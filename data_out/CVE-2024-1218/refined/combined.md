=== Content from www.wordfence.com_9e42791e_20250110_160755.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Contact Form builder with drag & drop for WordPress – Kali Forms <= 2.3.41 - Missing Authorization

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Contact Form builder with drag & drop for WordPress – Kali Forms <= 2.3.41 - Missing Authorization

4.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2024-1218](https://www.cve.org/CVERecord?id=CVE-2024-1218) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | February 19, 2024 |
| Last Updated | February 20, 2024 |
| Researcher | [Lucio Sá](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/lucio-sa) |

### Description

The Contact Form builder with drag & drop for WordPress – Kali Forms plugin for WordPress is vulnerable to unauthorized access and modification of data via API due to an inconsistent capability check on several REST endpoints in all versions up to, and including, 2.3.41. This makes it possible for authenticated attackers, with contributor access and higher, to obtain access to or modify forms or entries.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3036466/kali-forms/trunk?contextall=1&old=3029334&old_path=%2Fkali-forms%2Ftrunk)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fkali-forms%2Fcontact-form-builder-with-drag-drop-for-wordpress-kali-forms-2341-missing-authorization&t=Contact%20Form%20builder%20with%20drag%20%26%20drop%20for%20WordPress%20%E2%80%93%20Kali%20Forms%20%3C%3D%202.3.41%20-%20Missing%20Authorization "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fkali-forms%2Fcontact-form-builder-with-drag-drop-for-wordpress-kali-forms-2341-missing-authorization&text=Contact%20Form%20builder%20with%20drag%20%26%20drop%20for%20WordPress%20%E2%80%93%20Kali%20Forms%20%3C%3D%202.3.41%20-%20Missing%20Authorization "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fkali-forms%2Fcontact-form-builder-with-drag-drop-for-wordpress-kali-forms-2341-missing-authorization "LinkedIn")
Email

## Vulnerability Details for Contact Form builder with drag & drop for WordPress – Kali Forms

#### [Contact Form builder with drag & drop for WordPress – Kali Forms](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/kali-forms)

| Software Type | Plugin |
| --- | --- |
| Software Slug | kali-forms [(view on wordpress.org)](https://wordpress.org/plugins/kali-forms) |
| Patched? | Yes |
| Remediation | Update to version 2.3.42, or a newer patched version |
| Affected Version | * <= 2.3.41 |
| Patched Version | * 2.3.42 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_51c8276f_20250110_160754.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3036466%2Fkali-forms%2Ftrunk%3Fcontextall%3D1%26old%3D3029334%26old_path%3D%252Fkali-forms%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3029334/kali-forms/trunk?old=3036466&old_path=%2Fkali-forms%2Ftrunk)

---

# Changes in [kali-forms/trunk](/browser/kali-forms/trunk?rev=3036466 "Show entry in browser") [[3029334:3036466]](/log/kali-forms/trunk?rev=3036466&stop_rev=3029334 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[kali-forms/trunk](/browser/kali-forms/trunk?rev=3036466)
Files:

6 edited

* [Inc/Backend/Posts/class-submitted.php](/browser/kali-forms/trunk/Inc/Backend/Posts/class-submitted.php?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))
* [Inc/Backend/Rest/class-form-entries-rest-controller.php](/browser/kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [Inc/class-kaliforms.php](/browser/kali-forms/trunk/Inc/class-kaliforms.php?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [README.txt](/browser/kali-forms/trunk/README.txt?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [bootstrap.php](/browser/kali-forms/trunk/bootstrap.php?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [kali-forms.php](/browser/kali-forms/trunk/kali-forms.php?rev=3036466 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [kali-forms/trunk/Inc/Backend/Posts/class-submitted.php](/changeset/3036466/kali-forms/trunk/Inc/Backend/Posts/class-submitted.php?old=2498143&old_path=kali-forms%2Ftrunk%2FInc%2FBackend%2FPosts%2Fclass-submitted.php "Show the [3029334:3036466] differences restricted to kali-forms/trunk/Inc/Backend/Posts/class-submitted.php")

  | [r3029334](/browser/kali-forms/trunk/Inc/Backend/Posts/class-submitted.php?rev=2498143#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/Inc/Backend/Posts/class-submitted.php?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | namespace KaliForms\Inc\Backend\Posts; |
  | 3 | 3 |  |
  | 4 | 4 | use KaliForms\Inc\Frontend\Submission\_Shortcode; |
  | 5 | 5 | use KaliForms\Inc\Utils\Submission\_Actions; |
  | 6 | 6 | use KaliForms\Inc\Utils\Submission\_Action\_Helper as Action\_Helper; |
  | 7 | 7 | use KaliForms\Inc\Backend\Views\Form\_Entries\_Page; |
  | 8 | 8 |  |
  | 9 | 9 | if (!defined('ABSPATH')) { |
  | 10 | 10 | exit; |
  | 11 | 11 | } |
  | 12 | 12 |  |
  | 13 | 13 | /\*\* |
  | 14 | 14 | \* Submitted class |
  | 15 | 15 | \*/ |
  | 16 | 16 | class Submitted |
  | 17 | 17 | { |
  | 18 | 18 | /\*\* |
  | 19 | 19 | \* Current plugin slug |
  | 20 | 20 | \*/ |
  | 21 | 21 |  |
  | 22 | 22 | public $slug = 'kaliforms'; |
  | 23 | 23 | /\*\* |
  | 24 | 24 | \* Entry counter setter |
  | 25 | 25 | \* |
  | 26 | 26 | \* @var array |
  | 27 | 27 | \*/ |
  | 28 | 28 | public $entry\_counter = []; |
  | 29 | 29 | public $form\_type\_map = []; |
  | 30 | 30 | public $form\_field\_prop\_map = []; |
  | 31 | 31 | /\*\* |
  | 32 | 32 | \* Class Constructor |
  | 33 | 33 | \*/ |
  | 34 | 34 | public function \_\_construct() |
  | 35 | 35 | { |
  | 36 | 36 | $this->set\_entry\_counter(); |
  | 37 | 37 | $this->set\_form\_type\_map(); |
  | 38 | 38 | add\_action('init', [$this, 'register\_post\_type']); |
  | 39 | 39 | add\_filter('query\_vars', [$this, 'register\_formid\_var']); |
  | 40 | 40 | add\_action('pre\_get\_posts', [$this, 'alter\_query'], 99); |
  | 41 | 41 | add\_filter('manage\_edit-kaliforms\_forms\_columns', [$this, 'edit\_columns']); |
  | 42 | 42 | add\_action('manage\_kaliforms\_forms\_posts\_custom\_column', [$this, 'edit\_custom\_column'], 10, 2); |
  | 43 | 43 | add\_action('restrict\_manage\_posts', [$this, 'add\_form\_id\_filter']); |
  | 44 | 44 | // Edit viwes |
  | 45 | 45 | add\_action('views\_edit-kaliforms\_submitted', [$this, 'edit\_views']); |
  | 46 | 46 | // Enqueue the scripts needed for this particular post type |
  | 47 | 47 | add\_action('admin\_enqueue\_scripts', [$this, 'enqueue']); |
  | 48 | 48 | // Initiate the submission actions class ( ajax related to submissions ) |
  | 49 | 49 | new Submission\_Actions(); |
  | 50 | 50 | // Register the shortcode |
  | 51 | 51 | new Submission\_Shortcode(); |
  | 52 | 52 | /\*\* |
  | 53 | 53 | \* Register submenus |
  | 54 | 54 | \*/ |
  | 55 | 55 | add\_action('admin\_menu', [$this, 'register\_submenus']); |
  | 56 | 56 |  |
  | 57 | 57 | add\_filter('views\_edit-kaliforms\_submitted', [$this, 'add\_export\_tab'], 10, 1); |
  | 58 | 58 | } |
  | 59 | 59 | /\*\* |
  | 60 | 60 | \* Sets the entry counter formId => count so we can display the number in the column |
  | 61 | 61 | \* |
  | 62 | 62 | \* @return [] |
  | 63 | 63 | \*/ |
  | 64 | 64 | public function set\_entry\_counter() |
  | 65 | 65 | { |
  | 66 | 66 | $posts = new \WP\_Query(['post\_type' => $this->slug . '\_submitted', 'posts\_per\_page' => -1, 'post\_status' => 'publish']); |
  | 67 | 67 | if ($posts->have\_posts()) { |
  | 68 | 68 | foreach ($posts->posts as $post) { |
  | 69 | 69 | $form\_id = get\_post\_meta($post->ID, 'formId', true); |
  | 70 | 70 | if (!array\_key\_exists('form\_' . $form\_id, $this->entry\_counter)) { |
  | 71 | 71 | $this->entry\_counter['form\_' . $form\_id] = 0; |
  | 72 | 72 | } |
  | 73 | 73 |  |
  | 74 | 74 | $this->entry\_counter['form\_' . $form\_id] += 1; |
  | 75 | 75 | } |
  | 76 | 76 | } |
  | 77 | 77 |  |
  | 78 | 78 | wp\_reset\_postdata(); |
  | 79 | 79 | } |
  | 80 | 80 | /\*\* |
  | 81 | 81 | \* Registers the submenus |
  | 82 | 82 | \* |
  | 83 | 83 | \* @return void |
  | 84 | 84 | \*/ |
  | 85 | 85 | public function register\_submenus() |
  | 86 | 86 | { |
  | 87 | 87 | // add\_submenu\_page( |
  | 88 | 88 | //     'edit.php?post\_type=kaliforms\_forms', |
  | 89 | 89 | //     esc\_html\_\_('Form entries', 'kaliforms'), |
  | 90 | 90 | //     esc\_html\_\_('Form entries'), |
  | 91 | 91 | //     'manage\_options', |
  | 92 | 92 | //     'edit.php?post\_type=kaliforms\_submitted' |
  | 93 | 93 | // ); |
  | 94 | 94 |  |
  | 95 | 95 | add\_submenu\_page( |
  | 96 | 96 | 'edit.php?post\_type=kaliforms\_forms', |
  | 97 |  | esc\_html\_\_('Form entries', 'kaliforms'), |
  | 98 |  | esc\_html\_\_('Form entries', 'kaliforms'), |
  |  | 97 | esc\_html\_\_('Form entries', 'kaliforms'), |
  |  | 98 | esc\_html\_\_('Form entries', 'kaliforms'), |
  | 99 | 99 | 'manage\_options', |
  | 100 | 100 | 'kaliforms-form-entries', |
  | 101 | 101 | new Form\_Entries\_Page() |
  | 102 | 102 | ); |
  | 103 | 103 | } |
  | 104 | 104 | /\*\* |
  | 105 | 105 | \* Adds export tab |
  | 106 | 106 | \* |
  | 107 | 107 | \* @return void |
  | 108 | 108 | \*/ |
  | 109 | 109 | public function add\_export\_tab($views) |
  | 110 | 110 | { |
  | 111 | 111 | $tabs = [ |
  | 112 | 112 | 'entries'  => [ |
  | 113 | 113 | 'name' => esc\_html\_\_('Entries', 'kaliforms'), |
  | 114 | 114 | 'url'  => admin\_url('edit.php?post\_type=kaliforms\_submitted'), |
  | 115 | 115 | ], |
  | 116 | 116 | 'exporter' => [ |
  | 117 | 117 | 'name'   => esc\_html\_\_('Exporter (PRO)', 'kaliforms'), |
  | 118 | 118 | 'url'    => 'https://www.kaliforms.com/pricing?utm\_source=entriesPage&utm\_campaign=userInterests&utm\_medium=navTabButton', |
  | 119 | 119 | '\_blank' => true, |
  | 120 | 120 | ], |
  | 121 | 121 | ]; |
  | 122 | 122 |  |
  | 123 | 123 | $tabs = apply\_filters($this->slug . '\_submitted\_page\_tabs', $tabs); |
  | 124 | 124 |  |
  | 125 | 125 | $str = '<div class="nav-tab-wrapper">'; |
  | 126 | 126 | foreach ($tabs as $id => $tab) { |
  | 127 | 127 | $blank  = isset($tab['\_blank']) && $tab['\_blank'] ? 'target="\_blank"' : ''; |
  | 128 | 128 | $active = ('entries' === $id ? ' nav-tab-active' : ''); |
  | 129 | 129 | $str .= '<a href="' . esc\_url($tab['url']) . '" ' . $blank . ' class="nav-tab ' . $active . '">' . $tab['name'] . '</a>'; |
  | 130 | 130 | } |
  | 131 | 131 | $str .= '</div><br />'; |
  | 132 | 132 | echo $str; |
  | 133 | 133 | } |
  | 134 | 134 | /\*\* |
  | 135 | 135 | \* Custom post type enqueue |
  | 136 | 136 | \*/ |
  | 137 | 137 | public function enqueue() |
  | 138 | 138 | { |
  | 139 | 139 | $screen = get\_current\_screen(); |
  | 140 | 140 | if ($screen->id === 'edit-kaliforms\_submitted' || $screen->id === 'admin\_page\_kaliforms-submission-exporter') { |
  | 141 | 141 | $deps = ['underscore', 'jquery']; |
  | 142 | 142 | if ( |
  | 143 | 143 | wp\_script\_is('kaliforms-submission-plugin', 'registered') |
  | 144 | 144 | && $screen->id === 'admin\_page\_kaliforms-submission-exporter' |
  | 145 | 145 | ) { |
  | 146 | 146 | $deps[] = 'kaliforms-submission-plugin'; |
  | 147 | 147 | } |
  | 148 | 148 |  |
  | 149 | 149 | wp\_enqueue\_script( |
  | 150 | 150 | 'kaliforms-submission', |
  | 151 | 151 | KALIFORMS\_URL . 'assets/submissions/backend/js/kaliforms-submissions.js', |
  | 152 | 152 | $deps, |
  | 153 | 153 | KALIFORMS\_VERSION, |
  | 154 | 154 | true |
  | 155 | 155 | ); |
  | 156 | 156 |  |
  | 157 | 157 | wp\_localize\_script( |
  | 158 | 158 | 'kaliforms-submission', |
  | 159 | 159 | 'KaliFormsObject', |
  | 160 | 160 | ['ajaxurl' => esc\_url(admin\_url('admin-ajax.php')), 'ajax\_nonce' => wp\_create\_nonce($this->slug . '\_nonce')] |
  | 161 | 161 | ); |
  | 162 | 162 | } |
  | 163 | 163 | } |
  | 164 | 164 | /\*\* |
  | 165 | 165 | \* Adds the form id/name filter select |
  | 166 | 166 | \* |
  | 167 | 167 | \* @param [type] $post\_type |
  | 168 | 168 | \* @return void |
  | 169 | 169 | \*/ |
  | 170 | 170 | public function add\_form\_id\_filter($post\_type) |
  | 171 | 171 | { |
  | 172 | 172 | if ($post\_type !== 'kaliforms\_submitted') { |
  | 173 | 173 | return; |
  | 174 | 174 | } |
  | 175 | 175 | $options = []; |
  | 176 | 176 | $posts   = new \WP\_Query(['post\_type' => $this->slug . '\_forms', 'posts\_per\_page' => -1, 'post\_status' => 'publish']); |
  | 177 | 177 | if ($posts->have\_posts()) { |
  | 178 | 178 | while ($posts->have\_posts()) { |
  | 179 | 179 | $posts->the\_post(); |
  | 180 | 180 | $options[get\_the\_ID()] = get\_the\_title(); |
  | 181 | 181 | } |
  | 182 | 182 | } |
  | 183 | 183 | wp\_reset\_postdata(); |
  | 184 | 184 |  |
  | 185 | 185 | $str = '<select id="kaliforms-filter-by-id" name="formId">'; |
  | 186 | 186 | foreach ($options as $id => $title) { |
  | 187 | 187 | $checked = (isset($\_REQUEST['formId']) && absint($\_REQUEST['formId']) === $id) ? 'selected' : ''; |
  | 188 | 188 | $str .= '<option value="' . absint($id) . '" ' . $checked . '>' . esc\_html($title) . '</option>'; |
  | 189 | 189 | } |
  | 190 | 190 | $str .= '</select>'; |
  | 191 | 191 | echo $str; |
  | 192 | 192 | } |
  | 193 | 193 | /\*\* |
  | 194 | 194 | \* Edit the views |
  | 195 | 195 | \* |
  | 196 | 196 | \* @param Array $views |
  | 197 | 197 | \* @return Array |
  | 198 | 198 | \*/ |
  | 199 | 199 | public function edit\_views($views) |
  | 200 | 200 | { |
  | 201 | 201 |  |
  | 202 | 202 | // var\_dump(get\_current\_screen());die(); |
  | 203 | 203 | // var\_dump($views);die(); |
  | 204 | 204 | } |
  | 205 | 205 |  |
  | 206 | 206 | /\*\* |
  | 207 | 207 | \* Registers the post type |
  | 208 | 208 | \* |
  | 209 | 209 | \* @return void |
  | 210 | 210 | \*/ |
  | 211 | 211 | public function register\_post\_type() |
  | 212 | 212 | { |
  | 213 | 213 | register\_post\_type( |
  | 214 | 214 | 'kaliforms\_submitted', |
  | 215 | 215 | [ |
  | 216 | 216 | // Labels |
  | 217 | 217 | 'labels'              => [ |
  | 218 | 218 | 'name'          => esc\_html\_\_('Form Entries', 'kaliforms'), |
  | 219 | 219 | 'singular\_name' => esc\_html\_\_('Form Entry', 'kaliforms'), |
  | 220 | 220 | ], |
  | 221 | 221 | // Show in ui & menus |
  | 222 | 222 | 'show\_ui'             => true, |
  | 223 | 223 | 'show\_in\_menu'        => 'page=kaliforms\_settings', |
  | 224 | 224 | 'show\_in\_admin\_bar'   => false, |
  | 225 | 225 | 'show\_in\_rest'        => false, |
  | 226 | 226 | // Public |
  | 227 | 227 | 'public'              => true, |
  | 228 | 228 | 'publicly\_queryable'  => false, |
  | 229 | 229 | // has archive |
  | 230 | 230 | 'has\_archive'         => true, |
  | 231 | 231 | // URL rewrite |
  | 232 | 232 | 'rewrite'             => [ |
  | 233 | 233 | 'slug' => 'form-submissions', |
  | 234 | 234 | ], |
  | 235 | 235 | // 'menu\_icon' => KALIFORMS\_URL . 'assets/img/iconMenu.svg', |
  | 236 | 236 | 'supports'            => [], |
  | 237 | 237 | 'capabilities'        => ['create\_posts' => 'do\_not\_allow'], |
  | 238 | 238 | 'map\_meta\_cap'        => true, |
  | 239 | 239 | 'exclude\_from\_search' => true, |
  | 240 | 240 | 'hierarchical'        => false, |
  | 241 | 241 | ] |
  | 242 | 242 | ); |
  | 243 | 243 |  |
  | 244 | 244 | } |
  | 245 | 245 |  |
  | 246 | 246 | /\*\* |
  | 247 | 247 | \* Register the new formid param as queriable |
  | 248 | 248 | \* |
  | 249 | 249 | \* @param [type] $vars |
  | 250 | 250 | \* @return void |
  | 251 | 251 | \*/ |
  | 252 | 252 | public function register\_formid\_var($vars) |
  | 253 | 253 | { |
  | 254 | 254 | array\_push($vars, 'formId'); |
  | 255 | 255 |  |
  | 256 | 256 | return $vars; |
  | 257 | 257 | } |
  | 258 | 258 |  |
  | 259 | 259 | /\*\* |
  | 260 | 260 | \*  Alters the query so we get submissions only for the specific form Id |
  | 261 | 261 | \* |
  | 262 | 262 | \* @param [WP\_Query] $query |
  | 263 | 263 | \* @return void |
  | 264 | 264 | \*/ |
  | 265 | 265 | public function alter\_query($query) |
  | 266 | 266 | { |
  | 267 | 267 | if (!is\_admin() || !$query->is\_main\_query()) { |
  | 268 | 268 | return; |
  | 269 | 269 | } |
  | 270 | 270 |  |
  | 271 | 271 | if ($query->get('post\_type') !== 'kaliforms\_submitted') { |
  | 272 | 272 | return; |
  | 273 | 273 | } |
  | 274 | 274 |  |
  | 275 | 275 | $query->set('meta\_query', true); |
  | 276 | 276 | $query->set('meta\_key', 'formId'); |
  | 277 | 277 |  |
  | 278 | 278 | if (empty($\_REQUEST['formId'])) { |
  | 279 | 279 | // get first form |
  | 280 | 280 | $posts = new \WP\_Query(['post\_type' => $this->slug . '\_forms', 'posts\_per\_page' => 1, 'post\_status' => 'publish']); |
  | 281 | 281 | $id    = null; |
  | 282 | 282 | if ($posts->have\_posts()) { |
  | 283 | 283 | $query->set('meta\_value', $posts->post->ID); |
  | 284 | 284 | $id = $posts->post->ID; |
  | 285 | 285 | } |
  | 286 | 286 | wp\_reset\_postdata(); |
  | 287 | 287 | $\_REQUEST['formId'] = absint($id); |
  | 288 | 288 | } |
  | 289 | 289 |  |
  | 290 | 290 | if (!empty(absint($\_REQUEST['formId']))) { |
  | 291 | 291 | $query->set('meta\_value', absint($\_REQUEST['formId'])); |
  | 292 | 292 | } |
  | 293 | 293 |  |
  | 294 | 294 | add\_filter('manage\_edit-kaliforms\_submitted\_columns', [$this, 'edit\_submission\_columns']); |
  | 295 | 295 | add\_action('manage\_kaliforms\_submitted\_posts\_custom\_column', [$this, 'edit\_submission\_custom\_columns'], 10, 2); |
  | 296 | 296 | } |
  | 297 | 297 | /\*\* |
  | 298 | 298 | \* Edits custom column |
  | 299 | 299 | \* |
  | 300 | 300 | \* @param [string] $column |
  | 301 | 301 | \* @param [number] $post\_id |
  | 302 | 302 | \* @return void |
  | 303 | 303 | \*/ |
  | 304 | 304 | public function edit\_custom\_column($column, $post\_id) |
  | 305 | 305 | { |
  | 306 | 306 | $count = array\_key\_exists('form\_' . $post\_id, $this->entry\_counter) ? $this->entry\_counter['form\_' . $post\_id] : 0; |
  | 307 | 307 | switch ($column) { |
  | 308 | 308 | case 'submissions': |
  | 309 | 309 | echo ($count > 0) |
  | 310 | 310 | ? '<a href="edit.php?post\_type=kaliforms\_forms&page=kaliforms-form-entries#/form-entries/' . absint($post\_id) . '">' . sprintf(esc\_html\_\_('See entries (%s)', 'kaliforms'), $count) . '</a>' |
  | 311 | 311 | : esc\_html\_\_('Form has no entries', 'kaliforms'); |
  | 312 | 312 | break; |
  | 313 | 313 | default: |
  | 314 | 314 | break; |
  | 315 | 315 | } |
  | 316 | 316 | } |
  | 317 | 317 | /\*\* |
  | 318 | 318 | \* Edits columns in the edit posts page, so we can add what we need |
  | 319 | 319 | \* |
  | 320 | 320 | \* @param [Array] $columns |
  | 321 | 321 | \* @return void |
  | 322 | 322 | \*/ |
  | 323 | 323 | public function edit\_columns($columns) |
  | 324 | 324 | { |
  | 325 | 325 | $date = $columns['date']; |
  | 326 | 326 | unset($columns['date']); |
  | 327 | 327 |  |
  | 328 | 328 | $columns = array\_merge( |
  | 329 | 329 | $columns, |
  | 330 | 330 | [ |
  | 331 | 331 | 'submissions' => esc\_html\_\_('Submissions', 'kaliforms'), 'date' => $date, |
  | 332 | 332 | ] |
  | 333 | 333 | ); |
  | 334 | 334 | return $columns; |
  | 335 | 335 | } |
  | 336 | 336 | /\*\* |
  | 337 | 337 | \* Edits submission custom columns |
  | 338 | 338 | \* |
  | 339 | 339 | \* @param [string] $column |
  | 340 | 340 | \* @param [number] $post\_id |
  | 341 | 341 | \* @return void |
  | 342 | 342 | \*/ |
  | 343 | 343 | public function edit\_submission\_custom\_columns($column, $post\_id) |
  | 344 | 344 | { |
  | 345 | 345 | if (empty($this->form\_type\_map)) { |
  | 346 | 346 | $this->set\_form\_type\_map(); |
  | 347 | 347 | } |
  | 348 | 348 |  |
  | 349 | 349 | switch ($column) { |
  | 350 | 350 | case 'actions': |
  | 351 | 351 | $form\_id = null; |
  | 352 | 352 | if (get\_query\_var('formId')) { |
  | 353 | 353 | $form\_id = get\_query\_var('formId'); |
  | 354 | 354 | } |
  | 355 | 355 | if ($form\_id === null) { |
  | 356 | 356 | if (!isset($\_REQUEST['formId'])) { |
  | 357 | 357 | return; |
  | 358 | 358 | } |
  | 359 | 359 |  |
  | 360 | 360 | $form\_id = absint($\_REQUEST['formId']); |
  | 361 | 361 | } |
  | 362 | 362 |  |
  | 363 | 363 | echo '<div class="button-group">'; |
  | 364 | 364 | echo sprintf( |
  | 365 | 365 | '<button class="button button-small kaliforms-submission-link" data-link="%s">%s</button>', |
  | 366 | 366 | Action\_Helper::get\_submission\_link(false, $post\_id, $form\_id), |
  | 367 | 367 | '<span class="dashicons dashicons-admin-links"></span>' |
  | 368 | 368 | ); |
  | 369 | 369 | echo sprintf( |
  | 370 | 370 | '<button class="button button-small kaliforms-resend-emails" data-submission-id="%s" data-form-id="%s">%s</button>', |
  | 371 | 371 | $post\_id, |
  | 372 | 372 | $form\_id, |
  | 373 | 373 | '<span class="dashicons dashicons-email-alt"></span>' |
  | 374 | 374 | ); |
  | 375 | 375 | echo '</div>'; |
  | 376 | 376 | break; |
  | 377 | 377 | default: |
  | 378 | 378 | $val = esc\_html(get\_post\_meta($post\_id, $column, true)); |
  | 379 | 379 | if (!isset($this->form\_type\_map[$column])) { |
  | 380 | 380 | echo esc\_html($val); |
  | 381 | 381 | return; |
  | 382 | 382 | } |
  | 383 | 383 | switch ($this->form\_type\_map[$column]) { |
  | 384 | 384 | case 'ip': |
  | 385 | 385 | echo empty($val) ? esc\_html\_\_('N\A', 'kaliforms') : esc\_html($val); |
  | 386 | 386 | break; |
  | 387 | 387 | case 'radio': |
  | 388 | 388 | case 'dropdown': |
  | 389 | 389 | foreach ($this->form\_field\_prop\_map[$column]->choices as $choice) { |
  | 390 | 390 | if ($choice->value === $val) { |
  | 391 | 391 | $val = !empty($choice->label) |
  | 392 | 392 | ? esc\_html($choice->label) |
  | 393 | 393 | : esc\_html($choice->value); |
  | 394 | 394 | } |
  | 395 | 395 | }; |
  | 396 | 396 | echo esc\_html($val); |
  | 397 | 397 | break; |
  | 398 | 398 | case 'checkbox': |
  | 399 | 399 | case 'choices': |
  | 400 | 400 | $values = explode($this->form\_field\_prop\_map[$column]->separator, $val); |
  | 401 | 401 | $newVal = []; |
  | 402 | 402 | foreach ($values as $value) { |
  | 403 | 403 | foreach ($this->form\_field\_prop\_map[$column]->choices as $choice) { |
  | 404 | 404 | if ($choice->value === $value) { |
  | 405 | 405 | $newVal[] = !empty($choice->label) |
  | 406 | 406 | ? esc\_html($choice->label) |
  | 407 | 407 | : esc\_html($choice->value); |
  | 408 | 408 | } |
  | 409 | 409 | } |
  | 410 | 410 | } |
  | 411 | 411 | echo esc\_html(implode($this->form\_field\_prop\_map[$column]->separator, $newVal)); |
  | 412 | 412 | break; |
  | 413 | 413 | case 'fileUpload': |
  | 414 | 414 | $images = explode(',', $val); |
  | 415 | 415 | foreach ($images as $uId) { |
  | 416 | 416 | $img = wp\_get\_attachment\_url($uId); |
  | 417 | 417 | echo '<img style="width:150px" src="' . esc\_url($img) . '" /><br/>'; |
  | 418 | 418 | } |
  | 419 | 419 | break; |
  | 420 | 420 | case 'imageRadio': |
  | 421 | 421 | $img = wp\_get\_attachment\_url($val); |
  | 422 | 422 | echo '<img style="width:150px" src="' . esc\_url($img) . '" />'; |
  | 423 | 423 | break; |
  | 424 | 424 | case 'digitalSignature': |
  | 425 | 425 | $validB64 = preg\_match("/data:([a-zA-Z0-9]+\/[a-zA-Z0-9-.+]+).base64,.\*/", $val); |
  | 426 | 426 | if ($validB64 > 0) { |
  | 427 | 427 | echo '<img style="width:150px" src="' . $val . '" />'; |
  | 428 | 428 | break; |
  | 429 | 429 | } |
  | 430 | 430 | $img = wp\_get\_attachment\_url($val); |
  | 431 | 431 | echo '<img style="width:150px" src="' . esc\_url($img) . '" />'; |
  | 432 | 432 | break; |
  | 433 | 433 | default: |
  | 434 | 434 | echo esc\_html\_\_($val); |
  | 435 | 435 | break; |
  | 436 | 436 | } |
  | 437 | 437 | } |
  | 438 | 438 | } |
  | 439 | 439 |  |
  | 440 | 440 | /\*\* |
  | 441 | 441 | \* Generates a link to delete the submission |
  | 442 | 442 | \* |
  | 443 | 443 | \* @param [type] $post\_id |
  | 444 | 444 | \* @param [type] $form\_id |
  | 445 | 445 | \* @return void |
  | 446 | 446 | \*/ |
  | 447 | 447 | public function get\_delete\_link($post\_id, $form\_id) |
  | 448 | 448 | { |
  | 449 | 449 | return 'bye-world'; |
  | 450 | 450 | } |
  | 451 | 451 | /\*\* |
  | 452 | 452 | \* Plucks values from the properties array |
  | 453 | 453 | \* |
  | 454 | 454 | \* @param [String] $key |
  | 455 | 455 | \* @param [stdClass] $obj |
  | 456 | 456 | \* @return String |
  | 457 | 457 | \*/ |
  | 458 | 458 | public function pluck\_value\_from\_properties($key, $obj) |
  | 459 | 459 | { |
  | 460 | 460 | if (isset($obj->properties->{$key})) { |
  | 461 | 461 | return $obj->properties->{$key}; |
  | 462 | 462 | } |
  | 463 | 463 | } |
  | 464 | 464 | /\*\* |
  | 465 | 465 | \* Get first form |
  | 466 | 466 | \* |
  | 467 | 467 | \* @return void |
  | 468 | 468 | \*/ |
  | 469 | 469 | public function get\_first\_form() |
  | 470 | 470 | { |
  | 471 | 471 | $post  = null; |
  | 472 | 472 | $posts = new \WP\_Query(['post\_type' => $this->slug . '\_forms', 'posts\_per\_page' => 1, 'post\_status' => 'publish']); |
  | 473 | 473 | if ($posts->have\_posts()) { |
  | 474 | 474 | $post = $posts->post; |
  | 475 | 475 | } |
  | 476 | 476 | wp\_reset\_postdata(); |
  | 477 | 477 | return $post; |
  | 478 | 478 | } |
  | 479 | 479 | /\*\* |
  | 480 | 480 | \* Add columns dynamically based on the submitted data |
  | 481 | 481 | \* |
  | 482 | 482 | \* @param [Array] $columns |
  | 483 | 483 | \* @return void |
  | 484 | 484 | \*/ |
  | 485 | 485 | public function edit\_submission\_columns($columns) |
  | 486 | 486 | { |
  | 487 | 487 | $arr               = $this->\_get\_field\_components(); |
  | 488 | 488 | $arr['actions']    = esc\_html\_\_('Actions', 'kaliforms'); |
  | 489 | 489 | $arr['ip\_address'] = esc\_html\_\_('Ip address', 'kaliforms'); |
  | 490 | 490 | $arr['date']       = $columns['date']; |
  | 491 | 491 | unset($columns['title']); |
  | 492 | 492 | unset($columns['date']); |
  | 493 | 493 |  |
  | 494 | 494 | $columns = array\_merge($columns, $arr); |
  | 495 | 495 | return $columns; |
  | 496 | 496 | } |
  | 497 | 497 |  |
  | 498 | 498 | /\*\* |
  | 499 | 499 | \* Set form type map |
  | 500 | 500 | \* |
  | 501 | 501 | \* @return void |
  | 502 | 502 | \*/ |
  | 503 | 503 | public function set\_form\_type\_map() |
  | 504 | 504 | { |
  | 505 | 505 | if (empty($\_REQUEST['formId'])) { |
  | 506 | 506 | return; |
  | 507 | 507 | } |
  | 508 | 508 |  |
  | 509 | 509 | $form       = !empty($\_REQUEST['formId']) ? get\_post($\_REQUEST['formId']) : $this->get\_first\_form(); |
  | 510 | 510 | $components = get\_post\_meta($form->ID, $this->slug . '\_field\_components', true); |
  | 511 | 511 | $separator  = get\_post\_meta($form->ID, $this->slug . '\_multiple\_selections\_separator', true); |
  | 512 | 512 | if ($components === null || $components === '' && $components !== null) { |
  | 513 | 513 | return $columns; |
  | 514 | 514 | } |
  | 515 | 515 | $components = json\_decode($components); |
  | 516 | 516 | $arr        = []; |
  | 517 | 517 | $propsArr   = []; |
  | 518 | 518 | foreach ($components as $component) { |
  | 519 | 519 | $name = $this->pluck\_value\_from\_properties('name', $component); |
  | 520 | 520 |  |
  | 521 | 521 | if (empty($name)) { |
  | 522 | 522 | continue; |
  | 523 | 523 | } |
  | 524 | 524 |  |
  | 525 | 525 | $arr[$name]                 = $component->id; |
  | 526 | 526 | $propsArr[$name]            = $component->properties; |
  | 527 | 527 | $propsArr[$name]->separator = $separator; |
  | 528 | 528 | } |
  | 529 | 529 |  |
  | 530 | 530 | $arr['ip\_address']      = 'ip'; |
  | 531 | 531 | $propsArr['ip\_address'] = [ |
  | 532 | 532 | 'id'   => 'ip\_address', |
  | 533 | 533 | 'name' => 'ip\_address', |
  | 534 | 534 | ]; |
  | 535 | 535 | $this->form\_type\_map       = $arr; |
  | 536 | 536 | $this->form\_field\_prop\_map = $propsArr; |
  | 537 | 537 | } |
  | 538 | 538 | /\*\* |
  | 539 | 539 | \* Get field components |
  | 540 | 540 | \* |
  | 541 | 541 | \* @return void |
  | 542 | 542 | \*/ |
  | 543 | 543 | private function \_get\_field\_components() |
  | 544 | 544 | { |
  | 545 | 545 | $form       = !empty($\_REQUEST['formId']) ? get\_post(absint($\_REQUEST['formId'])) : $this->get\_first\_form(); |
  | 546 | 546 | $components = get\_post\_meta($form->ID, $this->slug . '\_field\_components', true); |
  | 547 | 547 | if ($components === null || $components === '' && $components !== null) { |
  | 548 | 548 | return $columns; |
  | 549 | 549 | } |
  | 550 | 550 | $components = json\_decode($components); |
  | 551 | 551 | $arr        = []; |
  | 552 | 552 | $skip       = ['payPal', 'grecaptcha', 'stripe', 'wireTransfer', 'button', 'submitButton', 'divider']; |
  | 553 | 553 | foreach ($components as $component) { |
  | 554 | 554 | if (in\_array($component->id, $skip)) { |
  | 555 | 555 | continue; |
  | 556 | 556 | } |
  | 557 | 557 |  |
  | 558 | 558 | $name = $this->pluck\_value\_from\_properties('name', $component); |
  | 559 | 559 | if (empty($name)) { |
  | 560 | 560 | continue; |
  | 561 | 561 | } |
  | 562 | 562 |  |
  | 563 | 563 | $caption    = $this->pluck\_value\_from\_properties('caption', $component); |
  | 564 | 564 | $arr[$name] = empty($caption) ? $name : $caption; |
  | 565 | 565 | if ($component->id === 'hidden') { |
  | 566 | 566 | $arr[$name] = $name; |
  | 567 | 567 | } |
  | 568 | 568 | } |
  | 569 | 569 | $arr = array\_filter($arr); |
  | 570 | 570 |  |
  | 571 | 571 | $arr['ip\_address'] = 'ip\_address'; |
  | 572 | 572 |  |
  | 573 | 573 | return $arr; |
  | 574 | 574 | } |
  | 575 | 575 | } |
* ## [kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php](/changeset/3036466/kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php?old=2698344&old_path=kali-forms%2Ftrunk%2FInc%2FBackend%2FRest%2Fclass-form-entries-rest-controller.php "Show the [3029334:3036466] differences restricted to kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php")

  | [r3029334](/browser/kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php?rev=2698344#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/Inc/Backend/Rest/class-form-entries-rest-controller.php?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | namespace KaliForms\Inc\Backend\Rest; |
  | 4 | 4 |  |
  | 5 | 5 | if (!defined('ABSPATH')) { |
  | 6 | 6 | exit; |
  | 7 | 7 | } |
  | 8 | 8 |  |
  | 9 | 9 | use KaliForms\Inc\Utils\Post\_Translator; |
  | 10 | 10 | use KaliForms\Inc\Utils\Submission\_Action\_Helper as Action\_Helper; |
  | 11 | 11 |  |
  | 12 | 12 | class Form\_Entries\_Rest\_Controller extends \WP\_REST\_Controller |
  | 13 | 13 | { |
  | 14 | 14 | /\*\* |
  | 15 | 15 | \* Public slug |
  | 16 | 16 | \* |
  | 17 | 17 | \* @var string |
  | 18 | 18 | \*/ |
  | 19 | 19 | public $slug = 'kaliforms'; |
  | 20 | 20 |  |
  | 21 | 21 | /\*\* |
  | 22 | 22 | \* Schema |
  | 23 | 23 | \* |
  | 24 | 24 | \* @var array |
  | 25 | 25 | \*/ |
  | 26 | 26 | public $schema = []; |
  | 27 | 27 |  |
  | 28 | 28 | /\*\* |
  | 29 | 29 | \* Meta fields |
  | 30 | 30 | \* |
  | 31 | 31 | \* @var array |
  | 32 | 32 | \*/ |
  | 33 | 33 | public $meta\_fields = []; |
  | 34 | 34 |  |
  | 35 | 35 | /\*\* |
  | 36 | 36 | \* Display fields for the current form ( detailed look ) |
  | 37 | 37 | \* |
  | 38 | 38 | \* @var array |
  | 39 | 39 | \*/ |
  | 40 | 40 | public $display\_fields = []; |
  | 41 | 41 |  |
  | 42 | 42 | /\*\* |
  | 43 | 43 | \* Multiple item separator |
  | 44 | 44 | \* |
  | 45 | 45 | \* @var string |
  | 46 | 46 | \*/ |
  | 47 | 47 | public $separator = ','; |
  | 48 | 48 |  |
  | 49 | 49 | /\*\* |
  | 50 | 50 | \* @var string |
  | 51 | 51 | \*/ |
  | 52 | 52 | public $ip\_address = ''; |
  | 53 | 53 |  |
  | 54 | 54 | /\*\* |
  | 55 | 55 | \* Post type |
  | 56 | 56 | \* |
  | 57 | 57 | \* @var string |
  | 58 | 58 | \*/ |
  | 59 | 59 | public $post\_type = 'kaliforms\_submitted'; |
  | 60 | 60 |  |
  | 61 | 61 | /\*\* |
  | 62 | 62 | \* Class constructor |
  | 63 | 63 | \*/ |
  | 64 | 64 | public function \_\_construct() |
  | 65 | 65 | { |
  | 66 | 66 | $this->namespace              = $this->slug . '/v1'; |
  | 67 | 67 | $this->resource\_name          = 'entries'; |
  | 68 | 68 | $this->singular\_resource\_name = 'entry'; |
  | 69 | 69 | } |
  | 70 | 70 |  |
  | 71 | 71 | /\*\* |
  | 72 | 72 | \* Route registration |
  | 73 | 73 | \* |
  | 74 | 74 | \* @return void |
  | 75 | 75 | \*/ |
  | 76 | 76 | public function register\_routes() |
  | 77 | 77 | { |
  | 78 | 78 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/(?P<id>[\d]+)', [ |
  | 79 | 79 | [ |
  | 80 | 80 | 'methods' => 'GET', |
  | 81 | 81 | 'callback' => [$this, 'get\_items'], |
  | 82 | 82 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 83 | 83 | 'args' => $this->get\_collection\_params(), |
  | 84 | 84 | ], |
  | 85 | 85 | ]); |
  | 86 | 86 |  |
  | 87 | 87 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/parsed/(?P<id>[\d]+)', [ |
  | 88 | 88 | 'methods' => 'GET', |
  | 89 | 89 | 'callback' => [$this, 'get\_items\_for\_display'], |
  | 90 | 90 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 91 | 91 | 'args' => $this->get\_collection\_params(), |
  | 92 | 92 | ]); |
  | 93 | 93 |  |
  | 94 | 94 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/aggregate/', [ |
  | 95 | 95 | 'methods' => 'GET', |
  | 96 | 96 | 'callback' => [$this, 'get\_items\_aggregate'], |
  | 97 | 97 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 98 | 98 | 'args' => $this->get\_collection\_params(), |
  | 99 | 99 | ]); |
  | 100 | 100 |  |
  | 101 | 101 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/aggregate/parsed', [ |
  | 102 | 102 | 'methods' => 'GET', |
  | 103 | 103 | 'callback' => [$this, 'get\_items\_aggregate\_for\_display'], |
  | 104 | 104 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 105 | 105 | 'args' => $this->get\_collection\_params(), |
  | 106 | 106 | ]); |
  | 107 | 107 |  |
  | 108 | 108 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/(?P<id>[\d]+)', [ |
  | 109 | 109 | 'methods' => 'PATCH', |
  | 110 | 110 | 'callback' => [$this, 'edit\_item'], |
  | 111 | 111 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 112 | 112 | ]); |
  | 113 | 113 |  |
  | 114 | 114 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/(?P<id>[\d]+)', [ |
  | 115 | 115 | 'methods' => 'DELETE', |
  | 116 | 116 | 'callback' => [$this, 'delete\_item'], |
  | 117 | 117 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 118 | 118 | ]); |
  | 119 | 119 |  |
  | 120 | 120 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/delete', [ |
  | 121 | 121 | 'methods' => 'POST', |
  | 122 | 122 | 'callback' => [$this, 'delete\_items'], |
  | 123 | 123 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 124 | 124 | ]); |
  | 125 | 125 |  |
  | 126 | 126 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/export', [ |
  | 127 | 127 | 'methods' => 'POST', |
  | 128 | 128 | 'callback' => [$this, 'start\_export'], |
  | 129 | 129 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 130 | 130 | ]); |
  | 131 | 131 |  |
  | 132 | 132 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/export/google-sheets', [ |
  | 133 | 133 | 'methods' => 'GET', |
  | 134 | 134 | 'callback' => [$this, 'get\_sheets'], |
  | 135 | 135 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 136 | 136 | ]); |
  | 137 | 137 |  |
  | 138 | 138 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/resend-emails', [ |
  | 139 | 139 | 'methods' => 'POST', |
  | 140 | 140 | 'callback' => [$this, 'resend\_emails'], |
  | 141 | 141 | 'permission\_callback' => [$this, 'edit\_item\_check'], |
  | 142 | 142 | ]); |
  | 143 | 143 | register\_rest\_route($this->namespace, '/' . $this->resource\_name . '/frontend-link', [ |
  | 144 | 144 | 'methods' => 'POST', |
  | 145 | 145 | 'callback' => [$this, 'get\_frontend\_link'], |
  | 146 | 146 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 147 | 147 | ]); |
  | 148 | 148 | register\_rest\_route($this->namespace, '/' . $this->singular\_resource\_name . '/(?P<id>[\d]+)', [ |
  | 149 | 149 | 'methods' => 'GET', |
  | 150 | 150 | 'callback' => [$this, 'get\_item'], |
  | 151 | 151 | 'permission\_callback' => [$this, 'get\_items\_permissions\_check'], |
  | 152 | 152 | 'args' => $this->get\_collection\_params(), |
  | 153 | 153 | ]); |
  | 154 | 154 | } |
  | 155 | 155 |  |
  | 156 | 156 | /\*\* |
  | 157 | 157 | \* Return the frontend link |
  | 158 | 158 | \* |
  | 159 | 159 | \* @param $request |
  | 160 | 160 | \* @return \WP\_Error|\WP\_HTTP\_Response|\WP\_REST\_Response |
  | 161 | 161 | \*/ |
  | 162 | 162 | public function get\_frontend\_link($request) |
  | 163 | 163 | { |
  | 164 | 164 | $params = $request->get\_json\_params(); |
  | 165 | 165 | if (get\_post\_type((int) $params['id']) !== $this->slug . '\_submitted') { |
  | 166 | 166 | return rest\_ensure\_response(['status' => false, 'message' => 'post is not an entry']); |
  | 167 | 167 | } |
  | 168 | 168 | if (get\_post\_type((int) $params['formId']) !== $this->slug . '\_forms') { |
  | 169 | 169 | return rest\_ensure\_response(['status' => false, 'message' => 'post is not a form']); |
  | 170 | 170 | } |
  | 171 | 171 |  |
  | 172 | 172 | return rest\_ensure\_response([ |
  | 173 | 173 | 'status' => true, |
  | 174 | 174 | 'url' => Action\_Helper::get\_submission\_link(false, $params['id'], $params['formId']), |
  | 175 | 175 | ]); |
  | 176 | 176 | } |
  | 177 | 177 |  |
  | 178 | 178 | /\*\* |
  | 179 | 179 | \* Resends emails |
  | 180 | 180 | \* |
  | 181 | 181 | \* @param $request |
  | 182 | 182 | \* @return \WP\_Error|\WP\_HTTP\_Response|\WP\_REST\_Response |
  | 183 | 183 | \*/ |
  | 184 | 184 | public function resend\_emails($request) |
  | 185 | 185 | { |
  | 186 | 186 | $params = $request->get\_json\_params(); |
  | 187 | 187 | if (get\_post\_type((int) $params['id']) !== $this->slug . '\_submitted') { |
  | 188 | 188 | return rest\_ensure\_response(['status' => false, 'message' => 'post is not an entry']); |
  | 189 | 189 | } |
  | 190 | 190 | if (get\_post\_type((int) $params['formId']) !== $this->slug . '\_forms') { |
  | 191 | 191 | return rest\_ensure\_response(['status' => false, 'message' => 'post is not a form']); |
  | 192 | 192 | } |
  | 193 | 193 |  |
  | 194 | 194 | $action = new Action\_Helper((int) $params['formId'], (int) $params['id']); |
  | 195 | 195 | if (is\_wp\_error($action)) { |
  | 196 | 196 | return rest\_ensure\_response([ |
  | 197 | 197 | 'status' => false, |
  | 198 | 198 | 'message' => sprintf('Soemthing wrong with formId: %s or submissionID : %s', $params['formId'], $params['id']), |
  | 199 | 199 | ]); |
  | 200 | 200 | } |
  | 201 | 201 |  |
  | 202 | 202 | $status = $action->send\_emails(); |
  | 203 | 203 | if (is\_wp\_error($status)) { |
  | 204 | 204 | return rest\_ensure\_response(['status' => false, 'message' => 'Sending failed']); |
  | 205 | 205 | } |
  | 206 | 206 |  |
  | 207 | 207 | return rest\_ensure\_response($status === 'ok' ? [ |
  | 208 | 208 | 'status' => true, |
  | 209 | 209 | 'message' => 'Notifications sent', |
  | 210 | 210 | ] : ['status' => false, 'message' => 'Status did not return `ok`']); |
  | 211 | 211 | } |
  | 212 | 212 |  |
  | 213 | 213 | /\*\* |
  | 214 | 214 | \* Get the sheets |
  | 215 | 215 | \* |
  | 216 | 216 | \* @param $request |
  | 217 | 217 | \* @return \WP\_Error|\WP\_HTTP\_Response|\WP\_REST\_Response |
  | 218 | 218 | \*/ |
  | 219 | 219 | public function get\_sheets($request) |
  | 220 | 220 | { |
  | 221 | 221 | if (!class\_exists('KaliForms\Inc\Utils\Export')) { |
  | 222 | 222 | return rest\_ensure\_response(['status' => false, 'message' => \_\_('Upgrade to PRO', 'kaliforms')]); |
  | 223 | 223 | } |
  | 224 | 224 |  |
  | 225 | 225 | if (!class\_exists('KaliForms\Inc\Google\_Sheets\_Helper')) { |
  | 226 | 226 | return rest\_ensure\_response([ |
  | 227 | 227 | 'status' => false, |
  | 228 | 228 | 'message' => \_\_('Google Sheets plugin not installed', 'kaliforms'), |
  | 229 | 229 | ]); |
  | 230 | 230 | } |
  | 231 | 231 |  |
  | 232 | 232 | $export = new \KaliForms\Inc\Utils\Export(); |
  | 233 | 233 |  |
  | 234 | 234 | return $export->get\_sheets($request); |
  | 235 | 235 | } |
  | 236 | 236 |  |
  | 237 | 237 | /\*\* |
  | 238 | 238 | \* Start export function |
  | 239 | 239 | \* |
  | 240 | 240 | \* @param [type] $request |
  | 241 | 241 | \* @return void |
  | 242 | 242 | \*/ |
  | 243 | 243 | public function start\_export($request) |
  | 244 | 244 | { |
  | 245 | 245 | if (!class\_exists('KaliForms\Inc\Utils\Export')) { |
  | 246 | 246 | return rest\_ensure\_response(['status' => false, 'message' => \_\_('Upgrade to PRO', 'kaliforms')]); |
  | 247 | 247 | } |
  | 248 | 248 |  |
  | 249 | 249 | $params = $request->get\_json\_params(); |
  | 250 | 250 |  |
  | 251 | 251 | $this->\_get\_available\_meta((int) $params['form']); |
  | 252 | 252 |  |
  | 253 | 253 | $export = new \KaliForms\Inc\Utils\Export(); |
  | 254 | 254 | $export->set\_stuff($this->display\_fields, $this->meta\_fields, $this->separator); |
  | 255 | 255 |  |
  | 256 | 256 | return $export->start\_export($request); |
  | 257 | 257 | } |
  | 258 | 258 |  |
  | 259 | 259 | /\*\* |
  | 260 | 260 | \* Check permissions for the posts. |
  | 261 | 261 | \* |
  | 262 | 262 | \* @param WP\_REST\_Request $request Current request. |
  | 263 | 263 | \*/ |
  | 264 | 264 | public function get\_items\_permissions\_check($request) |
  | 265 | 265 | { |
  | 266 |  | if (!current\_user\_can('~~edit\_post~~s')) { |
  |  | 266 | if (!current\_user\_can('manage\_options')) { |
  | 267 | 267 | return new \WP\_Error('rest\_forbidden', esc\_html\_\_('You cannot view the post resource.', 'kaliforms'), ['status' => $this->authorization\_status\_code()]); |
  | 268 | 268 | } |
  | 269 | 269 |  |
  | 270 | 270 | return true; |
  | 271 | 271 | } |
  | 272 | 272 |  |
  | 273 | 273 | /\*\* |
  | 274 | 274 | \* Check permission to edit a post |
  | 275 | 275 | \* |
  | 276 | 276 | \* @param [type] $request |
  | 277 | 277 | \* @return void |
  | 278 | 278 | \*/ |
  | 279 | 279 | public function edit\_item\_check($request) |
  | 280 | 280 | { |
  | 281 |  | if (!current\_user\_can('~~edit\_post~~s')) { |
  |  | 281 | if (!current\_user\_can('manage\_options')) { |
  | 282 | 282 | return new \WP\_Error('rest\_forbidden', esc\_html\_\_('You cannot edit the post resource.', 'kaliforms'), ['status' => $this->authorization\_status\_code()]); |
  | 283 | 283 | } |
  | 284 | 284 |  |
  | 285 | 285 | return true; |
  | 286 | 286 | } |
  | 287 | 287 |  |
  | 288 | 288 | /\*\* |
  | 289 | 289 | \* Edit item request |
  | 290 | 290 | \* |
  | 291 | 291 | \* @param [type] $request |
  | 292 | 292 | \* @return void |
  | 293 | 293 | \*/ |
  | 294 | 294 | public function edit\_item($request) |
  | 295 | 295 | { |
  | 296 | 296 | $options  = $this->\_get\_options\_to\_update($request); |
  | 297 | 297 | $response = $this->\_update\_item\_meta((int) $request['id'], $options); |
  | 298 | 298 |  |
  | 299 | 299 | return rest\_ensure\_response($response); |
  | 300 | 300 | } |
  | 301 | 301 |  |
  | 302 | 302 | /\*\* |
  | 303 | 303 | \* Delete item |
  | 304 | 304 | \* |
  | 305 | 305 | \* @param [type] $request |
  | 306 | 306 | \* @return void |
  | 307 | 307 | \*/ |
  | 308 | 308 | public function delete\_item($request) |
  | 309 | 309 | { |
  | 310 | 310 | $post\_type = get\_post\_type((int) $request['id']); |
  | 311 | 311 | if ($post\_type !== $this->slug . '\_submitted') { |
  | 312 | 312 | return rest\_ensure\_response(['status' => false]); |
  | 313 | 313 | } |
  | 314 | 314 | $deleted = wp\_delete\_post($request['id'], true); |
  | 315 | 315 |  |
  | 316 | 316 | return rest\_ensure\_response(['status' => $deleted]); |
  | 317 | 317 | } |
  | 318 | 318 |  |
  | 319 | 319 | /\*\* |
  | 320 | 320 | \* Delete multiple items |
  | 321 | 321 | \* |
  | 322 | 322 | \* @param [type] $request |
  | 323 | 323 | \* @return void |
  | 324 | 324 | \*/ |
  | 325 | 325 | public function delete\_items($request) |
  | 326 | 326 | { |
  | 327 | 327 | $params  = $request->get\_json\_params(); |
  | 328 | 328 | $deleted = []; |
  | 329 | 329 | foreach ($params['ids'] as $id) { |
  | 330 | 330 | if (get\_post\_type((int) $id) !== $this->slug . '\_submitted') { |
  | 331 | 331 | continue; |
  | 332 | 332 | } |
  | 333 | 333 |  |
  | 334 | 334 | $deleted[] = wp\_delete\_post($id, true); |
  | 335 | 335 | } |
  | 336 | 336 |  |
  | 337 | 337 | return rest\_ensure\_response(['status' => true, 'deleted' => $deleted]); |
  | 338 | 338 | } |
  | 339 | 339 |  |
  | 340 | 340 | /\*\* |
  | 341 | 341 | \* Update item meta |
  | 342 | 342 | \* |
  | 343 | 343 | \* @param [int] $id |
  | 344 | 344 | \* @param [array] $options |
  | 345 | 345 | \* @return void |
  | 346 | 346 | \*/ |
  | 347 | 347 | private function \_update\_item\_meta($id, $options) |
  | 348 | 348 | { |
  | 349 | 349 | $updated = []; |
  | 350 | 350 | foreach ($options as $key => $value) { |
  | 351 | 351 | $updated[$key] = update\_post\_meta($id, $key, $value); |
  | 352 | 352 | }; |
  | 353 | 353 |  |
  | 354 | 354 | return $updated; |
  | 355 | 355 | } |
  | 356 | 356 |  |
  | 357 | 357 | /\*\* |
  | 358 | 358 | \* Get options and sanitize them so we can update them |
  | 359 | 359 | \* |
  | 360 | 360 | \* @param [type] $request |
  | 361 | 361 | \* @return void |
  | 362 | 362 | \*/ |
  | 363 | 363 | private function \_get\_options\_to\_update($request) |
  | 364 | 364 | { |
  | 365 | 365 | $content\_type = $request->get\_content\_type(); |
  | 366 | 366 | if ($content\_type['value'] === 'application/x-www-form-urlencoded') { |
  | 367 | 367 | parse\_str($request->get\_body(), $params); |
  | 368 | 368 | } |
  | 369 | 369 |  |
  | 370 | 370 | if ($content\_type['value'] === 'application/json') { |
  | 371 | 371 | $params = $request->get\_json\_params(); |
  | 372 | 372 | } |
  | 373 | 373 |  |
  | 374 | 374 | $options = $this->\_sanitize\_values($params); |
  | 375 | 375 |  |
  | 376 | 376 | return $options; |
  | 377 | 377 | } |
  | 378 | 378 |  |
  | 379 | 379 | /\*\* |
  | 380 | 380 | \* Sanitize values |
  | 381 | 381 | \* |
  | 382 | 382 | \* @param [type] $options |
  | 383 | 383 | \* @return void |
  | 384 | 384 | \*/ |
  | 385 | 385 | private function \_sanitize\_values($options) |
  | 386 | 386 | { |
  | 387 | 387 | $sanitized = []; |
  | 388 | 388 |  |
  | 389 | 389 | foreach ($options as $k => $v) { |
  | 390 | 390 | if (is\_array($v) && isset($v['id']) && isset($v['img'])) { |
  | 391 | 391 | $sanitized[sanitize\_text\_field($k)] = absint($v['id']); |
  | 392 | 392 | continue; |
  | 393 | 393 | } |
  | 394 | 394 | $sanitized[sanitize\_text\_field($k)] = sanitize\_text\_field($v); |
  | 395 | 395 | } |
  | 396 | 396 |  |
  | 397 | 397 | return $sanitized; |
  | 398 | 398 | } |
  | 399 | 399 |  |
  | 400 | 400 | /\*\* |
  | 401 | 401 | \* Initial routine |
  | 402 | 402 | \* |
  | 403 | 403 | \* @param [type] $request |
  | 404 | 404 | \* @return void |
  | 405 | 405 | \*/ |
  | 406 | 406 | private function \_initial\_routine($request) |
  | 407 | 407 | { |
  | 408 | 408 | $this->\_get\_available\_meta((int) $request['id']); |
  | 409 | 409 |  |
  | 410 | 410 | $posts\_per\_page = isset($request['per\_page']) ? (int) $request['per\_page'] : 10; |
  | 411 | 411 | $args           = [ |
  | 412 | 412 | 'posts\_per\_page' => $posts\_per\_page, |
  | 413 | 413 | 'post\_type' => $this->slug . '\_submitted', |
  | 414 | 414 | 'status' => 'published', |
  | 415 | 415 | ]; |
  | 416 | 416 |  |
  | 417 | 417 | $args['meta\_query'] = $this->create\_meta\_query($request); |
  | 418 | 418 | $args['date\_query'] = $this->create\_date\_query($request); |
  | 419 | 419 |  |
  | 420 | 420 | $registered         = $this->get\_collection\_params(); |
  | 421 | 421 | $parameter\_mappings = [ |
  | 422 | 422 | 'page' => 'paged', |
  | 423 | 423 | 'search' => 's', |
  | 424 | 424 | ]; |
  | 425 | 425 |  |
  | 426 | 426 | foreach ($parameter\_mappings as $api\_param => $wp\_param) { |
  | 427 | 427 | if (isset($registered[$api\_param], $request[$api\_param])) { |
  | 428 | 428 | $args[$wp\_param] = $request[$api\_param]; |
  | 429 | 429 | } |
  | 430 | 430 | } |
  | 431 | 431 |  |
  | 432 | 432 | return $args; |
  | 433 | 433 | } |
  | 434 | 434 |  |
  | 435 | 435 | /\*\* |
  | 436 | 436 | \* Initial routine for aggregate request |
  | 437 | 437 | \* |
  | 438 | 438 | \* @param [type] $request |
  | 439 | 439 | \* @return void |
  | 440 | 440 | \*/ |
  | 441 | 441 | private function \_initial\_routine\_aggregate($request) |
  | 442 | 442 | { |
  | 443 | 443 | $this->\_get\_available\_meta\_aggregate($request); |
  | 444 | 444 |  |
  | 445 | 445 | $posts\_per\_page = isset($request['per\_page']) ? (int) $request['per\_page'] : 10; |
  | 446 | 446 | $args           = [ |
  | 447 | 447 | 'posts\_per\_page' => $posts\_per\_page, |
  | 448 | 448 | 'post\_type' => $this->slug . '\_submitted', |
  | 449 | 449 | 'status' => 'published', |
  | 450 | 450 | ]; |
  | 451 | 451 |  |
  | 452 | 452 | $args['meta\_query'] = $this->create\_meta\_query\_aggregate($request); |
  | 453 | 453 | $args['date\_query'] = $this->create\_date\_query($request); |
  | 454 | 454 |  |
  | 455 | 455 | $registered         = $this->get\_collection\_params(); |
  | 456 | 456 | $parameter\_mappings = [ |
  | 457 | 457 | 'page' => 'paged', |
  | 458 | 458 | 'search' => 's', |
  | 459 | 459 | ]; |
  | 460 | 460 |  |
  | 461 | 461 | foreach ($parameter\_mappings as $api\_param => $wp\_param) { |
  | 462 | 462 | if (isset($registered[$api\_param], $request[$api\_param])) { |
  | 463 | 463 | $args[$wp\_param] = $request[$api\_param]; |
  | 464 | 464 | } |
  | 465 | 465 | } |
  | 466 | 466 |  |
  | 467 | 467 | return $args; |
  | 468 | 468 | } |
  | 469 | 469 |  |
  | 470 | 470 | /\*\* |
  | 471 | 471 | \* Retrieve total posts |
  | 472 | 472 | \*/ |
  | 473 | 473 | private function \_get\_total\_posts($posts\_query, $query\_args) |
  | 474 | 474 | { |
  | 475 | 475 | $total\_posts = $posts\_query->found\_posts; |
  | 476 | 476 |  |
  | 477 | 477 | if ($total\_posts < 1) { |
  | 478 | 478 | unset($query\_args['paged']); |
  | 479 | 479 | $count\_query = new \WP\_Query(); |
  | 480 | 480 | $count\_query->query($query\_args); |
  | 481 | 481 | $total\_posts = $count\_query->found\_posts; |
  | 482 | 482 | } |
  | 483 | 483 |  |
  | 484 | 484 | return $total\_posts; |
  | 485 | 485 | } |
  | 486 | 486 |  |
  | 487 | 487 | /\*\* |
  | 488 | 488 | \* Prepare response |
  | 489 | 489 | \*/ |
  | 490 | 490 | private function \_prepare\_response($request, $posts, $total\_posts, $max\_pages, $page) |
  | 491 | 491 | { |
  | 492 | 492 | $request\_params = $request->get\_query\_params(); |
  | 493 | 493 |  |
  | 494 | 494 | $response = rest\_ensure\_response($posts); |
  | 495 | 495 | $response->header('X-WP-Total', $total\_posts); |
  | 496 | 496 | $response->header('X-WP-TotalPages', $max\_pages); |
  | 497 | 497 | $response->header('X-WP-CurrentPage', $page); |
  | 498 | 498 | $response->header('X-WP-PerPage', (int) $request\_params['per\_page']); |
  | 499 | 499 | $request\_params = $request->get\_query\_params(); |
  | 500 | 500 | $base           = add\_query\_arg(urlencode\_deep($request\_params), rest\_url(sprintf('%s/%s', $this->namespace, $this->rest\_base))); |
  | 501 | 501 |  |
  | 502 | 502 | if ($page > 1) { |
  | 503 | 503 | $prev\_page = $page - 1; |
  | 504 | 504 |  |
  | 505 | 505 | if ($prev\_page > $max\_pages) { |
  | 506 | 506 | $prev\_page = $max\_pages; |
  | 507 | 507 | } |
  | 508 | 508 |  |
  | 509 | 509 | $prev\_link = add\_query\_arg('page', $prev\_page, $base); |
  | 510 | 510 | $response->link\_header('prev', $prev\_link); |
  | 511 | 511 | } |
  | 512 | 512 | if ($max\_pages > $page) { |
  | 513 | 513 | $next\_page = $page + 1; |
  | 514 | 514 | $next\_link = add\_query\_arg('page', $next\_page, $base); |
  | 515 | 515 |  |
  | 516 | 516 | $response->link\_header('next', $next\_link); |
  | 517 | 517 | } |
  | 518 | 518 |  |
  | 519 | 519 | return $response; |
  | 520 | 520 | } |
  | 521 | 521 |  |
  | 522 | 522 | /\*\* |
  | 523 | 523 | \* Get items aggregate for display |
  | 524 | 524 | \* |
  | 525 | 525 | \* @param [type] $request |
  | 526 | 526 | \* @return void |
  | 527 | 527 | \*/ |
  | 528 | 528 | public function get\_items\_aggregate\_for\_display($request) |
  | 529 | 529 | { |
  | 530 | 530 | $params = $request->get\_params(); |
  | 531 | 531 | if (!isset($params['forms'])) { |
  | 532 | 532 | return new \WP\_Error('rest\_post\_invalid\_forms', esc\_html\_\_('You need to query data for certain forms. It can\'t be null.', 'kaliforms'), ['status' => 400]); |
  | 533 | 533 | } |
  | 534 | 534 |  |
  | 535 | 535 | $args         = $this->\_initial\_routine\_aggregate($request); |
  | 536 | 536 | $query\_args   = $this->prepare\_items\_query($args, $request); |
  | 537 | 537 | $posts\_query  = new \WP\_Query(); |
  | 538 | 538 | $query\_result = $posts\_query->query($query\_args); |
  | 539 | 539 | $posts        = []; |
  | 540 | 540 | foreach ($query\_result as $post) { |
  | 541 | 541 | $formId  = get\_post\_meta($post->ID, 'formId', true); |
  | 542 | 542 | $data    = $this->prepare\_item\_for\_aggregate\_display\_response($post, $request, $formId); |
  | 543 | 543 | $posts[] = $this->prepare\_response\_for\_collection($data); |
  | 544 | 544 | } |
  | 545 | 545 | $total\_posts = $this->\_get\_total\_posts($posts\_query, $query\_args); |
  | 546 | 546 |  |
  | 547 | 547 | $max\_pages = ceil($total\_posts / (int) $posts\_query->query\_vars['posts\_per\_page']); |
  | 548 | 548 | $page      = (int) $query\_args['paged']; |
  | 549 | 549 |  |
  | 550 | 550 | if ($page > $max\_pages && $total\_posts > 0) { |
  | 551 | 551 | return new WP\_Error('rest\_post\_invalid\_page\_number', esc\_html\_\_('The page number requested is larger than the number of pages available.', 'kaliforms'), ['status' => 400]); |
  | 552 | 552 | } |
  | 553 | 553 |  |
  | 554 | 554 | $response = $this->\_prepare\_response($request, $posts, (int) $total\_posts, (int) $max\_pages, $page); |
  | 555 | 555 |  |
  | 556 | 556 | return $response; |
  | 557 | 557 | } |
  | 558 | 558 |  |
  | 559 | 559 | /\*\* |
  | 560 | 560 | \* Aggregate all items |
  | 561 | 561 | \* |
  | 562 | 562 | \* @param [type] $request |
  | 563 | 563 | \* @return void |
  | 564 | 564 | \*/ |
  | 565 | 565 | public function get\_items\_aggregate($request) |
  | 566 | 566 | { |
  | 567 | 567 | $params = $request->get\_params(); |
  | 568 | 568 | if (!isset($params['forms'])) { |
  | 569 | 569 | return new \WP\_Error('rest\_post\_invalid\_forms', esc\_html\_\_('You need to query data for certain forms. It can\'t be null.', 'kaliforms'), ['status' => 400]); |
  | 570 | 570 | } |
  | 571 | 571 |  |
  | 572 | 572 | $args         = $this->\_initial\_routine\_aggregate($request); |
  | 573 | 573 | $query\_args   = $this->prepare\_items\_query($args, $request); |
  | 574 | 574 | $posts\_query  = new \WP\_Query(); |
  | 575 | 575 | $query\_result = $posts\_query->query($query\_args); |
  | 576 | 576 |  |
  | 577 | 577 | $posts = []; |
  | 578 | 578 | foreach ($query\_result as $post) { |
  | 579 | 579 | $formId  = get\_post\_meta($post->ID, 'formId', true); |
  | 580 | 580 | $data    = $this->prepare\_item\_for\_response($post, $request, $formId); |
  | 581 | 581 | $posts[] = $this->prepare\_response\_for\_collection($data); |
  | 582 | 582 | } |
  | 583 | 583 |  |
  | 584 | 584 | $total\_posts = $this->\_get\_total\_posts($posts\_query, $query\_args); |
  | 585 | 585 |  |
  | 586 | 586 | $max\_pages = ceil($total\_posts / (int) $posts\_query->query\_vars['posts\_per\_page']); |
  | 587 | 587 | $page      = (int) $query\_args['paged']; |
  | 588 | 588 |  |
  | 589 | 589 | if ($page > $max\_pages && $total\_posts > 0) { |
  | 590 | 590 | return new WP\_Error('rest\_post\_invalid\_page\_number', esc\_html\_\_('The page number requested is larger than the number of pages available.', 'kaliforms'), ['status' => 400]); |
  | 591 | 591 | } |
  | 592 | 592 |  |
  | 593 | 593 | $response = $this->\_prepare\_response($request, $posts, (int) $total\_posts, (int) $max\_pages, $page); |
  | 594 | 594 |  |
  | 595 | 595 | return $response; |
  | 596 | 596 | } |
  | 597 | 597 |  |
  | 598 | 598 | /\*\* |
  | 599 | 599 | \* Get one item |
  | 600 | 600 | \* |
  | 601 | 601 | \* @param [type] $request |
  | 602 | 602 | \* @return void |
  | 603 | 603 | \*/ |
  | 604 | 604 | public function get\_item($request) |
  | 605 | 605 | { |
  | 606 | 606 | $form\_id = get\_post\_meta((int) $request['id'], 'formId', true); |
  | 607 | 607 | $this->\_get\_available\_meta((int) $form\_id); |
  | 608 | 608 | $fakeObj     = new \stdClass(); |
  | 609 | 609 | $fakeObj->ID = $request['id']; |
  | 610 | 610 | $submission  = $this->prepare\_item\_for\_display\_response($fakeObj, ['id' => $form\_id]); |
  | 611 | 611 |  |
  | 612 | 612 | return rest\_ensure\_response($submission); |
  | 613 | 613 | } |
  | 614 | 614 |  |
  | 615 | 615 | /\*\* |
  | 616 | 616 | \* Grabs the items and returns them |
  | 617 | 617 | \* |
  | 618 | 618 | \* @param WP\_REST\_Request $request Current request. |
  | 619 | 619 | \*/ |
  | 620 | 620 | public function get\_items($request) |
  | 621 | 621 | { |
  | 622 | 622 | $args = $this->\_initial\_routine($request); |
  | 623 | 623 |  |
  | 624 | 624 | $query\_args   = $this->prepare\_items\_query($args, $request); |
  | 625 | 625 | $posts\_query  = new \WP\_Query(); |
  | 626 | 626 | $query\_result = $posts\_query->query($query\_args); |
  | 627 | 627 |  |
  | 628 | 628 | $posts = []; |
  | 629 | 629 | foreach ($query\_result as $post) { |
  | 630 | 630 | $data    = $this->prepare\_item\_for\_response($post, $request); |
  | 631 | 631 | $posts[] = $this->prepare\_response\_for\_collection($data); |
  | 632 | 632 | } |
  | 633 | 633 |  |
  | 634 | 634 | $total\_posts = $this->\_get\_total\_posts($posts\_query, $query\_args); |
  | 635 | 635 |  |
  | 636 | 636 | $max\_pages = ceil($total\_posts / (int) $posts\_query->query\_vars['posts\_per\_page']); |
  | 637 | 637 | $page      = (int) $query\_args['paged']; |
  | 638 | 638 |  |
  | 639 | 639 | if ($page > $max\_pages && $total\_posts > 0) { |
  | 640 | 640 | return new WP\_Error('rest\_post\_invalid\_page\_number', esc\_html\_\_('The page number requested is larger than the number of pages available.', 'kaliforms'), ['status' => 400]); |
  | 641 | 641 | } |
  | 642 | 642 |  |
  | 643 | 643 | $response = $this->\_prepare\_response($request, $posts, (int) $total\_posts, (int) $max\_pages, $page); |
  | 644 | 644 |  |
  | 645 | 645 | return $response; |
  | 646 | 646 | } |
  | 647 | 647 |  |
  | 648 | 648 | /\*\* |
  | 649 | 649 | \* Get items for display |
  | 650 | 650 | \* |
  | 651 | 651 | \* @param [type] $request |
  | 652 | 652 | \* @return void |
  | 653 | 653 | \*/ |
  | 654 | 654 | public function get\_items\_for\_display($request) |
  | 655 | 655 | { |
  | 656 | 656 | $args = $this->\_initial\_routine($request); |
  | 657 | 657 |  |
  | 658 | 658 | $query\_args   = $this->prepare\_items\_query($args, $request); |
  | 659 | 659 | $posts\_query  = new \WP\_Query(); |
  | 660 | 660 | $query\_result = $posts\_query->query($query\_args); |
  | 661 | 661 |  |
  | 662 | 662 | $posts = []; |
  | 663 | 663 | foreach ($query\_result as $post) { |
  | 664 | 664 | $data    = $this->prepare\_item\_for\_display\_response($post, $request); |
  | 665 | 665 | $posts[] = $this->prepare\_response\_for\_collection($data); |
  | 666 | 666 | } |
  | 667 | 667 | $total\_posts = $this->\_get\_total\_posts($posts\_query, $query\_args); |
  | 668 | 668 |  |
  | 669 | 669 | $max\_pages = ceil($total\_posts / (int) $posts\_query->query\_vars['posts\_per\_page']); |
  | 670 | 670 | $page      = (int) $query\_args['paged']; |
  | 671 | 671 |  |
  | 672 | 672 | if ($page > $max\_pages && $total\_posts > 0) { |
  | 673 | 673 | return new WP\_Error('rest\_post\_invalid\_page\_number', esc\_html\_\_('The page number requested is larger than the number of pages available.', 'kaliforms'), ['status' => 400]); |
  | 674 | 674 | } |
  | 675 | 675 |  |
  | 676 | 676 | $response = $this->\_prepare\_response($request, $posts, (int) $total\_posts, (int) $max\_pages, $page); |
  | 677 | 677 |  |
  | 678 | 678 | return $response; |
  | 679 | 679 | } |
  | 680 | 680 |  |
  | 681 | 681 | /\*\* |
  | 682 | 682 | \* Matches the post data to the schema we want. |
  | 683 | 683 | \* |
  | 684 | 684 | \* @param WP\_Post $post The comment object whose response is being prepared. |
  | 685 | 685 | \*/ |
  | 686 | 686 | public function prepare\_item\_for\_response($post, $request, $formId = null) |
  | 687 | 687 | { |
  | 688 | 688 | $post\_data = []; |
  | 689 | 689 | $schema    = $this->get\_item\_schema(); |
  | 690 | 690 |  |
  | 691 | 691 | // We are also renaming the fields to more understandable names. |
  | 692 | 692 | if (isset($schema['properties']['id'])) { |
  | 693 | 693 | $post\_data['id'] = (int) $post->ID; |
  | 694 | 694 | } |
  | 695 | 695 |  |
  | 696 | 696 | $meta\_fields = $formId !== null ? $this->meta\_fields[(int) $formId] : $this->meta\_fields; |
  | 697 | 697 | foreach ($meta\_fields as $field) { |
  | 698 | 698 | $post\_data[sanitize\_text\_field($field)] = get\_post\_meta($post->ID, $field, true); |
  | 699 | 699 | } |
  | 700 | 700 |  |
  | 701 | 701 | return rest\_ensure\_response($post\_data); |
  | 702 | 702 | } |
  | 703 | 703 |  |
  | 704 | 704 | /\*\* |
  | 705 | 705 | \* Return display ready aggregated data |
  | 706 | 706 | \* |
  | 707 | 707 | \* @param [type] $post |
  | 708 | 708 | \* @param [type] $request |
  | 709 | 709 | \* @return void |
  | 710 | 710 | \*/ |
  | 711 | 711 | public function prepare\_item\_for\_aggregate\_display\_response($post, $request) |
  | 712 | 712 | { |
  | 713 | 713 | $post\_data           = []; |
  | 714 | 714 | $post\_data['id']     = (int) $post->ID; |
  | 715 | 715 | $post\_data['formId'] = (int) get\_post\_meta((int) $post->ID, 'formId', true); |
  | 716 | 716 | $post\_data['fields'] = []; |
  | 717 | 717 |  |
  | 718 | 718 | foreach ($this->meta\_fields[$post\_data['formId']] as $field) { |
  | 719 | 719 | $post\_data['fields'][] = [ |
  | 720 | 720 | 'id' => $field, |
  | 721 | 721 | 'caption' => $this->display\_fields[$post\_data['formId']][$field]['caption'], |
  | 722 | 722 | 'type' => $this->display\_fields[$post\_data['formId']][$field]['type'], |
  | 723 | 723 | 'props' => $this->display\_fields[$field]['properties'], |
  | 724 | 724 | 'value' => $this->\_get\_post\_meta\_value($this->display\_fields[$post\_data['formId']][$field]['type'], get\_post\_meta($post->ID, $field, true), $field), |
  | 725 | 725 | ]; |
  | 726 | 726 | } |
  | 727 | 727 |  |
  | 728 | 728 | return rest\_ensure\_response($post\_data); |
  | 729 | 729 | } |
  | 730 | 730 |  |
  | 731 | 731 | /\*\* |
  | 732 | 732 | \* Matches the post data to the schema we want. |
  | 733 | 733 | \* |
  | 734 | 734 | \* @param WP\_Post $post The comment object whose response is being prepared. |
  | 735 | 735 | \*/ |
  | 736 | 736 | public function prepare\_item\_for\_display\_response($post, $request) |
  | 737 | 737 | { |
  | 738 | 738 | $post\_data              = []; |
  | 739 | 739 | $post\_data['id']        = (int) $post->ID; |
  | 740 | 740 | $post\_data['formId']    = (int) $request['id']; |
  | 741 | 741 | $post\_data['separator'] = $this->separator; |
  | 742 | 742 | $post\_data['fields']    = []; |
  | 743 | 743 | foreach ($this->meta\_fields as $field) { |
  | 744 | 744 | $post\_data['fields'][] = [ |
  | 745 | 745 | 'id' => $field, |
  | 746 | 746 | 'caption' => $this->display\_fields[$field]['caption'], |
  | 747 | 747 | 'type' => $this->display\_fields[$field]['type'], |
  | 748 | 748 | 'props' => $this->display\_fields[$field]['properties'], |
  | 749 | 749 | 'value' => $this->\_get\_post\_meta\_value($this->display\_fields[$field]['type'], get\_post\_meta($post->ID, $field, true), $field), |
  | 750 | 750 | ]; |
  | 751 | 751 | } |
  | 752 | 752 |  |
  | 753 | 753 | $post\_data['fields'][] = [ |
  | 754 | 754 | 'id' => 'ip\_address', |
  | 755 | 755 | 'caption' => \_\_('Ip address', 'kaliforms'), |
  | 756 | 756 | 'type' => 'text', |
  | 757 | 757 | 'value' => get\_post\_meta($post->ID, 'ip\_address', true), |
  | 758 | 758 | ]; |
  | 759 | 759 | $post\_data['fields'][] = [ |
  | 760 | 760 | 'id' => 'date\_published', |
  | 761 | 761 | 'caption' => \_\_('Publish date', 'kaliforms'), |
  | 762 | 762 | 'type' => 'date', |
  | 763 | 763 | 'value' => get\_the\_date('Y/m/d g:ia', $post->ID), |
  | 764 | 764 | ]; |
  | 765 | 765 |  |
  | 766 | 766 | return rest\_ensure\_response($post\_data); |
  | 767 | 767 | } |
  | 768 | 768 |  |
  | 769 | 769 | /\*\* |
  | 770 | 770 | \* Get our sample schema for a post. |
  | 771 | 771 | \* |
  | 772 | 772 | \* @return array The sample schema for a post |
  | 773 | 773 | \*/ |
  | 774 | 774 | public function get\_item\_schema() |
  | 775 | 775 | { |
  | 776 | 776 | if ($this->schema) { |
  | 777 | 777 | // Since WordPress 5.3, the schema can be cached in the $schema property. |
  | 778 | 778 | return $this->schema; |
  | 779 | 779 | } |
  | 780 | 780 |  |
  | 781 | 781 | $this->schema = [ |
  | 782 | 782 | '$schema' => 'http://json-schema.org/draft-04/schema#', |
  | 783 | 783 | 'title' => 'form\_entries', |
  | 784 | 784 | 'type' => 'object', |
  | 785 | 785 | 'properties' => [ |
  | 786 | 786 | 'id' => [ |
  | 787 | 787 | 'description' => esc\_html\_\_('Unique identifier for the object.', 'kaliforms'), |
  | 788 | 788 | 'type' => 'integer', |
  | 789 | 789 | 'context' => ['view', 'edit', 'embed'], |
  | 790 | 790 | 'readonly' => true, |
  | 791 | 791 | ], |
  | 792 | 792 | ], |
  | 793 | 793 | ]; |
  | 794 | 794 |  |
  | 795 | 795 | return $this->schema; |
  | 796 | 796 | } |
  | 797 | 797 |  |
  | 798 | 798 | /\*\* |
  | 799 | 799 | \* Returns a sane value |
  | 800 | 800 | \* |
  | 801 | 801 | \* @param [type] $type |
  | 802 | 802 | \* @param [type] $value |
  | 803 | 803 | \* @return void |
  | 804 | 804 | \*/ |
  | 805 | 805 | private function \_get\_post\_meta\_value($type, $value, $field) |
  | 806 | 806 | { |
  | 807 | 807 | switch ($type) { |
  | 808 | 808 | case 'product': |
  | 809 | 809 | $obj = [ |
  | 810 | 810 | 'label' => $this->display\_fields[$field]['properties']['caption'], |
  | 811 | 811 | 'price' => floatval($this->display\_fields[$field]['properties']['price']), |
  | 812 | 812 | ]; |
  | 813 | 813 |  |
  | 814 | 814 | return $obj; |
  | 815 | 815 | case 'multipleProducts': |
  | 816 | 816 | $obj = [ |
  | 817 | 817 | 'label' => '', |
  | 818 | 818 | 'price' => '', |
  | 819 | 819 | 'url' => '', |
  | 820 | 820 | ]; |
  | 821 | 821 |  |
  | 822 | 822 | foreach ($this->display\_fields[$field]['properties']['products'] as $product) { |
  | 823 | 823 | $product = (array) $product; |
  | 824 | 824 | if ($product['label'] === $value) { |
  | 825 | 825 | $obj = [ |
  | 826 | 826 | 'label' => $product['label'], |
  | 827 | 827 | 'price' => floatval($product['price']), |
  | 828 | 828 | ]; |
  | 829 | 829 |  |
  | 830 | 830 | if (!empty($product['image']->fullUrl)) { |
  | 831 | 831 | $obj['url'] = $product['image']->fullUrl; |
  | 832 | 832 | } |
  | 833 | 833 | } |
  | 834 | 834 | } |
  | 835 | 835 |  |
  | 836 | 836 | return $obj; |
  | 837 | 837 | break; |
  | 838 | 838 | case 'imageRadio': |
  | 839 | 839 | $obj = [ |
  | 840 | 840 | 'id' => $value, |
  | 841 | 841 | 'img' => esc\_url(wp\_get\_attachment\_url($value)), |
  | 842 | 842 | ]; |
  | 843 | 843 |  |
  | 844 | 844 | return $obj; |
  | 845 | 845 | case 'fileUpload': |
  | 846 | 846 | $title      = []; |
  | 847 | 847 | $urls       = []; |
  | 848 | 848 | $imagePaths = []; |
  | 849 | 849 |  |
  | 850 | 850 | $ids      = explode(',', $value); |
  | 851 | 851 | $combined = []; |
  | 852 | 852 | foreach ($ids as $uId) { |
  | 853 | 853 | $img = wp\_get\_attachment\_url($uId); |
  | 854 | 854 |  |
  | 855 | 855 | $upload = [ |
  | 856 | 856 | 'id' => $uId, |
  | 857 | 857 | 'title' => get\_the\_title($uId), |
  | 858 | 858 | 'url' => esc\_url(wp\_get\_attachment\_url($uId)), |
  | 859 | 859 | 'path' => wp\_get\_original\_image\_path($uId), |
  | 860 | 860 | ]; |
  | 861 | 861 |  |
  | 862 | 862 | $combined[] = $upload; |
  | 863 | 863 |  |
  | 864 | 864 | $title[]      = $upload['title']; |
  | 865 | 865 | $urls[]       = $upload['url']; |
  | 866 | 866 | $imagePaths[] = $upload['path']; |
  | 867 | 867 | } |
  | 868 | 868 |  |
  | 869 | 869 | return [ |
  | 870 | 870 | 'titles' => $title, |
  | 871 | 871 | 'imagePaths' => $imagePaths, |
  | 872 | 872 | 'urls' => $urls, |
  | 873 | 873 | 'combined' => $combined, |
  | 874 | 874 | ]; |
  | 875 | 875 | default: |
  | 876 | 876 | return $value; |
  | 877 | 877 | } |
  | 878 | 878 | } |
  | 879 | 879 |  |
  | 880 | 880 | /\*\* |
  | 881 | 881 | \* Determines the allowed query\_vars for a get\_items() response and prepares |
  | 882 | 882 | \* them for WP\_Query. |
  | 883 | 883 | \* |
  | 884 | 884 | \* @param array $prepared\_args Optional. Prepared WP\_Query arguments. Default empty array. |
  | 885 | 885 | \* @param WP\_REST\_Request $request Optional. Full details about the request. |
  | 886 | 886 | \* @return array Items query arguments. |
  | 887 | 887 | \* @since 4.7.0 |
  | 888 | 888 | \* |
  | 889 | 889 | \*/ |
  | 890 | 890 | protected function prepare\_items\_query($prepared\_args = [], $request = null) |
  | 891 | 891 | { |
  | 892 | 892 | $query\_args = []; |
  | 893 | 893 |  |
  | 894 | 894 | foreach ($prepared\_args as $key => $value) { |
  | 895 | 895 | $query\_args[$key] = apply\_filters("rest\_query\_var-{$key}", $value); |
  | 896 | 896 | } |
  | 897 | 897 | $query\_args['ignore\_sticky\_posts'] = true; |
  | 898 | 898 |  |
  | 899 | 899 | if (isset($query\_args['orderby']) && isset($request['orderby'])) { |
  | 900 | 900 | $orderby\_mappings = [ |
  | 901 | 901 | 'id' => 'ID', |
  | 902 | 902 | 'include' => 'post\_\_in', |
  | 903 | 903 | 'slug' => 'post\_name', |
  | 904 | 904 | 'include\_slugs' => 'post\_name\_\_in', |
  | 905 | 905 | ]; |
  | 906 | 906 |  |
  | 907 | 907 | if (isset($orderby\_mappings[$request['orderby']])) { |
  | 908 | 908 | $query\_args['orderby'] = $orderby\_mappings[$request['orderby']]; |
  | 909 | 909 | } |
  | 910 | 910 | } |
  | 911 | 911 |  |
  | 912 | 912 | return $query\_args; |
  | 913 | 913 | } |
  | 914 | 914 |  |
  | 915 | 915 | /\*\* |
  | 916 | 916 | \* Create a meta query |
  | 917 | 917 | \* |
  | 918 | 918 | \* @param [type] $request |
  | 919 | 919 | \* @return void |
  | 920 | 920 | \*/ |
  | 921 | 921 | protected function create\_meta\_query($request) |
  | 922 | 922 | { |
  | 923 | 923 | $args = [ |
  | 924 | 924 | [ |
  | 925 | 925 | 'key' => 'formId', |
  | 926 | 926 | 'value' => (int) $request['id'], |
  | 927 | 927 | 'compare' => '=', |
  | 928 | 928 | ], |
  | 929 | 929 | 'key\_clause' => [ |
  | 930 | 930 | 'relation' => 'AND', |
  | 931 | 931 | ], |
  | 932 | 932 | ]; |
  | 933 | 933 |  |
  | 934 | 934 | $params = $request->get\_params(); |
  | 935 | 935 | foreach ($params as $k => $v) { |
  | 936 | 936 | if (!in\_array($k, $this->meta\_fields)) { |
  | 937 | 937 | continue; |
  | 938 | 938 | } |
  | 939 | 939 |  |
  | 940 | 940 | $args['key\_clause'][] = [ |
  | 941 | 941 | 'key' => $k, |
  | 942 | 942 | 'value' => $v, |
  | 943 | 943 | 'compare' => '=', |
  | 944 | 944 | ]; |
  | 945 | 945 | } |
  | 946 | 946 |  |
  | 947 | 947 | return $args; |
  | 948 | 948 | } |
  | 949 | 949 |  |
  | 950 | 950 | /\*\* |
  | 951 | 951 | \* Returns the date query |
  | 952 | 952 | \* |
  | 953 | 953 | \* @param [type] $request |
  | 954 | 954 | \* @return void |
  | 955 | 955 | \*/ |
  | 956 | 956 | protected function create\_date\_query($request) |
  | 957 | 957 | { |
  | 958 | 958 | $params = $request->get\_params(); |
  | 959 | 959 | if (!isset($params['date\_published'])) { |
  | 960 | 960 | return []; |
  | 961 | 961 | } |
  | 962 | 962 |  |
  | 963 | 963 | $exploded = explode(',', $params['date\_published']); |
  | 964 | 964 |  |
  | 965 | 965 | return [ |
  | 966 | 966 | 'after' => $exploded[0], |
  | 967 | 967 | 'before' => $exploded['1'], |
  | 968 | 968 | ]; |
  | 969 | 969 | } |
  | 970 | 970 |  |
  | 971 | 971 | /\*\* |
  | 972 | 972 | \* Creates the meta query aggregated |
  | 973 | 973 | \* |
  | 974 | 974 | \* @param [type] $request |
  | 975 | 975 | \* @return void |
  | 976 | 976 | \*/ |
  | 977 | 977 | protected function create\_meta\_query\_aggregate($request) |
  | 978 | 978 | { |
  | 979 | 979 | $params          = $request->get\_params(); |
  | 980 | 980 | $args            = [ |
  | 981 | 981 | [ |
  | 982 | 982 | 'key' => 'formId', |
  | 983 | 983 | 'value' => explode(',', $params['forms']), |
  | 984 | 984 | 'compare' => 'IN', |
  | 985 | 985 | ], |
  | 986 | 986 | ]; |
  | 987 | 987 | $aggregated\_meta = array\_unique(array\_merge(...$this->meta\_fields)); |
  | 988 | 988 | foreach ($params as $k => $v) { |
  | 989 | 989 | if (!in\_array($k, $aggregated\_meta)) { |
  | 990 | 990 | continue; |
  | 991 | 991 | } |
  | 992 | 992 |  |
  | 993 | 993 | $args['key\_clause'][] = [ |
  | 994 | 994 | 'key' => $k, |
  | 995 | 995 | 'value' => $v, |
  | 996 | 996 | 'compare' => '=', |
  | 997 | 997 | ]; |
  | 998 | 998 | } |
  | 999 | 999 |  |
  | 1000 | 1000 | return $args; |
  | 1001 | 1001 | } |
  | 1002 | 1002 |  |
  | 1003 | 1003 | /\*\* |
  | 1004 | 1004 | \* Get available meta |
  | 1005 | 1005 | \* |
  | 1006 | 1006 | \* @param [type] $id |
  | 1007 | 1007 | \* @return void |
  | 1008 | 1008 | \*/ |
  | 1009 | 1009 | private function \_get\_available\_meta($id) |
  | 1010 | 1010 | { |
  | 1011 | 1011 | $fields  = []; |
  | 1012 | 1012 | $display = []; |
  | 1013 | 1013 | $builder = new Post\_Translator($id); |
  | 1014 | 1014 | $builder->construct\_these('formFields', 'formOptions'); |
  | 1015 | 1015 |  |
  | 1016 | 1016 | foreach ($builder->formFields as $field) { |
  | 1017 | 1017 | if (!isset($field->properties->name)) { |
  | 1018 | 1018 | continue; |
  | 1019 | 1019 | } |
  | 1020 | 1020 |  |
  | 1021 | 1021 | $fields[]                          = $field->properties->name; |
  | 1022 | 1022 | $display[$field->properties->name] = [ |
  | 1023 | 1023 | 'type' => $field->id, |
  | 1024 | 1024 | 'caption' => $this->\_get\_caption($field), |
  | 1025 | 1025 | 'properties' => (array) $field->properties, |
  | 1026 | 1026 | ]; |
  | 1027 | 1027 | } |
  | 1028 | 1028 |  |
  | 1029 | 1029 | $this->meta\_fields    = $fields; |
  | 1030 | 1030 | $this->display\_fields = $display; |
  | 1031 | 1031 | $this->ip\_address     = $builder->formOptions['saveIpAddress'] === '1'; |
  | 1032 | 1032 | $this->separator      = $builder->formOptions['multipleSelectionsSeparator']; |
  | 1033 | 1033 | } |
  | 1034 | 1034 |  |
  | 1035 | 1035 | /\*\* |
  | 1036 | 1036 | \* Returns all fields for all forms |
  | 1037 | 1037 | \* |
  | 1038 | 1038 | \* @param [type] $request |
  | 1039 | 1039 | \* @return void |
  | 1040 | 1040 | \*/ |
  | 1041 | 1041 | private function \_get\_available\_meta\_aggregate($request) |
  | 1042 | 1042 | { |
  | 1043 | 1043 | $fields  = []; |
  | 1044 | 1044 | $display = []; |
  | 1045 | 1045 |  |
  | 1046 | 1046 | $params = $request->get\_params(); |
  | 1047 | 1047 | $forms  = explode(',', $params['forms']); |
  | 1048 | 1048 | foreach ($forms as $id) { |
  | 1049 | 1049 | $builder = new Post\_Translator((int) $id); |
  | 1050 | 1050 | $builder->construct\_these('formFields'); |
  | 1051 | 1051 |  |
  | 1052 | 1052 | foreach ($builder->formFields as $field) { |
  | 1053 | 1053 | if (!isset($field->properties->name)) { |
  | 1054 | 1054 | continue; |
  | 1055 | 1055 | } |
  | 1056 | 1056 |  |
  | 1057 | 1057 | $fields[$id][]                          = $field->properties->name; |
  | 1058 | 1058 | $display[$id][$field->properties->name] = [ |
  | 1059 | 1059 | 'type' => $field->id, |
  | 1060 | 1060 | 'caption' => $this->\_get\_caption($field), |
  | 1061 | 1061 | ]; |
  | 1062 | 1062 | } |
  | 1063 | 1063 | } |
  | 1064 | 1064 |  |
  | 1065 | 1065 | $this->meta\_fields    = $fields; |
  | 1066 | 1066 | $this->display\_fields = $display; |
  | 1067 | 1067 | } |
  | 1068 | 1068 |  |
  | 1069 | 1069 | /\*\* |
  | 1070 | 1070 | \* Return a caption |
  | 1071 | 1071 | \* |
  | 1072 | 1072 | \* @param [type] $props |
  | 1073 | 1073 | \* @return void |
  | 1074 | 1074 | \*/ |
  | 1075 | 1075 | private function \_get\_caption($field) |
  | 1076 | 1076 | { |
  | 1077 | 1077 | $string = isset($field->properties->name) ? $field->properties->name : $field->internalId; |
  | 1078 | 1078 | if (isset($field->properties->caption) && !empty($field->properties->caption)) { |
  | 1079 | 1079 | $string = $field->properties->caption; |
  | 1080 | 1080 | } |
  | 1081 | 1081 |  |
  | 1082 | 1082 | return $string; |
  | 1083 | 1083 | } |
  | 1084 | 1084 |  |
  | 1085 | 1085 | /\*\* |
  | 1086 | 1086 | \* Return authorization status code |
  | 1087 | 1087 | \* |
  | 1088 | 1088 | \* @return void |
  | 1089 | 1089 | \*/ |
  | 1090 | 1090 | public function authorization\_status\_code() |
  | 1091 | 1091 | { |
  | 1092 | 1092 | $status = 401; |
  | 1093 | 1093 | if (is\_user\_logged\_in()) { |
  | 1094 | 1094 | $status = 403; |
  | 1095 | 1095 | } |
  | 1096 | 1096 |  |
  | 1097 | 1097 | return $status; |
  | 1098 | 1098 | } |
  | 1099 | 1099 | } |
* ## [kali-forms/trunk/Inc/class-kaliforms.php](/changeset/3036466/kali-forms/trunk/Inc/class-kaliforms.php?old=2804449&old_path=kali-forms%2Ftrunk%2FInc%2Fclass-kaliforms.php "Show the [3029334:3036466] differences restricted to kali-forms/trunk/Inc/class-kaliforms.php")

  | [r3029334](/browser/kali-forms/trunk/Inc/class-kaliforms.php?rev=2804449#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/Inc/class-kaliforms.php?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | namespace KaliForms\Inc; |
  | 4 | 4 |  |
  | 5 | 5 | if (!defined('ABSPATH')) { |
  | 6 | 6 | exit; |
  | 7 | 7 | } |
  | 8 | 8 |  |
  | 9 | 9 | use KaliForms\Inc\Backend\Dashboard\_Widget; |
  | 10 | 10 | use KaliForms\Inc\Backend\Elementor\_KaliForms\_Widget; |
  | 11 | 11 | use KaliForms\Inc\Backend\Hooks; |
  | 12 | 12 | use KaliForms\Inc\Backend\Meta\_Save; |
  | 13 | 13 | use KaliForms\Inc\Backend\Notifications; |
  | 14 | 14 | use KaliForms\Inc\Backend\Plugin\_Collision; |
  | 15 | 15 | use KaliForms\Inc\Backend\Plugin\_Deactivation; |
  | 16 | 16 | use KaliForms\Inc\Backend\Plugin\_Health\_Checks; |
  | 17 | 17 | use KaliForms\Inc\Backend\Plugin\_Review; |
  | 18 | 18 | use KaliForms\Inc\Backend\Entries\_Deleter; |
  | 19 | 19 | use KaliForms\Inc\Backend\Posts\Forms; |
  | 20 | 20 | use KaliForms\Inc\Backend\Posts\Submitted; |
  | 21 | 21 | use KaliForms\Inc\Backend\Predefined\_Forms; |
  | 22 | 22 | use KaliForms\Inc\Backend\Rest\Forms\_Rest\_Controller; |
  | 23 | 23 | use KaliForms\Inc\Backend\Rest\Form\_Entries\_Rest\_Controller; |
  | 24 | 24 | use KaliForms\Inc\Frontend\Form\_Processor; |
  | 25 | 25 | // use KaliForms\Inc\Frontend\Rest\Forms\_Processor\_Rest\_Controller; |
  | 26 | 26 | use KaliForms\Inc\Handle\_Payments; |
  | 27 | 27 | use KaliForms\Inc\Payments\_Simple; |
  | 28 | 28 | use KaliForms\Inc\Utils\First\_Install; |
  | 29 | 29 | use KaliForms\Inc\Utils\Installation; |
  | 30 | 30 | use KaliForms\Inc\Utils\TransientHelper; |
  | 31 | 31 |  |
  | 32 | 32 | /\*\* |
  | 33 | 33 | \* Class KaliForms |
  | 34 | 34 | \* |
  | 35 | 35 | \* @package App |
  | 36 | 36 | \*/ |
  | 37 | 37 | class KaliForms |
  | 38 | 38 | { |
  | 39 | 39 | use TransientHelper; |
  | 40 | 40 | /\*\* |
  | 41 | 41 | \* Plugin slug |
  | 42 | 42 | \* |
  | 43 | 43 | \* @var string |
  | 44 | 44 | \*/ |
  | 45 | 45 | protected $slug = 'kaliforms'; |
  | 46 | 46 |  |
  | 47 | 47 | /\*\* |
  | 48 | 48 | \* Plugins hooked in KaliForms |
  | 49 | 49 | \* |
  | 50 | 50 | \* @var array |
  | 51 | 51 | \*/ |
  | 52 | 52 | public $plugins = []; |
  | 53 | 53 |  |
  | 54 | 54 | /\*\* |
  | 55 | 55 | \* KaliForms constructor. |
  | 56 | 56 | \*/ |
  | 57 | 57 | public function \_\_construct() |
  | 58 | 58 | { |
  | 59 | 59 | // Activation hook - mostly used for first installers |
  | 60 | 60 | register\_activation\_hook(KALIFORMS\_PLUGIN\_FILE, [$this, 'install']); |
  | 61 | 61 | // Welcome screen init |
  | 62 | 62 | // new Welcome\_Screen(); |
  | 63 | 63 | // Init Kali Forms plugin during the plugins\_loaded hook. It provides an order for the "additional" components |
  | 64 | 64 | add\_action('plugins\_loaded', [$this, 'init\_kaliforms']); |
  | 65 | 65 | add\_action('admin\_head', [$this, 'upgrade\_pro']); |
  | 66 | 66 | } |
  | 67 | 67 |  |
  | 68 | 68 | /\*\* |
  | 69 | 69 | \* Initiate kaliforms |
  | 70 | 70 | \*/ |
  | 71 | 71 | public function init\_kaliforms() |
  | 72 | 72 | { |
  | 73 | 73 | /\*\* |
  | 74 | 74 | \* Hook before the plugin is constructed |
  | 75 | 75 | \*/ |
  | 76 | 76 | do\_action($this->slug . '\_before\_construction', $this); |
  | 77 | 77 | /\*\* |
  | 78 | 78 | \* Hook external plugins in KaliForms |
  | 79 | 79 | \*/ |
  | 80 | 80 | $this->plugins = apply\_filters($this->slug . '\_hook\_external\_plugins', $this->plugins); |
  | 81 | 81 | /\*\* |
  | 82 | 82 | \* Create an instance of the meta save |
  | 83 | 83 | \*/ |
  | 84 | 84 | Meta\_Save::get\_instance(); |
  | 85 | 85 | /\*\* |
  | 86 | 86 | \* Register the new custom post types |
  | 87 | 87 | \*/ |
  | 88 | 88 | new Forms(); |
  | 89 | 89 | new Submitted(); |
  | 90 | 90 | /\*\* |
  | 91 | 91 | \* Initiate actions & filters |
  | 92 | 92 | \*/ |
  | 93 | 93 | new Hooks(); |
  | 94 | 94 | /\*\* |
  | 95 | 95 | \* Form processor |
  | 96 | 96 | \*/ |
  | 97 | 97 | new Form\_Processor(); |
  | 98 | 98 | /\*\* |
  | 99 | 99 | \* Payment actions |
  | 100 | 100 | \*/ |
  | 101 | 101 | defined('KALIFORMS\_PAYMENTS\_VERSION') ? new Handle\_Payments() : new Payments\_Simple(); |
  | 102 | 102 | /\*\* |
  | 103 | 103 | \* Load the predefined forms |
  | 104 | 104 | \*/ |
  | 105 | 105 | new Predefined\_Forms(); |
  | 106 | 106 | /\*\* |
  | 107 | 107 | \* Create notifications |
  | 108 | 108 | \*/ |
  | 109 | 109 | $notifications = Notifications::get\_instance(); |
  | 110 | 110 | /\*\* |
  | 111 | 111 | \* Initiate the plugin collision class |
  | 112 | 112 | \*/ |
  | 113 | 113 | $this->check\_plugin\_collision(); |
  | 114 | 114 | /\*\* |
  | 115 | 115 | \* Start the plugin health checks ( for page /wp-admin/site-health.php ) |
  | 116 | 116 | \*/ |
  | 117 | 117 | new Plugin\_Health\_Checks(); |
  | 118 | 118 | /\*\* |
  | 119 | 119 | \* Plugin review |
  | 120 | 120 | \*/ |
  | 121 | 121 | new Plugin\_Review(); |
  | 122 | 122 | /\*\* |
  | 123 | 123 | \* Plugin deactivation |
  | 124 | 124 | \*/ |
  | 125 | 125 | new Plugin\_Deactivation(); |
  | 126 | 126 | /\*\* |
  | 127 | 127 | \* Dashboard widgets; |
  | 128 | 128 | \*/ |
  | 129 | 129 | new Dashboard\_Widget(); |
  | 130 | 130 | /\*\* |
  | 131 | 131 | \* Check if we have form entries to delete after certain amount of time |
  | 132 | 132 | \*/ |
  | 133 | 133 | new Entries\_Deleter(); |
  | 134 | 134 | $this->load\_elementor\_widget(); |
  | 135 | 135 | /\*\* |
  | 136 | 136 | \* Hook after the plugin constructor is ready |
  | 137 | 137 | \* (Some parts of the plugin e.g. Hooks() may happen later) |
  | 138 | 138 | \*/ |
  | 139 | 139 | do\_action($this->slug . '\_after\_construction', $this); |
  | 140 | 140 | /\*\* |
  | 141 | 141 | \* Delete transient files from the file upload |
  | 142 | 142 | \*/ |
  | 143 | 143 | add\_action($this->slug . '\_delete\_transient\_file', [$this, 'delete\_transient\_file']); |
  | 144 | 144 | add\_action('rest\_api\_init', [$this, 'start\_controller']); |
  | 145 | 145 | } |
  | 146 | 146 |  |
  | 147 | 147 | /\*\* |
  | 148 | 148 | \* Returns an instance of the plugin |
  | 149 | 149 | \* |
  | 150 | 150 | \* @return KaliForms |
  | 151 | 151 | \*/ |
  | 152 | 152 | public static function get\_instance() |
  | 153 | 153 | { |
  | 154 | 154 | static $inst; |
  | 155 | 155 | if (!$inst) { |
  | 156 | 156 | $inst = new KaliForms(); |
  | 157 | 157 | } |
  | 158 | 158 |  |
  | 159 | 159 | return $inst; |
  | 160 | 160 | } |
  | 161 | 161 |  |
  | 162 | 162 | /\*\* |
  | 163 | 163 | \* Installation hook |
  | 164 | 164 | \*/ |
  | 165 | 165 | public function install() |
  | 166 | 166 | { |
  | 167 | 167 | // This was the welcome screen - we dont really need it |
  | 168 | 168 | new First\_Install(); |
  | 169 | 169 | new Installation(); |
  | 170 | 170 | } |
  | 171 | 171 | /\*\* |
  | 172 | 172 | \* Start controller |
  | 173 | 173 | \*/ |
  | 174 | 174 | public function start\_controller() |
  | 175 | 175 | { |
  | 176 | 176 | (new Forms\_Rest\_Controller())->register\_routes(); |
  | 177 | 177 | (new Form\_Entries\_Rest\_Controller())->register\_routes(); |
  | 178 | 178 | // (new Forms\_Processor\_Rest\_Controller())->register\_routes(); |
  | 179 | 179 | } |
  | 180 | 180 | /\*\* |
  | 181 | 181 | \* Checks plugin collision |
  | 182 | 182 | \* |
  | 183 | 183 | \* @return void |
  | 184 | 184 | \*/ |
  | 185 | 185 | public function check\_plugin\_collision() |
  | 186 | 186 | { |
  | 187 | 187 | $collision = new Plugin\_Collision(); |
  | 188 |  | if (count($collision->activated\_plugins) > 0) { |
  | 189 |  | $collision->set\_notice(); |
  |  | 188 | if (current\_user\_can('manage\_options')) { |
  |  | 189 | if (count($collision->activated\_plugins) > 0) { |
  |  | 190 | $collision->set\_notice(); |
  |  | 191 | } |
  | 190 | 192 | } |
  | 191 | 193 | } |
  | 192 | 194 | /\*\* |
  | 193 | 195 | \* Check submission plugin |
  | 194 | 196 | \* |
  | 195 | 197 | \* @return void |
  | 196 | 198 | \*/ |
  | 197 | 199 | private function \_check\_submission\_plugin() |
  | 198 | 200 | { |
  | 199 | 201 | if ( |
  | 200 | 202 | defined('KALIFORMS\_SUBMISSIONS\_PLUGIN\_FILE') |
  | 201 | 203 | && defined('KALIFORMS\_SUBMISSIONS\_VERSION') |
  | 202 | 204 | && version\_compare(KALIFORMS\_SUBMISSIONS\_VERSION, '1.4.0', '<') |
  | 203 | 205 | ) { |
  | 204 | 206 | deactivate\_plugins(KALIFORMS\_SUBMISSIONS\_PLUGIN\_FILE, true); |
  | 205 | 207 | $html = '<div class="notice" style="background: #e9eff3;padding: 15px;border: 10px solid #fff;text-align:center;">'; |
  | 206 | 208 | $html .= '<h1 style="text-align:center; margin-bottom:15px">'; |
  | 207 | 209 | $html .= esc\_html\_\_('Kali Forms Submissions Deactivated', 'kaliforms'); |
  | 208 | 210 | $html .= '</h1>'; |
  | 209 | 211 | $html .= '<h4>' . esc\_html\_\_("The plugin was deactivated because this version is not supported. No worries, everything is still working, but please make sure you update our plugins to the latest versions. You can do so by using the automatic plugin updater functionality, or by downloading the newest plugin file from our website.", 'kaliforms') . '</h4>'; |
  | 210 | 212 | $html .= '</div>'; |
  | 211 | 213 |  |
  | 212 | 214 | echo $html; |
  | 213 | 215 | return; |
  | 214 | 216 | } |
  | 215 | 217 |  |
  | 216 | 218 | if ( |
  | 217 | 219 | defined('KALIFORMS\_SUBMISSIONS\_PLUGIN\_FILE') |
  | 218 | 220 | && defined('KALIFORMS\_SUBMISSIONS\_VERSION') |
  | 219 | 221 | && version\_compare(KALIFORMS\_SUBMISSIONS\_VERSION, '1.5.0', '<') |
  | 220 | 222 | ) { |
  | 221 | 223 | $html = '<div class="notice" style="background: #e9eff3;padding: 15px;border: 10px solid #fff;text-align:center;">'; |
  | 222 | 224 | $html .= '<h1 style="text-align:center; margin-bottom:15px">'; |
  | 223 | 225 | $html .= esc\_html\_\_('Kali Forms Submissions needs update', 'kaliforms'); |
  | 224 | 226 | $html .= '</h1>'; |
  | 225 | 227 | $html .= '<h4>' . esc\_html\_\_("Please make sure you are using the latest version of the Kali Forms Submissions plugin.", 'kaliforms') . '</h4>'; |
  | 226 | 228 | $html .= '</div>'; |
  | 227 | 229 |  |
  | 228 | 230 | echo $html; |
  | 229 | 231 | } |
  | 230 | 232 | } |
  | 231 | 233 | /\*\* |
  | 232 | 234 | \* Upgrade pro version if needed |
  | 233 | 235 | \* |
  | 234 | 236 | \* @return void |
  | 235 | 237 | \*/ |
  | 236 | 238 | public function upgrade\_pro() |
  | 237 | 239 | { |
  | 238 | 240 | $this->\_check\_submission\_plugin(); |
  | 239 | 241 | $plugins = get\_plugins(); |
  | 240 | 242 | $status  = array\_key\_exists('kali-forms-pro/kali-forms-pro.php', $plugins) ? 'installed' : 'not-installed'; |
  | 241 | 243 | if ($status === 'not-installed') { |
  | 242 | 244 | return; |
  | 243 | 245 | } |
  | 244 | 246 |  |
  | 245 | 247 | if ($status === 'installed') { |
  | 246 | 248 | $status = is\_plugin\_active('kali-forms-pro/kali-forms-pro.php') ? 'active' : 'installed'; |
  | 247 | 249 | } |
  | 248 | 250 |  |
  | 249 | 251 | if ($status === 'active' && version\_compare(KALIFORMS\_PRO\_VERSION, '1.5.0', '<')) { |
  | 250 | 252 | $html = '<div class="notice" style="background: #e9eff3;padding: 15px;border: 10px solid #fff;text-align:center;">'; |
  | 251 | 253 | $html .= '<h1 style="text-align:center; margin-bottom:15px">'; |
  | 252 | 254 | $html .= esc\_html\_\_('Update Kali Forms Pro to the latest version', 'kaliforms'); |
  | 253 | 255 | $html .= '</h1>'; |
  | 254 | 256 | $html .= '<h4>' . esc\_html\_\_("Please make sure you update our plugins to the latest versions. You can do so by using the automatic plugin updater functionality, or by downloading the newest plugin file from our website.", 'kaliforms') . '</h4>'; |
  | 255 | 257 | $html .= '</div>'; |
  | 256 | 258 |  |
  | 257 | 259 | echo $html; |
  | 258 | 260 | } |
  | 259 | 261 | } |
  | 260 | 262 |  |
  | 261 | 263 | /\*\* |
  | 262 | 264 | \* Registers the widget to the elementor plugin |
  | 263 | 265 | \* |
  | 264 | 266 | \* @return void |
  | 265 | 267 | \*/ |
  | 266 | 268 | public function load\_elementor\_widget() |
  | 267 | 269 | { |
  | 268 | 270 | add\_action('elementor/widgets/widgets\_registered', function () { |
  | 269 | 271 | $widget = new Elementor\_KaliForms\_Widget(); |
  | 270 | 272 | \Elementor\Plugin::instance()->widgets\_manager->register\_widget\_type($widget); |
  | 271 | 273 | }); |
  | 272 | 274 | } |
  | 273 | 275 | } |
* ## [kali-forms/trunk/README.txt](/changeset/3036466/kali-forms/trunk/README.txt?old=3029334&old_path=kali-forms%2Ftrunk%2FREADME.txt "Show the [3029334:3036466] differences restricted to kali-forms/trunk/README.txt")

  | [r3029334](/browser/kali-forms/trunk/README.txt?rev=3029334#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/README.txt?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | === Contact Form builder with drag & drop for WordPress - Kali Forms  === |
  | 2 | 2 | Contributors: kaliforms, andreic86 |
  | 3 | 3 | Tags: contact form, contact form plugin, forms, form builder, custom form, contact button, custom contact form, form manager, forms builder, forms creator, signup form, payment form, stripe, stripe form, paypal, paypal form, email form |
  | 4 | 4 | Requires at least: 5.2 |
  | 5 | 5 | Tested up to: 6.3 |
  | 6 | 6 | Requires PHP: 5.6 |
  | 7 | 7 | Stable tag: 2.3.41 |
  | 8 | 8 | License: GPLv3 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | 10 | 10 |  |
  | 11 | 11 | Build the ideal contact form for your WordPress website in minutes through the Drag & Drop builder and Guided Emails for entries notifications. |
  | 12 | 12 |  |
  | 13 | 13 | == Description == |
  | 14 | 14 |  |
  | 15 | 15 | #### WORDPRESS CONTACT FORM PLUGIN |
  | 16 | 16 |  |
  | 17 | 17 | Meet Kali Forms - the powerful & user-friendly WordPress contact form plugin. Start from scratch with our easy-to-use drag & drop builder or build a form with our predesigned templates in just a few clicks... |
  | 18 | 18 |  |
  | 19 | 19 | Kali Forms makes it easy to create powerful contact forms, payment forms, feedback forms and more for your website without the hassle. |
  | 20 | 20 |  |
  | 21 | 21 | = Easy-to-use Form Templates = |
  | 22 | 22 |  |
  | 23 | 23 | Building forms can take time, which is something we all never have enough of. So to make the form creation experience even easier and more efficient, Kali Forms comes with built-in form templates which you can use if you don't want to start from scratch! |
  | 24 | 24 |  |
  | 25 | 25 | - \*\*Standard contact form\*\* |
  | 26 | 26 |  |
  | 27 | 27 | Instantly create a contact form that allows your website visitors and potential customers to get in touch with you. |
  | 28 | 28 |  |
  | 29 | 29 | - \*\*Employee information form\*\* |
  | 30 | 30 |  |
  | 31 | 31 | Easily use and modify the Kali Forms employee information form template which you can use to collect vital information during the employee onboarding process. |
  | 32 | 32 |  |
  | 33 | 33 | > \*\*These 13 additional templates are only available in [Kali Forms Pro](https://kaliforms.com/pricing?utm\_source=wordpress.org&utm\_medium=web&utm\_campaign=form%20templates):\*\* |
  | 34 | 34 | > |
  | 35 | 35 | > - \*\*Job application form\*\* |
  | 36 | 36 | > |
  | 37 | 37 | > Easily create a form that allows candidates to apply for a job with this template. |
  | 38 | 38 | > |
  | 39 | 39 | > - \*\*Appointment form\*\* |
  | 40 | 40 | > |
  | 41 | 41 | > Make it easy for potential customers and clients to book a call or schedule a meeting with you without linking to external services. |
  | 42 | 42 | > |
  | 43 | 43 | > - \*\*Customer feedback form\*\* |
  | 44 | 44 | > |
  | 45 | 45 | > Use the customer feedback form template to start collecting valuable feedback and suggestions from your customers. |
  | 46 | 46 | > |
  | 47 | 47 | > - \*\*Art contest\*\* |
  | 48 | 48 | > |
  | 49 | 49 | > Thinking of running an art contest or competition but don't know where to start? With the Kali Forms Art Contest form template, easily start collecting entries in just a few clicks. |
  | 50 | 50 | > |
  | 51 | 51 | > - \*\*Gaming tournament registration form\*\* |
  | 52 | 52 | > |
  | 53 | 53 | > Do you run a gaming website and want to host a gaming tournament that all your followers can join? If so, easily create a gaming tournament registration form by importing this predesigned template. Kali Forms makes it easy to plan and host gaming tournaments that people love. |
  | 54 | 54 | > |
  | 55 | 55 | > - \*\*GDPR-Friendly contact form\*\* |
  | 56 | 56 | > |
  | 57 | 57 | > Kali Forms makes it extremely easy to create GDPR-friendly contact forms with a confirmation checkbox that allows you to ensure that people submitting your contact form agree with the terms and conditions or privacy policy of your website. |
  | 58 | 58 | > |
  | 59 | 59 | > - \*\*Running calculator form\*\* |
  | 60 | 60 | > |
  | 61 | 61 | > Help users that like to go on outdoor runs calculate their pace, time and distance. The calculations are easily handled through our built-in Calculator. |
  | 62 | 62 | > |
  | 63 | 63 | > - \*\*Donation form\*\* |
  | 64 | 64 | > |
  | 65 | 65 | > A simple form that will allow you to accept donations through PayPal. |
  | 66 | 66 | > |
  | 67 | 67 | > - \*\*Request quote form\*\* |
  | 68 | 68 | > |
  | 69 | 69 | > An example form for requesting a quote for gardening services. |
  | 70 | 70 | > |
  | 71 | 71 | > - \*\*Reservation form\*\* |
  | 72 | 72 | > |
  | 73 | 73 | > Use this form if you want to provide users with an example of a hotel reservation form. |
  | 74 | 74 | > |
  | 75 | 75 | > - \*\*Gym Membership Application form\*\* |
  | 76 | 76 | > |
  | 77 | 77 | > Staying in shape is very important, allow users to apply to a gym memberhsip at your establishment using this example form. |
  | 78 | 78 | > |
  | 79 | 79 | > - \*\*Simple booking form\*\* |
  | 80 | 80 | > |
  | 81 | 81 | > Allow users to book a venue through this form. Previously selected dates will be automatically disabled in the calendar selection in order to avoid overlapping bookings. |
  | 82 | 82 | > |
  | 83 | 83 | > - \*\*Simple booking form with payment\*\* |
  | 84 | 84 | > |
  | 85 | 85 | > Provide users with a basic form that will allow them to book a room at your hotel and also accept payments online through PayPal. |
  | 86 | 86 | > |
  | 87 | 87 | > |
  | 88 | 88 | > \*\*[Learn more about Kali Forms Pro…](https://kaliforms.com/pricing?utm\_source=wordpress.org&utm\_medium=web&utm\_campaign=form%20templates)\*\* |
  | 89 | 89 |  |
  | 90 | 90 | --- |
  | 91 | 91 |  |
  | 92 | 92 | = The Fastest WordPress Form Plugin Available = |
  | 93 | 93 |  |
  | 94 | 94 | We built the Kali Forms WordPress form plugin from the ground up overcome the performance issues caused by most (if not all) other form plugins. Say goodbye to legacy, outdated code. Kali Forms is built on [React](https://reactjs.org/). |
  | 95 | 95 |  |
  | 96 | 96 | = All forms are 100% mobile-responsive. = |
  | 97 | 97 |  |
  | 98 | 98 | Contact forms created with Kali Forms are fully mobile responsive, so your contact forms will look great on mobile, tablet, laptop and desktop devices. |
  | 99 | 99 |  |
  | 100 | 100 | --- |
  | 101 | 101 |  |
  | 102 | 102 | = The Days of Form Spam Are Over = |
  | 103 | 103 |  |
  | 104 | 104 | We know much of a problem form spam is which is why Kali Forms is designed to use a combination of [Google's powerful reCAPTCHA](https://www.google.com/recaptcha/intro/v3.html) and spam honeypot system so you never have to waste your time dealing with unsolicited submissions ever again. |
  | 105 | 105 |  |
  | 106 | 106 | = Easy doesn't need to mean basic forms = |
  | 107 | 107 |  |
  | 108 | 108 | > \*This feature is only available in [Kali Forms Pro](kaliforms.com/pricing)!\* |
  | 109 | 109 | > |
  | 110 | 110 | > Kali Forms was designed to be user-friendly but being easy-to-use doesn't need to mean that you should only be able to create simple, basic forms. |
  | 111 | 111 | > |
  | 112 | 112 | > With Kali Forms Pro, you can easily create powerful forms that use conditional logic, multi-page forms, and make use of our partial entries and submisison handling add-on. |
  | 113 | 113 | > |
  | 114 | 114 | > [Learn More about Kali Forms Pro…](https://kaliforms.com) |
  | 115 | 115 |  |
  | 116 | 116 | ---- |
  | 117 | 117 |  |
  | 118 | 118 | = 3rd party or external service disclaimer = |
  | 119 | 119 | The plugin sends data (User action) to our website through an API Call (https://kaliforms.com/wp-json/kf/v1/uninstall-feedback) in order to send a uninstall feedback. |
  | 120 | 120 |  |
  | 121 | 121 | The plugin connects to our website through an API call (https://kaliforms.com/wp-json/kf/v1/plugins) in order to request a list of available extensions. |
  | 122 | 122 |  |
  | 123 | 123 | \*\*Kali Forms does not send any data without consent or user action to our website, nor do we collect sensitive information from the requests.\*\* |
  | 124 | 124 |  |
  | 125 | 125 | Our full privacy policy can be found [here](https://kaliforms.com/privacy-policy/). |
  | 126 | 126 |  |
  | 127 | 127 | == Installation == |
  | 128 | 128 | = For automatic installation: = |
  | 129 | 129 |  |
  | 130 | 130 | The easiest and recommended way to install is to click on 'Plugins' then 'Add New' and type 'Kali Forms' in the search field. You'll then be able to install the plugin within a few seconds and get started right away. |
  | 131 | 131 |  |
  | 132 | 132 | = For Manual Installation (1): = |
  | 133 | 133 |  |
  | 134 | 134 | 1. Login to your website and go to the \*\*\*Plugins\*\*\* section of your admin panel. |
  | 135 | 135 | 2. Click the \*\*\*Add New\*\*\* button. |
  | 136 | 136 | 3. Under \*\*\*Install Plugins\*\*\*, click the \*\*\*Upload\*\*\* link. |
  | 137 | 137 | 4. Select the plugin zip file (\*kaliforms.x.x.x.zip\*) from your computer then click the \*\*\*Install Now\*\*\* button. |
  | 138 | 138 | 5. You should see a message stating that the \*plugin was installed successfully.\* |
  | 139 | 139 | 6. Now click \*\*\*activate plugin\*\*\*. |
  | 140 | 140 |  |
  | 141 | 141 | = For Manual Installation (2): = |
  | 142 | 142 |  |
  | 143 | 143 | 1. You should have access to the server where WordPress is installed. If you don't, please contact your system administrator. |
  | 144 | 144 | 2. Copy the plugin zip file (\*kaliforms.x.x.x.zip\*) to your server and unzip it somewhere in the file system. |
  | 145 | 145 | 3. Copy the new folder with name "\*kaliforms\*" folder into the \*\*\*/wp-content/plugins\*\*\* directory of your WordPress installation. |
  | 146 | 146 | 4. Login to your website and go to the \*\*\*Plugins\*\*\* section of your admin panel. |
  | 147 | 147 | 5. Look for "\*\*\*Kali Forms\*\*\*" and click Activate. |
  | 148 | 148 |  |
  | 149 | 149 | == Frequently Asked Questions == |
  | 150 | 150 |  |
  | 151 | 151 | = Who is Kali Forms for? = |
  | 152 | 152 |  |
  | 153 | 153 | - Kali Forms is the perfect WordPress form plugin for businesses, web design agencies and basically anyone with a WordPress website. If you want to add a form to your WordPress website, Kali Forms is the must-use plugin. |
  | 154 | 154 |  |
  | 155 | 155 | = Do I need to be able to program to use Kali Forms? = |
  | 156 | 156 |  |
  | 157 | 157 | - Kali Forms was built from the ground up to be the most user-friendly WordPress form plugin. You definetely do \*\*not\*\* need to know how to program to use it but if you are comfortable with custom CSS you can easily customize your form even further. |
  | 158 | 158 |  |
  | 159 | 159 | = How can I access the full version of Kali Forms? = |
  | 160 | 160 |  |
  | 161 | 161 | - You can get access to the full version of Kali Forms, premium extensions and support by [upgrading](https://kaliforms.com/pricing?utm\_source=wordpress.org&utm\_medium=web&utm\_campaign=FAQ). |
  | 162 | 162 |  |
  | 163 | 163 | = How can I say thanks? = |
  | 164 | 164 |  |
  | 165 | 165 | \* Share Kali Forms with someone else who's looking for a form plugin for their website! |
  | 166 | 166 |  |
  | 167 | 167 | = Where can I suggest a feature? = |
  | 168 | 168 |  |
  | 169 | 169 | - If you'd like to give us any feedback that we could use to take Kali Forms even further, please let us know by filling [this form](https://forms.gle/oTm2huQhNwumSHAu9) out! |
  | 170 | 170 |  |
  | 171 | 171 | = Where can I get help? = |
  | 172 | 172 |  |
  | 173 | 173 | - If you're a Kali Forms Pro user, [please reach out to us](https://kaliforms.com/contact-us/) - if you're using the free version of Kali Forms, feel free to use the [WordPress.org Support Forums here.](https://wordpress.org/support/plugin/kali-forms/) |
  | 174 | 174 |  |
  | 175 | 175 | == Screenshots == |
  | 176 | 176 | 1. Form builder |
  | 177 | 177 | 2. One Click Forms |
  | 178 | 178 | 3. Spam Protection |
  | 179 | 179 | 4. Conditional Logic (PRO) |
  | 180 | 180 | 5. Form field edit |
  | 181 | 181 | 6. General settings |
  | 182 | 182 | 7. Options presets |
  | 183 | 183 |  |
  | 184 | 184 | == Changelog == |
  |  | 185 | 2.3.42 |
  |  | 186 | - Fixed vulnerability in the form entries functionality & plugin collision |
  |  | 187 |  |
  | 185 | 188 | 2.3.41 |
  | 186 | 189 | - Various bugs, fixes and QOL improvements |
  | 187 | 190 |  |
  | 188 | 191 | 2.3.40 |
  | 189 | 192 | - PayPal button wasn't initiated correctly |
  | 190 | 193 |  |
  | 191 | 194 | 2.3.39 |
  | 192 | 195 | - Added an integration with Modula gallery ( pro only ) |
  | 193 | 196 |  |
  | 194 | 197 | 2.3.38 |
  | 195 | 198 | - Fixed a bug with the file upload field validation |
  | 196 | 199 |  |
  | 197 | 200 | 2.3.37 |
  | 198 | 201 | - Fixed a bug with the file upload field |
  | 199 | 202 |  |
  | 200 | 203 | 2.3.35 |
  | 201 | 204 | - Fixed a bug with upload conditionals |
  | 202 | 205 |  |
  | 203 | 206 | 2.3.34 |
  | 204 | 207 | - Fixed a bug with upload fields validation |
  | 205 | 208 |  |
  | 206 | 209 | 2.3.33 |
  | 207 | 210 | - Fixed a bug where attachment wasn't sent in emails |
  | 208 | 211 |  |
  | 209 | 212 | 2.3.32 |
  | 210 | 213 | - Fixed a bug with conditional fields |
  | 211 | 214 |  |
  | 212 | 215 | 2.3.31 |
  | 213 | 216 | - Fixed an issue with frontend rendering |
  | 214 | 217 |  |
  | 215 | 218 | 2.3.30 |
  | 216 | 219 | - Fixed an issue with the file upload field |
  | 217 | 220 | - Fixed an issue related to cache busting |
  | 218 | 221 |  |
  | 219 | 222 | 2.3.28 |
  | 220 | 223 | - Email log verifies user role before anything else |
  | 221 | 224 |  |
  | 222 | 225 | 2.3.27 |
  | 223 | 226 | - Fixed a vulnerability that allowed data submission to forms that where not published |
  | 224 | 227 |  |
  | 225 | 228 | 2.3.27 |
  | 226 | 229 | - Fixed a typo |
  | 227 | 230 |  |
  | 228 | 231 | 2.3.26 |
  | 229 | 232 | - Added mailgun reply to header |
  | 230 | 233 |  |
  | 231 | 234 | 2.3.23 |
  | 232 | 235 | - Fix trailing comma throwing error |
  | 233 | 236 |  |
  | 234 | 237 | 2.3.22 |
  | 235 | 238 | - Added a new option to delete entries after a certain amount of days |
  | 236 | 239 |  |
  | 237 | 240 | 2.3.20 |
  | 238 | 241 | - Fatal error fix when sanitizing a certain input |
  | 239 | 242 |  |
  | 240 | 243 | 2.3.19 |
  | 241 | 244 | - Bugfix related to checkbox validation and pages |
  | 242 | 245 |  |
  | 243 | 246 | 2.3.18 |
  | 244 | 247 | - Emails now accept PDF's as well for media attachments |
  | 245 | 248 |  |
  | 246 | 249 | 2.3.17 |
  | 247 | 250 | - There was a bug with datetimepicker from PRO version |
  | 248 | 251 |  |
  | 249 | 252 | 2.3.16 |
  | 250 | 253 | - Added the ip\_address smart tag in the shorcode definition |
  | 251 | 254 |  |
  | 252 | 255 | 2.3.15 |
  | 253 | 256 | - Small bugfix for certain PHP Versions |
  | 254 | 257 |  |
  | 255 | 258 | 2.3.14 |
  | 256 | 259 | - Added an option to disable the bootstrap grid |
  | 257 | 260 |  |
  | 258 | 261 | 2.3.13 |
  | 259 | 262 | - Fixed a problem with the {allFields} placeholder |
  | 260 | 263 |  |
  | 261 | 264 | 2.3.12 |
  | 262 | 265 | - Bug fix |
  | 263 | 266 |  |
  | 264 | 267 | 2.3.11 |
  | 265 | 268 | - Bug fix |
  | 266 | 269 |  |
  | 267 | 270 | 2.3.10 |
  | 268 | 271 | - Added min - max options to the number input ( Textbox -> Type = Number ) |
  | 269 | 272 |  |
  | 270 | 273 | 2.3.9 |
  | 271 | 274 | - Fixed a bug where it tried to instantiate an array from object |
  | 272 | 275 | - Fixed a bug regarding email logging |
  | 273 | 276 |  |
  | 274 | 277 | 2.3.8 |
  | 275 | 278 | - Fixed an issue with not loading the right dependencies when having multiple forms |
  | 276 | 279 | - Added HEIC extension to file upload |
  | 277 | 280 |  |
  | 278 | 281 | 2.3.7 |
  | 279 | 282 | - Fixed a bug when sending an email that had textarea filled with multiple lines ( it collapsed them ) |
  | 280 | 283 |  |
  | 281 | 284 | 2.3.6 |
  | 282 | 285 | - Removed extra slash from asset load URL |
  | 283 | 286 |  |
  | 284 | 287 | 2.3.5 |
  | 285 | 288 | - Added a configurable timeout for redirect |
  | 286 | 289 | - Removed file upload directly from server in an email attachment |
  | 287 | 290 |  |
  | 288 | 291 | 2.3.4 |
  | 289 | 292 | - Hide Extension submenu item on network |
  | 290 | 293 |  |
  | 291 | 294 | 2.3.2 & 2.3.3 |
  | 292 | 295 | - Recaptcha triggered an error if you had 2 of them on the same page |
  | 293 | 296 | - Compact overlap style would not be applied on date time picker |
  | 294 | 297 | - Added a checkbox to trigger "scroll" to thank you page, instead of being a default |
  | 295 | 298 | - Various bug fixes and QOL improvements |
  | 296 | 299 |  |
  | 297 | 300 | 2.3.1 |
  | 298 | 301 | - Added ip address in form entry list |
  | 299 | 302 | - Small fixes and qol improvements |
  | 300 | 303 |  |
  | 301 | 304 | 2.3.0 |
  | 302 | 305 | - Added a new way to view and handle submissions |
  | 303 | 306 | - Various bug fixes |
  | 304 | 307 |  |
  | 305 | 308 | 2.2.30 |
  | 306 | 309 | - Fixed issue with reply to field with sendinblue provider |
  | 307 | 310 | - Fixed issue with notice dismissal |
  | 308 | 311 |  |
  | 309 | 312 | 2.2.29 |
  | 310 | 313 | - Forms now scroll to the thank you message after submission |
  | 311 | 314 | - Fixed a typo |
  | 312 | 315 | - Added a new method to init our forms inside elementor |
  | 313 | 316 |  |
  | 314 | 317 | 2.2.28 |
  | 315 | 318 | - Fixed a bug in the akismet check |
  | 316 | 319 | - Fixed a bug with entrycounter |
  | 317 | 320 |  |
  | 318 | 321 | 2.2.27 |
  | 319 | 322 | - Updated language files |
  | 320 | 323 |  |
  | 321 | 324 | 2.2.25 |
  | 322 | 325 | - Elementor patching |
  | 323 | 326 |  |
  | 324 | 327 | 2.2.24 |
  | 325 | 328 | - Forms loaded in Elementor did not start the file upload process |
  | 326 | 329 |  |
  | 327 | 330 | 2.2.22 |
  | 328 | 331 | - Kaliform shortcode inside Elementor shortcode widget would not "start" |
  | 329 | 332 |  |
  | 330 | 333 | 2.2.21 |
  | 331 | 334 | - PHP 7.4 removed function each() - caused a fatal error |
  | 332 | 335 | - Added support for pagebreak complete label |
  | 333 | 336 | - There was an issue with conditional logic image radio items |
  | 334 | 337 | - QOL improvements |
  | 335 | 338 | - Added a Elementor widget (BETA) - still work in progress |
  | 336 | 339 |  |
  | 337 | 340 | 2.2.20 |
  | 338 | 341 | - Various bug fixes and QOL improvements |
  | 339 | 342 |  |
  | 340 | 343 | 2.2.19 |
  | 341 | 344 | - Elementor causing issues with javascript, removed JS files but forced the opacity to 1 |
  | 342 | 345 |  |
  | 343 | 346 | 2.2.18 |
  | 344 | 347 | - Small bug fixing |
  | 345 | 348 |  |
  | 346 | 349 | 2.2.17 |
  | 347 | 350 | - Added support for getresponse (needs plugin) |
  | 348 | 351 | - Fixed an issue with the date picker component (from the pro version) |
  | 349 | 352 | - Image radio improvements (now accepts label and captions) |
  | 350 | 353 |  |
  | 351 | 354 | 2.2.16 |
  | 352 | 355 | - Added support for moosend & campaign monitor (needs plugin) |
  | 353 | 356 | - Added support for webhooks placeholders (needs plugin) |
  | 354 | 357 | - Submission views will show the date and time of submission |
  | 355 | 358 |  |
  | 356 | 359 | 2.2.0 -> 2.2.15 |
  | 357 | 360 | - Generated a pot file in the /languages directory |
  | 358 | 361 | - Fixed an issue with file upload fields |
  | 359 | 362 | - Required field mark is wrapped in a span now |
  | 360 | 363 | - Added more options to the file upload field ( you can now add a minimum file size and a total maximum files size when using multiple uploads) |
  | 361 | 364 | - Submission view (for the user) now renders digital signatures and fileUpload fields as images ( paving the way for the new and improved version ) |
  | 362 | 365 | - Added support for mailpoet & sendfox (needs the newsletter plugin) |
  | 363 | 366 | - Fixed a bug when handling emails |
  | 364 | 367 | - Fixed an issue with having multiple file upload fields at the same time with different settings |
  | 365 | 368 | - Trigger frontend scripts in Elementor builder |
  | 366 | 369 | - Added support for webhooks |
  | 367 | 370 | - Fixed an issue with special characters in sent emails |
  | 368 | 371 | - Default wp mailer did not set headers correctly |
  | 369 | 372 | - Re-done email settings page ( along with email sending logic - hoping to increase deliverability) |
  | 370 | 373 | - Added an option to "reset" the form after you finish it |
  | 371 | 374 | - QOL improvements |
  | 372 | 375 | - Bug fixes |
  | 373 | 376 |  |
  | 374 | 377 | 2.1.7 |
  | 375 | 378 | - Fixed an issue with paypal and recaptcha |
  | 376 | 379 |  |
  | 377 | 380 | 2.1.6 |
  | 378 | 381 | - Bugfix |
  | 379 | 382 |  |
  | 380 | 383 | 2.1.5 |
  | 381 | 384 | - Small fix |
  | 382 | 385 |  |
  | 383 | 386 | 2.1.3 |
  | 384 | 387 | - QOL improvements |
  | 385 | 388 | - Bug fixes |
  | 386 | 389 | - Added a new global placeholder {thisPermalink} that returns the page where the form was submitted |
  | 387 | 390 |  |
  | 388 | 391 | 2.1.2 |
  | 389 | 392 | - Security issue fixed |
  | 390 | 393 |  |
  | 391 | 394 | 2.1.1 |
  | 392 | 395 | - Security issues fixed and resolved |
  | 393 | 396 | - Visual bug fixed ( for WP 5.5 ) |
  | 394 | 397 |  |
  | 395 | 398 | 2.1.0 |
  | 396 | 399 | - Added support for newsletter |
  | 397 | 400 | - Added support for slack |
  | 398 | 401 | - Added support for digital signature |
  | 399 | 402 | - Added support for user registration |
  | 400 | 403 | - Various bug fixes and qol issues |
  | 401 | 404 |  |
  | 402 | 405 | 2.0.4 / 2.0.5 / 2.0.6 |
  | 403 | 406 | - Bugfix |
  | 404 | 407 |  |
  | 405 | 408 | 2.0.3 |
  | 406 | 409 | - Bugfix on calculator page |
  | 407 | 410 |  |
  | 408 | 411 | 2.0.2 |
  | 409 | 412 | - Added a little bit of backward compat with older PHP versions for akismet checks |
  | 410 | 413 |  |
  | 411 | 414 | 2.0.1 |
  | 412 | 415 | - Bug fixes |
  | 413 | 416 |  |
  | 414 | 417 | 2.0.0 |
  | 415 | 418 | - Revamped User Interface |
  | 416 | 419 | - Added Image Radio field |
  | 417 | 420 | - Added Donation field |
  | 418 | 421 | - Added Button field |
  | 419 | 422 | - Added Akismet integration |
  | 420 | 423 | - Added honeypot spam protection |
  | 421 | 424 | - Added more placeholders that you can you use in the Thank You Message and in the Emails |
  | 422 | 425 | - Added support for more premium features |
  | 423 | 426 | - Various QOL improvements |
  | 424 | 427 |  |
  | 425 | 428 | 1.6.5 |
  | 426 | 429 | - Reply To header was not being set property (form notifications) |
  | 427 | 430 |  |
  | 428 | 431 | 1.6.4 |
  | 429 | 432 | - Fixed a bug when clicking the update button would show the deactivation feedback form |
  | 430 | 433 |  |
  | 431 | 434 | 1.6.3 |
  | 432 | 435 | - Checkbox values were not replaced in the placeholder |
  | 433 | 436 |  |
  | 434 | 437 | 1.6.2 |
  | 435 | 438 | - Fixed an issue that didnt trigger the email wizzard |
  | 436 | 439 |  |
  | 437 | 440 | 1.6.1 |
  | 438 | 441 | - {formName} placeholder wasn't returning a value |
  | 439 | 442 |  |
  | 440 | 443 | 1.6.0 |
  | 441 | 444 | - Improved form builder ( design & functionality ) |
  | 442 | 445 | - Added form themes |
  | 443 | 446 | - Form submissions renamed to Form Entries |
  | 444 | 447 | - Form entries can be saved without additional plugins ( note that you will need Form Submission plugin to access them through WP) |
  | 445 | 448 | - Textareas can be converted to editors ( standard wp editor ) |
  | 446 | 449 | - Added several form fields ( URL, Phone, Email ) |
  | 447 | 450 | - Added email duplicate functionality |
  | 448 | 451 | - Added field duplicate functionality |
  | 449 | 452 | - Added functionality to add placeholders in inputs to prefill user data on page view (e.g. to prefill a field with the user email, you need to use the {user\_email} placeholder : [kaliform id="5" email="{user\_email}"]) |
  | 450 | 453 | - Added 2 new placeholders that can be used in fields, thank you message or email notifications: {entryCounter} and {formName} |
  | 451 | 454 | - Using PHP Before Form Process scripting areas, you can edit/add/delete values from the submitted data before they are saved |
  | 452 | 455 | - QOL adjustments |
  | 453 | 456 |  |
  | 454 | 457 | 1.5.0 |
  | 455 | 458 | - Added a new filter that happens before file uploads |
  | 456 | 459 | - Added a review notice for wordpress.org |
  | 457 | 460 | - Added Email Settings page to improve and debug mail deliverability |
  | 458 | 461 | - Added a duplicate form button in the Forms listing |
  | 459 | 462 | - Added a dashboard widget |
  | 460 | 463 | - Added an email quick link in the form builder top navigation bar ( email icon ) |
  | 461 | 464 | - Added possibility to send data through the shorcode e.g. [kaliform id="1" first-name="John" last-name="Doe"] |
  | 462 | 465 | - Added uninstall feedback |
  | 463 | 466 | - Added system checks |
  | 464 | 467 | - Several QOL adjustments |
  | 465 | 468 |  |
  | 466 | 469 | 1.4.0 |
  | 467 | 470 | - Various bugs, fixes and QOL adjustments |
  | 468 | 471 |  |
  | 469 | 472 | 1.3.0 |
  | 470 | 473 | - Added functionality to attach files uploaded through file upload fields to emails |
  | 471 | 474 | - Added functionality to attach files from uploaded media to emails (will be improved in the next update) |
  | 472 | 475 | - Added functionality to attach files from your server using a relative path (e.g. /app/public/wp-content/uploads/file.zip) |
  | 473 | 476 | - Added a simple way to view/copy placeholders that can be used in emails/thank you message/etc |
  | 474 | 477 | - Added conditional logic functionality to free text. Useful in scenarios where you want to display a certain message based on user input |
  | 475 | 478 | - Various bugs, fixes and QOL adjustments |
  | 476 | 479 |  |
  | 477 | 480 | 1.2.0 |
  | 478 | 481 | - Option to hide form name |
  | 479 | 482 | - Layout builder improvements ( offsets are now taken into consideration ) |
  | 480 | 483 | - Various bugs, fixes and QOL adjustments |
  | 481 | 484 |  |
  | 482 | 485 | 1.1.0 |
  | 483 | 486 | - Added an instalation hook to add a default contact form |
  | 484 | 487 | - Added a loading state for the app |
  | 485 | 488 | - Various bugs, fixes and QOL adjustments |
  | 486 | 489 |  |
  | 487 | 490 | 1.0.0 |
  | 488 | 491 | - Release |
* ## [kali-forms/trunk/bootstrap.php](/changeset/3036466/kali-forms/trunk/bootstrap.php?old=3028792&old_path=kali-forms%2Ftrunk%2Fbootstrap.php "Show the [3029334:3036466] differences restricted to kali-forms/trunk/bootstrap.php")

  | [r3029334](/browser/kali-forms/trunk/bootstrap.php?rev=3028792#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/bootstrap.php?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | if (!defined('ABSPATH')) { |
  | 3 | 3 | exit; |
  | 4 | 4 | } |
  | 5 | 5 | require\_once 'autoloader.php'; |
  | 6 | 6 |  |
  | 7 | 7 | /\*\* |
  | 8 | 8 | \* |
  | 9 | 9 | \* Plugin defines |
  | 10 | 10 | \* |
  | 11 | 11 | \*/ |
  | 12 | 12 | define('KALIFORMS\_BASE', plugin\_dir\_path(\_\_FILE\_\_)); |
  | 13 | 13 | define('KALIFORMS\_URL', plugin\_dir\_url(\_\_FILE\_\_) . 'public/'); |
  | 14 | 14 | define('KALIFORMS\_SITE', rtrim(ABSPATH, '\\/')); |
  | 15 | 15 | define('KALIFORMS\_BASE\_API', 'https://www.kaliforms.com/wp-json/wp/v2/'); |
  | 16 | 16 | define('KALIFORMS\_EXTENSIONS\_API', 'https://kaliforms.com/wp-json/kf/v1/plugins'); |
  | 17 | 17 | define('KALIFORMS\_UNINSTALL\_FEEDBACK\_API', 'https://kaliforms.com/wp-json/kf/v1/uninstall-feedback'); |
  | 18 |  | define('KALIFORMS\_VERSION', '2.3.4~~1~~'); |
  |  | 18 | define('KALIFORMS\_VERSION', '2.3.42'); |
* ## [kali-forms/trunk/kali-forms.php](/changeset/3036466/kali-forms/trunk/kali-forms.php?old=3028792&old_path=kali-forms%2Ftrunk%2Fkali-forms.php "Show the [3029334:3036466] differences restricted to kali-forms/trunk/kali-forms.php")

  | [r3029334](/browser/kali-forms/trunk/kali-forms.php?rev=3028792#L1 "Show revision 3029334 of this file in browser") | [r3036466](/browser/kali-forms/trunk/kali-forms.php?rev=3036466#L1 "Show revision 3036466 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 | 3 | /\*\* |
  | 4 | 4 | \* Plugin Name: Kali Forms - WordPress Forms Made Easy |
  | 5 | 5 | \* Plugin URI: https://www.kaliforms.com |
  | 6 | 6 | \* Description: Kali Forms provides the best form creation experience for WordPress. |
  | 7 | 7 | \* Author: Kali Forms |
  | 8 |  | \* Version: 2.3.4~~1~~ |
  |  | 8 | \* Version: 2.3.42 |
  | 9 | 9 | \* Author URI: https://www.kaliforms.com/ |
  | 10 | 10 | \* License: GPLv3 or later |
  | 11 | 11 | \* License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | 12 | 12 | \* Requires PHP: 5.6 |
  | 13 | 13 | \* Text Domain: kaliforms |
  | 14 | 14 | \* Domain Path: /languages |
  | 15 | 15 | \* |
  | 16 | 16 | \* Copyright 2019        Kali Forms         hello@kaliforms.com |
  | 17 | 17 | \* |
  | 18 | 18 | \* This program is free software; you can redistribute it and/or modify |
  | 19 | 19 | \* it under the terms of the GNU General Public License, version 3, as |
  | 20 | 20 | \* published by the Free Software Foundation. |
  | 21 | 21 | \* |
  | 22 | 22 | \* This program is distributed in the hope that it will be useful, |
  | 23 | 23 | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
  | 24 | 24 | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
  | 25 | 25 | \* GNU General Public License for more details. |
  | 26 | 26 | \* |
  | 27 | 27 | \* You should have received a copy of the GNU General Public License |
  | 28 | 28 | \* along with this program; if not, write to the Free software |
  | 29 | 29 | \* Foundation, Inc., 51 Franklin St, Fifth Floor, Boston, MA  02110-1301  USA |
  | 30 | 30 | \*/ |
  | 31 | 31 |  |
  | 32 | 32 | namespace KaliForms; |
  | 33 | 33 |  |
  | 34 | 34 | use KaliForms\Inc\KaliForms; |
  | 35 | 35 |  |
  | 36 | 36 | if (!defined('ABSPATH')) { |
  | 37 | 37 | exit; |
  | 38 | 38 | } |
  | 39 | 39 |  |
  | 40 | 40 | define('KALIFORMS\_PLUGIN\_FILE', \_\_FILE\_\_); |
  | 41 | 41 | require\_once 'bootstrap.php'; |
  | 42 | 42 |  |
  | 43 | 43 | if (!class\_exists('KaliForms\Inc\KaliForms')) { |
  | 44 | 44 | return; |
  | 45 | 45 | } |
  | 46 | 46 | KaliForms::get\_instance(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3036466&old=3029334&new_path=%2Fkali-forms%2Ftrunk&old_path=%2Fkali-forms%2Ftrunk)
* [Zip Archive](?format=zip&new=3036466&old=3029334&new_path=%2Fkali-forms%2Ftrunk&old_path=%2Fkali-forms%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


