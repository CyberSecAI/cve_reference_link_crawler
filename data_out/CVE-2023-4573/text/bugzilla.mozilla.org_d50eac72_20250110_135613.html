

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1846687)
* [XML](/show_bug.cgi?ctype=xml&id=1846687)

Closed
[Bug 1846687](/show_bug.cgi?id=1846687)
(CVE-2023-4573)

Opened 1 years ago
Closed 1 year ago

# use-after-free in mStream

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

use-after-free in mStream

## Categories

### (Core :: Graphics, defect, P1)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=Graphics#Graphics)

Graphics
▾

Core :: Graphics
Mapping of cross platform rendering interfaces to various 2D graphics APIs
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=Graphics&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=Graphics)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P1

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

118 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Score | --- |
| --- | --- |
| Webcompat Priority | --- |
| a11y-review | --- |
| Accessibility Severity | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | [117+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=117%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed) |
| firefox-esr115 | [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox116 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix) |
| firefox117 | [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed) |
| firefox118 | [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 | 117+ | fixed |
| firefox-esr115 | 117+ | fixed |
| firefox-esr128 | --- | --- |
| firefox116 |  | wontfix |
| firefox117 | + | fixed |
| firefox118 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: sonakkbi, Assigned: bobowen)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/8877ff082c9a902bbf383dc11c1aeffc?d=mm&size=40)  [bobowen](/user_profile?user_id=458623)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/fbcb684d5cd0458d775e9361e0bd6cb6?d=mm&size=40)  [sonakkbi](/user_profile?user_id=698655)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/17436ade8da1b23d42b3df05b9c4fc77?d=mm&size=40)  [bhood](/user_profile?user_id=697075)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

8 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (5 keywords, Whiteboard: [reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2023-4573

[Keywords:](/describekeywords.cgi)

[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---),
[testcase](/buglist.cgi?keywords=testcase&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a1164458_1689 "1 years ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a1379617_488993 "1 year ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (8 files)

| [ASAN.txt](/attachment.cgi?id=9346868)  [1 years ago](#c0)  [sonakkbi](/user_profile?user_id=698655)   17.01 KB, text/plain |  | [Details](/attachment.cgi?id=9346868&action=edit) |
| --- | --- | --- |
| [index.html](/attachment.cgi?id=9346869)  [1 years ago](#c1)  [sonakkbi](/user_profile?user_id=698655)   328 bytes, text/html |  | [Details](/attachment.cgi?id=9346869&action=edit) |
| [patch1.diff](/attachment.cgi?id=9346870)  [1 years ago](#c2)  [sonakkbi](/user_profile?user_id=698655)   3.08 KB, patch |  | [Details](/attachment.cgi?id=9346870&action=edit) | [Diff](/attachment.cgi?id=9346870&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846687&attachment=9346870) |
| [patch2.diff](/attachment.cgi?id=9346871)  [1 years ago](#c3)  [sonakkbi](/user_profile?user_id=698655)   549 bytes, patch |  | [Details](/attachment.cgi?id=9346871&action=edit) | [Diff](/attachment.cgi?id=9346871&action=diff) | [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846687&attachment=9346871) |
| [svg.html](/attachment.cgi?id=9347262)  [1 years ago](#c7)  [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398)   424 bytes, text/html |  | [Details](/attachment.cgi?id=9347262&action=edit) |
| [Force CanvasTranslator to reinitialize while processing.](/attachment.cgi?id=9347654)  [1 year ago](#c12)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   6.54 KB, text/plain |  | [Details](/attachment.cgi?id=9347654&action=edit) |
| [Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!](/attachment.cgi?id=9347656)  [1 year ago](#c13)  [Bob Owen (:bobowen)](/user_profile?user_id=458623)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c20 "1 year ago")  diannaS : [approval-mozilla-release-](#c22 "1 year ago")  RyanVM : [approval-mozilla-esr102+](#c23 "1 year ago")  RyanVM : [approval-mozilla-esr115+](#c23 "1 year ago")  tjr : [sec-approval+](#c15 "1 year ago") | [Details](/attachment.cgi?id=9347656&action=edit) | [Review](/attachment.cgi?id=9347656) |
| [advisory.txt](/attachment.cgi?id=9350231)  [1 year ago](#c26)  [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341)   229 bytes, text/plain |  | [Details](/attachment.cgi?id=9350231&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1846687#c0)• 1 years ago |
|  | |

Attached file
[ASAN.txt](attachment.cgi?id=9346868)
— [Details](attachment.cgi?id=9346868&action=edit)

While graphics rendering, |mStream| is used to receive rendering data[1](https://searchfox.org/mozilla-central/source/gfx/layers/ipc/CanvasTranslator.h#261). |mStream| could be destroyed when initialized. However, there is no check in init function[2](https://searchfox.org/mozilla-central/source/gfx/layers/ipc/CanvasTranslator.cpp#138) and it could initialize twice. This could lead to use-after-free when |mStream| is destroyed during accessing rendering data.

REPRODUCE

Operating System: All

1.apply \*patch1.diff and patch2.diff

2.visit index.html

\*: patch1.diff is emulating a compromised content process. patch2.diff is patching the Graphic Process to improve the success rate (just for reproducing easily)

Crash State: see asan file

Flags: sec-bounty?

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1846687#c1)• 1 years ago |
|  | |

Attached file
[index.html](attachment.cgi?id=9346869)
— [Details](attachment.cgi?id=9346869&action=edit)

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1846687#c2)• 1 years ago |
|  | |

Attached patch

[patch1.diff](attachment.cgi?id=9346870&action=diff)
— [Details](attachment.cgi?id=9346870&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846687&attachment=9346870)

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1846687#c3)• 1 years ago |
|  | |

Attached patch

[patch2.diff](attachment.cgi?id=9346871&action=diff)
— [Details](attachment.cgi?id=9346871&action=edit)
— [Splinter Review](/page.cgi?id=splinter.html&ignore=&bug=1846687&attachment=9346871)

|  | [:Gijs (he/him)](/user_profile?user_id=159069) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a19879_159069)• 1 years ago |

Group: firefox-core-security → gfx-core-securityComponent: Security → GraphicsProduct: Firefox → Core

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a52852_1689)• 1 years ago |

Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[csectype-uaf](/buglist.cgi?keywords=csectype-uaf&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a53805_1689)• 1 years ago |

Keywords: [testcase](/buglist.cgi?keywords=testcase&resolution=---)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1846687#c4)• 1 years ago |
|  | |

I was unable to reproduce this on Linux.

|  | [sonakkbi](/user_profile?user_id=698655)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1846687#c5)• 1 years ago |
|  | |

I'm sorry to hear that it's not reproducible on Linux. The vulnerability itself still exists in Linux, but I overlooked that the function used in the patch.diff is not called in Linux. Could you test it on Windows?

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1846687#c6)• 1 years ago |
|  | |

(In reply to sonakkbi from [comment #5](/show_bug.cgi?id=1846687#c5 "RESOLVED FIXED - use-after-free in mStream"))

> I'm sorry to hear that it's not reproducible on Linux. The vulnerability itself still exists in Linux, but I overlooked that the function used in the patch.diff is not called in Linux. Could you test it on Windows?

I did modify the patch to work on Linux, but perhaps I missed something. I was trying to get a rr/Pernosco session (Linux only) to hopefully save them some work. I'll leave it do a developer with more knowledge of this component to try.

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1846687#c7)• 1 years ago |
|  | |

Attached file
[svg.html](attachment.cgi?id=9347262)
— [Details](attachment.cgi?id=9347262&action=edit)

Tyson, it might be possible to reproduce this with this test case on Linux instead of the attached one.

Flags: needinfo?(twsmith)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1846687#c8)• 1 years ago |
|  | |

Bob, can you take a look at this?

Assignee: nobody → bobowencodeFlags: needinfo?(bobowencode)

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1846687#c9)• 1 years ago |
|  | |

(In reply to Jeff Muizelaar [:jrmuizel] from [comment #7](/show_bug.cgi?id=1846687#c7 "RESOLVED FIXED - use-after-free in mStream"))

> Tyson, it might be possible to reproduce this with this test case on Linux instead of the attached one.

I'd be happy to give it a try.

I also had issues with the patches not applying cleanly and targeting Windows. Could you have a look at them as well please?

Flags: needinfo?(twsmith) → needinfo?(jmuizelaar)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1846687#c10)• 1 year ago |
|  | |

(In reply to Jeff Muizelaar [:jrmuizel] from [comment #8](/show_bug.cgi?id=1846687#c8 "RESOLVED FIXED - use-after-free in mStream"))

> Bob, can you take a look at this?

The patches were a bit mangled for me as well, so I applied them by hand.

I could see the issue either way from the description.

Pretty sure it will only affect Windows.

Severity: -- → S2Status: UNCONFIRMED → ASSIGNED
[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected)
[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected)
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)Ever confirmed: trueFlags: needinfo?(bobowencode)Priority: -- → P1

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1846687#c11)• 1 year ago |
|  | |

(In reply to Bob Owen (:bobowen) from [comment #10](/show_bug.cgi?id=1846687#c10 "RESOLVED FIXED - use-after-free in mStream"))

> (In reply to Jeff Muizelaar [:jrmuizel] from [comment #8](/show_bug.cgi?id=1846687#c8 "RESOLVED FIXED - use-after-free in mStream"))
>
> > Bob, can you take a look at this?
>
> The patches were a bit mangled for me as well, so I applied them by hand.
>
> I could see the issue either way from the description.
>
> Pretty sure it will only affect Windows.

The crash I was getting turned out to be in webrender code and not a UAF.

By modifying the patch a bit I think I've now reproduced the issue raised here.

Once I've got something for this, I'll see if I can still reproduce the crash in webrender and file a separate bug.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1846687#c12)• 1 year ago |
|  | |

Attached file
[Force CanvasTranslator to reinitialize while processing.](attachment.cgi?id=9347654)
— [Details](attachment.cgi?id=9347654&action=edit)

Here's my reproduction patch that I've rolled into one.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1846687#c13)• 1 year ago |
|  | |

Attached file
[Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!](attachment.cgi?id=9347656)
— [Details](attachment.cgi?id=9347656&action=edit)

|  | [Jeff Muizelaar [:jrmuizel]](/user_profile?user_id=309398) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a631339_309398)• 1 year ago |

Flags: needinfo?(jmuizelaar)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1846687#c14)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: Assuming they knew it was a sec bug, working out the problem from the patch is probably fairly easy, but not trivial.

  However, there isn't a known exploit of the vulnerability currently.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: No
* **Which older supported branches are affected by this flaw?**: All
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**: (Patch grafts onto all required branches.)
* **How likely is this patch to cause regressions; how much testing does it need?**: Unlikely, it adds an extra check that should never be triggered without an exploited content process.
* **Is Android affected?**: No
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1846687#c15)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

Approved to land and uplift

[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: sec-approval? → sec-approval+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1846687#c16)• 1 year ago |
|  | |

Pushed by bobowencode@gmail.com:
<https://hg.mozilla.org/integration/autoland/rev/d548ab29d331>
Don't allow CanvasTranslator to be initialized twice. r=jrmuizel

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1846687#c17)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

### Beta/Release Uplift Approval Request

* **User impact if declined**: Vulnerability that can be triggered in the GPU process from a compromised content process, which could potentially be used as part of a sandbox escape.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: No
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: None
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Simple is null check added that should never fail without a compromised content process.
* **String changes made/needed**: None
* **Is Android affected?**: No
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-release?
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-beta?

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623)  Assignee |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1846687#c18)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: sec-high
* **User impact if declined**: Vulnerability that can be triggered in the GPU process from a compromised content process, which could potentially be used as part of a sandbox escape.
* **Fix Landed on Version**: 118
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: Simple is null check added that should never fail without a compromised content process.
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-esr115?

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1846687#c19)• 1 year ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/d548ab29d331>

Status: ASSIGNED → RESOLVEDClosed: 1 year ago
[status-firefox118](/buglist.cgi?f1=cf_status_firefox118&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox118&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 118 Branch

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1846687#c20)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

Approved for 117.0b6

[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1846687#c21)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/ae4bf01c1157>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a731364_690067)• 1 year ago |

[status-firefox117](/buglist.cgi?f1=cf_status_firefox117&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox117&o1=equals&v1=fixed)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a763571_695136)• 1 year ago |

[tracking-firefox117](/buglist.cgi?f1=cf_tracking_firefox117&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox117&o1=equals&v1=%2B)
[tracking-firefox118](/buglist.cgi?f1=cf_tracking_firefox118&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox118&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=117%2B)

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a763587_695136)• 1 year ago |

[status-firefox116](/buglist.cgi?f1=cf_status_firefox116&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=affected) → [wontfix](/buglist.cgi?f1=cf_status_firefox116&o1=equals&v1=wontfix)

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1846687#c22)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

This will be roll out with 117 and will not be included in the next 116 dot release. If for any reason we do need to take this in the dot release, please feel free to NI me.

[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-release? → approval-mozilla-release-

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1069777_75935)• 1 year ago |

Group: gfx-core-security → core-security-release
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected)
[tracking-firefox-esr102](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=isnotempty):
--- → [117+](/buglist.cgi?f1=cf_tracking_firefox_esr102&o1=equals&v1=117%2B)

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1846687#c23)• 1 year ago |
|  | |

Comment on [attachment 9347656](/attachment.cgi?id=9347656 "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") [[details]](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!")

[Bug 1846687](/show_bug.cgi?id=1846687 "RESOLVED FIXED - use-after-free in mStream"): Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!

Approved for 115.2esr and 102.15esr.

[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-esr115?
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-esr115+
[Attachment #9347656](/attachment.cgi?id=9347656&action=edit "Bug 1846687: Don't allow CanvasTranslator to be initialized twice. r=jrmuizel!") -
Flags: approval-mozilla-esr102+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1846687#c24)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/9fa8de7e28de>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1085511_75935)• 1 year ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1846687#c25)• 1 year ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr102/rev/594fcde70067>

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1085819_75935)• 1 year ago |

[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=fixed)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1164458_1689)• 1 year ago |

Flags: sec-bounty? → sec-bounty+

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1379617_488993)• 1 year ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1846687#c26)• 1 year ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9350231)
— [Details](attachment.cgi?id=9350231&action=edit)

|  | [June Wilde (she/her) [:jewilde]](/user_profile?user_id=626341) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a1985213_626341)• 1 year ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?] [adv-main117+] [adv-esr115.2+] [adv-esr102.15+]

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a13393522_1689)• 1 year ago |

Group: core-security-release

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a13399456_1689)• 1 year ago |

Alias: CVE-2023-4573

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1846687#a26132596_5898)• 7 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)
You need to [log in](/show_bug.cgi?id=1846687&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [sonakkbi](/user_profile?user_id=698655)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

