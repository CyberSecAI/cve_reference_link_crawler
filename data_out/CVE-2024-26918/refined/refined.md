The provided content relates to CVE-2024-26918.

**Root cause of vulnerability:**
The vulnerability stems from a flawed requirement introduced in a previous commit related to PME (Power Management Event) polling of runtime PM managed devices. The previous commit incorrectly mandated that devices must be in the RPM_ACTIVE state for PME polling. However, only devices in low-power states should be polled. Additionally, the configuration space of the device needs to be accessible during polling, which depends on the state of both the device and its parent bridge. It was found that the bridge might appear to be in D0 state while its PM state is actually RPM_SUSPENDING, leading to config space of polled device being inaccessible during `pci_pme_wakeup()`.

**Weaknesses/vulnerabilities present:**
- Incorrect active state requirement for PME polling on runtime PM managed devices.
- Inadequate checks for bridge power state during PME polling, leading to potential inaccessibility of subordinate device's config space.

**Impact of exploitation:**
- A regression was introduced where a Thunderbolt/USB4 hierarchy failed to scan for an attached NVMe endpoint downstream of a bridge in a D3hot power state. This means devices might not be correctly detected or initialized.
- Inaccessible configuration space can lead to malfunction or failure of the device during PME wakeup.

**Attack vectors:**
The vulnerability is not directly exploitable by an attacker in a traditional sense. It's a logic error in the kernel's power management implementation that causes a malfunction.

**Required attacker capabilities/position:**
An attacker doesn't need a specific capability or position. The issue is related to how the kernel handles power management of PCI devices.