

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ard Biesheuvel <ardb@kernel.org> | 2024-09-12 17:45:49 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:11:14 +0200 |
| commit | [11690d7e76842f29b60fbb5b35bc97d206ea0e83](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)) | |
| tree | [dd6206188995a3646f8f5016d618a988d10d64c0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83) | |
| parent | [43f5d026da0bee68c59d5791772cd1727f2d48d9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43f5d026da0bee68c59d5791772cd1727f2d48d9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83&id2=43f5d026da0bee68c59d5791772cd1727f2d48d9)) | |
| download | [linux-11690d7e76842f29b60fbb5b35bc97d206ea0e83.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-11690d7e76842f29b60fbb5b35bc97d206ea0e83.tar.gz) | |

efistub/tpm: Use ACPI reclaim memory for event log to avoid corruptioncommit 77d48d39e99170b528e4f2e9fc5d1d64cdedd386 upstream.
The TPM event log table is a Linux specific construct, where the data
produced by the GetEventLog() boot service is cached in memory, and
passed on to the OS using an EFI configuration table.
The use of EFI\_LOADER\_DATA here results in the region being left
unreserved in the E820 memory map constructed by the EFI stub, and this
is the memory description that is passed on to the incoming kernel by
kexec, which is therefore unaware that the region should be reserved.
Even though the utility of the TPM2 event log after a kexec is
questionable, any corruption might send the parsing code off into the
weeds and crash the kernel. So let's use EFI\_ACPI\_RECLAIM\_MEMORY
instead, which is always treated as reserved by the E820 conversion
logic.
Cc: <stable@vger.kernel.org>
Reported-by: Breno Leitao <leitao@debian.org>
Tested-by: Usama Arif <usamaarif642@gmail.com>
Reviewed-by: Ilias Apalodimas <ilias.apalodimas@linaro.org>
Signed-off-by: Ard Biesheuvel <ardb@kernel.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)

| -rw-r--r-- | [drivers/firmware/efi/libstub/tpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/firmware/efi/libstub/tpm.c?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/firmware/efi/libstub/tpm.c b/drivers/firmware/efi/libstub/tpm.cindex 7acbac16eae0b2..95da291c3083ef 100644--- a/[drivers/firmware/efi/libstub/tpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/libstub/tpm.c?id=43f5d026da0bee68c59d5791772cd1727f2d48d9)+++ b/[drivers/firmware/efi/libstub/tpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/firmware/efi/libstub/tpm.c?id=11690d7e76842f29b60fbb5b35bc97d206ea0e83)@@ -115,7 +115,7 @@ void efi\_retrieve\_tpm2\_eventlog(void) }  /\* Allocate space for the logs and copy them. \*/- status = efi\_bs\_call(allocate\_pool, EFI\_LOADER\_DATA,+ status = efi\_bs\_call(allocate\_pool, EFI\_ACPI\_RECLAIM\_MEMORY, sizeof(\*log\_tbl) + log\_size, (void \*\*)&log\_tbl);  if (status != EFI\_SUCCESS) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:36:43 +0000

