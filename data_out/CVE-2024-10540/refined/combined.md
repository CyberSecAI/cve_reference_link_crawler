=== Content from plugins.trac.wordpress.org_64b4369d_20250111_194743.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3179229%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Ffrontend%2Fclass.bookingpress_appointment_bookings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3175695/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3175695 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")
* [Next Change](/changeset/3179779/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3179779 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php") →

---

# Changeset [3179229](/changeset/3179229 "Show full changeset") for [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/31/2024 06:28:26 AM
([2 months](/timeline?from=2024-10-31T06%3A28%3A26Z&precision=second "See timeline at 10/31/2024 06:28:26 AM") ago)

Author:
reputeinfosystems
Message:
# 1.1.17

* Minor bug fixes

File:

1 edited

* [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229 "Show entry in browser")
  (modified)
  ([40 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/changeset/3179229/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Show the changeset 3179229 restricted to bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")

  | [r3175695](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L165 "Show revision 3175695 of this file in browser") | [r3179229](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L165 "Show revision 3179229 of this file in browser") |  |
  | --- | --- | --- |
  | 165 | 165 | add\_action( 'wp\_ajax\_bookingpress\_update\_elementor\_widgets', array( $this, 'bookingpress\_elementor\_pre\_update\_check') ); |
  | 166 | 166 |  |
  | 167 |  | ~~add\_filter( 'bookingpress\_dynamic\_next\_page\_request\_filter', array( $this, 'bookingpress\_dynamic\_next\_page\_request\_filter\_func'), 1000);~~ |
  | 168 |  |  |
  | 169 |  | ~~}~~ |
  | 170 |  |  |
  | 171 |  | ~~function bookingpress\_dynamic\_next\_page\_request\_filter\_func( $bookingpress\_dynamic\_next\_page\_request\_filter ){~~ |
  | 172 |  |  |
  | 173 |  | ~~global $BookingPress;~~ |
  | 174 |  |  |
  | 175 |  | ~~$bookingpress\_step\_navigation\_token\_postdata = '';~~ |
  | 176 |  | ~~$bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata );~~ |
  | 177 |  |  |
  | 178 |  | ~~$bookingpress\_use\_legacy\_functions = 'false';~~ |
  | 179 |  | ~~if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){~~ |
  | 180 |  | ~~$bookingpress\_use\_legacy\_functions = 'true';~~ |
  | 181 |  | ~~}~~ |
  | 182 |  |  |
  | 183 |  | ~~$bookingpress\_dynamic\_next\_page\_request\_filter .= '~~ |
  | 184 |  | ~~let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'";~~ |
  | 185 |  | ~~if( "datetime" == vm.bookingpress\_sidebar\_step\_data[ current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ){~~ |
  | 186 |  | ~~let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date;~~ |
  | 187 |  | ~~let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0];~~ |
  | 188 |  |  |
  | 189 |  | ~~var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'";~~ |
  | 190 |  | ~~var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce");~~ |
  | 191 |  | ~~if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){~~ |
  | 192 |  | ~~bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre;~~ |
  | 193 |  | ~~}else {~~ |
  | 194 |  | ~~bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value;~~ |
  | 195 |  | ~~}~~ |
  | 196 |  |  |
  | 197 |  | ~~let postData = {~~ |
  | 198 |  | ~~action: "bpa\_set\_timeslot\_token",~~ |
  | 199 |  | ~~tokenData: selected\_token\_data,~~ |
  | 200 |  | ~~selectedDate: appointment\_selected\_date,~~ |
  | 201 |  | ~~\_wpnonce:bkp\_wpnonce\_pre\_fetch~~ |
  | 202 |  | ~~};~~ |
  | 203 |  |  |
  | 204 |  | ~~'.$bookingpress\_step\_navigation\_token\_postdata.'~~ |
  | 205 |  |  |
  | 206 |  | ~~axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) )~~ |
  | 207 |  | ~~.then( function (response) {~~ |
  | 208 |  | ~~}.bind(this) )~~ |
  | 209 |  | ~~.catch( function (error) {~~ |
  | 210 |  | ~~});~~ |
  | 211 |  | ~~}~~ |
  | 212 |  | ~~';~~ |
  | 213 |  |  |
  | 214 |  | ~~return $bookingpress\_dynamic\_next\_page\_request\_filter;~~ |
  | 215 | 167 | } |
  | 216 | 168 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1206) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1158) |  |
  | 1206 | 1158 | $content .= '</div>'; |
  | 1207 | 1159 |  |
  | 1208 |  | return ~~do\_shortcode($content)~~; |
  |  | 1160 | return $content; |
  | 1209 | 1161 | } |
  | 1210 | 1162 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1639) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1591) |  |
  | 1639 | 1591 | $response['stop\_check'] = $entire\_month\_details['stop\_check']; |
  | 1640 | 1592 | $response['working\_hour\_timing\_token'] = $entire\_month\_details['working\_hour\_timing\_token']; |
  |  | 1593 | $response['bpa\_disabled\_dates'] = $entire\_month\_details['bpa\_disabled\_dates']; |
  | 1641 | 1594 |  |
  | 1642 | 1595 | $end\_ms = microtime( true ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1725) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1678) |  |
  | 1725 | 1678 | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
  | 1726 | 1679 | } |
  | 1727 |  |  |
  | 1728 | 1680 |  |
  | 1729 | 1681 | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1734) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1686) |  |
  | 1734 | 1686 | $max\_service\_capacity = 1; |
  | 1735 | 1687 | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
  | 1736 |  |  |
  | 1737 |  | /\*\* Minimum Time required before booking start \*/ |
  | 1738 |  | /\*\* Minimum Time required before booking end \*/ |
  |  | 1688 |  |
  |  | 1689 | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
  | 1739 | 1690 |  |
  | 1740 | 1691 | if( !empty( $start\_date ) ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1756) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1707) |  |
  | 1756 | 1707 |  |
  | 1757 | 1708 | $selected\_date = !empty( $\_REQUEST['selected\_date'] ) ? sanitize\_text\_field( $\_REQUEST['selected\_date'] ) : ""; |
  | 1758 |  |  |
  |  | 1709 |  |
  |  | 1710 | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
  |  | 1711 | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
  |  | 1712 |  |
  |  | 1713 | $selected\_service\_duration\_in\_min = ''; |
  |  | 1714 | if( 'm' == $selected\_service\_duration\_unit ){ |
  |  | 1715 | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
  |  | 1716 | } else { |
  |  | 1717 | if( 'h' == $selected\_service\_duration\_unit ){ |
  |  | 1718 | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
  |  | 1719 | } |
  |  | 1720 | } |
  |  | 1721 |  |
  |  | 1722 | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
  |  | 1723 |  |
  |  | 1724 | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
  |  | 1725 |  |
  |  | 1726 | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
  |  | 1727 | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
  |  | 1728 |  |
  |  | 1729 | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
  |  | 1730 |  |
  |  | 1731 | /\*\* Get the default days off in the above limit \*/ |
  |  | 1732 | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
  |  | 1733 |  |
  |  | 1734 | //$bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
  |  | 1735 |  |
  | 1759 | 1736 | if( !empty( $selected\_date ) ){ |
  | 1760 | 1737 | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $selected\_date ) ) ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1800) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1777) |  |
  | 1800 | 1777 | } |
  | 1801 | 1778 |  |
  |  | 1779 | foreach( $bpa\_retrieves\_default\_disabled\_dates as $bpa\_key => $disabled\_date ){ |
  |  | 1780 | $bpa\_retrieves\_default\_disabled\_dates[ $bpa\_key ] = date('Y-m-d', strtotime( $disabled\_date ) ); |
  |  | 1781 | } |
  |  | 1782 |  |
  | 1802 | 1783 | $selected\_where\_in  = ' AND bookingpress\_appointment\_date IN ('; |
  | 1803 | 1784 | $selected\_where\_in .= rtrim( str\_repeat( '%s,', count( $booked\_check\_dates ) ), ',' ).' )'; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1811) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1792) |  |
  | 1811 | 1792 | $total\_booked\_appiontments = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE 1 = 1 $where\_clause", ARRAY\_A ); // phpcs:ignore |
  | 1812 | 1793 | /\*\* Reputelog - new code - need to check for optimization start \*/ |
  |  | 1794 |  |
  |  | 1795 | $first\_available\_date = ''; |
  | 1813 | 1796 |  |
  | 1814 | 1797 | foreach( $period as $dt ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1821) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1804) |  |
  | 1821 | 1804 | } |
  | 1822 | 1805 |  |
  |  | 1806 | if( !empty( $bpa\_retrieves\_default\_disabled\_dates ) && in\_array( $bpa\_check\_date, $bpa\_retrieves\_default\_disabled\_dates ) ){ |
  |  | 1807 | continue; |
  |  | 1808 | } |
  |  | 1809 |  |
  | 1823 | 1810 | $bpa\_check\_datetime = $dt->format( 'Y-m-d H:i:s'); |
  | 1824 | 1811 | $front\_timings\_data = $bookingpress\_appointment\_bookings->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, false, false, $total\_booked\_appiontments ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1852) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1839) |  |
  | 1852 | 1839 | foreach( $front\_timings\_data\_combined as $timeslot\_data ){ |
  | 1853 | 1840 |  |
  |  | 1841 | if( empty( $first\_available\_date ) ){ |
  |  | 1842 | $first\_available\_date = $timeslot\_data['store\_service\_date']; |
  |  | 1843 | } |
  |  | 1844 |  |
  | 1854 | 1845 | $startDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
  | 1855 | 1846 | $endDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_end\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1879) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1870) |  |
  | 1879 | 1870 | } |
  | 1880 | 1871 | } |
  |  | 1872 |  |
  |  | 1873 | if( strtotime( $selected\_date ) < strtotime( $first\_available\_date ) ){ |
  |  | 1874 | $selected\_date = $first\_available\_date; |
  |  | 1875 | } |
  | 1881 | 1876 | } |
  | 1882 | 1877 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1887) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1882) |  |
  | 1887 | 1882 | $working\_hour\_details = $working\_hour\_updated\_data['working\_details']; |
  | 1888 | 1883 | $working\_hour\_timing\_token = $working\_hour\_updated\_data['working\_hour\_timing\_token']; |
  |  | 1884 | $bpa\_retrieves\_default\_disabled\_dates = $working\_hour\_updated\_data['bpa\_disabled\_dates']; |
  | 1889 | 1885 | $max\_end\_date = $working\_hour\_updated\_data['next\_month\_date']; |
  | 1890 | 1886 | $preselected\_date = $working\_hour\_updated\_data['pre\_selected\_date']; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1904) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1900) |  |
  | 1904 | 1900 | $response['next\_month\_date'] = $max\_end\_date; |
  | 1905 | 1901 | $response['pre\_selected\_date'] = $preselected\_date; |
  |  | 1902 | $response['bpa\_disabled\_dates'] = $bpa\_retrieves\_default\_disabled\_dates; |
  | 1906 | 1903 | $response['stop\_check'] = ( false == $stop\_check && ( $bookingpress\_max\_date <= $max\_end\_date ) ) ? true : $stop\_check; |
  | 1907 | 1904 | $response['variant'] = 'success'; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3392) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3389) |  |
  | 3392 | 3389 | if(!empty($appointments\_data) && is\_array($appointments\_data) ){ |
  | 3393 | 3390 | foreach($appointments\_data as $k => $v){ |
  | 3394 |  | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) ){ |
  |  | 3391 | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3395 | 3392 | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_selected\_appointment\_date'])); |
  | 3396 | 3393 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3399) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3396) |  |
  | 3399 | 3396 | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_date'] = $bookingpress\_appointment\_date; |
  | 3400 | 3397 |  |
  | 3401 |  | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) ){ |
  |  | 3398 | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3402 | 3399 | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_time'])); |
  | 3403 | 3400 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3406) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3403) |  |
  | 3406 | 3403 | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_start\_time'] = $bookingpress\_appointment\_start\_time; |
  | 3407 | 3404 |  |
  | 3408 |  | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) ){ |
  |  | 3405 | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3409 | 3406 | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_end\_time'])); |
  | 3410 | 3407 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3604) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3601) |  |
  | 3604 | 3601 | $content .= '</div>'; |
  | 3605 | 3602 |  |
  | 3606 |  | return ~~do\_shortcode($content)~~; |
  |  | 3603 | return $content; |
  | 3607 | 3604 | } |
  | 3608 | 3605 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3771) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3768) |  |
  | 3771 | 3768 | $content .= '</div>'; |
  | 3772 | 3769 |  |
  | 3773 |  | return ~~do\_shortcode($content)~~; |
  |  | 3770 | return $content; |
  | 3774 | 3771 | } |
  | 3775 | 3772 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3805) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3802) |  |
  | 3805 | 3802 | if(!empty($bookingpress\_appointment\_details)){ |
  | 3806 | 3803 | $content .= '#'.$bookingpress\_appointment\_details['bookingpress\_booking\_id']; |
  | 3807 |  | return ~~do\_shortcode($content)~~; |
  |  | 3804 | return $content; |
  | 3808 | 3805 | } |
  | 3809 | 3806 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3825) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3822) |  |
  | 3825 | 3822 |  |
  | 3826 | 3823 | if(!$bookingpress\_nonce\_verification){ |
  | 3827 |  | return ~~do\_shortcode($content)~~; |
  |  | 3824 | return $content; |
  | 3828 | 3825 | } |
  | 3829 | 3826 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3846) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3843) |  |
  | 3846 | 3843 | $content .= '#'.$bookingpress\_booking\_id; |
  | 3847 | 3844 | } |
  | 3848 |  | return ~~do\_shortcode($content)~~; |
  |  | 3845 | return $content; |
  | 3849 | 3846 | } |
  | 3850 | 3847 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3985) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3982) |  |
  | 3985 | 3982 | $content = esc\_html\_e('Company avatar not found', 'bookingpress-appointment-booking'); |
  | 3986 | 3983 | } |
  | 3987 |  | return ~~do\_shortcode($content)~~; |
  |  | 3984 | return $content; |
  | 3988 | 3985 | } |
  | 3989 | 3986 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4007) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4004) |  |
  | 4007 | 4004 | $content = esc\_html\_e('Company name not found', 'bookingpress-appointment-booking'); |
  | 4008 | 4005 | } |
  | 4009 |  | return ~~do\_shortcode($content)~~; |
  |  | 4006 | return $content; |
  | 4010 | 4007 | } |
  | 4011 | 4008 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4029) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4026) |  |
  | 4029 | 4026 | $content = esc\_html\_e('Company website name not found', 'bookingpress-appointment-booking'); |
  | 4030 | 4027 | } |
  | 4031 |  | return ~~do\_shortcode($content)~~; |
  |  | 4028 | return $content; |
  | 4032 | 4029 | } |
  | 4033 | 4030 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4052) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4049) |  |
  | 4052 | 4049 | $content = esc\_html\_e('Company address not found', 'bookingpress-appointment-booking'); |
  | 4053 | 4050 | } |
  | 4054 |  | return ~~do\_shortcode($content)~~; |
  |  | 4051 | return $content; |
  | 4055 | 4052 | } |
  | 4056 | 4053 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4076) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4073) |  |
  | 4076 | 4073 | $content = esc\_html\_e('Company phone number not found', 'bookingpress-appointment-booking'); |
  | 4077 | 4074 | } |
  | 4078 |  | return ~~do\_shortcode($content)~~; |
  |  | 4075 | return $content; |
  | 4079 | 4076 | } |
  | 4080 | 4077 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4993) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4990) |  |
  | 4993 | 4990 | } |
  | 4994 | 4991 |  |
  |  | 4992 |  |
  | 4995 | 4993 | extract($args); |
  |  | 4994 |  |
  |  | 4995 |  |
  | 4996 | 4996 | $Bookingpress\_service  = 0; |
  | 4997 | 4997 | $Bookingpress\_category = 0; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L5000) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L5000) |  |
  | 5000 | 5000 | $Bookingpress\_category            = $category; |
  | 5001 | 5001 | $this->bookingpress\_form\_category = $category; |
  | 5002 |  | } |
  |  | 5002 | } |
  | 5003 | 5003 | $service = apply\_filters('bookingpress\_modify\_booking\_form\_default\_display\_services', $service); |
  | 5004 |  | if( ! empty($service) && $service != 0 ) { |
  |  | 5004 |  |
  |  | 5005 | if( ! empty( $service ) ) { |
  |  | 5006 | $service\_arr = explode( ',', $service ); |
  |  | 5007 | $service\_arr = array\_map( 'intval', $service\_arr ); |
  |  | 5008 | $service = implode( ', ', $service\_arr ); |
  | 5005 | 5009 | $Bookingpress\_service            = $service; |
  | 5006 | 5010 | $this->bookingpress\_form\_service = $service; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L7223) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L7227) |  |
  | 7223 | 7227 | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
  | 7224 | 7228 |  |
  |  | 7229 | $wp\_timezone\_offset = wp\_timezone\_string(); |
  |  | 7230 |  |
  |  | 7231 | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
  |  | 7232 | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
  |  | 7233 | } |
  |  | 7234 |  |
  |  | 7235 | $bookingpress\_step\_navigation\_token\_postdata = ''; |
  |  | 7236 | $bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata ); |
  |  | 7237 |  |
  |  | 7238 | $bookingpress\_use\_legacy\_functions = 'false'; |
  |  | 7239 | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
  |  | 7240 | $bookingpress\_use\_legacy\_functions = 'true'; |
  |  | 7241 | } |
  |  | 7242 |  |
  | 7225 | 7243 | $bookingpress\_vue\_methods\_data .= ' |
  | 7226 | 7244 | get\_formatted\_date(iso\_date){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L7792) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L7810) |  |
  | 7792 | 7810 |  |
  | 7793 | 7811 | '.$bookingpress\_dynamic\_time\_select\_after.' |
  | 7794 |  |  |
  | 7795 |  | vm.bookingpress\_~~step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name)~~ |
  |  | 7812 | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
  |  | 7813 | vm.bookingpress\_update\_timestep\_token(); |
  | 7796 | 7814 | }, |
  | 7797 | 7815 | resetForm(){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8043) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8061) |  |
  | 8043 | 8061 | } |
  | 8044 | 8062 | }, |
  |  | 8063 | bookingpress\_update\_timestep\_token( force\_update = false ){ |
  |  | 8064 | const vm = this; |
  |  | 8065 |  |
  |  | 8066 | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
  |  | 8067 |  |
  |  | 8068 | let current\_tab = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name; |
  |  | 8069 |  |
  |  | 8070 | if( true == force\_update || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
  |  | 8071 | console.log( vm.is\_bookingpress\_updating\_token ); |
  |  | 8072 | let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date; |
  |  | 8073 | let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0]; |
  |  | 8074 |  |
  |  | 8075 | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
  |  | 8076 | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
  |  | 8077 | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
  |  | 8078 | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
  |  | 8079 | }else { |
  |  | 8080 | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
  |  | 8081 | } |
  |  | 8082 |  |
  |  | 8083 | let postData = { |
  |  | 8084 | action: "bpa\_set\_timeslot\_token", |
  |  | 8085 | tokenData: selected\_token\_data, |
  |  | 8086 | selectedDate: appointment\_selected\_date, |
  |  | 8087 | \_wpnonce:bkp\_wpnonce\_pre\_fetch |
  |  | 8088 | }; |
  |  | 8089 |  |
  |  | 8090 | '.$bookingpress\_step\_navigation\_token\_postdata.' |
  |  | 8091 |  |
  |  | 8092 | vm.is\_bookingpress\_updating\_token = true; |
  |  | 8093 | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
  |  | 8094 | .then( function (response) { |
  |  | 8095 | vm.is\_bookingpress\_updating\_token = false; |
  |  | 8096 | vm.is\_bookingpress\_token\_updated = true; |
  |  | 8097 | }.bind(this) ) |
  |  | 8098 | .catch( function (error) { |
  |  | 8099 | }); |
  |  | 8100 | } |
  |  | 8101 | }, |
  | 8045 | 8102 | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
  | 8046 | 8103 | const vm = this; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8134) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8191) |  |
  | 8134 | 8191 | if( "" != bpa\_selected\_date ){ |
  | 8135 | 8192 | preselect\_date = true; |
  |  | 8193 | } |
  |  | 8194 |  |
  |  | 8195 | if( "" == bpa\_selected\_date ){ |
  |  | 8196 | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
  |  | 8197 | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
  | 8136 | 8198 | } |
  | 8137 | 8199 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8222) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8284) |  |
  | 8222 | 8284 | }); |
  | 8223 | 8285 | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
  |  | 8286 |  |
  |  | 8287 | /\* V-date-picker attributes \*/ |
  |  | 8288 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8289 |  |
  |  | 8290 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8291 | let vcal\_attr\_data = []; |
  |  | 8292 | let vcal\_attr\_data\_current = {}; |
  |  | 8293 | let k = 1; |
  |  | 8294 |  |
  |  | 8295 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8296 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8297 |  |
  |  | 8298 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8299 |  |
  |  | 8300 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8301 | let vcal\_attr\_obj = { |
  |  | 8302 | key: k, |
  |  | 8303 | dates: vcal\_date, |
  |  | 8304 | customData:{ |
  |  | 8305 | title: vcal\_data |
  |  | 8306 | } |
  |  | 8307 | }; |
  |  | 8308 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8309 | k++; |
  |  | 8310 | } |
  |  | 8311 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8312 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8313 | } |
  |  | 8314 |  |
  |  | 8315 | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
  |  | 8316 | /\* V-date-picker attributes \*/ |
  |  | 8317 |  |
  | 8224 | 8318 | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
  | 8225 | 8319 | vm.v\_calendar\_time\_token\_data = response.data.working\_hour\_timing\_token; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8244) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8338) |  |
  | 8244 | 8338 | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, 1 ); |
  | 8245 | 8339 | } |
  |  | 8340 |  |
  |  | 8341 | if( "undefined" != typeof vm.is\_bookingpress\_token\_updated && true == vm.is\_bookingpress\_token\_updated ){ |
  |  | 8342 | vm.bookingpress\_update\_timestep\_token( true ); |
  |  | 8343 | } |
  |  | 8344 |  |
  | 8246 | 8345 | '.$bookingpress\_disable\_date\_vue\_data\_after.' |
  | 8247 | 8346 | }.bind(this) ) |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8291) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8390) |  |
  | 8291 | 8390 | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
  | 8292 | 8391 | let v\_available\_dates\_only = []; |
  |  | 8392 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8393 |  |
  |  | 8394 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8395 | let vcal\_attr\_data = []; |
  |  | 8396 | let vcal\_attr\_data\_current = {}; |
  |  | 8397 | let k = 1; |
  |  | 8398 |  |
  |  | 8399 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8400 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8401 |  |
  |  | 8402 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8403 |  |
  |  | 8404 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8405 | let vcal\_attr\_obj = { |
  |  | 8406 | key: k, |
  |  | 8407 | dates: vcal\_date, |
  |  | 8408 | customData:{ |
  |  | 8409 | title: vcal\_data |
  |  | 8410 | } |
  |  | 8411 | }; |
  |  | 8412 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8413 | k++; |
  |  | 8414 | } |
  |  | 8415 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8416 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8417 | } |
  |  | 8418 |  |
  | 8293 | 8419 | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
  | 8294 | 8420 | v\_available\_dates\_only.push( i.split(" ")[0] ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8345) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8471) |  |
  | 8345 | 8471 | v\_available\_dates\_only.push( i.split(" ")[0] ); |
  | 8346 | 8472 | }); |
  |  | 8473 |  |
  |  | 8474 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8475 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8476 | let vcal\_attr\_data = []; |
  |  | 8477 | let vcal\_attr\_data\_current = {}; |
  |  | 8478 | let k = 1; |
  |  | 8479 |  |
  |  | 8480 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8481 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8482 |  |
  |  | 8483 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8484 |  |
  |  | 8485 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8486 | let vcal\_attr\_obj = { |
  |  | 8487 | key: k, |
  |  | 8488 | dates: vcal\_date, |
  |  | 8489 | customData:{ |
  |  | 8490 | title: vcal\_data |
  |  | 8491 | } |
  |  | 8492 | }; |
  |  | 8493 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8494 | k++; |
  |  | 8495 | } |
  |  | 8496 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8497 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8498 | } |
  | 8347 | 8499 | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
  | 8348 | 8500 | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8497) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8649) |  |
  | 8497 | 8649 | let vcal\_attributes = response.data.vcal\_attributes; |
  | 8498 | 8650 |  |
  | 8499 |  | if( vcal\_attributes.length != "" ){ |
  |  | 8651 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  | 8500 | 8652 | let vcal\_attr\_data = []; |
  | 8501 | 8653 | let vcal\_attr\_data\_current = {}; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8515) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8667) |  |
  | 8515 | 8667 | } |
  | 8516 | 8668 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  | 8517 |  | vm.v\_calendar\_attributes\_current = ~~vcal\_attr\_data\_current~~; |
  |  | 8669 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  | 8518 | 8670 | } |
  | 8519 | 8671 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8881) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L9033) |  |
  | 8881 | 9033 | '.$bookingpress\_dynamic\_validation\_for\_step\_change.' |
  | 8882 | 9034 | } |
  | 8883 |  |  |
  | 8884 | 9035 | if( "service" == current\_tab && "service" != vm.bookingpress\_current\_tab ){ |
  | 8885 | 9036 | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date+"T00:00:00+00:00"; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8924) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L9075) |  |
  | 8924 | 9075 | vm.bookngpress\_previous\_tab = previous\_tab; |
  | 8925 | 9076 | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
  | 8926 |  |  |
  | 8927 |  | ~~let tabsArr = ["cart","basic\_details","summary"];~~ |
  | 8928 | 9077 |  |
  | 8929 | 9078 | if( "datetime" == current\_tab ){ |
  | 8930 | 9079 | let selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
  | 8931 |  | if( tabsArr.indexOf( current\_selected\_tab ) > -1 ){ |
  | 8932 |  | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
  | 8933 |  | } else { |
  | 8934 |  | vm.bookingpress\_disable\_date(selected\_service\_id); |
  | 8935 |  | } |
  |  | 9080 | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
  | 8936 | 9081 | } |
  | 8937 | 9082 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3179229)
* [Zip Archive](?format=zip&new=3179229)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_9cff49cd_20250111_194709.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Fclass.bookingpress.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php?rev=3210916 "Revision 3210916")
* Next Revision →
* [Blame](/browser/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php)

---

# [source:](/browser?order=name "Go to repository root") [bookingpress-appointment-booking](/browser/bookingpress-appointment-booking?order=name "View bookingpress-appointment-booking")/[trunk](/browser/bookingpress-appointment-booking/trunk?order=name "View trunk")/[core](/browser/bookingpress-appointment-booking/trunk/core?order=name "View core")/[classes](/browser/bookingpress-appointment-booking/trunk/core/classes?order=name "View classes")/[class.bookingpress.php](/browser/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php?order=name "View class.bookingpress.php")

View diff against:

View revision:

| [Last change](/changeset/3217529/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php "View differences") on this file was [3217529](/changeset/3217529/ "View changeset 3217529"), checked in by reputeinfosystems, [5 days ago](/timeline?from=2025-01-06T09%3A23%3A13Z&precision=second "See timeline at 01/06/2025 09:23:13 AM") |
| --- |
| 1.1.25  * Fixed: add new service/appointment model hide behind the admin menu bar on websites hosted on wordpress.com * Other minor bug fixes |
| **File size:** 644.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { exit; } |
| [4](#L4) |  |
| [5](#L5) | if (! class\_exists('BookingPress') ) { |
| [6](#L6) | class BookingPress Extends BookingPress\_Core |
| [7](#L7) | { |
| [8](#L8) | var $bookingpress\_slugs; |
| [9](#L9) | function \_\_construct() |
| [10](#L10) | { |
| [11](#L11) | global $wp, $wpdb, $bookingpress\_capabilities\_global, $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_settings, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_default\_daysoff, $tbl\_bookingpress\_notifications, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_entries, $bookingpress\_common\_date\_format, $tbl\_bookingpress\_form\_fields, $tbl\_bookingpress\_customize\_settings,$tbl\_bookingpress\_debug\_payment\_log, $tbl\_bookingpress\_customers\_meta, $tbl\_bookingpress\_other\_debug\_logs, $bookingpress\_common\_time\_format, $pagenow,$Bookingpress, $tbl\_bookingpress\_entries\_meta, $tbl\_bookingpress\_double\_bookings,$tbl\_bookingpress\_transient,$tbl\_bookingpress\_export\_data\_log,$tbl\_bookingpress\_export\_data\_log\_detail,$export\_import\_data\_key\_name,$tbl\_bookingpress\_import\_data\_log,$tbl\_bookingpress\_import\_detail\_log,$tbl\_bookingpress\_import\_record\_rel,$tbl\_bookingpress\_import\_images; |
| [12](#L12) |  |
| [13](#L13) | $tbl\_bookingpress\_categories           = $wpdb->prefix . 'bookingpress\_categories'; |
| [14](#L14) | $tbl\_bookingpress\_services             = $wpdb->prefix . 'bookingpress\_services'; |
| [15](#L15) | $tbl\_bookingpress\_servicesmeta         = $wpdb->prefix . 'bookingpress\_servicesmeta'; |
| [16](#L16) | $tbl\_bookingpress\_customers            = $wpdb->prefix . 'bookingpress\_customers'; |
| [17](#L17) | $tbl\_bookingpress\_settings             = $wpdb->prefix . 'bookingpress\_settings'; |
| [18](#L18) | $tbl\_bookingpress\_default\_workhours    = $wpdb->prefix . 'bookingpress\_default\_workhours'; |
| [19](#L19) | $tbl\_bookingpress\_default\_daysoff      = $wpdb->prefix . 'bookingpress\_default\_daysoff'; |
| [20](#L20) | $tbl\_bookingpress\_notifications        = $wpdb->prefix . 'bookingpress\_notifications'; |
| [21](#L21) | $tbl\_bookingpress\_appointment\_bookings = $wpdb->prefix . 'bookingpress\_appointment\_bookings'; |
| [22](#L22) | $tbl\_bookingpress\_payment\_logs         = $wpdb->prefix . 'bookingpress\_payment\_transactions'; |
| [23](#L23) | $tbl\_bookingpress\_entries              = $wpdb->prefix . 'bookingpress\_entries'; |
| [24](#L24) | $tbl\_bookingpress\_form\_fields          = $wpdb->prefix . 'bookingpress\_form\_fields'; |
| [25](#L25) | $tbl\_bookingpress\_customize\_settings   = $wpdb->prefix . 'bookingpress\_customize\_settings'; |
| [26](#L26) | $tbl\_bookingpress\_debug\_payment\_log    = $wpdb->prefix . 'bookingpress\_debug\_payment\_log'; |
| [27](#L27) | $tbl\_bookingpress\_customers\_meta       = $wpdb->prefix . 'bookingpress\_customers\_meta'; |
| [28](#L28) | $tbl\_bookingpress\_other\_debug\_logs     = $wpdb->prefix . 'bookingpress\_other\_debug\_logs'; |
| [29](#L29) | $tbl\_bookingpress\_entries\_meta         = $wpdb->prefix . 'bookingpress\_entries\_meta'; |
| [30](#L30) | $tbl\_bookingpress\_double\_bookings      = $wpdb->prefix . 'bookignpress\_double\_bookings'; |
| [31](#L31) | $tbl\_bookingpress\_transient            = $wpdb->prefix . 'bookingpress\_transient'; |
| [32](#L32) | $tbl\_bookingpress\_export\_data\_log        = $wpdb->prefix.'bookingpress\_export\_data\_log'; |
| [33](#L33) | $tbl\_bookingpress\_export\_data\_log\_detail = $wpdb->prefix.'bookingpress\_export\_log\_detail'; |
| [34](#L34) | $tbl\_bookingpress\_import\_data\_log        = $wpdb->prefix.'bookingpress\_import\_data\_log'; |
| [35](#L35) | $tbl\_bookingpress\_import\_detail\_log      = $wpdb->prefix.'bookingpress\_import\_detail\_log'; |
| [36](#L36) | $tbl\_bookingpress\_import\_record\_rel      = $wpdb->prefix.'bookingpress\_import\_record\_rel'; |
| [37](#L37) | $tbl\_bookingpress\_import\_images          = $wpdb->prefix.'bookingpress\_import\_images'; |
| [38](#L38) |  |
| [39](#L39) | register\_activation\_hook(BOOKINGPRESS\_DIR . '/bookingpress-appointment-booking.php', array( 'BookingPress', 'install' )); |
| [40](#L40) | register\_activation\_hook(BOOKINGPRESS\_DIR . '/bookingpress-appointment-booking.php', array( 'BookingPress', 'bookingpress\_check\_network\_activation' )); |
| [41](#L41) | register\_uninstall\_hook(BOOKINGPRESS\_DIR . '/bookingpress-appointment-booking.php', array( 'BookingPress', 'uninstall' )); |
| [42](#L42) |  |
| [43](#L43) | /\* Set Page Capabilities Global \*/ |
| [44](#L44) | $bookingpress\_capabilities\_global = array( |
| [45](#L45) | 'bookingpress'               => 'bookingpress', |
| [46](#L46) | 'bookingpress\_calendar'      => 'bookingpress\_calendar', |
| [47](#L47) | 'bookingpress\_appointments'  => 'bookingpress\_appointments', |
| [48](#L48) | 'bookingpress\_payments'      => 'bookingpress\_payments', |
| [49](#L49) | 'bookingpress\_customers'     => 'bookingpress\_customers', |
| [50](#L50) | 'bookingpress\_services'      => 'bookingpress\_services', |
| [51](#L51) | 'bookingpress\_notifications' => 'bookingpress\_notifications', |
| [52](#L52) | 'bookingpress\_customize'     => 'bookingpress\_customize', |
| [53](#L53) | 'bookingpress\_settings'      => 'bookingpress\_settings', |
| [54](#L54) | ); |
| [55](#L55) |  |
| [56](#L56) | $this->bookingpress\_slugs = $this->bookingpress\_page\_slugs(); |
| [57](#L57) |  |
| [58](#L58) | global $bookingpress\_settings\_table\_exists; |
| [59](#L59) |  |
| [60](#L60) | $default\_date\_format = 'F j, Y'; |
| [61](#L61) | //$bookingpress\_settings\_table\_exists = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(1) FROM information\_schema.tables WHERE table\_schema=%s AND table\_name=%s",DB\_NAME,$tbl\_bookingpress\_settings)); |
| [62](#L62) | if($bookingpress\_settings\_table\_exists == 1) { |
| [63](#L63) | $default\_date\_format = $this->bookingpress\_get\_settings('default\_date\_format','general\_setting'); |
| [64](#L64) | $default\_date\_format = !empty($default\_date\_format) ? $default\_date\_format : 'F j, Y'; |
| [65](#L65) | } |
| [66](#L66) | $bookingpress\_common\_time\_format = $this->bookingpress\_check\_common\_time\_format( get\_option( 'time\_format' ) ); |
| [67](#L67) | $bookingpress\_common\_date\_format = $this->bookingpress\_check\_common\_date\_format($default\_date\_format); |
| [68](#L68) |  |
| [69](#L69) | add\_action('admin\_menu', array( $this, 'bookingpress\_menu' ), 26); |
| [70](#L70) | add\_action('admin\_enqueue\_scripts', array( $this, 'set\_css' ), 11); |
| [71](#L71) | add\_action('admin\_enqueue\_scripts', array( $this, 'set\_js' ), 11); |
| [72](#L72) |  |
| [73](#L73) | add\_action('wp\_head', array( $this, 'set\_front\_css' ), 1); |
| [74](#L74) | add\_action('wp\_footer', array( $this, 'set\_front\_js'), 1); |
| [75](#L75) |  |
| [76](#L76) | add\_filter('plugin\_action\_links', array( $this, 'bookingpress\_plugin\_action\_links' ), 10, 2); |
| [77](#L77) |  |
| [78](#L78) | if (! function\_exists('is\_plugin\_active') ) { |
| [79](#L79) | include ABSPATH . '/wp-admin/includes/plugin.php'; |
| [80](#L80) | } |
| [81](#L81) |  |
| [82](#L82) | if (is\_plugin\_active('wp-rocket/wp-rocket.php') && ! is\_admin() ) { |
| [83](#L83) | add\_filter('script\_loader\_tag', array( $this, 'bookingpress\_prevent\_rocket\_loader\_script' ), 10, 2); |
| [84](#L84) | } |
| [85](#L85) |  |
| [86](#L86) | if (! is\_admin() ) { |
| [87](#L87) | add\_filter('script\_loader\_tag', array( $this, 'bookingpress\_prevent\_rocket\_loader\_script\_clf' ), 10, 2); |
| [88](#L88) | add\_filter('script\_loader\_tag', array( $this, 'bookingpress\_prevent\_rocket\_loader\_script\_clf\_advanced' ), 11, 2); |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) | if (is\_plugin\_active('js\_composer/js\_composer.php') && file\_exists(BOOKINGPRESS\_CORE\_DIR . '/vc/bookingpress\_class\_vc\_extend.php') ) { |
| [92](#L92) |  |
| [93](#L93) | include\_once BOOKINGPRESS\_CORE\_DIR . '/vc/bookingpress\_class\_vc\_extend.php'; |
| [94](#L94) |  |
| [95](#L95) | global $bookingpress\_vcextend; |
| [96](#L96) | $bookingpress\_vcextend = new Bookingpress\_VCExtend(); |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | add\_filter('admin\_footer\_text', '\_\_return\_empty\_string', 11); |
| [100](#L100) | add\_filter('update\_footer', '\_\_return\_empty\_string', 11); |
| [101](#L101) | add\_action('admin\_init', array( $this, 'bookingpress\_hide\_update\_notice' ), 1); |
| [102](#L102) |  |
| [103](#L103) | add\_action('bookingpress\_user\_update\_meta', array( $this, 'bookingpress\_user\_update\_meta\_details' ), 10, 2); |
| [104](#L104) |  |
| [105](#L105) | add\_action('wp\_ajax\_bookingpress\_remove\_uploaded\_file', array( $this, 'bookingpress\_remove\_uploaded\_file' ), 10); |
| [106](#L106) |  |
| [107](#L107) | add\_action('deleted\_user', array( $this, 'bookingpress\_after\_deleted\_user\_action' ), 10, 2); |
| [108](#L108) |  |
| [109](#L109) | if (! empty($GLOBALS['wp\_version']) && version\_compare($GLOBALS['wp\_version'], '5.7.2', '>') ) { |
| [110](#L110) | add\_filter('block\_categories\_all', array( $this, 'bookingpress\_gutenberg\_category' ), 10, 2); |
| [111](#L111) | } else { |
| [112](#L112) | add\_filter('block\_categories', array( $this, 'bookingpress\_gutenberg\_category' ), 10, 2); |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | // add\_action('enqueue\_block\_editor\_assets', array( $this, 'bookingpress\_enqueue\_gutenberg\_assets' )); |
| [116](#L116) |  |
| [117](#L117) | add\_action('wp\_ajax\_bookingpress\_get\_help\_data', array( $this, 'bookingpress\_get\_help\_data\_func' )); |
| [118](#L118) |  |
| [119](#L119) | add\_action('admin\_footer', array( $this, 'bookingpress\_admin\_footer\_func' )); |
| [120](#L120) |  |
| [121](#L121) | add\_action('admin\_notices', array( $this, 'bookingpress\_admin\_notices' )); |
| [122](#L122) | add\_action('bookingpress\_payment\_log\_entry', array( $this, 'bookingpress\_write\_payment\_log' ), 10, 6); |
| [123](#L123) |  |
| [124](#L124) | add\_action('wp\_ajax\_bookingpress\_view\_debug\_payment\_log', array( $this, 'bookingpress\_view\_debug\_payment\_log\_func' ), 10); |
| [125](#L125) | add\_action('wp\_ajax\_bookingpress\_lite\_deactivate\_plugin', array( $this, 'bookingpress\_lite\_deactivate\_plugin\_func' )); |
| [126](#L126) | add\_action('wp\_ajax\_bookingpress\_clear\_debug\_payment\_log', array( $this, 'bookingpress\_clear\_debug\_payment\_log\_func' ), 10); |
| [127](#L127) |  |
| [128](#L128) | add\_action('wp\_ajax\_bookingpress\_download\_payment\_log', array( $this, 'bookingpress\_download\_payment\_log\_func' ), 10); |
| [129](#L129) |  |
| [130](#L130) | add\_action('admin\_init', array( $this, 'bookingpress\_debug\_log\_download\_file' )); |
| [131](#L131) |  |
| [132](#L132) | add\_action('admin\_head', array( $this, 'bookingpress\_hide\_admin\_notices' )); |
| [133](#L133) |  |
| [134](#L134) | add\_action('admin\_init', array( $this, 'upgrade\_data' )); |
| [135](#L135) |  |
| [136](#L136) | if($pagenow == "plugins.php"){ |
| [137](#L137) | add\_action('admin\_footer', array( $this, 'bookingpress\_deactivate\_feedback\_popup' )); |
| [138](#L138) | } |
| [139](#L139) |  |
| [140](#L140) | add\_action('wp', array( $this, 'bookingpress\_get\_sysinfo\_func' )); |
| [141](#L141) |  |
| [142](#L142) | add\_action('bookingpress\_other\_debug\_log\_entry', array( $this, 'bookingpress\_other\_debug\_logs\_func' ), 10, 5); |
| [143](#L143) |  |
| [144](#L144) | register\_deactivation\_hook(BOOKINGPRESS\_DIR . '/bookingpress-appointment-booking.php', array( 'BookingPress', 'deactivate\_lite\_version' )); |
| [145](#L145) |  |
| [146](#L146) | add\_action('wp\_ajax\_bookingpress\_dismisss\_admin\_notice', array($this, 'bookingpress\_dismisss\_admin\_notice\_func')); |
| [147](#L147) |  |
| [148](#L148) | add\_action( 'admin\_init', array($this, 'bookingpress\_add\_gutenbergblock' )); |
| [149](#L149) |  |
| [150](#L150) | add\_action('bookingpress\_send\_anonymous\_data',array($this,'bookingpress\_send\_anonymous\_data\_cron')); |
| [151](#L151) |  |
| [152](#L152) | add\_action( 'bookingpress\_cleanup\_transient\_data\_hook', array( $this, 'bookingpress\_cleanup\_transient\_data\_hook\_callback') ); |
| [153](#L153) |  |
| [154](#L154) | //Wizard hooks |
| [155](#L155) | add\_filter('bookingpress\_lite\_wizard\_dynamic\_view\_load', array( $this, 'bookingpress\_load\_wizard\_view\_func'), 10); |
| [156](#L156) | add\_action('bookingpress\_lite\_wizard\_dynamic\_vue\_methods', array( $this, 'bookingpress\_wizard\_vue\_methods\_func')); |
| [157](#L157) | add\_action('bookingpress\_lite\_wizard\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_wizard\_on\_load\_methods\_func')); |
| [158](#L158) | add\_action('bookingpress\_lite\_wizard\_dynamic\_data\_fields', array( $this, 'bookingpress\_wizard\_dynamic\_data\_fields\_func')); |
| [159](#L159) | add\_action('bookingpress\_lite\_wizard\_dynamic\_helper\_vars', array( $this, 'bookingpress\_wizard\_dynamic\_helper\_vars\_func')); |
| [160](#L160) |  |
| [161](#L161) | add\_action('wp\_ajax\_bookingpress\_save\_lite\_wizard\_settings', array($this, 'bookingpress\_save\_lite\_wizard\_settings\_func')); |
| [162](#L162) |  |
| [163](#L163) | add\_action('wp\_ajax\_bookingpress\_lite\_skip\_wizard', array($this, 'bookingpress\_skip\_wizard\_func')); |
| [164](#L164) |  |
| [165](#L165) | add\_action('set\_user\_role', array($this, 'bookingpress\_assign\_caps\_on\_role\_change'), 10, 3); |
| [166](#L166) |  |
| [167](#L167) | add\_filter( 'bpa\_calculate\_default\_break\_hours', array( $this, 'bookingpress\_calculate\_default\_workhours' ), 10, 2 ); |
| [168](#L168) |  |
| [169](#L169) | add\_filter( 'debug\_information', array( $this, 'bpa\_check\_server\_short\_tag\_information') ); |
| [170](#L170) |  |
| [171](#L171) | add\_filter( 'bookingpress\_modify\_update\_transient\_flag', array( $this, 'bookingpress\_modify\_update\_transient\_flag\_func') ); |
| [172](#L172) |  |
| [173](#L173) | } |
| [174](#L174) |  |
| [175](#L175) | function bookingpress\_modify\_update\_transient\_flag\_func( $transient\_flag ){ |
| [176](#L176) |  |
| [177](#L177) | /\*\* Check if the pro plugin is active \*/ |
| [178](#L178) | if( $this->bpa\_is\_pro\_active() ){ |
| [179](#L179) | if( !function\_exists('is\_plugin\_active') ){ |
| [180](#L180) | include ABSPATH . '/wp-admin/includes/plugin.php'; |
| [181](#L181) | } |
| [182](#L182) |  |
| [183](#L183) | if( is\_plugin\_active( 'bookingpress-cart/bookingpress-cart.php' ) ){ |
| [184](#L184) | global $bookingpress\_cart\_version; |
| [185](#L185) | if( version\_compare( $bookingpress\_cart\_version, '3.2', '<' ) ){ |
| [186](#L186) | $transient\_flag = true; |
| [187](#L187) | } |
| [188](#L188) | } |
| [189](#L189) |  |
| [190](#L190) | if( is\_plugin\_active( 'bookingpress-custom-service-duration/bookingpress-custom-service-duration.php' ) ){ |
| [191](#L191) | global $bookingpress\_custom\_service\_duration\_version; |
| [192](#L192) | if( version\_compare( $bookingpress\_custom\_service\_duration\_version, '3.2', '<' ) ){ |
| [193](#L193) | $transient\_flag = true; |
| [194](#L194) | } |
| [195](#L195) | } |
| [196](#L196) |  |
| [197](#L197) | if( is\_plugin\_active( 'bookingpress-recurring-appointments/bookingpress-recurring-appointments.php' ) ){ |
| [198](#L198) | global $recurring\_appointments\_list\_version; |
| [199](#L199) | if( version\_compare( $recurring\_appointments\_list\_version, '1.7', '<' ) ){ |
| [200](#L200) | $transient\_flag = true; |
| [201](#L201) | } |
| [202](#L202) | } |
| [203](#L203) |  |
| [204](#L204) | if( is\_plugin\_active( 'bookingpress-location/bookingpress-location.php' ) ){ |
| [205](#L205) | global $bookingpress\_location\_version; |
| [206](#L206) | if( version\_compare( $bookingpress\_location\_version, '1.6', '<' ) ){ |
| [207](#L207) | $transient\_flag = true; |
| [208](#L208) | } |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | if( version\_compare( $this->bpa\_pro\_plugin\_version(), '3.9.8', '<') ){ |
| [212](#L212) | $transient\_flag = true; |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) | if( false == $transient\_flag && !empty( $\_REQUEST['is\_rescheduling\_event'] ) && ('true' == $\_REQUEST['is\_rescheduling\_event'] || true === $\_REQUEST['is\_rescheduling\_event']) ){ |
| [216](#L216) | $transient\_flag = true; |
| [217](#L217) | } |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | return $transient\_flag; |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | function bpa\_check\_server\_short\_tag\_information( $server\_info ){ |
| [224](#L224) |  |
| [225](#L225) | $server\_info['wp-server']['fields']['php\_short\_tag'] = array( |
| [226](#L226) | 'label' => 'PHP Short Tag', |
| [227](#L227) | 'value' => !empty( ini\_get( 'short\_open\_tag') ) ? esc\_html\_\_( 'Enabled', 'bookingpress-appointment-booking' ) : esc\_html\_\_( 'Disabled', 'bookingpress-appointment-booking' ) |
| [228](#L228) | ); |
| [229](#L229) |  |
| [230](#L230) | return $server\_info; |
| [231](#L231) | } |
| [232](#L232) |  |
| [233](#L233) | function bookingpress\_get\_bf\_sale\_start\_time(){ |
| [234](#L234) |  |
| [235](#L235) | $start\_time = '1731936600'; |
| [236](#L236) |  |
| [237](#L237) | $fetch\_dates\_transient = get\_transient( 'bookingpress\_retrieve\_bf\_sale\_dates' ); |
| [238](#L238) |  |
| [239](#L239) | $current\_year = date('Y', current\_time('timestamp', true) ); |
| [240](#L240) |  |
| [241](#L241) | if( false ===  $fetch\_dates\_transient){ |
| [242](#L242) | $fetch\_url = 'https://bookingpressplugin.com/bpa\_misc/bf\_sale\_dates.json'; |
| [243](#L243) |  |
| [244](#L244) | $fetch\_dates = wp\_remote\_get( $fetch\_url, array( 'timeout' => 4000, 'accept' => 'application/json' ) ); |
| [245](#L245) |  |
| [246](#L246) | if( !is\_wp\_error( $fetch\_dates ) ){ |
| [247](#L247) | $details = wp\_remote\_retrieve\_body( $fetch\_dates ); |
| [248](#L248) | $date\_details = json\_decode( $details, true ); |
| [249](#L249) |  |
| [250](#L250) | set\_transient( 'bookingpress\_retrieve\_bf\_sale\_dates', $date\_details, ( HOUR\_IN\_SECONDS \* 12 ) ); |
| [251](#L251) | } |
| [252](#L252) | } else { |
| [253](#L253) | $date\_details = $fetch\_dates\_transient; |
| [254](#L254) | } |
| [255](#L255) |  |
| [256](#L256) | if( !empty( $date\_details[ $current\_year ] ) ){ |
| [257](#L257) | $start\_time = $date\_details[ $current\_year ]['start\_time']; |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) | return $start\_time; |
| [261](#L261) | } |
| [262](#L262) |  |
| [263](#L263) | function bookingpress\_get\_bf\_sale\_end\_time(){ |
| [264](#L264) |  |
| [265](#L265) | $end\_time = '1733571000'; |
| [266](#L266) |  |
| [267](#L267) | $fetch\_dates\_transient = get\_transient( 'bookingpress\_retrieve\_bf\_sale\_dates' ); |
| [268](#L268) |  |
| [269](#L269) | $current\_year = date('Y', current\_time('timestamp', true) ); |
| [270](#L270) |  |
| [271](#L271) | if( false ===  $fetch\_dates\_transient){ |
| [272](#L272) | $fetch\_url = 'https://bookingpressplugin.com/bpa\_misc/bf\_sale\_dates.json'; |
| [273](#L273) |  |
| [274](#L274) | $fetch\_dates = wp\_remote\_get( $fetch\_url, array( 'timeout' => 4000, 'accept' => 'application/json' ) ); |
| [275](#L275) |  |
| [276](#L276) | if( !is\_wp\_error( $fetch\_dates ) ){ |
| [277](#L277) | $details = wp\_remote\_retrieve\_body( $fetch\_dates ); |
| [278](#L278) | $date\_details = json\_decode( $details, true ); |
| [279](#L279) |  |
| [280](#L280) | set\_transient( 'bookingpress\_retrieve\_bf\_sale\_dates', $date\_details, ( HOUR\_IN\_SECONDS \* 12 ) ); |
| [281](#L281) | } |
| [282](#L282) | } else { |
| [283](#L283) | $date\_details = $fetch\_dates\_transient; |
| [284](#L284) | } |
| [285](#L285) |  |
| [286](#L286) | if( !empty( $date\_data[ $current\_year ] )){ |
| [287](#L287) | $end\_time = $date\_data[ $current\_year ]['end\_time']; |
| [288](#L288) | } |
| [289](#L289) |  |
| [290](#L290) | return $end\_time; |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | /\*\* |
| [294](#L294) | \* Any user role change to administrator from backend then all BookingPress capabilities assign |
| [295](#L295) | \* |
| [296](#L296) | \* @param  mixed $user\_id |
| [297](#L297) | \* @param  mixed $role |
| [298](#L298) | \* @param  mixed $old\_roles |
| [299](#L299) | \* @return void |
| [300](#L300) | \*/ |
| [301](#L301) | function bookingpress\_assign\_caps\_on\_role\_change($user\_id, $role, $old\_roles){ |
| [302](#L302) | global $BookingPress; |
| [303](#L303) | if(!empty($user\_id) && $role == "administrator"){ |
| [304](#L304) | $bookingpressroles = $BookingPress->bookingpress\_capabilities(); |
| [305](#L305) | $userObj = new WP\_User($user\_id); |
| [306](#L306) | foreach ($bookingpressroles as $bookingpress\_role => $bookingpress\_role\_desc) { |
| [307](#L307) | $userObj->add\_cap($bookingpress\_role); |
| [308](#L308) | } |
| [309](#L309) | unset($bookingpress\_role); |
| [310](#L310) | unset($bookingpress\_roles); |
| [311](#L311) | unset($bookingpress\_role\_desc); |
| [312](#L312) | } |
| [313](#L313) | } |
| [314](#L314) |  |
| [315](#L315) | /\*\* |
| [316](#L316) | \* Skip Wizard module at backend |
| [317](#L317) | \* |
| [318](#L318) | \* @return void |
| [319](#L319) | \*/ |
| [320](#L320) | function bookingpress\_skip\_wizard\_func(){ |
| [321](#L321) | global $wpdb, $BookingPress; |
| [322](#L322) | $response              = array(); |
| [323](#L323) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [324](#L324) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [325](#L325) | if (! $bpa\_verify\_nonce\_flag ) { |
| [326](#L326) | $response['variant']        = 'error'; |
| [327](#L327) | $response['title']          = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [328](#L328) | $response['msg']            = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [329](#L329) | echo wp\_json\_encode($response); |
| [330](#L330) | exit; |
| [331](#L331) | } |
| [332](#L332) |  |
| [333](#L333) | update\_option('bookingpress\_lite\_wizard\_complete', 1); |
| [334](#L334) |  |
| [335](#L335) | $response['variant']        = 'success'; |
| [336](#L336) | $response['title']          = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [337](#L337) | $response['msg']            = esc\_html\_\_('Wizard skipped successfully', 'bookingpress-appointment-booking'); |
| [338](#L338) |  |
| [339](#L339) | echo wp\_json\_encode($response); |
| [340](#L340) | exit; |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | /\*\* |
| [344](#L344) | \* Save lite wizard details |
| [345](#L345) | \* |
| [346](#L346) | \* @return void |
| [347](#L347) | \*/ |
| [348](#L348) | function bookingpress\_save\_lite\_wizard\_settings\_func(){ |
| [349](#L349) | global $wpdb, $BookingPress, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customize\_settings; |
| [350](#L350) |  |
| [351](#L351) | $response              = array(); |
| [352](#L352) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [353](#L353) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [354](#L354) | if (! $bpa\_verify\_nonce\_flag ) { |
| [355](#L355) | $response['variant']        = 'error'; |
| [356](#L356) | $response['title']          = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [357](#L357) | $response['msg']            = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [358](#L358) | echo wp\_json\_encode($response); |
| [359](#L359) | exit; |
| [360](#L360) | } |
| [361](#L361) |  |
| [362](#L362) | $is\_wizard\_saved = get\_option( 'bookingpress\_lite\_wizard\_complete' ); |
| [363](#L363) |  |
| [364](#L364) | if( 1 == $is\_wizard\_saved ){ |
| [365](#L365) | return; |
| [366](#L366) | } |
| [367](#L367) |  |
| [368](#L368) | $bookingpress\_wizard\_data = !empty($\_POST['wizard\_data']) ? array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['wizard\_data']) : array(); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [369](#L369) |  |
| [370](#L370) | if(!empty($bookingpress\_wizard\_data)){ |
| [371](#L371) | $bookingpress\_company\_fields\_data = !empty($bookingpress\_wizard\_data['company\_fields\_data']) ? $bookingpress\_wizard\_data['company\_fields\_data'] : array(); |
| [372](#L372) | $bookingpress\_booking\_options = !empty($bookingpress\_wizard\_data['booking\_options']) ? $bookingpress\_wizard\_data['booking\_options'] : array(); |
| [373](#L373) | $bookingpress\_service\_options = !empty($bookingpress\_wizard\_data['service\_options']) ? $bookingpress\_wizard\_data['service\_options'] : array(); |
| [374](#L374) | $bookingpress\_styling\_options = !empty($bookingpress\_wizard\_data['styling\_options']) ? $bookingpress\_wizard\_data['styling\_options'] : array(); |
| [375](#L375) |  |
| [376](#L376) | if(!empty($bookingpress\_company\_fields\_data)){ |
| [377](#L377) | $bookingpress\_logo = $bookingpress\_company\_fields\_data['logo\_img']; |
| [378](#L378) | $bookingpress\_logo\_url = $bookingpress\_company\_fields\_data['logo']; |
| [379](#L379) |  |
| [380](#L380) | if( !empty($bookingpress\_company\_fields\_data['logo\_img']) && !empty($bookingpress\_company\_fields\_data['logo\_img']) ){ |
| [381](#L381) | $bookingpress\_upload\_image\_name = $bookingpress\_logo; |
| [382](#L382) |  |
| [383](#L383) | $upload\_dir                 = BOOKINGPRESS\_UPLOAD\_DIR . '/'; |
| [384](#L384) | $bookingpress\_new\_file\_name = current\_time('timestamp') . '\_' . $bookingpress\_upload\_image\_name; |
| [385](#L385) | $upload\_path                = $upload\_dir . $bookingpress\_new\_file\_name; |
| [386](#L386) |  |
| [387](#L387) | $bookingpress\_upload\_res                        = new bookingpress\_fileupload\_class( $bookingpress\_logo\_url, true ); |
| [388](#L388) | $bookingpress\_upload\_res->check\_cap             = true; |
| [389](#L389) | $bookingpress\_upload\_res->check\_nonce           = true; |
| [390](#L390) | $bookingpress\_upload\_res->nonce\_data            = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [391](#L391) | $bookingpress\_upload\_res->nonce\_action          = 'bpa\_wp\_nonce'; |
| [392](#L392) | $bookingpress\_upload\_res->check\_only\_image   = true; |
| [393](#L393) | $bookingpress\_upload\_res->check\_specific\_ext = false; |
| [394](#L394) | $bookingpress\_upload\_res->allowed\_ext        = array(); |
| [395](#L395) | $upload\_response = $bookingpress\_upload\_res->bookingpress\_process\_upload( $upload\_path ); |
| [396](#L396) |  |
| [397](#L397) | if( true == $upload\_response ){ |
| [398](#L398) | $bookingpress\_file\_name\_arr = explode('/', $bookingpress\_logo\_url); |
| [399](#L399) | $bookingpress\_file\_name     = $bookingpress\_file\_name\_arr[ count($bookingpress\_file\_name\_arr) - 1 ]; |
| [400](#L400) | if( file\_exists( BOOKINGPRESS\_TMP\_IMAGES\_DIR . '/' . $bookingpress\_file\_name ) ){ |
| [401](#L401) | @unlink(BOOKINGPRESS\_TMP\_IMAGES\_DIR . '/' . $bookingpress\_file\_name); |
| [402](#L402) | } |
| [403](#L403) |  |
| [404](#L404) | $bookingpress\_logo\_url = BOOKINGPRESS\_UPLOAD\_URL . '/' . $bookingpress\_new\_file\_name; |
| [405](#L405) | $BookingPress->bookingpress\_update\_settings('company\_avatar\_img', 'company\_setting', $bookingpress\_logo); |
| [406](#L406) | $BookingPress->bookingpress\_update\_settings('company\_avatar\_url', 'company\_setting', $bookingpress\_logo\_url); |
| [407](#L407) | } |
| [408](#L408) | } |
| [409](#L409) |  |
| [410](#L410) | $BookingPress->bookingpress\_update\_settings('company\_name', 'company\_setting', $bookingpress\_company\_fields\_data['company\_name']); |
| [411](#L411) | $BookingPress->bookingpress\_update\_settings('company\_address', 'company\_setting', $bookingpress\_company\_fields\_data['address']); |
| [412](#L412) | $BookingPress->bookingpress\_update\_settings('company\_phone\_country', 'company\_setting', $bookingpress\_company\_fields\_data['country']); |
| [413](#L413) | $BookingPress->bookingpress\_update\_settings('company\_phone\_number', 'company\_setting', $bookingpress\_company\_fields\_data['phone\_no']); |
| [414](#L414) | $BookingPress->bookingpress\_update\_settings('company\_website', 'company\_setting', $bookingpress\_company\_fields\_data['website']); |
| [415](#L415) |  |
| [416](#L416) |  |
| [417](#L417) | $BookingPress->bookingpress\_update\_settings('default\_phone\_country\_code', 'general\_setting', $bookingpress\_company\_fields\_data['country']); |
| [418](#L418) |  |
| [419](#L419) | $BookingPress->bookingpress\_update\_settings('default\_date\_format', 'general\_setting', $bookingpress\_company\_fields\_data['date\_format']); |
| [420](#L420) | $BookingPress->bookingpress\_update\_settings('default\_time\_format', 'general\_setting', $bookingpress\_company\_fields\_data['time\_format']); |
| [421](#L421) |  |
| [422](#L422) | $bookingpress\_anonymous\_data = !empty($bookingpress\_company\_fields\_data['anonymous\_usage']) ? $bookingpress\_company\_fields\_data['anonymous\_usage'] : 'false'; |
| [423](#L423) | if($bookingpress\_anonymous\_data == "true"){ |
| [424](#L424) | $BookingPress->bookingpress\_update\_settings('anonymous\_data', 'general\_setting', 'true'); |
| [425](#L425) | }else{ |
| [426](#L426) | $BookingPress->bookingpress\_update\_settings('anonymous\_data', 'general\_setting', 'false'); |
| [427](#L427) | } |
| [428](#L428) | } |
| [429](#L429) |  |
| [430](#L430) | if(!empty($bookingpress\_booking\_options)){ |
| [431](#L431) | $bookingpress\_days = array('monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday'); |
| [432](#L432) | foreach($bookingpress\_days as $day\_key => $day\_val){ |
| [433](#L433) | $bookingpress\_start\_time = $bookingpress\_booking\_options[$day\_val]['start\_time']; |
| [434](#L434) | $bookingpress\_end\_time = $bookingpress\_booking\_options[$day\_val]['end\_time']; |
| [435](#L435) |  |
| [436](#L436) | if($bookingpress\_start\_time == "off"){ |
| [437](#L437) | $bookingpress\_start\_time = $bookingpress\_end\_time = null; |
| [438](#L438) | }else if($bookingpress\_start\_time == "24:00:00" || $bookingpress\_end\_time == "24:00:00"){ |
| [439](#L439) | if($bookingpress\_start\_time == "24:00:00"){ |
| [440](#L440) | $bookingpress\_start\_time = "00:00:00"; |
| [441](#L441) | } |
| [442](#L442) |  |
| [443](#L443) | if($bookingpress\_end\_time == "24:00:00"){ |
| [444](#L444) | $bookingpress\_end\_time = "00:00:00"; |
| [445](#L445) | } |
| [446](#L446) | } |
| [447](#L447) |  |
| [448](#L448) | $bookingpress\_insert\_workhour\_data = array( |
| [449](#L449) | 'bookingpress\_workday\_key' => $day\_val, |
| [450](#L450) | 'bookingpress\_start\_time'  => $bookingpress\_start\_time, |
| [451](#L451) | 'bookingpress\_end\_time'    => $bookingpress\_end\_time, |
| [452](#L452) | 'bookingpress\_is\_break'    => 0, |
| [453](#L453) | 'bookingpress\_created\_at'  => current\_time('mysql'), |
| [454](#L454) | ); |
| [455](#L455) |  |
| [456](#L456) | $wpdb->update($tbl\_bookingpress\_default\_workhours, $bookingpress\_insert\_workhour\_data, array('bookingpress\_workday\_key' => $day\_val)); |
| [457](#L457) | } |
| [458](#L458) |  |
| [459](#L459) |  |
| [460](#L460) | $bookingpress\_payment\_currency = $bookingpress\_booking\_options['currency']; |
| [461](#L461) | $BookingPress->bookingpress\_update\_settings('payment\_default\_currency', 'payment\_setting', $bookingpress\_payment\_currency); |
| [462](#L462) | } |
| [463](#L463) |  |
| [464](#L464) | if(!empty($bookingpress\_service\_options)){ |
| [465](#L465) | $bookingpress\_service\_fields\_data = !empty($bookingpress\_service\_options['service\_fields\_details']) ? $bookingpress\_service\_options['service\_fields\_details'] : array(); |
| [466](#L466) |  |
| [467](#L467) | if(!empty($bookingpress\_service\_fields\_data)){ |
| [468](#L468) | foreach($bookingpress\_service\_fields\_data as $service\_key => $service\_val){ |
| [469](#L469) | $service\_name = $service\_val['service\_name']; |
| [470](#L470) | $service\_price = floatval($service\_val['price']); |
| [471](#L471) | $duration\_val = $service\_val['duration\_val']; |
| [472](#L472) | $duration\_unit = $service\_val['duration\_unit']; |
| [473](#L473) | $service\_description = $service\_val['description']; |
| [474](#L474) |  |
| [475](#L475) | if(!empty($service\_name) && !empty($service\_price) && !empty($duration\_val) && !empty($duration\_unit)){ |
| [476](#L476) | $service\_pos\_data = $wpdb->get\_row('SELECT \* FROM ' . $tbl\_bookingpress\_services . ' ORDER BY bookingpress\_service\_position DESC LIMIT 1', ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [477](#L477) |  |
| [478](#L478) | $service\_position = 0; |
| [479](#L479) | if (! empty($service\_pos\_data) ) { |
| [480](#L480) | $service\_position = $service\_pos\_data['bookingpress\_service\_position'] + 1; |
| [481](#L481) | } |
| [482](#L482) |  |
| [483](#L483) | $bookingpress\_service\_data = array( |
| [484](#L484) | 'bookingpress\_category\_id' => 0, |
| [485](#L485) | 'bookingpress\_service\_name' => $service\_name, |
| [486](#L486) | 'bookingpress\_service\_price' => $service\_price, |
| [487](#L487) | 'bookingpress\_service\_duration\_val' => $duration\_val, |
| [488](#L488) | 'bookingpress\_service\_duration\_unit' => $duration\_unit, |
| [489](#L489) | 'bookingpress\_service\_description' => $service\_description, |
| [490](#L490) | 'bookingpress\_service\_position' => $service\_position, |
| [491](#L491) | 'bookingpress\_servicedate\_created' => current\_time('mysql'), |
| [492](#L492) | ); |
| [493](#L493) |  |
| [494](#L494) | $wpdb->insert($tbl\_bookingpress\_services, $bookingpress\_service\_data); |
| [495](#L495) | $bookingpress\_service\_id = $wpdb->insert\_id; |
| [496](#L496) | } |
| [497](#L497) | } |
| [498](#L498) | } |
| [499](#L499) | } |
| [500](#L500) |  |
| [501](#L501) | if(!empty($bookingpress\_styling\_options)){ |
| [502](#L502) | $bookingpress\_selected\_fonts = !empty($bookingpress\_styling\_options['font\_family']) ? $bookingpress\_styling\_options['font\_family'] : ''; |
| [503](#L503) | if(!empty($bookingpress\_selected\_fonts)){ |
| [504](#L504) | $bookingpress\_customize\_fields = array( |
| [505](#L505) | 'bookingpress\_setting\_name' => 'title\_font\_family', |
| [506](#L506) | 'bookingpress\_setting\_value' => $bookingpress\_selected\_fonts, |
| [507](#L507) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [508](#L508) | ); |
| [509](#L509) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'title\_font\_family','bookingpress\_setting\_type' => 'booking\_form') ); |
| [510](#L510) | } |
| [511](#L511) |  |
| [512](#L512) | $bookingpress\_primary\_color = !empty($bookingpress\_styling\_options['primary\_color']) ? $bookingpress\_styling\_options['primary\_color'] : ''; |
| [513](#L513) | if(!empty($bookingpress\_primary\_color)){ |
| [514](#L514) | $bookingpress\_customize\_fields = array( |
| [515](#L515) | 'bookingpress\_setting\_name' => 'primary\_color', |
| [516](#L516) | 'bookingpress\_setting\_value' => $bookingpress\_primary\_color, |
| [517](#L517) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [518](#L518) | ); |
| [519](#L519) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'primary\_color','bookingpress\_setting\_type' => 'booking\_form') ); |
| [520](#L520) | } |
| [521](#L521) |  |
| [522](#L522) | $bookingpress\_title\_color = !empty($bookingpress\_styling\_options['title\_color']) ? $bookingpress\_styling\_options['title\_color'] : ''; |
| [523](#L523) | if(!empty($bookingpress\_title\_color)){ |
| [524](#L524) | $bookingpress\_customize\_fields = array( |
| [525](#L525) | 'bookingpress\_setting\_name' => 'label\_title\_color', |
| [526](#L526) | 'bookingpress\_setting\_value' => $bookingpress\_title\_color, |
| [527](#L527) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [528](#L528) | ); |
| [529](#L529) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'label\_title\_color','bookingpress\_setting\_type' => 'booking\_form') ); |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | $bookingpress\_subtitle\_color = !empty($bookingpress\_styling\_options['subtitle\_color']) ? $bookingpress\_styling\_options['subtitle\_color'] : ''; |
| [533](#L533) | if(!empty($bookingpress\_subtitle\_color)){ |
| [534](#L534) | $bookingpress\_customize\_fields = array( |
| [535](#L535) | 'bookingpress\_setting\_name' => 'sub\_title\_color', |
| [536](#L536) | 'bookingpress\_setting\_value' => $bookingpress\_subtitle\_color, |
| [537](#L537) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [538](#L538) | ); |
| [539](#L539) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'sub\_title\_color','bookingpress\_setting\_type' => 'booking\_form') ); |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | $bookingpress\_content\_color = !empty($bookingpress\_styling\_options['content\_color']) ? $bookingpress\_styling\_options['content\_color'] : ''; |
| [543](#L543) | if(!empty($bookingpress\_content\_color)){ |
| [544](#L544) | $bookingpress\_customize\_fields = array( |
| [545](#L545) | 'bookingpress\_setting\_name' => 'content\_color', |
| [546](#L546) | 'bookingpress\_setting\_value' => $bookingpress\_content\_color, |
| [547](#L547) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [548](#L548) | ); |
| [549](#L549) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'content\_color','bookingpress\_setting\_type' => 'booking\_form') ); |
| [550](#L550) | } |
| [551](#L551) | $bookingpress\_primary\_background\_color = !empty($bookingpress\_styling\_options['primary\_background\_color']) ? $bookingpress\_styling\_options['primary\_background\_color'] : '#e2faf1'; |
| [552](#L552) | if(!empty($bookingpress\_content\_color)){ |
| [553](#L553) | $bookingpress\_customize\_fields = array( |
| [554](#L554) | 'bookingpress\_setting\_name' => 'primary\_background\_color', |
| [555](#L555) | 'bookingpress\_setting\_value' => $bookingpress\_primary\_background\_color, |
| [556](#L556) | 'bookingpress\_setting\_type' => 'booking\_form', |
| [557](#L557) | ); |
| [558](#L558) | $wpdb->update($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_fields, array( 'bookingpress\_setting\_name' => 'primary\_background\_color','bookingpress\_setting\_type' => 'booking\_form') ); |
| [559](#L559) | } |
| [560](#L560) |  |
| [561](#L561) | $bookingpress\_background\_color = $BookingPress->bookingpress\_get\_customize\_settings('background\_color', 'booking\_form'); |
| [562](#L562) | $bookingpress\_footer\_background\_color = $BookingPress->bookingpress\_get\_customize\_settings('footer\_background\_color', 'booking\_form'); |
| [563](#L563) | $bookingpress\_primary\_color = $BookingPress->bookingpress\_get\_customize\_settings('primary\_color', 'booking\_form'); |
| [564](#L564) | $bookingpress\_content\_color = $BookingPress->bookingpress\_get\_customize\_settings('content\_color', 'booking\_form'); |
| [565](#L565) | $bookingpress\_label\_title\_color = $BookingPress->bookingpress\_get\_customize\_settings('label\_title\_color', 'booking\_form'); |
| [566](#L566) | $bookingpress\_title\_font\_family = $BookingPress->bookingpress\_get\_customize\_settings('title\_font\_family', 'booking\_form'); |
| [567](#L567) | $bookingpress\_sub\_title\_color = $BookingPress->bookingpress\_get\_customize\_settings('sub\_title\_color', 'booking\_form'); |
| [568](#L568) | $bookingpress\_price\_button\_text\_color = $BookingPress->bookingpress\_get\_customize\_settings('price\_button\_text\_color', 'booking\_form'); |
| [569](#L569) | $bookingpress\_border\_color = $BookingPress->bookingpress\_get\_customize\_settings('border\_color', 'booking\_form'); |
| [570](#L570) |  |
| [571](#L571) | $bookingpress\_background\_color = !empty($bookingpress\_background\_color) ? $bookingpress\_background\_color : '#fff'; |
| [572](#L572) | $bookingpress\_footer\_background\_color = !empty($bookingpress\_footer\_background\_color) ? $bookingpress\_footer\_background\_color : '#f4f7fb'; |
| [573](#L573) | $bookingpress\_primary\_color = !empty($bookingpress\_primary\_color) ? $bookingpress\_primary\_color : '#12D488'; |
| [574](#L574) | $bookingpress\_content\_color = !empty($bookingpress\_content\_color) ? $bookingpress\_content\_color : '#727E95'; |
| [575](#L575) | $bookingpress\_label\_title\_color = !empty($bookingpress\_label\_title\_color) ? $bookingpress\_label\_title\_color : '#202C45'; |
| [576](#L576) | $bookingpress\_title\_font\_family = !empty($bookingpress\_title\_font\_family) ? $bookingpress\_title\_font\_family : ''; |
| [577](#L577) | $bookingpress\_sub\_title\_color = !empty($bookingpress\_sub\_title\_color) ? $bookingpress\_sub\_title\_color : '#535D71'; |
| [578](#L578) | $bookingpress\_price\_button\_text\_color = !empty($bookingpress\_price\_button\_text\_color) ? $bookingpress\_price\_button\_text\_color : '#fff'; |
| [579](#L579) | $bookingpress\_border\_color = !empty($bookingpress\_border\_color) ? $bookingpress\_border\_color : '#CFD6E5'; |
| [580](#L580) |  |
| [581](#L581) |  |
| [582](#L582) |  |
| [583](#L583) | $bookingpress\_custom\_data\_arr['action'][] = 'bookingpress\_save\_my\_booking\_settings'; |
| [584](#L584) | $bookingpress\_custom\_data\_arr['action'][] = 'bookingpress\_save\_booking\_form\_settings'; |
| [585](#L585) | $my\_booking\_form = array( |
| [586](#L586) | 'background\_color' => $bookingpress\_background\_color, |
| [587](#L587) | 'row\_background\_color' => $bookingpress\_footer\_background\_color, |
| [588](#L588) | 'primary\_color' => $bookingpress\_primary\_color, |
| [589](#L589) | 'content\_color' => $bookingpress\_content\_color, |
| [590](#L590) | 'label\_title\_color' => $bookingpress\_label\_title\_color, |
| [591](#L591) | 'title\_font\_family' => $bookingpress\_title\_font\_family, |
| [592](#L592) | 'sub\_title\_color'   => $bookingpress\_sub\_title\_color, |
| [593](#L593) | 'price\_button\_text\_color' => $bookingpress\_price\_button\_text\_color, |
| [594](#L594) | 'border\_color'      => $bookingpress\_border\_color, |
| [595](#L595) | ); |
| [596](#L596) |  |
| [597](#L597) | $booking\_form = array( |
| [598](#L598) | 'background\_color' => $bookingpress\_background\_color, |
| [599](#L599) | 'footer\_background\_color' => $bookingpress\_footer\_background\_color, |
| [600](#L600) | 'primary\_color' => $bookingpress\_primary\_color, |
| [601](#L601) | 'primary\_background\_color'=> $bookingpress\_primary\_background\_color, |
| [602](#L602) | 'label\_title\_color' => $bookingpress\_label\_title\_color, |
| [603](#L603) | 'title\_font\_family' => $bookingpress\_title\_font\_family, |
| [604](#L604) | 'content\_color' => $bookingpress\_content\_color, |
| [605](#L605) | 'price\_button\_text\_color' => $bookingpress\_price\_button\_text\_color, |
| [606](#L606) | 'sub\_title\_color' => $bookingpress\_sub\_title\_color, |
| [607](#L607) | 'border\_color'      => $bookingpress\_border\_color, |
| [608](#L608) | ); |
| [609](#L609) | $bookingpress\_custom\_data\_arr['booking\_form'] = $booking\_form; |
| [610](#L610) | $bookingpress\_custom\_data\_arr['my\_booking\_form'] = $my\_booking\_form; |
| [611](#L611) | $BookingPress->bookingpress\_generate\_customize\_css\_func($bookingpress\_custom\_data\_arr); |
| [612](#L612) | } |
| [613](#L613) |  |
| [614](#L614) | update\_option('bookingpress\_lite\_wizard\_complete', 1); |
| [615](#L615) |  |
| [616](#L616) | $response['variant']        = 'success'; |
| [617](#L617) | $response['title']          = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [618](#L618) | $response['msg']            = esc\_html\_\_('Data saved successfully', 'bookingpress-appointment-booking'); |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | echo wp\_json\_encode($response); |
| [622](#L622) | exit; |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | /\*\* |
| [626](#L626) | \* Load wizard view file |
| [627](#L627) | \* |
| [628](#L628) | \* @return void |
| [629](#L629) | \*/ |
| [630](#L630) | function bookingpress\_load\_wizard\_view\_func(){ |
| [631](#L631) | $bookingpress\_load\_file\_name = BOOKINGPRESS\_VIEWS\_DIR . '/wizard/manage\_wizard.php'; |
| [632](#L632) | require $bookingpress\_load\_file\_name; |
| [633](#L633) | } |
| [634](#L634) |  |
| [635](#L635) | /\*\* |
| [636](#L636) | \* Wizard methods / functions |
| [637](#L637) | \* |
| [638](#L638) | \* @return void |
| [639](#L639) | \*/ |
| [640](#L640) | function bookingpress\_wizard\_vue\_methods\_func(){ |
| [641](#L641) | global $bookingpress\_notification\_duration; |
| [642](#L642) | ?> |
| [643](#L643) | bookingpress\_upload\_company\_avatar\_func(response, file, fileList){ |
| [644](#L644) | const vm2 = this |
| [645](#L645) | if(response != ''){ |
| [646](#L646) | vm2.wizard\_steps\_data.company\_fields\_data.logo = response.upload\_url |
| [647](#L647) | vm2.wizard\_steps\_data.company\_fields\_data.logo\_img = response.upload\_file\_name |
| [648](#L648) | } |
| [649](#L649) | }, |
| [650](#L650) | bookingpress\_company\_avatar\_upload\_limit(files, fileList){ |
| [651](#L651) | const vm2 = this |
| [652](#L652) | if(files.length >= 1){ |
| [653](#L653) | vm2.$notify({ |
| [654](#L654) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [655](#L655) | message: '<?php esc\_html\_e('Multiple files not allowed', 'bookingpress-appointment-booking'); ?>', |
| [656](#L656) | type: 'error', |
| [657](#L657) | customClass: 'error\_notification', |
| [658](#L658) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [659](#L659) | }); |
| [660](#L660) | } |
| [661](#L661) | }, |
| [662](#L662) | checkUploadedFile(file){ |
| [663](#L663) | const vm2 = this |
| [664](#L664) | if(file.type != 'image/jpeg' && file.type != 'image/png' && file.type != 'image/webp'){ |
| [665](#L665) | vm2.$notify({ |
| [666](#L666) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [667](#L667) | message: '<?php esc\_html\_e('Please upload jpg/png file only', 'bookingpress-appointment-booking'); ?>', |
| [668](#L668) | type: 'error', |
| [669](#L669) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [670](#L670) | }); |
| [671](#L671) | return false |
| [672](#L672) | }else{ |
| [673](#L673) | var bpa\_image\_size = parseInt(file.size / 1000000); |
| [674](#L674) | if(bpa\_image\_size > 1){ |
| [675](#L675) | vm2.$notify({ |
| [676](#L676) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [677](#L677) | message: '<?php esc\_html\_e('Please upload maximum 1 MB file only', 'bookingpress-appointment-booking'); ?>', |
| [678](#L678) | type: 'error', |
| [679](#L679) | customClass: 'error\_notification', |
| [680](#L680) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [681](#L681) | }); |
| [682](#L682) | return false |
| [683](#L683) | } |
| [684](#L684) | } |
| [685](#L685) | }, |
| [686](#L686) | bookingpress\_company\_avatar\_upload\_err(err, file, fileList){ |
| [687](#L687) | const vm2 = this |
| [688](#L688) | var bookingpress\_err\_msg = '<?php esc\_html\_e('Something went wrong', 'bookingpress-appointment-booking'); ?>'; |
| [689](#L689) | if(err != '' || err != undefined){ |
| [690](#L690) | bookingpress\_err\_msg = err |
| [691](#L691) | } |
| [692](#L692) | vm2.$notify({ |
| [693](#L693) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [694](#L694) | message: bookingpress\_err\_msg, |
| [695](#L695) | type: 'error', |
| [696](#L696) | customClass: 'error\_notification', |
| [697](#L697) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [698](#L698) | }); |
| [699](#L699) | }, |
| [700](#L700) | bookingpress\_remove\_company\_avatar(){ |
| [701](#L701) | const vm = this |
| [702](#L702) | var upload\_url = vm.wizard\_steps\_data.company\_fields\_data.logo |
| [703](#L703) | var upload\_filename = vm.wizard\_steps\_data.company\_fields\_data.logo\_img |
| [704](#L704) |  |
| [705](#L705) | var postData = { action:'bookingpress\_remove\_uploaded\_file',upload\_file\_url: upload\_url,\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [706](#L706) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [707](#L707) | .then( function (response) { |
| [708](#L708) | vm.wizard\_steps\_data.company\_fields\_data.logo = '' |
| [709](#L709) | vm.wizard\_steps\_data.company\_fields\_data.logo\_img = '' |
| [710](#L710) | vm.$refs.avatarRef.clearFiles() |
| [711](#L711) | }.bind(vm) ) |
| [712](#L712) | .catch( function (error) { |
| [713](#L713) | console.log(error); |
| [714](#L714) | }); |
| [715](#L715) | }, |
| [716](#L716) | bookingpress\_add\_service(){ |
| [717](#L717) | const vm = this |
| [718](#L718) | var bookingpress\_default\_obj = vm.wizard\_steps\_data.service\_options.service\_details[0]; |
| [719](#L719) | vm.wizard\_steps\_data.service\_options.service\_details.push(bookingpress\_default\_obj); |
| [720](#L720) | vm.wizard\_steps\_data.service\_options.service\_fields\_details.push({service\_name: '', price: '', duration\_val: '30', duration\_unit: 'm', description: ''}); |
| [721](#L721) | }, |
| [722](#L722) | bpa\_remove\_service(remove\_index){ |
| [723](#L723) | const vm = this |
| [724](#L724) | vm.wizard\_steps\_data.service\_options.service\_details.splice(remove\_index, 1) |
| [725](#L725) | }, |
| [726](#L726) | bookingpress\_previous\_tab(current\_tab){ |
| [727](#L727) | const vm = this |
| [728](#L728) | if(current\_tab == "booking\_options"){ |
| [729](#L729) | vm.bookingpress\_active\_tab = 'company\_settings'; |
| [730](#L730) | }else if(current\_tab == "service\_options"){ |
| [731](#L731) | vm.bookingpress\_active\_tab = 'booking\_options'; |
| [732](#L732) | }else if(current\_tab == "styling\_options"){ |
| [733](#L733) | vm.bookingpress\_active\_tab = 'service\_options'; |
| [734](#L734) | }else if(current\_tab == "final\_step"){ |
| [735](#L735) | vm.bookingpress\_active\_tab = 'styling\_options'; |
| [736](#L736) | } |
| [737](#L737) | }, |
| [738](#L738) | bookingpress\_next\_tab(current\_tab){ |
| [739](#L739) | const vm = this |
| [740](#L740) | if(current\_tab == "company\_settings"){ |
| [741](#L741) | vm.bookingpress\_active\_tab = 'booking\_options'; |
| [742](#L742) | }else if(current\_tab == "booking\_options"){ |
| [743](#L743) | vm.bookingpress\_active\_tab = 'service\_options'; |
| [744](#L744) | }else if(current\_tab == "service\_options"){ |
| [745](#L745) | vm.bookingpress\_active\_tab = 'styling\_options'; |
| [746](#L746) | }else if(current\_tab == "styling\_options"){ |
| [747](#L747) | vm.bookingpress\_last\_step\_disabled = false; |
| [748](#L748) | vm.bookingpress\_active\_tab = 'final\_step'; |
| [749](#L749) | vm.final\_step\_loader = '1'; |
| [750](#L750) | var postData = []; |
| [751](#L751) | postData.action = 'bookingpress\_save\_lite\_wizard\_settings' |
| [752](#L752) | postData.wizard\_data = vm.wizard\_steps\_data |
| [753](#L753) | postData.\_wpnonce = '<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' |
| [754](#L754) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [755](#L755) | .then( function (response) { |
| [756](#L756) | if(response.data.variant != 'error'){ |
| [757](#L757) | vm.final\_step\_loader = '0'; |
| [758](#L758) | }else{ |
| [759](#L759) | console.log(response.data.msg); |
| [760](#L760) | } |
| [761](#L761) | }.bind(this) ) |
| [762](#L762) | .catch( function (error) { |
| [763](#L763) | vm.$notify({ |
| [764](#L764) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [765](#L765) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [766](#L766) | type: 'error', |
| [767](#L767) | customClass: 'error\_notification', |
| [768](#L768) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [769](#L769) | }); |
| [770](#L770) | }); |
| [771](#L771) | } |
| [772](#L772) | }, |
| [773](#L773) | bookingpress\_copy\_content(copy\_data){ |
| [774](#L774) | const vm = this; |
| [775](#L775) | var bookingpress\_selected\_placholder = copy\_data; |
| [776](#L776) | var bookingpress\_dummy\_elem = document.createElement("textarea"); |
| [777](#L777) | document.body.appendChild(bookingpress\_dummy\_elem); |
| [778](#L778) | bookingpress\_dummy\_elem.value = bookingpress\_selected\_placholder; |
| [779](#L779) | bookingpress\_dummy\_elem.select(); |
| [780](#L780) | document.execCommand("copy"); |
| [781](#L781) | document.body.removeChild(bookingpress\_dummy\_elem); |
| [782](#L782) | vm.$notify( |
| [783](#L783) | { |
| [784](#L784) | title: '<?php esc\_html\_e('Success', 'bookingpress-appointment-booking'); ?>', |
| [785](#L785) | message: '<?php echo esc\_html\_e('Text copied successfully.','bookingpress-appointment-booking'); ?>', |
| [786](#L786) | type: 'success', |
| [787](#L787) | customClass: 'success\_notification', |
| [788](#L788) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [789](#L789) | }); |
| [790](#L790) | }, |
| [791](#L791) | bookingpress\_skip\_wizard(){ |
| [792](#L792) | var postData = []; |
| [793](#L793) | postData.action = 'bookingpress\_lite\_skip\_wizard' |
| [794](#L794) | postData.\_wpnonce = '<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' |
| [795](#L795) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [796](#L796) | .then( function (response) { |
| [797](#L797) | if(response.data.variant != 'error'){ |
| [798](#L798) | window.location.href = '<?php echo esc\_html(admin\_url() . 'admin.php?page=bookingpress'); ?>'; |
| [799](#L799) | }else{ |
| [800](#L800) | console.log(response.data.msg); |
| [801](#L801) | } |
| [802](#L802) | }.bind(this) ) |
| [803](#L803) | .catch( function (error) { |
| [804](#L804) | vm.$notify({ |
| [805](#L805) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [806](#L806) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [807](#L807) | type: 'error', |
| [808](#L808) | customClass: 'error\_notification', |
| [809](#L809) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [810](#L810) | }); |
| [811](#L811) | }); |
| [812](#L812) | }, |
| [813](#L813) | bookingpress\_generate\_alpha\_color(selected\_color){ |
| [814](#L814) | const vm = this |
| [815](#L815) | var opacity\_color = Math.round(Math.min(Math.max(0.12 || 1, 0), 1) \* 255); |
| [816](#L816) | var primary\_background\_color = selected\_color+(opacity\_color.toString(16).toUpperCase()) |
| [817](#L817) | vm.wizard\_steps\_data.styling\_options.primary\_background\_color = primary\_background\_color |
| [818](#L818) | }, |
| [819](#L819) | bookingpress\_set\_workhour\_value\_wizard(worktime,work\_hour\_day){ |
| [820](#L820) | const vm = this |
| [821](#L821) | if(vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time == 'off') { |
| [822](#L822) | vm.working\_hours\_arr.forEach(function(currentValue, index, arr){ |
| [823](#L823) | if(currentValue.start\_time == worktime) { |
| [824](#L824) | vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time = arr[index]['end\_time'] ; |
| [825](#L825) | } |
| [826](#L826) | }); |
| [827](#L827) | } |
| [828](#L828) | else if(worktime >= vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time ) { |
| [829](#L829) | vm.working\_hours\_arr.forEach(function(currentValue, index, arr){ |
| [830](#L830) | if(currentValue.start\_time == worktime) { |
| [831](#L831) | vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time = arr[index]['end\_time'] ; |
| [832](#L832) | } |
| [833](#L833) | }); |
| [834](#L834) | } |
| [835](#L835) | else if(worktime != 'off' && vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time == undefined) { |
| [836](#L836) | vm.working\_hours\_arr.forEach(function(currentValue, index, arr){ |
| [837](#L837) | if(currentValue.start\_time == worktime) { |
| [838](#L838) | vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time = arr[index]['end\_time'] ; |
| [839](#L839) | } |
| [840](#L840) | }); |
| [841](#L841) | } |
| [842](#L842) | / \* vm.wizard\_steps\_data.booking\_options[work\_hour\_day].end\_time \*/ |
| [843](#L843) | }, |
| [844](#L844) | bookingpress\_check\_workhour\_value\_wizard(workhour\_time,work\_hour\_day) { |
| [845](#L845) | if(workhour\_time == 'off') { |
| [846](#L846) | const vm = this |
| [847](#L847) | vm.wizard\_steps\_data.booking\_options[work\_hour\_day].start\_time = 'off'; |
| [848](#L848) | } |
| [849](#L849) | }, |
| [850](#L850) | <?php |
| [851](#L851) | } |
| [852](#L852) |  |
| [853](#L853) | /\*\* |
| [854](#L854) | \* Wizard onload methods |
| [855](#L855) | \* |
| [856](#L856) | \* @return void |
| [857](#L857) | \*/ |
| [858](#L858) | function bookingpress\_wizard\_on\_load\_methods\_func(){ |
| [859](#L859) | ?> |
| [860](#L860) | document.body.classList.add('bpa-fullscreen-wizard-setup-container'); |
| [861](#L861) | <?php |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) | /\*\* |
| [865](#L865) | \* Wizard module data variables |
| [866](#L866) | \* |
| [867](#L867) | \* @return void |
| [868](#L868) | \*/ |
| [869](#L869) | function bookingpress\_wizard\_dynamic\_data\_fields\_func(){ |
| [870](#L870) | global $bookingpress\_lite\_wizard\_vue\_data\_fields, $bookingpress\_global\_options; |
| [871](#L871) |  |
| [872](#L872) | $bookingpress\_lite\_wizard\_vue\_data\_fields = array(); |
| [873](#L873) |  |
| [874](#L874) | $bookingpress\_lite\_wizard\_vue\_data\_fields['bookingpress\_active\_tab'] = 'company\_settings'; |
| [875](#L875) | $bookingpress\_lite\_wizard\_vue\_data\_fields['bookingpress\_last\_step\_disabled'] = true; |
| [876](#L876) | $bookingpress\_lite\_wizard\_vue\_data\_fields['bookingpress\_disabled\_tabs'] = true; |
| [877](#L877) |  |
| [878](#L878) | $bookingpress\_options                    = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [879](#L879) |  |
| [880](#L880) | $bookingpress\_country\_list               = $bookingpress\_options['country\_lists']; |
| [881](#L881) | $bookingpress\_lite\_wizard\_vue\_data\_fields['phone\_countries\_details'] = json\_decode($bookingpress\_country\_list); |
| [882](#L882) |  |
| [883](#L883) | $bookingpress\_lite\_wizard\_vue\_data\_fields['comShowFileList'] = false; |
| [884](#L884) |  |
| [885](#L885) | $bookingpress\_default\_time\_format = $bookingpress\_options['wp\_default\_time\_format']; |
| [886](#L886) |  |
| [887](#L887) | $bookingpress\_workhours\_arr = array(); |
| [888](#L888) | $bookingpress\_workhours\_arr[] = array( |
| [889](#L889) | 'start\_time' => 'off', |
| [890](#L890) | 'end\_time' => 'off', |
| [891](#L891) | 'formatted\_start\_time' => esc\_html\_\_('Off', 'bookingpress-appointment-booking'), |
| [892](#L892) | 'formatted\_end\_time' => esc\_html\_\_('Off', 'bookingpress-appointment-booking'), |
| [893](#L893) | ); |
| [894](#L894) | $default\_start\_time      = '00:00:00'; |
| [895](#L895) | $default\_end\_time        = '23:55:00'; |
| [896](#L896) | $step\_duration\_val       = 5; |
| [897](#L897) | do{ |
| [898](#L898) | $tmp\_start\_time = $default\_start\_time; |
| [899](#L899) |  |
| [900](#L900) | $tmp\_time\_obj = new DateTime($tmp\_start\_time); |
| [901](#L901) | $tmp\_time\_obj->add(new DateInterval('PT' . $step\_duration\_val . 'M')); |
| [902](#L902) | $tmp\_end\_time = $tmp\_time\_obj->format('H:i:s'); |
| [903](#L903) |  |
| [904](#L904) | if($tmp\_end\_time == "00:00:00"){ |
| [905](#L905) | $tmp\_end\_time = "24:00:00"; |
| [906](#L906) | } |
| [907](#L907) |  |
| [908](#L908) | $bookingpress\_workhours\_arr[] = array( |
| [909](#L909) | 'start\_time' => $tmp\_start\_time, |
| [910](#L910) | 'end\_time' => $tmp\_end\_time, |
| [911](#L911) | 'formatted\_start\_time' => date($bookingpress\_default\_time\_format, strtotime($tmp\_start\_time)), |
| [912](#L912) | 'formatted\_end\_time' => date($bookingpress\_default\_time\_format, strtotime($tmp\_end\_time))." ".($tmp\_end\_time == "24:00:00" ? esc\_html\_\_('Next Day', 'bookingpress-appointment-booking') : '' ), |
| [913](#L913) | ); |
| [914](#L914) |  |
| [915](#L915) | if($tmp\_end\_time == "24:00:00"){ |
| [916](#L916) | break; |
| [917](#L917) | } |
| [918](#L918) |  |
| [919](#L919) | $default\_start\_time = $tmp\_end\_time; |
| [920](#L920) | }while($default\_start\_time <= $default\_end\_time); |
| [921](#L921) |  |
| [922](#L922) | $bookingpress\_lite\_wizard\_vue\_data\_fields['working\_hours\_arr'] = $bookingpress\_workhours\_arr; |
| [923](#L923) |  |
| [924](#L924) | $bookingpress\_countries\_currency\_details = json\_decode($bookingpress\_options['countries\_json\_details']); |
| [925](#L925) | $bookingpress\_lite\_wizard\_vue\_data\_fields['bookingpress\_currency\_options'] = $bookingpress\_countries\_currency\_details; |
| [926](#L926) |  |
| [927](#L927) | $bookingpress\_inherit\_fonts\_list = array('Inherit Fonts',); |
| [928](#L928) | $bookingpress\_default\_fonts\_list = $bookingpress\_global\_options->bookingpress\_get\_default\_fonts(); |
| [929](#L929) | $bookingpress\_google\_fonts\_list  = $bookingpress\_global\_options->bookingpress\_get\_google\_fonts(); |
| [930](#L930) | $bookingpress\_fonts\_list         = array( |
| [931](#L931) | array( |
| [932](#L932) | 'label'   => esc\_html\_\_('Inherit Fonts', 'bookingpress-appointment-booking'), |
| [933](#L933) | 'options' => $bookingpress\_inherit\_fonts\_list, |
| [934](#L934) | ), |
| [935](#L935) | array( |
| [936](#L936) | 'label'   => esc\_html\_\_('Default Fonts', 'bookingpress-appointment-booking'), |
| [937](#L937) | 'options' => $bookingpress\_default\_fonts\_list, |
| [938](#L938) | ), |
| [939](#L939) | array( |
| [940](#L940) | 'label'   => esc\_html\_\_('Google Fonts', 'bookingpress-appointment-booking'), |
| [941](#L941) | 'options' => $bookingpress\_google\_fonts\_list, |
| [942](#L942) | ), |
| [943](#L943) | ); |
| [944](#L944) | $bookingpress\_lite\_wizard\_vue\_data\_fields['fonts\_list'] = $bookingpress\_fonts\_list; |
| [945](#L945) |  |
| [946](#L946) | $bookingpress\_lite\_wizard\_vue\_data\_fields['final\_step\_loader'] = '1'; |
| [947](#L947) |  |
| [948](#L948) | $default\_phone\_country\_code = $this->bookingpress\_get\_settings('default\_phone\_country\_code','general\_setting'); |
| [949](#L949) |  |
| [950](#L950) | $bookingpress\_lite\_wizard\_vue\_data\_fields['wizard\_steps\_data'] = array( |
| [951](#L951) | 'company\_fields\_data' => array( |
| [952](#L952) | 'company\_name' => '', |
| [953](#L953) | 'address' => '', |
| [954](#L954) | 'time\_format' => 'g:i a', |
| [955](#L955) | 'date\_format' => 'F j, Y', |
| [956](#L956) | 'country' => $default\_phone\_country\_code, |
| [957](#L957) | 'phone\_no' => '', |
| [958](#L958) | 'website' => '', |
| [959](#L959) | 'logo' => '', |
| [960](#L960) | 'logo\_img' => '', |
| [961](#L961) | 'logo\_list' => '', |
| [962](#L962) | 'anonymous\_usage' => true, |
| [963](#L963) | ), |
| [964](#L964) | 'booking\_options' => array( |
| [965](#L965) | 'monday' => array( |
| [966](#L966) | 'start\_time' => '09:00:00', |
| [967](#L967) | 'end\_time' => '17:00:00', |
| [968](#L968) | ), |
| [969](#L969) | 'tuesday' => array( |
| [970](#L970) | 'start\_time' => '09:00:00', |
| [971](#L971) | 'end\_time' => '17:00:00', |
| [972](#L972) | ), |
| [973](#L973) | 'wednesday' => array( |
| [974](#L974) | 'start\_time' => '09:00:00', |
| [975](#L975) | 'end\_time' => '17:00:00', |
| [976](#L976) | ), |
| [977](#L977) | 'thursday' => array( |
| [978](#L978) | 'start\_time' => '09:00:00', |
| [979](#L979) | 'end\_time' => '17:00:00', |
| [980](#L980) | ), |
| [981](#L981) | 'friday' => array( |
| [982](#L982) | 'start\_time' => '09:00:00', |
| [983](#L983) | 'end\_time' => '17:00:00', |
| [984](#L984) | ), |
| [985](#L985) | 'saturday' => array( |
| [986](#L986) | 'start\_time' => 'off', |
| [987](#L987) | 'end\_time' => 'off', |
| [988](#L988) | ), |
| [989](#L989) | 'sunday' => array( |
| [990](#L990) | 'start\_time' => 'off', |
| [991](#L991) | 'end\_time' => 'off', |
| [992](#L992) | ), |
| [993](#L993) | 'currency' => 'USD', |
| [994](#L994) | ), |
| [995](#L995) | 'service\_options' => array( |
| [996](#L996) | 'service\_details' => array( |
| [997](#L997) | array( |
| [998](#L998) | 'service\_name\_label' => esc\_html\_\_('Service Name', 'bookingpress-appointment-booking'), |
| [999](#L999) | 'price\_label' => esc\_html\_\_('Price', 'bookingpress-appointment-booking'), |
| [1000](#L1000) | 'duration\_label' => esc\_html\_\_('Duration', 'bookingpress-appointment-booking'), |
| [1001](#L1001) | 'description\_label' => esc\_html\_\_('Description', 'bookingpress-appointment-booking'), |
| [1002](#L1002) | ), |
| [1003](#L1003) | ), |
| [1004](#L1004) | 'service\_fields\_details' => array( |
| [1005](#L1005) | array( |
| [1006](#L1006) | 'service\_name' => '', |
| [1007](#L1007) | 'price' => '', |
| [1008](#L1008) | 'duration\_val' => '30', |
| [1009](#L1009) | 'duration\_unit' => 'm', |
| [1010](#L1010) | 'description' => '', |
| [1011](#L1011) | ), |
| [1012](#L1012) | ), |
| [1013](#L1013) | ), |
| [1014](#L1014) | 'styling\_options' => array( |
| [1015](#L1015) | 'font\_family' => 'Poppins', |
| [1016](#L1016) | 'primary\_color' => '#12D488', |
| [1017](#L1017) | 'primary\_background\_color' => '#e2faf1', |
| [1018](#L1018) | 'title\_color' => '#202C45', |
| [1019](#L1019) | 'subtitle\_color' => '#535D71', |
| [1020](#L1020) | 'content\_color' => '#727E95', |
| [1021](#L1021) | ), |
| [1022](#L1022) | ); |
| [1023](#L1023) |  |
| [1024](#L1024) | echo wp\_json\_encode($bookingpress\_lite\_wizard\_vue\_data\_fields); |
| [1025](#L1025) | } |
| [1026](#L1026) |  |
| [1027](#L1027) | /\*\* |
| [1028](#L1028) | \* Wizard module helper variables |
| [1029](#L1029) | \* |
| [1030](#L1030) | \* @return void |
| [1031](#L1031) | \*/ |
| [1032](#L1032) | function bookingpress\_wizard\_dynamic\_helper\_vars\_func(){ |
| [1033](#L1033) | global $bookingpress\_global\_options; |
| [1034](#L1034) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [1035](#L1035) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [1036](#L1036) | ?> |
| [1037](#L1037) | var lang = ELEMENT.lang.<?php echo esc\_html( $bookingpress\_locale\_lang ); ?>; |
| [1038](#L1038) | ELEMENT.locale(lang); |
| [1039](#L1039) | <?php |
| [1040](#L1040) | } |
| [1041](#L1041) |  |
| [1042](#L1042) |  |
| [1043](#L1043) |  |
| [1044](#L1044) | /\*\* |
| [1045](#L1045) | \* Add gutenberg blocks |
| [1046](#L1046) | \* |
| [1047](#L1047) | \* @return void |
| [1048](#L1048) | \*/ |
| [1049](#L1049) | function bookingpress\_add\_gutenbergblock() { |
| [1050](#L1050) | register\_block\_type( BOOKINGPRESS\_DIR . '/js/build/bookingform' ); |
| [1051](#L1051) | register\_block\_type( BOOKINGPRESS\_DIR . '/js/build/mybooking' ); |
| [1052](#L1052) | } |
| [1053](#L1053) |  |
| [1054](#L1054) |  |
| [1055](#L1055) | /\*\* |
| [1056](#L1056) | \* Dismiss admin notice |
| [1057](#L1057) | \* |
| [1058](#L1058) | \* @return void |
| [1059](#L1059) | \*/ |
| [1060](#L1060) | function bookingpress\_dismisss\_admin\_notice\_func(){ |
| [1061](#L1061) | update\_option('bookingpress\_customize\_changes\_notice', 1); |
| [1062](#L1062) | update\_option('bookingpress\_customize\_changes\_notice\_1.0.51', 0); |
| [1063](#L1063) | } |
| [1064](#L1064) |  |
| [1065](#L1065) |  |
| [1066](#L1066) | /\*\* |
| [1067](#L1067) | \* Deactivate pro version when lite deactivate |
| [1068](#L1068) | \* |
| [1069](#L1069) | \* @return void |
| [1070](#L1070) | \*/ |
| [1071](#L1071) | public static function deactivate\_lite\_version() |
| [1072](#L1072) | { |
| [1073](#L1073) | $dependent = 'bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'; |
| [1074](#L1074) | if (is\_plugin\_active($dependent) ) { |
| [1075](#L1075) | add\_action('update\_option\_active\_plugins', array( 'BookingPress', 'deactivate\_pro\_version' )); |
| [1076](#L1076) | } |
| [1077](#L1077) | } |
| [1078](#L1078) |  |
| [1079](#L1079) | /\*\* |
| [1080](#L1080) | \* Deactivate pro version when lite version deactivate |
| [1081](#L1081) | \* |
| [1082](#L1082) | \* @return void |
| [1083](#L1083) | \*/ |
| [1084](#L1084) | public static function deactivate\_pro\_version() |
| [1085](#L1085) | { |
| [1086](#L1086) | $dependent = 'bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'; |
| [1087](#L1087) | deactivate\_plugins($dependent); |
| [1088](#L1088) | } |
| [1089](#L1089) |  |
| [1090](#L1090) | /\*\* |
| [1091](#L1091) | \* Pro version activate or not |
| [1092](#L1092) | \* |
| [1093](#L1093) | \* @return void |
| [1094](#L1094) | \*/ |
| [1095](#L1095) | public static function bpa\_is\_pro\_active(){ |
| [1096](#L1096) | if( !function\_exists('is\_plugin\_active') ){ |
| [1097](#L1097) | include ABSPATH . '/wp-admin/includes/plugin.php'; |
| [1098](#L1098) | } |
| [1099](#L1099) | $plugin\_slug = 'bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'; |
| [1100](#L1100) | return is\_plugin\_active( $plugin\_slug ); |
| [1101](#L1101) | } |
| [1102](#L1102) |  |
| [1103](#L1103) | /\*\* |
| [1104](#L1104) | \* Is pro version exists or not |
| [1105](#L1105) | \* |
| [1106](#L1106) | \* @return void |
| [1107](#L1107) | \*/ |
| [1108](#L1108) | public static function bpa\_is\_pro\_exists(){ |
| [1109](#L1109) | $plugin\_dir = WP\_PLUGIN\_DIR . '/bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'; |
| [1110](#L1110) | return file\_exists( $plugin\_dir ); |
| [1111](#L1111) | } |
| [1112](#L1112) |  |
| [1113](#L1113) | /\*\* |
| [1114](#L1114) | \* Get pro version plugin version |
| [1115](#L1115) | \* |
| [1116](#L1116) | \* @return void |
| [1117](#L1117) | \*/ |
| [1118](#L1118) | public static function bpa\_pro\_plugin\_version(){ |
| [1119](#L1119) | $bpa\_pro\_version = get\_option( 'bookingpress\_pro\_version' ); |
| [1120](#L1120) | return $bpa\_pro\_version; |
| [1121](#L1121) | } |
| [1122](#L1122) |  |
| [1123](#L1123) | /\*\* |
| [1124](#L1124) | \* Insert other debug logs like integration logs |
| [1125](#L1125) | \* |
| [1126](#L1126) | \* @param  mixed $bookingpress\_other\_log\_type |
| [1127](#L1127) | \* @param  mixed $bookingpress\_other\_log\_event |
| [1128](#L1128) | \* @param  mixed $bookingpress\_other\_log\_event\_from |
| [1129](#L1129) | \* @param  mixed $bookingpress\_other\_log\_raw\_data |
| [1130](#L1130) | \* @param  mixed $bookingpress\_ref\_id |
| [1131](#L1131) | \* @return void |
| [1132](#L1132) | \*/ |
| [1133](#L1133) | public function bookingpress\_other\_debug\_logs\_func( $bookingpress\_other\_log\_type = '', $bookingpress\_other\_log\_event = '', $bookingpress\_other\_log\_event\_from = '', $bookingpress\_other\_log\_raw\_data = '', $bookingpress\_ref\_id = 0 ) |
| [1134](#L1134) | { |
| [1135](#L1135) | global $wpdb, $BookingPress, $bookingpress\_other\_debug\_log\_id, $tbl\_bookingpress\_other\_debug\_logs; |
| [1136](#L1136) |  |
| [1137](#L1137) | if(is\_array($bookingpress\_other\_log\_raw\_data)){ |
| [1138](#L1138) | $bookingpress\_other\_log\_raw\_data['backtrace\_summary'] = wp\_debug\_backtrace\_summary( null, 0, false ); |
| [1139](#L1139) | }else{ |
| [1140](#L1140) | $bookingpress\_other\_log\_raw\_data .= " | Backtrace Summary ==> ".wp\_json\_encode(wp\_debug\_backtrace\_summary( null, 0, false )); |
| [1141](#L1141) | } |
| [1142](#L1142) |  |
| [1143](#L1143) | if(!empty($bookingpress\_other\_log\_raw\_data['appointment\_data']['card\_number'])){ |
| [1144](#L1144) | $bookingpress\_other\_log\_raw\_data['appointment\_data']['card\_number'] = str\_repeat('X', strlen($bookingpress\_other\_log\_raw\_data['appointment\_data']['card\_number']) - 12) . substr($bookingpress\_other\_log\_raw\_data['appointment\_data']['card\_number'], -4); |
| [1145](#L1145) | $bookingpress\_other\_log\_raw\_data['appointment\_data']['expire\_month'] = ''; |
| [1146](#L1146) | $bookingpress\_other\_log\_raw\_data['appointment\_data']['expire\_year'] = ''; |
| [1147](#L1147) | $bookingpress\_other\_log\_raw\_data['appointment\_data']['cvv'] = ''; |
| [1148](#L1148) | }else if(!empty($bookingpress\_other\_log\_raw\_data['card\_details']['card\_number'])){ |
| [1149](#L1149) | $bookingpress\_other\_log\_raw\_data['card\_details']['card\_number'] = str\_repeat('X', strlen($bookingpress\_other\_log\_raw\_data['card\_details']['card\_number']) - 12) . substr($bookingpress\_other\_log\_raw\_data['card\_details']['card\_number'], -4); |
| [1150](#L1150) | $bookingpress\_other\_log\_raw\_data['card\_details']['expire\_month'] = ''; |
| [1151](#L1151) | $bookingpress\_other\_log\_raw\_data['card\_details']['expire\_year'] = ''; |
| [1152](#L1152) | $bookingpress\_other\_log\_raw\_data['card\_details']['cvv'] = ''; |
| [1153](#L1153) | } |
| [1154](#L1154) |  |
| [1155](#L1155) | $bookingpress\_active\_gateway = false; |
| [1156](#L1156) |  |
| [1157](#L1157) | $bookingpress\_active\_gateway = $BookingPress->bookingpress\_get\_settings($bookingpress\_other\_log\_type, 'debug\_log\_setting'); |
| [1158](#L1158) |  |
| [1159](#L1159) | $inserted\_id = 0; |
| [1160](#L1160) | if ($bookingpress\_active\_gateway == 'true' ) { |
| [1161](#L1161) | if ($bookingpress\_ref\_id == null ) { |
| [1162](#L1162) | $bookingpress\_ref\_id = 0; |
| [1163](#L1163) | } |
| [1164](#L1164) |  |
| [1165](#L1165) | $bookingpress\_database\_log\_data = array( |
| [1166](#L1166) | 'bookingpress\_other\_log\_ref\_id'     => sanitize\_text\_field($bookingpress\_ref\_id), |
| [1167](#L1167) | 'bookingpress\_other\_log\_type'       => sanitize\_text\_field($bookingpress\_other\_log\_type), |
| [1168](#L1168) | 'bookingpress\_other\_log\_event'      => sanitize\_text\_field($bookingpress\_other\_log\_event), |
| [1169](#L1169) | 'bookingpress\_other\_log\_event\_from' => sanitize\_text\_field($bookingpress\_other\_log\_event\_from), |
| [1170](#L1170) | 'bookingpress\_other\_log\_raw\_data'   => wp\_json\_encode(stripslashes\_deep($bookingpress\_other\_log\_raw\_data)), |
| [1171](#L1171) | 'bookingpress\_other\_log\_added\_date' => current\_time('mysql'), |
| [1172](#L1172) | ); |
| [1173](#L1173) |  |
| [1174](#L1174) | $wpdb->insert($tbl\_bookingpress\_other\_debug\_logs, $bookingpress\_database\_log\_data); |
| [1175](#L1175) | $inserted\_id = $wpdb->insert\_id; |
| [1176](#L1176) |  |
| [1177](#L1177) | if (empty($bookingpress\_ref\_id) ) { |
| [1178](#L1178) | $bookingpress\_ref\_id = $inserted\_id; |
| [1179](#L1179) | } |
| [1180](#L1180) | } |
| [1181](#L1181) | $bookingpress\_other\_debug\_log\_id = $bookingpress\_ref\_id; |
| [1182](#L1182) | return $inserted\_id; |
| [1183](#L1183) | } |
| [1184](#L1184) |  |
| [1185](#L1185) | function bookingpress\_get\_sysinfo\_func() |
| [1186](#L1186) | { |
| [1187](#L1187) | global $BookingPress; |
| [1188](#L1188) |  |
| [1189](#L1189) | $is\_debug\_mode\_enabled = $BookingPress->bookingpress\_get\_settings( 'debug\_mode', 'general\_setting' ); |
| [1190](#L1190) |  |
| [1191](#L1191) | if (! empty($\_REQUEST['bookingpress\_sysinfo']) && ( $\_REQUEST['bookingpress\_sysinfo'] == 'bkp999repute' ) && 'true' == $is\_debug\_mode\_enabled  ) { |
| [1192](#L1192) | include 'wp-load.php'; |
| [1193](#L1193) | include\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [1194](#L1194) |  |
| [1195](#L1195) | $directaccesskey = 'bkp999repute'; |
| [1196](#L1196) | $directaccess    = isset($\_REQUEST['bookingpress\_sysinfo']) ? sanitize\_text\_field($\_REQUEST['bookingpress\_sysinfo']) : ''; //phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [1197](#L1197) |  |
| [1198](#L1198) |  |
| [1199](#L1199) | if (is\_user\_logged\_in() || $directaccesskey == $directaccess ) { |
| [1200](#L1200) | } else { |
| [1201](#L1201) | $redirect\_to = user\_admin\_url(); |
| [1202](#L1202) | wp\_safe\_redirect($redirect\_to); |
| [1203](#L1203) | } |
| [1204](#L1204) |  |
| [1205](#L1205) | $php\_version = phpversion(); |
| [1206](#L1206) |  |
| [1207](#L1207) | $server\_ip = isset($\_SERVER['SERVER\_ADDR']) ? sanitize\_text\_field($\_SERVER['SERVER\_ADDR']) : ''; |
| [1208](#L1208) |  |
| [1209](#L1209) | $servername = isset($\_SERVER['SERVER\_NAME']) ? sanitize\_text\_field($\_SERVER['SERVER\_NAME']) : ''; |
| [1210](#L1210) |  |
| [1211](#L1211) | $upload\_max\_filesize = ini\_get('upload\_max\_filesize'); |
| [1212](#L1212) |  |
| [1213](#L1213) | $post\_max\_size = ini\_get('post\_max\_size'); |
| [1214](#L1214) |  |
| [1215](#L1215) | $max\_input\_vars = ini\_get('max\_input\_vars'); |
| [1216](#L1216) |  |
| [1217](#L1217) | if (ini\_get('safe\_mode') ) { |
| [1218](#L1218) | $safe\_mode = 'On'; |
| [1219](#L1219) | } else { |
| [1220](#L1220) | $safe\_mode = 'Off'; |
| [1221](#L1221) | } |
| [1222](#L1222) |  |
| [1223](#L1223) | $memory\_limit = ini\_get('memory\_limit'); |
| [1224](#L1224) |  |
| [1225](#L1225) | $apache\_version = ''; |
| [1226](#L1226) |  |
| [1227](#L1227) | $server\_software = isset($\_SERVER['SERVER\_SOFTWARE']) ? sanitize\_text\_field($\_SERVER['SERVER\_SOFTWARE']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [1228](#L1228) | $server\_signature  = isset($\_SERVER['SERVER\_SIGNATURE']) ? sanitize\_text\_field($\_SERVER['SERVER\_SIGNATURE']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [1229](#L1229) |  |
| [1230](#L1230) | if (function\_exists('apache\_get\_version') ) { |
| [1231](#L1231) | $apache\_version = apache\_get\_version(); |
| [1232](#L1232) | } else { |
| [1233](#L1233) | $apache\_version = $server\_software . '( ' . $server\_signature . ' )'; |
| [1234](#L1234) | } |
| [1235](#L1235) |  |
| [1236](#L1236) | $system\_info = php\_uname(); |
| [1237](#L1237) |  |
| [1238](#L1238) | global $wpdb; |
| [1239](#L1239) | $mysql\_server\_version = $wpdb->db\_version(); |
| [1240](#L1240) |  |
| [1241](#L1241) | // WordPress details |
| [1242](#L1242) |  |
| [1243](#L1243) | $wordpress\_version = get\_bloginfo('version'); |
| [1244](#L1244) |  |
| [1245](#L1245) | $wordpress\_sitename = get\_bloginfo('name'); |
| [1246](#L1246) |  |
| [1247](#L1247) | $wordpress\_sitedesc = get\_bloginfo('description'); |
| [1248](#L1248) |  |
| [1249](#L1249) | $wordpress\_wpurl = site\_url(); |
| [1250](#L1250) |  |
| [1251](#L1251) | $wordpress\_url = home\_url(); |
| [1252](#L1252) |  |
| [1253](#L1253) | $wordpress\_admin\_email = get\_bloginfo('admin\_email'); |
| [1254](#L1254) |  |
| [1255](#L1255) | $wordpress\_language = get\_bloginfo('language'); |
| [1256](#L1256) |  |
| [1257](#L1257) | $wordpress\_timezone = wp\_timezone\_string(); |
| [1258](#L1258) |  |
| [1259](#L1259) | $wordpress\_date\_format = get\_option('date\_format'); |
| [1260](#L1260) |  |
| [1261](#L1261) | $wordpress\_time\_format = get\_option('time\_format'); |
| [1262](#L1262) |  |
| [1263](#L1263) | $my\_theme                      = wp\_get\_theme(); |
| [1264](#L1264) | $wordpress\_templateurl         = $my\_theme->get('Name'); |
| [1265](#L1265) | $wordpress\_templateurl\_version = $my\_theme->get('Version'); |
| [1266](#L1266) |  |
| [1267](#L1267) | $wordpress\_charset = get\_bloginfo('charset'); |
| [1268](#L1268) |  |
| [1269](#L1269) | $wordpress\_debug = WP\_DEBUG; |
| [1270](#L1270) |  |
| [1271](#L1271) | if ($wordpress\_debug == true ) { |
| [1272](#L1272) | $wordpress\_debug = 'On'; |
| [1273](#L1273) | } else { |
| [1274](#L1274) | $wordpress\_debug = 'Off'; |
| [1275](#L1275) | } |
| [1276](#L1276) |  |
| [1277](#L1277) | if (is\_multisite() ) { |
| [1278](#L1278) | $wordpress\_multisite = 'Yes'; |
| [1279](#L1279) | } else { |
| [1280](#L1280) | ( $wordpress\_multisite = 'No' ); |
| [1281](#L1281) | } |
| [1282](#L1282) |  |
| [1283](#L1283) | $plugin\_dir\_path      = WP\_PLUGIN\_DIR; |
| [1284](#L1284) | $upload\_dir\_path      = wp\_upload\_dir(); |
| [1285](#L1285) | $bookingpress\_active  = 'Deactive'; |
| [1286](#L1286) | $bookingpress\_version = ''; |
| [1287](#L1287) | if (is\_plugin\_active('bookingpress-appointment-booking/bookingpress-appointment-booking.php') ) { |
| [1288](#L1288) | $bookingpress\_active  = 'Active'; |
| [1289](#L1289) | $bookingpress\_version = get\_option('bookingpress\_version'); |
| [1290](#L1290) | } |
| [1291](#L1291) |  |
| [1292](#L1292) | $folderpermission = substr(sprintf('%o', fileperms($upload\_dir\_path['basedir'])), -4); |
| [1293](#L1293) |  |
| [1294](#L1294) | $folderlogpermission = substr(sprintf('%o', fileperms($plugin\_dir\_path . '/bookingpress-appointment-booking/log/')), -4); |
| [1295](#L1295) |  |
| [1296](#L1296) | if (file\_exists($plugin\_dir\_path . '/bookingpress-appointment-booking/log/response.txt') ) { |
| [1297](#L1297) | $folderlogfilepermission = substr(sprintf('%o', fileperms($plugin\_dir\_path . '/bookingpress-appointment-booking/log/response.txt')), -4); |
| [1298](#L1298) | } |
| [1299](#L1299) |  |
| [1300](#L1300) | $plugin\_list    = get\_plugins(); |
| [1301](#L1301) | $plugin\_detail         = array(); |
| [1302](#L1302) | $active\_plugins = get\_option('active\_plugins'); |
| [1303](#L1303) |  |
| [1304](#L1304) | foreach ( $plugin\_list as $key => $plugin\_detail ) { |
| [1305](#L1305) | $is\_active = in\_array($key, $active\_plugins); |
| [1306](#L1306) | // filter for only gravityforms ones, may get some others if using our naming convention |
| [1307](#L1307) | if ($is\_active == 1 ) { |
| [1308](#L1308) | $name      = substr($key, 0, strpos($key, '/')); |
| [1309](#L1309) | $plugins\_main\_arr[] = array( |
| [1310](#L1310) | 'name'      => $plugin\_detail['Name'], |
| [1311](#L1311) | 'version'   => $plugin\_detail['Version'], |
| [1312](#L1312) | 'is\_active' => $is\_active, |
| [1313](#L1313) | ); |
| [1314](#L1314) | } |
| [1315](#L1315) | } |
| [1316](#L1316) |  |
| [1317](#L1317) | $bookingpress\_module = array( |
| [1318](#L1318) | 'bookingpress\_staffmember\_module' => 'Staff Member Management', |
| [1319](#L1319) | 'bookingpress\_service\_extra\_module' => 'Service Extra', |
| [1320](#L1320) | 'bookingpress\_coupon\_module' => 'Coupon Management', |
| [1321](#L1321) | 'bookingpress\_deposit\_payment\_module' => 'Desposit Payment', |
| [1322](#L1322) | 'bookingpress\_bring\_anyone\_with\_you\_module' => 'Multiple Quantity', |
| [1323](#L1323) | ); |
| [1324](#L1324) | foreach($bookingpress\_module as $key => $value) { |
| [1325](#L1325) | $is\_module\_active = get\_option($key); |
| [1326](#L1326) | if($is\_module\_active == 'true') { |
| [1327](#L1327) | $activated\_modules[] = $value; |
| [1328](#L1328) | } |
| [1329](#L1329) | } |
| [1330](#L1330) | $activated\_modules = !empty($activated\_modules) ? implode(', ',$activated\_modules) : ''; |
| [1331](#L1331) |  |
| [1332](#L1332) | ?> |
| [1333](#L1333) |  |
| [1334](#L1334) | <style type="text/css"> |
| [1335](#L1335) | table |
| [1336](#L1336) | { |
| [1337](#L1337) | border:2px solid #cccccc; |
| [1338](#L1338) | width:900px; |
| [1339](#L1339) | font-family:Verdana, Arial, Helvetica, sans-serif; |
| [1340](#L1340) | font-size:12px; |
| [1341](#L1341) | } |
| [1342](#L1342) | .title |
| [1343](#L1343) | { |
| [1344](#L1344) | border-bottom:2px solid #cccccc; padding:5px 0px 5px 15px; font-weight:bold; |
| [1345](#L1345) | } |
| [1346](#L1346) | .leftrowtitle |
| [1347](#L1347) | { |
| [1348](#L1348) | border-bottom:2px solid #cccccc; border-right:2px solid #cccccc; padding:5px 0px 5px 15px; width:250px; background-color:#333333; color:#FFFFFF; font-weight:bold; |
| [1349](#L1349) | } |
| [1350](#L1350) | .rightrowtitle |
| [1351](#L1351) | { |
| [1352](#L1352) | border-bottom:2px solid #cccccc; padding:5px 0px 5px 15px; width:650px; background-color:#333333;  color:#FFFFFF; font-weight:bold; |
| [1353](#L1353) | } |
| [1354](#L1354) | .leftrowdetails |
| [1355](#L1355) | { |
| [1356](#L1356) | border-bottom:2px solid #cccccc; border-right:2px solid #cccccc; padding:5px 0px 5px 15px; width:250px; |
| [1357](#L1357) | } |
| [1358](#L1358) | .rightrowdetails |
| [1359](#L1359) | { |
| [1360](#L1360) | border-bottom:2px solid #cccccc; padding:5px 0px 5px 15px; width:650px; |
| [1361](#L1361) | } |
| [1362](#L1362) | </style> |
| [1363](#L1363) |  |
| [1364](#L1364) |  |
| [1365](#L1365) | <table border="0" cellpadding="0" cellspacing="0"> |
| [1366](#L1366) | <tr> |
| [1367](#L1367) | <td colspan="2" class="title">Php Details</td> |
| [1368](#L1368) | </tr> |
| [1369](#L1369) | <tr> |
| [1370](#L1370) | <td class="leftrowtitle">Variable Name</td> |
| [1371](#L1371) | <td class="rightrowtitle">Details</td> |
| [1372](#L1372) | </tr> |
| [1373](#L1373) | <tr> |
| [1374](#L1374) | <td class="leftrowdetails">PHP Version</td> |
| [1375](#L1375) | <td class="rightrowdetails"><?php echo esc\_html($php\_version); ?></td> |
| [1376](#L1376) | </tr> |
| [1377](#L1377) | <tr> |
| [1378](#L1378) | <td class="leftrowdetails">System</td> |
| [1379](#L1379) | <td class="rightrowdetails"><?php echo esc\_html($system\_info); ?></td> |
| [1380](#L1380) | </tr> |
| [1381](#L1381) | <tr> |
| [1382](#L1382) | <td class="leftrowdetails">Apache Version</td> |
| [1383](#L1383) | <td class="rightrowdetails"><?php echo esc\_html($apache\_version); ?></td> |
| [1384](#L1384) | </tr> |
| [1385](#L1385) | <tr> |
| [1386](#L1386) | <td class="leftrowdetails">Server Ip</td> |
| [1387](#L1387) | <td class="rightrowdetails"><?php echo esc\_html($server\_ip); ?></td> |
| [1388](#L1388) | </tr> |
| [1389](#L1389) | <tr> |
| [1390](#L1390) | <td class="leftrowdetails">Server Name</td> |
| [1391](#L1391) | <td class="rightrowdetails"><?php echo esc\_html($servername); ?></td> |
| [1392](#L1392) | </tr> |
| [1393](#L1393) | <tr> |
| [1394](#L1394) | <td class="leftrowdetails">Upload Max Filesize</td> |
| [1395](#L1395) | <td class="rightrowdetails"><?php echo esc\_html($upload\_max\_filesize); ?></td> |
| [1396](#L1396) | </tr> |
| [1397](#L1397) | <tr> |
| [1398](#L1398) | <td class="leftrowdetails">Post Max Size</td> |
| [1399](#L1399) | <td class="rightrowdetails"><?php echo esc\_html($post\_max\_size); ?></td> |
| [1400](#L1400) | </tr> |
| [1401](#L1401) | <tr> |
| [1402](#L1402) | <td class="leftrowdetails">Max Input Vars</td> |
| [1403](#L1403) | <td class="rightrowdetails"><?php echo esc\_html($max\_input\_vars); ?></td> |
| [1404](#L1404) | </tr> |
| [1405](#L1405) | <tr> |
| [1406](#L1406) | <td class="leftrowdetails">Safe Mode</td> |
| [1407](#L1407) | <td class="rightrowdetails"><?php echo esc\_html($safe\_mode); ?></td> |
| [1408](#L1408) | </tr> |
| [1409](#L1409) | <tr> |
| [1410](#L1410) | <td class="leftrowdetails">Memory Limit</td> |
| [1411](#L1411) | <td class="rightrowdetails"><?php echo esc\_html($memory\_limit); ?></td> |
| [1412](#L1412) | </tr> |
| [1413](#L1413) | <tr> |
| [1414](#L1414) | <td class="leftrowdetails">MySql Version</td> |
| [1415](#L1415) | <td class="rightrowdetails"><?php echo esc\_html($mysql\_server\_version); ?></td> |
| [1416](#L1416) | </tr> |
| [1417](#L1417) | <tr> |
| [1418](#L1418) | <td class="leftrowdetails">Allow URL for fopen()</td> |
| [1419](#L1419) | <td class="rightrowdetails"><?php echo ( 1 == ini\_get('allow\_url\_fopen') ) ? 'Yes' : 'No'; ?></td> |
| [1420](#L1420) | </tr> |
| [1421](#L1421) | <tr> |
| [1422](#L1422) | <td colspan="2" style="border-bottom:2px solid #cccccc;">&nbsp;</td> |
| [1423](#L1423) | </tr> |
| [1424](#L1424) | <tr> |
| [1425](#L1425) | <td colspan="2" class="title">WordPress Details</td> |
| [1426](#L1426) | </tr> |
| [1427](#L1427) | <tr> |
| [1428](#L1428) | <td class="leftrowtitle">Variable Name</td> |
| [1429](#L1429) | <td class="rightrowtitle">Details</td> |
| [1430](#L1430) | </tr> |
| [1431](#L1431) | <tr> |
| [1432](#L1432) | <td class="leftrowdetails">Site Title</td> |
| [1433](#L1433) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_sitename); ?></td> |
| [1434](#L1434) | </tr> |
| [1435](#L1435) | <tr> |
| [1436](#L1436) | <td class="leftrowdetails">Tagline</td> |
| [1437](#L1437) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_sitedesc); ?></td> |
| [1438](#L1438) | </tr> |
| [1439](#L1439) | <tr> |
| [1440](#L1440) | <td class="leftrowdetails">Version</td> |
| [1441](#L1441) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_version); ?></td> |
| [1442](#L1442) | </tr> |
| [1443](#L1443) | <tr> |
| [1444](#L1444) | <td class="leftrowdetails">WordPress address (URL)</td> |
| [1445](#L1445) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_wpurl); ?></td> |
| [1446](#L1446) | </tr> |
| [1447](#L1447) | <tr> |
| [1448](#L1448) | <td class="leftrowdetails">Site address (URL)</td> |
| [1449](#L1449) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_url); ?></td> |
| [1450](#L1450) | </tr> |
| [1451](#L1451) | <?php |
| [1452](#L1452) | if(current\_user\_can('administrator')) { ?> |
| [1453](#L1453) | <tr> |
| [1454](#L1454) | <td class="leftrowdetails">Admin Email</td> |
| [1455](#L1455) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_admin\_email); ?></td> |
| [1456](#L1456) | </tr> |
| [1457](#L1457) | <?php |
| [1458](#L1458) | } |
| [1459](#L1459) | ?> |
| [1460](#L1460) | <tr> |
| [1461](#L1461) | <td class="leftrowdetails">Charset</td> |
| [1462](#L1462) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_charset); ?></td> |
| [1463](#L1463) | </tr> |
| [1464](#L1464) | <tr> |
| [1465](#L1465) | <td class="leftrowdetails">Language</td> |
| [1466](#L1466) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_language); ?></td> |
| [1467](#L1467) | </tr> |
| [1468](#L1468) | <tr> |
| [1469](#L1469) | <td class="leftrowdetails">Active theme</td> |
| [1470](#L1470) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_templateurl) . ' (' . esc\_html($wordpress\_templateurl\_version) . ')'; ?></td> |
| [1471](#L1471) | </tr> |
| [1472](#L1472) | <tr> |
| [1473](#L1473) | <td class="leftrowdetails">Debug Mode</td> |
| [1474](#L1474) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_debug); ?></td> |
| [1475](#L1475) | </tr> |
| [1476](#L1476) | <tr> |
| [1477](#L1477) | <td class="leftrowdetails">Multisite Enable</td> |
| [1478](#L1478) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_multisite); ?></td> |
| [1479](#L1479) | </tr> |
| [1480](#L1480) | <tr> |
| [1481](#L1481) | <td class="leftrowdetails">Timezone</td> |
| [1482](#L1482) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_timezone); ?></td> |
| [1483](#L1483) | </tr> |
| [1484](#L1484) | <tr> |
| [1485](#L1485) | <td class="leftrowdetails">Date Format</td> |
| [1486](#L1486) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_date\_format); ?></td> |
| [1487](#L1487) | </tr> |
| [1488](#L1488) | <tr> |
| [1489](#L1489) | <td class="leftrowdetails">Time Format</td> |
| [1490](#L1490) | <td class="rightrowdetails"><?php echo esc\_html($wordpress\_time\_format); ?></td> |
| [1491](#L1491) | </tr> |
| [1492](#L1492) | <tr> |
| [1493](#L1493) | <td colspan="2" style="border-bottom:2px solid #cccccc;">&nbsp;</td> |
| [1494](#L1494) | </tr> |
| [1495](#L1495) | <tr> |
| [1496](#L1496) | <td colspan="2" class="title">Bookingpress Details</td> |
| [1497](#L1497) | </tr> |
| [1498](#L1498) | <tr> |
| [1499](#L1499) | <td class="leftrowtitle">Variable Name</td> |
| [1500](#L1500) | <td class="rightrowtitle">Details</td> |
| [1501](#L1501) | </tr> |
| [1502](#L1502) | <tr> |
| [1503](#L1503) | <td class="leftrowdetails">Bookingpress Status</td> |
| [1504](#L1504) | <td class="rightrowdetails"><?php |
| [1505](#L1505) | echo esc\_html($bookingpress\_active); |
| [1506](#L1506) | if (!function\_exists('is\_plugin\_active')) { |
| [1507](#L1507) | include\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [1508](#L1508) | } |
| [1509](#L1509) | if( is\_plugin\_active('bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php') ){ |
| [1510](#L1510) |  |
| [1511](#L1511) | $store\_url = BOOKINGPRESS\_STORE\_URL; |
| [1512](#L1512) |  |
| [1513](#L1513) | $license = trim( get\_option( 'bkp\_license\_key' ) ); |
| [1514](#L1514) |  |
| [1515](#L1515) | $package = trim( get\_option( 'bkp\_license\_package' ) ); |
| [1516](#L1516) | $api\_params = array( |
| [1517](#L1517) | 'edd\_action' => 'check\_license', |
| [1518](#L1518) | 'license' => $license, |
| [1519](#L1519) | 'item\_id'  => $package, |
| [1520](#L1520) | 'url' => home\_url() |
| [1521](#L1521) | ); |
| [1522](#L1522) |  |
| [1523](#L1523) | $response = wp\_remote\_post( $store\_url, array( 'body' => $api\_params, 'timeout' => 15 ) ); |
| [1524](#L1524) | if ( is\_wp\_error( $response ) ) { |
| [1525](#L1525) | echo '&nbsp;<span style="color:red;">( Unlicensed )</span>'; |
| [1526](#L1526) | } else { |
| [1527](#L1527) | $resp\_body = json\_decode( wp\_remote\_retrieve\_body( $response ), true ); |
| [1528](#L1528) |  |
| [1529](#L1529) | if( true == $resp\_body['success'] ){ |
| [1530](#L1530) | $expiry\_date = $resp\_body['expires']; |
| [1531](#L1531) | if( 'lifetime' == $expiry\_date ){ |
| [1532](#L1532) | echo '&nbsp;<span style="color:green;font-weight:bolder;"> ( Active ) </span>'; |
| [1533](#L1533) | } else { |
| [1534](#L1534) | if( current\_time('timestamp') > strtotime( $expiry\_date ) ){ |
| [1535](#L1535) | echo '&nbsp;<span style="color:orange;font-weight:bolder;"> ( Expired ) </span>'; |
| [1536](#L1536) | } else { |
| [1537](#L1537) | echo '&nbsp;<span style="color:green;font-weight:bolder;"> ( Active ) </span>'; |
| [1538](#L1538) | } |
| [1539](#L1539) | } |
| [1540](#L1540) | } else { |
| [1541](#L1541) | echo '&nbsp;<span style="color:red;">( Unlicensed )</span>'; |
| [1542](#L1542) | } |
| [1543](#L1543) | } |
| [1544](#L1544) |  |
| [1545](#L1545) | } |
| [1546](#L1546) | ?></td> |
| [1547](#L1547) | </tr> |
| [1548](#L1548) | <tr> |
| [1549](#L1549) | <td class="leftrowdetails">Bookingpress Version</td> |
| [1550](#L1550) | <td class="rightrowdetails"><?php echo esc\_html($bookingpress\_version); ?></td> |
| [1551](#L1551) | </tr> |
| [1552](#L1552) | <?php if(current\_user\_can('administrator')) { ?> |
| [1553](#L1553) | <tr> |
| [1554](#L1554) | <td class="leftrowdetails">Upload Basedir</td> |
| [1555](#L1555) | <td class="rightrowdetails"><?php echo esc\_html($upload\_dir\_path['basedir']); ?></td> |
| [1556](#L1556) | </tr> |
| [1557](#L1557) | <tr> |
| [1558](#L1558) | <td class="leftrowdetails">Upload Baseurl</td> |
| [1559](#L1559) | <td class="rightrowdetails"><?php echo esc\_url($upload\_dir\_path['baseurl']); ?></td> |
| [1560](#L1560) | </tr> |
| [1561](#L1561) | <tr> |
| [1562](#L1562) | <td class="leftrowdetails">Upload Folder Permission</td> |
| [1563](#L1563) | <td class="rightrowdetails"><?php echo esc\_html($folderpermission); ?></td> |
| [1564](#L1564) | </tr> |
| [1565](#L1565) | <tr> |
| [1566](#L1566) | <td class="leftrowdetails">Bookingpress Log Folder Permission</td> |
| [1567](#L1567) | <td class="rightrowdetails"><?php echo esc\_html($folderlogpermission); ?></td> |
| [1568](#L1568) | </tr> |
| [1569](#L1569) | <tr> |
| [1570](#L1570) | <td class="leftrowdetails">Bookingpress Log File Permission</td> |
| [1571](#L1571) | <td class="rightrowdetails"><?php echo esc\_html($folderlogfilepermission); ?></td> |
| [1572](#L1572) | </tr> |
| [1573](#L1573) | <?php } ?> |
| [1574](#L1574) |  |
| [1575](#L1575) | <tr> |
| [1576](#L1576) | <td colspan="2" class="title">Active Plugin List</td> |
| [1577](#L1577) | </tr> |
| [1578](#L1578) |  |
| [1579](#L1579) | <?php |
| [1580](#L1580) | foreach ( $plugins\_main\_arr as $myplugin ) { |
| [1581](#L1581) | ?> |
| [1582](#L1582) | <tr> |
| [1583](#L1583) | <td class="leftrowdetails"><?php echo esc\_html($myplugin['name']); ?></td> |
| [1584](#L1584) | <td class="rightrowdetails"> |
| [1585](#L1585) | <?php |
| [1586](#L1586) | if ($myplugin['is\_active'] == 1 ) { |
| [1587](#L1587) | echo 'ACTIVE'; |
| [1588](#L1588) | } else { |
| [1589](#L1589) | echo 'INACTIVE'; |
| [1590](#L1590) | } |
| [1591](#L1591) | echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;(' . esc\_html($myplugin['version']) . ')'; |
| [1592](#L1592) |  |
| [1593](#L1593) | if($myplugin['name'] == 'BookingPress Pro - Appointment Booking plugin') { |
| [1594](#L1594) | echo '&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;'.$activated\_modules; //phpcs:ignore |
| [1595](#L1595) | } |
| [1596](#L1596) | ?> |
| [1597](#L1597) | </td> |
| [1598](#L1598) | </tr> |
| [1599](#L1599) | <?php |
| [1600](#L1600) | } |
| [1601](#L1601) | ?> |
| [1602](#L1602) |  |
| [1603](#L1603) |  |
| [1604](#L1604) |  |
| [1605](#L1605) | <tr> |
| [1606](#L1606) | <td colspan="2">&nbsp;</td> |
| [1607](#L1607) | </tr> |
| [1608](#L1608) | </table> |
| [1609](#L1609) | <?php |
| [1610](#L1610) | exit; |
| [1611](#L1611) | } |
| [1612](#L1612) | } |
| [1613](#L1613) |  |
| [1614](#L1614) | /\*\* |
| [1615](#L1615) | \* Get any existing customer meta |
| [1616](#L1616) | \* |
| [1617](#L1617) | \* @param  mixed $bookingpress\_customer\_id |
| [1618](#L1618) | \* @param  mixed $bookingpress\_user\_metakey |
| [1619](#L1619) | \* @return void |
| [1620](#L1620) | \*/ |
| [1621](#L1621) | function get\_bookingpress\_customersmeta( $bookingpress\_customer\_id, $bookingpress\_user\_metakey ) |
| [1622](#L1622) | { |
| [1623](#L1623) | global $wpdb, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_customers\_meta; |
| [1624](#L1624) | $bookingpress\_customersmeta\_value = ''; |
| [1625](#L1625) | // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_customers\_meta is table name defined globally. False Positive alarm |
| [1626](#L1626) | $bookingpress\_customersmeta\_details = $wpdb->get\_row($wpdb->prepare('SELECT \* FROM ' . $tbl\_bookingpress\_customers\_meta . ' WHERE bookingpress\_customer\_id = %d AND bookingpress\_customersmeta\_key = %s', $bookingpress\_customer\_id, $bookingpress\_user\_metakey), ARRAY\_A); |
| [1627](#L1627) | if (! empty($bookingpress\_customersmeta\_details) ) { |
| [1628](#L1628) | $bookingpress\_customersmeta\_value = $bookingpress\_customersmeta\_details['bookingpress\_customersmeta\_value']; |
| [1629](#L1629) | } |
| [1630](#L1630) |  |
| [1631](#L1631) | return $bookingpress\_customersmeta\_value; |
| [1632](#L1632) | } |
| [1633](#L1633) |  |
| [1634](#L1634) | /\*\* |
| [1635](#L1635) | \* Update any existing customer meta |
| [1636](#L1636) | \* |
| [1637](#L1637) | \* @param  mixed $bookingpress\_customer\_id |
| [1638](#L1638) | \* @param  mixed $bookingpress\_user\_metakey |
| [1639](#L1639) | \* @param  mixed $bookingpress\_user\_metavalue |
| [1640](#L1640) | \* @return void |
| [1641](#L1641) | \*/ |
| [1642](#L1642) | function update\_bookingpress\_customersmeta( $bookingpress\_customer\_id, $bookingpress\_user\_metakey, $bookingpress\_user\_metavalue ) |
| [1643](#L1643) | { |
| [1644](#L1644) | global $wpdb, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_customers\_meta, $BookingPress; |
| [1645](#L1645) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers\_meta is table name defined globally. False Positive alarm |
| [1646](#L1646) | $bookingpress\_exist\_meta\_count = $wpdb->get\_var($wpdb->prepare("SELECT COUNT(bookingpress\_customermeta\_id) as total FROM {$tbl\_bookingpress\_customers\_meta} WHERE bookingpress\_customer\_id = %d AND bookingpress\_customersmeta\_key = %s", $bookingpress\_customer\_id, $bookingpress\_user\_metakey)); |
| [1647](#L1647) | if( is\_array( $bookingpress\_user\_metavalue ) ){ |
| [1648](#L1648) | $bookingpress\_user\_metavalue = wp\_json\_encode( $bookingpress\_user\_metavalue ); |
| [1649](#L1649) | } |
| [1650](#L1650) |  |
| [1651](#L1651) | if ($bookingpress\_exist\_meta\_count > 0 ) { |
| [1652](#L1652) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers\_meta is table name defined globally. False Positive alarm |
| [1653](#L1653) | $bookingpress\_exist\_meta\_details = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_customers\_meta} WHERE bookingpress\_customer\_id = %d AND bookingpress\_customersmeta\_key = %s", $bookingpress\_customer\_id, $bookingpress\_user\_metakey), ARRAY\_A); |
| [1654](#L1654) | $bookingpress\_customermeta\_id    = $bookingpress\_exist\_meta\_details['bookingpress\_customermeta\_id']; |
| [1655](#L1655) |  |
| [1656](#L1656) | $bookingpress\_user\_meta\_details = array( |
| [1657](#L1657) | 'bookingpress\_customer\_id'         => $bookingpress\_customer\_id, |
| [1658](#L1658) | 'bookingpress\_customersmeta\_key'   => $bookingpress\_user\_metakey, |
| [1659](#L1659) | 'bookingpress\_customersmeta\_value' => $bookingpress\_user\_metavalue, |
| [1660](#L1660) | ); |
| [1661](#L1661) |  |
| [1662](#L1662) | $bookingpress\_update\_where\_condition = array( |
| [1663](#L1663) | 'bookingpress\_customermeta\_id' => $bookingpress\_customermeta\_id, |
| [1664](#L1664) | ); |
| [1665](#L1665) |  |
| [1666](#L1666) | $wpdb->update($tbl\_bookingpress\_customers\_meta, $bookingpress\_user\_meta\_details, $bookingpress\_update\_where\_condition); |
| [1667](#L1667) | } else { |
| [1668](#L1668) | $bookingpress\_user\_meta\_details = array( |
| [1669](#L1669) | 'bookingpress\_customer\_id'         => $bookingpress\_customer\_id, |
| [1670](#L1670) | 'bookingpress\_customersmeta\_key'   => $bookingpress\_user\_metakey, |
| [1671](#L1671) | 'bookingpress\_customersmeta\_value' => $bookingpress\_user\_metavalue, |
| [1672](#L1672) | ); |
| [1673](#L1673) |  |
| [1674](#L1674) | $wpdb->insert($tbl\_bookingpress\_customers\_meta, $bookingpress\_user\_meta\_details); |
| [1675](#L1675) | } |
| [1676](#L1676) | return 1; |
| [1677](#L1677) | } |
| [1678](#L1678) |  |
| [1679](#L1679) | /\*\* |
| [1680](#L1680) | \* Delete specific customer meta |
| [1681](#L1681) | \* |
| [1682](#L1682) | \* @param  mixed $bookingpress\_customer\_id |
| [1683](#L1683) | \* @param  mixed $bookingpress\_user\_metakey |
| [1684](#L1684) | \* @return void |
| [1685](#L1685) | \*/ |
| [1686](#L1686) | function delete\_bookingpress\_customersmeta( $bookingpress\_customer\_id, $bookingpress\_user\_metakey ) |
| [1687](#L1687) | { |
| [1688](#L1688) | global $wpdb, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_customers\_meta; |
| [1689](#L1689) | if (! empty($bookingpress\_customer\_id) && ! empty($bookingpress\_user\_metakey) ) { |
| [1690](#L1690) | $wpdb->delete( |
| [1691](#L1691) | $tbl\_bookingpress\_customers\_meta, |
| [1692](#L1692) | array( |
| [1693](#L1693) | 'bookingpress\_customer\_id'       => $bookingpress\_customer\_id, |
| [1694](#L1694) | 'bookingpress\_customersmeta\_key' => $bookingpress\_user\_metakey, |
| [1695](#L1695) | ) |
| [1696](#L1696) | ); |
| [1697](#L1697) | } |
| [1698](#L1698) | return 1; |
| [1699](#L1699) | } |
| [1700](#L1700) |  |
| [1701](#L1701) | /\*\* |
| [1702](#L1702) | \* Ajax request of deactivating lite plugin |
| [1703](#L1703) | \* |
| [1704](#L1704) | \* @return void |
| [1705](#L1705) | \*/ |
| [1706](#L1706) | function bookingpress\_lite\_deactivate\_plugin\_func() |
| [1707](#L1707) | { |
| [1708](#L1708) | global $wpdb; |
| [1709](#L1709) | check\_ajax\_referer('bookingpress\_lite\_deactivate\_plugin', 'security'); |
| [1710](#L1710) | if (! empty($\_POST['bpalite\_reason']) && isset($\_POST['bpalite\_details']) ) { |
| [1711](#L1711) | $bpalite\_anonymous               = isset($\_POST['bpalite\_anonymous']) && sanitize\_text\_field($\_POST['bpalite\_anonymous']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [1712](#L1712) | $args                            = $\_POST; |
| [1713](#L1713) | $data                            = array( |
| [1714](#L1714) | 'option\_name'  => 'bpa\_deactivation\_feedback', |
| [1715](#L1715) | 'option\_value' => serialize($args), |
| [1716](#L1716) | ); |
| [1717](#L1717) | $args['bpalite\_site\_url']        = BOOKINGPRESS\_HOME\_URL; |
| [1718](#L1718) | $args['bpalite\_site\_ip\_address'] = isset($\_SERVER['REMOTE\_ADDR']) ? sanitize\_text\_field($\_SERVER['REMOTE\_ADDR']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [1719](#L1719) | if (! $bpalite\_anonymous ) { |
| [1720](#L1720) | $args['bpa\_lite\_site\_email'] = get\_option('admin\_email'); |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | $url = 'https://www.bookingpressplugin.com/bpa\_misc/bpalite\_feedback.php'; |
| [1724](#L1724) |  |
| [1725](#L1725) | $response = wp\_remote\_post( |
| [1726](#L1726) | $url, |
| [1727](#L1727) | array( |
| [1728](#L1728) | 'timeout' => 500, |
| [1729](#L1729) | 'body'    => $args, |
| [1730](#L1730) | ) |
| [1731](#L1731) | ); |
| [1732](#L1732) | } |
| [1733](#L1733) | echo wp\_json\_encode( |
| [1734](#L1734) | array( |
| [1735](#L1735) | 'status' => 'OK', |
| [1736](#L1736) | ) |
| [1737](#L1737) | ); |
| [1738](#L1738) | die(); |
| [1739](#L1739) | } |
| [1740](#L1740) |  |
| [1741](#L1741) |  |
| [1742](#L1742) | /\*\* |
| [1743](#L1743) | \* Modify plugin action links |
| [1744](#L1744) | \* |
| [1745](#L1745) | \* @param  mixed $links |
| [1746](#L1746) | \* @param  mixed $file |
| [1747](#L1747) | \* @return void |
| [1748](#L1748) | \*/ |
| [1749](#L1749) | function bookingpress\_plugin\_action\_links( $links, $file ) |
| [1750](#L1750) | { |
| [1751](#L1751) | global $wp, $wpdb; |
| [1752](#L1752) | if ($file == 'bookingpress-appointment-booking/bookingpress-appointment-booking.php' ) { |
| [1753](#L1753) | if (isset($links['deactivate']) ) { |
| [1754](#L1754) | $deactivation\_link = $links['deactivate']; |
| [1755](#L1755) | $bpa\_is\_rtl\_enabled = is\_rtl() ? 'bpa\_rtl\_enabled' : ''; |
| [1756](#L1756) | // Insert an onClick action to allow form before deactivating |
| [1757](#L1757) | $extra\_popup\_class = ''; |
| [1758](#L1758) | if($this->bpa\_is\_pro\_active()) { |
| [1759](#L1759) | $extra\_popup\_class = 'bpalite-confirm-deactivate-wrapper'; |
| [1760](#L1760) | } |
| [1761](#L1761) |  |
| [1762](#L1762) | $deactivation\_link   = str\_replace( |
| [1763](#L1763) | '<a', |
| [1764](#L1764) | '<div class="bpalite-deactivate-form-wrapper"> |
| [1765](#L1765) | <span class="bpalite-deactivate-form '.$bpa\_is\_rtl\_enabled.' '.$extra\_popup\_class.'" id="bpa-deactivate-form-' . esc\_attr('BookingPressLite') . '"></span> |
| [1766](#L1766) | </div><a id="bpa-deactivate-link-' . esc\_attr('BookingPressLite') . '"', |
| [1767](#L1767) | $deactivation\_link |
| [1768](#L1768) | ); |
| [1769](#L1769) | $links['deactivate'] = $deactivation\_link; |
| [1770](#L1770) | } |
| [1771](#L1771) | } |
| [1772](#L1772) | return $links; |
| [1773](#L1773) | } |
| [1774](#L1774) |  |
| [1775](#L1775) |  |
| [1776](#L1776) | /\*\* |
| [1777](#L1777) | \* Deactive feedback popup content |
| [1778](#L1778) | \* |
| [1779](#L1779) | \* @return void |
| [1780](#L1780) | \*/ |
| [1781](#L1781) | function bookingpress\_deactivate\_feedback\_popup() |
| [1782](#L1782) | { |
| [1783](#L1783) | ?> |
| [1784](#L1784) | <style type="text/css" id="bookingpress\_deactivate\_popup\_css"> |
| [1785](#L1785) | .bpa-deactivate-btn{display: inline-block;font-weight: 400;text-align: center;white-space;vertical-align: nowrap;user-select: none;border: 1px solid transparent;padding: .375rem .75rem;font-size:1rem;line-height:1.5;border-radius:0.25rem;transition:color .15s } |
| [1786](#L1786) | .bpa-deactivate-btn-primary{ |
| [1787](#L1787) | color: #fff; |
| [1788](#L1788) | background-color: #12D488; |
| [1789](#L1789) | border-color:none !important; |
| [1790](#L1790) | } |
| [1791](#L1791) | .bpa-deactivate-btn:hover |
| [1792](#L1792) | { |
| [1793](#L1793) | color: white; |
| [1794](#L1794) | } |
| [1795](#L1795) | .bpa-deactivate-btn-cancel:hover ,.bpa-deactivate-btn-cancel { |
| [1796](#L1796) | color: #2c3338; |
| [1797](#L1797) | background-color: #fff; |
| [1798](#L1798) | border-color:#2c3338 !important; |
| [1799](#L1799) | /\* margin-left:350px; \*/ |
| [1800](#L1800) | margin-right: 10px; |
| [1801](#L1801) | } |
| [1802](#L1802) | .bpalite-deactivate-form-active .bpalite-deactivate-form-bg {background: rgba( 0, 0, 0, .5 );position: fixed;top: 0;left: 0;width: 100%;height: 100%; z-index: 99;} |
| [1803](#L1803) | .bpalite-deactivate-form-wrapper {position: relative;z-index: 999;display: none; } |
| [1804](#L1804) | .bpalite-deactivate-form-active .bpalite-deactivate-form-wrapper {display: inline-block;} |
| [1805](#L1805) | .bpalite-deactivate-form {display: none;} |
| [1806](#L1806) | .bpalite-deactivate-form-active .bpalite-deactivate-form {position: absolute;bottom: 30px;left: 0;max-width: 500px;min-width: 360px;background: #fff;white-space: normal;} |
| [1807](#L1807) | .bpalite-deactivate-form-active .bpalite-deactivate-form.bpa\_rtl\_enabled {position: absolute;bottom: 30px;left: unset;max-width: 500px;min-width: 360px;background: #fff;white-space: normal;} |
| [1808](#L1808) | .bpalite-deactivate-form-head {background: #12D488;color: #fff;padding: 8px 18px;} |
| [1809](#L1809) | .bpalite-deactivate-confirm-head p{color: #fff; padding-left:10px} |
| [1810](#L1810) | .bpalite-deactivate-confirm-head{padding: 4px 18px; background:red; } |
| [1811](#L1811) | .bpalite-deactivate-form-body {padding: 8px 18px 0;color: #444;} |
| [1812](#L1812) | .bpalite-deactivate-form-body label[for="bpalite-remove-settings"] {font-weight: bold;} |
| [1813](#L1813) | .deactivating-spinner {display: none;} |
| [1814](#L1814) | .deactivating-spinner .spinner {float: none;margin: 4px 4px 0 18px;vertical-align: bottom;visibility: visible;} |
| [1815](#L1815) | .bpalite-deactivate-form-footer {padding: 0 18px 8px;} |
| [1816](#L1816) | .bpalite-deactivate-form-footer label[for="bpalite\_anonymous"] {visibility: hidden;} |
| [1817](#L1817) | .bpalite-deactivate-form-footer p {display: flex;align-items: center;justify-content: space-between;margin: 0;} |
| [1818](#L1818) | #bpalite-deactivate-submit-form span {display: none;} |
| [1819](#L1819) | .bpalite-deactivate-form.process-response .bpalite-deactivate-form-body,.bpalite-deactivate-form.process-response .bpalite-deactivate-form-footer {position: relative;} |
| [1820](#L1820) | .bpalite-deactivate-form.process-response .bpalite-deactivate-form-body:after,.bpalite-deactivate-form.process-response .bpalite-deactivate-form-footer:after {content: "";display: block;position: absolute;top: 0;left: 0;width: 100%;height: 100%;background-color: rgba( 255, 255, 255, .5 );} |
| [1821](#L1821) | button#bpalite-deactivate-submit-btn{cursor:pointer;} |
| [1822](#L1822) | button#bpalite-deactivate-submit-btn[disabled=disabled]{ |
| [1823](#L1823) | cursor:not-allowed; |
| [1824](#L1824) | opacity: 0.5; |
| [1825](#L1825) | } |
| [1826](#L1826) | .bpalite-confirm-deactivate-wrapper{ |
| [1827](#L1827) | width:550px; |
| [1828](#L1828) | max-width:600px !important; |
| [1829](#L1829) | } |
| [1830](#L1830) | .bpalite-confirm-deactivate-wrapper .bpalite-deactivate-confirm-head strong { |
| [1831](#L1831) | margin-bottom:unset; |
| [1832](#L1832) | } |
| [1833](#L1833) | .bpalite-confirm-deactivate-wrapper .bpalite-deactivate-confirm-head { |
| [1834](#L1834) | display: flex; |
| [1835](#L1835) | align-items: center; |
| [1836](#L1836) | } |
| [1837](#L1837) | body.rtl .bpalite-deactivate-form-footer p{ justify-content: space-between;} |
| [1838](#L1838) | body.rtl .bpa-deactivate-btn-cancel:hover ,.bpa-deactivate-btn-cancel{margin-left: 10px; } |
| [1839](#L1839) | .bookingpress-pro-notice-plugin-label{ color: #000000; } |
| [1840](#L1840) | </style> |
| [1841](#L1841) | <?php |
| [1842](#L1842) | $question\_options                      = array(); |
| [1843](#L1843) | $question\_options['list\_data\_options'] = array( |
| [1844](#L1844) | 'setup-difficult'  => esc\_html\_\_('Set up is too difficult', 'bookingpress-appointment-booking'), |
| [1845](#L1845) | 'docs-improvement' => esc\_html\_\_('Lack of documentation', 'bookingpress-appointment-booking'), |
| [1846](#L1846) | 'features'         => esc\_html\_\_('Not the features I wanted', 'bookingpress-appointment-booking'), |
| [1847](#L1847) | 'better-plugin'    => esc\_html\_\_('Found a better plugin', 'bookingpress-appointment-booking'), |
| [1848](#L1848) | 'incompatibility'  => esc\_html\_\_('Incompatible with theme or plugin', 'bookingpress-appointment-booking'), |
| [1849](#L1849) | 'bought-premium'   => esc\_html\_\_('I bought premium version of BookingPress', 'bookingpress-appointment-booking'), |
| [1850](#L1850) | 'maintenance'      => esc\_html\_\_('Other', 'bookingpress-appointment-booking'), |
| [1851](#L1851) | ); |
| [1852](#L1852) |  |
| [1853](#L1853) | $html2 = '<div class="bpalite-deactivate-confirm-head"><svg xmlns="http://www.w3.org/2000/svg" height="20px" viewBox="0 0 24 24" width="20px" fill="#fff"><path d="M4.47 21h15.06c1.54 0 2.5-1.67 1.73-3L13.73 4.99c-.77-1.33-2.69-1.33-3.46 0L2.74 18c-.77 1.33.19 3 1.73 3zM12 14c-.55 0-1-.45-1-1v-2c0-.55.45-1 1-1s1 .45 1 1v2c0 .55-.45 1-1 1zm1 4h-2v-2h2v2z"/></svg><p><strong>' . esc\_html\_\_('BookingPress Lite plugin Deactivation', 'bookingpress-appointment-booking').'.</strong></p></div>'; |
| [1854](#L1854) | $html2 .= '<div class="bpalite-deactivate-form-body">'; |
| [1855](#L1855) | $html2 .= '<div class="bpalite-deactivate-options">'; |
| [1856](#L1856) |  |
| [1857](#L1857) | $html2 .= '<p><strong>' . esc\_html\_\_('You are using BookingPress Premium plugin on your website and it is an extension to BookingPress Lite, so, If you deactivate BookingPress Lite then it will automatically deactivate BookingPress Premium and all the add-ons', 'bookingpress-appointment-booking') . '.</strong></p></br>'; |
| [1858](#L1858) |  |
| [1859](#L1859) | $html2 .= '<p><label><input type="checkbox" name="bpalite-risk-confirm" id="bpalite-risk-confirm" value="risk-confirm">'.esc\_html\_\_('I understand the risk', 'bookingpress-appointment-booking').'</label></p>'; |
| [1860](#L1860) | $html2 .= '</div>'; |
| [1861](#L1861) | $html2 .= '<hr/>'; |
| [1862](#L1862) | $html2 .= '</div>'; |
| [1863](#L1863) | $html2 .= '<div class="bpalite-deactivate-form-footer"><p>'; |
| [1864](#L1864) | $html2 .= '<button id="bpalite-deactivate-cancel-btn" class="bpa-deactivate-btn bpa-deactivate-btn-cancel" >'.esc\_html\_\_('Cancel', 'bookingpress-appointment-booking') |
| [1865](#L1865) | . '</button>'; |
| [1866](#L1866) | $html2 .= '<button id="bpalite-deactivate-submit-btn" disabled=disabled class="bpa-deactivate-btn bpa-deactivate-btn-primary" href="#">'.esc\_html\_\_('Proceed', 'bookingpress-appointment-booking') |
| [1867](#L1867) | . '</button></p>'; |
| [1868](#L1868) | $html2 .= '</div>'; |
| [1869](#L1869) |  |
| [1870](#L1870) | $html                                  = '<div class="bpalite-deactivate-form-head"><strong>' . esc\_html\_\_('BookingPress - Sorry to see you go', 'bookingpress-appointment-booking') . '</strong></div>'; |
| [1871](#L1871) | $html                                 .= '<div class="bpalite-deactivate-form-body">'; |
| [1872](#L1872) | if (is\_array($question\_options['list\_data\_options']) ) { |
| [1873](#L1873) | $html .= '<div class="bpalite-deactivate-options">'; |
| [1874](#L1874) | $html .= '<p><strong>' . esc\_html\_\_('Before you deactivate the BookingPress Lite plugin, would you quickly give us your reason for doing so?', 'bookingpress-appointment-booking') . '</strong></p><p>'; |
| [1875](#L1875) |  |
| [1876](#L1876) | foreach ( $question\_options['list\_data\_options'] as $key => $option ) { |
| [1877](#L1877) | $html .= '<input type="radio" name="bpalite-deactivate-reason" id="' . esc\_attr($key) . '" value="' . esc\_attr($key) . '"> <label for="' . esc\_attr($key) . '">' . esc\_attr($option) . '</label><br>'; |
| [1878](#L1878) | } |
| [1879](#L1879) | $html .= '</p><label id="bpalite-deactivate-details-label" for="bpalite-deactivate-reasons"><strong>' . esc\_html\_\_('How could we improve ?', 'bookingpress-appointment-booking') . '</strong></label><textarea name="bpalite-deactivate-details" id="bpalite-deactivate-details" rows="2" style="width:100%"></textarea>'; |
| [1880](#L1880) | $html .= '</div>'; |
| [1881](#L1881) | } |
| [1882](#L1882) | $html .= '<hr/>'; |
| [1883](#L1883) |  |
| [1884](#L1884) | $html .= '</div>'; |
| [1885](#L1885) | $html .= '<p class="deactivating-spinner"><span class="spinner"></span> ' . esc\_html\_\_('Submitting form', 'bookingpress-appointment-booking') . '</p>'; |
| [1886](#L1886) | $html .= '<div class="bpalite-deactivate-form-footer"><p>'; |
| [1887](#L1887) | $html .= '<label for="bpalite\_anonymous" title="' |
| [1888](#L1888) | . esc\_html\_\_('If you uncheck this option, then your email address will be sent along with your feedback. This can be used by BookingPress to get back to you for more information or a solution.', 'bookingpress-appointment-booking') |
| [1889](#L1889) | . '"><input type="checkbox" name="bpalite-deactivate-tracking" id="bpalite\_anonymous"> ' . esc\_html\_\_('Send anonymous', 'bookingpress-appointment-booking') . '</label><br>'; |
| [1890](#L1890) | $html .= '<a id="bpalite-deactivate-submit-form"  class="bpa-deactivate-btn bpa-deactivate-btn-primary" href="#"><span>' |
| [1891](#L1891) | . esc\_html\_\_('Submit and', 'bookingpress-appointment-booking').'</span> '.esc\_html\_\_('Deactivate', 'bookingpress-appointment-booking') |
| [1892](#L1892) | . '</a>'; |
| [1893](#L1893) | $html .= '</p></div>'; |
| [1894](#L1894) | ?> |
| [1895](#L1895) | <div class="bpalite-deactivate-form-bg"></div> |
| [1896](#L1896) |  |
| [1897](#L1897) | <script type="text/javascript"> |
| [1898](#L1898) | jQuery(document).ready(function($){ |
| [1899](#L1899) | var bpalite\_deactivateURL = $("#bpa-deactivate-link-<?php echo esc\_attr('BookingPressLite'); ?>") |
| [1900](#L1900) | bpalite\_formContainer = $('#bpa-deactivate-form-<?php echo esc\_attr('BookingPressLite'); ?>'), |
| [1901](#L1901) | bpalite\_deactivated = true, |
| [1902](#L1902) | bpalite\_detailsStrings = { |
| [1903](#L1903) | 'setup-difficult' : '<?php echo esc\_html\_\_('What was the dificult part?', 'bookingpress-appointment-booking'); ?>', |
| [1904](#L1904) | 'docs-improvement' : '<?php echo esc\_html\_\_('What can we describe more?', 'bookingpress-appointment-booking'); ?>', |
| [1905](#L1905) | 'features' : '<?php echo esc\_html\_\_('How could we improve?', 'bookingpress-appointment-booking'); ?>', |
| [1906](#L1906) | 'better-plugin' : '<?php echo esc\_html\_\_('Can you mention it?', 'bookingpress-appointment-booking'); ?>', |
| [1907](#L1907) | 'incompatibility' : '<?php echo esc\_html\_\_('With what plugin or theme is incompatible?', 'bookingpress-appointment-booking'); ?>', |
| [1908](#L1908) | 'bought-premium' : '<?php echo esc\_html\_\_('Please specify experience', 'bookingpress-appointment-booking'); ?>', |
| [1909](#L1909) | 'maintenance' : '<?php echo esc\_html\_\_('Please specify', 'bookingpress-appointment-booking'); ?>', |
| [1910](#L1910) | }; |
| [1911](#L1911) |  |
| [1912](#L1912) | jQuery( bpalite\_deactivateURL).attr('onclick', "javascript:event.preventDefault();"); |
| [1913](#L1913) | jQuery( bpalite\_deactivateURL ).on("click", function(){ |
| [1914](#L1914) |  |
| [1915](#L1915) | function BPALiteSubmitData(bpalite\_data, bpalite\_formContainer) |
| [1916](#L1916) | { |
| [1917](#L1917) | bpalite\_data['action']          = 'bookingpress\_lite\_deactivate\_plugin'; |
| [1918](#L1918) | bpalite\_data['security']        = '<?php echo esc\_html(wp\_create\_nonce('bookingpress\_lite\_deactivate\_plugin')); ?>'; |
| [1919](#L1919) | bpalite\_data['dataType']        = 'json'; |
| [1920](#L1920) | bpalite\_formContainer.addClass( 'process-response' ); |
| [1921](#L1921) | bpalite\_formContainer.find(".deactivating-spinner").show(); |
| [1922](#L1922) | jQuery.post(ajaxurl,bpalite\_data,function(response) |
| [1923](#L1923) | { |
| [1924](#L1924) | window.location.href = bpalite\_url; |
| [1925](#L1925) |  |
| [1926](#L1926) | }); |
| [1927](#L1927) | } |
| [1928](#L1928) |  |
| [1929](#L1929) | var bpalite\_url = bpalite\_deactivateURL.attr( 'href' ); |
| [1930](#L1930) | jQuery('body').toggleClass('bpalite-deactivate-form-active'); |
| [1931](#L1931) |  |
| [1932](#L1932) | bpalite\_formContainer.show({complete: function(){ |
| [1933](#L1933) | var offset = bpalite\_formContainer.offset(); |
| [1934](#L1934) | if( offset.top < 50) { |
| [1935](#L1935) | $(this).parent().css('top', (50 - offset.top) + 'px') |
| [1936](#L1936) | } |
| [1937](#L1937) | jQuery('html,body').animate({ scrollTop: Math.max(0, offset.top - 50) }); |
| [1938](#L1938) | }}); |
| [1939](#L1939) |  |
| [1940](#L1940) | <?php  // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped -- Reason: output is properly escaped or hardcoded ?> |
| [1941](#L1941) | <?php if($this->bpa\_is\_pro\_active()) { |
| [1942](#L1942) | $html = $html2; |
| [1943](#L1943) | } ?> |
| [1944](#L1944) | bpalite\_formContainer.html( '<?php echo $html; //phpcs:ignore ?>'); |
| [1945](#L1945) |  |
| [1946](#L1946) |  |
| [1947](#L1947) | bpalite\_formContainer.on( 'change', 'input[type=radio]', function() |
| [1948](#L1948) | { |
| [1949](#L1949) | var bpalite\_detailsLabel = bpalite\_formContainer.find( '#bpalite-deactivate-details-label strong' ); |
| [1950](#L1950) | var bpalite\_anonymousLabel = bpalite\_formContainer.find( 'label[for="bpalite\_anonymous"]' )[0]; |
| [1951](#L1951) | var bpalite\_submitSpan = bpalite\_formContainer.find( '#bpalite-deactivate-submit-form span' )[0]; |
| [1952](#L1952) | var bpalite\_value = bpalite\_formContainer.find( 'input[name="bpalite-deactivate-reason"]:checked' ).val(); |
| [1953](#L1953) |  |
| [1954](#L1954) | bpalite\_detailsLabel.text( bpalite\_detailsStrings[ bpalite\_value ] ); |
| [1955](#L1955) | bpalite\_anonymousLabel.style.visibility = "visible"; |
| [1956](#L1956) | bpalite\_submitSpan.style.display = "inline-block"; |
| [1957](#L1957) | if(bpalite\_deactivated) |
| [1958](#L1958) | { |
| [1959](#L1959) | bpalite\_deactivated = false; |
| [1960](#L1960) | jQuery('#bpalite-deactivate-submit-form').removeAttr("disabled"); |
| [1961](#L1961) | bpalite\_formContainer.off('click', '#bpalite-deactivate-submit-form'); |
| [1962](#L1962) | bpalite\_formContainer.on('click', '#bpalite-deactivate-submit-form', function(e){ |
| [1963](#L1963) | e.preventDefault(); |
| [1964](#L1964) | var data = { |
| [1965](#L1965) | bpalite\_reason: bpalite\_formContainer.find('input[name="bpalite-deactivate-reason"]:checked').val(), |
| [1966](#L1966) | bpalite\_details: bpalite\_formContainer.find('#bpalite-deactivate-details').val(), |
| [1967](#L1967) | bpalite\_anonymous: bpalite\_formContainer.find('#bpalite\_anonymous:checked').length, |
| [1968](#L1968) | }; |
| [1969](#L1969) | BPALiteSubmitData(data, bpalite\_formContainer); |
| [1970](#L1970) | }); |
| [1971](#L1971) | } |
| [1972](#L1972) | }); |
| [1973](#L1973) |  |
| [1974](#L1974) | bpalite\_formContainer.on('click', '#bpalite-deactivate-submit-form', function(e){ |
| [1975](#L1975) | e.preventDefault(); |
| [1976](#L1976) | BPALiteSubmitData({}, bpalite\_formContainer); |
| [1977](#L1977) | }); |
| [1978](#L1978) | $('.bpalite-deactivate-form-bg').on('click',function(){ |
| [1979](#L1979) | bpalite\_formContainer.fadeOut(); |
| [1980](#L1980) | $('body').removeClass('bpalite-deactivate-form-active'); |
| [1981](#L1981) | }); |
| [1982](#L1982) |  |
| [1983](#L1983) | bpalite\_formContainer.on( 'change', '#bpalite-risk-confirm', function() { |
| [1984](#L1984) | if(jQuery(this).is(":checked")) { |
| [1985](#L1985) | $('#bpalite-deactivate-submit-btn').removeAttr("disabled"); |
| [1986](#L1986) | } else { |
| [1987](#L1987) | $('#bpalite-deactivate-submit-btn').attr('disabled','disabled'); |
| [1988](#L1988) | } |
| [1989](#L1989) | }); |
| [1990](#L1990) | bpalite\_formContainer.on( 'click', '#bpalite-deactivate-cancel-btn', function(e) { |
| [1991](#L1991) | e.preventDefault(); |
| [1992](#L1992) | bpalite\_formContainer.fadeOut(); |
| [1993](#L1993) | $('body').removeClass('bpalite-deactivate-form-active'); |
| [1994](#L1994) | return false; |
| [1995](#L1995) | }); |
| [1996](#L1996) | bpalite\_formContainer.on( 'click', '#bpalite-deactivate-submit-btn', function() { |
| [1997](#L1997) | window.location.href = bpalite\_url; |
| [1998](#L1998) | return false; |
| [1999](#L1999) | }); |
| [2000](#L2000) | }); |
| [2001](#L2001) | }); |
| [2002](#L2002) | </script> |
| [2003](#L2003) | <?php |
| [2004](#L2004) | } |
| [2005](#L2005) |  |
| [2006](#L2006) |  |
| [2007](#L2007) | /\*\* |
| [2008](#L2008) | \* Update lite version details |
| [2009](#L2009) | \* |
| [2010](#L2010) | \* @return void |
| [2011](#L2011) | \*/ |
| [2012](#L2012) | function upgrade\_data() |
| [2013](#L2013) | { |
| [2014](#L2014) | global $bookingpress\_version; |
| [2015](#L2015) | $bookingpress\_old\_version = get\_option('bookingpress\_version', true); |
| [2016](#L2016) | if (version\_compare($bookingpress\_old\_version, '1.1.25', '<') ) { |
| [2017](#L2017) | $bookingpress\_load\_upgrade\_file = BOOKINGPRESS\_VIEWS\_DIR . '/upgrade\_latest\_data.php'; |
| [2018](#L2018) | include $bookingpress\_load\_upgrade\_file; |
| [2019](#L2019) | $this->bookingpress\_send\_anonymous\_data\_cron(); |
| [2020](#L2020) | } |
| [2021](#L2021) | } |
| [2022](#L2022) |  |
| [2023](#L2023) | /\*\* |
| [2024](#L2024) | \* Hide all admin notices when Bookingpress page loads |
| [2025](#L2025) | \* |
| [2026](#L2026) | \* @return void |
| [2027](#L2027) | \*/ |
| [2028](#L2028) | function bookingpress\_hide\_admin\_notices() |
| [2029](#L2029) | { |
| [2030](#L2030) | if (! empty($\_GET['page']) && ( $\_GET['page'] == 'bookingpress' ) ) { |
| [2031](#L2031) | remove\_all\_actions('network\_admin\_notices', 100); |
| [2032](#L2032) | remove\_all\_actions('user\_admin\_notices', 100); |
| [2033](#L2033) | remove\_all\_actions('admin\_notices', 100); |
| [2034](#L2034) | remove\_all\_actions('all\_admin\_notices', 100); |
| [2035](#L2035) | } |
| [2036](#L2036) | } |
| [2037](#L2037) |  |
| [2038](#L2038) | /\*\* |
| [2039](#L2039) | \* Display admin notices |
| [2040](#L2040) | \* |
| [2041](#L2041) | \* @return void |
| [2042](#L2042) | \*/ |
| [2043](#L2043) | function bookingpress\_admin\_notices() |
| [2044](#L2044) | { |
| [2045](#L2045) | global $bookingpress\_version; |
| [2046](#L2046) | $bookingpress\_get\_php\_version = ( function\_exists('phpversion') ) ? phpversion() : 0; |
| [2047](#L2047) | $notice\_html                  = ''; |
| [2048](#L2048) | if (version\_compare($GLOBALS['wp\_version'], '5.0', '<') ) { |
| [2049](#L2049) | $notice\_html .= '<div class="bpa-notice bpa-notice-error" style="display: block !important; position: relative !important; z-index: 9999 !important;">'; |
| [2050](#L2050) | $notice\_html .= '<p>' . esc\_html\_\_('BookingPress - WordPress Appointment Booking Plugin requires a minimum WordPress version of 5.0.', 'bookingpress-appointment-booking') . '</p>'; |
| [2051](#L2051) | $notice\_html .= '</div>'; |
| [2052](#L2052) | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped -- Reason: output is properly escaped or hardcoded |
| [2053](#L2053) | echo $notice\_html; |
| [2054](#L2054) | } |
| [2055](#L2055) | $bookingpress\_customize\_changes\_notice = get\_option('bookingpress\_customize\_changes\_notice\_1.0.51'); |
| [2056](#L2056) | if($bookingpress\_customize\_changes\_notice !='' && $bookingpress\_customize\_changes\_notice == 1) { |
| [2057](#L2057) | $addon\_warning\_notice = esc\_html\_\_('Please save your customization changes once from BookingPress -> Customize -> Forms', 'bookingpress-appointment-booking'); |
| [2058](#L2058) | echo '<div class="notice notice-warning is-dismissible bpa\_customize\_error\_notice" data-bookingpress\_confirm="'.esc\_html\_\_('Are you sure you have confirm the changes?', 'bookingpress-appointment-booking').'"><p>'.$addon\_warning\_notice. '</p></div>'; // phpcs:ignore |
| [2059](#L2059) | } |
| [2060](#L2060) | $bookingpress\_pro\_version = get\_option('bookingpress\_pro\_version'); |
| [2061](#L2061) | if( file\_exists(WP\_PLUGIN\_DIR . '/bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php') && !empty($bookingpress\_pro\_version) && version\_compare($bookingpress\_pro\_version,'2.5','<')){ |
| [2062](#L2062) | $addon\_notice\_cal = esc\_html\_\_("It's highly recommended that BookingPress premium plugin should be updated to it's latest version to get latest changes of 'Calendar' page at the backend", "bookingpress-appointment-booking"); |
| [2063](#L2063) | echo "<div class='notice notice-error is-dismissible'><p>" .$addon\_notice\_cal. "</p></div>";  //phpcs:ignore |
| [2064](#L2064) | } |
| [2065](#L2065) |  |
| [2066](#L2066) | $bpa\_update\_elementor\_notice = get\_option( 'bookingpress\_update\_elementor\_widget' ); |
| [2067](#L2067) | if( !empty( $bpa\_update\_elementor\_notice ) && 1 == $bpa\_update\_elementor\_notice ){ |
| [2068](#L2068) |  |
| [2069](#L2069) | $admin\_notice\_elm = esc\_html\_\_( 'From BookingPress version 1.1.11, the two Elementor widgets are deprecated. Please click below button to update with the latest.', 'bookingpress-appointment-booking' ); |
| [2070](#L2070) |  |
| [2071](#L2071) | echo '<div class="notice notice-error bookingpress-elementor-widget-notice" style="padding: 5px 12px 15px 12px;"><p>'.$admin\_notice\_elm.'</p><button type="button" class="button bookingpress\_replace\_elementor\_widgets button-primary button-large" >'.esc\_html\_\_( 'Update Elementor Widgets', 'bookingpress-appointment-booking' ).'</button>&nbsp;<span class="bpa\_update\_message" style="display:inline-block; height:32px; line-height:32px; padding: 0 5px;"></span><span class="spinner bpa\_elementor\_update\_spinner" style="float:none;margin-top:-25px;" ></span><br/></div>'; //phpcs:ignore |
| [2072](#L2072) |  |
| [2073](#L2073) | } |
| [2074](#L2074) | } |
| [2075](#L2075) |  |
| [2076](#L2076) | /\*\* |
| [2077](#L2077) | \* Load admin side main script at footer |
| [2078](#L2078) | \* |
| [2079](#L2079) | \* @return void |
| [2080](#L2080) | \*/ |
| [2081](#L2081) | function bookingpress\_admin\_footer\_func(){ |
| [2082](#L2082) |  |
| [2083](#L2083) | $requested\_module = ! empty($\_REQUEST['page']) ? sanitize\_text\_field($\_REQUEST['page']) : 'dashboard'; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [2084](#L2084) | if (strpos($requested\_module, 'bookingpress\_') !== false || $requested\_module == 'bookingpress' ) { |
| [2085](#L2085) | global $bookingpress\_global\_options, $BookingPress; |
| [2086](#L2086) | $bookingpress\_global\_details  = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [2087](#L2087) | $bpa\_time\_format\_for\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [2088](#L2088) |  |
| [2089](#L2089) | $bookingpress\_default\_date\_format = $BookingPress->bookingpress\_check\_common\_date\_format($bookingpress\_global\_details['wp\_default\_date\_format']); |
| [2090](#L2090) | $bookingpress\_site\_current\_language = $bookingpress\_global\_options->bookingpress\_get\_site\_current\_language(); |
| [2091](#L2091) |  |
| [2092](#L2092) | $is\_compitible\_with\_pro = 0; |
| [2093](#L2093) | if( $this->bpa\_is\_pro\_exists() && $this->bpa\_is\_pro\_active() ){ |
| [2094](#L2094) | if( !empty( $this->bpa\_pro\_plugin\_version() ) && version\_compare( $this->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [2095](#L2095) | $is\_compitible\_with\_pro = 1; |
| [2096](#L2096) | } |
| [2097](#L2097) | } |
| [2098](#L2098) | $requested\_module = ( ! empty($\_REQUEST['page']) && ( $\_REQUEST['page'] != 'bookingpress' ) ) ? sanitize\_text\_field(str\_replace('bookingpress\_', '', sanitize\_text\_field($\_REQUEST['page']))) : 'dashboard'; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [2099](#L2099) | ?> |
| [2100](#L2100) | <script> |
| [2101](#L2101) | var bookingpress\_requested\_module = '<?php echo esc\_html($requested\_module); ?>'; |
| [2102](#L2102) | var bookingpress\_start\_of\_week = "<?php echo esc\_html($bookingpress\_global\_details['start\_of\_week']); ?>"; |
| [2103](#L2103) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_helper\_vars'); ?> |
| [2104](#L2104) | var app; |
| [2105](#L2105) | window.addEventListener('DOMContentLoaded', function() { |
| [2106](#L2106) | app = new Vue({ |
| [2107](#L2107) | el: '#root\_app', |
| [2108](#L2108) | directives: { |
| [2109](#L2109) | cancelReadOnly(el){ |
| [2110](#L2110) | const input = el.querySelector('.el-input\_\_inner'); |
| [2111](#L2111) | input.removeAttribute('readonly'); |
| [2112](#L2112) | }, |
| [2113](#L2113) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_directives'); ?> |
| [2114](#L2114) | }, |
| [2115](#L2115) | components: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_components'); ?> }, |
| [2116](#L2116) | data() { |
| [2117](#L2117) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields\_vars'); ?> |
| [2118](#L2118) |  |
| [2119](#L2119) | var bookingpress\_return\_data = <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields'); ?>; |
| [2120](#L2120) | bookingpress\_return\_data['needHelpDrawer'] = false; |
| [2121](#L2121) | bookingpress\_return\_data['needHelpDrawerDirection'] = 'rtl'; |
| [2122](#L2122) | bookingpress\_return\_data['needHelpDrawer\_add'] = false; |
| [2123](#L2123) | bookingpress\_return\_data['add\_needHelpDrawerDirection'] = 'rtl'; |
| [2124](#L2124) | bookingpress\_return\_data['helpDrawerData'] = ''; |
| [2125](#L2125) | bookingpress\_return\_data['close\_modal\_on\_esc'] = false; |
| [2126](#L2126) | <?php |
| [2127](#L2127) | $bookingpress\_site\_date = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [2128](#L2128) | $bookingpress\_site\_date = apply\_filters( 'bookingpress\_modify\_current\_date', $bookingpress\_site\_date ); |
| [2129](#L2129) | if( !empty( $bookingpress\_site\_date ) ){ |
| [2130](#L2130) | $bookingpress\_site\_current\_date = date( 'Y-m-d', strtotime( $bookingpress\_site\_date ) ) . ' 00:00:00'; |
| [2131](#L2131) | } else { |
| [2132](#L2132) | $bookingpress\_site\_current\_date = ""; |
| [2133](#L2133) | } |
| [2134](#L2134) | ?> |
| [2135](#L2135) | bookingpress\_return\_data["jsCurrentDate"] = new Date(<?php echo !empty( $bookingpress\_site\_date ) ? '"' . esc\_html( $bookingpress\_site\_date ) . '"' : ''; ?>); |
| [2136](#L2136) | bookingpress\_return\_data["jsCurrentDateFormatted"] = new Date (<?php echo !empty( $bookingpress\_site\_current\_date ) ? '"' . esc\_html($bookingpress\_site\_current\_date) . '"' : '' ?>); |
| [2137](#L2137) | bookingpress\_return\_data['is\_display\_drawer\_loader'] = '0'; |
| [2138](#L2138) | bookingpress\_return\_data["jsCurrentOnlyDate"] = bookingpress\_return\_data['jsCurrentDateFormatted'].toISOString().split("T")[0]; |
| [2139](#L2139) | bookingpress\_return\_data['requested\_module'] = bookingpress\_requested\_module; |
| [2140](#L2140) | bookingpress\_return\_data['read\_more\_link'] = '#'; |
| [2141](#L2141) | bookingpress\_return\_data['site\_locale'] = '<?php echo esc\_html($bookingpress\_site\_current\_language); ?>'; |
| [2142](#L2142) | bookingpress\_return\_data['site\_date'] = '<?php echo esc\_html(date('Y-m-d H:i:s', current\_time( 'timestamp') )); ?>'; |
| [2143](#L2143) | bookingpress\_return\_data['premium\_modal'] = false; |
| [2144](#L2144) | bookingpress\_return\_data['bookingpress\_old\_premium\_modal'] = false; |
| [2145](#L2145) | bookingpress\_return\_data['is\_compitible\_with\_pro'] = '<?php echo esc\_html($is\_compitible\_with\_pro); ?>'; |
| [2146](#L2146) | bookingpress\_return\_data['current\_screen\_size'] = 'desktop'; |
| [2147](#L2147) | bookingpress\_return\_data['bpa\_fab\_floating\_btn'] = '0'; |
| [2148](#L2148) | bookingpress\_return\_data['bpa\_date\_common\_date\_format'] = '<?php echo esc\_html($bookingpress\_default\_date\_format); ?>'; |
| [2149](#L2149) | bookingpress\_return\_data['bpa\_date\_time\_common\_date\_format'] = '<?php echo esc\_html($bookingpress\_default\_date\_format); ?>'+' HH:mm'; |
| [2150](#L2150) |  |
| [2151](#L2151) | <?php do\_action('bookingpress\_admin\_vue\_data\_variables\_script'); ?> |
| [2152](#L2152) |  |
| [2153](#L2153) | <?php |
| [2154](#L2154) | $bookingpress\_allowed\_disable\_date\_filter\_pickeroptions = apply\_filters( 'bookingpress\_allowed\_disable\_date\_filter\_pickeroptions', false, $requested\_module); |
| [2155](#L2155) | if (( isset($\_REQUEST['page']) && $\_REQUEST['page'] == 'bookingpress' ) || $bookingpress\_allowed\_disable\_date\_filter\_pickeroptions || $requested\_module == 'appointments' || $requested\_module == 'calendar' || $requested\_module == 'services' || $requested\_module == 'staff\_members' || $requested\_module == 'settings' || $requested\_module == 'timesheet' || $requested\_module == 'payments' || $requested\_module == 'customize' || $requested\_module == 'customers') { |
| [2156](#L2156) | ?> |
| [2157](#L2157) | bookingpress\_return\_data['pickerOptions'] = { |
| [2158](#L2158) | disabledDate(Time) { |
| [2159](#L2159) | var dd = String(Time.getDate()).padStart(2, '0'); |
| [2160](#L2160) | var mm = String(Time.getMonth() + 1).padStart(2, '0'); //January is 0! |
| [2161](#L2161) | var yyyy = Time.getFullYear(); |
| [2162](#L2162) | var time = yyyy+ '-' + mm + '-' + dd; |
| [2163](#L2163) | if( "undefined" == typeof bookingpress\_return\_data['disabledDates'].indexOf ){ |
| [2164](#L2164) | var date = new Date(); |
| [2165](#L2165) | var newDateArr = []; |
| [2166](#L2166) | for( let dcount in bookingpress\_return\_data['disabledDates'] ){ |
| [2167](#L2167) | let dis\_date = bookingpress\_return\_data['disabledDates'][dcount]; |
| [2168](#L2168) | newDateArr.push( dis\_date ); |
| [2169](#L2169) | } |
| [2170](#L2170) | var disable\_date = newDateArr.indexOf( time ) > -1; |
| [2171](#L2171) | var date = new Date(); |
| [2172](#L2172) | date.setDate(date.getDate()-1); |
| [2173](#L2173) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [2174](#L2174) | if(disable\_date == true) { |
| [2175](#L2175) | return disable\_date; |
| [2176](#L2176) | } else { |
| [2177](#L2177) | return disable\_past\_date; |
| [2178](#L2178) | } |
| [2179](#L2179) | } else { |
| [2180](#L2180) | var disable\_date = bookingpress\_return\_data['disabledDates'].indexOf(time) > -1; |
| [2181](#L2181) | var date = new Date(); |
| [2182](#L2182) | date.setDate(date.getDate()-1); |
| [2183](#L2183) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [2184](#L2184) | if(disable\_date == true) { |
| [2185](#L2185) | return disable\_date; |
| [2186](#L2186) | } else { |
| [2187](#L2187) | return disable\_past\_date; |
| [2188](#L2188) | } |
| [2189](#L2189) | } |
| [2190](#L2190) | }, |
| [2191](#L2191) | 'firstDayOfWeek': parseInt(bookingpress\_start\_of\_week), |
| [2192](#L2192) | }, |
| [2193](#L2193) | bookingpress\_return\_data['filter\_pickerOptions'] = { |
| [2194](#L2194) | 'firstDayOfWeek': parseInt(bookingpress\_start\_of\_week), |
| [2195](#L2195) | }, |
| [2196](#L2196) | bookingpress\_return\_data['disablePastDates'] = { |
| [2197](#L2197) | disabledDate(Time) { |
| [2198](#L2198) | var dd = String(Time.getDate()).padStart(2, '0'); |
| [2199](#L2199) | var mm = String(Time.getMonth() + 1).padStart(2, '0'); //January is 0! |
| [2200](#L2200) | var yyyy = Time.getFullYear(); |
| [2201](#L2201) | var time = yyyy+ '-' + mm + '-' + dd ; |
| [2202](#L2202) | var disable\_date = bookingpress\_return\_data['disabledOtherDates'].indexOf(time)>-1; |
| [2203](#L2203) | var date = new Date(); |
| [2204](#L2204) | date.setDate(date.getDate()-1); |
| [2205](#L2205) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [2206](#L2206) | if(disable\_date == true) { |
| [2207](#L2207) | return disable\_date; |
| [2208](#L2208) | } else { |
| [2209](#L2209) | return disable\_past\_date; |
| [2210](#L2210) | } |
| [2211](#L2211) | }, |
| [2212](#L2212) | 'firstDayOfWeek': parseInt(bookingpress\_start\_of\_week), |
| [2213](#L2213) | } |
| [2214](#L2214) | <?php |
| [2215](#L2215) | } |
| [2216](#L2216) | ?> |
| [2217](#L2217) | return bookingpress\_return\_data; |
| [2218](#L2218) | }, |
| [2219](#L2219) | computed: { |
| [2220](#L2220) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_computed\_methods'); ?> |
| [2221](#L2221) | }, |
| [2222](#L2222) | filters: { |
| [2223](#L2223) | bookingpress\_format\_time: function(value){ |
| [2224](#L2224) | var default\_time\_format = '<?php echo esc\_html($bpa\_time\_format\_for\_timeslot); ?>'; |
| [2225](#L2225) | return moment(String(value), "HH:mm:ss").format(default\_time\_format) |
| [2226](#L2226) | }, |
| [2227](#L2227) | <?php do\_action('bookingpress\_admin\_view\_filter'); ?> |
| [2228](#L2228) | }, |
| [2229](#L2229) | mounted() { |
| [2230](#L2230) | this.bpa\_set\_read\_more\_link(); |
| [2231](#L2231) | let admin\_menubar = document.getElementById('adminmenuwrap'); |
| [2232](#L2232) |  |
| [2233](#L2233) | if( null != admin\_menubar && admin\_menubar.offsetWidth > 160 ){ |
| [2234](#L2234) | document.body.classList.add('bpa\_menu\_large\_width'); |
| [2235](#L2235) | } |
| [2236](#L2236) | <?php do\_action('bookingpress\_admin\_vue\_on\_load\_script'); ?> |
| [2237](#L2237) | document.onreadystatechange = () => { |
| [2238](#L2238) | if (document.readyState == "complete") { |
| [2239](#L2239) | setTimeout(function(){ |
| [2240](#L2240) | if(document.getElementById('bpa-page-loading-loader') != null){ |
| [2241](#L2241) | document.getElementById('bpa-page-loading-loader').remove(); |
| [2242](#L2242) | document.getElementById('bpa-main-container').style.display = 'block'; |
| [2243](#L2243) | if(document.getElementById('bpa-page-loading-loader-2') != null){ |
| [2244](#L2244) | document.getElementById('bpa-page-loading-loader-2').remove(); |
| [2245](#L2245) | } |
| [2246](#L2246) | if(document.getElementById('bpa-main-container-2') != null){ |
| [2247](#L2247) | document.getElementById('bpa-main-container-2').style.display = 'block'; |
| [2248](#L2248) | } |
| [2249](#L2249) | if(document.getElementById('bpa-main-container-3') != null){ |
| [2250](#L2250) | document.getElementById('bpa-page-loading-loader-3').remove(); |
| [2251](#L2251) | document.getElementById('bpa-main-container-3').style.display = 'block'; |
| [2252](#L2252) | } |
| [2253](#L2253) | jQuery("#bpa-loader-div").show(); |
| [2254](#L2254) | } |
| [2255](#L2255) | }, 2000); |
| [2256](#L2256) | this.bookingpress\_remove\_focus\_for\_popover(); |
| [2257](#L2257) | } |
| [2258](#L2258) | } |
| [2259](#L2259) |  |
| [2260](#L2260) | if(window.screen.width >= 1200){ |
| [2261](#L2261) | this.current\_screen\_size = "desktop"; |
| [2262](#L2262) | }else if(window.screen.width < 1200 && window.screen.width >= 768){ |
| [2263](#L2263) | this.current\_screen\_size = "tablet"; |
| [2264](#L2264) | }else if(window.screen.width < 768){ |
| [2265](#L2265) | this.current\_screen\_size = "mobile"; |
| [2266](#L2266) | } |
| [2267](#L2267) |  |
| [2268](#L2268) | window.addEventListener('resize', function(event) { |
| [2269](#L2269) | if(window.screen.width >= 1200){ |
| [2270](#L2270) | this.current\_screen\_size = "desktop"; |
| [2271](#L2271) | }else if(window.screen.width < 1200 && window.screen.width >= 768){ |
| [2272](#L2272) | this.current\_screen\_size = "tablet"; |
| [2273](#L2273) | }else if(window.screen.width < 768){ |
| [2274](#L2274) | this.current\_screen\_size = "mobile"; |
| [2275](#L2275) | } |
| [2276](#L2276) | }); |
| [2277](#L2277) |  |
| [2278](#L2278) | this.responsiveMenu(); |
| [2279](#L2279) | if(window.screen.width <= 1024){ |
| [2280](#L2280) | document.body.className = document.body.className + ' folded'; |
| [2281](#L2281) | } |
| [2282](#L2282) | if(window.screen.width <= 1023){ |
| [2283](#L2283) | document.body.className = document.body.className + ' folded bookingpress-plugin-body-area'; |
| [2284](#L2284) | } |
| [2285](#L2285) | if(bookingpress\_requested\_module == "settings"){ |
| [2286](#L2286) | this.loadCalendarDates(); |
| [2287](#L2287) | } |
| [2288](#L2288) | jQuery(window).scroll(function() { |
| [2289](#L2289) | var scroll = jQuery(window).scrollTop(); |
| [2290](#L2290) | if (scroll > 46) { |
| [2291](#L2291) | jQuery("body").addClass("\_\_bpa-is-scroll-active"); |
| [2292](#L2292) | } |
| [2293](#L2293) | else { |
| [2294](#L2294) | jQuery("body").removeClass("\_\_bpa-is-scroll-active"); |
| [2295](#L2295) | } |
| [2296](#L2296) | }); |
| [2297](#L2297) |  |
| [2298](#L2298) | <?php |
| [2299](#L2299) | $bpa\_display\_after\_update = get\_option( 'bookingpress\_display\_bf\_popup\_after\_update' ); |
| [2300](#L2300) | $bpa\_is\_dispayed\_before\_end = get\_option( 'bpa\_is\_displayed\_bf\_sale\_popup' ); |
| [2301](#L2301) | $bpa\_current\_date\_for\_bf\_popup = current\_time('timestamp',true); //GMT/ UTC+00 timeszone |
| [2302](#L2302) |  |
| [2303](#L2303) | $bpa\_display\_bf\_popup = false; |
| [2304](#L2304) | $bpa\_bf\_popup\_start\_time = $this->bookingpress\_get\_bf\_sale\_start\_time(); |
| [2305](#L2305) | $bpa\_bf\_popup\_end\_time = $this->bookingpress\_get\_bf\_sale\_end\_time(); |
| [2306](#L2306) | if( ( isset($\_REQUEST['page']) && $\_REQUEST['page'] != 'bookingpress\_lite\_wizard') && ( 'false' == $bpa\_is\_dispayed\_before\_end || false == $bpa\_is\_dispayed\_before\_end ) && ( $bpa\_current\_date\_for\_bf\_popup >= $bpa\_bf\_popup\_start\_time && $bpa\_current\_date\_for\_bf\_popup <= $bpa\_bf\_popup\_end\_time ) ){ |
| [2307](#L2307) | $bpa\_display\_bf\_popup = true; |
| [2308](#L2308) | } |
| [2309](#L2309) | if( ( isset( $bpa\_display\_after\_update ) && 1 == $bpa\_display\_after\_update ) && true == $bpa\_display\_bf\_popup  ){ |
| [2310](#L2310) | ?> |
| [2311](#L2311) | this.premium\_modal = true; |
| [2312](#L2312) | <?php |
| [2313](#L2313) | update\_option( 'bookingpress\_display\_bf\_popup\_after\_update', 0 ); |
| [2314](#L2314) | if( true == $bpa\_display\_bf\_popup ){ |
| [2315](#L2315) | update\_option( 'bpa\_is\_displayed\_bf\_sale\_popup', true ); |
| [2316](#L2316) | update\_option('bookingpress\_display\_bf\_popup\_after\_update\_date',true); |
| [2317](#L2317) | } |
| [2318](#L2318) | } |
| [2319](#L2319) |  |
| [2320](#L2320) | $bpa\_bf\_popup\_start\_time = $this->bookingpress\_get\_bf\_sale\_start\_time(); |
| [2321](#L2321) | $bpa\_bf\_popup\_end\_time = $this->bookingpress\_get\_bf\_sale\_end\_time(); |
| [2322](#L2322) | if( $bpa\_current\_date\_for\_bf\_popup >= $bpa\_bf\_popup\_start\_time && $bpa\_current\_date\_for\_bf\_popup <= $bpa\_bf\_popup\_end\_time ) { |
| [2323](#L2323) | $bookingpress\_display\_bf\_popup\_after\_update\_date  = get\_option('bookingpress\_display\_bf\_popup\_after\_update\_date'); |
| [2324](#L2324) | if( $bookingpress\_display\_bf\_popup\_after\_update\_date == true ) { |
| [2325](#L2325) | ?> |
| [2326](#L2326) | this.premium\_modal = true; |
| [2327](#L2327) | <?php |
| [2328](#L2328) | update\_option( 'bookingpress\_display\_bf\_popup\_after\_update\_date',false); |
| [2329](#L2329) | } |
| [2330](#L2330) | } |
| [2331](#L2331) |  |
| [2332](#L2332) | do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_on\_load\_methods'); ?> |
| [2333](#L2333) | }, |
| [2334](#L2334) | methods: { |
| [2335](#L2335) | bpa\_set\_read\_more\_link(){ |
| [2336](#L2336) | const vm = this; |
| [2337](#L2337) | var bpa\_requested\_module = vm.requested\_module; |
| [2338](#L2338) | var read\_more\_link = ""; |
| [2339](#L2339) | <?php |
| [2340](#L2340) | $page\_action = isset($\_REQUEST['action']) ? sanitize\_text\_field($\_REQUEST['action']) : ''; |
| [2341](#L2341) | ?> |
| [2342](#L2342) | if(bpa\_requested\_module == "dashboard"){ |
| [2343](#L2343) | read\_more\_link = "https://www.bookingpressplugin.com/documents/dashboard/"; |
| [2344](#L2344) | }else if(bpa\_requested\_module == "services"){ |
| [2345](#L2345) | read\_more\_link = "https://www.bookingpressplugin.com/documents/services/"; |
| [2346](#L2346) | }else if(bpa\_requested\_module == "customers"){ |
| [2347](#L2347) | read\_more\_link = "https://www.bookingpressplugin.com/documents/customers/"; |
| [2348](#L2348) | }else if(bpa\_requested\_module == "calendar"){ |
| [2349](#L2349) | read\_more\_link = "https://www.bookingpressplugin.com/documents/admin-calender-view/"; |
| [2350](#L2350) | }else if(bpa\_requested\_module == "appointments"){ |
| [2351](#L2351) | read\_more\_link = "https://www.bookingpressplugin.com/documents/appointments/"; |
| [2352](#L2352) | }else if(bpa\_requested\_module == "notifications"){ |
| [2353](#L2353) | read\_more\_link = "https://www.bookingpressplugin.com/documents/email-notifications-message/"; |
| [2354](#L2354) | }else if(bpa\_requested\_module == "payments"){ |
| [2355](#L2355) | read\_more\_link = "https://www.bookingpressplugin.com/documents/payment/"; |
| [2356](#L2356) | }else if(bpa\_requested\_module == "customize") { |
| [2357](#L2357) | <?php if($page\_action == 'form\_fields') { ?> |
| [2358](#L2358) | read\_more\_link = "https://www.bookingpressplugin.com/documents/customize-custom-fields/"; |
| [2359](#L2359) | <?php } else { ?> |
| [2360](#L2360) | read\_more\_link = "https://www.bookingpressplugin.com/documents/customize-booking-form/"; |
| [2361](#L2361) | <?php } ?> |
| [2362](#L2362) | }else if(bpa\_requested\_module == "lite\_wizard"){ |
| [2363](#L2363) | read\_more\_link = "https://www.bookingpressplugin.com/documents/installing-updating-bookingpress/"; |
| [2364](#L2364) | }else if(bpa\_requested\_module == "addons"){ |
| [2365](#L2365) | read\_more\_link = "https://www.bookingpressplugin.com/addons"; |
| [2366](#L2366) | }else if(bpa\_requested\_module == "settings"){ |
| [2367](#L2367) | read\_more\_link = "https://www.bookingpressplugin.com/documents/general-settings/"; |
| [2368](#L2368) | var selected\_tab = sessionStorage.getItem("current\_tabname"); |
| [2369](#L2369) | if(selected\_tab == "general\_settings"){ |
| [2370](#L2370) | read\_more\_link = "https://www.bookingpressplugin.com/documents/general-settings/"; |
| [2371](#L2371) | }else if(selected\_tab == "company\_settings"){ |
| [2372](#L2372) | read\_more\_link = "https://www.bookingpressplugin.com/documents/company-settings/"; |
| [2373](#L2373) | }else if(selected\_tab == "notification\_settings"){ |
| [2374](#L2374) | read\_more\_link = "https://www.bookingpressplugin.com/documents/notifications-settings/"; |
| [2375](#L2375) | }else if(selected\_tab == "workhours\_settings"){ |
| [2376](#L2376) | read\_more\_link = "https://www.bookingpressplugin.com/documents/work-hours-settings/"; |
| [2377](#L2377) | }else if(selected\_tab == "dayoff\_settings"){ |
| [2378](#L2378) | read\_more\_link = "https://www.bookingpressplugin.com/documents/holidays-settings/"; |
| [2379](#L2379) | }else if(selected\_tab == "payment\_settings"){ |
| [2380](#L2380) | read\_more\_link = "https://www.bookingpressplugin.com/documents/payments-settings/"; |
| [2381](#L2381) | }else if(selected\_tab == "message\_settings"){ |
| [2382](#L2382) | read\_more\_link = "https://www.bookingpressplugin.com/documents/messages-settings/"; |
| [2383](#L2383) | }else if(selected\_tab == "debug\_log\_settings"){ |
| [2384](#L2384) | read\_more\_link = "https://www.bookingpressplugin.com/documents/debug-log-settings/"; |
| [2385](#L2385) | } |
| [2386](#L2386) | }else{ |
| [2387](#L2387) | var selected\_tab = sessionStorage.getItem("current\_tabname"); |
| [2388](#L2388) | if(selected\_tab == "general\_settings"){ |
| [2389](#L2389) | read\_more\_link = "https://www.bookingpressplugin.com/documents/general-settings/"; |
| [2390](#L2390) | }else if(selected\_tab == "company\_settings"){ |
| [2391](#L2391) | read\_more\_link = "https://www.bookingpressplugin.com/documents/company-settings/"; |
| [2392](#L2392) | }else if(selected\_tab == "notification\_settings"){ |
| [2393](#L2393) | read\_more\_link = "https://www.bookingpressplugin.com/documents/notifications-settings/"; |
| [2394](#L2394) | }else if(selected\_tab == "workhours\_settings"){ |
| [2395](#L2395) | read\_more\_link = "https://www.bookingpressplugin.com/documents/work-hours-settings/"; |
| [2396](#L2396) | }else if(selected\_tab == "dayoff\_settings"){ |
| [2397](#L2397) | read\_more\_link = "https://www.bookingpressplugin.com/documents/holidays-settings/"; |
| [2398](#L2398) | }else if(selected\_tab == "payment\_settings"){ |
| [2399](#L2399) | read\_more\_link = "https://www.bookingpressplugin.com/documents/payments-settings/"; |
| [2400](#L2400) | }else if(selected\_tab == "message\_settings"){ |
| [2401](#L2401) | read\_more\_link = "https://www.bookingpressplugin.com/documents/messages-settings/"; |
| [2402](#L2402) | }else if(selected\_tab == "debug\_log\_settings"){ |
| [2403](#L2403) | read\_more\_link = "https://www.bookingpressplugin.com/documents/debug-log-settings/"; |
| [2404](#L2404) | } |
| [2405](#L2405) | } |
| [2406](#L2406) |  |
| [2407](#L2407) | <?php |
| [2408](#L2408) | do\_action('bookingpress\_modify\_readmore\_link'); |
| [2409](#L2409) | ?> |
| [2410](#L2410) |  |
| [2411](#L2411) | vm.read\_more\_link = read\_more\_link; |
| [2412](#L2412) | }, |
| [2413](#L2413) | bpa\_fab\_floating\_action\_btn(){ |
| [2414](#L2414) | const vm = this; |
| [2415](#L2415) | vm.bpa\_fab\_floating\_btn = 1; |
| [2416](#L2416) | }, |
| [2417](#L2417) | bpa\_fab\_floating\_close\_btn(){ |
| [2418](#L2418) | const vm = this; |
| [2419](#L2419) | vm.bpa\_fab\_floating\_btn = 0; |
| [2420](#L2420) | }, |
| [2421](#L2421) | open\_premium\_modal(){ |
| [2422](#L2422) | const vm = this; |
| [2423](#L2423) | <?php |
| [2424](#L2424) | $bpa\_current\_date\_for\_bf\_popup = current\_time('timestamp', true); //GMT/ UTC+00 timeszone |
| [2425](#L2425) | $bpa\_bf\_popup\_start\_time = $this->bookingpress\_get\_bf\_sale\_start\_time(); |
| [2426](#L2426) | $bpa\_bf\_popup\_end\_time = $this->bookingpress\_get\_bf\_sale\_end\_time(); |
| [2427](#L2427) | if( $bpa\_current\_date\_for\_bf\_popup >= $bpa\_bf\_popup\_start\_time && $bpa\_current\_date\_for\_bf\_popup <= $bpa\_bf\_popup\_end\_time ) { |
| [2428](#L2428) | ?> |
| [2429](#L2429) | vm.premium\_modal = true; |
| [2430](#L2430) | vm.bookingpress\_old\_premium\_modal = false; |
| [2431](#L2431) | <?php |
| [2432](#L2432) | }else{ ?> |
| [2433](#L2433) | vm.bookingpress\_old\_premium\_modal = true; |
| [2434](#L2434) | vm.premium\_modal = false; |
| [2435](#L2435) | <?php } ?> |
| [2436](#L2436) | }, |
| [2437](#L2437) | bpa\_close\_premium\_modal(){ |
| [2438](#L2438) | const vm = this; |
| [2439](#L2439) | vm.premium\_modal = false; |
| [2440](#L2440) | vm.bookingpress\_old\_premium\_modal = false; |
| [2441](#L2441) | }, |
| [2442](#L2442) | bookingpress\_redirect\_premium\_page(){ |
| [2443](#L2443) | window.open('https://www.bookingpressplugin.com/pricing/?utm\_source=liteversion&utm\_medium=plugin&utm\_campaign=Upgrade+to+Premium&utm\_id=bookingpress\_2', '\_blank'); |
| [2444](#L2444) | }, |
| [2445](#L2445) | bookingpress\_redirect\_sale\_premium\_page(){ |
| [2446](#L2446) | window.open('https://www.bookingpressplugin.com/pricing/?utm\_source=liteversion&utm\_medium=plugin&utm\_campaign=BFCM\_2024&utm\_id=bookingpress\_2', '\_blank'); |
| [2447](#L2447) | }, |
| [2448](#L2448) | bookingpress\_redirect\_lite\_vs\_preminum\_page(){ |
| [2449](#L2449) | window.open('https://www.bookingpressplugin.com/bookingpress-lite-vs-premium', '\_blank'); |
| [2450](#L2450) | }, |
| [2451](#L2451) | bookingpress\_redirect\_lite\_vs\_other\_page(){ |
| [2452](#L2452) | window.open('https://www.bookingpressplugin.com/bookly-vs-amelia-vs-bookingpress', '\_blank'); |
| [2453](#L2453) | }, |
| [2454](#L2454) | async loadCalendarDates(selected\_year = new Date().getFullYear()){ |
| [2455](#L2455) | const vm = this |
| [2456](#L2456) | for(var i=0; i<=11; i++){ |
| [2457](#L2457) | var bookingpress\_calendar\_start\_date = new Date(); |
| [2458](#L2458) | bookingpress\_calendar\_start\_date.setFullYear(selected\_year, i, 1); |
| [2459](#L2459) |  |
| [2460](#L2460) | var bookingpress\_calendar\_end\_date = new Date(); |
| [2461](#L2461) | bookingpress\_calendar\_end\_date.setFullYear(selected\_year, i+1, 0); |
| [2462](#L2462) |  |
| [2463](#L2463) | var calendar\_name = 'calendar\_'+i; |
| [2464](#L2464) | var bookingpress\_calendar\_obj = vm.$refs[calendar\_name]; |
| [2465](#L2465) | await bookingpress\_calendar\_obj.move(bookingpress\_calendar\_start\_date) |
| [2466](#L2466) | } |
| [2467](#L2467) | }, |
| [2468](#L2468) | bookingpress\_get\_elm\_parents(elem, selector) { |
| [2469](#L2469) |  |
| [2470](#L2470) | if (!Element.prototype.matches) { |
| [2471](#L2471) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [2472](#L2472) | Element.prototype.mozMatchesSelector || |
| [2473](#L2473) | Element.prototype.msMatchesSelector || |
| [2474](#L2474) | Element.prototype.oMatchesSelector || |
| [2475](#L2475) | Element.prototype.webkitMatchesSelector || |
| [2476](#L2476) | function(s) { |
| [2477](#L2477) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [2478](#L2478) | i = matches.length; |
| [2479](#L2479) | while (--i >= 0 && matches.item(i) !== this) {} |
| [2480](#L2480) | return i > -1; |
| [2481](#L2481) | }; |
| [2482](#L2482) | } |
| [2483](#L2483) |  |
| [2484](#L2484) | var parents = []; |
| [2485](#L2485) |  |
| [2486](#L2486) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [2487](#L2487) | if (selector) { |
| [2488](#L2488) | if (elem.matches(selector)) { |
| [2489](#L2489) | parents.push(elem); |
| [2490](#L2490) | } |
| [2491](#L2491) | continue; |
| [2492](#L2492) | } |
| [2493](#L2493) | parents.push(elem); |
| [2494](#L2494) | } |
| [2495](#L2495) |  |
| [2496](#L2496) | return parents; |
| [2497](#L2497) | }, |
| [2498](#L2498) | bookingpress\_remove\_focus\_for\_popover(){ |
| [2499](#L2499) | const vm = this; |
| [2500](#L2500) | let list\_items = document.querySelectorAll( '.list-group-item' ); |
| [2501](#L2501) | if( list\_items.length > 0 ){ |
| [2502](#L2502) | for( l = 0; l < list\_items.length; l++ ){ |
| [2503](#L2503) | let current\_item = list\_items[l]; |
| [2504](#L2504) | current\_item.addEventListener('mouseout', function(e){ |
| [2505](#L2505) |  |
| [2506](#L2506) | let tooltipElm = e.target.querySelector('.bpa-table-actions span.el-tooltip'); |
| [2507](#L2507) | if( null != tooltipElm ){ |
| [2508](#L2508) |  |
| [2509](#L2509) | let has\_popover = tooltipElm.querySelector('.el-button.bpa-btn'); |
| [2510](#L2510) |  |
| [2511](#L2511) | if( null != has\_popover ){ |
| [2512](#L2512) | let popoverId = has\_popover.getAttribute('aria-describedby'); |
| [2513](#L2513) | let popoverDiv = document.getElementById( popoverId ); |
| [2514](#L2514) | let target = e.target; |
| [2515](#L2515) | if( target.classList.contains('list-group-item') && target.nodename == 'SPAN' ){ |
| [2516](#L2516) | return false; |
| [2517](#L2517) | } |
| [2518](#L2518) | let toElm = e.toElement; |
| [2519](#L2519) | let target\_parents = vm.bookingpress\_get\_elm\_parents( toElm, '.list-group-item'); |
| [2520](#L2520) |  |
| [2521](#L2521) | if( target\_parents.length > 0 ){ |
| [2522](#L2522) | return false; |
| [2523](#L2523) | } |
| [2524](#L2524) |  |
| [2525](#L2525) | if( null != popoverDiv ){ |
| [2526](#L2526) | let popover\_pos = popoverDiv.getBoundingClientRect(); |
| [2527](#L2527) | let is\_popover\_visible = ( popover\_pos.width > 0 && popover\_pos.height > 0 ) ? true : false; |
| [2528](#L2528) |  |
| [2529](#L2529) | if( is\_popover\_visible ){ |
| [2530](#L2530) | let parent\_elm = vm.bookingpress\_get\_elm\_parents( toElm, '#' + popoverId ); |
| [2531](#L2531) |  |
| [2532](#L2532) | if( 1 > parent\_elm.length ){ |
| [2533](#L2533) | let refBtn = document.querySelector( `.el-popover\_\_reference[aria-describedby="${popoverId}"]`); |
| [2534](#L2534) | refBtn.click(); |
| [2535](#L2535) | return false; |
| [2536](#L2536) | } |
| [2537](#L2537) |  |
| [2538](#L2538) | popoverDiv.addEventListener( 'mouseout', function(e){ |
| [2539](#L2539) | let parent\_elm2 = vm.bookingpress\_get\_elm\_parents( e.toElement, '#' + popoverId); |
| [2540](#L2540) |  |
| [2541](#L2541) | if( 1 > parent\_elm2.length ){ |
| [2542](#L2542) | let refBtn = document.querySelector( `.el-popover\_\_reference[aria-describedby="${popoverId}"]`); |
| [2543](#L2543) | refBtn.click(); |
| [2544](#L2544) | return false; |
| [2545](#L2545) | } |
| [2546](#L2546) | }); |
| [2547](#L2547) | } |
| [2548](#L2548) |  |
| [2549](#L2549) |  |
| [2550](#L2550) |  |
| [2551](#L2551) | } |
| [2552](#L2552) |  |
| [2553](#L2553) | } |
| [2554](#L2554) | } |
| [2555](#L2555) | }); |
| [2556](#L2556) | } |
| [2557](#L2557) | } |
| [2558](#L2558) |  |
| [2559](#L2559) | let calendar\_popover = document.querySelector('#calendar\_appointment\_popover\_dialog'); |
| [2560](#L2560) | if( null != calendar\_popover ){ |
| [2561](#L2561) | calendar\_popover.addEventListener('mouseup', function(e){ |
| [2562](#L2562) | let click\_timestamp = vm.bpa\_calendar\_event\_click\_timestamp || 0; |
| [2563](#L2563) | let click\_parents = vm.bpa\_get\_target\_parent( e.target, '.bpa-fsc-item\_\_popover-card' ); |
| [2564](#L2564) | if( 0 == click\_parents.length ){ |
| [2565](#L2565) | let event\_timestamp = Math.round( e.timeStamp ); |
| [2566](#L2566) | if( (event\_timestamp - click\_timestamp) > 1000 ){ |
| [2567](#L2567) | vm.bpa\_calendar\_event\_click\_timestamp = 0; |
| [2568](#L2568) | vm.closeAppointmentBookingPopover(); |
| [2569](#L2569) | } |
| [2570](#L2570) | } |
| [2571](#L2571) | }); |
| [2572](#L2572) | } |
| [2573](#L2573) |  |
| [2574](#L2574) | }, |
| [2575](#L2575) | bookingpress\_enable\_modal(){ |
| [2576](#L2576) | document.body.style.overflow = 'hidden'; |
| [2577](#L2577) | }, |
| [2578](#L2578) | bookingpress\_disable\_modal(){ |
| [2579](#L2579) | if(document.body.classList.contains("el-popup-parent--hidden")){ |
| [2580](#L2580) | document.body.classList.remove("el-popup-parent--hidden"); |
| [2581](#L2581) | document.body.style.paddingRight = "0px"; |
| [2582](#L2582) | } |
| [2583](#L2583) | document.body.style.overflow = 'auto'; |
| [2584](#L2584) | }, |
| [2585](#L2585) | openNeedHelper(page\_name = '', module\_name = '', module\_title = ''){ |
| [2586](#L2586) | const vm = this |
| [2587](#L2587) | vm.helpDrawerData = '' |
| [2588](#L2588) | vm.is\_display\_drawer\_loader = '1' |
| [2589](#L2589) | vm.needHelpDrawer = !this.needHelpDrawer |
| [2590](#L2590) | var help\_page\_name = 'list\_'+'<?php echo esc\_html($requested\_module); ?>'; |
| [2591](#L2591) | if(page\_name != ''){ |
| [2592](#L2592) | help\_page\_name = page\_name |
| [2593](#L2593) | } |
| [2594](#L2594) | var help\_module\_name = '<?php echo esc\_html($requested\_module); ?>'; |
| [2595](#L2595) | if(module\_name != ''){ |
| [2596](#L2596) | help\_module\_name = module\_name |
| [2597](#L2597) | } |
| [2598](#L2598) | if(module\_title != ''){ |
| [2599](#L2599) | this.requested\_module = module\_title |
| [2600](#L2600) | } |
| [2601](#L2601) | <?php do\_action('bookingpress\_change\_help\_request\_module\_data'); ?> |
| [2602](#L2602) | var postData = { action:'bookingpress\_get\_help\_data',  module: help\_module\_name, page: help\_page\_name, type: 'list',\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [2603](#L2603) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [2604](#L2604) | .then( function (response) { |
| [2605](#L2605) | vm.is\_display\_drawer\_loader = '0' |
| [2606](#L2606) | vm.helpDrawerData = response.data; |
| [2607](#L2607) | var elements = jQuery('.bpa-help-drawer\_\_body-wrapper'); |
| [2608](#L2608) | if(elements.length == 0) { |
| [2609](#L2609) | jQuery(".bpa-hd-header").next().andSelf().wrapAll('<div class="bpa-help-drawer\_\_body-wrapper"></div>'); |
| [2610](#L2610) | } |
| [2611](#L2611) | jQuery(document).ready(function(){ |
| [2612](#L2612) | jQuery('figure#watch\_now\_btn').each(function(){ |
| [2613](#L2613) | var bookingpress\_data\_video\_link = jQuery(this).attr('data-video'); |
| [2614](#L2614) | jQuery(this).children().wrap('<a href='+ bookingpress\_data\_video\_link +' target="\_blank" />'); |
| [2615](#L2615) | }); |
| [2616](#L2616) | }); |
| [2617](#L2617) |  |
| [2618](#L2618) | }.bind(vm) ) |
| [2619](#L2619) | .catch( function (error) { |
| [2620](#L2620) | console.log(error); |
| [2621](#L2621) | }); |
| [2622](#L2622) | }, |
| [2623](#L2623) | openNeedHelper\_add(page\_name = '', module\_name = '', module\_title = ''){ |
| [2624](#L2624) | const vm = this |
| [2625](#L2625) | vm.helpDrawerData = '' |
| [2626](#L2626) | vm.is\_display\_drawer\_loader = '1' |
| [2627](#L2627) | this.needHelpDrawer\_add = !this.needHelpDrawer\_add |
| [2628](#L2628) | var help\_page\_name = 'add\_'+'<?php echo esc\_html($requested\_module); ?>'; |
| [2629](#L2629) | if(page\_name != ''){ |
| [2630](#L2630) | help\_page\_name = page\_name |
| [2631](#L2631) | } |
| [2632](#L2632) | var help\_module\_name = '<?php echo esc\_html($requested\_module); ?>'; |
| [2633](#L2633) | if(module\_name != ''){ |
| [2634](#L2634) | help\_module\_name = module\_name |
| [2635](#L2635) | } |
| [2636](#L2636) | if(module\_title != ''){ |
| [2637](#L2637) | this.requested\_module = module\_title |
| [2638](#L2638) | } |
| [2639](#L2639) | var postData = { action:'bookingpress\_get\_help\_data',  module: help\_module\_name, page: help\_page\_name, type: 'add',\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>'  }; |
| [2640](#L2640) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [2641](#L2641) | .then( function (response) { |
| [2642](#L2642) | vm.is\_display\_drawer\_loader = '0' |
| [2643](#L2643) | vm.helpDrawerData = response.data; |
| [2644](#L2644) | }.bind(this) ) |
| [2645](#L2645) | .catch( function (error) { |
| [2646](#L2646) | console.log(error); |
| [2647](#L2647) | }); |
| [2648](#L2648) | }, |
| [2649](#L2649) | responsiveMenu(){ |
| [2650](#L2650) | window.onload = function(){ |
| [2651](#L2651) | (function() { |
| [2652](#L2652) | if(document.getElementById("bpa-mobile-menu") != null){ |
| [2653](#L2653) | document.getElementById("bpa-mobile-menu").onclick = function() {responsiveMenuFunc()}; |
| [2654](#L2654) | } |
| [2655](#L2655) | })(); |
| [2656](#L2656) | function responsiveMenuFunc() { |
| [2657](#L2657) | var element = document.getElementById("bpa-navbar-nav"); |
| [2658](#L2658) | if( element != null ){ |
| [2659](#L2659) | element.classList.toggle("bpa-mobile-nav"); |
| [2660](#L2660) | } |
| [2661](#L2661) | var element2 = document.getElementById("bpa-mob-nav-overlay"); |
| [2662](#L2662) | if( element2 != null ){ |
| [2663](#L2663) | element2.classList.toggle("is-visible"); |
| [2664](#L2664) | } |
| [2665](#L2665) | var element3 = document.getElementById("bpa-mobile-menu"); |
| [2666](#L2666) | if( element3 != null){ |
| [2667](#L2667) | element3.classList.toggle("is-active"); |
| [2668](#L2668) | } |
| [2669](#L2669) | } |
| [2670](#L2670) | } |
| [2671](#L2671) | }, |
| [2672](#L2672) | open\_feature\_request\_url(){ |
| [2673](#L2673) |  |
| [2674](#L2674) | window.open('https://ideas.bookingpressplugin.com/', '\_blank'); |
| [2675](#L2675) | }, |
| [2676](#L2676) | open\_facebook\_community\_url(){ |
| [2677](#L2677) | window.open('https://www.facebook.com/groups/bookingpress/', '\_blank'); |
| [2678](#L2678) | }, |
| [2679](#L2679) | open\_youtube\_channel\_url(){ |
| [2680](#L2680) | window.open('https://www.youtube.com/@BookingPress/', '\_blank'); |
| [2681](#L2681) | }, |
| [2682](#L2682) | open\_need\_help\_url(){ |
| [2683](#L2683) |  |
| [2684](#L2684) | const vm = this; |
| [2685](#L2685) |  |
| [2686](#L2686) | var bpa\_get\_url\_param = new URLSearchParams(window.location.search); |
| [2687](#L2687) | var bpa\_get\_page = bpa\_get\_url\_param.get('page'); |
| [2688](#L2688) | var bpa\_get\_action = bpa\_get\_url\_param.get('action'); |
| [2689](#L2689) | var bpa\_get\_setting\_page = bpa\_get\_url\_param.get('setting\_page'); |
| [2690](#L2690) |  |
| [2691](#L2691) | if( bpa\_get\_page == 'bookingpress\_lite\_wizard' ){ |
| [2692](#L2692) | vm.openNeedHelper('list\_quick\_start\_guide', 'quick\_start\_guide', 'Quick Start Guide'); |
| [2693](#L2693) | vm.bpa\_fab\_floating\_btn = 0; |
| [2694](#L2694) |  |
| [2695](#L2695) | }else if(bpa\_get\_page == 'bookingpress\_addons'){ |
| [2696](#L2696) | vm.openNeedHelper("list\_license\_settings", "license\_settings", "Add-ons"); |
| [2697](#L2697) | vm.bpa\_fab\_floating\_btn = 0; |
| [2698](#L2698) |  |
| [2699](#L2699) | }else if( bpa\_get\_page == 'bookingpress\_calendar' ){ |
| [2700](#L2700) | vm.openNeedHelper('list\_calendar', 'calendar', 'Calendar'); |
| [2701](#L2701) | vm.bpa\_fab\_floating\_btn = 0; |
| [2702](#L2702) |  |
| [2703](#L2703) | } else if( bpa\_get\_page == 'bookingpress\_appointments' ){ |
| [2704](#L2704) | vm.openNeedHelper('list\_appointments', 'appointments', 'Appointments'); |
| [2705](#L2705) | vm.bpa\_fab\_floating\_btn = 0; |
| [2706](#L2706) |  |
| [2707](#L2707) | } else if( bpa\_get\_page == 'bookingpress\_payments'){ |
| [2708](#L2708) | vm.openNeedHelper('list\_payments', 'payments', 'Payments') |
| [2709](#L2709) | vm.bpa\_fab\_floating\_btn = 0; |
| [2710](#L2710) |  |
| [2711](#L2711) | } else if( bpa\_get\_page == 'bookingpress\_customers'){ |
| [2712](#L2712) | vm.openNeedHelper('list\_customers', 'customers', 'Customers'); |
| [2713](#L2713) | vm.bpa\_fab\_floating\_btn = 0; |
| [2714](#L2714) |  |
| [2715](#L2715) | } else if( bpa\_get\_page == 'bookingpress\_services'){ |
| [2716](#L2716) | vm.openNeedHelper('list\_services', 'services', 'Services'); |
| [2717](#L2717) | vm.bpa\_fab\_floating\_btn = 0; |
| [2718](#L2718) |  |
| [2719](#L2719) | } else if( bpa\_get\_page == 'bookingpress\_notifications'){ |
| [2720](#L2720) | vm.openNeedHelper('list\_notifications', 'notifications', 'Notifications'); |
| [2721](#L2721) | vm.bpa\_fab\_floating\_btn = 0; |
| [2722](#L2722) |  |
| [2723](#L2723) | } else if( bpa\_get\_page == 'bookingpress\_customize' && null == bpa\_get\_action )  { |
| [2724](#L2724) | vm.openNeedHelper('list\_customize', 'customize', 'Customize'); |
| [2725](#L2725) | vm.bpa\_fab\_floating\_btn = 0; |
| [2726](#L2726) |  |
| [2727](#L2727) | } else if( bpa\_get\_page == 'bookingpress\_customize' && ( null != bpa\_get\_action && bpa\_get\_action == 'forms' )) { |
| [2728](#L2728) | vm.openNeedHelper('list\_customize', 'customize', 'Customize'); |
| [2729](#L2729) | vm.bpa\_fab\_floating\_btn = 0; |
| [2730](#L2730) |  |
| [2731](#L2731) | } else if( bpa\_get\_page == 'bookingpress\_customize' && ( null != bpa\_get\_action && bpa\_get\_action == 'form\_fields' )) { |
| [2732](#L2732) | vm.openNeedHelper('list\_customize\_field', 'customize\_field', 'Customize'); |
| [2733](#L2733) | vm.bpa\_fab\_floating\_btn = 0; |
| [2734](#L2734) |  |
| [2735](#L2735) | } else if( bpa\_get\_page == 'bookingpress'){ |
| [2736](#L2736) | vm.openNeedHelper('list\_dashboard', 'dashboard', 'Dashboard'); |
| [2737](#L2737) | vm.bpa\_fab\_floating\_btn = 0; |
| [2738](#L2738) |  |
| [2739](#L2739) | } else if( bpa\_get\_page == 'bookingpress\_settings'){ |
| [2740](#L2740) | var selected\_tab\_name = sessionStorage.getItem("current\_tabname"); |
| [2741](#L2741) | console.log( selected\_tab\_name ); |
| [2742](#L2742) | if( null == selected\_tab\_name && null == bpa\_get\_setting\_page ){ |
| [2743](#L2743) | vm.openNeedHelper('list\_general\_settings', 'general\_settings', 'General Settings'); |
| [2744](#L2744) | vm.bpa\_fab\_floating\_btn = 0; |
| [2745](#L2745) |  |
| [2746](#L2746) | }else if( selected\_tab\_name == 'company\_settings' ){ |
| [2747](#L2747) | vm.openNeedHelper("list\_company\_settings", "company\_settings", "Company Settings"); |
| [2748](#L2748) | vm.bpa\_fab\_floating\_btn = 0; |
| [2749](#L2749) |  |
| [2750](#L2750) | } else if( selected\_tab\_name == 'general\_settings'){ |
| [2751](#L2751) | vm.openNeedHelper('list\_general\_settings', 'general\_settings', 'General Settings'); |
| [2752](#L2752) | vm.bpa\_fab\_floating\_btn = 0; |
| [2753](#L2753) |  |
| [2754](#L2754) | } else if( selected\_tab\_name == 'notification\_settings'){ |
| [2755](#L2755) | vm.openNeedHelper('list\_notification\_settings', 'notification\_settings', 'Notification Settings'); |
| [2756](#L2756) | vm.bpa\_fab\_floating\_btn = 0; |
| [2757](#L2757) |  |
| [2758](#L2758) | } else if( selected\_tab\_name == 'workhours\_settings'){ |
| [2759](#L2759) | vm.openNeedHelper('list\_workhours\_settings', 'workhours\_settings', 'Working Hours Settings'); |
| [2760](#L2760) | vm.bpa\_fab\_floating\_btn = 0; |
| [2761](#L2761) |  |
| [2762](#L2762) | } else if( selected\_tab\_name == 'dayoff\_settings'){ |
| [2763](#L2763) | vm.openNeedHelper('list\_daysoff\_settings', 'daysoff\_settings', 'Holidays'); |
| [2764](#L2764) | vm.bpa\_fab\_floating\_btn = 0; |
| [2765](#L2765) |  |
| [2766](#L2766) | } else if( selected\_tab\_name == 'payment\_settings' ){ |
| [2767](#L2767) | vm.openNeedHelper('list\_payment\_settings', 'payment\_settings', 'Payment Settings'); |
| [2768](#L2768) | vm.bpa\_fab\_floating\_btn = 0; |
| [2769](#L2769) |  |
| [2770](#L2770) | } else if( selected\_tab\_name == 'message\_settings'){ |
| [2771](#L2771) | vm.openNeedHelper('list\_message\_settings', 'message\_settings', 'Message Settings'); |
| [2772](#L2772) | vm.bpa\_fab\_floating\_btn = 0; |
| [2773](#L2773) |  |
| [2774](#L2774) | } else if( selected\_tab\_name == 'debug\_log\_settings'){ |
| [2775](#L2775) | vm.openNeedHelper('list\_debug\_log\_settings', 'debug\_log\_settings', 'Debug Log Settings'); |
| [2776](#L2776) | vm.bpa\_fab\_floating\_btn = 0; |
| [2777](#L2777) |  |
| [2778](#L2778) | } |
| [2779](#L2779) | } |
| [2780](#L2780) | <?php do\_action('bpa\_add\_extra\_tab\_outside\_func'); ?> |
| [2781](#L2781) |  |
| [2782](#L2782) | }, |
| [2783](#L2783) | open\_add\_appointment\_modal() { |
| [2784](#L2784) | this.open\_appointment\_modal = true; |
| [2785](#L2785) | }, |
| [2786](#L2786) | bookingpress\_appointment\_change\_service(){ |
| [2787](#L2787) | const vm = this; |
| [2788](#L2788) |  |
| [2789](#L2789) | let selected\_service = vm.appointment\_formdata.appointment\_selected\_service; |
| [2790](#L2790) | let services\_lists = vm.appointment\_services\_list; |
| [2791](#L2791) | let max\_capacity = 0; |
| [2792](#L2792) | let min\_capacity = 0; |
| [2793](#L2793) | let selected\_service\_duration\_unit = ''; |
| [2794](#L2794) | let selected\_service\_duration = ''; |
| [2795](#L2795) | for( let categories of services\_lists ){ |
| [2796](#L2796) | let category\_service\_list = categories.category\_services; |
| [2797](#L2797) | for( let services of category\_service\_list ){ |
| [2798](#L2798) | let service\_id = services.service\_id; |
| [2799](#L2799) | if( service\_id == selected\_service ){ |
| [2800](#L2800) | max\_capacity = ( "undefined" != typeof services.service\_max\_capacity ) ? services.service\_max\_capacity : 1; |
| [2801](#L2801) | min\_capacity = ( "undefined" != typeof services.service\_min\_capacity ) ? services.service\_min\_capacity : 1; |
| [2802](#L2802) | selected\_service\_duration\_unit = ( "undefined" != typeof services.service\_duration\_unit ) ? services.service\_duration\_unit : ''; |
| [2803](#L2803) | selected\_service\_duration = ( "undefined" != typeof services.service\_duration ) ? services.service\_duration : ''; |
| [2804](#L2804) | if(vm.is\_compitible\_with\_pro == 0) { |
| [2805](#L2805) | max\_capacity--; |
| [2806](#L2806) | } |
| [2807](#L2807) | break; |
| [2808](#L2808) | } |
| [2809](#L2809) | } |
| [2810](#L2810) | } |
| [2811](#L2811) | <?php do\_action('bookingpress\_before\_change\_backend\_service'); ?> |
| [2812](#L2812) | vm.appointment\_formdata.selected\_bring\_members = 0; |
| [2813](#L2813) | if(vm.is\_compitible\_with\_pro == 1) { |
| [2814](#L2814) | vm.appointment\_formdata.selected\_bring\_members = 1; |
| [2815](#L2815) | if( min\_capacity > 1 ){ |
| [2816](#L2816) | vm.appointment\_formdata.selected\_bring\_members = min\_capacity; |
| [2817](#L2817) | } |
| [2818](#L2818) | } |
| [2819](#L2819) | vm.appointment\_formdata.bookingpress\_bring\_anyone\_max\_capacity = parseInt(max\_capacity); |
| [2820](#L2820) | vm.appointment\_formdata.bookingpress\_bring\_anyone\_min\_capacity = parseInt(min\_capacity); |
| [2821](#L2821) | vm.appointment\_formdata.selected\_service\_duration\_unit = selected\_service\_duration\_unit; |
| [2822](#L2822) | vm.appointment\_formdata.selected\_service\_duration = selected\_service\_duration; |
| [2823](#L2823) | vm.bookingpress\_appointment\_get\_disable\_dates(); |
| [2824](#L2824) |  |
| [2825](#L2825) | <?php do\_action('bookingpress\_change\_backend\_service'); ?> |
| [2826](#L2826) | }, |
| [2827](#L2827) | bookingpress\_appointment\_get\_disable\_dates( reset\_timeslot\_field = true ){ |
| [2828](#L2828) | const vm = this; |
| [2829](#L2829) | let bookingpress\_appointment\_form\_data = vm.appointment\_formdata; |
| [2830](#L2830) |  |
| [2831](#L2831) | if( true == reset\_timeslot\_field ){ |
| [2832](#L2832) | vm.appointment\_formdata.appointment\_booked\_time = ""; |
| [2833](#L2833) | } |
| [2834](#L2834) | var bookingpress\_appointment\_date = vm.appointment\_formdata.appointment\_booked\_date; |
| [2835](#L2835) | var bookingpress\_moment\_formatted\_date = moment(bookingpress\_appointment\_date); |
| [2836](#L2836) | bookingpress\_appointment\_date = bookingpress\_moment\_formatted\_date.format('YYYY-MM-DD'); |
| [2837](#L2837) |  |
| [2838](#L2838) |  |
| [2839](#L2839) | let postData = { |
| [2840](#L2840) | action:"bookingpress\_get\_disable\_date", |
| [2841](#L2841) | \_wpnonce:bookingpress\_appointment\_form\_data.\_wpnonce, |
| [2842](#L2842) | appointment\_data\_obj:bookingpress\_appointment\_form\_data, |
| [2843](#L2843) | service\_id: bookingpress\_appointment\_form\_data.appointment\_selected\_service, |
| [2844](#L2844) | selected\_date: bookingpress\_appointment\_date, |
| [2845](#L2845) | bpa\_fetch\_data: true, |
| [2846](#L2846) | selected\_service: bookingpress\_appointment\_form\_data.appointment\_selected\_service |
| [2847](#L2847) | }; |
| [2848](#L2848) | <?php do\_action( 'bookingpress\_set\_additional\_appointment\_xhr\_data' ) ?> |
| [2849](#L2849) | postData.appointment\_data\_obj = JSON.stringify( postData.appointment\_data\_obj ); |
| [2850](#L2850) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [2851](#L2851) | .then( function(response){ |
| [2852](#L2852) | if( response.data.variant == "success" ){ |
| [2853](#L2853) | let disableDates = response.data.days\_off\_disabled\_dates; |
| [2854](#L2854) | let disableDates\_arr = disableDates.split(','); |
| [2855](#L2855) | let disableDates\_formatted = []; |
| [2856](#L2856) | disableDates\_arr.forEach(function( date ){ |
| [2857](#L2857) | let formatted\_date = vm.get\_formatted\_date( date ); |
| [2858](#L2858) | disableDates\_formatted.push( formatted\_date ); |
| [2859](#L2859) | }); |
| [2860](#L2860) |  |
| [2861](#L2861) | vm.pickerOptions.disabledDate = function(Time){ |
| [2862](#L2862) | let currentDate = new Date( Time ); |
| [2863](#L2863) | currentDate = vm.get\_formatted\_date( currentDate ); |
| [2864](#L2864) | var date = new Date(); |
| [2865](#L2865) |  |
| [2866](#L2866) | date.setDate(date.getDate()-1); |
| [2867](#L2867) |  |
| [2868](#L2868) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [2869](#L2869) |  |
| [2870](#L2870) | if( disableDates\_formatted.indexOf( currentDate ) > -1 ){ |
| [2871](#L2871) | return true; |
| [2872](#L2872) | } else { |
| [2873](#L2873) | return disable\_past\_date; |
| [2874](#L2874) | } |
| [2875](#L2875) | }; |
| [2876](#L2876) |  |
| [2877](#L2877) | /\*\* timeslot data start \*/ |
| [2878](#L2878) |  |
| [2879](#L2879) | if(typeof response.data.front\_timings !== "undefined") { |
| [2880](#L2880) |  |
| [2881](#L2881) | let timeslot\_response\_data = response.data.front\_timings; |
| [2882](#L2882) | let morning\_times = timeslot\_response\_data.morning\_time; |
| [2883](#L2883) | let afternoon\_times = timeslot\_response\_data.afternoon\_time; |
| [2884](#L2884) | let evening\_times = timeslot\_response\_data.evening\_time; |
| [2885](#L2885) | let night\_times = timeslot\_response\_data.night\_time; |
| [2886](#L2886) |  |
| [2887](#L2887) | let timeslot\_data = { |
| [2888](#L2888) | morning\_time: { |
| [2889](#L2889) | timeslot\_label: "Morning", |
| [2890](#L2890) | timeslots: morning\_times |
| [2891](#L2891) | }, |
| [2892](#L2892) | afternoon\_time: { |
| [2893](#L2893) | timeslot\_label: "Afternoon", |
| [2894](#L2894) | timeslots: afternoon\_times |
| [2895](#L2895) | }, |
| [2896](#L2896) | evening\_time: { |
| [2897](#L2897) | timeslot\_label: "Evening", |
| [2898](#L2898) | timeslots: evening\_times |
| [2899](#L2899) | }, |
| [2900](#L2900) | night\_time: { |
| [2901](#L2901) | timeslot\_label: "Night", |
| [2902](#L2902) | timeslots: night\_times |
| [2903](#L2903) | } |
| [2904](#L2904) | }; |
| [2905](#L2905) |  |
| [2906](#L2906) | vm.appointment\_time\_slot = timeslot\_data; |
| [2907](#L2907) |  |
| [2908](#L2908) | } |
| [2909](#L2909) |  |
| [2910](#L2910) | /\*\* timeslot data end \*/ |
| [2911](#L2911) |  |
| [2912](#L2912) | /\*\* change current date \*/ |
| [2913](#L2913) | vm.disabledDates = disableDates\_formatted; |
| [2914](#L2914) |  |
| [2915](#L2915) | if(typeof vm.disabledDates != 'undefined'){ |
| [2916](#L2916) | if(typeof vm.disabledDates.length != 'undefined'){ |
| [2917](#L2917) | if(vm.disabledDates.includes(vm.appointment\_formdata.appointment\_booked\_date)){ |
| [2918](#L2918) | vm.appointment\_formdata.appointment\_booked\_date = response.data.selected\_date; |
| [2919](#L2919) | } |
| [2920](#L2920) | } |
| [2921](#L2921) | } |
| [2922](#L2922) | /\* vm.appointment\_formdata.appointment\_booked\_date = response.data.selected\_date;  \*/ |
| [2923](#L2923) | /\*\* change current date \*/ |
| [2924](#L2924) |  |
| [2925](#L2925) | <?php |
| [2926](#L2926) | do\_action('bookingpress\_additional\_disable\_dates'); |
| [2927](#L2927) | ?> |
| [2928](#L2928) | } |
| [2929](#L2929) | }.bind(this) ) |
| [2930](#L2930) | .catch( function (error) { |
| [2931](#L2931) | console.log(error); |
| [2932](#L2932) | }); |
| [2933](#L2933) |  |
| [2934](#L2934) | <?php do\_action('bookingpress\_after\_get\_backend\_disable\_dates'); ?> |
| [2935](#L2935) | }, |
| [2936](#L2936) | select\_appointment\_booking\_date( selected\_value ){ |
| [2937](#L2937) | const vm = this; |
| [2938](#L2938) | vm.appointment\_formdata.appointment\_booked\_date = vm.appointment\_formdata.selected\_date = selected\_value; |
| [2939](#L2939) | let bookingpress\_appointment\_form\_data = vm.appointment\_formdata; |
| [2940](#L2940) | let postData = { |
| [2941](#L2941) | action:"bookingpress\_front\_get\_timings", |
| [2942](#L2942) | \_wpnonce:bookingpress\_appointment\_form\_data.\_wpnonce, |
| [2943](#L2943) | appointment\_data\_obj:JSON.stringify( bookingpress\_appointment\_form\_data ), |
| [2944](#L2944) | service\_id: bookingpress\_appointment\_form\_data.appointment\_selected\_service, |
| [2945](#L2945) | selected\_date: selected\_value |
| [2946](#L2946) | }; |
| [2947](#L2947) | <?php do\_action('bookingpress\_get\_front\_timing\_set\_additional\_appointment\_xhr\_data') ?> |
| [2948](#L2948) |  |
| [2949](#L2949) | if( "" != bookingpress\_appointment\_form\_data.selected\_staffmember ){ |
| [2950](#L2950) | postData.staffmember\_id = bookingpress\_appointment\_form\_data.selected\_staffmember; |
| [2951](#L2951) | postData.bookingpress\_selected\_staffmember = { |
| [2952](#L2952) | selected\_staff\_member\_id: bookingpress\_appointment\_form\_data.selected\_staffmember |
| [2953](#L2953) | } |
| [2954](#L2954) | } |
| [2955](#L2955) |  |
| [2956](#L2956) | if(  "undefined" != typeof vm.bookingpress\_loaded\_extras && "undefined" != typeof vm.bookingpress\_loaded\_extras[vm.appointment\_formdata.appointment\_selected\_service] ){ |
| [2957](#L2957) | let bpa\_selected\_extras = {}; |
| [2958](#L2958) | vm.bookingpress\_loaded\_extras[vm.appointment\_formdata.appointment\_selected\_service].forEach(function( element ){ |
| [2959](#L2959) | let is\_selected = element.bookingpress\_is\_selected; |
| [2960](#L2960) | if( "true" == is\_selected || true == is\_selected ){ |
| [2961](#L2961) | bpa\_selected\_extras[ element.bookingpress\_extra\_services\_id ] = { |
| [2962](#L2962) | "bookingpress\_is\_selected":"true", |
| [2963](#L2963) | "bookingpress\_selected\_qty":element.bookingpress\_selected\_qty |
| [2964](#L2964) | }; |
| [2965](#L2965) | } |
| [2966](#L2966) | }); |
| [2967](#L2967) | postData.appointment\_data\_obj.bookingpress\_selected\_extra\_details = bpa\_selected\_extras; |
| [2968](#L2968) | } |
| [2969](#L2969) | if( "undefined" != typeof vm.appointment\_formdata.selected\_bring\_members ){ |
| [2970](#L2970) | postData.appointment\_data\_obj.bookingpress\_selected\_bring\_members = vm.appointment\_formdata.selected\_bring\_members; |
| [2971](#L2971) | } |
| [2972](#L2972) |  |
| [2973](#L2973) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [2974](#L2974) | .then( function(response) { |
| [2975](#L2975) |  |
| [2976](#L2976) | vm.appointment\_formdata.appointment\_booked\_time = ""; |
| [2977](#L2977) |  |
| [2978](#L2978) | let timeslot\_response\_data = response.data; |
| [2979](#L2979) | let morning\_times = timeslot\_response\_data.morning\_time; |
| [2980](#L2980) | let afternoon\_times = timeslot\_response\_data.afternoon\_time; |
| [2981](#L2981) | let evening\_times = timeslot\_response\_data.evening\_time; |
| [2982](#L2982) | let night\_times = timeslot\_response\_data.night\_time; |
| [2983](#L2983) |  |
| [2984](#L2984) | let timeslot\_data = { |
| [2985](#L2985) | morning\_time: { |
| [2986](#L2986) | timeslot\_label: "Morning", |
| [2987](#L2987) | timeslots: morning\_times |
| [2988](#L2988) | }, |
| [2989](#L2989) | afternoon\_time: { |
| [2990](#L2990) | timeslot\_label: "Afternoon", |
| [2991](#L2991) | timeslots: afternoon\_times |
| [2992](#L2992) | }, |
| [2993](#L2993) | evening\_time: { |
| [2994](#L2994) | timeslot\_label: "Evening", |
| [2995](#L2995) | timeslots: evening\_times |
| [2996](#L2996) | }, |
| [2997](#L2997) | night\_time: { |
| [2998](#L2998) | timeslot\_label: "Night", |
| [2999](#L2999) | timeslots: night\_times |
| [3000](#L3000) | } |
| [3001](#L3001) | }; |
| [3002](#L3002) | vm.appointment\_time\_slot = timeslot\_data; |
| [3003](#L3003) |  |
| [3004](#L3004) | <?php do\_action('bookingpress\_backend\_after\_get\_timeslot\_response'); ?> |
| [3005](#L3005) |  |
| [3006](#L3006) |  |
| [3007](#L3007) | }.bind(this) ) |
| [3008](#L3008) | .catch( function( error ){ |
| [3009](#L3009) | console.log( error ) |
| [3010](#L3010) | }) |
| [3011](#L3011) | }, |
| [3012](#L3012) | editAppointmentData(index,row, calendar = false, elm\_target, is\_more ) { |
| [3013](#L3013) | const vm2 = this; |
| [3014](#L3014) | var edit\_id = row.appointment\_id; |
| [3015](#L3015) | vm2.appointment\_formdata.appointment\_update\_id = edit\_id; |
| [3016](#L3016) | if( true == calendar ){ |
| [3017](#L3017) | var bookingpress\_appointment\_date = row.start\_date; |
| [3018](#L3018) | var bookingpress\_appointment\_end\_date = row.end\_date; |
| [3019](#L3019) | var bookingpress\_moment\_formatted\_date = moment(bookingpress\_appointment\_date); |
| [3020](#L3020) | var bookingpress\_moment\_formatted\_end\_date = moment(bookingpress\_appointment\_end\_date); |
| [3021](#L3021) | bookingpress\_appointment\_date = bookingpress\_moment\_formatted\_date.format('YYYY-MM-DD'); |
| [3022](#L3022) | var bookingpress\_appointment\_start\_time = bookingpress\_moment\_formatted\_date.format('HH:mm:ss'); |
| [3023](#L3023) | var bookingpress\_appointment\_end\_time = bookingpress\_moment\_formatted\_end\_date.format('HH:mm:ss'); |
| [3024](#L3024) | var postData = { action:'bookingpress\_get\_popover\_appointment\_data', bookingpress\_sel\_appointment\_date: bookingpress\_appointment\_date, appointment\_id: edit\_id, bookingpress\_appointment\_start\_time : bookingpress\_appointment\_start\_time,bookingpress\_appointment\_end\_time: bookingpress\_appointment\_end\_time ,activeView : vm2.activeView,search\_data : vm2.search\_data,\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [3025](#L3025) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [3026](#L3026) | .then( function (response) { |
| [3027](#L3027) | if(response.data != undefined || response.data != []) |
| [3028](#L3028) | { |
| [3029](#L3029) | appointment\_start\_time = response.data.bookingpress\_popover\_appointemnt\_data[0].bookingpress\_appointment\_time; |
| [3030](#L3030) | appointment\_end\_time = response.data.bookingpress\_popover\_appointemnt\_data[0].bookingpress\_appointment\_end\_time; |
| [3031](#L3031) | vm2.appointment\_formdata.bookingpress\_appointemnt\_popover\_timeslot\_title = appointment\_start\_time+ ' - '+appointment\_end\_time; |
| [3032](#L3032) | vm2.appointment\_formdata.bookingpress\_appointemnt\_popover\_title = response.data.bookingpress\_popover\_appointemnt\_data[0].bookingpress\_appointment\_date; |
| [3033](#L3033) | vm2.appointment\_formdata.bookingpress\_appointment\_popover\_data = response.data.bookingpress\_popover\_appointemnt\_data; |
| [3034](#L3034) | vm2.appointment\_formdata.bookingpress\_total\_popover\_appointemnt = response.data.bookingpress\_total\_popover\_appointemnt; |
| [3035](#L3035) | vm2.appointment\_formdata.row = { |
| [3036](#L3036) | appointment\_id: response.data.bookingpress\_popover\_appointemnt\_data[0].bookingpress\_appointment\_booking\_id, |
| [3037](#L3037) | }; |
| [3038](#L3038) | vm2.bpa\_display\_calendar\_popover\_loader = 0; |
| [3039](#L3039) |  |
| [3040](#L3040) | } |
| [3041](#L3041) | }.bind(this) ) |
| [3042](#L3042) | .catch( function (error) { |
| [3043](#L3043) | console.log(error); |
| [3044](#L3044) | }); |
| [3045](#L3045) |  |
| [3046](#L3046) | } else { |
| [3047](#L3047) | if( 'calendar\_popover' == calendar ){ |
| [3048](#L3048) | var edit\_id = index; |
| [3049](#L3049) | vm2.appointment\_formdata.appointment\_update\_id = edit\_id; |
| [3050](#L3050) | vm2.openAppointmentBookingModal(); |
| [3051](#L3051) |  |
| [3052](#L3052) | } else { |
| [3053](#L3053) | vm2.open\_add\_appointment\_modal(); |
| [3054](#L3054) | } |
| [3055](#L3055) | var postData = { action:'bookingpress\_get\_edit\_appointment\_data', payment\_log\_id: edit\_id, appointment\_id: edit\_id,\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [3056](#L3056) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [3057](#L3057) | .then( function (response) { |
| [3058](#L3058) | if(response.data != undefined || response.data != []) |
| [3059](#L3059) | { |
| [3060](#L3060) | var bookingpress\_tmp\_date = new Date(response.data.bookingpress\_appointment\_date).toLocaleString("en-US", {timeZone: 'UTC'}); |
| [3061](#L3061) | var bookingpress\_tmp\_date2 = response.data.bookingpress\_appointment\_date; |
| [3062](#L3062) |  |
| [3063](#L3063) | //bookingpress\_tmp\_date2 = bookingpress\_tmp\_date2.replace(/-/g, "/"); |
| [3064](#L3064) |  |
| [3065](#L3065) | vm2.appointment\_customers\_list = response.data.appointment\_customer\_list; |
| [3066](#L3066) | vm2.appointment\_formdata.appointment\_selected\_customer = response.data.bookingpress\_customer\_id |
| [3067](#L3067) | vm2.customer\_id = vm2.appointment\_formdata.appointment\_selected\_customer |
| [3068](#L3068) | vm2.appointment\_formdata.appointment\_selected\_service = response.data.bookingpress\_service\_id |
| [3069](#L3069) | //vm2.appointment\_formdata.appointment\_booked\_date = new Date(response.data.bookingpress\_appointment\_date) |
| [3070](#L3070) | //vm2.appointment\_formdata.appointment\_booked\_date = bookingpress\_tmp\_date |
| [3071](#L3071) | vm2.appointment\_formdata.appointment\_booked\_date = bookingpress\_tmp\_date2; |
| [3072](#L3072) | vm2.appointment\_formdata.appointment\_booked\_time = response.data.bookingpress\_appointment\_time |
| [3073](#L3073) | vm2.appointment\_formdata.appointment\_booked\_end\_time = response.data.bookingpress\_appointment\_end\_time |
| [3074](#L3074) | vm2.appointment\_formdata.appointment\_internal\_note = response.data.bookingpress\_appointment\_internal\_note |
| [3075](#L3075) | vm2.appointment\_time\_slot = response.data.appointment\_time\_slot |
| [3076](#L3076) |  |
| [3077](#L3077) | vm2.appointment\_formdata.appointment\_status = response.data.bookingpress\_appointment\_status |
| [3078](#L3078) | <?php |
| [3079](#L3079) | do\_action('bookingpress\_edit\_appointment\_details'); |
| [3080](#L3080) | ?> |
| [3081](#L3081) | vm2.bookingpress\_appointment\_get\_disable\_dates( false ); |
| [3082](#L3082) | } |
| [3083](#L3083) | }.bind(this) ) |
| [3084](#L3084) | .catch( function (error) { |
| [3085](#L3085) | console.log(error); |
| [3086](#L3086) | }); |
| [3087](#L3087) | } |
| [3088](#L3088) | }, |
| [3089](#L3089) | /\* eventRendered(){ |
| [3090](#L3090) | const vm = this; |
| [3091](#L3091) | if( vm.activeView != 'month' ){ |
| [3092](#L3092) | let totalEvents = document.querySelectorAll( '.bpa-cal-event-card' ); |
| [3093](#L3093) | if( 0 < totalEvents.length ){ |
| [3094](#L3094) | for( let x = 0; x < totalEvents.length; x++ ){ |
| [3095](#L3095) | let currentEvent = totalEvents[x]; |
| [3096](#L3096) | if( null == currentEvent ){ |
| [3097](#L3097) | continue; |
| [3098](#L3098) | } |
| [3099](#L3099) | let currentEventOuterHeight = parseInt( currentEvent.offsetHeight ); |
| [3100](#L3100) | let currentEventStyleHeight = parseInt(currentEvent.style.height); |
| [3101](#L3101) | if( currentEventStyleHeight > currentEventOuterHeight ){ |
| [3102](#L3102) | currentEvent.style.minHeight = currentEventStyleHeight + 'px'; |
| [3103](#L3103) | } |
| [3104](#L3104) | } |
| [3105](#L3105) | } |
| [3106](#L3106) | } |
| [3107](#L3107) | }, \*/ |
| [3108](#L3108) | editEventCalendar( event, e ){ |
| [3109](#L3109) | const vm = this; |
| [3110](#L3110) | let bpa\_screen\_size = vm.current\_screen\_size; |
| [3111](#L3111) | //vm.bpa\_calendar\_event\_clicks++; |
| [3112](#L3112) | let clickTimestamp = Math.round( e.timeStamp ); |
| [3113](#L3113) | vm.bpa\_calendar\_event\_click\_timestamp = clickTimestamp; |
| [3114](#L3114) | //if( 1 == vm.bpa\_calendar\_event\_clicks ){ |
| [3115](#L3115) | //vm.bpa\_calendar\_event\_clicks = 0; |
| [3116](#L3116) | if( "mobile" != bpa\_screen\_size ){ |
| [3117](#L3117) | vm.editEvent( event, e ); |
| [3118](#L3118) | } else { |
| [3119](#L3119) | vm.editEvent\_mobile( event, e ); |
| [3120](#L3120) | } |
| [3121](#L3121) | //}  else { |
| [3122](#L3122) | /\* e.stopPropagation(); |
| [3123](#L3123) | e.preventDefault(); |
| [3124](#L3124) | e.stopPropagation(); |
| [3125](#L3125) | clearTimeout( vm.bpa\_calendar\_event\_timer ); |
| [3126](#L3126) | return false; |
| [3127](#L3127) | vm.bpa\_calendar\_event\_clicks = 0; \*/ |
| [3128](#L3128) | //} |
| [3129](#L3129) | }, |
| [3130](#L3130) | editEvent(event, e){ |
| [3131](#L3131) | const vm = this; |
| [3132](#L3132) | vm.bpa\_calendar\_popover\_target = e.target; |
| [3133](#L3133) | vm.openAppointmentBookingPopover( e.target, false ); |
| [3134](#L3134) | let row = { |
| [3135](#L3135) | appointment\_id: event.appointment\_id, |
| [3136](#L3136) | start\_date : event.start, |
| [3137](#L3137) | end\_date : event.end |
| [3138](#L3138) | }; |
| [3139](#L3139) | if( e.target.classList.contains('vuecal\_more\_event') ){ |
| [3140](#L3140) | vm.appointment\_formdata.first\_expanded\_collapse=''; |
| [3141](#L3141) | } |
| [3142](#L3142) | else { |
| [3143](#L3143) | vm.appointment\_formdata.first\_expanded\_collapse = String(event.appointment\_id); |
| [3144](#L3144) | } |
| [3145](#L3145) | vm.bpa\_display\_calendar\_popover\_loader = '1'; |
| [3146](#L3146) | this.editAppointmentData( -1, row, true, e.target ); |
| [3147](#L3147) |  |
| [3148](#L3148) | }, |
| [3149](#L3149) | editEvent\_mobile(event, e){ |
| [3150](#L3150) | const vm = this; |
| [3151](#L3151) | let row = { |
| [3152](#L3152) | appointment\_id: event.appointment\_id, |
| [3153](#L3153) | start\_date : event.start, |
| [3154](#L3154) | end\_date : event.end |
| [3155](#L3155) | }; |
| [3156](#L3156) |  |
| [3157](#L3157) | vm.bpa\_calendar\_popover\_target = e.target; |
| [3158](#L3158) | vm.openAppointmentBookingPopover( e.target, false ); |
| [3159](#L3159) |  |
| [3160](#L3160) | if( e.target.classList.contains('vuecal\_more\_event') ){ |
| [3161](#L3161) | vm.appointment\_formdata.first\_expanded\_collapse=''; |
| [3162](#L3162) | } |
| [3163](#L3163) | else { |
| [3164](#L3164) | vm.appointment\_formdata.first\_expanded\_collapse = String(event.appointment\_id); |
| [3165](#L3165) | } |
| [3166](#L3166) |  |
| [3167](#L3167) | vm.bpa\_display\_calendar\_popover\_loader = '1'; |
| [3168](#L3168) | this.editAppointmentData( -1, row, true, e.target ); |
| [3169](#L3169) |  |
| [3170](#L3170) | }, |
| [3171](#L3171) | more\_event\_callback( cell, view, events, goNarrower ){ |
| [3172](#L3172) | const vm = this; |
| [3173](#L3173) | let row = {}; |
| [3174](#L3174) | if( events.length > 0 ){ |
| [3175](#L3175) | row.appointment\_id = events[0].appointment\_id; |
| [3176](#L3176) | row.start\_date = events[0].start; |
| [3177](#L3177) | row.end\_date= events[0].end; |
| [3178](#L3178) | } |
| [3179](#L3179) | let target = document.querySelector( `.${cell.class}.vuecal\_\_cell--selected.vuecal\_\_cell--has-events .vuecal\_more\_event` ); |
| [3180](#L3180) |  |
| [3181](#L3181) | vm.appointment\_formdata.first\_expanded\_collapse=''; |
| [3182](#L3182) | vm.bpa\_display\_calendar\_popover\_loader = '1'; |
| [3183](#L3183) | this.editAppointmentData( -1, row, true, target, true ); |
| [3184](#L3184) | vm.bpa\_calendar\_popover\_target = target; |
| [3185](#L3185) | vm.openAppointmentBookingPopover( target, true ); |
| [3186](#L3186) | }, |
| [3187](#L3187) | bpa\_adjust\_calendar\_popover\_position( element, is\_more = false ){ |
| [3188](#L3188) | const vm = this; |
| [3189](#L3189) |  |
| [3190](#L3190) | let cal\_popover\_wrapper = document.getElementById( 'calendar\_appointment\_popover\_dialog' ); |
| [3191](#L3191) |  |
| [3192](#L3192) | let parent\_cls\_check = 'vuecal\_\_event'; |
| [3193](#L3193) | if( true == is\_more ){ |
| [3194](#L3194) | parent\_cls\_check = 'vuecal\_\_cell'; |
| [3195](#L3195) | } |
| [3196](#L3196) |  |
| [3197](#L3197) | document.body.style.overflow = 'hidden'; |
| [3198](#L3198) |  |
| [3199](#L3199) | if( null != cal\_popover\_wrapper ){ |
| [3200](#L3200) | let cal\_dialog = cal\_popover\_wrapper.querySelector( '.el-dialog' ); |
| [3201](#L3201) | setTimeout(function(){ |
| [3202](#L3202) | let dialog\_height = cal\_dialog.offsetHeight; |
| [3203](#L3203) | let dialog\_top = cal\_dialog.getBoundingClientRect().top; |
| [3204](#L3204) | dialog\_top = Math.floor( dialog\_top ); |
| [3205](#L3205) | let parent; |
| [3206](#L3206) | if( element.classList.contains( parent\_cls\_check  ) || true == is\_more ){ |
| [3207](#L3207) | parent = element; |
| [3208](#L3208) | } else { |
| [3209](#L3209) | let parents = vm.bpa\_get\_target\_parent( element, `.${parent\_cls\_check}` ); |
| [3210](#L3210) | if( parents.length > 0 ){ |
| [3211](#L3211) | parent = parents[0]; |
| [3212](#L3212) | } |
| [3213](#L3213) | } |
| [3214](#L3214) |  |
| [3215](#L3215) | if( "undefined" == typeof parent ){ |
| [3216](#L3216) | return false; |
| [3217](#L3217) | } |
| [3218](#L3218) |  |
| [3219](#L3219) | let parent\_width = parent.offsetWidth; |
| [3220](#L3220) | let parent\_left = parent.getBoundingClientRect().left; |
| [3221](#L3221) | parent\_left = Math.round( parent\_left ); |
| [3222](#L3222) | let window\_width = window.outerWidth; |
| [3223](#L3223) |  |
| [3224](#L3224) | let available\_space\_on\_right = window\_width - ( parent\_left + parent\_width ); |
| [3225](#L3225) | let available\_space\_on\_left = parent\_left - window.pageXOffset; |
| [3226](#L3226) |  |
| [3227](#L3227) |  |
| [3228](#L3228) | let dialog\_proposed\_width = 380; |
| [3229](#L3229) |  |
| [3230](#L3230) | let place\_on\_right = true; |
| [3231](#L3231) | if( available\_space\_on\_right < dialog\_proposed\_width ){ |
| [3232](#L3232) | place\_on\_right = false; |
| [3233](#L3233) | } |
| [3234](#L3234) |  |
| [3235](#L3235) | if( place\_on\_right == false && ( available\_space\_on\_left < dialog\_proposed\_width ) ){ |
| [3236](#L3236) | vm.bpa\_calendar\_dialog\_custom\_cls = 'bpa-fsc-item\_\_popover-card bpa-is-center'; |
| [3237](#L3237) | return false; |
| [3238](#L3238) | } |
| [3239](#L3239) |  |
| [3240](#L3240) | let parent\_top = parent.getBoundingClientRect().top; |
| [3241](#L3241) | parent\_top = Math.round( parent\_top ); |
| [3242](#L3242) |  |
| [3243](#L3243) | let open\_on\_top = false; |
| [3244](#L3244) | if( parent\_top > dialog\_height ){ |
| [3245](#L3245) | open\_on\_top = true; |
| [3246](#L3246) | } |
| [3247](#L3247) |  |
| [3248](#L3248) | let windowHeight = window.outerHeight; |
| [3249](#L3249) | let parentHeight = parent.offsetHeight; |
| [3250](#L3250) |  |
| [3251](#L3251) | let popover\_top = 150; |
| [3252](#L3252) | let use\_fixed\_top = false; |
| [3253](#L3253) | if( parentHeight > windowHeight ){ |
| [3254](#L3254) |  |
| [3255](#L3255) |  |
| [3256](#L3256) | if( true == open\_on\_top ){ |
| [3257](#L3257) | open\_on\_top = false; |
| [3258](#L3258) | } |
| [3259](#L3259) |  |
| [3260](#L3260) | if( parent\_top < 130 ){ |
| [3261](#L3261) | use\_fixed\_top = true; |
| [3262](#L3262) | } |
| [3263](#L3263) |  |
| [3264](#L3264) | } |
| [3265](#L3265) |  |
| [3266](#L3266) | let popover\_top\_adjustment = 60; |
| [3267](#L3267) | if( true == is\_more ){ |
| [3268](#L3268) | popover\_top\_adjustment = 80; |
| [3269](#L3269) | } |
| [3270](#L3270) |  |
| [3271](#L3271) |  |
| [3272](#L3272) | vm.bpa\_calendar\_dialog\_custom\_cls = 'bpa-fsc-item\_\_popover-card'; |
| [3273](#L3273) | cal\_dialog.style.left = ''; |
| [3274](#L3274) | cal\_dialog.style.right = ''; |
| [3275](#L3275) | cal\_dialog.style.top = ''; |
| [3276](#L3276) | cal\_dialog.style.bottom = ''; |
| [3277](#L3277) | let parent\_height = parent\_top + parent.offsetHeight; |
| [3278](#L3278) |  |
| [3279](#L3279) | if( true == place\_on\_right && false == open\_on\_top ){ |
| [3280](#L3280) | vm.bpa\_calendar\_dialog\_custom\_cls += ' bpa\_cal\_popover\_bottom\_right'; |
| [3281](#L3281) |  |
| [3282](#L3282) | cal\_dialog.style.margin = 0; |
| [3283](#L3283) | cal\_dialog.style.position = 'absolute'; |
| [3284](#L3284) | cal\_dialog.style.left = (parent\_left + parent\_width + 20) + 'px'; |
| [3285](#L3285) | if( true == use\_fixed\_top ){ |
| [3286](#L3286) | cal\_dialog.style.top =  popover\_top + 'px'; |
| [3287](#L3287) | } else { |
| [3288](#L3288) | cal\_dialog.style.top = ( ( parent\_top ) - popover\_top\_adjustment ) + 'px'; |
| [3289](#L3289) | } |
| [3290](#L3290) |  |
| [3291](#L3291) | vm.bpa\_calendar\_dialog\_custom\_cls += ' active'; |
| [3292](#L3292) |  |
| [3293](#L3293) | } else if( true == place\_on\_right && true == open\_on\_top ){ |
| [3294](#L3294) | vm.bpa\_calendar\_dialog\_custom\_cls += ' bpa\_cal\_popover\_top\_right'; |
| [3295](#L3295) |  |
| [3296](#L3296) | cal\_dialog.style.margin = 0; |
| [3297](#L3297) |  |
| [3298](#L3298) | cal\_dialog.style.position = 'absolute'; |
| [3299](#L3299) | cal\_dialog.style.left = (parent\_left + parent\_width + 20) + 'px'; |
| [3300](#L3300) | if( true == use\_fixed\_top ){ |
| [3301](#L3301) | cal\_dialog.style.top =  popover\_top + 'px'; |
| [3302](#L3302) | } else { |
| [3303](#L3303) | cal\_dialog.style.top = ( ( parent\_height - dialog\_height ) + popover\_top\_adjustment ) + 'px'; |
| [3304](#L3304) | } |
| [3305](#L3305) |  |
| [3306](#L3306) | vm.bpa\_calendar\_dialog\_custom\_cls += ' active'; |
| [3307](#L3307) |  |
| [3308](#L3308) | } else if( false == place\_on\_right && true == open\_on\_top ){ |
| [3309](#L3309) | vm.bpa\_calendar\_dialog\_custom\_cls += ' bpa\_cal\_popover\_top\_left'; |
| [3310](#L3310) |  |
| [3311](#L3311) | cal\_dialog.style.margin = 0; |
| [3312](#L3312) | cal\_dialog.style.position = 'absolute'; |
| [3313](#L3313) | cal\_dialog.style.left = ( ( parent\_left - dialog\_proposed\_width ) - 20) + 'px'; |
| [3314](#L3314) | if( true == use\_fixed\_top ){ |
| [3315](#L3315) | cal\_dialog.style.top =  popover\_top + 'px'; |
| [3316](#L3316) | } else { |
| [3317](#L3317) | cal\_dialog.style.top = ( ( parent\_height - dialog\_height ) + popover\_top\_adjustment ) + 'px'; |
| [3318](#L3318) | } |
| [3319](#L3319) |  |
| [3320](#L3320) | vm.bpa\_calendar\_dialog\_custom\_cls += ' active'; |
| [3321](#L3321) |  |
| [3322](#L3322) | } else if( false == place\_on\_right && false == open\_on\_top ){ |
| [3323](#L3323) | vm.bpa\_calendar\_dialog\_custom\_cls += ' bpa\_cal\_popover\_bottom\_left'; |
| [3324](#L3324) |  |
| [3325](#L3325) | cal\_dialog.style.margin = 0; |
| [3326](#L3326) | cal\_dialog.style.position = 'absolute'; |
| [3327](#L3327) | cal\_dialog.style.left = ( (parent\_left - dialog\_proposed\_width) - 20) + 'px'; |
| [3328](#L3328) | if( true == use\_fixed\_top ){ |
| [3329](#L3329) | cal\_dialog.style.top =  popover\_top + 'px'; |
| [3330](#L3330) | } else { |
| [3331](#L3331) | cal\_dialog.style.top = ( ( parent\_top ) - popover\_top\_adjustment ) + 'px'; |
| [3332](#L3332) | } |
| [3333](#L3333) |  |
| [3334](#L3334) | vm.bpa\_calendar\_dialog\_custom\_cls += ' active'; |
| [3335](#L3335) | } |
| [3336](#L3336) |  |
| [3337](#L3337) | },1); |
| [3338](#L3338) | } |
| [3339](#L3339) |  |
| [3340](#L3340) | }, |
| [3341](#L3341) | bpa\_adjust\_calendar\_popover\_position\_old( element, is\_more = false ){ |
| [3342](#L3342) | const vm = this; |
| [3343](#L3343) |  |
| [3344](#L3344) | let parent\_cls\_check = 'vuecal\_\_event'; |
| [3345](#L3345) | let height\_adjust = 500; |
| [3346](#L3346) | if( true == is\_more ){ |
| [3347](#L3347) | parent\_cls\_check = 'vuecal\_\_cell'; |
| [3348](#L3348) | height\_adjust = 200; |
| [3349](#L3349) | } |
| [3350](#L3350) | let parent; |
| [3351](#L3351) |  |
| [3352](#L3352) | if( element.classList.contains(parent\_cls\_check) ){ |
| [3353](#L3353) | parent = element; |
| [3354](#L3354) | } else { |
| [3355](#L3355) | let parents = vm.bpa\_get\_target\_parent( element, `.${parent\_cls\_check}` ); |
| [3356](#L3356) | if( parents.length > 0 ){ |
| [3357](#L3357) | parent = parents[0]; |
| [3358](#L3358) | } |
| [3359](#L3359) | } |
| [3360](#L3360) |  |
| [3361](#L3361) |  |
| [3362](#L3362) | let dialog\_pos\_x = parent.getBoundingClientRect().left + parent.offsetWidth + 20; |
| [3363](#L3363) | let dialog\_pos\_y = parent.getBoundingClientRect().top - (height\_adjust - parent.offsetHeight); |
| [3364](#L3364) |  |
| [3365](#L3365) | <?php if( is\_rtl() ){ ?> |
| [3366](#L3366) | dialog\_pos\_x = parent.getBoundingClientRect().left - 38; |
| [3367](#L3367) | <?php } ?> |
| [3368](#L3368) |  |
| [3369](#L3369) | vm.$el.querySelector('.bpa-fsc-item\_\_popover-card').style.position = 'absolute'; |
| [3370](#L3370) | vm.$el.querySelector('.bpa-fsc-item\_\_popover-card').style.marginTop = '0px'; |
| [3371](#L3371) | vm.$el.querySelector('.bpa-fsc-item\_\_popover-card').style.top = dialog\_pos\_y + 'px'; |
| [3372](#L3372) | vm.$el.querySelector('.bpa-fsc-item\_\_popover-card').style.left = dialog\_pos\_x + 'px'; |
| [3373](#L3373) |  |
| [3374](#L3374) | }, |
| [3375](#L3375) | get\_formatted\_datetime(iso\_date) { |
| [3376](#L3376) | var \_\_date = new Date(iso\_date); |
| [3377](#L3377) | var hour = \_\_date.getHours(); |
| [3378](#L3378) | var minute = \_\_date.getMinutes(); |
| [3379](#L3379) | var second = \_\_date.getSeconds(); |
| [3380](#L3380) |  |
| [3381](#L3381) | if (minute < 10) { |
| [3382](#L3382) | minute = '0' + minute; |
| [3383](#L3383) | } |
| [3384](#L3384) | if (second < 10) { |
| [3385](#L3385) | second = '0' + second; |
| [3386](#L3386) | } |
| [3387](#L3387) | var formatted\_time = hour + ":" + minute + ":" + second; |
| [3388](#L3388) | var \_\_year = \_\_date.getFullYear(); |
| [3389](#L3389) | var \_\_month = \_\_date.getMonth()+1; |
| [3390](#L3390) | var \_\_day = \_\_date.getDate(); |
| [3391](#L3391) | if (\_\_day < 10) { |
| [3392](#L3392) | \_\_day = '0' + \_\_day; |
| [3393](#L3393) | } |
| [3394](#L3394) | if (\_\_month < 10) { |
| [3395](#L3395) | \_\_month = '0' + \_\_month; |
| [3396](#L3396) | } |
| [3397](#L3397) |  |
| [3398](#L3398) | var formatted\_date = \_\_year+'-'+\_\_month+'-'+\_\_day; |
| [3399](#L3399) | return formatted\_date+' '+formatted\_time; |
| [3400](#L3400) | }, |
| [3401](#L3401) | bpa\_get\_target\_parent( elem, selector ){ |
| [3402](#L3402) | if (!Element.prototype.matches) { |
| [3403](#L3403) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [3404](#L3404) | Element.prototype.mozMatchesSelector || |
| [3405](#L3405) | Element.prototype.msMatchesSelector || |
| [3406](#L3406) | Element.prototype.oMatchesSelector || |
| [3407](#L3407) | Element.prototype.webkitMatchesSelector || |
| [3408](#L3408) | function(s) { |
| [3409](#L3409) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [3410](#L3410) | i = matches.length; |
| [3411](#L3411) | while (--i >= 0 && matches.item(i) !== this) {} |
| [3412](#L3412) | return i > -1; |
| [3413](#L3413) | }; |
| [3414](#L3414) | } |
| [3415](#L3415) |  |
| [3416](#L3416) | var parents = []; |
| [3417](#L3417) |  |
| [3418](#L3418) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [3419](#L3419) | if (selector) { |
| [3420](#L3420) | if (elem.matches(selector)) { |
| [3421](#L3421) | parents.push(elem); |
| [3422](#L3422) | } |
| [3423](#L3423) | continue; |
| [3424](#L3424) | } |
| [3425](#L3425) | parents.push(elem); |
| [3426](#L3426) | } |
| [3427](#L3427) |  |
| [3428](#L3428) | return parents; |
| [3429](#L3429) | }, |
| [3430](#L3430) | bpa\_adjust\_popup\_position( currentElement, selector, sourceCls = '', position ){ |
| [3431](#L3431) |  |
| [3432](#L3432) | let paths = currentElement.path; |
| [3433](#L3433) | let buttonElm = null; |
| [3434](#L3434) |  |
| [3435](#L3435) | if( typeof paths != 'undefined' ){ |
| [3436](#L3436) | for( let x in paths ){ |
| [3437](#L3437) | let currentPath = paths[x]; |
| [3438](#L3438) | let currentPathNodeName = currentPath.nodeName; |
| [3439](#L3439) | if( "BUTTON" == currentPathNodeName || ( 'undefined' != typeof sourceCls && '' != sourceCls && currentPath.classList.contains(sourceCls)) ){ |
| [3440](#L3440) | buttonElm = currentPath; |
| [3441](#L3441) | break; |
| [3442](#L3442) | } |
| [3443](#L3443) | } |
| [3444](#L3444) | } else { |
| [3445](#L3445) |  |
| [3446](#L3446) | if( "BUTTON" == currentElement.target.nodeName || ( 'undefined' != typeof sourceCls && '' != sourceCls && currentElement.target.classList.contains(sourceCls) ) ){ |
| [3447](#L3447) | buttonElm = currentElement.target; |
| [3448](#L3448) | } else { |
| [3449](#L3449) | let par = this.bpa\_get\_target\_parent( currentElement.target, 'button' ); |
| [3450](#L3450) |  |
| [3451](#L3451) | if( par.length > 0 ){ |
| [3452](#L3452) | buttonElm = par[0]; |
| [3453](#L3453) | } else { |
| [3454](#L3454) | let par = this.bpa\_get\_target\_parent( currentElement.target, '.' + sourceCls ); |
| [3455](#L3455) | if( par.length > 0 ){ |
| [3456](#L3456) | buttonElm = par[0]; |
| [3457](#L3457) | } |
| [3458](#L3458) | } |
| [3459](#L3459) | } |
| [3460](#L3460) | } |
| [3461](#L3461) |  |
| [3462](#L3462) | if( null !== buttonElm ){ |
| [3463](#L3463) | let pos\_x = buttonElm.getBoundingClientRect().left; |
| [3464](#L3464) | let pos\_y = buttonElm.getBoundingClientRect().top; |
| [3465](#L3465) |  |
| [3466](#L3466) | pos\_x = Math.ceil( pos\_x ); |
| [3467](#L3467) | pos\_y = Math.ceil( pos\_y ); |
| [3468](#L3468) |  |
| [3469](#L3469) | let btn\_height = buttonElm.offsetHeight; |
| [3470](#L3470) | let pos\_top = pos\_y + btn\_height + 20; |
| [3471](#L3471) |  |
| [3472](#L3472) | let dialog\_\_wrapper = document.querySelector( selector ); |
| [3473](#L3473) | if( null !== dialog\_\_wrapper ){ |
| [3474](#L3474) |  |
| [3475](#L3475) |  |
| [3476](#L3476) | (function(pos\_x, buttonElm, dialog\_\_wrapper){ |
| [3477](#L3477) | setTimeout(function(){ |
| [3478](#L3478) |  |
| [3479](#L3479) | dialog\_\_wrapper.style.position = ''; |
| [3480](#L3480) | dialog\_\_wrapper.style.margin = ''; |
| [3481](#L3481) | dialog\_\_wrapper.style.top = ''; |
| [3482](#L3482) | dialog\_\_wrapper.style.left = '0'; |
| [3483](#L3483) |  |
| [3484](#L3484) | dialog\_\_wrapper.style.position = 'absolute'; |
| [3485](#L3485) | dialog\_\_wrapper.style.margin = '0'; |
| [3486](#L3486) | dialog\_\_wrapper.style.top = parseInt(pos\_top) + 'px'; |
| [3487](#L3487) |  |
| [3488](#L3488) | let pos\_to\_place = pos\_x + ( buttonElm.offsetWidth \* 0.5 ); |
| [3489](#L3489) | let dialog\_pos\_right = dialog\_\_wrapper.offsetWidth + dialog\_\_wrapper.getBoundingClientRect().left; |
| [3490](#L3490) | <?php |
| [3491](#L3491) | if( is\_rtl() ){ |
| [3492](#L3492) | ?> |
| [3493](#L3493) | if( '' != position && 'right' == position ){ |
| [3494](#L3494) | dialog\_pos\_right = dialog\_pos\_right - 50; |
| [3495](#L3495) | dialog\_\_wrapper.style.left = pos\_to\_place - dialog\_pos\_right + 'px'; |
| [3496](#L3496) | } else { |
| [3497](#L3497) | dialog\_pos\_right = dialog\_pos\_right - 30; |
| [3498](#L3498) | dialog\_\_wrapper.style.left = (pos\_to\_place -  ( dialog\_\_wrapper.getBoundingClientRect().left + 40 ) ) + 'px'; |
| [3499](#L3499) | } |
| [3500](#L3500) | <?php |
| [3501](#L3501) | } else { |
| [3502](#L3502) | ?> |
| [3503](#L3503) | if( '' != position && 'right' == position ){ |
| [3504](#L3504) | dialog\_pos\_right = dialog\_pos\_right - 30; |
| [3505](#L3505) | dialog\_\_wrapper.style.left = (pos\_to\_place -  ( dialog\_\_wrapper.getBoundingClientRect().left + 40 ) ) + 'px'; |
| [3506](#L3506) | } else { |
| [3507](#L3507) | let currentElementId = currentElement.target.id; |
| [3508](#L3508) | let is\_mobile = false; |
| [3509](#L3509) | if( null != document.getElementById('bpa-mobile-menu') ){ |
| [3510](#L3510) | let is\_mob\_menu\_visible = getComputedStyle( document.getElementById('bpa-mobile-menu') ).display; |
| [3511](#L3511) | if( 'block' == is\_mob\_menu\_visible ){ |
| [3512](#L3512) | is\_mobile = true; |
| [3513](#L3513) | } |
| [3514](#L3514) | } |
| [3515](#L3515) | if( is\_mobile == true && (('BUTTON' == currentElement.target.nodeName && currentElementId == 'bpa-appointment-share-url-button') || ( 'SPAN' == currentElement.target.nodeName && currentElement.target.parentNode != null && currentElement.target.parentNode.id == 'bpa-appointment-share-url-button' ) || ('SPAN' == currentElement.target.nodeName && currentElementId == 'bpa-appointment-share-url-span-txt')) ){ |
| [3516](#L3516) | let buttonWidth = document.getElementById( 'bpa-appointment-share-url-button' ).offsetWidth; |
| [3517](#L3517) | let popupWidth = dialog\_\_wrapper.offsetWidth; |
| [3518](#L3518) | if( pos\_x <= 44 ){ |
| [3519](#L3519) | dialog\_pos\_right = dialog\_pos\_right - 110; |
| [3520](#L3520) | } |
| [3521](#L3521) | } |
| [3522](#L3522) | dialog\_pos\_right = dialog\_pos\_right - 50; |
| [3523](#L3523) | dialog\_\_wrapper.style.left = pos\_to\_place - dialog\_pos\_right + 'px'; |
| [3524](#L3524) | } |
| [3525](#L3525) | <?php |
| [3526](#L3526) | } |
| [3527](#L3527) | ?> |
| [3528](#L3528) |  |
| [3529](#L3529) | },10) |
| [3530](#L3530) | })( pos\_x, buttonElm, dialog\_\_wrapper ); |
| [3531](#L3531) | } |
| [3532](#L3532) | } |
| [3533](#L3533) | }, |
| [3534](#L3534) | BPAGetParents( elem, selector ){ |
| [3535](#L3535) | if (!Element.prototype.matches) { |
| [3536](#L3536) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [3537](#L3537) | Element.prototype.mozMatchesSelector || |
| [3538](#L3538) | Element.prototype.msMatchesSelector || |
| [3539](#L3539) | Element.prototype.oMatchesSelector || |
| [3540](#L3540) | Element.prototype.webkitMatchesSelector || |
| [3541](#L3541) | function(s) { |
| [3542](#L3542) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [3543](#L3543) | i = matches.length; |
| [3544](#L3544) | while (--i >= 0 && matches.item(i) !== this) {} |
| [3545](#L3545) | return i > -1; |
| [3546](#L3546) | }; |
| [3547](#L3547) | } |
| [3548](#L3548) |  |
| [3549](#L3549) | var parents = []; |
| [3550](#L3550) |  |
| [3551](#L3551) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [3552](#L3552) | if (selector) { |
| [3553](#L3553) | if (elem.matches(selector)) { |
| [3554](#L3554) | parents.push(elem); |
| [3555](#L3555) | } |
| [3556](#L3556) | continue; |
| [3557](#L3557) | } |
| [3558](#L3558) | parents.push(elem); |
| [3559](#L3559) | } |
| [3560](#L3560) |  |
| [3561](#L3561) | return parents; |
| [3562](#L3562) | }, |
| [3563](#L3563) | bookingpress\_remove\_date\_range\_picker\_focus(event){ |
| [3564](#L3564) | <?php |
| [3565](#L3565) | if(wp\_is\_mobile()){ |
| [3566](#L3566) | ?> |
| [3567](#L3567) | const datepickerinput = document.querySelectorAll(".el-range-input"); |
| [3568](#L3568) | if(typeof datepickerinput != "undefined"){ |
| [3569](#L3569) | datepickerinput.forEach((dateItem) => { |
| [3570](#L3570) | dateItem.blur(); |
| [3571](#L3571) | }); |
| [3572](#L3572) | } |
| [3573](#L3573) | <?php |
| [3574](#L3574) | } |
| [3575](#L3575) | ?> |
| [3576](#L3576) | }, |
| [3577](#L3577) | <?php do\_action( 'bookingpress\_admin\_panel\_vue\_methods'); ?> |
| [3578](#L3578) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_vue\_methods'); ?> |
| [3579](#L3579) | }, |
| [3580](#L3580) | }); |
| [3581](#L3581) | }); |
| [3582](#L3582) | </script> |
| [3583](#L3583) | <?php |
| [3584](#L3584) | } |
| [3585](#L3585) | } |
| [3586](#L3586) |  |
| [3587](#L3587) | /\*\* |
| [3588](#L3588) | \* Check current page is front page or not |
| [3589](#L3589) | \* |
| [3590](#L3590) | \* @return void |
| [3591](#L3591) | \*/ |
| [3592](#L3592) | function bookingpress\_is\_front\_page() |
| [3593](#L3593) | { |
| [3594](#L3594) | global $wp, $wpdb, $wp\_query, $post; |
| [3595](#L3595) | if (! is\_admin() ) { |
| [3596](#L3596) | $bookingpress\_is\_front\_page = false; |
| [3597](#L3597) | $found\_matches = array(); |
| [3598](#L3598) | $pattern       = '\[(\[?)(bookingpress\_(.\*?))(?![\w-])([^\]\/]\*(?:\/(?!\])[^\]\/]\*)\*?)(?:(\/)\]|\](?:([^\[]\*+(?:\[(?!\/\2\])[^\[]\*+)\*+)\[\/\2\])?)(\]?)'; |
| [3599](#L3599) | $posts         = $wp\_query->posts; |
| [3600](#L3600) | if (is\_array($posts) ) { |
| [3601](#L3601) | foreach ( $posts as $mypost ) { |
| [3602](#L3602) | if (preg\_match\_all('/' . $pattern . '/s', $mypost->post\_content, $matches) > 0 ) { |
| [3603](#L3603) | $found\_matches[] = $matches; |
| [3604](#L3604) | } |
| [3605](#L3605) | } |
| [3606](#L3606) | } |
| [3607](#L3607) | /\* Remove empty array values. \*/ |
| [3608](#L3608) |  |
| [3609](#L3609) | $found\_matches = $this->bpa\_array\_trim($found\_matches); |
| [3610](#L3610) | if (! empty($found\_matches) && count($found\_matches) > 0 ) { |
| [3611](#L3611) | $bookingpress\_is\_front\_page = true; |
| [3612](#L3612) | } |
| [3613](#L3613) | $bookingpress\_is\_front\_page = apply\_filters('bookingpress\_check\_front\_page\_or\_not', $bookingpress\_is\_front\_page); |
| [3614](#L3614) | return $bookingpress\_is\_front\_page; |
| [3615](#L3615) | } |
| [3616](#L3616) | } |
| [3617](#L3617) |  |
| [3618](#L3618) | function bpa\_array\_trim( $array ) |
| [3619](#L3619) | { |
| [3620](#L3620) | if (is\_array($array) ) { |
| [3621](#L3621) | foreach ( $array as $key => $value ) { |
| [3622](#L3622) | if (is\_array($value) ) { |
| [3623](#L3623) | $array[ $key ] = $this->bpa\_array\_trim($value); |
| [3624](#L3624) | } else { |
| [3625](#L3625) | $array[ $key ] = trim($value); |
| [3626](#L3626) | } |
| [3627](#L3627) | if (empty($array[ $key ]) ) { |
| [3628](#L3628) | unset($array[ $key ]); |
| [3629](#L3629) | } |
| [3630](#L3630) | } |
| [3631](#L3631) | } else { |
| [3632](#L3632) | $array = trim($array); |
| [3633](#L3633) | } |
| [3634](#L3634) | return $array; |
| [3635](#L3635) | } |
| [3636](#L3636) |  |
| [3637](#L3637) | /\*\* |
| [3638](#L3638) | \* Get help drawer content |
| [3639](#L3639) | \* |
| [3640](#L3640) | \* @return void |
| [3641](#L3641) | \*/ |
| [3642](#L3642) | function bookingpress\_get\_help\_data\_func() |
| [3643](#L3643) | { |
| [3644](#L3644) | $response              = array(); |
| [3645](#L3645) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [3646](#L3646) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [3647](#L3647) | if (! $bpa\_verify\_nonce\_flag ) { |
| [3648](#L3648) | $response['variant'] = 'error'; |
| [3649](#L3649) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3650](#L3650) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [3651](#L3651) | wp\_send\_json($response); |
| [3652](#L3652) | die(); |
| [3653](#L3653) | } |
| [3654](#L3654) | $bookingpress\_documentation\_content = ''; |
| [3655](#L3655) | if (! empty($\_POST['action']) && ! empty($\_POST['module']) && ! empty($\_POST['page']) && ! empty($\_POST['type']) ) { |
| [3656](#L3656) | $help\_module = sanitize\_text\_field($\_POST['module']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [3657](#L3657) | $help\_page   = sanitize\_text\_field($\_POST['page']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [3658](#L3658) | $help\_type   = sanitize\_text\_field($\_POST['type']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [3659](#L3659) |  |
| [3660](#L3660) | $bookingpress\_remote\_url = 'https://www.bookingpressplugin.com/'; |
| [3661](#L3661) |  |
| [3662](#L3662) | if ($help\_type == 'list' ) { |
| [3663](#L3663) | $bookingpress\_remote\_params = array( |
| [3664](#L3664) | 'method'  => 'POST', |
| [3665](#L3665) | 'body'    => array( |
| [3666](#L3666) | 'action' => 'get\_documentation', |
| [3667](#L3667) | 'module' => $help\_module, |
| [3668](#L3668) | 'page'   => 'list\_' . $help\_module, |
| [3669](#L3669) | ), |
| [3670](#L3670) | 'timeout' => 45, |
| [3671](#L3671) | ); |
| [3672](#L3672) |  |
| [3673](#L3673) | $bookingpress\_documentation\_res = wp\_remote\_post($bookingpress\_remote\_url, $bookingpress\_remote\_params); |
| [3674](#L3674) | if (! is\_wp\_error($bookingpress\_documentation\_res) ) { |
| [3675](#L3675) | $bookingpress\_documentation\_content = ! empty($bookingpress\_documentation\_res['body']) ? $bookingpress\_documentation\_res['body'] : ''; |
| [3676](#L3676) | } else { |
| [3677](#L3677) | $bookingpress\_documentation\_content = $bookingpress\_documentation\_res->get\_error\_message(); |
| [3678](#L3678) | } |
| [3679](#L3679) | } elseif ($help\_type == 'add' ) { |
| [3680](#L3680) | $bookingpress\_remote\_params = array( |
| [3681](#L3681) | 'method'  => 'POST', |
| [3682](#L3682) | 'body'    => array( |
| [3683](#L3683) | 'action' => 'get\_documentation', |
| [3684](#L3684) | 'module' => $help\_module, |
| [3685](#L3685) | 'page'   => 'list\_' . $help\_module, |
| [3686](#L3686) | ), |
| [3687](#L3687) | 'timeout' => 45, |
| [3688](#L3688) | ); |
| [3689](#L3689) |  |
| [3690](#L3690) | $bookingpress\_documentation\_res = wp\_remote\_post($bookingpress\_remote\_url, $bookingpress\_remote\_params); |
| [3691](#L3691) | if (! is\_wp\_error($bookingpress\_documentation\_res) ) { |
| [3692](#L3692) | $bookingpress\_documentation\_content = ! empty($bookingpress\_documentation\_res['body']) ? $bookingpress\_documentation\_res['body'] : ''; |
| [3693](#L3693) | } else { |
| [3694](#L3694) | $bookingpress\_documentation\_content = $bookingpress\_documentation\_res->get\_error\_message(); |
| [3695](#L3695) | } |
| [3696](#L3696) | } |
| [3697](#L3697) | } |
| [3698](#L3698) | // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped -- Reason: output is properly escaped or hardcoded |
| [3699](#L3699) |  |
| [3700](#L3700) | echo $bookingpress\_documentation\_content; //phpcs:ignore |
| [3701](#L3701) | exit(); |
| [3702](#L3702) | } |
| [3703](#L3703) |  |
| [3704](#L3704) | /\*\* |
| [3705](#L3705) | \* Ajax based action after deleted user |
| [3706](#L3706) | \* |
| [3707](#L3707) | \* @param  mixed $user\_id |
| [3708](#L3708) | \* @param  mixed $reassign |
| [3709](#L3709) | \* @return void |
| [3710](#L3710) | \*/ |
| [3711](#L3711) | function bookingpress\_after\_deleted\_user\_action( $user\_id, $reassign = 1 ) |
| [3712](#L3712) | { |
| [3713](#L3713) | global $wpdb, $tbl\_bookingpress\_customers; |
| [3714](#L3714) | $wpdb->delete($tbl\_bookingpress\_customers, array( 'bookingpress\_wpuser\_id' => $user\_id ), array( '%d' )); |
| [3715](#L3715) | } |
| [3716](#L3716) |  |
| [3717](#L3717) | /\* Setting Capabilities for user \*/ |
| [3718](#L3718) | function bookingpress\_capabilities() |
| [3719](#L3719) | { |
| [3720](#L3720) | $cap = array( |
| [3721](#L3721) | 'bookingpress'               => '', |
| [3722](#L3722) | 'bookingpress\_calendar'      => esc\_html\_\_('Calendar', 'bookingpress-appointment-booking'), |
| [3723](#L3723) | 'bookingpress\_appointments'  => esc\_html\_\_('Appointments', 'bookingpress-appointment-booking'), |
| [3724](#L3724) | 'bookingpress\_payments'      => esc\_html\_\_('Payments', 'bookingpress-appointment-booking'), |
| [3725](#L3725) | 'bookingpress\_customers'     => esc\_html\_\_('Customers', 'bookingpress-appointment-booking'), |
| [3726](#L3726) | 'bookingpress\_services'      => esc\_html\_\_('Services', 'bookingpress-appointment-booking'), |
| [3727](#L3727) | 'bookingpress\_notifications' => esc\_html\_\_('Notifications', 'bookingpress-appointment-booking'), |
| [3728](#L3728) | 'bookingpress\_customize'     => esc\_html\_\_('Customize', 'bookingpress-appointment-booking'), |
| [3729](#L3729) | 'bookingpress\_settings'      => esc\_html\_\_('Settings', 'bookingpress-appointment-booking'), |
| [3730](#L3730) | 'bookingpress\_payment\_settings' => esc\_html\_\_( 'Payment Settings', 'bookingpress-appointment-booking' ), |
| [3731](#L3731) | 'bookingpress\_addons'        => esc\_html\_\_('Add ons', 'bookingpress-appointment-booking'), |
| [3732](#L3732) | 'bookingpress\_growth\_tools'  => esc\_html\_\_('Growth Plugins', 'bookingpress-appointment-booking'), |
| [3733](#L3733) | ); |
| [3734](#L3734) | return $cap; |
| [3735](#L3735) | } |
| [3736](#L3736) |  |
| [3737](#L3737) | function bookingpress\_prevent\_rocket\_loader\_script( $tag, $handle ) |
| [3738](#L3738) | { |
| [3739](#L3739) | $script   = htmlspecialchars($tag); |
| [3740](#L3740) | $pattern2 = '/\/(wp\-content\/plugins\/bookingpress)|(wp\-includes\/js)/'; |
| [3741](#L3741) | preg\_match($pattern2, $script, $match\_script); |
| [3742](#L3742) |  |
| [3743](#L3743) | /\* Check if current script is loaded from bookingpress only \*/ |
| [3744](#L3744) | if (! isset($match\_script[0]) || $match\_script[0] == '' ) { |
| [3745](#L3745) | return $tag; |
| [3746](#L3746) | } |
| [3747](#L3747) |  |
| [3748](#L3748) | $pattern = '/(.\*?)(data\-cfasync\=)(.\*?)/'; |
| [3749](#L3749) | preg\_match\_all($pattern, $tag, $matches); |
| [3750](#L3750) | if (! is\_array($matches) ) { |
| [3751](#L3751) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3752](#L3752) | } elseif (! empty($matches) && ! empty($matches[2]) && ! empty($matches[2][0]) && strtolower(trim($matches[2][0])) != 'data-cfasync=' ) { |
| [3753](#L3753) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3754](#L3754) | } elseif (! empty($matches) && empty($matches[2]) ) { |
| [3755](#L3755) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3756](#L3756) | } else { |
| [3757](#L3757) | return $tag; |
| [3758](#L3758) | } |
| [3759](#L3759) | } |
| [3760](#L3760) |  |
| [3761](#L3761) | function bookingpress\_prevent\_rocket\_loader\_script\_clf\_advanced( $tag, $handle ){ |
| [3762](#L3762) |  |
| [3763](#L3763) | $script = htmlspecialchars($tag); |
| [3764](#L3764) |  |
| [3765](#L3765) | $regex = '/(.\*?)(<script(\s)id=(\'|\")bookingpress(.\*)\-(after|before)(\'|\"))\>(.\*?)/'; |
| [3766](#L3766) |  |
| [3767](#L3767) | $handle\_arr = ['wcap\_vue\_js']; |
| [3768](#L3768) |  |
| [3769](#L3769) | $handle\_arr = apply\_filters( 'bookingpress\_skip\_loader\_tags', $handle\_arr, $tag, $handle ); |
| [3770](#L3770) |  |
| [3771](#L3771) | if( preg\_match( '/bookingpress/', $handle ) || preg\_match( '/bookingpress/', $script ) || preg\_match('/id=&#039;bookingpress/', $script) || in\_array( $handle, $handle\_arr ) ){ |
| [3772](#L3772) | if( preg\_match( '/\=(\'|")/', $tag, $matches\_ ) ){ |
| [3773](#L3773) | if( !empty( $matches\_[1] ) ){ |
| [3774](#L3774) | $tag = str\_replace( " src", " data-cfasync=". $matches\_[1]."false".$matches\_[1]." src", $tag ); |
| [3775](#L3775) | } else { |
| [3776](#L3776) | $tag = str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3777](#L3777) | } |
| [3778](#L3778) | } else { |
| [3779](#L3779) | $tag = str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3780](#L3780) | } |
| [3781](#L3781) | } |
| [3782](#L3782) |  |
| [3783](#L3783) | if( preg\_match( $regex, $tag, $matches ) ){ |
| [3784](#L3784) | $replaced = preg\_replace( $regex, '$1<script$3id=$4bookingpress$5-$6$7 data-cfasync=$4false$7>$8', $tag ); |
| [3785](#L3785) | if( null != $replaced ){ |
| [3786](#L3786) | $tag = $replaced; |
| [3787](#L3787) | } |
| [3788](#L3788) | } |
| [3789](#L3789) |  |
| [3790](#L3790) | if( preg\_match( '/(<img data\-cfasync\=\"false\")/', $tag ) ){ |
| [3791](#L3791) | $tag = preg\_replace( '/(<img data\-cfasync\=\"false\")/', '<img ', $tag ); |
| [3792](#L3792) | } |
| [3793](#L3793) |  |
| [3794](#L3794) | return $tag; |
| [3795](#L3795) | } |
| [3796](#L3796) |  |
| [3797](#L3797) | function bookingpress\_prevent\_rocket\_loader\_script\_clf( $tag, $handle ) |
| [3798](#L3798) | { |
| [3799](#L3799) | $script   = htmlspecialchars($tag); |
| [3800](#L3800) | $pattern2 = '/\/(wp\-content\/plugins\/bookingpress)|(wp\-includes\/js)/'; |
| [3801](#L3801) | preg\_match($pattern2, $script, $match\_script); |
| [3802](#L3802) |  |
| [3803](#L3803) | /\* Check if current script is loaded from bookingpress only \*/ |
| [3804](#L3804) | if (! isset($match\_script[0]) || $match\_script[0] == '' ) { |
| [3805](#L3805) | return $tag; |
| [3806](#L3806) | } |
| [3807](#L3807) |  |
| [3808](#L3808) | $pattern = '/(.\*?)(data\-cfasync\=)(.\*?)/'; |
| [3809](#L3809) | preg\_match\_all($pattern, $tag, $matches); |
| [3810](#L3810) |  |
| [3811](#L3811) | $pattern3 = '/type\=(\'|")[a-zA-Z0-9]+\-(text\/javascript)(\'|")/'; |
| [3812](#L3812) | preg\_match\_all($pattern3, $tag, $match\_tag); |
| [3813](#L3813) |  |
| [3814](#L3814) | if (! isset($match\_tag[0]) || empty($match\_tag[0]) ) { |
| [3815](#L3815) | return $tag; |
| [3816](#L3816) | } |
| [3817](#L3817) |  |
| [3818](#L3818) | if (! is\_array($matches) ) { |
| [3819](#L3819) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3820](#L3820) | } elseif (! empty($matches) && ! empty($matches[2]) && ! empty($matches[2][0]) && strtolower(trim($matches[2][0])) != 'data-cfasync=' ) { |
| [3821](#L3821) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3822](#L3822) | } elseif (! empty($matches) && empty($matches[2]) ) { |
| [3823](#L3823) | return str\_replace(' src', ' data-cfasync="false" src', $tag); |
| [3824](#L3824) | } else { |
| [3825](#L3825) | return $tag; |
| [3826](#L3826) | } |
| [3827](#L3827) | } |
| [3828](#L3828) |  |
| [3829](#L3829) | /\*\* |
| [3830](#L3830) | \* Restrict Network Activation |
| [3831](#L3831) | \*/ |
| [3832](#L3832) | public static function bookingpress\_check\_network\_activation( $network\_wide ) |
| [3833](#L3833) | { |
| [3834](#L3834) | if (! $network\_wide ) { |
| [3835](#L3835) | return; |
| [3836](#L3836) | } |
| [3837](#L3837) |  |
| [3838](#L3838) | deactivate\_plugins(plugin\_basename(BOOKINGPRESS\_DIR . '/bookingpress.php'), true, true); |
| [3839](#L3839) |  |
| [3840](#L3840) | header('Location: ' . network\_admin\_url('plugins.php?deactivate=true')); |
| [3841](#L3841) | exit; |
| [3842](#L3842) | } |
| [3843](#L3843) |  |
| [3844](#L3844) | public static function install() |
| [3845](#L3845) | { |
| [3846](#L3846) | global $wpdb,$BookingPress, $bookingpress\_version; |
| [3847](#L3847) |  |
| [3848](#L3848) | $\_version = get\_option('bookingpress\_version'); |
| [3849](#L3849) | if (empty($\_version) || $\_version == '' ) { |
| [3850](#L3850) | $bookingpress\_custom\_css\_key = uniqid(); |
| [3851](#L3851) | update\_option('bookingpress\_custom\_css\_key', $bookingpress\_custom\_css\_key); |
| [3852](#L3852) |  |
| [3853](#L3853) | include\_once ABSPATH . 'wp-admin/includes/upgrade.php'; |
| [3854](#L3854) | @set\_time\_limit(0); |
| [3855](#L3855) | global $wpdb, $bookingpress\_version; |
| [3856](#L3856) |  |
| [3857](#L3857) | $charset\_collate = ''; |
| [3858](#L3858) | if ($wpdb->has\_cap('collation') ) { |
| [3859](#L3859) | if (! empty($wpdb->charset) ) { |
| [3860](#L3860) | $charset\_collate = "DEFAULT CHARACTER SET $wpdb->charset"; |
| [3861](#L3861) | } |
| [3862](#L3862) | if (! empty($wpdb->collate) ) { |
| [3863](#L3863) | $charset\_collate .= " COLLATE $wpdb->collate"; |
| [3864](#L3864) | } |
| [3865](#L3865) | } |
| [3866](#L3866) |  |
| [3867](#L3867) | update\_option('bookingpress\_version', $bookingpress\_version); |
| [3868](#L3868) | update\_option('bookingpress\_plugin\_activated', 1); |
| [3869](#L3869) | update\_option('bookingpress\_timezone', wp\_timezone\_string() ); |
| [3870](#L3870) |  |
| [3871](#L3871) | $bookingpress\_pro\_version = get\_option('bookingpress\_pro\_version'); |
| [3872](#L3872) | if($bookingpress\_pro\_version != ''){ |
| [3873](#L3873) | update\_option('bookingpress\_pro\_exist\_on\_activate\_lite\_'.$bookingpress\_version,$bookingpress\_pro\_version); |
| [3874](#L3874) | } |
| [3875](#L3875) |  |
| [3876](#L3876) | $bookingpress\_dbtbl\_create = array(); |
| [3877](#L3877) | /\* Table structure for `Members activity` \*/ |
| [3878](#L3878) | global $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_settings, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_default\_daysoff, $tbl\_bookingpress\_notifications, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_form\_fields, $tbl\_bookingpress\_customize\_settings,$tbl\_bookingpress\_debug\_payment\_log, $tbl\_bookingpress\_customers\_meta, $tbl\_bookingpress\_other\_debug\_logs,$tbl\_bookingpress\_entries\_meta, $tbl\_bookingpress\_double\_bookings,$tbl\_bookingpress\_transient,$tbl\_bookingpress\_export\_data\_log,$tbl\_bookingpress\_export\_data\_log\_detail,$tbl\_bookingpress\_import\_data\_log,$tbl\_bookingpress\_import\_detail\_log,$tbl\_bookingpress\_import\_record\_rel,$tbl\_bookingpress\_import\_images; |
| [3879](#L3879) |  |
| [3880](#L3880) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_categories}`( |
| [3881](#L3881) | `bookingpress\_category\_id` SMALLINT NOT NULL AUTO\_INCREMENT, |
| [3882](#L3882) | `bookingpress\_category\_name` VARCHAR(255) NOT NULL, |
| [3883](#L3883) | `bookingpress\_category\_position` SMALLINT NOT NULL, |
| [3884](#L3884) | `bookingpress\_categorydate\_created` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [3885](#L3885) | PRIMARY KEY (`bookingpress\_category\_id`) |
| [3886](#L3886) | ) {$charset\_collate};"; |
| [3887](#L3887) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_categories ] = dbDelta($sql\_table); |
| [3888](#L3888) |  |
| [3889](#L3889) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_services}`( |
| [3890](#L3890) | `bookingpress\_service\_id` INT(11) NOT NULL AUTO\_INCREMENT, |
| [3891](#L3891) | `bookingpress\_category\_id` SMALLINT DEFAULT 0, |
| [3892](#L3892) | `bookingpress\_service\_name` VARCHAR(255) NOT NULL, |
| [3893](#L3893) | `bookingpress\_service\_price` DOUBLE NOT NULL, |
| [3894](#L3894) | `bookingpress\_service\_duration\_val` INT(11) NOT NULL, |
| [3895](#L3895) | `bookingpress\_service\_duration\_unit` VARCHAR(1) NOT NULL, |
| [3896](#L3896) | `bookingpress\_service\_description` TEXT NOT NULL, |
| [3897](#L3897) | `bookingpress\_service\_position` INT(11) NOT NULL, |
| [3898](#L3898) | `bookingpress\_servicedate\_created` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [3899](#L3899) | PRIMARY KEY (`bookingpress\_service\_id`) |
| [3900](#L3900) | ) {$charset\_collate};"; |
| [3901](#L3901) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_services ] = dbDelta($sql\_table); |
| [3902](#L3902) |  |
| [3903](#L3903) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_servicesmeta}`( |
| [3904](#L3904) | `bookingpress\_servicemeta\_id` INT(11) NOT NULL AUTO\_INCREMENT, |
| [3905](#L3905) | `bookingpress\_service\_id` INT(11) NOT NULL, |
| [3906](#L3906) | `bookingpress\_servicemeta\_name` VARCHAR(255) NOT NULL, |
| [3907](#L3907) | `bookingpress\_servicemeta\_value` TEXT NOT NULL, |
| [3908](#L3908) | `bookingpress\_servicemetadate\_created` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [3909](#L3909) | PRIMARY KEY (`bookingpress\_servicemeta\_id`) |
| [3910](#L3910) | ) {$charset\_collate};"; |
| [3911](#L3911) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_servicesmeta ] = dbDelta($sql\_table); |
| [3912](#L3912) |  |
| [3913](#L3913) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_customers}`( |
| [3914](#L3914) | `bookingpress\_customer\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [3915](#L3915) | `bookingpress\_wpuser\_id` bigint(11) DEFAULT NULL, |
| [3916](#L3916) | `bookingpress\_user\_login` VARCHAR(60) NOT NULL DEFAULT '', |
| [3917](#L3917) | `bookingpress\_user\_status` INT(1) NOT NULL, |
| [3918](#L3918) | `bookingpress\_user\_type` INT(1) DEFAULT 0, |
| [3919](#L3919) | `bookingpress\_user\_name` VARCHAR(255) NOT NULL, |
| [3920](#L3920) | `bookingpress\_user\_firstname` VARCHAR(255) NOT NULL, |
| [3921](#L3921) | `bookingpress\_user\_lastname` VARCHAR(255) NOT NULL, |
| [3922](#L3922) | `bookingpress\_customer\_full\_name` VARCHAR(255) NOT NULL, |
| [3923](#L3923) | `bookingpress\_user\_email` VARCHAR(255) NOT NULL, |
| [3924](#L3924) | `bookingpress\_user\_phone` VARCHAR(63) DEFAULT NULL, |
| [3925](#L3925) | `bookingpress\_user\_country\_phone` VARCHAR(60) DEFAULT NULL, |
| [3926](#L3926) | `bookingpress\_user\_country\_dial\_code` VARCHAR(5) DEFAULT NULL, |
| [3927](#L3927) | `bookingpress\_user\_timezone` VARCHAR(50) DEFAULT NULL, |
| [3928](#L3928) | `bookingpress\_created\_at` INT(1) NOT NULL DEFAULT 0, |
| [3929](#L3929) | `bookingpress\_created\_by` INT(11) NOT NULL DEFAULT 0, |
| [3930](#L3930) | `bookingpress\_user\_created` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [3931](#L3931) | PRIMARY KEY (`bookingpress\_customer\_id`) |
| [3932](#L3932) | ) {$charset\_collate};"; |
| [3933](#L3933) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_customers ] = dbDelta($sql\_table); |
| [3934](#L3934) |  |
| [3935](#L3935) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_settings}`( |
| [3936](#L3936) | `setting\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [3937](#L3937) | `setting\_name` varchar(255) NOT NULL, |
| [3938](#L3938) | `setting\_value` TEXT DEFAULT NULL, |
| [3939](#L3939) | `setting\_type` varchar(255) DEFAULT NULL, |
| [3940](#L3940) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [3941](#L3941) | PRIMARY KEY (`setting\_id`) |
| [3942](#L3942) | ) {$charset\_collate}"; |
| [3943](#L3943) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_settings ] = dbDelta($sql\_table); |
| [3944](#L3944) |  |
| [3945](#L3945) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_default\_workhours}`( |
| [3946](#L3946) | `bookingpress\_workhours\_id` smallint NOT NULL AUTO\_INCREMENT, |
| [3947](#L3947) | `bookingpress\_workday\_key` varchar(11) NOT NULL, |
| [3948](#L3948) | `bookingpress\_start\_time` time DEFAULT NULL, |
| [3949](#L3949) | `bookingpress\_end\_time` time DEFAULT NULL, |
| [3950](#L3950) | `bookingpress\_is\_break` TINYINT(1) DEFAULT 0, |
| [3951](#L3951) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [3952](#L3952) | PRIMARY KEY (`bookingpress\_workhours\_id`) |
| [3953](#L3953) | ) {$charset\_collate}"; |
| [3954](#L3954) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_default\_workhours ] = dbDelta($sql\_table); |
| [3955](#L3955) |  |
| [3956](#L3956) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_default\_daysoff}`( |
| [3957](#L3957) | `bookingpress\_dayoff\_id` smallint NOT NULL AUTO\_INCREMENT, |
| [3958](#L3958) | `bookingpress\_name` varchar(255) NOT NULL, |
| [3959](#L3959) | `bookingpress\_dayoff\_date` datetime DEFAULT NULL, |
| [3960](#L3960) | `bookingpress\_dayoff\_enddate` date DEFAULT NULL, |
| [3961](#L3961) | `bookingpress\_dayoff\_parent` int(11) NOT NULL DEFAULT 0, |
| [3962](#L3962) | `bookingpress\_repeat` TINYINT(1) DEFAULT 0, |
| [3963](#L3963) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [3964](#L3964) | PRIMARY KEY (`bookingpress\_dayoff\_id`) |
| [3965](#L3965) | ) {$charset\_collate}"; |
| [3966](#L3966) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_default\_daysoff ] = dbDelta($sql\_table); |
| [3967](#L3967) |  |
| [3968](#L3968) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_notifications}`( |
| [3969](#L3969) | `bookingpress\_notification\_id` smallint NOT NULL AUTO\_INCREMENT, |
| [3970](#L3970) | `bookingpress\_notification\_receiver\_type` varchar(11) DEFAULT 'customer', |
| [3971](#L3971) | `bookingpress\_notification\_is\_custom` TINYINT(1) DEFAULT 0, |
| [3972](#L3972) | `bookingpress\_notification\_name` varchar(255) NOT NULL, |
| [3973](#L3973) | `bookingpress\_notification\_execution\_type` varchar(11) DEFAULT 'action', |
| [3974](#L3974) | `bookingpress\_notification\_status` TINYINT(1) DEFAULT 0, |
| [3975](#L3975) | `bookingpress\_notification\_type` varchar(255) DEFAULT 'appointment', |
| [3976](#L3976) | `bookingpress\_notification\_appointment\_status` varchar(255) DEFAULT 'approved', |
| [3977](#L3977) | `bookingpress\_notification\_event\_action` varchar(255) DEFAULT 'booked', |
| [3978](#L3978) | `bookingpress\_notification\_send\_only\_this` TINYINT(1) DEFAULT 0, |
| [3979](#L3979) | `bookingpress\_notification\_subject` TEXT DEFAULT NULL, |
| [3980](#L3980) | `bookingpress\_notification\_message` TEXT DEFAULT NULL, |
| [3981](#L3981) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [3982](#L3982) | `bookingpress\_updated\_at` datetime DEFAULT '1970-01-01 00:00:00', |
| [3983](#L3983) | PRIMARY KEY (`bookingpress\_notification\_id`) |
| [3984](#L3984) | ) {$charset\_collate}"; |
| [3985](#L3985) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_notifications ] = dbDelta($sql\_table); |
| [3986](#L3986) |  |
| [3987](#L3987) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_appointment\_bookings}`( |
| [3988](#L3988) | `bookingpress\_appointment\_booking\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [3989](#L3989) | `bookingpress\_booking\_id` varchar(255) DEFAULT NULL, |
| [3990](#L3990) | `bookingpress\_entry\_id` bigint(11) DEFAULT NULL, |
| [3991](#L3991) | `bookingpress\_payment\_id` bigint(11) DEFAULT 0, |
| [3992](#L3992) | `bookingpress\_customer\_id` bigint(11) NOT NULL, |
| [3993](#L3993) | `bookingpress\_customer\_name` varchar(255) DEFAULT NULL, |
| [3994](#L3994) | `bookingpress\_username` varchar(255) DEFAULT NULL, |
| [3995](#L3995) | `bookingpress\_customer\_phone` varchar(255) DEFAULT NULL, |
| [3996](#L3996) | `bookingpress\_customer\_firstname` varchar(255) DEFAULT NULL, |
| [3997](#L3997) | `bookingpress\_customer\_lastname` varchar(255) DEFAULT NULL, |
| [3998](#L3998) | `bookingpress\_customer\_country` VARCHAR(60) DEFAULT NULL, |
| [3999](#L3999) | `bookingpress\_customer\_phone\_dial\_code` VARCHAR(5) DEFAULT NULL, |
| [4000](#L4000) | `bookingpress\_customer\_email` varchar(255) DEFAULT NULL, |
| [4001](#L4001) | `bookingpress\_staff\_member\_id` smallint DEFAULT NULL, |
| [4002](#L4002) | `bookingpress\_service\_id` INT(11) NOT NULL, |
| [4003](#L4003) | `bookingpress\_service\_name` varchar(255) NOT NULL, |
| [4004](#L4004) | `bookingpress\_service\_price` float NOT NULL, |
| [4005](#L4005) | `bookingpress\_service\_currency` varchar(100) NOT NULL, |
| [4006](#L4006) | `bookingpress\_service\_duration\_val` INT(11) NOT NULL, |
| [4007](#L4007) | `bookingpress\_service\_duration\_unit` VARCHAR(1) NOT NULL, |
| [4008](#L4008) | `bookingpress\_appointment\_date` DATE NOT NULL, |
| [4009](#L4009) | `bookingpress\_appointment\_end\_date` DATE NOT NULL, |
| [4010](#L4010) | `bookingpress\_appointment\_time` TIME NOT NULL, |
| [4011](#L4011) | `bookingpress\_appointment\_end\_time` TIME NOT NULL, |
| [4012](#L4012) | `bookingpress\_appointment\_internal\_note` TEXT DEFAULT NULL, |
| [4013](#L4013) | `bookingpress\_appointment\_send\_notification` TINYINT(1) DEFAULT 0, |
| [4014](#L4014) | `bookingpress\_appointment\_status` smallint(1) DEFAULT 1, |
| [4015](#L4015) | `bookingpress\_paid\_amount` float DEFAULT 0, |
| [4016](#L4016) | `bookingpress\_due\_amount` float DEFAULT 0, |
| [4017](#L4017) | `bookingpress\_appointment\_timezone` varchar(50) DEFAULT NULL, |
| [4018](#L4018) | `bookingpress\_selected\_appointment\_date` DATE NOT NULL, |
| [4019](#L4019) | `bookingpress\_selected\_appointment\_end\_date` DATE NOT NULL, |
| [4020](#L4020) | `bookingpress\_selected\_appointment\_time` TIME NOT NULL, |
| [4021](#L4021) | `bookingpress\_selected\_appointment\_end\_time` TIME NOT NULL, |
| [4022](#L4022) | `bookingpress\_appointment\_token` varchar(50) DEFAULT NULL, |
| [4023](#L4023) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4024](#L4024) | PRIMARY KEY (`bookingpress\_appointment\_booking\_id`) |
| [4025](#L4025) | ) {$charset\_collate}"; |
| [4026](#L4026) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_appointment\_bookings ] = dbDelta($sql\_table); |
| [4027](#L4027) |  |
| [4028](#L4028) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_payment\_logs}`( |
| [4029](#L4029) | `bookingpress\_payment\_log\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [4030](#L4030) | `bookingpress\_invoice\_id` varchar(50) DEFAULT 0, |
| [4031](#L4031) | `bookingpress\_appointment\_booking\_ref` bigint(11) DEFAULT NULL, |
| [4032](#L4032) | `bookingpress\_customer\_id` bigint(11) NOT NULL, |
| [4033](#L4033) | `bookingpress\_customer\_name` varchar(255) DEFAULT NULL, |
| [4034](#L4034) | `bookingpress\_username` varchar(255) DEFAULT NULL, |
| [4035](#L4035) | `bookingpress\_customer\_phone` varchar(255) DEFAULT NULL, |
| [4036](#L4036) | `bookingpress\_customer\_firstname` varchar(255) DEFAULT NULL, |
| [4037](#L4037) | `bookingpress\_customer\_lastname` varchar(255) DEFAULT NULL, |
| [4038](#L4038) | `bookingpress\_customer\_country` VARCHAR(60) DEFAULT NULL, |
| [4039](#L4039) | `bookingpress\_customer\_phone\_dial\_code` VARCHAR(5) DEFAULT NULL, |
| [4040](#L4040) | `bookingpress\_customer\_email` varchar(255) DEFAULT NULL, |
| [4041](#L4041) | `bookingpress\_staff\_member\_id` smallint DEFAULT NULL, |
| [4042](#L4042) | `bookingpress\_service\_id` INT(11) NOT NULL, |
| [4043](#L4043) | `bookingpress\_service\_name` varchar(255) NOT NULL, |
| [4044](#L4044) | `bookingpress\_service\_price` float NOT NULL, |
| [4045](#L4045) | `bookingpress\_service\_duration\_val` INT(11) NOT NULL, |
| [4046](#L4046) | `bookingpress\_service\_duration\_unit` VARCHAR(1) NOT NULL, |
| [4047](#L4047) | `bookingpress\_appointment\_date` DATE NOT NULL, |
| [4048](#L4048) | `bookingpress\_appointment\_end\_date` DATE NOT NULL, |
| [4049](#L4049) | `bookingpress\_appointment\_start\_time` TIME NOT NULL, |
| [4050](#L4050) | `bookingpress\_appointment\_end\_time` TIME NOT NULL, |
| [4051](#L4051) | `bookingpress\_payment\_gateway` varchar(255) DEFAULT NULL, |
| [4052](#L4052) | `bookingpress\_payer\_email` varchar(255) DEFAULT NULL, |
| [4053](#L4053) | `bookingpress\_transaction\_id` varchar(255) DEFAULT NULL, |
| [4054](#L4054) | `bookingpress\_payment\_date\_time` datetime DEFAULT '1970-01-01 00:00:00', |
| [4055](#L4055) | `bookingpress\_payment\_status` smallint(1) DEFAULT 1, |
| [4056](#L4056) | `bookingpress\_payment\_amount` FLOAT(8, 2) DEFAULT 0, |
| [4057](#L4057) | `bookingpress\_payment\_currency` varchar(100) DEFAULT NULL, |
| [4058](#L4058) | `bookingpress\_payment\_type` varchar(20) DEFAULT NULL, |
| [4059](#L4059) | `bookingpress\_payment\_response` TEXT DEFAULT NULL, |
| [4060](#L4060) | `bookingpress\_additional\_info` TEXT DEFAULT NULL, |
| [4061](#L4061) | `bookingpress\_paid\_amount` float DEFAULT 0, |
| [4062](#L4062) | `bookingpress\_due\_amount` float DEFAULT 0, |
| [4063](#L4063) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4064](#L4064) | PRIMARY KEY (`bookingpress\_payment\_log\_id`) |
| [4065](#L4065) | ) {$charset\_collate}"; |
| [4066](#L4066) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_payment\_logs ] = dbDelta($sql\_table); |
| [4067](#L4067) |  |
| [4068](#L4068) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_entries}`( |
| [4069](#L4069) | `bookingpress\_entry\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [4070](#L4070) | `bookingpress\_customer\_id` bigint(11) DEFAULT NULL, |
| [4071](#L4071) | `bookingpress\_customer\_name` varchar(255) DEFAULT NULL, |
| [4072](#L4072) | `bookingpress\_username` varchar(255) DEFAULT NULL, |
| [4073](#L4073) | `bookingpress\_customer\_phone` varchar(255) DEFAULT NULL, |
| [4074](#L4074) | `bookingpress\_customer\_firstname` varchar(255) DEFAULT NULL, |
| [4075](#L4075) | `bookingpress\_customer\_lastname` varchar(255) DEFAULT NULL, |
| [4076](#L4076) | `bookingpress\_customer\_country` VARCHAR(60) DEFAULT NULL, |
| [4077](#L4077) | `bookingpress\_customer\_phone\_dial\_code` VARCHAR(5) DEFAULT NULL, |
| [4078](#L4078) | `bookingpress\_customer\_email` varchar(255) DEFAULT NULL, |
| [4079](#L4079) | `bookingpress\_customer\_timezone` varchar(50) DEFAULT NULL, |
| [4080](#L4080) | `bookingpress\_service\_id` INT(11) NOT NULL, |
| [4081](#L4081) | `bookingpress\_service\_name` varchar(255) NOT NULL, |
| [4082](#L4082) | `bookingpress\_service\_price` float NOT NULL, |
| [4083](#L4083) | `bookingpress\_service\_currency` varchar(100) NOT NULL, |
| [4084](#L4084) | `bookingpress\_service\_duration\_val` INT(11) NOT NULL, |
| [4085](#L4085) | `bookingpress\_service\_duration\_unit` VARCHAR(1) NOT NULL, |
| [4086](#L4086) | `bookingpress\_payment\_gateway` VARCHAR(255) DEFAULT NULL, |
| [4087](#L4087) | `bookingpress\_appointment\_date` DATE NOT NULL, |
| [4088](#L4088) | `bookingpress\_appointment\_end\_date` DATE NOT NULL, |
| [4089](#L4089) | `bookingpress\_appointment\_time` TIME NOT NULL, |
| [4090](#L4090) | `bookingpress\_appointment\_end\_time` TIME NOT NULL, |
| [4091](#L4091) | `bookingpress\_appointment\_internal\_note` TEXT DEFAULT NULL, |
| [4092](#L4092) | `bookingpress\_appointment\_send\_notifications` TINYINT(1) DEFAULT 0, |
| [4093](#L4093) | `bookingpress\_appointment\_status` varchar(20) NOT NULL, |
| [4094](#L4094) | `bookingpress\_paid\_amount` float DEFAULT 0, |
| [4095](#L4095) | `bookingpress\_due\_amount` float DEFAULT 0, |
| [4096](#L4096) | `bookingpress\_selected\_appointment\_date` DATE NOT NULL, |
| [4097](#L4097) | `bookingpress\_selected\_appointment\_end\_date` DATE NOT NULL, |
| [4098](#L4098) | `bookingpress\_selected\_appointment\_time` TIME NOT NULL, |
| [4099](#L4099) | `bookingpress\_selected\_appointment\_end\_time` TIME NOT NULL, |
| [4100](#L4100) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4101](#L4101) | PRIMARY KEY (`bookingpress\_entry\_id`) |
| [4102](#L4102) | ) {$charset\_collate}"; |
| [4103](#L4103) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_entries ] = dbDelta($sql\_table); |
| [4104](#L4104) |  |
| [4105](#L4105) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_form\_fields}`( |
| [4106](#L4106) | `bookingpress\_form\_field\_id` SMALLINT NOT NULL AUTO\_INCREMENT, |
| [4107](#L4107) | `bookingpress\_form\_field\_name` varchar(255) NOT NULL, |
| [4108](#L4108) | `bookingpress\_field\_required` TINYINT(1) DEFAULT 0, |
| [4109](#L4109) | `bookingpress\_field\_label` TEXT NOT NULL, |
| [4110](#L4110) | `bookingpress\_field\_placeholder` TEXT DEFAULT NULL, |
| [4111](#L4111) | `bookingpress\_field\_error\_message` VARCHAR(255) DEFAULT NULL, |
| [4112](#L4112) | `bookingpress\_field\_is\_hide` TINYINT(1) DEFAULT 0, |
| [4113](#L4113) | `bookingpress\_field\_position` FLOAT DEFAULT 0, |
| [4114](#L4114) | `bookingpress\_field\_is\_default` tinyint(1) DEFAULT 0, |
| [4115](#L4115) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4116](#L4116) | PRIMARY KEY (`bookingpress\_form\_field\_id`) |
| [4117](#L4117) | ) {$charset\_collate}"; |
| [4118](#L4118) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_form\_fields ] = dbDelta($sql\_table); |
| [4119](#L4119) |  |
| [4120](#L4120) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_customize\_settings}`( |
| [4121](#L4121) | `bookingpress\_setting\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4122](#L4122) | `bookingpress\_setting\_name` varchar(255) NOT NULL, |
| [4123](#L4123) | `bookingpress\_setting\_value` TEXT NOT NULL, |
| [4124](#L4124) | `bookingpress\_setting\_type` varchar(255) NOT NULL, |
| [4125](#L4125) | `bookingpress\_created\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4126](#L4126) | PRIMARY KEY (`bookingpress\_setting\_id`) |
| [4127](#L4127) | ) {$charset\_collate}"; |
| [4128](#L4128) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_customize\_settings ] = dbDelta($sql\_table); |
| [4129](#L4129) |  |
| [4130](#L4130) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_debug\_payment\_log}`( |
| [4131](#L4131) | `bookingpress\_payment\_log\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [4132](#L4132) | `bookingpress\_payment\_log\_ref\_id` bigint(11) NOT NULL DEFAULT '0', |
| [4133](#L4133) | `bookingpress\_payment\_log\_gateway` varchar(255) DEFAULT NULL, |
| [4134](#L4134) | `bookingpress\_payment\_log\_event` varchar(255) DEFAULT NULL, |
| [4135](#L4135) | `bookingpress\_payment\_log\_event\_from` varchar(255) DEFAULT NULL, |
| [4136](#L4136) | `bookingpress\_payment\_log\_status` TINYINT(1) DEFAULT '1', |
| [4137](#L4137) | `bookingpress\_payment\_log\_raw\_data` TEXT, |
| [4138](#L4138) | `bookingpress\_payment\_log\_added\_date` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4139](#L4139) | PRIMARY KEY (`bookingpress\_payment\_log\_id`) |
| [4140](#L4140) | ) {$charset\_collate};"; |
| [4141](#L4141) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_debug\_payment\_log ] = dbDelta($sql\_table); |
| [4142](#L4142) |  |
| [4143](#L4143) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_customers\_meta}`( |
| [4144](#L4144) | `bookingpress\_customermeta\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [4145](#L4145) | `bookingpress\_customer\_id` bigint(11) NOT NULL, |
| [4146](#L4146) | `bookingpress\_customersmeta\_key` varchar(255) NOT NULL, |
| [4147](#L4147) | `bookingpress\_customersmeta\_value` TEXT DEFAULT NULL, |
| [4148](#L4148) | `bookingpress\_customersmeta\_created\_date` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4149](#L4149) | PRIMARY KEY (`bookingpress\_customermeta\_id`) |
| [4150](#L4150) | ) {$charset\_collate};"; |
| [4151](#L4151) |  |
| [4152](#L4152) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_customers\_meta ] = dbDelta($sql\_table); |
| [4153](#L4153) |  |
| [4154](#L4154) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_other\_debug\_logs}`( |
| [4155](#L4155) | `bookingpress\_other\_log\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4156](#L4156) | `bookingpress\_other\_log\_ref\_id` int(11) NOT NULL, |
| [4157](#L4157) | `bookingpress\_other\_log\_type` varchar(255) DEFAULT NULL, |
| [4158](#L4158) | `bookingpress\_other\_log\_event` varchar(255) DEFAULT NULL, |
| [4159](#L4159) | `bookingpress\_other\_log\_event\_from` varchar(255) DEFAULT NULL, |
| [4160](#L4160) | `bookingpress\_other\_log\_raw\_data` TEXT DEFAULT NULL, |
| [4161](#L4161) | `bookingpress\_other\_log\_added\_date` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4162](#L4162) | PRIMARY KEY (`bookingpress\_other\_log\_id`) |
| [4163](#L4163) | ) {$charset\_collate};"; |
| [4164](#L4164) |  |
| [4165](#L4165) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_other\_debug\_logs ] = dbDelta($sql\_table); |
| [4166](#L4166) |  |
| [4167](#L4167) |  |
| [4168](#L4168) |  |
| [4169](#L4169) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_entries\_meta}`( |
| [4170](#L4170) | `bookingpress\_entry\_meta\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4171](#L4171) | `bookingpress\_entry\_id` int(11) NOT NULL, |
| [4172](#L4172) | `bookingpress\_entry\_meta\_key` TEXT NOT NULL, |
| [4173](#L4173) | `bookingpress\_entry\_meta\_value` TEXT DEFAULT NULL, |
| [4174](#L4174) | `bookingpress\_entrymeta\_created\_date` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4175](#L4175) | PRIMARY KEY (`bookingpress\_entry\_meta\_id`) |
| [4176](#L4176) | ) {$charset\_collate};"; |
| [4177](#L4177) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_entries\_meta ] = dbDelta($sql\_table); |
| [4178](#L4178) |  |
| [4179](#L4179) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_double\_bookings}`( |
| [4180](#L4180) | `bookingpress\_double\_booking\_id` INT(11) NOT NULL AUTO\_INCREMENT, |
| [4181](#L4181) | `bookingpress\_entry\_id` INT(11) NOT NULL, |
| [4182](#L4182) | `bookingpress\_double\_booking\_reason` LONGTEXT NOT NULL, |
| [4183](#L4183) | `bookingpress\_payment\_gateway` VARCHAR(255) NOT NULL, |
| [4184](#L4184) | `bookingpress\_staffmember\_id` INT(11) DEFAULT 0, |
| [4185](#L4185) | `bookingpress\_payer\_email` varchar(255) DEFAULT NULL, |
| [4186](#L4186) | `bookingpress\_transaction\_id` varchar(255) DEFAULT NULL, |
| [4187](#L4187) | `bookingpress\_payment\_date\_time` datetime DEFAULT '1970-01-01 00:00:00', |
| [4188](#L4188) | `bookingpress\_payment\_status` smallint(1) DEFAULT 1, |
| [4189](#L4189) | `bookingpress\_payment\_amount` FLOAT(8, 2) DEFAULT 0, |
| [4190](#L4190) | `bookingpress\_payment\_currency` varchar(100) DEFAULT NULL, |
| [4191](#L4191) | `bookingpress\_payment\_type` varchar(20) DEFAULT NULL, |
| [4192](#L4192) | `bookingpress\_payment\_response` TEXT DEFAULT NULL, |
| [4193](#L4193) | `bookingpress\_additional\_info` TEXT DEFAULT NULL, |
| [4194](#L4194) | `bookingpress\_request\_raw\_data` LONGTEXT NOT NULL, |
| [4195](#L4195) | `bookingpress\_is\_refund\_supported` TINYINT NOT NULL DEFAULT '0', |
| [4196](#L4196) | `bookingpress\_refund\_response` TEXT NOT NULL, |
| [4197](#L4197) | `bookingpress\_refund\_reason` LONGTEXT NOT NULL, |
| [4198](#L4198) | `bookingpress\_is\_refunded` TINYINT NOT NULL DEFAULT '0', |
| [4199](#L4199) | `bookingpress\_created\_date` timestamp NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4200](#L4200) | PRIMARY KEY ( `bookingpress\_double\_booking\_id` ) |
| [4201](#L4201) | ) {$charset\_collate}"; |
| [4202](#L4202) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_double\_bookings ] = dbDelta( $sql\_table ); |
| [4203](#L4203) |  |
| [4204](#L4204) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_transient}` ( |
| [4205](#L4205) | `bookingpress\_transient\_id` bigint(11) NOT NULL AUTO\_INCREMENT, |
| [4206](#L4206) | `bookingpress\_transient\_key` VARCHAR(100) NOT NULL, |
| [4207](#L4207) | `bookingpress\_transient\_value` LONGTEXT NOT NULL, |
| [4208](#L4208) | `bookingpress\_transient\_expiry` VARCHAR(50) NULL DEFAULT NULL, |
| [4209](#L4209) | `bookingpress\_transient\_created\_date` TIMESTAMP NOT NULL DEFAULT CURRENT\_TIMESTAMP, |
| [4210](#L4210) | PRIMARY KEY (`bookingpress\_transient\_id`) |
| [4211](#L4211) | ) {$charset\_collate}"; |
| [4212](#L4212) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_transient ] = dbDelta( $sql\_table ); |
| [4213](#L4213) |  |
| [4214](#L4214) |  |
| [4215](#L4215) |  |
| [4216](#L4216) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_export\_data\_log}`( |
| [4217](#L4217) | `export\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4218](#L4218) | `export\_data` TEXT DEFAULT NULL, |
| [4219](#L4219) | `export\_complete` int(11) DEFAULT 0, |
| [4220](#L4220) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4221](#L4221) | PRIMARY KEY (`export\_id`) |
| [4222](#L4222) | ) {$charset\_collate}"; |
| [4223](#L4223) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_export\_data\_log ] = dbDelta($sql\_table); |
| [4224](#L4224) |  |
| [4225](#L4225) |  |
| [4226](#L4226) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_export\_data\_log\_detail}`( |
| [4227](#L4227) | `export\_detail\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4228](#L4228) | `export\_id` int(11) NOT NULL, |
| [4229](#L4229) | `export\_detail\_type` varchar(255) NOT NULL, |
| [4230](#L4230) | `export\_detail\_total\_record` int(11) NOT NULL DEFAULT 0, |
| [4231](#L4231) | `export\_detail\_last\_record` int(11) NOT NULL DEFAULT 0, |
| [4232](#L4232) | `export\_detail\_complete` int(11) DEFAULT 0, |
| [4233](#L4233) | `export\_detail\_option` varchar(255) DEFAULT NULL, |
| [4234](#L4234) | `export\_detail\_record\_hide` int(11) DEFAULT 0, |
| [4235](#L4235) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4236](#L4236) | PRIMARY KEY (`export\_detail\_id`) |
| [4237](#L4237) | ) {$charset\_collate}"; |
| [4238](#L4238) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_export\_data\_log\_detail ] = dbDelta($sql\_table); |
| [4239](#L4239) |  |
| [4240](#L4240) |  |
| [4241](#L4241) | $tbl\_bookingpress\_import\_data\_log = $wpdb->prefix.'bookingpress\_import\_data\_log'; |
| [4242](#L4242) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_import\_data\_log}`( |
| [4243](#L4243) | `import\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4244](#L4244) | `import\_data` TEXT DEFAULT NULL, |
| [4245](#L4245) | `import\_complete` int(11) DEFAULT 0, |
| [4246](#L4246) | `export\_key` varchar(255) DEFAULT NULL, |
| [4247](#L4247) | `export\_site\_key` varchar(255) DEFAULT NULL, |
| [4248](#L4248) | `site\_url` varchar(255) DEFAULT NULL, |
| [4249](#L4249) | `import\_stop\_reason` text DEFAULT NULL, |
| [4250](#L4250) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4251](#L4251) | PRIMARY KEY (`import\_id`) |
| [4252](#L4252) | ) {$charset\_collate}"; |
| [4253](#L4253) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_import\_data\_log ] = dbDelta($sql\_table); |
| [4254](#L4254) |  |
| [4255](#L4255) | $tbl\_bookingpress\_import\_detail\_log = $wpdb->prefix.'bookingpress\_import\_detail\_log'; |
| [4256](#L4256) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_import\_detail\_log}`( |
| [4257](#L4257) | `detail\_import\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4258](#L4258) | `import\_id` int(11) NOT NULL, |
| [4259](#L4259) | `detail\_import\_detail\_type` varchar(255) NOT NULL, |
| [4260](#L4260) | `detail\_import\_complete` int(11) DEFAULT 0, |
| [4261](#L4261) | `detail\_import\_total\_record` int(11) NOT NULL DEFAULT 0, |
| [4262](#L4262) | `detail\_import\_last\_record` int(11) NOT NULL DEFAULT 0, |
| [4263](#L4263) | `detail\_import\_display` int(1) NOT NULL DEFAULT 0, |
| [4264](#L4264) | `export\_site\_key` varchar(255) DEFAULT NULL, |
| [4265](#L4265) | `export\_key` varchar(255) DEFAULT NULL, |
| [4266](#L4266) | `detail\_import\_stop\_reason` text DEFAULT NULL, |
| [4267](#L4267) | `total\_import\_record` int(11) NOT NULL DEFAULT 0, |
| [4268](#L4268) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4269](#L4269) | PRIMARY KEY (`detail\_import\_id`) |
| [4270](#L4270) | ) {$charset\_collate}"; |
| [4271](#L4271) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_import\_detail\_log ] = dbDelta($sql\_table); |
| [4272](#L4272) |  |
| [4273](#L4273) | $tbl\_bookingpress\_import\_record\_rel = $wpdb->prefix.'bookingpress\_import\_record\_rel'; |
| [4274](#L4274) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_import\_record\_rel}`( |
| [4275](#L4275) | `record\_rel\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4276](#L4276) | `import\_id` int(11) NOT NULL, |
| [4277](#L4277) | `record\_rel\_type` varchar(255) NOT NULL, |
| [4278](#L4278) | `record\_old\_id` int(11) DEFAULT 0, |
| [4279](#L4279) | `record\_new\_id` int(11) DEFAULT 0, |
| [4280](#L4280) | `record\_rel\_lang\_type` varchar(255) DEFAULT NULL, |
| [4281](#L4281) | `export\_key` varchar(255) DEFAULT NULL, |
| [4282](#L4282) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4283](#L4283) | PRIMARY KEY (`record\_rel\_id`) |
| [4284](#L4284) | ) {$charset\_collate}"; |
| [4285](#L4285) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_import\_record\_rel ] = dbDelta($sql\_table); |
| [4286](#L4286) |  |
| [4287](#L4287) | $tbl\_bookingpress\_import\_images = $wpdb->prefix.'bookingpress\_import\_images'; |
| [4288](#L4288) | $sql\_table = "CREATE TABLE IF NOT EXISTS `{$tbl\_bookingpress\_import\_images}`( |
| [4289](#L4289) | `import\_image\_id` int(11) NOT NULL AUTO\_INCREMENT, |
| [4290](#L4290) | `import\_id` int(11) NOT NULL, |
| [4291](#L4291) | `import\_table` varchar(255) NOT NULL, |
| [4292](#L4292) | `import\_field` varchar(255) DEFAULT NULL, |
| [4293](#L4293) | `import\_table\_id` int(11) DEFAULT 0, |
| [4294](#L4294) | `import\_image\_name` varchar(255) DEFAULT NULL, |
| [4295](#L4295) | `import\_image\_url` varchar(255) DEFAULT NULL, |
| [4296](#L4296) | `import\_image\_complete` int(1) DEFAULT 0, |
| [4297](#L4297) | `export\_key` varchar(255) DEFAULT NULL, |
| [4298](#L4298) | `updated\_at` timestamp DEFAULT CURRENT\_TIMESTAMP, |
| [4299](#L4299) | PRIMARY KEY (`import\_image\_id`) |
| [4300](#L4300) | ) {$charset\_collate}"; |
| [4301](#L4301) | $bookingpress\_dbtbl\_create[ $tbl\_bookingpress\_import\_images ] = dbDelta($sql\_table); |
| [4302](#L4302) |  |
| [4303](#L4303) | $paypal\_payment\_method\_type = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_method\_type', 'payment\_setting'); |
| [4304](#L4304) | if(empty($paypal\_payment\_method\_type)){ |
| [4305](#L4305) | $BookingPress->bookingpress\_update\_settings('paypal\_payment\_method\_type', 'payment\_setting', 'lagacy'); |
| [4306](#L4306) | } |
| [4307](#L4307) |  |
| [4308](#L4308) | $BookingPress->bookingpress\_add\_user\_role\_and\_capabilities(); |
| [4309](#L4309) |  |
| [4310](#L4310) | $BookingPress->bookingpress\_install\_default\_notification\_data(); |
| [4311](#L4311) |  |
| [4312](#L4312) | $BookingPress->bookingpress\_install\_default\_general\_settings\_data(); |
| [4313](#L4313) |  |
| [4314](#L4314) | $BookingPress->bookingpress\_install\_default\_pages(); |
| [4315](#L4315) |  |
| [4316](#L4316) | $BookingPress->bookingpress\_install\_default\_customize\_settings\_data(); |
| [4317](#L4317) |  |
| [4318](#L4318) | /\* Plugin Action Hook After Install Process \*/ |
| [4319](#L4319) | do\_action('bookingpress\_after\_activation\_hook'); |
| [4320](#L4320) | do\_action('bookingpress\_after\_install'); |
| [4321](#L4321) |  |
| [4322](#L4322) | add\_option('bookingpress\_install\_date',current\_time('mysql')); |
| [4323](#L4323) |  |
| [4324](#L4324) |  |
| [4325](#L4325) | $check\_db\_permission = $BookingPress->bookingpress\_check\_db\_permission(); |
| [4326](#L4326) | if($check\_db\_permission) |
| [4327](#L4327) | { |
| [4328](#L4328) | //appointment booking table index |
| [4329](#L4329) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_appointment\_bookings}` ADD INDEX `bookingpress\_appointment\_status-appointment\_date` (`bookingpress\_appointment\_status`, `bookingpress\_appointment\_date`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [4330](#L4330) |  |
| [4331](#L4331) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_appointment\_bookings}` ADD INDEX `bookingpress\_service\_id-appointment\_status-appointment\_date` (`bookingpress\_service\_id`, `bookingpress\_appointment\_status`, `bookingpress\_appointment\_date`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [4332](#L4332) |  |
| [4333](#L4333) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_appointment\_bookings}` ADD INDEX `bookingpress\_appointment\_date-appointment\_time-appointment\_end\_t` (`bookingpress\_appointment\_date`, `bookingpress\_appointment\_time`, `bookingpress\_appointment\_end\_time`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [4334](#L4334) |  |
| [4335](#L4335) | //customer table index |
| [4336](#L4336) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_customers}` ADD INDEX `bookingpress\_user\_type-user\_status` (`bookingpress\_user\_type`, `bookingpress\_user\_status`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [4337](#L4337) |  |
| [4338](#L4338) | //customer meta table index |
| [4339](#L4339) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_customers\_meta}` ADD INDEX `bookingpress\_customer\_id-customersmeta\_key` (`bookingpress\_customer\_id`, `bookingpress\_customersmeta\_key`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers\_meta is table name defined globally. False Positive alarm |
| [4340](#L4340) |  |
| [4341](#L4341) | //payment transaction table index |
| [4342](#L4342) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_payment\_logs}` ADD INDEX `bookingpress\_payment\_date\_time-payment\_status` (`bookingpress\_payment\_date\_time`, `bookingpress\_payment\_status`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [4343](#L4343) |  |
| [4344](#L4344) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_payment\_logs}` ADD INDEX `bookingpress\_service\_id-appointment\_date-start\_time-end\_time` (`bookingpress\_service\_id`, `bookingpress\_appointment\_date`, `bookingpress\_appointment\_start\_time`, `bookingpress\_appointment\_end\_time`);" ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [4345](#L4345) |  |
| [4346](#L4346) | $wpdb->query( "ALTER TABLE `{$tbl\_bookingpress\_transient}` ADD INDEX `bookingpress\_transient\_id\_key\_index` (`bookingpress\_transient\_id`,`bookingpress\_transient\_key`)"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_transient is table name defined globally. False Positive alarm |
| [4347](#L4347) | } |
| [4348](#L4348) |  |
| [4349](#L4349) | } else { |
| [4350](#L4350) | do\_action('bookingpress\_reactivate\_plugin'); |
| [4351](#L4351) | } |
| [4352](#L4352) |  |
| [4353](#L4353) | $args  = array( |
| [4354](#L4354) | 'role'   => 'administrator', |
| [4355](#L4355) | 'fields' => 'id', |
| [4356](#L4356) | ); |
| [4357](#L4357) | $users = get\_users($args); |
| [4358](#L4358) |  |
| [4359](#L4359) | if (count($users) > 0 ) { |
| [4360](#L4360) | foreach ( $users as $key => $user\_id ) { |
| [4361](#L4361) | $bookingpressroles = $BookingPress->bookingpress\_capabilities(); |
| [4362](#L4362) | $userObj           = new WP\_User($user\_id); |
| [4363](#L4363) | foreach ( $bookingpressroles as $bookingpressrole => $bookingpress\_roledescription ) { |
| [4364](#L4364) | $userObj->add\_cap($bookingpressrole); |
| [4365](#L4365) | } |
| [4366](#L4366) | unset($bookingpressrole); |
| [4367](#L4367) | unset($bookingpressroles); |
| [4368](#L4368) | unset($bookingpress\_roledescription); |
| [4369](#L4369) | } |
| [4370](#L4370) | } |
| [4371](#L4371) | } |
| [4372](#L4372) |  |
| [4373](#L4373) | function bookingpress\_check\_db\_permission() |
| [4374](#L4374) | { |
| [4375](#L4375) | global $wpdb; |
| [4376](#L4376) | $results = $wpdb->get\_results("SHOW GRANTS FOR CURRENT\_USER;"); |
| [4377](#L4377) | $allowed\_index = 0; |
| [4378](#L4378) | foreach($results as $result) |
| [4379](#L4379) | { |
| [4380](#L4380) | if(is\_object($result)) |
| [4381](#L4381) | { |
| [4382](#L4382) | foreach($result as $res) |
| [4383](#L4383) | { |
| [4384](#L4384) | $result\_data = stripslashes\_deep($res); |
| [4385](#L4385) | } |
| [4386](#L4386) | } |
| [4387](#L4387) | else { |
| [4388](#L4388) | $result\_data = stripslashes\_deep($result); |
| [4389](#L4389) | } |
| [4390](#L4390) | if( (strpos($result\_data, "ALL PRIVILEGES") !== false || strpos($result\_data, "INDEX") !== false) && (strpos($result\_data, "ON \*.\*") || strpos($result\_data, "`".DB\_NAME."`") ) ) |
| [4391](#L4391) | { |
| [4392](#L4392) | $allowed\_index = 1; |
| [4393](#L4393) | break; |
| [4394](#L4394) | } |
| [4395](#L4395) | } |
| [4396](#L4396) | return $allowed\_index; |
| [4397](#L4397) | } |
| [4398](#L4398) |  |
| [4399](#L4399) | public static function uninstall() |
| [4400](#L4400) | { |
| [4401](#L4401) | global $wp, $wpdb, $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_customers\_meta, $tbl\_bookingpress\_settings, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_default\_daysoff, $tbl\_bookingpress\_notifications,$tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_form\_fields, $tbl\_bookingpress\_customize\_settings, $tbl\_bookingpress\_debug\_payment\_log,$bookingpress\_capabilities\_global,$BookingPress,$tbl\_bookingpress\_other\_debug\_logs, $tbl\_bookingpress\_double\_bookings, $tbl\_bookingpress\_entries\_meta, $tbl\_bookingpress\_transient; |
| [4402](#L4402) | /\*\* |
| [4403](#L4403) | \* Delete Meta Values |
| [4404](#L4404) | \*/ |
| [4405](#L4405) | //set flag when lite uninstall and pro already exist. |
| [4406](#L4406) | $bookingpress\_version = get\_option('bookingpress\_version'); |
| [4407](#L4407) | $bookingpress\_pro\_version = get\_option('bookingpress\_pro\_version'); |
| [4408](#L4408) | if($bookingpress\_pro\_version != ''){ |
| [4409](#L4409) | update\_option('bookingpress\_pro\_exist\_on\_uninstall\_lite\_'.$bookingpress\_version,$bookingpress\_pro\_version); |
| [4410](#L4410) | } |
| [4411](#L4411) |  |
| [4412](#L4412) | $wpdb->query('DELETE FROM `' . $wpdb->options . "` WHERE  `option\_name` LIKE  '%bookingpress\\_%' AND `option\_name` NOT LIKE  '%bookingpress\_pro\\_%'"); |
| [4413](#L4413) | /\*\* |
| [4414](#L4414) | \* Delete Plugin DB Tables |
| [4415](#L4415) | \*/ |
| [4416](#L4416) | $bookingpress\_tables = array( |
| [4417](#L4417) | $tbl\_bookingpress\_categories, |
| [4418](#L4418) | $tbl\_bookingpress\_services, |
| [4419](#L4419) | $tbl\_bookingpress\_servicesmeta, |
| [4420](#L4420) | $tbl\_bookingpress\_customers, |
| [4421](#L4421) | $tbl\_bookingpress\_customers\_meta, |
| [4422](#L4422) | $tbl\_bookingpress\_settings, |
| [4423](#L4423) | $tbl\_bookingpress\_default\_workhours, |
| [4424](#L4424) | $tbl\_bookingpress\_default\_daysoff, |
| [4425](#L4425) | $tbl\_bookingpress\_notifications, |
| [4426](#L4426) | $tbl\_bookingpress\_appointment\_bookings, |
| [4427](#L4427) | $tbl\_bookingpress\_payment\_logs, |
| [4428](#L4428) | $tbl\_bookingpress\_entries, |
| [4429](#L4429) | $tbl\_bookingpress\_form\_fields, |
| [4430](#L4430) | $tbl\_bookingpress\_customize\_settings, |
| [4431](#L4431) | $tbl\_bookingpress\_debug\_payment\_log, |
| [4432](#L4432) | $tbl\_bookingpress\_other\_debug\_logs, |
| [4433](#L4433) | $tbl\_bookingpress\_entries\_meta, |
| [4434](#L4434) | $tbl\_bookingpress\_double\_bookings, |
| [4435](#L4435) | $tbl\_bookingpress\_transient |
| [4436](#L4436) | ); |
| [4437](#L4437) | foreach ( $bookingpress\_tables as $table ) { |
| [4438](#L4438) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $table is table name defined globally. False Positive alarm |
| [4439](#L4439) | $wpdb->query("DROP TABLE IF EXISTS $table "); |
| [4440](#L4440) | } |
| [4441](#L4441) |  |
| [4442](#L4442) | //Remove all capabilities assigned to administrator |
| [4443](#L4443) | $args  = array( |
| [4444](#L4444) | 'role'   => 'administrator', |
| [4445](#L4445) | 'fields' => 'id', |
| [4446](#L4446) | ); |
| [4447](#L4447) | $users = get\_users($args); |
| [4448](#L4448) | if (count($users) > 0 ) { |
| [4449](#L4449) | foreach ( $users as $key => $user\_id ) { |
| [4450](#L4450) | $bookingpressroles = $BookingPress->bookingpress\_capabilities(); |
| [4451](#L4451) | $userObj           = new WP\_User($user\_id); |
| [4452](#L4452) | foreach ( $bookingpressroles as $bookingpressrole => $bookingpress\_roledescription ) { |
| [4453](#L4453) | if($userObj->has\_cap($bookingpressrole)){ |
| [4454](#L4454) | $userObj->remove\_cap($bookingpressrole, true); |
| [4455](#L4455) | } |
| [4456](#L4456) | } |
| [4457](#L4457) | } |
| [4458](#L4458) | } |
| [4459](#L4459) |  |
| [4460](#L4460) | $args  = array( |
| [4461](#L4461) | 'role'   => 'bookingpress-customer', |
| [4462](#L4462) | 'fields' => 'id', |
| [4463](#L4463) | ); |
| [4464](#L4464) | $users = get\_users($args); |
| [4465](#L4465) | if (count($users) > 0 ) { |
| [4466](#L4466) | foreach ( $users as $key => $user\_id ) { |
| [4467](#L4467) | $bookingpressroles = $BookingPress->bookingpress\_capabilities(); |
| [4468](#L4468) | $userObj           = new WP\_User($user\_id); |
| [4469](#L4469) | foreach ( $bookingpressroles as $bookingpressrole => $bookingpress\_roledescription ) { |
| [4470](#L4470) | $userObj->remove\_role('bookingpress-customer'); |
| [4471](#L4471) | if($userObj->has\_cap($bookingpressrole)){ |
| [4472](#L4472) | $userObj->remove\_cap($bookingpressrole, true); |
| [4473](#L4473) | } |
| [4474](#L4474) | } |
| [4475](#L4475) | } |
| [4476](#L4476) | } |
| [4477](#L4477) |  |
| [4478](#L4478) | // remove capabilities |
| [4479](#L4479) | $customer = get\_role('bookingpress-customer'); |
| [4480](#L4480) | if(!empty($customer)){ |
| [4481](#L4481) | $customer->remove\_cap('bookingpress-customer', true); |
| [4482](#L4482) | } |
| [4483](#L4483) |  |
| [4484](#L4484) | // remove role |
| [4485](#L4485) | $wp\_roles = new WP\_Roles(); |
| [4486](#L4486) | $wp\_roles->remove\_role('bookingpress-customer'); |
| [4487](#L4487) | /\* Plugin Action Hook After Uninstall Process \*/ |
| [4488](#L4488) | do\_action('bookingpress\_after\_uninstall'); |
| [4489](#L4489) | } |
| [4490](#L4490) |  |
| [4491](#L4491) | /\*\* |
| [4492](#L4492) | \* Register admin menu |
| [4493](#L4493) | \* |
| [4494](#L4494) | \* @return void |
| [4495](#L4495) | \*/ |
| [4496](#L4496) | function bookingpress\_menu() |
| [4497](#L4497) | { |
| [4498](#L4498) | global $bookingpress\_slugs; |
| [4499](#L4499) |  |
| [4500](#L4500) | $place = $this->get\_free\_menu\_position(26.1, 0.3); |
| [4501](#L4501) |  |
| [4502](#L4502) | $bookingpress\_is\_wizard\_complete = get\_option('bookingpress\_lite\_wizard\_complete'); |
| [4503](#L4503) |  |
| [4504](#L4504) | if(empty($bookingpress\_is\_wizard\_complete) || $bookingpress\_is\_wizard\_complete == 0){ |
| [4505](#L4505) | $bookingpress\_menu\_hook = add\_menu\_page(esc\_html\_\_('BookingPress', 'bookingpress-appointment-booking'), esc\_html\_\_('BookingPress', 'bookingpress-appointment-booking'), 'bookingpress', $bookingpress\_slugs->bookingpress\_lite\_wizard, array( $this, 'route' ), BOOKINGPRESS\_IMAGES\_URL . '/bookingpress\_menu\_icon.png', $place); |
| [4506](#L4506) | }else{ |
| [4507](#L4507) | $bookingpress\_menu\_hook = add\_menu\_page(esc\_html\_\_('BookingPress', 'bookingpress-appointment-booking'), esc\_html\_\_('BookingPress', 'bookingpress-appointment-booking'), 'bookingpress', $bookingpress\_slugs->bookingpress, array( $this, 'route' ), BOOKINGPRESS\_IMAGES\_URL . '/bookingpress\_menu\_icon.png', $place); |
| [4508](#L4508) | } |
| [4509](#L4509) |  |
| [4510](#L4510) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Dashboard', 'bookingpress-appointment-booking'), esc\_html\_\_('Dashboard', 'bookingpress-appointment-booking'), 'bookingpress', $bookingpress\_slugs->bookingpress); |
| [4511](#L4511) |  |
| [4512](#L4512) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Calendar', 'bookingpress-appointment-booking'), esc\_html\_\_('Calendar', 'bookingpress-appointment-booking'), 'bookingpress\_calendar', $bookingpress\_slugs->bookingpress\_calendar, array( $this, 'route' )); |
| [4513](#L4513) |  |
| [4514](#L4514) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Appointments', 'bookingpress-appointment-booking'), esc\_html\_\_('Appointments', 'bookingpress-appointment-booking'), 'bookingpress\_appointments', $bookingpress\_slugs->bookingpress\_appointments, array( $this, 'route' )); |
| [4515](#L4515) |  |
| [4516](#L4516) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Payments', 'bookingpress-appointment-booking'), esc\_html\_\_('Payments', 'bookingpress-appointment-booking'), 'bookingpress\_payments', $bookingpress\_slugs->bookingpress\_payments, array( $this, 'route' )); |
| [4517](#L4517) |  |
| [4518](#L4518) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Customers', 'bookingpress-appointment-booking'), esc\_html\_\_('Customers', 'bookingpress-appointment-booking'), 'bookingpress\_customers', $bookingpress\_slugs->bookingpress\_customers, array( $this, 'route' )); |
| [4519](#L4519) |  |
| [4520](#L4520) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Services', 'bookingpress-appointment-booking'), esc\_html\_\_('Services', 'bookingpress-appointment-booking'), 'bookingpress\_services', $bookingpress\_slugs->bookingpress\_services, array( $this, 'route' )); |
| [4521](#L4521) |  |
| [4522](#L4522) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Notifications', 'bookingpress-appointment-booking'), esc\_html\_\_('Notifications', 'bookingpress-appointment-booking'), 'bookingpress\_notifications', $bookingpress\_slugs->bookingpress\_notifications, array( $this, 'route' )); |
| [4523](#L4523) |  |
| [4524](#L4524) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Customize', 'bookingpress-appointment-booking'), esc\_html\_\_('Customize', 'bookingpress-appointment-booking'), 'bookingpress\_customize', $bookingpress\_slugs->bookingpress\_customize, array( $this, 'route' )); |
| [4525](#L4525) |  |
| [4526](#L4526) | add\_submenu\_page($bookingpress\_slugs->bookingpress, esc\_html\_\_('Settings', 'bookingpress-appointment-booking'), esc\_html\_\_('Settings', 'bookingpress-appointment-booking'), 'bookingpress\_settings', $bookingpress\_slugs->bookingpress\_settings, array( $this, 'route' )); |
| [4527](#L4527) |  |
| [4528](#L4528) | if( !$this->bpa\_is\_pro\_active() ){ |
| [4529](#L4529) | add\_submenu\_page( $bookingpress\_slugs->bookingpress, esc\_html\_\_( 'Add-ons', 'bookingpress-appointment-booking' ), esc\_html\_\_( 'Add-ons', 'bookingpress-appointment-booking' ), 'bookingpress\_addons', $bookingpress\_slugs->bookingpress\_addons, array( $this, 'route' ) ); |
| [4530](#L4530) |  |
| [4531](#L4531) | add\_submenu\_page( $bookingpress\_slugs->bookingpress, esc\_html\_\_( 'Growth Plugins', 'bookingpress-appointment-booking' ), esc\_html\_\_( 'Growth Plugins', 'bookingpress-appointment-booking' ), 'bookingpress\_growth\_tools', $bookingpress\_slugs->bookingpress\_growth\_tools, array( $this, 'route' ) ); |
| [4532](#L4532) | } |
| [4533](#L4533) |  |
| [4534](#L4534) | $upgrade\_menu\_text = esc\_html\_\_( 'Upgrade to Pro', 'bookingpress-appointment-booking' ); |
| [4535](#L4535) |  |
| [4536](#L4536) | $bpa\_current\_date\_for\_bf\_popup = current\_time( 'timestamp', true ); |
| [4537](#L4537) | $bpa\_bf\_popup\_start\_time = $this->bookingpress\_get\_bf\_sale\_start\_time(); |
| [4538](#L4538) | $bpa\_bf\_popup\_end\_time = $this->bookingpress\_get\_bf\_sale\_end\_time(); |
| [4539](#L4539) |  |
| [4540](#L4540) | if( $bpa\_current\_date\_for\_bf\_popup >= $bpa\_bf\_popup\_start\_time && $bpa\_current\_date\_for\_bf\_popup <= $bpa\_bf\_popup\_end\_time ){ |
| [4541](#L4541) | $upgrade\_menu\_text = esc\_html\_\_( 'Black Friday Sale 🔥', 'bookingpress-appointment-booking' ); |
| [4542](#L4542) | } |
| [4543](#L4543) |  |
| [4544](#L4544) | add\_submenu\_page($bookingpress\_slugs->bookingpress, $upgrade\_menu\_text, $upgrade\_menu\_text, 'bookingpress', $bookingpress\_slugs->bookingpress."&upgrade\_action=upgrade\_to\_pro", array( $this, 'route' )); |
| [4545](#L4545) |  |
| [4546](#L4546) | } |
| [4547](#L4547) |  |
| [4548](#L4548) | function bookingpress\_page\_slugs() |
| [4549](#L4549) | { |
| [4550](#L4550) | global $bookingpress\_slugs; |
| [4551](#L4551) | $bookingpress\_slugs = new stdClass(); |
| [4552](#L4552) | /\* Admin-Pages-Slug \*/ |
| [4553](#L4553) |  |
| [4554](#L4554) | $bookingpress\_slugs->bookingpress               = 'bookingpress'; |
| [4555](#L4555) | $bookingpress\_slugs->bookingpress\_lite\_wizard   = 'bookingpress\_lite\_wizard'; |
| [4556](#L4556) | $bookingpress\_slugs->bookingpress\_calendar      = 'bookingpress\_calendar'; |
| [4557](#L4557) | $bookingpress\_slugs->bookingpress\_appointments  = 'bookingpress\_appointments'; |
| [4558](#L4558) | $bookingpress\_slugs->bookingpress\_payments      = 'bookingpress\_payments'; |
| [4559](#L4559) | $bookingpress\_slugs->bookingpress\_customers     = 'bookingpress\_customers'; |
| [4560](#L4560) | $bookingpress\_slugs->bookingpress\_services      = 'bookingpress\_services'; |
| [4561](#L4561) | $bookingpress\_slugs->bookingpress\_notifications = 'bookingpress\_notifications'; |
| [4562](#L4562) | $bookingpress\_slugs->bookingpress\_customize     = 'bookingpress\_customize'; |
| [4563](#L4563) | $bookingpress\_slugs->bookingpress\_settings      = 'bookingpress\_settings'; |
| [4564](#L4564) | $bookingpress\_slugs->bookingpress\_addons        = 'bookingpress\_addons'; |
| [4565](#L4565) | $bookingpress\_slugs->bookingpress\_growth\_tools  = 'bookingpress\_growth\_tools'; |
| [4566](#L4566) |  |
| [4567](#L4567) | return $bookingpress\_slugs; |
| [4568](#L4568) | } |
| [4569](#L4569) |  |
| [4570](#L4570) | function get\_free\_menu\_position( $start, $increment = 0.1 ) |
| [4571](#L4571) | { |
| [4572](#L4572) | foreach ( $GLOBALS['menu'] as $key => $menu ) { |
| [4573](#L4573) | $menus\_positions[] = floatval($key); |
| [4574](#L4574) | } |
| [4575](#L4575) | if (! in\_array($start, $menus\_positions) ) { |
| [4576](#L4576) | $start = strval($start); |
| [4577](#L4577) | return $start; |
| [4578](#L4578) | } else { |
| [4579](#L4579) | $start += $increment; |
| [4580](#L4580) | } |
| [4581](#L4581) | /\* the position is already reserved find the closet one \*/ |
| [4582](#L4582) | while ( in\_array($start, $menus\_positions) ) { |
| [4583](#L4583) | $start += $increment; |
| [4584](#L4584) | } |
| [4585](#L4585) | $start = strval($start); |
| [4586](#L4586) | return $start; |
| [4587](#L4587) | } |
| [4588](#L4588) |  |
| [4589](#L4589) | function route() |
| [4590](#L4590) | { |
| [4591](#L4591) | global $bookingpress\_slugs; |
| [4592](#L4592) | if (isset($\_REQUEST['page']) ) { |
| [4593](#L4593) | $pageWrapperClass = ''; |
| [4594](#L4594) | if (is\_rtl() ) { |
| [4595](#L4595) | $pageWrapperClass = 'bookingpress\_page\_rtl'; |
| [4596](#L4596) | } |
| [4597](#L4597) | echo '<div class="bookingpress\_page\_wrapper ' . esc\_html($pageWrapperClass) . '" id="root\_app">'; |
| [4598](#L4598) | $requested\_page = sanitize\_text\_field($\_REQUEST['page']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4599](#L4599) | do\_action('bookingpress\_admin\_messages', $requested\_page); |
| [4600](#L4600) |  |
| [4601](#L4601) | if (file\_exists(BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_main.php') ) { |
| [4602](#L4602) | include BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_main.php'; |
| [4603](#L4603) | } |
| [4604](#L4604) | echo '</div>'; |
| [4605](#L4605) | } |
| [4606](#L4606) | } |
| [4607](#L4607) |  |
| [4608](#L4608) | /\*\* |
| [4609](#L4609) | \* Set admin CSS |
| [4610](#L4610) | \* |
| [4611](#L4611) | \* @return void |
| [4612](#L4612) | \*/ |
| [4613](#L4613) | function set\_css() |
| [4614](#L4614) | { |
| [4615](#L4615) | global $bookingpress\_slugs; |
| [4616](#L4616) |  |
| [4617](#L4617) | wp\_register\_style('bookingpress\_admin\_custom\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_admin\_custom.css', array(), BOOKINGPRESS\_VERSION); |
| [4618](#L4618) | wp\_enqueue\_style('bookingpress\_admin\_custom\_css'); |
| [4619](#L4619) |  |
| [4620](#L4620) | /\* Plugin Style \*/ |
| [4621](#L4621) | wp\_register\_style('bookingpress\_element\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_element\_theme.css', array(), BOOKINGPRESS\_VERSION); |
| [4622](#L4622) |  |
| [4623](#L4623) | wp\_register\_style('bookingpress\_fonts\_css', BOOKINGPRESS\_URL . '/css/fonts/fonts.css', array(), BOOKINGPRESS\_VERSION); |
| [4624](#L4624) |  |
| [4625](#L4625) | wp\_register\_style('bookingpress\_calendar\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_vue\_calendar.css', array(), BOOKINGPRESS\_VERSION); |
| [4626](#L4626) |  |
| [4627](#L4627) | wp\_register\_style('bookingpress\_root\_variables\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_variables.css', array(), BOOKINGPRESS\_VERSION); |
| [4628](#L4628) |  |
| [4629](#L4629) | wp\_register\_style('bookingpress\_components\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_admin\_components.css', array(), BOOKINGPRESS\_VERSION); |
| [4630](#L4630) |  |
| [4631](#L4631) | wp\_register\_style('bookingpress\_admin\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_admin.css', array( 'bookingpress\_root\_variables\_css' ), BOOKINGPRESS\_VERSION); |
| [4632](#L4632) |  |
| [4633](#L4633) | wp\_register\_style('bookingpress\_admin\_rtl\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_admin\_rtl.css', array(), BOOKINGPRESS\_VERSION); |
| [4634](#L4634) |  |
| [4635](#L4635) | wp\_register\_style('bookingpress\_tel\_input', BOOKINGPRESS\_URL . '/css/bookingpress\_tel\_input.css', array(), BOOKINGPRESS\_VERSION); |
| [4636](#L4636) |  |
| [4637](#L4637) | wp\_register\_style('bookingpress\_wizard\_style', BOOKINGPRESS\_URL . '/css/bookingpress\_wizard.css', array(), BOOKINGPRESS\_VERSION); |
| [4638](#L4638) |  |
| [4639](#L4639) | /\* Add CSS file only for plugin pages. \*/ |
| [4640](#L4640) | if (isset($\_REQUEST['page']) && in\_array(sanitize\_text\_field($\_REQUEST['page']), (array) $bookingpress\_slugs) ) { |
| [4641](#L4641) | wp\_enqueue\_style('bookingpress\_element\_css'); |
| [4642](#L4642) | wp\_enqueue\_style('bookingpress\_fonts\_css'); |
| [4643](#L4643) |  |
| [4644](#L4644) | if (! empty($\_REQUEST['page']) && ( sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_calendar' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4645](#L4645) | wp\_enqueue\_style('bookingpress\_calendar\_css'); |
| [4646](#L4646) | } |
| [4647](#L4647) |  |
| [4648](#L4648) | if(!empty($\_REQUEST['page']) && (sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_lite\_wizard' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_wizard')){ |
| [4649](#L4649) | wp\_enqueue\_style('bookingpress\_wizard\_style'); |
| [4650](#L4650) | } |
| [4651](#L4651) |  |
| [4652](#L4652) | wp\_enqueue\_style('bookingpress\_root\_variables\_css'); |
| [4653](#L4653) | wp\_enqueue\_style('bookingpress\_components\_css'); |
| [4654](#L4654) | wp\_enqueue\_style('bookingpress\_admin\_css'); |
| [4655](#L4655) | if (is\_rtl() ) { |
| [4656](#L4656) | wp\_enqueue\_style('bookingpress\_admin\_rtl\_css'); |
| [4657](#L4657) | } |
| [4658](#L4658) | $bookingpress\_allowed\_tel\_input\_script\_backend = apply\_filters('bookingpress\_allowed\_tel\_input\_script\_backend',false,sanitize\_text\_field($\_REQUEST['page'])); |
| [4659](#L4659) | if (! empty($\_REQUEST['page']) && ($bookingpress\_allowed\_tel\_input\_script\_backend || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customers' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_settings' || $\_REQUEST['page'] == 'bookingpress\_myprofile' || $\_REQUEST['page'] == "bookingpress\_appointments" || $\_REQUEST['page'] == "bookingpress\_calendar" ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4660](#L4660) | wp\_enqueue\_style('bookingpress\_tel\_input'); |
| [4661](#L4661) | } |
| [4662](#L4662) | } |
| [4663](#L4663) |  |
| [4664](#L4664) | $bpa\_current\_date\_for\_bf\_popup = current\_time( 'timestamp', true ); |
| [4665](#L4665) | $bpa\_bf\_popup\_start\_time = $this->bookingpress\_get\_bf\_sale\_start\_time(); |
| [4666](#L4666) | $bpa\_bf\_popup\_end\_time = $this->bookingpress\_get\_bf\_sale\_end\_time(); |
| [4667](#L4667) |  |
| [4668](#L4668) | if( $bpa\_current\_date\_for\_bf\_popup >= $bpa\_bf\_popup\_start\_time && $bpa\_current\_date\_for\_bf\_popup <= $bpa\_bf\_popup\_end\_time ){ |
| [4669](#L4669) | wp\_enqueue\_style( 'krona-one-font', 'https://fonts.googleapis.com/css2?family=Krona+One&display=swap', array(), BOOKINGPRESS\_VERSION ); |
| [4670](#L4670) | } |
| [4671](#L4671) | } |
| [4672](#L4672) |  |
| [4673](#L4673) |  |
| [4674](#L4674) | /\*\* |
| [4675](#L4675) | \* Set front CSS |
| [4676](#L4676) | \* |
| [4677](#L4677) | \* @param  mixed $force\_enqueue |
| [4678](#L4678) | \* @return void |
| [4679](#L4679) | \*/ |
| [4680](#L4680) | function set\_front\_css( $force\_enqueue = 0 ) |
| [4681](#L4681) | { |
| [4682](#L4682) | global $wpdb, $tbl\_bookingpress\_form\_fields; |
| [4683](#L4683) | wp\_register\_style('bookingpress\_element\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_element\_theme.css', array(), BOOKINGPRESS\_VERSION); |
| [4684](#L4684) |  |
| [4685](#L4685) | wp\_register\_style('bookingpress\_fonts\_css', BOOKINGPRESS\_URL . '/css/fonts/fonts.css', array(), BOOKINGPRESS\_VERSION); |
| [4686](#L4686) | wp\_register\_style('bookingpress\_front\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_front.css', array(), BOOKINGPRESS\_VERSION); |
| [4687](#L4687) | wp\_register\_style('bookingpress\_front\_rtl\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_front\_rtl.css', array(), BOOKINGPRESS\_VERSION); |
| [4688](#L4688) | wp\_register\_style('bookingpress\_tel\_input', BOOKINGPRESS\_URL . '/css/bookingpress\_tel\_input.css', array(), BOOKINGPRESS\_VERSION); |
| [4689](#L4689) |  |
| [4690](#L4690) | $bookingress\_load\_js\_css\_all\_pages = $this->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [4691](#L4691) |  |
| [4692](#L4692) | $bookingpress\_after\_canceled\_payment\_page\_id = $this->bookingpress\_get\_customize\_settings('after\_failed\_payment\_redirection', 'booking\_form'); |
| [4693](#L4693) | $bookingpress\_after\_approved\_payment\_page\_id = $this->bookingpress\_get\_customize\_settings('after\_booking\_redirection', 'booking\_form'); |
| [4694](#L4694) | $bookingpress\_cancelled\_appointment\_page\_id = $this->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [4695](#L4695) | $bookingpress\_cancellation\_confirmation\_page\_id = $this->bookingpress\_get\_customize\_settings('appointment\_cancellation\_confirmation', 'booking\_my\_booking'); |
| [4696](#L4696) |  |
| [4697](#L4697) | $bookingpress\_current\_page\_id = get\_the\_ID(); |
| [4698](#L4698) |  |
| [4699](#L4699) | if ($this->bookingpress\_is\_front\_page() || ( $bookingress\_load\_js\_css\_all\_pages == 'true' ) || ( $force\_enqueue == 1 ) || ($bookingpress\_after\_approved\_payment\_page\_id == $bookingpress\_current\_page\_id) || ($bookingpress\_cancelled\_appointment\_page\_id == $bookingpress\_current\_page\_id) || ($bookingpress\_after\_canceled\_payment\_page\_id == $bookingpress\_current\_page\_id) || ($bookingpress\_cancellation\_confirmation\_page\_id == $bookingpress\_current\_page\_id) ) { |
| [4700](#L4700) | wp\_enqueue\_style('bookingpress\_element\_css'); |
| [4701](#L4701) | wp\_enqueue\_style('bookingpress\_fonts\_css'); |
| [4702](#L4702) | wp\_enqueue\_style('bookingpress\_front\_css'); |
| [4703](#L4703) |  |
| [4704](#L4704) | $bpa\_phone\_number\_field\_detail = wp\_cache\_get( 'bookingpress\_phone\_field\_data' ); |
| [4705](#L4705) | if( false === $bpa\_phone\_number\_field\_detail ){ |
| [4706](#L4706) | $bookingpress\_form\_field\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_form\_field\_name = %s", 'phone\_number'), ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [4707](#L4707) | wp\_cache\_set( 'bookingpress\_phone\_field\_data', $bookingpress\_form\_field\_data ); |
| [4708](#L4708) | } else { |
| [4709](#L4709) | $bookingpress\_form\_field\_data = $bpa\_phone\_number\_field\_detail; |
| [4710](#L4710) | } |
| [4711](#L4711) |  |
| [4712](#L4712) | $bookingpress\_is\_field\_hide = isset($bookingpress\_form\_field\_data['bookingpress\_field\_is\_hide']) ? intval($bookingpress\_form\_field\_data['bookingpress\_field\_is\_hide']) : 1; |
| [4713](#L4713) | if ($bookingpress\_is\_field\_hide == 0 ) { |
| [4714](#L4714) | wp\_enqueue\_style('bookingpress\_tel\_input'); |
| [4715](#L4715) | } |
| [4716](#L4716) |  |
| [4717](#L4717) | if (is\_rtl() ) { |
| [4718](#L4718) | wp\_enqueue\_style('bookingpress\_front\_rtl\_css'); |
| [4719](#L4719) | } |
| [4720](#L4720) |  |
| [4721](#L4721) | do\_action('bookingpress\_add\_frontend\_css'); |
| [4722](#L4722) |  |
| [4723](#L4723) | if($bookingress\_load\_js\_css\_all\_pages == 'true' ) { |
| [4724](#L4724) | $this->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4725](#L4725) | $this->bookingpress\_load\_mybooking\_custom\_css(); |
| [4726](#L4726) | } |
| [4727](#L4727) | } |
| [4728](#L4728) | } |
| [4729](#L4729) |  |
| [4730](#L4730) |  |
| [4731](#L4731) | /\*\* |
| [4732](#L4732) | \* This function is used to load booking form custom css. |
| [4733](#L4733) | \* |
| [4734](#L4734) | \* @return void |
| [4735](#L4735) | \*/ |
| [4736](#L4736) | function bookingpress\_load\_booking\_form\_custom\_css() { |
| [4737](#L4737) | $bookingpress\_dependency = array('bookingpress\_front\_css'); |
| [4738](#L4738) | if( $this->bpa\_is\_pro\_active() ){ |
| [4739](#L4739) | $bookingpress\_dependency[] = 'bookingpress\_pro\_front\_css'; |
| [4740](#L4740) | } |
| [4741](#L4741) | $bookingpress\_customize\_css\_key = get\_option('bookingpress\_custom\_css\_key', true); |
| [4742](#L4742) | if (file\_exists(BOOKINGPRESS\_UPLOAD\_DIR . '/bookingpress\_front\_custom\_' . $bookingpress\_customize\_css\_key . '.css') ) { |
| [4743](#L4743) | wp\_register\_style('bookingpress\_front\_custom\_css', BOOKINGPRESS\_UPLOAD\_URL . '/bookingpress\_front\_custom\_' . $bookingpress\_customize\_css\_key . '.css', $bookingpress\_dependency, BOOKINGPRESS\_VERSION); |
| [4744](#L4744) | wp\_enqueue\_style('bookingpress\_front\_custom\_css'); |
| [4745](#L4745) |  |
| [4746](#L4746) | global $bookingpress\_global\_options, $BookingPress; |
| [4747](#L4747) |  |
| [4748](#L4748) | $bookingpress\_custom\_css = $BookingPress->bookingpress\_get\_customize\_settings('custom\_css', 'booking\_form'); |
| [4749](#L4749) | $bookingpress\_custom\_css = !empty($bookingpress\_custom\_css) ? stripslashes\_deep( $bookingpress\_custom\_css ) : ''; |
| [4750](#L4750) | wp\_add\_inline\_style( 'bookingpress\_front\_custom\_css', $bookingpress\_custom\_css, 'after' ); |
| [4751](#L4751) |  |
| [4752](#L4752) | $bookingpress\_google\_fonts\_list  = $bookingpress\_global\_options->bookingpress\_get\_google\_fonts(); |
| [4753](#L4753) |  |
| [4754](#L4754) | $bookingform\_title\_font\_family = $this->bookingpress\_get\_customize\_settings('title\_font\_family', 'booking\_form'); |
| [4755](#L4755) |  |
| [4756](#L4756) |  |
| [4757](#L4757) | if (! empty($bookingform\_title\_font\_family) && ($bookingform\_title\_font\_family != 'Poppins') && in\_array( $bookingform\_title\_font\_family, $bookingpress\_google\_fonts\_list ) ) { |
| [4758](#L4758) | $bookingpress\_google\_font\_url = 'https://fonts.googleapis.com/css2?family=' . $bookingform\_title\_font\_family . '&display=swap'; |
| [4759](#L4759) | $bookingpress\_google\_font\_url = apply\_filters('bookingpress\_modify\_google\_font\_url', $bookingpress\_google\_font\_url, $bookingform\_title\_font\_family); |
| [4760](#L4760) | wp\_register\_style('bookingpress\_front\_font\_css\_' . $bookingform\_title\_font\_family, $bookingpress\_google\_font\_url, array(), BOOKINGPRESS\_VERSION); |
| [4761](#L4761) | wp\_enqueue\_style('bookingpress\_front\_font\_css\_' . $bookingform\_title\_font\_family); |
| [4762](#L4762) | } |
| [4763](#L4763) | } |
| [4764](#L4764) |  |
| [4765](#L4765) | } |
| [4766](#L4766) |  |
| [4767](#L4767) | /\*\* |
| [4768](#L4768) | \* This function is used to load my booking custom css. |
| [4769](#L4769) | \* |
| [4770](#L4770) | \* @return void |
| [4771](#L4771) | \*/ |
| [4772](#L4772) | function bookingpress\_load\_mybooking\_custom\_css() { |
| [4773](#L4773) | $bookingpress\_dependency = array('bookingpress\_front\_css'); |
| [4774](#L4774) | if( $this->bpa\_is\_pro\_active() ){ |
| [4775](#L4775) | $bookingpress\_dependency[] = 'bookingpress\_pro\_front\_css'; |
| [4776](#L4776) | } |
| [4777](#L4777) | $bookingpress\_customize\_css\_key = get\_option('bookingpress\_custom\_css\_key', true); |
| [4778](#L4778) | if (file\_exists(BOOKINGPRESS\_UPLOAD\_DIR . '/bookingpress\_front\_mybookings\_custom\_' . $bookingpress\_customize\_css\_key . '.css') ) { |
| [4779](#L4779) |  |
| [4780](#L4780) | wp\_register\_style('bookingpress\_front\_mybookings\_custom\_css', BOOKINGPRESS\_UPLOAD\_URL . '/bookingpress\_front\_mybookings\_custom\_' . $bookingpress\_customize\_css\_key . '.css',$bookingpress\_dependency, BOOKINGPRESS\_VERSION); |
| [4781](#L4781) | wp\_enqueue\_style('bookingpress\_front\_mybookings\_custom\_css'); |
| [4782](#L4782) |  |
| [4783](#L4783) | global $bookingpress\_global\_options; |
| [4784](#L4784) | $bookingpress\_google\_fonts\_list  = $bookingpress\_global\_options->bookingpress\_get\_google\_fonts(); |
| [4785](#L4785) |  |
| [4786](#L4786) | $bookingform\_title\_font\_family = $this->bookingpress\_get\_customize\_settings('title\_font\_family', 'booking\_form'); |
| [4787](#L4787) | if (! empty($bookingform\_title\_font\_family) && ($bookingform\_title\_font\_family != 'Poppins') && in\_array( $bookingform\_title\_font\_family, $bookingpress\_google\_fonts\_list ) ) { |
| [4788](#L4788) | wp\_register\_style('bookingpress\_front\_font\_css\_' . $bookingform\_title\_font\_family, 'https://fonts.googleapis.com/css2?family=' . $bookingform\_title\_font\_family . '&display=swap', array(), BOOKINGPRESS\_VERSION); |
| [4789](#L4789) | wp\_enqueue\_style('bookingpress\_front\_font\_css\_' . $bookingform\_title\_font\_family); |
| [4790](#L4790) | } |
| [4791](#L4791) | } |
| [4792](#L4792) | } |
| [4793](#L4793) |  |
| [4794](#L4794) | /\*\* |
| [4795](#L4795) | \* Load mybookings custom js |
| [4796](#L4796) | \* |
| [4797](#L4797) | \* @return void |
| [4798](#L4798) | \*/ |
| [4799](#L4799) | function bookingpress\_load\_mybookings\_custom\_js(){ |
| [4800](#L4800) | wp\_register\_script('bookingpress\_v-calendar\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_v-calendar.js', array('bookingpress\_vue\_js'), BOOKINGPRESS\_VERSION); |
| [4801](#L4801) | wp\_enqueue\_script('bookingpress\_v-calendar\_js'); |
| [4802](#L4802) | } |
| [4803](#L4803) |  |
| [4804](#L4804) | /\*\* |
| [4805](#L4805) | \* Load frontside JS |
| [4806](#L4806) | \* |
| [4807](#L4807) | \* @param  mixed $force\_enqueue |
| [4808](#L4808) | \* @return void |
| [4809](#L4809) | \*/ |
| [4810](#L4810) | function set\_front\_js( $force\_enqueue = 0 ) |
| [4811](#L4811) | { |
| [4812](#L4812) | global $wpdb, $tbl\_bookingpress\_form\_fields, $wp\_version; |
| [4813](#L4813) |  |
| [4814](#L4814) | wp\_register\_script('bookingpress\_vue\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue.min.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4815](#L4815) |  |
| [4816](#L4816) | wp\_register\_script('bookingpress\_axios\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_axios.min.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4817](#L4817) |  |
| [4818](#L4818) | wp\_register\_script('bookingpress\_element\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4819](#L4819) |  |
| [4820](#L4820) | wp\_register\_script('bookingpress\_wordpress\_vue\_helper\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_wordpress\_vue\_qs\_helper.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4821](#L4821) |  |
| [4822](#L4822) | wp\_register\_script('bookingpress\_moment\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_moment.min.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4823](#L4823) |  |
| [4824](#L4824) | wp\_register\_script('bookingpress\_tel\_input\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_tel\_input.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4825](#L4825) | wp\_register\_script('bookingpress\_tel\_utils\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_tel\_utils.js', array(), BOOKINGPRESS\_VERSION, true ); |
| [4826](#L4826) |  |
| [4827](#L4827) | wp\_register\_script('bookingpress\_v-calendar\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_v-calendar.js', array('bookingpress\_vue\_js'), BOOKINGPRESS\_VERSION); |
| [4828](#L4828) |  |
| [4829](#L4829) | if( version\_compare( $wp\_version, '5.0', '<' ) ){ |
| [4830](#L4830) | wp\_register\_script( 'wp-hooks', BOOKINGPRESS\_URL . '/js/hooks.js', array(), BOOKINGPRESS\_VERSION, true ); |
| [4831](#L4831) | } |
| [4832](#L4832) |  |
| [4833](#L4833) | $load\_calendar\_js = false; |
| [4834](#L4834) | if( is\_plugin\_active( 'bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php') ){ |
| [4835](#L4835) | $bpa\_pro\_version = $this->bpa\_pro\_plugin\_version(); |
| [4836](#L4836) |  |
| [4837](#L4837) | if( version\_compare( $bpa\_pro\_version, '2.6', '<') ){ |
| [4838](#L4838) | $load\_calendar\_js = true; |
| [4839](#L4839) | wp\_register\_script('bookingpress\_calendar\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue\_calendar.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4840](#L4840) | } |
| [4841](#L4841) | } |
| [4842](#L4842) |  |
| [4843](#L4843) | $bookingress\_load\_js\_css\_all\_pages = $this->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [4844](#L4844) |  |
| [4845](#L4845) | if ($this->bookingpress\_is\_front\_page() || ( $bookingress\_load\_js\_css\_all\_pages == 'true' ) || ( $force\_enqueue == 1 ) ) { |
| [4846](#L4846) | $get\_already\_loaded\_vue\_setting\_val = $this->bookingpress\_get\_settings('use\_already\_loaded\_vue', 'general\_setting'); |
| [4847](#L4847) | if (! $get\_already\_loaded\_vue\_setting\_val || $get\_already\_loaded\_vue\_setting\_val == 'false' ) { |
| [4848](#L4848) | wp\_enqueue\_script('bookingpress\_vue\_js'); |
| [4849](#L4849) | } |
| [4850](#L4850) | wp\_enqueue\_script('wp-hooks'); |
| [4851](#L4851) | wp\_enqueue\_script('bookingpress\_axios\_js'); |
| [4852](#L4852) | wp\_enqueue\_script('bookingpress\_wordpress\_vue\_helper\_js'); |
| [4853](#L4853) | wp\_enqueue\_script('bookingpress\_element\_js'); |
| [4854](#L4854) | if( true == $load\_calendar\_js ){ |
| [4855](#L4855) | wp\_enqueue\_script('bookingpress\_calendar\_js'); |
| [4856](#L4856) | } |
| [4857](#L4857) | wp\_enqueue\_script('bookingpress\_moment\_js'); |
| [4858](#L4858) |  |
| [4859](#L4859) | if($bookingress\_load\_js\_css\_all\_pages == 'true' ) { |
| [4860](#L4860) | wp\_enqueue\_script('bookingpress\_v-calendar\_js'); |
| [4861](#L4861) | } |
| [4862](#L4862) |  |
| [4863](#L4863) |  |
| [4864](#L4864) | $bpa\_phone\_number\_field\_detail = wp\_cache\_get( 'bookingpress\_phone\_field\_data' ); |
| [4865](#L4865) | if( false === $bpa\_phone\_number\_field\_detail ){ |
| [4866](#L4866) | $bookingpress\_form\_field\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_form\_field\_name = %s", 'phone\_number'), ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False alarm |
| [4867](#L4867) | wp\_cache\_set( 'bookingpress\_phone\_field\_data', $bookingpress\_form\_field\_data ); |
| [4868](#L4868) | } else { |
| [4869](#L4869) | $bookingpress\_form\_field\_data = $bpa\_phone\_number\_field\_detail; |
| [4870](#L4870) | } |
| [4871](#L4871) |  |
| [4872](#L4872) | $bookingpress\_is\_field\_hide = isset($bookingpress\_form\_field\_data['bookingpress\_field\_is\_hide']) ? intval($bookingpress\_form\_field\_data['bookingpress\_field\_is\_hide']) : 1; |
| [4873](#L4873) | if ($bookingpress\_is\_field\_hide == 0 ) { |
| [4874](#L4874) | wp\_enqueue\_script('bookingpress\_tel\_input\_js'); |
| [4875](#L4875) | wp\_enqueue\_script('bookingpress\_tel\_utils\_js'); |
| [4876](#L4876) | } |
| [4877](#L4877) |  |
| [4878](#L4878) | global $bookingpress\_global\_options; |
| [4879](#L4879) | $bookingpress\_site\_current\_language = $bookingpress\_global\_options->bookingpress\_get\_site\_current\_language(); |
| [4880](#L4880) |  |
| [4881](#L4881) | if ($bookingpress\_site\_current\_language != 'en' ) { |
| [4882](#L4882) | wp\_register\_script('bookingpress\_vue\_cal\_locale', BOOKINGPRESS\_URL . '/js/locales/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4883](#L4883) | wp\_enqueue\_script('bookingpress\_vue\_cal\_locale'); |
| [4884](#L4884) |  |
| [4885](#L4885) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/elements\_locale/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4886](#L4886) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [4887](#L4887) | } else { |
| [4888](#L4888) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array(), BOOKINGPRESS\_VERSION, true); |
| [4889](#L4889) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [4890](#L4890) | } |
| [4891](#L4891) |  |
| [4892](#L4892) | //wp\_localize\_script('bookingpress\_vue\_js', 'appoint\_ajax\_obj', array( 'ajax\_url' => admin\_url('admin-ajax.php') )); |
| [4893](#L4893) | $data = 'var appoint\_ajax\_obj = '.wp\_json\_encode( array( |
| [4894](#L4894) | 'ajax\_url' => admin\_url( 'admin-ajax.php') |
| [4895](#L4895) | ) |
| [4896](#L4896) | ).';'; |
| [4897](#L4897) |  |
| [4898](#L4898) | wp\_add\_inline\_script('bookingpress\_vue\_js', $data, 'before'); |
| [4899](#L4899) |  |
| [4900](#L4900) | do\_action('bookingpress\_add\_frontend\_js'); |
| [4901](#L4901) | } |
| [4902](#L4902) | } |
| [4903](#L4903) |  |
| [4904](#L4904) | /\*\* |
| [4905](#L4905) | \* Load admin side JS |
| [4906](#L4906) | \* |
| [4907](#L4907) | \* @return void |
| [4908](#L4908) | \*/ |
| [4909](#L4909) | function set\_js() |
| [4910](#L4910) | { |
| [4911](#L4911) | global $bookingpress\_slugs, $bookingpress\_global\_options; |
| [4912](#L4912) |  |
| [4913](#L4913) | $bookingpress\_site\_current\_language = $bookingpress\_global\_options->bookingpress\_get\_site\_current\_language(); |
| [4914](#L4914) |  |
| [4915](#L4915) | /\* Plugin Scripts \*/ |
| [4916](#L4916) | wp\_register\_script('bookingpress\_admin\_custom\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_admin\_custom.js', array(), BOOKINGPRESS\_VERSION); |
| [4917](#L4917) | wp\_enqueue\_script('bookingpress\_admin\_custom\_js'); |
| [4918](#L4918) |  |
| [4919](#L4919) | wp\_localize\_script( 'bookingpress\_admin\_custom\_js', 'bpa\_custom\_js\_data', array( |
| [4920](#L4920) | 'bookingpress\_ajax\_url' => admin\_url('admin-ajax.php') |
| [4921](#L4921) | ) ); |
| [4922](#L4922) |  |
| [4923](#L4923) | $custom\_inline\_script = '\_\_BOOKINGPRESSIMAGEURL = "' . esc\_url(BOOKINGPRESS\_IMAGES\_URL) . '"'; |
| [4924](#L4924) |  |
| [4925](#L4925) | wp\_add\_inline\_script( 'bookingpress-appointment-booking-booking-form-editor-script', $custom\_inline\_script, 'before' ); |
| [4926](#L4926) |  |
| [4927](#L4927) | wp\_register\_script('bookingpress\_admin\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue.min.js', array(), BOOKINGPRESS\_VERSION); |
| [4928](#L4928) |  |
| [4929](#L4929) | wp\_register\_script('bookingpress\_axios\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_axios.min.js', array(), BOOKINGPRESS\_VERSION); |
| [4930](#L4930) | wp\_register\_script('bookingpress\_sortable\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_Sortable.min.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4931](#L4931) | wp\_register\_script('bookingpress\_draggable\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_draggable.min.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4932](#L4932) |  |
| [4933](#L4933) | wp\_register\_script('bookingpress\_element\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4934](#L4934) |  |
| [4935](#L4935) | if ($bookingpress\_site\_current\_language == 'en' ) { |
| [4936](#L4936) | wp\_register\_script('bookingpress\_element\_en\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4937](#L4937) | } |
| [4938](#L4938) |  |
| [4939](#L4939) | wp\_register\_script('bookingpress\_wordpress\_vue\_helper\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_wordpress\_vue\_qs\_helper.js', array(), BOOKINGPRESS\_VERSION); |
| [4940](#L4940) |  |
| [4941](#L4941) | wp\_register\_script('bookingpress\_calendar\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue\_calendar.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4942](#L4942) |  |
| [4943](#L4943) | wp\_register\_script('bookingpress\_v-calendar\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_v-calendar.js', array( 'bookingpress\_admin\_js' ), BOOKINGPRESS\_VERSION); |
| [4944](#L4944) |  |
| [4945](#L4945) | wp\_register\_script('bookingpress\_moment\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_moment.min.js', array(), BOOKINGPRESS\_VERSION); |
| [4946](#L4946) |  |
| [4947](#L4947) | wp\_register\_script('bookingpress\_tel\_input\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_tel\_input.js', array(), BOOKINGPRESS\_VERSION); |
| [4948](#L4948) | wp\_register\_script('bookingpress\_tel\_utils\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_tel\_utils.js', array(), BOOKINGPRESS\_VERSION); |
| [4949](#L4949) |  |
| [4950](#L4950) | /\* Add JS file only for plugin pages. \*/ |
| [4951](#L4951) | if (isset($\_REQUEST['page']) && ( sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_services' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4952](#L4952) | wp\_enqueue\_script('bookingpress\_sortable\_js'); |
| [4953](#L4953) | wp\_enqueue\_script('bookingpress\_draggable\_js'); |
| [4954](#L4954) | } |
| [4955](#L4955) |  |
| [4956](#L4956) | if( isset($\_REQUEST['page']) && 'bookingpress\_notifications' == $\_REQUEST['page'] ){ |
| [4957](#L4957) | wp\_enqueue\_script( 'wp-tinymce' ); |
| [4958](#L4958) | } |
| [4959](#L4959) |  |
| [4960](#L4960) | if (isset($\_REQUEST['page']) && in\_array(sanitize\_text\_field($\_REQUEST['page']), (array) $bookingpress\_slugs) ) { |
| [4961](#L4961) | wp\_enqueue\_script('bookingpress\_admin\_js'); |
| [4962](#L4962) | wp\_enqueue\_script('bookingpress\_axios\_js'); |
| [4963](#L4963) | wp\_enqueue\_script('bookingpress\_wordpress\_vue\_helper\_js'); |
| [4964](#L4964) | wp\_enqueue\_script('bookingpress\_element\_js'); |
| [4965](#L4965) | wp\_enqueue\_script('bookingpress\_moment\_js'); |
| [4966](#L4966) | if ($bookingpress\_site\_current\_language == 'en' ) { |
| [4967](#L4967) | wp\_enqueue\_script('bookingpress\_element\_en\_js'); |
| [4968](#L4968) | } |
| [4969](#L4969) |  |
| [4970](#L4970) | if ($bookingpress\_site\_current\_language != 'en' ) { |
| [4971](#L4971) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/elements\_locale/' . $bookingpress\_site\_current\_language . '.js', array( 'bookingpress\_element\_js' ), BOOKINGPRESS\_VERSION); |
| [4972](#L4972) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [4973](#L4973) | } |
| [4974](#L4974) |  |
| [4975](#L4975) | $bookingpress\_allowed\_tel\_input\_script\_backend = apply\_filters('bookingpress\_allowed\_tel\_input\_script\_backend',false,sanitize\_text\_field($\_REQUEST['page'])); |
| [4976](#L4976) |  |
| [4977](#L4977) | if (! empty($\_REQUEST['page']) && ($bookingpress\_allowed\_tel\_input\_script\_backend || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customers' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_settings' || ( $\_REQUEST['page'] == 'bookingpress\_myprofile' || $\_REQUEST['page'] == "bookingpress\_appointments" || $\_REQUEST['page'] == "bookingpress\_calendar" ) ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4978](#L4978) | wp\_enqueue\_script('bookingpress\_tel\_input\_js'); |
| [4979](#L4979) | wp\_enqueue\_script('bookingpress\_tel\_utils\_js'); |
| [4980](#L4980) | } |
| [4981](#L4981) | } |
| [4982](#L4982) |  |
| [4983](#L4983) | if (isset($\_REQUEST['page']) && ( sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_calendar' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4984](#L4984) | wp\_enqueue\_script('bookingpress\_calendar\_js'); |
| [4985](#L4985) |  |
| [4986](#L4986) | if ($bookingpress\_site\_current\_language != 'en' ) { |
| [4987](#L4987) | wp\_register\_script('bookingpress\_vue\_cal\_locale', BOOKINGPRESS\_URL . '/js/locales/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION); |
| [4988](#L4988) | wp\_enqueue\_script('bookingpress\_vue\_cal\_locale'); |
| [4989](#L4989) | } |
| [4990](#L4990) | } |
| [4991](#L4991) |  |
| [4992](#L4992) | if (isset($\_REQUEST['page']) && (sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_settings' || sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress\_customize')  ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4993](#L4993) | wp\_enqueue\_script('bookingpress\_v-calendar\_js'); |
| [4994](#L4994) | } |
| [4995](#L4995) |  |
| [4996](#L4996) | if (isset($\_REQUEST['page']) && ( isset($\_REQUEST['page']) && sanitize\_text\_field($\_REQUEST['page']) == 'bookingpress' ) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [4997](#L4997) | wp\_register\_script('bookingpress\_charts\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_chart.min.js', array(), BOOKINGPRESS\_VERSION); |
| [4998](#L4998) | wp\_enqueue\_script('bookingpress\_charts\_js'); |
| [4999](#L4999) | } |
| [5000](#L5000) |  |
| [5001](#L5001) | wp\_localize\_script('bookingpress\_admin\_custom\_js', 'appoint\_ajax\_obj', array( 'ajax\_url' => admin\_url('admin-ajax.php') )); |
| [5002](#L5002) |  |
| [5003](#L5003) | } |
| [5004](#L5004) |  |
| [5005](#L5005) | /\*\* |
| [5006](#L5006) | \* Hide update notices in plugins page |
| [5007](#L5007) | \* |
| [5008](#L5008) | \* @return void |
| [5009](#L5009) | \*/ |
| [5010](#L5010) | function bookingpress\_hide\_update\_notice() |
| [5011](#L5011) | { |
| [5012](#L5012) | global $bookingpress\_slugs; |
| [5013](#L5013) | if (isset($\_REQUEST['page']) && in\_array(sanitize\_text\_field($\_REQUEST['page']), (array) $bookingpress\_slugs) ) { |
| [5014](#L5014) | remove\_action('admin\_notices', 'update\_nag', 3); |
| [5015](#L5015) | remove\_action('network\_admin\_notices', 'update\_nag', 3); |
| [5016](#L5016) | remove\_action('admin\_notices', 'maintenance\_nag'); |
| [5017](#L5017) | remove\_action('network\_admin\_notices', 'maintenance\_nag'); |
| [5018](#L5018) | remove\_action('admin\_notices', 'site\_admin\_notice'); |
| [5019](#L5019) | remove\_action('network\_admin\_notices', 'site\_admin\_notice'); |
| [5020](#L5020) | remove\_action('load-update-core.php', 'wp\_update\_plugins'); |
| [5021](#L5021) | add\_filter('pre\_site\_transient\_update\_core', array( $this, 'bookingpress\_remove\_core\_updates' )); |
| [5022](#L5022) | add\_filter('pre\_site\_transient\_update\_plugins', array( $this, 'bookingpress\_remove\_core\_updates' )); |
| [5023](#L5023) | add\_filter('pre\_site\_transient\_update\_themes', array( $this, 'bookingpress\_remove\_core\_updates' )); |
| [5024](#L5024) | } |
| [5025](#L5025) | } |
| [5026](#L5026) |  |
| [5027](#L5027) | function bookingpress\_remove\_core\_updates() |
| [5028](#L5028) | { |
| [5029](#L5029) | global $wp\_version; |
| [5030](#L5030) | return (object) array( |
| [5031](#L5031) | 'last\_checked'    => time(), |
| [5032](#L5032) | 'version\_checked' => $wp\_version, |
| [5033](#L5033) | ); |
| [5034](#L5034) | } |
| [5035](#L5035) |  |
| [5036](#L5036) | function bookingpress\_add\_user\_role\_and\_capabilities() |
| [5037](#L5037) | { |
| [5038](#L5038) | global $wp\_roles; |
| [5039](#L5039) | $role\_name  = 'BookingPress Customer'; |
| [5040](#L5040) | $role\_slug  = sanitize\_title($role\_name); |
| [5041](#L5041) | $basic\_caps = array( |
| [5042](#L5042) | $role\_slug => true, |
| [5043](#L5043) | 'read'     => true, |
| [5044](#L5044) | 'level\_0'  => true, |
| [5045](#L5045) | ); |
| [5046](#L5046) |  |
| [5047](#L5047) | $wp\_roles->add\_role($role\_slug, $role\_name, $basic\_caps); |
| [5048](#L5048) | } |
| [5049](#L5049) |  |
| [5050](#L5050) |  |
| [5051](#L5051) | /\*\* |
| [5052](#L5052) | \* Validate specific username |
| [5053](#L5053) | \* |
| [5054](#L5054) | \* @param  mixed $user\_login |
| [5055](#L5055) | \* @param  mixed $invalid\_username |
| [5056](#L5056) | \* @return void |
| [5057](#L5057) | \*/ |
| [5058](#L5058) | function bookingpress\_validate\_username( $user\_login, $invalid\_username = '' ) |
| [5059](#L5059) | { |
| [5060](#L5060) | $sanitized\_user\_login = sanitize\_user($user\_login); |
| [5061](#L5061) | $err                  = ''; |
| [5062](#L5062) | // Check the username |
| [5063](#L5063) | if ($sanitized\_user\_login == '' ) { |
| [5064](#L5064) | $err = esc\_html\_\_('Please enter a username.', 'bookingpress-appointment-booking'); |
| [5065](#L5065) | } elseif (! validate\_username($user\_login) ) { |
| [5066](#L5066) | if ($invalid\_username == '' ) { |
| [5067](#L5067) | $err\_msg = esc\_html\_\_('This username is invalid because it uses illegal characters. Please enter a valid username.', 'bookingpress-appointment-booking'); |
| [5068](#L5068) | } else { |
| [5069](#L5069) | $err\_msg = $invalid\_username; |
| [5070](#L5070) | } |
| [5071](#L5071) | $err = ( ! empty($err\_msg) ) ? $err\_msg : esc\_html\_\_('This username is invalid because it uses illegal characters. Please enter a valid username.', 'bookingpress-appointment-booking'); |
| [5072](#L5072) | } elseif (username\_exists($sanitized\_user\_login) ) { |
| [5073](#L5073) | $err = esc\_html\_\_('This username is already registered, please choose another one.', 'bookingpress-appointment-booking'); |
| [5074](#L5074) | } |
| [5075](#L5075) | return $err; |
| [5076](#L5076) | } |
| [5077](#L5077) |  |
| [5078](#L5078) |  |
| [5079](#L5079) | /\*\* |
| [5080](#L5080) | \* Validate specific email address |
| [5081](#L5081) | \* |
| [5082](#L5082) | \* @param  mixed $user\_email |
| [5083](#L5083) | \* @param  mixed $invalid\_email |
| [5084](#L5084) | \* @return void |
| [5085](#L5085) | \*/ |
| [5086](#L5086) | function bookingpress\_validate\_email( $user\_email, $invalid\_email = '' ) |
| [5087](#L5087) | { |
| [5088](#L5088) | $err = ''; |
| [5089](#L5089) | // Check the username |
| [5090](#L5090) | if ('' == $user\_email ) { |
| [5091](#L5091) | $err = esc\_html\_\_('Please type your e-mail address.', 'bookingpress-appointment-booking'); |
| [5092](#L5092) | } elseif (! is\_email($user\_email) ) { |
| [5093](#L5093) | if ($invalid\_email == '' ) { |
| [5094](#L5094) | $err\_msg = esc\_html\_\_('Please enter valid email address.', 'bookingpress-appointment-booking'); |
| [5095](#L5095) | } else { |
| [5096](#L5096) | $err\_msg = $invalid\_email; |
| [5097](#L5097) | } |
| [5098](#L5098) | $err = ( ! empty($err\_msg) ) ? $err\_msg : esc\_html\_\_('Please enter valid email address.', 'bookingpress-appointment-booking'); |
| [5099](#L5099) | } elseif (email\_exists($user\_email) ) { |
| [5100](#L5100) | $err = esc\_html\_\_('This email is already registered, please choose another one.', 'bookingpress-appointment-booking'); |
| [5101](#L5101) | } |
| [5102](#L5102) | return $err; |
| [5103](#L5103) | } |
| [5104](#L5104) |  |
| [5105](#L5105) | /\*\* |
| [5106](#L5106) | \* Update usermeta details |
| [5107](#L5107) | \* |
| [5108](#L5108) | \* @param  mixed $user\_ID |
| [5109](#L5109) | \* @param  mixed $posted\_data |
| [5110](#L5110) | \* @return void |
| [5111](#L5111) | \*/ |
| [5112](#L5112) | function bookingpress\_user\_update\_meta\_details( $user\_ID, $posted\_data = array() ) |
| [5113](#L5113) | { |
| [5114](#L5114) | if (! empty($user\_ID) && ! empty($posted\_data) ) { |
| [5115](#L5115) | $user = new WP\_User($user\_ID); |
| [5116](#L5116) | foreach ( $posted\_data as $key => $val ) { |
| [5117](#L5117) | if ($key == 'first\_name' || $key == 'last\_name' ) { |
| [5118](#L5118) | $val = trim(sanitize\_text\_field($val)); |
| [5119](#L5119) | } else if( $key == 'staff\_email'){ |
| [5120](#L5120) | wp\_update\_user( array( |
| [5121](#L5121) | 'ID' => $user\_ID, |
| [5122](#L5122) | 'user\_email' => sanitize\_email($val) |
| [5123](#L5123) | ) ); |
| [5124](#L5124) | } elseif ($key == 'role' || $key == 'roles' ) { |
| [5125](#L5125) | if (isset($val) && is\_array($val) && ! empty($val) ) { |
| [5126](#L5126) | $count = 0; |
| [5127](#L5127) | foreach ( $val as $v ) { |
| [5128](#L5128) | if ($count == 0 ) { |
| [5129](#L5129) | $user->set\_role($v); |
| [5130](#L5130) | } else { |
| [5131](#L5131) | $user->add\_role($v); |
| [5132](#L5132) | } |
| [5133](#L5133) | $count++; |
| [5134](#L5134) | } |
| [5135](#L5135) | } else { |
| [5136](#L5136) | $user->add\_role($val); |
| [5137](#L5137) | } |
| [5138](#L5138) | } |
| [5139](#L5139) | update\_user\_meta($user\_ID, $key, $val); |
| [5140](#L5140) | } |
| [5141](#L5141) | } |
| [5142](#L5142) | } |
| [5143](#L5143) |  |
| [5144](#L5144) | /\*\* |
| [5145](#L5145) | \* BookingPress custom function for file upload |
| [5146](#L5146) | \* |
| [5147](#L5147) | \* @param  mixed $source |
| [5148](#L5148) | \* @param  mixed $destination |
| [5149](#L5149) | \* @return void |
| [5150](#L5150) | \*/ |
| [5151](#L5151) | function bookingpress\_file\_upload\_function( $source, $destination ){ |
| [5152](#L5152) |  |
| [5153](#L5153) | $allow\_file\_upload = 1; |
| [5154](#L5154) | $allow\_file\_upload = apply\_filters('bookingpress\_allow\_file\_uploads', $allow\_file\_upload); |
| [5155](#L5155) | if (empty($source) || empty($destination) || empty($allow\_file\_upload)) { |
| [5156](#L5156) | return false; |
| [5157](#L5157) | } |
| [5158](#L5158) |  |
| [5159](#L5159) | if (! function\_exists('WP\_Filesystem') ) { |
| [5160](#L5160) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [5161](#L5161) | } |
| [5162](#L5162) |  |
| [5163](#L5163) | WP\_Filesystem(); |
| [5164](#L5164) | global $wp\_filesystem; |
| [5165](#L5165) |  |
| [5166](#L5166) | $file\_content = $wp\_filesystem->get\_contents($source); |
| [5167](#L5167) |  |
| [5168](#L5168) | $result = $wp\_filesystem->put\_contents($destination, $file\_content, 0777); |
| [5169](#L5169) |  |
| [5170](#L5170) | return $result; |
| [5171](#L5171) | } |
| [5172](#L5172) |  |
| [5173](#L5173) |  |
| [5174](#L5174) | /\*\* |
| [5175](#L5175) | \* Remove uploaded file |
| [5176](#L5176) | \* |
| [5177](#L5177) | \* @return void |
| [5178](#L5178) | \*/ |
| [5179](#L5179) | function bookingpress\_remove\_uploaded\_file() |
| [5180](#L5180) | { |
| [5181](#L5181) | global $wpdb; |
| [5182](#L5182) | $response              = array(); |
| [5183](#L5183) |  |
| [5184](#L5184) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [5185](#L5185) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [5186](#L5186) | if (! $bpa\_verify\_nonce\_flag ) { |
| [5187](#L5187) | $response['variant'] = 'error'; |
| [5188](#L5188) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [5189](#L5189) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [5190](#L5190) | wp\_send\_json($response); |
| [5191](#L5191) | die(); |
| [5192](#L5192) | } |
| [5193](#L5193) | if (! empty($\_POST) && ! empty($\_POST['upload\_file\_url']) ) { |
| [5194](#L5194) | $bookingpress\_uploaded\_avatar\_url = esc\_url\_raw($\_POST['upload\_file\_url']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [5195](#L5195) | $bookingpress\_file\_name\_arr       = explode('/', $bookingpress\_uploaded\_avatar\_url); |
| [5196](#L5196) | $bookingpress\_file\_name           = $bookingpress\_file\_name\_arr[ count($bookingpress\_file\_name\_arr) - 1 ]; |
| [5197](#L5197) | if( file\_exists( BOOKINGPRESS\_TMP\_IMAGES\_DIR . '/' . $bookingpress\_file\_name ) ){ |
| [5198](#L5198) | @unlink(BOOKINGPRESS\_TMP\_IMAGES\_DIR . '/' . $bookingpress\_file\_name); |
| [5199](#L5199) | } |
| [5200](#L5200) | } |
| [5201](#L5201) | die; |
| [5202](#L5202) | } |
| [5203](#L5203) |  |
| [5204](#L5204) |  |
| [5205](#L5205) | /\*\* |
| [5206](#L5206) | \* Insert or Update BookingPress settings value |
| [5207](#L5207) | \* |
| [5208](#L5208) | \* @param  mixed $setting\_name |
| [5209](#L5209) | \* @param  mixed $setting\_type |
| [5210](#L5210) | \* @param  mixed $setting\_value |
| [5211](#L5211) | \* @return void |
| [5212](#L5212) | \*/ |
| [5213](#L5213) | public function bookingpress\_update\_settings( $setting\_name, $setting\_type, $setting\_value = '' ) |
| [5214](#L5214) | { |
| [5215](#L5215) | global $wpdb, $tbl\_bookingpress\_settings; |
| [5216](#L5216) | if (! empty($setting\_name) ) { |
| [5217](#L5217) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_settings is table name defined globally. False Positive alarm |
| [5218](#L5218) | $bookingpress\_check\_record\_existance = $wpdb->get\_var($wpdb->prepare("SELECT COUNT(setting\_id) FROM `{$tbl\_bookingpress\_settings}` WHERE setting\_name = %s AND setting\_type = %s", $setting\_name, $setting\_type)); |
| [5219](#L5219) |  |
| [5220](#L5220) | if ($bookingpress\_check\_record\_existance > 0 ) { |
| [5221](#L5221) | // If record already exists then update data. |
| [5222](#L5222) | $bookingpress\_update\_data = array( |
| [5223](#L5223) | 'setting\_value' => ( ! empty($setting\_value) && (gettype($setting\_value) === 'boolean' || $setting\_name == 'smtp\_password') ) ? $setting\_value : sanitize\_text\_field($setting\_value), |
| [5224](#L5224) | 'setting\_type'  => $setting\_type, |
| [5225](#L5225) | 'updated\_at'    => current\_time('mysql'), |
| [5226](#L5226) | ); |
| [5227](#L5227) |  |
| [5228](#L5228) | $bpa\_update\_where\_condition = array( |
| [5229](#L5229) | 'setting\_name' => $setting\_name, |
| [5230](#L5230) | 'setting\_type' => $setting\_type, |
| [5231](#L5231) | ); |
| [5232](#L5232) |  |
| [5233](#L5233) | $bpa\_update\_affected\_rows = $wpdb->update($tbl\_bookingpress\_settings, $bookingpress\_update\_data, $bpa\_update\_where\_condition); |
| [5234](#L5234) | if ($bpa\_update\_affected\_rows > 0 ) { |
| [5235](#L5235) | wp\_cache\_delete($setting\_name); |
| [5236](#L5236) | wp\_cache\_set($setting\_name, $setting\_value); |
| [5237](#L5237) | return 1; |
| [5238](#L5238) | } |
| [5239](#L5239) | } else { |
| [5240](#L5240) | // If record not exists hen insert data. |
| [5241](#L5241) |  |
| [5242](#L5242) | $bookingpress\_insert\_data = array( |
| [5243](#L5243) | 'setting\_name'  => $setting\_name, |
| [5244](#L5244) | 'setting\_value' => ( ! empty($setting\_value) && (gettype($setting\_value) === 'boolean' || $setting\_name == 'smtp\_password') ) ? $setting\_value : sanitize\_text\_field($setting\_value), |
| [5245](#L5245) | 'setting\_type'  => $setting\_type, |
| [5246](#L5246) | 'updated\_at'    => current\_time('mysql'), |
| [5247](#L5247) | ); |
| [5248](#L5248) |  |
| [5249](#L5249) | $bookingpress\_inserted\_id = $wpdb->insert($tbl\_bookingpress\_settings, $bookingpress\_insert\_data); |
| [5250](#L5250) | if ($bookingpress\_inserted\_id > 0 ) { |
| [5251](#L5251) | wp\_cache\_delete($setting\_name); |
| [5252](#L5252) | wp\_cache\_set($setting\_name, $setting\_value); |
| [5253](#L5253) | return 1; |
| [5254](#L5254) | } |
| [5255](#L5255) | } |
| [5256](#L5256) | } |
| [5257](#L5257) |  |
| [5258](#L5258) | return 0; |
| [5259](#L5259) | } |
| [5260](#L5260) |  |
| [5261](#L5261) | /\*\* |
| [5262](#L5262) | \* Get customize setting value |
| [5263](#L5263) | \* |
| [5264](#L5264) | \* @param  mixed $setting\_names |
| [5265](#L5265) | \* @param  mixed $setting\_type |
| [5266](#L5266) | \* @return void |
| [5267](#L5267) | \*/ |
| [5268](#L5268) |  |
| [5269](#L5269) | public function bookingpress\_get\_customize\_settings( $setting\_name, $setting\_type ){ |
| [5270](#L5270) |  |
| [5271](#L5271) | if( $this->bpa\_is\_pro\_active() && version\_compare( $this->bpa\_pro\_plugin\_version(), '2.0', '<') ){ |
| [5272](#L5272) | return $this->bookingpress\_get\_customize\_settings\_lagecy( $setting\_name, $setting\_type ); |
| [5273](#L5273) | } |
| [5274](#L5274) | global $bookingpress\_global\_options, $bookingpress\_settings\_table\_exists; |
| [5275](#L5275) | if( 1 != $bookingpress\_settings\_table\_exists ){ |
| [5276](#L5276) | return ''; |
| [5277](#L5277) | } |
| [5278](#L5278) | $bookingpress\_options                    = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5279](#L5279) |  |
| [5280](#L5280) | $customize\_settings = $bookingpress\_options['customize\_settings']; |
| [5281](#L5281) |  |
| [5282](#L5282) |  |
| [5283](#L5283) | if( !is\_array( $setting\_name ) && !empty( $customize\_settings[ $setting\_type ][ $setting\_name ] ) ){ |
| [5284](#L5284) | $return\_customize\_setting\_data = $customize\_settings[ $setting\_type ][ $setting\_name ]; |
| [5285](#L5285) | $return\_customize\_setting\_data = apply\_filters( 'bookingpress\_modified\_get\_customize\_settings',$return\_customize\_setting\_data,$setting\_type,$setting\_name); |
| [5286](#L5286) | return $return\_customize\_setting\_data; |
| [5287](#L5287) | } else if( is\_array( $setting\_name ) ){ |
| [5288](#L5288) | $return\_data = array(); |
| [5289](#L5289) | foreach( $setting\_name as $setting\_name\_key ){ |
| [5290](#L5290) | if( !empty( $customize\_settings[ $setting\_type ][ $setting\_name\_key ] ) ){ |
| [5291](#L5291) | $return\_customize\_setting\_data = $customize\_settings[ $setting\_type ][ $setting\_name\_key ]; |
| [5292](#L5292) |  |
| [5293](#L5293) | $return\_customize\_setting\_data = apply\_filters( 'bookingpress\_modified\_get\_customize\_settings',$return\_customize\_setting\_data,$setting\_type,$setting\_name\_key); |
| [5294](#L5294) |  |
| [5295](#L5295) | $return\_data[ $setting\_name\_key ] = $return\_customize\_setting\_data; |
| [5296](#L5296) | } else { |
| [5297](#L5297) | $return\_data[ $setting\_name\_key ] = ''; |
| [5298](#L5298) | } |
| [5299](#L5299) | } |
| [5300](#L5300) | return $return\_data; |
| [5301](#L5301) | } else { |
| [5302](#L5302) | return ''; |
| [5303](#L5303) | } |
| [5304](#L5304) | } |
| [5305](#L5305) |  |
| [5306](#L5306) | /\*\* |
| [5307](#L5307) | \* bookingpress\_get\_customize\_settings\_lagecy |
| [5308](#L5308) | \* |
| [5309](#L5309) | \* @param  mixed $setting\_names |
| [5310](#L5310) | \* @param  mixed $setting\_type |
| [5311](#L5311) | \* |
| [5312](#L5312) | \* @deprecated on 20th March 2023 |
| [5313](#L5313) | \* @return void |
| [5314](#L5314) | \*/ |
| [5315](#L5315) | public function bookingpress\_get\_customize\_settings\_lagecy( $setting\_names, $setting\_type ){ |
| [5316](#L5316) |  |
| [5317](#L5317) | if( empty( $setting\_names ) ){ |
| [5318](#L5318) | return ''; |
| [5319](#L5319) | } |
| [5320](#L5320) |  |
| [5321](#L5321) | global $wpdb, $tbl\_bookingpress\_customize\_settings; |
| [5322](#L5322) |  |
| [5323](#L5323) | if( is\_array( $setting\_names ) ){ |
| [5324](#L5324) | $settings\_placeholders = 'bookingpress\_setting\_name IN ('; |
| [5325](#L5325) | $settings\_placeholders .= rtrim( str\_repeat( '%s,', count( $setting\_names ) ), ',' ); |
| [5326](#L5326) | $settings\_placeholders .= ')'; |
| [5327](#L5327) |  |
| [5328](#L5328) | $customize\_setting\_key =  implode(",",$setting\_names)."|^|".$setting\_type; |
| [5329](#L5329) |  |
| [5330](#L5330) | array\_unshift( $setting\_names, $settings\_placeholders ); |
| [5331](#L5331) | $settings\_query\_where = call\_user\_func\_array(array( $wpdb, 'prepare' ), $setting\_names ); |
| [5332](#L5332) |  |
| [5333](#L5333) | $customize\_setting\_value = wp\_cache\_get($customize\_setting\_key); |
| [5334](#L5334) |  |
| [5335](#L5335) | if($customize\_setting\_value === false){ |
| [5336](#L5336) | $bookingpress\_get\_setting  = $wpdb->get\_results( $wpdb->prepare( "SELECT bookingpress\_setting\_name,bookingpress\_setting\_value FROM `{$tbl\_bookingpress\_customize\_settings}` WHERE {$settings\_query\_where} AND bookingpress\_setting\_type = %s", $setting\_type ), ARRAY\_A ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason $tbl\_bookingpress\_customize\_settings is a table query and $settings\_query\_where is already passed through wpdb->prepare function |
| [5337](#L5337) | wp\_cache\_set($customize\_setting\_key,$bookingpress\_get\_setting); |
| [5338](#L5338) | } |
| [5339](#L5339) | else{ |
| [5340](#L5340) | $bookingpress\_get\_setting  = $customize\_setting\_value; |
| [5341](#L5341) | } |
| [5342](#L5342) |  |
| [5343](#L5343) | if( !empty( $bookingpress\_get\_setting ) ){ |
| [5344](#L5344) | $bookingpress\_setting\_value = array(); |
| [5345](#L5345) | foreach( $bookingpress\_get\_setting as $bookingpress\_setting ){ |
| [5346](#L5346) | $bookingpress\_setting\_value[ $bookingpress\_setting['bookingpress\_setting\_name'] ] = $bookingpress\_setting['bookingpress\_setting\_value']; |
| [5347](#L5347) | } |
| [5348](#L5348) | return $bookingpress\_setting\_value; |
| [5349](#L5349) | } else { |
| [5350](#L5350) | return array(); |
| [5351](#L5351) | } |
| [5352](#L5352) |  |
| [5353](#L5353) | } else { |
| [5354](#L5354) | $bookingpress\_setting\_value = ''; |
| [5355](#L5355) |  |
| [5356](#L5356) | $customize\_setting\_key =  $setting\_names."|^|".$setting\_type; |
| [5357](#L5357) | $customize\_setting\_value = wp\_cache\_get($customize\_setting\_key); |
| [5358](#L5358) |  |
| [5359](#L5359) | if($customize\_setting\_value === false){ |
| [5360](#L5360) | $bookingpress\_get\_setting   = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_setting\_value FROM `{$tbl\_bookingpress\_customize\_settings}` WHERE bookingpress\_setting\_name = %s AND bookingpress\_setting\_type = %s", $setting\_names, $setting\_type), ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customize\_settings is table name defined globally. False alarm |
| [5361](#L5361) | wp\_cache\_set($customize\_setting\_key,$bookingpress\_get\_setting); |
| [5362](#L5362) | } |
| [5363](#L5363) | else{ |
| [5364](#L5364) | $bookingpress\_get\_setting  = $customize\_setting\_value; |
| [5365](#L5365) | } |
| [5366](#L5366) | if( !empty( $bookingpress\_get\_setting ) ){ |
| [5367](#L5367) | $bookingpress\_setting\_value = $bookingpress\_get\_setting['bookingpress\_setting\_value']; |
| [5368](#L5368) | } |
| [5369](#L5369) |  |
| [5370](#L5370) | return $bookingpress\_setting\_value; |
| [5371](#L5371) | } |
| [5372](#L5372) |  |
| [5373](#L5373) | } |
| [5374](#L5374) |  |
| [5375](#L5375) | /\*\* |
| [5376](#L5376) | \* Get specific setting value. |
| [5377](#L5377) | \* |
| [5378](#L5378) | \* @param  mixed $setting\_name |
| [5379](#L5379) | \* @param  mixed $setting\_type |
| [5380](#L5380) | \* @return void |
| [5381](#L5381) | \*/ |
| [5382](#L5382) | public function bookingpress\_get\_settings( $setting\_name, $setting\_type ) |
| [5383](#L5383) | { |
| [5384](#L5384) | if( $this->bpa\_is\_pro\_active() && version\_compare( $this->bpa\_pro\_plugin\_version(), '2.0', '<') ){ |
| [5385](#L5385) | return $this->bookingpress\_get\_settings\_lagecy( $setting\_name, $setting\_type ); |
| [5386](#L5386) | } |
| [5387](#L5387) | global $bookingpress\_global\_options, $bookingpress\_settings\_table\_exists; |
| [5388](#L5388) | if( 1 != $bookingpress\_settings\_table\_exists ){ |
| [5389](#L5389) | return ''; |
| [5390](#L5390) | } |
| [5391](#L5391) | $bookingpress\_general\_setting\_options                    = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5392](#L5392) |  |
| [5393](#L5393) | //echo "inside"; exit; |
| [5394](#L5394) |  |
| [5395](#L5395) | $general\_settings = $bookingpress\_general\_setting\_options['general\_settings']; |
| [5396](#L5396) |  |
| [5397](#L5397) |  |
| [5398](#L5398) | if( !is\_array( $setting\_name ) && !empty( $general\_settings[ $setting\_type ][ $setting\_name ] ) ){ |
| [5399](#L5399) | $return\_setting\_data = $general\_settings[ $setting\_type ][ $setting\_name ]; |
| [5400](#L5400) | $return\_setting\_data = apply\_filters( 'bookingpress\_modified\_get\_settings',$return\_setting\_data,$setting\_type,$setting\_name); |
| [5401](#L5401) | return $return\_setting\_data; |
| [5402](#L5402) |  |
| [5403](#L5403) | } else if( is\_array( $setting\_name ) ){ |
| [5404](#L5404) | $return\_data = array(); |
| [5405](#L5405) | foreach( $setting\_name as $setting\_name\_key ){ |
| [5406](#L5406) | if( !empty( $general\_settings[ $setting\_type ][ $setting\_name\_key ] ) ){ |
| [5407](#L5407) | $return\_setting\_data = $general\_settings[ $setting\_type ][ $setting\_name\_key ]; |
| [5408](#L5408) | $return\_setting\_data = apply\_filters( 'bookingpress\_modified\_get\_settings',$return\_setting\_data,$setting\_type,$setting\_name\_key); |
| [5409](#L5409) | $return\_data[ $setting\_name\_key ] = $return\_setting\_data; |
| [5410](#L5410) | } else { |
| [5411](#L5411) | $return\_data[ $setting\_name\_key ] = ''; |
| [5412](#L5412) | } |
| [5413](#L5413) | } |
| [5414](#L5414) | return $return\_data; |
| [5415](#L5415) | } else { |
| [5416](#L5416) | return ''; |
| [5417](#L5417) | } |
| [5418](#L5418) |  |
| [5419](#L5419) | //echo "out"; exit; |
| [5420](#L5420) | } |
| [5421](#L5421) |  |
| [5422](#L5422) |  |
| [5423](#L5423) | /\*\* |
| [5424](#L5424) | \* Get specific setting value. |
| [5425](#L5425) | \* |
| [5426](#L5426) | \* @param  mixed $setting\_name |
| [5427](#L5427) | \* @param  mixed $setting\_type |
| [5428](#L5428) | \* |
| [5429](#L5429) | \* @deprecated on 20th March 2023 |
| [5430](#L5430) | \* @return void |
| [5431](#L5431) | \*/ |
| [5432](#L5432) | public function bookingpress\_get\_settings\_lagecy( $setting\_name, $setting\_type ) |
| [5433](#L5433) | { |
| [5434](#L5434) | global $wpdb, $tbl\_bookingpress\_settings; |
| [5435](#L5435) | $bookingpress\_setting\_value = ''; |
| [5436](#L5436) | if (! empty($setting\_name) ) { |
| [5437](#L5437) | if ( false !== wp\_cache\_get($setting\_name) ) { |
| [5438](#L5438) | $bookingpress\_setting\_value = wp\_cache\_get($setting\_name); |
| [5439](#L5439) | } else { |
| [5440](#L5440) |  |
| [5441](#L5441) | $bookingpress\_get\_setting   = $wpdb->get\_row($wpdb->prepare("SELECT setting\_value FROM `{$tbl\_bookingpress\_settings}` WHERE setting\_name = %s AND setting\_type = %s", $setting\_name, $setting\_type), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_settings is table name defined globally. False Positive alarm |
| [5442](#L5442) |  |
| [5443](#L5443) | if( !empty( $bookingpress\_get\_setting ) ){ |
| [5444](#L5444) | $bookingpress\_setting\_value = $bookingpress\_get\_setting['setting\_value']; |
| [5445](#L5445) | } |
| [5446](#L5446) | wp\_cache\_set($setting\_name, $bookingpress\_setting\_value); |
| [5447](#L5447) | } |
| [5448](#L5448) | } |
| [5449](#L5449) |  |
| [5450](#L5450) | return $bookingpress\_setting\_value; |
| [5451](#L5451) | } |
| [5452](#L5452) |  |
| [5453](#L5453) |  |
| [5454](#L5454) | /\*\* |
| [5455](#L5455) | \* Get currency symbol from curreny name |
| [5456](#L5456) | \* |
| [5457](#L5457) | \* @param  mixed $currency\_name |
| [5458](#L5458) | \* @return void |
| [5459](#L5459) | \*/ |
| [5460](#L5460) | public function bookingpress\_get\_currency\_symbol( $currency\_name ) |
| [5461](#L5461) | { |
| [5462](#L5462) | if (! empty($currency\_name) ) { |
| [5463](#L5463) | global $bookingpress\_global\_options; |
| [5464](#L5464) | $bookingpress\_options                    = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5465](#L5465) | $bookingpress\_countries\_currency\_details = json\_decode($bookingpress\_options['countries\_json\_details']); |
| [5466](#L5466) |  |
| [5467](#L5467) | $bookingpress\_currency\_symbol = ''; |
| [5468](#L5468) |  |
| [5469](#L5469) | foreach ( $bookingpress\_countries\_currency\_details as $currency\_key => $currency\_val ) { |
| [5470](#L5470) | if ($currency\_val->code == $currency\_name ) { |
| [5471](#L5471) | $bookingpress\_currency\_symbol = $currency\_val->symbol; |
| [5472](#L5472) | break; |
| [5473](#L5473) | } |
| [5474](#L5474) | } |
| [5475](#L5475) |  |
| [5476](#L5476) | return $bookingpress\_currency\_symbol; |
| [5477](#L5477) | } |
| [5478](#L5478) |  |
| [5479](#L5479) | return ''; |
| [5480](#L5480) | } |
| [5481](#L5481) |  |
| [5482](#L5482) | /\*\* |
| [5483](#L5483) | \* Get currency code from currency name |
| [5484](#L5484) | \* |
| [5485](#L5485) | \* @param  mixed $currency\_name |
| [5486](#L5486) | \* @return void |
| [5487](#L5487) | \*/ |
| [5488](#L5488) | public function bookingpress\_get\_currency\_code( $currency\_name ) |
| [5489](#L5489) | { |
| [5490](#L5490) | if (! empty($currency\_name) ) { |
| [5491](#L5491) | global $bookingpress\_global\_options; |
| [5492](#L5492) | $bookingpress\_options                    = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5493](#L5493) | $bookingpress\_countries\_currency\_details = json\_decode($bookingpress\_options['countries\_json\_details']); |
| [5494](#L5494) |  |
| [5495](#L5495) | $bookingpress\_currency\_code = ''; |
| [5496](#L5496) |  |
| [5497](#L5497) | foreach ( $bookingpress\_countries\_currency\_details as $currency\_key => $currency\_val ) { |
| [5498](#L5498) | if ($currency\_val->code == $currency\_name ) { |
| [5499](#L5499) | $bookingpress\_currency\_code = $currency\_val->code; |
| [5500](#L5500) | break; |
| [5501](#L5501) | } |
| [5502](#L5502) | } |
| [5503](#L5503) |  |
| [5504](#L5504) | return $bookingpress\_currency\_code; |
| [5505](#L5505) | } |
| [5506](#L5506) |  |
| [5507](#L5507) | return ''; |
| [5508](#L5508) | } |
| [5509](#L5509) |  |
| [5510](#L5510) | /\*\* |
| [5511](#L5511) | \* Format price with currency and other general setting which applied in 'General settings' |
| [5512](#L5512) | \* |
| [5513](#L5513) | \* @param  mixed $price |
| [5514](#L5514) | \* @param  mixed $currency\_symbol |
| [5515](#L5515) | \* @param  mixed $is\_symbol\_added |
| [5516](#L5516) | \* @return void |
| [5517](#L5517) | \*/ |
| [5518](#L5518) | public function bookingpress\_price\_formatter\_with\_currency\_symbol( $price, $currency\_symbol = '', $is\_symbol\_added = 1 ) |
| [5519](#L5519) | { |
| [5520](#L5520) | $bookingpress\_decimal\_points = $this->bookingpress\_get\_settings('price\_number\_of\_decimals', 'payment\_setting'); |
| [5521](#L5521) | $bookingpress\_decimal\_points = intval($bookingpress\_decimal\_points); |
| [5522](#L5522) | if (gettype($price) == 'string' ) { |
| [5523](#L5523) | $price = floatval($price); |
| [5524](#L5524) | } |
| [5525](#L5525) | $bookingpress\_price\_separator\_pos = $this->bookingpress\_get\_settings('price\_separator', 'payment\_setting'); |
| [5526](#L5526) | if ($bookingpress\_price\_separator\_pos == 'comma-dot' && gettype($price) != 'NULL') { |
| [5527](#L5527) | $price = number\_format($price, $bookingpress\_decimal\_points, '.', ','); |
| [5528](#L5528) | } elseif ($bookingpress\_price\_separator\_pos == 'dot-comma' && gettype($price) != 'NULL') { |
| [5529](#L5529) | $price = number\_format($price, $bookingpress\_decimal\_points, ',', '.'); |
| [5530](#L5530) | } elseif ($bookingpress\_price\_separator\_pos == 'space-dot' && gettype($price) != 'NULL') { |
| [5531](#L5531) | $price = number\_format($price, $bookingpress\_decimal\_points, '.', ' '); |
| [5532](#L5532) | } elseif ($bookingpress\_price\_separator\_pos == 'space-comma' && gettype($price) != 'NULL') { |
| [5533](#L5533) | $price = number\_format($price, $bookingpress\_decimal\_points, ',', ' '); |
| [5534](#L5534) | } elseif ($bookingpress\_price\_separator\_pos == 'Custom' && gettype($price) != 'NULL') { |
| [5535](#L5535) | $bookingpress\_comma\_separator = $this->bookingpress\_get\_settings('custom\_comma\_separator', 'payment\_setting'); |
| [5536](#L5536) | $bookingpress\_dot\_separator   = $this->bookingpress\_get\_settings('custom\_dot\_separator', 'payment\_setting'); |
| [5537](#L5537) | $price                        = number\_format($price, $bookingpress\_decimal\_points, $bookingpress\_dot\_separator, $bookingpress\_comma\_separator); |
| [5538](#L5538) | } |
| [5539](#L5539) |  |
| [5540](#L5540) | $bookingpress\_price\_with\_symbol = $price; |
| [5541](#L5541) | if($is\_symbol\_added == 1){ |
| [5542](#L5542) | if (empty($currency\_symbol) ) { |
| [5543](#L5543) | $bookingpress\_currency\_name = $this->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [5544](#L5544) | $currency\_symbol            = ! empty($bookingpress\_currency\_name) ? $this->bookingpress\_get\_currency\_symbol($bookingpress\_currency\_name) : ''; |
| [5545](#L5545) | } |
| [5546](#L5546) |  |
| [5547](#L5547) | $bookingpress\_price\_symbol\_position = $this->bookingpress\_get\_settings('price\_symbol\_position', 'payment\_setting'); |
| [5548](#L5548) |  |
| [5549](#L5549) | $bookingpress\_price\_with\_symbol = $currency\_symbol . $price; |
| [5550](#L5550) |  |
| [5551](#L5551) | if ($bookingpress\_price\_symbol\_position == 'before' ) { |
| [5552](#L5552) | $bookingpress\_price\_with\_symbol = $currency\_symbol . $price; |
| [5553](#L5553) | } elseif ($bookingpress\_price\_symbol\_position == 'before\_with\_space' ) { |
| [5554](#L5554) | $bookingpress\_price\_with\_symbol = $currency\_symbol . ' ' . $price; |
| [5555](#L5555) | } elseif ($bookingpress\_price\_symbol\_position == 'after' ) { |
| [5556](#L5556) | $bookingpress\_price\_with\_symbol = $price . $currency\_symbol; |
| [5557](#L5557) | } elseif ($bookingpress\_price\_symbol\_position == 'after\_with\_space' ) { |
| [5558](#L5558) | $bookingpress\_price\_with\_symbol = $price . ' ' . $currency\_symbol; |
| [5559](#L5559) | } |
| [5560](#L5560) | } |
| [5561](#L5561) |  |
| [5562](#L5562) | return $bookingpress\_price\_with\_symbol; |
| [5563](#L5563) | } |
| [5564](#L5564) |  |
| [5565](#L5565) | /\*\* |
| [5566](#L5566) | \* Get service end time based start time |
| [5567](#L5567) | \* |
| [5568](#L5568) | \* @param  mixed $service\_id |
| [5569](#L5569) | \* @param  mixed $service\_start\_time |
| [5570](#L5570) | \* @param  mixed $service\_duration\_val |
| [5571](#L5571) | \* @param  mixed $service\_duration\_unit |
| [5572](#L5572) | \* @return void |
| [5573](#L5573) | \*/ |
| [5574](#L5574) | public function bookingpress\_get\_service\_end\_time( $service\_id, $service\_start\_time, $service\_duration\_val = '', $service\_duration\_unit = '' ) |
| [5575](#L5575) | { |
| [5576](#L5576) | global $wpdb, $tbl\_bookingpress\_services; |
| [5577](#L5577) | if (! empty($service\_id) ) { |
| [5578](#L5578) | $service\_duration      = ! empty($service\_duration\_val) ? $service\_duration\_val : ''; |
| [5579](#L5579) | $service\_unit\_duration = ! empty($service\_duration\_unit) ? $service\_duration\_unit : ''; |
| [5580](#L5580) |  |
| [5581](#L5581) | if (empty($service\_duration) && empty($service\_unit\_duration) ) { |
| [5582](#L5582) | $service\_data = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_service\_duration\_val,bookingpress\_service\_duration\_unit FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $service\_id), ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [5583](#L5583) | if(!empty($service\_data)){ |
| [5584](#L5584) | $service\_duration      = $service\_data['bookingpress\_service\_duration\_val']; |
| [5585](#L5585) | $service\_unit\_duration = $service\_data['bookingpress\_service\_duration\_unit']; |
| [5586](#L5586) | } |
| [5587](#L5587) | } |
| [5588](#L5588) |  |
| [5589](#L5589) | $service\_mins = $service\_duration; |
| [5590](#L5590) | if ($service\_unit\_duration == 'h' ) { |
| [5591](#L5591) | $service\_mins = $service\_duration \* 60; |
| [5592](#L5592) | } |
| [5593](#L5593) |  |
| [5594](#L5594) | $service\_end\_time\_obj = new DateTime($service\_start\_time); |
| [5595](#L5595) | $service\_end\_time\_obj->add(new DateInterval('PT' . $service\_mins . 'M')); |
| [5596](#L5596) | $service\_end\_time = $service\_end\_time\_obj->format('H:i'); |
| [5597](#L5597) |  |
| [5598](#L5598) | return array( |
| [5599](#L5599) | 'service\_start\_time' => $service\_start\_time, |
| [5600](#L5600) | 'service\_end\_time'   => $service\_end\_time, |
| [5601](#L5601) | ); |
| [5602](#L5602) |  |
| [5603](#L5603) | } |
| [5604](#L5604) |  |
| [5605](#L5605) | return array(); |
| [5606](#L5606) | } |
| [5607](#L5607) |  |
| [5608](#L5608) |  |
| [5609](#L5609) | /\*\* |
| [5610](#L5610) | \* Get default timeslot details |
| [5611](#L5611) | \* |
| [5612](#L5612) | \* @return void |
| [5613](#L5613) | \*/ |
| [5614](#L5614) | public function bookingpress\_get\_default\_timeslot\_data() |
| [5615](#L5615) | { |
| [5616](#L5616) | $bookingpress\_default\_timeslot\_data = esc\_html($this->bookingpress\_get\_settings('default\_time\_slot\_step', 'general\_setting')); |
| [5617](#L5617) | $bookingpress\_default\_timeslot\_data = ! empty($bookingpress\_default\_timeslot\_data) ? esc\_html($bookingpress\_default\_timeslot\_data) : 60; |
| [5618](#L5618) | $time\_duration  = $bookingpress\_time\_duration= $bookingpress\_default\_timeslot\_data; |
| [5619](#L5619) | $time\_unit = 'm'; |
| [5620](#L5620) |  |
| [5621](#L5621) | if ($time\_duration >= 60 ) { |
| [5622](#L5622) | $time\_duration = ( $time\_duration / 60 ); |
| [5623](#L5623) | if(is\_int($time\_duration) == false) { |
| [5624](#L5624) | $time\_duration = $bookingpress\_time\_duration; |
| [5625](#L5625) | } else { |
| [5626](#L5626) | $time\_unit     = 'h'; |
| [5627](#L5627) | } |
| [5628](#L5628) | } |
| [5629](#L5629) | return array( |
| [5630](#L5630) | 'time\_duration'    => $time\_duration, |
| [5631](#L5631) | 'time\_unit'        => $time\_unit, |
| [5632](#L5632) | 'default\_timeslot' => $bookingpress\_default\_timeslot\_data, |
| [5633](#L5633) | ); |
| [5634](#L5634) | } |
| [5635](#L5635) |  |
| [5636](#L5636) | public function bookingpress\_retrieve\_off\_days( $start\_date = '', $number\_of\_days = 366, $selected\_service = '', $selected\_service\_duration = '', $selected\_staffmember = '' ){ |
| [5637](#L5637) |  |
| [5638](#L5638) | global $wpdb, $tbl\_bookingpress\_default\_daysoff, $tbl\_bookingpress\_default\_workhours, $BookingPress; |
| [5639](#L5639) |  |
| [5640](#L5640) | $current\_date = date( 'Y-m-d', current\_time('timestamp') ); |
| [5641](#L5641) |  |
| [5642](#L5642) | $end\_date = date('Y-m-d', strtotime($start\_date . '+' . $number\_of\_days.' day')); |
| [5643](#L5643) |  |
| [5644](#L5644) | $retrieve\_default\_holidays = array( |
| [5645](#L5645) | 'offdays' => array(), |
| [5646](#L5646) | 'exclude\_offdays' => array() |
| [5647](#L5647) | ); |
| [5648](#L5648) |  |
| [5649](#L5649) | $retrieve\_default\_holidays = apply\_filters( 'bookingpress\_modify\_default\_holidays', $retrieve\_default\_holidays, $selected\_service, $selected\_service\_duration, $selected\_staffmember ); |
| [5650](#L5650) |  |
| [5651](#L5651) |  |
| [5652](#L5652) | /\*\* checking the holidays from the start date \*/ |
| [5653](#L5653) | $bpa\_default\_daysoff\_where = $wpdb->prepare( 'WHERE (bookingpress\_dayoff\_date >= %s OR bookingpress\_repeat = %d)', $start\_date .' 00:00:00',1); |
| [5654](#L5654) |  |
| [5655](#L5655) | $exclude\_days = !empty( $retrieve\_default\_holidays['exclude\_offdays'] ) ? $retrieve\_default\_holidays['exclude\_offdays'] : array(); |
| [5656](#L5656) |  |
| [5657](#L5657) |  |
| [5658](#L5658) | /\*\* if dates are available in exclusion, then add a where clause with those dates \*/ |
| [5659](#L5659) | if( !empty( $exclude\_days ) ){ |
| [5660](#L5660) |  |
| [5661](#L5661) | $bpa\_default\_daysoff\_where .= ' AND bookingpress\_dayoff\_date NOT IN ( '; |
| [5662](#L5662) | $bpa\_default\_daysoff\_where .= rtrim( str\_repeat( '%s,', count( $exclude\_days ) ), ',' ) . ' )'; |
| [5663](#L5663) |  |
| [5664](#L5664) | array\_unshift( $exclude\_days, $bpa\_default\_daysoff\_where ); |
| [5665](#L5665) | $bpa\_default\_daysoff\_where = call\_user\_func\_array( array( $wpdb, 'prepare' ), $exclude\_days ); |
| [5666](#L5666) |  |
| [5667](#L5667) | } |
| [5668](#L5668) |  |
| [5669](#L5669) | $daysoff\_details = $wpdb->get\_results("SELECT bookingpress\_dayoff\_date,bookingpress\_repeat FROM {$tbl\_bookingpress\_default\_daysoff} {$bpa\_default\_daysoff\_where}", ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_daysoff is table name defined globally. False alarm |
| [5670](#L5670) |  |
| [5671](#L5671) | $default\_off\_dates = array(); |
| [5672](#L5672) | $repeative\_off\_dates = array(); |
| [5673](#L5673) |  |
| [5674](#L5674) | if( !empty( $retrieve\_default\_holidays['offdays'] ) ){ |
| [5675](#L5675) | $daysoff\_details = array\_merge( $daysoff\_details, $retrieve\_default\_holidays['offdays']); |
| [5676](#L5676) | } |
| [5677](#L5677) |  |
| [5678](#L5678) | if( !empty( $daysoff\_details ) ){ |
| [5679](#L5679) | $total\_daysoff\_details = count( $daysoff\_details ); |
| [5680](#L5680) | $daysoff\_counter = 0; |
| [5681](#L5681) | while( 0 < $total\_daysoff\_details ){ |
| [5682](#L5682) |  |
| [5683](#L5683) | $holidays\_data = $daysoff\_details[ $daysoff\_counter ]; |
| [5684](#L5684) |  |
| [5685](#L5685) | $default\_off\_dates[] = date('Y-m-d', strtotime( $holidays\_data['bookingpress\_dayoff\_date'] ) ); |
| [5686](#L5686) | if( 1 == $holidays\_data['bookingpress\_repeat'] ){ |
| [5687](#L5687) | $repeative\_off\_dates[] = date( 'm-d', strtotime( $holidays\_data['bookingpress\_dayoff\_date'] ) ); |
| [5688](#L5688) | } |
| [5689](#L5689) |  |
| [5690](#L5690) | $total\_daysoff\_details--; |
| [5691](#L5691) | $daysoff\_counter++; |
| [5692](#L5692) | } |
| [5693](#L5693) | } |
| [5694](#L5694) |  |
| [5695](#L5695) | $default\_off\_days = array( |
| [5696](#L5696) | 'skip\_check' => false, |
| [5697](#L5697) | 'off\_days' => array() |
| [5698](#L5698) | ); |
| [5699](#L5699) | $default\_off\_days = apply\_filters( 'bookingpress\_modify\_default\_off\_days', $default\_off\_days, $selected\_service, $selected\_service\_duration, $selected\_staffmember ); |
| [5700](#L5700) |  |
| [5701](#L5701) | if( false == $default\_off\_days['skip\_check'] ){ |
| [5702](#L5702) | $bookingpress\_off\_days\_data = $wpdb->get\_results( $wpdb->prepare( "SELECT LOWER(bookingpress\_workday\_key) AS bookingpress\_workday\_key FROM {$tbl\_bookingpress\_default\_workhours} WHERE (bookingpress\_start\_time IS NULL OR ( ABS( TIME\_TO\_SEC( TIMEDIFF( bookingpress\_start\_Time, ( CASE WHEN bookingpress\_end\_time = '00:00:00' THEN '24:00:00' ELSE bookingpress\_end\_time END ) ) ) DIV 60 ) < %d ) ) AND bookingpress\_is\_break = %d", $selected\_service\_duration, 0 ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [5703](#L5703) |  |
| [5704](#L5704) | if( !empty( $bookingpress\_off\_days\_data ) ){ |
| [5705](#L5705) | foreach( $bookingpress\_off\_days\_data as $bpa\_default\_workdata ){ |
| [5706](#L5706) | $default\_off\_days['off\_days'][] = $bpa\_default\_workdata['bookingpress\_workday\_key']; |
| [5707](#L5707) | } |
| [5708](#L5708) | } |
| [5709](#L5709) | } else { |
| [5710](#L5710) |  |
| [5711](#L5711) | } |
| [5712](#L5712) |  |
| [5713](#L5713) |  |
| [5714](#L5714) | $bpa\_begin\_date = new DateTime( $start\_date ); |
| [5715](#L5715) | $bpa\_end\_date = new DateTime( $end\_date ); |
| [5716](#L5716) |  |
| [5717](#L5717) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [5718](#L5718) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [5719](#L5719) |  |
| [5720](#L5720) | $default\_daysoff\_dates = array(); |
| [5721](#L5721) |  |
| [5722](#L5722) | foreach( $period as $dt ){ |
| [5723](#L5723) | $weekday\_name = $dt->format( 'l' ); |
| [5724](#L5724) |  |
| [5725](#L5725) | if( ( ( !empty( $exclude\_days ) && ( in\_array( $dt->format('Y-m-d H:i:s'), $exclude\_days ) || in\_array( $dt->format('Y-m-d'), $exclude\_days ) ) ) ) ){ |
| [5726](#L5726) | continue; |
| [5727](#L5727) | } |
| [5728](#L5728) |  |
| [5729](#L5729) | if( in\_array( strtolower( $weekday\_name ), $default\_off\_days['off\_days'] ) ){ |
| [5730](#L5730) | $default\_daysoff\_dates[] = $dt->format( 'Y-m-d H:i:s' ); |
| [5731](#L5731) | } |
| [5732](#L5732) |  |
| [5733](#L5733) | if( in\_array( $dt->format('Y-m-d'), $default\_off\_dates ) ){ |
| [5734](#L5734) | $default\_daysoff\_dates[] = $dt->format( 'Y-m-d H:i:s' ); |
| [5735](#L5735) | } |
| [5736](#L5736) |  |
| [5737](#L5737) | if( in\_array( $dt->format( 'm-d' ), $repeative\_off\_dates ) ){ |
| [5738](#L5738) | $default\_daysoff\_dates[] = $dt->format( 'Y-m-d H:i:s' ); |
| [5739](#L5739) | } |
| [5740](#L5740) | } |
| [5741](#L5741) |  |
| [5742](#L5742) |  |
| [5743](#L5743) |  |
| [5744](#L5744) | if( $start\_date > $current\_date ){ |
| [5745](#L5745) | $bpa\_check\_end\_date = new DateTime( $current\_date ); |
| [5746](#L5746) |  |
| [5747](#L5747) | $bpa\_interval = DateInterval::createFromDateString( '1 day' ); |
| [5748](#L5748) | $period = new DatePeriod( $bpa\_check\_end\_date, $bpa\_interval, $bpa\_begin\_date ); |
| [5749](#L5749) |  |
| [5750](#L5750) | foreach( $period as $dt ){ |
| [5751](#L5751) | $default\_daysoff\_dates[] = $dt->format( 'Y-m-d H:i:s' ); |
| [5752](#L5752) | } |
| [5753](#L5753) | } |
| [5754](#L5754) |  |
| [5755](#L5755) |  |
| [5756](#L5756) | return $default\_daysoff\_dates; |
| [5757](#L5757) | } |
| [5758](#L5758) |  |
| [5759](#L5759) | /\*\* |
| [5760](#L5760) | \* Get default daysoff dates |
| [5761](#L5761) | \* |
| [5762](#L5762) | \* @param  mixed $booking\_date |
| [5763](#L5763) | \* @param  mixed $booking\_time |
| [5764](#L5764) | \* @param  mixed $bookingpress\_selected\_service |
| [5765](#L5765) | \* @param  mixed $bookingpress\_selected\_staffmember\_id |
| [5766](#L5766) | \* @return void |
| [5767](#L5767) | \*/ |
| [5768](#L5768) | public function bookingpress\_get\_default\_dayoff\_dates($booking\_date = '', $booking\_time = '', $bookingpress\_selected\_service = '',$bookingpress\_selected\_staffmember\_id = '') |
| [5769](#L5769) | { |
| [5770](#L5770) | global $wpdb, $tbl\_bookingpress\_default\_daysoff, $tbl\_bookingpress\_default\_workhours; |
| [5771](#L5771) |  |
| [5772](#L5772) | $bpa\_default\_hours\_with\_nobreak = wp\_cache\_get( 'bookingpress\_default\_workhours\_without\_break' ); |
| [5773](#L5773) | if( false === $bpa\_default\_hours\_with\_nobreak ){ |
| [5774](#L5774) | $bookingpress\_workhours\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_is\_break = 0", ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False alarm |
| [5775](#L5775) | wp\_cache\_set( 'bookingpress\_default\_workhours\_without\_break', $bookingpress\_workhours\_data ); |
| [5776](#L5776) | } else { |
| [5777](#L5777) | $bookingpress\_workhours\_data = $bpa\_default\_hours\_with\_nobreak; |
| [5778](#L5778) | } |
| [5779](#L5779) |  |
| [5780](#L5780) | $is\_monday\_break             = 0; |
| [5781](#L5781) | $is\_tuesday\_break            = 0; |
| [5782](#L5782) | $is\_wednesday\_break          = 0; |
| [5783](#L5783) | $is\_thursday\_break           = 0; |
| [5784](#L5784) | $is\_friday\_break             = 0; |
| [5785](#L5785) | $is\_saturday\_break           = 0; |
| [5786](#L5786) | $is\_sunday\_break             = 0; |
| [5787](#L5787) |  |
| [5788](#L5788) | foreach ( $bookingpress\_workhours\_data as $workhour\_key => $workhour\_val ) { |
| [5789](#L5789) | $bookingpress\_start\_time = $workhour\_val['bookingpress\_start\_time']; |
| [5790](#L5790) | $bookingpress\_end\_time   = $workhour\_val['bookingpress\_end\_time']; |
| [5791](#L5791) | if ($workhour\_val['bookingpress\_workday\_key'] == 'monday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5792](#L5792) | $is\_monday\_break = 1; |
| [5793](#L5793) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'tuesday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5794](#L5794) | $is\_tuesday\_break = 1; |
| [5795](#L5795) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'wednesday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5796](#L5796) | $is\_wednesday\_break = 1; |
| [5797](#L5797) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'thursday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5798](#L5798) | $is\_thursday\_break = 1; |
| [5799](#L5799) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'friday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5800](#L5800) | $is\_friday\_break = 1; |
| [5801](#L5801) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'saturday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5802](#L5802) | $is\_saturday\_break = 1; |
| [5803](#L5803) | } elseif ($workhour\_val['bookingpress\_workday\_key'] == 'sunday' && ( $bookingpress\_start\_time == null || $bookingpress\_end\_time == null ) ) { |
| [5804](#L5804) | $is\_sunday\_break = 1; |
| [5805](#L5805) | } |
| [5806](#L5806) | } |
| [5807](#L5807) |  |
| [5808](#L5808) | $break\_days = array(); |
| [5809](#L5809) | $break\_days['monday'] = $is\_monday\_break; |
| [5810](#L5810) | $break\_days['tuesday'] = $is\_tuesday\_break; |
| [5811](#L5811) | $break\_days['wednesday'] = $is\_wednesday\_break; |
| [5812](#L5812) | $break\_days['thursday'] = $is\_thursday\_break; |
| [5813](#L5813) | $break\_days['friday'] = $is\_friday\_break; |
| [5814](#L5814) | $break\_days['saturday'] = $is\_saturday\_break; |
| [5815](#L5815) | $break\_days['sunday'] = $is\_sunday\_break; |
| [5816](#L5816) |  |
| [5817](#L5817) | // I think we need to consider service time OR staff member time here |
| [5818](#L5818) |  |
| [5819](#L5819) | $break\_days = apply\_filters('bookingpress\_modify\_working\_hours', $break\_days, $bookingpress\_selected\_service,$bookingpress\_selected\_staffmember\_id); |
| [5820](#L5820) |  |
| [5821](#L5821) | $is\_monday\_break             = $break\_days['monday']; |
| [5822](#L5822) | $is\_tuesday\_break            = $break\_days['tuesday']; |
| [5823](#L5823) | $is\_wednesday\_break          = $break\_days['wednesday']; |
| [5824](#L5824) | $is\_thursday\_break           = $break\_days['thursday']; |
| [5825](#L5825) | $is\_friday\_break             = $break\_days['friday']; |
| [5826](#L5826) | $is\_saturday\_break           = $break\_days['saturday']; |
| [5827](#L5827) | $is\_sunday\_break             = $break\_days['sunday']; |
| [5828](#L5828) |  |
| [5829](#L5829) |  |
| [5830](#L5830) |  |
| [5831](#L5831) | $default\_year            = date('Y', current\_time('timestamp')); |
| [5832](#L5832) | $default\_daysoff\_details = array(); |
| [5833](#L5833) |  |
| [5834](#L5834) | $calendar\_start\_date = $calendar\_next\_date = date('Y-m-d', current\_time('timestamp')); |
| [5835](#L5835) | $calendar\_end\_date   = date('Y-m-d', strtotime('+1 year', current\_time('timestamp'))); |
| [5836](#L5836) | for ( $i = 1; $i <= 730; $i++ ) { |
| [5837](#L5837) | $current\_day\_name = date('l', strtotime($calendar\_next\_date)); |
| [5838](#L5838) | if ($current\_day\_name == 'Monday' && $is\_monday\_break == 1 ) { |
| [5839](#L5839) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5840](#L5840) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5841](#L5841) | } elseif ($current\_day\_name == 'Tuesday' && $is\_tuesday\_break == 1 ) { |
| [5842](#L5842) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5843](#L5843) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5844](#L5844) | } elseif ($current\_day\_name == 'Wednesday' && $is\_wednesday\_break == 1 ) { |
| [5845](#L5845) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5846](#L5846) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5847](#L5847) | } elseif ($current\_day\_name == 'Thursday' && $is\_thursday\_break == 1 ) { |
| [5848](#L5848) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5849](#L5849) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5850](#L5850) | } elseif ($current\_day\_name == 'Friday' && $is\_friday\_break == 1 ) { |
| [5851](#L5851) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5852](#L5852) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5853](#L5853) | } elseif ($current\_day\_name == 'Saturday' && $is\_saturday\_break == 1 ) { |
| [5854](#L5854) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5855](#L5855) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5856](#L5856) | } elseif ($current\_day\_name == 'Sunday' && $is\_sunday\_break == 1 ) { |
| [5857](#L5857) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($calendar\_next\_date)); |
| [5858](#L5858) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_tmp\_date))); |
| [5859](#L5859) | } |
| [5860](#L5860) |  |
| [5861](#L5861) | $calendar\_next\_date = date('Y-m-d', strtotime($calendar\_next\_date . ' +1 days')); |
| [5862](#L5862) | } |
| [5863](#L5863) | $bpa\_default\_daysoff = wp\_cache\_get( 'bookingpress\_default\_daysoff' ); |
| [5864](#L5864) | if( false === $bpa\_default\_daysoff ){ |
| [5865](#L5865) | $daysoff\_details = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_default\_daysoff}", ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_daysoff is table name defined globally. False alarm |
| [5866](#L5866) | wp\_cache\_set( 'bookingpress\_default\_daysoff', $daysoff\_details ); |
| [5867](#L5867) | } else { |
| [5868](#L5868) | $daysoff\_details = $bpa\_default\_daysoff; |
| [5869](#L5869) | } |
| [5870](#L5870) | foreach ( $daysoff\_details as $daysoff\_details\_key => $daysoff\_details\_val ) { |
| [5871](#L5871) | $daysoff\_date = esc\_html($daysoff\_details\_val['bookingpress\_dayoff\_date']); |
| [5872](#L5872) |  |
| [5873](#L5873) | $dayoff\_year = date('Y', strtotime($daysoff\_date)); |
| [5874](#L5874) |  |
| [5875](#L5875) | if (empty($daysoff\_details\_val['bookingpress\_repeat']) ) { |
| [5876](#L5876) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_date))); |
| [5877](#L5877) | } elseif (! empty($daysoff\_details\_val['bookingpress\_repeat']) ) { |
| [5878](#L5878) | for ( $i = $default\_year; $i <= 2035; $i++ ) { |
| [5879](#L5879) | $daysoff\_new\_date\_month = $i . '-' . date('m-d', strtotime($daysoff\_date)); |
| [5880](#L5880) | array\_push($default\_daysoff\_details, date('c', strtotime($daysoff\_new\_date\_month))); |
| [5881](#L5881) | } |
| [5882](#L5882) | } |
| [5883](#L5883) | } |
| [5884](#L5884) |  |
| [5885](#L5885) | $default\_daysoff\_details = apply\_filters('bookingpress\_modify\_default\_daysoff\_details', $default\_daysoff\_details, $booking\_date, $booking\_time); |
| [5886](#L5886) |  |
| [5887](#L5887) | return $default\_daysoff\_details; |
| [5888](#L5888) | } |
| [5889](#L5889) |  |
| [5890](#L5890) | /\*\* |
| [5891](#L5891) | \* Check is appointment booked or not |
| [5892](#L5892) | \* |
| [5893](#L5893) | \* @param  mixed $service\_id |
| [5894](#L5894) | \* @param  mixed $booking\_date |
| [5895](#L5895) | \* @param  mixed $booking\_start\_time |
| [5896](#L5896) | \* @param  mixed $booking\_end\_time |
| [5897](#L5897) | \* @param  mixed $appointment\_id |
| [5898](#L5898) | \* @return void |
| [5899](#L5899) | \*/ |
| [5900](#L5900) | public function bookingpress\_is\_appointment\_booked($service\_id, $booking\_date, $booking\_start\_time, $booking\_end\_time,$appointment\_id = 0, $prevent\_double\_booking = false, $appointment\_data = array() ){ |
| [5901](#L5901) | global $wpdb, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_services; |
| [5902](#L5902) |  |
| [5903](#L5903) | $bpa\_external\_validation\_check = apply\_filters( 'bookingpress\_check\_pro\_version\_booked\_appointment', array(), $service\_id, $booking\_date, $booking\_start\_time, $booking\_end\_time, $appointment\_id, $prevent\_double\_booking, $appointment\_data ); |
| [5904](#L5904) |  |
| [5905](#L5905) | if( !empty( $bpa\_external\_validation\_check ) && 1 == $bpa\_external\_validation\_check['prevent\_validation\_process'] ){ |
| [5906](#L5906) | if( true == $prevent\_double\_booking ){ |
| [5907](#L5907) | return $bpa\_external\_validation\_check; |
| [5908](#L5908) | } else { |
| [5909](#L5909) | return $bpa\_external\_validation\_check['response']; |
| [5910](#L5910) | } |
| [5911](#L5911) | } |
| [5912](#L5912) |  |
| [5913](#L5913) | $is\_appointment\_booked = 0; |
| [5914](#L5914) |  |
| [5915](#L5915) | if($booking\_end\_time == "00:00"){ |
| [5916](#L5916) | $booking\_end\_time = "24:00:00"; |
| [5917](#L5917) | } |
| [5918](#L5918) |  |
| [5919](#L5919) | $wpdb\_query\_fun = 'get\_var'; |
| [5920](#L5920) | $wpdb\_query\_col = 'COUNT(bookingpress\_appointment\_booking\_id) AS total'; |
| [5921](#L5921) | if( true == $prevent\_double\_booking ){ |
| [5922](#L5922) | $wpdb\_query\_fun = 'get\_results'; |
| [5923](#L5923) | $wpdb\_query\_col = '\*'; |
| [5924](#L5924) | } |
| [5925](#L5925) |  |
| [5926](#L5926) | //Check shared service timeslot switch enabled or not |
| [5927](#L5927) | $bookingpress\_shared\_service\_timeslot = $this->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [5928](#L5928) |  |
| [5929](#L5929) | if($bookingpress\_shared\_service\_timeslot == 'true'){ |
| [5930](#L5930) |  |
| [5931](#L5931) | $where\_clause = ''; |
| [5932](#L5932) | $where\_clause.= apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$service\_id); |
| [5933](#L5933) |  |
| [5934](#L5934) | if(!empty($appointment\_id)) { |
| [5935](#L5935) | $is\_appointment\_booked = $wpdb->$wpdb\_query\_fun( $wpdb->prepare( "SELECT {$wpdb\_query\_col} FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_date = %s  AND bookingpress\_appointment\_booking\_id != %d AND ( ( bookingpress\_appointment\_time >= %s AND bookingpress\_appointment\_time < %s) OR (bookingpress\_appointment\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) AND ( bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s )  $where\_clause", $booking\_date,$appointment\_id, $booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time, '1', '2' ) ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is table name |
| [5936](#L5936) | } else { |
| [5937](#L5937) | $is\_appointment\_booked = $wpdb->$wpdb\_query\_fun( $wpdb->prepare( "SELECT {$wpdb\_query\_col} FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_date = %s AND ((bookingpress\_appointment\_time >= %s AND bookingpress\_appointment\_time < %s) OR (bookingpress\_appointment\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) AND ( bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s ) $where\_clause", $booking\_date, $booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time, '1', '2' ) ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is table name |
| [5938](#L5938) | } |
| [5939](#L5939) | }else{ |
| [5940](#L5940) | $where\_clause = ''; |
| [5941](#L5941) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_where\_clause', $where\_clause ); |
| [5942](#L5942) |  |
| [5943](#L5943) | $where\_clause .= $wpdb->prepare( ' AND ( bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s )', '1', '2' ); |
| [5944](#L5944) |  |
| [5945](#L5945) | if(!empty($appointment\_id)) { |
| [5946](#L5946) | $is\_appointment\_booked = $wpdb->$wpdb\_query\_fun( $wpdb->prepare( "SELECT {$wpdb\_query\_col} FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_booking\_id != %d AND bookingpress\_service\_id = %d AND ( ( bookingpress\_appointment\_time >= %s AND bookingpress\_appointment\_time < %s) OR (bookingpress\_appointment\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) $where\_clause", $booking\_date,$appointment\_id,$service\_id, $booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time ) ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is table name |
| [5947](#L5947) | } else { |
| [5948](#L5948) | $is\_appointment\_booked = $wpdb->$wpdb\_query\_fun( $wpdb->prepare( "SELECT {$wpdb\_query\_col} FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_date = %s AND bookingpress\_service\_id = %d AND ( ( bookingpress\_appointment\_time >= %s AND bookingpress\_appointment\_time < %s) OR (bookingpress\_appointment\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) $where\_clause", $booking\_date, $service\_id, $booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time ) ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is table name |
| [5949](#L5949) | } |
| [5950](#L5950) | } |
| [5951](#L5951) |  |
| [5952](#L5952) | /\* $bookingpress\_is\_appointment\_cancelled = $this->bookingpress\_is\_appointment\_cancelled\_or\_rejected($service\_id, $booking\_date, $booking\_start\_time, $booking\_end\_time); |
| [5953](#L5953) | if($bookingpress\_is\_appointment\_cancelled){ |
| [5954](#L5954) | $is\_appointment\_booked = 0; |
| [5955](#L5955) | } \*/ |
| [5956](#L5956) |  |
| [5957](#L5957) | return $is\_appointment\_booked; |
| [5958](#L5958) | } |
| [5959](#L5959) |  |
| [5960](#L5960) | /\*\* |
| [5961](#L5961) | \* Check is appointment cancelled or rejected or not |
| [5962](#L5962) | \* |
| [5963](#L5963) | \* @param  mixed $service\_id |
| [5964](#L5964) | \* @param  mixed $booking\_date |
| [5965](#L5965) | \* @param  mixed $booking\_start\_time |
| [5966](#L5966) | \* @param  mixed $booking\_end\_time |
| [5967](#L5967) | \* @return void |
| [5968](#L5968) | \*/ |
| [5969](#L5969) | public function bookingpress\_is\_appointment\_cancelled\_or\_rejected($service\_id, $booking\_date, $booking\_start\_time, $booking\_end\_time){ |
| [5970](#L5970) | global $wpdb, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_services; |
| [5971](#L5971) | $bookingpress\_shared\_service\_timeslot = $this->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [5972](#L5972) |  |
| [5973](#L5973) | $bookingpress\_is\_appointment\_canceled = 0; |
| [5974](#L5974) |  |
| [5975](#L5975) | if($bookingpress\_shared\_service\_timeslot == 'true'){ |
| [5976](#L5976) | $where\_clause = ''; |
| [5977](#L5977) | $where\_clause.= apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$service\_id); |
| [5978](#L5978) |  |
| [5979](#L5979) | $check\_timeslot\_canceled\_data = $wpdb->get\_row($wpdb->prepare("SELECT `bookingpress\_appointment\_booking\_ref` FROM {$tbl\_bookingpress\_payment\_logs} WHERE 1 = 1 $where\_clause AND  bookingpress\_appointment\_date LIKE %s AND ((bookingpress\_appointment\_start\_time >= %s AND bookingpress\_appointment\_start\_time < %s) OR (bookingpress\_appointment\_start\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) ORDER BY bookingpress\_appointment\_booking\_ref DESC", "%{$booking\_date}%", $booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time ),ARRAY\_A);  // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [5980](#L5980) | } else { |
| [5981](#L5981) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [5982](#L5982) | $check\_timeslot\_canceled\_data = $wpdb->get\_row($wpdb->prepare("SELECT `bookingpress\_appointment\_booking\_ref` FROM {$tbl\_bookingpress\_payment\_logs} WHERE bookingpress\_appointment\_date LIKE %s AND bookingpress\_service\_id = %d AND ((bookingpress\_appointment\_start\_time >= %s  AND bookingpress\_appointment\_start\_time < %s) OR (bookingpress\_appointment\_start\_time < %s AND bookingpress\_appointment\_end\_time > %s ) ) ORDER BY bookingpress\_appointment\_booking\_ref DESC", "%{$booking\_date}%",$service\_id,$booking\_start\_time, $booking\_end\_time, $booking\_end\_time, $booking\_start\_time ),ARRAY\_A ); |
| [5983](#L5983) | } |
| [5984](#L5984) |  |
| [5985](#L5985) | if (! empty($check\_timeslot\_canceled\_data) ) { |
| [5986](#L5986) | $appointment\_id                = $check\_timeslot\_canceled\_data['bookingpress\_appointment\_booking\_ref']; |
| [5987](#L5987) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [5988](#L5988) | $bookingpress\_appointment\_data = $wpdb->get\_var($wpdb->prepare("SELECT COUNT(bookingpress\_appointment\_booking\_id) as total FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d AND ( bookingpress\_appointment\_status = '3' OR bookingpress\_appointment\_status = '4')", $appointment\_id)); |
| [5989](#L5989) |  |
| [5990](#L5990) | if ($bookingpress\_appointment\_data > 0 ) { |
| [5991](#L5991) | $bookingpress\_is\_appointment\_canceled = 1; |
| [5992](#L5992) | } |
| [5993](#L5993) | } |
| [5994](#L5994) |  |
| [5995](#L5995) | return $bookingpress\_is\_appointment\_canceled; |
| [5996](#L5996) | } |
| [5997](#L5997) |  |
| [5998](#L5998) | // 04May 2023 Changes |
| [5999](#L5999) | function bookingpress\_convert\_timezone\_to\_offset( $timezone\_string, $bookingpress\_timezone = '' ){ |
| [6000](#L6000) |  |
| [6001](#L6001) | global $bookingpress\_global\_options; |
| [6002](#L6002) |  |
| [6003](#L6003) | $bookingpress\_options = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [6004](#L6004) | $bookingpress\_timezone\_offset = $bookingpress\_options['bookingpress\_timezone\_offset']; |
| [6005](#L6005) |  |
| [6006](#L6006) | $bookingpress\_exceptional\_timezone = ['America/St\_Johns','Australia/Adelaide', 'Australia/Broken\_Hill', 'Pacific/Chatham']; |
| [6007](#L6007) | $bookingpress\_exceptional\_timezone = apply\_filters( 'bookingpress\_exclude\_timezone\_converstion\_to\_offset', $bookingpress\_exceptional\_timezone ); |
| [6008](#L6008) |  |
| [6009](#L6009) | if( in\_array( $timezone\_string, $bookingpress\_exceptional\_timezone ) ){ |
| [6010](#L6010) | return $timezone\_string; |
| [6011](#L6011) | } |
| [6012](#L6012) |  |
| [6013](#L6013) | if( 'UTC' == $timezone\_string){ |
| [6014](#L6014) | return '+00:00'; |
| [6015](#L6015) | } else if( array\_key\_exists( $timezone\_string, $bookingpress\_timezone\_offset ) ){ |
| [6016](#L6016) |  |
| [6017](#L6017) | $wp\_timezone\_data = new DateTimeZone($timezone\_string); |
| [6018](#L6018) | $wp\_timezone\_dtls = $wp\_timezone\_data->getTransitions(); |
| [6019](#L6019) |  |
| [6020](#L6020) | $wp\_timezone\_current = array(); |
| [6021](#L6021) | foreach( $wp\_timezone\_dtls as $k => $wp\_timezone\_detail ){ |
| [6022](#L6022) | if( current\_time( 'timestamp' ) < $wp\_timezone\_detail['ts'] ){ |
| [6023](#L6023) | $wp\_timezone\_current[] = $wp\_timezone\_dtls[ $k - 1 ]; |
| [6024](#L6024) | } |
| [6025](#L6025) | } |
| [6026](#L6026) |  |
| [6027](#L6027) | $wp\_curr\_timezone\_data = !empty( $wp\_timezone\_current[0] ) ? $wp\_timezone\_current[0] : array( 'offset' => '' ); |
| [6028](#L6028) |  |
| [6029](#L6029) | $wp\_offset = ( $wp\_curr\_timezone\_data['offset'] !== "" ) ? ( $wp\_curr\_timezone\_data['offset'] / ( 60 \* 60 ) ) : $bookingpress\_timezone\_offset[ $timezone\_string ]; |
| [6030](#L6030) | if( $wp\_curr\_timezone\_data['offset'] !== '' ){ |
| [6031](#L6031) |  |
| [6032](#L6032) | if( $wp\_offset < 0 ){ |
| [6033](#L6033) | if( $wp\_offset > -10 ){ |
| [6034](#L6034) | $wp\_offset = '-0' . abs( $wp\_offset ) . ":00"; |
| [6035](#L6035) | } else { |
| [6036](#L6036) | $wp\_offset = $wp\_offset . ":00"; |
| [6037](#L6037) | } |
| [6038](#L6038) | } else { |
| [6039](#L6039) | if( $wp\_offset < 10 ){ |
| [6040](#L6040) | $wp\_offset = '+0' . $wp\_offset . ":00"; |
| [6041](#L6041) | } else { |
| [6042](#L6042) | $wp\_offset = "+" . $wp\_offset . ":00"; |
| [6043](#L6043) | } |
| [6044](#L6044) | } |
| [6045](#L6045) | $timezone\_string = $wp\_offset; |
| [6046](#L6046) | } else { |
| [6047](#L6047) | $timezone\_string = $wp\_offset; |
| [6048](#L6048) | } |
| [6049](#L6049) | } |
| [6050](#L6050) |  |
| [6051](#L6051) | return $timezone\_string; |
| [6052](#L6052) | } |
| [6053](#L6053) | // 04May 2023 Changes |
| [6054](#L6054) |  |
| [6055](#L6055) |  |
| [6056](#L6056) | function bookingpress\_calculate\_default\_workhours( $service\_timing\_arr, $workhours\_break\_data ){ |
| [6057](#L6057) |  |
| [6058](#L6058) | $slot\_start\_time = $service\_timing\_arr['store\_start\_time']; |
| [6059](#L6059) | $slot\_end\_time = $service\_timing\_arr['store\_end\_time']; |
| [6060](#L6060) |  |
| [6061](#L6061) | foreach( $workhours\_break\_data as $blocked\_time ){ |
| [6062](#L6062) | $blocked\_start\_time = $blocked\_time['start\_time']; |
| [6063](#L6063) | $blocked\_end\_time = $blocked\_time['end\_time']; |
| [6064](#L6064) |  |
| [6065](#L6065) | if( ( $blocked\_start\_time >= $slot\_start\_time && $blocked\_end\_time <= $slot\_end\_time ) || ( $blocked\_start\_time < $slot\_end\_time && $blocked\_end\_time > $slot\_start\_time) ){ |
| [6066](#L6066) | $service\_timing\_arr['is\_blocked'] = true; |
| [6067](#L6067) | $service\_timing\_arr['break\_time\_start'] = $blocked\_start\_time; |
| [6068](#L6068) | $service\_timing\_arr['break\_end\_time'] = $blocked\_end\_time; |
| [6069](#L6069) | } |
| [6070](#L6070) |  |
| [6071](#L6071) | } |
| [6072](#L6072) |  |
| [6073](#L6073) | return $service\_timing\_arr; |
| [6074](#L6074) |  |
| [6075](#L6075) | } |
| [6076](#L6076) |  |
| [6077](#L6077) | function bookingpress\_check\_for\_the\_holidays( $selected\_date = '', $selected\_service\_id = '', $type = 'company' ){ |
| [6078](#L6078) | global $tbl\_bookingpress\_default\_daysoff, $wpdb; |
| [6079](#L6079) |  |
| [6080](#L6080) | $is\_holiday = false; |
| [6081](#L6081) |  |
| [6082](#L6082) | if( empty( $selected\_date ) ){ |
| [6083](#L6083) | return $is\_holiday; |
| [6084](#L6084) | } |
| [6085](#L6085) |  |
| [6086](#L6086) | if( 'company' == $type || empty( $type ) ){ |
| [6087](#L6087) | /\*\* Check if selected days is in holiday \*/ |
| [6088](#L6088) | $bpa\_default\_daysoff\_where = $wpdb->prepare( 'WHERE (bookingpress\_dayoff\_date >= %s OR bookingpress\_repeat = %d)', $selected\_date .' 00:00:00',1); |
| [6089](#L6089) | $daysoff\_details = $wpdb->get\_results("SELECT bookingpress\_dayoff\_date,bookingpress\_repeat FROM {$tbl\_bookingpress\_default\_daysoff} {$bpa\_default\_daysoff\_where}");// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_daysoff is table name defined globally. False alarm |
| [6090](#L6090) |  |
| [6091](#L6091) | $is\_holiday = false; |
| [6092](#L6092) | if( !empty( $daysoff\_details ) ){ |
| [6093](#L6093) | foreach( $daysoff\_details as $daysoff\_data ){ |
| [6094](#L6094) | if( $daysoff\_data->bookingpress\_dayoff\_date == $selected\_date .' 00:00:00' ){ |
| [6095](#L6095) | $service\_timings\_data['is\_daysoff'] = true; |
| [6096](#L6096) | $is\_holiday = true; |
| [6097](#L6097) | } else if( $daysoff\_data->bookingpress\_repeat == 1 ){ |
| [6098](#L6098) | $current\_date\_without\_year = date('m-d', strtotime( $selected\_date ) ); |
| [6099](#L6099) | $holiday\_date\_without\_year = date('m-d', strtotime( $daysoff\_data->bookingpress\_dayoff\_date ) ); |
| [6100](#L6100) | if( $holiday\_date\_without\_year == $current\_date\_without\_year ){ |
| [6101](#L6101) | $service\_timings\_data['is\_daysoff'] = true; |
| [6102](#L6102) | $is\_holiday = true; |
| [6103](#L6103) | } |
| [6104](#L6104) | } |
| [6105](#L6105) | } |
| [6106](#L6106) | } |
| [6107](#L6107) | } |
| [6108](#L6108) |  |
| [6109](#L6109) | $is\_holiday = apply\_filters( 'bookingpress\_check\_advance\_repeated\_default\_holidays\_'. $type, $is\_holiday, $selected\_date, $selected\_service\_id ); |
| [6110](#L6110) |  |
| [6111](#L6111) | return $is\_holiday; |
| [6112](#L6112) |  |
| [6113](#L6113) | } |
| [6114](#L6114) |  |
| [6115](#L6115) | function bookinpgress\_retrieve\_default\_workhours( $selected\_service\_id, $selected\_date, $minimum\_time\_required, $service\_max\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration ){ |
| [6116](#L6116) |  |
| [6117](#L6117) | $service\_timings = array(); |
| [6118](#L6118) |  |
| [6119](#L6119) | global $wpdb, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_default\_daysoff; |
| [6120](#L6120) |  |
| [6121](#L6121) | $current\_day  = ! empty( $selected\_date ) ? strtolower( date( 'l', strtotime( $selected\_date ) ) ) : strtolower( date( 'l', current\_time( 'timestamp' ) ) ); |
| [6122](#L6122) | $current\_date = ! empty($selected\_date) ? date('Y-m-d', strtotime($selected\_date)) : date('Y-m-d', current\_time('timestamp')); |
| [6123](#L6123) |  |
| [6124](#L6124) | $bpa\_current\_date = date('Y-m-d', current\_time('timestamp')); |
| [6125](#L6125) | $bpa\_current\_time = date( 'H:i', current\_time('timestamp') ); |
| [6126](#L6126) |  |
| [6127](#L6127) | $service\_time\_duration     = $this->bookingpress\_get\_default\_timeslot\_data(); |
| [6128](#L6128) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration['default\_timeslot']; |
| [6129](#L6129) |  |
| [6130](#L6130) | $bookingpress\_current\_time\_timestamp = current\_time('timestamp'); |
| [6131](#L6131) | $service\_time\_duration\_unit = $service\_time\_duration['time\_unit']; |
| [6132](#L6132) |  |
| [6133](#L6133) | if (! empty($selected\_service\_id) ) { |
| [6134](#L6134) | $service\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $selected\_service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason $tbl\_bookingpress\_services is a table name |
| [6135](#L6135) | if (! empty($service\_data) ) { |
| [6136](#L6136) | $service\_time\_duration      = esc\_html($service\_data['bookingpress\_service\_duration\_val']); |
| [6137](#L6137) | $service\_time\_duration\_unit = esc\_html($service\_data['bookingpress\_service\_duration\_unit']); |
| [6138](#L6138) | if ($service\_time\_duration\_unit == 'h' ) { |
| [6139](#L6139) | $service\_time\_duration = $service\_time\_duration \* 60; |
| [6140](#L6140) | } elseif($service\_time\_duration\_unit == 'd') { |
| [6141](#L6141) | $service\_time\_duration = $service\_time\_duration \* 24 \* 60; |
| [6142](#L6142) | } |
| [6143](#L6143) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration; |
| [6144](#L6144) | } |
| [6145](#L6145) | } |
| [6146](#L6146) |  |
| [6147](#L6147) | $bpa\_fetch\_updated\_slots = false; |
| [6148](#L6148) | if( isset( $\_POST['bpa\_fetch\_data'] ) && 'true' == sanitize\_text\_field($\_POST['bpa\_fetch\_data'] )){  // phpcs:ignore |
| [6149](#L6149) | $bpa\_fetch\_updated\_slots = true; |
| [6150](#L6150) | } |
| [6151](#L6151) |  |
| [6152](#L6152) | $service\_step\_duration\_val = apply\_filters( 'bookingpress\_modify\_service\_timeslot', $service\_step\_duration\_val, $selected\_service\_id, $service\_time\_duration\_unit, $bpa\_fetch\_updated\_slots ); |
| [6153](#L6153) |  |
| [6154](#L6154) | $bookingpress\_show\_time\_as\_per\_service\_duration = $this->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [6155](#L6155) | if ( ! empty( $bookingpress\_show\_time\_as\_per\_service\_duration ) && $bookingpress\_show\_time\_as\_per\_service\_duration == 'false' ) { |
| [6156](#L6156) | $bookingpress\_default\_time\_slot = $this->bookingpress\_get\_settings( 'default\_time\_slot', 'general\_setting' ); |
| [6157](#L6157) | $default\_timeslot\_step      = $bookingpress\_default\_time\_slot; |
| [6158](#L6158) | } else { |
| [6159](#L6159) | $default\_timeslot\_step = $service\_step\_duration\_val; |
| [6160](#L6160) | } |
| [6161](#L6161) |  |
| [6162](#L6162) | $get\_default\_work\_hours\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 0 AND bookingpress\_start\_time IS NOT NULL", $current\_day), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6163](#L6163) |  |
| [6164](#L6164) | $workhour\_data = array(); |
| [6165](#L6165) | $workhours\_break\_data = array(); |
| [6166](#L6166) |  |
| [6167](#L6167) | $is\_holiday = $this->bookingpress\_check\_for\_the\_holidays( $selected\_date, $selected\_service\_id ); |
| [6168](#L6168) |  |
| [6169](#L6169) | if( true == $is\_holiday ){ |
| [6170](#L6170) | return $service\_timings; |
| [6171](#L6171) | } |
| [6172](#L6172) |  |
| [6173](#L6173) | $get\_default\_work\_hous\_break\_data = $wpdb->get\_results($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 1 AND bookingpress\_start\_time IS NOT NULL", $current\_day), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6174](#L6174) |  |
| [6175](#L6175) | if( !empty( $get\_default\_work\_hous\_break\_data )  ){ |
| [6176](#L6176) | foreach( $get\_default\_work\_hous\_break\_data as $default\_workhour\_data ){ |
| [6177](#L6177) | $break\_data = array( |
| [6178](#L6178) | 'break\_start\_time' => date( 'H:i', strtotime( $default\_workhour\_data['bookingpress\_start\_time'] ) ), |
| [6179](#L6179) | 'break\_end\_time' => date('H:i', strtotime( $default\_workhour\_data['bookingpress\_end\_time'] ) ) |
| [6180](#L6180) | ); |
| [6181](#L6181) | $workhours\_break\_data[]  = $break\_data; |
| [6182](#L6182) | } |
| [6183](#L6183) | } |
| [6184](#L6184) |  |
| [6185](#L6185) |  |
| [6186](#L6186) | if( !empty( $get\_default\_work\_hours\_data ) ){ |
| [6187](#L6187) | $service\_current\_time = $service\_start\_time = apply\_filters( 'bookingpress\_modify\_service\_start\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_start\_time'])), $selected\_service\_id ); |
| [6188](#L6188) | $service\_end\_time     = apply\_filters( 'bookingpress\_modify\_service\_end\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_end\_time'])), $selected\_service\_id ); |
| [6189](#L6189) |  |
| [6190](#L6190) | if($service\_end\_time == "00:00"){ |
| [6191](#L6191) | $service\_end\_time = "24:00"; |
| [6192](#L6192) | } |
| [6193](#L6193) |  |
| [6194](#L6194) | if ($service\_start\_time != null && $service\_end\_time != null ) { |
| [6195](#L6195) | $interval = new DateInterval( 'PT'. $default\_timeslot\_step .'M' ); |
| [6196](#L6196) | $startDateTime = new DateTime( $selected\_date .' '.$service\_start\_time, new DateTimeZone( wp\_timezone\_string() ) ); |
| [6197](#L6197) | $endDateTime = new DateTime( $selected\_date .' '.$service\_end\_time, new DateTimeZone( wp\_timezone\_string() ) ); |
| [6198](#L6198) |  |
| [6199](#L6199) | $tc = 0; |
| [6200](#L6200) | while( $startDateTime <= $endDateTime ){ |
| [6201](#L6201) |  |
| [6202](#L6202) | $slotStart = $startDateTime; |
| [6203](#L6203) | $slotEnd = clone $slotStart; |
| [6204](#L6204) | $slotEnd->add( new DateInterval( 'PT'.$service\_step\_duration\_val . 'M' ) ); |
| [6205](#L6205) |  |
| [6206](#L6206) | $service\_tmp\_current\_time = $service\_current\_time = $slotStart->format('H:i'); |
| [6207](#L6207) |  |
| [6208](#L6208) | if ($service\_current\_time == '00:00' ) { |
| [6209](#L6209) | $service\_current\_time = date('H:i', strtotime($service\_current\_time) + ( $service\_step\_duration\_val \* 60 )); |
| [6210](#L6210) | } else { |
| [6211](#L6211) | $service\_tmp\_time\_obj = new DateTime($selected\_date.' '.$service\_current\_time); |
| [6212](#L6212) | $service\_tmp\_time\_obj->add(new DateInterval('PT' . $service\_step\_duration\_val . 'M')); |
| [6213](#L6213) |  |
| [6214](#L6214) | $service\_current\_time = $service\_tmp\_time\_obj->format('H:i'); |
| [6215](#L6215) | $service\_current\_date = $service\_tmp\_time\_obj->format('Y-m-d'); |
| [6216](#L6216) | if( $service\_current\_date > $selected\_date ){ |
| [6217](#L6217) | if( $service\_end\_time == '24:00' && strtotime($service\_current\_date.' '.$service\_current\_time) > strtotime( $service\_current\_date . ' 00:00' ) ){ |
| [6218](#L6218) | break; |
| [6219](#L6219) | } |
| [6220](#L6220) | } |
| [6221](#L6221) | } |
| [6222](#L6222) |  |
| [6223](#L6223) | if ($service\_current\_time < $service\_start\_time || $service\_current\_time == $service\_start\_time ) { |
| [6224](#L6224) | $service\_current\_time = $service\_end\_time; |
| [6225](#L6225) | } |
| [6226](#L6226) |  |
| [6227](#L6227) | $bookingpress\_timediff\_in\_minutes = round(abs(strtotime($service\_current\_time) - strtotime($service\_tmp\_current\_time)) / 60, 2); |
| [6228](#L6228) | $is\_booked\_for\_minimum = false; |
| [6229](#L6229) |  |
| [6230](#L6230) | if( 'disabled' != $minimum\_time\_required ){ |
| [6231](#L6231) | $bookingpress\_slot\_start\_datetime       = $selected\_date . ' ' . $service\_tmp\_current\_time . ':00'; |
| [6232](#L6232) | $bookingpress\_slot\_start\_time\_timestamp = strtotime( $bookingpress\_slot\_start\_datetime ); |
| [6233](#L6233) | $bookingpress\_time\_diff = round( abs( current\_time('timestamp') - $bookingpress\_slot\_start\_time\_timestamp ) / 60, 2 ); |
| [6234](#L6234) |  |
| [6235](#L6235) | if( $bookingpress\_time\_diff <= $minimum\_time\_required ){ |
| [6236](#L6236) | $is\_booked\_for\_minimum = true; |
| [6237](#L6237) | } |
| [6238](#L6238) | } |
| [6239](#L6239) |  |
| [6240](#L6240) |  |
| [6241](#L6241) | if( ($bookingpress\_timediff\_in\_minutes >= $service\_step\_duration\_val) && $service\_current\_time <= $service\_end\_time && $slotEnd <= $endDateTime ){ |
| [6242](#L6242) | if( strtotime( $selected\_date .' ' . $service\_tmp\_current\_time ) > current\_time( 'timestamp' ) && !$is\_booked\_for\_minimum ){ |
| [6243](#L6243) | $is\_break = false; |
| [6244](#L6244) | if( !empty( $workhours\_break\_data ) ){ |
| [6245](#L6245) | foreach( $workhours\_break\_data as $break\_hour\_data ){ |
| [6246](#L6246) | $break\_start\_time = new DateTime( $selected\_date .' '. $break\_hour\_data['break\_start\_time'], new DateTimeZone( wp\_timezone\_string() ) ); |
| [6247](#L6247) | $break\_end\_time = new DateTime( $selected\_date .' '. $break\_hour\_data['break\_end\_time'], new DateTimeZone( wp\_timezone\_string() ) ); |
| [6248](#L6248) |  |
| [6249](#L6249) | if( ($break\_start\_time >= $slotStart && $break\_end\_time <= $slotEnd ) || ( $break\_start\_time < $slotEnd && $break\_end\_time > $slotStart ) ){ |
| [6250](#L6250) | $is\_break = true; |
| [6251](#L6251) | break; |
| [6252](#L6252) | } |
| [6253](#L6253) | } |
| [6254](#L6254) | } |
| [6255](#L6255) |  |
| [6256](#L6256) | if( true == $is\_break ){ |
| [6257](#L6257) | $startDateTime = $break\_end\_time; |
| [6258](#L6258) | continue; |
| [6259](#L6259) | } |
| [6260](#L6260) |  |
| [6261](#L6261) | $service\_timing\_arr = array( |
| [6262](#L6262) | 'start\_time' => $service\_tmp\_current\_time, |
| [6263](#L6263) | 'end\_time'   => $service\_current\_time, |
| [6264](#L6264) | 'store\_start\_time' => $service\_tmp\_current\_time, |
| [6265](#L6265) | 'store\_end\_time'   => $service\_current\_time, |
| [6266](#L6266) | 'break\_start\_time' => !empty( $break\_start\_time ) ? $break\_start\_time->format('H:i:s') : '', |
| [6267](#L6267) | 'break\_end\_time' => !empty( $break\_end\_time ) ? $break\_end\_time->format('H:i:s') : '', |
| [6268](#L6268) | 'store\_service\_date' => $selected\_date, |
| [6269](#L6269) | 'is\_next\_day' => false, |
| [6270](#L6270) | 'is\_booked'  => 0, |
| [6271](#L6271) | 'max\_capacity' => $service\_max\_capacity, |
| [6272](#L6272) | 'counter\_pos' => $tc, |
| [6273](#L6273) | 'total\_booked' => 0 |
| [6274](#L6274) | ); |
| [6275](#L6275) | $workhour\_data[] = $service\_timing\_arr; |
| [6276](#L6276) | } |
| [6277](#L6277) | } |
| [6278](#L6278) |  |
| [6279](#L6279) | $startDateTime->add( $interval ); |
| [6280](#L6280) | $tc++; |
| [6281](#L6281) | } |
| [6282](#L6282) | $service\_timings = $workhour\_data; |
| [6283](#L6283) | } |
| [6284](#L6284) | } |
| [6285](#L6285) |  |
| [6286](#L6286) | return $service\_timings; |
| [6287](#L6287) |  |
| [6288](#L6288) | } |
| [6289](#L6289) |  |
| [6290](#L6290) | /\*\* |
| [6291](#L6291) | \* Core function to get default workhours |
| [6292](#L6292) | \* |
| [6293](#L6293) | \* @param  mixed $selected\_service\_id |
| [6294](#L6294) | \* @param  mixed $selected\_date |
| [6295](#L6295) | \* @param  mixed $minimum\_time\_required |
| [6296](#L6296) | \* @param  mixed $service\_max\_capacity |
| [6297](#L6297) | \* @param  mixed $bookingpress\_show\_time\_as\_per\_service\_duration |
| [6298](#L6298) | \* @return void |
| [6299](#L6299) | \*/ |
| [6300](#L6300) | public function bookinpgress\_retrieve\_default\_workhours\_legacy( $selected\_service\_id, $selected\_date, $minimum\_time\_required, $service\_max\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration ){ |
| [6301](#L6301) | // phpcs:ignore WordPress.Security.NonceVerification |
| [6302](#L6302) | $service\_timings = array(); |
| [6303](#L6303) |  |
| [6304](#L6304) | global $wpdb, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_default\_daysoff; |
| [6305](#L6305) |  |
| [6306](#L6306) | $bookingpress\_hide\_already\_booked\_slot = $this->bookingpress\_get\_customize\_settings( 'hide\_already\_booked\_slot', 'booking\_form' ); |
| [6307](#L6307) | $bookingpress\_hide\_already\_booked\_slot = ( $bookingpress\_hide\_already\_booked\_slot == 'true' ) ? 1 : 0; |
| [6308](#L6308) |  |
| [6309](#L6309) | $bookingpress\_timezone = isset($\_POST['client\_timezone\_offset']) ? sanitize\_text\_field( $\_POST['client\_timezone\_offset'] ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [6310](#L6310) |  |
| [6311](#L6311) | $current\_day  = ! empty( $selected\_date ) ? strtolower( date( 'l', strtotime( $selected\_date ) ) ) : strtolower( date( 'l', current\_time( 'timestamp' ) ) ); |
| [6312](#L6312) | $current\_date = ! empty($selected\_date) ? date('Y-m-d', strtotime($selected\_date)) : date('Y-m-d', current\_time('timestamp')); |
| [6313](#L6313) |  |
| [6314](#L6314) | $bpa\_current\_date = date('Y-m-d', current\_time('timestamp')); |
| [6315](#L6315) |  |
| [6316](#L6316) | $bookingpress\_timeslot\_display\_in\_client\_timezone = $this->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
| [6317](#L6317) | $display\_slots\_in\_client\_timezone = false; |
| [6318](#L6318) |  |
| [6319](#L6319) | // 04May 2023 Changes |
| [6320](#L6320) | $client\_timezone\_string = !empty( $\_COOKIE['bookingpress\_client\_timezone'] ) ? sanitize\_text\_field($\_COOKIE['bookingpress\_client\_timezone']) : ''; |
| [6321](#L6321) | if( 'true' == $bookingpress\_timeslot\_display\_in\_client\_timezone && !empty( $client\_timezone\_string ) ){ |
| [6322](#L6322) | $client\_timezone\_offset = $this->bookingpress\_convert\_timezone\_to\_offset( $client\_timezone\_string, $bookingpress\_timezone ); |
| [6323](#L6323) | $wordpress\_timezone\_offset = $this->bookingpress\_convert\_timezone\_to\_offset( wp\_timezone\_string() ); |
| [6324](#L6324) | if( $client\_timezone\_offset  == $wordpress\_timezone\_offset ){ |
| [6325](#L6325) | $bookingpress\_timeslot\_display\_in\_client\_timezone = 'false'; |
| [6326](#L6326) | } |
| [6327](#L6327) | } |
| [6328](#L6328) | // 04May 2023 Changes |
| [6329](#L6329) |  |
| [6330](#L6330) | if( isset($bookingpress\_timezone) && '' !== $bookingpress\_timezone && !empty($bookingpress\_timeslot\_display\_in\_client\_timezone) && ($bookingpress\_timeslot\_display\_in\_client\_timezone == 'true') ){ |
| [6331](#L6331) | $display\_slots\_in\_client\_timezone = true; |
| [6332](#L6332) | } |
| [6333](#L6333) |  |
| [6334](#L6334) | if( strtotime( $bpa\_current\_date ) > strtotime( $selected\_date ) && false == $display\_slots\_in\_client\_timezone ){ |
| [6335](#L6335) | return $service\_timings; |
| [6336](#L6336) | } |
| [6337](#L6337) |  |
| [6338](#L6338) | $change\_store\_date = ( !empty( $\_POST['bpa\_change\_store\_date'] ) && 'true' == sanitize\_text\_field( $\_POST['bpa\_change\_store\_date'] ) ) ? true : false; //phpcs:ignore |
| [6339](#L6339) |  |
| [6340](#L6340) | $bpa\_current\_time = date('H:i', current\_time('timestamp')); |
| [6341](#L6341) | $service\_time\_duration     = $this->bookingpress\_get\_default\_timeslot\_data(); |
| [6342](#L6342) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration['default\_timeslot']; |
| [6343](#L6343) |  |
| [6344](#L6344) |  |
| [6345](#L6345) | $bookingpress\_current\_time\_timestamp = current\_time('timestamp'); |
| [6346](#L6346) | $service\_time\_duration\_unit = $service\_time\_duration['time\_unit']; |
| [6347](#L6347) |  |
| [6348](#L6348) |  |
| [6349](#L6349) | if (! empty($selected\_service\_id) ) { |
| [6350](#L6350) | $service\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $selected\_service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason $tbl\_bookingpress\_services is a table name |
| [6351](#L6351) | if (! empty($service\_data) ) { |
| [6352](#L6352) | $service\_time\_duration      = esc\_html($service\_data['bookingpress\_service\_duration\_val']); |
| [6353](#L6353) | $service\_time\_duration\_unit = esc\_html($service\_data['bookingpress\_service\_duration\_unit']); |
| [6354](#L6354) | if ($service\_time\_duration\_unit == 'h' ) { |
| [6355](#L6355) | $service\_time\_duration = $service\_time\_duration \* 60; |
| [6356](#L6356) | } elseif($service\_time\_duration\_unit == 'd') { |
| [6357](#L6357) | $service\_time\_duration = $service\_time\_duration \* 24 \* 60; |
| [6358](#L6358) | } |
| [6359](#L6359) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration; |
| [6360](#L6360) | } |
| [6361](#L6361) | } |
| [6362](#L6362) |  |
| [6363](#L6363) |  |
| [6364](#L6364) | $bpa\_fetch\_updated\_slots = false; |
| [6365](#L6365) | if( isset( $\_POST['bpa\_fetch\_data'] ) && 'true' == sanitize\_text\_field($\_POST['bpa\_fetch\_data'] )){  // phpcs:ignore |
| [6366](#L6366) | $bpa\_fetch\_updated\_slots = true; |
| [6367](#L6367) | } |
| [6368](#L6368) |  |
| [6369](#L6369) | $service\_step\_duration\_val = apply\_filters( 'bookingpress\_modify\_service\_timeslot', $service\_step\_duration\_val, $selected\_service\_id, $service\_time\_duration\_unit, $bpa\_fetch\_updated\_slots ); |
| [6370](#L6370) |  |
| [6371](#L6371) | $bookingpress\_show\_time\_as\_per\_service\_duration = $this->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [6372](#L6372) | if ( ! empty( $bookingpress\_show\_time\_as\_per\_service\_duration ) && $bookingpress\_show\_time\_as\_per\_service\_duration == 'false' ) { |
| [6373](#L6373) | $bookingpress\_default\_time\_slot = $this->bookingpress\_get\_settings( 'default\_time\_slot', 'general\_setting' ); |
| [6374](#L6374) | $default\_timeslot\_step      = $bookingpress\_default\_time\_slot; |
| [6375](#L6375) | } else { |
| [6376](#L6376) | $default\_timeslot\_step = $service\_step\_duration\_val; |
| [6377](#L6377) | } |
| [6378](#L6378) |  |
| [6379](#L6379) | $get\_default\_work\_hours\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 0 AND bookingpress\_start\_time IS NOT NULL", $current\_day), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6380](#L6380) |  |
| [6381](#L6381) | $workhour\_data = array(); |
| [6382](#L6382) | $workhours\_break\_data = array(); |
| [6383](#L6383) |  |
| [6384](#L6384) | /\*\* Check if selected days is in holiday \*/ |
| [6385](#L6385) | $bpa\_default\_daysoff\_where = $wpdb->prepare( 'WHERE (bookingpress\_dayoff\_date >= %s OR bookingpress\_repeat = %d)', $selected\_date .' 00:00:00',1); |
| [6386](#L6386) | $daysoff\_details = $wpdb->get\_results("SELECT bookingpress\_dayoff\_date,bookingpress\_repeat FROM {$tbl\_bookingpress\_default\_daysoff} {$bpa\_default\_daysoff\_where}");// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_daysoff is table name defined globally. False alarm |
| [6387](#L6387) |  |
| [6388](#L6388) | $is\_holiday = false; |
| [6389](#L6389) | if( !empty( $daysoff\_details ) ){ |
| [6390](#L6390) | foreach( $daysoff\_details as $daysoff\_data ){ |
| [6391](#L6391) | if( $daysoff\_data->bookingpress\_dayoff\_date == $selected\_date .' 00:00:00' ){ |
| [6392](#L6392) | $service\_timings\_data['is\_daysoff'] = true; |
| [6393](#L6393) | $is\_holiday = true; |
| [6394](#L6394) | } else if( $daysoff\_data->bookingpress\_repeat == 1 ){ |
| [6395](#L6395) | $current\_date\_without\_year = date('m-d', strtotime( $selected\_date ) ); |
| [6396](#L6396) | $holiday\_date\_without\_year = date('m-d', strtotime( $daysoff\_data->bookingpress\_dayoff\_date ) ); |
| [6397](#L6397) | if( $holiday\_date\_without\_year == $current\_date\_without\_year ){ |
| [6398](#L6398) | $service\_timings\_data['is\_daysoff'] = true; |
| [6399](#L6399) | $is\_holiday = true; |
| [6400](#L6400) | } |
| [6401](#L6401) | } |
| [6402](#L6402) | } |
| [6403](#L6403) | } |
| [6404](#L6404) |  |
| [6405](#L6405) | $is\_holiday = apply\_filters( 'bookingpress\_check\_advance\_repeated\_default\_holidays', $is\_holiday, $selected\_date ); |
| [6406](#L6406) |  |
| [6407](#L6407) | if( $is\_holiday ){ |
| [6408](#L6408) | return $service\_timings\_data; |
| [6409](#L6409) | } |
| [6410](#L6410) |  |
| [6411](#L6411) | $get\_default\_work\_hous\_break\_data = $wpdb->get\_results($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 1 AND bookingpress\_start\_time IS NOT NULL", $current\_day), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6412](#L6412) |  |
| [6413](#L6413) | if( !empty( $get\_default\_work\_hous\_break\_data )  ){ |
| [6414](#L6414) | foreach( $get\_default\_work\_hous\_break\_data as $default\_workhour\_data ){ |
| [6415](#L6415) | $break\_data = array( |
| [6416](#L6416) | 'start\_time' => date( 'H:i', strtotime( $default\_workhour\_data['bookingpress\_start\_time'] ) ), |
| [6417](#L6417) | 'end\_time' => date('H:i', strtotime( $default\_workhour\_data['bookingpress\_end\_time'] ) ) |
| [6418](#L6418) | ); |
| [6419](#L6419) |  |
| [6420](#L6420) | $workhours\_break\_data[]  = $break\_data; |
| [6421](#L6421) | } |
| [6422](#L6422) | } |
| [6423](#L6423) |  |
| [6424](#L6424) | if( !empty( $get\_default\_work\_hours\_data ) ){ |
| [6425](#L6425) | $service\_current\_time = $service\_start\_time = apply\_filters( 'bookingpress\_modify\_service\_start\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_start\_time'])), $selected\_service\_id ); |
| [6426](#L6426) | $service\_end\_time     = apply\_filters( 'bookingpress\_modify\_service\_end\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_end\_time'])), $selected\_service\_id ); |
| [6427](#L6427) |  |
| [6428](#L6428) | if($service\_end\_time == "00:00"){ |
| [6429](#L6429) | $service\_end\_time = "24:00"; |
| [6430](#L6430) | } |
| [6431](#L6431) |  |
| [6432](#L6432) | if ($service\_start\_time != null && $service\_end\_time != null ) { |
| [6433](#L6433) |  |
| [6434](#L6434) | while ( $service\_current\_time <= $service\_end\_time ) { |
| [6435](#L6435) | if ($service\_current\_time > $service\_end\_time ) { |
| [6436](#L6436) | break; |
| [6437](#L6437) | } |
| [6438](#L6438) |  |
| [6439](#L6439) | $service\_tmp\_date\_time = $selected\_date .' '.$service\_current\_time; |
| [6440](#L6440) |  |
| [6441](#L6441) | $service\_tmp\_end\_time = date( 'Y-m-d', ( strtotime($selected\_date. ' ' . $service\_current\_time ) + ( $service\_step\_duration\_val \* 60 ) ) ); |
| [6442](#L6442) |  |
| [6443](#L6443) | if( $service\_tmp\_end\_time > $selected\_date ){ |
| [6444](#L6444) | if( $service\_step\_duration\_val > 1440 && $service\_time\_duration\_unit != 'd' ){ |
| [6445](#L6445) | break; |
| [6446](#L6446) | } |
| [6447](#L6447) | } |
| [6448](#L6448) |  |
| [6449](#L6449) | $service\_tmp\_current\_time = $service\_current\_time; |
| [6450](#L6450) | if ($service\_current\_time == '00:00' ) { |
| [6451](#L6451) | $service\_current\_time = date('H:i', strtotime($service\_current\_time) + ( $service\_step\_duration\_val \* 60 )); |
| [6452](#L6452) | } else { |
| [6453](#L6453) | $service\_tmp\_time\_obj = new DateTime($selected\_date.' '.$service\_current\_time); |
| [6454](#L6454) | $service\_tmp\_time\_obj->add(new DateInterval('PT' . $service\_step\_duration\_val . 'M')); |
| [6455](#L6455) |  |
| [6456](#L6456) | $service\_current\_time = $service\_tmp\_time\_obj->format('H:i'); |
| [6457](#L6457) | $service\_current\_date = $service\_tmp\_time\_obj->format('Y-m-d'); |
| [6458](#L6458) | if( $service\_current\_date > $selected\_date ){ |
| [6459](#L6459) | if( $service\_end\_time == '24:00' && strtotime($service\_current\_date.' '.$service\_current\_time) > strtotime( $service\_current\_date . ' 00:00' ) ){ |
| [6460](#L6460) | break; |
| [6461](#L6461) | } |
| [6462](#L6462) | } |
| [6463](#L6463) |  |
| [6464](#L6464) | } |
| [6465](#L6465) |  |
| [6466](#L6466) | $break\_start\_time      = ''; |
| [6467](#L6467) | $break\_end\_time        = ''; |
| [6468](#L6468) |  |
| [6469](#L6469) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6470](#L6470) |  |
| [6471](#L6471) | $is\_appointment\_booked = 0; |
| [6472](#L6472) | if ($service\_current\_time < $service\_start\_time || $service\_current\_time == $service\_start\_time ) { |
| [6473](#L6473) | $service\_current\_time = $service\_end\_time; |
| [6474](#L6474) | } |
| [6475](#L6475) |  |
| [6476](#L6476) | $bookingpress\_timediff\_in\_minutes = round(abs(strtotime($service\_current\_time) - strtotime($service\_tmp\_current\_time)) / 60, 2); |
| [6477](#L6477) | $is\_booked\_for\_minimum = false; |
| [6478](#L6478) |  |
| [6479](#L6479) | if( 'disabled' != $minimum\_time\_required ){ |
| [6480](#L6480) | $bookingpress\_slot\_start\_datetime       = $selected\_date . ' ' . $service\_tmp\_current\_time . ':00'; |
| [6481](#L6481) | $bookingpress\_slot\_start\_time\_timestamp = strtotime( $bookingpress\_slot\_start\_datetime ); |
| [6482](#L6482) | $bookingpress\_time\_diff = round( abs( current\_time('timestamp') - $bookingpress\_slot\_start\_time\_timestamp ) / 60, 2 ); |
| [6483](#L6483) |  |
| [6484](#L6484) | if( $bookingpress\_time\_diff <= $minimum\_time\_required ){ |
| [6485](#L6485) | $is\_booked\_for\_minimum = true; |
| [6486](#L6486) | } |
| [6487](#L6487) | } |
| [6488](#L6488) |  |
| [6489](#L6489) | if ($break\_start\_time != $service\_tmp\_current\_time && ($bookingpress\_timediff\_in\_minutes >= $service\_step\_duration\_val) && $service\_current\_time <= $service\_end\_time ) { |
| [6490](#L6490) | if ($bpa\_current\_date == $current\_date ) { |
| [6491](#L6491) | if ($service\_tmp\_current\_time > $bpa\_current\_time && !$is\_booked\_for\_minimum ) { |
| [6492](#L6492) | $service\_timing\_arr = array( |
| [6493](#L6493) | 'start\_time' => $service\_tmp\_current\_time, |
| [6494](#L6494) | 'end\_time'   => $service\_current\_time, |
| [6495](#L6495) | 'store\_start\_time' => $service\_tmp\_current\_time, |
| [6496](#L6496) | 'store\_end\_time'   => $service\_current\_time, |
| [6497](#L6497) | 'break\_start\_time' => $break\_start\_time, |
| [6498](#L6498) | 'break\_end\_time' => $break\_end\_time, |
| [6499](#L6499) | 'store\_service\_date' => $selected\_date, |
| [6500](#L6500) | 'is\_booked'  => 0, |
| [6501](#L6501) | 'max\_capacity' => $service\_max\_capacity, |
| [6502](#L6502) | 'total\_booked' => 0 |
| [6503](#L6503) | ); |
| [6504](#L6504) |  |
| [6505](#L6505) | if( !empty( $workhours\_break\_data ) ){ |
| [6506](#L6506) | $service\_timing\_arr = apply\_filters( 'bpa\_calculate\_default\_break\_hours', $service\_timing\_arr, $workhours\_break\_data ); |
| [6507](#L6507) | } |
| [6508](#L6508) |  |
| [6509](#L6509) | if( !empty( $service\_timing\_arr['is\_blocked'] ) && true == $service\_timing\_arr['is\_blocked'] ){ |
| [6510](#L6510) | $service\_current\_time = $service\_timing\_arr['break\_end\_time']; |
| [6511](#L6511) | continue; |
| [6512](#L6512) | } |
| [6513](#L6513) |  |
| [6514](#L6514) | if( $display\_slots\_in\_client\_timezone ){ |
| [6515](#L6515) |  |
| [6516](#L6516) | $booking\_timeslot\_start = $selected\_date.' '.$service\_tmp\_current\_time.':00'; |
| [6517](#L6517) | $booking\_timeslot\_end = $selected\_date .' '.$service\_current\_time.':00'; |
| [6518](#L6518) |  |
| [6519](#L6519) | $booking\_timeslot\_start = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booking\_timeslot\_start, $bookingpress\_timezone); |
| [6520](#L6520) | $booking\_timeslot\_end = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booking\_timeslot\_end, $bookingpress\_timezone); |
| [6521](#L6521) |  |
| [6522](#L6522) |  |
| [6523](#L6523) | $service\_timing\_arr['start\_time'] = date('H:i', strtotime($booking\_timeslot\_start) ); |
| [6524](#L6524) | $service\_timing\_arr['end\_time'] = date('H:i', strtotime( $booking\_timeslot\_end ) ); |
| [6525](#L6525) |  |
| [6526](#L6526) | $booking\_timeslot\_start\_date = date('Y-m-d', strtotime( $booking\_timeslot\_start ) ); |
| [6527](#L6527) | if( $change\_store\_date ) { |
| [6528](#L6528) |  |
| [6529](#L6529) | $store\_selected\_date = apply\_filters( 'bookingpress\_appointment\_change\_date\_to\_store\_timezone', $selected\_date, $service\_timing\_arr['start\_time'], $bookingpress\_timezone ); |
| [6530](#L6530) |  |
| [6531](#L6531) | $service\_timing\_arr['store\_service\_date'] = $store\_selected\_date; |
| [6532](#L6532) |  |
| [6533](#L6533) | $store\_selection\_datetime = $store\_selected\_date . ' ' . $service\_tmp\_current\_time; |
| [6534](#L6534) | if( strtotime( $store\_selection\_datetime ) < current\_time('timestamp' )  || $store\_selected\_date != $selected\_date ){ |
| [6535](#L6535) | continue; |
| [6536](#L6536) | } |
| [6537](#L6537) | } |
| [6538](#L6538) |  |
| [6539](#L6539) | if( $selected\_date < $booking\_timeslot\_start\_date){ |
| [6540](#L6540) | break; |
| [6541](#L6541) | } |
| [6542](#L6542) | } |
| [6543](#L6543) | $workhour\_data[] = $service\_timing\_arr; |
| [6544](#L6544) | } |
| [6545](#L6545) | } else { |
| [6546](#L6546) | if( !$is\_booked\_for\_minimum ) { |
| [6547](#L6547) |  |
| [6548](#L6548) | $service\_timing\_arr = array( |
| [6549](#L6549) | 'start\_time'       => $service\_tmp\_current\_time, |
| [6550](#L6550) | 'end\_time'         => $service\_current\_time, |
| [6551](#L6551) | 'store\_start\_time'       => $service\_tmp\_current\_time, |
| [6552](#L6552) | 'store\_end\_time'         => $service\_current\_time, |
| [6553](#L6553) | 'break\_start\_time' => $break\_start\_time, |
| [6554](#L6554) | 'break\_end\_time'   => $break\_end\_time, |
| [6555](#L6555) | 'store\_service\_date' => $selected\_date, |
| [6556](#L6556) | 'is\_booked'        => 0, |
| [6557](#L6557) | 'max\_capacity' => $service\_max\_capacity, |
| [6558](#L6558) | 'total\_booked' => 0 |
| [6559](#L6559) | ); |
| [6560](#L6560) |  |
| [6561](#L6561) | if( !empty( $workhours\_break\_data ) ){ |
| [6562](#L6562) | $service\_timing\_arr = apply\_filters( 'bpa\_calculate\_default\_break\_hours', $service\_timing\_arr, $workhours\_break\_data ); |
| [6563](#L6563) | } |
| [6564](#L6564) |  |
| [6565](#L6565) | if( !empty( $service\_timing\_arr['is\_blocked'] ) && true == $service\_timing\_arr['is\_blocked'] ){ |
| [6566](#L6566) | $service\_current\_time = $service\_timing\_arr['break\_end\_time']; |
| [6567](#L6567) | continue; |
| [6568](#L6568) | } |
| [6569](#L6569) |  |
| [6570](#L6570) | if( $display\_slots\_in\_client\_timezone ){ |
| [6571](#L6571) |  |
| [6572](#L6572) | $booking\_timeslot\_start = $selected\_date.' '.$service\_tmp\_current\_time.':00'; |
| [6573](#L6573) | $booking\_timeslot\_end = $selected\_date .' '.$service\_current\_time.':00'; |
| [6574](#L6574) |  |
| [6575](#L6575) |  |
| [6576](#L6576) | $booking\_timeslot\_start = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booking\_timeslot\_start, $bookingpress\_timezone); |
| [6577](#L6577) | $booking\_timeslot\_end = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booking\_timeslot\_end, $bookingpress\_timezone); |
| [6578](#L6578) |  |
| [6579](#L6579) |  |
| [6580](#L6580) | $service\_timing\_arr['start\_time'] = date('H:i', strtotime($booking\_timeslot\_start) ); |
| [6581](#L6581) | $service\_timing\_arr['end\_time'] = date('H:i', strtotime( $booking\_timeslot\_end ) ); |
| [6582](#L6582) |  |
| [6583](#L6583) | $booking\_timeslot\_start\_date = date('Y-m-d', strtotime( $booking\_timeslot\_start ) ); |
| [6584](#L6584) |  |
| [6585](#L6585) | if( $change\_store\_date ) { |
| [6586](#L6586) | $store\_selected\_date = apply\_filters( 'bookingpress\_appointment\_change\_date\_to\_store\_timezone', $selected\_date, $service\_timing\_arr['start\_time'], $bookingpress\_timezone ); |
| [6587](#L6587) |  |
| [6588](#L6588) | $service\_timing\_arr['store\_service\_date'] = $store\_selected\_date; |
| [6589](#L6589) | $store\_selection\_datetime = $store\_selected\_date . ' ' . $service\_tmp\_current\_time; |
| [6590](#L6590) |  |
| [6591](#L6591) | if( strtotime( $store\_selection\_datetime ) < current\_time('timestamp' ) || $store\_selected\_date != $selected\_date ){ |
| [6592](#L6592) | continue; |
| [6593](#L6593) | } |
| [6594](#L6594) | } |
| [6595](#L6595) |  |
| [6596](#L6596) | } |
| [6597](#L6597) |  |
| [6598](#L6598) | $workhour\_data[] = $service\_timing\_arr; |
| [6599](#L6599) | } |
| [6600](#L6600) | } |
| [6601](#L6601) | } else { |
| [6602](#L6602) | if($service\_current\_time >= $service\_end\_time){ |
| [6603](#L6603) | break; |
| [6604](#L6604) | } |
| [6605](#L6605) | } |
| [6606](#L6606) |  |
| [6607](#L6607) | if ( !empty($break\_end\_time) ) { |
| [6608](#L6608) | $service\_current\_time = $break\_end\_time; |
| [6609](#L6609) | } |
| [6610](#L6610) |  |
| [6611](#L6611) | if ($service\_current\_time == $service\_end\_time ) { |
| [6612](#L6612) | break; |
| [6613](#L6613) | } |
| [6614](#L6614) |  |
| [6615](#L6615) | if($default\_timeslot\_step != $service\_step\_duration\_val && empty($break\_start\_time)){ |
| [6616](#L6616) |  |
| [6617](#L6617) | $service\_tmp\_time\_obj = new DateTime($selected\_date . ' ' . $service\_tmp\_current\_time); |
| [6618](#L6618) | $service\_tmp\_time\_obj->add(new DateInterval('PT' . $default\_timeslot\_step . 'M')); |
| [6619](#L6619) | $service\_current\_time = $service\_tmp\_time\_obj->format('H:i'); |
| [6620](#L6620) |  |
| [6621](#L6621) | $service\_current\_date = $service\_tmp\_time\_obj->format('Y-m-d'); |
| [6622](#L6622) | if( $service\_current\_date > $selected\_date ){ |
| [6623](#L6623) | break; |
| [6624](#L6624) | } |
| [6625](#L6625) | } |
| [6626](#L6626) |  |
| [6627](#L6627) | } |
| [6628](#L6628) |  |
| [6629](#L6629) | $service\_timings = $workhour\_data; |
| [6630](#L6630) | } |
| [6631](#L6631) | } |
| [6632](#L6632) |  |
| [6633](#L6633) | return $service\_timings; |
| [6634](#L6634) |  |
| [6635](#L6635) | } |
| [6636](#L6636) |  |
| [6637](#L6637) |  |
| [6638](#L6638) | /\*\* |
| [6639](#L6639) | \* Core function of get timeslots |
| [6640](#L6640) | \* |
| [6641](#L6641) | \* @param  mixed $service\_id |
| [6642](#L6642) | \* @param  mixed $selected\_date |
| [6643](#L6643) | \* @param  mixed $bookingpress\_timezone |
| [6644](#L6644) | \* @return void |
| [6645](#L6645) | \*/ |
| [6646](#L6646) | public function bookingpress\_get\_service\_available\_time( $service\_id = 0, $selected\_date = '', $bookingpress\_timezone = '' ) { |
| [6647](#L6647) | global $wpdb, $tbl\_bookingpress\_default\_workhours, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_services; |
| [6648](#L6648) |  |
| [6649](#L6649) |  |
| [6650](#L6650) | $bookingpress\_hide\_already\_booked\_slot = $this->bookingpress\_get\_customize\_settings( 'hide\_already\_booked\_slot', 'booking\_form' ); |
| [6651](#L6651) | $bookingpress\_hide\_already\_booked\_slot = ( $bookingpress\_hide\_already\_booked\_slot == 'true' ) ? 1 : 0; |
| [6652](#L6652) |  |
| [6653](#L6653) | $current\_day  = ! empty( $selected\_date ) ? strtolower( date( 'l', strtotime( $selected\_date ) ) ) : strtolower( date( 'l', current\_time( 'timestamp' ) ) ); |
| [6654](#L6654) | $current\_date = ! empty($selected\_date) ? date('Y-m-d', strtotime($selected\_date)) : date('Y-m-d', current\_time('timestamp')); |
| [6655](#L6655) |  |
| [6656](#L6656) | $bpa\_current\_date = date('Y-m-d', strtotime(current\_time('mysql'))); |
| [6657](#L6657) |  |
| [6658](#L6658) | if(empty($bookingpress\_timezone)){ |
| [6659](#L6659) | $bpa\_current\_time = date( 'H:i',strtotime(current\_time('mysql'))); |
| [6660](#L6660) | }else{ |
| [6661](#L6661) | $bpa\_current\_time = date('H:i'); |
| [6662](#L6662) | } |
| [6663](#L6663) |  |
| [6664](#L6664) | $default\_daysoff\_details = $this->bookingpress\_get\_default\_dayoff\_dates(); |
| [6665](#L6665) | if ( ! empty( $default\_daysoff\_details ) ) { |
| [6666](#L6666) | foreach ( $default\_daysoff\_details as $key => $value ) { |
| [6667](#L6667) | if ( date( 'Y-m-d', strtotime( $value ) ) == $current\_date ) { |
| [6668](#L6668) | return array(); |
| [6669](#L6669) | exit; |
| [6670](#L6670) | } |
| [6671](#L6671) | } |
| [6672](#L6672) | } |
| [6673](#L6673) |  |
| [6674](#L6674) |  |
| [6675](#L6675) | $service\_time\_duration     = $this->bookingpress\_get\_default\_timeslot\_data(); |
| [6676](#L6676) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration['default\_timeslot']; |
| [6677](#L6677) |  |
| [6678](#L6678) | $service\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason $tbl\_bookingpress\_services is a table name |
| [6679](#L6679) | if (! empty($service\_data) ) { |
| [6680](#L6680) | $service\_time\_duration      = esc\_html($service\_data['bookingpress\_service\_duration\_val']); |
| [6681](#L6681) | $service\_time\_duration\_unit = esc\_html($service\_data['bookingpress\_service\_duration\_unit']); |
| [6682](#L6682) | if ($service\_time\_duration\_unit == 'h' ) { |
| [6683](#L6683) | $service\_time\_duration = $service\_time\_duration \* 60; |
| [6684](#L6684) | } elseif($service\_time\_duration\_unit == 'd') { |
| [6685](#L6685) | $service\_time\_duration = $service\_time\_duration \* 24 \* 60; |
| [6686](#L6686) | } |
| [6687](#L6687) | $default\_timeslot\_step = $service\_step\_duration\_val = $service\_time\_duration; |
| [6688](#L6688) | } |
| [6689](#L6689) |  |
| [6690](#L6690) | $bookingpress\_show\_time\_as\_per\_service\_duration = $this->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [6691](#L6691) | if ( ! empty( $bookingpress\_show\_time\_as\_per\_service\_duration ) && $bookingpress\_show\_time\_as\_per\_service\_duration == 'false' ) { |
| [6692](#L6692) | $bookingpress\_default\_time\_slot = $this->bookingpress\_get\_settings( 'default\_time\_slot', 'general\_setting' ); |
| [6693](#L6693) | $default\_timeslot\_step      = $bookingpress\_default\_time\_slot; |
| [6694](#L6694) | } |
| [6695](#L6695) |  |
| [6696](#L6696) | //$service\_step\_duration\_val = apply\_filters( 'bookingpress\_modify\_service\_timeslot', $service\_step\_duration\_val, $service\_id, $service\_time\_duration\_unit ); |
| [6697](#L6697) |  |
| [6698](#L6698) | //Check shared service timeslot switch enabled or not |
| [6699](#L6699) | //$bookingpress\_shared\_service\_timeslot = $this->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [6700](#L6700) |  |
| [6701](#L6701) | $already\_booked\_time\_arr = $workhour\_data = $break\_hour\_arr = array(); |
| [6702](#L6702) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6703](#L6703) | $get\_default\_work\_hours\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 0", $current\_day), ARRAY\_A); |
| [6704](#L6704) | if (! empty($get\_default\_work\_hours\_data) ) { |
| [6705](#L6705) | $service\_current\_time = $service\_start\_time = apply\_filters( 'bookingpress\_modify\_service\_start\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_start\_time'])), $service\_id ); |
| [6706](#L6706) | $service\_end\_time     = apply\_filters( 'bookingpress\_modify\_service\_end\_time', date('H:i', strtotime($get\_default\_work\_hours\_data['bookingpress\_end\_time'])), $service\_id ); |
| [6707](#L6707) |  |
| [6708](#L6708) | if($service\_end\_time == "00:00"){ |
| [6709](#L6709) | $service\_end\_time = "24:00"; |
| [6710](#L6710) | } |
| [6711](#L6711) |  |
| [6712](#L6712) | if ($service\_start\_time != null && $service\_end\_time != null ) { |
| [6713](#L6713) | while ( $service\_current\_time <= $service\_end\_time ) { |
| [6714](#L6714) | if ($service\_current\_time > $service\_end\_time ) { |
| [6715](#L6715) | break; |
| [6716](#L6716) | } |
| [6717](#L6717) |  |
| [6718](#L6718) | $service\_tmp\_date\_time = $selected\_date .' '.$service\_current\_time; |
| [6719](#L6719) |  |
| [6720](#L6720) | $service\_tmp\_end\_time = date( 'Y-m-d', ( strtotime($selected\_date. ' ' . $service\_current\_time ) + ( $service\_step\_duration\_val \* 60 ) ) ); |
| [6721](#L6721) |  |
| [6722](#L6722) | if( $service\_tmp\_end\_time > $selected\_date ){ |
| [6723](#L6723) | if( $service\_step\_duration\_val > 1440 && $service\_time\_duration\_unit != 'd' ){ |
| [6724](#L6724) | break; |
| [6725](#L6725) | } |
| [6726](#L6726) | } |
| [6727](#L6727) |  |
| [6728](#L6728) | $service\_tmp\_current\_time = $service\_current\_time; |
| [6729](#L6729) | if ($service\_current\_time == '00:00' ) { |
| [6730](#L6730) | $service\_current\_time = date('H:i', strtotime($service\_current\_time) + ( $service\_step\_duration\_val \* 60 )); |
| [6731](#L6731) | } else { |
| [6732](#L6732) | $service\_tmp\_time\_obj = new DateTime($selected\_date .' ' . $service\_current\_time); |
| [6733](#L6733) | $service\_tmp\_time\_obj->add(new DateInterval('PT' . $service\_step\_duration\_val . 'M')); |
| [6734](#L6734) | $service\_current\_time = $service\_tmp\_time\_obj->format('H:i'); |
| [6735](#L6735) | $service\_current\_date = $service\_tmp\_time\_obj->format('Y-m-d'); |
| [6736](#L6736) | if( $service\_current\_date > $selected\_date ){ |
| [6737](#L6737) | if( $service\_end\_time == '24:00' && strtotime($service\_current\_date.' '.$service\_current\_time) > strtotime( $service\_current\_date . ' 00:00' ) ){ |
| [6738](#L6738) | break; |
| [6739](#L6739) | } |
| [6740](#L6740) | } |
| [6741](#L6741) | } |
| [6742](#L6742) |  |
| [6743](#L6743) | $break\_start\_time      = ''; |
| [6744](#L6744) | $break\_end\_time        = ''; |
| [6745](#L6745) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6746](#L6746) | $check\_break\_existance = $wpdb->get\_var($wpdb->prepare("SELECT COUNT(bookingpress\_workhours\_id) as total FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 1 AND (bookingpress\_start\_time BETWEEN %s AND %s)", $current\_day, $service\_tmp\_current\_time, $service\_current\_time)); |
| [6747](#L6747) |  |
| [6748](#L6748) | if ($check\_break\_existance > 0 ) { |
| [6749](#L6749) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_default\_workhours is table name defined globally. False Positive alarm |
| [6750](#L6750) | $get\_break\_workhours = $wpdb->get\_row($wpdb->prepare("SELECT TIMEDIFF(bookingpress\_end\_time, bookingpress\_start\_time) as time\_diff, bookingpress\_start\_time, bookingpress\_end\_time FROM {$tbl\_bookingpress\_default\_workhours} WHERE bookingpress\_workday\_key = %s AND bookingpress\_is\_break = 1 AND (bookingpress\_start\_time BETWEEN %s AND %s )", $current\_day, $service\_tmp\_current\_time, $service\_current\_time), ARRAY\_A); |
| [6751](#L6751) | $time\_difference     = date('H:i', strtotime($get\_break\_workhours['time\_diff'])); |
| [6752](#L6752) |  |
| [6753](#L6753) | $break\_start\_time     = date('H:i', strtotime($get\_break\_workhours['bookingpress\_start\_time'])); |
| [6754](#L6754) | $break\_end\_time       = date('H:i', strtotime($get\_break\_workhours['bookingpress\_end\_time'])); |
| [6755](#L6755) | $service\_current\_time = $break\_start\_time; |
| [6756](#L6756) | } |
| [6757](#L6757) |  |
| [6758](#L6758) | $is\_appointment\_booked = 0; |
| [6759](#L6759) | if( empty( $\_POST['action'] ) || $\_POST['action'] != 'bookingpress\_get\_edit\_appointment\_data' ){ // phpcs:ignore |
| [6760](#L6760) | $is\_appointment\_booked = $this->bookingpress\_is\_appointment\_booked($service\_id, $current\_date, $service\_tmp\_current\_time, $service\_current\_time); |
| [6761](#L6761) | } |
| [6762](#L6762) |  |
| [6763](#L6763) | $is\_already\_booked = ( $is\_appointment\_booked > 0 ) ? 1 : 0; |
| [6764](#L6764) | if ($service\_current\_time < $service\_start\_time || $service\_current\_time == $service\_start\_time ) { |
| [6765](#L6765) | $service\_current\_time = $service\_end\_time; |
| [6766](#L6766) | } |
| [6767](#L6767) |  |
| [6768](#L6768) | $bookingpress\_timediff\_in\_minutes = round(abs(strtotime($service\_current\_time) - strtotime($service\_tmp\_current\_time)) / 60, 2); |
| [6769](#L6769) |  |
| [6770](#L6770) | if ($is\_already\_booked == 1 && $bookingpress\_hide\_already\_booked\_slot == 1 ) { |
| [6771](#L6771) | continue; |
| [6772](#L6772) | } else { |
| [6773](#L6773) | if ($break\_start\_time != $service\_tmp\_current\_time && ($bookingpress\_timediff\_in\_minutes >= $service\_step\_duration\_val) && $service\_current\_time <= $service\_end\_time ) { |
| [6774](#L6774) | if ($bpa\_current\_date == $current\_date ) { |
| [6775](#L6775) | if ($service\_tmp\_current\_time > $bpa\_current\_time ) { |
| [6776](#L6776) | $workhour\_data[] = array( |
| [6777](#L6777) | 'start\_time' => $service\_tmp\_current\_time, |
| [6778](#L6778) | 'end\_time'   => $service\_current\_time, |
| [6779](#L6779) | 'break\_start\_time' => $break\_start\_time, |
| [6780](#L6780) | 'break\_end\_time' => $break\_end\_time, |
| [6781](#L6781) | 'is\_booked'  => $is\_already\_booked, |
| [6782](#L6782) | ); |
| [6783](#L6783) | } else { |
| [6784](#L6784) | /\* $workhour\_data[] = array( |
| [6785](#L6785) | 'start\_time' => $service\_tmp\_current\_time, |
| [6786](#L6786) | 'end\_time'   => $service\_current\_time, |
| [6787](#L6787) | 'break\_start\_time' => $break\_start\_time, |
| [6788](#L6788) | 'break\_end\_time' => $break\_end\_time, |
| [6789](#L6789) | 'is\_booked'  => 1, |
| [6790](#L6790) | ); \*/ |
| [6791](#L6791) | } |
| [6792](#L6792) | } else { |
| [6793](#L6793) | $workhour\_data[] = array( |
| [6794](#L6794) | 'start\_time'       => $service\_tmp\_current\_time, |
| [6795](#L6795) | 'end\_time'         => $service\_current\_time, |
| [6796](#L6796) | 'break\_start\_time' => $break\_start\_time, |
| [6797](#L6797) | 'break\_end\_time'   => $break\_end\_time, |
| [6798](#L6798) | 'is\_booked'        => $is\_already\_booked, |
| [6799](#L6799) | ); |
| [6800](#L6800) | } |
| [6801](#L6801) | }else{ |
| [6802](#L6802) | if($service\_current\_time >= $service\_end\_time){ |
| [6803](#L6803) | break; |
| [6804](#L6804) | } |
| [6805](#L6805) | } |
| [6806](#L6806) | } |
| [6807](#L6807) |  |
| [6808](#L6808) | if (! empty($break\_end\_time) ) { |
| [6809](#L6809) | $service\_current\_time = $break\_end\_time; |
| [6810](#L6810) | } |
| [6811](#L6811) |  |
| [6812](#L6812) | if ($service\_current\_time == $service\_end\_time ) { |
| [6813](#L6813) | break; |
| [6814](#L6814) | } |
| [6815](#L6815) |  |
| [6816](#L6816) | if($default\_timeslot\_step != $service\_step\_duration\_val && empty($break\_start\_time)){ |
| [6817](#L6817) | $service\_tmp\_time\_obj = new DateTime($selected\_date . ' ' . $service\_tmp\_current\_time); |
| [6818](#L6818) | $service\_tmp\_time\_obj->add(new DateInterval('PT' . $default\_timeslot\_step . 'M')); |
| [6819](#L6819) | $service\_current\_time = $service\_tmp\_time\_obj->format('H:i'); |
| [6820](#L6820) |  |
| [6821](#L6821) | $service\_current\_date = $service\_tmp\_time\_obj->format('Y-m-d'); |
| [6822](#L6822) | if( $service\_current\_date > $selected\_date ){ |
| [6823](#L6823) | break; |
| [6824](#L6824) | } |
| [6825](#L6825) | } |
| [6826](#L6826) | } |
| [6827](#L6827) | } |
| [6828](#L6828) | } |
| [6829](#L6829) |  |
| [6830](#L6830) | //$workhour\_data = apply\_filters( 'bookingpress\_modify\_service\_time', $workhour\_data, $current\_date, $current\_day, $service\_id, $selected\_date, $bookingpress\_timezone ); |
| [6831](#L6831) |  |
| [6832](#L6832) | return $workhour\_data; |
| [6833](#L6833) | } |
| [6834](#L6834) |  |
| [6835](#L6835) | /\*\* |
| [6836](#L6836) | \* Core function of get timeslots |
| [6837](#L6837) | \* |
| [6838](#L6838) | \* @param  mixed $service\_id |
| [6839](#L6839) | \* @param  mixed $selected\_date |
| [6840](#L6840) | \* @param  mixed $bookingpress\_timezone |
| [6841](#L6841) | \* @return void |
| [6842](#L6842) | \*/ |
| [6843](#L6843) | public function bookingpress\_get\_daily\_timeslots( $appointment\_time\_slot = array() ) { |
| [6844](#L6844) | global $bookingpress\_global\_options; |
| [6845](#L6845) |  |
| [6846](#L6846) | $bookingpress\_global\_details      = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [6847](#L6847) | $bookingpress\_default\_time\_format = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [6848](#L6848) | $bookingpress\_default\_time\_format = apply\_filters('bookingpress\_change\_time\_slot\_format',$bookingpress\_default\_time\_format); |
| [6849](#L6849) | $morning\_time   = array(); |
| [6850](#L6850) | $afternoon\_time = array(); |
| [6851](#L6851) | $evening\_time   = array(); |
| [6852](#L6852) | $night\_time     = array(); |
| [6853](#L6853) |  |
| [6854](#L6854) | $bookingpress\_service\_slot\_details = array(); |
| [6855](#L6855) | if (! empty($appointment\_time\_slot) ) { |
| [6856](#L6856) | foreach ( $appointment\_time\_slot as $key => $value ) { |
| [6857](#L6857) |  |
| [6858](#L6858) | $service\_start\_time = date('H', strtotime($value['start\_time'])); |
| [6859](#L6859) | $service\_end\_time   = date('H', strtotime($value['end\_time'])); |
| [6860](#L6860) |  |
| [6861](#L6861) | if ($service\_start\_time >= 0 && $service\_start\_time < 12 ) { |
| [6862](#L6862) | $morning\_time[] = array( |
| [6863](#L6863) | 'start\_time'  => $value['start\_time'], |
| [6864](#L6864) | 'start\_time\_format' => date( $bookingpress\_default\_time\_format, strtotime( $value['start\_time'] ) ), |
| [6865](#L6865) | 'end\_time'    => $value['end\_time'], |
| [6866](#L6866) | 'end\_time\_format'   => date( $bookingpress\_default\_time\_format, strtotime( $value['end\_time'] ) ), |
| [6867](#L6867) | 'is\_disabled' => ( $value['is\_booked'] == 1 ) ? true : false, |
| [6868](#L6868) | ); |
| [6869](#L6869) | } elseif ($service\_start\_time >= 12 && $service\_start\_time < 16 ) { |
| [6870](#L6870) | $afternoon\_time[] = array( |
| [6871](#L6871) | 'start\_time'  => $value['start\_time'], |
| [6872](#L6872) | 'start\_time\_format' => date( $bookingpress\_default\_time\_format, strtotime( $value['start\_time'] ) ), |
| [6873](#L6873) | 'end\_time'    => $value['end\_time'], |
| [6874](#L6874) | 'end\_time\_format'   => date( $bookingpress\_default\_time\_format, strtotime( $value['end\_time'] ) ), |
| [6875](#L6875) | 'is\_disabled' => ( $value['is\_booked'] == 1 ) ? true : false, |
| [6876](#L6876) | ); |
| [6877](#L6877) | } elseif ($service\_start\_time >= 16 && $service\_start\_time < 20 ) { |
| [6878](#L6878) | $evening\_time[] = array( |
| [6879](#L6879) | 'start\_time'  => $value['start\_time'], |
| [6880](#L6880) | 'start\_time\_format' => date( $bookingpress\_default\_time\_format, strtotime( $value['start\_time'] ) ), |
| [6881](#L6881) | 'end\_time'          => $value['end\_time'], |
| [6882](#L6882) | 'end\_time\_format'   => date( $bookingpress\_default\_time\_format, strtotime( $value['end\_time'] ) ), |
| [6883](#L6883) | 'is\_disabled' => ( $value['is\_booked'] == 1 ) ? true : false, |
| [6884](#L6884) | ); |
| [6885](#L6885) | } else { |
| [6886](#L6886) | $night\_time[] = array( |
| [6887](#L6887) | 'start\_time'  => $value['start\_time'], |
| [6888](#L6888) | 'start\_time\_format' => date( $bookingpress\_default\_time\_format, strtotime( $value['start\_time'] ) ), |
| [6889](#L6889) | 'end\_time'    => $value['end\_time'], |
| [6890](#L6890) | 'end\_time\_format'   => date( $bookingpress\_default\_time\_format, strtotime( $value['end\_time'] ) ), |
| [6891](#L6891) | 'is\_disabled' => ( $value['is\_booked'] == 1 ) ? true : false, |
| [6892](#L6892) | ); |
| [6893](#L6893) | } |
| [6894](#L6894) | } |
| [6895](#L6895) | } |
| [6896](#L6896) |  |
| [6897](#L6897) | $bookingpress\_service\_slot\_details['morning\_time']   = array( |
| [6898](#L6898) | 'timeslot\_label' => esc\_html\_\_('Morning', 'bookingpress-appointment-booking'), |
| [6899](#L6899) | 'timeslots'      => $morning\_time, |
| [6900](#L6900) | ); |
| [6901](#L6901) | $bookingpress\_service\_slot\_details['afternoon\_time'] = array( |
| [6902](#L6902) | 'timeslot\_label' => esc\_html\_\_('Afternoon', 'bookingpress-appointment-booking'), |
| [6903](#L6903) | 'timeslots'      => $afternoon\_time, |
| [6904](#L6904) | ); |
| [6905](#L6905) | $bookingpress\_service\_slot\_details['evening\_time']   = array( |
| [6906](#L6906) | 'timeslot\_label' => esc\_html\_\_('Evening', 'bookingpress-appointment-booking'), |
| [6907](#L6907) | 'timeslots'      => $evening\_time, |
| [6908](#L6908) | ); |
| [6909](#L6909) | $bookingpress\_service\_slot\_details['night\_time']     = array( |
| [6910](#L6910) | 'timeslot\_label' => esc\_html\_\_('Night', 'bookingpress-appointment-booking'), |
| [6911](#L6911) | 'timeslots'      => $night\_time, |
| [6912](#L6912) | ); |
| [6913](#L6913) |  |
| [6914](#L6914) | return $bookingpress\_service\_slot\_details; |
| [6915](#L6915) | } |
| [6916](#L6916) |  |
| [6917](#L6917) |  |
| [6918](#L6918) | /\*\* |
| [6919](#L6919) | \* Get week startdate and end date from week number and year |
| [6920](#L6920) | \* |
| [6921](#L6921) | \* @param  mixed $week\_number |
| [6922](#L6922) | \* @param  mixed $year |
| [6923](#L6923) | \* @return void |
| [6924](#L6924) | \*/ |
| [6925](#L6925) | public function get\_weekstart\_date\_end\_date( $week\_number, $year ) |
| [6926](#L6926) | { |
| [6927](#L6927) | $dto = new DateTime(); |
| [6928](#L6928) | $dto->setISODate($year, $week\_number); |
| [6929](#L6929) | $ret['week\_start'] = $dto->format('Y-m-d'); |
| [6930](#L6930) | $dto->modify('+6 days'); |
| [6931](#L6931) | $ret['week\_end'] = $dto->format('Y-m-d'); |
| [6932](#L6932) | return $ret; |
| [6933](#L6933) | } |
| [6934](#L6934) |  |
| [6935](#L6935) | /\*\* |
| [6936](#L6936) | \* Get current month start and end date |
| [6937](#L6937) | \* |
| [6938](#L6938) | \* @return void |
| [6939](#L6939) | \*/ |
| [6940](#L6940) | public function get\_monthstart\_date\_end\_date() |
| [6941](#L6941) | { |
| [6942](#L6942) | $month\_start\_date = date('Y-m-01'); |
| [6943](#L6943) | $month\_end\_date   = date('Y-m-t'); |
| [6944](#L6944) | return array( |
| [6945](#L6945) | 'start\_date' => $month\_start\_date, |
| [6946](#L6946) | 'end\_date'   => $month\_end\_date, |
| [6947](#L6947) | ); |
| [6948](#L6948) | } |
| [6949](#L6949) |  |
| [6950](#L6950) | /\*\* |
| [6951](#L6951) | \* Fetch all services |
| [6952](#L6952) | \* |
| [6953](#L6953) | \* @param  mixed $service [bookingpress\_form service=1] |
| [6954](#L6954) | \* @param  mixed $selected\_service [bookingpress\_form selected\_service=1] |
| [6955](#L6955) | \* @param  mixed $bookingpress\_category [bookingpress\_form category=1] |
| [6956](#L6956) | \* @return array |
| [6957](#L6957) | \*/ |
| [6958](#L6958) | function bookingpress\_retrieve\_all\_services( $service = '', $selected\_service = '', $bookingpress\_category = 0 ){ |
| [6959](#L6959) | global $wpdb, $tbl\_bookingpress\_services; |
| [6960](#L6960) | $bpa\_all\_services = array(); |
| [6961](#L6961) |  |
| [6962](#L6962) | $bookingpress\_display\_no\_service\_placeholder = false; |
| [6963](#L6963) |  |
| [6964](#L6964) | $where\_clause = ''; |
| [6965](#L6965) | $consider\_where = false; |
| [6966](#L6966) | $get\_s\_id = !empty( $\_GET['s\_id'] ) ? intval( $\_GET['s\_id'] ) : ''; |
| [6967](#L6967) | $get\_s\_id = apply\_filters( 'bookingpress\_modify\_s\_id\_before\_retrieving\_service', $get\_s\_id ); |
| [6968](#L6968) |  |
| [6969](#L6969) |  |
| [6970](#L6970) | if( !empty( $get\_s\_id ) && isset( $\_GET['allow\_modify'] ) && 0 === intval( $\_GET['allow\_modify'] )){ |
| [6971](#L6971) | $where\_clause .= $wpdb->prepare( ' AND bookingpress\_service\_id = %d', intval( $\_GET['s\_id'] ) ); |
| [6972](#L6972) | $consider\_where = true; |
| [6973](#L6973) | } else if( !empty( $service ) ){ |
| [6974](#L6974) | $where\_clause .= ' AND bookingpress\_service\_id IN ('.$service.')'; |
| [6975](#L6975) | $consider\_where = true; |
| [6976](#L6976) | } else if ( isset( $bookingpress\_category ) && 0 < $bookingpress\_category ){ |
| [6977](#L6977) | $where\_clause .= ' AND bookingpress\_category\_id IN ('.$bookingpress\_category.')'; |
| [6978](#L6978) | $consider\_where = true; |
| [6979](#L6979) | } |
| [6980](#L6980) |  |
| [6981](#L6981) | $where\_clause = apply\_filters( 'bookingpress\_retrieve\_service\_where\_clause', $where\_clause, $service, $selected\_service, $bookingpress\_category ); |
| [6982](#L6982) | if( false == $consider\_where && !empty( $where\_clause ) ){ |
| [6983](#L6983) | $consider\_where = true; |
| [6984](#L6984) | } |
| [6985](#L6985) |  |
| [6986](#L6986) | $db\_all\_services\_without\_where = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_services} ORDER BY bookingpress\_service\_position ASC", ARRAY\_A );// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. |
| [6987](#L6987) |  |
| [6988](#L6988) | $db\_all\_services = array(); |
| [6989](#L6989) | if( !empty( $where\_clause ) ){ |
| [6990](#L6990) | $db\_all\_services = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_services} WHERE 1 = 1 $where\_clause ORDER BY bookingpress\_service\_position ASC", ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. |
| [6991](#L6991) | } |
| [6992](#L6992) | if( count( $db\_all\_services ) == 0 && 0 < count( $db\_all\_services\_without\_where ) ){ |
| [6993](#L6993) | $db\_all\_services = $db\_all\_services\_without\_where; |
| [6994](#L6994) | } |
| [6995](#L6995) |  |
| [6996](#L6996) | $bookingpress\_display\_service\_description = $this->bookingpress\_get\_customize\_settings('display\_service\_description', 'booking\_form'); |
| [6997](#L6997) |  |
| [6998](#L6998) | $min\_text = $this->bookingpress\_get\_customize\_settings('book\_appointment\_min\_text', 'booking\_form'); |
| [6999](#L6999) | $hour\_text = $this->bookingpress\_get\_customize\_settings('book\_appointment\_hours\_text', 'booking\_form'); |
| [7000](#L7000) | $bookingpress\_duration\_suffix\_labels = array( |
| [7001](#L7001) | 'm' => !empty( $min\_text ) ? stripslashes\_deep($min\_text) : esc\_html\_\_('m', 'bookingpress-appointment-booking'), |
| [7002](#L7002) | 'h' => !empty( $hour\_text ) ? stripslashes\_deep($hour\_text) : esc\_html\_\_('h', 'bookingpress-appointment-booking'), |
| [7003](#L7003) | ); |
| [7004](#L7004) |  |
| [7005](#L7005) | if( !empty( $db\_all\_services ) ){ |
| [7006](#L7006) | foreach( $db\_all\_services as $skey => $svalue ){ |
| [7007](#L7007) | $svalue['is\_visible'] = true; |
| [7008](#L7008) | $svalue['is\_visible\_with\_flag'] = true; |
| [7009](#L7009) | $services\_meta = $this->bookingpress\_get\_service\_meta( $svalue['bookingpress\_service\_id'] ); |
| [7010](#L7010) | $svalue['services\_meta'] = $services\_meta; |
| [7011](#L7011) |  |
| [7012](#L7012) | $service\_price = $svalue['bookingpress\_service\_price']; |
| [7013](#L7013) |  |
| [7014](#L7014) | $svalue['bookingpress\_service\_price'] = $this->bookingpress\_price\_formatter\_with\_currency\_symbol( $service\_price ); |
| [7015](#L7015) | $svalue['service\_price\_without\_currency'] = (float) $service\_price; |
| [7016](#L7016) | $svalue['bookingpress\_service\_name'] = stripslashes\_deep($svalue['bookingpress\_service\_name']); |
| [7017](#L7017) |  |
| [7018](#L7018) | $svalue['bookingpress\_service\_duration\_label'] = !empty( $bookingpress\_duration\_suffix\_labels[ $svalue['bookingpress\_service\_duration\_unit'] ] ) ? $bookingpress\_duration\_suffix\_labels[ $svalue['bookingpress\_service\_duration\_unit'] ] : $svalue['bookingpress\_service\_duration\_unit']; |
| [7019](#L7019) |  |
| [7020](#L7020) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [7021](#L7021) | $svalue['display\_read\_more\_less'] = 1; |
| [7022](#L7022) | $default\_service\_description   = $svalue['bookingpress\_service\_description']; |
| [7023](#L7023) | if (strlen($default\_service\_description) > 140 ) { |
| [7024](#L7024) | $svalue['bookingpress\_service\_description\_with\_excerpt'] = substr($default\_service\_description, 0, 140); |
| [7025](#L7025) | $svalue['display\_details\_more']                          = 0; |
| [7026](#L7026) | $svalue['display\_details\_less']                          = 1; |
| [7027](#L7027) | } else { |
| [7028](#L7028) | $svalue['display\_read\_more\_less'] = 0; |
| [7029](#L7029) | } |
| [7030](#L7030) | } |
| [7031](#L7031) |  |
| [7032](#L7032) | if( !empty( $services\_meta['service\_image\_details'] ) ){ |
| [7033](#L7033) | $svalue['use\_placeholder'] = !empty( $services\_meta['service\_image\_details'][0]['url'] ) ? false : true; |
| [7034](#L7034) | $svalue['img\_url'] = !empty( $services\_meta['service\_image\_details'][0]['url'] ) ? $services\_meta['service\_image\_details'][0]['url'] : BOOKINGPRESS\_URL . '/images/placeholder-img.jpg'; |
| [7035](#L7035) | } else { |
| [7036](#L7036) | $svalue['use\_placeholder'] = true; |
| [7037](#L7037) | } |
| [7038](#L7038) | $bpa\_all\_services[ (string)$svalue['bookingpress\_service\_id'] ] = $svalue; |
| [7039](#L7039) | } |
| [7040](#L7040) | } else { |
| [7041](#L7041) | $bookingpress\_display\_no\_service\_placeholder = true; |
| [7042](#L7042) | } |
| [7043](#L7043) |  |
| [7044](#L7044) | $bpa\_all\_services = apply\_filters( 'bookingpress\_modify\_all\_retrieved\_services', $bpa\_all\_services, $service, $selected\_service, $bookingpress\_category ); |
| [7045](#L7045) |  |
| [7046](#L7046) | return $bpa\_all\_services; |
| [7047](#L7047) | } |
| [7048](#L7048) |  |
| [7049](#L7049) | /\*\* |
| [7050](#L7050) | \* Fetch all categories based on the services we have |
| [7051](#L7051) | \* |
| [7052](#L7052) | \* @param  mixed $bpa\_all\_services |
| [7053](#L7053) | \* @return void |
| [7054](#L7054) | \*/ |
| [7055](#L7055) | function bookingpress\_retrieve\_all\_categories( $bpa\_all\_services ){ |
| [7056](#L7056) | $bpa\_all\_categories = array(); |
| [7057](#L7057) | global $wpdb, $tbl\_bookingpress\_categories; |
| [7058](#L7058) |  |
| [7059](#L7059) | $get\_category\_ids = array(); |
| [7060](#L7060) |  |
| [7061](#L7061) | if( !empty( $bpa\_all\_services ) ){ |
| [7062](#L7062) | foreach( $bpa\_all\_services as $service\_id => $service\_data ){ |
| [7063](#L7063) | $is\_disabled = ( !empty( $service\_data['is\_disabled'] ) && 1 == $service\_data['is\_disabled'] ) ? true : false; |
| [7064](#L7064) | if( 1 == $service\_data['is\_visible'] && false == $is\_disabled){ |
| [7065](#L7065) | if( !isset( $get\_category\_ids[ $service\_data['bookingpress\_category\_id'] ]) ){ |
| [7066](#L7066) | $get\_category\_ids[ $service\_data['bookingpress\_category\_id'] ] =array( |
| [7067](#L7067) | 'counter' => 1, |
| [7068](#L7068) | 'service\_ids' => array( |
| [7069](#L7069) | $service\_id |
| [7070](#L7070) | ) |
| [7071](#L7071) | ); |
| [7072](#L7072) | } else { |
| [7073](#L7073) | $get\_category\_ids[ $service\_data['bookingpress\_category\_id'] ]['counter']++; |
| [7074](#L7074) | $get\_category\_ids[ $service\_data['bookingpress\_category\_id'] ]['service\_ids'][] = $service\_id; |
| [7075](#L7075) | } |
| [7076](#L7076) | } |
| [7077](#L7077) | } |
| [7078](#L7078) | } |
| [7079](#L7079) |  |
| [7080](#L7080) |  |
| [7081](#L7081) | $bpa\_category\_data = array(); |
| [7082](#L7082) | $bpa\_uncategorized\_data = array(); |
| [7083](#L7083) |  |
| [7084](#L7084) | $bookingpress\_all\_category\_title = $this->bookingpress\_get\_customize\_settings('all\_category\_title', 'booking\_form'); |
| [7085](#L7085) | $bookingpress\_all\_category\_with\_services = array(); |
| [7086](#L7086) | foreach( $get\_category\_ids as $category\_id => $category\_ids\_data ){ |
| [7087](#L7087) | if( 0 === $category\_id ){ |
| [7088](#L7088) | $bpa\_uncategorized\_data[0] = array( |
| [7089](#L7089) | 'category\_id' => 0, |
| [7090](#L7090) | 'category\_key' => 'all', |
| [7091](#L7091) | 'category\_name' => stripslashes\_deep($bookingpress\_all\_category\_title), |
| [7092](#L7092) | 'total\_services' => $category\_ids\_data['counter'], |
| [7093](#L7093) | 'is\_visible' => true, |
| [7094](#L7094) | 'service\_ids' => $category\_ids\_data['service\_ids'] |
| [7095](#L7095) | ); |
| [7096](#L7096) | } else { |
| [7097](#L7097) | $category\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_categories} WHERE bookingpress\_category\_id = %d", $category\_id ), ARRAY\_A );// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_categories is table name defined globally. |
| [7098](#L7098) | $bpa\_category\_data[ $category\_data['bookingpress\_category\_id'] ] = array( |
| [7099](#L7099) | 'category\_id' => intval( $category\_data['bookingpress\_category\_id'] ), |
| [7100](#L7100) | 'category\_key' => $category\_data['bookingpress\_category\_name'], |
| [7101](#L7101) | 'category\_name' => stripslashes\_deep($category\_data['bookingpress\_category\_name']), |
| [7102](#L7102) | 'total\_services' => $category\_ids\_data['counter'], |
| [7103](#L7103) | 'service\_ids' => $category\_ids\_data['service\_ids'], |
| [7104](#L7104) | 'is\_visible' => true, |
| [7105](#L7105) | 'position' => $category\_data['bookingpress\_category\_position'] |
| [7106](#L7106) | ); |
| [7107](#L7107) | $bookingpress\_all\_category\_with\_services[0] = array( |
| [7108](#L7108) | 'category\_id' => 0, |
| [7109](#L7109) | 'category\_key' => 'all', |
| [7110](#L7110) | 'is\_visible' => true, |
| [7111](#L7111) | 'category\_name' => stripslashes\_deep($bookingpress\_all\_category\_title), |
| [7112](#L7112) | 'total\_services' => $category\_ids\_data['counter'], |
| [7113](#L7113) | 'service\_ids' => $category\_ids\_data['service\_ids'] |
| [7114](#L7114) | ); |
| [7115](#L7115) | } |
| [7116](#L7116) | } |
| [7117](#L7117) |  |
| [7118](#L7118) | usort( $bpa\_category\_data, function( $a, $b ){ return $a['position'] <=> $b['position']; } ); |
| [7119](#L7119) |  |
| [7120](#L7120) | if( !empty( $bpa\_uncategorized\_data ) ){ |
| [7121](#L7121) | $bpa\_all\_categories = array\_merge( $bpa\_uncategorized\_data, $bpa\_category\_data ); |
| [7122](#L7122) | } else { |
| [7123](#L7123) | if( count( $get\_category\_ids ) > 1 ){ |
| [7124](#L7124) | $bpa\_all\_categories = array\_merge( $bookingpress\_all\_category\_with\_services, $bpa\_category\_data ); |
| [7125](#L7125) | } else { |
| [7126](#L7126) | $bpa\_all\_categories = $bpa\_category\_data; |
| [7127](#L7127) | } |
| [7128](#L7128) | } |
| [7129](#L7129) |  |
| [7130](#L7130) | return $bpa\_all\_categories; |
| [7131](#L7131) | } |
| [7132](#L7132) |  |
| [7133](#L7133) | /\*\* |
| [7134](#L7134) | \* retrive bookingpress service meta from the service id |
| [7135](#L7135) | \* |
| [7136](#L7136) | \* @param  mixed $service\_id |
| [7137](#L7137) | \* @return void |
| [7138](#L7138) | \*/ |
| [7139](#L7139) | function bookingpress\_get\_service\_meta( $service\_id ){ |
| [7140](#L7140) | global $wpdb, $tbl\_bookingpress\_servicesmeta; |
| [7141](#L7141) |  |
| [7142](#L7142) | $services\_meta = array(); |
| [7143](#L7143) |  |
| [7144](#L7144) | if( empty( $service\_id ) ){ |
| [7145](#L7145) | return $services\_meta; |
| [7146](#L7146) | } |
| [7147](#L7147) |  |
| [7148](#L7148) | $get\_service\_metas = $wpdb->get\_results( $wpdb->prepare( "SELECT bookingpress\_servicemeta\_name, bookingpress\_servicemeta\_value FROM {$tbl\_bookingpress\_servicesmeta} WHERE bookingpress\_service\_id = %d", $service\_id ), ARRAY\_A );// phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_servicesmeta is table name defined globally. |
| [7149](#L7149) |  |
| [7150](#L7150) | if( empty( $get\_service\_metas ) ){ |
| [7151](#L7151) | return $services\_meta; |
| [7152](#L7152) | } |
| [7153](#L7153) |  |
| [7154](#L7154) | foreach ( $get\_service\_metas as $smkey => $smvalue ){ |
| [7155](#L7155) | $services\_meta[ $smvalue['bookingpress\_servicemeta\_name'] ] = $this->bookingpress\_json\_decode( $smvalue['bookingpress\_servicemeta\_value'], true ); |
| [7156](#L7156) | } |
| [7157](#L7157) |  |
| [7158](#L7158) | return $services\_meta; |
| [7159](#L7159) | } |
| [7160](#L7160) |  |
| [7161](#L7161) | /\*\* |
| [7162](#L7162) | \* bookingpress\_json\_decode |
| [7163](#L7163) | \* |
| [7164](#L7164) | \* @param  mixed $values |
| [7165](#L7165) | \* @param  mixed $as\_array |
| [7166](#L7166) | \* @return void |
| [7167](#L7167) | \*/ |
| [7168](#L7168) | function bookingpress\_json\_decode( $values, $as\_array = false ){ |
| [7169](#L7169) | if( is\_array( $values ) ){ |
| [7170](#L7170) | return $values; |
| [7171](#L7171) | } |
| [7172](#L7172) |  |
| [7173](#L7173) | if( is\_object( $values ) && $as\_array == false ){ |
| [7174](#L7174) | return $values; |
| [7175](#L7175) | } else if( is\_object( $values ) && true == $as\_array ){ |
| [7176](#L7176) | return json\_decode( wp\_json\_encode( $values ), true ); |
| [7177](#L7177) | } |
| [7178](#L7178) |  |
| [7179](#L7179) | $return\_array = json\_decode( $values, $as\_array ); |
| [7180](#L7180) | if( json\_last\_error() != JSON\_ERROR\_NONE ){ |
| [7181](#L7181) | $return\_array = maybe\_unserialize( $values ); |
| [7182](#L7182) | if( !$as\_array ){ |
| [7183](#L7183) | $return\_array = (object)$return\_array; |
| [7184](#L7184) | } |
| [7185](#L7185) | } |
| [7186](#L7186) | return $return\_array; |
| [7187](#L7187) | } |
| [7188](#L7188) |  |
| [7189](#L7189) | /\*\* |
| [7190](#L7190) | \* Get service data with category grouping |
| [7191](#L7191) | \* |
| [7192](#L7192) | \* @return void |
| [7193](#L7193) | \*/ |
| [7194](#L7194) | public function get\_bookingpress\_service\_data\_group\_with\_category() |
| [7195](#L7195) | { |
| [7196](#L7196) | global $wpdb, $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services; |
| [7197](#L7197) |  |
| [7198](#L7198) | $bookingpress\_currency\_name   = $this->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [7199](#L7199) | $bookingpress\_currency\_symbol = ! empty($bookingpress\_currency\_name) ? $this->bookingpress\_get\_currency\_symbol($bookingpress\_currency\_name) : ''; |
| [7200](#L7200) |  |
| [7201](#L7201) | $bookingpress\_services\_details   = array(); |
| [7202](#L7202) |  |
| [7203](#L7203) | //Get all uncategorized services |
| [7204](#L7204) | $bookingpress\_get\_uncategorized\_services = $wpdb->get\_results($wpdb->prepare("SELECT \* FROM $tbl\_bookingpress\_services WHERE bookingpress\_category\_id = %d ORDER BY bookingpress\_service\_id DESC", 0), ARRAY\_A); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_services is table name |
| [7205](#L7205) | if(!empty($bookingpress\_get\_uncategorized\_services)){ |
| [7206](#L7206) | foreach($bookingpress\_get\_uncategorized\_services as $uncat\_ser\_key => $uncat\_ser\_val){ |
| [7207](#L7207) | $bookingpress\_service\_price = $this->bookingpress\_price\_formatter\_with\_currency\_symbol($uncat\_ser\_val['bookingpress\_service\_price'], $bookingpress\_currency\_symbol); |
| [7208](#L7208) |  |
| [7209](#L7209) | $bookingpress\_tmp\_services[] = array( |
| [7210](#L7210) | 'service\_id'                     => $uncat\_ser\_val['bookingpress\_service\_id'], |
| [7211](#L7211) | 'service\_name'                   => stripslashes\_deep($uncat\_ser\_val['bookingpress\_service\_name']), |
| [7212](#L7212) | 'service\_price'                  => $bookingpress\_service\_price, |
| [7213](#L7213) | 'service\_price\_without\_currency' => $uncat\_ser\_val['bookingpress\_service\_price'], |
| [7214](#L7214) | 'service\_price\_currency'         => $bookingpress\_currency\_symbol, |
| [7215](#L7215) | 'service\_duration'               => $uncat\_ser\_val['bookingpress\_service\_duration\_val'], |
| [7216](#L7216) | 'service\_duration\_unit'          => $uncat\_ser\_val['bookingpress\_service\_duration\_unit'], |
| [7217](#L7217) | ); |
| [7218](#L7218) | } |
| [7219](#L7219) |  |
| [7220](#L7220) | $bookingpress\_services\_details[] = array( |
| [7221](#L7221) | 'category\_id'       => 0, |
| [7222](#L7222) | 'category\_name'     => esc\_html\_\_('Uncategorized', 'bookingpress-appointment-booking'), |
| [7223](#L7223) | 'category\_services' => $bookingpress\_tmp\_services, |
| [7224](#L7224) | ); |
| [7225](#L7225) | } |
| [7226](#L7226) |  |
| [7227](#L7227) | $bookingpress\_service\_categories = $wpdb->get\_results('SELECT \* FROM ' . $tbl\_bookingpress\_categories . ' WHERE bookingpress\_category\_id != 0 ORDER BY bookingpress\_category\_position ASC', ARRAY\_A);// phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_categories is table name defined globally. False alarm |
| [7228](#L7228) | foreach ( $bookingpress\_service\_categories as $bookingpress\_service\_cat\_key => $bookingpress\_service\_cat\_val ) { |
| [7229](#L7229) | $bookingpress\_cat\_id       = $bookingpress\_service\_cat\_val['bookingpress\_category\_id']; |
| [7230](#L7230) | $bookingpress\_tmp\_services = array(); |
| [7231](#L7231) | $bookingpress\_services     = $wpdb->get\_results($wpdb->prepare('SELECT \* FROM ' . $tbl\_bookingpress\_services . ' WHERE bookingpress\_category\_id = %d', $bookingpress\_cat\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False alarm |
| [7232](#L7232) | foreach ( $bookingpress\_services as $bookingpress\_service\_key => $bookingpress\_service\_val ) { |
| [7233](#L7233) | $bookingpress\_service\_price = $this->bookingpress\_price\_formatter\_with\_currency\_symbol($bookingpress\_service\_val['bookingpress\_service\_price'], $bookingpress\_currency\_symbol); |
| [7234](#L7234) |  |
| [7235](#L7235) | $bookingpress\_tmp\_services[] = array( |
| [7236](#L7236) | 'service\_id'                     => $bookingpress\_service\_val['bookingpress\_service\_id'], |
| [7237](#L7237) | 'service\_name'                   => stripslashes\_deep($bookingpress\_service\_val['bookingpress\_service\_name']), |
| [7238](#L7238) | 'service\_price'                  => $bookingpress\_service\_price, |
| [7239](#L7239) | 'service\_price\_without\_currency' => $bookingpress\_service\_val['bookingpress\_service\_price'], |
| [7240](#L7240) | 'service\_price\_currency'         => $bookingpress\_currency\_symbol, |
| [7241](#L7241) | 'service\_duration'               => $bookingpress\_service\_val['bookingpress\_service\_duration\_val'], |
| [7242](#L7242) | 'service\_duration\_unit'          => $bookingpress\_service\_val['bookingpress\_service\_duration\_unit'], |
| [7243](#L7243) | ); |
| [7244](#L7244) | } |
| [7245](#L7245) |  |
| [7246](#L7246) | if (! empty($bookingpress\_tmp\_services) ) { |
| [7247](#L7247) | $bookingpress\_services\_details[] = array( |
| [7248](#L7248) | 'category\_id'       => $bookingpress\_cat\_id, |
| [7249](#L7249) | 'category\_name'     => stripslashes\_deep($bookingpress\_service\_cat\_val['bookingpress\_category\_name']), |
| [7250](#L7250) | 'category\_services' => $bookingpress\_tmp\_services, |
| [7251](#L7251) | ); |
| [7252](#L7252) | } |
| [7253](#L7253) | } |
| [7254](#L7254) |  |
| [7255](#L7255) | return $bookingpress\_services\_details; |
| [7256](#L7256) | } |
| [7257](#L7257) |  |
| [7258](#L7258) | /\*\* |
| [7259](#L7259) | \* Core function for insert appointment table details |
| [7260](#L7260) | \* |
| [7261](#L7261) | \* @param  mixed $appointment\_booking\_data |
| [7262](#L7262) | \* @return void |
| [7263](#L7263) | \*/ |
| [7264](#L7264) | function bookingpress\_insert\_appointment\_logs( $appointment\_booking\_data = array() ) |
| [7265](#L7265) | { |
| [7266](#L7266) | global $wpdb, $tbl\_bookingpress\_appointment\_bookings; |
| [7267](#L7267) | $appointment\_inserted\_id = 0; |
| [7268](#L7268) | if (! empty($appointment\_booking\_data) ) { |
| [7269](#L7269) | $wpdb->insert($tbl\_bookingpress\_appointment\_bookings, $appointment\_booking\_data); |
| [7270](#L7270) | $appointment\_inserted\_id = $wpdb->insert\_id; |
| [7271](#L7271) | do\_action('bookingpress\_after\_insert\_appointment', $appointment\_inserted\_id); |
| [7272](#L7272) | } |
| [7273](#L7273) | return $appointment\_inserted\_id; |
| [7274](#L7274) | } |
| [7275](#L7275) |  |
| [7276](#L7276) |  |
| [7277](#L7277) | /\*\* |
| [7278](#L7278) | \* Core function for insert payment logs data |
| [7279](#L7279) | \* |
| [7280](#L7280) | \* @param  mixed $payment\_log\_data |
| [7281](#L7281) | \* @return void |
| [7282](#L7282) | \*/ |
| [7283](#L7283) | function bookingpress\_insert\_payment\_logs( $payment\_log\_data = array() ) |
| [7284](#L7284) | { |
| [7285](#L7285) | global $wpdb, $tbl\_bookingpress\_payment\_logs; |
| [7286](#L7286) | $payment\_log\_id = 0; |
| [7287](#L7287) | if (! empty($payment\_log\_data) ) { |
| [7288](#L7288) | $wpdb->insert($tbl\_bookingpress\_payment\_logs, $payment\_log\_data); |
| [7289](#L7289) | $payment\_log\_id = $wpdb->insert\_id; |
| [7290](#L7290) | } |
| [7291](#L7291) |  |
| [7292](#L7292) | return $payment\_log\_id; |
| [7293](#L7293) | } |
| [7294](#L7294) |  |
| [7295](#L7295) |  |
| [7296](#L7296) | /\*\* |
| [7297](#L7297) | \* Get service details from specific ID |
| [7298](#L7298) | \* |
| [7299](#L7299) | \* @param  mixed $service\_id |
| [7300](#L7300) | \* @return void |
| [7301](#L7301) | \*/ |
| [7302](#L7302) | function get\_service\_by\_id( $service\_id ) |
| [7303](#L7303) | { |
| [7304](#L7304) | global $wpdb, $tbl\_bookingpress\_services; |
| [7305](#L7305) | $service\_data = array(); |
| [7306](#L7306) | if (! empty($service\_id) ) { |
| [7307](#L7307) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [7308](#L7308) | $service\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $service\_id), ARRAY\_A); |
| [7309](#L7309) | } |
| [7310](#L7310) | return $service\_data; |
| [7311](#L7311) | } |
| [7312](#L7312) |  |
| [7313](#L7313) |  |
| [7314](#L7314) | /\*\* |
| [7315](#L7315) | \* Get customer details from specific customer id |
| [7316](#L7316) | \* |
| [7317](#L7317) | \* @param  mixed $customer\_id |
| [7318](#L7318) | \* @return void |
| [7319](#L7319) | \*/ |
| [7320](#L7320) | function get\_customer\_details( $customer\_id ) |
| [7321](#L7321) | { |
| [7322](#L7322) | global $wpdb, $tbl\_bookingpress\_customers; |
| [7323](#L7323) | $customer\_data = array(); |
| [7324](#L7324) | if (! empty($customer\_id) ) { |
| [7325](#L7325) | // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [7326](#L7326) | $customer\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_customer\_id =%d", $customer\_id), ARRAY\_A); |
| [7327](#L7327) | } |
| [7328](#L7328) | return $customer\_data; |
| [7329](#L7329) | } |
| [7330](#L7330) |  |
| [7331](#L7331) | /\*\* |
| [7332](#L7332) | \* Install default notification data |
| [7333](#L7333) | \* |
| [7334](#L7334) | \* @return void |
| [7335](#L7335) | \*/ |
| [7336](#L7336) | function bookingpress\_install\_default\_notification\_data() |
| [7337](#L7337) | { |
| [7338](#L7338) | global $wpdb, $tbl\_bookingpress\_notifications; |
| [7339](#L7339) |  |
| [7340](#L7340) | $bookingpress\_default\_notifications\_name\_arr = array( 'Appointment Approved', 'Appointment Pending', 'Appointment Rejected', 'Appointment Canceled', 'Share Appointment URL' ); |
| [7341](#L7341) |  |
| [7342](#L7342) | $bookingpress\_default\_notifications\_message\_arr = array( |
| [7343](#L7343) | 'Appointment Approved' => sprintf( esc\_html\_\_('Dear %1$s %2$s,%3$sYou have successfully scheduled appointment.%3$sThank you for choosing us,%3$s%4$s','bookingpress-appointment-booking'), '%customer\_first\_name%', '%customer\_last\_name%', '<br/>', '%company\_name%' ), // phpcs:ignore |
| [7344](#L7344) | 'Appointment Pending'  => sprintf( esc\_html\_\_('Dear %1$s %2$s,%3$sThe %4$s appointment is scheduled and it is waiting for a confirmation.%3$sThank you for choosing us,%3$s%5$s','bookingpress-appointment-booking'), '%customer\_first\_name%', '%customer\_last\_name%', '<br/>', '%service\_name%', '%company\_name%' ), // phpcs:ignore |
| [7345](#L7345) | 'Appointment Rejected' => sprintf( esc\_html\_\_('Dear %1$s %2$s,%3$sThe %4$s appointment, has been rejected.%3$sThank you for choosing us,%3$s%5$s','bookingpress-appointment-booking'), '%customer\_first\_name%', '%customer\_last\_name%', '<br/>', '%service\_name%', '%company\_name%' ), // phpcs:ignore |
| [7346](#L7346) | 'Appointment Canceled' => sprintf( esc\_html\_\_('Dear %1$s %2$s,%3$sThe %4$s appointment, has been canceled.%3$sThank you for choosing us,%3$s%5$s','bookingpress-appointment-booking'), '%customer\_first\_name%', '%customer\_last\_name%', '<br/>', '%service\_name%', '%company\_name%' ), // phpcs:ignore |
| [7347](#L7347) | 'Share Appointment URL' => sprintf( esc\_html\_\_('Hi%1$sPlease book your appointment with following URL: %1$s%2$s%1$sThanks,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%share\_appointment\_url%', '%company\_name%' ), // phpcs:ignore |
| [7348](#L7348) | ); |
| [7349](#L7349) |  |
| [7350](#L7350) | foreach ( $bookingpress\_default\_notifications\_name\_arr as $bookingpress\_default\_notification\_key => $bookingpress\_default\_notification\_val ) { |
| [7351](#L7351) | $bookingpress\_customer\_notification\_data = array( |
| [7352](#L7352) | 'bookingpress\_notification\_name'    => $bookingpress\_default\_notification\_val, |
| [7353](#L7353) | 'bookingpress\_notification\_receiver\_type' => 'customer', |
| [7354](#L7354) | 'bookingpress\_notification\_status'  => 1, |
| [7355](#L7355) | 'bookingpress\_notification\_type'    => 'default', |
| [7356](#L7356) | 'bookingpress\_notification\_subject' => ($bookingpress\_default\_notification\_val == "Share Appointment URL") ? esc\_html\_\_('Book your appointment now', 'bookingpress-appointment-booking') : $bookingpress\_default\_notification\_val, |
| [7357](#L7357) | 'bookingpress\_notification\_message' => $bookingpress\_default\_notifications\_message\_arr[ $bookingpress\_default\_notification\_val ], |
| [7358](#L7358) | 'bookingpress\_created\_at'           => current\_time('mysql'), |
| [7359](#L7359) | ); |
| [7360](#L7360) |  |
| [7361](#L7361) | $resp = $wpdb->insert($tbl\_bookingpress\_notifications, $bookingpress\_customer\_notification\_data); |
| [7362](#L7362) | $db\_data = array( |
| [7363](#L7363) | 'last\_query' => $wpdb->last\_query, |
| [7364](#L7364) | 'last\_error' => $wpdb->last\_error, |
| [7365](#L7365) | 'resposne' => $resp |
| [7366](#L7366) | ); |
| [7367](#L7367) |  |
| [7368](#L7368) | update\_option( 'bpa\_default\_notificat\_data\_query\_details\_'. $bookingpress\_default\_notification\_val.'\_'. date( 'Y-m-d H:i:s', current\_time('timestamp') ), wp\_json\_encode( $db\_data) ); |
| [7369](#L7369) | } |
| [7370](#L7370) |  |
| [7371](#L7371) | $bookingpress\_default\_notifications\_arr2 = array( |
| [7372](#L7372) | 'Appointment Approved' => sprintf( esc\_html\_\_('Hi administrator,%1$sYou have one confirmed %2$s appointment. The appointment is added to your schedule.%1$sThank you,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%service\_name%', '%company\_name%' ), //phpcs:ignore |
| [7373](#L7373) | 'Appointment Pending'  => sprintf( esc\_html\_\_('Hi administrator,%1$sYou have new appointment in %2$s. The appointment is waiting for a confirmation.%1$sThank you,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%service\_name%', '%company\_name%' ), //phpcs:ignore |
| [7374](#L7374) | 'Appointment Rejected' => sprintf( esc\_html\_\_('Hi administrator,%1$sYour %2$s appointment, has been rejected.%1$sThank you,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%service\_name%', '%company\_name%' ), //phpcs:ignore |
| [7375](#L7375) | 'Appointment Canceled' => sprintf( esc\_html\_\_('Hi administrator,%1$sYour %2$s appointment, has been canceled.%1$sThank you,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%service\_name%', '%company\_name%' ), //phpcs:ignore |
| [7376](#L7376) | 'Share Appointment URL' => sprintf( esc\_html\_\_('Hi administrator,%1$sFollowing appointment URL is shared with customer. %1$s%2$s%1$sThank you,%1$s%3$s','bookingpress-appointment-booking'), '<br/>', '%share\_appointment\_url%', '%company\_name%' ), //phpcs:ignore |
| [7377](#L7377) | ); |
| [7378](#L7378) |  |
| [7379](#L7379) | foreach ( $bookingpress\_default\_notifications\_name\_arr as $bookingpress\_default\_notification\_key => $bookingpress\_default\_notification\_val ) { |
| [7380](#L7380) | $bookingpress\_employee\_notification\_data = array( |
| [7381](#L7381) | 'bookingpress\_notification\_name'    => $bookingpress\_default\_notification\_val, |
| [7382](#L7382) | 'bookingpress\_notification\_receiver\_type' => 'employee', |
| [7383](#L7383) | 'bookingpress\_notification\_status'  => 1, |
| [7384](#L7384) | 'bookingpress\_notification\_type'    => 'default', |
| [7385](#L7385) | 'bookingpress\_notification\_subject' => ($bookingpress\_default\_notification\_val == "Share Appointment URL") ? esc\_html\_\_('Book your appointment now', 'bookingpress-appointment-booking') : $bookingpress\_default\_notification\_val, |
| [7386](#L7386) | 'bookingpress\_notification\_message' => $bookingpress\_default\_notifications\_arr2[ $bookingpress\_default\_notification\_val ], |
| [7387](#L7387) | 'bookingpress\_created\_at'           => current\_time('mysql'), |
| [7388](#L7388) | ); |
| [7389](#L7389) |  |
| [7390](#L7390) | $resp = $wpdb->insert($tbl\_bookingpress\_notifications, $bookingpress\_employee\_notification\_data); |
| [7391](#L7391) |  |
| [7392](#L7392) | $db\_data = array( |
| [7393](#L7393) | 'last\_query' => $wpdb->last\_query, |
| [7394](#L7394) | 'last\_error' => $wpdb->last\_error, |
| [7395](#L7395) | 'resposne' => $resp |
| [7396](#L7396) | ); |
| [7397](#L7397) |  |
| [7398](#L7398) | update\_option( 'bpa\_default\_notificat\_data\_query\_details\_second\_'. $bookingpress\_default\_notification\_val.'\_'. date( 'Y-m-d H:i:s', current\_time('timestamp') ), wp\_json\_encode( $db\_data) ); |
| [7399](#L7399) | } |
| [7400](#L7400) | } |
| [7401](#L7401) |  |
| [7402](#L7402) |  |
| [7403](#L7403) | /\*\* |
| [7404](#L7404) | \* Install default general settings data |
| [7405](#L7405) | \* |
| [7406](#L7406) | \* @return void |
| [7407](#L7407) | \*/ |
| [7408](#L7408) | function bookingpress\_install\_default\_general\_settings\_data() |
| [7409](#L7409) | { |
| [7410](#L7410) | global $BookingPress; |
| [7411](#L7411) | $default\_date\_format = get\_option('date\_format'); |
| [7412](#L7412) | if($default\_date\_format != 'F j, Y' && $default\_date\_format != 'd/m/Y'  && $default\_date\_format != 'm/d/Y'  && $default\_date\_format != 'Y-m-d' && $default\_date\_format != 'd.m.Y' && $default\_date\_format != 'd-m-Y' ) { |
| [7413](#L7413) | $default\_date\_format = 'F j, Y'; |
| [7414](#L7414) | } |
| [7415](#L7415) |  |
| [7416](#L7416) | $wp\_default\_time\_format  = get\_option('time\_format'); |
| [7417](#L7417) | if ($wp\_default\_time\_format == 'g:i a' || $wp\_default\_time\_format == 'g:i A') { |
| [7418](#L7418) | $wp\_default\_time\_format = 'g:i a'; |
| [7419](#L7419) | } elseif($wp\_default\_time\_format == 'H:i') { |
| [7420](#L7420) | $wp\_default\_time\_format = 'H:i'; |
| [7421](#L7421) | } else { |
| [7422](#L7422) | $wp\_default\_time\_format = 'g:i a'; |
| [7423](#L7423) | } |
| [7424](#L7424) |  |
| [7425](#L7425) | $bookingpress\_general\_setting\_form\_default\_data = array( |
| [7426](#L7426) | 'default\_time\_slot\_step'              => '30', |
| [7427](#L7427) | 'appointment\_status'                  => '1', |
| [7428](#L7428) | 'onsite\_appointment\_status'           => '2', |
| [7429](#L7429) | 'default\_phone\_country\_code'          => 'us', |
| [7430](#L7430) | 'per\_page\_item'                       => '20', |
| [7431](#L7431) | 'redirect\_url\_after\_booking\_approved' => '', |
| [7432](#L7432) | 'redirect\_url\_after\_booking\_pending'  => '', |
| [7433](#L7433) | 'redirect\_url\_after\_booking\_canceled' => '', |
| [7434](#L7434) | 'phone\_number\_mandatory'              => false, |
| [7435](#L7435) | 'share\_timeslot\_between\_services'     => false, |
| [7436](#L7436) | 'use\_already\_loaded\_vue'              => false, |
| [7437](#L7437) | 'load\_js\_css\_all\_pages'               => false, |
| [7438](#L7438) | 'show\_time\_as\_per\_service\_duration'   => 'true', |
| [7439](#L7439) | 'default\_time\_slot'                   => '30', |
| [7440](#L7440) | 'default\_date\_format'                 => $default\_date\_format, |
| [7441](#L7441) | 'default\_time\_format'                 => $wp\_default\_time\_format, |
| [7442](#L7442) | 'anonymous\_data'                              => 'false', |
| [7443](#L7443) | 'debug\_mode'                          => false, |
| [7444](#L7444) | 'bpa\_afternoon\_start\_time'            => '12:00:00', |
| [7445](#L7445) | 'bpa\_evening\_start\_time'              => '16:00:00', |
| [7446](#L7446) | 'bpa\_night\_start\_time'                => '20:00:00', |
| [7447](#L7447) | ); |
| [7448](#L7448) |  |
| [7449](#L7449) | $bookingpress\_company\_setting\_form\_default\_data      = array( |
| [7450](#L7450) | 'company\_avatar\_img'    => '', |
| [7451](#L7451) | 'company\_avatar\_url'    => '', |
| [7452](#L7452) | 'company\_avatar\_list'   => array(), |
| [7453](#L7453) | 'company\_name'          => get\_option('blogname'), |
| [7454](#L7454) | 'company\_address'       => '', |
| [7455](#L7455) | 'company\_website'       => '', |
| [7456](#L7456) | 'company\_phone\_country' => 'us', |
| [7457](#L7457) | 'company\_phone\_number'  => '', |
| [7458](#L7458) | ); |
| [7459](#L7459) | $bookingpress\_notification\_setting\_form\_default\_data = array( |
| [7460](#L7460) | 'selected\_mail\_service' => 'wp\_mail', |
| [7461](#L7461) | 'sender\_name'           => get\_option('blogname'), |
| [7462](#L7462) | 'sender\_email'          => get\_option('admin\_email'), |
| [7463](#L7463) | 'admin\_email'           => get\_option('admin\_email'), |
| [7464](#L7464) | 'success\_url'           => '', |
| [7465](#L7465) | 'cancel\_url'            => '', |
| [7466](#L7466) | 'smtp\_host'             => '', |
| [7467](#L7467) | 'smtp\_port'             => '', |
| [7468](#L7468) | 'smtp\_secure'           => 'Disabled', |
| [7469](#L7469) | 'smtp\_username'         => '', |
| [7470](#L7470) | 'smtp\_password'         => '', |
| [7471](#L7471) | 'gmail\_client\_ID'       => '', |
| [7472](#L7472) | 'gmail\_client\_secret'   => '', |
| [7473](#L7473) | 'gmail\_redirect\_url'    => '', |
| [7474](#L7474) | 'gmail\_auth\_secret'     => '', |
| [7475](#L7475) | 'bookingpress\_gmail\_auth' => '', |
| [7476](#L7476) | 'bookingpress\_response\_email' => '', |
| [7477](#L7477) | 'bookingpress\_gmail\_auth\_token' => '', |
| [7478](#L7478) | ); |
| [7479](#L7479) | $bookingpress\_payment\_setting\_form\_default\_data      = array( |
| [7480](#L7480) | 'payment\_default\_currency' => 'USD', |
| [7481](#L7481) | 'price\_symbol\_position'    => 'before', |
| [7482](#L7482) | 'price\_separator'          => 'comma-dot', |
| [7483](#L7483) | 'price\_number\_of\_decimals' => 2, |
| [7484](#L7484) | 'on\_site\_payment'          => true, |
| [7485](#L7485) | 'paypal\_payment'           => false, |
| [7486](#L7486) | 'paypal\_cancel\_url'        => BOOKINGPRESS\_HOME\_URL, |
| [7487](#L7487) | 'paypal\_payment\_mode'      => 'sandbox', |
| [7488](#L7488) | ); |
| [7489](#L7489) | $bookingpress\_message\_setting\_form\_default\_data      = array( |
| [7490](#L7490) | 'appointment\_booked\_successfully'       => esc\_html\_\_('Appointment has been booked successfully.','bookingpress-appointment-booking'), |
| [7491](#L7491) | 'appointment\_cancelled\_successfully'    => esc\_html\_\_('Appointment has been cancelled successfully.','bookingpress-appointment-booking'), |
| [7492](#L7492) | 'duplidate\_appointment\_time\_slot\_found' => esc\_html\_\_('I am sorry! Another appointment is already booked with this time slot. Please select another time slot which suits you the best.','bookingpress-appointment-booking'), |
| [7493](#L7493) | 'unsupported\_currecy\_selected\_for\_the\_payment' => esc\_html\_\_('I am sorry! The selected currency is not supported by selected payment gateway. Please proceed with another available payment method.','bookingpress-appointment-booking'), |
| [7494](#L7494) | 'duplicate\_email\_address\_found'         => esc\_html\_\_('It seems that you are already registered with us! Please login to continue to book an appointment.','bookingpress-appointment-booking'), |
| [7495](#L7495) | 'no\_payment\_method\_is\_selected\_for\_the\_booking' => esc\_html\_\_('Please select a payment method to proceed with the booking.','bookingpress-appointment-booking'), |
| [7496](#L7496) | 'no\_appointment\_time\_selected\_for\_the\_booking' => esc\_html\_\_('Please select a time slot to proceed with the booking.','bookingpress-appointment-booking'), |
| [7497](#L7497) | 'no\_appointment\_date\_selected\_for\_the\_booking' => esc\_html\_\_('Please select appointment date to proceed with the booking.','bookingpress-appointment-booking'), |
| [7498](#L7498) | 'no\_service\_selected\_for\_the\_booking'   => esc\_html\_\_('Please select any service to book an appointment.','bookingpress-appointment-booking'), |
| [7499](#L7499) | 'no\_payment\_method\_available'  => esc\_html\_\_('There is no payment method available.','bookingpress-appointment-booking'), |
| [7500](#L7500) | 'no\_timeslots\_available'  => esc\_html\_\_('There is no time slots available','bookingpress-appointment-booking'), |
| [7501](#L7501) | 'cancel\_appointment\_confirmation'  => esc\_html\_\_('Cancel appointment confirmation','bookingpress-appointment-booking'), |
| [7502](#L7502) | 'no\_appointment\_available\_for\_cancel'  => esc\_html\_\_('There is no appointment to cancel','bookingpress-appointment-booking'), |
| [7503](#L7503) | ); |
| [7504](#L7504) | $bookingpress\_customer\_setting\_form\_default\_data     = array( |
| [7505](#L7505) | 'allow\_wp\_user\_create' => 'false', |
| [7506](#L7506) | 'allow\_autologin\_user' => 'true' |
| [7507](#L7507) | ); |
| [7508](#L7508) | $bookingpress\_invoice\_setting\_default\_data           = array( |
| [7509](#L7509) | 'bookingpress\_last\_invoice\_id' => 0, |
| [7510](#L7510) | ); |
| [7511](#L7511) | $bookingpress\_install\_default\_data                   = array( |
| [7512](#L7512) | 'general\_setting'               => $bookingpress\_general\_setting\_form\_default\_data, |
| [7513](#L7513) | 'company\_setting'               => $bookingpress\_company\_setting\_form\_default\_data, |
| [7514](#L7514) | 'notification\_setting'          => $bookingpress\_notification\_setting\_form\_default\_data, |
| [7515](#L7515) | 'payment\_setting'               => $bookingpress\_payment\_setting\_form\_default\_data, |
| [7516](#L7516) | 'message\_setting'               => $bookingpress\_message\_setting\_form\_default\_data, |
| [7517](#L7517) | 'customer\_setting'              => $bookingpress\_customer\_setting\_form\_default\_data, |
| [7518](#L7518) | 'invoice\_Setting'               => $bookingpress\_invoice\_setting\_default\_data, |
| [7519](#L7519) | ); |
| [7520](#L7520) |  |
| [7521](#L7521) | foreach ( $bookingpress\_install\_default\_data as $bookingpress\_default\_data\_key => $bookingpress\_default\_data\_val ) { |
| [7522](#L7522) | $bookingpress\_setting\_type = $bookingpress\_default\_data\_key; |
| [7523](#L7523) | foreach ( $bookingpress\_default\_data\_val as $bookingpress\_default\_data\_val\_key => $bookingpress\_default\_data\_val2 ) { |
| [7524](#L7524) | $BookingPress->bookingpress\_update\_settings($bookingpress\_default\_data\_val\_key, $bookingpress\_setting\_type, $bookingpress\_default\_data\_val2); |
| [7525](#L7525) | } |
| [7526](#L7526) | } |
| [7527](#L7527) |  |
| [7528](#L7528) | global $tbl\_bookingpress\_default\_workhours, $wpdb; |
| [7529](#L7529) |  |
| [7530](#L7530) | // Install default workhours data |
| [7531](#L7531) | $bookingpress\_default\_days = array( 'monday', 'tuesday', 'wednesday', 'thursday', 'friday', 'saturday', 'sunday' ); |
| [7532](#L7532) | foreach ( $bookingpress\_default\_days as $bookingpress\_default\_day\_key => $bookingpress\_default\_day\_val ) { |
| [7533](#L7533) | $default\_start\_time = '09:00'; |
| [7534](#L7534) | $default\_end\_time   = '17:00'; |
| [7535](#L7535) |  |
| [7536](#L7536) | $default\_insert\_data = array( |
| [7537](#L7537) | 'bookingpress\_workday\_key' => $bookingpress\_default\_day\_val, |
| [7538](#L7538) | ); |
| [7539](#L7539) |  |
| [7540](#L7540) | if ($bookingpress\_default\_day\_val != 'saturday' && $bookingpress\_default\_day\_val != 'sunday' ) { |
| [7541](#L7541) | $default\_insert\_data['bookingpress\_start\_time'] = $default\_start\_time; |
| [7542](#L7542) | $default\_insert\_data['bookingpress\_end\_time']   = $default\_end\_time; |
| [7543](#L7543) | } else { |
| [7544](#L7544) | $default\_insert\_data['bookingpress\_start\_time'] = null; |
| [7545](#L7545) | $default\_insert\_data['bookingpress\_end\_time']   = null; |
| [7546](#L7546) | } |
| [7547](#L7547) |  |
| [7548](#L7548) | $wpdb->insert($tbl\_bookingpress\_default\_workhours, $default\_insert\_data); |
| [7549](#L7549) | } |
| [7550](#L7550) | } |
| [7551](#L7551) |  |
| [7552](#L7552) | /\*\* |
| [7553](#L7553) | \* Install default customize settings data |
| [7554](#L7554) | \* |
| [7555](#L7555) | \* @return void |
| [7556](#L7556) | \*/ |
| [7557](#L7557) | function bookingpress\_install\_default\_customize\_settings\_data() |
| [7558](#L7558) | { |
| [7559](#L7559) | global $wpdb, $tbl\_bookingpress\_customize\_settings, $tbl\_bookingpress\_form\_fields, $BookingPress; |
| [7560](#L7560) |  |
| [7561](#L7561) | $booking\_form\_shortcode\_default\_fields = array( |
| [7562](#L7562) | 'service\_title'                   => esc\_html\_\_('Service', 'bookingpress-appointment-booking'), |
| [7563](#L7563) | 'datetime\_title'                  => str\_replace( '&amp;', '&', esc\_html\_\_('Date & Time', 'bookingpress-appointment-booking') ), |
| [7564](#L7564) | 'basic\_details\_title'             => esc\_html\_\_('Basic Details', 'bookingpress-appointment-booking'), |
| [7565](#L7565) | 'summary\_title'                   => esc\_html\_\_('Summary', 'bookingpress-appointment-booking'), |
| [7566](#L7566) | 'category\_title'                  => esc\_html\_\_('Select Category', 'bookingpress-appointment-booking'), |
| [7567](#L7567) | 'service\_heading\_title'           => esc\_html\_\_('Select Service', 'bookingpress-appointment-booking'), |
| [7568](#L7568) | 'default\_image\_url'               => BOOKINGPRESS\_URL . '/images/placeholder-img.jpg', |
| [7569](#L7569) | 'timeslot\_text'                   => esc\_html\_\_('Time Slot', 'bookingpress-appointment-booking'), |
| [7570](#L7570) | 'morning\_text'                    => esc\_html\_\_('Morning', 'bookingpress-appointment-booking'), |
| [7571](#L7571) | 'afternoon\_text'                  => esc\_html\_\_('Afternoon', 'bookingpress-appointment-booking'), |
| [7572](#L7572) | 'evening\_text'                    => esc\_html\_\_('Evening', 'bookingpress-appointment-booking'), |
| [7573](#L7573) | 'night\_text'                      => esc\_html\_\_('Night', 'bookingpress-appointment-booking'), |
| [7574](#L7574) | 'date\_time\_step\_note'             => '', |
| [7575](#L7575) | 'summary\_step\_note'               => '', |
| [7576](#L7576) | 'summary\_content\_text'            => esc\_html\_\_('Your appointment booking summary', 'bookingpress-appointment-booking'), |
| [7577](#L7577) | 'payment\_method\_text'             => esc\_html\_\_('Select Payment Method', 'bookingpress-appointment-booking'), |
| [7578](#L7578) | 'background\_color'                => '#fff', |
| [7579](#L7579) | 'price\_button\_text\_color'         => '#fff', |
| [7580](#L7580) | 'footer\_background\_color'         => '#f4f7fb', |
| [7581](#L7581) | 'border\_color'                    => '#CFD6E5', |
| [7582](#L7582) | 'primary\_color'                   => '#12D488', |
| [7583](#L7583) | 'primary\_background\_color'        => '#e2faf1', |
| [7584](#L7584) | 'label\_title\_color'               => '#202C45', |
| [7585](#L7585) | 'sub\_title\_color'                 => '#535D71', |
| [7586](#L7586) | 'content\_color'                   => '#727E95', |
| [7587](#L7587) | 'custom\_css'                      => '', |
| [7588](#L7588) | 'title\_font\_family'               => 'Poppins', |
| [7589](#L7589) | 'hide\_category\_service\_selection' => 'false', |
| [7590](#L7590) | 'booking\_form\_tabs\_position'      => 'left', |
| [7591](#L7591) | 'hide\_already\_booked\_slot'        => 'false', |
| [7592](#L7592) | 'display\_service\_description'     => 'true', |
| [7593](#L7593) | 'goback\_button\_text'              => esc\_html\_\_('Go Back', 'bookingpress-appointment-booking'), |
| [7594](#L7594) | 'next\_button\_text'                => esc\_html\_\_('Next:', 'bookingpress-appointment-booking'), |
| [7595](#L7595) | 'book\_appointment\_btn\_text'       => esc\_html\_\_('Book Appointment', 'bookingpress-appointment-booking'), |
| [7596](#L7596) | 'book\_appointment\_hours\_text'     => 'h', |
| [7597](#L7597) | 'book\_appointment\_min\_text'       => 'm', |
| [7598](#L7598) | 'paypal\_text'                     => esc\_html\_\_('PayPal', 'bookingpress-appointment-booking'), |
| [7599](#L7599) | 'locally\_text'                    => esc\_html\_\_('Pay Locally', 'bookingpress-appointment-booking'), |
| [7600](#L7600) | 'total\_amount\_text'               => esc\_html\_\_('Total Amount Payable', 'bookingpress-appointment-booking'), |
| [7601](#L7601) | 'service\_text'                    => esc\_html\_\_('Service', 'bookingpress-appointment-booking'), |
| [7602](#L7602) | 'customer\_text'                   => esc\_html\_\_('Customer', 'bookingpress-appointment-booking'), |
| [7603](#L7603) | 'date\_time\_text'                  => str\_replace( '&amp;', '&', esc\_html\_\_('Date & Time', 'bookingpress-appointment-booking') ), |
| [7604](#L7604) | 'appointment\_details'             => esc\_html\_\_('Appointment Details', 'bookingpress-appointment-booking'), |
| [7605](#L7605) | 'all\_category\_title'              => esc\_html\_\_('ALL', 'bookingpress-appointment-booking'), |
| [7606](#L7606) | 'service\_duration\_label'          => esc\_html\_\_('Duration', 'bookingpress-appointment-booking') . ':', |
| [7607](#L7607) | 'service\_price\_label'             => esc\_html\_\_('Price', 'bookingpress-appointment-booking') . ':', |
| [7608](#L7608) | 'default\_select\_all\_category'     => 'false', |
| [7609](#L7609) | ); |
| [7610](#L7610) |  |
| [7611](#L7611) | foreach ( $booking\_form\_shortcode\_default\_fields as $booking\_form\_shortcode\_data\_key => $booking\_form\_shortcode\_data\_val ) { |
| [7612](#L7612) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [7613](#L7613) | 'bookingpress\_setting\_name'  => $booking\_form\_shortcode\_data\_key, |
| [7614](#L7614) | 'bookingpress\_setting\_value' => $booking\_form\_shortcode\_data\_val, |
| [7615](#L7615) | 'bookingpress\_setting\_type'  => 'booking\_form', |
| [7616](#L7616) | ); |
| [7617](#L7617) | $resp = $wpdb->insert($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields); |
| [7618](#L7618) |  |
| [7619](#L7619) | $db\_data = array( |
| [7620](#L7620) | 'last\_query' => $wpdb->last\_query, |
| [7621](#L7621) | 'last\_error' => $wpdb->last\_error, |
| [7622](#L7622) | 'resposne' => $resp |
| [7623](#L7623) | ); |
| [7624](#L7624) |  |
| [7625](#L7625) | update\_option( 'booking\_form\_shortcode\_default\_fields\_'. $booking\_form\_shortcode\_data\_key.'\_'. date( 'Y-m-d H:i:s', current\_time('timestamp') ), wp\_json\_encode( $db\_data) ); |
| [7626](#L7626) | } |
| [7627](#L7627) |  |
| [7628](#L7628) | $mybookings\_shortcode\_default\_data = array( |
| [7629](#L7629) | 'mybooking\_title\_text'        => esc\_html\_\_('My Bookings', 'bookingpress-appointment-booking'), |
| [7630](#L7630) | 'hide\_customer\_details'       => 'false', |
| [7631](#L7631) | 'hide\_search\_bar'             => 'false', |
| [7632](#L7632) | 'allow\_to\_cancel\_appointment' => 'true', |
| [7633](#L7633) | 'apply\_button\_title'          => esc\_html\_\_('Apply', 'bookingpress-appointment-booking'), |
| [7634](#L7634) | 'search\_appointment\_title'    => esc\_html\_\_('Search appointments', 'bookingpress-appointment-booking'), |
| [7635](#L7635) | 'search\_date\_title'           => esc\_html\_\_('Please select date', 'bookingpress-appointment-booking'), |
| [7636](#L7636) | 'search\_end\_date\_title'           => esc\_html\_\_('Please select date', 'bookingpress-appointment-booking'), |
| [7637](#L7637) | 'my\_appointment\_menu\_title'    => esc\_html\_\_('My Appointments', 'bookingpress-appointment-booking'), |
| [7638](#L7638) | 'delete\_appointment\_menu\_title'    => esc\_html\_\_('Delete Account', 'bookingpress-appointment-booking'), |
| [7639](#L7639) | 'cancel\_appointment\_title' => esc\_html\_\_('Cancel Appointment', 'bookingpress-appointment-booking'), |
| [7640](#L7640) | 'cancel\_appointment\_confirmation\_message' => esc\_html\_\_('Are you sure you want to cancel the appointment?', 'bookingpress-appointment-booking'), |
| [7641](#L7641) | 'cancel\_appointment\_no\_btn\_text' => esc\_html\_\_('No', 'bookingpress-appointment-booking'), |
| [7642](#L7642) | 'cancel\_appointment\_yes\_btn\_text' => esc\_html\_\_('Yes', 'bookingpress-appointment-booking'), |
| [7643](#L7643) | 'id\_main\_heading' => esc\_html\_\_('ID', 'bookingpress-appointment-booking'), |
| [7644](#L7644) | 'service\_main\_heading' => esc\_html\_\_('Service', 'bookingpress-appointment-booking'), |
| [7645](#L7645) | 'date\_main\_heading' => esc\_html\_\_('Date', 'bookingpress-appointment-booking'), |
| [7646](#L7646) | 'status\_main\_heading' => esc\_html\_\_('Status', 'bookingpress-appointment-booking'), |
| [7647](#L7647) | 'payment\_main\_heading' => esc\_html\_\_('Payment', 'bookingpress-appointment-booking'), |
| [7648](#L7648) | 'booking\_id\_heading' => esc\_html\_\_('Booking ID', 'bookingpress-appointment-booking'), |
| [7649](#L7649) | 'booking\_time\_title' => esc\_html\_\_('Time', 'bookingpress-appointment-booking'), |
| [7650](#L7650) | 'payment\_details\_title' => esc\_html\_\_('Payment Details', 'bookingpress-appointment-booking'), |
| [7651](#L7651) | 'payment\_method\_title' => esc\_html\_\_('Payment Method', 'bookingpress-appointment-booking'), |
| [7652](#L7652) | 'total\_amount\_title' => esc\_html\_\_('Total Amount', 'bookingpress-appointment-booking'), |
| [7653](#L7653) | 'cancel\_booking\_id\_text' => esc\_html\_\_('Booking ID', 'bookingpress-appointment-booking'), |
| [7654](#L7654) | 'cancel\_service\_text' => esc\_html\_\_('Service', 'bookingpress-appointment-booking'), |
| [7655](#L7655) | 'cancel\_date\_time\_text' => str\_replace( '&amp;', '&', esc\_html\_\_('Date & Time', 'bookingpress-appointment-booking') ), |
| [7656](#L7656) | 'cancel\_button\_text' => esc\_html\_\_('Confirm Cancellation', 'bookingpress-appointment-booking'), |
| [7657](#L7657) | 'delete\_account\_content' => '<div class="bpa-front-cp-delete-account-wrapper"> |
| [7658](#L7658) | <div class="bpa-front-dcw\_\_vector"> |
| [7659](#L7659) | <svg width="306" height="187" viewBox="0 0 306 187" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [7660](#L7660) | <path opacity="0.3" d="M211.536 186.663C212.664 185.998 213.781 185.31 214.886 184.601C228.966 175.555 241.049 162.228 245.039 145.975C249.03 129.722 243.319 110.575 229.022 101.876C216.592 94.3128 200.676 95.7294 186.676 99.6925C172.675 103.654 159.189 109.917 144.716 111.417C127.574 113.193 109.197 108.323 93.6292 115.715C76.351 123.918 68.5627 146.337 74.1599 164.628C76.7263 173.011 81.6272 180.396 87.9578 186.431L211.536 186.663Z" fill="#E9EDF5"/> |
| [7661](#L7661) | <path opacity="0.6" d="M103.995 186.593L103.943 186.56C102.839 185.858 101.747 185.134 100.695 184.407C85.3464 173.787 74.9624 159.448 71.4556 144.032C67.3307 125.9 73.8934 106.47 87.0587 97.837C97.3193 91.1084 111.161 90.3286 128.202 95.5185C132.633 96.8688 137.08 98.4988 141.382 100.077C150.216 103.317 159.351 106.669 168.749 107.714C174.567 108.36 180.631 108.151 186.496 107.945C197.282 107.568 208.434 107.18 218.24 112.195C234.362 120.437 242.849 143.415 237.159 163.415C234.703 172.048 229.708 178.879 220.457 186.255L220.4 186.3H220.327L103.995 186.593ZM107.813 92.5555C99.8804 92.5555 93.0179 94.4349 87.2908 98.1898C74.2661 106.731 67.7803 125.971 71.8668 143.939C75.3497 159.251 85.674 173.499 100.935 184.06C101.965 184.773 103.034 185.483 104.117 186.17L220.253 185.877C229.392 178.577 234.329 171.822 236.754 163.297C242.391 143.48 233.999 120.724 218.047 112.569C208.337 107.604 197.241 107.993 186.509 108.365C180.629 108.571 174.551 108.783 168.702 108.132C159.251 107.082 150.092 103.722 141.234 100.472C136.94 98.8967 132.498 97.268 128.077 95.9217C120.707 93.6762 113.941 92.5555 107.813 92.5555Z" fill="#9192FF"/> |
| [7662](#L7662) | <path class="bpa-front-dcw\_\_vector-primary-color" d="M263.772 177.548C259.619 177.548 256.242 174.392 256.242 170.514C256.242 166.636 259.619 163.48 263.772 163.48C267.925 163.48 271.301 166.636 271.301 170.514C271.301 174.392 267.925 177.548 263.772 177.548ZM263.772 166.103C261.066 166.103 258.864 168.082 258.864 170.514C258.864 172.947 261.066 174.925 263.772 174.925C266.478 174.925 268.679 172.947 268.679 170.514C268.681 168.082 266.479 166.103 263.772 166.103Z" /> |
| [7663](#L7663) | <path d="M261.124 186.256H244.645L241.828 157.664H263.941L261.124 186.256Z" fill="white"/> |
| [7664](#L7664) | <path class="bpa-front-dcw\_\_vector-primary-color" d="M261.378 186.537H244.388L241.516 157.381H264.25L261.378 186.537ZM244.899 185.973H260.867L263.628 157.945H242.138L244.899 185.973Z" /> |
| [7665](#L7665) | <path d="M258.255 183.88H247.509L245.672 165.957H260.092L258.255 183.88Z" fill="#E9EDF5"/> |
| [7666](#L7666) | <path d="M222.623 68.0227C219.484 69.4758 215.304 71.8149 216.099 75.9732C216.878 80.052 221.801 79.3155 224.675 78.3406C226.803 77.6187 228.859 76.648 230.753 75.4345C231.982 74.6467 233.711 73.2847 233.291 71.5963C232.931 70.1464 231.248 69.7216 229.955 69.9873C228.08 70.3723 225.939 71.5147 224.47 72.7187C223.136 73.8119 222.097 75.514 222.359 77.2986C222.597 78.9306 223.944 80.0939 225.444 80.6054C227.312 81.2435 229.846 81.1128 231.723 80.5426C232.865 80.1964 233.92 79.1628 233.173 77.9263C232.289 76.4628 230.454 76.8174 229.182 77.4608C227.466 78.3301 225.432 79.4662 224.584 81.2885C223.939 82.6725 224.042 84.3892 225.296 85.3914C226.525 86.3737 228.298 86.3768 229.787 86.2638C231.019 86.1697 233.031 85.9123 233.227 84.3578C233.424 82.7907 231.497 82.0773 230.272 82.5407C228.376 83.2573 227.187 85.5964 226.612 87.4072C225.933 89.5476 225.945 91.8365 226.605 93.9768C226.688 94.2488 227.117 94.1327 227.034 93.8586C226.175 91.0739 226.473 88.014 227.943 85.4845C228.647 84.272 230.035 82.3566 231.692 82.8922C232.577 83.1788 233.205 84.226 232.42 85.0148C231.869 85.5692 230.94 85.7042 230.199 85.7837C229.125 85.8987 227.97 85.9448 226.914 85.6728C225.093 85.2041 224.187 83.5565 224.865 81.7593C225.418 80.2926 226.773 79.372 228.063 78.6021C229.289 77.8709 231.734 76.3393 232.789 78.1502C233.973 80.1786 230.125 80.393 229.068 80.4736C227.517 80.5908 225.873 80.5353 224.517 79.6806C223.08 78.7768 222.437 77.2149 222.96 75.5778C223.485 73.9312 224.852 72.8338 226.313 72.0262C227.452 71.3965 228.788 70.6631 230.074 70.4152C230.98 70.2405 232.124 70.3838 232.664 71.2437C233.31 72.2731 232.539 73.3966 231.793 74.0996C229.704 76.0674 226.548 77.3101 223.849 78.1408C221.037 79.0059 216.425 79.1921 216.465 75.0537C216.499 71.4749 220.039 69.7049 222.847 68.4056C223.107 68.2864 222.882 67.9035 222.623 68.0227Z" fill="#202C45"/> |
| [7667](#L7667) | <path d="M57.8316 69C58.7441 70.9192 59.5744 72.8689 60.3822 74.8266L61.5653 77.7724L62.6993 80.7355L61.0069 80.2381L63.8466 78.0098C64.7949 77.2684 65.7618 76.5535 66.7194 75.8227L67.876 74.9407L68.4105 76.279C68.7952 77.2419 69.1519 78.2167 69.5246 79.185C69.8934 80.1545 70.2342 81.136 70.591 82.1109C70.9266 83.0937 71.2767 84.0712 71.5924 85.0633C71.92 86.0501 72.2251 87.0462 72.5102 88.0489L71.6945 88.3818C71.1945 87.4653 70.7157 86.5409 70.2568 85.6084C69.7873 84.68 69.3522 83.737 68.9013 82.8006C68.4729 81.8549 68.0285 80.9159 67.6121 79.9662C67.1996 79.0152 66.7712 78.0695 66.3706 77.1119L68.063 77.5682C67.1134 78.3069 66.1743 79.0603 65.2154 79.7871L62.3359 81.965L61.113 82.8895L60.6435 81.4663L59.65 78.4528L58.7044 75.4221C58.0942 73.3942 57.5053 71.3596 57 69.2944L57.8316 69Z" fill="#FFA121"/> |
| [7668](#L7668) | <path d="M197.509 49.2944C197.004 51.3596 196.415 53.3942 195.805 55.4221L194.859 58.4528L193.865 61.4663L193.396 62.8895L192.173 61.965L189.294 59.7871C188.335 59.059 187.396 58.3069 186.446 57.5682L188.138 57.1119C187.738 58.0682 187.309 59.0139 186.897 59.9662C186.48 60.9159 186.036 61.8549 185.608 62.8006C185.158 63.737 184.723 64.68 184.253 65.6084C183.795 66.5422 183.316 67.4653 182.816 68.3818L182 68.0489C182.286 67.0449 182.592 66.0501 182.918 65.0633C183.233 64.0712 183.584 63.095 183.919 62.1109C184.276 61.136 184.617 60.1559 184.986 59.185C185.358 58.2167 185.715 57.2419 186.1 56.279L186.634 54.9407L187.791 55.8227C188.747 56.5522 189.715 57.2684 190.664 58.0098L193.503 60.2381L191.811 60.7355L192.945 57.7724L194.128 54.8266C194.936 52.8689 195.766 50.9205 196.679 49L197.509 49.2944Z" fill="#FFA121"/> |
| [7669](#L7669) | <path class="bpa-front-dcw\_\_vector-primary-color" d="M170.793 105.362L151.217 104.174L125.673 110.924C116.714 113.29 109.442 119.825 106.14 128.479L90.1797 170.275L121.544 142.483L130.182 186.239L188.773 186.05L188.585 125.298L170.793 105.362Z"/> |
| [7670](#L7670) | <path d="M155.177 128.044C151.629 128.044 148.316 126.662 146.125 124.22L146.544 123.844C148.889 126.457 152.596 127.796 156.456 127.418C160.593 127.016 164.207 124.703 166.374 121.07L166.858 121.359C164.598 125.146 160.827 127.56 156.512 127.979C156.063 128.022 155.619 128.044 155.177 128.044Z" fill="#C5C5FF"/> |
| [7671](#L7671) | <path d="M157.611 120.398C153.859 122.212 149.251 120.42 147.363 116.409L146.727 115.051L140.27 101.333L136.32 92.933L155.402 83.7109L163.712 101.367C167.126 108.629 164.404 117.114 157.611 120.398Z" fill="#FFBC96"/> |
| [7672](#L7672) | <path d="M157.222 97.7891C155.542 105.97 151.346 111.575 146.726 115.051L140.27 101.333L157.222 97.7891Z" fill="#1B1B43"/> |
| [7673](#L7673) | <path d="M159.458 87.5528C159.458 97.4314 153.888 104.204 146.823 107.695C139.552 111.286 131.96 97.4844 128.334 88.2571C124.569 78.6796 134.932 71.4961 143.606 71.4961C152.281 71.4961 159.458 77.6729 159.458 87.5528Z" fill="#FFBC96"/> |
| [7674](#L7674) | <path d="M159.85 81.9195C159.005 71.7783 156.944 62.1928 147.55 64.6426C143.982 59.6661 129.052 59.7603 125.39 71.5913C123.028 79.2231 115.438 82.9527 115.438 82.9527C124.545 87.7408 132.941 85.9476 144.64 77.0372C148.302 82.389 158.724 82.7644 158.724 82.7644L159.85 81.9195Z" fill="#1B1B43"/> |
| [7675](#L7675) | <path d="M162.765 86.6849C163.176 83.4828 161.479 80.6268 158.976 80.3058C156.473 79.9848 154.111 82.3204 153.701 85.5225C153.29 88.7245 154.986 91.5805 157.489 91.9015C159.992 92.2225 162.354 89.8869 162.765 86.6849Z" fill="#FFBC96"/> |
| [7676](#L7676) | <path d="M159.143 83.6904C158.537 84.1904 158.337 84.8682 158.343 85.5937C158.347 85.9518 158.404 86.3165 158.509 86.6627C158.619 87.0089 158.767 87.3365 159.017 87.623L158.85 87.9081C158.386 87.7556 158.04 87.3657 157.828 86.9532C157.61 86.5341 157.504 86.0672 157.504 85.5963C157.508 85.1268 157.613 84.64 157.875 84.2249C158.129 83.8084 158.552 83.4848 159.007 83.3906L159.143 83.6904Z" fill="#1B1B43"/> |
| [7677](#L7677) | <path d="M143.414 91.3952C144.199 91.3432 144.788 90.5875 144.73 89.7075C144.671 88.8275 143.988 88.1564 143.203 88.2084C142.418 88.2605 141.829 89.0161 141.887 89.8961C141.945 90.7761 142.629 91.4473 143.414 91.3952Z" fill="#1B1B43"/> |
| [7678](#L7678) | <path d="M136.363 94.0169C137.029 93.7595 137.334 92.946 137.046 92.1999C136.757 91.4539 135.984 91.0577 135.318 91.3151C134.653 91.5726 134.347 92.3861 134.636 93.1321C134.924 93.8782 135.698 94.2743 136.363 94.0169Z" fill="#1B1B43"/> |
| [7679](#L7679) | <path d="M147.166 85.6844C147.195 86.1314 144.824 85.9868 143.804 86.203C142.934 86.3874 141.607 87.2349 141.011 86.3887C140.472 85.6247 141.826 84.76 143.504 84.6485C145.182 84.5371 147.136 85.2388 147.166 85.6844Z" fill="#1B1B43"/> |
| [7680](#L7680) | <path d="M131.878 90.5943C132.144 90.9604 133.355 89.7017 134.052 89.3781C134.646 89.1022 135.91 89.13 135.702 88.1751C135.513 87.3143 134.223 87.2864 133.231 88.0093C132.24 88.7321 131.611 90.2283 131.878 90.5943Z" fill="#1B1B43"/> |
| [7681](#L7681) | <path d="M141.375 100.649C141.917 99.9948 142.693 99.5717 143.479 99.3064C144.273 99.0465 145.089 98.9324 145.914 98.9921L145.975 99.317C145.227 99.6725 144.469 99.8701 143.74 100.106C143.004 100.334 142.313 100.605 141.574 100.913L141.375 100.649Z" fill="#1B1B43"/> |
| [7682](#L7682) | <path d="M139.239 93.5735C139.28 94.1876 139.19 94.8401 138.873 95.4383C138.721 95.7354 138.501 96.0047 138.278 96.2288C138.059 96.453 137.837 96.6413 137.784 96.7753C137.767 96.8429 137.738 96.896 137.753 96.9981C137.749 97.0591 137.766 97.0631 137.762 97.0724C137.763 97.087 137.787 97.1082 137.802 97.1347C137.906 97.2527 138.154 97.3734 138.402 97.465C138.914 97.648 139.494 97.77 140.066 97.9053L140.058 98.2356C139.442 98.3191 138.831 98.3151 138.197 98.1772C137.881 98.099 137.552 98.0074 137.218 97.717C137.141 97.6308 137.058 97.5379 137.004 97.4172C136.95 97.2872 136.914 97.1506 136.916 97.0604C136.886 96.8655 136.926 96.6174 137.023 96.4145C137.242 96.0126 137.516 95.8336 137.718 95.6452C137.929 95.4622 138.1 95.2765 138.254 95.0656C138.559 94.6425 138.749 94.1093 138.908 93.543L139.239 93.5735Z" fill="#D28572"/> |
| [7683](#L7683) | <path opacity="0.2" d="M154.602 92.1506C154.626 90.1606 153.033 88.5276 151.043 88.5034C149.053 88.4791 147.42 90.0726 147.396 92.0627C147.371 94.0528 148.965 95.6857 150.955 95.71C152.945 95.7343 154.578 94.1407 154.602 92.1506Z" fill="#FE5B52"/> |
| [7684](#L7684) | <path class="bpa-front-dcw\_\_vector-primary-color" d="M203.429 125.772C197.862 114.065 186.375 106.314 173.435 105.524L170.793 105.361L190.281 149.738L211.612 141.82L203.429 125.772Z" /> |
| [7685](#L7685) | <path d="M135.344 96.8521C135.133 93.6132 135.695 86.0066 133.724 86.8515C131.753 87.6964 131.26 98.6811 131.26 98.6811C131.26 98.6811 130.979 80.371 128.866 81.2159C126.753 82.0607 126.753 95.3003 122.106 109.385L96.0019 164.514C92.8625 171.146 96.8176 178.958 104.021 180.353C109.305 181.376 114.571 178.508 116.58 173.515C123.34 156.715 135.759 120.461 136.965 113.401C137.95 107.626 137.695 105.128 137.315 103.644C136.685 101.191 135.508 99.3801 135.344 96.8521Z" fill="#FFBC96"/> |
| [7686](#L7686) | <path d="M122.27 108.167C123.068 105.994 123.591 103.725 124.077 101.457C124.556 99.1848 124.959 96.8956 125.373 94.6089L126.597 87.7372C126.814 86.5925 127.036 85.4479 127.304 84.3086C127.44 83.7383 127.584 83.1706 127.765 82.6042C127.856 82.3217 127.956 82.0392 128.086 81.758C128.149 81.6174 128.225 81.4768 128.319 81.3362C128.421 81.2036 128.53 81.0352 128.804 80.949L128.783 80.9543C128.864 80.9383 128.952 80.9291 129.034 80.9277C129.112 80.9397 129.19 80.9702 129.265 80.9994C129.384 81.071 129.497 81.1612 129.559 81.25C129.713 81.4304 129.798 81.6148 129.883 81.7991C130.045 82.1665 130.161 82.5366 130.258 82.908C130.456 83.6507 130.594 84.3974 130.714 85.1442C130.949 86.6403 131.111 88.1417 131.236 89.6444C131.48 92.6513 131.61 95.6634 131.58 98.6821L130.94 98.6689C131.01 96.9645 131.139 95.2721 131.331 93.5797C131.537 91.8899 131.773 90.1962 132.305 88.5383C132.451 88.1258 132.61 87.7146 132.855 87.3207C132.984 87.1271 133.128 86.9308 133.343 86.7716C133.546 86.6005 133.863 86.5183 134.152 86.5581C134.22 86.574 134.284 86.5978 134.35 86.6204C134.417 86.6496 134.472 86.6482 134.557 86.7238C134.595 86.7544 134.632 86.7888 134.667 86.8233C134.697 86.8565 134.708 86.883 134.729 86.9122C134.762 86.9692 134.809 87.0329 134.829 87.0873C134.928 87.3101 134.993 87.525 135.048 87.7385C135.158 88.1669 135.221 88.5913 135.284 89.0171C135.504 90.7188 135.562 92.4231 135.548 94.1248C135.542 94.983 135.488 95.8159 135.562 96.6409C135.63 97.4685 135.781 98.2895 135.995 99.0973C136.209 99.905 136.483 100.698 136.78 101.486C137.085 102.266 137.39 103.092 137.561 103.933C137.924 105.619 137.964 107.351 137.808 109.048C137.65 110.747 137.318 112.422 136.875 114.062L136.631 113.999C137.041 112.362 137.338 110.696 137.463 109.02C137.586 107.346 137.513 105.653 137.131 104.03C136.947 103.212 136.666 102.444 136.347 101.65C136.041 100.856 135.757 100.048 135.532 99.2206C135.306 98.3917 135.144 97.5428 135.069 96.682C134.986 95.8186 135.037 94.9551 135.036 94.1209C135.04 92.4377 134.969 90.748 134.745 89.0914C134.683 88.6802 134.618 88.2664 134.513 87.8751C134.463 87.6801 134.402 87.4878 134.327 87.3247C134.31 87.2783 134.288 87.2597 134.27 87.2239C134.249 87.1801 134.236 87.1761 134.236 87.1761C134.25 87.1655 134.191 87.1549 134.162 87.143C134.127 87.1324 134.093 87.1151 134.058 87.1072C133.809 87.0674 133.537 87.2875 133.335 87.6218C133.134 87.9494 132.985 88.3314 132.852 88.7173C132.356 90.2917 132.127 91.9748 131.937 93.6434C131.757 95.3159 131.64 97.0056 131.582 98.6848L130.941 98.6715C130.969 95.678 130.871 92.6765 130.641 89.6895C130.526 88.1961 130.375 86.7053 130.151 85.2304C130.037 84.4943 129.904 83.7595 129.72 83.0486C129.629 82.6931 129.519 82.3429 129.38 82.022C129.311 81.8655 129.231 81.705 129.14 81.6002C129.096 81.5325 129.05 81.5127 129.017 81.4835C129.002 81.4848 128.991 81.4742 128.981 81.4689C128.97 81.4768 128.964 81.4782 128.952 81.4715L128.93 81.4768C128.92 81.4755 128.828 81.5445 128.765 81.644C128.697 81.7448 128.632 81.8588 128.576 81.9835C128.461 82.2302 128.364 82.4968 128.275 82.766C128.099 83.3072 127.953 83.8656 127.816 84.4266C127.546 85.55 127.316 86.688 127.095 87.8274L125.831 94.6872C125.414 96.9765 124.959 99.2604 124.442 101.532C123.916 103.8 123.353 106.07 122.508 108.253L122.27 108.167Z" fill="#D28572"/> |
| [7687](#L7687) | <path d="M221.814 172.788C221.718 179.278 218.889 183.814 215.346 186.428L208.152 186.315L206.372 186.287H206.333L197.876 167.037L197.859 166.992L190.281 149.741L211.61 141.82L219.571 161.359C221.205 165.679 221.864 169.486 221.814 172.788Z" fill="#FFBC96"/> |
| [7688](#L7688) | <path d="M215.91 165.02L159.917 171.284L152.632 168.93C149.333 167.865 145.721 168.52 143.013 170.683C136.66 175.758 126.331 185.111 129.008 185.863C133.515 187.131 139.401 184.758 144.685 183.432C147.605 182.698 150.688 183.046 153.366 184.417L157.03 186.294L212.81 186.286L215.91 165.02Z" fill="#FFBC96"/> |
| [7689](#L7689) | <path d="M130.344 184.873C131.854 183.99 133.389 183.15 134.928 182.321C136.462 181.484 138.023 180.699 139.571 179.886C140.334 179.485 141.151 179.074 142.004 178.778C142.856 178.485 143.737 178.272 144.631 178.174C145.525 178.073 146.426 178.063 147.316 178.143C148.204 178.241 149.084 178.412 149.923 178.701L149.837 179.02C148.988 178.854 148.135 178.741 147.28 178.732C146.426 178.704 145.573 178.762 144.735 178.904C143.898 179.045 143.074 179.256 142.281 179.554C141.481 179.835 140.742 180.235 139.952 180.631C138.384 181.405 136.832 182.207 135.253 182.956C133.678 183.715 132.097 184.463 130.494 185.166L130.344 184.873Z" fill="#D28572"/> |
| [7690](#L7690) | <path d="M131.156 182.074C132.174 181.111 133.236 180.207 134.322 179.328C135.403 178.443 136.519 177.599 137.661 176.789C138.809 175.988 139.971 175.203 141.206 174.524C142.446 173.872 143.709 173.163 145.19 173.023L145.218 173.352C144.578 173.521 143.954 173.77 143.359 174.116C142.75 174.421 142.166 174.791 141.584 175.158C140.419 175.894 139.283 176.687 138.146 177.476C137.008 178.266 135.891 179.091 134.757 179.894C133.63 180.706 132.506 181.528 131.368 182.329L131.156 182.074Z" fill="#D28572"/> |
| [7691](#L7691) | <path d="M205.285 166.39L197.773 166.574L197.794 167.419L205.306 167.235L205.285 166.39Z" fill="#D28572"/> |
| [7692](#L7692) | <path d="M185.084 138.502L184.578 138.75L190.032 149.855L190.538 149.607L185.084 138.502Z" fill="#E9EDF5"/> |
| [7693](#L7693) | <path opacity="0.2" d="M221.815 172.788C221.719 179.278 218.89 183.814 215.347 186.428L208.153 186.315C208.148 186.305 208.148 186.298 208.148 186.288C207.883 185.347 207.742 184.355 207.742 183.33C207.742 178.67 210.638 174.693 214.733 173.093C215.972 172.609 217.32 172.344 218.728 172.344C219.797 172.344 220.835 172.496 221.815 172.788Z" fill="#FE5B52"/> |
| [7694](#L7694) | <path d="M132.624 179.492H100.512V186.253H132.624V179.492Z" fill="#1B1B43"/> |
| [7695](#L7695) | <path d="M111.404 186.253H60.4176L45.7695 135.268H96.7554L111.404 186.253Z" fill="#E9EDF5"/> |
| [7696](#L7696) | <path d="M60.2147 186.311L45.4883 135.055H61.2625V135.478H46.0507L60.6205 186.193L60.2147 186.311Z" fill="#1B1B43"/> |
| [7697](#L7697) | <path d="M105.942 167.612L96.5965 135.478H73.0938V135.055H96.9135L106.348 167.494L105.942 167.612Z" fill="#1B1B43"/> |
| [7698](#L7698) | <path d="M109.075 6.46072C109.74 4.22377 108.466 1.87097 106.229 1.20561C103.992 0.540239 101.64 1.81426 100.974 4.05121C100.309 6.28816 101.583 8.64095 103.82 9.30632C106.057 9.97168 108.41 8.69767 109.075 6.46072Z" fill="#E9EDF5"/> |
| [7699](#L7699) | <path d="M23.7421 113.037C24.4333 110.11 22.6207 107.177 19.6936 106.485C16.7665 105.794 13.8333 107.607 13.1421 110.534C12.4509 113.461 14.2635 116.394 17.1906 117.085C20.1177 117.777 23.0509 115.964 23.7421 113.037Z" fill="#E9EDF5"/> |
| [7700](#L7700) | <path d="M285.202 126.709C287.536 126.709 289.428 124.817 289.428 122.484C289.428 120.15 287.536 118.258 285.202 118.258C282.868 118.258 280.977 120.15 280.977 122.484C280.977 124.817 282.868 126.709 285.202 126.709Z" fill="#E9EDF5"/> |
| [7701](#L7701) | <path d="M279.927 125.251L279.916 124.687C280.598 124.674 281.269 124.557 281.91 124.337L282.093 124.87C281.397 125.109 280.668 125.236 279.927 125.251ZM277.749 124.956C277.042 124.746 276.375 124.426 275.765 124.007L276.085 123.543C276.646 123.927 277.26 124.222 277.911 124.417L277.749 124.956ZM284.037 123.845L283.7 123.393C284.246 122.985 284.723 122.499 285.118 121.947L285.576 122.275C285.147 122.874 284.63 123.402 284.037 123.845ZM274.165 122.499C273.712 121.914 273.352 121.267 273.1 120.574L273.63 120.382C273.862 121.019 274.192 121.615 274.61 122.154L274.165 122.499ZM286.564 120.31L286.027 120.138C286.234 119.493 286.339 118.819 286.339 118.136C286.339 117.963 286.332 117.792 286.319 117.622L286.88 117.577C286.894 117.761 286.902 117.948 286.901 118.136C286.902 118.879 286.788 119.61 286.564 120.31ZM272.679 118.419C272.675 118.326 272.673 118.233 272.672 118.139C272.672 117.49 272.759 116.85 272.931 116.233L273.473 116.383C273.315 116.951 273.236 117.541 273.236 118.136C273.236 118.221 273.238 118.309 273.241 118.395L272.679 118.419ZM285.85 115.652C285.593 115.025 285.24 114.443 284.801 113.921L285.232 113.559C285.708 114.126 286.092 114.757 286.372 115.439L285.85 115.652ZM274.311 114.542L273.84 114.232C274.246 113.615 274.742 113.067 275.317 112.603L275.671 113.041C275.143 113.469 274.685 113.973 274.311 114.542ZM283.276 112.591C282.7 112.228 282.076 111.958 281.416 111.79L281.556 111.243C282.271 111.426 282.951 111.72 283.576 112.113L283.276 112.591ZM277.423 112.026L277.22 111.501C277.907 111.234 278.63 111.078 279.369 111.035L279.4 111.598C278.721 111.637 278.056 111.781 277.423 112.026Z" fill="#9192FF"/> |
| [7702](#L7702) | <path d="M185.208 23.3295C183.499 23.3295 182.109 21.9395 182.109 20.2311C182.109 18.5228 183.499 17.1328 185.208 17.1328C186.916 17.1328 188.306 18.5228 188.306 20.2311C188.306 21.9395 186.916 23.3295 185.208 23.3295ZM185.208 17.6965C183.81 17.6965 182.673 18.8332 182.673 20.2311C182.673 21.6291 183.81 22.7671 185.208 22.7671C186.606 22.7671 187.742 21.6291 187.742 20.2311C187.742 18.8332 186.604 17.6965 185.208 17.6965Z" fill="#9192FF"/> |
| [7703](#L7703) | <path d="M306 186H2V187H306V186Z" fill="#727E95"/> |
| [7704](#L7704) | </svg> |
| [7705](#L7705) | </div> |
| [7706](#L7706) | <div class="bpa-front-dcw\_\_body"> |
| [7707](#L7707) | <div class="bpa-front-dcw\_\_body-title">Sorry to see you go. Please Confirm</div> |
| [7708](#L7708) | <div class="bpa-front-dcw\_\_body-sub-title">All your data will be erased</div> |
| [7709](#L7709) | [bookingpress\_delete\_account cancel\_button\_text = "cancel" delete\_button\_text="delete"] |
| [7710](#L7710) | </div> |
| [7711](#L7711) | </div>', |
| [7712](#L7712) | ); |
| [7713](#L7713) |  |
| [7714](#L7714) | foreach ( $mybookings\_shortcode\_default\_data as $mybookings\_shortcode\_data\_key => $mybookings\_shortcode\_data\_val ) { |
| [7715](#L7715) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [7716](#L7716) | 'bookingpress\_setting\_name'  => $mybookings\_shortcode\_data\_key, |
| [7717](#L7717) | 'bookingpress\_setting\_value' => $mybookings\_shortcode\_data\_val, |
| [7718](#L7718) | 'bookingpress\_setting\_type'  => 'booking\_my\_booking', |
| [7719](#L7719) | ); |
| [7720](#L7720) | $resp = $wpdb->insert($tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields); |
| [7721](#L7721) |  |
| [7722](#L7722) | $db\_data = array( |
| [7723](#L7723) | 'last\_query' => $wpdb->last\_query, |
| [7724](#L7724) | 'last\_error' => $wpdb->last\_error, |
| [7725](#L7725) | 'resposne' => $resp |
| [7726](#L7726) | ); |
| [7727](#L7727) |  |
| [7728](#L7728) | update\_option( 'bpa\_mybookings\_shortcode\_default\_data'. $mybookings\_shortcode\_data\_key.'\_'. date( 'Y-m-d H:i:s', current\_time('timestamp') ), wp\_json\_encode( $db\_data) ); |
| [7729](#L7729) | } |
| [7730](#L7730) |  |
| [7731](#L7731) | $form\_fields\_default\_data = array( |
| [7732](#L7732) | 'fullname'      => array( |
| [7733](#L7733) | 'field\_name'     => 'fullname', |
| [7734](#L7734) | 'field\_type'     => 'Text', |
| [7735](#L7735) | 'is\_edit'        => 0, |
| [7736](#L7736) | 'is\_required'    => 0, |
| [7737](#L7737) | 'label'          => wp\_kses\_post( \_\_('Fullname', 'bookingpress-appointment-booking') ), |
| [7738](#L7738) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your full name', 'bookingpress-appointment-booking') ), |
| [7739](#L7739) | 'error\_message'  => wp\_kses\_post(\_\_('Please enter your full name', 'bookingpress-appointment-booking') ), |
| [7740](#L7740) | 'is\_hide'        => 1, |
| [7741](#L7741) | 'field\_position' => 1, |
| [7742](#L7742) | ), |
| [7743](#L7743) | 'firstname'     => array( |
| [7744](#L7744) | 'field\_name'     => 'firstname', |
| [7745](#L7745) | 'field\_type'     => 'Text', |
| [7746](#L7746) | 'is\_edit'        => 0, |
| [7747](#L7747) | 'is\_required'    => true, |
| [7748](#L7748) | 'label'          => wp\_kses\_post( \_\_('Firstname', 'bookingpress-appointment-booking') ), |
| [7749](#L7749) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your firstname', 'bookingpress-appointment-booking') ), |
| [7750](#L7750) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter your firstname', 'bookingpress-appointment-booking') ), |
| [7751](#L7751) | 'is\_hide'        => 0, |
| [7752](#L7752) | 'field\_position' => 2, |
| [7753](#L7753) | ), |
| [7754](#L7754) | 'lastname'      => array( |
| [7755](#L7755) | 'field\_name'     => 'lastname', |
| [7756](#L7756) | 'field\_type'     => 'Text', |
| [7757](#L7757) | 'is\_edit'        => 0, |
| [7758](#L7758) | 'is\_required'    => true, |
| [7759](#L7759) | 'label'          => wp\_kses\_post( \_\_('Lastname', 'bookingpress-appointment-booking') ), |
| [7760](#L7760) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your lastname', 'bookingpress-appointment-booking') ), |
| [7761](#L7761) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter your lastname', 'bookingpress-appointment-booking') ), |
| [7762](#L7762) | 'is\_hide'        => 0, |
| [7763](#L7763) | 'field\_position' => 3, |
| [7764](#L7764) | ), |
| [7765](#L7765) | 'email\_address' => array( |
| [7766](#L7766) | 'field\_name'     => 'email\_address', |
| [7767](#L7767) | 'field\_type'     => 'Email', |
| [7768](#L7768) | 'is\_edit'        => 0, |
| [7769](#L7769) | 'is\_required'    => true, |
| [7770](#L7770) | 'label'          => wp\_kses\_post( \_\_('Email Address', 'bookingpress-appointment-booking') ), |
| [7771](#L7771) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your email address', 'bookingpress-appointment-booking') ), |
| [7772](#L7772) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter your email address', 'bookingpress-appointment-booking') ), |
| [7773](#L7773) | 'is\_hide'        => 0, |
| [7774](#L7774) | 'field\_position' => 4, |
| [7775](#L7775) | ), |
| [7776](#L7776) | 'phone\_number'  => array( |
| [7777](#L7777) | 'field\_name'     => 'phone\_number', |
| [7778](#L7778) | 'field\_type'     => 'Dropdown', |
| [7779](#L7779) | 'is\_edit'        => 0, |
| [7780](#L7780) | 'is\_required'    => true, |
| [7781](#L7781) | 'label'          => wp\_kses\_post( \_\_('Phone Number', 'bookingpress-appointment-booking') ), |
| [7782](#L7782) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your phone number', 'bookingpress-appointment-booking') ), |
| [7783](#L7783) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter your phone number', 'bookingpress-appointment-booking') ), |
| [7784](#L7784) | 'is\_hide'        => 0, |
| [7785](#L7785) | 'field\_position' => 5, |
| [7786](#L7786) | ), |
| [7787](#L7787) | 'note'          => array( |
| [7788](#L7788) | 'field\_name'     => 'note', |
| [7789](#L7789) | 'field\_type'     => 'Textarea', |
| [7790](#L7790) | 'is\_edit'        => 0, |
| [7791](#L7791) | 'is\_required'    => 0, |
| [7792](#L7792) | 'label'          => wp\_kses\_post( \_\_('Note', 'bookingpress-appointment-booking') ), |
| [7793](#L7793) | 'placeholder'    => wp\_kses\_post( \_\_('Enter note details', 'bookingpress-appointment-booking') ), |
| [7794](#L7794) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter appointment note', 'bookingpress-appointment-booking') ), |
| [7795](#L7795) | 'is\_hide'        => 0, |
| [7796](#L7796) | 'field\_position' => 6, |
| [7797](#L7797) | ), |
| [7798](#L7798) | 'terms\_condition'          => array( |
| [7799](#L7799) | 'field\_name'     => 'terms\_and\_conditions', |
| [7800](#L7800) | 'field\_type'     => 'terms\_and\_conditions', |
| [7801](#L7801) | 'is\_edit'        => 0, |
| [7802](#L7802) | 'is\_required'    => true, |
| [7803](#L7803) | 'placeholder'    => '', |
| [7804](#L7804) | 'label'          => str\_replace( '&amp;', '&', wp\_kses\_post( \_\_('I agree with <a target="\_blank" href="#">terms & conditions</a>', 'bookingpress-appointment-booking') ) ), |
| [7805](#L7805) | 'error\_message'  => wp\_kses\_post( \_\_('Please tick this box if you want to proceed', 'bookingpress-appointment-booking') ), |
| [7806](#L7806) | 'is\_hide'        => 1, |
| [7807](#L7807) | 'field\_position' => 7, |
| [7808](#L7808) | ), |
| [7809](#L7809) | 'username'          => array( |
| [7810](#L7810) | 'field\_name'     => 'username', |
| [7811](#L7811) | 'field\_type'     => 'text', |
| [7812](#L7812) | 'is\_edit'        => 0, |
| [7813](#L7813) | 'is\_required'    => true, |
| [7814](#L7814) | 'placeholder'    => wp\_kses\_post( \_\_('Enter your username', 'bookingpress-appointment-booking') ), |
| [7815](#L7815) | 'label'          => wp\_kses\_post( \_\_('Username', 'bookingpress-appointment-booking') ), |
| [7816](#L7816) | 'error\_message'  => wp\_kses\_post( \_\_('Please enter your username', 'bookingpress-appointment-booking') ), |
| [7817](#L7817) | 'is\_hide'        => 1, |
| [7818](#L7818) | 'field\_position' => 8, |
| [7819](#L7819) | ), |
| [7820](#L7820) | ); |
| [7821](#L7821) |  |
| [7822](#L7822) | foreach ( $form\_fields\_default\_data as $form\_field\_key => $form\_field\_val ) { |
| [7823](#L7823) | $form\_field\_db\_data = array( |
| [7824](#L7824) | 'bookingpress\_form\_field\_name'     => $form\_field\_val['field\_name'], |
| [7825](#L7825) | 'bookingpress\_field\_required'      => $form\_field\_val['is\_required'], |
| [7826](#L7826) | 'bookingpress\_field\_label'         => stripslashes\_deep($form\_field\_val['label']), |
| [7827](#L7827) | 'bookingpress\_field\_placeholder'   => $form\_field\_val['placeholder'], |
| [7828](#L7828) | 'bookingpress\_field\_error\_message' => $form\_field\_val['error\_message'], |
| [7829](#L7829) | 'bookingpress\_field\_is\_hide'       => $form\_field\_val['is\_hide'], |
| [7830](#L7830) | 'bookingpress\_field\_position'      => $form\_field\_val['field\_position'], |
| [7831](#L7831) | 'bookingpress\_field\_is\_default'    => 1, |
| [7832](#L7832) | ); |
| [7833](#L7833) |  |
| [7834](#L7834) | $resp = $wpdb->insert($tbl\_bookingpress\_form\_fields, $form\_field\_db\_data); |
| [7835](#L7835) | $db\_data = array( |
| [7836](#L7836) | 'last\_query' => $wpdb->last\_query, |
| [7837](#L7837) | 'last\_error' => $wpdb->last\_error, |
| [7838](#L7838) | 'form\_field\_data' => $form\_field\_db\_data, |
| [7839](#L7839) | 'resposne' => $resp |
| [7840](#L7840) | ); |
| [7841](#L7841) |  |
| [7842](#L7842) | update\_option( 'bpa\_defult\_field\_installation\_details\_'. $form\_field\_val['field\_name'].'\_'. date( 'Y-m-d H:i:s', current\_time('timestamp') ), wp\_json\_encode( $db\_data) ); |
| [7843](#L7843) | } |
| [7844](#L7844) |  |
| [7845](#L7845) | $bookingpress\_custom\_data\_arr['action'][] = 'bookingpress\_save\_my\_booking\_settings'; |
| [7846](#L7846) | $bookingpress\_custom\_data\_arr['action'][] = 'bookingpress\_save\_booking\_form\_settings'; |
| [7847](#L7847) | $my\_booking\_form = array( |
| [7848](#L7848) | 'background\_color' => $booking\_form\_shortcode\_default\_fields['background\_color'], |
| [7849](#L7849) | 'row\_background\_color' => $booking\_form\_shortcode\_default\_fields['footer\_background\_color'], |
| [7850](#L7850) | 'primary\_color' => $booking\_form\_shortcode\_default\_fields['primary\_color'], |
| [7851](#L7851) | 'content\_color' => $booking\_form\_shortcode\_default\_fields['content\_color'], |
| [7852](#L7852) | 'border\_color' => $booking\_form\_shortcode\_default\_fields['border\_color'], |
| [7853](#L7853) | 'label\_title\_color'=>$booking\_form\_shortcode\_default\_fields['label\_title\_color'], |
| [7854](#L7854) | 'title\_font\_family' => $booking\_form\_shortcode\_default\_fields['title\_font\_family'], |
| [7855](#L7855) | 'sub\_title\_color' => $booking\_form\_shortcode\_default\_fields['sub\_title\_color'], |
| [7856](#L7856) | 'price\_button\_text\_color' => '#fff', |
| [7857](#L7857) | ); |
| [7858](#L7858) | $booking\_form = array( |
| [7859](#L7859) | 'background\_color' => $booking\_form\_shortcode\_default\_fields['background\_color'], |
| [7860](#L7860) | 'footer\_background\_color' => $booking\_form\_shortcode\_default\_fields['footer\_background\_color'], |
| [7861](#L7861) | 'border\_color' => $booking\_form\_shortcode\_default\_fields['border\_color'], |
| [7862](#L7862) | 'primary\_color' => $booking\_form\_shortcode\_default\_fields['primary\_color'], |
| [7863](#L7863) | 'primary\_background\_color'=> $booking\_form\_shortcode\_default\_fields['primary\_background\_color'], |
| [7864](#L7864) | 'label\_title\_color' => $booking\_form\_shortcode\_default\_fields['label\_title\_color'], |
| [7865](#L7865) | 'title\_font\_family' => $booking\_form\_shortcode\_default\_fields['title\_font\_family'], |
| [7866](#L7866) | 'content\_color' => $booking\_form\_shortcode\_default\_fields['content\_color'], |
| [7867](#L7867) | 'price\_button\_text\_color' => '#fff', |
| [7868](#L7868) | 'sub\_title\_color' => $booking\_form\_shortcode\_default\_fields['sub\_title\_color'], |
| [7869](#L7869) | ); |
| [7870](#L7870) |  |
| [7871](#L7871) | $bookingpress\_custom\_data\_arr['booking\_form'] = $booking\_form; |
| [7872](#L7872) | $bookingpress\_custom\_data\_arr['my\_booking\_form'] = $my\_booking\_form; |
| [7873](#L7873) |  |
| [7874](#L7874) | $BookingPress->bookingpress\_generate\_customize\_css\_func($bookingpress\_custom\_data\_arr); |
| [7875](#L7875) | } |
| [7876](#L7876) |  |
| [7877](#L7877) | /\*\* |
| [7878](#L7878) | \* Install default pages |
| [7879](#L7879) | \* |
| [7880](#L7880) | \* @return void |
| [7881](#L7881) | \*/ |
| [7882](#L7882) | function bookingpress\_install\_default\_pages() |
| [7883](#L7883) | {   global $wpdb,$tbl\_bookingpress\_customize\_settings; |
| [7884](#L7884) |  |
| [7885](#L7885) | $post\_table = $wpdb->posts; |
| [7886](#L7886) |  |
| [7887](#L7887) | $post\_author = get\_current\_user\_id(); |
| [7888](#L7888) |  |
| [7889](#L7889) | $bookingpress\_bookingformpage\_content = '<!-- wp:shortcode -->[bookingpress\_form]<!-- /wp:shortcode -->'; |
| [7890](#L7890) | $bookingpress\_bookingform\_page\_details = array( |
| [7891](#L7891) | 'post\_title'    => esc\_html\_\_('Book an Appointment', 'bookingpress-appointment-booking'), |
| [7892](#L7892) | 'post\_name'     => 'book-appointment', |
| [7893](#L7893) | 'post\_content'  => $bookingpress\_bookingformpage\_content, |
| [7894](#L7894) | 'post\_status'   => 'publish', |
| [7895](#L7895) | 'post\_parent'   => 0, |
| [7896](#L7896) | 'post\_author'   => 1, |
| [7897](#L7897) | 'post\_type'     => 'page', |
| [7898](#L7898) | 'post\_author'   => $post\_author, |
| [7899](#L7899) | 'post\_date'     => current\_time( 'mysql' ), |
| [7900](#L7900) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [7901](#L7901) | ); |
| [7902](#L7902) |  |
| [7903](#L7903) | $wpdb->insert( $post\_table, $bookingpress\_bookingform\_page\_details ); |
| [7904](#L7904) | $bookingpress\_post\_id = $wpdb->insert\_id; |
| [7905](#L7905) |  |
| [7906](#L7906) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_post\_id ); |
| [7907](#L7907) | $where = array( 'ID' => $bookingpress\_post\_id ); |
| [7908](#L7908) | if( '' === $current\_guid ){ |
| [7909](#L7909) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_post\_id ) ), $where ); |
| [7910](#L7910) | } |
| [7911](#L7911) |  |
| [7912](#L7912) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [7913](#L7913) | 'bookingpress\_setting\_name'  => 'default\_booking\_page', |
| [7914](#L7914) | 'bookingpress\_setting\_value' => $bookingpress\_post\_id, |
| [7915](#L7915) | 'bookingpress\_setting\_type'  => 'booking\_form', |
| [7916](#L7916) | ); |
| [7917](#L7917) | $wpdb->insert( $tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields ); |
| [7918](#L7918) |  |
| [7919](#L7919) |  |
| [7920](#L7920) | $bookingpress\_mybooking\_content = '<!-- wp:shortcode -->[bookingpress\_my\_appointments]<!-- /wp:shortcode -->'; |
| [7921](#L7921) | $bookingpress\_mybooking\_page\_details = array( |
| [7922](#L7922) | 'post\_title'   => esc\_html\_\_('My Bookings', 'bookingpress-appointment-booking'), |
| [7923](#L7923) | 'post\_name'    => 'my-bookings', |
| [7924](#L7924) | 'post\_content' => $bookingpress\_mybooking\_content, |
| [7925](#L7925) | 'post\_status'  => 'publish', |
| [7926](#L7926) | 'post\_parent'  => 0, |
| [7927](#L7927) | 'post\_author'  => 1, |
| [7928](#L7928) | 'post\_type'    => 'page', |
| [7929](#L7929) | 'post\_author'   => $post\_author, |
| [7930](#L7930) | 'post\_date'     => current\_time( 'mysql' ), |
| [7931](#L7931) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [7932](#L7932) | ); |
| [7933](#L7933) |  |
| [7934](#L7934) | $wpdb->insert( $post\_table, $bookingpress\_mybooking\_page\_details ); |
| [7935](#L7935) | $bookingpress\_post\_id = $wpdb->insert\_id; |
| [7936](#L7936) |  |
| [7937](#L7937) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_post\_id ); |
| [7938](#L7938) | $where = array( 'ID' => $bookingpress\_post\_id ); |
| [7939](#L7939) | if( '' === $current\_guid ){ |
| [7940](#L7940) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_post\_id ) ), $where ); |
| [7941](#L7941) | } |
| [7942](#L7942) |  |
| [7943](#L7943) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [7944](#L7944) | 'bookingpress\_setting\_name'  => 'default\_mybooking\_page', |
| [7945](#L7945) | 'bookingpress\_setting\_value' => $bookingpress\_post\_id, |
| [7946](#L7946) | 'bookingpress\_setting\_type'  => 'booking\_my\_booking', |
| [7947](#L7947) | ); |
| [7948](#L7948) | $wpdb->insert( $tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields ); |
| [7949](#L7949) |  |
| [7950](#L7950) |  |
| [7951](#L7951) | $bookingpress\_thankyoupage\_content = ' |
| [7952](#L7952) | <div class="bpa-front-thankyou-module-container"> |
| [7953](#L7953) | <div class="bpa-front-tmc\_\_head"> |
| [7954](#L7954) | <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="bpa-front-tmc\_\_vector--confirmation" xmlns="http://www.w3.org/2000/svg"> |
| [7955](#L7955) | <path fill-rule="evenodd" clip-rule="evenodd" d="M90.7002 85.4607C84.4375 93.0096 72.3956 90.9928 62.8277 93.3708C53.5335 95.6808 44.3866 102.22 35.2915 99.2321C26.2099 96.2486 22.8396 85.5957 16.7964 78.2482C10.8588 71.0289 1.14803 65.6954 0.0978856 56.4421C-0.951171 47.1984 6.67152 39.5219 11.4957 31.5411C15.8676 24.3084 20.1527 17.1387 26.9344 12.0452C34.1982 6.58954 42.3994 1.52524 51.5153 1.4835C60.7 1.44146 68.4886 7.2199 76.4135 11.8187C84.8089 16.6905 95.7104 20.0477 99.0838 29.0875C102.453 38.1169 94.606 47.2495 93.1897 56.7733C91.7484 66.4649 96.9793 77.8921 90.7002 85.4607Z" class="bpa-front-vc\_\_bg"/> |
| [7956](#L7956) | <path d="M8.13042 32.8242L8.16292 32.9233H8.25556L8.18062 32.9772L8.21164 33.0718L8.13042 33.0133L8.04921 33.0718L8.08023 32.9772L8.00529 32.9233H8.09792L8.13042 32.8242Z" stroke="#12D488" stroke-width="0.758084"/> |
| [7957](#L7957) | <path d="M98.6324 39.8248L98.6649 39.9239H98.7575L98.6826 39.9778L98.7136 40.0724L98.6324 40.0139L98.5512 40.0724L98.5822 39.9778L98.5072 39.9239H98.5999L98.6324 39.8248Z" stroke="#12D488" stroke-width="0.758084"/> |
| [7958](#L7958) | <path d="M70.5923 92.4332L70.6248 92.5323H70.7175L70.6425 92.5862L70.6736 92.6808L70.5923 92.6223L70.5111 92.6808L70.5421 92.5862L70.4672 92.5323H70.5598L70.5923 92.4332Z" stroke="#F5AE41" stroke-width="0.758084"/> |
| [7959](#L7959) | <path d="M47.4169 1.12892C47.4169 1.53965 47.0797 1.8788 46.6561 1.8788C46.2326 1.8788 45.8954 1.53965 45.8954 1.12892C45.8954 0.718185 46.2326 0.379042 46.6561 0.379042C47.0797 0.379042 47.4169 0.718185 47.4169 1.12892Z" stroke="#EE2445" stroke-opacity="0.7" stroke-width="0.758084"/> |
| [7960](#L7960) | <path d="M94.1486 65.4766C94.1486 65.8873 93.8114 66.2265 93.3878 66.2265C92.9643 66.2265 92.6271 65.8873 92.6271 65.4766C92.6271 65.0658 92.9643 64.7267 93.3878 64.7267C93.8114 64.7267 94.1486 65.0658 94.1486 65.4766Z" stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084"/> |
| [7961](#L7961) | <path d="M2.51086 65.4766C2.51086 65.8873 2.17369 66.2265 1.75013 66.2265C1.32656 66.2265 0.989393 65.8873 0.989393 65.4766C0.989393 65.0658 1.32656 64.7267 1.75013 64.7267C2.17369 64.7267 2.51086 65.0658 2.51086 65.4766Z" stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084"/> |
| [7962](#L7962) | <path d="M78.7639 11.7399H79.1429C79.1429 11.5408 78.9889 11.3756 78.7903 11.3617C78.5916 11.3479 78.4162 11.4901 78.3885 11.6872L78.7639 11.7399ZM77.6621 12.8239V12.4449C77.4602 12.4449 77.2938 12.6031 77.2836 12.8047C77.2733 13.0063 77.4229 13.1806 77.6237 13.201L77.6621 12.8239ZM78.7639 13.9977H78.3848C78.3848 14.2046 78.5508 14.3733 78.7577 14.3767C78.9646 14.3801 79.1359 14.2169 79.1427 14.0101L78.7639 13.9977ZM79.9417 12.8389V13.2179C80.1417 13.2179 80.3073 13.0625 80.3199 12.8628C80.3326 12.6631 80.1879 12.4881 79.9894 12.4629L79.9417 12.8389ZM78.3885 11.6872C78.3704 11.8168 78.3049 12.0223 78.1788 12.186C78.0617 12.3379 77.9023 12.4449 77.6621 12.4449V13.203C78.1818 13.203 78.548 12.9487 78.7791 12.6489C79.0012 12.3608 79.1068 12.0243 79.1393 11.7925L78.3885 11.6872ZM77.6237 13.201C77.7462 13.2135 77.9495 13.2749 78.1136 13.4065C78.2641 13.5273 78.3848 13.7071 78.3848 13.9977H79.1429C79.1429 13.451 78.8964 13.0626 78.5879 12.8151C78.2929 12.5785 77.9453 12.4717 77.7005 12.4468L77.6237 13.201ZM79.1427 14.0101C79.1471 13.8767 79.1964 13.666 79.3201 13.4991C79.4308 13.3498 79.6112 13.2179 79.9417 13.2179V12.4598C79.3603 12.4598 78.9582 12.7142 78.711 13.0478C78.477 13.3637 78.3933 13.7325 78.3851 13.9853L79.1427 14.0101ZM79.9894 12.4629C79.8426 12.4442 79.6106 12.3744 79.4257 12.2425C79.2503 12.1174 79.1429 11.9588 79.1429 11.7399H78.3848C78.3848 12.2686 78.67 12.6346 78.9854 12.8596C79.2913 13.0778 79.6481 13.1837 79.8939 13.2149L79.9894 12.4629Z" fill="#F4B125"/> |
| [7963](#L7963) | <line x1="78.6483" y1="10.6833" x2="78.6483" y2="10.3125" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round"/> |
| [7964](#L7964) | <line x1="78.6483" y1="16.3277" x2="78.6483" y2="15.2796" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round"/> |
| [7965](#L7965) | <path d="M80.623 12.8972H81.9908" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round"/> |
| [7966](#L7966) | <path d="M75.6084 12.8972H76.4632" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round"/> |
| [7967](#L7967) | <path class="bpa-head\_\_vector-item" d="M75.3977 42.9786C74.4164 41.9652 73.4018 40.9175 73.0185 39.9995C72.6662 39.1561 72.6449 37.7592 72.6243 36.4081C72.5859 33.8939 72.5425 31.0443 70.5423 29.0632C68.5422 27.0821 65.6652 27.0391 63.1268 27.0011C61.7627 26.9807 60.3524 26.9595 59.5009 26.6106C58.5743 26.2309 57.5163 25.226 56.4931 24.2541C54.6959 22.5467 52.6584 20.6117 49.9422 20.6117C47.226 20.6117 45.1888 22.5467 43.3913 24.2541C42.3681 25.226 41.3104 26.2309 40.3835 26.6106C39.532 26.9595 38.1217 26.9807 36.7576 27.0011C34.2192 27.0391 31.3422 27.0821 29.3421 29.0632C27.3419 31.0443 27.2985 33.8939 27.2601 36.4081C27.2396 37.7592 27.2182 39.1561 26.8659 39.9995C26.4826 40.9173 25.468 41.9652 24.4868 42.9786C22.763 44.7587 20.8093 46.7768 20.8093 49.4671C20.8093 52.1575 22.763 54.1753 24.4868 55.9556C25.468 56.9691 26.4826 58.0167 26.8659 58.9348C27.2182 59.7782 27.2396 61.1751 27.2601 62.5262C27.2985 65.0404 27.3419 67.89 29.3421 69.8711C31.3422 71.8522 34.2192 71.8952 36.7576 71.9332C38.1217 71.9536 39.532 71.9747 40.3835 72.3237C41.3101 72.7034 42.3681 73.7082 43.3913 74.6802C45.1885 76.3875 47.226 78.3226 49.9422 78.3226C52.6584 78.3226 54.6957 76.3875 56.4931 74.6802C57.5163 73.7083 58.574 72.7034 59.5009 72.3237C60.3524 71.9747 61.7627 71.9536 63.1268 71.9332C65.6652 71.8952 68.5422 71.8522 70.5423 69.8711C72.5425 67.89 72.5859 65.0404 72.6243 62.5262C72.6449 61.1751 72.6662 59.7782 73.0185 58.9348C73.4018 58.017 74.4164 56.9691 75.3977 55.9556C77.1214 54.1756 79.0751 52.1575 79.0751 49.4671C79.0751 46.7768 77.1214 44.759 75.3977 42.9786ZM62.824 44.7748L47.5638 59.2025C47.1767 59.5685 46.6622 59.7727 46.1271 59.7727C45.592 59.7727 45.0775 59.5685 44.6904 59.2025L37.0604 51.9887C36.8626 51.8018 36.7039 51.5782 36.5934 51.3306C36.4829 51.083 36.4227 50.8162 36.4163 50.5456C36.4098 50.2749 36.4573 50.0057 36.556 49.7532C36.6547 49.5007 36.8026 49.27 36.9913 49.0741C37.18 48.8783 37.4058 48.7212 37.6559 48.6118C37.9059 48.5024 38.1752 48.4429 38.4485 48.4366C38.7217 48.4304 38.9936 48.4775 39.2484 48.5753C39.5033 48.6731 39.7362 48.8197 39.9339 49.0067L46.1271 54.8622L59.9505 41.7929C60.1482 41.6059 60.3811 41.4593 60.636 41.3615C60.8908 41.2636 61.1627 41.2165 61.4359 41.2228C61.7092 41.229 61.9785 41.2886 62.2285 41.3979C62.4786 41.5073 62.7044 41.6644 62.8931 41.8603C63.0818 42.0561 63.2298 42.2869 63.3284 42.5393C63.4271 42.7918 63.4746 43.0611 63.4681 43.3317C63.4617 43.6024 63.4015 43.8691 63.291 44.1167C63.1805 44.3643 63.0218 44.588 62.824 44.7748Z" /> |
| [7968](#L7968) | </svg> |
| [7969](#L7969) | <div class="bpa-front-tmc\_\_booking-id"> |
| [7970](#L7970) | <div class="bpa-front-bi\_\_label">'.esc\_html\_\_('Booking ID', 'bookingpress-appointment-booking').': <span class="bpa-front-bi\_\_val">[booking\_id]</span></div> |
| [7971](#L7971) | </div> |
| [7972](#L7972) | <div class="bpa-front-tmc\_\_title">' . esc\_html\_\_('Your Appointment Booked successfully!', 'bookingpress-appointment-booking') . '</div> |
| [7973](#L7973) | <p>' . esc\_html\_\_('We have sent your booking information to your email address.', 'bookingpress-appointment-booking') . '</p> |
| [7974](#L7974) | </div> |
| [7975](#L7975) | <div class="bpa-front-tmc\_\_summary-content"> |
| [7976](#L7976) | <div class="bpa-front-tmc\_\_sc-item"> |
| [7977](#L7977) | <div class="bpa-front-sc-item\_\_label">' . esc\_html\_\_('Service:', 'bookingpress-appointment-booking') . '</div> |
| [7978](#L7978) | <div class="bpa-front-sc-item\_\_val">[bookingpress\_appointment\_service]</div> |
| [7979](#L7979) | </div> |
| [7980](#L7980) | <div class="bpa-front-tmc\_\_sc-item"> |
| [7981](#L7981) | <div class="bpa-front-sc-item\_\_label">' . str\_replace( '&amp;', '&', esc\_html\_\_('Date & Time:', 'bookingpress-appointment-booking') ) . '</div> |
| [7982](#L7982) | <div class="bpa-front-sc-item\_\_val">[bookingpress\_appointment\_datetime]</div> |
| [7983](#L7983) | </div> |
| [7984](#L7984) | <div class="bpa-front-tmc\_\_sc-item"> |
| [7985](#L7985) | <div class="bpa-front-sc-item\_\_label">' . esc\_html\_\_('Customer Name:', 'bookingpress-appointment-booking') . '</div> |
| [7986](#L7986) | <div class="bpa-front-sc-item\_\_val">[bookingpress\_appointment\_customername]</div> |
| [7987](#L7987) | </div> |
| [7988](#L7988) | </div> |
| [7989](#L7989) | <div class="bpa-front-module--add-to-calendar"> |
| [7990](#L7990) | <div class="bpa-fm--atc\_\_heading">' . esc\_html\_\_('Add to Calendar', 'bookingpress-appointment-booking') . '</div> |
| [7991](#L7991) | [bookingpress\_appointment\_calendar\_integration] |
| [7992](#L7992) | </div> |
| [7993](#L7993) | </div>'; |
| [7994](#L7994) |  |
| [7995](#L7995) | $bookingpress\_thankyou\_page\_details = array( |
| [7996](#L7996) | 'post\_title'   => esc\_html\_\_('Thank you', 'bookingpress-appointment-booking'), |
| [7997](#L7997) | 'post\_name'    => 'thank-you', |
| [7998](#L7998) | 'post\_content' => $bookingpress\_thankyoupage\_content, |
| [7999](#L7999) | 'post\_status'  => 'publish', |
| [8000](#L8000) | 'post\_parent'  => 0, |
| [8001](#L8001) | 'post\_author'  => 1, |
| [8002](#L8002) | 'post\_type'    => 'page', |
| [8003](#L8003) | 'post\_author'   => $post\_author, |
| [8004](#L8004) | 'post\_date'     => current\_time( 'mysql' ), |
| [8005](#L8005) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [8006](#L8006) | ); |
| [8007](#L8007) |  |
| [8008](#L8008) | $wpdb->insert( $post\_table, $bookingpress\_thankyou\_page\_details ); |
| [8009](#L8009) | $bookingpress\_post\_id = $wpdb->insert\_id; |
| [8010](#L8010) |  |
| [8011](#L8011) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_post\_id ); |
| [8012](#L8012) | $where = array( 'ID' => $bookingpress\_post\_id ); |
| [8013](#L8013) | if( '' === $current\_guid ){ |
| [8014](#L8014) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_post\_id ) ), $where ); |
| [8015](#L8015) | } |
| [8016](#L8016) |  |
| [8017](#L8017) | $bookingpress\_thankyou\_page\_url = get\_permalink($bookingpress\_post\_id); |
| [8018](#L8018) | if (! empty($bookingpress\_thankyou\_page\_url) ) { |
| [8019](#L8019) | $booking\_form = array( |
| [8020](#L8020) | 'after\_booking\_redirection' => $bookingpress\_post\_id, |
| [8021](#L8021) | 'bookingpress\_thankyou\_msg' => $bookingpress\_thankyoupage\_content, |
| [8022](#L8022) | ); |
| [8023](#L8023) | foreach($booking\_form as $key => $value) { |
| [8024](#L8024) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [8025](#L8025) | 'bookingpress\_setting\_name'  => $key, |
| [8026](#L8026) | 'bookingpress\_setting\_value' => $value, |
| [8027](#L8027) | 'bookingpress\_setting\_type'  => 'booking\_form', |
| [8028](#L8028) | ); |
| [8029](#L8029) | $wpdb->insert( $tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields ); |
| [8030](#L8030) | } |
| [8031](#L8031) | } |
| [8032](#L8032) |  |
| [8033](#L8033) | $bookingpress\_cancelpage\_content = ' |
| [8034](#L8034) | <div class="bpa-front-cancel-module-container"> |
| [8035](#L8035) | <div class="bpa-front-cmc\_\_title">' . esc\_html\_\_('Sorry to hear that you have requested for cancel the appointment.', 'bookingpress-appointment-booking') . '</div> |
| [8036](#L8036) | <div class="bpa-front-cmc\_\_desc">' . esc\_html\_\_('We have sent an email notification for cancel appointment. So please click on the button to cancel the appointment.', 'bookingpress-appointment-booking') . '</div> |
| [8037](#L8037) | </div>'; |
| [8038](#L8038) |  |
| [8039](#L8039) | $bookingpress\_cancel\_page\_details = array( |
| [8040](#L8040) | 'post\_title'   => esc\_html\_\_('Appointment canceled', 'bookingpress-appointment-booking'), |
| [8041](#L8041) | 'post\_name'    => 'cancel-appointment', |
| [8042](#L8042) | 'post\_content' => $bookingpress\_cancelpage\_content, |
| [8043](#L8043) | 'post\_status'  => 'publish', |
| [8044](#L8044) | 'post\_parent'  => 0, |
| [8045](#L8045) | 'post\_author'  => 1, |
| [8046](#L8046) | 'post\_type'    => 'page', |
| [8047](#L8047) | 'post\_author'   => $post\_author, |
| [8048](#L8048) | 'post\_date'     => current\_time( 'mysql' ), |
| [8049](#L8049) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [8050](#L8050) | ); |
| [8051](#L8051) |  |
| [8052](#L8052) | $wpdb->insert( $post\_table, $bookingpress\_cancel\_page\_details ); |
| [8053](#L8053) | $bookingpress\_post\_id = $wpdb->insert\_id; |
| [8054](#L8054) |  |
| [8055](#L8055) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_post\_id ); |
| [8056](#L8056) | $where = array( 'ID' => $bookingpress\_post\_id ); |
| [8057](#L8057) | if( '' === $current\_guid ){ |
| [8058](#L8058) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_post\_id ) ), $where ); |
| [8059](#L8059) | } |
| [8060](#L8060) |  |
| [8061](#L8061) |  |
| [8062](#L8062) | $bookingpress\_cancel\_page\_url = get\_permalink($bookingpress\_post\_id); |
| [8063](#L8063) | if (! empty($bookingpress\_cancel\_page\_url) ) { |
| [8064](#L8064) | $my\_booking\_form = array( |
| [8065](#L8065) | 'after\_cancelled\_appointment\_redirection'     => $bookingpress\_post\_id, |
| [8066](#L8066) | ); |
| [8067](#L8067) | foreach($my\_booking\_form as $key => $value) { |
| [8068](#L8068) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [8069](#L8069) | 'bookingpress\_setting\_name'  => $key, |
| [8070](#L8070) | 'bookingpress\_setting\_value' => $value, |
| [8071](#L8071) | 'bookingpress\_setting\_type'  => 'booking\_my\_booking', |
| [8072](#L8072) | ); |
| [8073](#L8073) | $wpdb->insert( $tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields ); |
| [8074](#L8074) | } |
| [8075](#L8075) | } |
| [8076](#L8076) |  |
| [8077](#L8077) | // Cancel payment page |
| [8078](#L8078) | $bookingpress\_cancel\_payment\_page = ' |
| [8079](#L8079) | <div class="bpa-front-data-empty-view \_\_bpa-is-guest-view"> |
| [8080](#L8080) | <h4>' . esc\_html\_\_('Sorry! Something went wrong. Your payment has been failed.', 'bookingpress-appointment-booking') . '</h4> |
| [8081](#L8081) | </div>'; |
| [8082](#L8082) |  |
| [8083](#L8083) | $bookingpress\_cancel\_page\_details = array( |
| [8084](#L8084) | 'post\_title'   => esc\_html\_\_('Cancel Payment', 'bookingpress-appointment-booking'), |
| [8085](#L8085) | 'post\_name'    => 'cancel-payment', |
| [8086](#L8086) | 'post\_content' => $bookingpress\_cancel\_payment\_page, |
| [8087](#L8087) | 'post\_status'  => 'publish', |
| [8088](#L8088) | 'post\_parent'  => 0, |
| [8089](#L8089) | 'post\_author'  => 1, |
| [8090](#L8090) | 'post\_type'    => 'page', |
| [8091](#L8091) | 'post\_author'   => $post\_author, |
| [8092](#L8092) | 'post\_date'     => current\_time( 'mysql' ), |
| [8093](#L8093) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [8094](#L8094) | ); |
| [8095](#L8095) |  |
| [8096](#L8096) | $wpdb->insert( $post\_table, $bookingpress\_cancel\_page\_details ); |
| [8097](#L8097) | $bookingpress\_post\_id = $wpdb->insert\_id; |
| [8098](#L8098) |  |
| [8099](#L8099) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_post\_id ); |
| [8100](#L8100) | $where = array( 'ID' => $bookingpress\_post\_id ); |
| [8101](#L8101) | if( '' === $current\_guid ){ |
| [8102](#L8102) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_post\_id ) ), $where ); |
| [8103](#L8103) | } |
| [8104](#L8104) |  |
| [8105](#L8105) | $bookingpress\_cancel\_payment\_url = get\_permalink($bookingpress\_post\_id); |
| [8106](#L8106) | if (! empty($bookingpress\_cancel\_payment\_url) ) { |
| [8107](#L8107) | $my\_booking\_form = array( |
| [8108](#L8108) | 'after\_failed\_payment\_redirection' => $bookingpress\_post\_id, |
| [8109](#L8109) | 'bookingpress\_failed\_payment\_msg' => $bookingpress\_cancel\_payment\_page, |
| [8110](#L8110) | ); |
| [8111](#L8111) | foreach($my\_booking\_form as $key => $value) { |
| [8112](#L8112) | $bookingpress\_customize\_settings\_db\_fields = array( |
| [8113](#L8113) | 'bookingpress\_setting\_name'  => $key, |
| [8114](#L8114) | 'bookingpress\_setting\_value' => $value, |
| [8115](#L8115) | 'bookingpress\_setting\_type'  => 'booking\_form', |
| [8116](#L8116) | ); |
| [8117](#L8117) | $wpdb->insert( $tbl\_bookingpress\_customize\_settings, $bookingpress\_customize\_settings\_db\_fields ); |
| [8118](#L8118) | } |
| [8119](#L8119) | } |
| [8120](#L8120) |  |
| [8121](#L8121) | // Appointment cancellation confirmation page |
| [8122](#L8122) | $bookingpress\_cancellation\_confirmation\_payment\_content= '<!-- wp:shortcode -->[bookingpress\_appointment\_cancellation\_confirmation]<!-- /wp:shortcode -->'; |
| [8123](#L8123) | $bookingpress\_cancel\_page\_details = array( |
| [8124](#L8124) | 'post\_title'   => esc\_html\_\_('Appointment cancellation confirmation', 'bookingpress-appointment-booking'), |
| [8125](#L8125) | 'post\_name'    => 'appointment-cancellation-confirmation', |
| [8126](#L8126) | 'post\_content' => $bookingpress\_cancellation\_confirmation\_payment\_content, |
| [8127](#L8127) | 'post\_status'  => 'publish', |
| [8128](#L8128) | 'post\_parent'  => 0, |
| [8129](#L8129) | 'post\_author'  => 1, |
| [8130](#L8130) | 'post\_type'    => 'page', |
| [8131](#L8131) | 'post\_author'   => $post\_author, |
| [8132](#L8132) | 'post\_date'     => current\_time( 'mysql' ), |
| [8133](#L8133) | 'post\_date\_gmt' => current\_time( 'mysql', 1 ), |
| [8134](#L8134) | ); |
| [8135](#L8135) |  |
| [8136](#L8136) | $wpdb->insert( $post\_table, $bookingpress\_cancel\_page\_details ); |
| [8137](#L8137) | $bookingpress\_cancellation\_post\_id = $wpdb->insert\_id; |
| [8138](#L8138) |  |
| [8139](#L8139) | $current\_guid = get\_post\_field( 'guid', $bookingpress\_cancellation\_post\_id ); |
| [8140](#L8140) | $where = array( 'ID' => $bookingpress\_cancellation\_post\_id ); |
| [8141](#L8141) | if( '' === $current\_guid ){ |
| [8142](#L8142) | $wpdb->update( $wpdb->posts, array( 'guid' => get\_permalink( $bookingpress\_cancellation\_post\_id ) ), $where ); |
| [8143](#L8143) | } |
| [8144](#L8144) |  |
| [8145](#L8145) | $bookingpress\_appointment\_cancellation\_payment\_url = get\_permalink($bookingpress\_cancellation\_post\_id); |
| [8146](#L8146) | if (! empty($bookingpress\_appointment\_cancellation\_payment\_url) ) { |
| [8147](#L8147) | $bookingpress\_my\_booking\_customize\_setting['appointment\_cancellation\_confirmation'] = $bookingpress\_cancellation\_post\_id; |
| [8148](#L8148) | foreach($bookingpress\_my\_booking\_customize\_setting as $key => $val){ |
| [8149](#L8149) | $bookingpress\_bd\_data = array( |
| [8150](#L8150) | 'bookingpress\_setting\_name' => $key, |
| [8151](#L8151) | 'bookingpress\_setting\_value' => $val, |
| [8152](#L8152) | 'bookingpress\_setting\_type' => 'booking\_my\_booking', |
| [8153](#L8153) | ); |
| [8154](#L8154) | $wpdb->insert($tbl\_bookingpress\_customize\_settings, $bookingpress\_bd\_data); |
| [8155](#L8155) | } |
| [8156](#L8156) | } |
| [8157](#L8157) | } |
| [8158](#L8158) |  |
| [8159](#L8159) | /\*\* |
| [8160](#L8160) | \* Change php date format to javascript date format |
| [8161](#L8161) | \* |
| [8162](#L8162) | \* @param  mixed $selected\_date\_format |
| [8163](#L8163) | \* @return void |
| [8164](#L8164) | \*/ |
| [8165](#L8165) | function bookingpress\_check\_common\_date\_format( $selected\_date\_format ) |
| [8166](#L8166) | { |
| [8167](#L8167) | $return\_final\_date\_format              = ''; |
| [8168](#L8168) | $Bookingpres\_elementer\_default\_formate = array( |
| [8169](#L8169) | 'Y' => 'yyyy', |
| [8170](#L8170) | 'y' => 'yy', |
| [8171](#L8171) | 'F' => 'MMMM', |
| [8172](#L8172) | 'M' => 'MMM', |
| [8173](#L8173) | 'm' => 'MM', |
| [8174](#L8174) | 'n' => 'M', |
| [8175](#L8175) | 'l' => 'dddd', |
| [8176](#L8176) | 'D' => 'ddd', |
| [8177](#L8177) | 'd' => 'dd', |
| [8178](#L8178) | 'j' => 'd', |
| [8179](#L8179) | ); |
| [8180](#L8180) | $bookingpress\_supported\_date\_formats   = array( 'd', 'D', 'm', 'M', 'y', 'Y', 'F', 'j', 'l', 'n' ); |
| [8181](#L8181) |  |
| [8182](#L8182) | if ($selected\_date\_format == 'F j, Y' ) { |
| [8183](#L8183) | return 'MMMM d, yyyy'; |
| [8184](#L8184) | } elseif (substr\_count($selected\_date\_format, '-') ) { |
| [8185](#L8185) | $bookingpress\_tmp\_date\_format\_arr = explode('-', $selected\_date\_format); |
| [8186](#L8186) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8187](#L8187) |  |
| [8188](#L8188) | $return\_final\_date\_format = ''; |
| [8189](#L8189) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) ) { |
| [8190](#L8190) | $return\_final\_date\_format = $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[0] ] . '-'; |
| [8191](#L8191) | } |
| [8192](#L8192) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) ) { |
| [8193](#L8193) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[1] ] . '-'; |
| [8194](#L8194) | } |
| [8195](#L8195) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8196](#L8196) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[2] ]; |
| [8197](#L8197) | } |
| [8198](#L8198) | return $return\_final\_date\_format; |
| [8199](#L8199) | } else { |
| [8200](#L8200) | return 'MMMM d, yyyy'; |
| [8201](#L8201) | } |
| [8202](#L8202) | } elseif (substr\_count($selected\_date\_format, '/') ) { |
| [8203](#L8203) | $bookingpress\_tmp\_date\_format\_arr = explode('/', $selected\_date\_format); |
| [8204](#L8204) |  |
| [8205](#L8205) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8206](#L8206) |  |
| [8207](#L8207) | $return\_final\_date\_format = ''; |
| [8208](#L8208) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) ) { |
| [8209](#L8209) | $return\_final\_date\_format = $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[0] ] . '/'; |
| [8210](#L8210) | } |
| [8211](#L8211) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) ) { |
| [8212](#L8212) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[1] ] . '/'; |
| [8213](#L8213) | } |
| [8214](#L8214) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8215](#L8215) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[2] ]; |
| [8216](#L8216) | } |
| [8217](#L8217) | return $return\_final\_date\_format; |
| [8218](#L8218) | } else { |
| [8219](#L8219) | return 'MMMM d, yyyy'; |
| [8220](#L8220) | } |
| [8221](#L8221) | } elseif (substr\_count($selected\_date\_format, ' ') ) { |
| [8222](#L8222) |  |
| [8223](#L8223) | $bookingpress\_tmp\_date\_format\_arr = explode(' ', $selected\_date\_format); |
| [8224](#L8224) | $return\_final\_date\_format         = ''; |
| [8225](#L8225) |  |
| [8226](#L8226) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8227](#L8227) |  |
| [8228](#L8228) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) ) { |
| [8229](#L8229) | $return\_final\_date\_format = $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[0] ] . ' '; |
| [8230](#L8230) | } |
| [8231](#L8231) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) ) { |
| [8232](#L8232) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[1] ] . ' '; |
| [8233](#L8233) | } |
| [8234](#L8234) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8235](#L8235) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[2] ]; |
| [8236](#L8236) | } |
| [8237](#L8237) | return $return\_final\_date\_format; |
| [8238](#L8238) |  |
| [8239](#L8239) | } else { |
| [8240](#L8240) | return 'MMMM d, yyyy'; |
| [8241](#L8241) | } |
| [8242](#L8242) | } elseif (substr\_count($selected\_date\_format, '.') ) { |
| [8243](#L8243) | $bookingpress\_tmp\_date\_format\_arr = explode('.', $selected\_date\_format); |
| [8244](#L8244) | $return\_final\_date\_format         = ''; |
| [8245](#L8245) |  |
| [8246](#L8246) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) && in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8247](#L8247) |  |
| [8248](#L8248) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[0], $bookingpress\_supported\_date\_formats) ) { |
| [8249](#L8249) | $return\_final\_date\_format = $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[0] ] . '.'; |
| [8250](#L8250) | } |
| [8251](#L8251) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[1], $bookingpress\_supported\_date\_formats) ) { |
| [8252](#L8252) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[1] ] . '.'; |
| [8253](#L8253) | } |
| [8254](#L8254) | if (in\_array($bookingpress\_tmp\_date\_format\_arr[2], $bookingpress\_supported\_date\_formats) ) { |
| [8255](#L8255) | $return\_final\_date\_format = $return\_final\_date\_format . $Bookingpres\_elementer\_default\_formate[ $bookingpress\_tmp\_date\_format\_arr[2] ]; |
| [8256](#L8256) | } |
| [8257](#L8257) | return $return\_final\_date\_format; |
| [8258](#L8258) |  |
| [8259](#L8259) | } else { |
| [8260](#L8260) | return 'MMMM d, yyyy'; |
| [8261](#L8261) | } |
| [8262](#L8262) | } else { |
| [8263](#L8263) | return 'MMMM d, yyyy'; |
| [8264](#L8264) | } |
| [8265](#L8265) | } |
| [8266](#L8266) |  |
| [8267](#L8267) | /\*\* |
| [8268](#L8268) | \* Change PHP time format to javascript time format |
| [8269](#L8269) | \* |
| [8270](#L8270) | \* @param  mixed $selected\_time\_format |
| [8271](#L8271) | \* @return void |
| [8272](#L8272) | \*/ |
| [8273](#L8273) | function bookingpress\_check\_common\_time\_format( $selected\_time\_format ) { |
| [8274](#L8274) | if ( $selected\_time\_format == 'g:i a' ) { |
| [8275](#L8275) | return 'h mm a'; |
| [8276](#L8276) | } else if( $selected\_time\_format == 'g:i A' ) { |
| [8277](#L8277) | return 'h mm A'; |
| [8278](#L8278) | } else if( $selected\_time\_format == 'H:i' ) { |
| [8279](#L8279) | return 'hh mm'; |
| [8280](#L8280) | } else if( $selected\_time\_format == 'H:i:s' ) { |
| [8281](#L8281) | return 'hh mm ss'; |
| [8282](#L8282) | } else { |
| [8283](#L8283) | return 'h mm a'; |
| [8284](#L8284) | } |
| [8285](#L8285) | } |
| [8286](#L8286) |  |
| [8287](#L8287) | /\*\* |
| [8288](#L8288) | \* bookingpress\_write\_response |
| [8289](#L8289) | \* |
| [8290](#L8290) | \* @param  mixed $response\_data |
| [8291](#L8291) | \* @param  mixed $file\_name |
| [8292](#L8292) | \* @param  mixed $mode - possible values | file - to write logs in file, db - to write logs in the database, both - to write logs in file and database both | default - file |
| [8293](#L8293) | \* @param  mixed $overwrite |
| [8294](#L8294) | \* @return void |
| [8295](#L8295) | \*/ |
| [8296](#L8296) | function bookingpress\_write\_response( $response\_data, $file\_name = '', $mode = 'file', $overwrite = false ) |
| [8297](#L8297) | { |
| [8298](#L8298) | global $wp, $wpdb, $wp\_filesystem; |
| [8299](#L8299) | $file\_path = BOOKINGPRESS\_DIR . '/log/response.txt'; |
| [8300](#L8300) | if (file\_exists(ABSPATH . 'wp-admin/includes/file.php') && ( 'file' == $mode || 'both' == $mode ) ) { |
| [8301](#L8301) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [8302](#L8302) | if (false === ( $creds = request\_filesystem\_credentials($file\_path, '', false, false) ) ) { |
| [8303](#L8303) | return true; |
| [8304](#L8304) | } |
| [8305](#L8305) |  |
| [8306](#L8306) | if (! WP\_Filesystem($creds) ) { |
| [8307](#L8307) | request\_filesystem\_credentials($file\_path, $method, true, false); |
| [8308](#L8308) | return true; |
| [8309](#L8309) | } |
| [8310](#L8310) | @$file\_data = $wp\_filesystem->get\_contents($file\_path); |
| [8311](#L8311) | $file\_data .= $response\_data; |
| [8312](#L8312) | $file\_data .= "\r\n===========================================================================\r\n"; |
| [8313](#L8313) | $breaks     = array( '<br />', '<br>', '<br/>' ); |
| [8314](#L8314) | $file\_data  = str\_ireplace($breaks, "\r\n", $file\_data); |
| [8315](#L8315) |  |
| [8316](#L8316) | if( true == $overwrite ){ |
| [8317](#L8317) | $wp\_filesystem->put\_contents( $file\_path, '', 0755 ); // clear file every time logs write |
| [8318](#L8318) | } |
| [8319](#L8319) |  |
| [8320](#L8320) | @$write\_file = $wp\_filesystem->put\_contents($file\_path, $file\_data, 0755); |
| [8321](#L8321) | } |
| [8322](#L8322) |  |
| [8323](#L8323) | if( 'db' == $mode || 'both' == $mode ){ |
| [8324](#L8324) | $option\_name = 'bpa\_debug\_log\_' . current\_time('timestamp'); |
| [8325](#L8325) | $option\_value = $response\_data; |
| [8326](#L8326) |  |
| [8327](#L8327) | update\_option( $option\_name, $option\_value ); |
| [8328](#L8328) | } |
| [8329](#L8329) | return; |
| [8330](#L8330) | } |
| [8331](#L8331) |  |
| [8332](#L8332) | /\*\* |
| [8333](#L8333) | \* Insert payment logs |
| [8334](#L8334) | \* |
| [8335](#L8335) | \* @param  mixed $bookingpress\_log\_payment\_gateway |
| [8336](#L8336) | \* @param  mixed $bookingpress\_log\_event |
| [8337](#L8337) | \* @param  mixed $bookingpress\_log\_event\_from |
| [8338](#L8338) | \* @param  mixed $bookingpress\_payment\_log\_raw\_data |
| [8339](#L8339) | \* @param  mixed $bookingpress\_ref\_id |
| [8340](#L8340) | \* @param  mixed $bookingpress\_log\_status |
| [8341](#L8341) | \* @return void |
| [8342](#L8342) | \*/ |
| [8343](#L8343) | function bookingpress\_write\_payment\_log( $bookingpress\_log\_payment\_gateway, $bookingpress\_log\_event, $bookingpress\_log\_event\_from = 'bookingpress', $bookingpress\_payment\_log\_raw\_data = '', $bookingpress\_ref\_id = 0, $bookingpress\_log\_status = 1 ) |
| [8344](#L8344) | { |
| [8345](#L8345) |  |
| [8346](#L8346) | global $wpdb, $BookingPress,$bookingpress\_debug\_payment\_log\_id,$tbl\_bookingpress\_debug\_payment\_log; |
| [8347](#L8347) |  |
| [8348](#L8348) | $bookingpress\_log\_payment\_setting\_name = $bookingpress\_log\_payment\_gateway; |
| [8349](#L8349) | $bookingpress\_active\_gateway           = false; |
| [8350](#L8350) | if (! empty($bookingpress\_log\_payment\_gateway) && $bookingpress\_log\_payment\_gateway == 'on-site' ) { |
| [8351](#L8351) | $bookingpress\_log\_payment\_setting\_name = 'on\_site\_payment'; |
| [8352](#L8352) | } elseif(!empty($bookingpress\_log\_payment\_gateway)){ |
| [8353](#L8353) | $bookingpress\_log\_payment\_setting\_name = $bookingpress\_log\_payment\_gateway.'\_payment'; |
| [8354](#L8354) | } |
| [8355](#L8355) | if (! empty($bookingpress\_log\_payment\_setting\_name) ) { |
| [8356](#L8356) | $bookingpress\_active\_gateway = $BookingPress->bookingpress\_get\_settings($bookingpress\_log\_payment\_setting\_name, 'debug\_log\_setting'); |
| [8357](#L8357) | } |
| [8358](#L8358) | $inserted\_id = 0; |
| [8359](#L8359) | if ($bookingpress\_active\_gateway == 'true' ) { |
| [8360](#L8360) | if ($bookingpress\_ref\_id == null ) { |
| [8361](#L8361) | $bookingpress\_ref\_id = 0; |
| [8362](#L8362) | } |
| [8363](#L8363) |  |
| [8364](#L8364) | $bookingpress\_database\_log\_data = array( |
| [8365](#L8365) | 'bookingpress\_payment\_log\_ref\_id'     => sanitize\_text\_field($bookingpress\_ref\_id), |
| [8366](#L8366) | 'bookingpress\_payment\_log\_gateway'    => sanitize\_text\_field($bookingpress\_log\_payment\_gateway), |
| [8367](#L8367) | 'bookingpress\_payment\_log\_event'      => sanitize\_text\_field($bookingpress\_log\_event), |
| [8368](#L8368) | 'bookingpress\_payment\_log\_event\_from' => sanitize\_text\_field($bookingpress\_log\_event\_from), |
| [8369](#L8369) | 'bookingpress\_payment\_log\_status'     => sanitize\_text\_field($bookingpress\_log\_status), |
| [8370](#L8370) | 'bookingpress\_payment\_log\_raw\_data'   => wp\_json\_encode(stripslashes\_deep($bookingpress\_payment\_log\_raw\_data)), |
| [8371](#L8371) | 'bookingpress\_payment\_log\_added\_date' => current\_time('mysql'), |
| [8372](#L8372) | ); |
| [8373](#L8373) |  |
| [8374](#L8374) | $wpdb->insert($tbl\_bookingpress\_debug\_payment\_log, $bookingpress\_database\_log\_data); |
| [8375](#L8375) | $inserted\_id = $wpdb->insert\_id; |
| [8376](#L8376) | if (empty($bookingpress\_ref\_id) ) { |
| [8377](#L8377) | $bookingpress\_ref\_id = $inserted\_id; |
| [8378](#L8378) | } |
| [8379](#L8379) | } |
| [8380](#L8380) | $bookingpress\_debug\_payment\_log\_id = $bookingpress\_ref\_id; |
| [8381](#L8381) | return $inserted\_id; |
| [8382](#L8382) | } |
| [8383](#L8383) |  |
| [8384](#L8384) | /\*\* |
| [8385](#L8385) | \* Download debug log files |
| [8386](#L8386) | \* |
| [8387](#L8387) | \* @return void |
| [8388](#L8388) | \*/ |
| [8389](#L8389) | function bookingpress\_debug\_log\_download\_file() |
| [8390](#L8390) | { |
| [8391](#L8391) |  |
| [8392](#L8392) | if (! empty($\_REQUEST['bookingpress\_action']) && 'download\_log' == sanitize\_text\_field($\_REQUEST['bookingpress\_action']) ) { // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8393](#L8393) |  |
| [8394](#L8394) | $filename = ! empty($\_REQUEST['file']) ? basename(sanitize\_file\_name($\_REQUEST['file'])) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8395](#L8395) | if (! empty($filename) ) { |
| [8396](#L8396) | $file\_path = BOOKINGPRESS\_UPLOAD\_DIR . '/' . $filename; |
| [8397](#L8397) |  |
| [8398](#L8398) | $allowexts = array( 'txt', 'zip' ); |
| [8399](#L8399) |  |
| [8400](#L8400) | $file\_name\_bpa = substr($filename, 0, 3); |
| [8401](#L8401) |  |
| [8402](#L8402) | $checkext = explode('.', $filename); |
| [8403](#L8403) | $ext      = strtolower($checkext[ count($checkext) - 1 ]); |
| [8404](#L8404) |  |
| [8405](#L8405) | if (! empty($ext) && in\_array($ext, $allowexts) && ! empty($filename) && file\_exists($file\_path) ) { |
| [8406](#L8406) | ignore\_user\_abort(); |
| [8407](#L8407) | $now = gmdate('D, d M Y H:i:s'); |
| [8408](#L8408) | header('Expires: Tue, 03 Jul 2020 06:00:00 GMT'); |
| [8409](#L8409) | header('Cache-Control: max-age=0, no-cache, must-revalidate, proxy-revalidate'); |
| [8410](#L8410) | header("Last-Modified: {$now} GMT"); |
| [8411](#L8411) | header('Content-Type: application/force-download'); |
| [8412](#L8412) | header('Content-Type: application/octet-stream'); |
| [8413](#L8413) | header('Content-Type: application/download'); |
| [8414](#L8414) | header("Content-Disposition: attachment;filename={$filename}"); |
| [8415](#L8415) | header('Content-Transfer-Encoding: binary'); |
| [8416](#L8416) |  |
| [8417](#L8417) | readfile($file\_path); |
| [8418](#L8418) |  |
| [8419](#L8419) | @unlink($file\_path); |
| [8420](#L8420) |  |
| [8421](#L8421) | $bpa\_txt\_file\_name = str\_replace('.zip', '.txt', $filename); |
| [8422](#L8422) | $bpa\_txt\_file\_path = BOOKINGPRESS\_UPLOAD\_DIR . '/' . $bpa\_txt\_file\_name; |
| [8423](#L8423) | if (file\_exists($bpa\_txt\_file\_path) ) { |
| [8424](#L8424) | @unlink($bpa\_txt\_file\_path); |
| [8425](#L8425) | } |
| [8426](#L8426) |  |
| [8427](#L8427) | die; |
| [8428](#L8428) | } |
| [8429](#L8429) | } |
| [8430](#L8430) | } |
| [8431](#L8431) | } |
| [8432](#L8432) |  |
| [8433](#L8433) |  |
| [8434](#L8434) | /\*\* |
| [8435](#L8435) | \* View debug payment logs |
| [8436](#L8436) | \* |
| [8437](#L8437) | \* @return void |
| [8438](#L8438) | \*/ |
| [8439](#L8439) | function bookingpress\_view\_debug\_payment\_log\_func() |
| [8440](#L8440) | { |
| [8441](#L8441) | global $wpdb,$tbl\_bookingpress\_debug\_payment\_log; |
| [8442](#L8442) | $response              = array(); |
| [8443](#L8443) | $response['variant']   = 'error'; |
| [8444](#L8444) | $response['title']     = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [8445](#L8445) | $response['msg']       = esc\_html\_\_('Something went wrong', 'bookingpress-appointment-booking'); |
| [8446](#L8446) |  |
| [8447](#L8447) | $perpage     = isset($\_POST['perpage']) ? intval($\_POST['perpage']) : 20; // phpcs:ignore WordPress.Security.NonceVerification |
| [8448](#L8448) | $currentpage = isset($\_POST['currentpage']) ? intval($\_POST['currentpage']) : 1; // phpcs:ignore WordPress.Security.NonceVerification |
| [8449](#L8449) | $offset      = ( ! empty($currentpage) && $currentpage > 1 ) ? ( ( $currentpage - 1 ) \* $perpage ) : 0; |
| [8450](#L8450) |  |
| [8451](#L8451) | $bpa\_check\_authorization = $this->bpa\_check\_authentication( 'view\_debug\_payment\_logs', true, 'bpa\_wp\_nonce' ); |
| [8452](#L8452) |  |
| [8453](#L8453) | if( preg\_match( '/error/', $bpa\_check\_authorization ) ){ |
| [8454](#L8454) | $bpa\_auth\_error = explode( '^|^', $bpa\_check\_authorization ); |
| [8455](#L8455) | $bpa\_error\_msg = !empty( $bpa\_auth\_error[1] ) ? $bpa\_auth\_error[1] : esc\_html\_\_( 'Sorry. Something went wrong while processing the request', 'bookingpress-appointment-booking'); |
| [8456](#L8456) |  |
| [8457](#L8457) | $response['variant'] = 'error'; |
| [8458](#L8458) | $response['title'] = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking'); |
| [8459](#L8459) | $response['msg'] = $bpa\_error\_msg; |
| [8460](#L8460) |  |
| [8461](#L8461) | wp\_send\_json( $response ); |
| [8462](#L8462) | die; |
| [8463](#L8463) | } |
| [8464](#L8464) |  |
| [8465](#L8465) | $bookingpress\_view\_log\_selector = isset($\_REQUEST['bookingpress\_debug\_log\_selector']) ? sanitize\_text\_field($\_REQUEST['bookingpress\_debug\_log\_selector']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8466](#L8466) |  |
| [8467](#L8467) | if (! empty($bookingpress\_view\_log\_selector) ) { |
| [8468](#L8468) | /\* $bookingpress\_search\_query  = ' WHERE 1=1'; |
| [8469](#L8469) | $bookingpress\_search\_query .= " AND bookingpress\_payment\_log\_gateway = '{$bookingpress\_view\_log\_selector}'"; \*/ |
| [8470](#L8470) | $total\_payment\_debug\_logs   = $wpdb->get\_results( $wpdb->prepare( 'SELECT \* FROM ' . $tbl\_bookingpress\_debug\_payment\_log . " WHERE bookingpress\_payment\_log\_gateway = %s ORDER BY bookingpress\_payment\_log\_id DESC", $bookingpress\_view\_log\_selector ), ARRAY\_A); //phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared --Reason $tbl\_bookingpress\_debug\_payment\_log is table name |
| [8471](#L8471) | $payment\_debug\_logs         = $wpdb->get\_results( $wpdb->prepare( 'SELECT \* FROM ' . $tbl\_bookingpress\_debug\_payment\_log . " WHERE bookingpress\_payment\_log\_gateway = %s ORDER BY bookingpress\_payment\_log\_id DESC LIMIT %d, %d", $bookingpress\_view\_log\_selector, $offset , $perpage ), ARRAY\_A); //phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared --Reason $tbl\_bookingpress\_debug\_payment\_log is table name |
| [8472](#L8472) |  |
| [8473](#L8473) | $payment\_debug\_log\_data = array(); |
| [8474](#L8474) | if (! empty($payment\_debug\_logs) ) { |
| [8475](#L8475) | $bookingpress\_date\_format = get\_option('date\_format'); |
| [8476](#L8476) | foreach ( $payment\_debug\_logs as $payment\_debug\_log\_key => $payment\_debug\_log\_val ) { |
| [8477](#L8477) |  |
| [8478](#L8478) | $bookingpress\_payment\_log\_id         = ! empty($payment\_debug\_log\_val['bookingpress\_payment\_log\_id']) ? intval($payment\_debug\_log\_val['bookingpress\_payment\_log\_id']) : ''; |
| [8479](#L8479) | $bookingpress\_payment\_log\_event      = ! empty($payment\_debug\_log\_val['bookingpress\_payment\_log\_event']) ? esc\_html($payment\_debug\_log\_val['bookingpress\_payment\_log\_event']) : ''; |
| [8480](#L8480) | $bookingpress\_payment\_log\_raw\_data   = ! empty($payment\_debug\_log\_val['bookingpress\_payment\_log\_raw\_data']) ? $payment\_debug\_log\_val['bookingpress\_payment\_log\_raw\_data'] : ''; |
| [8481](#L8481) | $bookingpress\_payment\_log\_added\_date = ! empty($payment\_debug\_log\_val['bookingpress\_payment\_log\_added\_date']) ? esc\_html($payment\_debug\_log\_val['bookingpress\_payment\_log\_added\_date']) : ''; |
| [8482](#L8482) |  |
| [8483](#L8483) | $payment\_debug\_log\_data[] = array( |
| [8484](#L8484) | 'payment\_debug\_log\_id'         => $bookingpress\_payment\_log\_id, |
| [8485](#L8485) | 'payment\_debug\_log\_name'       => $bookingpress\_payment\_log\_event, |
| [8486](#L8486) | 'payment\_debug\_log\_data'       => stripslashes\_deep($bookingpress\_payment\_log\_raw\_data), |
| [8487](#L8487) | 'payment\_debug\_log\_added\_date' => date($bookingpress\_date\_format, strtotime($bookingpress\_payment\_log\_added\_date)), |
| [8488](#L8488) | ); |
| [8489](#L8489) | } |
| [8490](#L8490) | } |
| [8491](#L8491) | } |
| [8492](#L8492) | $data['items'] = $payment\_debug\_log\_data; |
| [8493](#L8493) | $data['total'] = count($total\_payment\_debug\_logs); |
| [8494](#L8494) |  |
| [8495](#L8495) | // Modify debug logs data |
| [8496](#L8496) | $data = apply\_filters('bookingpress\_modify\_debug\_log\_data', $data, $\_REQUEST); |
| [8497](#L8497) |  |
| [8498](#L8498) | wp\_send\_json($data); |
| [8499](#L8499) | exit; |
| [8500](#L8500) | } |
| [8501](#L8501) |  |
| [8502](#L8502) |  |
| [8503](#L8503) | /\*\* |
| [8504](#L8504) | \* Clear debug payment logs |
| [8505](#L8505) | \* |
| [8506](#L8506) | \* @return void |
| [8507](#L8507) | \*/ |
| [8508](#L8508) | function bookingpress\_clear\_debug\_payment\_log\_func() |
| [8509](#L8509) | { |
| [8510](#L8510) | global $wpdb,$tbl\_bookingpress\_debug\_payment\_log; |
| [8511](#L8511) | $response              = array(); |
| [8512](#L8512) | $response['variant']   = 'error'; |
| [8513](#L8513) | $response['title']     = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [8514](#L8514) | $response['msg']       = esc\_html\_\_('Something went wrong', 'bookingpress-appointment-booking'); |
| [8515](#L8515) |  |
| [8516](#L8516) | $bpa\_check\_authorization = $this->bpa\_check\_authentication( 'clear\_debug\_payment\_logs', true, 'bpa\_wp\_nonce' ); |
| [8517](#L8517) |  |
| [8518](#L8518) | if( preg\_match( '/error/', $bpa\_check\_authorization ) ){ |
| [8519](#L8519) | $bpa\_auth\_error = explode( '^|^', $bpa\_check\_authorization ); |
| [8520](#L8520) | $bpa\_error\_msg = !empty( $bpa\_auth\_error[1] ) ? $bpa\_auth\_error[1] : esc\_html\_\_( 'Sorry. Something went wrong while processing the request', 'bookingpress-appointment-booking'); |
| [8521](#L8521) |  |
| [8522](#L8522) | $response['variant'] = 'error'; |
| [8523](#L8523) | $response['title'] = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking'); |
| [8524](#L8524) | $response['msg'] = $bpa\_error\_msg; |
| [8525](#L8525) |  |
| [8526](#L8526) | wp\_send\_json( $response ); |
| [8527](#L8527) | die; |
| [8528](#L8528) | } |
| [8529](#L8529) |  |
| [8530](#L8530) | $bookingpress\_view\_log\_selector = ! empty($\_REQUEST['bookingpress\_debug\_log\_selector']) ? sanitize\_text\_field($\_REQUEST['bookingpress\_debug\_log\_selector']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8531](#L8531) | if (! empty($bookingpress\_view\_log\_selector) ) { |
| [8532](#L8532) | // If data exists into payment debug log table then delete from that table. |
| [8533](#L8533) | $wpdb->delete($tbl\_bookingpress\_debug\_payment\_log, array( 'bookingpress\_payment\_log\_gateway' => $bookingpress\_view\_log\_selector ), array( '%s' )); |
| [8534](#L8534) | $response['variant'] = 'success'; |
| [8535](#L8535) | $response['title']   = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [8536](#L8536) | $response['msg']     = esc\_html\_\_('Debug Logs Cleared Successfully.', 'bookingpress-appointment-booking'); |
| [8537](#L8537) | } |
| [8538](#L8538) |  |
| [8539](#L8539) | do\_action('bookingpress\_delete\_debug\_log\_from\_outside', $\_POST); // phpcs:ignore WordPress.Security.NonceVerification |
| [8540](#L8540) |  |
| [8541](#L8541) | echo wp\_json\_encode($response); |
| [8542](#L8542) | exit(); |
| [8543](#L8543) | } |
| [8544](#L8544) |  |
| [8545](#L8545) |  |
| [8546](#L8546) | /\*\* |
| [8547](#L8547) | \* Download payment logs |
| [8548](#L8548) | \* |
| [8549](#L8549) | \* @return void |
| [8550](#L8550) | \*/ |
| [8551](#L8551) | function bookingpress\_download\_payment\_log\_func() |
| [8552](#L8552) | { |
| [8553](#L8553) | global $wpdb,$tbl\_bookingpress\_debug\_payment\_log; |
| [8554](#L8554) | $response              = array(); |
| [8555](#L8555) | $response['variant']   = 'error'; |
| [8556](#L8556) | $response['title']     = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [8557](#L8557) | $response['msg']       = esc\_html\_\_('Something went wrong', 'bookingpress-appointment-booking'); |
| [8558](#L8558) |  |
| [8559](#L8559) | $bpa\_check\_authorization = $this->bpa\_check\_authentication( 'download\_debug\_payment\_logs', true, 'bpa\_wp\_nonce' ); |
| [8560](#L8560) |  |
| [8561](#L8561) | if( preg\_match( '/error/', $bpa\_check\_authorization ) ){ |
| [8562](#L8562) | $bpa\_auth\_error = explode( '^|^', $bpa\_check\_authorization ); |
| [8563](#L8563) | $bpa\_error\_msg = !empty( $bpa\_auth\_error[1] ) ? $bpa\_auth\_error[1] : esc\_html\_\_( 'Sorry. Something went wrong while processing the request', 'bookingpress-appointment-booking'); |
| [8564](#L8564) |  |
| [8565](#L8565) | $response['variant'] = 'error'; |
| [8566](#L8566) | $response['title'] = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking'); |
| [8567](#L8567) | $response['msg'] = $bpa\_error\_msg; |
| [8568](#L8568) |  |
| [8569](#L8569) | wp\_send\_json( $response ); |
| [8570](#L8570) | die; |
| [8571](#L8571) | } |
| [8572](#L8572) |  |
| [8573](#L8573) | $bookingpress\_view\_log\_selector          = ! empty($\_REQUEST['bookingpress\_debug\_log\_selector']) ? sanitize\_text\_field($\_REQUEST['bookingpress\_debug\_log\_selector']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8574](#L8574) | $bookingpress\_selected\_download\_duration = ! empty($\_REQUEST['bookingpress\_selected\_download\_duration']) ? sanitize\_text\_field($\_REQUEST['bookingpress\_selected\_download\_duration']) : 'all'; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8575](#L8575) |  |
| [8576](#L8576) | if (! empty($bookingpress\_view\_log\_selector) && ! empty($bookingpress\_selected\_download\_duration) ) { |
| [8577](#L8577) |  |
| [8578](#L8578) | $bookingpress\_debug\_payment\_log\_where\_cond = ''; |
| [8579](#L8579) | if (! empty($\_REQUEST['bookingpress\_selected\_download\_custom\_duration']) && $bookingpress\_selected\_download\_duration == 'custom' ) { |
| [8580](#L8580) | $bookingpress\_start\_date                   = !empty($\_REQUEST['bookingpress\_selected\_download\_custom\_duration'][0]) ? date('Y-m-d 00:00:00', strtotime(sanitize\_text\_field($\_REQUEST['bookingpress\_selected\_download\_custom\_duration'][0]))) : ''; |
| [8581](#L8581) | $bookingpress\_end\_date                     = !empty($\_REQUEST['bookingpress\_selected\_download\_custom\_duration'][1]) ? date('Y-m-d 23:59:59', strtotime(sanitize\_text\_field($\_REQUEST['bookingpress\_selected\_download\_custom\_duration'][1]))) : ''; |
| [8582](#L8582) | $bookingpress\_debug\_payment\_log\_where\_cond = $wpdb->prepare(' AND (bookingpress\_payment\_log\_added\_date >= %s AND bookingpress\_payment\_log\_added\_date <= %s)', $bookingpress\_start\_date, $bookingpress\_end\_date); |
| [8583](#L8583) | } elseif (! empty($bookingpress\_selected\_download\_duration) && $bookingpress\_selected\_download\_duration != 'custom' && $bookingpress\_selected\_download\_duration != 'all' ) { |
| [8584](#L8584) | $bookingpress\_last\_selected\_days           = date('Y-m-d', strtotime('-' . $bookingpress\_selected\_download\_duration . ' days')); |
| [8585](#L8585) | $bookingpress\_debug\_payment\_log\_where\_cond = $wpdb->prepare(' AND (bookingpress\_payment\_log\_added\_date >= %s)', $bookingpress\_last\_selected\_days); |
| [8586](#L8586) | } |
| [8587](#L8587) |  |
| [8588](#L8588) | $bookingpress\_debug\_payment\_log\_query = 'SELECT \* FROM `' . $tbl\_bookingpress\_debug\_payment\_log . "` WHERE `bookingpress\_payment\_log\_gateway` = '" . $bookingpress\_view\_log\_selector . "' AND `bookingpress\_payment\_log\_status` = 1 " . $bookingpress\_debug\_payment\_log\_where\_cond . ' ORDER BY bookingpress\_payment\_log\_id DESC'; // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_debug\_payment\_log is table name defined globally. False Positive alarm |
| [8589](#L8589) |  |
| [8590](#L8590) | $bookingpress\_debug\_payment\_log\_query = apply\_filters('bookingpress\_modify\_download\_debug\_log\_query', $bookingpress\_debug\_payment\_log\_query, $bookingpress\_view\_log\_selector, $\_REQUEST); |
| [8591](#L8591) |  |
| [8592](#L8592) | $bookingpress\_payment\_debug\_log\_data = $wpdb->get\_results($bookingpress\_debug\_payment\_log\_query, ARRAY\_A); //phpcs:ignore |
| [8593](#L8593) |  |
| [8594](#L8594) | $bookingpress\_payment\_debug\_log\_data = apply\_filters('bookingpress\_modify\_download\_debug\_log\_data', $bookingpress\_payment\_debug\_log\_data, $bookingpress\_view\_log\_selector, $\_REQUEST); |
| [8595](#L8595) |  |
| [8596](#L8596) | $bookingpress\_download\_data = wp\_json\_encode($bookingpress\_payment\_debug\_log\_data); |
| [8597](#L8597) |  |
| [8598](#L8598) | if (! function\_exists('WP\_Filesystem') ) { |
| [8599](#L8599) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [8600](#L8600) | } |
| [8601](#L8601) | WP\_Filesystem(); |
| [8602](#L8602) | global $wp\_filesystem; |
| [8603](#L8603) |  |
| [8604](#L8604) | $bookingpresss\_debug\_log\_file\_name = 'bookingpress\_debug\_logs\_' . $bookingpress\_view\_log\_selector . '\_' . $bookingpress\_selected\_download\_duration; |
| [8605](#L8605) | $result                            = $wp\_filesystem->put\_contents(BOOKINGPRESS\_UPLOAD\_DIR . '/' . $bookingpresss\_debug\_log\_file\_name . '.txt', $bookingpress\_download\_data, 0777); |
| [8606](#L8606) |  |
| [8607](#L8607) | $debug\_log\_file\_name = ''; |
| [8608](#L8608) |  |
| [8609](#L8609) | if (class\_exists('ZipArchive') ) { |
| [8610](#L8610) | $zip = new ZipArchive(); |
| [8611](#L8611) | $zip->open(BOOKINGPRESS\_UPLOAD\_DIR . '/' . $bookingpresss\_debug\_log\_file\_name . '.zip', ZipArchive::CREATE); |
| [8612](#L8612) | $zip->addFile(BOOKINGPRESS\_UPLOAD\_DIR . '/' . $bookingpresss\_debug\_log\_file\_name . '.txt', $bookingpresss\_debug\_log\_file\_name . '.txt'); |
| [8613](#L8613) | $zip->close(); |
| [8614](#L8614) |  |
| [8615](#L8615) | $bookingpress\_download\_url = BOOKINGPRESS\_UPLOAD\_URL . '/' . $bookingpresss\_debug\_log\_file\_name . '.zip'; |
| [8616](#L8616) | $debug\_log\_file\_name       = $bookingpresss\_debug\_log\_file\_name . '.zip'; |
| [8617](#L8617) | } else { |
| [8618](#L8618) | $bookingpress\_download\_url = BOOKINGPRESS\_UPLOAD\_URL . '/' . $bookingpresss\_debug\_log\_file\_name . '.txt'; |
| [8619](#L8619) | $debug\_log\_file\_name       = $bookingpresss\_debug\_log\_file\_name . '.txt'; |
| [8620](#L8620) | } |
| [8621](#L8621) | $response['variant']    = 'success'; |
| [8622](#L8622) | $response['title']      = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [8623](#L8623) | $response['msg']        = esc\_html\_\_('log download successfully', 'bookingpress-appointment-booking'); |
| [8624](#L8624) | $response['url'] = admin\_url('admin.php?page=bookingpress&module=settings&bookingpress\_action=download\_log&file=' . $debug\_log\_file\_name); |
| [8625](#L8625) | echo wp\_json\_encode($response); |
| [8626](#L8626) | exit(); |
| [8627](#L8627) | } |
| [8628](#L8628) | echo wp\_json\_encode($response); |
| [8629](#L8629) | exit(); |
| [8630](#L8630) | } |
| [8631](#L8631) |  |
| [8632](#L8632) |  |
| [8633](#L8633) | function appointment\_sanatize\_field( $data\_array ) |
| [8634](#L8634) | { |
| [8635](#L8635) | if( null == $data\_array ){ |
| [8636](#L8636) | return $data\_array; |
| [8637](#L8637) | } |
| [8638](#L8638) |  |
| [8639](#L8639) | if (is\_array($data\_array) ) { |
| [8640](#L8640) | return array\_map(array( $this, \_\_FUNCTION\_\_ ), $data\_array); |
| [8641](#L8641) | } else { |
| [8642](#L8642) | if(preg\_match( '/<[^<]+>/', $data\_array ) ) { |
| [8643](#L8643) | global $bookingpress\_global\_options; |
| [8644](#L8644) |  |
| [8645](#L8645) | $bookingpress\_global\_options\_data = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [8646](#L8646) | $bookingpress\_allow\_tag = json\_decode($bookingpress\_global\_options\_data['allowed\_html'], true); |
| [8647](#L8647) |  |
| [8648](#L8648) | return wp\_kses( $data\_array, $bookingpress\_allow\_tag ); |
| [8649](#L8649) | } else { |
| [8650](#L8650) | return sanitize\_text\_field($data\_array); |
| [8651](#L8651) | } |
| [8652](#L8652) | } |
| [8653](#L8653) | } |
| [8654](#L8654) |  |
| [8655](#L8655) | function bookingpress\_gutenberg\_category( $category, $post ) |
| [8656](#L8656) | { |
| [8657](#L8657) | $new\_category     = array( |
| [8658](#L8658) | array( |
| [8659](#L8659) | 'slug'  => 'bookingpress', |
| [8660](#L8660) | 'title' => 'Bookingpress Blocks', |
| [8661](#L8661) | ), |
| [8662](#L8662) | ); |
| [8663](#L8663) | $final\_categories = array\_merge($category, $new\_category); |
| [8664](#L8664) | return $final\_categories; |
| [8665](#L8665) | } |
| [8666](#L8666) |  |
| [8667](#L8667) | function bookingpress\_select\_date\_before\_load($date = '',$bookingpress\_daysoff\_date = array()){ |
| [8668](#L8668) | $bpa\_current\_date = $bpa\_date = !empty($date) ? $date : date('Y-m-d'); // old |
| [8669](#L8669) | $bpa\_current\_date = $bpa\_date = !empty($date) ? $date : date('Y-m-d', current\_time('timestamp')); // new change |
| [8670](#L8670) |  |
| [8671](#L8671) | if(empty($bookingpress\_daysoff\_date)) { |
| [8672](#L8672) | // reputelog -> need to check this function execution ahead |
| [8673](#L8673) | return $bpa\_current\_date; |
| [8674](#L8674) | //$bookingpress\_daysoff\_date = $this->bookingpress\_get\_default\_dayoff\_dates(); |
| [8675](#L8675) | } |
| [8676](#L8676) | $bpa\_current\_date =  date('c',strtotime($bpa\_current\_date)); |
| [8677](#L8677) |  |
| [8678](#L8678) | if(!empty($bookingpress\_daysoff\_date) && is\_array($bookingpress\_daysoff\_date)) { |
| [8679](#L8679) | foreach($bookingpress\_daysoff\_date as $k => $v){ |
| [8680](#L8680) | $daysoff\_tmp\_date = date('Y-m-d', strtotime($v)); |
| [8681](#L8681) | if($daysoff\_tmp\_date == $bpa\_date){ |
| [8682](#L8682) | $bpa\_current\_date  = date('Y-m-d',strtotime($bpa\_date.'+1 Day')); |
| [8683](#L8683) | return $this->bookingpress\_select\_date\_before\_load($bpa\_current\_date,$bookingpress\_daysoff\_date); |
| [8684](#L8684) | } |
| [8685](#L8685) | } |
| [8686](#L8686) | } |
| [8687](#L8687) | return $bpa\_date; |
| [8688](#L8688) | } |
| [8689](#L8689) |  |
| [8690](#L8690) | /\*\* |
| [8691](#L8691) | \* Get appointment customers list |
| [8692](#L8692) | \* |
| [8693](#L8693) | \* @param  mixed $search\_user\_str |
| [8694](#L8694) | \* @param  mixed $customer\_id |
| [8695](#L8695) | \* @return void |
| [8696](#L8696) | \*/ |
| [8697](#L8697) | function bookingpress\_get\_appointment\_customer\_list($search\_user\_str = '',$customer\_id = '') |
| [8698](#L8698) | { |
| [8699](#L8699) | global $wpdb,$tbl\_bookingpress\_customers; |
| [8700](#L8700) | $bookingpress\_search\_query\_where = 'WHERE 1=1'; |
| [8701](#L8701) | $bookingpress\_search\_query\_where .= $wpdb->prepare( ' AND cs.bookingpress\_user\_type = %d AND cs.bookingpress\_user\_status = %d ', 2,1 ); |
| [8702](#L8702) | if(!empty($search\_user\_str)) { |
| [8703](#L8703) | if(!empty($customer\_id )) { |
| [8704](#L8704) | $bookingpress\_search\_query\_where .= "AND ((cs.bookingpress\_user\_login LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_email LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_firstname LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_lastname LIKE '%{$search\_user\_str}%') OR (cs.bookingpress\_customer\_id = {$customer\_id})) "; |
| [8705](#L8705) | } else { |
| [8706](#L8706) | $bookingpress\_search\_query\_where .= "AND (cs.bookingpress\_user\_login LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_email LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_firstname LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_lastname LIKE '%{$search\_user\_str}%') "; |
| [8707](#L8707) | } |
| [8708](#L8708) | } |
| [8709](#L8709) | if(empty($search\_user\_str) && !empty($customer\_id )) { |
| [8710](#L8710) | $bookingpress\_search\_query\_where .= $wpdb->prepare( 'AND (cs.bookingpress\_customer\_id =%d) ', $customer\_id ); |
| [8711](#L8711) | } |
| [8712](#L8712) | $bookingpress\_search\_join\_query  = ''; |
| [8713](#L8713) | $bookingpress\_search\_join\_query  = apply\_filters('bookingpress\_appointment\_customer\_list\_join\_filter', $bookingpress\_search\_join\_query); |
| [8714](#L8714) | $bookingpress\_search\_query\_where = apply\_filters('bookingpress\_appointment\_customer\_list\_filter', $bookingpress\_search\_query\_where); |
| [8715](#L8715) |  |
| [8716](#L8716) | $bookingpress\_customer\_details = $wpdb->get\_results('SELECT cs.bookingpress\_user\_phone,cs.bookingpress\_customer\_id,cs.bookingpress\_customer\_id,cs.bookingpress\_user\_firstname,cs.bookingpress\_user\_lastname,cs.bookingpress\_user\_email FROM ' . $tbl\_bookingpress\_customers . ' as cs ' . $bookingpress\_search\_join\_query . ' ' . $bookingpress\_search\_query\_where, ARRAY\_A); //phpcs:ignore |
| [8717](#L8717) | $bookingpress\_customer\_selection\_details = array(); |
| [8718](#L8718) | foreach ( $bookingpress\_customer\_details as $bookingpress\_customer\_key => $bookingpress\_customer\_val ) { |
| [8719](#L8719) | $bookingpress\_customer\_name = ( $bookingpress\_customer\_val['bookingpress\_user\_firstname'] == '' && $bookingpress\_customer\_val['bookingpress\_user\_lastname'] == '' ) ? $bookingpress\_customer\_val['bookingpress\_user\_email'] : $bookingpress\_customer\_val['bookingpress\_user\_firstname'] . ' ' . $bookingpress\_customer\_val['bookingpress\_user\_lastname']; |
| [8720](#L8720) | if(empty($bookingpress\_customer\_name) && $bookingpress\_customer\_val['bookingpress\_user\_phone']) { |
| [8721](#L8721) | $bookingpress\_customer\_name = $bookingpress\_customer\_val['bookingpress\_user\_phone']; |
| [8722](#L8722) | } |
| [8723](#L8723) | $bookingpress\_customer\_selection\_details[] = array( |
| [8724](#L8724) | 'text'  => stripslashes\_deep($bookingpress\_customer\_name), |
| [8725](#L8725) | 'value' => $bookingpress\_customer\_val['bookingpress\_customer\_id'], |
| [8726](#L8726) | ); |
| [8727](#L8727) | } |
| [8728](#L8728) | return $bookingpress\_customer\_selection\_details; |
| [8729](#L8729) | } |
| [8730](#L8730) |  |
| [8731](#L8731) | /\*\* |
| [8732](#L8732) | \* Get search customers list |
| [8733](#L8733) | \* |
| [8734](#L8734) | \* @param  mixed $search\_user\_str |
| [8735](#L8735) | \* @return void |
| [8736](#L8736) | \*/ |
| [8737](#L8737) | function bookingpress\_get\_search\_customer\_list($search\_user\_str = '') |
| [8738](#L8738) | { |
| [8739](#L8739) | global $wpdb,$tbl\_bookingpress\_customers; |
| [8740](#L8740) | $bookingpress\_search\_query\_where = 'WHERE 1=1'; |
| [8741](#L8741) | $bookingpress\_search\_query\_where .= $wpdb->prepare( ' AND cs.bookingpress\_user\_type = %d AND cs.bookingpress\_user\_status = %d ', 2,1 ); |
| [8742](#L8742) | if(!empty($search\_user\_str)) { |
| [8743](#L8743) | $bookingpress\_search\_query\_where .= "AND (cs.bookingpress\_user\_login LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_email LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_firstname LIKE '%{$search\_user\_str}%' OR cs.bookingpress\_user\_lastname LIKE '%{$search\_user\_str}%') OR cs.bookingpress\_customer\_full\_name LIKE '%{$search\_user\_str}%' "; |
| [8744](#L8744) | } |
| [8745](#L8745) | $bookingpress\_search\_join\_query  = ''; |
| [8746](#L8746) | $bookingpress\_search\_join\_query  = apply\_filters('bookingpress\_search\_customer\_list\_join\_filter', $bookingpress\_search\_join\_query); |
| [8747](#L8747) | $bookingpress\_search\_query\_where = apply\_filters('bookingpress\_search\_customer\_list\_filter', $bookingpress\_search\_query\_where); |
| [8748](#L8748) |  |
| [8749](#L8749) | $bookingpress\_customer\_details = $wpdb->get\_results('SELECT cs.bookingpress\_customer\_id,cs.bookingpress\_user\_firstname,cs.bookingpress\_user\_lastname,cs.bookingpress\_user\_email FROM ' . $tbl\_bookingpress\_customers . ' as cs ' . $bookingpress\_search\_join\_query . ' ' . $bookingpress\_search\_query\_where, ARRAY\_A); //phpcs:ignore |
| [8750](#L8750) | $bookingpress\_customer\_selection\_details = array(); |
| [8751](#L8751) |  |
| [8752](#L8752) | foreach ( $bookingpress\_customer\_details as $bookingpress\_customer\_key => $bookingpress\_customer\_val ) { |
| [8753](#L8753) | $bookingpress\_customer\_name = ( $bookingpress\_customer\_val['bookingpress\_user\_firstname'] == '' && $bookingpress\_customer\_val['bookingpress\_user\_lastname'] == '' ) ? $bookingpress\_customer\_val['bookingpress\_user\_email'] : $bookingpress\_customer\_val['bookingpress\_user\_firstname'] . ' ' . $bookingpress\_customer\_val['bookingpress\_user\_lastname']; |
| [8754](#L8754) |  |
| [8755](#L8755) | $bookingpress\_customer\_selection\_details[] = array( |
| [8756](#L8756) | 'text'  => stripslashes\_deep($bookingpress\_customer\_name), |
| [8757](#L8757) | 'value' => $bookingpress\_customer\_val['bookingpress\_customer\_id'], |
| [8758](#L8758) | ); |
| [8759](#L8759) | } |
| [8760](#L8760) |  |
| [8761](#L8761) | return $bookingpress\_customer\_selection\_details; |
| [8762](#L8762) | } |
| [8763](#L8763) |  |
| [8764](#L8764) | /\*\* |
| [8765](#L8765) | \* Cleaning up transient data |
| [8766](#L8766) | \* |
| [8767](#L8767) | \* @return void |
| [8768](#L8768) | \*/ |
| [8769](#L8769) | function bookingpress\_cleanup\_transient\_data\_hook\_callback(){ |
| [8770](#L8770) | global $wpdb,$tbl\_bookingpress\_transient; |
| [8771](#L8771) |  |
| [8772](#L8772) | $time\_before\_hour = current\_time( 'timestamp' ) - DAY\_IN\_SECONDS; |
| [8773](#L8773) |  |
| [8774](#L8774) | $wpdb->query( $wpdb->prepare( "DELETE FROM {$tbl\_bookingpress\_transient} WHERE bookingpress\_transient\_expiry <= %s", $time\_before\_hour ) ); //phpcs:ignore |
| [8775](#L8775) |  |
| [8776](#L8776) | } |
| [8777](#L8777) |  |
| [8778](#L8778) | /\*\* |
| [8779](#L8779) | \* Send anonymous data through cron |
| [8780](#L8780) | \* |
| [8781](#L8781) | \* @return void |
| [8782](#L8782) | \*/ |
| [8783](#L8783) | function bookingpress\_send\_anonymous\_data\_cron() { |
| [8784](#L8784) |  |
| [8785](#L8785) |  |
| [8786](#L8786) | $bookingpress\_send\_anonymous\_data = $this->bookingpress\_get\_settings('anonymous\_data','general\_setting'); |
| [8787](#L8787) |  |
| [8788](#L8788) | if($bookingpress\_send\_anonymous\_data == 'true') { |
| [8789](#L8789) |  |
| [8790](#L8790) | global $wpdb,$tbl\_bookingpress\_services,$tbl\_bookingpress\_customers,$tbl\_bookingpress\_form\_fields,$tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_appointment\_bookings, $wp\_version; |
| [8791](#L8791) |  |
| [8792](#L8792) | $bookingpress\_total\_services = $bookingpress\_total\_staffmember = $bookingpress\_total\_service\_extras = $bookingpress\_total\_customers = $bookingpress\_total\_payment\_transactions = $bookingpress\_with\_deposit\_payments = $bookingpress\_without\_deposit\_payments = $bookingpress\_booking\_from\_backend = $bookingpress\_total\_appointment\_custom\_fields = $bookingpress\_total\_customer\_custom\_fields = 0; |
| [8793](#L8793) |  |
| [8794](#L8794) | $activated\_modules = $inactivated\_modules = $active\_plugins\_arr = $bookingpress\_gateway\_wise\_transactions = $inactive\_plugin\_arr = array(); |
| [8795](#L8795) |  |
| [8796](#L8796) | $bookingpress\_lite\_version = $boookingpress\_lite\_installation\_date = $bookingpress\_pro\_version = $boookingpress\_pro\_installation\_date = |
| [8797](#L8797) | $home\_url = $admin\_url = $site\_timezone = $site\_locale = ''; |
| [8798](#L8798) |  |
| [8799](#L8799) | $bookingpress\_lite\_version = get\_option('bookingpress\_version'); |
| [8800](#L8800) | $bookingpress\_lite\_version = !empty($bookingpress\_lite\_version) ? $bookingpress\_lite\_version : ''; |
| [8801](#L8801) | $boookingpress\_lite\_installation\_date = get\_option('bookingpress\_install\_date'); |
| [8802](#L8802) | $boookingpress\_lite\_installation\_date = !empty($boookingpress\_lite\_installation\_date) ? $boookingpress\_lite\_installation\_date : ''; |
| [8803](#L8803) | $bookingpress\_pro\_version = get\_option('bookingpress\_pro\_version'); |
| [8804](#L8804) | $bookingpress\_pro\_version = !empty($bookingpress\_pro\_version) ? $bookingpress\_pro\_version : ''; |
| [8805](#L8805) | $boookingpress\_pro\_installation\_date = get\_option('bookingpress\_pro\_install\_date'); |
| [8806](#L8806) | $boookingpress\_pro\_installation\_date = !empty($boookingpress\_pro\_installation\_date) ? $boookingpress\_pro\_installation\_date : ''; |
| [8807](#L8807) | $home\_url = home\_url(); |
| [8808](#L8808) | $admin\_url = admin\_url(); |
| [8809](#L8809) | $site\_locale = get\_locale(); |
| [8810](#L8810) | $site\_locale = !empty($site\_locale) ? $site\_locale : ''; |
| [8811](#L8811) | $site\_timezone = wp\_timezone\_string(); |
| [8812](#L8812) |  |
| [8813](#L8813) | $tbl\_bookingpress\_staffmembers =  $wpdb->prefix.'bookingpress\_staffmembers'; |
| [8814](#L8814) | $tbl\_bookingpress\_extra\_services =  $wpdb->prefix.'bookingpress\_extra\_services'; |
| [8815](#L8815) |  |
| [8816](#L8816) | $server\_information = isset( $\_SERVER['SERVER\_SOFTWARE'] ) ? sanitize\_text\_field($\_SERVER['SERVER\_SOFTWARE']) : ''; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.MissingUnslash |
| [8817](#L8817) | $my\_theme   = wp\_get\_theme(); |
| [8818](#L8818) | $theme\_data = $my\_theme->get('Name').'  ('.$my\_theme->get('Version').' )'; |
| [8819](#L8819) | $is\_multisite = is\_multisite() ? 'Yes' : 'NO'; |
| [8820](#L8820) |  |
| [8821](#L8821) | $plugin\_list    = get\_plugins(); |
| [8822](#L8822) | $active\_plugins = get\_option('active\_plugins'); |
| [8823](#L8823) |  |
| [8824](#L8824) | foreach ( $plugin\_list as $key => $plugin\_detail ) { |
| [8825](#L8825) | $is\_active = in\_array($key, $active\_plugins); |
| [8826](#L8826) | if ($is\_active == 1 ) { |
| [8827](#L8827) | $name      = substr($key, 0, strpos($key, '/')); |
| [8828](#L8828) | $active\_plugins\_arr[] = array( |
| [8829](#L8829) | $plugin\_detail['Name'] => $plugin\_detail['Version'] |
| [8830](#L8830) | ); |
| [8831](#L8831) | } else { |
| [8832](#L8832) | $inactive\_plugin\_arr[]  = array( |
| [8833](#L8833) | $plugin\_detail['Name'] => $plugin\_detail['Version'] |
| [8834](#L8834) | ); |
| [8835](#L8835) | } |
| [8836](#L8836) | } |
| [8837](#L8837) |  |
| [8838](#L8838) | $bookingpress\_currency = $this->bookingpress\_get\_settings('payment\_default\_currency','payment\_setting'); |
| [8839](#L8839) |  |
| [8840](#L8840) | $bookingpress\_module = array( |
| [8841](#L8841) | 'bookingpress\_coupon\_module' => 'Coupon Management', |
| [8842](#L8842) | 'bookingpress\_staffmember\_module' => 'Staff Member Management', |
| [8843](#L8843) | 'bookingpress\_deposit\_payment\_module' => 'Desposit Payment', |
| [8844](#L8844) | 'bookingpress\_bring\_anyone\_with\_you\_module' => 'Bring Quantity with You', |
| [8845](#L8845) | 'bookingpress\_service\_extra\_module' => 'Service Extra', |
| [8846](#L8846) | ); |
| [8847](#L8847) | foreach($bookingpress\_module as $key => $value) { |
| [8848](#L8848) | $is\_module\_active = get\_option($key); |
| [8849](#L8849) | if($is\_module\_active == 'true') { |
| [8850](#L8850) | $activated\_modules[] = $value; |
| [8851](#L8851) | } else { |
| [8852](#L8852) | $inactivated\_modules[] = $value; |
| [8853](#L8853) | } |
| [8854](#L8854) | } |
| [8855](#L8855) |  |
| [8856](#L8856) | $bookingpress\_addon\_url = 'https://bookingpressplugin.com/bpa\_misc/addons\_list\_v2.php'; |
| [8857](#L8857) | $bookingpress\_addons\_res = wp\_remote\_post( |
| [8858](#L8858) | $bookingpress\_addon\_url, |
| [8859](#L8859) | array( |
| [8860](#L8860) | 'method'    => 'POST', |
| [8861](#L8861) | 'timeout'   => 45, |
| [8862](#L8862) | 'sslverify' => false, |
| [8863](#L8863) | 'body'      => array( |
| [8864](#L8864) | 'bookingpress\_addon\_list' => 1, |
| [8865](#L8865) | ), |
| [8866](#L8866) | ) |
| [8867](#L8867) | ); |
| [8868](#L8868) | $active\_addon\_list = $inactive\_addon\_list =  array(); |
| [8869](#L8869) | if ( ! is\_wp\_error( $bookingpress\_addons\_res ) ) { |
| [8870](#L8870) | $bookingpress\_body\_res = base64\_decode( $bookingpress\_addons\_res['body'] ); |
| [8871](#L8871) | if ( ! empty( $bookingpress\_body\_res ) ) { |
| [8872](#L8872) | $bookingpress\_body\_res = json\_decode( $bookingpress\_body\_res, true ); |
| [8873](#L8873) | foreach ( $bookingpress\_body\_res as $bookingpress\_body\_key => $bookingpress\_body\_data\_arr ) { |
| [8874](#L8874) | foreach ( $bookingpress\_body\_data\_arr as $bookingpress\_body\_data\_key => $bookingpress\_body\_val ) { |
| [8875](#L8875) | if(!empty($bookingpress\_body\_val['addon\_installer'])) { |
| [8876](#L8876) | if(file\_exists( WP\_PLUGIN\_DIR . '/'.$bookingpress\_body\_val['addon\_installer'])) { |
| [8877](#L8877) | $is\_addon\_active = is\_plugin\_active($bookingpress\_body\_val['addon\_installer']); |
| [8878](#L8878) | if($is\_addon\_active) { |
| [8879](#L8879) | $active\_addon\_list[$bookingpress\_body\_val['addon\_name']] = $bookingpress\_body\_val['addon\_version']; |
| [8880](#L8880) | } else { |
| [8881](#L8881) | $inactive\_addon\_list[$bookingpress\_body\_val['addon\_name']] = $bookingpress\_body\_val['addon\_version']; |
| [8882](#L8882) | } |
| [8883](#L8883) | } |
| [8884](#L8884) | } |
| [8885](#L8885) | } |
| [8886](#L8886) | } |
| [8887](#L8887) | } |
| [8888](#L8888) | } |
| [8889](#L8889) |  |
| [8890](#L8890) | $bookingpress\_total\_services = $wpdb->get\_var( "SELECT count(bookingpress\_service\_id) FROM {$tbl\_bookingpress\_services}"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_services is a table name. false alarm |
| [8891](#L8891) |  |
| [8892](#L8892) | $bookingpress\_total\_customers = $wpdb->get\_var( "SELECT count(bookingpress\_customer\_id) FROM {$tbl\_bookingpress\_customers}"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $bookingpress\_customers is a table name. false alarm |
| [8893](#L8893) |  |
| [8894](#L8894) | $bookingpress\_total\_fields = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_form\_fields}",ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_form\_fields is a table name. false alarm |
| [8895](#L8895) |  |
| [8896](#L8896) | $bookingpress\_total\_payment\_transactions = $wpdb->get\_var( "SELECT count(bookingpress\_payment\_log\_id) FROM {$tbl\_bookingpress\_payment\_logs}"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_payment\_logs is a table name. false alarm |
| [8897](#L8897) |  |
| [8898](#L8898) | $bookingpress\_total\_transactions = $wpdb->get\_results( "SELECT count(bookingpress\_payment\_log\_id) as total ,bookingpress\_payment\_gateway FROM {$tbl\_bookingpress\_payment\_logs} GROUP BY bookingpress\_payment\_gateway",ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_payment\_logs is a table name. false alarm |
| [8899](#L8899) |  |
| [8900](#L8900) | $bookingpress\_total\_appointmentes = $wpdb->get\_results( "SELECT ap.\*,pl.bookingpress\_payment\_gateway FROM {$tbl\_bookingpress\_appointment\_bookings} as ap LEFT JOIN {$tbl\_bookingpress\_payment\_logs} as pl ON pl.bookingpress\_payment\_log\_id = ap.bookingpress\_payment\_id",ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [8901](#L8901) |  |
| [8902](#L8902) | if(!empty($bookingpress\_total\_fields)) { |
| [8903](#L8903) | foreach($bookingpress\_total\_fields as $key => $value){ |
| [8904](#L8904) | if(isset($value['bookingpress\_field\_is\_default']) && $value['bookingpress\_field\_is\_default'] == 0 && isset($value['bookingpress\_is\_customer\_field']) && $value['bookingpress\_is\_customer\_field'] == 0) { |
| [8905](#L8905) | $bookingpress\_total\_appointment\_custom\_fields++; |
| [8906](#L8906) | } elseif(isset($value['bookingpress\_field\_is\_default']) && isset($value['bookingpress\_is\_customer\_field']) && $value['bookingpress\_is\_customer\_field'] == 1 ) { |
| [8907](#L8907) | $bookingpress\_total\_customer\_custom\_fields++; |
| [8908](#L8908) | } |
| [8909](#L8909) | } |
| [8910](#L8910) | } |
| [8911](#L8911) |  |
| [8912](#L8912) | if(!empty($bookingpress\_total\_appointmentes)) { |
| [8913](#L8913) | foreach($bookingpress\_total\_appointmentes as $key => $value){ |
| [8914](#L8914) | $bookingpress\_deposit\_details = !empty($value['bookingpress\_deposit\_payment\_details']) ? json\_decode |
| [8915](#L8915) | ($value['bookingpress\_deposit\_payment\_details'], TRUE) : array(); |
| [8916](#L8916) | if(!empty($bookingpress\_deposit\_details) && !empty($bookingpress\_deposit\_details['deposit\_selected\_type']) && !empty($value['bookingpress\_deposit\_amount']) && !empty($value['bookingpress\_payment\_gateway']) && $value['bookingpress\_payment\_gateway'] ){ |
| [8917](#L8917) | $bookingpress\_with\_deposit\_payments++; |
| [8918](#L8918) | } else { |
| [8919](#L8919) | $bookingpress\_without\_deposit\_payments++; |
| [8920](#L8920) | } |
| [8921](#L8921) | if(!empty($value['bookingpress\_payment\_gateway']) && $value['bookingpress\_payment\_gateway'] == 'manual'){ |
| [8922](#L8922) | $bookingpress\_booking\_from\_backend++; |
| [8923](#L8923) | } |
| [8924](#L8924) | } |
| [8925](#L8925) | } |
| [8926](#L8926) | if(!empty($bookingpress\_total\_transactions)) { |
| [8927](#L8927) | foreach($bookingpress\_total\_transactions as $key => $value) { |
| [8928](#L8928) | $bookingpress\_gateway\_wise\_transactions[$value['bookingpress\_payment\_gateway']] =  $value['total']; |
| [8929](#L8929) | } |
| [8930](#L8930) | } |
| [8931](#L8931) |  |
| [8932](#L8932) | $bookingpress\_staffmember\_table\_exists = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(1) FROM information\_schema.tables WHERE table\_schema=%s AND table\_name=%s",DB\_NAME,$tbl\_bookingpress\_staffmembers)); |
| [8933](#L8933) | if($bookingpress\_staffmember\_table\_exists) { |
| [8934](#L8934) | $bookingpress\_total\_staffmember = $wpdb->get\_var( "SELECT count(bookingpress\_staffmember\_id) FROM {$tbl\_bookingpress\_staffmembers}"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_staffmembers is a table name. false alarm |
| [8935](#L8935) | } |
| [8936](#L8936) |  |
| [8937](#L8937) | $bookingpress\_extra\_services\_table\_exists = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(1) FROM information\_schema.tables WHERE table\_schema=%s AND table\_name=%s",DB\_NAME,$tbl\_bookingpress\_extra\_services)); |
| [8938](#L8938) | if($bookingpress\_extra\_services\_table\_exists == 1)                { |
| [8939](#L8939) | $bookingpress\_total\_service\_extras = $wpdb->get\_var( "SELECT count(bookingpress\_extra\_services\_id) FROM {$tbl\_bookingpress\_extra\_services}"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_extra\_services is a table name. false alarm |
| [8940](#L8940) | } |
| [8941](#L8941) |  |
| [8942](#L8942) | $total\_wp\_users =  count\_users(); |
| [8943](#L8943) | $total\_wp\_users = $total\_wp\_users['total\_users']; |
| [8944](#L8944) |  |
| [8945](#L8945) | $bookingpress\_anonymous\_data = array( |
| [8946](#L8946) | 'php\_version'                             => phpversion(), |
| [8947](#L8947) | 'bookingpress\_lite\_version'               => $bookingpress\_lite\_version, |
| [8948](#L8948) | 'boookingpress\_lite\_installation\_date'    => $boookingpress\_lite\_installation\_date, |
| [8949](#L8949) | 'bookingpress\_pro\_version'                => $bookingpress\_pro\_version, |
| [8950](#L8950) | 'boookingpress\_pro\_installation\_date'     => $boookingpress\_pro\_installation\_date, |
| [8951](#L8951) | 'wp\_version'                              => $wp\_version, |
| [8952](#L8952) | 'server\_information'                      => $server\_information, |
| [8953](#L8953) | 'is\_multisite'                            => $is\_multisite, |
| [8954](#L8954) | 'theme\_data'                              => $theme\_data, |
| [8955](#L8955) | 'home\_url'                                => $home\_url, |
| [8956](#L8956) | 'admin\_url'                               => $admin\_url, |
| [8957](#L8957) | 'active\_plugin\_list'                      => wp\_json\_encode($active\_plugins\_arr), |
| [8958](#L8958) | 'inactivate\_plugin\_list'                  => wp\_json\_encode($inactive\_plugin\_arr), |
| [8959](#L8959) | 'site\_locale'                             => $site\_locale, |
| [8960](#L8960) | 'site\_timezone'                           => $site\_timezone, |
| [8961](#L8961) | 'bookingpress\_currency'                   => $bookingpress\_currency, |
| [8962](#L8962) | 'activated\_modules'                       => wp\_json\_encode($activated\_modules), |
| [8963](#L8963) | 'inactive\_modules'                        => wp\_json\_encode($inactivated\_modules), |
| [8964](#L8964) | 'activated\_addons'                        => wp\_json\_encode($active\_addon\_list), |
| [8965](#L8965) | 'inactive\_addons'                         => wp\_json\_encode($inactive\_addon\_list), |
| [8966](#L8966) | 'total\_staffmembers'                      => $bookingpress\_total\_staffmember, |
| [8967](#L8967) | 'total\_services'                          => $bookingpress\_total\_services, |
| [8968](#L8968) | 'total\_service\_extras'                    => $bookingpress\_total\_service\_extras, |
| [8969](#L8969) | 'total\_wp\_users'                          => $total\_wp\_users, |
| [8970](#L8970) | 'total\_bookingpress\_customers'            => $bookingpress\_total\_customers, |
| [8971](#L8971) | 'total\_appointment\_custom\_fields'         => $bookingpress\_total\_appointment\_custom\_fields, |
| [8972](#L8972) | 'total\_customer\_custom\_fields'            => $bookingpress\_total\_customer\_custom\_fields, |
| [8973](#L8973) | 'total\_payment\_transactions'              => $bookingpress\_total\_payment\_transactions, |
| [8974](#L8974) | 'payment\_gateway\_wise\_transaction'        => wp\_json\_encode($bookingpress\_gateway\_wise\_transactions), |
| [8975](#L8975) | 'total\_bookings\_with\_deposit\_payments'    => $bookingpress\_with\_deposit\_payments, |
| [8976](#L8976) | 'total\_bookings\_without\_deposit\_payments' => $bookingpress\_without\_deposit\_payments, |
| [8977](#L8977) | 'total\_bookings\_made\_from\_backend'        => $bookingpress\_booking\_from\_backend, |
| [8978](#L8978) | ); |
| [8979](#L8979) | $url = ''; |
| [8980](#L8980) | $url = 'https://bookingpressplugin.com/bpa\_misc/bp\_tracking\_usage.php'; |
| [8981](#L8981) | $response = wp\_remote\_post( |
| [8982](#L8982) | $url, |
| [8983](#L8983) | array( |
| [8984](#L8984) | 'timeout' => 500, |
| [8985](#L8985) | 'body'    => array( 'bpa\_anonymous\_data' =>  wp\_json\_encode($bookingpress\_anonymous\_data)), |
| [8986](#L8986) | ) |
| [8987](#L8987) | ); |
| [8988](#L8988) | } |
| [8989](#L8989) | } |
| [8990](#L8990) |  |
| [8991](#L8991) | /\*\* |
| [8992](#L8992) | \* Generate customize module CSS at front side |
| [8993](#L8993) | \* |
| [8994](#L8994) | \* @param  mixed $bookingpress\_custom\_data\_arr |
| [8995](#L8995) | \* @return void |
| [8996](#L8996) | \*/ |
| [8997](#L8997) | function bookingpress\_generate\_customize\_css\_func($bookingpress\_custom\_data\_arr) { |
| [8998](#L8998) | global $BookingPress; |
| [8999](#L8999) | $bookingpress\_customize\_css\_content = ''; |
| [9000](#L9000) | $bookingpress\_customize\_css\_key     = get\_option('bookingpress\_custom\_css\_key', true); |
| [9001](#L9001) |  |
| [9002](#L9002) | if(!empty($bookingpress\_custom\_data\_arr['action'])) { |
| [9003](#L9003) | update\_option('bookingpress\_customize\_changes\_notice', 1); |
| [9004](#L9004) | update\_option('bookingpress\_customize\_changes\_notice\_1.0.51',0); |
| [9005](#L9005) |  |
| [9006](#L9006) | foreach($bookingpress\_custom\_data\_arr['action'] as $key => $value) { |
| [9007](#L9007) | $bookingpress\_customize\_css\_content = ''; |
| [9008](#L9008) | if( $value == 'bookingpress\_save\_my\_booking\_settings') { |
| [9009](#L9009) | $shortcode\_background\_color = $bookingpress\_custom\_data\_arr['my\_booking\_form']['background\_color']; |
| [9010](#L9010) | $shortcode\_footer\_background\_color = $bookingpress\_custom\_data\_arr['my\_booking\_form']['row\_background\_color']; |
| [9011](#L9011) | $border\_color               = $bookingpress\_custom\_data\_arr['my\_booking\_form']['border\_color']; |
| [9012](#L9012) | $primary\_color              = $bookingpress\_custom\_data\_arr['my\_booking\_form']['primary\_color']; |
| [9013](#L9013) | $label\_title\_color          = $bookingpress\_custom\_data\_arr['my\_booking\_form']['label\_title\_color']; |
| [9014](#L9014) | $content\_color              = $bookingpress\_custom\_data\_arr['my\_booking\_form']['content\_color']; |
| [9015](#L9015) | $sub\_title\_color            = $bookingpress\_custom\_data\_arr['my\_booking\_form']['sub\_title\_color']; |
| [9016](#L9016) | $title\_font\_size            = '18px'; |
| [9017](#L9017) | $title\_font\_family          = $bookingpress\_custom\_data\_arr['my\_booking\_form']['title\_font\_family']; |
| [9018](#L9018) | $title\_font\_family          = $title\_font\_family == 'Inherit Fonts' ? 'inherit' : $title\_font\_family; |
| [9019](#L9019) | $price\_button\_color         = $bookingpress\_custom\_data\_arr['my\_booking\_form']['price\_button\_text\_color']; |
| [9020](#L9020) | $content\_font\_size          = '14px'; |
| [9021](#L9021) | $sub\_title\_font\_size        = '16px'; |
| [9022](#L9022) | $hex                        = $primary\_color; |
| [9023](#L9023) | list($r, $g, $b)            = is\_string($hex) ? sscanf($hex, '#%02x%02x%02x') : sscanf('#12D488', '#%02x%02x%02x'); |
| [9024](#L9024) | $primary\_alpha\_color        = "rgba($r,$g,$b,0.06)"; |
| [9025](#L9025) | $border\_hex                 = $content\_color; |
| [9026](#L9026) | list($r, $g, $b)            = is\_string($border\_hex) ? sscanf($border\_hex, '#%02x%02x%02x') : sscanf('#535D71', '#%02x%02x%02x'); |
| [9027](#L9027) | $placeholder\_color          = "rgba($r,$g,$b,0.75)"; |
| [9028](#L9028) |  |
| [9029](#L9029) |  |
| [9030](#L9030) | $bookingpress\_customize\_css\_content .= ' |
| [9031](#L9031) | .bpa-front-cp-top-navbar,.bpa-front-cp-card, |
| [9032](#L9032) | .bpa-front-data-empty-view--my-bookings.\_\_bpa-is-guest-view, |
| [9033](#L9033) | .bpa-front-ma-table-actions-wrap .bpa-front-ma-taw\_\_card, |
| [9034](#L9034) | .el-popover, |
| [9035](#L9035) | .bpa-front-cp-custom-popover, |
| [9036](#L9036) | .bpa-tn\_\_dropdown-menu, |
| [9037](#L9037) | .bpa-front-ma-view-appointment-card, |
| [9038](#L9038) | .bpa-vac-pd\_\_item.\_\_bpa-pd-is-total-item, |
| [9039](#L9039) | .bpa-front-cp-cancel-mob-drawer { |
| [9040](#L9040) | background-color:'.$shortcode\_background\_color.' !important; |
| [9041](#L9041) | } |
| [9042](#L9042) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_form-bg{ |
| [9043](#L9043) | fill:'.$shortcode\_background\_color.' !important; |
| [9044](#L9044) | }'; |
| [9045](#L9045) | $bookingpress\_customize\_css\_content .= ' |
| [9046](#L9046) | .bpa-cp-ma-table.el-table--striped .el-table\_\_body tr.el-table\_\_row--striped td.el-table\_\_cell, |
| [9047](#L9047) | .bpa-front-toast-notification.--bpa-error, |
| [9048](#L9048) | .bpa-front-toast-notification.--bpa-success, |
| [9049](#L9049) | .bpa-front-ma--pagination-wrapper.\_\_bpa-is-sticky, |
| [9050](#L9050) | .el-year-table td.disabled .cell, |
| [9051](#L9051) | .el-month-table td.disabled .cell{ |
| [9052](#L9052) | background-color: '.$shortcode\_footer\_background\_color.' !important; |
| [9053](#L9053) | } |
| [9054](#L9054) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_panel-bg{ |
| [9055](#L9055) | fill: '.$shortcode\_footer\_background\_color.' !important; |
| [9056](#L9056) | }'; |
| [9057](#L9057) |  |
| [9058](#L9058) | $bookingpress\_customize\_css\_content .= ' |
| [9059](#L9059) | .bpa-front-cp-top-navbar, |
| [9060](#L9060) | .bpa-front-cp-card, |
| [9061](#L9061) | .bpa-front-form-control input, |
| [9062](#L9062) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner, |
| [9063](#L9063) | .bpa-cp-ma-table.el-table .el-table\_\_header-wrapper tr th.el-table\_\_cell, |
| [9064](#L9064) | .bpa-front-ma-view-appointment-card, |
| [9065](#L9065) | .bpa-ma-vac-sec-title, |
| [9066](#L9066) | .bpa-ma-vac--head\_\_right .bpa-front-pill, |
| [9067](#L9067) | .bpa-vac-pd\_\_item.\_\_bpa-pd-is-total-item, |
| [9068](#L9068) | .bpa-front-btn\_\_small, |
| [9069](#L9069) | .bpa-front-ma-table-actions-wrap .bpa-front-ma-taw\_\_card, |
| [9070](#L9070) | .el-popover, |
| [9071](#L9071) | .el-popconfirm .el-popconfirm\_\_action, |
| [9072](#L9072) | .bpa-front-cp-custom-popover, |
| [9073](#L9073) | .bpa-tn\_\_dropdown-menu, |
| [9074](#L9074) | .bpa-front-form-control input:focus, |
| [9075](#L9075) | .bpa-front-form-control .el-textarea\_\_inner:focus, |
| [9076](#L9076) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner:focus, |
| [9077](#L9077) | .bpa-cp-ma-table.el-table td.el-table\_\_cell, |
| [9078](#L9078) | .bpa-front-ma--pagination-wrapper .el-pager li, |
| [9079](#L9079) | .bpa-front-cp-custom-popover .el-date-picker\_\_header--bordered, |
| [9080](#L9080) | .bpa-custom-datepicker .el-date-picker\_\_header--bordered, |
| [9081](#L9081) | .bpa-tn\_\_dropdown-head .bpa-cp-avatar\_\_default-img, |
| [9082](#L9082) | .bpa-front-form-control.--bpa-country-dropdown.vue-tel-input:focus-within, |
| [9083](#L9083) | .el-date-picker\_\_header--bordered { |
| [9084](#L9084) | border-color: ' . $border\_color . ' !important; |
| [9085](#L9085) | } |
| [9086](#L9086) | .bpa-front-form-control input::placeholder, |
| [9087](#L9087) | .bpa-front-form-control .el-textarea\_\_inner::placeholder, |
| [9088](#L9088) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner::placeholder { |
| [9089](#L9089) | color:'.$placeholder\_color.' !important; |
| [9090](#L9090) | }'; |
| [9091](#L9091) | $bookingpress\_customize\_css\_content .= '.bpa-front-btn--primary, |
| [9092](#L9092) | .bpa-front-ma--pagination-wrapper .el-pager li.active, |
| [9093](#L9093) | .bpa-ma-vac--action-btn-group .bpa-front-btn:hover, |
| [9094](#L9094) | .bpa-front-ma-table-actions-wrap .bpa-front-btn--icon-without-box:hover, |
| [9095](#L9095) | .bpa-front-btn--primary:hover, |
| [9096](#L9096) | .el-date-table td.current:not(.disabled) span  { |
| [9097](#L9097) | background: ' . $primary\_color . ' !important; |
| [9098](#L9098) | } |
| [9099](#L9099) | .bpa-front-btn--primary,.bpa-ma-vac--action-btn-group .bpa-front-btn:hover, |
| [9100](#L9100) | .bpa-front-ma--pagination-wrapper .btn-prev:hover, |
| [9101](#L9101) | .bpa-front-ma--pagination-wrapper .btn-next:hover, |
| [9102](#L9102) | .bpa-front-btn--primary:hover, |
| [9103](#L9103) | .bpa-front-ma--pagination-wrapper .el-pager li.active, |
| [9104](#L9104) | .bpa-front-ma--pagination-wrapper .el-pager li:hover { |
| [9105](#L9105) | border-color:' . $primary\_color . ' !important; |
| [9106](#L9106) | } |
| [9107](#L9107) | .el-button--bpa-front-btn.bpa-front-btn--danger.el-button--mini:hover { |
| [9108](#L9108) | border-color:var(--bpa-sc-danger) !important; |
| [9109](#L9109) | } |
| [9110](#L9110) | .el-button--bpa-front-btn:hover { |
| [9111](#L9111) | border-color:' . $content\_color . ' !important; |
| [9112](#L9112) | }'; |
| [9113](#L9113) |  |
| [9114](#L9114) | $bookingpress\_customize\_css\_content .= '.bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item.\_\_bpa-is-active, |
| [9115](#L9115) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item.\_\_bpa-is-active span, |
| [9116](#L9116) | .bpa-front-ma--pagination-wrapper .el-pager li:hover, |
| [9117](#L9117) | .bpa-vac-pd\_\_item.\_\_bpa-pd-is-total-item .bpa-vac-pd\_\_val, |
| [9118](#L9118) | .el-date-picker\_\_header-label.active, |
| [9119](#L9119) | .el-date-picker\_\_header-label:hover, |
| [9120](#L9120) | .el-date-table td.available:hover, |
| [9121](#L9121) | .el-date-table td.today:not(.current) span, |
| [9122](#L9122) | .el-month-table td .cell:hover, |
| [9123](#L9123) | .el-month-table td.current:not(.disabled) .cell, |
| [9124](#L9124) | .el-year-table td .cell:hover, |
| [9125](#L9125) | .el-year-table td.current:not(.disabled) .cell, |
| [9126](#L9126) | .el-picker-panel\_\_content .el-date-table td:not(.next-month):not(.prev-month):not(.today):not(.current) span:hover, |
| [9127](#L9127) | .el-picker-panel\_\_content .el-date-table td:not(.current):not(.today) span:hover, |
| [9128](#L9128) | .bpa-front-cp-custom-popover .el-year-table td.today .cell, |
| [9129](#L9129) | .bpa-front-cp-custom-popover .el-month-table td.today .cell, |
| [9130](#L9130) | .bpa-custom-datepicker .el-year-table td.today .cell, |
| [9131](#L9131) | .bpa-custom-datepicker .el-month-table td.today .cell { |
| [9132](#L9132) | color: ' . $primary\_color. ' !important; |
| [9133](#L9133) | } |
| [9134](#L9134) | .bpa-front-dcw\_\_vector .bpa-front-dcw\_\_vector-primary-color,.bpa-front-loader-cl-primary, |
| [9135](#L9135) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item.\_\_bpa-is-active svg, |
| [9136](#L9136) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_primary-bg{ |
| [9137](#L9137) | fill:'. $primary\_color. ' !important; |
| [9138](#L9138) | } |
| [9139](#L9139) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_primary-bg{ |
| [9140](#L9140) | stroke:'. $primary\_color. ' !important; |
| [9141](#L9141) | } |
| [9142](#L9142) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .bpa-ma-date-time-details .bpa-ma-dt\_\_time-val svg, |
| [9143](#L9143) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item svg, |
| [9144](#L9144) | .bpa-front-ma-table-actions-wrap .bpa-front-ma-taw\_\_card .bpa-front-btn--icon-without-box span svg, |
| [9145](#L9145) | .bpa-tn\_\_dropdown-head .bpa-cp-avatar\_\_default-img svg { |
| [9146](#L9146) | fill:'. $content\_color. ' !important; |
| [9147](#L9147) | } |
| [9148](#L9148) | .bpa-ma-vac--action-btn-group .bpa-front-btn span svg { |
| [9149](#L9149) | fill:'. $sub\_title\_color. ' !important; |
| [9150](#L9150) | } |
| [9151](#L9151) | .bpa-ma-vac--action-btn-group .bpa-front-btn:hover span svg, |
| [9152](#L9152) | .bpa-front-ma-table-actions-wrap .bpa-front-ma-taw\_\_card .bpa-front-btn--icon-without-box:hover span svg { |
| [9153](#L9153) | fill: var(--bpa-cl-white) !important; |
| [9154](#L9154) | }'; |
| [9155](#L9155) | $bookingpress\_customize\_css\_content .= ' |
| [9156](#L9156) | .bpa-front-default-card{ |
| [9157](#L9157) | background: ' . $shortcode\_background\_color . ' !important; |
| [9158](#L9158) | } |
| [9159](#L9159) |  |
| [9160](#L9160) | .bpa-front-btn--primary span, |
| [9161](#L9161) | .bpa-front-ma--pagination-wrapper .el-pager li.active, |
| [9162](#L9162) | .bpa-ma-vac--action-btn-group .bpa-front-btn:hover, |
| [9163](#L9163) | .bpa-front-ma--pagination-wrapper .btn-prev:hover span, |
| [9164](#L9164) | .bpa-front-ma--pagination-wrapper .btn-next:hover span, |
| [9165](#L9165) | .bpa-front-ma--pagination-wrapper .btn-next:hover, |
| [9166](#L9166) | .bpa-front-ma--pagination-wrapper .btn-prev:hover, |
| [9167](#L9167) | .bpa-front-ma--pagination-wrapper .el-pagination .btn-prev .el-icon:hover, |
| [9168](#L9168) | .bpa-front-ma--pagination-wrapper .el-pagination .btn-next .el-icon:hover, |
| [9169](#L9169) | .bpa-front-ma--pagination-wrapper .btn-prev:hover:before, |
| [9170](#L9170) | .bpa-front-ma--pagination-wrapper .btn-next:hover:after, |
| [9171](#L9171) | .el-date-table td.current:not(.disabled) span, |
| [9172](#L9172) | .bpa-front-cp-delete-account-wrapper .bpa-front-dcw\_\_body-btn-group .bpa-front-btn--danger, |
| [9173](#L9173) | .bpa-front-cp-delete-account-wrapper .bpa-front-dcw\_\_body-btn-group .bpa-front-btn--danger span{ |
| [9174](#L9174) | color:'.$price\_button\_color.' !important; |
| [9175](#L9175) | }'; |
| [9176](#L9176) |  |
| [9177](#L9177) | $bookingpress\_customize\_css\_content .= ' |
| [9178](#L9178) | .bpa-front-module-heading, |
| [9179](#L9179) | .bpa-cp-pd\_\_title, |
| [9180](#L9180) | .bpa-cp-ma-table.el-table .bpa-cp-ma-cell-val, |
| [9181](#L9181) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .cell, |
| [9182](#L9182) | .bpa-cp-ma-table.el-table .el-table\_\_header-wrapper tr th.el-table\_\_cell, |
| [9183](#L9183) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-title, |
| [9184](#L9184) | .bpa-bd\_\_item .bpa-item--val, |
| [9185](#L9185) | .bpa-ma-vac-sec-title, |
| [9186](#L9186) | .bpa-front-form-control input, |
| [9187](#L9187) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-id, |
| [9188](#L9188) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item, |
| [9189](#L9189) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item, |
| [9190](#L9190) | .bpa-cp-ma-table.el-table td.el-table\_\_cell, |
| [9191](#L9191) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .bpa-ma-date-time-details .bpa-ma-dt\_\_time-val, |
| [9192](#L9192) | .bpa-bd\_\_item .bpa-item--label, |
| [9193](#L9193) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_label, |
| [9194](#L9194) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_val, |
| [9195](#L9195) | .bpa-ma-vac--action-btn-group .bpa-front-btn\_\_small, |
| [9196](#L9196) | .bpa-front-btn--primary, |
| [9197](#L9197) | .bpa-front-pill, |
| [9198](#L9198) | .bpa-front-ma--pagination-wrapper .el-pager li.number, |
| [9199](#L9199) | .bpa-front-dcw\_\_body-title, |
| [9200](#L9200) | .bpa-front-dcw\_\_body-sub-title, |
| [9201](#L9201) | .bpa-front-btn, |
| [9202](#L9202) | .el-popconfirm\_\_main, |
| [9203](#L9203) | .bpa-front-btn\_\_small, |
| [9204](#L9204) | .el-date-picker\_\_header-label, |
| [9205](#L9205) | .el-picker-panel\_\_content .el-date-table th, |
| [9206](#L9206) | .el-picker-panel\_\_content .el-date-table td span, |
| [9207](#L9207) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_title, |
| [9208](#L9208) | .el-form-item\_\_error, |
| [9209](#L9209) | .bpa-front-form-control input::placeholder, |
| [9210](#L9210) | .bpa-front-form-control .el-textarea\_\_inner::placeholder, |
| [9211](#L9211) | .bpa-front-cp-custom-popover .el-year-table td .cell, |
| [9212](#L9212) | .bpa-front-cp-custom-popover .el-month-table td .cell, |
| [9213](#L9213) | .bpa-custom-datepicker .el-year-table td .cell, |
| [9214](#L9214) | .bpa-custom-datepicker .el-month-table td .cell, |
| [9215](#L9215) | .el-year-table td .cell, |
| [9216](#L9216) | .el-month-table td .cell, |
| [9217](#L9217) | .bpa-front-ma--pagination-wrapper .btn-prev span, |
| [9218](#L9218) | .bpa-front-ma--pagination-wrapper .btn-next span{ |
| [9219](#L9219) | font-family: ' . $title\_font\_family . ' !important; |
| [9220](#L9220) | }'; |
| [9221](#L9221) |  |
| [9222](#L9222) | $bookingpress\_customize\_css\_content .= ' |
| [9223](#L9223) | .bpa-front-module-heading, |
| [9224](#L9224) | .bpa-cp-pd\_\_title, |
| [9225](#L9225) | .bpa-cp-ma-table.el-table .el-table\_\_header-wrapper tr th.el-table\_\_cell, |
| [9226](#L9226) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-title, |
| [9227](#L9227) | .bpa-bd\_\_item .bpa-item--val, |
| [9228](#L9228) | .bpa-ma-vac-sec-title, |
| [9229](#L9229) | .bpa-front-form-control input, |
| [9230](#L9230) | .bpa-vac-pd\_\_item.\_\_bpa-pd-is-total-item .bpa-vac-pd\_\_label, |
| [9231](#L9231) | .bpa-front-dcw\_\_body-title, |
| [9232](#L9232) | .el-picker-panel\_\_content .el-date-table td:not(.next-month):not(.prev-month):not(.today):not(.current) span, |
| [9233](#L9233) | .el-date-picker\_\_header-label, |
| [9234](#L9234) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner, |
| [9235](#L9235) | .bpa-front-cp-custom-popover .el-year-table td .cell, |
| [9236](#L9236) | .bpa-front-cp-custom-popover .el-month-table td .cell, |
| [9237](#L9237) | .bpa-custom-datepicker .el-year-table td .cell, |
| [9238](#L9238) | .bpa-custom-datepicker .el-month-table td .cell, |
| [9239](#L9239) | .el-year-table td .cell, |
| [9240](#L9240) | .el-month-table td .cell |
| [9241](#L9241) | { |
| [9242](#L9242) | color: ' . $label\_title\_color . ' !important; |
| [9243](#L9243) | }'; |
| [9244](#L9244) | $bookingpress\_customize\_css\_content .= ' |
| [9245](#L9245) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-id, |
| [9246](#L9246) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item span, |
| [9247](#L9247) | .bpa-cp-ma-table.el-table .el-table\_\_expand-icon .el-icon-arrow-right::before, |
| [9248](#L9248) | .bpa-front-data-empty-view--my-bookings .bpa-front-dev\_\_title |
| [9249](#L9249) | { |
| [9250](#L9250) | color: ' . $content\_color . ' !important; |
| [9251](#L9251) | }'; |
| [9252](#L9252) | $bookingpress\_customize\_css\_content .= ' |
| [9253](#L9253) | .bpa-tn\_\_dropdown-head svg { |
| [9254](#L9254) | fill: ' . $content\_color . ' !important; |
| [9255](#L9255) | }'; |
| [9256](#L9256) | $bookingpress\_customize\_css\_content .= ' |
| [9257](#L9257) | .el-picker-panel .el-icon-arrow-left::before, |
| [9258](#L9258) | .el-picker-panel .el-icon-arrow-right::before, |
| [9259](#L9259) | .el-picker-panel .el-icon-d-arrow-left::before, |
| [9260](#L9260) | .el-picker-panel .el-icon-d-arrow-right::before, |
| [9261](#L9261) | .bpa-cp-ma-table.el-table .el-table\_\_expand-icon .el-icon-arrow-right::before, |
| [9262](#L9262) | .bpa-front-form-control--date-picker .el-input\_\_prefix .el-input\_\_icon::before, |
| [9263](#L9263) | .bpa-front-cp--fw\_\_col.\_\_bpa-is-search-icon .bpa-front-form-control .el-input\_\_prefix .el-icon-search:before, |
| [9264](#L9264) | .bpa-front-ma--pagination-wrapper .btn-prev::before, |
| [9265](#L9265) | .bpa-front-ma--pagination-wrapper .btn-next::after { |
| [9266](#L9266) | background-color: ' . $content\_color . ' !important; |
| [9267](#L9267) | }'; |
| [9268](#L9268) |  |
| [9269](#L9269) |  |
| [9270](#L9270) | $bookingpress\_customize\_css\_content .= ' |
| [9271](#L9271) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item, |
| [9272](#L9272) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .cell, |
| [9273](#L9273) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .bpa-ma-date-time-details .bpa-ma-dt\_\_time-val, |
| [9274](#L9274) | .bpa-bd\_\_item .bpa-item--label, |
| [9275](#L9275) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_label, |
| [9276](#L9276) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_val:not(.bpa-front-text-primary-color):not(.bpa-front-text--danger-color):not(.bpa-front-text--danger-color):not(.bpa-front-text-blue-color):not(.bpa-front-text--secondary-orange-color), |
| [9277](#L9277) | .bpa-ma-vac--action-btn-group .bpa-front-btn\_\_small, |
| [9278](#L9278) | .bpa-ma-vac--action-btn-group .bpa-front-btn span svg, |
| [9279](#L9279) | .bpa-cp-ma-table.el-table .bpa-cp-ma-cell-val, |
| [9280](#L9280) | .bpa-front-ma--pagination-wrapper .el-pager li, |
| [9281](#L9281) | .bpa-front-dcw\_\_body-sub-title, |
| [9282](#L9282) | .bpa-front-delete-account-txt, |
| [9283](#L9283) | .bpa-mob-col\_\_body .bpa-mob--service-title, |
| [9284](#L9284) | .bpa-mob--date-time-details .bpa-mob-dtd\_\_date-val, |
| [9285](#L9285) | .bpa-mob--date-time-details .bpa-mob-dtd\_\_time-val, |
| [9286](#L9286) | .bpa-front-ma--pagination-wrapper .btn-prev span, |
| [9287](#L9287) | .bpa-front-ma--pagination-wrapper .btn-next span, |
| [9288](#L9288) | .bpa-front-ma--pagination-wrapper .el-pagination .btn-prev .el-icon, |
| [9289](#L9289) | .bpa-front-ma--pagination-wrapper .el-pagination .btn-next .el-icon, |
| [9290](#L9290) | .bpa-front-ma--pagination-wrapper .btn-prev::before, |
| [9291](#L9291) | .bpa-front-ma--pagination-wrapper .btn-next::after, |
| [9292](#L9292) | .el-picker-panel\_\_content .el-date-table th, |
| [9293](#L9293) | .el-popconfirm .el-popconfirm\_\_main, |
| [9294](#L9294) | .el-popconfirm .el-popconfirm\_\_action .el-button--bpa-front-btn:not(.bpa-front-btn--danger) |
| [9295](#L9295) | { |
| [9296](#L9296) | color: ' . $sub\_title\_color . ' !important; |
| [9297](#L9297) | }'; |
| [9298](#L9298) |  |
| [9299](#L9299) | $bookingpress\_customize\_css\_content .= ' |
| [9300](#L9300) | .btn-prev .el-icon-arrow-left::before, |
| [9301](#L9301) | .btn-next .el-icon-arrow-right::before |
| [9302](#L9302) | { |
| [9303](#L9303) | background-color: '.$sub\_title\_color.' !important; |
| [9304](#L9304) | }'; |
| [9305](#L9305) |  |
| [9306](#L9306) | $bookingpress\_customize\_css\_content .= ' |
| [9307](#L9307) | @media (min-width: 1200px){ |
| [9308](#L9308) | .bpa-front-module-heading |
| [9309](#L9309) | { |
| [9310](#L9310) | font-size: ' . $title\_font\_size . ' !important; |
| [9311](#L9311) | } |
| [9312](#L9312) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item, |
| [9313](#L9313) | .bpa-front-form-control input, |
| [9314](#L9314) | .bpa-front-btn--primary span, |
| [9315](#L9315) | .bpa-cp-ma-table.el-table .bpa-cp-ma-cell-val, |
| [9316](#L9316) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .cell, |
| [9317](#L9317) | .bpa-front-ma--pagination-wrapper .el-pager li, |
| [9318](#L9318) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-id, |
| [9319](#L9319) | .bpa-bd\_\_item .bpa-item--val, |
| [9320](#L9320) | .bpa-ma-vac-sec-title, |
| [9321](#L9321) | .bpa-front-dcw\_\_body-sub-title, |
| [9322](#L9322) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_label, |
| [9323](#L9323) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_val, |
| [9324](#L9324) | .bpa-front-ma--pagination-wrapper .btn-prev span, |
| [9325](#L9325) | .bpa-front-ma--pagination-wrapper .btn-next span{ |
| [9326](#L9326) | font-size: ' . $content\_font\_size . ' !important; |
| [9327](#L9327) | } |
| [9328](#L9328) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-title, |
| [9329](#L9329) | .bpa-front-dcw\_\_body-title{ |
| [9330](#L9330) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9331](#L9331) | } |
| [9332](#L9332) | .bpa-cp-pd\_\_title, |
| [9333](#L9333) | .bpa-front-btn\_\_small, |
| [9334](#L9334) | .bpa-bd\_\_item .bpa-item--label, |
| [9335](#L9335) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .bpa-ma-date-time-details .bpa-ma-dt\_\_time-val, |
| [9336](#L9336) | .el-picker-panel\_\_content .el-date-table th, |
| [9337](#L9337) | .el-picker-panel\_\_content .el-date-table td span { |
| [9338](#L9338) | font-size: 13px !important; |
| [9339](#L9339) | } |
| [9340](#L9340) | } |
| [9341](#L9341) |  |
| [9342](#L9342) | @media (max-width: 1024px) { |
| [9343](#L9343) | .bpa-front-module-heading, |
| [9344](#L9344) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-title { |
| [9345](#L9345) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9346](#L9346) | } |
| [9347](#L9347) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item, |
| [9348](#L9348) | .el-table th.el-table\_\_cell>.cell, |
| [9349](#L9349) | .bpa-cp-ma-table.el-table .bpa-cp-ma-cell-val, |
| [9350](#L9350) | .bpa-front-ma--pagination-wrapper .el-pager li, |
| [9351](#L9351) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-id, |
| [9352](#L9352) | .bpa-bd\_\_item .bpa-item--label, |
| [9353](#L9353) | .bpa-ma-vac-sec-title, |
| [9354](#L9354) | .bpa-front-form-control { |
| [9355](#L9355) | font-size: ' . $content\_font\_size . ' !important; |
| [9356](#L9356) | } |
| [9357](#L9357) | .bpa-cp-pd\_\_title, |
| [9358](#L9358) | .bpa-bd\_\_item .bpa-item--label, |
| [9359](#L9359) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_label, |
| [9360](#L9360) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_val, |
| [9361](#L9361) | .bpa-front-btn\_\_small, |
| [9362](#L9362) | .bpa-cp-ma-table.el-table td.el-table\_\_cell .bpa-ma-date-time-details .bpa-ma-dt\_\_time-val { |
| [9363](#L9363) | font-size: 13px !important; |
| [9364](#L9364) | } |
| [9365](#L9365) | } |
| [9366](#L9366) | @media (max-width: 576px){ |
| [9367](#L9367) | .bpa-front-module-heading |
| [9368](#L9368) | { |
| [9369](#L9369) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9370](#L9370) | } |
| [9371](#L9371) | .bpa-tn\_\_dropdown-menu .bpa-tn\_\_dropdown-item a.bpa-tm\_\_item, |
| [9372](#L9372) | .bpa-mob-col\_\_body .bpa-mob--service-title , |
| [9373](#L9373) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-title, |
| [9374](#L9374) | .bpa-bd\_\_item .bpa-item--label, |
| [9375](#L9375) | .bpa-bd\_\_item .bpa-item--val, |
| [9376](#L9376) | .bpa-ma-vac-sec-title |
| [9377](#L9377) | { |
| [9378](#L9378) | font-size: ' . $content\_font\_size . ' !important; |
| [9379](#L9379) | } |
| [9380](#L9380) | .bpa-mob--date-time-details .bpa-mob-dtd\_\_date-val, |
| [9381](#L9381) | .bpa-mob--date-time-details .bpa-mob-dtd\_\_time-val, |
| [9382](#L9382) | .bpa-left\_\_service-detail .bpa-sd\_\_appointment-id, |
| [9383](#L9383) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_label, |
| [9384](#L9384) | .bpa-vac-pd\_\_item .bpa-vac-pd\_\_val, |
| [9385](#L9385) | .bpa-front-btn\_\_small { |
| [9386](#L9386) | font-size: 13px !important; |
| [9387](#L9387) | } |
| [9388](#L9388) | .bpa-front-ma--pagination-wrapper .btn-prev, |
| [9389](#L9389) | .bpa-front-ma--pagination-wrapper .btn-next{ |
| [9390](#L9390) | border-color: ' . $border\_color . ' !important; |
| [9391](#L9391) | } |
| [9392](#L9392) | .bpa-front-ma--pagination-wrapper .btn-prev:hover, |
| [9393](#L9393) | .bpa-front-ma--pagination-wrapper .btn-next:hover{ |
| [9394](#L9394) | background: ' . $primary\_color . ' !important; |
| [9395](#L9395) | border-color: ' . $primary\_color . ' !important; |
| [9396](#L9396) |  |
| [9397](#L9397) | } |
| [9398](#L9398) | .bpa-front-ma--pagination-wrapper .btn-next:hover:after, |
| [9399](#L9399) | .bpa-front-ma--pagination-wrapper .btn-prev:hover:before { |
| [9400](#L9400) | background-color: ' .$price\_button\_color. ' !important; |
| [9401](#L9401) | } |
| [9402](#L9402) | }'; |
| [9403](#L9403) |  |
| [9404](#L9404) | $bookingpress\_customize\_css\_content = apply\_filters('bookingpress\_generate\_my\_booking\_customize\_css',$bookingpress\_customize\_css\_content,$bookingpress\_custom\_data\_arr); |
| [9405](#L9405) |  |
| [9406](#L9406) | if (! function\_exists('WP\_Filesystem') ) { |
| [9407](#L9407) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [9408](#L9408) | } |
| [9409](#L9409) | WP\_Filesystem(); |
| [9410](#L9410) | global $wp\_filesystem; |
| [9411](#L9411) | $wp\_upload\_dir = wp\_upload\_dir(); |
| [9412](#L9412) | $target\_path   = $wp\_upload\_dir['basedir'] . '/bookingpress/bookingpress\_front\_mybookings\_custom\_' . $bookingpress\_customize\_css\_key . '.css'; |
| [9413](#L9413) | $result        = $wp\_filesystem->put\_contents($target\_path, $bookingpress\_customize\_css\_content, 0777); |
| [9414](#L9414) |  |
| [9415](#L9415) | } else if( 'bookingpress\_save\_booking\_form\_settings' == $value ){ |
| [9416](#L9416) | $shortcode\_background\_color        = $bookingpress\_custom\_data\_arr['booking\_form']['background\_color']; |
| [9417](#L9417) | $shortcode\_footer\_background\_color = $bookingpress\_custom\_data\_arr['booking\_form']['footer\_background\_color']; |
| [9418](#L9418) | $border\_color                      = $bookingpress\_custom\_data\_arr['booking\_form']['border\_color']; |
| [9419](#L9419) | $primary\_color                     = $bookingpress\_custom\_data\_arr['booking\_form']['primary\_color']; |
| [9420](#L9420) | $primary\_alpha\_color               = $bookingpress\_custom\_data\_arr['booking\_form']['primary\_background\_color']; |
| [9421](#L9421) | $title\_label\_color                 = $bookingpress\_custom\_data\_arr['booking\_form']['label\_title\_color']; |
| [9422](#L9422) | $title\_font\_size                   = '18px'; |
| [9423](#L9423) | $title\_font\_family                 = $bookingpress\_custom\_data\_arr['booking\_form']['title\_font\_family']; |
| [9424](#L9424) | $title\_font\_family                 =  $title\_font\_family == 'Inherit Fonts' ? 'inherit' : $title\_font\_family; |
| [9425](#L9425) | $content\_color                     = $bookingpress\_custom\_data\_arr['booking\_form']['content\_color']; |
| [9426](#L9426) | $price\_button\_text\_content\_color   = $bookingpress\_custom\_data\_arr['booking\_form']['price\_button\_text\_color']; |
| [9427](#L9427) | $sub\_title\_font\_size               = '16px'; |
| [9428](#L9428) | $content\_font\_size                 = '14px'; |
| [9429](#L9429) | $sub\_title\_color                   = $bookingpress\_custom\_data\_arr['booking\_form']['sub\_title\_color']; |
| [9430](#L9430) |  |
| [9431](#L9431) | $hex                               = $primary\_color; |
| [9432](#L9432) | list($r, $g, $b)                   = is\_string($hex) ? sscanf($hex, '#%02x%02x%02x') : sscanf('#12D488', '#%02x%02x%02x'); |
| [9433](#L9433) | $box\_shadow\_color                  = "0 4px 8px rgba($r,$g,$b,0.06), 0 8px 16px rgba($r,$g,$b,0.16)"; |
| [9434](#L9434) |  |
| [9435](#L9435) | $border\_hex                        = $content\_color; |
| [9436](#L9436) | list($r, $g, $b)                   = is\_string($border\_hex) ? sscanf($border\_hex, '#%02x%02x%02x') : sscanf('#535D71', '#%02x%02x%02x'); |
| [9437](#L9437) | $placeholder\_color                 = "rgba($r,$g,$b,0.75)"; |
| [9438](#L9438) |  |
| [9439](#L9439) | $border\_rgba                 = $border\_color; |
| [9440](#L9440) | list($r, $g, $b)            = is\_string($border\_rgba) ? sscanf($border\_rgba, '#%02x%02x%02x') : sscanf('#CFD6E5', '#%02x%02x%02x'); |
| [9441](#L9441) | $border\_rgba          = "rgba($r,$g,$b,0.1)"; |
| [9442](#L9442) |  |
| [9443](#L9443) | $bookingpress\_customize\_css\_content .= '.bpa-front-tabs,.bpa-appointment-cancellation\_container { |
| [9444](#L9444) | --bpa-pt-main-green: ' . $primary\_color . ' !important; |
| [9445](#L9445) | --bpa-pt-main-green-darker: ' . $primary\_color . ' !important; |
| [9446](#L9446) | --bpa-pt-main-green-alpha-12: ' . $primary\_alpha\_color . ' !important; |
| [9447](#L9447) | }'; |
| [9448](#L9448) |  |
| [9449](#L9449) | $bookingpress\_customize\_css\_content .= ' |
| [9450](#L9450) | .bpa-front-tabs .bpa-front-tab-menu, |
| [9451](#L9451) | .bpa-front-tabs .bpa-front-default-card, |
| [9452](#L9452) | .bpa-full-container-loader, |
| [9453](#L9453) | .bpa-front-tabs .bpa-front-tabs--foot, |
| [9454](#L9454) | .bpa-front-data-empty-view, |
| [9455](#L9455) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown, |
| [9456](#L9456) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-list, |
| [9457](#L9457) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item .bpa-front-si-card--checkmark-icon, |
| [9458](#L9458) | .bpa-front-thankyou-module-container, |
| [9459](#L9459) | .bpa-front-cancel-module-container, |
| [9460](#L9460) | .bpa-front--dt\_\_calendar .vc-nav-popover-container{ |
| [9461](#L9461) | background-color: ' . $shortcode\_background\_color . ' !important; |
| [9462](#L9462) | } |
| [9463](#L9463) | .bpa-front-data-empty-view .bpa-front-dev\_\_form-bg, |
| [9464](#L9464) | .bpa-front\_\_no-timeslots-body svg .bpa-front-dev\_\_form-bg{ |
| [9465](#L9465) | fill: ' . $shortcode\_background\_color . ' !important; |
| [9466](#L9466) | } |
| [9467](#L9467) | .bpa-front-form-control .el-textarea\_\_inner::placeholder, |
| [9468](#L9468) | .bpa-front-form-control input::placeholder, |
| [9469](#L9469) | .bpa-front-form-control--file-upload .bpa-fu\_\_placeholder, |
| [9470](#L9470) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner::placeholder { |
| [9471](#L9471) | color:'.$placeholder\_color.' !important; |
| [9472](#L9472) | } |
| [9473](#L9473) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown:hover, |
| [9474](#L9474) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-item.highlighted, |
| [9475](#L9475) | .bpa-front-toast-notification.--bpa-error, |
| [9476](#L9476) | .bpa-front-toast-notification.--bpa-success, |
| [9477](#L9477) | .bpa-front-thankyou-module-container .bpa-front-cc\_\_error-toast-notification{ |
| [9478](#L9478) | background-color: ' . $shortcode\_footer\_background\_color . ' !important; |
| [9479](#L9479) | } |
| [9480](#L9480) | .bpa-front-loader-cl-primary, |
| [9481](#L9481) | .bpa-front-data-empty-view .bpa-front-dev\_\_primary-bg, |
| [9482](#L9482) | .bpa-front\_\_no-timeslots-body svg .bpa-front-dev\_\_primary-bg{ |
| [9483](#L9483) | fill:'.$primary\_color.' !important; |
| [9484](#L9484) | } |
| [9485](#L9485) | .bpa-front-data-empty-view .bpa-front-dev\_\_primary-bg, |
| [9486](#L9486) | .bpa-front\_\_no-timeslots-body svg .bpa-front-dev\_\_primary-bg{ |
| [9487](#L9487) | stroke:'.$primary\_color.' !important; |
| [9488](#L9488) | } |
| [9489](#L9489) | .bpa-front-thankyou-module-container .bpa-front-tmc\_\_head .bpa-front-tmc\_\_vector--confirmation .bpa-front-vc\_\_bg, |
| [9490](#L9490) | .bpa-front-data-empty-view .bpa-front-dev\_\_panel-bg, |
| [9491](#L9491) | .bpa-front\_\_no-timeslots-body svg .bpa-front-dev\_\_panel-bg{ |
| [9492](#L9492) | fill: ' . $shortcode\_footer\_background\_color . ' !important; |
| [9493](#L9493) | } |
| [9494](#L9494) | .bpa-front-module--atc-wrapper .bpa-front-btn:hover { |
| [9495](#L9495) | border-color: ' . $content\_color . ' !important; |
| [9496](#L9496) | } |
| [9497](#L9497) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu, |
| [9498](#L9498) | .bpa-front-default-card, |
| [9499](#L9499) | .bpa-front-module--service-item .bpa-front-si-card, |
| [9500](#L9500) | .bpa-front--dt\_\_time-slots, |
| [9501](#L9501) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item, |
| [9502](#L9502) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9503](#L9503) | .bpa-front-tabs--foot, |
| [9504](#L9504) | .bpa-front--dt\_\_calendar .vc-container, |
| [9505](#L9505) | .bpa-front--dt\_\_calendar .vc-header, |
| [9506](#L9506) | .bpa-front--dt\_\_calendar .vc-day, |
| [9507](#L9507) | .bpa-front-form-control input, |
| [9508](#L9508) | .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details, |
| [9509](#L9509) | .bpa-front-form-control.--bpa-country-dropdown, |
| [9510](#L9510) | .bpa-front-form-control .el-textarea\_\_inner, |
| [9511](#L9511) | .bpa-front-form-control--v-date-picker .el-input\_\_inner, |
| [9512](#L9512) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner, |
| [9513](#L9513) | .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item, |
| [9514](#L9514) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item .bpa-front-tm--item-icon, |
| [9515](#L9515) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-list, |
| [9516](#L9516) | .bpa-fm--bs\_\_deposit-payment-module .bpa-dpm\_\_item.--bpa-is-dpm-total-item, |
| [9517](#L9517) | .bpa-fm--bs\_\_deposit-payment-module, |
| [9518](#L9518) | .bpa-front-module--booking-summary .bpa-is-coupon-module-enable .bpa-fm--bs\_\_coupon-module-textbox, |
| [9519](#L9519) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item, |
| [9520](#L9520) | .bpa-front-thankyou-module-container, |
| [9521](#L9521) | .bpa-front-tmc\_\_summary-content .bpa-front-tmc\_\_sc-item, |
| [9522](#L9522) | .bpa-front-module--add-to-calendar, |
| [9523](#L9523) | .bpa-front-module--atc-wrapper .bpa-front-btn, |
| [9524](#L9524) | .bpa-cp-ls\_\_tab-menu .bpa-tm\_\_item .bpa-tm\_\_item-icon, |
| [9525](#L9525) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown, |
| [9526](#L9526) | .bpa-front-form-control input:focus, |
| [9527](#L9527) | .bpa-front-form-control .el-textarea\_\_inner:focus, |
| [9528](#L9528) | .el-date-picker\_\_time-header .el-input .el-input\_\_inner:focus, |
| [9529](#L9529) | .bpa-front-module--date-and-time.\_\_sm .bpa-front--dt\_\_ts-sm-back-btn .bpa-front-btn, |
| [9530](#L9530) | .bpa-front-module--service-items-row .bpa-front-module--service-item, |
| [9531](#L9531) | .bpa-custom-datepicker .el-date-picker\_\_header--bordered, |
| [9532](#L9532) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si-card\_\_left .bpa-front-si\_\_default-img, |
| [9533](#L9533) | .bpa-fm\_\_booking-summary-v47 .bpa-front-module--bs-customer-detail, |
| [9534](#L9534) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item.\_\_bpa-is-disabled:hover, |
| [9535](#L9535) | .bpa-front--dt\_\_calendar .vc-nav-popover-container, |
| [9536](#L9536) | .bpa-front--dt\_\_calendar .vc-nav-items .vc-nav-item:hover, |
| [9537](#L9537) | .bpa-front-form-control--checkbox .el-checkbox\_\_inner:hover, |
| [9538](#L9538) | .bpa-front-form-control--checkbox .el-checkbox\_\_inner { |
| [9539](#L9539) | border-color: ' . $border\_color . ' !important; |
| [9540](#L9540) | } |
| [9541](#L9541) | .bpa-front-module--service-item.\_\_bpa-is-selected .bpa-front-si-card, |
| [9542](#L9542) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag.\_\_bpa-is-active, |
| [9543](#L9543) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag:hover, |
| [9544](#L9544) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item:hover, |
| [9545](#L9545) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active .bpa-front-tm--item-icon, |
| [9546](#L9546) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item.\_\_bpa-is-selected, |
| [9547](#L9547) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item.\_\_is-selected, |
| [9548](#L9548) | .bpa-front-form-control--checkbox .el-checkbox\_\_input.is-checked .el-checkbox\_\_inner, |
| [9549](#L9549) | .bpa-front-form-control--checkbox .el-checkbox\_\_inner:hover, |
| [9550](#L9550) | .el-radio\_\_input.is-checked .el-radio\_\_inner, |
| [9551](#L9551) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item.\_\_bpa-is-selected  { |
| [9552](#L9552) | border-color: ' . $primary\_color . ' !important; |
| [9553](#L9553) | } |
| [9554](#L9554) | .bpa-front--dt\_\_calendar .vc-day .vc-day-content.is-disabled{ |
| [9555](#L9555) | background-color:'.$border\_rgba. ' !important; |
| [9556](#L9556) | } |
| [9557](#L9557) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item.\_\_bpa-is-disabled{ |
| [9558](#L9558) | background-color:'.$border\_rgba. ' !important; |
| [9559](#L9559) | } |
| [9560](#L9560) | .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item.\_\_bpa-is-disabled:hover{ |
| [9561](#L9561) | background-color:'.$border\_rgba. ' !important; |
| [9562](#L9562) | } |
| [9563](#L9563) | '; |
| [9564](#L9564) | $bookingpress\_customize\_css\_content .= ' |
| [9565](#L9565) | .bpa-front-tabs .bpa-front-module-heading, |
| [9566](#L9566) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-weeks .vc-weekday, |
| [9567](#L9567) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item span, |
| [9568](#L9568) | .bpa-front-tabs .bpa-front-form-control input, |
| [9569](#L9569) | .bpa-front-tabs .bpa-front-form-control .el-textarea\_\_inner, |
| [9570](#L9570) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item .bpa-front-bs-sm\_\_item-val, |
| [9571](#L9571) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-head p, |
| [9572](#L9572) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p, |
| [9573](#L9573) | .bpa-front-tabs .el-form-item\_\_label .bpa-front-form-label, |
| [9574](#L9574) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .--bpa-is-desc, |
| [9575](#L9575) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item p, |
| [9576](#L9576) | .bpa-front-tabs .bpa-front-tab-menu .bpa-front-tab-menu--item, |
| [9577](#L9577) | .el-form-item\_\_error, |
| [9578](#L9578) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9579](#L9579) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong, |
| [9580](#L9580) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si\_\_card-body--heading, |
| [9581](#L9581) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt-ts\_\_sub-heading, |
| [9582](#L9582) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item span, |
| [9583](#L9583) | .bpa-front-module--bs-amount-details .bpa-fm--bs-amount-item .bpa-front-total-payment-amount-label, |
| [9584](#L9584) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details .bpa-front-module--bs-ad--price, |
| [9585](#L9585) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-title, |
| [9586](#L9586) | .bpa-front-tabs--foot .bpa-front-btn, |
| [9587](#L9587) | .bpa-front-form-control.--bpa-country-dropdown.vue-tel-input strong, |
| [9588](#L9588) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_label, |
| [9589](#L9589) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_val, |
| [9590](#L9590) | .bpa-front-tmc\_\_head .bpa-front-tmc\_\_title, |
| [9591](#L9591) | .bpa-front-tmc\_\_summary-content .bpa-front-tmc\_\_sc-item .bpa-front-sc-item\_\_label, |
| [9592](#L9592) | .bpa-front-tmc\_\_summary-content .bpa-front-tmc\_\_sc-item .bpa-front-sc-item\_\_val, |
| [9593](#L9593) | .bpa-front-module--add-to-calendar .bpa-fm--atc\_\_heading, |
| [9594](#L9594) | .bpa-front-tmc\_\_head p, |
| [9595](#L9595) | .bpa-front-data-empty-view .bpa-front-dev\_\_title, |
| [9596](#L9596) | .bpa-front-form-control input::placeholder, |
| [9597](#L9597) | .bpa-front-form-control .el-textarea\_\_inner::placeholder, |
| [9598](#L9598) | .bpa-front-form-control--file-upload .bpa-fu\_\_placeholder, |
| [9599](#L9599) | .bpa-custom-datepicker .el-year-table td .cell, |
| [9600](#L9600) | .bpa-custom-datepicker .el-month-table td .cell, |
| [9601](#L9601) | .bpa-front--dt\_\_calendar .vc-nav-title, |
| [9602](#L9602) | .bpa-front--dt\_\_calendar .vc-nav-items .vc-nav-item, |
| [9603](#L9603) | .bpa-front-thankyou-module-container .bpa-front-cc\_\_error-toast-notification, |
| [9604](#L9604) | .bpa-front\_\_no-timeslots-body .bpa-front-ntb\_\_val, |
| [9605](#L9605) | .bpa-front-module--note-desc, |
| [9606](#L9606) | .bpa-front-refund-confirmation-content .bpa-front-rcc\_\_body .bpa-front-rcc\_\_empty-msg, |
| [9607](#L9607) | .bpa-front--dt\_\_calendar .vc-day .vc-day-content, |
| [9608](#L9608) | .bpa-front-form-control--checkbox .el-checkbox\_\_label |
| [9609](#L9609) | { |
| [9610](#L9610) | font-family: ' . $title\_font\_family . ' !important; |
| [9611](#L9611) | }'; |
| [9612](#L9612) |  |
| [9613](#L9613) | $bookingpress\_customize\_css\_content .= ' |
| [9614](#L9614) | .bpa-front-ci-pill.\_\_bpa-is-active .bpa-front-ci-item-title, |
| [9615](#L9615) | .bpa-front-tabs .bpa-front-form-control input, |
| [9616](#L9616) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item .bpa-front-bs-sm\_\_item-val, |
| [9617](#L9617) | .bpa-front-tabs .bpa-front-form-control .el-textarea\_\_inner, |
| [9618](#L9618) | .bpa-front-tabs .bpa-front-module-heading, |
| [9619](#L9619) | .bpa-front-module--bs-amount-details .bpa-fm--bs-amount-item .bpa-front-total-payment-amount-label, |
| [9620](#L9620) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_val, |
| [9621](#L9621) | .bpa-front-tmc\_\_head .bpa-front-tmc\_\_title, |
| [9622](#L9622) | .bpa-front-tmc\_\_summary-content .bpa-front-tmc\_\_sc-item .bpa-front-sc-item\_\_val, |
| [9623](#L9623) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-item.highlighted strong, |
| [9624](#L9624) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-item.highlighted span, |
| [9625](#L9625) | .bpa-custom-datepicker .el-year-table td .cell, |
| [9626](#L9626) | .bpa-custom-datepicker .el-month-table td .cell{ |
| [9627](#L9627) | color: ' . $title\_label\_color . ' !important; |
| [9628](#L9628) | }'; |
| [9629](#L9629) |  |
| [9630](#L9630) |  |
| [9631](#L9631) | $bookingpress\_customize\_css\_content .= ' |
| [9632](#L9632) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong, |
| [9633](#L9633) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt-ts\_\_sub-heading, |
| [9634](#L9634) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-title, |
| [9635](#L9635) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si\_\_card-body--heading, |
| [9636](#L9636) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .--bpa-is-desc, |
| [9637](#L9637) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item span, |
| [9638](#L9638) | .bpa-front--dt\_\_ts-sm-back-btn label, |
| [9639](#L9639) | .bpa-front-tabs .el-form-item\_\_label span, |
| [9640](#L9640) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item span, |
| [9641](#L9641) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item p, |
| [9642](#L9642) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a, |
| [9643](#L9643) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-weeks .vc-weekday, |
| [9644](#L9644) | .bpa-front-tabs--foot .bpa-front-btn.bpa-front-btn--borderless, |
| [9645](#L9645) | .bpa-front-tmc\_\_summary-content .bpa-front-tmc\_\_sc-item .bpa-front-sc-item\_\_label, |
| [9646](#L9646) | .bpa-front-thankyou-module-container button.bpa-front-btn:not(:hover):not(:active):not(.has-text-color), |
| [9647](#L9647) | .bpa-front-thankyou-module-container .bpa-front-module--atc\_\_item a.bpa-front-btn:not(:hover):not(:active):not(.has-text-color), |
| [9648](#L9648) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-item strong, |
| [9649](#L9649) | .bpa-front-form-control.--bpa-country-dropdown .vti\_\_dropdown-item span, |
| [9650](#L9650) | .bpa-front--dt\_\_calendar .vc-nav-title, |
| [9651](#L9651) | .bpa-front--dt\_\_calendar .vc-nav-title:hover, |
| [9652](#L9652) | .bpa-front--dt\_\_calendar .vc-nav-items .vc-nav-item:hover, |
| [9653](#L9653) | .bpa-front\_\_no-timeslots-body .bpa-front-ntb\_\_val, |
| [9654](#L9654) | .bpa-front-refund-confirmation-content .bpa-front-rcc\_\_body .bpa-front-rcc\_\_empty-msg, |
| [9655](#L9655) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item::before{ |
| [9656](#L9656) | color: ' . $sub\_title\_color . ' !important; |
| [9657](#L9657) | }'; |
| [9658](#L9658) |  |
| [9659](#L9659) | $bookingpress\_customize\_css\_content .= ' |
| [9660](#L9660) | .bpa-front-tabs--foot .bpa-front-btn.bpa-front-btn--borderless, |
| [9661](#L9661) | .bpa-front--dt\_\_calendar .vc-arrows-container .vc-svg-icon path, |
| [9662](#L9662) | .bpa-front--dt\_\_calendar .vc-nav-header .vc-nav-arrow .vc-svg-icon path{ |
| [9663](#L9663) | fill: ' . $sub\_title\_color . ' !important; |
| [9664](#L9664) | }'; |
| [9665](#L9665) |  |
| [9666](#L9666) | $bookingpress\_customize\_css\_content .= ' |
| [9667](#L9667) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-head p, |
| [9668](#L9668) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a span, |
| [9669](#L9669) | .bpa-front-tabs .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item:hover, |
| [9670](#L9670) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p, |
| [9671](#L9671) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_label, |
| [9672](#L9672) | .bpa-front-tmc\_\_head, |
| [9673](#L9673) | .bpa-front-tmc\_\_head p, |
| [9674](#L9674) | .bpa-front-module--add-to-calendar .bpa-fm--atc\_\_heading, |
| [9675](#L9675) | .bpa-front-module--atc-wrapper .bpa-front-btn:hover, |
| [9676](#L9676) | .bpa-front-data-empty-view .bpa-front-dev\_\_title, |
| [9677](#L9677) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-day .vc-day-content, |
| [9678](#L9678) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9679](#L9679) | .bpa-front--dt\_\_calendar .vc-nav-items .vc-nav-item, |
| [9680](#L9680) | .bpa-front-module--note-desc, |
| [9681](#L9681) | .bpa-front--dt\_\_calendar .vc-day.is-today .vc-day-content.is-disabled, |
| [9682](#L9682) | .bpa-front-form-control--checkbox .el-checkbox\_\_label { |
| [9683](#L9683) | color: ' . $content\_color . ' !important; |
| [9684](#L9684) | }'; |
| [9685](#L9685) |  |
| [9686](#L9686) | $bookingpress\_customize\_css\_content .= ' |
| [9687](#L9687) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item .bpa-front-tm--item-icon svg, |
| [9688](#L9688) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si-card\_\_left .bpa-front-si\_\_default-img svg{ |
| [9689](#L9689) | fill: ' . $content\_color . ' !important; |
| [9690](#L9690) | }'; |
| [9691](#L9691) |  |
| [9692](#L9692) | $bookingpress\_customize\_css\_content .= ' |
| [9693](#L9693) | .bpa-front-tabs--foot .bpa-front-btn--primary span, |
| [9694](#L9694) | .bpa-front-tabs--foot .bpa-front-btn--primary strong, |
| [9695](#L9695) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong.--is-service-price, |
| [9696](#L9696) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-day.is-today .vc-highlights + .bpa\_day-select .vc-day-content, |
| [9697](#L9697) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-day .vc-highlights + .vc-day-content{ |
| [9698](#L9698) | color: ' . $price\_button\_text\_content\_color . ' !important; |
| [9699](#L9699) | } |
| [9700](#L9700) | .bpa-front-tabs--foot .bpa-front-btn--primary svg{ |
| [9701](#L9701) | fill: ' . $price\_button\_text\_content\_color . ' !important; |
| [9702](#L9702) | } |
| [9703](#L9703) | .bpa-front--dt\_\_ts-body--item.\_\_bpa-is-selected { |
| [9704](#L9704) | background-color: ' . $primary\_alpha\_color . ' !important; |
| [9705](#L9705) | }'; |
| [9706](#L9706) |  |
| [9707](#L9707) | $bookingpress\_customize\_css\_content .= ' |
| [9708](#L9708) | .bpa-front-module--booking-summary .bpa-front-module--bs-head .bpa-head\_\_vector-item, |
| [9709](#L9709) | .bpa-front-module--confirmation .bpa-head\_\_vector--confirmation .bpa-head\_\_vector-item, |
| [9710](#L9710) | .bpa-front-thankyou-module-container .bpa-front-tmc\_\_head .bpa-front-tmc\_\_vector--confirmation .bpa-head\_\_vector-item { |
| [9711](#L9711) | fill: ' . $primary\_color . ' !important; |
| [9712](#L9712) | }'; |
| [9713](#L9713) | $bookingpress\_customize\_css\_content .= ' |
| [9714](#L9714) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a.bpa-front-tab-menu--item.\_\_bpa-is-active, |
| [9715](#L9715) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details .bpa-front-module--bs-ad--price, |
| [9716](#L9716) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active::before, |
| [9717](#L9717) | .bpa-custom-datepicker .el-year-table td.today .cell, |
| [9718](#L9718) | .bpa-custom-datepicker .el-month-table td.today .cell, |
| [9719](#L9719) | .bpa-front--dt\_\_calendar .vc-day.is-today .vc-day-content, |
| [9720](#L9720) | .bpa-front-form-control--checkbox .el-checkbox\_\_input.is-checked + .el-checkbox\_\_label { |
| [9721](#L9721) | color: ' . $primary\_color . ' !important; |
| [9722](#L9722) | }'; |
| [9723](#L9723) |  |
| [9724](#L9724) | $bookingpress\_customize\_css\_content .= ' |
| [9725](#L9725) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active span, |
| [9726](#L9726) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active .bpa-front-tm--item-icon, |
| [9727](#L9727) | .bpa-front-tabs .bpa-front-tabs--foot .bpa-front-btn--primary:focus { |
| [9728](#L9728) | box-shadow: ' . $box\_shadow\_color . ' !important; |
| [9729](#L9729) | }'; |
| [9730](#L9730) |  |
| [9731](#L9731) | $bookingpress\_customize\_css\_content .= ' |
| [9732](#L9732) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a.\_\_bpa-is-active span { |
| [9733](#L9733) | color: var(--bpa-cl-white) !important; |
| [9734](#L9734) | }'; |
| [9735](#L9735) | $bookingpress\_customize\_css\_content .= ' |
| [9736](#L9736) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a.\_\_bpa-is-active .bpa-front-tm--item-icon svg { |
| [9737](#L9737) | fill: var(--bpa-cl-white) !important; |
| [9738](#L9738) | } |
| [9739](#L9739) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item svg.bpa-front-pm-pay-local-icon{ |
| [9740](#L9740) | fill: ' . $content\_color . ' !important; |
| [9741](#L9741) | }'; |
| [9742](#L9742) |  |
| [9743](#L9743) | $bookingpress\_customize\_css\_content .= ' |
| [9744](#L9744) | @media (min-width: 1200px){ |
| [9745](#L9745) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si\_\_card-body--heading, |
| [9746](#L9746) | .bpa-front-tabs .bpa-front-module-heading, |
| [9747](#L9747) | .bpa-front-tmc\_\_head .bpa-front-tmc\_\_title, |
| [9748](#L9748) | .bpa-front-cancel-module-container .bpa-front-cmc\_\_title, |
| [9749](#L9749) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_label, |
| [9750](#L9750) | .bpa-front-module--add-to-calendar .bpa-fm--atc\_\_heading{ |
| [9751](#L9751) | font-size: ' . $title\_font\_size . ' !important; |
| [9752](#L9752) | } |
| [9753](#L9753) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p, |
| [9754](#L9754) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9755](#L9755) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-head p, |
| [9756](#L9756) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item .bpa-front-bs-sm\_\_item-val, |
| [9757](#L9757) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong, |
| [9758](#L9758) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt-ts\_\_sub-heading, |
| [9759](#L9759) | .bpa-front-module--bs-amount-details .bpa-fm--bs-amount-item .bpa-front-total-payment-amount-label, |
| [9760](#L9760) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details .bpa-front-module--bs-ad--price, |
| [9761](#L9761) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-title, |
| [9762](#L9762) | .bpa-front-refund-confirmation-content .bpa-front-rcc\_\_body .bpa-front-rcc\_\_empty-msg, |
| [9763](#L9763) | .bpa-front-tmc\_\_head p, |
| [9764](#L9764) | .bpa-front-cancel-module-container .bpa-front-cmc\_\_desc { |
| [9765](#L9765) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9766](#L9766) | } |
| [9767](#L9767) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .--bpa-is-desc, |
| [9768](#L9768) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item span, |
| [9769](#L9769) | .bpa-front-tabs .el-form-item\_\_label span, |
| [9770](#L9770) | .bpa-front-tabs .bpa-front-form-control input, |
| [9771](#L9771) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item span, |
| [9772](#L9772) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item p, |
| [9773](#L9773) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a, |
| [9774](#L9774) | .bpa-front-tabs .bpa-front-form-control .el-textarea\_\_inner, |
| [9775](#L9775) | .bpa-front--dt\_\_calendar .vc-day .vc-day-content, |
| [9776](#L9776) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-weeks .vc-weekday, |
| [9777](#L9777) | .bpa-front-tabs--foot .bpa-front-btn, |
| [9778](#L9778) | .bpa-front\_\_no-timeslots-body .bpa-front-ntb\_\_val, |
| [9779](#L9779) | .bpa-front-thankyou-module-container .bpa-front-cc\_\_error-toast-notification, |
| [9780](#L9780) | .bpa-front-form-control--checkbox .el-checkbox\_\_label, { |
| [9781](#L9781) | font-size: ' . $content\_font\_size . ' !important; |
| [9782](#L9782) | } |
| [9783](#L9783) | .--bpa-top.bpa-front-tabs--vertical-left .bpa-front-tab-menu a, |
| [9784](#L9784) | .bpa-front-module--note-desc{ |
| [9785](#L9785) | font-size: 15px !important; |
| [9786](#L9786) | } |
| [9787](#L9787) | } |
| [9788](#L9788) | @media (max-width: 1024px){ |
| [9789](#L9789) | .bpa-front-tabs .bpa-front-module-heading, |
| [9790](#L9790) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-title, |
| [9791](#L9791) | .bpa-front-tmc\_\_head .bpa-front-tmc\_\_title, |
| [9792](#L9792) | .bpa-front-cancel-module-container .bpa-front-cmc\_\_title, |
| [9793](#L9793) | .bpa-front-tmc\_\_booking-id .bpa-front-bi\_\_label, |
| [9794](#L9794) | .bpa-front-module--add-to-calendar .bpa-fm--atc\_\_heading { |
| [9795](#L9795) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9796](#L9796) | } |
| [9797](#L9797) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si\_\_card-body--heading, |
| [9798](#L9798) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt-ts\_\_sub-heading, |
| [9799](#L9799) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-head p, |
| [9800](#L9800) | .bpa-front-module--bs-amount-details .bpa-fm--bs-amount-item .bpa-front-total-payment-amount-label, |
| [9801](#L9801) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details .bpa-front-module--bs-ad--price{ |
| [9802](#L9802) | font-size: 15px !important; |
| [9803](#L9803) | } |
| [9804](#L9804) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a, |
| [9805](#L9805) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9806](#L9806) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .--bpa-is-desc, |
| [9807](#L9807) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p, |
| [9808](#L9808) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong, |
| [9809](#L9809) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item span, |
| [9810](#L9810) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-weeks .vc-weekday, |
| [9811](#L9811) | .bpa-front-tabs .el-form-item\_\_label span, |
| [9812](#L9812) | .bpa-front-tabs .bpa-front-form-control input, |
| [9813](#L9813) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item .bpa-front-bs-sm\_\_item-val, |
| [9814](#L9814) | .bpa-front-tabs--foot .bpa-front-btn |
| [9815](#L9815) | { |
| [9816](#L9816) | font-size: ' . $content\_font\_size . ' !important; |
| [9817](#L9817) | } |
| [9818](#L9818) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item span { |
| [9819](#L9819) | font-size: 13px !important; |
| [9820](#L9820) | } |
| [9821](#L9821) | .bpa-front-module--date-and-time.\_\_sm .bpa-front--dt\_\_ts-sm-back-btn .bpa-front-btn span svg{ |
| [9822](#L9822) | fill: ' . $sub\_title\_color . ' !important; |
| [9823](#L9823) | } |
| [9824](#L9824) | } |
| [9825](#L9825) |  |
| [9826](#L9826) | @media (max-width: 576px){ |
| [9827](#L9827) | .bpa-front-tabs .bpa-front-module-heading{ |
| [9828](#L9828) | font-size: ' . $sub\_title\_font\_size . ' !important; |
| [9829](#L9829) | } |
| [9830](#L9830) | .bpa-front-tabs .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si\_\_card-body--heading, |
| [9831](#L9831) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-weeks .vc-weekday{ |
| [9832](#L9832) | font-size: 15px !important; |
| [9833](#L9833) | } |
| [9834](#L9834) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu a, |
| [9835](#L9835) | .bpa-front-module--category .bpa-front-cat-items .bpa-front-ci-pill.el-tag, |
| [9836](#L9836) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p strong, |
| [9837](#L9837) | .bpa-front-tabs .bpa-front--dt\_\_calendar .vc-title, |
| [9838](#L9838) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt-ts\_\_sub-heading, |
| [9839](#L9839) | .bpa-front-tabs .el-form-item\_\_label span, |
| [9840](#L9840) | .bpa-front-tabs .bpa-front-form-control input, |
| [9841](#L9841) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-head p, |
| [9842](#L9842) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item .bpa-front-bs-sm\_\_item-val, |
| [9843](#L9843) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-summary-content .bpa-front-module--bs-summary-content-item span, |
| [9844](#L9844) | .bpa-front-module--bs-amount-details .bpa-fm--bs-amount-item .bpa-front-total-payment-amount-label, |
| [9845](#L9845) | .bpa-front-tabs .bpa-front-module--booking-summary .bpa-front-module--bs-amount-details .bpa-front-module--bs-ad--price |
| [9846](#L9846) | { |
| [9847](#L9847) | font-size: ' . $content\_font\_size . ' !important; |
| [9848](#L9848) | } |
| [9849](#L9849) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .--bpa-is-desc, |
| [9850](#L9850) | .bpa-front-module--service-item .bpa-front-si-card .bpa-front-si\_\_card-body .bpa-front-si-cb\_\_specs .bpa-front-si-cb\_\_specs-item p, |
| [9851](#L9851) | .bpa-front-tabs .bpa-front--dt\_\_time-slots .bpa-front--dt\_\_ts-body .bpa-front--dt\_\_ts-body--row .bpa-front--dt\_\_ts-body--items .bpa-front--dt\_\_ts-body--item span, |
| [9852](#L9852) | .bpa-front-module--payment-methods .bpa-front-module--pm-body .bpa-front-module--pm-body\_\_item p, |
| [9853](#L9853) | .bpa-front-tabs--foot .bpa-front-btn { |
| [9854](#L9854) | font-size: 13px !important; |
| [9855](#L9855) | } |
| [9856](#L9856) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active span, |
| [9857](#L9857) | .bpa-front-tabs--vertical-left .bpa-front-tab-menu .bpa-front-tab-menu--item.\_\_bpa-is-active .bpa-front-tm--item-icon { |
| [9858](#L9858) | box-shadow: none !important; |
| [9859](#L9859) | }; |
| [9860](#L9860) | }'; |
| [9861](#L9861) | $bookingpress\_customize\_css\_content = apply\_filters('bookingpress\_generate\_booking\_form\_customize\_css',$bookingpress\_customize\_css\_content,$bookingpress\_custom\_data\_arr); |
| [9862](#L9862) |  |
| [9863](#L9863) | if (! function\_exists('WP\_Filesystem') ) { |
| [9864](#L9864) | include\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [9865](#L9865) | } |
| [9866](#L9866) | WP\_Filesystem(); |
| [9867](#L9867) | global $wp\_filesystem; |
| [9868](#L9868) | $wp\_upload\_dir = wp\_upload\_dir(); |
| [9869](#L9869) | $target\_path   = $wp\_upload\_dir['basedir'] . '/bookingpress/bookingpress\_front\_custom\_' . $bookingpress\_customize\_css\_key . '.css'; |
| [9870](#L9870) | $result        = $wp\_filesystem->put\_contents($target\_path, $bookingpress\_customize\_css\_content, 0777); |
| [9871](#L9871) | } else { |
| [9872](#L9872) | do\_action( 'bookingpress\_generate\_exteranl\_css\_outside', $value, $bookingpress\_custom\_data\_arr, $bookingpress\_customize\_css\_key ); |
| [9873](#L9873) | } |
| [9874](#L9874) | } |
| [9875](#L9875) | } |
| [9876](#L9876) | } |
| [9877](#L9877) |  |
| [9878](#L9878) | /\*\* |
| [9879](#L9879) | \* bookingpress\_replace\_appointment\_data |
| [9880](#L9880) | \* This function is used to replace the appointment data |
| [9881](#L9881) | \* @param  mixed $template\_content |
| [9882](#L9882) | \* @param  mixed $bookingpress\_appointment\_data |
| [9883](#L9883) | \* @return void |
| [9884](#L9884) | \*/ |
| [9885](#L9885) | function bookingpress\_replace\_appointment\_data($template\_content,$bookingpress\_appointment\_data) { |
| [9886](#L9886) |  |
| [9887](#L9887) | global $wpdb, $BookingPress, $bookingpress\_spam\_protection,$bookingpress\_global\_options,$tbl\_bookingpress\_categories,$tbl\_bookingpress\_services,$tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_appointment\_bookings; |
| [9888](#L9888) | $global\_data = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9889](#L9889) | $default\_time\_format = $global\_data['wp\_default\_time\_format']; |
| [9890](#L9890) | $default\_date\_format = $global\_data['wp\_default\_date\_format']; |
| [9891](#L9891) |  |
| [9892](#L9892) | /\* replacing the company data \*/ |
| [9893](#L9893) |  |
| [9894](#L9894) | $company\_name    = esc\_html($BookingPress->bookingpress\_get\_settings('company\_name', 'company\_setting')); |
| [9895](#L9895) | $company\_address = esc\_html($BookingPress->bookingpress\_get\_settings('company\_address', 'company\_setting')); |
| [9896](#L9896) | $company\_phone   = esc\_html($BookingPress->bookingpress\_get\_settings('company\_phone\_number', 'company\_setting')); |
| [9897](#L9897) | $company\_website = $BookingPress->bookingpress\_get\_settings('company\_website', 'company\_setting'); |
| [9898](#L9898) |  |
| [9899](#L9899) | $template\_content = str\_replace('%company\_address%', $company\_address, $template\_content); |
| [9900](#L9900) | $template\_content = str\_replace('%company\_name%', $company\_name, $template\_content); |
| [9901](#L9901) | $template\_content = str\_replace('%company\_phone%', $company\_phone, $template\_content); |
| [9902](#L9902) | $template\_content = str\_replace('%company\_website%', $company\_website, $template\_content); |
| [9903](#L9903) |  |
| [9904](#L9904) | /\*\*\*\*\*  replacing the company data \*\*\*\*\*/ |
| [9905](#L9905) |  |
| [9906](#L9906) | if (! empty($bookingpress\_appointment\_data) ) { |
| [9907](#L9907) |  |
| [9908](#L9908) | /\* replacing the appointment data \*/ |
| [9909](#L9909) | $bookingpress\_appointment\_date       = !empty( $bookingpress\_appointment\_data['bookingpress\_appointment\_date'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_appointment\_date'] ) : ''; |
| [9910](#L9910) | $bookingpress\_appointment\_start\_time = !empty( $bookingpress\_appointment\_data['bookingpress\_appointment\_time'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_appointment\_time'] ) : ''; |
| [9911](#L9911) | $bookingpress\_appointment\_end\_time   = !empty( $bookingpress\_appointment\_data['bookingpress\_appointment\_end\_time'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_appointment\_end\_time'] ) : ''; |
| [9912](#L9912) | $bookingpress\_booking\_id   = !empty( $bookingpress\_appointment\_data['bookingpress\_booking\_id'] ) ? sanitize\_text\_field( $bookingpress\_appointment\_data['bookingpress\_booking\_id'] ) : ''; |
| [9913](#L9913) | $bookingpress\_appointment\_date       = date\_i18n($default\_date\_format, strtotime($bookingpress\_appointment\_date)); |
| [9914](#L9914) | $bookingpress\_appointment\_start\_time = date($default\_time\_format, strtotime($bookingpress\_appointment\_start\_time)); |
| [9915](#L9915) | $bookingpress\_appointment\_end\_time   = date($default\_time\_format, strtotime($bookingpress\_appointment\_end\_time)); |
| [9916](#L9916) | $bookingpress\_booking\_id = "#".$bookingpress\_booking\_id; |
| [9917](#L9917) | $template\_content = str\_replace('%booking\_id%', $bookingpress\_booking\_id, $template\_content); |
| [9918](#L9918) | $template\_content = str\_replace('%appointment\_date%', $bookingpress\_appointment\_date, $template\_content); |
| [9919](#L9919) | $template\_content = str\_replace('%appointment\_time%',$bookingpress\_appointment\_start\_time. ' - '.$bookingpress\_appointment\_end\_time,$template\_content); |
| [9920](#L9920) |  |
| [9921](#L9921) | $bookingpress\_appointment\_booking\_id = ! empty($bookingpress\_appointment\_data['bookingpress\_appointment\_booking\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_appointment\_booking\_id']) : ''; |
| [9922](#L9922) |  |
| [9923](#L9923) | $bookingpress\_order\_id = !empty($bookingpress\_appointment\_data['bookingpress\_order\_id']) ? intval( $bookingpress\_appointment\_data['bookingpress\_order\_id']) : ''; |
| [9924](#L9924) |  |
| [9925](#L9925) | if(!empty($bookingpress\_appointment\_data['bookingpress\_is\_cart']) && $bookingpress\_appointment\_data['bookingpress\_is\_cart'] == 1 ){ |
| [9926](#L9926) | $where\_clause\_condition = $wpdb->prepare( 'bookingpress\_order\_id = %d ', $bookingpress\_order\_id ); |
| [9927](#L9927) | } else { |
| [9928](#L9928) | $where\_clause\_condition = $wpdb->prepare( 'bookingpress\_appointment\_booking\_ref = %d ', $bookingpress\_appointment\_booking\_id ); |
| [9929](#L9929) | } |
| [9930](#L9930) |  |
| [9931](#L9931) | $log\_data = array(); |
| [9932](#L9932) | if (!empty($bookingpress\_appointment\_booking\_id) && $bookingpress\_appointment\_booking\_id != 0) { |
| [9933](#L9933) | $log\_data = $wpdb->get\_row( "SELECT bookingpress\_payment\_gateway FROM " . $tbl\_bookingpress\_payment\_logs . " WHERE {$where\_clause\_condition}",ARRAY\_A); // phpcs:ignore |
| [9934](#L9934) | } |
| [9935](#L9935) |  |
| [9936](#L9936) | $bookingpress\_payment\_method = !empty($log\_data['bookingpress\_payment\_gateway']) ? $log\_data['bookingpress\_payment\_gateway'] : ''; |
| [9937](#L9937) | if(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method == 'on-site' ) { |
| [9938](#L9938) | $bookingpress\_payment\_method = $this->bookingpress\_get\_customize\_settings('locally\_text','booking\_form'); |
| [9939](#L9939) | } elseif(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method != 'manual') { |
| [9940](#L9940) | $bookingpress\_payment\_method = $this->bookingpress\_get\_customize\_settings($bookingpress\_payment\_method.'\_text','booking\_form'); |
| [9941](#L9941) | } |
| [9942](#L9942) | $template\_content = str\_replace('%payment\_method%',$bookingpress\_payment\_method,$template\_content); |
| [9943](#L9943) |  |
| [9944](#L9944) | /\*\*\*\* replacing the appointment data \*\*\*\*\*/ |
| [9945](#L9945) |  |
| [9946](#L9946) | /\* replacing the customer data \*/ |
| [9947](#L9947) |  |
| [9948](#L9948) | $bookingpress\_customer\_id       = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_id'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_id'] ) : ''; |
| [9949](#L9949) | $bookingpress\_customer\_email = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_email'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_email'] ) : ''; |
| [9950](#L9950) | $bookingpress\_customer\_firstname   = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_firstname'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_firstname'] ) : ''; |
| [9951](#L9951) | $bookingpress\_customer\_lastname   = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_lastname'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_lastname'] ) : ''; |
| [9952](#L9952) | $bookingpress\_customer\_fullname   = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_name'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_name'] ) : ''; |
| [9953](#L9953) | $bookingpress\_customer\_phone   = !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_phone'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_customer\_phone'] ) : ''; |
| [9954](#L9954) | $bookingpress\_customer\_note   = !empty( $bookingpress\_appointment\_data['bookingpress\_appointment\_internal\_note'] ) ? esc\_html( $bookingpress\_appointment\_data['bookingpress\_appointment\_internal\_note'] ) : ''; |
| [9955](#L9955) |  |
| [9956](#L9956) | if( !empty($bookingpress\_customer\_phone) && !empty( $bookingpress\_appointment\_data['bookingpress\_customer\_phone\_dial\_code'] ) ){ |
| [9957](#L9957) |  |
| [9958](#L9958) | $customer\_phone\_pattern = '/(^\+'.$bookingpress\_appointment\_data['bookingpress\_customer\_phone\_dial\_code'].')/'; |
| [9959](#L9959) | if( preg\_match($customer\_phone\_pattern, $bookingpress\_customer\_phone) ){ |
| [9960](#L9960) | $bookingpress\_customer\_phone = preg\_replace( $customer\_phone\_pattern, '', $bookingpress\_customer\_phone) ; |
| [9961](#L9961) | } |
| [9962](#L9962) | } |
| [9963](#L9963) |  |
| [9964](#L9964) | if(!empty($bookingpress\_appointment\_data['bookingpress\_customer\_phone\_dial\_code'])){ |
| [9965](#L9965) | $bookingpress\_customer\_phone = "+".$bookingpress\_appointment\_data['bookingpress\_customer\_phone\_dial\_code']." ".$bookingpress\_customer\_phone; |
| [9966](#L9966) | } |
| [9967](#L9967) | $template\_content = str\_replace('%customer\_email%', $bookingpress\_customer\_email, $template\_content); |
| [9968](#L9968) | $template\_content = str\_replace('%customer\_first\_name%', $bookingpress\_customer\_firstname, $template\_content); |
| [9969](#L9969) | $template\_content = str\_replace('%customer\_full\_name%', $bookingpress\_customer\_fullname, $template\_content); |
| [9970](#L9970) | $template\_content = str\_replace('%customer\_last\_name%', $bookingpress\_customer\_lastname, $template\_content); |
| [9971](#L9971) | $template\_content = str\_replace('%customer\_phone%', $bookingpress\_customer\_phone, $template\_content); |
| [9972](#L9972) | $template\_content = str\_replace('%customer\_note%', $bookingpress\_customer\_note, $template\_content); |
| [9973](#L9973) |  |
| [9974](#L9974) | $bookingpress\_appointment\_status = !empty($bookingpress\_appointment\_data['bookingpress\_appointment\_status']) ? intval($bookingpress\_appointment\_data['bookingpress\_appointment\_status']) : '' ; |
| [9975](#L9975) | if(!empty($bookingpress\_appointment\_status) && $bookingpress\_appointment\_status != 3 && $bookingpress\_appointment\_status != 4)  { |
| [9976](#L9976) |  |
| [9977](#L9977) | $bpa\_unique\_id = !empty($bookingpress\_appointment\_data['bookingpress\_appointment\_token']) ? $bookingpress\_appointment\_data['bookingpress\_appointment\_token'] : ''; |
| [9978](#L9978) |  |
| [9979](#L9979) | if($bookingpress\_appointment\_booking\_id){ |
| [9980](#L9980) | $bpa\_unique\_id = $wpdb->get\_var($wpdb->prepare("SELECT bookingpress\_appointment\_token FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d", $bookingpress\_appointment\_booking\_id)); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_log\_data is table name defined globally. False Positive alarm |
| [9981](#L9981) | } |
| [9982](#L9982) |  |
| [9983](#L9983) | if(empty($bpa\_unique\_id)) { |
| [9984](#L9984) | $bpa\_unique\_id = $this->bookingpress\_generate\_token(); |
| [9985](#L9985) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings,array('bookingpress\_appointment\_token' => $bpa\_unique\_id),array('bookingpress\_appointment\_booking\_id' => $bookingpress\_appointment\_booking\_id)); |
| [9986](#L9986) | } |
| [9987](#L9987) | $appointment\_cancellation\_confirmation = $BookingPress->bookingpress\_get\_customize\_settings('appointment\_cancellation\_confirmation','booking\_my\_booking'); |
| [9988](#L9988) | if(!empty($appointment\_cancellation\_confirmation)){ |
| [9989](#L9989) | $bookingpress\_appointment\_cancellation\_confirmation\_url = get\_permalink($appointment\_cancellation\_confirmation); |
| [9990](#L9990) | } |
| [9991](#L9991) | $bookingpress\_cancel\_appointment\_link = !empty($bookingpress\_appointment\_cancellation\_confirmation\_url) ? $bookingpress\_appointment\_cancellation\_confirmation\_url :BOOKINGPRESS\_HOME\_URL; |
| [9992](#L9992) | $bookingpress\_cancel\_appointment\_link    = add\_query\_arg('appointment\_id', base64\_encode($bookingpress\_appointment\_data['bookingpress\_appointment\_booking\_id']), $bookingpress\_cancel\_appointment\_link); |
| [9993](#L9993) | $bookingpress\_cancel\_appointment\_link = add\_query\_arg( 'cancel\_token',$bpa\_unique\_id, $bookingpress\_cancel\_appointment\_link ); |
| [9994](#L9994) | $template\_content = str\_replace('%customer\_cancel\_appointment\_link%', $bookingpress\_cancel\_appointment\_link, $template\_content); |
| [9995](#L9995) |  |
| [9996](#L9996) | } |
| [9997](#L9997) |  |
| [9998](#L9998) | /\*\*\*\*\* replacing the customer data \*\*\*\*\*/ |
| [9999](#L9999) |  |
| [10000](#L10000) | /\*  replacing the service data \*/ |
| [10001](#L10001) |  |
| [10002](#L10002) | $bookingpress\_service\_id = !empty( $bookingpress\_appointment\_data['bookingpress\_service\_id'] ) ? intval($bookingpress\_appointment\_data['bookingpress\_service\_id'] ) : '' ; |
| [10003](#L10003) | $bookingpress\_service\_name = !empty($bookingpress\_appointment\_data['bookingpress\_service\_name']) ? esc\_html($bookingpress\_appointment\_data['bookingpress\_service\_name']) : ''; |
| [10004](#L10004) | $bookingpress\_currency = !empty($bookingpress\_appointment\_data['bookingpress\_service\_currency']) ? esc\_html($bookingpress\_appointment\_data['bookingpress\_service\_currency']) : ''; |
| [10005](#L10005) | $bookingpress\_currency\_symbol = $BookingPress->bookingpress\_get\_currency\_symbol($bookingpress\_currency); |
| [10006](#L10006) | $bookingpress\_service\_price = ! empty($bookingpress\_appointment\_data['bookingpress\_service\_price']) ? $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($bookingpress\_appointment\_data['bookingpress\_service\_price'], $bookingpress\_currency\_symbol) : 0; |
| [10007](#L10007) | $bookingpress\_service\_duration = $bookingpress\_appointment\_data['bookingpress\_service\_duration\_val']; |
| [10008](#L10008) | if( 'm' == $bookingpress\_appointment\_data['bookingpress\_service\_duration\_unit'] ){ |
| [10009](#L10009) | $bookingpress\_service\_duration .= ' ' . esc\_html\_\_( 'Mins', 'bookingpress-appointment-booking' ); |
| [10010](#L10010) | } elseif('d' == $bookingpress\_appointment\_data['bookingpress\_service\_duration\_unit']) { |
| [10011](#L10011) | $bookingpress\_service\_duration .= ' ' . esc\_html\_\_( 'Days', 'bookingpress-appointment-booking' ); |
| [10012](#L10012) | } else { |
| [10013](#L10013) | $bookingpress\_service\_duration .= ' ' . esc\_html\_\_( 'Hours', 'bookingpress-appointment-booking' ); |
| [10014](#L10014) | } |
| [10015](#L10015) | $template\_content = str\_replace('%service\_name%', $bookingpress\_service\_name, $template\_content); |
| [10016](#L10016) | $template\_content = str\_replace('%service\_amount%', $bookingpress\_service\_price, $template\_content); |
| [10017](#L10017) | $template\_content = str\_replace('%service\_duration%', $bookingpress\_service\_duration, $template\_content); |
| [10018](#L10018) |  |
| [10019](#L10019) | /\*\*\*\*\* replacing the service data \*\*\*\*\*/ |
| [10020](#L10020) |  |
| [10021](#L10021) | /\*\*\*\*\* replacing the category data \*\*\*\*\*/ |
| [10022](#L10022) | $bookingpress\_category\_name = ''; |
| [10023](#L10023) | if(!empty($bookingpress\_service\_id)) { |
| [10024](#L10024) | $bookingpress\_service\_data= $wpdb->get\_row( $wpdb->prepare ("SELECT bookingpress\_category\_id FROM " . $tbl\_bookingpress\_services." WHERE bookingpress\_service\_id = %d ",$bookingpress\_service\_id), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [10025](#L10025) | $bookingpress\_category\_id = !empty($bookingpress\_service\_data['bookingpress\_category\_id']) ? intval($bookingpress\_service\_data['bookingpress\_category\_id']) : 0; |
| [10026](#L10026) | if($bookingpress\_category\_id == 0 ) { |
| [10027](#L10027) | $bookingpress\_category\_name = esc\_html\_\_('Uncategorized', 'bookingpress-appointment-booking'); |
| [10028](#L10028) | } else { |
| [10029](#L10029) | $categories= $wpdb->get\_row($wpdb->prepare( "SELECT bookingpress\_category\_name FROM " . $tbl\_bookingpress\_categories." WHERE bookingpress\_category\_id = %d",$bookingpress\_category\_id), ARRAY\_A );// phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_categories is table name defined globally. False Positive alarm |
| [10030](#L10030) | $bookingpress\_category\_name = !empty($categories['bookingpress\_category\_name']) ? esc\_html($categories['bookingpress\_category\_name']): ''; |
| [10031](#L10031) | } |
| [10032](#L10032) | } |
| [10033](#L10033) | $template\_content = str\_replace( '%category\_name%', $bookingpress\_category\_name, $template\_content ); |
| [10034](#L10034) |  |
| [10035](#L10035) | /\*\*\*\*\*  replacing the category data \*\*\*\*\*/ |
| [10036](#L10036) |  |
| [10037](#L10037) | $template\_content = apply\_filters('bookingpress\_modify\_email\_content\_filter',$template\_content,$bookingpress\_appointment\_data); |
| [10038](#L10038) |  |
| [10039](#L10039) | } |
| [10040](#L10040) | return $template\_content; |
| [10041](#L10041) | } |
| [10042](#L10042) |  |
| [10043](#L10043) | /\*\* |
| [10044](#L10044) | \* bookingpress\_get\_form\_field\_list |
| [10045](#L10045) | \* This function is used to get form field list. |
| [10046](#L10046) | \* @return void |
| [10047](#L10047) | \*/ |
| [10048](#L10048) | function bookingpress\_get\_form\_field\_list(){ |
| [10049](#L10049) | global $tbl\_bookingpress\_form\_fields,$wpdb; |
| [10050](#L10050) | $bookingpress\_field\_list\_data = $wpdb->get\_results( $wpdb->prepare( 'SELECT bookingpress\_field\_label,bookingpress\_field\_meta\_key,bookingpress\_field\_type FROM ' . $tbl\_bookingpress\_form\_fields . ' WHERE bookingpress\_is\_customer\_field = %d AND bookingpress\_field\_type != %s AND bookingpress\_field\_type != %s AND bookingpress\_field\_type != %s order by bookingpress\_form\_field\_id ASC',0,'2\_col','3\_col','4\_col'), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared --Reason $tbl\_bookingpress\_form\_fields is a table name. false alarm. |
| [10051](#L10051) |  |
| [10052](#L10052) | return $bookingpress\_field\_list\_data; |
| [10053](#L10053) | } |
| [10054](#L10054) |  |
| [10055](#L10055) | /\*\* |
| [10056](#L10056) | \* Function to generate token |
| [10057](#L10057) | \* |
| [10058](#L10058) | \* @param  mixed $special\_chars |
| [10059](#L10059) | \* @param  mixed $extra\_special\_chars |
| [10060](#L10060) | \* @return void |
| [10061](#L10061) | \*/ |
| [10062](#L10062) | function bookingpress\_generate\_token( $special\_chars = true, $extra\_special\_chars = true ){ |
| [10063](#L10063) | $chars = 'abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ0123456789'; |
| [10064](#L10064) | if ( $special\_chars ) { |
| [10065](#L10065) | $chars .= '!@#$%^&\*()'; |
| [10066](#L10066) | } |
| [10067](#L10067) | if ( $extra\_special\_chars ) { |
| [10068](#L10068) | $chars .= '-\_ []{}<>~`+=,.;:/?|'; |
| [10069](#L10069) | } |
| [10070](#L10070) | $ms = round( microtime(true) ); |
| [10071](#L10071) | usleep(100); |
| [10072](#L10072) | $length = 8; |
| [10073](#L10073) | $password = ''; |
| [10074](#L10074) | for ( $i = 0; $i < $length; $i++ ) { |
| [10075](#L10075) | $password .= substr( $chars, wp\_rand( 0, strlen( $chars ) - 1 ), 1 ); |
| [10076](#L10076) | } |
| [10077](#L10077) | $password .= $ms; |
| [10078](#L10078) |  |
| [10079](#L10079) | return base64\_encode( $password ); |
| [10080](#L10080) | } |
| [10081](#L10081) |  |
| [10082](#L10082) | } |
| [10083](#L10083) | } |
| [10084](#L10084) | global $BookingPress,$bookingpress\_debug\_payment\_log\_id; |
| [10085](#L10085) | $BookingPress = new BOOKINGPRESS(); |
| [10086](#L10086) |  |
| [10087](#L10087) | $bookingpress\_debug\_payment\_log\_id = 0; |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php?format=txt)
* [Original Format](/export/3220813/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_4edf9b24_20250111_194741.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Ffrontend%2Fclass.bookingpress_appointment_bookings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3210916 "Revision 3210916")
* Next Revision →
* [Blame](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

---

# [source:](/browser?order=name "Go to repository root") [bookingpress-appointment-booking](/browser/bookingpress-appointment-booking?order=name "View bookingpress-appointment-booking")/[trunk](/browser/bookingpress-appointment-booking/trunk?order=name "View trunk")/[core](/browser/bookingpress-appointment-booking/trunk/core?order=name "View core")/[classes](/browser/bookingpress-appointment-booking/trunk/core/classes?order=name "View classes")/[frontend](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend?order=name "View frontend")/[class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?order=name "View class.bookingpress_appointment_bookings.php")

View diff against:

View revision:

| [Last change](/changeset/3217529/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "View differences") on this file was [3217529](/changeset/3217529/ "View changeset 3217529"), checked in by reputeinfosystems, [5 days ago](/timeline?from=2025-01-06T09%3A23%3A13Z&precision=second "See timeline at 01/06/2025 09:23:13 AM") |
| --- |
| 1.1.25  * Fixed: add new service/appointment model hide behind the admin menu bar on websites hosted on wordpress.com * Other minor bug fixes |
| **File size:** 656.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { exit; } |
| [4](#L4) |  |
| [5](#L5) | if (! class\_exists('bookingpress\_appointment\_bookings')  && class\_exists('BookingPress\_Core')) { |
| [6](#L6) | class bookingpress\_appointment\_bookings Extends BookingPress\_Core |
| [7](#L7) | { |
| [8](#L8) | var $bookingpress\_form\_category; |
| [9](#L9) | var $bookingpress\_form\_service; |
| [10](#L10) | var $bookingpress\_hide\_category\_service; |
| [11](#L11) | var $bookingpress\_default\_date\_format; |
| [12](#L12) | var $bookingpress\_default\_time\_format; |
| [13](#L13) | var $bookingpress\_form\_fields\_error\_msg\_arr; |
| [14](#L14) | var $bookingpress\_form\_fields\_new; |
| [15](#L15) | var $bookingpress\_is\_service\_load\_from\_url; |
| [16](#L16) | var $bookingpress\_selected\_service\_param; |
| [17](#L17) |  |
| [18](#L18) | var $bookingpress\_mybooking\_random\_id; |
| [19](#L19) | var $bookingpress\_mybooking\_default\_date\_format; |
| [20](#L20) | var $bookingpress\_mybooking\_customer\_username; |
| [21](#L21) | var $bookingpress\_mybooking\_customer\_email; |
| [22](#L22) | var $bookingpress\_mybooking\_login\_user\_id; |
| [23](#L23) | var $bookingpress\_mybooking\_wpuser\_id; |
| [24](#L24) | var $bookingpress\_delete\_customer\_profile; |
| [25](#L25) | var $bookingpress\_calendar\_list; |
| [26](#L26) | var $bookingpress\_google\_calendar\_link; |
| [27](#L27) | var $bookingpress\_yahoo\_calendar\_link; |
| [28](#L28) |  |
| [29](#L29) | var $bookingpress\_all\_service\_data; |
| [30](#L30) |  |
| [31](#L31) | function \_\_construct() |
| [32](#L32) | { |
| [33](#L33) | global $BookingPress; |
| [34](#L34) |  |
| [35](#L35) | $this->bookingpress\_form\_category               = 0; |
| [36](#L36) | $this->bookingpress\_form\_service                = 0; |
| [37](#L37) | $this->bookingpress\_hide\_category\_service       = 0; |
| [38](#L38) | $this->bookingpress\_default\_date\_format         = get\_option('date\_format'); |
| [39](#L39) | $this->bookingpress\_default\_time\_format         = get\_option('time\_format'); |
| [40](#L40) | $this->bookingpress\_form\_fields\_error\_msg\_arr   = array(); |
| [41](#L41) | $this->bookingpress\_form\_fields\_new             = array(); |
| [42](#L42) | $this->bookingpress\_is\_service\_load\_from\_url    = 0; |
| [43](#L43) | $this->bookingpress\_calendar\_list               = ''; |
| [44](#L44) | $this->bookingpress\_google\_calendar\_link        = ''; |
| [45](#L45) | $this->bookingpress\_yahoo\_calendar\_link         = ''; |
| [46](#L46) | $this->bookingpress\_mybooking\_customer\_username = ''; |
| [47](#L47) | $this->bookingpress\_mybooking\_customer\_email    = ''; |
| [48](#L48) | $this->bookingpress\_mybooking\_wpuser\_id         = 0; |
| [49](#L49) |  |
| [50](#L50) | $this->bookingpress\_all\_service\_data           = array(); |
| [51](#L51) |  |
| [52](#L52) | add\_filter('bookingpress\_front\_booking\_dynamic\_data\_fields', array( $this, 'bookingpress\_booking\_dynamic\_data\_fields\_func' ), 10, 5); |
| [53](#L53) |  |
| [54](#L54) | add\_filter('bookingpress\_front\_booking\_dynamic\_helper\_vars', array( $this, 'bookingpress\_booking\_dynamic\_helper\_vars\_func' ), 10, 1); |
| [55](#L55) |  |
| [56](#L56) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [57](#L57) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [58](#L58) | add\_filter( 'bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func\_with\_pro')); |
| [59](#L59) | } else { |
| [60](#L60) | add\_filter('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func' ), 10, 1); |
| [61](#L61) | } |
| [62](#L62) | } else { |
| [63](#L63) | add\_filter('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func' ), 10, 1); |
| [64](#L64) | } |
| [65](#L65) | add\_filter( 'bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_call\_autofocus\_method'), 100 ); |
| [66](#L66) |  |
| [67](#L67) | add\_filter('bookingpress\_front\_booking\_dynamic\_vue\_methods', array( $this, 'bookingpress\_booking\_dynamic\_vue\_methods\_func' ), 10, 1); |
| [68](#L68) | add\_action('media\_buttons', array( $this, 'bookingpress\_insert\_shortcode\_button' ), 20); |
| [69](#L69) |  |
| [70](#L70) | add\_shortcode('bookingpress\_form', array( $this, 'bookingpress\_front\_booking\_form' )); |
| [71](#L71) | add\_shortcode('bookingpress\_company\_avatar', array( $this, 'bookingpress\_company\_avatar\_func' )); |
| [72](#L72) | add\_shortcode('bookingpress\_company\_name', array( $this, 'bookingpress\_company\_name\_func' )); |
| [73](#L73) | add\_shortcode('bookingpress\_company\_website', array( $this, 'bookingpress\_company\_website\_func' )); |
| [74](#L74) | add\_shortcode('bookingpress\_company\_address', array( $this, 'bookingpress\_company\_address\_func' )); |
| [75](#L75) | add\_shortcode('bookingpress\_company\_phone', array( $this, 'bookingpress\_company\_phone\_func' )); |
| [76](#L76) | add\_shortcode('bookingpress\_appointment\_service', array( $this, 'bookingpress\_appointment\_service\_func' )); |
| [77](#L77) | add\_shortcode('bookingpress\_appointment\_datetime', array( $this, 'bookingpress\_appointment\_datetime\_func' )); |
| [78](#L78) | add\_shortcode('bookingpress\_appointment\_customername', array( $this, 'bookingpress\_appointment\_customername\_func' )); |
| [79](#L79) | add\_shortcode('bookingpress\_my\_appointments', array( $this, 'bookingpress\_my\_appointments\_func' )); |
| [80](#L80) | add\_shortcode('bookingpress\_delete\_account', array($this, 'bookingpress\_delete\_account\_func')); |
| [81](#L81) | add\_shortcode('booking\_id', array($this, 'bookingpress\_booking\_id\_func')); |
| [82](#L82) | add\_shortcode('bookingpress\_appointment\_cancellation\_confirmation', array($this, 'bookingpress\_appointment\_cancellation\_confirmation\_func')); |
| [83](#L83) |  |
| [84](#L84) | add\_action('wp\_ajax\_bookingpress\_front\_get\_category\_services', array( $this, 'bookingpress\_get\_category\_service\_data' ), 10); |
| [85](#L85) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_get\_category\_services', array( $this, 'bookingpress\_get\_category\_service\_data' ), 10); |
| [86](#L86) |  |
| [87](#L87) | add\_action('wp\_ajax\_bookingpress\_front\_get\_timings', array( $this, 'bookingpress\_retrieve\_timeslots' ), 10); |
| [88](#L88) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_get\_timings', array( $this, 'bookingpress\_retrieve\_timeslots' ), 10); |
| [89](#L89) |  |
| [90](#L90) | add\_action('wp\_ajax\_bookingpress\_front\_save\_appointment\_booking', array( $this, 'bookingpress\_save\_appointment\_booking\_func' ), 10); |
| [91](#L91) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_save\_appointment\_booking', array( $this, 'bookingpress\_save\_appointment\_booking\_func' ), 10); |
| [92](#L92) |  |
| [93](#L93) | add\_action('wp\_ajax\_nopriv\_bookingpress\_validate\_username', array( $this,'validate\_bookingpress\_username'),10); |
| [94](#L94) |  |
| [95](#L95) | /\* add\_action('wp\_ajax\_bookingpress\_before\_book\_appointment', array( $this, 'bookingpress\_before\_book\_appointment\_func' ), 10); |
| [96](#L96) | add\_action('wp\_ajax\_nopriv\_bookingpress\_before\_book\_appointment', array( $this, 'bookingpress\_before\_book\_appointment\_func' ), 10); \*/ |
| [97](#L97) |  |
| [98](#L98) | add\_action('wp\_ajax\_bookingpress\_cancel\_appointment', array( $this, 'bookingpress\_cancel\_appointment' ), 10); |
| [99](#L99) | add\_action('wp', array( $this, 'bookingpress\_cancel\_appointment\_func' ), 10); |
| [100](#L100) |  |
| [101](#L101) | add\_action('wp\_ajax\_bookingpress\_front\_cancel\_appointment', array( $this, 'bookingpress\_front\_cancel\_appointment\_func' ), 10); |
| [102](#L102) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_cancel\_appointment', array( $this, 'bookingpress\_front\_cancel\_appointment\_func' ), 10); |
| [103](#L103) |  |
| [104](#L104) | /\* fornt-end mybooking \*/ |
| [105](#L105) |  |
| [106](#L106) | add\_action('bookingpress\_front\_appointments\_dynamic\_data\_fields', array( $this, 'bookingpress\_front\_appointments\_dynamic\_data\_fields\_func' )); |
| [107](#L107) | add\_action('bookingpress\_front\_appointments\_dynamic\_helper\_vars', array( $this, 'bookingpress\_front\_appointments\_dynamic\_helper\_vars\_func' )); |
| [108](#L108) | add\_action('bookingpress\_front\_appointments\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_front\_appointments\_dynamic\_on\_load\_methods\_func' )); |
| [109](#L109) | add\_action('bookingpress\_front\_appointments\_dynamic\_vue\_methods', array( $this, 'bookingpress\_front\_appointments\_dynamic\_vue\_methods\_func' )); |
| [110](#L110) |  |
| [111](#L111) | add\_action('wp\_ajax\_bookingpress\_get\_customer\_appointments', array( $this, 'bookingpress\_get\_customer\_appointments\_func' ), 10); |
| [112](#L112) |  |
| [113](#L113) | add\_action('wp\_ajax\_bookingpress\_get\_disable\_date', array( $this, 'bookingpress\_get\_disable\_date\_func' ), 10); |
| [114](#L114) | add\_action('wp\_ajax\_nopriv\_bookingpress\_get\_disable\_date', array( $this, 'bookingpress\_get\_disable\_date\_func' ), 10); |
| [115](#L115) |  |
| [116](#L116) | add\_action( 'wp\_ajax\_bookingpress\_fetch\_timeslot\_data', array( $this, 'bookingpress\_retrieve\_timeslot\_data\_callback'), 10 ); |
| [117](#L117) | add\_action( 'wp\_ajax\_nopriv\_bookingpress\_fetch\_timeslot\_data', array( $this, 'bookingpress\_retrieve\_timeslot\_data\_callback'), 10 ); |
| [118](#L118) |  |
| [119](#L119) | add\_action( 'wp\_ajax\_bpa\_set\_timeslot\_token', array( $this, 'bookingpress\_set\_timeslot\_token\_transient') ); |
| [120](#L120) | add\_action( 'wp\_ajax\_nopriv\_bpa\_set\_timeslot\_token', array( $this, 'bookingpress\_set\_timeslot\_token\_transient') ); |
| [121](#L121) |  |
| [122](#L122) | add\_action( 'wp\_ajax\_bookingpress\_retrieve\_entire\_month\_details', array( $this, 'bookingpress\_retrieve\_entire\_month\_data\_callback') ); |
| [123](#L123) | add\_action( 'wp\_ajax\_nopriv\_bookingpress\_retrieve\_entire\_month\_details', array( $this, 'bookingpress\_retrieve\_entire\_month\_data\_callback') ); |
| [124](#L124) |  |
| [125](#L125) |  |
| [126](#L126) | // New action for BG Calls to check disable dates for full day booking |
| [127](#L127) | add\_action('wp\_ajax\_bookingpress\_get\_whole\_day\_appointments', array( $this, 'bookingpress\_get\_whole\_day\_appointments\_func' ), 10); |
| [128](#L128) | add\_action('wp\_ajax\_nopriv\_bookingpress\_get\_whole\_day\_appointments', array( $this, 'bookingpress\_get\_whole\_day\_appointments\_func' ), 10); |
| [129](#L129) |  |
| [130](#L130) | add\_filter( 'bookingpress\_check\_available\_timeslot\_manual\_block', array( $this, 'bookingpress\_check\_available\_timeslot\_manual\_block\_func'), 12, 2); |
| [131](#L131) |  |
| [132](#L132) | /\*\* Calendar Integration Data \*/ |
| [133](#L133) | add\_shortcode( 'bookingpress\_appointment\_calendar\_integration', array( $this, 'bookingpress\_booking\_calendar\_options' ) ); |
| [134](#L134) | add\_action( 'init', array( $this, 'bookingpress\_download\_ics\_file' ) ); |
| [135](#L135) |  |
| [136](#L136) | add\_action('wp\_ajax\_bookingpress\_delete\_account', array($this, 'bookingpress\_delete\_customer\_account\_func')); |
| [137](#L137) |  |
| [138](#L138) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func' )); |
| [139](#L139) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func' )); |
| [140](#L140) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func' )); |
| [141](#L141) |  |
| [142](#L142) | /\*\* Action to set pre-loaded fonts \*/ |
| [143](#L143) | add\_action( 'wp\_head', array( $this, 'bookingpress\_preloaded\_fonts'), 99999 ); |
| [144](#L144) |  |
| [145](#L145) | add\_filter( 'jet-reviews/frontend/deps-scripts', array( $this, 'change\_jet\_review\_deps') ); |
| [146](#L146) |  |
| [147](#L147) | /\* Paypal Payment method added \*/ |
| [148](#L148) | $bookingpress\_pro = $this->bookingpress\_pro\_plugin\_active(); |
| [149](#L149) | if($bookingpress\_pro == 0){ |
| [150](#L150) | add\_filter('bookingpress\_after\_selecting\_payment\_method\_booking\_form',array($this,'bookingpress\_after\_selecting\_payment\_method\_func'),10,1); |
| [151](#L151) | add\_action('bookingpress\_paypal\_payment\_button\_html',array($this,'bookingpress\_paypal\_payment\_button\_html\_func'),10); |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) |  |
| [155](#L155) | add\_action('bookingpress\_add\_frontend\_js', array($this, 'bookingpress\_paypal\_scripts\_add')); |
| [156](#L156) |  |
| [157](#L157) | /\* For Validate Paypal Request & add entries \*/ |
| [158](#L158) | add\_action('wp\_ajax\_bookingpress\_paypal\_booking\_validate\_lite', array($this, 'bookingpress\_paypal\_booking\_validate\_lite\_func'), 10); |
| [159](#L159) | add\_action('wp\_ajax\_nopriv\_bookingpress\_paypal\_booking\_validate\_lite', array($this, 'bookingpress\_paypal\_booking\_validate\_lite\_func'), 10); |
| [160](#L160) |  |
| [161](#L161) | /\* For Book Appointment Paypal Request \*/ |
| [162](#L162) | add\_action('wp\_ajax\_bookingpress\_paypal\_booking\_payment\_confirm\_lite', array($this, 'bookingpress\_paypal\_booking\_payment\_confirm\_lite'), 10); |
| [163](#L163) | add\_action('wp\_ajax\_nopriv\_bookingpress\_paypal\_booking\_payment\_confirm\_lite', array($this, 'bookingpress\_paypal\_booking\_payment\_confirm\_lite'), 10); |
| [164](#L164) |  |
| [165](#L165) | add\_action( 'wp\_ajax\_bookingpress\_update\_elementor\_widgets', array( $this, 'bookingpress\_elementor\_pre\_update\_check') ); |
| [166](#L166) |  |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | function bookingpress\_elementor\_pre\_update\_check(){ |
| [170](#L170) | global $wpdb; |
| [171](#L171) |  |
| [172](#L172) | $fetch\_records = $wpdb->get\_results( $wpdb->prepare( "SELECT post\_id,meta\_value FROM {$wpdb->postmeta} WHERE meta\_key = %s AND meta\_value LIKE '%\"widgetType\":\"Booking Forms - WordPress Booking Plugin\"%' OR meta\_value LIKE '%\"widgetType\":\"Customer Panel - BookingPress Appointment Plugin\"%'", '\_elementor\_data' ) ); //phpcs:ignore |
| [173](#L173) |  |
| [174](#L174) | if( !empty( $fetch\_records ) ){ |
| [175](#L175) | foreach( $fetch\_records as $key => $fetch\_data ){ |
| [176](#L176) | $post\_id = $fetch\_data->post\_id; |
| [177](#L177) |  |
| [178](#L178) | $meta\_value = json\_decode( $fetch\_data->meta\_value, true ); |
| [179](#L179) |  |
| [180](#L180) | $meta\_value\_updated = []; |
| [181](#L181) |  |
| [182](#L182) | foreach( $meta\_value as $meta\_key => $elementor\_metadata ){ |
| [183](#L183) | $elements = $elementor\_metadata['elements']; |
| [184](#L184) |  |
| [185](#L185) | foreach( $elements as $elm\_key => $elm\_data ){ |
| [186](#L186) | if( 'Booking Forms - WordPress Booking Plugin' == $elm\_data['widgetType'] ){ |
| [187](#L187) | $elementor\_metadata['elements'][ $elm\_key ]['widgetType'] = 'bookingpress\_elementor\_form\_widget'; |
| [188](#L188) | } else if( 'Customer Panel - BookingPress Appointment Plugin' == $elm\_data['widgetType'] ){ |
| [189](#L189) | $elementor\_metadata['elements'][ $elm\_key ]['widgetType'] = 'bookingpress\_elementor\_customer\_panel\_widget'; |
| [190](#L190) | } |
| [191](#L191) | } |
| [192](#L192) | $meta\_value\_updated[ $meta\_key ] = $elementor\_metadata; |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | $meta\_value\_updated = wp\_json\_encode( $meta\_value\_updated ); |
| [196](#L196) |  |
| [197](#L197) | update\_post\_meta( $post\_id, '\_elementor\_data', $meta\_value\_updated ); |
| [198](#L198) | delete\_post\_meta( $post\_id, '\_elementor\_element\_cache' ); |
| [199](#L199) | } |
| [200](#L200) | update\_option( 'bookingpress\_update\_elementor\_widget', 2 ); |
| [201](#L201) | } else { |
| [202](#L202) | update\_option( 'bookingpress\_update\_elementor\_widget', 2 ); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | echo wp\_json\_encode( |
| [206](#L206) | array( |
| [207](#L207) | 'type' => 'success', |
| [208](#L208) | 'message' => esc\_html\_\_( 'BookingPress widgets updated successfully!', 'bookingpress-appointment-booking' ) |
| [209](#L209) | ) |
| [210](#L210) | ); |
| [211](#L211) | die; |
| [212](#L212) |  |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) | /\*\* |
| [217](#L217) | \* Paypal payment button html |
| [218](#L218) | \* |
| [219](#L219) | \*/ |
| [220](#L220) | function bookingpress\_paypal\_payment\_button\_html\_func(){ |
| [221](#L221) | ?> |
| [222](#L222) |  |
| [223](#L223) | <el-button v-if="paypal\_button\_loader != 'false'" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--primary bpa-loader-button bpa-front-btn--is-loader"> |
| [224](#L224) | <span class="bpa-btn\_\_label">Test Button</span> |
| [225](#L225) | <div class="bpa-front-btn--loader\_\_circles"> |
| [226](#L226) | <div></div> |
| [227](#L227) | <div></div> |
| [228](#L228) | <div></div> |
| [229](#L229) | </div> |
| [230](#L230) | </el-button> |
| [231](#L231) | <div v-if="paypal\_button\_loader != 'true'" id="paypal-button-container"></div> |
| [232](#L232) | <?php |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) |  |
| [236](#L236) | public function validate\_paypal\_order($order\_id){ |
| [237](#L237) | global $BookingPress; |
| [238](#L238) |  |
| [239](#L239) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [240](#L240) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [241](#L241) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [242](#L242) |  |
| [243](#L243) | $paypalAuthAPI = 'https://api-m.paypal.com/v1/oauth2/token'; |
| [244](#L244) | $paypalAPI = 'https://api-m.paypal.com/v2/checkout'; |
| [245](#L245) |  |
| [246](#L246) | $Sandbox = ($bookingpress\_payment\_mode == "sandbox")?true:false; |
| [247](#L247) | $paypalClientID = $paypal\_client\_id; |
| [248](#L248) | $paypalSecret = $paypal\_client\_secret; |
| [249](#L249) |  |
| [250](#L250) | if ($Sandbox) { |
| [251](#L251) | $paypalAuthAPI = 'https://api-m.sandbox.paypal.com/v1/oauth2/token'; |
| [252](#L252) | $paypalAPI = 'https://api-m.sandbox.paypal.com/v2/checkout'; |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | $request\_args = array( |
| [256](#L256) | 'headers'     => array( |
| [257](#L257) | 'Authorization' => 'Basic ' . base64\_encode($paypalClientID . ':' . $paypalSecret), |
| [258](#L258) | ), |
| [259](#L259) | 'body'        => array( |
| [260](#L260) | 'grant\_type' => 'client\_credentials', |
| [261](#L261) | ), |
| [262](#L262) | ); |
| [263](#L263) |  |
| [264](#L264) | $response = wp\_remote\_post($paypalAuthAPI, $request\_args); |
| [265](#L265) |  |
| [266](#L266) | if (is\_wp\_error($response)) { |
| [267](#L267) | throw new Exception('Error ' . $response->get\_error\_code() . ': ' . $response->get\_error\_message()); // phpcs:ignore |
| [268](#L268) | } |
| [269](#L269) |  |
| [270](#L270) | $auth\_response = json\_decode(wp\_remote\_retrieve\_body($response)); |
| [271](#L271) |  |
| [272](#L272) | if (empty($auth\_response)) { |
| [273](#L273) | return false; |
| [274](#L274) | } else { |
| [275](#L275) | if (!empty($auth\_response->access\_token)) { |
| [276](#L276) | $request\_args = array( |
| [277](#L277) | 'headers'     => array( |
| [278](#L278) | 'Authorization' => 'Bearer ' . $auth\_response->access\_token, |
| [279](#L279) | ), |
| [280](#L280) | ); |
| [281](#L281) |  |
| [282](#L282) | $response = wp\_remote\_get($paypalAPI . '/orders/' . $order\_id, $request\_args); |
| [283](#L283) |  |
| [284](#L284) | if (is\_wp\_error($response)) { |
| [285](#L285) | throw new Exception('Error ' . $response->get\_error\_code() . ': ' . $response->get\_error\_message()); // phpcs:ignore |
| [286](#L286) | } |
| [287](#L287) |  |
| [288](#L288) | $api\_data = json\_decode(wp\_remote\_retrieve\_body($response), true); |
| [289](#L289) |  |
| [290](#L290) | if (!empty($api\_data['error'])) { |
| [291](#L291) | throw new Exception('Error ' . $api\_data['error'] . ': ' . $api\_data['error\_description']); // phpcs:ignore |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | return !empty($api\_data) ? $api\_data : false; |
| [295](#L295) | } else { |
| [296](#L296) | return false; |
| [297](#L297) | } |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | } |
| [301](#L301) |  |
| [302](#L302) | function bookingpress\_paypal\_booking\_payment\_confirm\_lite(){ |
| [303](#L303) |  |
| [304](#L304) | global  $BookingPress,$bookingpress\_debug\_payment\_log\_id,$bookingpress\_payment\_gateways; |
| [305](#L305) | $wpnonce               = isset( $\_POST['\_wpnonce'] ) ? sanitize\_text\_field( $\_POST['\_wpnonce'] ) : ''; |
| [306](#L306) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce( $wpnonce, 'bpa\_wp\_nonce' ); |
| [307](#L307) | $response              = array(); |
| [308](#L308) |  |
| [309](#L309) | $response['variant'] = 'error'; |
| [310](#L310) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [311](#L311) | $response['msg']     = esc\_html\_\_( 'Sorry, payment is not successed with the paypal.', 'bookingpress-appointment-booking' ); |
| [312](#L312) |  |
| [313](#L313) | $bookingpress\_payment\_res = (isset($\_POST['bookingpress\_payment\_res'])) ? $\_POST['bookingpress\_payment\_res'] : ''; // phpcs:ignore |
| [314](#L314) | do\_action( 'bookingpress\_payment\_log\_entry', 'paypal', 'payment popup response data', 'bookingpress pro', $\_POST, $bookingpress\_debug\_payment\_log\_id ); |
| [315](#L315) | if ( ! $bpa\_verify\_nonce\_flag ) { |
| [316](#L316) | $response['variant'] = 'error'; |
| [317](#L317) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [318](#L318) | $response['msg']     = esc\_html\_\_( 'Sorry, Your request can not process due to security reason.', 'bookingpress-appointment-booking' ); |
| [319](#L319) | wp\_send\_json( $response ); |
| [320](#L320) | die(); |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [324](#L324) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [325](#L325) |  |
| [326](#L326) | if (empty($paypal\_client\_id) ) { |
| [327](#L327) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal Client ID', 'bookingpress-appointment-booking'); |
| [328](#L328) | $response['variant']       = 'error'; |
| [329](#L329) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [330](#L330) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [331](#L331) | $response['is\_redirect']   = 0; |
| [332](#L332) | $response['redirect\_data'] = ''; |
| [333](#L333) | $response['is\_spam']       = 0; |
| [334](#L334) | echo wp\_json\_encode($response); |
| [335](#L335) | exit; |
| [336](#L336) | } |
| [337](#L337) | if (empty($paypal\_client\_secret) ) { |
| [338](#L338) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please Configure PayPal Client Secret', 'bookingpress-appointment-booking'); |
| [339](#L339) | $response['variant']       = 'error'; |
| [340](#L340) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [341](#L341) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [342](#L342) | $response['is\_redirect']   = 0; |
| [343](#L343) | $response['redirect\_data'] = ''; |
| [344](#L344) | $response['is\_spam']       = 0; |
| [345](#L345) | echo wp\_json\_encode($response); |
| [346](#L346) | exit; |
| [347](#L347) | } |
| [348](#L348) |  |
| [349](#L349) | $order\_id = (isset($bookingpress\_payment\_res['id']))?$bookingpress\_payment\_res['id']:''; |
| [350](#L350) | $order = ""; |
| [351](#L351) | if(!empty($order\_id)){ |
| [352](#L352) | try { |
| [353](#L353) | $order = $this->validate\_paypal\_order($order\_id); |
| [354](#L354) | } catch(Exception $e) { |
| [355](#L355) | $api\_error = $e->getMessage(); |
| [356](#L356) | $response['variant'] = 'error'; |
| [357](#L357) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [358](#L358) | $response['msg']     = $api\_error; |
| [359](#L359) | wp\_send\_json( $response ); |
| [360](#L360) | die(); |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | $reference\_id = (isset($order['purchase\_units'][0]['reference\_id']))?$order['purchase\_units'][0]['reference\_id']:''; |
| [364](#L364) | $order\_status = (isset($order['status']))?$order['status']:''; |
| [365](#L365) | $transaction\_id  =  (isset($order['purchase\_units'][0]['payments']['captures'][0]['id']))?$order['purchase\_units'][0]['payments']['captures'][0]['id']:''; |
| [366](#L366) | $payment\_status = (isset($order['purchase\_units'][0]['payments']['captures'][0]['status']))?$order['purchase\_units'][0]['payments']['captures'][0]['status']:''; |
| [367](#L367) | $amount = (isset($order['purchase\_units'][0]['amount']['value']))?$order['purchase\_units'][0]['amount']['value']:''; |
| [368](#L368) | $currency\_code = (isset($order['purchase\_units'][0]['amount']['currency\_code']))?$order['purchase\_units'][0]['amount']['currency\_code']:''; |
| [369](#L369) |  |
| [370](#L370) | if(!empty($reference\_id)){ |
| [371](#L371) |  |
| [372](#L372) | $entry\_id = $reference\_id; |
| [373](#L373) | if(!empty($order\_id) && $order\_status == 'COMPLETED' && !empty($entry\_id)){ |
| [374](#L374) |  |
| [375](#L375) | $bookingpress\_webhook\_data = array(); |
| [376](#L376) | $payer\_email = (isset($order['payer']['email\_address']))?$order['payer']['email\_address']:''; |
| [377](#L377) | $bookingpress\_webhook\_data['bookingpress\_payer\_email'] = $payer\_email; |
| [378](#L378) | $bookingpress\_webhook\_data['txn\_id'] = $transaction\_id; |
| [379](#L379) | $bookingpress\_webhook\_data['mc\_gross'] = $amount; |
| [380](#L380) | $bookingpress\_webhook\_data['mc\_currency'] = $currency\_code; |
| [381](#L381) | $bookingpress\_webhook\_data['amount'] = $amount; |
| [382](#L382) | $bookingpress\_webhook\_data['currency'] = $currency\_code; |
| [383](#L383) | $payment\_add\_status = '1'; |
| [384](#L384) | if($payment\_status == "PENDING"){ |
| [385](#L385) | $payment\_add\_status = '2'; |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | $payment\_log\_id = $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, $bookingpress\_webhook\_data, $payment\_add\_status, 'txn\_id', '', 1); |
| [389](#L389) | $response['variant'] = 'success'; |
| [390](#L390) | $response['title']   = esc\_html\_\_( 'Success', 'bookingpress-appointment-booking' ); |
| [391](#L391) | $response['msg']     = esc\_html\_\_( 'Appointment succesfully created.', 'bookingpress-appointment-booking' ); |
| [392](#L392) |  |
| [393](#L393) | wp\_send\_json( $response ); |
| [394](#L394) | die(); |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | } |
| [398](#L398) |  |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | echo wp\_json\_encode($response); |
| [403](#L403) | die; |
| [404](#L404) |  |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | /\*\* |
| [408](#L408) | \* Add for create paypal entries |
| [409](#L409) | \* |
| [410](#L410) | \*/ |
| [411](#L411) | function bookingpress\_paypal\_booking\_validate\_lite\_func(){ |
| [412](#L412) |  |
| [413](#L413) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customer\_bookings, $tbl\_bookingpress\_customers, $bookingpress\_payment\_gateways, $bookingpress\_debug\_payment\_log\_id; |
| [414](#L414) | $wpnonce               = isset( $\_POST['\_wpnonce'] ) ? sanitize\_text\_field( $\_POST['\_wpnonce'] ) : ''; |
| [415](#L415) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce( $wpnonce, 'bpa\_wp\_nonce' ); |
| [416](#L416) | $response              = array(); |
| [417](#L417) |  |
| [418](#L418) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [419](#L419) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [420](#L420) | if (! $bpa\_verify\_nonce\_flag ) { |
| [421](#L421) | $response['variant'] = 'error'; |
| [422](#L422) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [423](#L423) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [424](#L424) | wp\_send\_json($response); |
| [425](#L425) | die(); |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [429](#L429) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [430](#L430) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [431](#L431) |  |
| [432](#L432) | if (empty($paypal\_client\_id) ) { |
| [433](#L433) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal Client ID', 'bookingpress-appointment-booking'); |
| [434](#L434) | $response['variant']       = 'error'; |
| [435](#L435) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [436](#L436) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [437](#L437) | $response['is\_redirect']   = 0; |
| [438](#L438) | $response['redirect\_data'] = ''; |
| [439](#L439) | $response['is\_spam']       = 0; |
| [440](#L440) | echo wp\_json\_encode($response); |
| [441](#L441) | exit; |
| [442](#L442) | } |
| [443](#L443) | if (empty($paypal\_client\_secret) ) { |
| [444](#L444) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please Configure PayPal Client Secret', 'bookingpress-appointment-booking'); |
| [445](#L445) | $response['variant']       = 'error'; |
| [446](#L446) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [447](#L447) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [448](#L448) | $response['is\_redirect']   = 0; |
| [449](#L449) | $response['redirect\_data'] = ''; |
| [450](#L450) | $response['is\_spam']       = 0; |
| [451](#L451) | echo wp\_json\_encode($response); |
| [452](#L452) | exit; |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | $response['variant']       = 'error'; |
| [456](#L456) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [457](#L457) | $response['msg']           = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [458](#L458) | $response['is\_redirect']   = 0; |
| [459](#L459) | $response['redirect\_data'] = ''; |
| [460](#L460) | $response['is\_spam']       = 1; |
| [461](#L461) |  |
| [462](#L462) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [463](#L463) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [464](#L464) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [465](#L465) | } |
| [466](#L466) |  |
| [467](#L467) | $response = apply\_filters('bookingpress\_validate\_spam\_protection', $response, array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data'])); // phpcs:ignore |
| [468](#L468) |  |
| [469](#L469) | $booking\_response = $this->bookingpress\_before\_book\_appointment\_func(); |
| [470](#L470) |  |
| [471](#L471) | if( !empty( $booking\_response ) ){ |
| [472](#L472) | $booking\_response\_arr = json\_decode( $booking\_response, true ); |
| [473](#L473) | if( !empty( $booking\_response\_arr['variant'] ) && 'error' == $booking\_response\_arr['variant'] ){ |
| [474](#L474) | if(!empty($booking\_response\_arr['msg'])) { |
| [475](#L475) | $booking\_response\_arr['msg'] = stripslashes\_deep(html\_entity\_decode($booking\_response\_arr['msg'],ENT\_QUOTES)); |
| [476](#L476) | } |
| [477](#L477) | wp\_send\_json($booking\_response\_arr); |
| [478](#L478) | die; |
| [479](#L479) | } |
| [480](#L480) | } |
| [481](#L481) |  |
| [482](#L482) | $appointment\_booked\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_booked\_successfully', 'message\_setting'); |
| [483](#L483) |  |
| [484](#L484) | if (! empty($\_REQUEST) && ! empty($\_REQUEST['appointment\_data']) ) { |
| [485](#L485) |  |
| [486](#L486) | $bookingpress\_appointment\_data            = array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_data'] contains mixed array and sanitized properly using 'appointment\_sanatize\_field' function |
| [487](#L487) | $bookingpress\_payment\_gateway             = ! empty($bookingpress\_appointment\_data['selected\_payment\_method']) ? $bookingpress\_appointment\_data['selected\_payment\_method'] : ''; |
| [488](#L488) | $bookingpress\_appointment\_on\_site\_enabled = ( $bookingpress\_appointment\_data['selected\_payment\_method'] == 'onsite' ) ? 1 : 0; |
| [489](#L489) | $payment\_gateway                          = ( $bookingpress\_appointment\_on\_site\_enabled ) ? 'on-site' : $bookingpress\_payment\_gateway; |
| [490](#L490) |  |
| [491](#L491) | $bookingpress\_service\_price = isset($bookingpress\_appointment\_data['service\_price\_without\_currency']) ? floatval($bookingpress\_appointment\_data['service\_price\_without\_currency']) : 0; |
| [492](#L492) | if ($bookingpress\_service\_price == 0 ) { |
| [493](#L493) | $payment\_gateway = ' - '; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | $bpa\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [497](#L497) |  |
| [498](#L498) | $bpa\_service\_data               = $BookingPress->get\_service\_by\_id( $bpa\_selected\_service ); |
| [499](#L499) | $bpa\_service\_amount             = ! empty($bpa\_service\_data['bookingpress\_service\_price']) ? (float) $bpa\_service\_data['bookingpress\_service\_price'] : 0; |
| [500](#L500) |  |
| [501](#L501) | if( $bpa\_service\_amount != $bookingpress\_service\_price ){ |
| [502](#L502) | $bookingpress\_invalid\_amount = esc\_html\_\_('Sorry! Appointment could not be processed', 'bookingpress-appointment-booking'); |
| [503](#L503) |  |
| [504](#L504) | $response['variant']       = 'error'; |
| [505](#L505) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [506](#L506) | $response['msg']           = $bookingpress\_invalid\_amount; |
| [507](#L507) | $response['is\_redirect']   = 0; |
| [508](#L508) | $response['reason']        = 'price mismatched ' . $bpa\_service\_amount . ' --- ' . $bookingpress\_service\_price; |
| [509](#L509) | $response['redirect\_data'] = ''; |
| [510](#L510) | $response['is\_spam']       = 0; |
| [511](#L511) |  |
| [512](#L512) | echo wp\_json\_encode($response); |
| [513](#L513) | exit; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | $bookingpress\_return\_data = apply\_filters('bookingpress\_validate\_submitted\_form', $payment\_gateway, $bookingpress\_appointment\_data); |
| [517](#L517) |  |
| [518](#L518) | $bookingpress\_service\_name = ! empty( $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] ) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_( 'Appointment Booking', 'bookingpress-appointment-booking' ); |
| [519](#L519) |  |
| [520](#L520) | if ($bookingpress\_service\_price == 0 ) { |
| [521](#L521) | $response['variant']       = 'error'; |
| [522](#L522) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [523](#L523) | $response['msg']           = esc\_html\_\_('Service price must be more then 0 for paypal.', 'bookingpress-appointment-booking'); |
| [524](#L524) | $response['is\_redirect']   = 0; |
| [525](#L525) | $response['reason']        = 'price 0'; |
| [526](#L526) | $response['redirect\_data'] = ''; |
| [527](#L527) | $response['is\_spam']       = 0; |
| [528](#L528) | echo wp\_json\_encode($response); |
| [529](#L529) | exit; |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | $entry\_id = ! empty( $bookingpress\_return\_data['entry\_id'] ) ? $bookingpress\_return\_data['entry\_id'] : ''; |
| [533](#L533) |  |
| [534](#L534) | if(!empty($entry\_id)){ |
| [535](#L535) |  |
| [536](#L536) | $order\_id = ""; |
| [537](#L537) | $currency                          = $bookingpress\_return\_data['currency']; |
| [538](#L538) | $currency\_symbol                   = $BookingPress->bookingpress\_get\_currency\_code($currency); |
| [539](#L539) | $bookingpress\_final\_payable\_amount = isset($bookingpress\_return\_data['payable\_amount']) ? $bookingpress\_return\_data['payable\_amount'] : 0; |
| [540](#L540) | $customer\_details                  = $bookingpress\_return\_data['customer\_details']; |
| [541](#L541) | $customer\_email                    = ! empty($customer\_details['customer\_email']) ? $customer\_details['customer\_email'] : ''; |
| [542](#L542) |  |
| [543](#L543) | $bookingpress\_service\_name = ! empty($bookingpress\_return\_data['service\_data']['bookingpress\_service\_name']) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_('Appointment Booking', 'bookingpress-appointment-booking'); |
| [544](#L544) |  |
| [545](#L545) | $custom\_var = $entry\_id; |
| [546](#L546) |  |
| [547](#L547) |  |
| [548](#L548) |  |
| [549](#L549) | $Sandbox = ($bookingpress\_payment\_mode == "sandbox")?true:false; |
| [550](#L550) | $paypalClientID = $paypal\_client\_id; |
| [551](#L551) | $paypalSecret = $paypal\_client\_secret; |
| [552](#L552) |  |
| [553](#L553) | $token\_url = 'https://api-m.paypal.com/v1/oauth2/token'; |
| [554](#L554) | $api\_url = 'https://api-m.paypal.com/v2/checkout/orders'; |
| [555](#L555) | if ($Sandbox) { |
| [556](#L556) | $token\_url = 'https://api-m.sandbox.paypal.com/v1/oauth2/token'; |
| [557](#L557) | $api\_url = 'https://api-m.sandbox.paypal.com/v2/checkout/orders'; |
| [558](#L558) | } |
| [559](#L559) | $request\_args = array( |
| [560](#L560) | 'headers'     => array( |
| [561](#L561) | 'Authorization' => 'Basic ' . base64\_encode($paypalClientID . ':' . $paypalSecret), |
| [562](#L562) | ), |
| [563](#L563) | 'body'        => array( |
| [564](#L564) | 'grant\_type' => 'client\_credentials', |
| [565](#L565) | ), |
| [566](#L566) | ); |
| [567](#L567) | $response\_return = wp\_remote\_post($token\_url, $request\_args); |
| [568](#L568) | if (is\_wp\_error($response\_return)) { |
| [569](#L569) | $error = $response\_return->get\_error\_code() . ': ' . $response\_return->get\_error\_message(); |
| [570](#L570) | $response['variant'] = 'error'; |
| [571](#L571) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [572](#L572) | $response['msg']     = $error; |
| [573](#L573) | wp\_send\_json( $response ); |
| [574](#L574) | die(); |
| [575](#L575) | } |
| [576](#L576) |  |
| [577](#L577) | $auth\_response = json\_decode(wp\_remote\_retrieve\_body($response\_return)); |
| [578](#L578) |  |
| [579](#L579) | if(isset($auth\_response->error\_description) && isset($auth\_response->error)){ |
| [580](#L580) | $response['variant'] = 'error'; |
| [581](#L581) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [582](#L582) | $response['msg']     = $auth\_response->error.' '.$auth\_response->error\_description; |
| [583](#L583) | echo wp\_json\_encode( $response ); |
| [584](#L584) | die(); |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | if (empty($auth\_response)) { |
| [588](#L588) | wp\_send\_json( $response ); |
| [589](#L589) | die(); |
| [590](#L590) | } else { |
| [591](#L591) | if (!empty($auth\_response->access\_token)) { |
| [592](#L592) | $headers = array( |
| [593](#L593) | 'Content-Type' => 'application/json', |
| [594](#L594) | 'Authorization' => 'Bearer ' . $auth\_response->access\_token, |
| [595](#L595) | ); |
| [596](#L596) | $body = array( |
| [597](#L597) | 'intent' => 'CAPTURE', |
| [598](#L598) | 'purchase\_units' => array( |
| [599](#L599) | array( |
| [600](#L600) | 'reference\_id'=> $custom\_var, |
| [601](#L601) | 'description' => $bookingpress\_service\_name, |
| [602](#L602) | 'amount' => array( |
| [603](#L603) | 'currency\_code' => ''.$currency\_symbol, |
| [604](#L604) | 'value' => $bookingpress\_final\_payable\_amount, |
| [605](#L605) | ), |
| [606](#L606) | ), |
| [607](#L607) | ), |
| [608](#L608) | ); |
| [609](#L609) |  |
| [610](#L610) |  |
| [611](#L611) | $response\_return = wp\_remote\_post( |
| [612](#L612) | $api\_url, |
| [613](#L613) | array( |
| [614](#L614) | 'method' => 'POST', |
| [615](#L615) | 'headers' => $headers, |
| [616](#L616) | 'body' => wp\_json\_encode($body), |
| [617](#L617) | ) |
| [618](#L618) | ); |
| [619](#L619) |  |
| [620](#L620) |  |
| [621](#L621) | if (is\_wp\_error($response\_return)) { |
| [622](#L622) | $error\_message = $response\_return->get\_error\_message(); |
| [623](#L623) | $response['variant'] = 'error'; |
| [624](#L624) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [625](#L625) | $response['msg']     = "Something went wrong:"; |
| [626](#L626) | wp\_send\_json( $response ); |
| [627](#L627) | die(); |
| [628](#L628) |  |
| [629](#L629) | } else { |
| [630](#L630) | $response\_body = wp\_remote\_retrieve\_body($response\_return); |
| [631](#L631) | $order\_data = json\_decode($response\_body, true); |
| [632](#L632) | $order\_id = (isset($order\_data['id']))?$order\_data['id']:''; |
| [633](#L633) | } |
| [634](#L634) | } |
| [635](#L635) | } |
| [636](#L636) | if(!empty($order\_id)){ |
| [637](#L637) |  |
| [638](#L638) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [639](#L639) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [640](#L640) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [641](#L641) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [642](#L642) | } |
| [643](#L643) |  |
| [644](#L644) | $bookingpress\_paypal\_cancel\_url\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_failed\_payment\_redirection', 'booking\_form'); |
| [645](#L645) | $bookingpress\_paypal\_cancel\_url = get\_permalink($bookingpress\_paypal\_cancel\_url\_id); |
| [646](#L646) | $cancel\_url                     = ! empty($bookingpress\_paypal\_cancel\_url) ? $bookingpress\_paypal\_cancel\_url : BOOKINGPRESS\_HOME\_URL; |
| [647](#L647) | $cancel\_url                     = add\_query\_arg('is\_cancel', 1, esc\_url($cancel\_url)); |
| [648](#L648) | $booking\_form\_redirection\_mode = 'external\_redirection'; |
| [649](#L649) |  |
| [650](#L650) | $response['variant'] = 'success'; |
| [651](#L651) | $response['title']   = esc\_html\_\_( 'Success', 'bookingpress-appointment-booking' ); |
| [652](#L652) | $response['msg']     = esc\_html\_\_( 'Appointment succesfully created.', 'bookingpress-appointment-booking' ); |
| [653](#L653) | $response['order\_id']  = $order\_id; |
| [654](#L654) | $response['paypal\_success\_url']  = $redirect\_url; |
| [655](#L655) | $response['paypal\_cancel\_url']  = $cancel\_url; |
| [656](#L656) | $response['paypal\_booking\_form\_redirection\_mode']  = $booking\_form\_redirection\_mode; |
| [657](#L657) |  |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | }else{ |
| [661](#L661) |  |
| [662](#L662) | $response['variant']       = 'error'; |
| [663](#L663) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [664](#L664) | $response['msg']           = esc\_html\_\_('Something Wrong', 'bookingpress-appointment-booking'); |
| [665](#L665) | $response['is\_redirect']   = 0; |
| [666](#L666) | $response['reason']        = 'price 0'; |
| [667](#L667) | $response['redirect\_data'] = ''; |
| [668](#L668) | $response['is\_spam']       = 0; |
| [669](#L669) | echo wp\_json\_encode($response); |
| [670](#L670) | exit; |
| [671](#L671) | } |
| [672](#L672) | } |
| [673](#L673) |  |
| [674](#L674) | wp\_send\_json( $response ); |
| [675](#L675) | die(); |
| [676](#L676) |  |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | function bookingpress\_paypal\_scripts\_add(){ |
| [680](#L680) | global $BookingPress; |
| [681](#L681) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment', 'payment\_setting' ); |
| [682](#L682) | $paypal\_payment\_method\_type = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment\_method\_type', 'payment\_setting' ); |
| [683](#L683) | if($paypal\_payment\_method\_type == 'popup' && $paypal\_payment == true){ |
| [684](#L684) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [685](#L685) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [686](#L686) | $bookingpress\_currency\_name   = $BookingPress->bookingpress\_get\_settings( 'payment\_default\_currency', 'payment\_setting' ); |
| [687](#L687) | $bookingpress\_currency\_code = $BookingPress->bookingpress\_get\_currency\_code( $bookingpress\_currency\_name ); |
| [688](#L688) |  |
| [689](#L689) | if(!empty($paypal\_client\_id) && !empty($paypal\_client\_secret)){ |
| [690](#L690) | wp\_enqueue\_script( 'bookingpress-paypal-script', 'https://www.paypal.com/sdk/js?client-id='.$paypal\_client\_id.'&currency='.$bookingpress\_currency\_code.'&disable-funding=credit,card', array(), null, true ); |
| [691](#L691) | } |
| [692](#L692) | } |
| [693](#L693) | } |
| [694](#L694) |  |
| [695](#L695) |  |
| [696](#L696) |  |
| [697](#L697) | /\*\* |
| [698](#L698) | \* After selection payment method paypal script added |
| [699](#L699) | \* |
| [700](#L700) | \*/ |
| [701](#L701) | function bookingpress\_after\_selecting\_payment\_method\_func($bookingpress\_after\_selecting\_payment\_method\_data){ |
| [702](#L702) | global $BookingPress; |
| [703](#L703) |  |
| [704](#L704) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment', 'payment\_setting' ); |
| [705](#L705) | if($paypal\_payment == true){ |
| [706](#L706) |  |
| [707](#L707) | $paypal\_payment\_method\_type = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment\_method\_type', 'payment\_setting' ); |
| [708](#L708) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [709](#L709) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [710](#L710) |  |
| [711](#L711) | if($paypal\_payment\_method\_type == 'popup'){ |
| [712](#L712) |  |
| [713](#L713) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [714](#L714) | var vm7 = this; |
| [715](#L715) | if(payment\_method == "paypal"){ |
| [716](#L716) | vm7.show\_paypal\_popup\_button = "true"; |
| [717](#L717) | }else{ |
| [718](#L718) | vm7.show\_paypal\_popup\_button = "false"; |
| [719](#L719) | } |
| [720](#L720) | '; |
| [721](#L721) |  |
| [722](#L722) | if(empty($paypal\_client\_id)){ |
| [723](#L723) | $client\_id\_error = esc\_html\_\_( 'Client ID is required.', 'bookingpress-appointment-booking' ); |
| [724](#L724) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [725](#L725) | window.app.bookingpress\_set\_error\_msg("'.$client\_id\_error.'"); |
| [726](#L726) | '; |
| [727](#L727) | }else if(empty($paypal\_client\_secret)){ |
| [728](#L728) | $client\_secret\_error = esc\_html\_\_( 'Client secret is required.', 'bookingpress-appointment-booking' ); |
| [729](#L729) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [730](#L730) | window.app.bookingpress\_set\_error\_msg("'.$client\_secret\_error.'"); |
| [731](#L731) | '; |
| [732](#L732) | }else{ |
| [733](#L733) |  |
| [734](#L734) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [735](#L735) | if(payment\_method == "paypal"){ |
| [736](#L736) | document.getElementById("paypal-button-container").innerHTML = ""; |
| [737](#L737) | paypal.Buttons({ |
| [738](#L738) | async createOrder(data, actions) { |
| [739](#L739) | var vm2 = this; |
| [740](#L740) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [741](#L741) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [742](#L742) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [743](#L743) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [744](#L744) | }else { |
| [745](#L745) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [746](#L746) | } |
| [747](#L747) | var final\_order\_id = ""; |
| [748](#L748) | var postData = { action: "bookingpress\_paypal\_booking\_validate\_lite", \_wpnonce: bkp\_wpnonce\_pre\_fetch,appointment\_data:JSON.stringify( app.appointment\_step\_form\_data)} |
| [749](#L749) | var final\_data = ""; |
| [750](#L750) | try { |
| [751](#L751) | const response = await axios.post(appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData )); |
| [752](#L752) | if(response.data.variant != "error") { |
| [753](#L753) | if(typeof response.data.order\_id != "undefined" && response.data.order\_id != ""){ |
| [754](#L754) | app.paypal\_success\_url = response.data.paypal\_success\_url; |
| [755](#L755) | app.paypal\_cancel\_url = response.data.paypal\_cancel\_url; |
| [756](#L756) | app.paypal\_booking\_form\_redirection\_mode = response.data.paypal\_booking\_form\_redirection\_mode; |
| [757](#L757) | return response.data.order\_id; |
| [758](#L758) | } |
| [759](#L759) | }else{ |
| [760](#L760) | window.app.bookingpress\_set\_error\_msg(response.data.msg); |
| [761](#L761) | return 0; |
| [762](#L762) | } |
| [763](#L763) | } catch (error) { |
| [764](#L764) | window.app.bookingpress\_set\_error\_msg("Failed to create PayPal order"); |
| [765](#L765) | return 0; |
| [766](#L766) | } |
| [767](#L767) |  |
| [768](#L768) | }, |
| [769](#L769) | onCancel: function(data){}, |
| [770](#L770) | onApprove: (data, actions) => { |
| [771](#L771) | return actions.order.capture().then(function(orderData) { |
| [772](#L772) |  |
| [773](#L773) | app.paypal\_button\_loader = "true"; |
| [774](#L774) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [775](#L775) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [776](#L776) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [777](#L777) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [778](#L778) | }else { |
| [779](#L779) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | var sca\_confirm\_booking\_data = { action: "bookingpress\_paypal\_booking\_payment\_confirm\_lite", bookingpress\_payment\_res: orderData, \_wpnonce: bkp\_wpnonce\_pre\_fetch} |
| [783](#L783) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( sca\_confirm\_booking\_data ) ) |
| [784](#L784) | .then(function(response) { |
| [785](#L785) | setTimeout(function(){ |
| [786](#L786) | app.paypal\_button\_loader = "false"; |
| [787](#L787) | },500); |
| [788](#L788) | if(response.data.variant != "error") { |
| [789](#L789) | window.location.href = app.paypal\_success\_url; |
| [790](#L790) | }else{ |
| [791](#L791) | window.app.bookingpress\_set\_error\_msg(response.data.msg); |
| [792](#L792) | } |
| [793](#L793) | }).catch(function(error){ |
| [794](#L794) | setTimeout(function(){ |
| [795](#L795) | app.paypal\_button\_loader = "false"; |
| [796](#L796) | },500); |
| [797](#L797) | console.log(error); |
| [798](#L798) | }); |
| [799](#L799) |  |
| [800](#L800) | }); |
| [801](#L801) | }, |
| [802](#L802) | style: { |
| [803](#L803) | layout: "vertical", |
| [804](#L804) | color: "gold", |
| [805](#L805) | shape: "pill", |
| [806](#L806) | label: "paypal", |
| [807](#L807) | fundingicons: false, |
| [808](#L808) | } |
| [809](#L809) | }).render("#paypal-button-container"); |
| [810](#L810) |  |
| [811](#L811) | }else{ |
| [812](#L812) | document.getElementById("paypal-button-container").innerHTML = ""; |
| [813](#L813) | } |
| [814](#L814) | '; |
| [815](#L815) | } |
| [816](#L816) | } |
| [817](#L817) |  |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) |  |
| [821](#L821) |  |
| [822](#L822) | return $bookingpress\_after\_selecting\_payment\_method\_data; |
| [823](#L823) | } |
| [824](#L824) |  |
| [825](#L825) | function bookingpress\_pro\_plugin\_active(){ |
| [826](#L826) | if (! function\_exists('is\_plugin\_active') ) { |
| [827](#L827) | include ABSPATH . '/wp-admin/includes/plugin.php'; |
| [828](#L828) | } |
| [829](#L829) | $bookingpress\_pro = (is\_plugin\_active('bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'))?1:0; |
| [830](#L830) | return $bookingpress\_pro; |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) | function change\_jet\_review\_deps( $jet\_vue\_deps ){ |
| [834](#L834) | foreach( $jet\_vue\_deps as $key => $dep ){ |
| [835](#L835) | if( 'jet-vue' == $dep ){ |
| [836](#L836) | $jet\_vue\_deps[ $key ] = 'bookingpress\_vue\_js'; |
| [837](#L837) | } |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | return $jet\_vue\_deps; |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | function validate\_bookingpress\_username(){ |
| [844](#L844) |  |
| [845](#L845) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_customers,$bookingpress\_payment\_gateways; |
| [846](#L846) | $response              = array(); |
| [847](#L847) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [848](#L848) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [849](#L849) | if (! $bpa\_verify\_nonce\_flag ) { |
| [850](#L850) | $response['variant']      = 'error'; |
| [851](#L851) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [852](#L852) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [853](#L853) | $response['redirect\_url'] = ''; |
| [854](#L854) | return wp\_json\_encode($response); |
| [855](#L855) |  |
| [856](#L856) | } |
| [857](#L857) | $response['variant']    = 'success'; |
| [858](#L858) | $response['title']      = ''; |
| [859](#L859) | $response['msg']        = ''; |
| [860](#L860) |  |
| [861](#L861) | if( !empty( $\_REQUEST['\_username'] ) && !is\_array( $\_REQUEST['\_username'] ) ){ |
| [862](#L862) | $response = apply\_filters('bpa\_password\_field\_validation\_outside', $response); |
| [863](#L863) | $username = sanitize\_text\_field($\_REQUEST['\_username']); |
| [864](#L864) | $check\_username = validate\_username( $username ); |
| [865](#L865) | if( $check\_username == 1 ){ |
| [866](#L866) | $response['variant'] = 'success'; |
| [867](#L867) | $response['title']   = esc\_html\_\_('success', 'bookingpress-appointment-booking'); |
| [868](#L868) | $response['msg']     = esc\_html\_\_('Validate Username', 'bookingpress-appointment-booking'); |
| [869](#L869) | echo wp\_json\_encode( $response ); |
| [870](#L870) | } else { |
| [871](#L871) | $response['variant'] = 'error'; |
| [872](#L872) | $response['title']   = esc\_html\_\_('error', 'bookingpress-appointment-booking'); |
| [873](#L873) | $response['msg']     = esc\_html\_\_('Please enter validate username', 'bookingpress-appointment-booking'); |
| [874](#L874) | echo wp\_json\_encode( $response ); |
| [875](#L875) | } |
| [876](#L876) | } |
| [877](#L877) | die; |
| [878](#L878) | } |
| [879](#L879) |  |
| [880](#L880) | function bookingpress\_front\_cancel\_appointment\_func() { |
| [881](#L881) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications, $bookingpress\_services; |
| [882](#L882) | $response              = array(); |
| [883](#L883) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [884](#L884) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [885](#L885) | if (! $bpa\_verify\_nonce\_flag ) { |
| [886](#L886) | $response['variant']      = 'error'; |
| [887](#L887) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [888](#L888) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [889](#L889) | wp\_send\_json($response); |
| [890](#L890) | die(); |
| [891](#L891) | } |
| [892](#L892) |  |
| [893](#L893) | $response['variant']    = 'error'; |
| [894](#L894) | $response['title']      = 'Error'; |
| [895](#L895) | $response['msg']        = 'Something went wrong when process with cancel appointment....'; |
| [896](#L896) |  |
| [897](#L897) | if(!empty($\_REQUEST['appointment\_id']) && !empty($\_REQUEST['cancel\_token'])) { |
| [898](#L898) |  |
| [899](#L899) | $appointment\_id = intval($\_REQUEST['appointment\_id']);// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [900](#L900) | $bookingpress\_cancel\_token = sanitize\_text\_field($\_REQUEST['cancel\_token']); |
| [901](#L901) |  |
| [902](#L902) | $bookingpress\_appointment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_customer\_email,bookingpress\_service\_id,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_customer\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d AND bookingpress\_appointment\_token = %s", $appointment\_id,$bookingpress\_cancel\_token), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_log\_data is table name defined globally. False Positive alarm |
| [903](#L903) |  |
| [904](#L904) | if (! empty($bookingpress\_appointment\_log\_data) ) { |
| [905](#L905) |  |
| [906](#L906) | $bookingpress\_appointment\_date = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_date']; |
| [907](#L907) | $bookingpress\_appointment\_time = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_time']; |
| [908](#L908) |  |
| [909](#L909) | $bookingpress\_appointment\_datetime = $bookingpress\_appointment\_date." ".$bookingpress\_appointment\_time; |
| [910](#L910) | $current\_datetime = date( 'Y-m-d H:i:s', current\_time('timestamp') ); |
| [911](#L911) | $allow\_cancel\_appointment = true; |
| [912](#L912) |  |
| [913](#L913) | if( $bookingpress\_appointment\_datetime <= $current\_datetime ){ |
| [914](#L914) | $allow\_cancel\_appointment = false; |
| [915](#L915) | } |
| [916](#L916) |  |
| [917](#L917) | $allow\_cancel\_appointment = apply\_filters( 'bookingpress\_modify\_cancel\_appointment\_flag', $allow\_cancel\_appointment, $bookingpress\_appointment\_log\_data ); |
| [918](#L918) |  |
| [919](#L919) | if($allow\_cancel\_appointment){ |
| [920](#L920) | $appointment\_cancelled\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_cancelled\_successfully', 'message\_setting'); |
| [921](#L921) | $response['variant']      = 'success'; |
| [922](#L922) | $response['title']        = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [923](#L923) | $response['msg']          = $appointment\_cancelled\_successfully; |
| [924](#L924) | $response = apply\_filters('bookingpress\_refund\_process\_before\_cancel\_appointment',$response,$appointment\_id); |
| [925](#L925) | if($response['variant'] == 'success' ) { |
| [926](#L926) | $bookingress\_customer\_email = $bookingpress\_appointment\_log\_data['bookingpress\_customer\_email']; |
| [927](#L927) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [928](#L928) | $bookingpress\_after\_canceled\_payment\_url     = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [929](#L929) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [930](#L930) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $appointment\_id )); |
| [931](#L931) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $appointment\_id, $bookingress\_customer\_email); |
| [932](#L932) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings,array('bookingpress\_appointment\_token' => ''),array('bookingpress\_appointment\_booking\_id' => $appointment\_id)); |
| [933](#L933) | do\_action('bookingpress\_after\_cancel\_appointment', $appointment\_id); |
| [934](#L934) | $response['redirect\_url'] = $bookingpress\_after\_canceled\_payment\_url; |
| [935](#L935) | } |
| [936](#L936) |  |
| [937](#L937) | } else { |
| [938](#L938) | $response['variant']    = 'error'; |
| [939](#L939) | $response['title']      = 'Error'; |
| [940](#L940) | $response['msg']        = esc\_html\_\_("We're sorry! you can't cancel this appointment because minimum required time for cancellation is already passed", "bookingpress-appointment-booking"); |
| [941](#L941) | } |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) | wp\_send\_json( $response); |
| [945](#L945) | die(); |
| [946](#L946) | } |
| [947](#L947) |  |
| [948](#L948) | /\*\* |
| [949](#L949) | \* bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func |
| [950](#L950) | \* |
| [951](#L951) | \* @return void |
| [952](#L952) | \*/ |
| [953](#L953) | function bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func() |
| [954](#L954) | { |
| [955](#L955) | global $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields, $BookingPress, $bookingpress\_global\_options; |
| [956](#L956) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields = array(); |
| [957](#L957) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['is\_cancel\_appointment\_loader'] = '0'; |
| [958](#L958) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['is\_cancel\_button\_disabled'] = false; |
| [959](#L959) |  |
| [960](#L960) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['bookingpress\_cancel\_variant'] = ''; |
| [961](#L961) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['bookingpress\_cancel\_msg'] = ''; |
| [962](#L962) |  |
| [963](#L963) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields = apply\_filters('bookingpress\_cancellation\_confirmation\_add\_dynamic\_data', $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields); |
| [964](#L964) |  |
| [965](#L965) | echo wp\_json\_encode($bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields); |
| [966](#L966) | } |
| [967](#L967) | /\*\* |
| [968](#L968) | \* bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | function bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func() |
| [973](#L973) | { |
| [974](#L974) | global $bookingpress\_global\_options; |
| [975](#L975) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [976](#L976) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [977](#L977) | ?> |
| [978](#L978) | var lang = ELEMENT.lang.<?php echo esc\_html($bookingpress\_locale\_lang); ?>; |
| [979](#L979) | ELEMENT.locale(lang); |
| [980](#L980) | <?php |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | /\*\* |
| [984](#L984) | \* bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func |
| [985](#L985) | \* |
| [986](#L986) | \* @return void |
| [987](#L987) | \*/ |
| [988](#L988) | function bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func() { |
| [989](#L989) | global $bookingpress\_notification\_duration; |
| [990](#L990) | ?> |
| [991](#L991) | bookingpress\_cancel\_appointment(appointment\_id,cancel\_token) { |
| [992](#L992) | const vm = this; |
| [993](#L993) | vm.is\_cancel\_appointment\_loader = '1' |
| [994](#L994) | vm.is\_cancel\_button\_disabled = true |
| [995](#L995) | var appointment\_cancel\_data = { action: 'bookingpress\_front\_cancel\_appointment',appointment\_id:appointment\_id,cancel\_token,\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [996](#L996) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( appointment\_cancel\_data ) ) |
| [997](#L997) | .then(function(response){ |
| [998](#L998) | vm.is\_cancel\_appointment\_loader = '0' |
| [999](#L999) | vm.is\_cancel\_button\_disabled = false |
| [1000](#L1000) |  |
| [1001](#L1001) | if(response.data.variant != undefined && response.data.variant != 'error'){ |
| [1002](#L1002) | window.location.href = response.data.redirect\_url; |
| [1003](#L1003) | } else { |
| [1004](#L1004) | vm.bookingpress\_cancel\_variant = response.data.variant; |
| [1005](#L1005) | vm.bookingpress\_cancel\_msg = response.data.msg; |
| [1006](#L1006) | } |
| [1007](#L1007) | }).catch(function(error){ |
| [1008](#L1008) | console.log(error); |
| [1009](#L1009) | vm.$notify({ |
| [1010](#L1010) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [1011](#L1011) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [1012](#L1012) | type: 'error', |
| [1013](#L1013) | customClass: 'error\_notification', |
| [1014](#L1014) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [1015](#L1015) | }); |
| [1016](#L1016) | }); |
| [1017](#L1017) | }, |
| [1018](#L1018) | <?php |
| [1019](#L1019) | } |
| [1020](#L1020) |  |
| [1021](#L1021) | function bookingpress\_preloaded\_fonts(){ |
| [1022](#L1022) |  |
| [1023](#L1023) | global $post; |
| [1024](#L1024) |  |
| [1025](#L1025) | if( empty( $post ) ){ |
| [1026](#L1026) | return; |
| [1027](#L1027) | } |
| [1028](#L1028) |  |
| [1029](#L1029) | $post\_content = $post->post\_content; |
| [1030](#L1030) |  |
| [1031](#L1031) | $pattern = '/\[(bookingpress\_(.\*?)\])/'; |
| [1032](#L1032) |  |
| [1033](#L1033) | if( preg\_match( $pattern, $post\_content ) ){ |
| [1034](#L1034) |  |
| [1035](#L1035) | global $BookingPress, $bookingpress\_global\_options; |
| [1036](#L1036) |  |
| [1037](#L1037) | $google\_fonts = $bookingpress\_global\_options->bookingpress\_get\_google\_fonts(); |
| [1038](#L1038) | $bookingpress\_title\_fonts = $BookingPress->bookingpress\_get\_customize\_settings( |
| [1039](#L1039) | 'title\_font\_family', |
| [1040](#L1040) | 'booking\_form' |
| [1041](#L1041) | ); |
| [1042](#L1042) |  |
| [1043](#L1043) | $bpa\_font\_dir\_url =  BOOKINGPRESS\_URL.'/css/fonts'; |
| [1044](#L1044) |  |
| [1045](#L1045) | $bpa\_preload\_font\_file\_arr = array( |
| [1046](#L1046) | 'element-icons.woff2' |
| [1047](#L1047) | ); |
| [1048](#L1048) |  |
| [1049](#L1049) | if( 'poppins' == strtolower( trim( $bookingpress\_title\_fonts) ) ){ |
| [1050](#L1050) | $bpa\_preload\_font\_file\_arr = array\_merge( $bpa\_preload\_font\_file\_arr, array( |
| [1051](#L1051) | 'poppins/Poppins-Bold.woff2', |
| [1052](#L1052) | 'poppins/Poppins-Medium.woff2', |
| [1053](#L1053) | 'poppins/Poppins-Regular.woff2', |
| [1054](#L1054) | 'poppins/Poppins-SemiBold.woff2' |
| [1055](#L1055) | )); |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | $bpa\_preload\_font\_file\_arr = apply\_filters( 'bookingpress\_modify\_preload\_font\_arr', $bpa\_preload\_font\_file\_arr ); |
| [1059](#L1059) |  |
| [1060](#L1060) | if( !empty( $bpa\_preload\_font\_file\_arr ) ){ |
| [1061](#L1061) | foreach( $bpa\_preload\_font\_file\_arr as $bpa\_font\_file ){ |
| [1062](#L1062) | if( filter\_var( $bpa\_font\_file, FILTER\_VALIDATE\_URL ) ){ |
| [1063](#L1063) | echo '<link rel="preload" href="'.$bpa\_font\_file.'" as="font" type="font/woff2" crossorigin />'; //phpcs:ignore |
| [1064](#L1064) | } else { |
| [1065](#L1065) | echo '<link rel="preload" href="'.$bpa\_font\_dir\_url.'/'.$bpa\_font\_file.'" as="font" type="font/woff2" crossorigin />'; //phpcs:ignore |
| [1066](#L1066) | } |
| [1067](#L1067) | } |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) |  |
| [1071](#L1071) | } |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | /\*\* |
| [1075](#L1075) | \* Used for delete customer account |
| [1076](#L1076) | \* |
| [1077](#L1077) | \* @return void |
| [1078](#L1078) | \*/ |
| [1079](#L1079) | function bookingpress\_delete\_customer\_account\_func(){ |
| [1080](#L1080) | global $wpdb, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_appointment\_bookings, $BookingPress, $tbl\_bookingpress\_customers\_meta,$tbl\_bookingpress\_payment\_logs; |
| [1081](#L1081) | $response              = array(); |
| [1082](#L1082) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1083](#L1083) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1084](#L1084) |  |
| [1085](#L1085) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1086](#L1086) | $response['variant']      = 'error'; |
| [1087](#L1087) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1088](#L1088) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1089](#L1089) | wp\_send\_json($response); |
| [1090](#L1090) | die(); |
| [1091](#L1091) | } |
| [1092](#L1092) |  |
| [1093](#L1093) | $response['variant']    = 'error'; |
| [1094](#L1094) | $response['title']      = 'Error'; |
| [1095](#L1095) | $response['msg']        = 'Something went wrong....'; |
| [1096](#L1096) |  |
| [1097](#L1097) | $bookingpress\_login\_user\_id = get\_current\_user\_id(); |
| [1098](#L1098) |  |
| [1099](#L1099) | if(!empty($bookingpress\_login\_user\_id)){ |
| [1100](#L1100) | $bookingpress\_customer\_rows = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d ORDER BY bookingpress\_customer\_id DESC", $bookingpress\_login\_user\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_customers is a table name. false alarm |
| [1101](#L1101) |  |
| [1102](#L1102) | do\_action('bookingpress\_delete\_customer\_log',$bookingpress\_customer\_rows,$\_REQUEST); |
| [1103](#L1103) |  |
| [1104](#L1104) | if(!empty($bookingpress\_customer\_rows)){ |
| [1105](#L1105) | do\_action( 'bookingpress\_before\_delete\_customer', $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ); |
| [1106](#L1106) | $delete = $wpdb->delete( $tbl\_bookingpress\_customers, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1107](#L1107) | if ( $delete > 0 ) { |
| [1108](#L1108) | $delete1 = $wpdb->delete( $tbl\_bookingpress\_customers\_meta, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1109](#L1109) | $delete2 = $wpdb->delete( $tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1110](#L1110) | $delete3 = $wpdb->delete( $tbl\_bookingpress\_payment\_logs, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1111](#L1111) | $customer\_role\_id = new WP\_User( $bookingpress\_login\_user\_id ); |
| [1112](#L1112) | $customer\_role\_id->remove\_role('bookingpress-customer'); |
| [1113](#L1113) |  |
| [1114](#L1114) | wp\_logout(); |
| [1115](#L1115) |  |
| [1116](#L1116) | $response['variant'] = 'success'; |
| [1117](#L1117) | $response['title'] = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [1118](#L1118) | $response['msg'] = esc\_html\_\_('Account Deleted Successfully', 'bookingpress-appointment-booking'); |
| [1119](#L1119) | } |
| [1120](#L1120) | }else{ |
| [1121](#L1121) | $response['msg'] = esc\_html\_\_('No customers exist in BookingPress', 'bookingpress-appointment-booking'); |
| [1122](#L1122) | } |
| [1123](#L1123) | }else{ |
| [1124](#L1124) | $response['msg'] = esc\_html\_\_('Please login to your account for delete BookingPress account', 'bookingpress-appointment-booking'); |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | echo wp\_json\_encode($response); |
| [1128](#L1128) | exit; |
| [1129](#L1129) | } |
| [1130](#L1130) |  |
| [1131](#L1131) | /\*\* |
| [1132](#L1132) | \* Customer delete account shortcode callable function |
| [1133](#L1133) | \* |
| [1134](#L1134) | \* @param  mixed $atts |
| [1135](#L1135) | \* @param  mixed $content |
| [1136](#L1136) | \* @param  mixed $tag |
| [1137](#L1137) | \* @return void |
| [1138](#L1138) | \*/ |
| [1139](#L1139) | function bookingpress\_delete\_account\_func($atts, $content, $tag){ |
| [1140](#L1140) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [1141](#L1141) | $BookingPress->set\_front\_css(1); |
| [1142](#L1142) | $BookingPress->set\_front\_js(1); |
| [1143](#L1143) | $BookingPress->bookingpress\_load\_mybooking\_custom\_css(); |
| [1144](#L1144) | //$BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [1145](#L1145) |  |
| [1146](#L1146) | $bookingpress\_short\_atts = array( |
| [1147](#L1147) | 'cancel\_button\_text' => esc\_html\_\_('Cancel', 'bookingpress-appointment-booking'), |
| [1148](#L1148) | 'delete\_button\_text' => esc\_html\_\_('Delete', 'bookingpress-appointment-booking'), |
| [1149](#L1149) | ); |
| [1150](#L1150) |  |
| [1151](#L1151) | $atts = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [1152](#L1152) |  |
| [1153](#L1153) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [1154](#L1154) |  |
| [1155](#L1155) | $content = '<div class="bpa-front-dcw\_\_body-btn-group">'; |
| [1156](#L1156) | $content .= '<el-button class="el-button bpa-front-btn bpa-front-btn\_\_medium bpa-front-delete-account-txt" @click="bookingpress\_cancel\_delete\_account()"><span>'. $atts['cancel\_button\_text'].'</span></el-button>'; |
| [1157](#L1157) | $content .= '<el-button class="el-button bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--danger" @click="bookingpress\_delete\_account()"><span>'.$atts['delete\_button\_text'].'</span></el-button>'; |
| [1158](#L1158) | $content .= '</div>'; |
| [1159](#L1159) |  |
| [1160](#L1160) | return $content; |
| [1161](#L1161) | } |
| [1162](#L1162) |  |
| [1163](#L1163) | /\*\* |
| [1164](#L1164) | \* bookingpress\_appointment\_cancellation\_confirmation\_func |
| [1165](#L1165) | \* |
| [1166](#L1166) | \* @param  mixed $atts |
| [1167](#L1167) | \* @param  mixed $content |
| [1168](#L1168) | \* @param  mixed $tag |
| [1169](#L1169) | \* @return void |
| [1170](#L1170) | \*/ |
| [1171](#L1171) | function bookingpress\_appointment\_cancellation\_confirmation\_func($atts, $content, $tag)  { |
| [1172](#L1172) |  |
| [1173](#L1173) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [1174](#L1174) | $BookingPress->set\_front\_css(1); |
| [1175](#L1175) | $BookingPress->set\_front\_js(1); |
| [1176](#L1176) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [1177](#L1177) | $bookingpress\_uniq\_id = uniqid(); |
| [1178](#L1178) | $appointment\_id = 0; |
| [1179](#L1179) |  |
| [1180](#L1180) | if(!empty($\_GET['appointment\_id']) && !empty($\_GET['cancel\_token'])){ |
| [1181](#L1181) | $bkp\_ap\_id = intval(base64\_decode($\_GET['appointment\_id'])); //phpcs:ignore |
| [1182](#L1182) | $bookingpress\_cancel\_token = sanitize\_text\_field($\_GET['cancel\_token']); |
| [1183](#L1183) |  |
| [1184](#L1184) | $bpa\_cancel\_booking\_id\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_booking\_id\_text', 'booking\_my\_booking'); |
| [1185](#L1185) | $bpa\_cancel\_service\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_service\_text', 'booking\_my\_booking'); |
| [1186](#L1186) | $bpa\_cancel\_date\_time\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_date\_time\_text', 'booking\_my\_booking'); |
| [1187](#L1187) | $bpa\_cancel\_button\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_button\_text', 'booking\_my\_booking'); |
| [1188](#L1188) | $bpa\_appointment\_cancellation\_confirmation = $BookingPress->bookingpress\_get\_settings('cancel\_appointment\_confirmation','message\_setting'); |
| [1189](#L1189) | $bpa\_no\_appointment\_available\_for\_cancel = $BookingPress->bookingpress\_get\_settings('no\_appointment\_available\_for\_cancel','message\_setting'); |
| [1190](#L1190) |  |
| [1191](#L1191) | $bpa\_cancel\_booking\_id\_text = !empty($bpa\_cancel\_booking\_id\_text) ? esc\_html($bpa\_cancel\_booking\_id\_text) : ''; |
| [1192](#L1192) | $bpa\_cancel\_service\_text = !empty($bpa\_cancel\_service\_text) ? esc\_html($bpa\_cancel\_service\_text) : ''; |
| [1193](#L1193) | $bpa\_cancel\_date\_time\_text = !empty($bpa\_cancel\_date\_time\_text) ? esc\_html($bpa\_cancel\_date\_time\_text) : ''; |
| [1194](#L1194) | $bpa\_cancel\_button\_text = !empty($bpa\_cancel\_button\_text) ? esc\_html($bpa\_cancel\_button\_text) : ''; |
| [1195](#L1195) |  |
| [1196](#L1196) | $bpa\_no\_appointment\_available\_for\_cancel = !empty($bpa\_no\_appointment\_available\_for\_cancel) ? esc\_html($bpa\_no\_appointment\_available\_for\_cancel) : ''; |
| [1197](#L1197) |  |
| [1198](#L1198) | $bpa\_appointment\_cancellation\_confirmation = !empty($bpa\_appointment\_cancellation\_confirmation) ? esc\_html($bpa\_appointment\_cancellation\_confirmation) : ''; |
| [1199](#L1199) |  |
| [1200](#L1200) | $bookingpress\_appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_status,bookingpress\_appointment\_timezone,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_booking\_id,bookingpress\_service\_name FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$bkp\_ap\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [1201](#L1201) |  |
| [1202](#L1202) | if(!empty($bookingpress\_appointment\_data) && $bookingpress\_appointment\_data['bookingpress\_appointment\_status'] != '3') { |
| [1203](#L1203) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [1204](#L1204) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_details['wp\_default\_date\_format'] . ' ' . $bookingpress\_global\_details |
| [1205](#L1205) | ['wp\_default\_time\_format']; |
| [1206](#L1206) |  |
| [1207](#L1207) | $booked\_appointment\_datetime = esc\_html($bookingpress\_appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($bookingpress\_appointment\_data['bookingpress\_appointment\_time']); |
| [1208](#L1208) | $bpa\_appointment\_booking\_id = '#'.esc\_html($bookingpress\_appointment\_data['bookingpress\_booking\_id']); |
| [1209](#L1209) | $bpa\_appointment\_service\_name = stripslashes\_deep(esc\_html($bookingpress\_appointment\_data['bookingpress\_service\_name'])); |
| [1210](#L1210) |  |
| [1211](#L1211) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_appointment\_data['bookingpress\_appointment\_timezone'], $bookingpress\_appointment\_data ); |
| [1212](#L1212) | $bpa\_appointment\_date\_time = date($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [1213](#L1213) |  |
| [1214](#L1214) | $content .=' <el-main class="bpa-appointment-cancellation\_container" id="bookingpress\_appointment\_cancellation\_form\_'.$bookingpress\_uniq\_id.'"> |
| [1215](#L1215) | <div class="bpa-front-thankyou-module-container bpa-front-cancel-confirmation-container"> |
| [1216](#L1216) | <div class="bpa-front-cc\_\_error-toast-notification" v-if="bookingpress\_cancel\_variant == \'error\'" v-html="bookingpress\_cancel\_msg"></div> |
| [1217](#L1217) | <div class="bpa-front-tmc\_\_head"> |
| [1218](#L1218) | <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="bpa-front-tmc\_\_vector--confirmation" xmlns="http://www.w3.org/2000/svg"> |
| [1219](#L1219) | <path fill-rule="evenodd" clip-rule="evenodd" |
| [1220](#L1220) | d="M90.7002 85.4609C84.4375 93.0097 72.3956 90.9929 62.8277 93.3709C53.5335 95.6809 44.3866 102.22 35.2915 99.2322C26.2099 96.2487 22.8396 85.5958 16.7964 78.2483C10.8588 71.029 1.14803 65.6955 0.0978856 56.4422C-0.951171 47.1985 6.67152 39.5221 11.4957 31.5412C15.8676 24.3085 20.1527 17.1388 26.9344 12.0453C34.1982 6.58966 42.3994 1.52536 51.5153 1.48363C60.7 1.44158 68.4886 7.22002 76.4135 11.8188C84.8089 16.6906 95.7104 20.0478 99.0838 29.0876C102.453 38.117 94.606 47.2497 93.1897 56.7734C91.7484 66.465 96.9793 77.8922 90.7002 85.4609Z" |
| [1221](#L1221) | class="bpa-front-vc\_\_bg" /> |
| [1222](#L1222) | <path |
| [1223](#L1223) | d="M82.6133 69.7307C82.3433 70.1385 82.386 70.6258 82.2851 71.0748C80.968 76.9215 75.5745 81.4923 68.9549 81.3047C62.9363 81.13 57.6068 76.5791 56.5156 70.5647C56.1894 68.8291 56.2157 67.0455 56.5929 65.3202C56.9701 63.5949 57.6905 61.9631 58.7112 60.5219C59.7319 59.0808 61.0321 57.8596 62.5344 56.9311C64.0367 56.0027 65.7104 55.3859 67.4559 55.1175C74.6368 53.9809 81.444 59.0447 82.4911 66.3093C82.5082 66.4259 82.4286 66.5935 82.6133 66.6475V69.7307ZM63.219 73.5939C63.2276 73.7806 63.2905 73.9608 63.4 74.1123C63.5096 74.2637 63.661 74.3799 63.8357 74.4464C64.2903 74.6283 64.6541 74.4777 64.9723 74.1622C66.3932 72.7414 67.814 71.3419 69.2078 69.9126C69.492 69.617 69.6468 69.5772 69.958 69.8983C71.2026 71.1856 72.48 72.4402 73.7473 73.7062C73.8633 73.8323 73.9877 73.9505 74.1196 74.0599C74.3031 74.2167 74.5389 74.2986 74.7801 74.2894C75.0212 74.2802 75.2501 74.1805 75.4211 74.0102C75.5943 73.8436 75.6998 73.6188 75.7173 73.3791C75.7349 73.1394 75.6633 72.9017 75.5163 72.7116C75.399 72.5594 75.2698 72.4169 75.1298 72.2853C73.8511 71.0066 72.5723 69.7179 71.2936 68.4491C71.0449 68.2061 71.0222 68.0754 71.2865 67.8268C72.021 67.1348 72.7244 66.406 73.4404 65.6955L75.4296 63.7178C75.7223 63.4251 75.8473 63.0798 75.7138 62.6777C75.6621 62.5025 75.5615 62.3457 75.4238 62.2257C75.2862 62.1057 75.1172 62.0274 74.9366 62C74.5103 61.9176 74.2105 62.1321 73.9292 62.4134C72.6391 63.7092 71.3248 64.9837 70.0646 66.3065C69.6809 66.7086 69.4962 66.6319 69.1538 66.2838C67.8751 64.9738 66.5736 63.6908 65.2807 62.3978C65.1997 62.3168 65.1201 62.2344 65.0377 62.1563C64.5106 61.649 63.9635 61.6007 63.5245 62.0142C63.0855 62.4277 63.1267 63.0244 63.651 63.5771L63.732 63.6581C65.0661 64.9908 66.3804 66.3463 67.7472 67.6435C68.1848 68.0598 68.1209 68.2601 67.7245 68.6381C66.3647 69.9452 65.0491 71.2964 63.7106 72.6249C63.4378 72.8949 63.2119 73.1662 63.219 73.5939Z" |
| [1224](#L1224) | class="bpa-head\_\_vector-item" /> |
| [1225](#L1225) | <path |
| [1226](#L1226) | d="M46.9914 34.1763C54.4242 34.1763 61.8599 34.1716 69.2983 34.1621C69.8312 34.1621 69.942 34.3042 69.9406 34.8171C69.9216 40.6899 69.9216 46.5626 69.9406 52.4353C69.9406 52.9127 69.8212 53.0165 69.3523 53.0207C65.7787 53.0403 62.3274 54.3247 59.6103 56.6461C56.8933 58.9676 55.086 62.1762 54.509 65.703C54.2154 67.4168 54.24 69.1699 54.5815 70.8748C54.6738 71.3209 54.553 71.4133 54.1126 71.4133C45.7453 71.4005 37.3781 71.4133 29.0109 71.4005C26.0414 71.4005 24.0678 69.4113 24.0678 66.4489C24.0678 55.8894 24.0621 45.3303 24.0508 34.7716C24.0508 34.2189 24.2398 34.1735 24.6973 34.1735C32.1244 34.182 39.5558 34.1829 46.9914 34.1763ZM45.5976 49.1689H53.8824C54.7789 49.1689 55.6755 49.1816 56.5706 49.1589C56.6996 49.1597 56.8275 49.1347 56.9467 49.0855C57.0659 49.0363 57.1742 48.9638 57.265 48.8722C57.3559 48.7807 57.4277 48.6719 57.476 48.5523C57.5244 48.4327 57.5484 48.3047 57.5467 48.1757C57.5375 47.9256 57.436 47.6877 57.2617 47.508C57.0875 47.3283 56.853 47.2195 56.6033 47.2024C56.4328 47.1868 56.2609 47.1953 56.0889 47.1953H35.0536C34.8822 47.1889 34.7105 47.1918 34.5393 47.2039C34.4009 47.2136 34.2662 47.2528 34.1442 47.3188C34.0221 47.3847 33.9155 47.4759 33.8315 47.5863C33.7475 47.6967 33.6879 47.8237 33.6569 47.9589C33.6258 48.0941 33.6239 48.2344 33.6513 48.3704C33.738 48.9003 34.1273 49.1674 34.8476 49.1674C38.4309 49.1703 42.0143 49.1708 45.5976 49.1689ZM41.1419 58.3943H47.3097C48.2545 58.3943 48.7461 58.049 48.7461 57.3897C48.7461 56.7305 48.2659 56.3952 47.3054 56.3952H35.0281C34.838 56.3897 34.6479 56.4006 34.4597 56.4279C33.9724 56.5159 33.6783 56.8101 33.6413 57.3116C33.6044 57.8132 33.8332 58.1428 34.2992 58.3246C34.4993 58.3872 34.7096 58.4108 34.9187 58.3943H41.1419Z" |
| [1227](#L1227) | fill="#727E95" /> |
| [1228](#L1228) | <path |
| [1229](#L1229) | d="M46.9156 32.214C39.4838 32.214 32.051 32.2177 24.6172 32.2253C24.1469 32.2253 24.0034 32.1259 24.0318 31.6428C24.1114 30.2561 23.9025 28.8565 24.1455 27.4783C24.3243 26.4557 24.8489 25.5255 25.6315 24.8434C26.4142 24.1614 27.4074 23.7689 28.4449 23.7316C30.4824 23.6748 32.5227 23.7174 34.5616 23.7004C34.867 23.7004 34.9466 23.7941 34.9409 24.0883C34.9239 24.9265 34.9296 25.7648 34.9409 26.6031C34.9409 27.3533 35.3331 27.8137 35.9355 27.8137C36.5379 27.8137 36.9301 27.3547 36.9301 26.6017C36.9386 25.8217 36.9599 25.0388 36.9215 24.2588C36.9002 23.8112 37.0295 23.6904 37.4799 23.6904C42.4528 23.7075 47.4257 23.7018 52.3986 23.7018C53.7896 23.7018 55.182 23.7132 56.573 23.6933C56.9154 23.6933 57.0362 23.7657 57.0234 24.1309C56.9935 24.9493 57.0077 25.7691 57.0148 26.5889C57.0219 27.3434 57.4027 27.8023 58.0094 27.808C58.6161 27.8137 59.004 27.3519 59.0168 26.606C59.0253 25.7861 59.0338 24.9663 59.0168 24.1479C59.0083 23.814 59.0722 23.6876 59.443 23.6919C61.3668 23.7132 63.2935 23.6805 65.2173 23.7075C67.9623 23.7458 69.9188 25.7847 69.906 28.5383C69.906 29.567 69.8762 30.5971 69.9174 31.6243C69.9358 32.1017 69.808 32.2154 69.3306 32.214C61.8618 32.2045 54.3901 32.2045 46.9156 32.214Z" |
| [1230](#L1230) | fill="#727E95" /> |
| [1231](#L1231) | <path |
| [1232](#L1232) | d="M8.12945 32.8244L8.16195 32.9235H8.25458L8.17964 32.9774L8.21066 33.072L8.12945 33.0136L8.04823 33.072L8.07925 32.9774L8.00431 32.9235H8.09695L8.12945 32.8244Z" |
| [1233](#L1233) | stroke="#12D488" stroke-width="0.758084" /> |
| [1234](#L1234) | <path |
| [1235](#L1235) | d="M98.6334 39.8249L98.6659 39.924H98.7585L98.6835 39.9779L98.7146 40.0725L98.6334 40.0141L98.5521 40.0725L98.5832 39.9779L98.5082 39.924H98.6009L98.6334 39.8249Z" |
| [1236](#L1236) | stroke="#12D488" stroke-width="0.758084" /> |
| [1237](#L1237) | <path |
| [1238](#L1238) | d="M70.5904 92.4333L70.6229 92.5324H70.7155L70.6406 92.5863L70.6716 92.6809L70.5904 92.6225L70.5092 92.6809L70.5402 92.5863L70.4652 92.5324H70.5579L70.5904 92.4333Z" |
| [1239](#L1239) | stroke="#F5AE41" stroke-width="0.758084" /> |
| [1240](#L1240) | <path |
| [1241](#L1241) | d="M47.4161 1.12892C47.4161 1.53965 47.079 1.8788 46.6554 1.8788C46.2318 1.8788 45.8947 1.53965 45.8947 1.12892C45.8947 0.718185 46.2318 0.379042 46.6554 0.379042C47.079 0.379042 47.4161 0.718185 47.4161 1.12892Z" |
| [1242](#L1242) | stroke="#EE2445" stroke-opacity="0.7" stroke-width="0.758084" /> |
| [1243](#L1243) | <path |
| [1244](#L1244) | d="M94.1466 65.4766C94.1466 65.8873 93.8094 66.2265 93.3859 66.2265C92.9623 66.2265 92.6251 65.8873 92.6251 65.4766C92.6251 65.0658 92.9623 64.7267 93.3859 64.7267C93.8094 64.7267 94.1466 65.0658 94.1466 65.4766Z" |
| [1245](#L1245) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1246](#L1246) | <path |
| [1247](#L1247) | d="M2.50988 65.4766C2.50988 65.8873 2.17272 66.2265 1.74915 66.2265C1.32558 66.2265 0.988417 65.8873 0.988417 65.4766C0.988417 65.0658 1.32558 64.7267 1.74915 64.7267C2.17272 64.7267 2.50988 65.0658 2.50988 65.4766Z" |
| [1248](#L1248) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1249](#L1249) | <path |
| [1250](#L1250) | d="M77.6641 12.8238C78.4239 12.8238 78.7152 12.1011 78.7658 11.7397C78.7658 12.4874 79.551 12.7889 79.9436 12.8388C79.0318 12.8388 78.7785 13.6113 78.7658 13.9976C78.7658 13.1602 78.0313 12.8612 77.6641 12.8238Z" |
| [1251](#L1251) | stroke="#F4B125" stroke-width="0.758084" stroke-linejoin="round" /> |
| [1252](#L1252) | <line x1="78.6483" y1="10.683" x2="78.6483" y2="10.3121" stroke="#F4B125" stroke-width="0.758084" |
| [1253](#L1253) | stroke-linecap="round" /> |
| [1254](#L1254) | <line x1="78.6483" y1="16.3275" x2="78.6483" y2="15.2793" stroke="#F4B125" stroke-width="0.758084" |
| [1255](#L1255) | stroke-linecap="round" /> |
| [1256](#L1256) | <path d="M80.625 12.897H81.9927" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1257](#L1257) | <path d="M75.6094 12.897H76.4642" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1258](#L1258) | </svg> |
| [1259](#L1259) | <div class="bpa-front-tmc\_\_booking-id"> |
| [1260](#L1260) | <div class="bpa-front-bi\_\_label">'.$bpa\_appointment\_cancellation\_confirmation.'</div> |
| [1261](#L1261) | </div> |
| [1262](#L1262) | </div> |
| [1263](#L1263) | <div class="bpa-front-tmc\_\_summary-content"> |
| [1264](#L1264) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1265](#L1265) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_booking\_id\_text.':</div> |
| [1266](#L1266) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_booking\_id.'</div> |
| [1267](#L1267) | </div> |
| [1268](#L1268) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1269](#L1269) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_service\_text.':</div> |
| [1270](#L1270) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_service\_name.'</div> |
| [1271](#L1271) | </div> |
| [1272](#L1272) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1273](#L1273) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_date\_time\_text.':</div> |
| [1274](#L1274) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_date\_time.'</div> |
| [1275](#L1275) | </div> |
| [1276](#L1276) | </div>'; |
| [1277](#L1277) | $content = apply\_filters('bookingpress\_add\_cancel\_appointment\_extra\_content',$content,$bkp\_ap\_id); |
| [1278](#L1278) | $content .="<el-button class='bpa-front-btn bpa-front-btn--primary' @click='bookingpress\_cancel\_appointment(bookingpress\_appointment\_id,bookingpress\_cancel\_token)' :disabled='is\_cancel\_button\_disabled' :class='(is\_cancel\_appointment\_loader == \"1\") ? \"bpa-front-btn--is-loader\" : \"\"'>"; |
| [1279](#L1279) | $content .= '<span class="bpa-btn\_\_label">'.$bpa\_cancel\_button\_text.'</span> |
| [1280](#L1280) | <div class="bpa-front-btn--loader\_\_circles"> |
| [1281](#L1281) | <div></div> |
| [1282](#L1282) | <div></div> |
| [1283](#L1283) | <div></div> |
| [1284](#L1284) | </div> |
| [1285](#L1285) | </el-button> |
| [1286](#L1286) | </div> |
| [1287](#L1287) |  |
| [1288](#L1288) | </el-main>'; |
| [1289](#L1289) | } else { |
| [1290](#L1290) | $content .=' |
| [1291](#L1291) | <div class="bpa-front-thankyou-module-container bpa-front-cancel-confirmation-container"> |
| [1292](#L1292) | <div class="bpa-front-tmc\_\_head"> |
| [1293](#L1293) | <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="bpa-front-tmc\_\_vector--confirmation" xmlns="http://www.w3.org/2000/svg"> |
| [1294](#L1294) | <path fill-rule="evenodd" clip-rule="evenodd" |
| [1295](#L1295) | d="M90.7002 85.4609C84.4375 93.0097 72.3956 90.9929 62.8277 93.3709C53.5335 95.6809 44.3866 102.22 35.2915 99.2322C26.2099 96.2487 22.8396 85.5958 16.7964 78.2483C10.8588 71.029 1.14803 65.6955 0.0978856 56.4422C-0.951171 47.1985 6.67152 39.5221 11.4957 31.5412C15.8676 24.3085 20.1527 17.1388 26.9344 12.0453C34.1982 6.58966 42.3994 1.52536 51.5153 1.48363C60.7 1.44158 68.4886 7.22002 76.4135 11.8188C84.8089 16.6906 95.7104 20.0478 99.0838 29.0876C102.453 38.117 94.606 47.2497 93.1897 56.7734C91.7484 66.465 96.9793 77.8922 90.7002 85.4609Z" |
| [1296](#L1296) | class="bpa-front-vc\_\_bg" /> |
| [1297](#L1297) | <path |
| [1298](#L1298) | d="M82.6133 69.7307C82.3433 70.1385 82.386 70.6258 82.2851 71.0748C80.968 76.9215 75.5745 81.4923 68.9549 81.3047C62.9363 81.13 57.6068 76.5791 56.5156 70.5647C56.1894 68.8291 56.2157 67.0455 56.5929 65.3202C56.9701 63.5949 57.6905 61.9631 58.7112 60.5219C59.7319 59.0808 61.0321 57.8596 62.5344 56.9311C64.0367 56.0027 65.7104 55.3859 67.4559 55.1175C74.6368 53.9809 81.444 59.0447 82.4911 66.3093C82.5082 66.4259 82.4286 66.5935 82.6133 66.6475V69.7307ZM63.219 73.5939C63.2276 73.7806 63.2905 73.9608 63.4 74.1123C63.5096 74.2637 63.661 74.3799 63.8357 74.4464C64.2903 74.6283 64.6541 74.4777 64.9723 74.1622C66.3932 72.7414 67.814 71.3419 69.2078 69.9126C69.492 69.617 69.6468 69.5772 69.958 69.8983C71.2026 71.1856 72.48 72.4402 73.7473 73.7062C73.8633 73.8323 73.9877 73.9505 74.1196 74.0599C74.3031 74.2167 74.5389 74.2986 74.7801 74.2894C75.0212 74.2802 75.2501 74.1805 75.4211 74.0102C75.5943 73.8436 75.6998 73.6188 75.7173 73.3791C75.7349 73.1394 75.6633 72.9017 75.5163 72.7116C75.399 72.5594 75.2698 72.4169 75.1298 72.2853C73.8511 71.0066 72.5723 69.7179 71.2936 68.4491C71.0449 68.2061 71.0222 68.0754 71.2865 67.8268C72.021 67.1348 72.7244 66.406 73.4404 65.6955L75.4296 63.7178C75.7223 63.4251 75.8473 63.0798 75.7138 62.6777C75.6621 62.5025 75.5615 62.3457 75.4238 62.2257C75.2862 62.1057 75.1172 62.0274 74.9366 62C74.5103 61.9176 74.2105 62.1321 73.9292 62.4134C72.6391 63.7092 71.3248 64.9837 70.0646 66.3065C69.6809 66.7086 69.4962 66.6319 69.1538 66.2838C67.8751 64.9738 66.5736 63.6908 65.2807 62.3978C65.1997 62.3168 65.1201 62.2344 65.0377 62.1563C64.5106 61.649 63.9635 61.6007 63.5245 62.0142C63.0855 62.4277 63.1267 63.0244 63.651 63.5771L63.732 63.6581C65.0661 64.9908 66.3804 66.3463 67.7472 67.6435C68.1848 68.0598 68.1209 68.2601 67.7245 68.6381C66.3647 69.9452 65.0491 71.2964 63.7106 72.6249C63.4378 72.8949 63.2119 73.1662 63.219 73.5939Z" |
| [1299](#L1299) | class="bpa-head\_\_vector-item" /> |
| [1300](#L1300) | <path |
| [1301](#L1301) | d="M46.9914 34.1763C54.4242 34.1763 61.8599 34.1716 69.2983 34.1621C69.8312 34.1621 69.942 34.3042 69.9406 34.8171C69.9216 40.6899 69.9216 46.5626 69.9406 52.4353C69.9406 52.9127 69.8212 53.0165 69.3523 53.0207C65.7787 53.0403 62.3274 54.3247 59.6103 56.6461C56.8933 58.9676 55.086 62.1762 54.509 65.703C54.2154 67.4168 54.24 69.1699 54.5815 70.8748C54.6738 71.3209 54.553 71.4133 54.1126 71.4133C45.7453 71.4005 37.3781 71.4133 29.0109 71.4005C26.0414 71.4005 24.0678 69.4113 24.0678 66.4489C24.0678 55.8894 24.0621 45.3303 24.0508 34.7716C24.0508 34.2189 24.2398 34.1735 24.6973 34.1735C32.1244 34.182 39.5558 34.1829 46.9914 34.1763ZM45.5976 49.1689H53.8824C54.7789 49.1689 55.6755 49.1816 56.5706 49.1589C56.6996 49.1597 56.8275 49.1347 56.9467 49.0855C57.0659 49.0363 57.1742 48.9638 57.265 48.8722C57.3559 48.7807 57.4277 48.6719 57.476 48.5523C57.5244 48.4327 57.5484 48.3047 57.5467 48.1757C57.5375 47.9256 57.436 47.6877 57.2617 47.508C57.0875 47.3283 56.853 47.2195 56.6033 47.2024C56.4328 47.1868 56.2609 47.1953 56.0889 47.1953H35.0536C34.8822 47.1889 34.7105 47.1918 34.5393 47.2039C34.4009 47.2136 34.2662 47.2528 34.1442 47.3188C34.0221 47.3847 33.9155 47.4759 33.8315 47.5863C33.7475 47.6967 33.6879 47.8237 33.6569 47.9589C33.6258 48.0941 33.6239 48.2344 33.6513 48.3704C33.738 48.9003 34.1273 49.1674 34.8476 49.1674C38.4309 49.1703 42.0143 49.1708 45.5976 49.1689ZM41.1419 58.3943H47.3097C48.2545 58.3943 48.7461 58.049 48.7461 57.3897C48.7461 56.7305 48.2659 56.3952 47.3054 56.3952H35.0281C34.838 56.3897 34.6479 56.4006 34.4597 56.4279C33.9724 56.5159 33.6783 56.8101 33.6413 57.3116C33.6044 57.8132 33.8332 58.1428 34.2992 58.3246C34.4993 58.3872 34.7096 58.4108 34.9187 58.3943H41.1419Z" |
| [1302](#L1302) | fill="#727E95" /> |
| [1303](#L1303) | <path |
| [1304](#L1304) | d="M46.9156 32.214C39.4838 32.214 32.051 32.2177 24.6172 32.2253C24.1469 32.2253 24.0034 32.1259 24.0318 31.6428C24.1114 30.2561 23.9025 28.8565 24.1455 27.4783C24.3243 26.4557 24.8489 25.5255 25.6315 24.8434C26.4142 24.1614 27.4074 23.7689 28.4449 23.7316C30.4824 23.6748 32.5227 23.7174 34.5616 23.7004C34.867 23.7004 34.9466 23.7941 34.9409 24.0883C34.9239 24.9265 34.9296 25.7648 34.9409 26.6031C34.9409 27.3533 35.3331 27.8137 35.9355 27.8137C36.5379 27.8137 36.9301 27.3547 36.9301 26.6017C36.9386 25.8217 36.9599 25.0388 36.9215 24.2588C36.9002 23.8112 37.0295 23.6904 37.4799 23.6904C42.4528 23.7075 47.4257 23.7018 52.3986 23.7018C53.7896 23.7018 55.182 23.7132 56.573 23.6933C56.9154 23.6933 57.0362 23.7657 57.0234 24.1309C56.9935 24.9493 57.0077 25.7691 57.0148 26.5889C57.0219 27.3434 57.4027 27.8023 58.0094 27.808C58.6161 27.8137 59.004 27.3519 59.0168 26.606C59.0253 25.7861 59.0338 24.9663 59.0168 24.1479C59.0083 23.814 59.0722 23.6876 59.443 23.6919C61.3668 23.7132 63.2935 23.6805 65.2173 23.7075C67.9623 23.7458 69.9188 25.7847 69.906 28.5383C69.906 29.567 69.8762 30.5971 69.9174 31.6243C69.9358 32.1017 69.808 32.2154 69.3306 32.214C61.8618 32.2045 54.3901 32.2045 46.9156 32.214Z" |
| [1305](#L1305) | fill="#727E95" /> |
| [1306](#L1306) | <path |
| [1307](#L1307) | d="M8.12945 32.8244L8.16195 32.9235H8.25458L8.17964 32.9774L8.21066 33.072L8.12945 33.0136L8.04823 33.072L8.07925 32.9774L8.00431 32.9235H8.09695L8.12945 32.8244Z" |
| [1308](#L1308) | stroke="#12D488" stroke-width="0.758084" /> |
| [1309](#L1309) | <path |
| [1310](#L1310) | d="M98.6334 39.8249L98.6659 39.924H98.7585L98.6835 39.9779L98.7146 40.0725L98.6334 40.0141L98.5521 40.0725L98.5832 39.9779L98.5082 39.924H98.6009L98.6334 39.8249Z" |
| [1311](#L1311) | stroke="#12D488" stroke-width="0.758084" /> |
| [1312](#L1312) | <path |
| [1313](#L1313) | d="M70.5904 92.4333L70.6229 92.5324H70.7155L70.6406 92.5863L70.6716 92.6809L70.5904 92.6225L70.5092 92.6809L70.5402 92.5863L70.4652 92.5324H70.5579L70.5904 92.4333Z" |
| [1314](#L1314) | stroke="#F5AE41" stroke-width="0.758084" /> |
| [1315](#L1315) | <path |
| [1316](#L1316) | d="M47.4161 1.12892C47.4161 1.53965 47.079 1.8788 46.6554 1.8788C46.2318 1.8788 45.8947 1.53965 45.8947 1.12892C45.8947 0.718185 46.2318 0.379042 46.6554 0.379042C47.079 0.379042 47.4161 0.718185 47.4161 1.12892Z" |
| [1317](#L1317) | stroke="#EE2445" stroke-opacity="0.7" stroke-width="0.758084" /> |
| [1318](#L1318) | <path |
| [1319](#L1319) | d="M94.1466 65.4766C94.1466 65.8873 93.8094 66.2265 93.3859 66.2265C92.9623 66.2265 92.6251 65.8873 92.6251 65.4766C92.6251 65.0658 92.9623 64.7267 93.3859 64.7267C93.8094 64.7267 94.1466 65.0658 94.1466 65.4766Z" |
| [1320](#L1320) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1321](#L1321) | <path |
| [1322](#L1322) | d="M2.50988 65.4766C2.50988 65.8873 2.17272 66.2265 1.74915 66.2265C1.32558 66.2265 0.988417 65.8873 0.988417 65.4766C0.988417 65.0658 1.32558 64.7267 1.74915 64.7267C2.17272 64.7267 2.50988 65.0658 2.50988 65.4766Z" |
| [1323](#L1323) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1324](#L1324) | <path |
| [1325](#L1325) | d="M77.6641 12.8238C78.4239 12.8238 78.7152 12.1011 78.7658 11.7397C78.7658 12.4874 79.551 12.7889 79.9436 12.8388C79.0318 12.8388 78.7785 13.6113 78.7658 13.9976C78.7658 13.1602 78.0313 12.8612 77.6641 12.8238Z" |
| [1326](#L1326) | stroke="#F4B125" stroke-width="0.758084" stroke-linejoin="round" /> |
| [1327](#L1327) | <line x1="78.6483" y1="10.683" x2="78.6483" y2="10.3121" stroke="#F4B125" stroke-width="0.758084" |
| [1328](#L1328) | stroke-linecap="round" /> |
| [1329](#L1329) | <line x1="78.6483" y1="16.3275" x2="78.6483" y2="15.2793" stroke="#F4B125" stroke-width="0.758084" |
| [1330](#L1330) | stroke-linecap="round" /> |
| [1331](#L1331) | <path d="M80.625 12.897H81.9927" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1332](#L1332) | <path d="M75.6094 12.897H76.4642" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1333](#L1333) | </svg> |
| [1334](#L1334) | <div class="bpa-front-tmc\_\_booking-id"> |
| [1335](#L1335) | <div class="bpa-front-bi\_\_label">'.$bpa\_appointment\_cancellation\_confirmation.'</div> |
| [1336](#L1336) | </div> |
| [1337](#L1337) | </div> |
| [1338](#L1338) | <div class="bpa-front-refund-confirmation-content"> |
| [1339](#L1339) | <div class="bpa-front-rcc\_\_body"> |
| [1340](#L1340) | <div class="bpa-front-rcc\_\_empty-msg">'.$bpa\_no\_appointment\_available\_for\_cancel.'</div> |
| [1341](#L1341) | </div> |
| [1342](#L1342) | </div>'; |
| [1343](#L1343) | } |
| [1344](#L1344) |  |
| [1345](#L1345) | add\_action( |
| [1346](#L1346) | 'wp\_footer', |
| [1347](#L1347) | function () use ( &$bookingpress\_uniq\_id,$bkp\_ap\_id,$bookingpress\_cancel\_token ) { |
| [1348](#L1348) | global $bookingpress\_global\_options ,$BookingPress; |
| [1349](#L1349) | $requested\_module                = 'cancellation\_confirmation'; |
| [1350](#L1350) |  |
| [1351](#L1351) | ?> |
| [1352](#L1352) | <script> |
| [1353](#L1353) | window.addEventListener('DOMContentLoaded', function() { |
| [1354](#L1354) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_helper\_vars'); ?> |
| [1355](#L1355) | var app = new Vue({ |
| [1356](#L1356) | el: '#bookingpress\_appointment\_cancellation\_form\_<?php echo esc\_html($bookingpress\_uniq\_id); ?>', |
| [1357](#L1357) | directives: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_directives'); ?> }, |
| [1358](#L1358) | components: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_components'); ?> }, |
| [1359](#L1359) | data() { |
| [1360](#L1360) | var bookingpress\_return\_data = <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields'); ?>; |
| [1361](#L1361) | bookingpress\_return\_data['bookingpress\_uniq\_id'] = '<?php echo esc\_html($bookingpress\_uniq\_id); ?>'; |
| [1362](#L1362) | bookingpress\_return\_data['bookingpress\_appointment\_id'] = '<?php echo intval($bkp\_ap\_id); ?>'; |
| [1363](#L1363) | bookingpress\_return\_data['bookingpress\_cancel\_token'] = '<?php echo esc\_html($bookingpress\_cancel\_token); ?>'; |
| [1364](#L1364) | return bookingpress\_return\_data; |
| [1365](#L1365) | }, |
| [1366](#L1366) | filters:{ |
| [1367](#L1367) |  |
| [1368](#L1368) | }, |
| [1369](#L1369) | beforeCreate(){ |
| [1370](#L1370) | this.is\_front\_appointment\_empty\_loader = '1'; |
| [1371](#L1371) | }, |
| [1372](#L1372) | created(){ |
| [1373](#L1373) | }, |
| [1374](#L1374) | mounted() { |
| [1375](#L1375) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_on\_load\_methods'); ?> |
| [1376](#L1376) | }, |
| [1377](#L1377) | methods: { |
| [1378](#L1378) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_vue\_methods'); ?> |
| [1379](#L1379) | }, |
| [1380](#L1380) | }); |
| [1381](#L1381) | }); |
| [1382](#L1382) | </script> |
| [1383](#L1383) | <?php |
| [1384](#L1384) | }, |
| [1385](#L1385) | 100 |
| [1386](#L1386) | ); |
| [1387](#L1387) | } |
| [1388](#L1388) | return do\_shortcode($content); |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | /\*\* |
| [1392](#L1392) | \* Get appointment details for thank you page calendar |
| [1393](#L1393) | \* |
| [1394](#L1394) | \* @return void |
| [1395](#L1395) | \*/ |
| [1396](#L1396) | function bookingpress\_get\_appointment\_details\_for\_calendar\_func( $appointment\_id, $return = false ){ |
| [1397](#L1397) | global $wpdb, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_appointment\_bookings, $BookingPress; |
| [1398](#L1398) | $response              = array(); |
| [1399](#L1399) |  |
| [1400](#L1400) | $response['variant']    = 'error'; |
| [1401](#L1401) | $response['title']      = 'Error'; |
| [1402](#L1402) | $response['msg']        = 'Something went wrong....'; |
| [1403](#L1403) | $response['google\_calendar\_link'] = ''; |
| [1404](#L1404) | $response['yahoo\_calendar\_link'] = ''; |
| [1405](#L1405) |  |
| [1406](#L1406) | $bookingpress\_appointment\_id = $appointment\_id; |
| [1407](#L1407) |  |
| [1408](#L1408) | if(!empty($bookingpress\_appointment\_id)){ |
| [1409](#L1409) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d OR bookingpress\_entry\_id = %d", $bookingpress\_appointment\_id, $bookingpress\_appointment\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [1410](#L1410) |  |
| [1411](#L1411) | if(!empty($appointment\_data)){ |
| [1412](#L1412) | $service\_id = intval( $appointment\_data['bookingpress\_service\_id'] ); |
| [1413](#L1413) |  |
| [1414](#L1414) | $bookingpress\_start\_time = $start\_time =  sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_time'] ); |
| [1415](#L1415) | $bookingpress\_end\_time = $end\_time = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_end\_time'] ); |
| [1416](#L1416) |  |
| [1417](#L1417) | $bookingpress\_appointment\_date\_temp = $appointment\_data['bookingpress\_appointment\_date']; |
| [1418](#L1418) | if ($bookingpress\_end\_time === '24:00:00') { |
| [1419](#L1419) | $bookingpress\_appointment\_date\_temp = date('Y-m-d', strtotime($appointment\_data['bookingpress\_appointment\_date'] . ' +1 day')); |
| [1420](#L1420) | $bookingpress\_end\_time = '00:00:00'; |
| [1421](#L1421) | } |
| [1422](#L1422) |  |
| [1423](#L1423) | $service\_duration = sanitize\_text\_field( $appointment\_data['bookingpress\_service\_duration\_val'] ); |
| [1424](#L1424) |  |
| [1425](#L1425) | $service\_duration\_unit = sanitize\_text\_field( $appointment\_data['bookingpress\_service\_duration\_unit'] ); |
| [1426](#L1426) |  |
| [1427](#L1427) | $bookingpress\_start\_time\_for\_yahoo = date( 'Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ) . 'T' . date( 'His', strtotime( $bookingpress\_start\_time ) ) . 'Z'; |
| [1428](#L1428) |  |
| [1429](#L1429) | $bookingpress\_start\_time = $this->bookingpress\_convert\_date\_time\_to\_utc( $appointment\_data['bookingpress\_appointment\_date'], $bookingpress\_start\_time ); |
| [1430](#L1430) | $bookingpress\_end\_time = $this->bookingpress\_convert\_date\_time\_to\_utc( $bookingpress\_appointment\_date\_temp , $bookingpress\_end\_time ); |
| [1431](#L1431) |  |
| [1432](#L1432) | $bookingpress\_service\_name = ! empty( $appointment\_data['bookingpress\_service\_name'] ) ? stripslashes\_deep($appointment\_data['bookingpress\_service\_name']) : ''; |
| [1433](#L1433) |  |
| [1434](#L1434) | if ( 'd' != $service\_duration\_unit ) { |
| [1435](#L1435) | $bookingpress\_tmp\_start\_time = new DateTime($start\_time); |
| [1436](#L1436) | $bookingpress\_tmp\_end\_time = new DateTime($end\_time); |
| [1437](#L1437) | $booking\_date\_interval = $bookingpress\_tmp\_start\_time->diff($bookingpress\_tmp\_end\_time); |
| [1438](#L1438) | $service\_duration\_time = ($booking\_date\_interval->h \* 60) + ($booking\_date\_interval->i); |
| [1439](#L1439) | $service\_duration\_time = '00'.$service\_duration\_time; |
| [1440](#L1440) | } else { |
| [1441](#L1441) | $service\_duration\_time = $service\_duration . '00'; |
| [1442](#L1442) | $bookingpress\_start\_time = date('Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ); |
| [1443](#L1443) | $bookingpress\_end\_time = date('Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] . '+' . $service\_duration.' days' ) ); |
| [1444](#L1444) | } |
| [1445](#L1445) |  |
| [1446](#L1446) | $response['variant'] = 'success'; |
| [1447](#L1447) | $response['title'] = 'Success'; |
| [1448](#L1448) | $response['msg'] = 'Links generated successfully'; |
| [1449](#L1449) | $response['google\_calendar\_link'] = urlencode($bookingpress\_service\_name)."&dates=".esc\_html($bookingpress\_start\_time)."/".esc\_html($bookingpress\_end\_time); |
| [1450](#L1450) | $response['yahoo\_calendar\_link'] = urlencode($bookingpress\_service\_name)."&st=".esc\_html($bookingpress\_start\_time\_for\_yahoo)."&dur=".esc\_html($service\_duration\_time); |
| [1451](#L1451) | } |
| [1452](#L1452) | } |
| [1453](#L1453) |  |
| [1454](#L1454) | return $response; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) |  |
| [1458](#L1458) | /\*\* |
| [1459](#L1459) | \* Background function for disable future dates |
| [1460](#L1460) | \* |
| [1461](#L1461) | \* @return void |
| [1462](#L1462) | \*/ |
| [1463](#L1463) | function bookingpress\_get\_whole\_day\_appointments\_func($return\_data = false) { |
| [1464](#L1464) | // phpcs:ignore WordPress.Security.NonceVerification |
| [1465](#L1465) | global $BookingPress; |
| [1466](#L1466) |  |
| [1467](#L1467) | $month\_check = !empty( $\_POST['next\_month'] ) ? sanitize\_text\_field( $\_POST['next\_month'] ) : date('m', current\_time('timestamp') ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1468](#L1468) | $year\_check = !empty( $\_POST['next\_year'] ) ? sanitize\_text\_field( $\_POST['next\_year'] ) : date( 'Y', current\_time('timestamp') ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1469](#L1469) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ // phpcs:ignore WordPress.Security.NonceVerification |
| [1470](#L1470) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [1471](#L1471) | $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1472](#L1472) | } |
| [1473](#L1473) |  |
| [1474](#L1474) | $bookingpress\_disabled\_dates = !empty($\_POST['days\_off\_disabled\_dates']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), explode(',',$\_POST['days\_off\_disabled\_dates']) ) : array(); // phpcs:ignore |
| [1475](#L1475) | $daysoff\_dates = $bookingpress\_disabled\_dates; |
| [1476](#L1476) |  |
| [1477](#L1477) | $first\_date\_of\_month = $year\_check . '-' . $month\_check . '-01'; |
| [1478](#L1478) | $last\_date\_of\_month = date('Y-m-t', strtotime( $first\_date\_of\_month ) ); |
| [1479](#L1479) |  |
| [1480](#L1480) | $start\_date = new DateTime( $first\_date\_of\_month ); |
| [1481](#L1481) | $end\_date = new DateTime( date('Y-m-d', strtotime($last\_date\_of\_month .'+1 day') ) ); |
| [1482](#L1482) |  |
| [1483](#L1483) | $interval = DateInterval::createFromDateString('1 day'); |
| [1484](#L1484) | $period = new DatePeriod( $start\_date, $interval, $end\_date ); |
| [1485](#L1485) |  |
| [1486](#L1486) | $extra\_disabled\_dates = array(); |
| [1487](#L1487) | $extra\_disabled\_dates\_t = array(); |
| [1488](#L1488) | foreach( $period as $dt ){ |
| [1489](#L1489) | $current\_date = $dt->format("Y-m-d H:i:s"); |
| [1490](#L1490) | $date\_t = date('c', strtotime( $current\_date ) ); |
| [1491](#L1491) | if( !in\_array( $date\_t, $daysoff\_dates ) ){ |
| [1492](#L1492) | $current\_selected\_date = $dt->format( 'Y-m-d' ); |
| [1493](#L1493) | $is\_time\_slot\_available = $this->bookingpress\_retrieve\_timeslots( $current\_selected\_date, true, true ); |
| [1494](#L1494) | if( false == $is\_time\_slot\_available ){ |
| [1495](#L1495) | $daysoff\_dates[] = $date\_t; |
| [1496](#L1496) | $extra\_disabled\_dates\_t[] = $date\_t; |
| [1497](#L1497) | $extra\_disabled\_dates[] = date('Y-m-d', strtotime( $date\_t) ); |
| [1498](#L1498) | } |
| [1499](#L1499) | } |
| [1500](#L1500) | } |
| [1501](#L1501) |  |
| [1502](#L1502) | $max\_available\_month = !empty( $\_POST['max\_available\_month'] ) ? sanitize\_text\_field( $\_POST['max\_available\_month'] ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1503](#L1503) | $response['prevent\_next\_month\_check']  = false; |
| [1504](#L1504) | if( !empty( $max\_available\_month ) && $max\_available\_month == $month\_check && $\_POST['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ // phpcs:ignore |
| [1505](#L1505) | $response['prevent\_next\_month\_check']  = true; |
| [1506](#L1506) | } |
| [1507](#L1507) |  |
| [1508](#L1508) | $bookingpress\_selected\_service = !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [1509](#L1509) |  |
| [1510](#L1510) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1511](#L1511) |  |
| [1512](#L1512) | if(empty($bookingpress\_selected\_service)){ |
| [1513](#L1513) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [1514](#L1514) | } |
| [1515](#L1515) |  |
| [1516](#L1516) | $before\_daysoff\_dates = $daysoff\_dates; |
| [1517](#L1517) |  |
| [1518](#L1518) | $daysoff\_dates = apply\_filters( 'bookingpress\_modify\_disable\_dates\_with\_staffmember', $daysoff\_dates, $bookingpress\_selected\_service, $first\_date\_of\_month ); |
| [1519](#L1519) |  |
| [1520](#L1520) | $after\_daysoff\_dates = $daysoff\_dates; |
| [1521](#L1521) |  |
| [1522](#L1522) | foreach( $extra\_disabled\_dates\_t as $key => $v ){ |
| [1523](#L1523) | if( !in\_array( $v, $daysoff\_dates ) ){ |
| [1524](#L1524) | unset( $extra\_disabled\_dates[ $key ] ); |
| [1525](#L1525) | } |
| [1526](#L1526) | } |
| [1527](#L1527) |  |
| [1528](#L1528) | $bpa\_retrieves\_default\_disabled\_dates = array(); |
| [1529](#L1529) | if(!empty($extra\_disabled\_dates)){ |
| [1530](#L1530) | foreach($extra\_disabled\_dates as $val){ |
| [1531](#L1531) | $bpa\_retrieves\_default\_disabled\_dates[] = date('Y-m-d H:i:s', strtotime( $val ) ); |
| [1532](#L1532) | } |
| [1533](#L1533) | $extra\_disabled\_dates = $bpa\_retrieves\_default\_disabled\_dates; |
| [1534](#L1534) | } |
| [1535](#L1535) |  |
| [1536](#L1536) | $extra\_disabled\_dates = array\_values( $extra\_disabled\_dates ); |
| [1537](#L1537) |  |
| [1538](#L1538) | $response[ 'days\_off\_disabled\_dates' ] = implode( ',', $daysoff\_dates ); |
| [1539](#L1539) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$extra\_disabled\_dates ); |
| [1540](#L1540) |  |
| [1541](#L1541) | $response['next\_month'] = date( 'm', strtotime( $first\_date\_of\_month . '+1 month') ); |
| [1542](#L1542) | $response['next\_year'] =  date( 'Y', strtotime( $first\_date\_of\_month . '+1 month') ); |
| [1543](#L1543) |  |
| [1544](#L1544) | $next\_month\_check = date('Y-m', strtotime( $response['next\_year'] .'-'. $response['next\_month'] .'-01' ) ); |
| [1545](#L1545) |  |
| [1546](#L1546) | $max\_available\_year = !empty( $\_POST['max\_available\_year'] ) ? sanitize\_text\_field( $\_POST['max\_available\_year'] ) : ''; // phpcs:ignore |
| [1547](#L1547) | $max\_month\_check = date('Y-m', strtotime( $max\_available\_year . '-' . $max\_available\_month . '-01' ) ); // phpcs:ignore |
| [1548](#L1548) |  |
| [1549](#L1549) | if( strtotime( $max\_month\_check ) < strtotime( $next\_month\_check ) ){ |
| [1550](#L1550) | $response['prevent\_next\_month\_check'] = true; |
| [1551](#L1551) | } |
| [1552](#L1552) |  |
| [1553](#L1553) | $response = array\_merge( $\_POST, $response ); // phpcs:ignore |
| [1554](#L1554) | if($return\_data == true){ |
| [1555](#L1555) | return $response; |
| [1556](#L1556) | } |
| [1557](#L1557) | echo wp\_json\_encode( $response ); |
| [1558](#L1558) |  |
| [1559](#L1559) | die; |
| [1560](#L1560) | } |
| [1561](#L1561) |  |
| [1562](#L1562) | function bookingpress\_retrieve\_entire\_month\_data\_callback(){ |
| [1563](#L1563) | $start\_ms = microtime( true ); |
| [1564](#L1564) | $response              = []; |
| [1565](#L1565) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1566](#L1566) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1567](#L1567) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1568](#L1568) | $response['variant']      = 'error'; |
| [1569](#L1569) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1570](#L1570) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1571](#L1571) | $response['redirect\_url'] = ''; |
| [1572](#L1572) | if($return\_data){ |
| [1573](#L1573) | return $response; |
| [1574](#L1574) | } |
| [1575](#L1575) | wp\_send\_json($response); |
| [1576](#L1576) | die(); |
| [1577](#L1577) | } |
| [1578](#L1578) |  |
| [1579](#L1579) | $bookingpress\_start\_date = !empty( $\_POST['from\_date'] ) ? sanitize\_text\_field( $\_POST['from\_date'] ) : date('Y-m-d', current\_time( 'timestamp' ) ) .' 00:00:00'; |
| [1580](#L1580) |  |
| [1581](#L1581) | $bookingpress\_start\_date = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [1582](#L1582) |  |
| [1583](#L1583) | $entire\_month\_details = $this->bookingpress\_retrieve\_timeslot\_data\_callback( $bookingpress\_start\_date, true ); |
| [1584](#L1584) |  |
| [1585](#L1585) | $working\_hour\_details = $entire\_month\_details['working\_details']; |
| [1586](#L1586) | $last\_date = array\_key\_last( $working\_hour\_details ); |
| [1587](#L1587) |  |
| [1588](#L1588) | $response['working\_details'] = $working\_hour\_details; |
| [1589](#L1589) | $response['last\_date'] = $last\_date; |
| [1590](#L1590) | $response['next\_month\_date'] = $entire\_month\_details['next\_month\_date']; |
| [1591](#L1591) | $response['stop\_check'] = $entire\_month\_details['stop\_check']; |
| [1592](#L1592) | $response['working\_hour\_timing\_token'] = $entire\_month\_details['working\_hour\_timing\_token']; |
| [1593](#L1593) | $response['bpa\_disabled\_dates'] = $entire\_month\_details['bpa\_disabled\_dates']; |
| [1594](#L1594) | $response['overnight\_booking\_dates'] = $entire\_month\_details['overnight\_booking\_dates']; |
| [1595](#L1595) |  |
| [1596](#L1596) | $end\_ms = microtime( true ); |
| [1597](#L1597) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [1598](#L1598) |  |
| [1599](#L1599) | echo json\_encode( $response ); |
| [1600](#L1600) | die; |
| [1601](#L1601) |  |
| [1602](#L1602) | } |
| [1603](#L1603) |  |
| [1604](#L1604) | function bookingpress\_set\_timeslot\_token\_transient(){ |
| [1605](#L1605) | $start\_ms = microtime( true ); |
| [1606](#L1606) | global $wpdb; |
| [1607](#L1607) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1608](#L1608) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1609](#L1609) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1610](#L1610) | $response['variant']      = 'error'; |
| [1611](#L1611) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1612](#L1612) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1613](#L1613) | $response['redirect\_url'] = ''; |
| [1614](#L1614) | if($return\_data){ |
| [1615](#L1615) | return $response; |
| [1616](#L1616) | } |
| [1617](#L1617) | wp\_send\_json($response); |
| [1618](#L1618) | die(); |
| [1619](#L1619) | } |
| [1620](#L1620) |  |
| [1621](#L1621) | $tokenData = !empty( $\_POST['tokenData'] ) ? sanitize\_text\_field( $\_POST['tokenData'] ) : ''; |
| [1622](#L1622) |  |
| [1623](#L1623) | if( !empty( $tokenData ) ){ |
| [1624](#L1624) | $token\_json = json\_decode( base64\_decode( $tokenData ), true ); |
| [1625](#L1625) | $this->bookingpress\_update\_transient( $token\_json['token\_key'], $token\_json['token\_data'], HOUR\_IN\_SECONDS ); |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | die; |
| [1629](#L1629) | } |
| [1630](#L1630) |  |
| [1631](#L1631) | function bookingpress\_retrieve\_timeslot\_data\_callback( $start\_date = '', $return = false, $use\_start\_date = false ){ |
| [1632](#L1632) |  |
| [1633](#L1633) | $start\_ms = microtime( true ); |
| [1634](#L1634) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_default\_workhours; |
| [1635](#L1635) |  |
| [1636](#L1636) | $response = []; |
| [1637](#L1637) |  |
| [1638](#L1638) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1639](#L1639) |  |
| [1640](#L1640) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1641](#L1641) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1642](#L1642) | $response['variant']      = 'error'; |
| [1643](#L1643) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1644](#L1644) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1645](#L1645) | $response['redirect\_url'] = ''; |
| [1646](#L1646) | if($return\_data){ |
| [1647](#L1647) | return $response; |
| [1648](#L1648) | } |
| [1649](#L1649) | wp\_send\_json($response); |
| [1650](#L1650) | die(); |
| [1651](#L1651) | } |
| [1652](#L1652) |  |
| [1653](#L1653) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [1654](#L1654) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [1655](#L1655) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1656](#L1656) | } |
| [1657](#L1657) |  |
| [1658](#L1658) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1659](#L1659) |  |
| [1660](#L1660) | $bpa\_get\_external\_response = apply\_filters( 'bookingpress\_fetch\_appointment\_timeslot\_external\_data', [], $bookingpress\_appointment\_data ); |
| [1661](#L1661) |  |
| [1662](#L1662) | if( !empty( $bpa\_get\_external\_response ) && !empty( $bpa\_get\_external\_response['stop\_process'] ) && true == $bpa\_get\_external\_response['stop\_process'] ){ |
| [1663](#L1663) | echo wp\_json\_encode( $bpa\_get\_external\_response ); |
| [1664](#L1664) | die; |
| [1665](#L1665) | } |
| [1666](#L1666) |  |
| [1667](#L1667) | $current\_date = date( 'Y-m-d', current\_time( 'timestamp' ) ); |
| [1668](#L1668) |  |
| [1669](#L1669) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [1670](#L1670) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [1671](#L1671) | $get\_period\_available\_for\_booking = 365; |
| [1672](#L1672) | } |
| [1673](#L1673) |  |
| [1674](#L1674) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp') ); |
| [1675](#L1675) |  |
| [1676](#L1676) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [1677](#L1677) |  |
| [1678](#L1678) | if(empty($bookingpress\_selected\_service)){ |
| [1679](#L1679) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [1680](#L1680) | } |
| [1681](#L1681) |  |
| [1682](#L1682) | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
| [1683](#L1683) | $get\_period\_available\_for\_booking = apply\_filters( 'bookingpress\_modify\_max\_available\_time\_for\_booking', $get\_period\_available\_for\_booking, $bookingpress\_start\_date, $bookingpress\_selected\_service ); |
| [1684](#L1684) |  |
| [1685](#L1685) | $bookingpress\_max\_date = date('Y-m-d', strtotime( '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [1686](#L1686) |  |
| [1687](#L1687) | $max\_service\_capacity = 1; |
| [1688](#L1688) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [1689](#L1689) |  |
| [1690](#L1690) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [1691](#L1691) |  |
| [1692](#L1692) | if( !empty( $start\_date ) ){ |
| [1693](#L1693) | $bookingpress\_start\_date = $start\_date; |
| [1694](#L1694) | } else { |
| [1695](#L1695) | $bookingpress\_start\_date = $current\_date; |
| [1696](#L1696) | } |
| [1697](#L1697) |  |
| [1698](#L1698) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [1699](#L1699) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [1700](#L1700) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [1701](#L1701) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [1702](#L1702) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | $service\_duration\_val = $bookingpress\_appointment\_data['selected\_service\_duration']; |
| [1707](#L1707) | $service\_duration\_unit = $bookingpress\_appointment\_data['selected\_service\_duration\_unit']; |
| [1708](#L1708) |  |
| [1709](#L1709) | $selected\_date = !empty( $\_REQUEST['selected\_date'] ) ? sanitize\_text\_field( $\_REQUEST['selected\_date'] ) : ""; |
| [1710](#L1710) |  |
| [1711](#L1711) | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
| [1712](#L1712) | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
| [1713](#L1713) |  |
| [1714](#L1714) | $selected\_service\_duration\_in\_min = ''; |
| [1715](#L1715) | if( 'm' == $selected\_service\_duration\_unit ){ |
| [1716](#L1716) | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
| [1717](#L1717) | } else { |
| [1718](#L1718) | if( 'h' == $selected\_service\_duration\_unit ){ |
| [1719](#L1719) | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
| [1720](#L1720) | } |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [1724](#L1724) |  |
| [1725](#L1725) | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
| [1726](#L1726) |  |
| [1727](#L1727) | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
| [1728](#L1728) | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
| [1729](#L1729) |  |
| [1730](#L1730) |  |
| [1731](#L1731) | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [1732](#L1732) |  |
| [1733](#L1733) | /\*\* Get the default days off in the above limit \*/ |
| [1734](#L1734) | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
| [1735](#L1735) |  |
| [1736](#L1736) | //$bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
| [1737](#L1737) |  |
| [1738](#L1738) | if( true == $use\_start\_date ){ |
| [1739](#L1739) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $start\_date ) ) ); |
| [1740](#L1740) | } else if( !empty( $selected\_date ) ){ |
| [1741](#L1741) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $selected\_date ) ) ); |
| [1742](#L1742) | } else { |
| [1743](#L1743) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $bookingpress\_start\_date ) ) ); |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | $bpa\_begin\_date = new DateTime( $bookingpress\_start\_date ); |
| [1747](#L1747) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [1748](#L1748) |  |
| [1749](#L1749) | $max\_end\_date = $bpa\_end\_date->format('Y-m-d'); |
| [1750](#L1750) |  |
| [1751](#L1751) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [1752](#L1752) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [1753](#L1753) |  |
| [1754](#L1754) | $working\_hour\_details = []; |
| [1755](#L1755) | $working\_hour\_timing\_token = []; |
| [1756](#L1756) | $disable\_dates = []; |
| [1757](#L1757) | $preselected\_date = ( !empty( $\_REQUEST['is\_preselect'] ) && (true === $\_REQUEST['is\_preselect'] || 'true' == $\_REQUEST['is\_preselect']) ) ? true : false; |
| [1758](#L1758) | $stop\_check = false; |
| [1759](#L1759) |  |
| [1760](#L1760) | $total\_dates = []; |
| [1761](#L1761) |  |
| [1762](#L1762) | $total\_booked\_appointment = []; |
| [1763](#L1763) |  |
| [1764](#L1764) | $bookingpress\_show\_time\_as\_per\_service\_duration = $BookingPress->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [1765](#L1765) | $bookingpress\_shared\_service\_timeslot = $BookingPress->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [1766](#L1766) | /\*\* total booked appointment of the selected date \*/ |
| [1767](#L1767) | $where\_clause = ''; |
| [1768](#L1768) | if( 'true' != $bookingpress\_shared\_service\_timeslot ){ |
| [1769](#L1769) | $where\_clause = $wpdb->prepare( ' AND bookingpress\_service\_id = %d ', $bookingpress\_selected\_service ); |
| [1770](#L1770) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_where\_clause', $where\_clause ); |
| [1771](#L1771) | }else{ |
| [1772](#L1772) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$bookingpress\_selected\_service); |
| [1773](#L1773) | } |
| [1774](#L1774) |  |
| [1775](#L1775) | $where\_clause .= $wpdb->prepare( ' AND (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s)', '1', '2' ); |
| [1776](#L1776) |  |
| [1777](#L1777) | if( strtotime( $bookingpress\_start\_date ) == strtotime( $bpa\_end\_date->format('Y-m-d') ) ){ |
| [1778](#L1778) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime( 'last day of this month', strtotime( $bpa\_end\_date->format('Y-m-d') ) ) ) ); |
| [1779](#L1779) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [1780](#L1780) | } |
| [1781](#L1781) |  |
| [1782](#L1782) | $booked\_check\_dates = []; |
| [1783](#L1783) | foreach( $period as $dt ){ |
| [1784](#L1784) | $bpa\_sel\_date = $dt->format( 'Y-m-d' ); |
| [1785](#L1785) | $booked\_check\_dates[] = $bpa\_sel\_date; |
| [1786](#L1786) | } |
| [1787](#L1787) |  |
| [1788](#L1788) | foreach( $bpa\_retrieves\_default\_disabled\_dates as $bpa\_key => $disabled\_date ){ |
| [1789](#L1789) | $bpa\_retrieves\_default\_disabled\_dates[ $bpa\_key ] = date('Y-m-d', strtotime( $disabled\_date ) ); |
| [1790](#L1790) | } |
| [1791](#L1791) |  |
| [1792](#L1792) | $selected\_where\_in  = ' AND bookingpress\_appointment\_date IN ('; |
| [1793](#L1793) | $selected\_where\_in .= rtrim( str\_repeat( '%s,', count( $booked\_check\_dates ) ), ',' ).' )'; |
| [1794](#L1794) |  |
| [1795](#L1795) | array\_unshift( $booked\_check\_dates, $selected\_where\_in ); |
| [1796](#L1796) |  |
| [1797](#L1797) | $selected\_where\_clause = call\_user\_func\_array( array( $wpdb, 'prepare' ), $booked\_check\_dates ); |
| [1798](#L1798) |  |
| [1799](#L1799) | $where\_clause .= $selected\_where\_clause; |
| [1800](#L1800) |  |
| [1801](#L1801) | $total\_booked\_appiontments = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE 1 = 1 $where\_clause", ARRAY\_A ); // phpcs:ignore |
| [1802](#L1802) | /\*\* Reputelog - new code - need to check for optimization start \*/ |
| [1803](#L1803) |  |
| [1804](#L1804) | $first\_available\_date = ''; |
| [1805](#L1805) | $overnight\_booking\_dates = []; |
| [1806](#L1806) | foreach( $period as $dt ){ |
| [1807](#L1807) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [1808](#L1808) | if( $bookingpress\_max\_date < $bpa\_check\_date ){ |
| [1809](#L1809) | $max\_end\_date = date('Y-m-d', strtotime( $bookingpress\_max\_date ) ); |
| [1810](#L1810) | $stop\_check = true; |
| [1811](#L1811) | $response['stop\_check'] = true; |
| [1812](#L1812) | break; |
| [1813](#L1813) | } |
| [1814](#L1814) |  |
| [1815](#L1815) | if( !empty( $bpa\_retrieves\_default\_disabled\_dates ) && in\_array( $bpa\_check\_date, $bpa\_retrieves\_default\_disabled\_dates ) ){ |
| [1816](#L1816) | continue; |
| [1817](#L1817) | } |
| [1818](#L1818) |  |
| [1819](#L1819) | $bpa\_check\_datetime = $dt->format( 'Y-m-d H:i:s'); |
| [1820](#L1820) | $front\_timings\_data = $bookingpress\_appointment\_bookings->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, false, false, $total\_booked\_appiontments ); |
| [1821](#L1821) |  |
| [1822](#L1822) |  |
| [1823](#L1823) | $front\_timings\_data\_combined = array\_merge( |
| [1824](#L1824) | $front\_timings\_data['morning\_time'], |
| [1825](#L1825) | $front\_timings\_data['afternoon\_time'], |
| [1826](#L1826) | $front\_timings\_data['evening\_time'], |
| [1827](#L1827) | $front\_timings\_data['night\_time'] |
| [1828](#L1828) | ); |
| [1829](#L1829) |  |
| [1830](#L1830) | $total\_available\_slots = count( $front\_timings\_data\_combined ); |
| [1831](#L1831) | $is\_booked = false; |
| [1832](#L1832) | $total\_booked = 0; |
| [1833](#L1833) | foreach( $front\_timings\_data\_combined as $slot\_data ){ |
| [1834](#L1834) | if( !empty( $slot\_data['is\_booked'] ) && 1 == $slot\_data['is\_booked'] ){ |
| [1835](#L1835) | $total\_booked++; |
| [1836](#L1836) | } |
| [1837](#L1837) | } |
| [1838](#L1838) |  |
| [1839](#L1839) | $bookingpress\_allow\_to\_disable\_booked\_date = apply\_filters('bookingpress\_allow\_to\_disable\_booked\_date',true,$bookingpress\_selected\_service); |
| [1840](#L1840) |  |
| [1841](#L1841) | if( $total\_booked == $total\_available\_slots && $bookingpress\_allow\_to\_disable\_booked\_date == true ){ |
| [1842](#L1842) | $front\_timings\_data\_combined = []; |
| [1843](#L1843) | } |
| [1844](#L1844) |  |
| [1845](#L1845) | $wp\_timezone\_offset = wp\_timezone\_string(); |
| [1846](#L1846) | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
| [1847](#L1847) | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
| [1848](#L1848) | } |
| [1849](#L1849) |  |
| [1850](#L1850) |  |
| [1851](#L1851) |  |
| [1852](#L1852) | if( !empty( $front\_timings\_data\_combined ) ){ |
| [1853](#L1853) | foreach( $front\_timings\_data\_combined as $timeslot\_data ){ |
| [1854](#L1854) |  |
| [1855](#L1855) | if( empty( $first\_available\_date ) ){ |
| [1856](#L1856) | $first\_available\_date = $timeslot\_data['store\_service\_date']; |
| [1857](#L1857) | } |
| [1858](#L1858) |  |
| [1859](#L1859) | $is\_next\_date = !empty( $timeslot\_data['is\_next\_day'] ) ? $timeslot\_data['is\_next\_day'] : false; |
| [1860](#L1860) |  |
| [1861](#L1861) | $startDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
| [1862](#L1862) | $endDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_end\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
| [1863](#L1863) | $wp\_offset\_org = $startDateTime->getTimezone()->getName(); |
| [1864](#L1864) |  |
| [1865](#L1865) | $timeslot\_data['store\_offset'] = $wp\_offset\_org; |
| [1866](#L1866) |  |
| [1867](#L1867) | $start\_time = date('Y-m-d H:i:s', strtotime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'] ) ); |
| [1868](#L1868) |  |
| [1869](#L1869) | if( true == $is\_next\_date && $timeslot\_data['store\_service\_date'] != $timeslot\_data['selected\_date']){ |
| [1870](#L1870) | $tmpStartDateTime = clone $startDateTime; |
| [1871](#L1871) | $tmpStartDateTime->modify( '-1 day'); |
| [1872](#L1872) | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $tmpStartDateTime->format('Y-m-d'), $start\_time ); |
| [1873](#L1873) | } else { |
| [1874](#L1874) | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $startDateTime->format('Y-m-d'), $start\_time ); |
| [1875](#L1875) | } |
| [1876](#L1876) |  |
| [1877](#L1877) | $working\_hour\_details[ $start\_datetime ][] = $timeslot\_data; |
| [1878](#L1878) |  |
| [1879](#L1879) | if( !isset( $working\_hour\_timing\_token[ $start\_datetime ]) ){ |
| [1880](#L1880) | $working\_hour\_timing\_token[ $start\_datetime ] = []; |
| [1881](#L1881) | } |
| [1882](#L1882) | if( !in\_array( $front\_timings\_data['timing\_token\_data'], $working\_hour\_timing\_token[ $start\_datetime ] ) ){ |
| [1883](#L1883) | $working\_hour\_timing\_token[ $start\_datetime ][] = $front\_timings\_data['timing\_token\_data']; |
| [1884](#L1884) | } |
| [1885](#L1885) | if( !empty( $timeslot\_data['is\_next\_day'] ) && !in\_array( $start\_datetime, $overnight\_booking\_dates ) ){ |
| [1886](#L1886) | $overnight\_booking\_dates[] = $start\_datetime; |
| [1887](#L1887) | } |
| [1888](#L1888) | } |
| [1889](#L1889) |  |
| [1890](#L1890) | if( empty( $selected\_date ) ){ |
| [1891](#L1891) | $selected\_date = $start\_datetime; |
| [1892](#L1892) | } else { |
| [1893](#L1893) | if( !empty( $start\_date ) ){ |
| [1894](#L1894) | $preselected\_date = true; |
| [1895](#L1895) | } |
| [1896](#L1896) | } |
| [1897](#L1897) |  |
| [1898](#L1898) | if( strtotime( $selected\_date ) < strtotime( $first\_available\_date ) ){ |
| [1899](#L1899) | $selected\_date = $first\_available\_date; |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | } |
| [1903](#L1903) |  |
| [1904](#L1904) | if( empty( $working\_hour\_details ) && false == $stop\_check ){ |
| [1905](#L1905) | $working\_hour\_updated\_data = $this->bookingpress\_retrieve\_timeslot\_data\_callback( $max\_end\_date, true, true ); |
| [1906](#L1906) |  |
| [1907](#L1907) | $working\_hour\_details = $working\_hour\_updated\_data['working\_details']; |
| [1908](#L1908) | $working\_hour\_timing\_token = $working\_hour\_updated\_data['working\_hour\_timing\_token']; |
| [1909](#L1909) | $bpa\_retrieves\_default\_disabled\_dates = $working\_hour\_updated\_data['bpa\_disabled\_dates']; |
| [1910](#L1910) | $max\_end\_date = $working\_hour\_updated\_data['next\_month\_date']; |
| [1911](#L1911) | $preselected\_date = $working\_hour\_updated\_data['pre\_selected\_date']; |
| [1912](#L1912) | $stop\_check = $working\_hour\_updated\_data['stop\_check']; |
| [1913](#L1913) | $selected\_date = $working\_hour\_updated\_data['selected\_date']; |
| [1914](#L1914) | $overnight\_booking\_dates = $working\_hour\_updated\_data['overnight\_booking\_dates']; |
| [1915](#L1915) | } |
| [1916](#L1916) |  |
| [1917](#L1917) | /\*\* Reputelog - new code - need to check for optimization End \*/ |
| [1918](#L1918) |  |
| [1919](#L1919) | if( !empty( $bookingpress\_appointment\_data['appointment\_update\_id'] ) ){ |
| [1920](#L1920) | $preselected\_date = true; |
| [1921](#L1921) | $selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [1922](#L1922) | } |
| [1923](#L1923) |  |
| [1924](#L1924) |  |
| [1925](#L1925) | $response['working\_details'] = $working\_hour\_details; |
| [1926](#L1926) | $response['working\_hour\_timing\_token'] = $working\_hour\_timing\_token; |
| [1927](#L1927) | $response['next\_month\_date'] = $max\_end\_date; |
| [1928](#L1928) | $response['pre\_selected\_date'] = $preselected\_date; |
| [1929](#L1929) | $response['overnight\_booking\_dates'] = $overnight\_booking\_dates; |
| [1930](#L1930) | $response['bpa\_disabled\_dates'] = $bpa\_retrieves\_default\_disabled\_dates; |
| [1931](#L1931) | $response['stop\_check'] = ( false == $stop\_check && ( $bookingpress\_max\_date <= $max\_end\_date ) ) ? true : $stop\_check; |
| [1932](#L1932) | $response['variant'] = 'success'; |
| [1933](#L1933) | $response['selected\_date']  = $selected\_date; |
| [1934](#L1934) |  |
| [1935](#L1935) |  |
| [1936](#L1936) | if( true == $return ){ |
| [1937](#L1937) | return $response; |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [1941](#L1941) |  |
| [1942](#L1942) | $end\_ms = microtime( true ); |
| [1943](#L1943) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [1944](#L1944) |  |
| [1945](#L1945) | $response = apply\_filters( 'bookingpress\_modify\_disable\_timeslot\_external', $response ); |
| [1946](#L1946) |  |
| [1947](#L1947) | echo wp\_json\_encode( $response ); |
| [1948](#L1948) | die; |
| [1949](#L1949) | } |
| [1950](#L1950) |  |
| [1951](#L1951) | function bookingpress\_get\_disable\_date\_func(){ |
| [1952](#L1952) |  |
| [1953](#L1953) | global $BookingPress; |
| [1954](#L1954) |  |
| [1955](#L1955) | $use\_legacy = false; |
| [1956](#L1956) | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.0', '<') ){ |
| [1957](#L1957) | $use\_legacy = true; |
| [1958](#L1958) | } |
| [1959](#L1959) |  |
| [1960](#L1960) | if( !$use\_legacy && is\_plugin\_active( 'bookingpress-custom-service-duration/bookingpress-custom-service-duration.php') ){ |
| [1961](#L1961) | global $bookingpress\_custom\_service\_duration\_version; |
| [1962](#L1962) |  |
| [1963](#L1963) | if( version\_compare( $bookingpress\_custom\_service\_duration\_version, '1.7', '<') ){ |
| [1964](#L1964) | $use\_legacy = true; |
| [1965](#L1965) | } |
| [1966](#L1966) | } |
| [1967](#L1967) |  |
| [1968](#L1968) | if( !$use\_legacy && is\_plugin\_active( 'bookingpress-waiting-list/bookingpress-waiting-list.php' ) ){ |
| [1969](#L1969) | global $bookingpress\_waiting\_list\_version; |
| [1970](#L1970) |  |
| [1971](#L1971) | if( version\_compare( $bookingpress\_waiting\_list\_version, '1.2', '<') ){ |
| [1972](#L1972) | $use\_legacy = true; |
| [1973](#L1973) | } |
| [1974](#L1974) | } |
| [1975](#L1975) |  |
| [1976](#L1976) | if( true == $use\_legacy ){ |
| [1977](#L1977) | $this->bookingpress\_get\_disable\_date\_func\_legacy(); |
| [1978](#L1978) | } else { |
| [1979](#L1979) | $this->bookingpress\_get\_disable\_date\_func\_optimized(); |
| [1980](#L1980) | } |
| [1981](#L1981) |  |
| [1982](#L1982) | } |
| [1983](#L1983) |  |
| [1984](#L1984) | function bookingpress\_get\_disable\_date\_func\_optimized($return\_data = false){ |
| [1985](#L1985) |  |
| [1986](#L1986) | $start\_ms = microtime( true ); |
| [1987](#L1987) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs; |
| [1988](#L1988) | $response              = array(); |
| [1989](#L1989) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1990](#L1990) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1991](#L1991) |  |
| [1992](#L1992) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1993](#L1993) | $response['variant']      = 'error'; |
| [1994](#L1994) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1995](#L1995) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1996](#L1996) | $response['redirect\_url'] = ''; |
| [1997](#L1997) | if($return\_data){ |
| [1998](#L1998) | return $response; |
| [1999](#L1999) | } |
| [2000](#L2000) | wp\_send\_json($response); |
| [2001](#L2001) | die(); |
| [2002](#L2002) | } |
| [2003](#L2003) |  |
| [2004](#L2004) | $response['variant']    = 'error'; |
| [2005](#L2005) | $response['title']      = 'Error'; |
| [2006](#L2006) | $response['msg']        = 'Something went wrong....'; |
| [2007](#L2007) |  |
| [2008](#L2008) | //$consider\_selected\_date = false; |
| [2009](#L2009) |  |
| [2010](#L2010) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [2011](#L2011) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [2012](#L2012) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2013](#L2013) | } |
| [2014](#L2014) |  |
| [2015](#L2015) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2016](#L2016) | $bookingpress\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2017](#L2017) |  |
| [2018](#L2018) | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
| [2019](#L2019) | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
| [2020](#L2020) |  |
| [2021](#L2021) | $selected\_service\_duration\_in\_min = ''; |
| [2022](#L2022) | if( 'm' == $selected\_service\_duration\_unit ){ |
| [2023](#L2023) | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
| [2024](#L2024) | } else { |
| [2025](#L2025) | if( 'h' == $selected\_service\_duration\_unit ){ |
| [2026](#L2026) | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
| [2027](#L2027) | } |
| [2028](#L2028) | } |
| [2029](#L2029) |  |
| [2030](#L2030) | if(!empty($bookingpress\_selected\_date)){ |
| [2031](#L2031) | $bookingpress\_selected\_date = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2032](#L2032) | } |
| [2033](#L2033) |  |
| [2034](#L2034) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2035](#L2035) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2036](#L2036) | } |
| [2037](#L2037) |  |
| [2038](#L2038) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [2039](#L2039) |  |
| [2040](#L2040) | if(empty($bookingpress\_selected\_service)){ |
| [2041](#L2041) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [2042](#L2042) | } |
| [2043](#L2043) |  |
| [2044](#L2044) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [2045](#L2045) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [2046](#L2046) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [2047](#L2047) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [2048](#L2048) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [2049](#L2049) | } |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* get maximum period available from booking \*/ |
| [2053](#L2053) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [2054](#L2054) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [2055](#L2055) | $get\_period\_available\_for\_booking = 365; |
| [2056](#L2056) | } |
| [2057](#L2057) |  |
| [2058](#L2058) | $posted\_disabled\_dates = !empty( $\_POST['disabled\_dates'] ) ? json\_decode( stripslashes\_deep( $\_POST['disabled\_dates'] ), true ) : array(); // phpcs:ignore |
| [2059](#L2059) |  |
| [2060](#L2060) | if( !empty( $posted\_disabled\_dates ) ){ |
| [2061](#L2061) | $posted\_disabled\_dates = array\_filter( $posted\_disabled\_dates ); |
| [2062](#L2062) | } |
| [2063](#L2063) |  |
| [2064](#L2064) | $max\_service\_capacity = 1; |
| [2065](#L2065) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [2066](#L2066) |  |
| [2067](#L2067) | if( !empty( $bookingpress\_selected\_service ) ){ |
| [2068](#L2068) |  |
| [2069](#L2069) | $response['prevent\_next\_month\_check'] = false; |
| [2070](#L2070) |  |
| [2071](#L2071) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2072](#L2072) |  |
| [2073](#L2073) | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [2074](#L2074) |  |
| [2075](#L2075) | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
| [2076](#L2076) |  |
| [2077](#L2077) | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
| [2078](#L2078) | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
| [2079](#L2079) |  |
| [2080](#L2080) | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [2081](#L2081) |  |
| [2082](#L2082) | $exclude\_dates = array(); |
| [2083](#L2083) | if( $bookingpress\_start\_date\_initial != $bookingpress\_start\_date ){ |
| [2084](#L2084) | //$start\_date\_with\_time = date('Y-m-d H:i:s', strtotime( $bookingpress\_start\_date\_initial ) ); |
| [2085](#L2085) |  |
| [2086](#L2086) | $timestamp\_init\_date = strtotime( $bookingpress\_start\_date\_with\_time ); |
| [2087](#L2087) | $timestamp\_start\_date = strtotime( $bookingpress\_start\_date ); |
| [2088](#L2088) |  |
| [2089](#L2089) | $time\_diff\_minuts =  round(abs($timestamp\_start\_date - $timestamp\_init\_date) / 60,2); |
| [2090](#L2090) |  |
| [2091](#L2091) | if( 1440 >= $time\_diff\_minuts ){ |
| [2092](#L2092) | $exclude\_dates[] = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [2093](#L2093) | } |
| [2094](#L2094) |  |
| [2095](#L2095) | } |
| [2096](#L2096) |  |
| [2097](#L2097) |  |
| [2098](#L2098) | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
| [2099](#L2099) | $get\_period\_available\_for\_booking = apply\_filters( 'bookingpress\_modify\_max\_available\_time\_for\_booking', $get\_period\_available\_for\_booking, $bookingpress\_start\_date, $bookingpress\_selected\_service ); |
| [2100](#L2100) |  |
| [2101](#L2101) | /\* if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2102](#L2102) | $bookingpress\_start\_date = $bpa\_selected\_date; |
| [2103](#L2103) | } \*/ |
| [2104](#L2104) |  |
| [2105](#L2105) | $bookingpress\_temp\_end\_date = date('Y-m-d', strtotime('last day of this month', strtotime( $bookingpress\_start\_date ))); |
| [2106](#L2106) |  |
| [2107](#L2107) | $bookingpress\_end\_date = date('Y-m-d', strtotime( '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2108](#L2108) |  |
| [2109](#L2109) | $next\_month = date( 'm', strtotime( $bookingpress\_temp\_end\_date . '+1 day' ) ); |
| [2110](#L2110) | $next\_year = date( 'Y', strtotime( $bookingpress\_temp\_end\_date . '+1 day' ) ); |
| [2111](#L2111) |  |
| [2112](#L2112) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [2113](#L2113) |  |
| [2114](#L2114) | /\*\* Get the default days off in the above limit \*/ |
| [2115](#L2115) | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
| [2116](#L2116) |  |
| [2117](#L2117) | $bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
| [2118](#L2118) |  |
| [2119](#L2119) | /\*\* loop through each days until the limit has been reached |
| [2120](#L2120) | \* for lite - it'll check for the next 365 days |
| [2121](#L2121) | \* for pro - it'll check up to the X number of days defined in the settings |
| [2122](#L2122) | \*/ |
| [2123](#L2123) | $bpa\_begin\_date = new DateTime( $bookingpress\_selected\_date ); |
| [2124](#L2124) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [2125](#L2125) |  |
| [2126](#L2126) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [2127](#L2127) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [2128](#L2128) |  |
| [2129](#L2129) | $bookingpress\_selected\_date = $bookingpress\_end\_date; |
| [2130](#L2130) | $front\_timings\_data = array(); |
| [2131](#L2131) |  |
| [2132](#L2132) | $count = 0; |
| [2133](#L2133) | $stop\_date = ''; |
| [2134](#L2134) |  |
| [2135](#L2135) |  |
| [2136](#L2136) |  |
| [2137](#L2137) | if( !empty( $bookingpress\_appointment\_data['appointment\_update\_id'] ) ){ |
| [2138](#L2138) | $sel\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2139](#L2139) | $front\_timings\_data = $this->bookingpress\_retrieve\_timeslots( $sel\_date, true ); |
| [2140](#L2140) | $bookingpress\_selected\_date = $sel\_date; |
| [2141](#L2141) | } else { |
| [2142](#L2142) | $empty\_slot\_dates = array(); |
| [2143](#L2143) | foreach( $period as $dt ){ |
| [2144](#L2144) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [2145](#L2145) |  |
| [2146](#L2146) | if( in\_array( $dt->format('Y-m-d H:i:s'), $bpa\_retrieves\_default\_disabled\_dates ) && !in\_array( $dt->format('Y-m-d'), $exclude\_dates )){ |
| [2147](#L2147) | continue; |
| [2148](#L2148) | } |
| [2149](#L2149) |  |
| [2150](#L2150) | /\*\* Stop the loop if the time slot is available & date is equals to the last day of the available date month \*/ |
| [2151](#L2151) | if( !empty( $stop\_date ) && $bpa\_check\_date > date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $stop\_date) ) ) ){ |
| [2152](#L2152) | $last\_date = date('Y-m-d', strtotime( 'last day of this month', strtotime( $stop\_date ) ) ); |
| [2153](#L2153) | $next\_month = date('m', strtotime( $last\_date . '+1 day') ); |
| [2154](#L2154) | $next\_year = date('Y', strtotime( $last\_date . '+1 day') ); |
| [2155](#L2155) | break; |
| [2156](#L2156) | } |
| [2157](#L2157) |  |
| [2158](#L2158) | $bookingpress\_time\_slots = $this->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, true, false ); |
| [2159](#L2159) |  |
| [2160](#L2160) | if( empty( $bookingpress\_time\_slots ) ){ |
| [2161](#L2161) | $bpa\_retrieves\_default\_disabled\_dates[] = date('Y-m-d H:i:s', strtotime( $bpa\_check\_date ) ); |
| [2162](#L2162) | $empty\_slot\_dates[] = date('Y-m-d', strtotime( $bpa\_check\_date ) ); |
| [2163](#L2163) | } else { |
| [2164](#L2164) | if( $count < 1 ){ |
| [2165](#L2165) | $date1 = new DateTime( $bookingpress\_start\_date ); |
| [2166](#L2166) | $date2 = new DateTime( $bpa\_check\_date ); |
| [2167](#L2167) | $interval = $date1->diff($date2); |
| [2168](#L2168) | $interval\_in\_days = $interval->days; |
| [2169](#L2169) | if( $interval\_in\_days < $get\_period\_available\_for\_booking ){ |
| [2170](#L2170) | $bookingpress\_selected\_date = $bpa\_check\_date; |
| [2171](#L2171) | /\*\* Check if the selected date is greater than end date in respect to service expiration \*/ |
| [2172](#L2172) | $front\_timings\_data = $this->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true ); |
| [2173](#L2173) |  |
| [2174](#L2174) | $stop\_date = $bpa\_check\_date; |
| [2175](#L2175) | $count++; |
| [2176](#L2176) | } |
| [2177](#L2177) | } |
| [2178](#L2178) | } |
| [2179](#L2179) | } |
| [2180](#L2180) | } |
| [2181](#L2181) |  |
| [2182](#L2182) | $bookingpress\_disable\_date = array(); |
| [2183](#L2183) | foreach( $bpa\_retrieves\_default\_disabled\_dates as $dis\_key => $disabled\_dates ){ |
| [2184](#L2184) | $dis\_date = date('Y-m-d', strtotime( $disabled\_dates) ); |
| [2185](#L2185) | if( !empty( $exclude\_dates ) && in\_array( $dis\_date, $exclude\_dates ) && ( empty( $empty\_slot\_dates ) || !in\_array( $dis\_date, $empty\_slot\_dates ) ) ){ |
| [2186](#L2186) | unset( $bpa\_retrieves\_default\_disabled\_dates[ $dis\_key ] ); |
| [2187](#L2187) | continue; |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | $bookingpress\_disable\_date[] = date('c', strtotime( $disabled\_dates ) ); |
| [2191](#L2191) | } |
| [2192](#L2192) |  |
| [2193](#L2193) | $bpa\_retrieves\_default\_disabled\_dates = array\_values( $bpa\_retrieves\_default\_disabled\_dates ); |
| [2194](#L2194) |  |
| [2195](#L2195) | $attributes = array(); |
| [2196](#L2196) |  |
| [2197](#L2197) | $response['prevent\_next\_month\_check'] = false; |
| [2198](#L2198) | if( !empty( $get\_period\_available\_for\_booking ) ){ |
| [2199](#L2199) | $bookingpress\_current\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2200](#L2200) | $max\_available\_date = date('Y-m-d', strtotime( $bookingpress\_current\_date . '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2201](#L2201) | $response['max\_available\_date'] = $max\_available\_date; |
| [2202](#L2202) | $response['max\_available\_month'] = date('m', strtotime( $max\_available\_date ) ); |
| [2203](#L2203) | $response['max\_available\_year'] = date('Y', strtotime( $max\_available\_date ) ); |
| [2204](#L2204) | if( isset($response['selected\_date']) && $max\_available\_date < $response['selected\_date'] ){ |
| [2205](#L2205) | $response['front\_timings'] = array(); |
| [2206](#L2206) | $response['next\_month'] = $next\_month; |
| [2207](#L2207) | if($return\_data){ |
| [2208](#L2208) | return $response; |
| [2209](#L2209) | } |
| [2210](#L2210) | wp\_send\_json( $response ); |
| [2211](#L2211) | die; |
| [2212](#L2212) | } |
| [2213](#L2213) | } |
| [2214](#L2214) |  |
| [2215](#L2215) | if( !empty( $response['max\_available\_month'] ) && $next\_month > $response['max\_available\_month'] && $response['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ |
| [2216](#L2216) | $response['prevent\_next\_month\_check'] = true; |
| [2217](#L2217) | } |
| [2218](#L2218) |  |
| [2219](#L2219) |  |
| [2220](#L2220) | $response['variant']    = 'success'; |
| [2221](#L2221) | $response['title']      = 'Success'; |
| [2222](#L2222) | $response['msg']        = 'Data reterive successfully'; |
| [2223](#L2223) | $response['days\_off\_disabled\_dates']  =  implode(',',$bookingpress\_disable\_date ); |
| [2224](#L2224) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$bpa\_retrieves\_default\_disabled\_dates ); |
| [2225](#L2225) | $response['selected\_date']  = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2226](#L2226) | $response['next\_month'] = $next\_month; |
| [2227](#L2227) | $response['vcal\_attributes'] = $attributes; |
| [2228](#L2228) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [2229](#L2229) | $response['front\_timings'] = $front\_timings\_data; |
| [2230](#L2230) | $response['next\_year'] = $next\_year; |
| [2231](#L2231) | $response['msg']        = 'Data reterive successfully'; |
| [2232](#L2232) | } |
| [2233](#L2233) |  |
| [2234](#L2234) | $end\_ms = microtime( true ); |
| [2235](#L2235) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [2236](#L2236) |  |
| [2237](#L2237) | if($return\_data){ |
| [2238](#L2238) | return $response; |
| [2239](#L2239) | } |
| [2240](#L2240) | wp\_send\_json($response); |
| [2241](#L2241) | exit; |
| [2242](#L2242) | } |
| [2243](#L2243) |  |
| [2244](#L2244) | /\*\* |
| [2245](#L2245) | \* Get default disable dates |
| [2246](#L2246) | \* |
| [2247](#L2247) | \* @return void |
| [2248](#L2248) | \*/ |
| [2249](#L2249) | function bookingpress\_get\_disable\_date\_func\_legacy( $bpa\_selected\_date = '', $consider\_selected\_date = false, $counter = 1, $bpa\_total\_booked\_appointment = array(), $single\_disable\_date = array()) { |
| [2250](#L2250) |  |
| [2251](#L2251) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs; |
| [2252](#L2252) | $response              = array(); |
| [2253](#L2253) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [2254](#L2254) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [2255](#L2255) |  |
| [2256](#L2256) | if (! $bpa\_verify\_nonce\_flag ) { |
| [2257](#L2257) | $response['variant']      = 'error'; |
| [2258](#L2258) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2259](#L2259) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [2260](#L2260) | $response['redirect\_url'] = ''; |
| [2261](#L2261) | wp\_send\_json($response); |
| [2262](#L2262) | die(); |
| [2263](#L2263) | } |
| [2264](#L2264) |  |
| [2265](#L2265) | $response['variant']    = 'error'; |
| [2266](#L2266) | $response['title']      = 'Error'; |
| [2267](#L2267) | $response['msg']        = 'Something went wrong....'; |
| [2268](#L2268) |  |
| [2269](#L2269) |  |
| [2270](#L2270) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [2271](#L2271) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [2272](#L2272) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2273](#L2273) | } |
| [2274](#L2274) |  |
| [2275](#L2275) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2276](#L2276) | $bookingpress\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2277](#L2277) |  |
| [2278](#L2278) | if(!empty($bookingpress\_selected\_date)){ |
| [2279](#L2279) | $bookingpress\_selected\_date = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2283](#L2283) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2284](#L2284) | } |
| [2285](#L2285) |  |
| [2286](#L2286) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [2287](#L2287) |  |
| [2288](#L2288) | if(empty($bookingpress\_selected\_service)){ |
| [2289](#L2289) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [2290](#L2290) | } |
| [2291](#L2291) |  |
| [2292](#L2292) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [2293](#L2293) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [2294](#L2294) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [2295](#L2295) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [2296](#L2296) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [2297](#L2297) | } |
| [2298](#L2298) | } |
| [2299](#L2299) |  |
| [2300](#L2300) | if(empty($bookingpress\_selected\_date)){ |
| [2301](#L2301) | $bookingpress\_selected\_date = !empty( $bookingpress\_appointment\_data['selected\_date'] ) ? $bookingpress\_appointment\_data['selected\_date'] : date('Y-m-d', current\_time('timestamp') ); |
| [2302](#L2302) | } |
| [2303](#L2303) | if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2304](#L2304) | $bookingpress\_selected\_date = $bpa\_selected\_date; |
| [2305](#L2305) | } |
| [2306](#L2306) |  |
| [2307](#L2307) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2308](#L2308) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2309](#L2309) | } |
| [2310](#L2310) |  |
| [2311](#L2311) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [2312](#L2312) |  |
| [2313](#L2313) |  |
| [2314](#L2314) | $is\_multiple\_day\_event = false; |
| [2315](#L2315) | if( !empty( $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ) && 'd' == $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ){ |
| [2316](#L2316) | $is\_multiple\_day\_event = true; |
| [2317](#L2317) | $multiple\_day\_response = array(); |
| [2318](#L2318) | $multiple\_day\_response = apply\_filters( 'bookingpress\_get\_multiple\_days\_disable\_dates', $multiple\_day\_response, $bookingpress\_selected\_date, $bookingpress\_selected\_service, $bookingpress\_appointment\_data ); |
| [2319](#L2319) | if( !empty( $multiple\_day\_response ) ){ |
| [2320](#L2320) | echo wp\_json\_encode( $multiple\_day\_response ); |
| [2321](#L2321) | die; |
| [2322](#L2322) | } |
| [2323](#L2323) | } |
| [2324](#L2324) |  |
| [2325](#L2325) | if(!empty($bookingpress\_selected\_service)) { |
| [2326](#L2326) | $bookingpress\_disable\_date = $BookingPress->bookingpress\_get\_default\_dayoff\_dates('','',$bookingpress\_selected\_service,$bookingpress\_selected\_staffmember\_id); |
| [2327](#L2327) |  |
| [2328](#L2328) | $bookingpress\_disable\_date = apply\_filters('bookingpress\_modify\_disable\_dates', $bookingpress\_disable\_date, $bookingpress\_selected\_service, $bookingpress\_selected\_date, $bookingpress\_appointment\_data); |
| [2329](#L2329) |  |
| [2330](#L2330) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp')); |
| [2331](#L2331) | if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2332](#L2332) | $bookingpress\_start\_date = $bpa\_selected\_date; |
| [2333](#L2333) | } |
| [2334](#L2334) | $bookingpress\_end\_date = date('Y-m-d', strtotime('last day of this month', strtotime( $bookingpress\_start\_date ))); |
| [2335](#L2335) |  |
| [2336](#L2336) | $next\_month = date( 'm', strtotime( $bookingpress\_end\_date . '+1 day' ) ); |
| [2337](#L2337) | $next\_year = date( 'Y', strtotime( $bookingpress\_end\_date . '+1 day' ) ); |
| [2338](#L2338) |  |
| [2339](#L2339) | $bookingpress\_total\_booked\_appointment\_where\_clause = ''; |
| [2340](#L2340) | $bookingpress\_total\_booked\_appointment\_where\_clause = apply\_filters( 'bookingpress\_total\_booked\_appointment\_where\_clause', $bookingpress\_total\_booked\_appointment\_where\_clause ); |
| [2341](#L2341) |  |
| [2342](#L2342) | $max\_service\_capacity = 1; |
| [2343](#L2343) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [2344](#L2344) |  |
| [2345](#L2345) | $bpa\_begin\_date = new DateTime( $bookingpress\_start\_date ); |
| [2346](#L2346) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [2347](#L2347) |  |
| [2348](#L2348) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [2349](#L2349) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [2350](#L2350) |  |
| [2351](#L2351) | foreach ($period as $dt) { |
| [2352](#L2352) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [2353](#L2353) |  |
| [2354](#L2354) | $bpa\_check\_date\_formatted = $dt->format( 'c' ); |
| [2355](#L2355) | if( !empty( $bookingpress\_disable\_date) && in\_array( $bpa\_check\_date\_formatted, $bookingpress\_disable\_date ) ){ |
| [2356](#L2356) | continue; |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) | $bookingpress\_total\_appointment = $wpdb->get\_results($wpdb->prepare("SELECT bookingpress\_appointment\_date,bookingpress\_service\_duration\_val,bookingpress\_service\_duration\_unit FROM " . $tbl\_bookingpress\_appointment\_bookings . " WHERE (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s) AND bookingpress\_service\_id= %d AND bookingpress\_appointment\_date = %s ".$bookingpress\_total\_booked\_appointment\_where\_clause." GROUP BY bookingpress\_appointment\_date",'1','2',$bookingpress\_selected\_service,$bpa\_check\_date), ARRAY\_A); //phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [2360](#L2360) |  |
| [2361](#L2361) | $bookingpress\_total\_appointment = apply\_filters( 'bookingpress\_modify\_total\_booked\_appointment', $bookingpress\_total\_appointment, $bookingpress\_appointment\_data); |
| [2362](#L2362) |  |
| [2363](#L2363) | /\*\* reputelog - check for this loop as it's adding the current selected date to disabled time slots if an appointment is booked in the selected date \*/ |
| [2364](#L2364) | if( !empty( $bpa\_total\_booked\_appointment ) ){ |
| [2365](#L2365) | $bookingpress\_total\_appointment = array\_merge( $bookingpress\_total\_appointment, $bpa\_total\_booked\_appointment ); |
| [2366](#L2366) | } |
| [2367](#L2367) |  |
| [2368](#L2368) | $multiple\_days\_event = array(); |
| [2369](#L2369) |  |
| [2370](#L2370) | if( count( $bookingpress\_total\_appointment ) > 0 ){ |
| [2371](#L2371) | foreach($bookingpress\_total\_appointment as $key  => $value) { |
| [2372](#L2372) | if(!empty($value['bookingpress\_appointment\_date'])){ |
| [2373](#L2373) | $bookingpress\_appointment\_date = !empty($value['bookingpress\_appointment\_date']) ? $value['bookingpress\_appointment\_date'] : ''; |
| [2374](#L2374) | //$bookingpress\_time\_slot\_data = $BookingPress->bookingpress\_get\_service\_available\_time($bookingpress\_selected\_service,$bookingpress\_appointment\_date ); |
| [2375](#L2375) | $bookingpress\_time\_slots = $this->bookingpress\_check\_booked\_appointments( $bookingpress\_appointment\_date ); |
| [2376](#L2376) |  |
| [2377](#L2377) | $bookingpress\_time\_slot\_data = array\_merge( |
| [2378](#L2378) | $bookingpress\_time\_slots['morning\_time'], |
| [2379](#L2379) | $bookingpress\_time\_slots['afternoon\_time'], |
| [2380](#L2380) | $bookingpress\_time\_slots['evening\_time'], |
| [2381](#L2381) | $bookingpress\_time\_slots['night\_time'] |
| [2382](#L2382) | ); |
| [2383](#L2383) |  |
| [2384](#L2384) | if(!empty($bookingpress\_time\_slot\_data)) { |
| [2385](#L2385) | $is\_booked = 1; |
| [2386](#L2386) | foreach($bookingpress\_time\_slot\_data as $key2 => $value2) { |
| [2387](#L2387) | if( ( isset($value2['is\_booked']) && $value2['is\_booked'] == 0 ) || empty( $value2['is\_booked'] ) ){ |
| [2388](#L2388) | if( isset( $value2['max\_capacity'] ) && isset( $value2['total\_booked'] ) && $value2['total\_booked'] >= $value2['max\_total\_capacity'] ) { |
| [2389](#L2389) | /\*\* Do nothing \*/ |
| [2390](#L2390) | } else { |
| [2391](#L2391) | $is\_booked = 0; |
| [2392](#L2392) | break; |
| [2393](#L2393) | } |
| [2394](#L2394) | } |
| [2395](#L2395) | } |
| [2396](#L2396) |  |
| [2397](#L2397) | $bookingpress\_allow\_to\_disable\_booked\_date = apply\_filters('bookingpress\_allow\_to\_disable\_booked\_date',true,$bookingpress\_selected\_service); |
| [2398](#L2398) |  |
| [2399](#L2399) | if($is\_booked == 1 && $bookingpress\_allow\_to\_disable\_booked\_date) { |
| [2400](#L2400) | $bookingpress\_disable\_date[] = date('c', strtotime( $bookingpress\_appointment\_date)); |
| [2401](#L2401) | } |
| [2402](#L2402) | } else { |
| [2403](#L2403) | if( $is\_multiple\_day\_event ){ |
| [2404](#L2404) | $service\_duration\_val = $value['bookingpress\_service\_duration\_val']; |
| [2405](#L2405) | if( empty( $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ] ) ){ |
| [2406](#L2406) | $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ] = 1; |
| [2407](#L2407) | } else { |
| [2408](#L2408) | $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ]++; |
| [2409](#L2409) | } |
| [2410](#L2410) | for( $d = 1; $d < $service\_duration\_val; $d++ ){ |
| [2411](#L2411) | if( empty( $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ] ) ){ |
| [2412](#L2412) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ] = 1; |
| [2413](#L2413) | } else { |
| [2414](#L2414) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ]++; |
| [2415](#L2415) | } |
| [2416](#L2416) | } |
| [2417](#L2417) |  |
| [2418](#L2418) | for( $dm = $service\_duration\_val - 1; $dm > 0; $dm-- ){ |
| [2419](#L2419) | if( empty( $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ] ) ){ |
| [2420](#L2420) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ] = 1; |
| [2421](#L2421) | } else { |
| [2422](#L2422) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ]++; |
| [2423](#L2423) | } |
| [2424](#L2424) | } |
| [2425](#L2425) | } else { |
| [2426](#L2426) | $bookingpress\_disable\_date[] = date('Y-m-d', strtotime( $bookingpress\_appointment\_date)); |
| [2427](#L2427) | } |
| [2428](#L2428) | } |
| [2429](#L2429) | } |
| [2430](#L2430) | }; |
| [2431](#L2431) | } else { |
| [2432](#L2432) | if( !$is\_multiple\_day\_event ){ |
| [2433](#L2433) |  |
| [2434](#L2434) | $booked\_time\_slots = apply\_filters( 'bookingpress\_check\_available\_timeslot\_manual\_block', true, $bpa\_check\_date ); |
| [2435](#L2435) |  |
| [2436](#L2436) | if( false == $booked\_time\_slots ){ |
| [2437](#L2437) | $bookingpress\_disable\_date[] = date('Y-m-d', strtotime($bpa\_check\_date) ); |
| [2438](#L2438) | } |
| [2439](#L2439) | } |
| [2440](#L2440) | } |
| [2441](#L2441) | } |
| [2442](#L2442) |  |
| [2443](#L2443) | $attributes = array(); |
| [2444](#L2444) | if( !empty( $multiple\_days\_event ) ){ |
| [2445](#L2445) | $bookingpress\_slot\_left\_text = $BookingPress->bookingpress\_get\_customize\_settings('slot\_left\_text','booking\_form'); |
| [2446](#L2446) | $bookingpress\_slot\_left\_text = !empty($bookingpress\_slot\_left\_text) ? stripslashes\_deep($bookingpress\_slot\_left\_text) : esc\_html\_\_('Slots left', 'bookingpress-appointment-booking'); |
| [2447](#L2447) | foreach( $multiple\_days\_event as $md\_date => $md\_cap ){ |
| [2448](#L2448) |  |
| [2449](#L2449) | if( $md\_cap >= $max\_service\_capacity ){ |
| [2450](#L2450) | $bookingpress\_disable\_date[] = $md\_date; |
| [2451](#L2451) | } |
| [2452](#L2452) | $remaining\_capacity = ( $max\_service\_capacity - $md\_cap ); |
| [2453](#L2453) | $attributes[ $md\_date ] = ( ($remaining\_capacity < 0 ) ? 0 : $remaining\_capacity )  .' '. $bookingpress\_slot\_left\_text; |
| [2454](#L2454) | } |
| [2455](#L2455) | } |
| [2456](#L2456) |  |
| [2457](#L2457) | $bookingpress\_disable\_date = apply\_filters( 'bookingpress\_modify\_disable\_dates\_with\_staffmember', $bookingpress\_disable\_date, $bookingpress\_selected\_service); |
| [2458](#L2458) | $bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load($bookingpress\_selected\_date,$bookingpress\_disable\_date); |
| [2459](#L2459) |  |
| [2460](#L2460) | $bookingpress\_disable\_date = array\_unique( $bookingpress\_disable\_date ); |
| [2461](#L2461) |  |
| [2462](#L2462) | if( !empty( $single\_disable\_date ) ){ |
| [2463](#L2463) | $bookingpress\_disable\_date = array\_merge( $bookingpress\_disable\_date, $single\_disable\_date ); |
| [2464](#L2464) | } |
| [2465](#L2465) |  |
| [2466](#L2466) | $bpa\_disable\_dates = array(); |
| [2467](#L2467) | foreach( $bookingpress\_disable\_date as $disable\_date ){ |
| [2468](#L2468) | $bpa\_disable\_dates[] = date('Y-m-d H:i:s', strtotime( $disable\_date ) ); |
| [2469](#L2469) | } |
| [2470](#L2470) |  |
| [2471](#L2471) | $response['variant']    = 'success'; |
| [2472](#L2472) | $response['title']      = 'Success'; |
| [2473](#L2473) | $response['msg']        = 'Data reterive successfully'; |
| [2474](#L2474) | $response['days\_off\_disabled\_dates']  =  implode(',',$bookingpress\_disable\_date ); |
| [2475](#L2475) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$bpa\_disable\_dates ); |
| [2476](#L2476) | $response['selected\_date']  = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2477](#L2477) | $response['next\_month'] = $next\_month; |
| [2478](#L2478) | $response['vcal\_attributes'] = $attributes; |
| [2479](#L2479) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [2480](#L2480) | $response['next\_year'] = $next\_year; |
| [2481](#L2481) | $response['msg']        = 'Data reterive successfully'; |
| [2482](#L2482) | } |
| [2483](#L2483) |  |
| [2484](#L2484) | /\* $\_SESSION['disable\_dates'] = array(); |
| [2485](#L2485) | $\_SESSION['disable\_dates'] = $bookingpress\_disable\_date; \*/ |
| [2486](#L2486) | /\*\* Get Front Timings Changes Start \*/ |
| [2487](#L2487) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [2488](#L2488) |  |
| [2489](#L2489) | /\*\* Set max 365 days if setting not set or pro version is deactivated \*/ |
| [2490](#L2490) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [2491](#L2491) | $get\_period\_available\_for\_booking = 365; |
| [2492](#L2492) | } |
| [2493](#L2493) |  |
| [2494](#L2494) | $response['prevent\_next\_month\_check'] = false; |
| [2495](#L2495) | if( !empty( $get\_period\_available\_for\_booking ) ){ |
| [2496](#L2496) | $bookingpress\_current\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2497](#L2497) | $max\_available\_date = date('Y-m-d', strtotime( $bookingpress\_current\_date . '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2498](#L2498) | $response['max\_available\_date'] = $max\_available\_date; |
| [2499](#L2499) | $response['max\_available\_month'] = date('m', strtotime( $max\_available\_date ) ); |
| [2500](#L2500) | $response['max\_available\_year'] = date('Y', strtotime( $max\_available\_date ) ); |
| [2501](#L2501) | if( $max\_available\_date < $response['selected\_date'] ){ |
| [2502](#L2502) | $response['front\_timings'] = array(); |
| [2503](#L2503) | $response['next\_month'] = $next\_month; |
| [2504](#L2504) | wp\_send\_json( $response ); |
| [2505](#L2505) | die; |
| [2506](#L2506) | } |
| [2507](#L2507) | } |
| [2508](#L2508) |  |
| [2509](#L2509) | if( !empty( $response['max\_available\_month'] ) && $next\_month > $response['max\_available\_month'] && $response['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ |
| [2510](#L2510) | $response['prevent\_next\_month\_check'] = true; |
| [2511](#L2511) | } |
| [2512](#L2512) | $response['check\_for\_multiple\_days\_event'] = false; |
| [2513](#L2513) | if( !empty( $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ) && 'd' == $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ){ |
| [2514](#L2514) | $response['check\_for\_multiple\_days\_event'] = true; |
| [2515](#L2515) | } |
| [2516](#L2516) |  |
| [2517](#L2517) |  |
| [2518](#L2518) | /\*\* multiple days event \*/ |
| [2519](#L2519) | $multiple\_days\_event = false; |
| [2520](#L2520) | if( !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit'] ) && $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit'] == 'd' ){ |
| [2521](#L2521) | $multiple\_days\_event = true; |
| [2522](#L2522) | } |
| [2523](#L2523) |  |
| [2524](#L2524) | $front\_timings = $this->bookingpress\_retrieve\_timeslots( $response['selected\_date'], true ); |
| [2525](#L2525) |  |
| [2526](#L2526) | $is\_custom\_duration = ( !empty( $front\_timings['is\_custom\_duration'] ) && 1 == $front\_timings['is\_custom\_duration'] ) ? true : false; |
| [2527](#L2527) | if( !empty( $front\_timings ) && !$is\_custom\_duration ){ |
| [2528](#L2528) |  |
| [2529](#L2529) | $is\_front\_timings\_empty = false; |
| [2530](#L2530) | $total\_time\_slots = 0; |
| [2531](#L2531) | $total\_booked\_time\_slots = 0; |
| [2532](#L2532) | $total\_timings = count( $front\_timings ); |
| [2533](#L2533) | $empty\_slots = 0; |
| [2534](#L2534) |  |
| [2535](#L2535) | foreach( $front\_timings as $k => $val ){ |
| [2536](#L2536) |  |
| [2537](#L2537) | if( !empty( $val ) && count( $val ) > 0 ){ |
| [2538](#L2538) | foreach( $val as $ik => $iv ){ |
| [2539](#L2539) | if( 1 == $iv['is\_booked'] ){ |
| [2540](#L2540) | $total\_booked\_time\_slots++; |
| [2541](#L2541) | } else if( isset( $iv['max\_capacity'] ) && isset( $iv['total\_booked'] ) && $iv['total\_booked'] >= $iv['max\_total\_capacity'] ){ |
| [2542](#L2542) | $total\_booked\_time\_slots++; |
| [2543](#L2543) | } |
| [2544](#L2544) | $total\_time\_slots++; |
| [2545](#L2545) | } |
| [2546](#L2546) | } else if( empty( $val ) ){ |
| [2547](#L2547) | $empty\_slots++; |
| [2548](#L2548) | } |
| [2549](#L2549) | } |
| [2550](#L2550) | if( ( $total\_time\_slots == $total\_booked\_time\_slots && 0 < $total\_time\_slots && $total\_booked\_time\_slots ) || $total\_timings == $empty\_slots ){ |
| [2551](#L2551) | $is\_front\_timings\_empty = true; |
| [2552](#L2552) | } |
| [2553](#L2553) |  |
| [2554](#L2554) | if( $is\_front\_timings\_empty && $multiple\_days\_event ){ |
| [2555](#L2555) | $is\_front\_timings\_empty = false; |
| [2556](#L2556) | } |
| [2557](#L2557) |  |
| [2558](#L2558) | $response['front\_timings'] = $front\_timings; |
| [2559](#L2559) |  |
| [2560](#L2560) | $bookingpress\_add\_single\_disable\_date = apply\_filters('bookingpress\_add\_single\_disable\_date\_when\_no\_timeslot',true,$bookingpress\_selected\_service,$front\_timings); |
| [2561](#L2561) | if( true == $is\_front\_timings\_empty && $bookingpress\_add\_single\_disable\_date){ |
| [2562](#L2562) | $response['empty\_front\_timings'] = true; |
| [2563](#L2563) | if( true == $consider\_selected\_date ){ |
| [2564](#L2564) | $posted\_selected\_date = $bpa\_selected\_date; |
| [2565](#L2565) | } else { |
| [2566](#L2566) | $posted\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2567](#L2567) | } |
| [2568](#L2568) | //$bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load($posted\_selected\_date,$bookingpress\_disable\_date); /\*\* reputelog - need to check with pro version data \*/ |
| [2569](#L2569) | $response['next\_available\_date'] = date('Y-m-d', strtotime($posted\_selected\_date.'+1 day') ); |
| [2570](#L2570) | if( !isset( $single\_disable\_date ) || !is\_array( $single\_disable\_date ) ){ |
| [2571](#L2571) | $single\_disable\_date = array(); |
| [2572](#L2572) | } |
| [2573](#L2573) | $single\_disable\_date[] = date('c',strtotime($posted\_selected\_date)); |
| [2574](#L2574) |  |
| [2575](#L2575) | $this->bookingpress\_get\_disable\_date\_func\_legacy( $response['next\_available\_date'], true, $counter++, $bookingpress\_total\_appointment, $single\_disable\_date ); |
| [2576](#L2576) |  |
| [2577](#L2577) | } |
| [2578](#L2578) | } |
| [2579](#L2579) |  |
| [2580](#L2580) |  |
| [2581](#L2581) | /\*\* Get Front Timings Changes End \*/ |
| [2582](#L2582) |  |
| [2583](#L2583) | $response = apply\_filters('bookingpress\_modify\_disable\_date\_data',$response); |
| [2584](#L2584) |  |
| [2585](#L2585) |  |
| [2586](#L2586) |  |
| [2587](#L2587) | wp\_send\_json($response); |
| [2588](#L2588) | exit; |
| [2589](#L2589) | } |
| [2590](#L2590) |  |
| [2591](#L2591) | function bookingpress\_check\_available\_timeslot\_manual\_block\_func( $block\_date, $check\_date ){ |
| [2592](#L2592) |  |
| [2593](#L2593) | if( false != $block\_date ){ |
| [2594](#L2594) | $block\_date = $this->bookingpress\_check\_booked\_appointments( $check\_date, true, false, true ); |
| [2595](#L2595) |  |
| [2596](#L2596) | } else{ |
| [2597](#L2597) | return true; |
| [2598](#L2598) | } |
| [2599](#L2599) | return $block\_date; |
| [2600](#L2600) | } |
| [2601](#L2601) |  |
| [2602](#L2602) | function bookingpress\_check\_booked\_appointments( $disabled\_date, $return = true, $check\_for\_whole\_day = false, $checked\_for\_one\_slot = false ){ |
| [2603](#L2603) | return $this->bookingpress\_retrieve\_timeslots( $disabled\_date, $return, $check\_for\_whole\_day, $checked\_for\_one\_slot ); |
| [2604](#L2604) | } |
| [2605](#L2605) |  |
| [2606](#L2606) |  |
| [2607](#L2607) | /\*\* |
| [2608](#L2608) | \* Insert shortcode from classic editor |
| [2609](#L2609) | \* |
| [2610](#L2610) | \* @param  mixed $content |
| [2611](#L2611) | \* @return void |
| [2612](#L2612) | \*/ |
| [2613](#L2613) | function bookingpress\_insert\_shortcode\_button( $content ) |
| [2614](#L2614) | { |
| [2615](#L2615) | global $bookingpress\_global\_options; |
| [2616](#L2616) | $allowed\_pages\_for\_media\_button = array( 'post.php', 'post-new.php' ); |
| [2617](#L2617) |  |
| [2618](#L2618) | if (isset($\_SERVER['PHP\_SELF']) && ! in\_array(basename($\_SERVER['PHP\_SELF']), $allowed\_pages\_for\_media\_button) ) { |
| [2619](#L2619) | return; |
| [2620](#L2620) | } |
| [2621](#L2621) | if (! isset($post\_type) ) { |
| [2622](#L2622) | $post\_type = ''; |
| [2623](#L2623) | } |
| [2624](#L2624) | if (isset($\_SERVER['PHP\_SELF']) && basename(sanitize\_text\_field($\_SERVER['PHP\_SELF'])) == 'post.php' ) { |
| [2625](#L2625) | $post\_id   = isset($\_REQUEST['post']) ? sanitize\_text\_field($\_REQUEST['post']) : 0; |
| [2626](#L2626) | $post\_type = get\_post\_type($post\_id); |
| [2627](#L2627) | } |
| [2628](#L2628) | if (isset($\_SERVER['PHP\_SELF']) && basename(sanitize\_text\_field($\_SERVER['PHP\_SELF'])) == 'post-new.php' ) { |
| [2629](#L2629) | if (isset($\_REQUEST['post\_type']) ) { |
| [2630](#L2630) | $post\_type = sanitize\_text\_field($\_REQUEST['post\_type']); |
| [2631](#L2631) | } else { |
| [2632](#L2632) | $post\_type = 'post'; |
| [2633](#L2633) | } |
| [2634](#L2634) | } |
| [2635](#L2635) |  |
| [2636](#L2636) | if( $content != 'content'){ |
| [2637](#L2637) | return; |
| [2638](#L2638) | } |
| [2639](#L2639) |  |
| [2640](#L2640) | $allowed\_post\_types = array( 'post', 'page' ); |
| [2641](#L2641) |  |
| [2642](#L2642) | if (! in\_array($post\_type, $allowed\_post\_types) ) { |
| [2643](#L2643) | return; |
| [2644](#L2644) | } |
| [2645](#L2645) | if (! wp\_script\_is('jquery', 'enqueued') ) { |
| [2646](#L2646) | wp\_enqueue\_script('jquery'); |
| [2647](#L2647) | } |
| [2648](#L2648) | if (! wp\_style\_is('bookingpress\_tinymce', 'enqueued') ) { |
| [2649](#L2649) | wp\_enqueue\_style('bookingpress\_tinymce', BOOKINGPRESS\_URL . '/css/bookingpress\_tinymce.css', array(), BOOKINGPRESS\_VERSION); |
| [2650](#L2650) | } |
| [2651](#L2651) | wp\_register\_script('bookingpress\_vue\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue.min.js', array(), BOOKINGPRESS\_VERSION, 0); |
| [2652](#L2652) | wp\_register\_script('bookingpress\_element\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element.js', array( '' ), '2.51.5', 0); |
| [2653](#L2653) | wp\_register\_script('bookingpress\_element\_en\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array( '' ), '2.51.5', 0); |
| [2654](#L2654) | wp\_register\_script('bookingpress\_wordpress\_vue\_helper\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_wordpress\_vue\_qs\_helper.js', array( '' ), '6.5.1', 0); |
| [2655](#L2655) |  |
| [2656](#L2656) | wp\_enqueue\_script('bookingpress\_vue\_js'); |
| [2657](#L2657) | wp\_enqueue\_script('bookingpress\_element\_js'); |
| [2658](#L2658) | wp\_enqueue\_script('bookingpress\_element\_en\_js'); |
| [2659](#L2659) | wp\_enqueue\_script('bookingpress\_wordpress\_vue\_helper\_js'); |
| [2660](#L2660) |  |
| [2661](#L2661) | wp\_register\_style('bookingpress\_element\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_element\_theme.css', array(), BOOKINGPRESS\_VERSION); |
| [2662](#L2662) | wp\_enqueue\_style('bookingpress\_element\_css'); |
| [2663](#L2663) |  |
| [2664](#L2664) | if (wp\_script\_is('bookingpress\_vue\_js', 'enqueued') ) { |
| [2665](#L2665) | $this->bookingpress\_insert\_shortcode\_popup(); |
| [2666](#L2666) | } |
| [2667](#L2667) |  |
| [2668](#L2668) | $bookingpress\_site\_current\_language = $bookingpress\_global\_options->bookingpress\_get\_site\_current\_language(); |
| [2669](#L2669) |  |
| [2670](#L2670) | if ($bookingpress\_site\_current\_language != 'en' ) { |
| [2671](#L2671) | wp\_register\_script('bookingpress\_vue\_cal\_locale', BOOKINGPRESS\_URL . '/js/locales/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2672](#L2672) | wp\_enqueue\_script('bookingpress\_vue\_cal\_locale'); |
| [2673](#L2673) |  |
| [2674](#L2674) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/elements\_locale/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2675](#L2675) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [2676](#L2676) | } else { |
| [2677](#L2677) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2678](#L2678) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [2679](#L2679) | } |
| [2680](#L2680) |  |
| [2681](#L2681) | $bpa\_inline\_script\_data = ' |
| [2682](#L2682) | var lang = ELEMENT.lang.' . $bookingpress\_site\_current\_language . '; |
| [2683](#L2683) | ELEMENT.locale(lang); |
| [2684](#L2684) | var app = new Vue({ |
| [2685](#L2685) | el: "#bookingpress\_shortcode\_form", |
| [2686](#L2686) | data() { |
| [2687](#L2687) | var bookingpress\_return\_data = { |
| [2688](#L2688) | open\_bookingpress\_shortcode\_modal: false, |
| [2689](#L2689) | close\_modal\_on\_esc: true, |
| [2690](#L2690) | centerDialogVisible: false, |
| [2691](#L2691) | selected\_bookingpress\_shortcode: "", |
| [2692](#L2692) | append\_modal\_to\_body: true, |
| [2693](#L2693) | }; |
| [2694](#L2694) | return bookingpress\_return\_data; |
| [2695](#L2695) | }, |
| [2696](#L2696) | mounted(){ |
| [2697](#L2697) | }, |
| [2698](#L2698) | methods: { |
| [2699](#L2699) | model\_action() { |
| [2700](#L2700) | const vm= this; |
| [2701](#L2701) | if(vm.open\_bookingpress\_shortcode\_modal == true ) { |
| [2702](#L2702) | vm.open\_bookingpress\_shortcode\_modal = false; |
| [2703](#L2703) | } else { |
| [2704](#L2704) | vm.open\_bookingpress\_shortcode\_modal = true; |
| [2705](#L2705) | } |
| [2706](#L2706) | }, |
| [2707](#L2707) | bookingpress\_open\_form\_shortcode\_popup(){ |
| [2708](#L2708) | this.model\_action(); |
| [2709](#L2709) | }, |
| [2710](#L2710) | add\_bookingpress\_shortcode(){ |
| [2711](#L2711) | const vm = this; |
| [2712](#L2712) | if(vm.selected\_bookingpress\_shortcode != "") { |
| [2713](#L2713) | if(tinyMCE.activeEditor != null){ |
| [2714](#L2714) | var editorContent = tinyMCE.activeEditor.getContent() |
| [2715](#L2715) | editorContent += "["+vm.selected\_bookingpress\_shortcode+"]" |
| [2716](#L2716) | tinyMCE.activeEditor.setContent(editorContent) |
| [2717](#L2717) | } |
| [2718](#L2718) | else{ |
| [2719](#L2719) | var textEditorContent = document.getElementById("content").innerHTML |
| [2720](#L2720) | textEditorContent += "\n["+vm.selected\_bookingpress\_shortcode+"]" |
| [2721](#L2721) | document.getElementById("content").innerHTML = textEditorContent |
| [2722](#L2722) | } |
| [2723](#L2723) | vm.model\_action(); |
| [2724](#L2724) | } |
| [2725](#L2725) | } |
| [2726](#L2726) | }, |
| [2727](#L2727) | });'; |
| [2728](#L2728) |  |
| [2729](#L2729) | wp\_add\_inline\_script('bookingpress\_elements\_locale', $bpa\_inline\_script\_data); |
| [2730](#L2730) | } |
| [2731](#L2731) |  |
| [2732](#L2732) | /\*\* |
| [2733](#L2733) | \* Load HTML content of classic editor button view |
| [2734](#L2734) | \* |
| [2735](#L2735) | \* @return void |
| [2736](#L2736) | \*/ |
| [2737](#L2737) | function bookingpress\_insert\_shortcode\_popup() |
| [2738](#L2738) | { |
| [2739](#L2739) | if (file\_exists(BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_tinymce\_options\_shortcodes.php') ) { |
| [2740](#L2740) | include BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_tinymce\_options\_shortcodes.php'; |
| [2741](#L2741) | } |
| [2742](#L2742) | ?> |
| [2743](#L2743) | <?php |
| [2744](#L2744) | } |
| [2745](#L2745) |  |
| [2746](#L2746) | /\*\* |
| [2747](#L2747) | \* Server Side Validaton - Backend Side Validation |
| [2748](#L2748) | \* |
| [2749](#L2749) | \* @return void |
| [2750](#L2750) | \*/ |
| [2751](#L2751) | function bookingpress\_before\_book\_appointment\_func() |
| [2752](#L2752) | { |
| [2753](#L2753) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_customers,$bookingpress\_payment\_gateways,$tbl\_bookingpress\_form\_fields; |
| [2754](#L2754) | $response              = array(); |
| [2755](#L2755) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [2756](#L2756) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [2757](#L2757) | if (! $bpa\_verify\_nonce\_flag ) { |
| [2758](#L2758) | $response['variant']      = 'error'; |
| [2759](#L2759) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2760](#L2760) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [2761](#L2761) | $response['redirect\_url'] = ''; |
| [2762](#L2762) | return wp\_json\_encode($response); |
| [2763](#L2763) |  |
| [2764](#L2764) | } |
| [2765](#L2765) | $response['variant']    = 'success'; |
| [2766](#L2766) | $response['title']      = ''; |
| [2767](#L2767) | $response['msg']        = ''; |
| [2768](#L2768) | $response['error\_type'] = ''; |
| [2769](#L2769) |  |
| [2770](#L2770) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [2771](#L2771) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [2772](#L2772) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [2773](#L2773) | } |
| [2774](#L2774) | $bookingpress\_unique\_id =  !empty($\_REQUEST['appointment\_data']['bookingpress\_uniq\_id']) ? sanitize\_text\_field( $\_REQUEST['appointment\_data']['bookingpress\_uniq\_id'] ) : ''; |
| [2775](#L2775) | $bookingpress\_form\_token = !empty( $\_REQUEST['appointment\_data']['bookingpress\_form\_token'] ) ? sanitize\_text\_field( $\_REQUEST['appointment\_data']['bookingpress\_form\_token'] ) : $bookingpress\_unique\_id; |
| [2776](#L2776) |  |
| [2777](#L2777) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [2778](#L2778) |  |
| [2779](#L2779) | $no\_appointment\_date\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_date\_selected\_for\_the\_booking', 'message\_setting'); |
| [2780](#L2780) |  |
| [2781](#L2781) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [2782](#L2782) |  |
| [2783](#L2783) | $no\_payment\_method\_is\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_payment\_method\_is\_selected\_for\_the\_booking', 'message\_setting'); |
| [2784](#L2784) |  |
| [2785](#L2785) | $duplicate\_email\_address\_found = $BookingPress->bookingpress\_get\_settings('duplicate\_email\_address\_found', 'message\_setting'); |
| [2786](#L2786) |  |
| [2787](#L2787) | $unsupported\_currecy\_selected\_for\_the\_payment = $BookingPress->bookingpress\_get\_settings('unsupported\_currecy\_selected\_for\_the\_payment', 'message\_setting'); |
| [2788](#L2788) |  |
| [2789](#L2789) | $duplidate\_appointment\_time\_slot\_found = $BookingPress->bookingpress\_get\_settings('duplidate\_appointment\_time\_slot\_found', 'message\_setting'); |
| [2790](#L2790) |  |
| [2791](#L2791) | $bookingpress\_service\_price = isset($\_REQUEST['appointment\_data']['service\_price\_without\_currency']) ? floatval($\_REQUEST['appointment\_data']['service\_price\_without\_currency']) : 0; |
| [2792](#L2792) |  |
| [2793](#L2793) | /\* server side validation \*/ |
| [2794](#L2794) | $all\_fields = $wpdb->get\_results( "SELECT bookingpress\_field\_error\_message,bookingpress\_form\_field\_name,bookingpress\_field\_is\_default FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_field\_required = 1 AND bookingpress\_field\_is\_hide = 0" ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_form\_fields is a table name. false alarm |
| [2795](#L2795) |  |
| [2796](#L2796) | $field\_validation\_message = array(); |
| [2797](#L2797) | $is\_required\_validation = false; |
| [2798](#L2798) | if ( ! empty( $all\_fields ) ) { |
| [2799](#L2799) | foreach ( $all\_fields as $field\_data ) { |
| [2800](#L2800) |  |
| [2801](#L2801) | $field\_error\_msg = $field\_data->bookingpress\_field\_error\_message; |
| [2802](#L2802) |  |
| [2803](#L2803) | if( $field\_data->bookingpress\_field\_is\_default == 1 ){ |
| [2804](#L2804) |  |
| [2805](#L2805) | if( $field\_data->bookingpress\_form\_field\_name == 'firstname'){ |
| [2806](#L2806) | $bpa\_visible\_field\_key = 'customer\_firstname'; |
| [2807](#L2807) | } |
| [2808](#L2808) | if( $field\_data->bookingpress\_form\_field\_name == 'lastname'){ |
| [2809](#L2809) | $bpa\_visible\_field\_key = 'customer\_lastname'; |
| [2810](#L2810) | } |
| [2811](#L2811) | if( $field\_data->bookingpress\_form\_field\_name == 'email\_address'){ |
| [2812](#L2812) | $bpa\_visible\_field\_key = 'customer\_email'; |
| [2813](#L2813) | } |
| [2814](#L2814) | if( $field\_data->bookingpress\_form\_field\_name == 'note'){ |
| [2815](#L2815) | $bpa\_visible\_field\_key = 'appointment\_note'; |
| [2816](#L2816) | } |
| [2817](#L2817) | if( $field\_data->bookingpress\_form\_field\_name == 'phone\_number'){ |
| [2818](#L2818) | $bpa\_visible\_field\_key = 'customer\_phone'; |
| [2819](#L2819) | } |
| [2820](#L2820) | if( $field\_data->bookingpress\_form\_field\_name == 'fullname'){ |
| [2821](#L2821) | $bpa\_visible\_field\_key = 'customer\_name'; |
| [2822](#L2822) | } |
| [2823](#L2823) | if( $field\_data->bookingpress\_form\_field\_name == 'username'){ |
| [2824](#L2824) | $bpa\_visible\_field\_key = 'customer\_username'; |
| [2825](#L2825) | } |
| [2826](#L2826) | if( $field\_data->bookingpress\_form\_field\_name == 'terms\_and\_conditions'){ |
| [2827](#L2827) | $bpa\_visible\_field\_key = 'appointment\_terms\_conditions'; |
| [2828](#L2828) | } |
| [2829](#L2829) | } |
| [2830](#L2830) |  |
| [2831](#L2831) | $val = isset($\_POST['appointment\_data'][ $bpa\_visible\_field\_key ]) ? $\_POST['appointment\_data'][ $bpa\_visible\_field\_key ] : ''; //phpcs:ignore |
| [2832](#L2832) |  |
| [2833](#L2833) | if( $bpa\_visible\_field\_key == 'appointment\_terms\_conditions'){ |
| [2834](#L2834) |  |
| [2835](#L2835) | if( empty($val[0])){ |
| [2836](#L2836) | $is\_required\_validation = true; |
| [2837](#L2837) | $field\_validation\_message[] = $field\_error\_msg; |
| [2838](#L2838) | } |
| [2839](#L2839) | } else { |
| [2840](#L2840) | if( '' === $val ){ |
| [2841](#L2841) | $is\_required\_validation = true; |
| [2842](#L2842) | $field\_validation\_message[] = $field\_error\_msg; |
| [2843](#L2843) | } |
| [2844](#L2844) | } |
| [2845](#L2845) |  |
| [2846](#L2846) | } |
| [2847](#L2847) | } |
| [2848](#L2848) |  |
| [2849](#L2849) | if( true == $is\_required\_validation ){ |
| [2850](#L2850) | $response['variant'] = 'error'; |
| [2851](#L2851) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2852](#L2852) | $response['msg']     = !empty($field\_validation\_message) ? implode(' ', $field\_validation\_message) : array(); |
| [2853](#L2853) | return wp\_json\_encode($response); |
| [2854](#L2854) | } |
| [2855](#L2855) |  |
| [2856](#L2856) | if (empty($\_POST['appointment\_data']['selected\_service']) ) { |
| [2857](#L2857) | $response['variant'] = 'error'; |
| [2858](#L2858) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2859](#L2859) | $response['msg']     = esc\_html($no\_service\_selected\_for\_the\_booking); |
| [2860](#L2860) | return wp\_json\_encode($response); |
| [2861](#L2861) | } |
| [2862](#L2862) |  |
| [2863](#L2863) | if (empty($\_POST['appointment\_data']['selected\_date']) ) { |
| [2864](#L2864) | $response['variant'] = 'error'; |
| [2865](#L2865) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2866](#L2866) | $response['msg']     = esc\_html($no\_appointment\_date\_selected\_for\_the\_booking); |
| [2867](#L2867) | return wp\_json\_encode($response); |
| [2868](#L2868) | } |
| [2869](#L2869) |  |
| [2870](#L2870) | if (empty($\_POST['appointment\_data']['selected\_start\_time']) || empty($\_POST['appointment\_data']['selected\_end\_time']) ) { |
| [2871](#L2871) | $response['variant'] = 'error'; |
| [2872](#L2872) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2873](#L2873) | $response['msg']     = esc\_html($no\_appointment\_time\_selected\_for\_the\_booking); |
| [2874](#L2874) | return wp\_json\_encode($response); |
| [2875](#L2875) | } |
| [2876](#L2876) |  |
| [2877](#L2877) | if (empty($\_POST['appointment\_data']['selected\_payment\_method']) && $bookingpress\_service\_price > 0 ) { |
| [2878](#L2878) | $response['variant'] = 'error'; |
| [2879](#L2879) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2880](#L2880) | $response['msg']     = esc\_html($no\_payment\_method\_is\_selected\_for\_the\_booking); |
| [2881](#L2881) | return wp\_json\_encode($response); |
| [2882](#L2882) | } |
| [2883](#L2883) |  |
| [2884](#L2884) | $bookingpress\_fullname  = ! empty($\_POST['appointment\_data']['customer\_name']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_name'])) : ''; |
| [2885](#L2885) | $bookingpress\_firstname = ! empty($\_POST['appointment\_data']['customer\_firstname']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_firstname'])) : ''; |
| [2886](#L2886) | $bookingpress\_lastname  = ! empty($\_POST['appointment\_data']['customer\_lastname']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_lastname'])) : ''; |
| [2887](#L2887) | $bookingpress\_email     = ! empty($\_POST['appointment\_data']['customer\_email']) ? sanitize\_email($\_POST['appointment\_data']['customer\_email']) : ''; |
| [2888](#L2888) |  |
| [2889](#L2889) | if (strlen($bookingpress\_fullname) > 255 ) { |
| [2890](#L2890) | $response['variant'] = 'error'; |
| [2891](#L2891) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2892](#L2892) | $response['msg']     = esc\_html\_\_('Fullname is too long...', 'bookingpress-appointment-booking'); |
| [2893](#L2893) | return wp\_json\_encode($response); |
| [2894](#L2894) | } |
| [2895](#L2895) | if (strlen($bookingpress\_firstname) > 255 ) { |
| [2896](#L2896) | $response['variant'] = 'error'; |
| [2897](#L2897) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2898](#L2898) | $response['msg']     = esc\_html\_\_('Firstname is too long...', 'bookingpress-appointment-booking'); |
| [2899](#L2899) | return wp\_json\_encode($response); |
| [2900](#L2900) | } |
| [2901](#L2901) | if (strlen($bookingpress\_lastname) > 255 ) { |
| [2902](#L2902) | $response['variant'] = 'error'; |
| [2903](#L2903) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2904](#L2904) | $response['msg']     = esc\_html\_\_('Lastname is too long...', 'bookingpress-appointment-booking'); |
| [2905](#L2905) | return wp\_json\_encode($response); |
| [2906](#L2906) | } |
| [2907](#L2907) | if (strlen($bookingpress\_email) > 255 ) { |
| [2908](#L2908) | $response['variant'] = 'error'; |
| [2909](#L2909) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2910](#L2910) | $response['msg']     = esc\_html\_\_('Email address is too long...', 'bookingpress-appointment-booking'); |
| [2911](#L2911) | return wp\_json\_encode($response); |
| [2912](#L2912) | } |
| [2913](#L2913) | $bookingpress\_selected\_payment\_method = sanitize\_text\_field($\_POST['appointment\_data']['selected\_payment\_method']); |
| [2914](#L2914) | $bookingpress\_currency\_name           = $BookingPress->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [2915](#L2915) |  |
| [2916](#L2916) | $bookingpress\_paypal\_currency = $bookingpress\_payment\_gateways->bookingpress\_paypal\_supported\_currency\_list(); |
| [2917](#L2917) | if ($bookingpress\_selected\_payment\_method == 'paypal' && !in\_array($bookingpress\_currency\_name,$bookingpress\_paypal\_currency ) ) { |
| [2918](#L2918) |  |
| [2919](#L2919) | $response['variant'] = 'error'; |
| [2920](#L2920) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2921](#L2921) | $response['msg']     = esc\_html($unsupported\_currecy\_selected\_for\_the\_payment); |
| [2922](#L2922) | return wp\_json\_encode($response); |
| [2923](#L2923) | } |
| [2924](#L2924) |  |
| [2925](#L2925) | $appointment\_service\_id    = intval($\_POST['appointment\_data']['selected\_service']); |
| [2926](#L2926) | $appointment\_selected\_date = date('Y-m-d', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_date']))); |
| [2927](#L2927) | $appointment\_start\_time    = date('H:i:s', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_start\_time']))); |
| [2928](#L2928) | $appointment\_end\_time      = date('H:i:s', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_end\_time']))); |
| [2929](#L2929) |  |
| [2930](#L2930) | $is\_appointment\_exists = $BookingPress->bookingpress\_is\_appointment\_booked($appointment\_service\_id, $appointment\_selected\_date, $appointment\_start\_time, $appointment\_end\_time); |
| [2931](#L2931) | if ($is\_appointment\_exists) { |
| [2932](#L2932) | $response['variant']              = 'error'; |
| [2933](#L2933) | $response['title']                = 'Error'; |
| [2934](#L2934) | $response['msg']                  = esc\_html($duplidate\_appointment\_time\_slot\_found); |
| [2935](#L2935) | return wp\_json\_encode($response); |
| [2936](#L2936) | } |
| [2937](#L2937) |  |
| [2938](#L2938) | // If selected date is day off then display error. |
| [2939](#L2939) | $bookingpress\_search\_query              = preg\_quote($appointment\_selected\_date, '~'); |
| [2940](#L2940) | $bookingpress\_get\_default\_daysoff\_dates = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [2941](#L2941) | $bookingpress\_search\_date               = preg\_grep('~' . $bookingpress\_search\_query . '~', $bookingpress\_get\_default\_daysoff\_dates); |
| [2942](#L2942) | if (! empty($bookingpress\_search\_date) ) { |
| [2943](#L2943) | $booking\_dayoff\_msg     = esc\_html\_\_('Selected date is off day', 'bookingpress-appointment-booking'); |
| [2944](#L2944) | $booking\_dayoff\_msg    .= '. ' . esc\_html\_\_('So please select new date', 'bookingpress-appointment-booking') . '.'; |
| [2945](#L2945) | $response['error\_type'] = 'dayoff'; |
| [2946](#L2946) | $response['variant']    = 'error'; |
| [2947](#L2947) | $response['title']      = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2948](#L2948) | $response['msg']        = $booking\_dayoff\_msg; |
| [2949](#L2949) | return wp\_json\_encode($response); |
| [2950](#L2950) | } |
| [2951](#L2951) |  |
| [2952](#L2952) | // If payment gateway is disable then return error |
| [2953](#L2953) | if ($bookingpress\_selected\_payment\_method == 'on-site' && $bookingpress\_service\_price > 0 ) { |
| [2954](#L2954) | $on\_site\_payment = $BookingPress->bookingpress\_get\_settings('on\_site\_payment', 'payment\_setting'); |
| [2955](#L2955) | if (empty($on\_site\_payment) || ( $on\_site\_payment == 'false' ) ) { |
| [2956](#L2956) | $response['variant'] = 'error'; |
| [2957](#L2957) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2958](#L2958) | $response['msg']     = esc\_html\_\_('On site payment gateway is not active', 'bookingpress-appointment-booking') . '.'; |
| [2959](#L2959) | return wp\_json\_encode($response); |
| [2960](#L2960) | } |
| [2961](#L2961) | } elseif ( $bookingpress\_selected\_payment\_method == 'paypal' && $bookingpress\_service\_price > 0 ) { |
| [2962](#L2962) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [2963](#L2963) | if (empty($paypal\_payment) || ( $paypal\_payment == 'false' ) ) { |
| [2964](#L2964) | $response['variant'] = 'error'; |
| [2965](#L2965) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2966](#L2966) | $response['msg']     = esc\_html\_\_('PayPal payment gateway is not active', 'bookingpress-appointment-booking') . '.'; |
| [2967](#L2967) | return wp\_json\_encode($response); |
| [2968](#L2968) | } |
| [2969](#L2969) |  |
| [2970](#L2970) | if ($bookingpress\_service\_price < floatval('0.1') ) { |
| [2971](#L2971) | $response['variant'] = 'error'; |
| [2972](#L2972) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2973](#L2973) | $response['msg']     = esc\_html\_\_('Paypal supports minimum amount 0.1', 'bookingpress-appointment-booking'); |
| [2974](#L2974) | return wp\_json\_encode($response); |
| [2975](#L2975) | } |
| [2976](#L2976) | } |
| [2977](#L2977) |  |
| [2978](#L2978) | $bpa\_front\_timings\_key = 'bpa\_front\_timings\_' .$bookingpress\_form\_token.'\_'.$appointment\_selected\_date; |
| [2979](#L2979) |  |
| [2980](#L2980) | $bpa\_front\_timings\_data = $this->bookingpress\_get\_transient( $bpa\_front\_timings\_key ); |
| [2981](#L2981) |  |
| [2982](#L2982) | // double confirm the timings |
| [2983](#L2983) | $timings = array\_values($bpa\_front\_timings\_data); |
| [2984](#L2984) |  |
| [2985](#L2985) | $appointment\_start\_time = date('H:i',strtotime($appointment\_start\_time)); |
| [2986](#L2986) | $appointment\_end\_time = $appointment\_end\_time != '00:00:00' ? date('H:i',strtotime($appointment\_end\_time)) : '24:00'; |
| [2987](#L2987) | $time\_slot\_start\_key = array\_search($appointment\_start\_time, array\_column( $timings, 'store\_start\_time' ) ); |
| [2988](#L2988) | $time\_slot\_end\_key = array\_search( $appointment\_end\_time, array\_column( $timings, 'store\_end\_time' ) ); |
| [2989](#L2989) | if( ( trim($time\_slot\_start\_key) === '' || trim($time\_slot\_end\_key) === '' || trim($time\_slot\_start\_key) != trim($time\_slot\_end\_key) ) && 'd' != $posted\_data['appointment\_data']['selected\_service\_duration\_unit'] ){ |
| [2990](#L2990) | $response['variant']              = 'error'; |
| [2991](#L2991) | $response['title']                = 'Error'; |
| [2992](#L2992) | $response['msg']                  = esc\_html\_\_("Sorry, Booking can not be done as booking time is different than selected timeslot", "bookingpress-appointment-booking"); |
| [2993](#L2993) | return wp\_json\_encode($response); |
| [2994](#L2994) | } |
| [2995](#L2995) |  |
| [2996](#L2996) | do\_action('bookingpress\_validate\_booking\_form', $\_POST); |
| [2997](#L2997) |  |
| [2998](#L2998) | } |
| [2999](#L2999) |  |
| [3000](#L3000) | /\*\* |
| [3001](#L3001) | \* Cancel appointment from customer cancel link |
| [3002](#L3002) | \* @deprecated on 07th March 2023 |
| [3003](#L3003) | \* |
| [3004](#L3004) | \* @return void |
| [3005](#L3005) | \*/ |
| [3006](#L3006) | function bookingpress\_cancel\_appointment\_func() |
| [3007](#L3007) | { |
| [3008](#L3008) | if( !empty($\_SERVER["HTTP\_USER\_AGENT"]) && $\_SERVER["HTTP\_USER\_AGENT"] == 'WhatsApp' ){ |
| [3009](#L3009) | return; |
| [3010](#L3010) | } |
| [3011](#L3011) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications, $bookingpress\_services; |
| [3012](#L3012) | $cancel\_id    = ! empty($\_REQUEST['bpa\_cancel']) ? intval(base64\_decode($\_REQUEST['bpa\_cancel'])) : 0; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_REQUEST['bpa\_cancel'] is sanitized properly |
| [3013](#L3013) | $cancel\_token = ! empty($\_REQUEST['cancel\_id']) ? sanitize\_text\_field($\_REQUEST['cancel\_id']) : ''; |
| [3014](#L3014) |  |
| [3015](#L3015) | if (! empty($cancel\_id) && ! empty($cancel\_token) ) { |
| [3016](#L3016) |  |
| [3017](#L3017) | $bookingpress\_appointment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_customer\_email,bookingpress\_service\_id,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_customer\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d AND bookingpress\_appointment\_token = %s", $cancel\_id,$cancel\_token), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_log\_data is table name defined globally. False Positive alarm |
| [3018](#L3018) |  |
| [3019](#L3019) | if (! empty($bookingpress\_appointment\_log\_data) ) { |
| [3020](#L3020) |  |
| [3021](#L3021) | $bookingpress\_appointment\_date = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_date']; |
| [3022](#L3022) | $bookingpress\_appointment\_time = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_time']; |
| [3023](#L3023) | $bookingpress\_appointment\_datetime = $bookingpress\_appointment\_date." ".$bookingpress\_appointment\_time; |
| [3024](#L3024) | $bookingpress\_service\_id = $bookingpress\_appointment\_log\_data['bookingpress\_service\_id']; |
| [3025](#L3025) | $current\_datetime = date( 'Y-m-d H:i:s', current\_time('timestamp') ); |
| [3026](#L3026) |  |
| [3027](#L3027) | $allow\_cancel\_appointment = true; |
| [3028](#L3028) | if( $bookingpress\_appointment\_datetime <= $current\_datetime ){ |
| [3029](#L3029) | $allow\_cancel\_appointment = false; |
| [3030](#L3030) | } |
| [3031](#L3031) |  |
| [3032](#L3032) | if($allow\_cancel\_appointment == true){ |
| [3033](#L3033) | $bookingpress\_min\_time\_before\_cancel = $BookingPress->bookingpress\_get\_settings('default\_minimum\_time\_for\_canceling', 'general\_setting'); |
| [3034](#L3034) |  |
| [3035](#L3035) | //Check service level minimum time required before cancel |
| [3036](#L3036) | $bookingpress\_service\_min\_time\_require\_before\_cancel = $bookingpress\_services->bookingpress\_get\_service\_meta($bookingpress\_service\_id, 'minimum\_time\_required\_before\_cancelling'); |
| [3037](#L3037) | if(!empty($bookingpress\_service\_min\_time\_require\_before\_cancel)){ |
| [3038](#L3038) | if($bookingpress\_service\_min\_time\_require\_before\_cancel == 'disabled'){ |
| [3039](#L3039) | $bookingpress\_min\_time\_before\_cancel = 'disabled'; |
| [3040](#L3040) | }else if($bookingpress\_service\_min\_time\_require\_before\_cancel != 'inherit'){ |
| [3041](#L3041) | $bookingpress\_min\_time\_before\_cancel = $bookingpress\_service\_min\_time\_require\_before\_cancel; |
| [3042](#L3042) | } |
| [3043](#L3043) | } |
| [3044](#L3044) |  |
| [3045](#L3045) | //Check minimum cancel time |
| [3046](#L3046) | if($allow\_cancel\_appointment && !empty($bookingpress\_min\_time\_before\_cancel) && $bookingpress\_min\_time\_before\_cancel != 'disabled'){ |
| [3047](#L3047) | $bookingpress\_from\_time = current\_time('timestamp'); |
| [3048](#L3048) | $bookingpress\_to\_time = strtotime($bookingpress\_appointment\_datetime); |
| [3049](#L3049) | $bookingpress\_time\_diff\_for\_cancel = round(abs($bookingpress\_to\_time - $bookingpress\_from\_time) / 60, 2); |
| [3050](#L3050) |  |
| [3051](#L3051) | if($bookingpress\_time\_diff\_for\_cancel < $bookingpress\_min\_time\_before\_cancel){ |
| [3052](#L3052) | $allow\_cancel\_appointment = false; |
| [3053](#L3053) | } |
| [3054](#L3054) | } |
| [3055](#L3055) | } |
| [3056](#L3056) |  |
| [3057](#L3057) | if($allow\_cancel\_appointment){ |
| [3058](#L3058) | $bookingress\_customer\_email = $bookingpress\_appointment\_log\_data['bookingpress\_customer\_email']; |
| [3059](#L3059) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [3060](#L3060) | $bookingpress\_after\_canceled\_payment\_url     = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [3061](#L3061) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [3062](#L3062) |  |
| [3063](#L3063) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $cancel\_id )); |
| [3064](#L3064) |  |
| [3065](#L3065) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $cancel\_id, $bookingress\_customer\_email); |
| [3066](#L3066) |  |
| [3067](#L3067) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings,array('bookingpress\_appointment\_token' => ''),array('bookingpress\_appointment\_booking\_id' => $cancel\_id)); |
| [3068](#L3068) |  |
| [3069](#L3069) | do\_action('bookingpress\_after\_cancel\_appointment', $cancel\_id); |
| [3070](#L3070) |  |
| [3071](#L3071) | wp\_redirect($bookingpress\_after\_canceled\_payment\_url); |
| [3072](#L3072) |  |
| [3073](#L3073) | }else{ |
| [3074](#L3074) | $bookingpress\_alert\_msg = esc\_html\_\_("We're sorry! you can't cancel this appointment because minimum required time for cancellation is already passed", "bookingpress-appointment-booking"); |
| [3075](#L3075) |  |
| [3076](#L3076) | $bookingpress\_alert\_script = "<script>"; |
| [3077](#L3077) | $bookingpress\_alert\_script .= "alert('".$bookingpress\_alert\_msg."')"; |
| [3078](#L3078) | $bookingpress\_alert\_script .= "</script>"; |
| [3079](#L3079) |  |
| [3080](#L3080) | echo $bookingpress\_alert\_script; // phpcs:ignore |
| [3081](#L3081) | } |
| [3082](#L3082) | } |
| [3083](#L3083) | } |
| [3084](#L3084) | } |
| [3085](#L3085) |  |
| [3086](#L3086) | /\*\* |
| [3087](#L3087) | \* Cancel appointment from ajax request |
| [3088](#L3088) | \* |
| [3089](#L3089) | \* @return void |
| [3090](#L3090) | \*/ |
| [3091](#L3091) | function bookingpress\_cancel\_appointment($return\_data = false,$user\_id = "") |
| [3092](#L3092) | { |
| [3093](#L3093) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications; |
| [3094](#L3094) | $response              = array(); |
| [3095](#L3095) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [3096](#L3096) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [3097](#L3097) | if (! $bpa\_verify\_nonce\_flag ) { |
| [3098](#L3098) | $response['variant']      = 'error'; |
| [3099](#L3099) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3100](#L3100) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [3101](#L3101) | $response['redirect\_url'] = ''; |
| [3102](#L3102) | if($return\_data){ |
| [3103](#L3103) | return $response; |
| [3104](#L3104) | } |
| [3105](#L3105) | wp\_send\_json($response); |
| [3106](#L3106) | die(); |
| [3107](#L3107) | } |
| [3108](#L3108) |  |
| [3109](#L3109) | $response['variant'] = 'error'; |
| [3110](#L3110) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3111](#L3111) | $response['msg']     = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [3112](#L3112) |  |
| [3113](#L3113) | $appointment\_cancelled\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_cancelled\_successfully', 'message\_setting'); |
| [3114](#L3114) | $cancel\_id                          = ! empty($\_REQUEST['cancel\_id']) ? intval($\_REQUEST['cancel\_id']) : 0; |
| [3115](#L3115) |  |
| [3116](#L3116) | $allow\_cancel\_appointment = $this->bookingpress\_check\_cancel\_appointment\_permission\_func( $cancel\_id,$user\_id ); |
| [3117](#L3117) |  |
| [3118](#L3118) | if (! empty($cancel\_id) && true == $allow\_cancel\_appointment ) { |
| [3119](#L3119) |  |
| [3120](#L3120) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [3121](#L3121) | $bookingpress\_after\_canceled\_payment\_url = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [3122](#L3122) |  |
| [3123](#L3123) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [3124](#L3124) |  |
| [3125](#L3125) | $response['variant']      = 'success'; |
| [3126](#L3126) | $response['title']        = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [3127](#L3127) | $response['msg']          = esc\_html($appointment\_cancelled\_successfully); |
| [3128](#L3128) | $response['redirect\_url'] = $bookingpress\_after\_canceled\_payment\_url; |
| [3129](#L3129) |  |
| [3130](#L3130) |  |
| [3131](#L3131) | $response = apply\_filters('bookingpress\_refund\_process\_before\_cancel\_appointment',$response,$cancel\_id); |
| [3132](#L3132) |  |
| [3133](#L3133) | if($response['variant'] == 'success' ) { |
| [3134](#L3134) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $cancel\_id )); |
| [3135](#L3135) |  |
| [3136](#L3136) | do\_action('bookingpress\_after\_cancel\_appointment\_without\_check\_payment', $cancel\_id); |
| [3137](#L3137) | // Get payment log id and insert canceled appointment entry |
| [3138](#L3138) | $payment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_payment\_logs} WHERE bookingpress\_appointment\_booking\_ref = %d", $cancel\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [3139](#L3139) |  |
| [3140](#L3140) | if (! empty($payment\_log\_data) ) { |
| [3141](#L3141) | $bookingress\_customer\_email = $payment\_log\_data['bookingpress\_customer\_email']; |
| [3142](#L3142) |  |
| [3143](#L3143) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $cancel\_id, $bookingress\_customer\_email); |
| [3144](#L3144) |  |
| [3145](#L3145) | do\_action('bookingpress\_after\_cancel\_appointment', $cancel\_id); |
| [3146](#L3146) | } |
| [3147](#L3147) | } |
| [3148](#L3148) | } |
| [3149](#L3149) | if($return\_data){ |
| [3150](#L3150) | return $response; |
| [3151](#L3151) | } |
| [3152](#L3152) | echo wp\_json\_encode($response); |
| [3153](#L3153) | exit(); |
| [3154](#L3154) | } |
| [3155](#L3155) |  |
| [3156](#L3156) | /\*\* |
| [3157](#L3157) | \* My appointment shortcode callback function |
| [3158](#L3158) | \* |
| [3159](#L3159) | \* @param  mixed $atts |
| [3160](#L3160) | \* @param  mixed $content |
| [3161](#L3161) | \* @param  mixed $tag |
| [3162](#L3162) | \* @return void |
| [3163](#L3163) | \*/ |
| [3164](#L3164) | function bookingpress\_my\_appointments\_func( $atts, $content, $tag ) |
| [3165](#L3165) | { |
| [3166](#L3166) |  |
| [3167](#L3167) | global $wpdb, $BookingPress,$bookingpress\_global\_options; |
| [3168](#L3168) |  |
| [3169](#L3169) | $this->bookingpress\_mybooking\_login\_user\_id = get\_current\_user\_id(); |
| [3170](#L3170) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3171](#L3171) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format']; |
| [3172](#L3172) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [3173](#L3173) | if ($bookingpress\_default\_date\_time\_format == 'F j, Y' ) { |
| [3174](#L3174) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [3175](#L3175) | } elseif ($bookingpress\_default\_date\_time\_format == 'Y-m-d' ) { |
| [3176](#L3176) | $bookingpress\_default\_date\_format = 'YYYY-MM-DD'; |
| [3177](#L3177) | } elseif ($bookingpress\_default\_date\_time\_format == 'm/d/Y' ) { |
| [3178](#L3178) | $bookingpress\_default\_date\_format = 'MM/DD/YYYY'; |
| [3179](#L3179) | } elseif($bookingpress\_default\_date\_time\_format == 'd/m/Y') { |
| [3180](#L3180) | $bookingpress\_default\_date\_format = 'DD/MM/YYYY'; |
| [3181](#L3181) | } elseif ($bookingpress\_default\_date\_time\_format == 'd.m.Y') { |
| [3182](#L3182) | $bookingpress\_default\_date\_format = 'DD.MM.YYYY'; |
| [3183](#L3183) | } elseif ($bookingpress\_default\_date\_time\_format == 'd-m-Y') { |
| [3184](#L3184) | $bookingpress\_default\_date\_format = 'DD-MM-YYYY'; |
| [3185](#L3185) | } |
| [3186](#L3186) |  |
| [3187](#L3187) | $this->bookingpress\_mybooking\_default\_date\_format = $bookingpress\_default\_date\_format; |
| [3188](#L3188) |  |
| [3189](#L3189) | $BookingPress->set\_front\_css(1); |
| [3190](#L3190) | $BookingPress->set\_front\_js(1); |
| [3191](#L3191) | $BookingPress->bookingpress\_load\_mybooking\_custom\_css(); |
| [3192](#L3192) | // $BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [3193](#L3193) |  |
| [3194](#L3194) | $bookingpress\_uniq\_id = uniqid(); |
| [3195](#L3195) | ob\_start(); |
| [3196](#L3196) | $bookingpress\_my\_appointments\_file\_url = BOOKINGPRESS\_VIEWS\_DIR . '/frontend/appointment\_my\_appointments.php'; |
| [3197](#L3197) | $bookingpress\_my\_appointments\_file\_url = apply\_filters('bookingpress\_change\_my\_appointmens\_shortcode\_file\_url', $bookingpress\_my\_appointments\_file\_url); |
| [3198](#L3198) | include $bookingpress\_my\_appointments\_file\_url; |
| [3199](#L3199) | $content .= ob\_get\_clean(); |
| [3200](#L3200) |  |
| [3201](#L3201) | add\_action( |
| [3202](#L3202) | 'wp\_footer', |
| [3203](#L3203) | function () use ( &$bookingpress\_uniq\_id ) { |
| [3204](#L3204) | global $bookingpress\_global\_options , $BookingPress; |
| [3205](#L3205) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3206](#L3206) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [3207](#L3207) | $requested\_module                = 'front\_appointments'; |
| [3208](#L3208) | ?> |
| [3209](#L3209) | <script data-cfasync="false"> |
| [3210](#L3210) | window.addEventListener('DOMContentLoaded', function() { |
| [3211](#L3211) | var bookingpress\_start\_of\_week = '<?php echo esc\_html($bookingpress\_global\_details['start\_of\_week']); ?>'; |
| [3212](#L3212) | var bpa\_customer\_username = '<?php echo esc\_html($this->bookingpress\_mybooking\_customer\_email); ?>'; |
| [3213](#L3213) | var bpa\_customer\_email = '<?php echo esc\_html($this->bookingpress\_mybooking\_customer\_email); ?>'; |
| [3214](#L3214) | var bpa\_customer\_id = '<?php echo esc\_html($this->bookingpress\_mybooking\_wpuser\_id); ?>'; |
| [3215](#L3215) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_helper\_vars'); ?> |
| [3216](#L3216) | var app = new Vue({ |
| [3217](#L3217) | el: '#bookingpress\_booking\_form\_<?php echo esc\_html($bookingpress\_uniq\_id); ?>', |
| [3218](#L3218) | directives: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_directives'); ?> }, |
| [3219](#L3219) | components: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_components'); ?> }, |
| [3220](#L3220) | data() { |
| [3221](#L3221) | var bookingpress\_return\_data = <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields'); ?>; |
| [3222](#L3222) | bookingpress\_return\_data['is\_display\_loader'] = '0'; |
| [3223](#L3223) | bookingpress\_return\_data['bookingpress\_uniq\_id'] = '<?php echo esc\_html($bookingpress\_uniq\_id); ?>'; |
| [3224](#L3224) | bookingpress\_return\_data['pickerOptions'] = |
| [3225](#L3225) | { |
| [3226](#L3226) | disabledDate(Time) |
| [3227](#L3227) | { |
| [3228](#L3228) | var dd = String(Time.getDate()).padStart(2, '0'); |
| [3229](#L3229) | var mm = String(Time.getMonth() + 1).padStart(2, '0'); /\* January is 0! \*/ |
| [3230](#L3230) | var yyyy = Time.getFullYear(); |
| [3231](#L3231) | var time = yyyy+ '-' + mm + '-' + dd; |
| [3232](#L3232) | if( "undefined" == typeof bookingpress\_return\_data['disabledDates'].indexOf ){ |
| [3233](#L3233) | var date = new Date(); |
| [3234](#L3234) | var newDateArr = []; |
| [3235](#L3235) | for( let dcount in bookingpress\_return\_data['disabledDates'] ){ |
| [3236](#L3236) | let dis\_date = bookingpress\_return\_data['disabledDates'][dcount]; |
| [3237](#L3237) | newDateArr.push( dis\_date ); |
| [3238](#L3238) | } |
| [3239](#L3239) | var disable\_date = newDateArr.indexOf( time ) > -1; |
| [3240](#L3240) | var date = new Date(); |
| [3241](#L3241) | date.setDate(date.getDate()-1); |
| [3242](#L3242) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [3243](#L3243) | if(disable\_date == true) { |
| [3244](#L3244) | return disable\_date; |
| [3245](#L3245) | } else { |
| [3246](#L3246) | return disable\_past\_date; |
| [3247](#L3247) | } |
| [3248](#L3248) | } else { |
| [3249](#L3249) | var disable\_date= bookingpress\_return\_data['disabledDates'].indexOf(time)>-1; |
| [3250](#L3250) | var date = new Date(); |
| [3251](#L3251) | date.setDate(date.getDate()-1); |
| [3252](#L3252) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [3253](#L3253) | if(disable\_date == true) { |
| [3254](#L3254) | return disable\_date; |
| [3255](#L3255) | } else { |
| [3256](#L3256) | return disable\_past\_date; |
| [3257](#L3257) | } |
| [3258](#L3258) | } |
| [3259](#L3259) | }, |
| [3260](#L3260) | }; |
| [3261](#L3261) | bookingpress\_return\_data['filter\_pickerOptions'] = { |
| [3262](#L3262) | 'firstDayOfWeek': parseInt(bookingpress\_start\_of\_week), |
| [3263](#L3263) | }; |
| [3264](#L3264) | return bookingpress\_return\_data; |
| [3265](#L3265) | }, |
| [3266](#L3266) | filters:{ |
| [3267](#L3267) | bookingpress\_format\_date: function(value){ |
| [3268](#L3268) | var default\_date\_format = '<?php echo esc\_html($this->bookingpress\_mybooking\_default\_date\_format); ?>'; |
| [3269](#L3269) | <?php $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); ?> |
| [3270](#L3270) | return moment(String(value)).locale('<?php echo esc\_html($bookingpress\_site\_current\_lang\_moment\_locale); ?>').format(default\_date\_format); |
| [3271](#L3271) | }, |
| [3272](#L3272) | bookingpress\_format\_time: function(value){ |
| [3273](#L3273) | var default\_time\_format = '<?php echo esc\_html($bookingpress\_formatted\_timeslot); ?>'; |
| [3274](#L3274) | <?php $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); ?> |
| [3275](#L3275) | return moment(String(value), "HH:mm:ss").locale('<?php echo esc\_html($bookingpress\_site\_current\_lang\_moment\_locale); ?>').format(default\_time\_format) |
| [3276](#L3276) | } |
| [3277](#L3277) | }, |
| [3278](#L3278) | beforeCreate(){ |
| [3279](#L3279) | this.is\_front\_appointment\_empty\_loader = '1'; |
| [3280](#L3280) | }, |
| [3281](#L3281) | created(){ |
| [3282](#L3282) | }, |
| [3283](#L3283) | mounted() { |
| [3284](#L3284) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_on\_load\_methods'); ?> |
| [3285](#L3285) | }, |
| [3286](#L3286) | methods: { |
| [3287](#L3287) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_vue\_methods'); ?> |
| [3288](#L3288) | }, |
| [3289](#L3289) | }); |
| [3290](#L3290) | }); |
| [3291](#L3291) | </script> |
| [3292](#L3292) | <?php |
| [3293](#L3293) | }, |
| [3294](#L3294) | 100 |
| [3295](#L3295) | ); |
| [3296](#L3296) |  |
| [3297](#L3297) | $bookingress\_load\_js\_css\_all\_pages = $BookingPress->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [3298](#L3298) |  |
| [3299](#L3299) | if($bookingress\_load\_js\_css\_all\_pages != 'true' ) { |
| [3300](#L3300) |  |
| [3301](#L3301) | $bookingpress\_custom\_css = $BookingPress->bookingpress\_get\_customize\_settings('custom\_css', 'booking\_form'); |
| [3302](#L3302) | $bookingpress\_custom\_css = !empty($bookingpress\_custom\_css) ? stripslashes\_deep($bookingpress\_custom\_css) : ''; |
| [3303](#L3303) | wp\_add\_inline\_style( 'bookingpress\_front\_mybookings\_custom\_css', $bookingpress\_custom\_css, 'after' ); |
| [3304](#L3304) |  |
| [3305](#L3305) | } |
| [3306](#L3306) | return do\_shortcode($content); |
| [3307](#L3307) | } |
| [3308](#L3308) |  |
| [3309](#L3309) | /\*\* |
| [3310](#L3310) | \* Get customers my appointments list |
| [3311](#L3311) | \* |
| [3312](#L3312) | \* @return void |
| [3313](#L3313) | \*/ |
| [3314](#L3314) | function bookingpress\_get\_customer\_appointments\_func($return\_data = false, $user\_id = "") |
| [3315](#L3315) | { |
| [3316](#L3316) | global $BookingPress,$wpdb,$tbl\_bookingpress\_appointment\_bookings,$tbl\_bookingpress\_customers,$bookingpress\_global\_options, $tbl\_bookingpress\_payment\_logs; |
| [3317](#L3317) | $response              = array(); |
| [3318](#L3318) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [3319](#L3319) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [3320](#L3320) | if (! $bpa\_verify\_nonce\_flag ) { |
| [3321](#L3321) | $response['variant'] = 'error'; |
| [3322](#L3322) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3323](#L3323) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [3324](#L3324) | if($return\_data){ |
| [3325](#L3325) | return $response; |
| [3326](#L3326) | } |
| [3327](#L3327) | wp\_send\_json($response); |
| [3328](#L3328) | die(); |
| [3329](#L3329) | } |
| [3330](#L3330) | $bpa\_login\_customer\_id             = get\_current\_user\_id(); |
| [3331](#L3331) | if(!empty($user\_id)){ |
| [3332](#L3332) | $bpa\_login\_customer\_id = $user\_id; |
| [3333](#L3333) | } |
| [3334](#L3334) |  |
| [3335](#L3335) | $bookingpress\_get\_customer\_details = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id =%d AND bookingpress\_user\_status = 1 ORDER BY bookingpress\_customer\_id DESC", $bpa\_login\_customer\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [3336](#L3336) | $bookingpress\_current\_user\_id      = ! empty($bookingpress\_get\_customer\_details['bookingpress\_customer\_id']) ? $bookingpress\_get\_customer\_details['bookingpress\_customer\_id'] : 0; |
| [3337](#L3337) | $bookingpress\_customer\_data = $appointments\_data = array(); |
| [3338](#L3338) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = ''; |
| [3339](#L3339) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = ''; |
| [3340](#L3340) | $bookingpress\_customer\_data['bookingpress\_avatar\_url'] = BOOKINGPRESS\_IMAGES\_URL . '/default-avatar.jpg'; |
| [3341](#L3341) |  |
| [3342](#L3342) | if(empty($bookingpress\_current\_user\_id) && (is\_user\_logged\_in() || !empty($user\_id))) { |
| [3343](#L3343) |  |
| [3344](#L3344) | $bookingpress\_current\_user\_obj = wp\_get\_current\_user(); |
| [3345](#L3345) | if(!empty($user\_id)){ |
| [3346](#L3346) | $bookingpress\_current\_user\_obj = get\_user\_by('id', $user\_id); |
| [3347](#L3347) | } |
| [3348](#L3348) | $bookingpress\_customer\_name  = ! empty($bookingpress\_current\_user\_obj->data->user\_login) ? $bookingpress\_current\_user\_obj->data->user\_login : ''; |
| [3349](#L3349) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [3350](#L3350) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = stripslashes\_deep($bookingpress\_customer\_email); |
| [3351](#L3351) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [3352](#L3352) | } |
| [3353](#L3353) |  |
| [3354](#L3354) | $bookingpress\_total\_appointments = 0; |
| [3355](#L3355) |  |
| [3356](#L3356) | $perpage     = isset($\_POST['perpage']) ? intval($\_POST['perpage']) : 10; |
| [3357](#L3357) | $currentpage = isset($\_POST['currentpage']) ? intval($\_POST['currentpage']) : 1; |
| [3358](#L3358) | $offset      = ( ! empty($currentpage) && $currentpage > 1 ) ? ( ( $currentpage - 1 ) \* $perpage ) : 0; |
| [3359](#L3359) |  |
| [3360](#L3360) | if (! empty($bookingpress\_current\_user\_id) ) { |
| [3361](#L3361) | $bpa\_customer\_firstname = ! empty($bookingpress\_get\_customer\_details['bookingpress\_user\_firstname']) ? stripslashes\_deep($bookingpress\_get\_customer\_details['bookingpress\_user\_firstname']) : ''; |
| [3362](#L3362) | $bpa\_customer\_lastname = ! empty($bookingpress\_get\_customer\_details['bookingpress\_user\_lastname']) ? stripslashes\_deep($bookingpress\_get\_customer\_details['bookingpress\_user\_lastname']) : ''; |
| [3363](#L3363) | $bookingpress\_user\_fullname = $bpa\_customer\_firstname.' '.$bpa\_customer\_lastname ; |
| [3364](#L3364) | if( is\_user\_logged\_in() ){ |
| [3365](#L3365) | if( is\_user\_logged\_in() ){ |
| [3366](#L3366) | $bookingpress\_current\_user\_obj = wp\_get\_current\_user(); |
| [3367](#L3367) |  |
| [3368](#L3368) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [3369](#L3369) | $bookingpress\_user\_email = stripslashes\_deep($bookingpress\_customer\_email); |
| [3370](#L3370) | } |
| [3371](#L3371) | } else { |
| [3372](#L3372) | $bookingpress\_user\_email = ! empty( $bookingpress\_get\_customer\_details['bookingpress\_user\_email'] ) ? sanitize\_email( $bookingpress\_get\_customer\_details['bookingpress\_user\_email'] ) : ''; |
| [3373](#L3373) | } |
| [3374](#L3374) | $bpa\_avatar\_url = get\_avatar\_url( $bpa\_login\_customer\_id ); |
| [3375](#L3375) |  |
| [3376](#L3376) | $bookingpress\_get\_existing\_avatar\_url = $BookingPress->get\_bookingpress\_customersmeta( $bookingpress\_current\_user\_id, 'customer\_avatar\_details' ); |
| [3377](#L3377) | $bookingpress\_get\_existing\_avatar\_url = ! empty( $bookingpress\_get\_existing\_avatar\_url ) ? maybe\_unserialize( $bookingpress\_get\_existing\_avatar\_url ) : array(); |
| [3378](#L3378) | $use\_default\_placeholder = false; |
| [3379](#L3379) | if ( ! empty( $bookingpress\_get\_existing\_avatar\_url[0]['url'] ) ) { |
| [3380](#L3380) | $bookingpress\_user\_avatar = $bookingpress\_get\_existing\_avatar\_url[0]['url']; |
| [3381](#L3381) | } else { |
| [3382](#L3382) | $bookingpress\_user\_avatar = BOOKINGPRESS\_IMAGES\_URL . '/default-avatar.jpg'; |
| [3383](#L3383) | $use\_default\_placeholder = true; |
| [3384](#L3384) | } |
| [3385](#L3385) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = $bookingpress\_user\_email; |
| [3386](#L3386) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = $bookingpress\_user\_fullname; |
| [3387](#L3387) | $bookingpress\_customer\_data['bookingpress\_avatar\_url'] = $bookingpress\_user\_avatar; |
| [3388](#L3388) | $bookingpress\_customer\_data['bookingpress\_use\_placeholder'] = $use\_default\_placeholder; |
| [3389](#L3389) |  |
| [3390](#L3390) | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_REQUEST['search\_data'] contains mixed array and it's been sanitized properly using 'appointment\_sanatize\_field' function |
| [3391](#L3391) | $bookingpress\_search\_data        = ! empty($\_REQUEST['search\_data']) ? array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['search\_data']) : array(); |
| [3392](#L3392) | $bookingpress\_search\_query       = ''; |
| [3393](#L3393) | if( is\_user\_logged\_in() ){ |
| [3394](#L3394) | $bookingpress\_current\_user\_wpid = get\_current\_user\_id(); |
| [3395](#L3395) | $bookingpress\_search\_query\_where = "WHERE 1=1 AND ( bookingpress\_customer\_id IN ( SELECT bookingpress\_customer\_id FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = {$bookingpress\_current\_user\_wpid} ) ) "; |
| [3396](#L3396) | } else { |
| [3397](#L3397) | $bookingpress\_search\_query\_where = "WHERE 1=1 AND (bookingpress\_customer\_id={$bookingpress\_current\_user\_id}) "; |
| [3398](#L3398) | } |
| [3399](#L3399) |  |
| [3400](#L3400) | if (! empty($bookingpress\_search\_data) ) { |
| [3401](#L3401) | if (! empty($bookingpress\_search\_data['search\_appointment']) ) { |
| [3402](#L3402) | $bookingpress\_search\_string       = $bookingpress\_search\_data['search\_appointment']; |
| [3403](#L3403) | $bookingpress\_search\_query\_where .= "AND (bookingpress\_service\_name LIKE '%{$bookingpress\_search\_string}%') "; |
| [3404](#L3404) | } |
| [3405](#L3405) | if ( !empty ( $bookingpress\_search\_data['selected\_date\_range'] ) && ! empty($bookingpress\_search\_data['selected\_date\_range'][0]) && !empty($bookingpress\_search\_data['selected\_date\_range'][1]) ) { |
| [3406](#L3406) | $bookingpress\_search\_date         = $bookingpress\_search\_data['selected\_date\_range']; |
| [3407](#L3407) | $start\_date                       = date('Y-m-d', strtotime($bookingpress\_search\_date[0])); |
| [3408](#L3408) | $end\_date                         = date('Y-m-d', strtotime($bookingpress\_search\_date[1])); |
| [3409](#L3409) | $bookingpress\_search\_query\_where .= "AND (bookingpress\_appointment\_date BETWEEN '{$start\_date}' AND '{$end\_date}')"; |
| [3410](#L3410) | } |
| [3411](#L3411) | } |
| [3412](#L3412) |  |
| [3413](#L3413) | $bookingpress\_global\_data = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3414](#L3414) | $bookingpress\_date\_format = $bookingpress\_global\_data['wp\_default\_date\_format']; |
| [3415](#L3415) | $bookingpress\_time\_format = $bookingpress\_global\_data['wp\_default\_time\_format']; |
| [3416](#L3416) | $bookingpress\_appointment\_statuses = $bookingpress\_global\_data['appointment\_status']; |
| [3417](#L3417) | $bookingpress\_payment\_statuses = $bookingpress\_global\_data['payment\_status']; |
| [3418](#L3418) |  |
| [3419](#L3419) | $bookingpress\_total\_appointments = $wpdb->get\_var("SELECT COUNT(bookingpress\_appointment\_booking\_id) FROM {$tbl\_bookingpress\_appointment\_bookings} {$bookingpress\_search\_query} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_appointment\_date DESC"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [3420](#L3420) | $appointments\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} {$bookingpress\_search\_query} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_appointment\_date DESC LIMIT {$offset} , {$perpage}", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [3421](#L3421) |  |
| [3422](#L3422) |  |
| [3423](#L3423) | if(!empty($appointments\_data) && is\_array($appointments\_data) ){ |
| [3424](#L3424) | foreach($appointments\_data as $k => $v){ |
| [3425](#L3425) | $use\_default\_date\_time = false; |
| [3426](#L3426) | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && '0000-00-00' != $v['bookingpress\_selected\_appointment\_date'] && $BookingPress->bpa\_is\_pro\_active() ){ |
| [3427](#L3427) | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_selected\_appointment\_date'])); |
| [3428](#L3428) | } else { |
| [3429](#L3429) | $use\_default\_date\_time = true; |
| [3430](#L3430) | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_appointment\_date'])); |
| [3431](#L3431) | } |
| [3432](#L3432) |  |
| [3433](#L3433) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_date'] = $bookingpress\_appointment\_date; |
| [3434](#L3434) |  |
| [3435](#L3435) | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) && $BookingPress->bpa\_is\_pro\_active() && '00:00:00' != $v['bookingpress\_selected\_appointment\_time'] && true == $use\_default\_date\_time ){ |
| [3436](#L3436) | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_time'])); |
| [3437](#L3437) | } else { |
| [3438](#L3438) | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_appointment\_time'])); |
| [3439](#L3439) | } |
| [3440](#L3440) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_start\_time'] = $bookingpress\_appointment\_start\_time; |
| [3441](#L3441) |  |
| [3442](#L3442) | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) && $BookingPress->bpa\_is\_pro\_active() && '00:00:00' != $v['bookingpress\_selected\_appointment\_end\_time'] && true == $use\_default\_date\_time ){ |
| [3443](#L3443) | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_end\_time'])); |
| [3444](#L3444) | } else { |
| [3445](#L3445) | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_appointment\_end\_time'])); |
| [3446](#L3446) | } |
| [3447](#L3447) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_end\_time'] = $bookingpress\_appointment\_end\_time; |
| [3448](#L3448) |  |
| [3449](#L3449) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Minutes', 'bookingpress-appointment-booking'); |
| [3450](#L3450) | if($v['bookingpress\_service\_duration\_unit'] == 'h'){ |
| [3451](#L3451) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Hours', 'bookingpress-appointment-booking'); |
| [3452](#L3452) | } else if( 'd' == $v['bookingpress\_service\_duration\_unit'] ){ |
| [3453](#L3453) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Days', 'bookingpress-appointment-booking'); |
| [3454](#L3454) | } |
| [3455](#L3455) |  |
| [3456](#L3456) | $appointments\_data[$k]['bookingpress\_service\_name'] = !empty($v['bookingpress\_service\_name']) ? stripslashes\_deep($v['bookingpress\_service\_name']) : ''; |
| [3457](#L3457) | $appointments\_data[$k]['bookingpress\_service\_duration\_label'] = $bookingpress\_appointment\_duration\_unit\_label; |
| [3458](#L3458) |  |
| [3459](#L3459) | $bookingpress\_appointment\_status\_label = ''; |
| [3460](#L3460) | foreach($bookingpress\_appointment\_statuses as $k2 => $v2){ |
| [3461](#L3461) | if($v2['value'] == $v['bookingpress\_appointment\_status']){ |
| [3462](#L3462) | $bookingpress\_appointment\_status\_label = $v2['text']; |
| [3463](#L3463) | } |
| [3464](#L3464) | } |
| [3465](#L3465) | $appointments\_data[$k]['bookingpress\_appointment\_status\_label'] = $bookingpress\_appointment\_status\_label; |
| [3466](#L3466) |  |
| [3467](#L3467) | $currency\_name   = $v['bookingpress\_service\_currency']; |
| [3468](#L3468) | $currency\_symbol = $BookingPress->bookingpress\_get\_currency\_symbol($currency\_name); |
| [3469](#L3469) | $bookingpress\_paid\_price\_with\_currency = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($v['bookingpress\_paid\_amount'], $currency\_symbol); |
| [3470](#L3470) | $appointments\_data[$k]['bookingpress\_paid\_price\_with\_currency'] = $bookingpress\_paid\_price\_with\_currency; |
| [3471](#L3471) |  |
| [3472](#L3472) | //get payment log details |
| [3473](#L3473) | $bookingpress\_appointment\_id = intval($v['bookingpress\_appointment\_booking\_id']); |
| [3474](#L3474) | $bookingpress\_payment\_log\_details = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_payment\_logs} WHERE bookingpress\_appointment\_booking\_ref = %d", $bookingpress\_appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_payment\_logs is a table name. false alarm |
| [3475](#L3475) |  |
| [3476](#L3476) | $appointments\_data[$k]['booking\_id'] = !empty($v['bookingpress\_booking\_id']) ? sanitize\_text\_field($v['bookingpress\_booking\_id']) : 1; |
| [3477](#L3477) |  |
| [3478](#L3478) | $bookingpress\_payment\_status = $bookingpress\_payment\_status\_label = $bookingpress\_payment\_method = ''; |
| [3479](#L3479) | if(!empty($bookingpress\_payment\_log\_details)){ |
| [3480](#L3480) | $bookingpress\_payment\_method = $bookingpress\_payment\_log\_details['bookingpress\_payment\_gateway']; |
| [3481](#L3481) | $bookingpress\_payment\_status = $bookingpress\_payment\_log\_details['bookingpress\_payment\_status']; |
| [3482](#L3482) |  |
| [3483](#L3483) | foreach($bookingpress\_payment\_statuses as $k2 => $v2){ |
| [3484](#L3484) | if($v2['value'] == $bookingpress\_payment\_status){ |
| [3485](#L3485) | $bookingpress\_payment\_status\_label = $v2['text']; |
| [3486](#L3486) | } |
| [3487](#L3487) | } |
| [3488](#L3488) | } |
| [3489](#L3489) | $appointments\_data[$k]['bookingpress\_payment\_status'] = $bookingpress\_payment\_status; |
| [3490](#L3490) | $appointments\_data[$k]['bookingpress\_payment\_status\_label'] = $bookingpress\_payment\_status\_label; |
| [3491](#L3491) | $bookingpress\_payment\_method\_label = $bookingpress\_payment\_method; |
| [3492](#L3492) |  |
| [3493](#L3493) | if(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method == 'on-site' ) { |
| [3494](#L3494) | $bookingpress\_payment\_method\_label = $BookingPress->bookingpress\_get\_customize\_settings('locally\_text','booking\_form'); |
| [3495](#L3495) | } elseif(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method != 'manual') { |
| [3496](#L3496) | $bookingpress\_payment\_method\_label = $BookingPress->bookingpress\_get\_customize\_settings($bookingpress\_payment\_method.'\_text','booking\_form'); |
| [3497](#L3497) | if(empty($bookingpress\_payment\_method\_label)) { |
| [3498](#L3498) | $bookingpress\_payment\_method\_label = $bookingpress\_payment\_method; |
| [3499](#L3499) | } |
| [3500](#L3500) | } |
| [3501](#L3501) | $appointments\_data[$k]['bookingpress\_payment\_method'] = $bookingpress\_payment\_method; |
| [3502](#L3502) | $appointments\_data[$k]['bookingpress\_payment\_method\_label'] = $bookingpress\_payment\_method\_label; |
| [3503](#L3503) |  |
| [3504](#L3504) | $appointment\_status\_cls = ''; |
| [3505](#L3505) | $appointments\_data[$k]['bookingpress\_payment\_status\_class'] = $appointment\_status\_cls; |
| [3506](#L3506) |  |
| [3507](#L3507) | $appointments\_data = apply\_filters('bookingpress\_modify\_my\_appointment\_data', $appointments\_data, $k); |
| [3508](#L3508) | } |
| [3509](#L3509) | } |
| [3510](#L3510) | } |
| [3511](#L3511) | $data['customer\_details'] = $bookingpress\_customer\_data; |
| [3512](#L3512) | $data['items'] = $appointments\_data; |
| [3513](#L3513) | $data['total\_records'] = $bookingpress\_total\_appointments; |
| [3514](#L3514) |  |
| [3515](#L3515) | $data = apply\_filters('bookingpress\_modify\_my\_appointments\_data', $data); |
| [3516](#L3516) | if($return\_data){ |
| [3517](#L3517) | return $data; |
| [3518](#L3518) | } |
| [3519](#L3519) | wp\_send\_json($data); |
| [3520](#L3520) | exit; |
| [3521](#L3521) | } |
| [3522](#L3522) |  |
| [3523](#L3523) | /\*\* |
| [3524](#L3524) | \* Callback function of [bookingpress\_appointment\_service] shortcode |
| [3525](#L3525) | \* |
| [3526](#L3526) | \* @param  mixed $atts |
| [3527](#L3527) | \* @param  mixed $content |
| [3528](#L3528) | \* @param  mixed $tag |
| [3529](#L3529) | \* @return void |
| [3530](#L3530) | \*/ |
| [3531](#L3531) | function bookingpress\_appointment\_service\_func( $atts, $content, $tag ) |
| [3532](#L3532) | { |
| [3533](#L3533) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [3534](#L3534) | $BookingPress->set\_front\_css(1); |
| [3535](#L3535) | $BookingPress->set\_front\_js(1); |
| [3536](#L3536) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3537](#L3537) | $bookingpress\_short\_atts = array( |
| [3538](#L3538) | 'appointment\_id' => 0, |
| [3539](#L3539) | ); |
| [3540](#L3540) |  |
| [3541](#L3541) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3542](#L3542) | $appointment\_id = $atts['appointment\_id']; |
| [3543](#L3543) |  |
| [3544](#L3544) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3545](#L3545) |  |
| [3546](#L3546) | if(!empty($bookingpress\_uniq\_id)){ |
| [3547](#L3547) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3548](#L3548) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3549](#L3549) | } else { |
| [3550](#L3550) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3551](#L3551) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3552](#L3552) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3553](#L3553) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3554](#L3554) |  |
| [3555](#L3555) | if(!empty($bookingpress\_entry\_id)){ |
| [3556](#L3556) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3557](#L3557) |  |
| [3558](#L3558) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3559](#L3559) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3560](#L3560) | } |
| [3561](#L3561) | } |
| [3562](#L3562) | } |
| [3563](#L3563) | } |
| [3564](#L3564) | } |
| [3565](#L3565) |  |
| [3566](#L3566) | $appointment\_data = array(); |
| [3567](#L3567) |  |
| [3568](#L3568) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3569](#L3569) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3570](#L3570) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3571](#L3571) |  |
| [3572](#L3572) | if (empty($appointment\_id) && !empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification) { |
| [3573](#L3573) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id'])); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3574](#L3574) |  |
| [3575](#L3575) |  |
| [3576](#L3576) | //$bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3577](#L3577) |  |
| [3578](#L3578) |  |
| [3579](#L3579) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3580](#L3580) | if( false == $bookingpress\_entry\_details ){ |
| [3581](#L3581) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3582](#L3582) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3583](#L3583) | } |
| [3584](#L3584) |  |
| [3585](#L3585) |  |
| [3586](#L3586) |  |
| [3587](#L3587) | if (! empty($bookingpress\_entry\_details) ) { |
| [3588](#L3588) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3589](#L3589) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [3590](#L3590) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [3591](#L3591) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [3592](#L3592) |  |
| [3593](#L3593) |  |
| [3594](#L3594) | //$appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3595](#L3595) |  |
| [3596](#L3596) | $bookingpress\_entry\_id = $appointment\_id; |
| [3597](#L3597) | //$appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3598](#L3598) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3599](#L3599) | if( false == $bookingpress\_entry\_details ){ |
| [3600](#L3600) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3601](#L3601) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3602](#L3602) | } |
| [3603](#L3603) |  |
| [3604](#L3604) | if (empty($appointment\_data) ) { |
| [3605](#L3605) | // If no appointment data found then display data from entries table. |
| [3606](#L3606) | $appointment\_data = $bookingpress\_entry\_details; |
| [3607](#L3607) | } |
| [3608](#L3608) | } |
| [3609](#L3609) | } else { |
| [3610](#L3610) |  |
| [3611](#L3611) |  |
| [3612](#L3612) | if($appointment\_id > 0){ |
| [3613](#L3613) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3614](#L3614) | if( false == $appointment\_data ){ |
| [3615](#L3615) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3616](#L3616) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3617](#L3617) | } |
| [3618](#L3618) | } |
| [3619](#L3619) |  |
| [3620](#L3620) | } |
| [3621](#L3621) |  |
| [3622](#L3622) | $appointment\_data = apply\_filters('bookingpress\_modify\_service\_shortcode\_details', $appointment\_data, $appointment\_id); |
| [3623](#L3623) |  |
| [3624](#L3624) | $content .= '<div class="bookingpress\_service\_shortcode\_container">'; |
| [3625](#L3625) | if (! empty($appointment\_data) ) { |
| [3626](#L3626) | if(empty($appointment\_data['bookingpress\_service\_name'])){ |
| [3627](#L3627) | foreach($appointment\_data as $appointment\_data\_key => $appointment\_data\_val){ |
| [3628](#L3628) | $content .= "<div class='bookingpress\_service\_name\_div'>"; |
| [3629](#L3629) | $content .= "<span class='bookingpress\_service\_name'>" . stripslashes\_deep(esc\_html($appointment\_data\_val['bookingpress\_service\_name'])) . '</span>'; |
| [3630](#L3630) | $content .= '</div><br/>'; |
| [3631](#L3631) | } |
| [3632](#L3632) | }else{ |
| [3633](#L3633) | $content .= "<div class='bookingpress\_service\_name\_div'>"; |
| [3634](#L3634) | $content .= "<span class='bookingpress\_service\_name'>" . stripslashes\_deep(esc\_html($appointment\_data['bookingpress\_service\_name'])) . '</span>'; |
| [3635](#L3635) | $content .= '</div>'; |
| [3636](#L3636) | } |
| [3637](#L3637) | } |
| [3638](#L3638) | $content .= '</div>'; |
| [3639](#L3639) |  |
| [3640](#L3640) | return $content; |
| [3641](#L3641) | } |
| [3642](#L3642) |  |
| [3643](#L3643) | /\*\* |
| [3644](#L3644) | \* Callback function of [bookingpress\_appointment\_datetime] shortcode |
| [3645](#L3645) | \* |
| [3646](#L3646) | \* @param  mixed $atts |
| [3647](#L3647) | \* @param  mixed $content |
| [3648](#L3648) | \* @param  mixed $tag |
| [3649](#L3649) | \* @return void |
| [3650](#L3650) | \*/ |
| [3651](#L3651) | function bookingpress\_appointment\_datetime\_func( $atts, $content, $tag ) |
| [3652](#L3652) | { |
| [3653](#L3653) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [3654](#L3654) | $BookingPress->set\_front\_css(1); |
| [3655](#L3655) | $BookingPress->set\_front\_js(1); |
| [3656](#L3656) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3657](#L3657) |  |
| [3658](#L3658) | $bookingpress\_short\_atts = array( |
| [3659](#L3659) | 'appointment\_id' => 0, |
| [3660](#L3660) | ); |
| [3661](#L3661) |  |
| [3662](#L3662) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3663](#L3663) | $appointment\_id = $atts['appointment\_id']; |
| [3664](#L3664) |  |
| [3665](#L3665) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3666](#L3666) | if(!empty($bookingpress\_uniq\_id)){ |
| [3667](#L3667) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3668](#L3668) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3669](#L3669) | } else { |
| [3670](#L3670) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3671](#L3671) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3672](#L3672) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3673](#L3673) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3674](#L3674) |  |
| [3675](#L3675) | if(!empty($bookingpress\_entry\_id)){ |
| [3676](#L3676) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3677](#L3677) |  |
| [3678](#L3678) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3679](#L3679) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3680](#L3680) | } |
| [3681](#L3681) | } |
| [3682](#L3682) | } |
| [3683](#L3683) | } |
| [3684](#L3684) | } |
| [3685](#L3685) |  |
| [3686](#L3686) | $appointment\_data = array(); |
| [3687](#L3687) |  |
| [3688](#L3688) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3689](#L3689) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3690](#L3690) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3691](#L3691) |  |
| [3692](#L3692) | if (empty($appointment\_id) && ! empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification ) { |
| [3693](#L3693) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3694](#L3694) |  |
| [3695](#L3695) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3696](#L3696) | if( false == $bookingpress\_entry\_details ){ |
| [3697](#L3697) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3698](#L3698) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3699](#L3699) | } |
| [3700](#L3700) |  |
| [3701](#L3701) |  |
| [3702](#L3702) |  |
| [3703](#L3703) | if (! empty($bookingpress\_entry\_details) ) { |
| [3704](#L3704) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3705](#L3705) |  |
| [3706](#L3706) | $bookingpress\_entry\_id = $appointment\_id; |
| [3707](#L3707) |  |
| [3708](#L3708) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3709](#L3709) | if( false == $bookingpress\_entry\_details ){ |
| [3710](#L3710) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3711](#L3711) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3712](#L3712) | } |
| [3713](#L3713) |  |
| [3714](#L3714) |  |
| [3715](#L3715) | if (empty($appointment\_data) ) { |
| [3716](#L3716) | // If no appointment data found then display data from entries table. |
| [3717](#L3717) | $appointment\_data = $bookingpress\_entry\_details; |
| [3718](#L3718) | } |
| [3719](#L3719) | } |
| [3720](#L3720) | } else { |
| [3721](#L3721) |  |
| [3722](#L3722) |  |
| [3723](#L3723) | if($appointment\_id > 0){ |
| [3724](#L3724) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3725](#L3725) | if( false == $appointment\_data ){ |
| [3726](#L3726) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3727](#L3727) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3728](#L3728) | } |
| [3729](#L3729) | } |
| [3730](#L3730) |  |
| [3731](#L3731) |  |
| [3732](#L3732) | } |
| [3733](#L3733) |  |
| [3734](#L3734) | $appointment\_data = apply\_filters('bookingpress\_modify\_datetime\_shortcode\_data', $appointment\_data, $appointment\_id); |
| [3735](#L3735) |  |
| [3736](#L3736) | $content .= '<div class="bookinpress-datetime-container">'; |
| [3737](#L3737) | $content = apply\_filters('bookingpress\_modify\_datetime\_shortcode\_content', $content, $appointment\_data); |
| [3738](#L3738) | $bookingpress\_is\_group\_datetime = apply\_filters('bookingpress\_check\_group\_order\_for\_thankyou\_datetime', 0, $appointment\_data); |
| [3739](#L3739) |  |
| [3740](#L3740) | if ($bookingpress\_is\_group\_datetime == 0 && !empty($appointment\_data) ) { |
| [3741](#L3741) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3742](#L3742) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format'] . ' ' . $bookingpress\_global\_options\_arr['wp\_default\_time\_format']; |
| [3743](#L3743) |  |
| [3744](#L3744) |  |
| [3745](#L3745) |  |
| [3746](#L3746) | if( empty( $appointment\_data['bookingpress\_appointment\_date'] ) ){ |
| [3747](#L3747) | foreach($appointment\_data as $appointment\_data\_key => $appointment\_data\_val){ |
| [3748](#L3748) | $content .= "<div class='bookingpress\_appointment\_datetime\_div'>"; |
| [3749](#L3749) | $check\_timezone = false; |
| [3750](#L3750) | if( !empty( $appointment\_data\_val['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data\_val['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data\_val['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data\_val['bookingpress\_selected\_appointment\_time'] ){ |
| [3751](#L3751) | $booked\_appointment\_datetime = esc\_html($appointment\_data\_val['bookingpress\_selected\_appointment\_date']) . ' ' . esc\_html($appointment\_data\_val['bookingpress\_selected\_appointment\_time']); |
| [3752](#L3752) | } else { |
| [3753](#L3753) | $check\_timezone = true; |
| [3754](#L3754) | $booked\_appointment\_datetime = esc\_html($appointment\_data\_val['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data\_val['bookingpress\_appointment\_time']); |
| [3755](#L3755) | } |
| [3756](#L3756) |  |
| [3757](#L3757) | if(empty($bookingpress\_entry\_details['bookingpress\_customer\_timezone'])){ |
| [3758](#L3758) | $bookingpress\_entry\_id = !empty($appointment\_data\_val['bookingpress\_entry\_id']) ? intval($appointment\_data\_val['bookingpress\_entry\_id']) : 0; |
| [3759](#L3759) | if(!empty($bookingpress\_entry\_id)){ |
| [3760](#L3760) |  |
| [3761](#L3761) | //Get entries details |
| [3762](#L3762) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3763](#L3763) | } |
| [3764](#L3764) | } |
| [3765](#L3765) |  |
| [3766](#L3766) | if( true == $check\_timezone ){ |
| [3767](#L3767) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_entry\_details['bookingpress\_customer\_timezone'], $bookingpress\_entry\_details ); |
| [3768](#L3768) | } |
| [3769](#L3769) |  |
| [3770](#L3770) | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data\_val ); |
| [3771](#L3771) |  |
| [3772](#L3772) | $booked\_appointment\_date = date($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [3773](#L3773) |  |
| [3774](#L3774) | $content .= "<span class='bookingpress\_appointment\_datetime'>" . $booked\_appointment\_date . '</span>'; |
| [3775](#L3775) | $content .= '</div><br/>'; |
| [3776](#L3776) | } |
| [3777](#L3777) | }else{ |
| [3778](#L3778) | $check\_timezone = false; |
| [3779](#L3779) |  |
| [3780](#L3780) | if( ( !empty( $appointment\_data['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data['bookingpress\_selected\_appointment\_time'] ) || 'd' == $appointment\_data['bookingpress\_service\_duration\_unit']  ){ |
| [3781](#L3781) | $booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_selected\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_selected\_appointment\_time']); |
| [3782](#L3782) | } else { |
| [3783](#L3783) | $check\_timezone = true; |
| [3784](#L3784) | $booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_appointment\_time']); |
| [3785](#L3785) | } |
| [3786](#L3786) | //$booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_appointment\_time']); |
| [3787](#L3787) |  |
| [3788](#L3788) | if(empty($bookingpress\_entry\_details['bookingpress\_customer\_timezone'])){ |
| [3789](#L3789) | $bookingpress\_entry\_id = !empty($appointment\_data['bookingpress\_entry\_id']) ? intval($appointment\_data['bookingpress\_entry\_id']) : 0; |
| [3790](#L3790) | if(!empty($bookingpress\_entry\_id)){ |
| [3791](#L3791) |  |
| [3792](#L3792) | //Get entries details |
| [3793](#L3793) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3794](#L3794) | } |
| [3795](#L3795) | } |
| [3796](#L3796) |  |
| [3797](#L3797) | if( true == $check\_timezone ){ |
| [3798](#L3798) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_entry\_details['bookingpress\_customer\_timezone'], $bookingpress\_entry\_details ); |
| [3799](#L3799) | } |
| [3800](#L3800) |  |
| [3801](#L3801) | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data ); |
| [3802](#L3802) |  |
| [3803](#L3803) | $booked\_appointment\_date = date\_i18n($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [3804](#L3804) | $content .= "<div class='bookingpress\_appointment\_datetime\_div'>"; |
| [3805](#L3805) | $content .= "<span class='bookingpress\_appointment\_datetime'>" . $booked\_appointment\_date . '</span>'; |
| [3806](#L3806) | $content .= '</div>'; |
| [3807](#L3807) | } |
| [3808](#L3808) | } |
| [3809](#L3809) | $content .= '</div>'; |
| [3810](#L3810) |  |
| [3811](#L3811) | return $content; |
| [3812](#L3812) | } |
| [3813](#L3813) |  |
| [3814](#L3814) | /\*\* |
| [3815](#L3815) | \* Callback function of [booking\_id] shortcode |
| [3816](#L3816) | \* |
| [3817](#L3817) | \* @param  mixed $atts |
| [3818](#L3818) | \* @param  mixed $content |
| [3819](#L3819) | \* @param  mixed $tag |
| [3820](#L3820) | \* @return void |
| [3821](#L3821) | \*/ |
| [3822](#L3822) | function bookingpress\_booking\_id\_func($atts, $content, $tag){ |
| [3823](#L3823) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_payment\_logs; |
| [3824](#L3824) | $BookingPress->set\_front\_css(1); |
| [3825](#L3825) | $BookingPress->set\_front\_js(1); |
| [3826](#L3826) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3827](#L3827) |  |
| [3828](#L3828) | $bookingpress\_short\_atts = array( |
| [3829](#L3829) | 'appointment\_id' => 0, |
| [3830](#L3830) | ); |
| [3831](#L3831) |  |
| [3832](#L3832) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3833](#L3833) | $appointment\_id = $atts['appointment\_id']; |
| [3834](#L3834) |  |
| [3835](#L3835) | $entry\_id = 0; |
| [3836](#L3836) |  |
| [3837](#L3837) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3838](#L3838) | if(!empty($bookingpress\_uniq\_id)){ |
| [3839](#L3839) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3840](#L3840) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3841](#L3841) | if(!empty($appointment\_id)){ |
| [3842](#L3842) | $bookingpress\_appointment\_details = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_order\_id = %d", $appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_details is table name defined globally. False Positive alarm |
| [3843](#L3843) | if(!empty($bookingpress\_appointment\_details)){ |
| [3844](#L3844) | $content .= '#'.$bookingpress\_appointment\_details['bookingpress\_booking\_id']; |
| [3845](#L3845) | return $content; |
| [3846](#L3846) | } |
| [3847](#L3847) | } |
| [3848](#L3848) | } else { |
| [3849](#L3849) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3850](#L3850) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3851](#L3851) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3852](#L3852) | $entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3853](#L3853) | } |
| [3854](#L3854) | } |
| [3855](#L3855) | } |
| [3856](#L3856) |  |
| [3857](#L3857) | if(empty($appointment\_id) && !empty($\_GET['appointment\_id']) ){ |
| [3858](#L3858) | $entry\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3859](#L3859) |  |
| [3860](#L3860) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3861](#L3861) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3862](#L3862) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3863](#L3863) |  |
| [3864](#L3864) | if(!$bookingpress\_nonce\_verification){ |
| [3865](#L3865) | return $content; |
| [3866](#L3866) | } |
| [3867](#L3867) | } |
| [3868](#L3868) |  |
| [3869](#L3869) |  |
| [3870](#L3870) |  |
| [3871](#L3871) | $appointment\_data  = array(); |
| [3872](#L3872) | $bookingpress\_booking\_id = ''; |
| [3873](#L3873) |  |
| [3874](#L3874) | if(!empty($entry\_id)){ |
| [3875](#L3875) | //Get appointment details |
| [3876](#L3876) | $bookingpress\_appointment\_details = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3877](#L3877) |  |
| [3878](#L3878) | $bookingpress\_booking\_id = !empty($bookingpress\_appointment\_details['bookingpress\_booking\_id']) ? $bookingpress\_appointment\_details['bookingpress\_booking\_id'] : ''; |
| [3879](#L3879) | } |
| [3880](#L3880) |  |
| [3881](#L3881) | $bookingpress\_booking\_id = apply\_filters('bookingpress\_modify\_booking\_id\_shortcode\_data', $bookingpress\_booking\_id, $entry\_id); |
| [3882](#L3882) |  |
| [3883](#L3883) | if(!empty($bookingpress\_booking\_id)){ |
| [3884](#L3884) | $content .= '#'.$bookingpress\_booking\_id; |
| [3885](#L3885) | } |
| [3886](#L3886) | return $content; |
| [3887](#L3887) | } |
| [3888](#L3888) |  |
| [3889](#L3889) | /\*\* |
| [3890](#L3890) | \* Callback function of [bookingpress\_appointment\_customername] shortcode |
| [3891](#L3891) | \* |
| [3892](#L3892) | \* @param  mixed $atts |
| [3893](#L3893) | \* @param  mixed $content |
| [3894](#L3894) | \* @param  mixed $tag |
| [3895](#L3895) | \* @return void |
| [3896](#L3896) | \*/ |
| [3897](#L3897) | function bookingpress\_appointment\_customername\_func( $atts, $content, $tag ) |
| [3898](#L3898) | { |
| [3899](#L3899) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [3900](#L3900) | $BookingPress->set\_front\_css(1); |
| [3901](#L3901) | $BookingPress->set\_front\_js(1); |
| [3902](#L3902) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3903](#L3903) |  |
| [3904](#L3904) | $bookingpress\_short\_atts = array( |
| [3905](#L3905) | 'appointment\_id' => 0, |
| [3906](#L3906) | ); |
| [3907](#L3907) |  |
| [3908](#L3908) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3909](#L3909) | $appointment\_id = $atts['appointment\_id']; |
| [3910](#L3910) |  |
| [3911](#L3911) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3912](#L3912) |  |
| [3913](#L3913) | if(!empty($bookingpress\_uniq\_id)){ |
| [3914](#L3914) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3915](#L3915) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3916](#L3916) | } else { |
| [3917](#L3917) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3918](#L3918) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3919](#L3919) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3920](#L3920) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3921](#L3921) | if(!empty($bookingpress\_entry\_id)){ |
| [3922](#L3922) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3923](#L3923) |  |
| [3924](#L3924) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3925](#L3925) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3926](#L3926) | } |
| [3927](#L3927) | } |
| [3928](#L3928) | } |
| [3929](#L3929) | } |
| [3930](#L3930) | } |
| [3931](#L3931) |  |
| [3932](#L3932) | $appointment\_data  = array(); |
| [3933](#L3933) |  |
| [3934](#L3934) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3935](#L3935) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3936](#L3936) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3937](#L3937) |  |
| [3938](#L3938) | $customer\_fullname = ''; |
| [3939](#L3939) | if (empty($appointment\_id) && ! empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification ) { |
| [3940](#L3940) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3941](#L3941) |  |
| [3942](#L3942) | //$bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3943](#L3943) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3944](#L3944) | if( false == $bookingpress\_entry\_details ){ |
| [3945](#L3945) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3946](#L3946) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3947](#L3947) | } |
| [3948](#L3948) |  |
| [3949](#L3949) |  |
| [3950](#L3950) | if (! empty($bookingpress\_entry\_details) ) { |
| [3951](#L3951) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3952](#L3952) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [3953](#L3953) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [3954](#L3954) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [3955](#L3955) |  |
| [3956](#L3956) | //$appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3957](#L3957) |  |
| [3958](#L3958) | $bookingpress\_entry\_id = $appointment\_id; |
| [3959](#L3959) | //$appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3960](#L3960) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3961](#L3961) | if( false == $bookingpress\_entry\_details ){ |
| [3962](#L3962) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3963](#L3963) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3964](#L3964) | } |
| [3965](#L3965) |  |
| [3966](#L3966) | if (empty($appointment\_data) ) { |
| [3967](#L3967) | // If no data found from appointments then display data from entries table. |
| [3968](#L3968) | $appointment\_data = $bookingpress\_entry\_details; |
| [3969](#L3969) | } |
| [3970](#L3970) | } |
| [3971](#L3971) | } else { |
| [3972](#L3972) |  |
| [3973](#L3973) | if($appointment\_id > 0){ |
| [3974](#L3974) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3975](#L3975) | if( false == $appointment\_data ){ |
| [3976](#L3976) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3977](#L3977) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3978](#L3978) | } |
| [3979](#L3979) | } |
| [3980](#L3980) |  |
| [3981](#L3981) |  |
| [3982](#L3982) | } |
| [3983](#L3983) |  |
| [3984](#L3984) | $appointment\_data = apply\_filters('bookingpress\_modify\_customer\_details\_shortcode\_data', $appointment\_data, $appointment\_id); |
| [3985](#L3985) |  |
| [3986](#L3986) | $content .= "<div class='bookingpress-appointment-customer-container'>"; |
| [3987](#L3987) | if (! empty($appointment\_data) ) { |
| [3988](#L3988) |  |
| [3989](#L3989) | $customer\_firstname = ! empty($appointment\_data['bookingpress\_customer\_firstname']) ? $appointment\_data['bookingpress\_customer\_firstname'] : ''; |
| [3990](#L3990) | $customer\_lastname  = ! empty($appointment\_data['bookingpress\_customer\_lastname']) ? $appointment\_data['bookingpress\_customer\_lastname'] : ''; |
| [3991](#L3991) | $customer\_email     = ! empty($appointment\_data['bookingpress\_customer\_email']) ? $appointment\_data['bookingpress\_customer\_email'] : ''; |
| [3992](#L3992) | $customer\_fullname = !empty($appointment\_data['bookingpress\_customer\_name']) ? $appointment\_data['bookingpress\_customer\_name'] : ($customer\_firstname . ' ' . $customer\_lastname); |
| [3993](#L3993) | if(empty($appointment\_data['bookingpress\_customer\_name']) && empty($customer\_firstname) && empty($customer\_lastname) ) { |
| [3994](#L3994) | $customer\_fullname = $customer\_email; |
| [3995](#L3995) | } |
| [3996](#L3996) | $content .= "<div class='bookingpress\_appointment\_customername\_div'>"; |
| [3997](#L3997) | $content .= "<span class='bookingpress\_appointment\_customername'>" . stripslashes\_deep(esc\_html($customer\_fullname)) . '</span>'; |
| [3998](#L3998) | $content .= '</div>'; |
| [3999](#L3999) | } |
| [4000](#L4000) | $content .= "</div>"; |
| [4001](#L4001) |  |
| [4002](#L4002) | return do\_shortcode($content); |
| [4003](#L4003) | } |
| [4004](#L4004) |  |
| [4005](#L4005) | /\*\* |
| [4006](#L4006) | \* Callback function of [bookingpress\_company\_avatar] shortcode |
| [4007](#L4007) | \* |
| [4008](#L4008) | \* @return void |
| [4009](#L4009) | \*/ |
| [4010](#L4010) | function bookingpress\_company\_avatar\_func() |
| [4011](#L4011) | { |
| [4012](#L4012) | global $BookingPress; |
| [4013](#L4013) | $BookingPress->set\_front\_css(1); |
| [4014](#L4014) | $BookingPress->set\_front\_js(1); |
| [4015](#L4015) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4016](#L4016) |  |
| [4017](#L4017) | $content                         = ''; |
| [4018](#L4018) | $bookingpress\_company\_avatar\_url = $BookingPress->bookingpress\_get\_settings('company\_avatar\_url', 'company\_setting'); |
| [4019](#L4019) | if ($bookingpress\_company\_avatar\_url != '' ) { |
| [4020](#L4020) | $bookingpress\_company\_avatar\_url = esc\_url($bookingpress\_company\_avatar\_url); |
| [4021](#L4021) | $content                         = '<img src=' . $bookingpress\_company\_avatar\_url . ' width=100 height=100 >'; |
| [4022](#L4022) | } else { |
| [4023](#L4023) | $content = esc\_html\_e('Company avatar not found', 'bookingpress-appointment-booking'); |
| [4024](#L4024) | } |
| [4025](#L4025) | return $content; |
| [4026](#L4026) | } |
| [4027](#L4027) |  |
| [4028](#L4028) | /\*\* |
| [4029](#L4029) | \* Callback function of [bookingpress\_company\_name] shortcode |
| [4030](#L4030) | \* |
| [4031](#L4031) | \* @return void |
| [4032](#L4032) | \*/ |
| [4033](#L4033) | function bookingpress\_company\_name\_func() |
| [4034](#L4034) | { |
| [4035](#L4035) | global $BookingPress; |
| [4036](#L4036) | $BookingPress->set\_front\_css(1); |
| [4037](#L4037) | $BookingPress->set\_front\_js(1); |
| [4038](#L4038) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4039](#L4039) |  |
| [4040](#L4040) | $content                   = ''; |
| [4041](#L4041) | $bookingpress\_company\_name = $BookingPress->bookingpress\_get\_settings('company\_name', 'company\_setting'); |
| [4042](#L4042) | if ($bookingpress\_company\_name != '' ) { |
| [4043](#L4043) | $content = esc\_html($bookingpress\_company\_name); |
| [4044](#L4044) | } else { |
| [4045](#L4045) | $content = esc\_html\_e('Company name not found', 'bookingpress-appointment-booking'); |
| [4046](#L4046) | } |
| [4047](#L4047) | return $content; |
| [4048](#L4048) | } |
| [4049](#L4049) |  |
| [4050](#L4050) | /\*\* |
| [4051](#L4051) | \* Callback function of [bookingpress\_company\_website] shortcode |
| [4052](#L4052) | \* |
| [4053](#L4053) | \* @return void |
| [4054](#L4054) | \*/ |
| [4055](#L4055) | function bookingpress\_company\_website\_func() |
| [4056](#L4056) | { |
| [4057](#L4057) | global $BookingPress; |
| [4058](#L4058) | $BookingPress->set\_front\_css(1); |
| [4059](#L4059) | $BookingPress->set\_front\_js(1); |
| [4060](#L4060) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4061](#L4061) |  |
| [4062](#L4062) | $content                      = ''; |
| [4063](#L4063) | $bookingpress\_company\_website = $BookingPress->bookingpress\_get\_settings('company\_website', 'company\_setting'); |
| [4064](#L4064) | if ($bookingpress\_company\_website != '' ) { |
| [4065](#L4065) | $content = esc\_html($bookingpress\_company\_website); |
| [4066](#L4066) | } else { |
| [4067](#L4067) | $content = esc\_html\_e('Company website name not found', 'bookingpress-appointment-booking'); |
| [4068](#L4068) | } |
| [4069](#L4069) | return $content; |
| [4070](#L4070) | } |
| [4071](#L4071) |  |
| [4072](#L4072) |  |
| [4073](#L4073) | /\*\* |
| [4074](#L4074) | \* Callback function of [bookingpress\_company\_address] shortcode |
| [4075](#L4075) | \* |
| [4076](#L4076) | \* @return void |
| [4077](#L4077) | \*/ |
| [4078](#L4078) | function bookingpress\_company\_address\_func() |
| [4079](#L4079) | { |
| [4080](#L4080) | global $BookingPress; |
| [4081](#L4081) | $BookingPress->set\_front\_css(1); |
| [4082](#L4082) | $BookingPress->set\_front\_js(1); |
| [4083](#L4083) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4084](#L4084) |  |
| [4085](#L4085) | $content                      = ''; |
| [4086](#L4086) | $bookingpress\_company\_address = $BookingPress->bookingpress\_get\_settings('company\_address', 'company\_setting'); |
| [4087](#L4087) | if ($bookingpress\_company\_address != '' ) { |
| [4088](#L4088) | $content = esc\_html($bookingpress\_company\_address); |
| [4089](#L4089) | } else { |
| [4090](#L4090) | $content = esc\_html\_e('Company address not found', 'bookingpress-appointment-booking'); |
| [4091](#L4091) | } |
| [4092](#L4092) | return $content; |
| [4093](#L4093) | } |
| [4094](#L4094) |  |
| [4095](#L4095) | /\*\* |
| [4096](#L4096) | \* Callback function of [bookingpress\_company\_phone] shortcode |
| [4097](#L4097) | \* |
| [4098](#L4098) | \* @return void |
| [4099](#L4099) | \*/ |
| [4100](#L4100) | function bookingpress\_company\_phone\_func() |
| [4101](#L4101) | { |
| [4102](#L4102) | global $BookingPress; |
| [4103](#L4103) | $BookingPress->set\_front\_css(1); |
| [4104](#L4104) | $BookingPress->set\_front\_js(1); |
| [4105](#L4105) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4106](#L4106) |  |
| [4107](#L4107) | $content                      = ''; |
| [4108](#L4108) | $bookingpress\_company\_phone   = $BookingPress->bookingpress\_get\_settings('company\_phone\_number', 'company\_setting'); |
| [4109](#L4109) | $bookingpress\_company\_country = $BookingPress->bookingpress\_get\_settings('company\_phone\_country', 'company\_setting'); |
| [4110](#L4110) |  |
| [4111](#L4111) | if ($bookingpress\_company\_phone != '' ) { |
| [4112](#L4112) | $content = esc\_html($bookingpress\_company\_phone); |
| [4113](#L4113) | } else { |
| [4114](#L4114) | $content = esc\_html\_e('Company phone number not found', 'bookingpress-appointment-booking'); |
| [4115](#L4115) | } |
| [4116](#L4116) | return $content; |
| [4117](#L4117) | } |
| [4118](#L4118) |  |
| [4119](#L4119) | /\*\* |
| [4120](#L4120) | \* Function for add/update appointment |
| [4121](#L4121) | \* |
| [4122](#L4122) | \* @return void |
| [4123](#L4123) | \*/ |
| [4124](#L4124) | function bookingpress\_save\_appointment\_booking\_func() |
| [4125](#L4125) | { |
| [4126](#L4126) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customer\_bookings, $tbl\_bookingpress\_customers, $bookingpress\_payment\_gateways, $bookingpress\_debug\_payment\_log\_id; |
| [4127](#L4127) | $response              = array(); |
| [4128](#L4128) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4129](#L4129) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4130](#L4130) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4131](#L4131) | $response['variant'] = 'error'; |
| [4132](#L4132) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4133](#L4133) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4134](#L4134) | wp\_send\_json($response); |
| [4135](#L4135) | die(); |
| [4136](#L4136) | } |
| [4137](#L4137) | $response['variant']       = 'error'; |
| [4138](#L4138) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4139](#L4139) | $response['msg']           = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [4140](#L4140) | $response['is\_redirect']   = 0; |
| [4141](#L4141) | $response['redirect\_data'] = ''; |
| [4142](#L4142) | $response['is\_spam']       = 1; |
| [4143](#L4143) |  |
| [4144](#L4144) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [4145](#L4145) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [4146](#L4146) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [4147](#L4147) | } |
| [4148](#L4148) |  |
| [4149](#L4149) | $response = apply\_filters('bookingpress\_validate\_spam\_protection', $response, array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data'])); // phpcs:ignore |
| [4150](#L4150) |  |
| [4151](#L4151) | $booking\_response = $this->bookingpress\_before\_book\_appointment\_func(); |
| [4152](#L4152) |  |
| [4153](#L4153) | if( !empty( $booking\_response ) ){ |
| [4154](#L4154) | $booking\_response\_arr = json\_decode( $booking\_response, true ); |
| [4155](#L4155) | if( !empty( $booking\_response\_arr['variant'] ) && 'error' == $booking\_response\_arr['variant'] ){ |
| [4156](#L4156) | if(!empty($booking\_response\_arr['msg'])) { |
| [4157](#L4157) | $booking\_response\_arr['msg'] = stripslashes\_deep(html\_entity\_decode($booking\_response\_arr['msg'],ENT\_QUOTES)); |
| [4158](#L4158) | } |
| [4159](#L4159) | wp\_send\_json($booking\_response\_arr); |
| [4160](#L4160) | die; |
| [4161](#L4161) | } |
| [4162](#L4162) | } |
| [4163](#L4163) |  |
| [4164](#L4164) | $appointment\_booked\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_booked\_successfully', 'message\_setting'); |
| [4165](#L4165) |  |
| [4166](#L4166) | if (! empty($\_REQUEST) && ! empty($\_REQUEST['appointment\_data']) ) { |
| [4167](#L4167) |  |
| [4168](#L4168) | $bookingpress\_appointment\_data            = array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_data'] contains mixed array and sanitized properly using 'appointment\_sanatize\_field' function |
| [4169](#L4169) | $bookingpress\_payment\_gateway             = ! empty($bookingpress\_appointment\_data['selected\_payment\_method']) ? $bookingpress\_appointment\_data['selected\_payment\_method'] : ''; |
| [4170](#L4170) | $bookingpress\_appointment\_on\_site\_enabled = ( $bookingpress\_appointment\_data['selected\_payment\_method'] == 'onsite' ) ? 1 : 0; |
| [4171](#L4171) | $payment\_gateway                          = ( $bookingpress\_appointment\_on\_site\_enabled ) ? 'on-site' : $bookingpress\_payment\_gateway; |
| [4172](#L4172) |  |
| [4173](#L4173) | $bookingpress\_service\_price = isset($bookingpress\_appointment\_data['service\_price\_without\_currency']) ? floatval($bookingpress\_appointment\_data['service\_price\_without\_currency']) : 0; |
| [4174](#L4174) | if ($bookingpress\_service\_price == 0 ) { |
| [4175](#L4175) | $payment\_gateway = ' - '; |
| [4176](#L4176) | } |
| [4177](#L4177) |  |
| [4178](#L4178) | $bpa\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [4179](#L4179) |  |
| [4180](#L4180) | $bpa\_service\_data               = $BookingPress->get\_service\_by\_id( $bpa\_selected\_service ); |
| [4181](#L4181) | $bpa\_service\_amount             = ! empty($bpa\_service\_data['bookingpress\_service\_price']) ? (float) $bpa\_service\_data['bookingpress\_service\_price'] : 0; |
| [4182](#L4182) |  |
| [4183](#L4183) | if( $bpa\_service\_amount != $bookingpress\_service\_price ){ |
| [4184](#L4184) | $bookingpress\_invalid\_amount = esc\_html\_\_('Sorry! Appointment could not be processed', 'bookingpress-appointment-booking'); |
| [4185](#L4185) |  |
| [4186](#L4186) | $response['variant']       = 'error'; |
| [4187](#L4187) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4188](#L4188) | $response['msg']           = $bookingpress\_invalid\_amount; |
| [4189](#L4189) | $response['is\_redirect']   = 0; |
| [4190](#L4190) | $response['reason']        = 'price mismatched ' . $bpa\_service\_amount . ' --- ' . $bookingpress\_service\_price; |
| [4191](#L4191) | $response['redirect\_data'] = ''; |
| [4192](#L4192) | $response['is\_spam']       = 0; |
| [4193](#L4193) |  |
| [4194](#L4194) | echo wp\_json\_encode($response); |
| [4195](#L4195) | exit; |
| [4196](#L4196) | } |
| [4197](#L4197) |  |
| [4198](#L4198) | $bookingpress\_return\_data = apply\_filters('bookingpress\_validate\_submitted\_form', $payment\_gateway, $bookingpress\_appointment\_data); |
| [4199](#L4199) |  |
| [4200](#L4200) | if ($payment\_gateway == 'on-site' && $bookingpress\_service\_price > 0 ) { |
| [4201](#L4201) | $entry\_id = ! empty($bookingpress\_return\_data['entry\_id']) ? $bookingpress\_return\_data['entry\_id'] : 0; |
| [4202](#L4202) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('onsite\_appointment\_status', 'general\_setting'); |
| [4203](#L4203) |  |
| [4204](#L4204) | if($bookingpress\_appointment\_status ==  '1' ) { |
| [4205](#L4205) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '1', '', '', 1); |
| [4206](#L4206) | $bookingpress\_redirect\_url = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4207](#L4207) | } else { |
| [4208](#L4208) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '2', '', '', 1); |
| [4209](#L4209) | $bookingpress\_redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4210](#L4210) | } |
| [4211](#L4211) | if (! empty($bookingpress\_redirect\_url) ) { |
| [4212](#L4212) | $response['variant']       = 'redirect\_url'; |
| [4213](#L4213) | $response['title']         = ''; |
| [4214](#L4214) | $response['msg']           = ''; |
| [4215](#L4215) | $response['is\_redirect']   = 1; |
| [4216](#L4216) | $response['redirect\_data'] = $bookingpress\_redirect\_url; |
| [4217](#L4217) | } else { |
| [4218](#L4218) | $response['variant'] = 'success'; |
| [4219](#L4219) | $response['title']   = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [4220](#L4220) | $response['msg']     = esc\_html($appointment\_booked\_successfully); |
| [4221](#L4221) | } |
| [4222](#L4222) | } elseif ($bookingpress\_service\_price == 0 ) { |
| [4223](#L4223) | $entry\_id = ! empty($bookingpress\_return\_data['entry\_id']) ? $bookingpress\_return\_data['entry\_id'] : 0; |
| [4224](#L4224) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '1', '', '', 1); |
| [4225](#L4225) |  |
| [4226](#L4226) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4227](#L4227) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [4228](#L4228) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [4229](#L4229) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4230](#L4230) | } |
| [4231](#L4231) |  |
| [4232](#L4232) | $bookingpress\_redirect\_url = $redirect\_url; |
| [4233](#L4233) | if (! empty($bookingpress\_redirect\_url) ) { |
| [4234](#L4234) | $response['variant']       = 'redirect\_url'; |
| [4235](#L4235) | $response['title']         = ''; |
| [4236](#L4236) | $response['msg']           = ''; |
| [4237](#L4237) | $response['is\_redirect']   = 1; |
| [4238](#L4238) | $response['redirect\_data'] = $bookingpress\_redirect\_url; |
| [4239](#L4239) | } else { |
| [4240](#L4240) | $response['variant'] = 'success'; |
| [4241](#L4241) | $response['title']   = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [4242](#L4242) | $response['msg']     = esc\_html($appointment\_booked\_successfully); |
| [4243](#L4243) | } |
| [4244](#L4244) | } else { |
| [4245](#L4245) | if ($payment\_gateway == 'paypal' ) { |
| [4246](#L4246) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [4247](#L4247) | $bookingpress\_is\_sandbox\_mode = ( $bookingpress\_payment\_mode != 'live' ) ? true : false; |
| [4248](#L4248) | $bookingpress\_gateway\_status  = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [4249](#L4249) | $bookingpress\_merchant\_email  = $BookingPress->bookingpress\_get\_settings('paypal\_merchant\_email', 'payment\_setting'); |
| [4250](#L4250) | $bookingpress\_api\_username    = $BookingPress->bookingpress\_get\_settings('paypal\_api\_username', 'payment\_setting'); |
| [4251](#L4251) | $bookingpress\_api\_password    = $BookingPress->bookingpress\_get\_settings('paypal\_api\_password', 'payment\_setting'); |
| [4252](#L4252) | $bookingpress\_api\_signature   = $BookingPress->bookingpress\_get\_settings('paypal\_api\_signature', 'payment\_setting'); |
| [4253](#L4253) |  |
| [4254](#L4254) | $bookingpress\_paypal\_error\_msg  = esc\_html\_\_('PayPal Configuration Error', 'bookingpress-appointment-booking'); |
| [4255](#L4255) | $bookingpress\_paypal\_error\_msg .= ': '; |
| [4256](#L4256) | if (empty($bookingpress\_merchant\_email) ) { |
| [4257](#L4257) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure merchant email address', 'bookingpress-appointment-booking'); |
| [4258](#L4258) |  |
| [4259](#L4259) | $response['variant']       = 'error'; |
| [4260](#L4260) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4261](#L4261) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4262](#L4262) | $response['is\_redirect']   = 0; |
| [4263](#L4263) | $response['redirect\_data'] = ''; |
| [4264](#L4264) | $response['is\_spam']       = 0; |
| [4265](#L4265) |  |
| [4266](#L4266) | echo wp\_json\_encode($response); |
| [4267](#L4267) | exit; |
| [4268](#L4268) | } |
| [4269](#L4269) |  |
| [4270](#L4270) | if (empty($bookingpress\_api\_username) ) { |
| [4271](#L4271) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Username', 'bookingpress-appointment-booking'); |
| [4272](#L4272) |  |
| [4273](#L4273) | $response['variant']       = 'error'; |
| [4274](#L4274) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4275](#L4275) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4276](#L4276) | $response['is\_redirect']   = 0; |
| [4277](#L4277) | $response['redirect\_data'] = ''; |
| [4278](#L4278) | $response['is\_spam']       = 0; |
| [4279](#L4279) |  |
| [4280](#L4280) | echo wp\_json\_encode($response); |
| [4281](#L4281) | exit; |
| [4282](#L4282) | } |
| [4283](#L4283) |  |
| [4284](#L4284) | if (empty($bookingpress\_api\_password) ) { |
| [4285](#L4285) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Password', 'bookingpress-appointment-booking'); |
| [4286](#L4286) |  |
| [4287](#L4287) | $response['variant']       = 'error'; |
| [4288](#L4288) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4289](#L4289) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4290](#L4290) | $response['is\_redirect']   = 0; |
| [4291](#L4291) | $response['redirect\_data'] = ''; |
| [4292](#L4292) | $response['is\_spam']       = 0; |
| [4293](#L4293) |  |
| [4294](#L4294) | echo wp\_json\_encode($response); |
| [4295](#L4295) | exit; |
| [4296](#L4296) | } |
| [4297](#L4297) |  |
| [4298](#L4298) | if (empty($bookingpress\_api\_signature) ) { |
| [4299](#L4299) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Signature', 'bookingpress-appointment-booking'); |
| [4300](#L4300) |  |
| [4301](#L4301) | $response['variant']       = 'error'; |
| [4302](#L4302) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4303](#L4303) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4304](#L4304) | $response['is\_redirect']   = 0; |
| [4305](#L4305) | $response['redirect\_data'] = ''; |
| [4306](#L4306) | $response['is\_spam']       = 0; |
| [4307](#L4307) |  |
| [4308](#L4308) | echo wp\_json\_encode($response); |
| [4309](#L4309) | exit; |
| [4310](#L4310) | } |
| [4311](#L4311) |  |
| [4312](#L4312) | $entry\_id                          = $bookingpress\_return\_data['entry\_id']; |
| [4313](#L4313) | $currency                          = $bookingpress\_return\_data['currency']; |
| [4314](#L4314) | $currency\_symbol                   = $BookingPress->bookingpress\_get\_currency\_code($currency); |
| [4315](#L4315) | $bookingpress\_final\_payable\_amount = isset($bookingpress\_return\_data['payable\_amount']) ? $bookingpress\_return\_data['payable\_amount'] : 0; |
| [4316](#L4316) | $customer\_details                  = $bookingpress\_return\_data['customer\_details']; |
| [4317](#L4317) | $customer\_email                    = ! empty($customer\_details['customer\_email']) ? $customer\_details['customer\_email'] : ''; |
| [4318](#L4318) |  |
| [4319](#L4319) | $bookingpress\_service\_name = ! empty($bookingpress\_return\_data['service\_data']['bookingpress\_service\_name']) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_('Appointment Booking', 'bookingpress-appointment-booking'); |
| [4320](#L4320) |  |
| [4321](#L4321) | $custom\_var = $entry\_id; |
| [4322](#L4322) |  |
| [4323](#L4323) | $sandbox = $bookingpress\_is\_sandbox\_mode ? 'sandbox.' : ''; |
| [4324](#L4324) |  |
| [4325](#L4325) | $notify\_url = $bookingpress\_return\_data['notify\_url']; |
| [4326](#L4326) |  |
| [4327](#L4327) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4328](#L4328) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [4329](#L4329) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [4330](#L4330) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4331](#L4331) | } |
| [4332](#L4332) |  |
| [4333](#L4333) | $bookingpress\_paypal\_cancel\_url\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_failed\_payment\_redirection', 'booking\_form'); |
| [4334](#L4334) | $bookingpress\_paypal\_cancel\_url = get\_permalink($bookingpress\_paypal\_cancel\_url\_id); |
| [4335](#L4335) | $cancel\_url                     = ! empty($bookingpress\_paypal\_cancel\_url) ? $bookingpress\_paypal\_cancel\_url : BOOKINGPRESS\_HOME\_URL; |
| [4336](#L4336) | $cancel\_url                     = add\_query\_arg('is\_cancel', 1, esc\_url($cancel\_url)); |
| [4337](#L4337) |  |
| [4338](#L4338) | $cmd          = '\_xclick'; |
| [4339](#L4339) | $paypal\_form  = '<form name="\_xclick" id="bookingpress\_paypal\_form" action="https://www.' . $sandbox . 'paypal.com/cgi-bin/webscr" method="post">'; |
| [4340](#L4340) | $paypal\_form .= '<input type="hidden" name="cmd" value="' . $cmd . '" />'; |
| [4341](#L4341) | $paypal\_form .= '<input type="hidden" name="amount" value="' . $bookingpress\_final\_payable\_amount . '" />'; |
| [4342](#L4342) | $paypal\_form .= '<input type="hidden" name="business" value="' . $bookingpress\_merchant\_email . '" />'; |
| [4343](#L4343) | $paypal\_form .= '<input type="hidden" name="notify\_url" value="' . $notify\_url . '" />'; |
| [4344](#L4344) | $paypal\_form .= '<input type="hidden" name="cancel\_return" value="' . $cancel\_url . '" />'; |
| [4345](#L4345) | $paypal\_form .= '<input type="hidden" name="return" value="' . $redirect\_url . '" />'; |
| [4346](#L4346) | $paypal\_form .= '<input type="hidden" name="rm" value="2" />'; |
| [4347](#L4347) | $paypal\_form .= '<input type="hidden" name="lc" value="en\_US" />'; |
| [4348](#L4348) | $paypal\_form .= '<input type="hidden" name="no\_shipping" value="1" />'; |
| [4349](#L4349) | $paypal\_form .= '<input type="hidden" name="custom" value="' . $custom\_var . '" />'; |
| [4350](#L4350) | $paypal\_form .= '<input type="hidden" name="on0" value="user\_email" />'; |
| [4351](#L4351) | $paypal\_form .= '<input type="hidden" name="os0" value="' . $customer\_email . '" />'; |
| [4352](#L4352) | $paypal\_form .= '<input type="hidden" name="currency\_code" value="' . $currency\_symbol . '" />'; |
| [4353](#L4353) | $paypal\_form .= '<input type="hidden" name="page\_style" value="primary" />'; |
| [4354](#L4354) | $paypal\_form .= '<input type="hidden" name="charset" value="UTF-8" />'; |
| [4355](#L4355) | $paypal\_form .= '<input type="hidden" name="item\_name" value="' . $bookingpress\_service\_name . '" />'; |
| [4356](#L4356) | $paypal\_form .= '<input type="hidden" name="item\_number" value="1" />'; |
| [4357](#L4357) | $paypal\_form .= '<input type="submit" value="Pay with PayPal!" />'; |
| [4358](#L4358) | $paypal\_form .= '</form>'; |
| [4359](#L4359) |  |
| [4360](#L4360) | do\_action('bookingpress\_payment\_log\_entry', 'paypal', 'payment form redirected data', 'bookingpress', $paypal\_form, $bookingpress\_debug\_payment\_log\_id); |
| [4361](#L4361) |  |
| [4362](#L4362) | $paypal\_form .= '<script type="text/javascript">document.getElementById("bookingpress\_paypal\_form").submit();</script>'; |
| [4363](#L4363) |  |
| [4364](#L4364) | $response['variant']       = 'redirect'; |
| [4365](#L4365) | $response['title']         = ''; |
| [4366](#L4366) | $response['msg']           = ''; |
| [4367](#L4367) | $response['is\_redirect']   = 1; |
| [4368](#L4368) | $response['redirect\_data'] = $paypal\_form; |
| [4369](#L4369) | $response['entry\_id']      = $entry\_id; |
| [4370](#L4370) | } |
| [4371](#L4371) | } |
| [4372](#L4372) | } |
| [4373](#L4373) |  |
| [4374](#L4374) | echo wp\_json\_encode($response); |
| [4375](#L4375) | exit(); |
| [4376](#L4376) | } |
| [4377](#L4377) |  |
| [4378](#L4378) |  |
| [4379](#L4379) | /\*\* |
| [4380](#L4380) | \* Function for retrieve booking time slots |
| [4381](#L4381) | \* |
| [4382](#L4382) | \* @param  mixed $selected\_date          Pass selected date |
| [4383](#L4383) | \* @param  mixed $return                 If paramter set to true then timeslots data will return |
| [4384](#L4384) | \* @param  mixed $check\_for\_whole\_days   Time should be check for whole day or not |
| [4385](#L4385) | \* @param  mixed $check\_only\_one\_slot    Check only for one available slots or not |
| [4386](#L4386) | \* @return void |
| [4387](#L4387) | \*/ |
| [4388](#L4388) | function bookingpress\_retrieve\_timeslots( $selected\_date = '' , $return = false, $check\_for\_whole\_days = false, $check\_only\_one\_slot = false, $total\_booked\_appiontments = [] ){ |
| [4389](#L4389) |  |
| [4390](#L4390) | global $wpdb, $BookingPress, $tbl\_bookingpress\_services, $bookingpress\_global\_options, $bookingpress\_other\_debug\_log\_id, $tbl\_bookingpress\_appointment\_bookings, $bookingpress\_services, $bookingpress\_other\_debug\_log\_id; |
| [4391](#L4391) |  |
| [4392](#L4392) | $response              = array(); |
| [4393](#L4393) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4394](#L4394) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4395](#L4395) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4396](#L4396) | $response['variant'] = 'error'; |
| [4397](#L4397) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4398](#L4398) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4399](#L4399) | echo wp\_json\_encode($response); |
| [4400](#L4400) | exit(); |
| [4401](#L4401) | } |
| [4402](#L4402) | if(!empty($\_POST['appointment\_data\_obj']) && !is\_array($\_POST['appointment\_data\_obj'])) { |
| [4403](#L4403) | $\_POST['appointment\_data\_obj'] = !empty( $\_POST['appointment\_data\_obj'] ) ? json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ) : array(); //phpcs:ignore |
| [4404](#L4404) | $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [4405](#L4405) | } |
| [4406](#L4406) |  |
| [4407](#L4407) | $selected\_service\_id =  ! empty($\_POST['service\_id']) ? intval($\_POST['service\_id']) : 0; |
| [4408](#L4408) | if( empty( $selected\_service\_id ) ){ |
| [4409](#L4409) | $selected\_service\_id = !empty( $\_POST['appointment\_data\_obj']['selected\_service'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service'] ) : ( !empty( $\_POST['selected\_service'] ) ? intval( $\_POST['selected\_service'] ) : 0 ); |
| [4410](#L4410) | } |
| [4411](#L4411) |  |
| [4412](#L4412) | if( empty( $selected\_date ) ){ |
| [4413](#L4413) | $selected\_date       = ! empty($\_POST['selected\_date']) ? date('Y-m-d', strtotime(sanitize\_text\_field($\_POST['selected\_date']))) : date('Y-m-d',current\_time('timestamp')); |
| [4414](#L4414) | } |
| [4415](#L4415) | $service\_timings = array(); |
| [4416](#L4416) |  |
| [4417](#L4417) | $service\_timings\_data = array( |
| [4418](#L4418) | 'is\_daysoff' => false, |
| [4419](#L4419) | 'service\_timings' => array() |
| [4420](#L4420) | ); |
| [4421](#L4421) |  |
| [4422](#L4422) | $bookingpress\_form\_token = (isset($\_POST['appointment\_data\_obj']['bookingpress\_form\_token']))?sanitize\_text\_field($\_POST['appointment\_data\_obj']['bookingpress\_form\_token']):''; |
| [4423](#L4423) | if(empty($bookingpress\_form\_token)){ |
| [4424](#L4424) | $bookingpress\_form\_token = (isset($\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id']))?sanitize\_text\_field($\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id']):''; |
| [4425](#L4425) | } |
| [4426](#L4426) | //$bookingpress\_form\_token = !empty( $\_POST['appointment\_data\_obj']['bookingpress\_form\_token'] ) ? sanitize\_text\_field( $\_POST['appointment\_data\_obj']['bookingpress\_form\_token'] ) : sanitize\_text\_field( $\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id'] ) ; |
| [4427](#L4427) |  |
| [4428](#L4428) | $no\_timeslots\_available = $BookingPress->bookingpress\_get\_settings('no\_timeslots\_available', 'message\_setting'); |
| [4429](#L4429) |  |
| [4430](#L4430) | /\*\* filter to check minimum time requirement \*/ |
| [4431](#L4431) | $minimum\_time\_required = 'disabled'; |
| [4432](#L4432) | $minimum\_time\_required = apply\_filters( 'bookingpress\_retrieve\_minimum\_required\_time', $minimum\_time\_required, $selected\_service\_id ); |
| [4433](#L4433) |  |
| [4434](#L4434) | /\*\* Check for the available capacity \*/ |
| [4435](#L4435) | $max\_service\_capacity = 1; |
| [4436](#L4436) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $selected\_service\_id ); |
| [4437](#L4437) |  |
| [4438](#L4438) | /\*\* timeslot steps settings \*/ |
| [4439](#L4439) | $bookingpress\_show\_time\_as\_per\_service\_duration = $BookingPress->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [4440](#L4440) | $bookingpress\_shared\_service\_timeslot = $BookingPress->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [4441](#L4441) | /\*\* total booked appointment of the selected date \*/ |
| [4442](#L4442) | $where\_clause = ''; |
| [4443](#L4443) | if( 'true' != $bookingpress\_shared\_service\_timeslot ){ |
| [4444](#L4444) | $where\_clause = $wpdb->prepare( ' AND bookingpress\_service\_id = %d ', $selected\_service\_id ); |
| [4445](#L4445) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_where\_clause', $where\_clause ); |
| [4446](#L4446) | }else{ |
| [4447](#L4447) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$selected\_service\_id); |
| [4448](#L4448) | } |
| [4449](#L4449) |  |
| [4450](#L4450) | $where\_clause .= $wpdb->prepare( ' AND (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s)', '1', '2' ); |
| [4451](#L4451) |  |
| [4452](#L4452) | $bookingpress\_hide\_already\_booked\_slot = $BookingPress->bookingpress\_get\_customize\_settings( 'hide\_already\_booked\_slot', 'booking\_form' ); |
| [4453](#L4453) | $bookingpress\_hide\_already\_booked\_slot = ( $bookingpress\_hide\_already\_booked\_slot == 'true' ) ? 1 : 0; |
| [4454](#L4454) | $bookingpress\_hide\_already\_booked\_slot = apply\_filters( 'bookingpress\_change\_hide\_already\_booked\_slot\_for\_service', $bookingpress\_hide\_already\_booked\_slot, $selected\_service\_id); |
| [4455](#L4455) |  |
| [4456](#L4456) |  |
| [4457](#L4457) | $bpa\_appointment\_edit\_id = !empty( $\_POST['appointment\_data\_obj']['appointment\_update\_id'] ) ? intval( $\_POST['appointment\_data\_obj']['appointment\_update\_id'] ) : 0; |
| [4458](#L4458) |  |
| [4459](#L4459) | if( !empty( $bpa\_appointment\_edit\_id ) ){ |
| [4460](#L4460) | $where\_clause .= $wpdb->prepare( ' AND bookingpress\_appointment\_booking\_id != %d', $bpa\_appointment\_edit\_id ); |
| [4461](#L4461) | } |
| [4462](#L4462) |  |
| [4463](#L4463) | if( empty( $total\_booked\_appiontments ) && !empty( $\_POST['action'] ) && in\_array( $\_POST['action'], ['bookingpress\_front\_get\_timings' ,'bookingpress\_get\_disable\_date','bookingpress\_get\_whole\_day\_appointments', 'bookingpress\_get\_recurring\_appointments' ] ) ){ |
| [4464](#L4464) |  |
| [4465](#L4465) | $where\_clause\_overnight\_booking = apply\_filters( 'bookingpress\_modify\_where\_clause\_for\_overnight\_booking', '', $selected\_date ); |
| [4466](#L4466) | $total\_booked\_appiontments = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE (bookingpress\_appointment\_date = %s $where\_clause\_overnight\_booking) $where\_clause", $selected\_date), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [4467](#L4467) | } |
| [4468](#L4468) |  |
| [4469](#L4469) | $shared\_quantity = apply\_filters('bookingpress\_get\_shared\_capacity\_data', 'true' ); |
| [4470](#L4470) |  |
| [4471](#L4471) | /\*\* service buffer times ends \*/ |
| [4472](#L4472) |  |
| [4473](#L4473) | /\*\* retrieving staff member and service time slots \*/ |
| [4474](#L4474) | $service\_timings\_data = apply\_filters('bookingpress\_retrieve\_pro\_modules\_timeslots', $service\_timings\_data, $selected\_service\_id, $selected\_date, $minimum\_time\_required, $max\_service\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration ); |
| [4475](#L4475) |  |
| [4476](#L4476) | if( empty( $service\_timings\_data['service\_timings'] ) && false == $service\_timings\_data['is\_daysoff'] ){ |
| [4477](#L4477) | $service\_timings = $BookingPress->bookinpgress\_retrieve\_default\_workhours($selected\_service\_id, $selected\_date, $minimum\_time\_required, $max\_service\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration); |
| [4478](#L4478) | } else { |
| [4479](#L4479) | $service\_timings = $service\_timings\_data['service\_timings']; |
| [4480](#L4480) | } |
| [4481](#L4481) |  |
| [4482](#L4482) | if( true == $check\_only\_one\_slot ){ |
| [4483](#L4483) | if( 0 < count( $service\_timings ) ){ |
| [4484](#L4484) | return true; |
| [4485](#L4485) | } else { |
| [4486](#L4486) | return false; |
| [4487](#L4487) | } |
| [4488](#L4488) | } |
| [4489](#L4489) |  |
| [4490](#L4490) | wp\_cache\_delete( 'bpa\_total\_booked\_appointment\_' . $selected\_date ); |
| [4491](#L4491) |  |
| [4492](#L4492) | $selected\_service\_duration\_unit = !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit']) ? sanitize\_text\_field($\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit']) : ''; |
| [4493](#L4493) | $selected\_service\_duration\_val = !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service\_duration'] ) : ''; |
| [4494](#L4494) |  |
| [4495](#L4495) | $total\_booked\_appiontments = apply\_filters( 'bookingpress\_modify\_booked\_appointment\_data', $total\_booked\_appiontments, $selected\_date, $service\_timings, $selected\_service\_id ); |
| [4496](#L4496) |  |
| [4497](#L4497) | /\*\* Remove Booked Time Slots from the final service timings - start \*/ |
| [4498](#L4498) |  |
| [4499](#L4499) | if( !empty( $total\_booked\_appiontments ) && 'd' == $selected\_service\_duration\_unit && 1 == $selected\_service\_duration\_val && empty( $service\_timings ) ){ |
| [4500](#L4500) |  |
| [4501](#L4501) | $service\_timings = array( |
| [4502](#L4502) | array( |
| [4503](#L4503) | 'start\_time' => '00:00', |
| [4504](#L4504) | 'end\_time' => '00:00', |
| [4505](#L4505) | 'store\_start\_time' => '00:00', |
| [4506](#L4506) | 'store\_end\_time' => '00:00', |
| [4507](#L4507) | 'break\_start\_time' => '', |
| [4508](#L4508) | 'break\_end\_time' => '', |
| [4509](#L4509) | 'store\_service\_date' => $selected\_date, |
| [4510](#L4510) | 'is\_booked' => 0, |
| [4511](#L4511) | 'max\_capacity' => $max\_service\_capacity, |
| [4512](#L4512) | 'total\_booked' => '' |
| [4513](#L4513) | ) |
| [4514](#L4514) | ); |
| [4515](#L4515) | } |
| [4516](#L4516) |  |
| [4517](#L4517) | $bpa\_remove\_crossed\_time = apply\_filters( 'bookingpress\_remove\_crossed\_timeslot', true); |
| [4518](#L4518) |  |
| [4519](#L4519) | $booked\_timing\_keys = array(); |
| [4520](#L4520) |  |
| [4521](#L4521) | $service\_temp\_timings = $service\_timings; |
| [4522](#L4522) |  |
| [4523](#L4523) | if( !empty( $total\_booked\_appiontments ) && !empty( $service\_timings ) ){ |
| [4524](#L4524) | foreach( $total\_booked\_appiontments as $booked\_appointment\_data ){ |
| [4525](#L4525) | $total\_guests = 0; |
| [4526](#L4526) |  |
| [4527](#L4527) | $booked\_appointment\_start\_time = $booked\_appointment\_data['bookingpress\_appointment\_time']; |
| [4528](#L4528) | $booked\_appointment\_end\_time = $booked\_appointment\_data['bookingpress\_appointment\_end\_time']; |
| [4529](#L4529) |  |
| [4530](#L4530) | $booked\_appointment\_start\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_date'] : $selected\_date; |
| [4531](#L4531) | $booked\_appointment\_end\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] : $booked\_appointment\_start\_date; |
| [4532](#L4532) |  |
| [4533](#L4533) | if( '00:00:00' == $booked\_appointment\_end\_time ){ |
| [4534](#L4534) | $booked\_appointment\_end\_time = apply\_filters( 'bookingpress\_modify\_booked\_end\_time','24:00:00', $booked\_appointment\_data ); |
| [4535](#L4535) | } |
| [4536](#L4536) |  |
| [4537](#L4537) | $booked\_appointment\_start\_datetime = $booked\_appointment\_start\_date.' ' . $booked\_appointment\_start\_time; |
| [4538](#L4538) | $booked\_appointment\_end\_datetime = $booked\_appointment\_end\_date.' ' . $booked\_appointment\_end\_time; |
| [4539](#L4539) |  |
| [4540](#L4540) | $tmp\_selected\_date = apply\_filters( 'bookingpress\_consider\_next\_day\_date', $selected\_date, $booked\_appointment\_data, $booked\_appointment\_start\_date ); |
| [4541](#L4541) |  |
| [4542](#L4542) | if( $booked\_appointment\_start\_date != $tmp\_selected\_date ){ |
| [4543](#L4543) | continue; |
| [4544](#L4544) | } |
| [4545](#L4545) |  |
| [4546](#L4546) | foreach( $service\_timings as $sk => $time\_slot\_data ){ |
| [4547](#L4547) | $current\_time\_start = $time\_slot\_data['store\_start\_time'].':00'; |
| [4548](#L4548) | $current\_time\_end = $time\_slot\_data['store\_end\_time'].':00'; |
| [4549](#L4549) |  |
| [4550](#L4550) | $current\_time\_start\_datetime = $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_start; |
| [4551](#L4551) | $current\_time\_end\_datetime = ( !empty( $time\_slot\_data['selected\_end\_date'] ) && '0000-00-00' != $time\_slot\_data['selected\_end\_date'] ) ? ( $time\_slot\_data['selected\_end\_date'] . ' '. $current\_time\_end ) : ( $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_end ); |
| [4552](#L4552) |  |
| [4553](#L4553) |  |
| [4554](#L4554) | if( ( $booked\_appointment\_start\_datetime >= $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime <= $current\_time\_end\_datetime ) || ( $booked\_appointment\_start\_datetime < $current\_time\_end\_datetime && $booked\_appointment\_end\_datetime > $current\_time\_start\_datetime ) ){ |
| [4555](#L4555) |  |
| [4556](#L4556) | $bookingpress\_single\_time\_slot\_data = $time\_slot\_data; |
| [4557](#L4557) |  |
| [4558](#L4558) | $service\_timings[ $sk ]['total\_booked']++; |
| [4559](#L4559) | $capacity\_count = 1; |
| [4560](#L4560) | /\*\* increase capacity count if booked appointment has the extra members \*/ |
| [4561](#L4561) |  |
| [4562](#L4562) | $extra\_members = !empty($booked\_appointment\_data['bookingpress\_selected\_extra\_members'] ) ? intval($booked\_appointment\_data['bookingpress\_selected\_extra\_members']) : 0; |
| [4563](#L4563) |  |
| [4564](#L4564) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [4565](#L4565) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [4566](#L4566) | $extra\_members = $extra\_members - 1; |
| [4567](#L4567) | } |
| [4568](#L4568) | } |
| [4569](#L4569) |  |
| [4570](#L4570) | if( isset($booked\_appointment\_data['bookingpress\_selected\_extra\_members']) && $booked\_appointment\_data['bookingpress\_selected\_extra\_members'] > 0 ){ |
| [4571](#L4571) | $capacity\_count += $extra\_members; |
| [4572](#L4572) | $total\_guests = $extra\_members; |
| [4573](#L4573) | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
| [4574](#L4574) | } else { |
| [4575](#L4575) | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
| [4576](#L4576) | } |
| [4577](#L4577) |  |
| [4578](#L4578) | /\* Share capacity betweenslot issue fixed start \*/ |
| [4579](#L4579) | $bookingpress\_reduce\_capacity = true; |
| [4580](#L4580) | if( 'true' == $shared\_quantity ){ |
| [4581](#L4581) |  |
| [4582](#L4582) | $max\_capacity = (isset($time\_slot\_data['max\_capacity']))?$time\_slot\_data['max\_capacity']:1; |
| [4583](#L4583) |  |
| [4584](#L4584) | if(isset($service\_temp\_timings[$sk]['booked\_timeslot'])){ |
| [4585](#L4585) |  |
| [4586](#L4586) | $total\_block\_capacity = 0; |
| [4587](#L4587) | foreach( $total\_booked\_appiontments as $booked\_appointment\_data\_for\_total ){ |
| [4588](#L4588) | $total\_guests = 0; |
| [4589](#L4589) | $booked\_appointment\_start\_time\_new = $booked\_appointment\_data\_for\_total['bookingpress\_appointment\_time']; |
| [4590](#L4590) | $booked\_appointment\_end\_time\_new = $booked\_appointment\_data\_for\_total['bookingpress\_appointment\_end\_time']; |
| [4591](#L4591) | if( ( $booked\_appointment\_start\_time\_new >= $current\_time\_start && $booked\_appointment\_end\_time\_new <= $current\_time\_end ) || ( $booked\_appointment\_start\_time\_new < $current\_time\_end && $booked\_appointment\_end\_time\_new > $current\_time\_start) ){ |
| [4592](#L4592) | if( isset($booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members']) && $booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members'] > 0 ){ |
| [4593](#L4593) | $block\_capacity\_count = $booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members']; |
| [4594](#L4594) | } else { |
| [4595](#L4595) | $block\_capacity\_count = 1; |
| [4596](#L4596) | } |
| [4597](#L4597) | $total\_block\_capacity = $total\_block\_capacity + $block\_capacity\_count; |
| [4598](#L4598) | } |
| [4599](#L4599) | } |
| [4600](#L4600) |  |
| [4601](#L4601) | $booked\_timeslot\_data = $service\_temp\_timings[$sk]['booked\_timeslot']; |
| [4602](#L4602) | if(!empty($booked\_timeslot\_data) && $max\_capacity > $total\_block\_capacity){ |
| [4603](#L4603) | foreach($booked\_timeslot\_data as $booked\_slot){ |
| [4604](#L4604) | $start\_time = $booked\_slot['start\_time']; |
| [4605](#L4605) | $end\_time = $booked\_slot['end\_time']; |
| [4606](#L4606) | $block\_cap\_count = $booked\_slot['capacity\_count']; |
| [4607](#L4607) | if($booked\_appointment\_start\_time > $start\_time && $booked\_appointment\_start\_time >= $end\_time){ |
| [4608](#L4608) | if($capacity\_count > $block\_cap\_count){ |
| [4609](#L4609) | $final\_capacity\_count = $capacity\_count - $block\_cap\_count; |
| [4610](#L4610) | $capacity\_count = $capacity\_count+$final\_capacity\_count; |
| [4611](#L4611) | }else{ |
| [4612](#L4612) | $bookingpress\_reduce\_capacity = false; |
| [4613](#L4613) | } |
| [4614](#L4614) | } |
| [4615](#L4615) | } |
| [4616](#L4616) | } |
| [4617](#L4617) | } |
| [4618](#L4618) | $service\_temp\_timings[$sk]['booked\_timeslot'][] = array('start\_time'=>$booked\_appointment\_start\_time,'end\_time'=>$booked\_appointment\_end\_time,'capacity\_count'=>$capacity\_count); |
| [4619](#L4619) | if(!$bookingpress\_reduce\_capacity){ |
| [4620](#L4620) | $service\_timings[ $sk ] = $bookingpress\_single\_time\_slot\_data; |
| [4621](#L4621) | continue; |
| [4622](#L4622) | } |
| [4623](#L4623) |  |
| [4624](#L4624) | } |
| [4625](#L4625) | /\* Share capacity betweenslot issue fixed start \*/ |
| [4626](#L4626) |  |
| [4627](#L4627) | if( 'true' == $shared\_quantity ){ |
| [4628](#L4628) | $service\_timings[ $sk ]['max\_capacity'] -= $capacity\_count; |
| [4629](#L4629) | if( $service\_timings[ $sk ]['max\_capacity'] < 0 ){ |
| [4630](#L4630) | $service\_timings[ $sk ]['max\_capacity'] = 0; |
| [4631](#L4631) | } |
| [4632](#L4632) | $service\_timings[ $sk ]['is\_reduced\_capacity'] = true; |
| [4633](#L4633) | } else { |
| [4634](#L4634) | if( $booked\_appointment\_start\_datetime == $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime == $current\_time\_end\_datetime ){ |
| [4635](#L4635) |  |
| [4636](#L4636) | $service\_timings[ $sk ]['max\_capacity'] -= $capacity\_count; // reduce capacity for exact time slot |
| [4637](#L4637) | if( $service\_timings[ $sk ]['max\_capacity'] < 0 ){ |
| [4638](#L4638) | $service\_timings[ $sk ]['max\_capacity'] = 0; |
| [4639](#L4639) | } |
| [4640](#L4640) |  |
| [4641](#L4641) | if( 0 == $service\_timings[ $sk ]['max\_capacity'] ){ |
| [4642](#L4642) | $service\_timings[ $sk ]['is\_booked'] = 1; |
| [4643](#L4643) | } |
| [4644](#L4644) | /\*\* reputelog - need to check once \*/ |
| [4645](#L4645) | if( isset( $booked\_appointment\_data['bookingpress\_appointment\_booking\_id'] )){ |
| [4646](#L4646) |  |
| [4647](#L4647) | $booked\_timing\_keys[ $booked\_appointment\_data['bookingpress\_appointment\_booking\_id'] ] = $sk; |
| [4648](#L4648) | } |
| [4649](#L4649) | } else { |
| [4650](#L4650) | /\*\* Removed time slot for booking if the booked appointment's time slots are crossed between time slots and capacity is not sharing \*/ |
| [4651](#L4651) | if( true == $bpa\_remove\_crossed\_time ){ |
| [4652](#L4652) | unset( $service\_timings[ $sk ] ); |
| [4653](#L4653) | } |
| [4654](#L4654) | } |
| [4655](#L4655) | } |
| [4656](#L4656) |  |
| [4657](#L4657) | /\*\* Filter to Check BAWY \*/ |
| [4658](#L4658) | $service\_timings = apply\_filters( 'bookingpress\_modify\_timeslot\_data\_for\_bawy', $service\_timings, $sk ); |
| [4659](#L4659) |  |
| [4660](#L4660) | /\*\* shared timeslot \*/ |
| [4661](#L4661) |  |
| [4662](#L4662) | if( 'true' == $bookingpress\_shared\_service\_timeslot && !empty( $service\_timings[$sk] )  ){ |
| [4663](#L4663) | if( empty( $service\_timings[ $sk ]['reason\_for\_not\_available'] ) ){ |
| [4664](#L4664) | $service\_timings[ $sk ]['reason\_for\_not\_available'] = array( 'Due to shared time slot from ' . $booked\_appointment\_start\_time . ' to  ' . $booked\_appointment\_end\_time ); |
| [4665](#L4665) | } else { |
| [4666](#L4666) | $service\_timings[ $sk ]['reason\_for\_not\_available'][] = 'Due to shared time slot from ' . $booked\_appointment\_start\_time . ' to  ' . $booked\_appointment\_end\_time; |
| [4667](#L4667) | } |
| [4668](#L4668) | if( 0 == $service\_timings[ $sk ]['max\_capacity'] ){ |
| [4669](#L4669) | $service\_timings[ $sk ]['is\_booked'] = 1; |
| [4670](#L4670) | } else { |
| [4671](#L4671) | $is\_booked\_flag = isset( $service\_timings[ $sk ]['is\_booked'] ) ? $service\_timings[ $sk ]['is\_booked'] : false; |
| [4672](#L4672) | if( $selected\_service\_id != $booked\_appointment\_data['bookingpress\_service\_id'] ){ |
| [4673](#L4673) | $is\_booked\_flag = true; |
| [4674](#L4674) | } |
| [4675](#L4675) | $service\_timings[ $sk ]['is\_booked'] = apply\_filters( 'bookingpress\_is\_slot\_booked\_with\_share\_timeslot', $is\_booked\_flag, $selected\_service\_id, $booked\_appointment\_data ); |
| [4676](#L4676) | } |
| [4677](#L4677) | } |
| [4678](#L4678) | $service\_timings[ $sk ]['is\_booked\_appointment'] = true; |
| [4679](#L4679) | } |
| [4680](#L4680) |  |
| [4681](#L4681) | $service\_timings[ $sk ]['max\_total\_capacity'] = $max\_service\_capacity; |
| [4682](#L4682) |  |
| [4683](#L4683) | if(!isset( $service\_timings[ $sk ]['store\_start\_time'] ) || !isset($service\_timings[ $sk ]['store\_end\_time'])) { |
| [4684](#L4684) | unset( $service\_timings[ $sk ] ); |
| [4685](#L4685) | } |
| [4686](#L4686) |  |
| [4687](#L4687) | } |
| [4688](#L4688) | } |
| [4689](#L4689) | } |
| [4690](#L4690) |  |
| [4691](#L4691) | /\*\* Remove Booked Time Slots from the final service timings - end \*/ |
| [4692](#L4692) |  |
| [4693](#L4693) | $service\_timings = apply\_filters( 'bookingpress\_check\_available\_timings\_with\_staffmember', $service\_timings, $selected\_service\_id, $selected\_date, $total\_booked\_appiontments ); |
| [4694](#L4694) |  |
| [4695](#L4695) | $service\_timings = apply\_filters( 'bookingpress\_buffer\_calculations', $service\_timings, $total\_booked\_appiontments, $selected\_service\_id, $shared\_quantity, $booked\_timing\_keys ); |
| [4696](#L4696) |  |
| [4697](#L4697) | $service\_timings = array\_values( $service\_timings ); |
| [4698](#L4698) |  |
| [4699](#L4699) | if( true == $check\_for\_whole\_days ){ |
| [4700](#L4700) | $is\_available = false; |
| [4701](#L4701) | foreach( $service\_timings as $sk => $time\_slot\_data ){ |
| [4702](#L4702) | if( !empty( $time\_slot\_data['guest\_members'] ) ){ |
| [4703](#L4703) | $time\_slot\_data['total\_booked'] += $time\_slot\_data['guest\_members']; |
| [4704](#L4704) | } |
| [4705](#L4705) | $current\_time\_start  = $time\_slot\_data['start\_time']; |
| [4706](#L4706) | $current\_time\_end  = $time\_slot\_data['end\_time']; |
| [4707](#L4707) | $service\_max\_capacity = $time\_slot\_data['max\_capacity']; |
| [4708](#L4708) | $total\_booked = $time\_slot\_data['total\_booked']; |
| [4709](#L4709) | $is\_booked = isset( $time\_slot\_data['is\_booked'] ) ? $time\_slot\_data['is\_booked'] : false; |
| [4710](#L4710) |  |
| [4711](#L4711) | $total\_members = apply\_filters( 'bookingpress\_fetch\_bring\_members', 1 ); |
| [4712](#L4712) |  |
| [4713](#L4713) |  |
| [4714](#L4714) |  |
| [4715](#L4715) | if ( !empty( $time\_slot\_data['disable\_timeslot'] ) && 1 == $time\_slot\_data['disable\_timeslot'] ) { |
| [4716](#L4716) | continue; |
| [4717](#L4717) | } else { |
| [4718](#L4718) | if(isset($time\_slot\_data['max\_total\_capacity'])){ |
| [4719](#L4719) | $total\_max\_capacity = $time\_slot\_data['max\_total\_capacity']; |
| [4720](#L4720) | if( !$is\_booked && ( $total\_booked < $total\_max\_capacity || $total\_members < $service\_max\_capacity ) ){ |
| [4721](#L4721) | $is\_available = true; |
| [4722](#L4722) | break; |
| [4723](#L4723) | } |
| [4724](#L4724) | } else{ |
| [4725](#L4725) | if( !$is\_booked && ( $total\_booked < $service\_max\_capacity || $total\_members < $service\_max\_capacity ) ){ |
| [4726](#L4726) | $is\_available = true; |
| [4727](#L4727) | break; |
| [4728](#L4728) | } |
| [4729](#L4729) | } |
| [4730](#L4730) | } |
| [4731](#L4731) |  |
| [4732](#L4732) | } |
| [4733](#L4733) | return $is\_available; |
| [4734](#L4734) | } |
| [4735](#L4735) |  |
| [4736](#L4736) | $bookingpress\_global\_details = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [4737](#L4737) | $bpa\_wp\_default\_time\_format  = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [4738](#L4738) | $bpa\_wp\_default\_time\_format = apply\_filters('bookingpress\_change\_time\_slot\_format',$bpa\_wp\_default\_time\_format); |
| [4739](#L4739) |  |
| [4740](#L4740) | $service\_timings = apply\_filters('bookingpress\_modify\_service\_timings\_data\_filter', $service\_timings, $selected\_service\_id, $selected\_date, $\_POST, $max\_service\_capacity); |
| [4741](#L4741) |  |
| [4742](#L4742) | if(is\_plugin\_active('bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php')){ |
| [4743](#L4743) | $bookingpress\_pro\_version = get\_option( 'bookingpress\_pro\_version'); |
| [4744](#L4744) | if( version\_compare( $bookingpress\_pro\_version, '2.6', '<' ) ){ |
| [4745](#L4745) |  |
| [4746](#L4746) | if(session\_id() == '' OR session\_status() === PHP\_SESSION\_NONE) { |
| [4747](#L4747) | session\_start(); |
| [4748](#L4748) | } |
| [4749](#L4749) | $\_SESSION['front\_timings'] = array(); |
| [4750](#L4750) | $\_SESSION['front\_timings'] = $service\_timings; |
| [4751](#L4751) |  |
| [4752](#L4752) | } |
| [4753](#L4753) | } |
| [4754](#L4754) | if(is\_plugin\_active('bookingpress-cart/bookingpress-cart.php')){ |
| [4755](#L4755) | $bookingpress\_cart\_version = get\_option( 'bookingpress\_cart\_module' ); |
| [4756](#L4756) | if( version\_compare( $bookingpress\_cart\_version, '2.2', '<' ) ){ |
| [4757](#L4757) |  |
| [4758](#L4758) | if(session\_id() == '' OR session\_status() === PHP\_SESSION\_NONE) { |
| [4759](#L4759) | session\_start(); |
| [4760](#L4760) | } |
| [4761](#L4761) | $\_SESSION['front\_timings'] = array(); |
| [4762](#L4762) | $\_SESSION['front\_timings'] = $service\_timings; |
| [4763](#L4763) |  |
| [4764](#L4764) | } |
| [4765](#L4765) | } |
| [4766](#L4766) |  |
| [4767](#L4767) | $bpa\_front\_timings\_key = 'bpa\_front\_timings\_' .$bookingpress\_form\_token.'\_'.$selected\_date; |
| [4768](#L4768) | $bpa\_front\_timings\_key\_old = 'bpa\_front\_timings\_' .$bookingpress\_form\_token; |
| [4769](#L4769) |  |
| [4770](#L4770) | $update\_transient = apply\_filters( 'bookingpress\_modify\_update\_transient\_flag', false ); |
| [4771](#L4771) |  |
| [4772](#L4772) | if( true == $update\_transient ){ |
| [4773](#L4773) | $this->bookingpress\_update\_transient( $bpa\_front\_timings\_key, $service\_timings, HOUR\_IN\_SECONDS ); |
| [4774](#L4774) | } |
| [4775](#L4775) | $time\_token\_data = ''; |
| [4776](#L4776) | if( !empty( $service\_timings ) ){ |
| [4777](#L4777) | $time\_token\_data = base64\_encode( wp\_json\_encode( |
| [4778](#L4778) | [ |
| [4779](#L4779) | 'token\_key' => $bpa\_front\_timings\_key, |
| [4780](#L4780) | 'token\_data' => $service\_timings |
| [4781](#L4781) | ] |
| [4782](#L4782) | ) ); |
| [4783](#L4783) | } |
| [4784](#L4784) |  |
| [4785](#L4785) | /\*\* For premium older version compatability \*/ |
| [4786](#L4786) | if( true == $update\_transient ){ |
| [4787](#L4787) | $bpa\_front\_timings\_expiration = ( 60 \* MINUTE\_IN\_SECONDS ); |
| [4788](#L4788) | set\_transient( $bpa\_front\_timings\_key, $service\_timings, $bpa\_front\_timings\_expiration ); |
| [4789](#L4789) | set\_transient( $bpa\_front\_timings\_key\_old, $service\_timings, $bpa\_front\_timings\_expiration ); |
| [4790](#L4790) | } |
| [4791](#L4791) | /\*\* For premium older version compatability \*/ |
| [4792](#L4792) |  |
| [4793](#L4793) | $morning\_time   = array(); |
| [4794](#L4794) | $afternoon\_time = array(); |
| [4795](#L4795) | $evening\_time   = array(); |
| [4796](#L4796) | $night\_time     = array(); |
| [4797](#L4797) |  |
| [4798](#L4798) | if (! empty($service\_timings) ) { |
| [4799](#L4799) | $an = 1; |
| [4800](#L4800) | $total\_members = apply\_filters( 'bookingpress\_fetch\_bring\_members', 1 ); |
| [4801](#L4801) | foreach ( $service\_timings as $service\_time\_key => $service\_time\_val ) { |
| [4802](#L4802) | if(!empty($service\_time\_val['start\_time']) && $service\_time\_val['end\_time']) { |
| [4803](#L4803) | $service\_start\_time = date('H', strtotime($service\_time\_val['start\_time'])); |
| [4804](#L4804) | $service\_end\_time   = date('H', strtotime($service\_time\_val['end\_time'])); |
| [4805](#L4805) |  |
| [4806](#L4806) | $service\_formatted\_start\_time = date\_i18n($bpa\_wp\_default\_time\_format, strtotime($service\_time\_val['start\_time'])); |
| [4807](#L4807) | $service\_formatted\_end\_time   = date\_i18n($bpa\_wp\_default\_time\_format, strtotime($service\_time\_val['end\_time'])); |
| [4808](#L4808) |  |
| [4809](#L4809) | if( $service\_formatted\_end\_time == '00:00') { |
| [4810](#L4810) | $service\_formatted\_end\_time = '24:00'; |
| [4811](#L4811) | } |
| [4812](#L4812) | $service\_time\_arr = $service\_time\_val; |
| [4813](#L4813) | if( !empty( $service\_time\_arr['guest\_members'] ) ){ |
| [4814](#L4814) | $service\_time\_arr['total\_booked'] += $service\_time\_arr['guest\_members']; |
| [4815](#L4815) | } |
| [4816](#L4816) | $service\_time\_arr['disable\_flag\_timeslot'] = false; |
| [4817](#L4817) | if( $service\_time\_arr['total\_booked'] >= $max\_service\_capacity || $total\_members > $max\_service\_capacity ){ |
| [4818](#L4818) | /\*\* Remove timeslot when Hide already booked time slot option is enabled \*/ |
| [4819](#L4819) | if( !empty( $bookingpress\_hide\_already\_booked\_slot ) && 1 == $bookingpress\_hide\_already\_booked\_slot ){ |
| [4820](#L4820) | unset( $service\_timings[ $service\_time\_key ] ); |
| [4821](#L4821) | continue; |
| [4822](#L4822) | } else { |
| [4823](#L4823) | $service\_time\_arr['disable\_flag\_timeslot'] = true; |
| [4824](#L4824) | } |
| [4825](#L4825) | } |
| [4826](#L4826) | if( !isset( $service\_time\_arr['max\_total\_capacity'] ) ){ |
| [4827](#L4827) | $service\_time\_arr['max\_total\_capacity'] = $max\_service\_capacity; |
| [4828](#L4828) | } |
| [4829](#L4829) |  |
| [4830](#L4830) | $service\_time\_arr = apply\_filters('bookingpress\_modify\_single\_time\_slot\_data',$service\_time\_arr, $selected\_service\_id, $selected\_date); |
| [4831](#L4831) |  |
| [4832](#L4832) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [4833](#L4833) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [4834](#L4834) | if( !$BookingPress->bpa\_is\_pro\_active() ){ |
| [4835](#L4835) | $bookigpress\_time\_format\_for\_booking\_form = ''; |
| [4836](#L4836) | } |
| [4837](#L4837) |  |
| [4838](#L4838) | if($bookigpress\_time\_format\_for\_booking\_form == '1' || $bookigpress\_time\_format\_for\_booking\_form == '2') { |
| [4839](#L4839) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s to %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4840](#L4840) | } |
| [4841](#L4841) | if($bookigpress\_time\_format\_for\_booking\_form == '5' || $bookigpress\_time\_format\_for\_booking\_form == '6'){ |
| [4842](#L4842) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s - %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4843](#L4843) | } |
| [4844](#L4844) | if($bookigpress\_time\_format\_for\_booking\_form == '3' || $bookigpress\_time\_format\_for\_booking\_form == '4'){ |
| [4845](#L4845) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time); // phpcs:ignore |
| [4846](#L4846) | } |
| [4847](#L4847) | if($bookigpress\_time\_format\_for\_booking\_form == 'bookingpress-wp-inherit-time-format' || $bookigpress\_time\_format\_for\_booking\_form == ''){ |
| [4848](#L4848) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s - %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4849](#L4849) | } |
| [4850](#L4850) |  |
| [4851](#L4851) |  |
| [4852](#L4852) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [4853](#L4853) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [4854](#L4854) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [4855](#L4855) |  |
| [4856](#L4856) |  |
| [4857](#L4857) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [4858](#L4858) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [4859](#L4859) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [4860](#L4860) |  |
| [4861](#L4861) |  |
| [4862](#L4862) | $service\_time\_arr['css\_animation\_class'] = $css\_animation\_class = 'bpa-front--ts-item-' . $an; |
| [4863](#L4863) | if ($service\_start\_time >= 0 && $service\_start\_time < $bpa\_afternoon\_solts\_timing ) { |
| [4864](#L4864) |  |
| [4865](#L4865) | $morning\_time[] = array\_merge( $service\_time\_arr, array( |
| [4866](#L4866) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4867](#L4867) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4868](#L4868) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4869](#L4869) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4870](#L4870) | ) ); |
| [4871](#L4871) | } elseif ($service\_start\_time >= $bpa\_afternoon\_solts\_timing && ( '' == $bpa\_evening\_solts\_timing || $service\_start\_time < $bpa\_evening\_solts\_timing ) ) { |
| [4872](#L4872) | $afternoon\_time[] = array\_merge( $service\_time\_arr, array( |
| [4873](#L4873) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4874](#L4874) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4875](#L4875) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4876](#L4876) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4877](#L4877) | ) ); |
| [4878](#L4878) | } elseif ($service\_start\_time >= $bpa\_evening\_solts\_timing && ( '' == $bpa\_night\_solts\_timing || $service\_start\_time < $bpa\_night\_solts\_timing ) ) { |
| [4879](#L4879) | $evening\_time[] = array\_merge( $service\_time\_arr, array( |
| [4880](#L4880) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4881](#L4881) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4882](#L4882) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4883](#L4883) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4884](#L4884) | ) ); |
| [4885](#L4885) | } else { |
| [4886](#L4886) | $night\_time[] = array\_merge( $service\_time\_arr, array( |
| [4887](#L4887) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4888](#L4888) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4889](#L4889) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4890](#L4890) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4891](#L4891) | ) ); |
| [4892](#L4892) | } |
| [4893](#L4893) | $an++; |
| [4894](#L4894) | } |
| [4895](#L4895) | } |
| [4896](#L4896) | } |
| [4897](#L4897) |  |
| [4898](#L4898) | $bookingpress\_timeslot\_counts = count($service\_timings); |
| [4899](#L4899) | $bookingpress\_selected\_start\_time = ""; |
| [4900](#L4900) | $bookingpress\_selected\_end\_time = ""; |
| [4901](#L4901) | if($bookingpress\_timeslot\_counts == 1 && (!empty($service\_timings[0]['end\_time']) && $service\_timings[0]['end\_time'] == "24:00") && ($service\_timings[0]['is\_booked'] == 0) ){ |
| [4902](#L4902) | $bookingpress\_selected\_start\_time = $service\_timings[0]['start\_time']; |
| [4903](#L4903) | $bookingpress\_selected\_end\_time = $service\_timings[0]['end\_time']; |
| [4904](#L4904) | } |
| [4905](#L4905) |  |
| [4906](#L4906) | $next\_day\_times = []; |
| [4907](#L4907) | foreach( $morning\_time as $mkey => $mvalue ){ |
| [4908](#L4908) | if( !empty( $mvalue['is\_next\_day'] ) && ( true === $mvalue['is\_next\_day'] || 'true' == $mvalue['is\_next\_day'] ) ){ |
| [4909](#L4909) | $next\_day\_times[] = $mvalue; |
| [4910](#L4910) | unset( $morning\_time[ $mkey ] ); |
| [4911](#L4911) | } |
| [4912](#L4912) | } |
| [4913](#L4913) |  |
| [4914](#L4914) | $morning\_time = array\_values( $morning\_time ); |
| [4915](#L4915) |  |
| [4916](#L4916) | $return\_data = array( |
| [4917](#L4917) | 'morning\_time'   => $morning\_time, |
| [4918](#L4918) | 'afternoon\_time' => $afternoon\_time, |
| [4919](#L4919) | 'evening\_time'   => $evening\_time, |
| [4920](#L4920) | 'night\_time'     => array\_merge( $night\_time, $next\_day\_times ) |
| [4921](#L4921) | ); |
| [4922](#L4922) |  |
| [4923](#L4923) | if( !empty( $service\_timings\_data['is\_custom\_duration'] ) ){ |
| [4924](#L4924) | $return\_data['is\_custom\_duration'] = true; |
| [4925](#L4925) | } |
| [4926](#L4926) |  |
| [4927](#L4927) | $return\_data['timing\_token\_data'] = $time\_token\_data; |
| [4928](#L4928) |  |
| [4929](#L4929) |  |
| [4930](#L4930) | //$return\_data = apply\_filters('bookingpress\_modify\_service\_return\_timings\_filter', $return\_data, $selected\_service\_id, $selected\_date, $\_POST, $max\_service\_capacity); |
| [4931](#L4931) |  |
| [4932](#L4932) | if( true == $return ){ |
| [4933](#L4933) | return $return\_data; |
| [4934](#L4934) | } else { |
| [4935](#L4935) | echo wp\_json\_encode($return\_data); |
| [4936](#L4936) | exit(); |
| [4937](#L4937) | } |
| [4938](#L4938) |  |
| [4939](#L4939) | } |
| [4940](#L4940) |  |
| [4941](#L4941) | /\*\* |
| [4942](#L4942) | \* Get category specific service |
| [4943](#L4943) | \* |
| [4944](#L4944) | \* @return void |
| [4945](#L4945) | \*/ |
| [4946](#L4946) | function bookingpress\_get\_category\_service\_data() |
| [4947](#L4947) | { |
| [4948](#L4948) | global $wpdb, $BookingPress, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $bookingpress\_other\_debug\_log\_id; |
| [4949](#L4949) | do\_action('bookingpress\_other\_debug\_log\_entry', 'appointment\_debug\_logs', 'Get category service posted data', 'bookingpress\_bookingform', $\_REQUEST, $bookingpress\_other\_debug\_log\_id); |
| [4950](#L4950) | $response              = array(); |
| [4951](#L4951) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4952](#L4952) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4953](#L4953) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4954](#L4954) | $response['variant'] = 'error'; |
| [4955](#L4955) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4956](#L4956) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4957](#L4957) | echo wp\_json\_encode($response); |
| [4958](#L4958) | exit(); |
| [4959](#L4959) | } |
| [4960](#L4960) | if ( ! empty( $\_POST['category\_id'] ) || intval($\_POST['category\_id']) == 0 ) { |
| [4961](#L4961) | $selected\_category\_id        = intval($\_POST['category\_id']); |
| [4962](#L4962) | $bookingpress\_posted\_data = !empty($\_POST['posted\_data']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['posted\_data'] ) : array(); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [4963](#L4963) | $bookingpress\_total\_services = 0; |
| [4964](#L4964) | if (! empty($\_POST['total\_service']) ) { |
| [4965](#L4965) | $bookingpress\_total\_services = sanitize\_text\_field($\_POST['total\_service']); |
| [4966](#L4966) | } |
| [4967](#L4967) | if ( ! empty( $\_POST['total\_category'] ) ) { |
| [4968](#L4968) | $bookingpress\_total\_category = sanitize\_text\_field( $\_POST['total\_category'] ); |
| [4969](#L4969) | } |
| [4970](#L4970) | // Fetch services of selected categories |
| [4971](#L4971) | $bookingpress\_search\_query\_where       = ''; |
| [4972](#L4972) | if ( ! empty( $selected\_category\_id ) && $selected\_category\_id != 0 ) { |
| [4973](#L4973) | $bookingpress\_search\_query\_where .= " WHERE (bookingpress\_category\_id = '{$selected\_category\_id}')"; |
| [4974](#L4974) | } |
| [4975](#L4975) | $bookingpress\_search\_query\_placeholder = ''; |
| [4976](#L4976) | if ( ! empty( $bookingpress\_total\_category ) && $bookingpress\_total\_category != 0 ) { |
| [4977](#L4977) | $bookingpress\_search\_query\_where       .= ! empty( $bookingpress\_search\_query\_where ) ? ' AND' : ' WHERE'; |
| [4978](#L4978) | $bookingpress\_search\_query\_placeholder  = ' bookingpress\_category\_id IN ('; |
| [4979](#L4979) | $bookingpress\_total\_category\_arr        = explode( ',', $bookingpress\_total\_category ); |
| [4980](#L4980) | $bookingpress\_search\_query\_placeholder .= rtrim( str\_repeat( '%d,', count( $bookingpress\_total\_category\_arr ) ), ',' ); |
| [4981](#L4981) | $bookingpress\_search\_query\_placeholder .= ')'; |
| [4982](#L4982) | array\_unshift( $bookingpress\_total\_category\_arr, $bookingpress\_search\_query\_placeholder ); |
| [4983](#L4983) | $bookingpress\_search\_query\_where .= call\_user\_func\_array( array( $wpdb, 'prepare' ), $bookingpress\_total\_category\_arr ); |
| [4984](#L4984) | } |
| [4985](#L4985) | $bookingpress\_search\_query\_placeholder = ''; |
| [4986](#L4986) | if (! empty($bookingpress\_total\_services) && $bookingpress\_total\_services != 0 ) { |
| [4987](#L4987) | $bookingpress\_search\_query\_where       .= ! empty( $bookingpress\_search\_query\_where ) ? ' AND' : ' WHERE'; |
| [4988](#L4988) | $bookingpress\_search\_query\_placeholder  = ' bookingpress\_service\_id IN ('; |
| [4989](#L4989) | $bookingpress\_total\_services\_arr        = explode(',', $bookingpress\_total\_services); |
| [4990](#L4990) | $bookingpress\_search\_query\_placeholder .= rtrim(str\_repeat('%d,', count($bookingpress\_total\_services\_arr)), ','); |
| [4991](#L4991) | $bookingpress\_search\_query\_placeholder .= ')'; |
| [4992](#L4992) | array\_unshift($bookingpress\_total\_services\_arr, $bookingpress\_search\_query\_placeholder); |
| [4993](#L4993) | $bookingpress\_search\_query\_where .= call\_user\_func\_array( array( $wpdb, 'prepare' ), $bookingpress\_total\_services\_arr ); |
| [4994](#L4994) | } |
| [4995](#L4995) |  |
| [4996](#L4996) | $service\_data = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_services} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_service\_position ASC" ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally and $bookingpress\_search\_query\_where is properly prepared. False Positive alarm |
| [4997](#L4997) |  |
| [4998](#L4998) | $bookingpress\_display\_service\_description = $BookingPress->bookingpress\_get\_customize\_settings('display\_service\_description', 'booking\_form'); |
| [4999](#L4999) |  |
| [5000](#L5000) | foreach ( $service\_data as $service\_key => $service\_val ) { |
| [5001](#L5001) | $service\_data[ $service\_key ]['bookingpress\_service\_price']     = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($service\_val['bookingpress\_service\_price']); |
| [5002](#L5002) | $service\_data[ $service\_key ]['service\_price\_without\_currency'] = (float) $service\_val['bookingpress\_service\_price']; |
| [5003](#L5003) | $service\_data[ $service\_key ]['bookingpress\_service\_name'] = stripslashes\_deep($service\_val['bookingpress\_service\_name']); |
| [5004](#L5004) | $service\_id                              = $service\_val['bookingpress\_service\_id']; |
| [5005](#L5005) | $service\_meta\_details                    = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_servicesmeta} WHERE bookingpress\_service\_id = %d AND bookingpress\_servicemeta\_name = 'service\_image\_details'", $service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_servicesmeta is table name defined globally. False Positive alarm |
| [5006](#L5006) | $service\_img\_details                     = ! empty($service\_meta\_details['bookingpress\_servicemeta\_value']) ? maybe\_unserialize($service\_meta\_details['bookingpress\_servicemeta\_value']) : array(); |
| [5007](#L5007) | $service\_data[ $service\_key ]['img\_url'] = ! empty($service\_img\_details[0]['url']) ? $service\_img\_details[0]['url'] : BOOKINGPRESS\_URL . '/images/placeholder-img.jpg'; |
| [5008](#L5008) | $service\_data[ $service\_key ]['bookingpress\_service\_description'] = stripslashes\_deep($service\_data[ $service\_key ]['bookingpress\_service\_description']); |
| [5009](#L5009) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [5010](#L5010) | $service\_data[ $service\_key ]['display\_read\_more\_less'] = 1; |
| [5011](#L5011) | $default\_service\_description   = $service\_data[ $service\_key ]['bookingpress\_service\_description']; |
| [5012](#L5012) | if (strlen($default\_service\_description) > 140 ) { |
| [5013](#L5013) | $service\_data[ $service\_key ]['bookingpress\_service\_description\_with\_excerpt'] = substr($default\_service\_description, 0, 140); |
| [5014](#L5014) | $service\_data[ $service\_key ]['display\_details\_more']                          = 0; |
| [5015](#L5015) | $service\_data[ $service\_key ]['display\_details\_less']                          = 1; |
| [5016](#L5016) | } else { |
| [5017](#L5017) | $service\_data[ $service\_key ]['display\_read\_more\_less'] = 0; |
| [5018](#L5018) | } |
| [5019](#L5019) | } |
| [5020](#L5020) | } |
| [5021](#L5021) | $service\_data = apply\_filters('bookingpress\_modify\_service\_data\_on\_category\_selection', $service\_data, $selected\_category\_id, $bookingpress\_posted\_data); |
| [5022](#L5022) |  |
| [5023](#L5023) | do\_action('bookingpress\_other\_debug\_log\_entry', 'appointment\_debug\_logs', 'Get category service - service data', 'bookingpress\_bookingform', $service\_data, $bookingpress\_other\_debug\_log\_id); |
| [5024](#L5024) |  |
| [5025](#L5025) | echo wp\_json\_encode($service\_data); |
| [5026](#L5026) | exit(); |
| [5027](#L5027) | } |
| [5028](#L5028) | } |
| [5029](#L5029) |  |
| [5030](#L5030) | /\*\* |
| [5031](#L5031) | \* Callback function for [bookingpress\_form] shortcode |
| [5032](#L5032) | \* |
| [5033](#L5033) | \* @param  mixed $atts |
| [5034](#L5034) | \* @param  mixed $content |
| [5035](#L5035) | \* @param  mixed $tag |
| [5036](#L5036) | \* @return void |
| [5037](#L5037) | \*/ |
| [5038](#L5038) | function bookingpress\_front\_booking\_form( $atts, $content, $tag ) |
| [5039](#L5039) | { |
| [5040](#L5040) | global $wpdb, $BookingPress, $bookingpress\_common\_date\_format, $tbl\_bookingpress\_form\_fields, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customers, $bookingpress\_global\_options,$bookingpress\_front\_vue\_data\_fields; |
| [5041](#L5041) |  |
| [5042](#L5042) | do\_action('bookingpress\_front\_booking\_form\_load\_before'); |
| [5043](#L5043) |  |
| [5044](#L5044) | $defaults = array( |
| [5045](#L5045) | 'service'  => 0, |
| [5046](#L5046) | 'category' => 0, |
| [5047](#L5047) | 'selected\_service' => 0, |
| [5048](#L5048) | ); |
| [5049](#L5049) | $args     = shortcode\_atts($defaults, $atts, $tag); |
| [5050](#L5050) |  |
| [5051](#L5051) | if( !empty( $atts ) ){ |
| [5052](#L5052) | if( !empty( $atts['service'] ) && !preg\_match( '/^[(\d+)\,]+$/', $atts['service'] ) ){ |
| [5053](#L5053) | $atts['service'] = ''; |
| [5054](#L5054) | } |
| [5055](#L5055) |  |
| [5056](#L5056) | $atts['category'] = !empty( $atts['category'] ) ? intval( $atts['category'] ) : ''; |
| [5057](#L5057) | $atts['selected\_service'] = !empty( $atts['selected\_service'] ) ? intval( $atts['selected\_service'] ) : ''; |
| [5058](#L5058) | } |
| [5059](#L5059) |  |
| [5060](#L5060) |  |
| [5061](#L5061) | extract($args); |
| [5062](#L5062) |  |
| [5063](#L5063) |  |
| [5064](#L5064) | $category = explode( ',', $category ); |
| [5065](#L5065) | $category = array\_map( 'intval', $category ); |
| [5066](#L5066) | $category = implode( ',', $category ); |
| [5067](#L5067) |  |
| [5068](#L5068) | $Bookingpress\_service  = 0; |
| [5069](#L5069) | $Bookingpress\_category = 0; |
| [5070](#L5070) | $selected\_category = 0; |
| [5071](#L5071) | if (! empty($category) && $category != 0 ) { |
| [5072](#L5072) | $Bookingpress\_category            = $category; |
| [5073](#L5073) | $this->bookingpress\_form\_category = $category; |
| [5074](#L5074) | } |
| [5075](#L5075) | $service = apply\_filters('bookingpress\_modify\_booking\_form\_default\_display\_services', $service); |
| [5076](#L5076) |  |
| [5077](#L5077) | if( ! empty( $service ) ) { |
| [5078](#L5078) | $service\_arr = explode( ',', $service ); |
| [5079](#L5079) | $service\_arr = array\_map( 'intval', $service\_arr ); |
| [5080](#L5080) | $service = implode( ', ', $service\_arr ); |
| [5081](#L5081) | $Bookingpress\_service            = $service; |
| [5082](#L5082) | $this->bookingpress\_form\_service = $service; |
| [5083](#L5083) | } |
| [5084](#L5084) |  |
| [5085](#L5085) | /\*\* Set flag to display no service placeholder \*/ |
| [5086](#L5086) | $bookingpress\_display\_no\_service\_placeholder = false; |
| [5087](#L5087) |  |
| [5088](#L5088) | /\*\* Fetch all services \*/ |
| [5089](#L5089) |  |
| [5090](#L5090) | if (( ! empty($service) && $service != 0 ) || ( !empty($selected\_service) && $selected\_service != 0 ) || ( isset($\_GET['bpservice\_id']) && ! empty($\_GET['bpservice\_id']) ) || ( isset($\_GET['s\_id']) && ! empty($\_GET['s\_id']) ) ) { |
| [5091](#L5091) | $total\_service = array(); |
| [5092](#L5092) | $bookingpress\_is\_service\_load\_from\_url = 0; |
| [5093](#L5093) | $bookingpress\_search\_query\_where = 'WHERE 1=1 '; |
| [5094](#L5094) | if (!empty($\_GET['bpservice\_id']) || !empty($\_GET['s\_id']) ) { |
| [5095](#L5095) | if(!empty($\_GET['bpservice\_id']) && !isset($\_GET['s\_id']) ){ |
| [5096](#L5096) | $selected\_service = intval($\_GET['bpservice\_id']); |
| [5097](#L5097) | }else if(!empty($\_GET['s\_id'])){ |
| [5098](#L5098) | $selected\_service = intval($\_GET['s\_id']); |
| [5099](#L5099) | $category = 0; |
| [5100](#L5100) | $service = 0; |
| [5101](#L5101) | $this->bookingpress\_form\_service = 0; |
| [5102](#L5102) | $this->bookingpress\_form\_category = 0; |
| [5103](#L5103) | } |
| [5104](#L5104) | $bookingpress\_is\_service\_load\_from\_url = 1; |
| [5105](#L5105) | } else { |
| [5106](#L5106) | $selected\_service = intval($selected\_service); |
| [5107](#L5107) | $this->bookingpress\_form\_service = $service; |
| [5108](#L5108) | } |
| [5109](#L5109) |  |
| [5110](#L5110) | if(!empty($category)) { |
| [5111](#L5111) | $bookingpress\_search\_query\_where .= " AND bookingpress\_category\_id IN ({$category})"; |
| [5112](#L5112) | } |
| [5113](#L5113) | if(!empty($service)) { |
| [5114](#L5114) | $bookingpress\_search\_query\_where .= " AND bookingpress\_service\_id IN ({$service})"; |
| [5115](#L5115) | } |
| [5116](#L5116) | $is\_service\_exist = ''; |
| [5117](#L5117) | if(!empty($selected\_service)) { |
| [5118](#L5118) |  |
| [5119](#L5119) | $bookingpress\_search\_query\_where .= " AND bookingpress\_service\_id = {$selected\_service}"; |
| [5120](#L5120) | $is\_service\_exist = $wpdb->get\_row( "SELECT bookingpress\_service\_id FROM ".$tbl\_bookingpress\_services." ".$bookingpress\_search\_query\_where); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [5121](#L5121) |  |
| [5122](#L5122) | if(!empty($selected\_service) && !empty($is\_service\_exist)) { |
| [5123](#L5123) | // Get category id |
| [5124](#L5124) | $bookingpress\_service\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $selected\_service ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [5125](#L5125) | if (! empty($bookingpress\_service\_details) ) { |
| [5126](#L5126) | $selected\_category = $bookingpress\_service\_details['bookingpress\_category\_id']; |
| [5127](#L5127) | } |
| [5128](#L5128) | if($bookingpress\_is\_service\_load\_from\_url == 1) { |
| [5129](#L5129) | $this->bookingpress\_is\_service\_load\_from\_url = 1; |
| [5130](#L5130) | } |
| [5131](#L5131) | } else{ |
| [5132](#L5132) | $selected\_service = 0; |
| [5133](#L5133) | } |
| [5134](#L5134) | } |
| [5135](#L5135) | } |
| [5136](#L5136) |  |
| [5137](#L5137) | if( !empty( $atts['selected\_service'] ) ){ |
| [5138](#L5138) | $this->bookingpress\_selected\_service\_param = true; |
| [5139](#L5139) | } |
| [5140](#L5140) |  |
| [5141](#L5141) | $bpa\_all\_services = $BookingPress->bookingpress\_retrieve\_all\_services( $service, $selected\_service, $Bookingpress\_category ); |
| [5142](#L5142) | $this->bookingpress\_all\_service\_data = $bpa\_all\_services; |
| [5143](#L5143) |  |
| [5144](#L5144) | $bookingpress\_is\_display\_empty\_view = apply\_filters( 'bpa\_is\_display\_emtpy\_view', false, $bpa\_all\_services ); |
| [5145](#L5145) |  |
| [5146](#L5146) | if( empty( $bpa\_all\_services ) || true == $bookingpress\_is\_display\_empty\_view ){ |
| [5147](#L5147) | $bookingpress\_display\_no\_service\_placeholder = true; |
| [5148](#L5148) | } |
| [5149](#L5149) |  |
| [5150](#L5150) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_display\_no\_service\_placeholder'] = $bookingpress\_display\_no\_service\_placeholder; |
| [5151](#L5151) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data'] = $bpa\_all\_services; |
| [5152](#L5152) |  |
| [5153](#L5153) | $bookingpress\_front\_vue\_data\_fields['browser\_details'] = ''; |
| [5154](#L5154) | $bookingpress\_front\_vue\_data\_fields['browser\_version'] = ''; |
| [5155](#L5155) |  |
| [5156](#L5156) | $bpa\_all\_categories = $BookingPress->bookingpress\_retrieve\_all\_categories( $bpa\_all\_services ); |
| [5157](#L5157) |  |
| [5158](#L5158) | $bookingpress\_front\_vue\_data\_fields['hide\_category\_selection'] = false; |
| [5159](#L5159) | if( count( $bpa\_all\_categories ) == 1 && 0 < $bpa\_all\_categories[0]['category\_id'] ){ |
| [5160](#L5160) | $bookingpress\_front\_vue\_data\_fields['hide\_category\_selection'] = true; |
| [5161](#L5161) | } |
| [5162](#L5162) |  |
| [5163](#L5163) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_categories'] = $bpa\_all\_categories; |
| [5164](#L5164) |  |
| [5165](#L5165) | $bookingpress\_service\_details = $BookingPress->get\_bookingpress\_service\_data\_group\_with\_category(); |
| [5166](#L5166) |  |
| [5167](#L5167) | // Get labels and tabs names generated from customize |
| [5168](#L5168) | // ----------------------------------------------------- |
| [5169](#L5169) |  |
| [5170](#L5170) | $bookingpress\_customize\_settings = $BookingPress->bookingpress\_get\_customize\_settings( |
| [5171](#L5171) | array( |
| [5172](#L5172) | 'service\_title', |
| [5173](#L5173) | 'datetime\_title', |
| [5174](#L5174) | 'basic\_details\_title', |
| [5175](#L5175) | 'summary\_title', |
| [5176](#L5176) | 'category\_title', |
| [5177](#L5177) | 'service\_heading\_title', |
| [5178](#L5178) | 'timeslot\_text', |
| [5179](#L5179) | 'summary\_content\_text', |
| [5180](#L5180) | 'service\_duration\_label', |
| [5181](#L5181) | 'service\_price\_label', |
| [5182](#L5182) | 'paypal\_text', |
| [5183](#L5183) | 'locally\_text', |
| [5184](#L5184) | 'total\_amount\_text', |
| [5185](#L5185) | 'service\_text', |
| [5186](#L5186) | 'customer\_text', |
| [5187](#L5187) | 'date\_time\_text', |
| [5188](#L5188) | 'appointment\_details', |
| [5189](#L5189) | 'payment\_method\_text', |
| [5190](#L5190) | 'morning\_text', |
| [5191](#L5191) | 'afternoon\_text', |
| [5192](#L5192) | 'evening\_text', |
| [5193](#L5193) | 'night\_text', |
| [5194](#L5194) | 'goback\_button\_text', |
| [5195](#L5195) | 'next\_button\_text', |
| [5196](#L5196) | 'book\_appointment\_btn\_text', |
| [5197](#L5197) | 'book\_appointment\_hours\_text', |
| [5198](#L5198) | 'book\_appointment\_min\_text', |
| [5199](#L5199) | 'booking\_form\_tabs\_position', |
| [5200](#L5200) | 'hide\_category\_service\_selection', |
| [5201](#L5201) | 'title\_font\_family', |
| [5202](#L5202) | 'content\_font\_family', |
| [5203](#L5203) | 'display\_service\_description', |
| [5204](#L5204) | 'all\_category\_title', |
| [5205](#L5205) | 'date\_time\_step\_note', |
| [5206](#L5206) | 'summary\_step\_note', |
| [5207](#L5207) | ), |
| [5208](#L5208) | 'booking\_form' |
| [5209](#L5209) | ); |
| [5210](#L5210) |  |
| [5211](#L5211) | $bookingpress\_first\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['service\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_title', 'booking\_form'); |
| [5212](#L5212) | $bookingpress\_second\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['datetime\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('', 'booking\_form'); |
| [5213](#L5213) | $bookingpress\_third\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['basic\_details\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('basic\_details\_title', 'booking\_form'); |
| [5214](#L5214) | $bookingpress\_fourth\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['summary\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('summary\_title', 'booking\_form'); |
| [5215](#L5215) | $bookingpress\_all\_category\_title = stripslashes\_deep($bookingpress\_customize\_settings['all\_category\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('all\_category\_title', 'booking\_form'); |
| [5216](#L5216) | $bookingpress\_category\_title       = stripslashes\_deep($bookingpress\_customize\_settings['category\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('category\_title', 'booking\_form'); |
| [5217](#L5217) | $bookingpress\_services\_title       = stripslashes\_deep($bookingpress\_customize\_settings['service\_heading\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_heading\_title', 'booking\_form'); |
| [5218](#L5218) | $bookingpress\_timeslot\_title       = stripslashes\_deep($bookingpress\_customize\_settings['timeslot\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('timeslot\_text', 'booking\_form'); |
| [5219](#L5219) | $bookingpress\_summary\_content\_text = stripslashes\_deep($bookingpress\_customize\_settings['summary\_content\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('summary\_content\_text', 'booking\_form'); |
| [5220](#L5220) | $bookingpress\_date\_time\_step\_note = !empty( $bookingpress\_customize\_settings['date\_time\_step\_note'] ) ? stripslashes\_deep($bookingpress\_customize\_settings['date\_time\_step\_note']) : ''; |
| [5221](#L5221) | $bookingpress\_summary\_step\_note = !empty( $bookingpress\_customize\_settings['summary\_step\_note'] ) ? stripslashes\_deep($bookingpress\_customize\_settings['summary\_step\_note']) : ''; |
| [5222](#L5222) |  |
| [5223](#L5223) | $bookingpress\_service\_duration\_text = !empty($bookingpress\_customize\_settings['service\_duration\_label']) ? stripslashes\_deep($bookingpress\_customize\_settings['service\_duration\_label']) : '';//$BookingPress->bookingpress\_get\_customize\_settings('service\_duration\_label', 'booking\_form'); |
| [5224](#L5224) | if (empty($bookingpress\_service\_duration\_text) ) { |
| [5225](#L5225) | $bookingpress\_service\_duration\_text = esc\_html\_\_('Duration', 'bookingpress-appointment-booking') . ':'; |
| [5226](#L5226) | } |
| [5227](#L5227) | $bookingpress\_service\_price\_text = !empty($bookingpress\_customize\_settings['service\_price\_label']) ? stripslashes\_deep($bookingpress\_customize\_settings['service\_price\_label']) : '';//$BookingPress->bookingpress\_get\_customize\_settings('service\_price\_label', 'booking\_form'); |
| [5228](#L5228) | if (empty($bookingpress\_service\_price\_text) ) { |
| [5229](#L5229) | $bookingpress\_service\_price\_text = esc\_html\_\_('Price', 'bookingpress-appointment-booking') . ':'; |
| [5230](#L5230) | } |
| [5231](#L5231) |  |
| [5232](#L5232) | $bookingpress\_paypal\_text = stripslashes\_deep($bookingpress\_customize\_settings['paypal\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('paypal\_text', 'booking\_form'); |
| [5233](#L5233) | if (empty($bookingpress\_paypal\_text) ) { |
| [5234](#L5234) | $bookingpress\_paypal\_text = esc\_html\_\_('PayPal', 'bookingpress-appointment-booking'); |
| [5235](#L5235) | } |
| [5236](#L5236) |  |
| [5237](#L5237) | $bookingpress\_locally\_text = stripslashes\_deep($bookingpress\_customize\_settings['locally\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('locally\_text', 'booking\_form'); |
| [5238](#L5238) | if (empty($bookingpress\_locally\_text) ) { |
| [5239](#L5239) | $bookingpress\_locally\_text = esc\_html\_\_('Pay Locally', 'bookingpress-appointment-booking'); |
| [5240](#L5240) | } |
| [5241](#L5241) |  |
| [5242](#L5242) | $bookingpress\_total\_amount\_text = stripslashes\_deep($bookingpress\_customize\_settings['total\_amount\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('total\_amount\_text', 'booking\_form'); |
| [5243](#L5243) | if (empty($bookingpress\_total\_amount\_text) ) { |
| [5244](#L5244) | $bookingpress\_total\_amount\_text = esc\_html\_\_('Total Amount Payable', 'bookingpress-appointment-booking'); |
| [5245](#L5245) | } |
| [5246](#L5246) |  |
| [5247](#L5247) | $bookingpress\_service\_text = stripslashes\_deep($bookingpress\_customize\_settings['service\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_text', 'booking\_form'); |
| [5248](#L5248) | if (empty($bookingpress\_service\_text) ) { |
| [5249](#L5249) | $bookingpress\_service\_text = esc\_html\_\_('Service', 'bookingpress-appointment-booking'); |
| [5250](#L5250) | } |
| [5251](#L5251) |  |
| [5252](#L5252) | $bookingpress\_customer\_text = stripslashes\_deep($bookingpress\_customize\_settings['customer\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('customer\_text', 'booking\_form'); |
| [5253](#L5253) | if (empty($bookingpress\_customer\_text) ) { |
| [5254](#L5254) | $bookingpress\_customer\_text = esc\_html\_\_('Customer', 'bookingpress-appointment-booking'); |
| [5255](#L5255) | } |
| [5256](#L5256) |  |
| [5257](#L5257) | $bookingpress\_date\_time\_text = stripslashes\_deep($bookingpress\_customize\_settings['date\_time\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('date\_time\_text', 'booking\_form'); |
| [5258](#L5258) | if (empty($bookingpress\_date\_time\_text) ) { |
| [5259](#L5259) | $bookingpress\_date\_time\_text = esc\_html\_\_('Date &amp; Time', 'bookingpress-appointment-booking'); |
| [5260](#L5260) | } |
| [5261](#L5261) |  |
| [5262](#L5262) | $bookingpress\_appointment\_details\_title\_text = stripslashes\_deep($bookingpress\_customize\_settings['appointment\_details']);//$BookingPress->bookingpress\_get\_customize\_settings('date\_time\_text', 'booking\_form'); |
| [5263](#L5263) | if (empty($bookingpress\_appointment\_details\_title\_text) ) { |
| [5264](#L5264) | $bookingpress\_appointment\_details\_title\_text = esc\_html\_\_('Appointment Details', 'bookingpress-appointment-booking'); |
| [5265](#L5265) | } |
| [5266](#L5266) |  |
| [5267](#L5267) | $bookingpress\_payment\_method\_text = stripslashes\_deep($bookingpress\_customize\_settings['payment\_method\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('payment\_method\_text', 'booking\_form'); |
| [5268](#L5268) | if (empty($bookingpress\_payment\_method\_text) ) { |
| [5269](#L5269) | $bookingpress\_payment\_method\_text = esc\_html\_\_('Select Payment Method', 'bookingpress-appointment-booking'); |
| [5270](#L5270) | } |
| [5271](#L5271) |  |
| [5272](#L5272) | $bookingpress\_morning\_text = stripslashes\_deep($bookingpress\_customize\_settings['morning\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('morning\_text', 'booking\_form'); |
| [5273](#L5273) | if (empty($bookingpress\_morning\_text) ) { |
| [5274](#L5274) | $bookingpress\_morning\_text = esc\_html\_\_('Morning', 'bookingpress-appointment-booking'); |
| [5275](#L5275) | } |
| [5276](#L5276) | $bookingpress\_afternoon\_text = stripslashes\_deep($bookingpress\_customize\_settings['afternoon\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('afternoon\_text', 'booking\_form'); |
| [5277](#L5277) | if (empty($bookingpress\_afternoon\_text) ) { |
| [5278](#L5278) | $bookingpress\_afternoon\_text = esc\_html\_\_('Afternoon', 'bookingpress-appointment-booking'); |
| [5279](#L5279) | } |
| [5280](#L5280) | $bookingpress\_evening\_text = stripslashes\_deep($bookingpress\_customize\_settings['evening\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('evening\_text', 'booking\_form'); |
| [5281](#L5281) | if (empty($bookingpress\_evening\_text) ) { |
| [5282](#L5282) | $bookingpress\_evening\_text = esc\_html\_\_('Evening', 'bookingpress-appointment-booking'); |
| [5283](#L5283) | } |
| [5284](#L5284) | $bookingpress\_night\_text = stripslashes\_deep($bookingpress\_customize\_settings['night\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('night\_text', 'booking\_form'); |
| [5285](#L5285) | if (empty($bookingpress\_night\_text) ) { |
| [5286](#L5286) | $bookingpress\_night\_text = esc\_html\_\_('Night', 'bookingpress-appointment-booking'); |
| [5287](#L5287) | } |
| [5288](#L5288) | $bookingpress\_date\_time\_step\_note = !empty($bookingpress\_date\_time\_step\_note) ? stripslashes\_deep($bookingpress\_date\_time\_step\_note) : ''; |
| [5289](#L5289) | $bookingpress\_summary\_step\_note = !empty($bookingpress\_summary\_step\_note) ? stripslashes\_deep($bookingpress\_summary\_step\_note) : ''; |
| [5290](#L5290) |  |
| [5291](#L5291) | $bookingpress\_goback\_btn\_text           = stripslashes\_deep($bookingpress\_customize\_settings['goback\_button\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('goback\_button\_text', 'booking\_form'); |
| [5292](#L5292) | $bookingpress\_next\_btn\_text             = stripslashes\_deep($bookingpress\_customize\_settings['next\_button\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('next\_button\_text', 'booking\_form'); |
| [5293](#L5293) | $bookingpress\_book\_appointment\_btn\_text = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_btn\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_btn\_text', 'booking\_form'); |
| [5294](#L5294) | $bookingpress\_book\_appointment\_hours\_label = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_hours\_text']); |
| [5295](#L5295) | $bookingpress\_book\_appointment\_min\_label = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_min\_text']); |
| [5296](#L5296) | $bookingpress\_tabs\_position             = $bookingpress\_customize\_settings['booking\_form\_tabs\_position'];//$BookingPress->bookingpress\_get\_customize\_settings('booking\_form\_tabs\_position', 'booking\_form'); |
| [5297](#L5297) |  |
| [5298](#L5298) | $bookingpress\_hide\_category\_service       = $bookingpress\_customize\_settings['hide\_category\_service\_selection'];//$BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection', 'booking\_form'); |
| [5299](#L5299) |  |
| [5300](#L5300) |  |
| [5301](#L5301) |  |
| [5302](#L5302) |  |
| [5303](#L5303) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_book\_appointment\_btn\_text'] = $bookingpress\_book\_appointment\_btn\_text; |
| [5304](#L5304) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_total\_amount\_text'] = $bookingpress\_total\_amount\_text; |
| [5305](#L5305) |  |
| [5306](#L5306) | $bpa\_default\_date\_format = $BookingPress->bookingpress\_get\_settings( 'default\_date\_format', 'general\_setting' ); |
| [5307](#L5307) | $bookingpress\_front\_vue\_data\_fields['bpa\_front\_date\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ) : $bookingpress\_default\_date\_format; |
| [5308](#L5308) |  |
| [5309](#L5309) | $bookingpress\_front\_vue\_data\_fields['bpa\_front\_date\_time\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ).' HH:mm' : $bookingpress\_default\_date\_format.' HH:mm'; |
| [5310](#L5310) |  |
| [5311](#L5311) |  |
| [5312](#L5312) | $bookingpress\_hide\_category\_service       = ( $bookingpress\_hide\_category\_service == 'true' ) ? 1 : 0; |
| [5313](#L5313) | $bookingpress\_loaded\_from\_share\_url       = false; |
| [5314](#L5314) | if(!empty($\_GET['s\_id']) && ( isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '0' ) ){ |
| [5315](#L5315) | $bookingpress\_hide\_category\_service = 1; |
| [5316](#L5316) | $bookingpress\_loaded\_from\_share\_url = true; |
| [5317](#L5317) | } else if(!empty($\_GET['s\_id']) && ( isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '1' ) ){ |
| [5318](#L5318) | $bookingpress\_hide\_category\_service = 0; |
| [5319](#L5319) | $bookingpress\_loaded\_from\_share\_url = true; |
| [5320](#L5320) | } |
| [5321](#L5321) |  |
| [5322](#L5322) |  |
| [5323](#L5323) | if( 1 == $bookingpress\_hide\_category\_service && $bookingpress\_loaded\_from\_share\_url ){ |
| [5324](#L5324) | if( $selected\_service == 0 ){ |
| [5325](#L5325) | $bookingpress\_hide\_category\_service = 0; |
| [5326](#L5326) | } |
| [5327](#L5327) | } |
| [5328](#L5328) |  |
| [5329](#L5329) | $this->bookingpress\_hide\_category\_service = $bookingpress\_hide\_category\_service; |
| [5330](#L5330) |  |
| [5331](#L5331) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5332](#L5332) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format']; |
| [5333](#L5333) |  |
| [5334](#L5334) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [5335](#L5335) | if ($bookingpress\_default\_date\_time\_format == 'F j, Y' ) { |
| [5336](#L5336) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [5337](#L5337) | } elseif ($bookingpress\_default\_date\_time\_format == 'Y-m-d' ) { |
| [5338](#L5338) | $bookingpress\_default\_date\_format = 'YYYY-MM-DD'; |
| [5339](#L5339) | } elseif ($bookingpress\_default\_date\_time\_format == 'm/d/Y' ) { |
| [5340](#L5340) | $bookingpress\_default\_date\_format = 'MM/DD/YYYY'; |
| [5341](#L5341) | } elseif($bookingpress\_default\_date\_time\_format == 'd/m/Y') { |
| [5342](#L5342) | $bookingpress\_default\_date\_format = 'DD/MM/YYYY'; |
| [5343](#L5343) | } elseif ($bookingpress\_default\_date\_time\_format == 'd.m.Y') { |
| [5344](#L5344) | $bookingpress\_default\_date\_format = 'DD.MM.YYYY'; |
| [5345](#L5345) | } elseif ($bookingpress\_default\_date\_time\_format == 'd-m-Y') { |
| [5346](#L5346) | $bookingpress\_default\_date\_format = 'DD-MM-YYYY'; |
| [5347](#L5347) | } |
| [5348](#L5348) |  |
| [5349](#L5349) | $this->bookingpress\_default\_date\_format = $bookingpress\_default\_date\_format; |
| [5350](#L5350) |  |
| [5351](#L5351) | // ----------------------------------------------------- |
| [5352](#L5352) |  |
| [5353](#L5353) | // Get form fields details |
| [5354](#L5354) | // ----------------------------------------------------- |
| [5355](#L5355) |  |
| [5356](#L5356) | /\*\* Check if Pro version is exists but not activated \*/ |
| [5357](#L5357) | if( $BookingPress->bpa\_is\_pro\_exists() && !$BookingPress->bpa\_is\_pro\_active() ){ |
| [5358](#L5358) | if( empty( $BookingPress->bpa\_pro\_plugin\_version() ) ){ |
| [5359](#L5359) | $bookingpress\_form\_fields               = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} ORDER BY bookingpress\_field\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5360](#L5360) | } else { |
| [5361](#L5361) | $bookingpress\_form\_fields               = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_field\_is\_default = %d ORDER BY bookingpress\_field\_position ASC", 1), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5362](#L5362) | } |
| [5363](#L5363) | } else { |
| [5364](#L5364) |  |
| [5365](#L5365) |  |
| [5366](#L5366) | $bookingpress\_form\_fields = wp\_cache\_get( 'bpa\_appointment\_booking\_form\_fields\_data\_'); |
| [5367](#L5367) |  |
| [5368](#L5368) |  |
| [5369](#L5369) | if( false == $bookingpress\_form\_fields ) |
| [5370](#L5370) | { |
| [5371](#L5371) | $bookingpress\_form\_fields = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} ORDER BY bookingpress\_field\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5372](#L5372) |  |
| [5373](#L5373) | wp\_cache\_set( 'bpa\_appointment\_booking\_form\_fields\_data\_', $bookingpress\_form\_fields); |
| [5374](#L5374) | } |
| [5375](#L5375) |  |
| [5376](#L5376) | } |
| [5377](#L5377) |  |
| [5378](#L5378) |  |
| [5379](#L5379) | $bookingpress\_form\_fields\_error\_msg\_arr = $bookingpress\_form\_fields\_new = array(); |
| [5380](#L5380) |  |
| [5381](#L5381) | $bookingpress\_form\_fields        = apply\_filters('bookingpress\_modify\_field\_data\_before\_prepare', $bookingpress\_form\_fields); |
| [5382](#L5382) |  |
| [5383](#L5383) |  |
| [5384](#L5384) | foreach ( $bookingpress\_form\_fields as $bookingpress\_form\_field\_key => $bookingpress\_form\_field\_val ) { |
| [5385](#L5385) |  |
| [5386](#L5386) | if($bookingpress\_form\_field\_val['bookingpress\_field\_is\_hide'] == 0) { |
| [5387](#L5387) |  |
| [5388](#L5388) | $bookingpress\_v\_model\_value = ''; |
| [5389](#L5389) | if ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'fullname' ) { |
| [5390](#L5390) | $bookingpress\_v\_model\_value = 'customer\_name'; |
| [5391](#L5391) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'firstname' ) { |
| [5392](#L5392) | $bookingpress\_v\_model\_value = 'customer\_firstname'; |
| [5393](#L5393) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'lastname' ) { |
| [5394](#L5394) | $bookingpress\_v\_model\_value = 'customer\_lastname'; |
| [5395](#L5395) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'email\_address' ) { |
| [5396](#L5396) | $bookingpress\_v\_model\_value = 'customer\_email'; |
| [5397](#L5397) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'phone\_number' ) { |
| [5398](#L5398) | $bookingpress\_v\_model\_value = 'customer\_phone'; |
| [5399](#L5399) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'note' ) { |
| [5400](#L5400) | $bookingpress\_v\_model\_value = 'appointment\_note'; |
| [5401](#L5401) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'username' ){ |
| [5402](#L5402) | $bookingpress\_v\_model\_value = 'customer\_username'; |
| [5403](#L5403) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'terms\_and\_conditions' ) { |
| [5404](#L5404) | $bookingpress\_v\_model\_value = 'appointment\_terms\_conditions'; |
| [5405](#L5405) | } else { |
| [5406](#L5406) | $bookingpress\_v\_model\_value = $bookingpress\_form\_field\_val['bookingpress\_field\_meta\_key']; |
| [5407](#L5407) | } |
| [5408](#L5408) |  |
| [5409](#L5409) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'][$bookingpress\_v\_model\_value] = ''; |
| [5410](#L5410) | if( 'appointment\_terms\_conditions' == $bookingpress\_v\_model\_value ){ |
| [5411](#L5411) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'][$bookingpress\_v\_model\_value] = array(); |
| [5412](#L5412) | } |
| [5413](#L5413) |  |
| [5414](#L5414) | $bookingpress\_field\_type = ''; |
| [5415](#L5415) | if ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'fullname' ) { |
| [5416](#L5416) | $bookingpress\_field\_type = 'Text'; |
| [5417](#L5417) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'firstname' ) { |
| [5418](#L5418) | $bookingpress\_field\_type = 'Text'; |
| [5419](#L5419) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'lastname' ) { |
| [5420](#L5420) | $bookingpress\_field\_type = 'Text'; |
| [5421](#L5421) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'email\_address' ) { |
| [5422](#L5422) | $bookingpress\_field\_type = 'Email'; |
| [5423](#L5423) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'phone\_number' ) { |
| [5424](#L5424) | $bookingpress\_field\_type = 'Dropdown'; |
| [5425](#L5425) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'note' ) { |
| [5426](#L5426) | $bookingpress\_field\_type = 'Textarea'; |
| [5427](#L5427) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'username' ){ |
| [5428](#L5428) | $bookingpress\_field\_type = 'Text'; |
| [5429](#L5429) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'terms\_and\_conditions'){ |
| [5430](#L5430) | $bookingpress\_field\_type = 'terms\_and\_conditions'; |
| [5431](#L5431) | } else { |
| [5432](#L5432) | $bookingpress\_field\_type = $bookingpress\_form\_field\_val['bookingpress\_field\_type']; |
| [5433](#L5433) | } |
| [5434](#L5434) |  |
| [5435](#L5435) | $bookingpress\_field\_setting\_fields\_tmp                   = array(); |
| [5436](#L5436) | $bookingpress\_field\_setting\_fields\_tmp['id']             = intval($bookingpress\_form\_field\_val['bookingpress\_form\_field\_id']); |
| [5437](#L5437) | $bookingpress\_field\_setting\_fields\_tmp['field\_name']     = $bookingpress\_form\_field\_val['bookingpress\_form\_field\_name']; |
| [5438](#L5438) | $bookingpress\_field\_setting\_fields\_tmp['field\_type']     = $bookingpress\_field\_type; |
| [5439](#L5439) | $bookingpress\_field\_setting\_fields\_tmp['is\_edit']        = false; |
| [5440](#L5440) |  |
| [5441](#L5441) | $bookingpress\_field\_setting\_fields\_tmp['is\_required']    = ( $bookingpress\_form\_field\_val['bookingpress\_field\_required'] == 0 ) ? false : true; |
| [5442](#L5442) | $bookingpress\_field\_setting\_fields\_tmp['label']          = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_label']); |
| [5443](#L5443) | $bookingpress\_field\_setting\_fields\_tmp['placeholder']    = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_placeholder']); |
| [5444](#L5444) | $bookingpress\_field\_setting\_fields\_tmp['error\_message']  = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']); |
| [5445](#L5445) | $bookingpress\_field\_setting\_fields\_tmp['is\_hide']        = ( $bookingpress\_form\_field\_val['bookingpress\_field\_is\_hide'] == 0 ) ? false : true; |
| [5446](#L5446) | $bookingpress\_field\_setting\_fields\_tmp['field\_position'] = floatval($bookingpress\_form\_field\_val['bookingpress\_field\_position']); |
| [5447](#L5447) | $bookingpress\_field\_setting\_fields\_tmp['v\_model\_value']  = $bookingpress\_v\_model\_value; |
| [5448](#L5448) |  |
| [5449](#L5449) | $bookingpress\_field\_setting\_fields\_tmp = apply\_filters( 'bookingpress\_arrange\_form\_fields\_outside', $bookingpress\_field\_setting\_fields\_tmp, $bookingpress\_form\_field\_val); |
| [5450](#L5450) |  |
| [5451](#L5451) |  |
| [5452](#L5452) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'] = apply\_filters('bookingpress\_add\_appointment\_step\_form\_data\_filter',$bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'],$bookingpress\_field\_setting\_fields\_tmp); |
| [5453](#L5453) |  |
| [5454](#L5454) | $bookingpress\_front\_vue\_data\_fields['bpa\_current\_selected\_date'] = ''; |
| [5455](#L5455) |  |
| [5456](#L5456) | array\_push( $bookingpress\_form\_fields\_new, $bookingpress\_field\_setting\_fields\_tmp ); |
| [5457](#L5457) |  |
| [5458](#L5458) | if ($bookingpress\_form\_field\_val['bookingpress\_field\_required'] == '1' ) { |
| [5459](#L5459) | if ($bookingpress\_v\_model\_value == 'customer\_email' ) { |
| [5460](#L5460) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ] = array( |
| [5461](#L5461) | array( |
| [5462](#L5462) | 'required' => true, |
| [5463](#L5463) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5464](#L5464) | 'trigger'  => 'blur', |
| [5465](#L5465) | ), |
| [5466](#L5466) | array( |
| [5467](#L5467) | 'type'    => 'email', |
| [5468](#L5468) | 'message' => esc\_html\_\_('Please enter valid email address', 'bookingpress-appointment-booking'), |
| [5469](#L5469) | 'trigger' => 'blur', |
| [5470](#L5470) | ), |
| [5471](#L5471) | ); |
| [5472](#L5472) | } elseif( $bookingpress\_v\_model\_value == 'appointment\_terms\_conditions') { |
| [5473](#L5473) |  |
| [5474](#L5474) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][] = array( |
| [5475](#L5475) | 'required' => true, |
| [5476](#L5476) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5477](#L5477) | 'trigger'  => 'change', |
| [5478](#L5478) | ); |
| [5479](#L5479) | } else { |
| [5480](#L5480) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][] = array( |
| [5481](#L5481) | 'required' => true, |
| [5482](#L5482) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5483](#L5483) | 'trigger'  => 'blur', |
| [5484](#L5484) | ); |
| [5485](#L5485) | } |
| [5486](#L5486) |  |
| [5487](#L5487) | if(isset($bookingpress\_form\_fields\_error\_msg\_arr[$bookingpress\_v\_model\_value][0]['message']) && $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value][0]['message'] == '') { |
| [5488](#L5488) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][0]['message'] = !empty($bookingpress\_form\_field\_val['bookingpress\_field\_label']) ?  stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_label']).' '.esc\_html\_\_('is required','bookingpress-appointment-booking') : ''; |
| [5489](#L5489) | } |
| [5490](#L5490) | } |
| [5491](#L5491) | $bookingpress\_form\_fields\_error\_msg\_arr = apply\_filters( 'bookingpress\_modify\_form\_fields\_rules\_arr', $bookingpress\_form\_fields\_error\_msg\_arr,$bookingpress\_field\_setting\_fields\_tmp ); |
| [5492](#L5492) | } |
| [5493](#L5493) | } |
| [5494](#L5494) |  |
| [5495](#L5495) | $this->bookingpress\_form\_fields\_error\_msg\_arr = apply\_filters( 'bookingpress\_modify\_form\_fields\_msg\_array', $bookingpress\_form\_fields\_error\_msg\_arr ); |
| [5496](#L5496) |  |
| [5497](#L5497) | $this->bookingpress\_form\_fields\_new           = $bookingpress\_form\_fields\_new; |
| [5498](#L5498) |  |
| [5499](#L5499) | $bookingress\_load\_js\_css\_all\_pages = $BookingPress->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [5500](#L5500) |  |
| [5501](#L5501) | // ----------------------------------------------------- |
| [5502](#L5502) |  |
| [5503](#L5503) | if (is\_user\_logged\_in() ) { |
| [5504](#L5504) | $bookingpress\_wp\_user\_id              = get\_current\_user\_id(); |
| [5505](#L5505) | $bookingpress\_check\_user\_exist\_or\_not = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(bookingpress\_customer\_id) as total FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d AND bookingpress\_user\_status = 0 AND bookingpress\_user\_type = 0", $bookingpress\_wp\_user\_id ));  // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [5506](#L5506) | if ($bookingpress\_check\_user\_exist\_or\_not > 0 ) { |
| [5507](#L5507) | $bookingpress\_update\_customer\_data = array( |
| [5508](#L5508) | 'bookingpress\_user\_status' => 1, |
| [5509](#L5509) | 'bookingpress\_user\_type'   => 2, |
| [5510](#L5510) | ); |
| [5511](#L5511) |  |
| [5512](#L5512) | $bookingpress\_where\_condition = array( |
| [5513](#L5513) | 'bookingpress\_wpuser\_id' => $bookingpress\_wp\_user\_id, |
| [5514](#L5514) | ); |
| [5515](#L5515) |  |
| [5516](#L5516) | $wpdb->update($tbl\_bookingpress\_customers, $bookingpress\_update\_customer\_data, $bookingpress\_where\_condition); |
| [5517](#L5517) | } |
| [5518](#L5518) | } |
| [5519](#L5519) |  |
| [5520](#L5520) | $bookingpress\_uniq\_id = uniqid(); |
| [5521](#L5521) |  |
| [5522](#L5522) | $BookingPress->set\_front\_css(1); |
| [5523](#L5523) | $BookingPress->set\_front\_js(1); |
| [5524](#L5524) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [5525](#L5525) |  |
| [5526](#L5526) | $BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [5527](#L5527) |  |
| [5528](#L5528) | //Code for modify front shortcode data from outside |
| [5529](#L5529) | //------------------------------------------------------- |
| [5530](#L5530) | $bookingpress\_class\_vars\_val = array( |
| [5531](#L5531) | 'form\_category' => $this->bookingpress\_form\_category, |
| [5532](#L5532) | 'form\_service' => $this->bookingpress\_form\_service, |
| [5533](#L5533) | 'hide\_category\_service' => $this->bookingpress\_hide\_category\_service, |
| [5534](#L5534) | 'default\_date\_format' => $this->bookingpress\_default\_date\_format, |
| [5535](#L5535) | 'default\_time\_format' => $this->bookingpress\_default\_time\_format, |
| [5536](#L5536) | 'form\_field\_err\_msg\_arr' => $this->bookingpress\_form\_fields\_error\_msg\_arr, |
| [5537](#L5537) | 'form\_fields\_new' => $this->bookingpress\_form\_fields\_new, |
| [5538](#L5538) | 'is\_service\_load\_from\_url' => $this->bookingpress\_is\_service\_load\_from\_url, |
| [5539](#L5539) | ); |
| [5540](#L5540) |  |
| [5541](#L5541) | do\_action('bookingpress\_add\_dynamic\_details\_booking\_shortcode', $bookingpress\_uniq\_id, $bookingpress\_class\_vars\_val, $args); |
| [5542](#L5542) | //------------------------------------------------------- |
| [5543](#L5543) |  |
| [5544](#L5544) | ob\_start(); |
| [5545](#L5545) | $bookingpress\_shortcode\_file\_url = BOOKINGPRESS\_VIEWS\_DIR . '/frontend/appointment\_booking\_form.php'; |
| [5546](#L5546) | $bookingpress\_shortcode\_file\_url = apply\_filters('bookingpress\_change\_booking\_shortcode\_file\_url', $bookingpress\_shortcode\_file\_url); |
| [5547](#L5547) | include $bookingpress\_shortcode\_file\_url; |
| [5548](#L5548) | $content .= ob\_get\_clean(); |
| [5549](#L5549) |  |
| [5550](#L5550) | // Main data loading script |
| [5551](#L5551) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5552](#L5552) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [5553](#L5553) | $bookingpress\_wp\_default\_time\_format = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [5554](#L5554) |  |
| [5555](#L5555) | $bookingpress\_site\_current\_language = get\_locale(); |
| [5556](#L5556) | if ($bookingpress\_site\_current\_language == 'ru\_RU' ) { |
| [5557](#L5557) | $bookingpress\_site\_current\_language = 'ru'; |
| [5558](#L5558) | } elseif ($bookingpress\_site\_current\_language == 'ar' ) { |
| [5559](#L5559) | $bookingpress\_site\_current\_language = 'ar'; // arabic |
| [5560](#L5560) | } elseif ($bookingpress\_site\_current\_language == 'bg\_BG' ) { |
| [5561](#L5561) | $bookingpress\_site\_current\_language = 'bg'; // Bulgeria |
| [5562](#L5562) | } elseif ($bookingpress\_site\_current\_language == 'ca' ) { |
| [5563](#L5563) | $bookingpress\_site\_current\_language = 'ca'; // Canada |
| [5564](#L5564) | } elseif ($bookingpress\_site\_current\_language == 'da\_DK' ) { |
| [5565](#L5565) | $bookingpress\_site\_current\_language = 'da'; // Denmark |
| [5566](#L5566) | } elseif ($bookingpress\_site\_current\_language == 'de\_DE' || $bookingpress\_site\_current\_language == 'de\_CH\_informal' || $bookingpress\_site\_current\_language == 'de\_AT' || $bookingpress\_site\_current\_language == 'de\_CH' || $bookingpress\_site\_current\_language == 'de\_DE\_formal' ) { |
| [5567](#L5567) | $bookingpress\_site\_current\_language = 'de'; // Germany |
| [5568](#L5568) | } elseif ($bookingpress\_site\_current\_language == 'el' ) { |
| [5569](#L5569) | $bookingpress\_site\_current\_language = 'el'; // Greece |
| [5570](#L5570) | } elseif ($bookingpress\_site\_current\_language == 'es\_ES' ) { |
| [5571](#L5571) | $bookingpress\_site\_current\_language = 'es'; // Spain |
| [5572](#L5572) | } elseif ($bookingpress\_site\_current\_language == 'fr\_FR' ) { |
| [5573](#L5573) | $bookingpress\_site\_current\_language = 'fr'; // France |
| [5574](#L5574) | } elseif ($bookingpress\_site\_current\_language == 'hr' ) { |
| [5575](#L5575) | $bookingpress\_site\_current\_language = 'hr'; // Croatia |
| [5576](#L5576) | } elseif ($bookingpress\_site\_current\_language == 'hu\_HU' ) { |
| [5577](#L5577) | $bookingpress\_site\_current\_language = 'hu'; // Hungary |
| [5578](#L5578) | } elseif ($bookingpress\_site\_current\_language == 'id\_ID' ) { |
| [5579](#L5579) | $bookingpress\_site\_current\_language = 'id'; // Indonesia |
| [5580](#L5580) | } elseif ($bookingpress\_site\_current\_language == 'is\_IS' ) { |
| [5581](#L5581) | $bookingpress\_site\_current\_language = 'is'; // Iceland |
| [5582](#L5582) | } elseif ($bookingpress\_site\_current\_language == 'it\_IT' ) { |
| [5583](#L5583) | $bookingpress\_site\_current\_language = 'it'; // Italy |
| [5584](#L5584) | } elseif ($bookingpress\_site\_current\_language == 'ja' ) { |
| [5585](#L5585) | $bookingpress\_site\_current\_language = 'ja'; // Japan |
| [5586](#L5586) | } elseif ($bookingpress\_site\_current\_language == 'ka\_GE' ) { |
| [5587](#L5587) | $bookingpress\_site\_current\_language = 'ka'; // Georgia |
| [5588](#L5588) | } elseif ($bookingpress\_site\_current\_language == 'ko\_KR' ) { |
| [5589](#L5589) | $bookingpress\_site\_current\_language = 'ko'; // Korean |
| [5590](#L5590) | } elseif ($bookingpress\_site\_current\_language == 'lt\_LT' ) { |
| [5591](#L5591) | $bookingpress\_site\_current\_language = 'lt'; // Lithunian |
| [5592](#L5592) | } elseif ($bookingpress\_site\_current\_language == 'mn' ) { |
| [5593](#L5593) | $bookingpress\_site\_current\_language = 'mn'; // Mongolia |
| [5594](#L5594) | } elseif ($bookingpress\_site\_current\_language == 'nl\_NL' ) { |
| [5595](#L5595) | $bookingpress\_site\_current\_language = 'nl'; // Netherlands |
| [5596](#L5596) | } elseif ($bookingpress\_site\_current\_language == 'nn\_NO' ) { |
| [5597](#L5597) | $bookingpress\_site\_current\_language = 'no'; // Norway |
| [5598](#L5598) | } elseif ($bookingpress\_site\_current\_language == 'pl\_PL' ) { |
| [5599](#L5599) | $bookingpress\_site\_current\_language = 'pl'; // Poland |
| [5600](#L5600) | } elseif ($bookingpress\_site\_current\_language == 'pt\_BR' ) { |
| [5601](#L5601) | $bookingpress\_site\_current\_language = 'pt-br'; // Portuguese |
| [5602](#L5602) | } elseif ($bookingpress\_site\_current\_language == 'ro\_RO' ) { |
| [5603](#L5603) | $bookingpress\_site\_current\_language = 'ro'; // Romania |
| [5604](#L5604) | } elseif ($bookingpress\_site\_current\_language == 'sk\_SK' ) { |
| [5605](#L5605) | $bookingpress\_site\_current\_language = 'sk'; // Slovakia |
| [5606](#L5606) | } elseif ($bookingpress\_site\_current\_language == 'sl\_SI' ) { |
| [5607](#L5607) | $bookingpress\_site\_current\_language = 'sl'; // Slovenia |
| [5608](#L5608) | } elseif ($bookingpress\_site\_current\_language == 'sq' ) { |
| [5609](#L5609) | $bookingpress\_site\_current\_language = 'sq'; // Albanian |
| [5610](#L5610) | } elseif ($bookingpress\_site\_current\_language == 'sr\_RS' ) { |
| [5611](#L5611) | $bookingpress\_site\_current\_language = 'sr'; // Suriname |
| [5612](#L5612) | } elseif ($bookingpress\_site\_current\_language == 'sv\_SE' ) { |
| [5613](#L5613) | $bookingpress\_site\_current\_language = 'sv'; // El Salvador |
| [5614](#L5614) | } elseif ($bookingpress\_site\_current\_language == 'tr\_TR' ) { |
| [5615](#L5615) | $bookingpress\_site\_current\_language = 'tr'; // Turkey |
| [5616](#L5616) | } elseif ($bookingpress\_site\_current\_language == 'uk' ) { |
| [5617](#L5617) | $bookingpress\_site\_current\_language = 'uk'; // Ukrain |
| [5618](#L5618) | } elseif ($bookingpress\_site\_current\_language == 'vi' ) { |
| [5619](#L5619) | $bookingpress\_site\_current\_language = 'vi'; // Virgin Islands (U.S.) |
| [5620](#L5620) | } elseif ($bookingpress\_site\_current\_language == 'zh\_CN' ) { |
| [5621](#L5621) | $bookingpress\_site\_current\_language = 'zh-cn'; // Chinese |
| [5622](#L5622) | } elseif ($bookingpress\_site\_current\_language == 'nl\_BE'){ |
| [5623](#L5623) | $bookingpress\_site\_current\_language = 'nl-be'; // Nederlands ( Belgi ) |
| [5624](#L5624) | } elseif ($bookingpress\_site\_current\_language == 'cs\_CZ'){ |
| [5625](#L5625) | $bookingpress\_site\_current\_language = 'cs'; |
| [5626](#L5626) | }elseif ($bookingpress\_site\_current\_language == 'pt\_PT'){ |
| [5627](#L5627) | $bookingpress\_site\_current\_language = 'pt'; |
| [5628](#L5628) | }elseif ($bookingpress\_site\_current\_language == 'et'){ |
| [5629](#L5629) | $bookingpress\_site\_current\_language = 'et'; |
| [5630](#L5630) | }elseif ($bookingpress\_site\_current\_language == 'nb\_NO'){ |
| [5631](#L5631) | $bookingpress\_site\_current\_language = 'no'; |
| [5632](#L5632) | } elseif ($bookingpress\_site\_current\_language == 'lv'){ |
| [5633](#L5633) | $bookingpress\_site\_current\_language = 'lv'; |
| [5634](#L5634) | }elseif ($bookingpress\_site\_current\_language == 'az'){ |
| [5635](#L5635) | $bookingpress\_site\_current\_language = 'az'; |
| [5636](#L5636) | }elseif ($bookingpress\_site\_current\_language == 'fi'){ |
| [5637](#L5637) | $bookingpress\_site\_current\_language = 'fi'; //Finnish |
| [5638](#L5638) | }elseif ($bookingpress\_site\_current\_language == 'gl\_ES'){ |
| [5639](#L5639) | $bookingpress\_site\_current\_language = 'gl'; //Galician |
| [5640](#L5640) | }elseif ($bookingpress\_site\_current\_language == 'he\_IL' ) { |
| [5641](#L5641) | $bookingpress\_site\_current\_language = 'he';//Hebrew |
| [5642](#L5642) | }else { |
| [5643](#L5643) | $bookingpress\_site\_current\_language = 'en'; |
| [5644](#L5644) | } |
| [5645](#L5645) |  |
| [5646](#L5646) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [5647](#L5647) |  |
| [5648](#L5648) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [5649](#L5649) |  |
| [5650](#L5650) | $bookingpress\_script\_return\_data = ''; |
| [5651](#L5651) |  |
| [5652](#L5652) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = ''; |
| [5653](#L5653) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = apply\_filters('bookingpress\_front\_booking\_dynamic\_helper\_vars', $bookingpress\_front\_booking\_dynamic\_helper\_vars); |
| [5654](#L5654) |  |
| [5655](#L5655) | $bookingpress\_vue\_root\_element\_id = '#bookingpress\_booking\_form\_' . $bookingpress\_uniq\_id; |
| [5656](#L5656) | $bookingpress\_vue\_root\_element\_id\_without\_hash = 'bookingpress\_booking\_form\_' . $bookingpress\_uniq\_id; |
| [5657](#L5657) | $bookingpress\_vue\_root\_element\_id\_el = 'method\_' . $bookingpress\_uniq\_id; |
| [5658](#L5658) |  |
| [5659](#L5659) | $bookingpress\_dynamic\_directive\_data = ''; |
| [5660](#L5660) | $bookingpress\_dynamic\_directive\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_directives', $bookingpress\_dynamic\_directive\_data); |
| [5661](#L5661) |  |
| [5662](#L5662) | $bookingpress\_dynamic\_data\_fields = ''; |
| [5663](#L5663) | $bookingpress\_dynamic\_data\_fields = apply\_filters('bookingpress\_front\_booking\_dynamic\_data\_fields', $bookingpress\_dynamic\_data\_fields, $this->bookingpress\_form\_category, $this->bookingpress\_form\_service,$selected\_service,$selected\_category); |
| [5664](#L5664) |  |
| [5665](#L5665) |  |
| [5666](#L5666) |  |
| [5667](#L5667) |  |
| [5668](#L5668) |  |
| [5669](#L5669) | $bookingpress\_dynamic\_on\_load\_methods\_data = ''; |
| [5670](#L5670) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [5671](#L5671) |  |
| [5672](#L5672) | $bookingpress\_vue\_methods\_data = ''; |
| [5673](#L5673) | $bookingpress\_vue\_methods\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_vue\_methods', $bookingpress\_vue\_methods\_data); |
| [5674](#L5674) |  |
| [5675](#L5675) | $bookingpress\_password\_check\_data = ''; |
| [5676](#L5676) | $bookingpress\_password\_check\_data = apply\_filters('bookingpress\_front\_check\_password\_validation', $bookingpress\_password\_check\_data); |
| [5677](#L5677) |  |
| [5678](#L5678) | $bookingpress\_password\_check\_for\_username = ''; |
| [5679](#L5679) | $bookingpress\_password\_check\_for\_username = apply\_filters('bookingpress\_front\_check\_password\_with\_username\_validation', $bookingpress\_password\_check\_for\_username); |
| [5680](#L5680) |  |
| [5681](#L5681) |  |
| [5682](#L5682) | if (! empty($bookingpress\_front\_booking\_dynamic\_helper\_vars) ) { |
| [5683](#L5683) | $bookingpress\_script\_return\_data .= $bookingpress\_front\_booking\_dynamic\_helper\_vars; |
| [5684](#L5684) | } |
| [5685](#L5685) |  |
| [5686](#L5686) | $bookingpress\_script\_return\_data .= "var bookingpress\_uniq\_id\_js\_var = '" . $bookingpress\_uniq\_id . "';"; |
| [5687](#L5687) |  |
| [5688](#L5688) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [5689](#L5689) |  |
| [5690](#L5690) | $bookingpress\_site\_date = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [5691](#L5691) | $bookingpress\_site\_date = apply\_filters( 'bookingpress\_modify\_current\_date', $bookingpress\_site\_date ); |
| [5692](#L5692) | if( !empty( $bookingpress\_site\_date ) ){ |
| [5693](#L5693) | $bookingpress\_site\_current\_date = date( 'Y-m-d', strtotime( $bookingpress\_site\_date ) ) . ' 00:00:00'; |
| [5694](#L5694) | } else { |
| [5695](#L5695) | $bookingpress\_site\_current\_date = ""; |
| [5696](#L5696) | } |
| [5697](#L5697) | $bookingpress\_site\_date = str\_replace('-', '/', $bookingpress\_site\_date); |
| [5698](#L5698) |  |
| [5699](#L5699) | $bpa\_allow\_modify\_from\_url = !empty($\_GET['allow\_modify']) ? 1 : 0; |
| [5700](#L5700) |  |
| [5701](#L5701) | if( ( isset($\_GET['bpservice\_id']) ) || isset($\_GET['s\_id']) ){ |
| [5702](#L5702) | $this->bookingpress\_is\_service\_load\_from\_url = 1; |
| [5703](#L5703) | } |
| [5704](#L5704) |  |
| [5705](#L5705) | if( 1 == $this->bookingpress\_is\_service\_load\_from\_url ){ |
| [5706](#L5706) | if( empty( $selected\_service ) ){ |
| [5707](#L5707) | $this->bookingpress\_is\_service\_load\_from\_url = 0; |
| [5708](#L5708) | } |
| [5709](#L5709) | } |
| [5710](#L5710) |  |
| [5711](#L5711) | $first\_day\_of\_week = (int)  $bookingpress\_global\_options\_arr['start\_of\_week']; |
| [5712](#L5712) | $first\_day\_of\_week\_inc = $first\_day\_of\_week + 1; |
| [5713](#L5713) |  |
| [5714](#L5714) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [5715](#L5715) |  |
| [5716](#L5716) | if($bookingpress\_site\_current\_lang\_moment\_locale == "am" || $bookingpress\_site\_current\_lang\_moment\_locale == "ary" || $bookingpress\_site\_current\_lang\_moment\_locale == "skr") { |
| [5717](#L5717) | $bookingpress\_site\_current\_lang\_moment\_locale = "ar"; |
| [5718](#L5718) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "azb" ) { |
| [5719](#L5719) | $bookingpress\_site\_current\_lang\_moment\_locale = "fa\_AF"; |
| [5720](#L5720) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "dsb" || $bookingpress\_site\_current\_lang\_moment\_locale == "hsb" || $bookingpress\_site\_current\_lang\_moment\_locale == "szl" ) { |
| [5721](#L5721) | $bookingpress\_site\_current\_lang\_moment\_locale = "pl"; |
| [5722](#L5722) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "fur" ) { |
| [5723](#L5723) | $bookingpress\_site\_current\_lang\_moment\_locale = "it"; |
| [5724](#L5724) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "ckb" ) { |
| [5725](#L5725) | $bookingpress\_site\_current\_lang\_moment\_locale = "ku"; |
| [5726](#L5726) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "oci" ) { |
| [5727](#L5727) | $bookingpress\_site\_current\_lang\_moment\_locale = "ca"; |
| [5728](#L5728) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "sah" ) { |
| [5729](#L5729) | $bookingpress\_site\_current\_lang\_moment\_locale = "ky"; |
| [5730](#L5730) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "tl" ) { |
| [5731](#L5731) | $bookingpress\_site\_current\_lang\_moment\_locale = "fil"; |
| [5732](#L5732) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "as" ) { |
| [5733](#L5733) | $bookingpress\_site\_current\_lang\_moment\_locale = "bn"; |
| [5734](#L5734) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "hy" ) { |
| [5735](#L5735) | $bookingpress\_site\_current\_lang\_moment\_locale = "hy-am"; |
| [5736](#L5736) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "et" ) { |
| [5737](#L5737) | $bookingpress\_site\_current\_lang\_moment\_locale = "et"; |
| [5738](#L5738) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "nb\_NO" ) { |
| [5739](#L5739) | $bookingpress\_site\_current\_lang\_moment\_locale = "no"; |
| [5740](#L5740) | } |
| [5741](#L5741) |  |
| [5742](#L5742) | $bookingpress\_global\_details  = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5743](#L5743) | $bookingpress\_wp\_default\_time\_format = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [5744](#L5744) | $bookingpress\_inherit\_from\_wordpress\_arr = json\_decode($bookingpress\_global\_details['bookingpress\_inherit\_from\_wordpress\_arr'],true); |
| [5745](#L5745) |  |
| [5746](#L5746) | if(isset($bookingpress\_inherit\_from\_wordpress\_arr[$bookingpress\_wp\_default\_time\_format])){ |
| [5747](#L5747) | $bookingpress\_formatted\_timeslot = $bookingpress\_inherit\_from\_wordpress\_arr[$bookingpress\_wp\_default\_time\_format]; |
| [5748](#L5748) | } |
| [5749](#L5749) |  |
| [5750](#L5750) | $bookingpress\_script\_return\_data .= 'app = new Vue({ |
| [5751](#L5751) | el: "' . $bookingpress\_vue\_root\_element\_id . '", |
| [5752](#L5752) | components: {}, |
| [5753](#L5753) | directives: { ' . $bookingpress\_dynamic\_directive\_data . ' }, |
| [5754](#L5754) | data(){ |
| [5755](#L5755) |  |
| [5756](#L5756) | var bpa\_check\_username = ( rule, value, callback ) =>{ |
| [5757](#L5757) | const vm = this; |
| [5758](#L5758) |  |
| [5759](#L5759) | if( "undefined" == vm.appointment\_step\_form\_data.check\_username\_validation || false == vm.appointment\_step\_form\_data.check\_username\_validation ){ |
| [5760](#L5760) | if( "undefined" != vm.appointment\_step\_form\_data.invalid\_customer\_username && true == vm.appointment\_step\_form\_data.invalid\_customer\_username ){ |
| [5761](#L5761) | return callback( new Error( vm.appointment\_step\_form\_data.invalid\_customer\_message ) ); |
| [5762](#L5762) | } else { |
| [5763](#L5763) | return callback(); |
| [5764](#L5764) | } |
| [5765](#L5765) | } |
| [5766](#L5766) |  |
| [5767](#L5767) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [5768](#L5768) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5769](#L5769) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [5770](#L5770) | { |
| [5771](#L5771) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [5772](#L5772) | } |
| [5773](#L5773) | else { |
| [5774](#L5774) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [5775](#L5775) | } |
| [5776](#L5776) | let bookingpress\_username\_value = value; |
| [5777](#L5777) |  |
| [5778](#L5778) | var bookingpress\_username = { action:"bookingpress\_validate\_username", \_username: bookingpress\_username\_value, \_wpnonce:bkp\_wpnonce\_pre\_fetch}; |
| [5779](#L5779) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( bookingpress\_username ) ) |
| [5780](#L5780) | .then( function (response) { |
| [5781](#L5781) | vm.appointment\_step\_form\_data.check\_username\_validation = false; |
| [5782](#L5782) | '.$bookingpress\_password\_check\_data.'; |
| [5783](#L5783) | if(response.data.variant == "error"){ |
| [5784](#L5784) | vm.appointment\_step\_form\_data.invalid\_customer\_username = true; |
| [5785](#L5785) | vm.appointment\_step\_form\_data.invalid\_customer\_message = response.data.msg; |
| [5786](#L5786) | return callback(new Error( response.data.msg )); |
| [5787](#L5787) | } else { |
| [5788](#L5788) | if(this.$refs.appointment\_step\_form\_data && "undefined" != typeof vm.appointment\_step\_form\_data.form\_fields.customer\_password){ |
| [5789](#L5789) | this.$refs.appointment\_step\_form\_data.clearValidate("customer\_password"); |
| [5790](#L5790) | } |
| [5791](#L5791) | vm.appointment\_step\_form\_data.invalid\_customer\_username = false; |
| [5792](#L5792) | callback(); |
| [5793](#L5793) | } |
| [5794](#L5794) | }.bind(this) ) |
| [5795](#L5795) | .catch( function (error) { |
| [5796](#L5796) | vm.bookingpress\_set\_error\_msg(error) |
| [5797](#L5797) | }); |
| [5798](#L5798) | }; |
| [5799](#L5799) |  |
| [5800](#L5800) | var bookingpress\_return\_data = ' . $bookingpress\_dynamic\_data\_fields . '; |
| [5801](#L5801) | bookingpress\_return\_data["jsCurrentDate"] = new Date('. ( !empty( $bookingpress\_site\_date ) ? '"'.$bookingpress\_site\_date.'"' : '' ) .'); |
| [5802](#L5802) | bookingpress\_return\_data["jsCurrentDateFormatted"] = new Date ('. ( !empty( $bookingpress\_site\_current\_date ) ? '"'.$bookingpress\_site\_current\_date.'"' : '' ) .'); |
| [5803](#L5803) | bookingpress\_return\_data["jsCurrentOnlyDate"] = bookingpress\_return\_data["jsCurrentDateFormatted"].toISOString().split("T")[0]; |
| [5804](#L5804) | bookingpress\_return\_data["appointment\_step\_form\_data"]["stime"] = ' . ( time() + 14921 ) . '; |
| [5805](#L5805) | bookingpress\_return\_data["appointment\_step\_form\_data"]["spam\_captcha"] = ""; |
| [5806](#L5806) | bookingpress\_return\_data["hide\_category\_service"] = "' . $this->bookingpress\_hide\_category\_service . '"; |
| [5807](#L5807) | bookingpress\_return\_data["default\_date\_format"] = "' . $this->bookingpress\_default\_date\_format . '"; |
| [5808](#L5808) | bookingpress\_return\_data["customer\_details\_rule"] = ' . wp\_json\_encode($this->bookingpress\_form\_fields\_error\_msg\_arr) . '; |
| [5809](#L5809) |  |
| [5810](#L5810) | if( "undefined" != typeof bookingpress\_return\_data["customer\_details\_rule"].customer\_username && bookingpress\_return\_data["check\_bookingpress\_username\_set"] == 0 ){ |
| [5811](#L5811) |  |
| [5812](#L5812) | let rule\_for\_username = { |
| [5813](#L5813) | "validator": bpa\_check\_username, |
| [5814](#L5814) | "trigger": "blur" |
| [5815](#L5815) | }; |
| [5816](#L5816) |  |
| [5817](#L5817) | bookingpress\_return\_data["customer\_details\_rule"].customer\_username.push( rule\_for\_username ); |
| [5818](#L5818) |  |
| [5819](#L5819) | } |
| [5820](#L5820) |  |
| [5821](#L5821) | bookingpress\_return\_data["customer\_form\_fields"] = ' . wp\_json\_encode($this->bookingpress\_form\_fields\_new) . '; |
| [5822](#L5822) | bookingpress\_return\_data["is\_error\_msg"] = ""; |
| [5823](#L5823) | bookingpress\_return\_data["is\_display\_error"] = "0"; |
| [5824](#L5824) | bookingpress\_return\_data["is\_service\_loaded\_from\_url"] = "' . $this->bookingpress\_is\_service\_load\_from\_url . '"; |
| [5825](#L5825) | bookingpress\_return\_data["booking\_cal\_maxdate"] = new Date( Date.now() + ( 3600 \* 1000 \* (24 \* 365) ) ); |
| [5826](#L5826) | bookingpress\_return\_data["is\_booking\_form\_empty\_loader"] = "1"; |
| [5827](#L5827) | bookingpress\_return\_data["bpa\_allow\_modify\_from\_url"] = "'.$bpa\_allow\_modify\_from\_url.'"; |
| [5828](#L5828) |  |
| [5829](#L5829) | bookingpress\_return\_data["site\_locale"] = "' . $bookingpress\_site\_current\_language . '"; |
| [5830](#L5830) | bookingpress\_return\_data["appointment\_step\_form\_data"]["bookingpress\_uniq\_id"] = "' . $bookingpress\_uniq\_id . '"; |
| [5831](#L5831) | var bookingpress\_captcha\_key = "bookingpress\_captcha\_' . $bookingpress\_uniq\_id . '"; |
| [5832](#L5832) | bookingpress\_return\_data["appointment\_step\_form\_data"][bookingpress\_captcha\_key] = ""; |
| [5833](#L5833) |  |
| [5834](#L5834) | bookingpress\_return\_data["first\_day\_of\_week"] = "' . $first\_day\_of\_week\_inc. '"; |
| [5835](#L5835) | bookingpress\_return\_data["filter\_pickerOptions"] = { |
| [5836](#L5836) | "firstDayOfWeek": '.$first\_day\_of\_week.', |
| [5837](#L5837) | }; |
| [5838](#L5838) | bookingpress\_return\_data["appointment\_step\_form\_data"]["base\_price\_without\_currency"] = 0; |
| [5839](#L5839) | bookingpress\_return\_data["use\_base\_price\_for\_calculation"] = true; |
| [5840](#L5840) |  |
| [5841](#L5841) | bookingpress\_return\_data["modelConfig"] = { |
| [5842](#L5842) | "type": "string", |
| [5843](#L5843) | "mask": "YYYY-MM-DD", |
| [5844](#L5844) | }; |
| [5845](#L5845) |  |
| [5846](#L5846) |  |
| [5847](#L5847) | return bookingpress\_return\_data; |
| [5848](#L5848) | }, |
| [5849](#L5849) | filters: { |
| [5850](#L5850) | bookingpress\_format\_date: function(value){ |
| [5851](#L5851) | var default\_date\_format = "' . $this->bookingpress\_default\_date\_format . '"; |
| [5852](#L5852) | return moment(String(value)).locale("'.$bookingpress\_site\_current\_lang\_moment\_locale.'").format(default\_date\_format) |
| [5853](#L5853) | }, |
| [5854](#L5854) | bookingpress\_format\_time: function(value){ |
| [5855](#L5855) | var default\_time\_format = "' . $bookingpress\_formatted\_timeslot . '"; |
| [5856](#L5856) | return moment(String(value), "HH:mm:ss").locale("'.$bookingpress\_site\_current\_lang\_moment\_locale.'").format(default\_time\_format) |
| [5857](#L5857) | } |
| [5858](#L5858) | }, |
| [5859](#L5859) | beforeCreate(){ |
| [5860](#L5860) | this.is\_booking\_form\_empty\_loader = "1"; |
| [5861](#L5861) | }, |
| [5862](#L5862) | created(){ |
| [5863](#L5863) | this.bookingpress\_load\_booking\_form(); |
| [5864](#L5864) | }, |
| [5865](#L5865) | mounted(){ |
| [5866](#L5866) | const vm\_onload = this; |
| [5867](#L5867) |  |
| [5868](#L5868) | if( "undefined" != typeof window.location.href && /post\.php/.test( window.location.href ) ){ |
| [5869](#L5869) | return; |
| [5870](#L5870) | } |
| [5871](#L5871) |  |
| [5872](#L5872) | vm\_onload.bpa\_check\_browser(); |
| [5873](#L5873) | vm\_onload.bpa\_check\_browser\_version(); |
| [5874](#L5874) |  |
| [5875](#L5875) | let selected\_category = vm\_onload.appointment\_step\_form\_data.selected\_category; |
| [5876](#L5876) | vm\_onload.bpa\_select\_category( selected\_category ); |
| [5877](#L5877) |  |
| [5878](#L5878) | this.loadSpamProtection(); |
| [5879](#L5879) |  |
| [5880](#L5880) | ' . $bookingpress\_dynamic\_on\_load\_methods\_data . ' |
| [5881](#L5881) |  |
| [5882](#L5882) | }, |
| [5883](#L5883) | computed:{ |
| [5884](#L5884) | bpasortedServices: function(){ |
| [5885](#L5885) | let bookingpress\_all\_services\_data = []; |
| [5886](#L5886) | for( let i in this.bookingpress\_all\_services\_data ){ |
| [5887](#L5887) | bookingpress\_all\_services\_data.push( this.bookingpress\_all\_services\_data[i] ); |
| [5888](#L5888) | } |
| [5889](#L5889) | return bookingpress\_all\_services\_data.sort( (a, b) =>{ |
| [5890](#L5890) | return ( parseInt( a.bookingpress\_service\_position ) < parseInt( b.bookingpress\_service\_position ) ) ? -1 : 1; |
| [5891](#L5891) | }); |
| [5892](#L5892) | } |
| [5893](#L5893) | }, |
| [5894](#L5894) | methods: { |
| [5895](#L5895) | bpa\_check\_username\_validation(bpa\_username){ |
| [5896](#L5896) | const vm = this; |
| [5897](#L5897) | if( bpa\_username != ""){ |
| [5898](#L5898) | vm.appointment\_step\_form\_data.check\_username\_validation = true; |
| [5899](#L5899) | } else { |
| [5900](#L5900) | vm.appointment\_step\_form\_data.check\_username\_validation = false; |
| [5901](#L5901) | '.$bookingpress\_password\_check\_for\_username.'; |
| [5902](#L5902) | } |
| [5903](#L5903) | }, |
| [5904](#L5904) | bookingpress\_load\_booking\_form(){ |
| [5905](#L5905) | const vm = this; |
| [5906](#L5906) | setTimeout(function(){ |
| [5907](#L5907) | vm.is\_booking\_form\_empty\_loader = "0"; |
| [5908](#L5908) | setTimeout(function(){ |
| [5909](#L5909) | var elms = document.querySelectorAll("#bpa-front-tabs"); |
| [5910](#L5910) | for(var i = 0; i < elms.length; i++)  { |
| [5911](#L5911) | elms[i].style.display = "flex"; |
| [5912](#L5912) | } |
| [5913](#L5913) |  |
| [5914](#L5914) |  |
| [5915](#L5915) | var elms2 = document.querySelectorAll("#bpa-front-data-empty-view"); |
| [5916](#L5916) | for(var i = 0; i < elms2.length; i++)  { |
| [5917](#L5917) | elms2[i].style.display = "flex"; |
| [5918](#L5918) | } |
| [5919](#L5919) |  |
| [5920](#L5920) | }, 500); |
| [5921](#L5921) | }, 2000); |
| [5922](#L5922) | }, |
| [5923](#L5923) | generateSpamCaptcha(){ |
| [5924](#L5924) | const vm = this; |
| [5925](#L5925) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [5926](#L5926) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5927](#L5927) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [5928](#L5928) | { |
| [5929](#L5929) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [5930](#L5930) | } |
| [5931](#L5931) | else { |
| [5932](#L5932) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [5933](#L5933) | } |
| [5934](#L5934) | var postData = { action: "bookingpress\_generate\_spam\_captcha", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [5935](#L5935) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [5936](#L5936) | .then( function (response) { |
| [5937](#L5937) | if(response.variant != "error" && (response.data.captcha\_val != "" && response.data.captcha\_val != undefined)){ |
| [5938](#L5938) | vm.appointment\_step\_form\_data.spam\_captcha = response.data.captcha\_val; |
| [5939](#L5939) | }else{ |
| [5940](#L5940) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5941](#L5941) | if(typeof bkp\_wpnonce\_pre\_fetch!="undefined" && bkp\_wpnonce\_pre\_fetch!=null && response.data.updated\_nonce!="") |
| [5942](#L5942) | { |
| [5943](#L5943) | document.getElementById("\_wpnonce").value = response.data.updated\_nonce; |
| [5944](#L5944) | } else { |
| [5945](#L5945) | vm.$notify({ |
| [5946](#L5946) | title: response.data.title, |
| [5947](#L5947) | message: response.data.msg, |
| [5948](#L5948) | type: response.data.variant, |
| [5949](#L5949) | customClass: "error\_notification" |
| [5950](#L5950) | }); |
| [5951](#L5951) | } |
| [5952](#L5952) | } |
| [5953](#L5953) | }.bind(this) ) |
| [5954](#L5954) | .catch( function (error) { |
| [5955](#L5955) | console.log(error); |
| [5956](#L5956) | }); |
| [5957](#L5957) | }, |
| [5958](#L5958) | loadSpamProtection(){ |
| [5959](#L5959) | const vm = this; |
| [5960](#L5960) | vm.generateSpamCaptcha(); |
| [5961](#L5961) | }, |
| [5962](#L5962) | bookingpress\_price\_with\_currency\_symbol( price\_amount, ignore\_symbol = false ){ |
| [5963](#L5963) | const vm = this; |
| [5964](#L5964) | if( "String" == typeof price\_amount ){ |
| [5965](#L5965) | price\_amount = parseFloat( price\_amount ); |
| [5966](#L5966) | } |
| [5967](#L5967) |  |
| [5968](#L5968) | let currency\_separator = vm.bookingpress\_currency\_separator; |
| [5969](#L5969) | let decimal\_points = vm.bookingpress\_decimal\_points; |
| [5970](#L5970) |  |
| [5971](#L5971) | if( "comma-dot" == currency\_separator ){ |
| [5972](#L5972) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ".", ",", ignore\_symbol ); |
| [5973](#L5973) | } else if( "dot-comma" == currency\_separator ){ |
| [5974](#L5974) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ",", ".", ignore\_symbol ); |
| [5975](#L5975) | } else if( "space-dot" == currency\_separator ){ |
| [5976](#L5976) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ".", " ", ignore\_symbol ); |
| [5977](#L5977) | } else if( "space-comma" == currency\_separator ){ |
| [5978](#L5978) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ",", " ", ignore\_symbol ); |
| [5979](#L5979) | } else if( "Custom" == currency\_separator){ |
| [5980](#L5980) | let custom\_comma\_separator = vm.bookingpress\_custom\_comma\_separator; |
| [5981](#L5981) | let custom\_thousand\_separator = vm.bookingpress\_custom\_thousand\_separator; |
| [5982](#L5982) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, custom\_comma\_separator, custom\_thousand\_separator ); |
| [5983](#L5983) | } |
| [5984](#L5984) |  |
| [5985](#L5985) | if( true == ignore\_symbol ){ |
| [5986](#L5986) | return price\_amount; |
| [5987](#L5987) | } |
| [5988](#L5988) |  |
| [5989](#L5989) | let currency\_symbol = vm.bookingpress\_currency\_symbol; |
| [5990](#L5990) | let currency\_symbol\_pos = vm.bookingpress\_currency\_symbol\_position; |
| [5991](#L5991) |  |
| [5992](#L5992) | if( "before" == currency\_symbol\_pos ){ |
| [5993](#L5993) | price\_amount = currency\_symbol + price\_amount; |
| [5994](#L5994) | } else if( "before\_with\_space" == currency\_symbol\_pos ){ |
| [5995](#L5995) | price\_amount = currency\_symbol + " " + price\_amount; |
| [5996](#L5996) | } else if( "after" == currency\_symbol\_pos ){ |
| [5997](#L5997) | price\_amount = price\_amount + currency\_symbol; |
| [5998](#L5998) | } else if( "after\_with\_space" == currency\_symbol\_pos ){ |
| [5999](#L5999) | price\_amount = price\_amount + " " + currency\_symbol; |
| [6000](#L6000) | } |
| [6001](#L6001) |  |
| [6002](#L6002) | return price\_amount; |
| [6003](#L6003) |  |
| [6004](#L6004) | }, |
| [6005](#L6005) | bookingpress\_number\_format( number, decimals, decPoint, thousandsSep, skip\_separator = false ){ |
| [6006](#L6006) | number = (number + "").replace(/[^0-9+\-Ee.]/g, ""); |
| [6007](#L6007) | const n = !isFinite(+number) ? 0 : +number; |
| [6008](#L6008) | const prec = !isFinite(+decimals) ? 0 : Math.abs(decimals); |
| [6009](#L6009) | const sep = (typeof thousandsSep === "undefined") ? "," : thousandsSep; |
| [6010](#L6010) | const dec = (typeof decPoint === "undefined" || true == skip\_separator ) ? "." : decPoint; |
| [6011](#L6011) | let s = ""; |
| [6012](#L6012) | const toFixedFix = function (n, prec) { |
| [6013](#L6013) | if (("" + n).indexOf("e") === -1) { |
| [6014](#L6014) | return +(Math.round(n + "e+" + prec) + "e-" + prec); |
| [6015](#L6015) | } else { |
| [6016](#L6016) | const arr = ("" + n).split("e"); |
| [6017](#L6017) | let sig = ""; |
| [6018](#L6018) | if (+arr[1] + prec > 0) { |
| [6019](#L6019) | sig = "+"; |
| [6020](#L6020) | } |
| [6021](#L6021) | return (+(Math.round(+arr[0] + "e" + sig + (+arr[1] + prec)) + "e-" + prec)).toFixed(prec); |
| [6022](#L6022) | } |
| [6023](#L6023) | }; |
| [6024](#L6024) | /\* @todo: for IE parseFloat(0.55).toFixed(0) = 0; \*/ |
| [6025](#L6025) | s = (prec ? toFixedFix(n, prec).toString() : "" + Math.round(n)).split("."); |
| [6026](#L6026) | if( false == skip\_separator ){ |
| [6027](#L6027) | if (s[0].length > 3) { |
| [6028](#L6028) | s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep); |
| [6029](#L6029) | } |
| [6030](#L6030) | } |
| [6031](#L6031) | if ((s[1] || "").length < prec) { |
| [6032](#L6032) | s[1] = s[1] || ""; |
| [6033](#L6033) | s[1] += new Array(prec - s[1].length + 1).join("0"); |
| [6034](#L6034) | } |
| [6035](#L6035) | if( true == skip\_separator ){ |
| [6036](#L6036) | return parseFloat( s.join(dec) ); |
| [6037](#L6037) | } else { |
| [6038](#L6038) | return s.join(dec); |
| [6039](#L6039) | } |
| [6040](#L6040) | }, |
| [6041](#L6041) | ' . $bookingpress\_vue\_methods\_data . ' |
| [6042](#L6042) | }, |
| [6043](#L6043) | });'; |
| [6044](#L6044) |  |
| [6045](#L6045) | $bpa\_script\_data = " var app; |
| [6046](#L6046) | var is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el = false; |
| [6047](#L6047) | bookingpress\_beforeload\_data = ''; |
| [6048](#L6048) | if( null != document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash') ){ |
| [6049](#L6049) | bookingpress\_beforeload\_data = document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash').innerHTML; |
| [6050](#L6050) | } |
| [6051](#L6051) | window.addEventListener('DOMContentLoaded', function() { |
| [6052](#L6052) | if( is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el == false) { |
| [6053](#L6053) | is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el = true; |
| [6054](#L6054) | bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(); |
| [6055](#L6055) | } |
| [6056](#L6056) | }); |
| [6057](#L6057) |  |
| [6058](#L6058) | window.addEventListener( 'elementor/popup/show', (event) => { |
| [6059](#L6059) | let element = event.detail.instance.\$element[0].querySelector('.bpa-frontend-main-container'); |
| [6060](#L6060) | if( 'undefined' != typeof element ){ |
| [6061](#L6061) | document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash').innerHTML = bookingpress\_beforeload\_data; |
| [6062](#L6062) | bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(); |
| [6063](#L6063) | } |
| [6064](#L6064) | }); |
| [6065](#L6065) |  |
| [6066](#L6066) | function bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(){ |
| [6067](#L6067) | {$bookingpress\_script\_return\_data} |
| [6068](#L6068) | }"; |
| [6069](#L6069) |  |
| [6070](#L6070) | if( $bookingress\_load\_js\_css\_all\_pages == 'true' ){ |
| [6071](#L6071) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [6072](#L6072) | $bpa\_script\_data .= 'if( false == is\_script\_loaded\_'.$bookingpress\_vue\_root\_element\_id\_el.' ) {  is\_script\_loaded\_'.$bookingpress\_vue\_root\_element\_id\_el.' = true; bpa\_load\_vue\_shortcode\_'.$bookingpress\_vue\_root\_element\_id\_el.'(); }'; |
| [6073](#L6073) | } |
| [6074](#L6074) |  |
| [6075](#L6075) | wp\_add\_inline\_script('bookingpress\_elements\_locale', $bpa\_script\_data, 'after'); |
| [6076](#L6076) |  |
| [6077](#L6077) | if($bookingress\_load\_js\_css\_all\_pages != 'true' ) { |
| [6078](#L6078) |  |
| [6079](#L6079) | $bookingpress\_custom\_css = $BookingPress->bookingpress\_get\_customize\_settings('custom\_css', 'booking\_form'); |
| [6080](#L6080) | $bookingpress\_custom\_css = !empty($bookingpress\_custom\_css) ? stripslashes\_deep( $bookingpress\_custom\_css ) : ''; |
| [6081](#L6081) | wp\_add\_inline\_style( 'bookingpress\_front\_custom\_css', $bookingpress\_custom\_css, 'after' ); |
| [6082](#L6082) | } |
| [6083](#L6083) |  |
| [6084](#L6084) |  |
| [6085](#L6085) | $this->bookingpress\_form\_category = 0; |
| [6086](#L6086) | $this->bookingpress\_form\_service = 0 ; |
| [6087](#L6087) | $this->bookingpress\_hide\_category\_service= 0; |
| [6088](#L6088) | $this->bookingpress\_is\_service\_load\_from\_url = 0; |
| [6089](#L6089) | $this->bookingpress\_form\_fields\_error\_msg\_arr = array(); |
| [6090](#L6090) | $this->bookingpress\_form\_fields\_new = array(); |
| [6091](#L6091) |  |
| [6092](#L6092) | return do\_shortcode( $content ); |
| [6093](#L6093) | } |
| [6094](#L6094) |  |
| [6095](#L6095) | /\*\* |
| [6096](#L6096) | \* Hook for add data variables for Booking Form shortcode |
| [6097](#L6097) | \* |
| [6098](#L6098) | \* @param  mixed $bookingpress\_dynamic\_data\_fields      Global data variable for Booking Form |
| [6099](#L6099) | \* @param  mixed $bookingpress\_category                 Shortcode allowed category |
| [6100](#L6100) | \* @param  mixed $bookingpress\_service                  Shortcode allowed service |
| [6101](#L6101) | \* @param  mixed $selected\_service                      Shortcode default selected service |
| [6102](#L6102) | \* @param  mixed $selected\_category                     Shortcode default selected category |
| [6103](#L6103) | \* @return void |
| [6104](#L6104) | \*/ |
| [6105](#L6105) | function bookingpress\_booking\_dynamic\_data\_fields\_func( $bookingpress\_dynamic\_data\_fields, $bookingpress\_category, $bookingpress\_service, $selected\_service,$selected\_category ) |
| [6106](#L6106) | { |
| [6107](#L6107) | global $wpdb, $BookingPress, $bookingpress\_front\_vue\_data\_fields, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $tbl\_bookingpress\_form\_fields, $bookingpress\_global\_options; |
| [6108](#L6108) | // Get categories |
| [6109](#L6109) |  |
| [6110](#L6110) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['is\_waiting\_list'] = 0; |
| [6111](#L6111) | $bookingpress\_search\_query\_where = 'WHERE 1=1 '; |
| [6112](#L6112) | $bookingpress\_search\_query\_join  = ''; |
| [6113](#L6113) | if (! empty($bookingpress\_category) ) { |
| [6114](#L6114) | $bookingpress\_search\_query\_where .= " AND category.bookingpress\_category\_id IN ({$bookingpress\_category})"; |
| [6115](#L6115) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['total\_category'] = $bookingpress\_category; |
| [6116](#L6116) | } |
| [6117](#L6117) | $bookingpress\_search\_query\_join  .= "LEFT JOIN {$tbl\_bookingpress\_services} AS service ON category.bookingpress\_category\_id = service.bookingpress\_category\_id"; |
| [6118](#L6118) | $bookingpress\_search\_query\_where .= ' AND category.bookingpress\_category\_id = service.bookingpress\_category\_id'; |
| [6119](#L6119) | if (! empty($bookingpress\_service) ) { |
| [6120](#L6120) | $bookingpress\_search\_query\_where .= " AND service.bookingpress\_service\_id IN ({$bookingpress\_service})"; |
| [6121](#L6121) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['total\_services'] = $bookingpress\_service; |
| [6122](#L6122) | } |
| [6123](#L6123) |  |
| [6124](#L6124) |  |
| [6125](#L6125) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['check\_username\_validation'] = false; |
| [6126](#L6126) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['invalid\_customer\_username'] = false; |
| [6127](#L6127) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['invalid\_customer\_message'] = 'Invalid Username'; |
| [6128](#L6128) |  |
| [6129](#L6129) | $bookingpress\_search\_query\_where .= ' GROUP BY bookingpress\_category\_id'; |
| [6130](#L6130) | $bookingpress\_service\_categories  = $wpdb->get\_results("SELECT category.\* FROM {$tbl\_bookingpress\_categories} AS category {$bookingpress\_search\_query\_join} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_category\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_categories is a table name. false alarm |
| [6131](#L6131) |  |
| [6132](#L6132) | foreach (  $bookingpress\_service\_categories as $key => $val ) { |
| [6133](#L6133) | $bookingpress\_service\_categories[$key]['bookingpress\_category\_name'] = stripslashes\_deep($val['bookingpress\_category\_name']); |
| [6134](#L6134) | $bookingpress\_service\_categories[$key]['is\_visible'] = true; |
| [6135](#L6135) | } |
| [6136](#L6136) | $bookingpress\_front\_vue\_data\_fields['service\_categories'] = $bookingpress\_service\_categories; |
| [6137](#L6137) | $default\_service\_category = ! empty($bookingpress\_service\_categories[0]['bookingpress\_category\_id']) ? $bookingpress\_service\_categories[0]['bookingpress\_category\_id'] : 0; |
| [6138](#L6138) | $default\_service\_category  = empty($selected\_category) ? $default\_service\_category : $selected\_category; |
| [6139](#L6139) |  |
| [6140](#L6140) |  |
| [6141](#L6141) |  |
| [6142](#L6142) | //$bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $default\_service\_category; |
| [6143](#L6143) |  |
| [6144](#L6144) | $all\_categories = $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_categories']; |
| [6145](#L6145) |  |
| [6146](#L6146) |  |
| [6147](#L6147) |  |
| [6148](#L6148) | if( !empty($all\_categories) && count( $all\_categories ) == 1 ){ |
| [6149](#L6149) | $first\_category\_data = $all\_categories[ array\_key\_first( $all\_categories ) ]; |
| [6150](#L6150) | if( 0 === $first\_category\_data['category\_id'] ){ |
| [6151](#L6151) |  |
| [6152](#L6152) | } |
| [6153](#L6153) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $all\_categories[ array\_key\_first( $all\_categories ) ]['category\_id']; |
| [6154](#L6154) |  |
| [6155](#L6155) | } else if( count( $all\_categories ) > 1 ){ |
| [6156](#L6156) | $default\_category = ''; |
| [6157](#L6157) | $n = 0; |
| [6158](#L6158) | foreach( $all\_categories as $all\_cat\_data ){ |
| [6159](#L6159) | if( $n == 0 && $all\_cat\_data['category\_id'] == 0 ){ |
| [6160](#L6160) | $n++; |
| [6161](#L6161) | continue; |
| [6162](#L6162) | } |
| [6163](#L6163) | if( $n < 2 && empty( $default\_category )){ |
| [6164](#L6164) | $default\_category = $all\_cat\_data['category\_id']; |
| [6165](#L6165) | break; |
| [6166](#L6166) | } |
| [6167](#L6167) | $n++; |
| [6168](#L6168) | } |
| [6169](#L6169) |  |
| [6170](#L6170) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $default\_category; |
| [6171](#L6171) | } |
| [6172](#L6172) |  |
| [6173](#L6173) | $bookingpress\_service\_search\_query\_where = ''; |
| [6174](#L6174) | $bookingpress\_service\_cache\_param = $default\_service\_category; |
| [6175](#L6175) |  |
| [6176](#L6176) | if (! empty($bookingpress\_service) ) { |
| [6177](#L6177) | $bookingpress\_service\_search\_query\_where .= " AND bookingpress\_service\_id IN ({$bookingpress\_service})"; |
| [6178](#L6178) | $bookingpress\_service\_cache\_param .= '\_' . $bookingpress\_service; |
| [6179](#L6179) | } |
| [6180](#L6180) |  |
| [6181](#L6181) | //$service\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_category\_id = {$default\_service\_category} {$bookingpress\_service\_search\_query\_where} ORDER BY bookingpress\_service\_position", ARRAY\_A); |
| [6182](#L6182) | $all\_service\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE 1=1 {$bookingpress\_service\_search\_query\_where} ORDER BY bookingpress\_service\_position", ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_services is a table name. false alarm |
| [6183](#L6183) | $service\_data = array(); |
| [6184](#L6184) | $temp\_service\_data = array(); |
| [6185](#L6185) | $bpa\_services\_categories\_data = array(); |
| [6186](#L6186) | $all\_services\_data = array(); |
| [6187](#L6187) | $bookingpress\_display\_service\_description = $BookingPress->bookingpress\_get\_customize\_settings('display\_service\_description', 'booking\_form'); |
| [6188](#L6188) |  |
| [6189](#L6189) | $all\_service\_data = apply\_filters( 'bookingpress\_remove\_disabled\_services', $all\_service\_data ); |
| [6190](#L6190) |  |
| [6191](#L6191) | $min\_text = $BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_min\_text', 'booking\_form'); |
| [6192](#L6192) | $hour\_text = $BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_hours\_text', 'booking\_form'); |
| [6193](#L6193) |  |
| [6194](#L6194) | $bookingpress\_duration\_suffix\_labels = array( |
| [6195](#L6195) | 'm' => !empty( $min\_text ) ? stripslashes\_deep($min\_text) : esc\_html\_\_('m', 'bookingpress-appointment-booking'), |
| [6196](#L6196) | 'h' => !empty( $hour\_text ) ? stripslashes\_deep($hour\_text) : esc\_html\_\_('h', 'bookingpress-appointment-booking'), |
| [6197](#L6197) | ); |
| [6198](#L6198) |  |
| [6199](#L6199) | $bookingpress\_duration\_suffix\_labels = apply\_filters( 'bookingpress\_modify\_service\_duration\_label', $bookingpress\_duration\_suffix\_labels ); |
| [6200](#L6200) |  |
| [6201](#L6201) |  |
| [6202](#L6202) | $bookingpress\_related\_category\_service = array(); |
| [6203](#L6203) | $bookingpress\_all\_service\_data = (isset($bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data']))?$bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data']:array(); |
| [6204](#L6204) | foreach ( $all\_service\_data as $service\_key => $service\_val ) { |
| [6205](#L6205) | $temp\_service\_data[ $service\_key ] = $all\_service\_data[ $service\_key ]; |
| [6206](#L6206) |  |
| [6207](#L6207) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_duration\_label'] = !empty( $bookingpress\_duration\_suffix\_labels[ $service\_val['bookingpress\_service\_duration\_unit'] ] ) ? $bookingpress\_duration\_suffix\_labels[ $service\_val['bookingpress\_service\_duration\_unit'] ] : $service\_val['bookingpress\_service\_duration\_unit']; |
| [6208](#L6208) | $temp\_service\_data[ $service\_key ]['service\_position'] = $service\_val['bookingpress\_service\_position']; |
| [6209](#L6209) | $temp\_service\_data[ $service\_key ]['service\_price\_without\_currency'] = $service\_val['bookingpress\_service\_price']; |
| [6210](#L6210) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_price']     = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($service\_val['bookingpress\_service\_price']); |
| [6211](#L6211) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_name'] = stripslashes($service\_val['bookingpress\_service\_name']); |
| [6212](#L6212) |  |
| [6213](#L6213) | $service\_id                              = $service\_val['bookingpress\_service\_id']; |
| [6214](#L6214) | $service\_img\_details                     = ''; |
| [6215](#L6215) | if($service\_id && !empty($bookingpress\_all\_service\_data) && isset($bookingpress\_all\_service\_data[$service\_id]['services\_meta'])){ |
| [6216](#L6216) | $service\_img\_details  = (isset($bookingpress\_all\_service\_data[$service\_id]['services\_meta']['service\_image\_details']))?$bookingpress\_all\_service\_data[$service\_id]['services\_meta']['service\_image\_details']:array(); |
| [6217](#L6217) | $service\_img\_details = (!empty($service\_img\_details))?$service\_img\_details:array(); |
| [6218](#L6218) | }else{ |
| [6219](#L6219) | $service\_meta\_details                    = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_servicesmeta} WHERE bookingpress\_service\_id = %d AND bookingpress\_servicemeta\_name = 'service\_image\_details'", $service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_servicesmeta is table name defined globally. False Positive alarm |
| [6220](#L6220) | $service\_img\_details                     = ! empty($service\_meta\_details['bookingpress\_servicemeta\_value']) ? maybe\_unserialize($service\_meta\_details['bookingpress\_servicemeta\_value']) : array(); |
| [6221](#L6221) | } |
| [6222](#L6222) |  |
| [6223](#L6223) | $bpa\_user\_placeholder = !empty( $service\_img\_details[0]['url'] ) ? false : true; |
| [6224](#L6224) | $temp\_service\_data[ $service\_key ]['img\_url'] = ! empty($service\_img\_details[0]['url']) ? $service\_img\_details[0]['url'] : BOOKINGPRESS\_URL . '/images/placeholder-img.jpg'; |
| [6225](#L6225) | $temp\_service\_data[ $service\_key ]['use\_placeholder'] = $bpa\_user\_placeholder; |
| [6226](#L6226) | $temp\_service\_data[ $service\_key ]['is\_visible'] = true; |
| [6227](#L6227) | $temp\_service\_data[ $service\_key ]['is\_disabled'] = false; |
| [6228](#L6228) |  |
| [6229](#L6229) | $default\_service\_description = ! empty($service\_val['bookingpress\_service\_description']) ? $service\_val['bookingpress\_service\_description'] : ''; |
| [6230](#L6230) |  |
| [6231](#L6231) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [6232](#L6232) | $temp\_service\_data[ $service\_key ]['display\_read\_more\_less']           = 1; |
| [6233](#L6233) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_description'] = stripslashes\_deep($default\_service\_description); |
| [6234](#L6234) | if (strlen($default\_service\_description) > 140 ) { |
| [6235](#L6235) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_description\_with\_excerpt'] = stripslashes(substr($default\_service\_description, 0, 140)); |
| [6236](#L6236) | $temp\_service\_data[ $service\_key ]['display\_details\_more']                          = 0; |
| [6237](#L6237) | $temp\_service\_data[ $service\_key ]['display\_details\_less']                          = 1; |
| [6238](#L6238) | } else { |
| [6239](#L6239) | $temp\_service\_data[ $service\_key ]['display\_read\_more\_less'] = 0; |
| [6240](#L6240) | } |
| [6241](#L6241) | } |
| [6242](#L6242) | if($service\_val['bookingpress\_category\_id'] || $service\_val['bookingpress\_category\_id'] == 0){ |
| [6243](#L6243) | $bookingpress\_related\_category\_service[$service\_val['bookingpress\_category\_id']][] = $service\_val['bookingpress\_service\_id']; |
| [6244](#L6244) | } |
| [6245](#L6245) |  |
| [6246](#L6246) | if( $service\_val['bookingpress\_category\_id'] == $default\_service\_category ){ |
| [6247](#L6247) | $service\_data[ $service\_key ] = $temp\_service\_data[ $service\_key ]; |
| [6248](#L6248) | } |
| [6249](#L6249) | if( empty( $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ] ) ){ |
| [6250](#L6250) | $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ] = array(); |
| [6251](#L6251) | } |
| [6252](#L6252) | $all\_services\_data[ $service\_key ] = $temp\_service\_data[ $service\_key ]; |
| [6253](#L6253) | $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ][] = $temp\_service\_data[ $service\_key ]; |
| [6254](#L6254) | } |
| [6255](#L6255) |  |
| [6256](#L6256) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [6257](#L6257) | $bookingpress\_front\_vue\_data\_fields['display\_service\_description'] = '1'; |
| [6258](#L6258) | } |
| [6259](#L6259) |  |
| [6260](#L6260) | $bookingpress\_front\_vue\_data\_fields['services\_data'] = $service\_data; |
| [6261](#L6261) |  |
| [6262](#L6262) | $bookingpress\_front\_vue\_data\_fields['bpa\_services\_data\_from\_categories'] = $bpa\_services\_categories\_data; |
| [6263](#L6263) | $bookingpress\_front\_vue\_data\_fields['all\_services\_data'] = $all\_services\_data; |
| [6264](#L6264) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['related\_category\_service'] = $bookingpress\_related\_category\_service; |
| [6265](#L6265) |  |
| [6266](#L6266) | $bookingpress\_is\_uncategorized\_service\_added = 0; |
| [6267](#L6267) | foreach($all\_services\_data as $ser\_key => $ser\_val){ |
| [6268](#L6268) | if(empty($ser\_val['bookingpress\_category\_id']) && empty($bookingpress\_service) && empty($bookingpress\_category)){ |
| [6269](#L6269) | $bookingpress\_is\_uncategorized\_service\_added = 1; |
| [6270](#L6270) | break; |
| [6271](#L6271) | }else if(empty($ser\_val['bookingpress\_category\_id']) && !empty($bookingpress\_service) && empty($bookingpress\_category)){ |
| [6272](#L6272) | $bookingpress\_is\_uncategorized\_service\_added = 1; |
| [6273](#L6273) | break; |
| [6274](#L6274) | } |
| [6275](#L6275) | } |
| [6276](#L6276) | $bookingpress\_front\_vue\_data\_fields['is\_uncategorize\_service\_added'] = $bookingpress\_is\_uncategorized\_service\_added; |
| [6277](#L6277) | $default\_service\_id = 0; |
| [6278](#L6278) |  |
| [6279](#L6279) | $default\_service\_name = $default\_price = $default\_service\_duration = $default\_service\_duration\_unit = $default\_price\_with\_currency = ""; |
| [6280](#L6280) | $service\_data= array\_values($service\_data); |
| [6281](#L6281) | if(!empty($service\_data)) { |
| [6282](#L6282) | foreach($service\_data as $key => $val) { |
| [6283](#L6283) | if((!empty($selected\_service) ) ) { |
| [6284](#L6284) | if($selected\_service == $val['bookingpress\_service\_id']) { |
| [6285](#L6285) | $default\_service\_id                                  = ! empty($val['bookingpress\_service\_id']) ? $val['bookingpress\_service\_id'] : 0; |
| [6286](#L6286) | $default\_service\_name                                = ! empty($val['bookingpress\_service\_name']) ? stripslashes\_deep($val['bookingpress\_service\_name']) : ''; |
| [6287](#L6287) | $default\_price                                       = ! empty($val['bookingpress\_service\_price']) ? $val['bookingpress\_service\_price'] : 0; |
| [6288](#L6288) | $default\_price\_with\_currency                         = ! empty($val['service\_price\_without\_currency']) ? $val['service\_price\_without\_currency'] : 0; |
| [6289](#L6289) | $default\_service\_duration\_unit                         = ! empty($val['bookingpress\_service\_duration\_unit']) ? $val |
| [6290](#L6290) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6291](#L6291) | $default\_service\_duration                         = ! empty($val['bookingpress\_service\_duration\_val']) ? $val |
| [6292](#L6292) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6293](#L6293) |  |
| [6294](#L6294) | } |
| [6295](#L6295) | } else { |
| [6296](#L6296) | $default\_service\_id   = ! empty($service\_data[0]['bookingpress\_service\_id']) ? $service\_data[0]['bookingpress\_service\_id'] : $all\_services\_data[0]['bookingpress\_service\_id']; |
| [6297](#L6297) | $default\_service\_name  = ! empty($service\_data[0]['bookingpress\_service\_name']) ? stripslashes($service\_data[0]['bookingpress\_service\_name']) : ''; |
| [6298](#L6298) | $default\_price   = ! empty($service\_data[0]['bookingpress\_service\_price']) ? $service\_data[0]['bookingpress\_service\_price'] : 0; |
| [6299](#L6299) | $default\_price\_with\_currency  = ! empty($service\_data[0]['service\_price\_without\_currency']) ? $service\_data[0]['service\_price\_without\_currency'] : 0; |
| [6300](#L6300) | $default\_service\_duration\_unit= ! empty($service\_data[0]['bookingpress\_service\_duration\_unit']) ? $service\_data[0] |
| [6301](#L6301) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6302](#L6302) | $default\_service\_duration                         = ! empty($service\_data[0]['bookingpress\_service\_duration\_val']) ? $service\_data[0] |
| [6303](#L6303) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6304](#L6304) | } |
| [6305](#L6305) | } |
| [6306](#L6306) | } |
| [6307](#L6307) |  |
| [6308](#L6308) | if(empty($default\_service\_id) && !empty($selected\_service)){ |
| [6309](#L6309) | //If default no service selected and selected service parameter pass from booking form shortcode then this condition will executed |
| [6310](#L6310) | foreach($all\_services\_data as $key => $val) { |
| [6311](#L6311) | if((!empty($selected\_service) ) ) { |
| [6312](#L6312) | if($selected\_service == $val['bookingpress\_service\_id']) { |
| [6313](#L6313) | $default\_service\_id                                  = ! empty($val['bookingpress\_service\_id']) ? $val['bookingpress\_service\_id'] : 0; |
| [6314](#L6314) | $default\_service\_name                                = ! empty($val['bookingpress\_service\_name']) ? stripslashes\_deep($val['bookingpress\_service\_name']) : ''; |
| [6315](#L6315) | $default\_price                                       = ! empty($val['bookingpress\_service\_price']) ? $val['bookingpress\_service\_price'] : 0; |
| [6316](#L6316) | $default\_price\_with\_currency                         = ! empty($val['service\_price\_without\_currency']) ? $val['service\_price\_without\_currency'] : 0; |
| [6317](#L6317) | $default\_service\_duration\_unit                         = ! empty($val['bookingpress\_service\_duration\_unit']) ? $val |
| [6318](#L6318) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6319](#L6319) | $default\_service\_duration                         = ! empty($val['bookingpress\_service\_duration\_val']) ? $val |
| [6320](#L6320) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6321](#L6321) | } |
| [6322](#L6322) | } |
| [6323](#L6323) | } |
| [6324](#L6324) | } |
| [6325](#L6325) |  |
| [6326](#L6326) | $bookingpress\_is\_hide\_category\_service\_selection = $BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection', 'booking\_form'); |
| [6327](#L6327) |  |
| [6328](#L6328) | $bpa\_move\_from\_service\_selection\_step = false; |
| [6329](#L6329) |  |
| [6330](#L6330) | if( empty( $default\_service\_id ) ){ |
| [6331](#L6331) | $default\_service\_id = apply\_filters( 'bookingpress\_modify\_default\_servide\_id', $default\_service\_id, $bookingpress\_front\_vue\_data\_fields ); |
| [6332](#L6332) | } |
| [6333](#L6333) |  |
| [6334](#L6334) | if ( $bookingpress\_is\_hide\_category\_service\_selection == 'true' || ! empty( $selected\_service ) || ( !empty($bookingpress\_service) && (count($all\_services\_data) == 1) && empty($bookingpress\_category) ) ) { |
| [6335](#L6335) | // If hide category service step option enabled then by default service selected |
| [6336](#L6336) | // If only 1 service display from shortcode parameter then by default that 1 service also selected automatically |
| [6337](#L6337) | // If there is any service selected from parameter then also service automatically selected |
| [6338](#L6338) |  |
| [6339](#L6339) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service']               = $default\_service\_id; |
| [6340](#L6340) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_name']          = $default\_service\_name; |
| [6341](#L6341) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_price']         = $default\_price; |
| [6342](#L6342) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['service\_price\_without\_currency'] = $default\_price\_with\_currency; |
| [6343](#L6343) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_duration\_unit'] = $default\_service\_duration\_unit; |
| [6344](#L6344) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_duration'] = $default\_service\_duration; |
| [6345](#L6345) |  |
| [6346](#L6346) | $bookingpress\_front\_vue\_data\_fields['displayResponsiveCalendar'] = "1"; |
| [6347](#L6347) | } |
| [6348](#L6348) |  |
| [6349](#L6349) | if( 'true' == $bookingpress\_is\_hide\_category\_service\_selection ){ |
| [6350](#L6350) | $bpa\_move\_from\_service\_selection\_step = true; |
| [6351](#L6351) | } else if( !empty( $default\_service\_id ) && 1 == $this->bookingpress\_is\_service\_load\_from\_url ){ |
| [6352](#L6352) | $bpa\_move\_from\_service\_selection\_step = true; |
| [6353](#L6353) | } |
| [6354](#L6354) |  |
| [6355](#L6355) | $bpa\_move\_from\_service\_selection\_step = apply\_filters( 'bookingpress\_check\_flag\_to\_move\_next\_from\_serfice', $bpa\_move\_from\_service\_selection\_step, $bookingpress\_front\_vue\_data\_fields ); |
| [6356](#L6356) |  |
| [6357](#L6357) | $on\_site\_payment = $BookingPress->bookingpress\_get\_settings('on\_site\_payment', 'payment\_setting'); |
| [6358](#L6358) | $paypal\_payment  = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [6359](#L6359) |  |
| [6360](#L6360) | $bookingpress\_front\_vue\_data\_fields['on\_site\_payment'] = $on\_site\_payment; |
| [6361](#L6361) | $bookingpress\_front\_vue\_data\_fields['paypal\_payment']  = $paypal\_payment; |
| [6362](#L6362) |  |
| [6363](#L6363) | $bookingpress\_total\_configure\_gateways = 0; |
| [6364](#L6364) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6365](#L6365) | if (( $on\_site\_payment == 'true' || $on\_site\_payment == '1' ) && ( $paypal\_payment == 'true' || $paypal\_payment == '1' ) ) { |
| [6366](#L6366) | $bookingpress\_total\_configure\_gateways = 2; |
| [6367](#L6367) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6368](#L6368) | } elseif (( $on\_site\_payment == 'true' || $on\_site\_payment == '1' ) && ( $paypal\_payment == 'false' || empty($paypal\_payment) ) ) { |
| [6369](#L6369) | $bookingpress\_total\_configure\_gateways = 1; |
| [6370](#L6370) | $bookingpress\_is\_only\_onsite\_enabled   = 1; |
| [6371](#L6371) | } elseif (( $on\_site\_payment == 'false' || empty($on\_site\_payment) ) && ( $paypal\_payment == 'true' || $paypal\_payment == '1' ) ) { |
| [6372](#L6372) | $bookingpress\_total\_configure\_gateways = 1; |
| [6373](#L6373) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6374](#L6374) | } |
| [6375](#L6375) |  |
| [6376](#L6376) | $bookingpress\_front\_vue\_data\_fields['total\_configure\_gateways'] = $bookingpress\_total\_configure\_gateways; |
| [6377](#L6377) | $bookingpress\_front\_vue\_data\_fields['is\_only\_onsite\_enabled']   = $bookingpress\_is\_only\_onsite\_enabled; |
| [6378](#L6378) |  |
| [6379](#L6379) |  |
| [6380](#L6380) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_payment\_method'] = ''; |
| [6381](#L6381) |  |
| [6382](#L6382) | if ($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_payment\_method'] == '' && ( $paypal\_payment == 'true' ) ) { |
| [6383](#L6383) | $bookingpress\_front\_vue\_data\_fields['paypal\_payment'] = 'paypal'; |
| [6384](#L6384) | } |
| [6385](#L6385) |  |
| [6386](#L6386) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 0; |
| [6387](#L6387) | $bookingpress\_front\_vue\_data\_fields['bpa\_check\_user\_login'] = 0; |
| [6388](#L6388) |  |
| [6389](#L6389) | if (is\_user\_logged\_in() ) { |
| [6390](#L6390) | $current\_user\_id               = get\_current\_user\_id(); |
| [6391](#L6391) | $bookingpress\_current\_user\_obj = new WP\_User($current\_user\_id); |
| [6392](#L6392) | $bookingpress\_front\_vue\_data\_fields['bpa\_check\_user\_login'] = 1; |
| [6393](#L6393) |  |
| [6394](#L6394) | $get\_current\_user\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d AND bookingpress\_user\_type = 2", $current\_user\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [6395](#L6395) | if (! empty($get\_current\_user\_data) ) { |
| [6396](#L6396) | $bookingpress\_firstname = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_firstname']); |
| [6397](#L6397) | $bookingpress\_lastname = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_lastname']); |
| [6398](#L6398) | $bookingpress\_customername = !empty($get\_current\_user\_data['bookingpress\_user\_name']) ? stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_name']) : ''; |
| [6399](#L6399) | $bookingpress\_customername\_full\_name = !empty($get\_current\_user\_data['bookingpress\_customer\_full\_name']) ? stripslashes\_deep($get\_current\_user\_data['bookingpress\_customer\_full\_name']) : ''; |
| [6400](#L6400) |  |
| [6401](#L6401) | /\* if( empty($bookingpress\_customername\_full\_name)){ |
| [6402](#L6402) | $bookingpress\_customername\_full\_name = $bookingpress\_customername; |
| [6403](#L6403) | } \*/ |
| [6404](#L6404) |  |
| [6405](#L6405) | if( !empty($bookingpress\_customername)){ |
| [6406](#L6406) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 1; |
| [6407](#L6407) | } |
| [6408](#L6408) |  |
| [6409](#L6409) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'])) { |
| [6410](#L6410) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'] = stripslashes\_deep($bookingpress\_customername\_full\_name); |
| [6411](#L6411) | } |
| [6412](#L6412) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'])) { |
| [6413](#L6413) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'] = stripslashes\_deep($bookingpress\_customername); |
| [6414](#L6414) | } |
| [6415](#L6415) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone'])) { |
| [6416](#L6416) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone'] = $get\_current\_user\_data['bookingpress\_user\_phone']; |
| [6417](#L6417) | } |
| [6418](#L6418) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'])) { |
| [6419](#L6419) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'] = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_email']); |
| [6420](#L6420) | } |
| [6421](#L6421) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'])) { |
| [6422](#L6422) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'] = stripslashes\_deep($bookingpress\_firstname); |
| [6423](#L6423) | } |
| [6424](#L6424) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname'])) { |
| [6425](#L6425) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname']  = stripslashes\_deep($bookingpress\_lastname); |
| [6426](#L6426) | } |
| [6427](#L6427) | } elseif (! empty($current\_user\_id) && ! empty($bookingpress\_current\_user\_obj) ) { |
| [6428](#L6428) | $bookingpress\_customer\_name  = ! empty($bookingpress\_current\_user\_obj->data->user\_login) ? $bookingpress\_current\_user\_obj->data->user\_login : ''; |
| [6429](#L6429) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [6430](#L6430) | $bookingpress\_firstname      = get\_user\_meta($current\_user\_id, 'first\_name', true); |
| [6431](#L6431) | $bookingpress\_lastname       = get\_user\_meta($current\_user\_id, 'last\_name', true); |
| [6432](#L6432) |  |
| [6433](#L6433) | if( !empty($bookingpress\_customer\_name)){ |
| [6434](#L6434) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 1; |
| [6435](#L6435) | } |
| [6436](#L6436) |  |
| [6437](#L6437) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'])) { |
| [6438](#L6438) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [6439](#L6439) | } |
| [6440](#L6440) |  |
| [6441](#L6441) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'])) { |
| [6442](#L6442) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [6443](#L6443) | } |
| [6444](#L6444) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'])) { |
| [6445](#L6445) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email']     = stripslashes\_deep($bookingpress\_customer\_email); |
| [6446](#L6446) | } |
| [6447](#L6447) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'])) { |
| [6448](#L6448) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'] = stripslashes\_deep($bookingpress\_firstname); |
| [6449](#L6449) | } |
| [6450](#L6450) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname'])) { |
| [6451](#L6451) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname']  = stripslashes\_deep($bookingpress\_lastname); |
| [6452](#L6452) | } |
| [6453](#L6453) | } |
| [6454](#L6454) | } |
| [6455](#L6455) | $bookingpress\_phone\_mandatory\_option = $BookingPress->bookingpress\_get\_settings('phone\_number\_mandatory', 'general\_setting'); |
| [6456](#L6456) | if (! empty($bookingpress\_phone\_mandatory\_option) && $bookingpress\_phone\_mandatory\_option == 'true' ) { |
| [6457](#L6457) | $mandatory\_field\_data = array( |
| [6458](#L6458) | 'required' => true, |
| [6459](#L6459) | 'message'  => esc\_html\_\_('Please enter customer phone number', 'bookingpress-appointment-booking'), |
| [6460](#L6460) | 'trigger'  => 'blur', |
| [6461](#L6461) | ); |
| [6462](#L6462) | $bookingpress\_front\_vue\_data\_fields['customer\_details\_rule']['customer\_phone'] = $mandatory\_field\_data; |
| [6463](#L6463) | } |
| [6464](#L6464) |  |
| [6465](#L6465) | $bookingpress\_phone\_country\_option = $BookingPress->bookingpress\_get\_settings('default\_phone\_country\_code', 'general\_setting'); |
| [6466](#L6466) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone\_country'] = $bookingpress\_phone\_country\_option; |
| [6467](#L6467) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone\_dial\_code'] = ''; |
| [6468](#L6468) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['bookingpress\_customer\_timezone'] = $bookingpress\_global\_options->bookingpress\_get\_site\_timezone\_offset(); |
| [6469](#L6469) |  |
| [6470](#L6470) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_tel\_input\_props'] = array( |
| [6471](#L6471) | 'defaultCountry' => $bookingpress\_phone\_country\_option, |
| [6472](#L6472) | 'inputOptions'   => array( |
| [6473](#L6473) | 'placeholder' => '', |
| [6474](#L6474) | ), |
| [6475](#L6475) | 'validCharactersOnly' => true, |
| [6476](#L6476) | ); |
| [6477](#L6477) |  |
| [6478](#L6478) | $default\_daysoff\_details = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [6479](#L6479) | $disabled\_date           = implode(',', $default\_daysoff\_details); |
| [6480](#L6480) | $bookingpress\_front\_vue\_data\_fields['days\_off\_disabled\_dates'] = $disabled\_date; |
| [6481](#L6481) |  |
| [6482](#L6482) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_disable\_dates'] = array(); |
| [6483](#L6483) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_dates'] = array(); |
| [6484](#L6484) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_blocked\_dates'] = array(); |
| [6485](#L6485) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_only\_date'] = array(); |
| [6486](#L6486) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_timeslots\_data'] = array(); |
| [6487](#L6487) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_time\_token\_data'] = array(); |
| [6488](#L6488) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_attributes'] = array(); |
| [6489](#L6489) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_attributes\_current'] = array(); |
| [6490](#L6490) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_default\_label'] = array(); |
| [6491](#L6491) |  |
| [6492](#L6492) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_check\_month\_dates'] = false; |
| [6493](#L6493) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_next\_month\_dates'] = ''; |
| [6494](#L6494) |  |
| [6495](#L6495) | $bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load(); |
| [6496](#L6496) |  |
| [6497](#L6497) | if (! empty($bookingpress\_selected\_date) ) { |
| [6498](#L6498) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_date'] = $bookingpress\_selected\_date; |
| [6499](#L6499) | } |
| [6500](#L6500) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_activate\_payment\_gateway\_counter'] = 0; |
| [6501](#L6501) |  |
| [6502](#L6502) | if($bookingpress\_front\_vue\_data\_fields['bookingpress\_activate\_payment\_gateway\_counter'] > 0) { |
| [6503](#L6503) | $bookingpress\_front\_vue\_data\_fields['is\_only\_onsite\_enabled']   = 0; |
| [6504](#L6504) | } |
| [6505](#L6505) |  |
| [6506](#L6506) | $bookingpress\_customize\_settings = $BookingPress->bookingpress\_get\_customize\_settings( |
| [6507](#L6507) | array( |
| [6508](#L6508) | 'service\_title', |
| [6509](#L6509) | 'datetime\_title', |
| [6510](#L6510) | 'basic\_details\_title', |
| [6511](#L6511) | 'summary\_title', |
| [6512](#L6512) | 'hide\_category\_service\_selection' |
| [6513](#L6513) | ), |
| [6514](#L6514) | 'booking\_form' |
| [6515](#L6515) | ); |
| [6516](#L6516) |  |
| [6517](#L6517) | $bookingpress\_hide\_category\_service\_selection = stripslashes\_deep($bookingpress\_customize\_settings['hide\_category\_service\_selection']); |
| [6518](#L6518) | $bookingpress\_is\_loaded\_from\_share\_url = false; |
| [6519](#L6519) | if(!empty($\_GET['s\_id']) && (isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '0' ) ){ |
| [6520](#L6520) | $bookingpress\_hide\_category\_service\_selection = 'true'; |
| [6521](#L6521) | $bookingpress\_is\_loaded\_from\_share\_url = true; |
| [6522](#L6522) | }else if(!empty($\_GET['s\_id']) && (isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '1' ) ){ |
| [6523](#L6523) | $bookingpress\_hide\_category\_service\_selection = 'false'; |
| [6524](#L6524) | $bookingpress\_is\_loaded\_from\_share\_url = true; |
| [6525](#L6525) | } |
| [6526](#L6526) |  |
| [6527](#L6527) | if( 'true' == $bookingpress\_hide\_category\_service\_selection && empty( $selected\_service ) && true == $bookingpress\_is\_loaded\_from\_share\_url ){ |
| [6528](#L6528) | $bookingpress\_hide\_category\_service\_selection = 'false'; |
| [6529](#L6529) | } |
| [6530](#L6530) |  |
| [6531](#L6531) | $bookingpress\_service\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['service\_title']); |
| [6532](#L6532) | $bookingpress\_datetime\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['datetime\_title']);// |
| [6533](#L6533) | $bookingpress\_basic\_details\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['basic\_details\_title']); |
| [6534](#L6534) | $bookingpress\_summary\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['summary\_title']); |
| [6535](#L6535) |  |
| [6536](#L6536) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [6537](#L6537) |  |
| [6538](#L6538) | $no\_appointment\_date\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_date\_selected\_for\_the\_booking', 'message\_setting'); |
| [6539](#L6539) |  |
| [6540](#L6540) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [6541](#L6541) |  |
| [6542](#L6542) | $no\_payment\_method\_is\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_payment\_method\_is\_selected\_for\_the\_booking', 'message\_setting'); |
| [6543](#L6543) |  |
| [6544](#L6544) | $bookingpress\_date\_time\_step\_note = $BookingPress->bookingpress\_get\_customize\_settings('date\_time\_step\_note','booking\_form'); |
| [6545](#L6545) | $bookingpress\_date\_time\_step\_note = !empty($bookingpress\_date\_time\_step\_note) ? stripslashes\_deep($bookingpress\_date\_time\_step\_note) : ''; |
| [6546](#L6546) | $bookingpress\_front\_vue\_data\_fields['date\_time\_step\_note'] = $bookingpress\_date\_time\_step\_note; |
| [6547](#L6547) |  |
| [6548](#L6548) | $bookingpress\_summary\_step\_note = $BookingPress->bookingpress\_get\_customize\_settings('summary\_step\_note','booking\_form'); |
| [6549](#L6549) | $bookingpress\_summary\_step\_note = !empty($bookingpress\_summary\_step\_note) ? stripslashes\_deep($bookingpress\_summary\_step\_note) : ''; |
| [6550](#L6550) | $bookingpress\_front\_vue\_data\_fields['summary\_step\_note'] = $bookingpress\_summary\_step\_note; |
| [6551](#L6551) |  |
| [6552](#L6552) | $bookingpress\_sidebar\_steps\_data = array( |
| [6553](#L6553) | 'service' => array( |
| [6554](#L6554) | 'tab\_name' => $bookingpress\_service\_tab\_name, |
| [6555](#L6555) | 'tab\_value' => 'service', |
| [6556](#L6556) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2zM7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM19 3H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>', |
| [6557](#L6557) | 'next\_tab\_name' => 'datetime', |
| [6558](#L6558) | 'next\_tab\_label' => '', |
| [6559](#L6559) | 'previous\_tab\_name' => '', |
| [6560](#L6560) | 'validate\_fields' => array( |
| [6561](#L6561) | 'selected\_service', |
| [6562](#L6562) | ), |
| [6563](#L6563) | 'auto\_focus\_tab\_callback' => array(), |
| [6564](#L6564) | 'validation\_msg' => array( |
| [6565](#L6565) | 'selected\_service' => stripslashes\_deep($no\_service\_selected\_for\_the\_booking), |
| [6566](#L6566) | ), |
| [6567](#L6567) | 'is\_allow\_navigate' => 1, |
| [6568](#L6568) | 'is\_navigate\_to\_next' => $bpa\_move\_from\_service\_selection\_step, |
| [6569](#L6569) | 'is\_display\_step' => 1, |
| [6570](#L6570) | 'sorting\_key' => 'service\_selection', |
| [6571](#L6571) | ), |
| [6572](#L6572) | 'datetime' => array( |
| [6573](#L6573) | 'tab\_name' => $bookingpress\_datetime\_tab\_name, |
| [6574](#L6574) | 'tab\_value' => 'datetime', |
| [6575](#L6575) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 4h-1V3c0-.55-.45-1-1-1s-1 .45-1 1v1H8V3c0-.55-.45-1-1-1s-1 .45-1 1v1H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 15c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1V9h14v10zM7 11h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/></svg>', |
| [6576](#L6576) | 'next\_tab\_name' => 'basic\_details', |
| [6577](#L6577) | 'previous\_tab\_name' => 'service', |
| [6578](#L6578) | 'auto\_focus\_tab\_callback' => array( |
| [6579](#L6579) | 'bookingpress\_disable\_date' => array() |
| [6580](#L6580) | ), |
| [6581](#L6581) | 'validate\_fields' => array( |
| [6582](#L6582) | 'selected\_date', |
| [6583](#L6583) | 'selected\_start\_time', |
| [6584](#L6584) | ), |
| [6585](#L6585) | 'validation\_msg' => array( |
| [6586](#L6586) | 'selected\_date' => stripslashes\_deep($no\_appointment\_date\_selected\_for\_the\_booking), |
| [6587](#L6587) | 'selected\_start\_time' => stripslashes\_deep($no\_appointment\_time\_selected\_for\_the\_booking), |
| [6588](#L6588) | ), |
| [6589](#L6589) | 'is\_allow\_navigate' => 0, |
| [6590](#L6590) | 'is\_display\_step' => 1, |
| [6591](#L6591) | 'is\_navigate\_to\_next' => false, |
| [6592](#L6592) | 'sorting\_key' => 'datetime\_selection', |
| [6593](#L6593) | ), |
| [6594](#L6594) | 'basic\_details' => array( |
| [6595](#L6595) | 'tab\_name' => $bookingpress\_basic\_details\_tab\_name, |
| [6596](#L6596) | 'tab\_value' => 'basic\_details', |
| [6597](#L6597) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><g><rect fill="none" height="24" width="24"/><path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M13,17H8c-0.55,0-1-0.45-1-1 c0-0.55,0.45-1,1-1h5c0.55,0,1,0.45,1,1C14,16.55,13.55,17,13,17z M16,13H8c-0.55,0-1-0.45-1-1c0-0.55,0.45-1,1-1h8 c0.55,0,1,0.45,1,1C17,12.55,16.55,13,16,13z M16,9H8C7.45,9,7,8.55,7,8c0-0.55,0.45-1,1-1h8c0.55,0,1,0.45,1,1 C17,8.55,16.55,9,16,9z"/></g></svg>', |
| [6598](#L6598) | 'auto\_focus\_tab\_callback' => array(), |
| [6599](#L6599) | 'next\_tab\_name' => 'summary', |
| [6600](#L6600) | 'previous\_tab\_name' => 'datetime', |
| [6601](#L6601) | 'validate\_fields' => array(), |
| [6602](#L6602) | 'is\_allow\_navigate' => 0, |
| [6603](#L6603) | 'is\_display\_step' => 1, |
| [6604](#L6604) | 'is\_navigate\_to\_next' => false, |
| [6605](#L6605) | 'sorting\_key' => 'basic\_details\_selection', |
| [6606](#L6606) | ), |
| [6607](#L6607) | 'summary' => array( |
| [6608](#L6608) | 'tab\_name' => $bookingpress\_summary\_tab\_name, |
| [6609](#L6609) | 'tab\_value' => 'summary', |
| [6610](#L6610) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9.29 16.29L6.7 13.7c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0L10 14.17l5.88-5.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-6.59 6.59c-.38.39-1.02.39-1.41 0z"/></svg>', |
| [6611](#L6611) | 'next\_tab\_name' => 'summary', |
| [6612](#L6612) | 'auto\_focus\_tab\_callback' => array(), |
| [6613](#L6613) | 'previous\_tab\_name' => 'basic\_details', |
| [6614](#L6614) | 'validate\_fields' => array(), |
| [6615](#L6615) | 'is\_allow\_navigate' => 0, |
| [6616](#L6616) | 'is\_display\_step' => 1, |
| [6617](#L6617) | 'is\_navigate\_to\_next' => false, |
| [6618](#L6618) | 'sorting\_key' => 'summary\_selection', |
| [6619](#L6619) | ), |
| [6620](#L6620) | ); |
| [6621](#L6621) |  |
| [6622](#L6622) |  |
| [6623](#L6623) | if($bookingpress\_hide\_category\_service\_selection == 'true'){ |
| [6624](#L6624) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [6625](#L6625) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [6626](#L6626) | $bookingpress\_sidebar\_steps\_data['service']['is\_display\_step'] = 0; |
| [6627](#L6627) | } else { |
| [6628](#L6628) | /\*\* remove service step when pro version is lower than 1.5 \*/ |
| [6629](#L6629) | unset( $bookingpress\_sidebar\_steps\_data['service'] ); |
| [6630](#L6630) | } |
| [6631](#L6631) | } else { |
| [6632](#L6632) | $bookingpress\_sidebar\_steps\_data['service']['is\_display\_step'] = 0; |
| [6633](#L6633) | } |
| [6634](#L6634) | } |
| [6635](#L6635) |  |
| [6636](#L6636) | /\*\* compatibility change for pro version lower than 1.7 \*/ |
| [6637](#L6637) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [6638](#L6638) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.7', '<' ) ){ |
| [6639](#L6639) | $bookingpress\_sidebar\_steps\_data['service']['tab\_icon'] = 'dns'; |
| [6640](#L6640) | $bookingpress\_sidebar\_steps\_data['datetime']['tab\_icon'] = 'date\_range'; |
| [6641](#L6641) | $bookingpress\_sidebar\_steps\_data['basic\_details']['tab\_icon'] = 'article'; |
| [6642](#L6642) | $bookingpress\_sidebar\_steps\_data['summary']['tab\_icon'] = 'assignment\_turned\_in'; |
| [6643](#L6643) | } |
| [6644](#L6644) | } |
| [6645](#L6645) | /\*\* compatibility change for pro version lower than 1.7 \*/ |
| [6646](#L6646) |  |
| [6647](#L6647) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_sidebar\_step\_data'] = $bookingpress\_sidebar\_steps\_data; |
| [6648](#L6648) | $bookingpress\_front\_vue\_data\_fields['isLoadClass'] = 1; |
| [6649](#L6649) |  |
| [6650](#L6650) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_external\_html'] = ''; |
| [6651](#L6651) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_is\_display\_external\_html'] = true; |
| [6652](#L6652) |  |
| [6653](#L6653) | $bookingpress\_decimal\_points = $BookingPress->bookingpress\_get\_settings('price\_number\_of\_decimals', 'payment\_setting'); |
| [6654](#L6654) | $bookingpress\_decimal\_points = intval($bookingpress\_decimal\_points); |
| [6655](#L6655) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_decimal\_points'] = $bookingpress\_decimal\_points; |
| [6656](#L6656) |  |
| [6657](#L6657) | $bookingpress\_currency\_separator = $BookingPress->bookingpress\_get\_settings('price\_separator', 'payment\_setting'); |
| [6658](#L6658) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_separator'] = $bookingpress\_currency\_separator; |
| [6659](#L6659) |  |
| [6660](#L6660) | $bookingpress\_currency\_name = $BookingPress->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [6661](#L6661) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_name'] = $bookingpress\_currency\_name; |
| [6662](#L6662) |  |
| [6663](#L6663) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_symbol'] = $BookingPress->bookingpress\_get\_currency\_symbol($bookingpress\_currency\_name); |
| [6664](#L6664) |  |
| [6665](#L6665) | $bookingpress\_price\_symbol\_position = $BookingPress->bookingpress\_get\_settings('price\_symbol\_position', 'payment\_setting'); |
| [6666](#L6666) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_symbol\_position'] = $bookingpress\_price\_symbol\_position; |
| [6667](#L6667) |  |
| [6668](#L6668) | $bookingpress\_custom\_comma\_separator = $BookingPress->bookingpress\_get\_settings('custom\_comma\_separator', 'payment\_setting'); |
| [6669](#L6669) | $bookingpress\_custom\_thousand\_separator = $BookingPress->bookingpress\_get\_settings('custom\_dot\_separator', 'payment\_setting'); |
| [6670](#L6670) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_custom\_comma\_separator'] = $bookingpress\_custom\_comma\_separator; |
| [6671](#L6671) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_custom\_thousand\_separator'] = $bookingpress\_custom\_thousand\_separator; |
| [6672](#L6672) |  |
| [6673](#L6673) | $selected\_service = !empty( $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service'] ) ? $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service'] : ''; |
| [6674](#L6674) | $default\_selected\_category = !empty( $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] ) ? $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] : ''; |
| [6675](#L6675) |  |
| [6676](#L6676) | if( !empty( $selected\_service ) ){ |
| [6677](#L6677) | $selected\_services\_data = $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data'][ $selected\_service ]; |
| [6678](#L6678) |  |
| [6679](#L6679) | $selected\_service\_category = $selected\_services\_data['bookingpress\_category\_id']; |
| [6680](#L6680) |  |
| [6681](#L6681) | if( $selected\_service\_category != $default\_selected\_category ){ |
| [6682](#L6682) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $selected\_service\_category; |
| [6683](#L6683) | } |
| [6684](#L6684) | } |
| [6685](#L6685) |  |
| [6686](#L6686) | $bookingpress\_default\_select\_all\_category = $BookingPress->bookingpress\_get\_customize\_settings('default\_select\_all\_category','booking\_form'); |
| [6687](#L6687) | if(!empty($bookingpress\_default\_select\_all\_category ) && $bookingpress\_default\_select\_all\_category == 'true') { |
| [6688](#L6688) | $hide\_category\_service\_selection = $BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection','booking\_form'); |
| [6689](#L6689) | if($hide\_category\_service\_selection != 'true') { |
| [6690](#L6690) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'])){ |
| [6691](#L6691) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = 0; |
| [6692](#L6692) | } |
| [6693](#L6693) | } |
| [6694](#L6694) | } |
| [6695](#L6695) |  |
| [6696](#L6696) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_selected\_date\_range'] = array(); |
| [6697](#L6697) |  |
| [6698](#L6698) | $bookingpress\_front\_vue\_data\_fields['vue\_tel\_mode'] = 'international'; |
| [6699](#L6699) | $bookingpress\_front\_vue\_data\_fields['vue\_tel\_auto\_format'] = true; |
| [6700](#L6700) |  |
| [6701](#L6701) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['bookingpress\_form\_token'] = ''; |
| [6702](#L6702) |  |
| [6703](#L6703) | $bookingpress\_front\_vue\_data\_fields['show\_paypal\_popup\_button'] = "false"; |
| [6704](#L6704) | $bookingpress\_front\_vue\_data\_fields['paypal\_button\_loader'] = "false"; |
| [6705](#L6705) | $bookingpress\_front\_vue\_data\_fields['paypal\_success\_url'] = ""; |
| [6706](#L6706) | $bookingpress\_front\_vue\_data\_fields['paypal\_cancel\_url'] = ""; |
| [6707](#L6707) | $bookingpress\_front\_vue\_data\_fields['paypal\_booking\_form\_redirection\_mode'] = ""; |
| [6708](#L6708) |  |
| [6709](#L6709) | $bookingpress\_front\_vue\_data\_fields = apply\_filters('bookingpress\_frontend\_apointment\_form\_add\_dynamic\_data', $bookingpress\_front\_vue\_data\_fields); |
| [6710](#L6710) |  |
| [6711](#L6711) | $bookingpress\_dynamic\_data\_fields = wp\_json\_encode($bookingpress\_front\_vue\_data\_fields); |
| [6712](#L6712) | return $bookingpress\_dynamic\_data\_fields; |
| [6713](#L6713) | } |
| [6714](#L6714) |  |
| [6715](#L6715) | /\*\* |
| [6716](#L6716) | \* Callback function for [bookingpress\_appointment\_calendar\_integration] shortcode |
| [6717](#L6717) | \* |
| [6718](#L6718) | \* @param  mixed $atts |
| [6719](#L6719) | \* @param  mixed $content |
| [6720](#L6720) | \* @param  mixed $tag |
| [6721](#L6721) | \* @return void |
| [6722](#L6722) | \*/ |
| [6723](#L6723) | function bookingpress\_booking\_calendar\_options($atts, $content, $tag) { |
| [6724](#L6724) | global $wpdb, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [6725](#L6725) | $defaults = array( |
| [6726](#L6726) | 'gateways'  => 'google,yahoo,outlook,ical', |
| [6727](#L6727) | 'gateways\_label' => '', |
| [6728](#L6728) | 'button\_spacing' => '12' |
| [6729](#L6729) | ); |
| [6730](#L6730) | $args = shortcode\_atts($defaults, $atts, $tag); |
| [6731](#L6731) | extract($args); |
| [6732](#L6732) | $bookingpress\_calendar\_list = array(); |
| [6733](#L6733) | $bookingpress\_default\_arr = array('google' => esc\_html\_\_('Google Calendar','bookingpress-appointment-booking'), |
| [6734](#L6734) | 'yahoo'=> esc\_html\_\_('Yahoo Calendar','bookingpress-appointment-booking'), |
| [6735](#L6735) | 'outlook'=>  esc\_html\_\_('Outlook Calendar','bookingpress-appointment-booking'), |
| [6736](#L6736) | 'ical'=>  esc\_html\_\_('iCal Calendar','bookingpress-appointment-booking'), |
| [6737](#L6737) | ); |
| [6738](#L6738) | $bookingpress\_default\_arr2 = array('google' => 'google\_calendar' , |
| [6739](#L6739) | 'yahoo'=> 'yahoo\_calendar' , |
| [6740](#L6740) | 'outlook'=> 'outlook\_calendar', |
| [6741](#L6741) | 'ical'=> 'ical\_calendar', |
| [6742](#L6742) | ); |
| [6743](#L6743) | if(!empty($gateways)) { |
| [6744](#L6744) | $gateways = explode(',',$gateways); |
| [6745](#L6745) | $gateways\_label = explode(',',$gateways\_label); |
| [6746](#L6746) | foreach($gateways as $key => $value ) { |
| [6747](#L6747) | if(array\_key\_exists($value,$bookingpress\_default\_arr) ) { |
| [6748](#L6748) | $label\_value =!empty($gateways\_label[$key]) ? sanitize\_text\_field($gateways\_label[$key]) : $bookingpress\_default\_arr[$value]; |
| [6749](#L6749) | if(!empty($label\_value)) { |
| [6750](#L6750) | $bookingpress\_calendar\_list[] = array( |
| [6751](#L6751) | 'value' => $bookingpress\_default\_arr2[$value], |
| [6752](#L6752) | 'name' => $label\_value, |
| [6753](#L6753) | ); |
| [6754](#L6754) | } |
| [6755](#L6755) | } |
| [6756](#L6756) | } |
| [6757](#L6757) | } |
| [6758](#L6758) | $this->bookingpress\_calendar\_list = wp\_json\_encode($bookingpress\_calendar\_list); |
| [6759](#L6759) |  |
| [6760](#L6760) | global $BookingPress; |
| [6761](#L6761) | $BookingPress->set\_front\_css( 1 ); |
| [6762](#L6762) | $BookingPress->set\_front\_js( 1 ); |
| [6763](#L6763) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [6764](#L6764) |  |
| [6765](#L6765) | $bookingpress\_is\_render\_calendar = 1; |
| [6766](#L6766) | $bookingpress\_calendar\_html = ""; |
| [6767](#L6767) |  |
| [6768](#L6768) | $appointment\_id = 0; |
| [6769](#L6769) | if(!empty($\_GET['appointment\_id'])){ |
| [6770](#L6770) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [6771](#L6771) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [6772](#L6772) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [6773](#L6773) | $appointment\_id = base64\_decode(sanitize\_text\_field($\_GET['appointment\_id'])); |
| [6774](#L6774) | if(!$bookingpress\_nonce\_verification){ |
| [6775](#L6775) | $bookingpress\_is\_render\_calendar = 0; |
| [6776](#L6776) | } |
| [6777](#L6777) | } |
| [6778](#L6778) |  |
| [6779](#L6779) | $bpa\_calendar\_details = $this->bookingpress\_get\_appointment\_details\_for\_calendar\_func($appointment\_id,true); |
| [6780](#L6780) |  |
| [6781](#L6781) | $bpa\_google\_data = $bpa\_calendar\_details['google\_calendar\_link']; |
| [6782](#L6782) | $bpa\_yahoo\_data =  $bpa\_calendar\_details['yahoo\_calendar\_link']; |
| [6783](#L6783) |  |
| [6784](#L6784) | $bpa\_google\_link = "https://www.google.com/calendar/render?action=TEMPLATE&text=$bpa\_google\_data"; |
| [6785](#L6785) | $bpa\_yahoo\_link = "http://calendar.yahoo.com/?v=60&view=d&type=20&title=$bpa\_yahoo\_data"; |
| [6786](#L6786) |  |
| [6787](#L6787) | $this->bookingpress\_google\_calendar\_link = $bpa\_google\_link; |
| [6788](#L6788) | $this->bookingpress\_yahoo\_calendar\_link = $bpa\_yahoo\_link; |
| [6789](#L6789) |  |
| [6790](#L6790) | if($bookingpress\_is\_render\_calendar){ |
| [6791](#L6791) | $bookingpress\_calendar\_html = '<div id="bpa-front-module-calendar-integration">'; |
| [6792](#L6792) | $bookingpress\_calendar\_html     .= '<div class="bpa-front-module--atc-wrapper">'; |
| [6793](#L6793) | $bookingpress\_calendar\_html .= ' |
| [6794](#L6794) | <div v-for="item in bookingpress\_calendar\_list" :class="\'bpa-front-module--atc\_\_item bpa-fm--atc\_\_\'+item.value" style="margin:0px '.$button\_spacing.'px '.$button\_spacing.'px 0px"> |
| [6795](#L6795) | <el-button class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width" id="bookingpress\_ical\_calendar" v-if="item.value == \'ical\_calendar\'"> |
| [6796](#L6796) | <span class="bpa-thank-you-add-cal"> |
| [6797](#L6797) | <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6798](#L6798) | <g clip-path="url(#clip0\_1235\_2762)"> |
| [6799](#L6799) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.21165 1.39313C8.26508 0.00788564 9.72934 0 9.72934 0C9.72934 0 9.94793 1.30376 8.89977 2.55758C7.78313 3.89814 6.51375 3.67734 6.51375 3.67734C6.51375 3.67734 6.2741 2.6233 7.21165 1.39313Z" fill="black"/> |
| [6800](#L6800) | <path fill-rule="evenodd" clip-rule="evenodd" d="M6.64714 4.59251C7.18965 4.59251 8.19568 3.84863 9.50456 3.84863C11.7589 3.84863 12.6438 5.44942 12.6438 5.44942C12.6438 5.44942 10.9109 6.33524 10.9109 8.48014C10.9109 10.901 13.0704 11.7369 13.0704 11.7369C13.0704 11.7369 11.5614 15.9794 9.52037 15.9794C8.58281 15.9794 7.85595 15.3486 6.86836 15.3486C5.86233 15.3486 4.86421 16.0031 4.21372 16.0031C2.35178 16.0004 0 11.9787 0 8.743C0 5.55982 1.99098 3.89069 3.85818 3.89069C5.07226 3.89332 6.01508 4.59251 6.64714 4.59251Z" fill="black"/> |
| [6801](#L6801) | </g> |
| [6802](#L6802) | <defs> |
| [6803](#L6803) | <clipPath id="clip0\_1235\_2762"> |
| [6804](#L6804) | <rect width="13.0704" height="16" fill="white"/> |
| [6805](#L6805) | </clipPath> |
| [6806](#L6806) | </defs> |
| [6807](#L6807) | </svg> |
| [6808](#L6808) | </span> |
| [6809](#L6809) | {{ item.name}} |
| [6810](#L6810) | </el-button> |
| [6811](#L6811) | <el-link :href="bookingpress\_google\_calendar\_link" target="\_blank" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width bpa-front-link--no-underline" id="bookingpress\_google\_calendar" v-if="item.value == \'google\_calendar\'"> |
| [6812](#L6812) | <span class="bpa-thank-you-add-cal"> |
| [6813](#L6813) | <svg width="16" class="bookingpress\_google\_calendar\_svg" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6814](#L6814) | <path fill-rule="evenodd" clip-rule="evenodd" d="M15.6444 8.17812C15.6444 7.64479 15.5556 7.02257 15.4667 6.57812H8V9.68924H12.2667C12.0889 10.667 11.5556 11.467 10.6667 12.0892V14.1337H13.3333C14.8444 12.7115 15.6444 10.5781 15.6444 8.17812Z" fill="#4285F4"/> |
| [6815](#L6815) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99978 15.9996C10.1331 15.9996 11.9998 15.2885 13.3331 14.0441L10.6664 12.0885C9.95534 12.5329 9.06645 12.8885 7.99978 12.8885C5.95534 12.8885 4.17756 11.4663 3.55534 9.59961H0.888672V11.5552C2.13312 14.2218 4.88867 15.9996 7.99978 15.9996Z" fill="#34A853"/> |
| [6816](#L6816) | <path fill-rule="evenodd" clip-rule="evenodd" d="M3.55556 9.511C3.37778 9.06656 3.28889 8.53322 3.28889 7.99989C3.28889 7.46656 3.37778 6.93322 3.55556 6.48878V4.44434H0.888889C0.355556 5.511 0 6.75545 0 7.99989C0 9.24434 0.266667 10.4888 0.888889 11.5554L3.55556 9.511Z" fill="#FBBC05"/> |
| [6817](#L6817) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99978 3.2C9.15534 3.2 10.222 3.64444 11.022 4.35556L13.3331 2.04444C11.9998 0.8 10.1331 0 7.99978 0C4.88867 0 2.13312 1.77778 0.888672 4.44444L3.55534 6.48889C4.17756 4.62222 5.95534 3.2 7.99978 3.2Z" fill="#EA4335"/> |
| [6818](#L6818) | </svg> |
| [6819](#L6819) | </span> |
| [6820](#L6820) | {{ item.name}} |
| [6821](#L6821) | </el-link> |
| [6822](#L6822) | <el-button class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width" id="bookingpress\_outlook\_calendar" v-if="item.value ==  \'outlook\_calendar\'"> |
| [6823](#L6823) | <span class="bpa-thank-you-add-cal"> |
| [6824](#L6824) | <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6825](#L6825) | <g clip-path="url(#clip0\_1235\_2768)"> |
| [6826](#L6826) | <path d="M7.57897 0H0V7.57897H7.57897V0Z" fill="#F25022"/> |
| [6827](#L6827) | <path d="M7.57897 8.4209H0V15.9999H7.57897V8.4209Z" fill="#00A4EF"/> |
| [6828](#L6828) | <path d="M16.0008 0H8.42188V7.57897H16.0008V0Z" fill="#7FBA00"/> |
| [6829](#L6829) | <path d="M16.0008 8.4209H8.42188V15.9999H16.0008V8.4209Z" fill="#FFB900"/> |
| [6830](#L6830) | </g> |
| [6831](#L6831) | <defs> |
| [6832](#L6832) | <clipPath id="clip0\_1235\_2768"> |
| [6833](#L6833) | <rect width="16" height="16" fill="white"/> |
| [6834](#L6834) | </clipPath> |
| [6835](#L6835) | </defs> |
| [6836](#L6836) | </svg> |
| [6837](#L6837) | </span> |
| [6838](#L6838) | {{ item.name}} |
| [6839](#L6839) | </el-button> |
| [6840](#L6840) | <el-link :href="bookingpress\_yahoo\_calendar\_link" target="\_blank" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width bpa-front-link--no-underline" id="bookingpress\_yahoo\_calendar" v-if="item.value == |
| [6841](#L6841) | \'yahoo\_calendar\'"> |
| [6842](#L6842) | <span class="bpa-thank-you-add-cal"> |
| [6843](#L6843) | <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6844](#L6844) | <g clip-path="url(#clip0\_1235\_2766)"> |
| [6845](#L6845) | <path d="M0 3.89506H3.43247L5.43118 9.00836L7.45588 3.89506H10.7976L5.76558 16H2.40215L3.77968 12.7924L0.000106295 3.89506H0ZM14.6891 7.98076H10.9461L14.2682 0L17.9975 0.000159442L14.6891 7.98076V7.98076ZM11.9266 8.74459C13.075 8.74459 14.006 9.67558 14.006 10.8238C14.006 11.9721 13.075 12.9031 11.9266 12.9031C10.7783 12.9031 9.84751 11.9721 9.84751 10.8238C9.84751 9.67558 10.7784 8.74459 11.9266 8.74459Z" fill="#5F01D1"/> |
| [6846](#L6846) | </g> |
| [6847](#L6847) | <defs> |
| [6848](#L6848) | <clipPath id="clip0\_1235\_2766"> |
| [6849](#L6849) | <rect width="17.9975" height="16" fill="white"/> |
| [6850](#L6850) | </clipPath> |
| [6851](#L6851) | </defs> |
| [6852](#L6852) | </svg> |
| [6853](#L6853) | </span> |
| [6854](#L6854) | {{ item.name}} |
| [6855](#L6855) | </el-link> |
| [6856](#L6856) | </div>'; |
| [6857](#L6857) | $bookingpress\_calendar\_html             .= '</div>'; |
| [6858](#L6858) | $bookingpress\_calendar\_html .= '</div>'; |
| [6859](#L6859) |  |
| [6860](#L6860) | add\_action( |
| [6861](#L6861) | 'wp\_footer', |
| [6862](#L6862) | function() { |
| [6863](#L6863) | $appointment\_id = ( ! empty( $\_REQUEST['appointment\_id'] ) ? intval( base64\_decode( $\_REQUEST['appointment\_id'] ) ) : '' ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [6864](#L6864) | ?> |
| [6865](#L6865) | <script> |
| [6866](#L6866) | wp.hooks.addAction('bpa\_calendar\_js\_init' , 'bookingpress-appointment-booking-pro', bookingpress\_load\_calendar\_list, 10, 1 ); |
| [6867](#L6867) | function bookingpress\_load\_calendar\_list(bookingpress\_appointment\_id){ |
| [6868](#L6868) | var app = new Vue({ |
| [6869](#L6869) | el:'#bpa-front-module-calendar-integration', |
| [6870](#L6870) | data(){ |
| [6871](#L6871) | var bookingpress\_return\_data = {}; |
| [6872](#L6872) | bookingpress\_return\_data['bookingpress\_calendar\_list'] = <?php echo \_wp\_specialchars($this->bookingpress\_calendar\_list,ENT\_NOQUOTES,'UTF-8', true); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>; |
| [6873](#L6873) | bookingpress\_return\_data['bookingpress\_selected\_calendar'] = ''; |
| [6874](#L6874) | bookingpress\_return\_data['bookingpress\_appointment\_id'] = '<?php echo esc\_html($appointment\_id); ?>'; |
| [6875](#L6875) | bookingpress\_return\_data['bookingpress\_calendar\_link'] = ''; |
| [6876](#L6876) | bookingpress\_return\_data['bookingpress\_google\_calendar\_link'] = '<?php echo esc\_url\_raw($this->bookingpress\_google\_calendar\_link); ?>'; //phpcs:ignore |
| [6877](#L6877) | bookingpress\_return\_data['bookingpress\_yahoo\_calendar\_link'] = '<?php echo esc\_url\_raw($this->bookingpress\_yahoo\_calendar\_link); ?>'; //phpcs:ignore |
| [6878](#L6878) | return bookingpress\_return\_data; |
| [6879](#L6879) | }, |
| [6880](#L6880) | mounted(){ |
| [6881](#L6881) | const vm = this; |
| [6882](#L6882) | document.getElementById("bpa-front-module-calendar-integration").style.display = "block"; |
| [6883](#L6883) | document.getElementById("bookingpress\_ical\_calendar").addEventListener("click", function(e){ |
| [6884](#L6884) | let cal\_ics\_nonce = '<?php esc\_html\_e( wp\_create\_nonce( 'bookingpress\_calendar\_ics' ) );// phpcs:ignore ?>'; |
| [6885](#L6885) | if( null != document.getElementById('bpa\_ics\_nonce') ){ |
| [6886](#L6886) | cal\_ics\_nonce = document.getElementById('bpa\_ics\_nonce').value; |
| [6887](#L6887) | } |
| [6888](#L6888) | var bookingpress\_calendar\_link = "<?php echo esc\_url(BOOKINGPRESS\_HOME\_URL)."?bpa\_page=bookingpress\_download&action=generate\_ics&state=";?>" + cal\_ics\_nonce+ "<?php echo "&appointment\_id="; ?>"; |
| [6889](#L6889) | bookingpress\_calendar\_link = bookingpress\_calendar\_link + bookingpress\_appointment\_id; |
| [6890](#L6890) | bookingpress\_calendar\_link = wp.hooks.applyFilters( 'bookingpress\_change\_calendar\_url', bookingpress\_calendar\_link, 'ical', bookingpress\_appointment\_id ); |
| [6891](#L6891) | window.open(bookingpress\_calendar\_link, '\_self'); |
| [6892](#L6892) | }); |
| [6893](#L6893) | document.getElementById("bookingpress\_outlook\_calendar").addEventListener("click", function(e){ |
| [6894](#L6894) | let cal\_ics\_nonce = '<?php esc\_html\_e( wp\_create\_nonce( 'bookingpress\_calendar\_ics' ) );// phpcs:ignore ?>'; |
| [6895](#L6895) | if( null != document.getElementById('bpa\_ics\_nonce') ){ |
| [6896](#L6896) | cal\_ics\_nonce = document.getElementById('bpa\_ics\_nonce').value; |
| [6897](#L6897) | } |
| [6898](#L6898) | var bookingpress\_calendar\_link = "<?php echo esc\_url(BOOKINGPRESS\_HOME\_URL)."?bpa\_page=bookingpress\_download&action=generate\_ics&state=";?>" + cal\_ics\_nonce+ "<?php echo "&appointment\_id="; ?>"; |
| [6899](#L6899) | bookingpress\_calendar\_link = bookingpress\_calendar\_link + bookingpress\_appointment\_id; |
| [6900](#L6900) | bookingpress\_calendar\_link = wp.hooks.applyFilters( 'bookingpress\_change\_calendar\_url', bookingpress\_calendar\_link, 'outlook\_calendar', bookingpress\_appointment\_id ); |
| [6901](#L6901) | window.open(bookingpress\_calendar\_link, '\_self'); |
| [6902](#L6902) | }); |
| [6903](#L6903) | <?php do\_action( 'bookingpress\_calendar\_integration\_events' ); ?> |
| [6904](#L6904) | }, |
| [6905](#L6905) | }); |
| [6906](#L6906) | } |
| [6907](#L6907) |  |
| [6908](#L6908) | var bookingpress\_redirection\_mode = '<?php echo esc\_html(!empty($appointment\_id) ? 'external\_redirection' : 'in\_built'); ?>'; |
| [6909](#L6909) | if(bookingpress\_redirection\_mode == "external\_redirection"){ |
| [6910](#L6910) | var bookingpress\_appointment\_id = '<?php echo esc\_html($appointment\_id); ?>'; |
| [6911](#L6911) | wp.hooks.doAction("bpa\_calendar\_js\_init", bookingpress\_appointment\_id); |
| [6912](#L6912) | } |
| [6913](#L6913) | </script> |
| [6914](#L6914) | <?php |
| [6915](#L6915) | }, |
| [6916](#L6916) | 100 |
| [6917](#L6917) | ); |
| [6918](#L6918) | } |
| [6919](#L6919) |  |
| [6920](#L6920) | return $bookingpress\_calendar\_html; |
| [6921](#L6921) | } |
| [6922](#L6922) |  |
| [6923](#L6923) | /\*\* |
| [6924](#L6924) | \* Download ICS file from if it enable in email notification |
| [6925](#L6925) | \* |
| [6926](#L6926) | \* @return void |
| [6927](#L6927) | \*/ |
| [6928](#L6928) | function bookingpress\_download\_ics\_file() { |
| [6929](#L6929) |  |
| [6930](#L6930) | if ( ( ( !empty( $\_GET['page'] ) && 'bookingpress\_download' == $\_GET['page'] ) || ( !empty( $\_GET['bpa\_page'] ) && 'bookingpress\_download' == $\_GET['bpa\_page'] )) && ! empty( $\_GET['action'] ) && 'generate\_ics' == $\_GET['action'] ) { |
| [6931](#L6931) |  |
| [6932](#L6932) | $nonce = ! empty( $\_GET['state'] ) ? sanitize\_text\_field( $\_GET['state'] ) : ''; |
| [6933](#L6933) | if ( ! wp\_verify\_nonce( $nonce, 'bookingpress\_calendar\_ics' ) ) { |
| [6934](#L6934) | return false; |
| [6935](#L6935) | } |
| [6936](#L6936) |  |
| [6937](#L6937) | if ( empty( $\_GET['appointment\_id'] ) ) { |
| [6938](#L6938) | return false; |
| [6939](#L6939) | } |
| [6940](#L6940) |  |
| [6941](#L6941) | $appointment\_id = intval( $\_GET['appointment\_id'] ); |
| [6942](#L6942) |  |
| [6943](#L6943) | global $wpdb,$tbl\_bookingpress\_entries, $tbl\_bookingpress\_appointment\_bookings, $BookingPress, $bookingpress\_global\_options; |
| [6944](#L6944) | // $appointment\_id = base64\_decode( $\_REQUEST['appointment\_id'] ); |
| [6945](#L6945) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d", $appointment\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_entries is a table name. false alarm |
| [6946](#L6946) |  |
| [6947](#L6947) |  |
| [6948](#L6948) |  |
| [6949](#L6949) | if ( ! empty( $bookingpress\_entry\_details ) ) { |
| [6950](#L6950) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [6951](#L6951) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [6952](#L6952) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [6953](#L6953) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [6954](#L6954) |  |
| [6955](#L6955) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [6956](#L6956) |  |
| [6957](#L6957) | if ( ! empty( $appointment\_data ) ) { |
| [6958](#L6958) | $service\_id              = intval( $appointment\_data['bookingpress\_service\_id'] ); |
| [6959](#L6959) |  |
| [6960](#L6960) | $bookingpress\_start\_time = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_time'] ); |
| [6961](#L6961) | $bookingpress\_end\_time   = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_end\_time'] ); |
| [6962](#L6962) |  |
| [6963](#L6963) | $bookingpress\_appointment\_date\_temp = $appointment\_data['bookingpress\_appointment\_date']; |
| [6964](#L6964) | if ($bookingpress\_end\_time === '24:00:00') { |
| [6965](#L6965) | $bookingpress\_appointment\_date\_temp = date('Y-m-d', strtotime($appointment\_data['bookingpress\_appointment\_date'] . ' +1 day')); |
| [6966](#L6966) | $bookingpress\_end\_time = '00:00:00'; |
| [6967](#L6967) | } |
| [6968](#L6968) |  |
| [6969](#L6969) | $bookingpress\_start\_time = date( 'Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ) . 'T' . date( 'His', strtotime( $bookingpress\_start\_time ) ); |
| [6970](#L6970) |  |
| [6971](#L6971) | $bookingpress\_end\_time = date( 'Ymd', strtotime( $bookingpress\_appointment\_date\_temp ) ) . 'T' . date( 'His', strtotime( $bookingpress\_end\_time ) ); |
| [6972](#L6972) | $user\_timezone             = $bookingpress\_global\_options->bookingpress\_get\_site\_timezone\_offset(); |
| [6973](#L6973) | $bookingpress\_service\_name = ! empty( $appointment\_data['bookingpress\_service\_name'] ) ? sanitize\_text\_field( $appointment\_data['bookingpress\_service\_name'] ) : ''; |
| [6974](#L6974) | } |
| [6975](#L6975) | $booking\_stime = $this->bookingpress\_convert\_date\_time\_to\_utc( $appointment\_data['bookingpress\_appointment\_date'], $bookingpress\_start\_time ); |
| [6976](#L6976) | $booking\_etime = $this->bookingpress\_convert\_date\_time\_to\_utc( $bookingpress\_appointment\_date\_temp, $bookingpress\_end\_time ); |
| [6977](#L6977) | $current\_dtime = $this->bookingpress\_convert\_date\_time\_to\_utc( date( 'm/d/Y' ), 'g:i A' ); |
| [6978](#L6978) |  |
| [6979](#L6979) | $string  = "BEGIN:VCALENDAR\r\n"; |
| [6980](#L6980) | $string .= "VERSION:2.0\r\n"; |
| [6981](#L6981) | $string .= 'PRODID:BOOKINGPRESS APPOINTMENT BOOKING\\\\' . get\_bloginfo('title') . "\r\n"; |
| [6982](#L6982) | $string .= "X-PUBLISHED-TTL:P1W\r\n"; |
| [6983](#L6983) | $string .= "BEGIN:VEVENT\r\n"; |
| [6984](#L6984) | $string .= 'UID:' . md5( time() ) . "\r\n"; |
| [6985](#L6985) | $string .= 'DTSTART:' . $booking\_stime . "\r\n"; |
| [6986](#L6986) | $string .= "SEQUENCE:0\r\n"; |
| [6987](#L6987) | $string .= "TRANSP:OPAQUE\r\n"; |
| [6988](#L6988) | $string .= "DTEND:{$booking\_etime}\r\n"; |
| [6989](#L6989) | $string .= "SUMMARY:{$bookingpress\_service\_name}\r\n"; |
| [6990](#L6990) | $string .= "CLASS:PUBLIC\r\n"; |
| [6991](#L6991) | $string .= "DTSTAMP:{$current\_dtime}\r\n"; |
| [6992](#L6992) | $string .= "END:VEVENT\r\n"; |
| [6993](#L6993) | $string .= "END:VCALENDAR\r\n"; |
| [6994](#L6994) |  |
| [6995](#L6995) | $string  = apply\_filters( 'bpa\_add\_timezone\_parameters\_for\_ics', $string, $appointment\_data ); |
| [6996](#L6996) |  |
| [6997](#L6997) | header( 'Content-Type: text/calendar; charset=utf-8' ); |
| [6998](#L6998) | header( 'Content-Disposition: attachment; filename="cal.ics"' ); |
| [6999](#L6999) |  |
| [7000](#L7000) |  |
| [7001](#L7001) | echo $string; //phpcs:ignore |
| [7002](#L7002) | } |
| [7003](#L7003) |  |
| [7004](#L7004) | die; |
| [7005](#L7005) |  |
| [7006](#L7006) | } |
| [7007](#L7007) | } |
| [7008](#L7008) |  |
| [7009](#L7009) | /\*\* |
| [7010](#L7010) | \* Convert Date and Time to UTC format |
| [7011](#L7011) | \* |
| [7012](#L7012) | \* @param  mixed $date      Convert date |
| [7013](#L7013) | \* @param  mixed $time      Convert time |
| [7014](#L7014) | \* @param  mixed $formated  Formatted date time should be return |
| [7015](#L7015) | \* @return void |
| [7016](#L7016) | \*/ |
| [7017](#L7017) | function bookingpress\_convert\_date\_time\_to\_utc( $date, $time, $formated = false ) { |
| [7018](#L7018) |  |
| [7019](#L7019) | if ( empty( $date ) ) { |
| [7020](#L7020) | $date = date( 'm/d/Y' ); |
| [7021](#L7021) | } |
| [7022](#L7022) |  |
| [7023](#L7023) | if ( empty( $time ) ) { |
| [7024](#L7024) | $time = date( 'g:i A' ); |
| [7025](#L7025) | } |
| [7026](#L7026) |  |
| [7027](#L7027) | $bookingpress\_time = date( 'm/d/Y', strtotime( $date ) ) . ' ' . date( 'g:i A', strtotime( $time ) ); |
| [7028](#L7028) |  |
| [7029](#L7029) | $tz\_from = wp\_timezone\_string(); |
| [7030](#L7030) | $tz\_to   = 'UTC'; |
| [7031](#L7031) | if ( $formated ) { |
| [7032](#L7032) | $format = 'Y-m-d\TH:i:s\Z'; |
| [7033](#L7033) | } else { |
| [7034](#L7034) | $format = 'Ymd\THis\Z'; |
| [7035](#L7035) | } |
| [7036](#L7036) |  |
| [7037](#L7037) | $start\_dt = new DateTime( $bookingpress\_time, new DateTimeZone( $tz\_from ) ); |
| [7038](#L7038) | $start\_dt->setTimeZone( new DateTimeZone( $tz\_to ) ); |
| [7039](#L7039) | $bookingpress\_time = $start\_dt->format( $format ); |
| [7040](#L7040) |  |
| [7041](#L7041) | return $bookingpress\_time; |
| [7042](#L7042) |  |
| [7043](#L7043) | } |
| [7044](#L7044) |  |
| [7045](#L7045) | /\*\* |
| [7046](#L7046) | \* Helper variables for Booking Form Shortcode |
| [7047](#L7047) | \* |
| [7048](#L7048) | \* @param  mixed $bookingpress\_front\_booking\_dynamic\_helper\_vars |
| [7049](#L7049) | \* @return void |
| [7050](#L7050) | \*/ |
| [7051](#L7051) | function bookingpress\_booking\_dynamic\_helper\_vars\_func( $bookingpress\_front\_booking\_dynamic\_helper\_vars ) |
| [7052](#L7052) | { |
| [7053](#L7053) | global $bookingpress\_global\_options; |
| [7054](#L7054) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [7055](#L7055) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [7056](#L7056) |  |
| [7057](#L7057) | $bookingpress\_front\_booking\_dynamic\_helper\_vars .= 'var lang = ELEMENT.lang.' . $bookingpress\_locale\_lang . ';'; |
| [7058](#L7058) | $bookingpress\_front\_booking\_dynamic\_helper\_vars .= 'ELEMENT.locale(lang);'; |
| [7059](#L7059) |  |
| [7060](#L7060) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = apply\_filters('bookingpress\_add\_frontbooking\_dynamic\_helper\_vars', $bookingpress\_front\_booking\_dynamic\_helper\_vars); |
| [7061](#L7061) |  |
| [7062](#L7062) | return $bookingpress\_front\_booking\_dynamic\_helper\_vars; |
| [7063](#L7063) | } |
| [7064](#L7064) |  |
| [7065](#L7065) |  |
| [7066](#L7066) | /\*\* |
| [7067](#L7067) | \* Booking Form Shortcode onload methods |
| [7068](#L7068) | \* |
| [7069](#L7069) | \* @param  mixed $bookingpress\_dynamic\_on\_load\_methods\_data |
| [7070](#L7070) | \* @return void |
| [7071](#L7071) | \*/ |
| [7072](#L7072) | function bookingpress\_booking\_dynamic\_on\_load\_methods\_func( $bookingpress\_dynamic\_on\_load\_methods\_data ) |
| [7073](#L7073) | { |
| [7074](#L7074) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.bookingpress\_onload\_func();'; |
| [7075](#L7075) |  |
| [7076](#L7076) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.appointment\_step\_form\_data.bookingpress\_customer\_timezone = new Date().getTimezoneOffset();'; |
| [7077](#L7077) |  |
| [7078](#L7078) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'if(this.hide\_category\_service == "1" || this.is\_service\_loaded\_from\_url == "1"){ |
| [7079](#L7079) | this.bookingpress\_current\_tab = "datetime"; |
| [7080](#L7080) | }'; |
| [7081](#L7081) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [7082](#L7082) |  |
| [7083](#L7083) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7084](#L7084) | } |
| [7085](#L7085) |  |
| [7086](#L7086) | /\*\* |
| [7087](#L7087) | \* Booking Form Shortcode onload methods |
| [7088](#L7088) | \* |
| [7089](#L7089) | \* @param  mixed $bookingpress\_dynamic\_on\_load\_methods\_data |
| [7090](#L7090) | \* @return void |
| [7091](#L7091) | \*/ |
| [7092](#L7092) | function bookingpress\_booking\_dynamic\_on\_load\_methods\_func\_with\_pro( $bookingpress\_dynamic\_on\_load\_methods\_data ){ |
| [7093](#L7093) |  |
| [7094](#L7094) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.bookingpress\_onload\_func();'; |
| [7095](#L7095) |  |
| [7096](#L7096) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.appointment\_step\_form\_data.bookingpress\_customer\_timezone = new Date().getTimezoneOffset();'; |
| [7097](#L7097) |  |
| [7098](#L7098) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [7099](#L7099) |  |
| [7100](#L7100) | $bookingpress\_is\_guest\_load\_from\_share\_url = !empty($\_GET['g\_id']) ? 1 : 0; |
| [7101](#L7101) | $bookingpress\_selected\_guest\_from\_url = !empty($\_GET['g\_id']) ? intval($\_GET['g\_id']) : 0; |
| [7102](#L7102) |  |
| [7103](#L7103) | $bookingpress\_dynamic\_on\_load\_methods\_data .= ' |
| [7104](#L7104) |  |
| [7105](#L7105) | var bookingpress\_guests\_load\_from\_share\_url = "'.$bookingpress\_is\_guest\_load\_from\_share\_url.'"; |
| [7106](#L7106) | var bookingpress\_selected\_guest\_from\_url = "'.$bookingpress\_selected\_guest\_from\_url.'"; |
| [7107](#L7107) |  |
| [7108](#L7108) | let current\_tab = this.bookingpress\_current\_tab; |
| [7109](#L7109) | let step\_data = this.bookingpress\_sidebar\_step\_data[ current\_tab ]; |
| [7110](#L7110) |  |
| [7111](#L7111) | if( this.hide\_category\_service == "1" || this.is\_service\_loaded\_from\_url == "1" ){ |
| [7112](#L7112) |  |
| [7113](#L7113) | let next\_tab = this.bookingpress\_sidebar\_step\_data["service"].next\_tab\_name; |
| [7114](#L7114) | let bookingpress\_selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [7115](#L7115) | let bookingpress\_selected\_service\_name = vm.appointment\_step\_form\_data.selected\_service\_name; |
| [7116](#L7116) | let bookingpress\_selected\_service\_price = vm.appointment\_step\_form\_data.selected\_service\_price; |
| [7117](#L7117) | let bookingpress\_selected\_service\_price\_without\_currency = vm.appointment\_step\_form\_data.service\_price\_without\_currency; |
| [7118](#L7118) |  |
| [7119](#L7119) | let useFlag = "false"; |
| [7120](#L7120) | if( "undefined" != typeof vm.is\_bring\_anyone\_with\_you\_activated && 1 == vm.is\_bring\_anyone\_with\_you\_activated && bookingpress\_guests\_load\_from\_share\_url == "1" && bookingpress\_selected\_guest\_from\_url != "" ){ |
| [7121](#L7121) | /\*\* Do Nothing as selectDate function has already been called before \*/ |
| [7122](#L7122) | } else { |
| [7123](#L7123) | vm.selectDate( bookingpress\_selected\_service\_id, bookingpress\_selected\_service\_name, bookingpress\_selected\_service\_price, bookingpress\_selected\_service\_price\_without\_currency, useFlag ); |
| [7124](#L7124) | } |
| [7125](#L7125) | } else { |
| [7126](#L7126) | if( "undefined" != typeof step\_data.is\_navigate\_to\_next && true == step\_data.is\_navigate\_to\_next ){ |
| [7127](#L7127) | this.bookingpress\_current\_tab = step\_data.next\_tab\_name; |
| [7128](#L7128) | } |
| [7129](#L7129) | } |
| [7130](#L7130) | '; |
| [7131](#L7131) | /\*'if((this.is\_staffmember\_activated == 1 && typeof this.appointment\_step\_form\_data.hide\_staff\_selection !== "undefined" && this.appointment\_step\_form\_data.hide\_staff\_selection == "false" && this.hide\_category\_service == "1" && this.is\_service\_loaded\_from\_url != "1" )) { |
| [7132](#L7132) | this.bookingpress\_current\_tab = "staffmembers"; |
| [7133](#L7133) | }'; \*/ |
| [7134](#L7134) |  |
| [7135](#L7135) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7136](#L7136) | } |
| [7137](#L7137) |  |
| [7138](#L7138) | function bookingpress\_call\_autofocus\_method( $bookingpress\_dynamic\_on\_load\_methods\_data ){ |
| [7139](#L7139) |  |
| [7140](#L7140) | $bookingpress\_dynamic\_on\_load\_methods\_data .= ' |
| [7141](#L7141) | let bpa\_current\_tab = this.bookingpress\_current\_tab; |
| [7142](#L7142) |  |
| [7143](#L7143) | let bpa\_side\_bar\_step\_data = this.bookingpress\_sidebar\_step\_data[bpa\_current\_tab]; |
| [7144](#L7144) | let bpa\_callback\_funcs = bpa\_side\_bar\_step\_data.auto\_focus\_tab\_callback; |
| [7145](#L7145) |  |
| [7146](#L7146) | for( let callback in bpa\_callback\_funcs ){ |
| [7147](#L7147) | let args = bpa\_callback\_funcs[callback]; |
| [7148](#L7148) |  |
| [7149](#L7149) | this[callback].apply( callback, args ); |
| [7150](#L7150) | } |
| [7151](#L7151) |  |
| [7152](#L7152) | '; |
| [7153](#L7153) |  |
| [7154](#L7154) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7155](#L7155) | } |
| [7156](#L7156) |  |
| [7157](#L7157) | /\*\* |
| [7158](#L7158) | \* Booking Form Shortcode methods or functions |
| [7159](#L7159) | \* |
| [7160](#L7160) | \* @param  mixed $bookingpress\_vue\_methods\_data |
| [7161](#L7161) | \* @return void |
| [7162](#L7162) | \*/ |
| [7163](#L7163) | function bookingpress\_booking\_dynamic\_vue\_methods\_func( $bookingpress\_vue\_methods\_data ) |
| [7164](#L7164) | { |
| [7165](#L7165) | global $BookingPress, $bookingpress\_global\_options; |
| [7166](#L7166) |  |
| [7167](#L7167) | $bookingpress\_current\_date                    = date('Y-m-d', current\_time('timestamp')); |
| [7168](#L7168) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [7169](#L7169) | $no\_service\_selected\_for\_the\_booking          = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [7170](#L7170) |  |
| [7171](#L7171) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [7172](#L7172) |  |
| [7173](#L7173) | $bookingpress\_current\_user\_id = get\_current\_user\_id(); |
| [7174](#L7174) |  |
| [7175](#L7175) | $bookingpress\_before\_book\_appointment\_data = ''; |
| [7176](#L7176) | $bookingpress\_before\_book\_appointment\_data = apply\_filters('bookingpress\_before\_book\_appointment', $bookingpress\_before\_book\_appointment\_data); |
| [7177](#L7177) |  |
| [7178](#L7178) | $bookingpress\_before\_selecting\_booking\_service\_data = ''; |
| [7179](#L7179) | $bookingpress\_before\_selecting\_booking\_service\_data = apply\_filters('bookingpress\_before\_selecting\_booking\_service', $bookingpress\_before\_selecting\_booking\_service\_data); |
| [7180](#L7180) |  |
| [7181](#L7181) | $bookingpress\_after\_selecting\_booking\_service\_data = ''; |
| [7182](#L7182) | $bookingpress\_after\_selecting\_booking\_service\_data = apply\_filters('bookingpress\_after\_selecting\_booking\_service', $bookingpress\_after\_selecting\_booking\_service\_data); |
| [7183](#L7183) |  |
| [7184](#L7184) | $bookingpress\_after\_selecting\_booking\_service\_data\_updated = ''; |
| [7185](#L7185) | $bookingpress\_after\_selecting\_booking\_service\_data\_updated = apply\_filters('bookingpress\_after\_selecting\_booking\_service\_updated', $bookingpress\_after\_selecting\_booking\_service\_data\_updated); |
| [7186](#L7186) |  |
| [7187](#L7187) | $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date = ''; |
| [7188](#L7188) | $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date = apply\_filters('bookingpress\_after\_timeslot\_data\_load\_for\_single\_date', $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date); |
| [7189](#L7189) |  |
| [7190](#L7190) |  |
| [7191](#L7191) | $bookingpress\_after\_selecting\_payment\_method\_data = ''; |
| [7192](#L7192) | $bookingpress\_after\_selecting\_payment\_method\_data = apply\_filters('bookingpress\_after\_selecting\_payment\_method', $bookingpress\_after\_selecting\_payment\_method\_data); |
| [7193](#L7193) |  |
| [7194](#L7194) | $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form = ''; |
| [7195](#L7195) | $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form = apply\_filters('bookingpress\_after\_selecting\_payment\_method\_booking\_form', $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form); |
| [7196](#L7196) |  |
| [7197](#L7197) | $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request = ''; |
| [7198](#L7198) | $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request = apply\_filters('bookingpress\_dynamic\_add\_params\_for\_timeslot\_request', $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request); |
| [7199](#L7199) |  |
| [7200](#L7200) | $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page = ''; |
| [7201](#L7201) | $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page = apply\_filters('bookingpress\_add\_data\_for\_first\_step\_on\_next\_page', $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page); |
| [7202](#L7202) |  |
| [7203](#L7203) | $bookingpress\_add\_data\_for\_previous\_page = ''; |
| [7204](#L7204) | $bookingpress\_add\_data\_for\_previous\_page = apply\_filters('bookingpress\_add\_data\_for\_previous\_page', $bookingpress\_add\_data\_for\_previous\_page); |
| [7205](#L7205) |  |
| [7206](#L7206) | $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page = ''; |
| [7207](#L7207) | $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page = apply\_filters('bookingpress\_add\_data\_for\_second\_step\_on\_next\_page', $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page); |
| [7208](#L7208) |  |
| [7209](#L7209) | $bookingpress\_dynamic\_next\_page\_request\_filter = ''; |
| [7210](#L7210) | $bookingpress\_dynamic\_next\_page\_request\_filter = apply\_filters('bookingpress\_dynamic\_next\_page\_request\_filter', $bookingpress\_dynamic\_next\_page\_request\_filter); |
| [7211](#L7211) |  |
| [7212](#L7212) | $bookingpress\_change\_on\_summary\_steps\_filter = ''; |
| [7213](#L7213) | $bookingpress\_change\_on\_summary\_steps\_filter = apply\_filters('bookingpress\_change\_on\_summary\_steps\_filter', $bookingpress\_change\_on\_summary\_steps\_filter); |
| [7214](#L7214) |  |
| [7215](#L7215) | $bookingpress\_dynamic\_validation\_for\_step\_change = ''; |
| [7216](#L7216) | $bookingpress\_dynamic\_validation\_for\_step\_change = apply\_filters('bookingpress\_dynamic\_validation\_for\_step\_change', $bookingpress\_dynamic\_validation\_for\_step\_change); |
| [7217](#L7217) |  |
| [7218](#L7218) | $bookingpress\_validation\_for\_outside\_step\_change\_filter = ''; |
| [7219](#L7219) | $bookingpress\_validation\_for\_outside\_step\_change\_filter = apply\_filters('bookingpress\_validation\_for\_outside\_step\_change\_filter',$bookingpress\_validation\_for\_outside\_step\_change\_filter); |
| [7220](#L7220) |  |
| [7221](#L7221) | $bookingpress\_disable\_date\_xhr\_data = ''; |
| [7222](#L7222) | $bookingpress\_disable\_date\_xhr\_data = apply\_filters( 'bookingpress\_disable\_date\_xhr\_data', $bookingpress\_disable\_date\_xhr\_data ); |
| [7223](#L7223) |  |
| [7224](#L7224) | $bookingpress\_disable\_date\_pre\_xhr\_data = ''; |
| [7225](#L7225) | $bookingpress\_disable\_date\_pre\_xhr\_data = apply\_filters( 'bookingpress\_disable\_date\_pre\_xhr\_data', $bookingpress\_disable\_date\_pre\_xhr\_data ); |
| [7226](#L7226) |  |
| [7227](#L7227) | $bookingpress\_use\_legacy\_functions = 'false'; |
| [7228](#L7228) | $bookingpress\_use\_pro\_legacy = 'false'; |
| [7229](#L7229) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [7230](#L7230) | if( version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
| [7231](#L7231) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7232](#L7232) | $bookingpress\_use\_pro\_legacy = 'true'; |
| [7233](#L7233) | } |
| [7234](#L7234) |  |
| [7235](#L7235) | if( is\_plugin\_active( 'bookingpress-custom-service-duration/bookingpress-custom-service-duration.php' ) ){ |
| [7236](#L7236) | global $bookingpress\_custom\_service\_duration\_version; |
| [7237](#L7237) | if( version\_compare( $bookingpress\_custom\_service\_duration\_version, '2.1', '<' ) ){ |
| [7238](#L7238) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7239](#L7239) | } |
| [7240](#L7240) | } |
| [7241](#L7241) | } |
| [7242](#L7242) |  |
| [7243](#L7243) | $bookingpress\_disable\_date\_vue\_data = ''; |
| [7244](#L7244) | $bookingpress\_disable\_date\_vue\_data = apply\_filters( 'bookingpress\_disable\_date\_vue\_data\_modify', $bookingpress\_disable\_date\_vue\_data ); |
| [7245](#L7245) |  |
| [7246](#L7246) | $bookingpress\_disable\_date\_vue\_data\_after = ''; |
| [7247](#L7247) | $bookingpress\_disable\_date\_vue\_data\_after = apply\_filters( 'bookingpress\_disable\_date\_vue\_data\_after\_modify', $bookingpress\_disable\_date\_vue\_data\_after ); |
| [7248](#L7248) |  |
| [7249](#L7249) |  |
| [7250](#L7250) | $bookingpress\_disable\_future\_vue\_data = ''; |
| [7251](#L7251) | $bookingpress\_disable\_future\_vue\_data = apply\_filters( 'bookingpress\_disable\_future\_date\_vue\_data\_modify', $bookingpress\_disable\_future\_vue\_data ); |
| [7252](#L7252) |  |
| [7253](#L7253) | $bookingpress\_disable\_future\_vue\_data\_after = ''; |
| [7254](#L7254) | $bookingpress\_disable\_future\_vue\_data\_after = apply\_filters( 'bookingpress\_disable\_future\_date\_after\_vue\_data\_modify', $bookingpress\_disable\_future\_vue\_data\_after); |
| [7255](#L7255) |  |
| [7256](#L7256) | $bookingpress\_modify\_select\_step\_category = ''; |
| [7257](#L7257) | $bookingpress\_modify\_select\_step\_category = apply\_filters('bookingpress\_modify\_select\_step\_category', $bookingpress\_modify\_select\_step\_category); |
| [7258](#L7258) |  |
| [7259](#L7259) | $bookingpress\_modify\_select\_service\_category = ''; |
| [7260](#L7260) | $bookingpress\_modify\_select\_service\_category = apply\_filters( 'bookingpress\_modify\_select\_service\_category', $bookingpress\_modify\_select\_service\_category ); |
| [7261](#L7261) |  |
| [7262](#L7262) |  |
| [7263](#L7263) | $bookingpress\_step\_navigation\_before\_validation = ''; |
| [7264](#L7264) | $bookingpress\_step\_navigation\_before\_validation = apply\_filters( 'bookingpress\_step\_navigation\_before\_validation', $bookingpress\_step\_navigation\_before\_validation ); |
| [7265](#L7265) |  |
| [7266](#L7266) |  |
| [7267](#L7267) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after = ''; |
| [7268](#L7268) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after = apply\_filters( 'bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after', $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after ); |
| [7269](#L7269) |  |
| [7270](#L7270) |  |
| [7271](#L7271) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp = ''; |
| [7272](#L7272) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp = apply\_filters( 'bookingpress\_disable\_multiple\_days\_xhr\_response', $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp ); |
| [7273](#L7273) |  |
| [7274](#L7274) | $bookingpress\_dynamic\_time\_select\_after = ''; |
| [7275](#L7275) | $bookingpress\_dynamic\_time\_select\_after = apply\_filters('bookingpress\_dynamic\_time\_select\_after', $bookingpress\_dynamic\_time\_select\_after); |
| [7276](#L7276) |  |
| [7277](#L7277) | $bookingpress\_site\_date = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [7278](#L7278) | $bookingpress\_site\_date = apply\_filters( 'bookingpress\_modify\_current\_date', $bookingpress\_site\_date ); |
| [7279](#L7279) |  |
| [7280](#L7280) | $bookingpress\_disable\_timeslot\_select\_data = ''; |
| [7281](#L7281) | $bookingpress\_disable\_timeslot\_select\_data = apply\_filters('bookingpress\_disable\_timeslot\_select\_data', $bookingpress\_disable\_timeslot\_select\_data); |
| [7282](#L7282) |  |
| [7283](#L7283) | $bookingpress\_disable\_date\_send\_data = ''; |
| [7284](#L7284) | $bookingpress\_disable\_date\_send\_data = apply\_filters('bookingpress\_disable\_date\_send\_data\_before', $bookingpress\_disable\_date\_send\_data); |
| [7285](#L7285) |  |
| [7286](#L7286) | $bookingpress\_disable\_future\_date\_send\_data = ''; |
| [7287](#L7287) | $bookingpress\_disable\_future\_date\_send\_data = apply\_filters( 'bookingpress\_disable\_future\_date\_send\_data\_before', $bookingpress\_disable\_future\_date\_send\_data ); |
| [7288](#L7288) |  |
| [7289](#L7289) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [7290](#L7290) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [7291](#L7291) |  |
| [7292](#L7292) | $convert\_timeslot\_to\_client\_timezone = false; |
| [7293](#L7293) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [7294](#L7294) | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
| [7295](#L7295) | } |
| [7296](#L7296) |  |
| [7297](#L7297) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [7298](#L7298) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [7299](#L7299) |  |
| [7300](#L7300) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [7301](#L7301) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [7302](#L7302) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [7303](#L7303) |  |
| [7304](#L7304) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [7305](#L7305) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [7306](#L7306) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [7307](#L7307) |  |
| [7308](#L7308) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [7309](#L7309) |  |
| [7310](#L7310) | $wp\_timezone\_offset = wp\_timezone\_string(); |
| [7311](#L7311) |  |
| [7312](#L7312) | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
| [7313](#L7313) | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
| [7314](#L7314) | } |
| [7315](#L7315) |  |
| [7316](#L7316) | $bookingpress\_step\_navigation\_token\_postdata = ''; |
| [7317](#L7317) | $bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata ); |
| [7318](#L7318) |  |
| [7319](#L7319) | $bookingpress\_step\_navigation\_token\_selection\_data = ''; |
| [7320](#L7320) | $bookingpress\_step\_navigation\_token\_selection\_data = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_date\_selection', $bookingpress\_step\_navigation\_token\_selection\_data ); |
| [7321](#L7321) |  |
| [7322](#L7322) | $bookingpress\_use\_legacy\_functions = 'false'; |
| [7323](#L7323) | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
| [7324](#L7324) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7325](#L7325) | } |
| [7326](#L7326) |  |
| [7327](#L7327) | $bookingpress\_vue\_methods\_data .= ' |
| [7328](#L7328) | get\_formatted\_date(iso\_date){ |
| [7329](#L7329) |  |
| [7330](#L7330) | if( true == /(\d{2})\T/.test( iso\_date ) ){ |
| [7331](#L7331) | let date\_time\_arr = iso\_date.split("T"); |
| [7332](#L7332) | return date\_time\_arr[0]; |
| [7333](#L7333) | } |
| [7334](#L7334) | var \_\_date = new Date(iso\_date); |
| [7335](#L7335) | var \_\_year = \_\_date.getFullYear(); |
| [7336](#L7336) | var \_\_month = \_\_date.getMonth()+1; |
| [7337](#L7337) | var \_\_day = \_\_date.getDate(); |
| [7338](#L7338) | if (\_\_day < 10) { |
| [7339](#L7339) | \_\_day = "0" + \_\_day; |
| [7340](#L7340) | } |
| [7341](#L7341) | if (\_\_month < 10) { |
| [7342](#L7342) | \_\_month = "0" + \_\_month; |
| [7343](#L7343) | } |
| [7344](#L7344) | var formatted\_date = \_\_year+"-"+\_\_month+"-"+\_\_day; |
| [7345](#L7345) | return formatted\_date; |
| [7346](#L7346) | }, |
| [7347](#L7347) | get\_formatted\_datetime(iso\_date) { |
| [7348](#L7348) | var \_\_date = new Date(iso\_date); |
| [7349](#L7349) | var hour = \_\_date.getHours(); |
| [7350](#L7350) | var minute = \_\_date.getMinutes(); |
| [7351](#L7351) | var second = \_\_date.getSeconds(); |
| [7352](#L7352) |  |
| [7353](#L7353) | if (minute < 10) { |
| [7354](#L7354) | minute = "0" + minute; |
| [7355](#L7355) | } |
| [7356](#L7356) | if (second < 10) { |
| [7357](#L7357) | second = "0" + second; |
| [7358](#L7358) | } |
| [7359](#L7359) | var formatted\_time = hour + ":" + minute + ":" + second; |
| [7360](#L7360) | var \_\_year = \_\_date.getFullYear(); |
| [7361](#L7361) | var \_\_month = \_\_date.getMonth()+1; |
| [7362](#L7362) | var \_\_day = \_\_date.getDate(); |
| [7363](#L7363) | if (\_\_day < 10) { |
| [7364](#L7364) | \_\_day = "0" + \_\_day; |
| [7365](#L7365) | } |
| [7366](#L7366) | if (\_\_month < 10) { |
| [7367](#L7367) | \_\_month = "0" + \_\_month; |
| [7368](#L7368) | } |
| [7369](#L7369) |  |
| [7370](#L7370) | var formatted\_date = \_\_year+"-"+\_\_month+"-"+\_\_day; |
| [7371](#L7371) | return formatted\_date+" "+formatted\_time; |
| [7372](#L7372) | }, |
| [7373](#L7373) | bookingpress\_set\_error\_msg(error\_msg){ |
| [7374](#L7374) | const vm = this; |
| [7375](#L7375) | let container = vm.$el; |
| [7376](#L7376) | let pos = 0; |
| [7377](#L7377) | if( null != container ){ |
| [7378](#L7378) | pos = container.getBoundingClientRect().top + window.scrollY; |
| [7379](#L7379) | } |
| [7380](#L7380) | vm.is\_display\_error = "1"; |
| [7381](#L7381) | vm.is\_error\_msg = error\_msg; |
| [7382](#L7382) | const myVar = Error().stack; |
| [7383](#L7383) |  |
| [7384](#L7384) | let allow\_scroll = true; |
| [7385](#L7385) | if( /mounted/.test( myVar ) ){ |
| [7386](#L7386) | allow\_scroll = false; |
| [7387](#L7387) | } |
| [7388](#L7388) | if( allow\_scroll ){ |
| [7389](#L7389) | window.scrollTo({ |
| [7390](#L7390) | top: pos, |
| [7391](#L7391) | behavior: "smooth", |
| [7392](#L7392) | }); |
| [7393](#L7393) | } |
| [7394](#L7394) | setTimeout(function(){ |
| [7395](#L7395) | vm.bookingpress\_remove\_error\_msg(); |
| [7396](#L7396) | },6000); |
| [7397](#L7397) | }, |
| [7398](#L7398) | bookingpress\_remove\_error\_msg(){ |
| [7399](#L7399) | const vm = this; |
| [7400](#L7400) | vm.is\_display\_error = "0"; |
| [7401](#L7401) | vm.is\_error\_msg = ""; |
| [7402](#L7402) | }, |
| [7403](#L7403) | checkBeforeBookAppointment(){ |
| [7404](#L7404) | const vm = this; |
| [7405](#L7405) | setTimeout(function(){ |
| [7406](#L7406) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7407](#L7407) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7408](#L7408) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7409](#L7409) | { |
| [7410](#L7410) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7411](#L7411) | } |
| [7412](#L7412) | else { |
| [7413](#L7413) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7414](#L7414) | } |
| [7415](#L7415) |  |
| [7416](#L7416) | var postData = { action:"bookingpress\_before\_book\_appointment",\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [7417](#L7417) | postData.appointment\_data = JSON.stringify( vm.appointment\_step\_form\_data ); |
| [7418](#L7418) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7419](#L7419) | .then( function (response) { |
| [7420](#L7420) | if(response.data.variant == "error"){ |
| [7421](#L7421) | vm.bookingpress\_set\_error\_msg(response.data.msg); |
| [7422](#L7422) | if(response.data.error\_type == "dayoff"){ |
| [7423](#L7423) | vm.service\_timing = []; |
| [7424](#L7424) | } |
| [7425](#L7425) | vm.isLoadBookingLoader = "0"; |
| [7426](#L7426) | vm.isBookingDisabled = false; |
| [7427](#L7427) | }else{ |
| [7428](#L7428) | vm.bookingpress\_remove\_error\_msg(); |
| [7429](#L7429) | vm.bookingpress\_process\_to\_book\_appointment(); |
| [7430](#L7430) | } |
| [7431](#L7431) | }.bind(this) ) |
| [7432](#L7432) | .catch( function (error) { |
| [7433](#L7433) | vm.bookingpress\_set\_error\_msg(error); |
| [7434](#L7434) | }); |
| [7435](#L7435) | },1500); |
| [7436](#L7436) | }, |
| [7437](#L7437) | book\_appointment(){ |
| [7438](#L7438) | const vm2 = this; |
| [7439](#L7439) | vm2.isLoadBookingLoader = "1"; |
| [7440](#L7440) | vm2.isBookingDisabled = true; |
| [7441](#L7441) | vm2.bookingpress\_process\_to\_book\_appointment(); |
| [7442](#L7442) |  |
| [7443](#L7443) | }, |
| [7444](#L7444) | async bookingpress\_process\_to\_book\_appointment(){ |
| [7445](#L7445) | const vm2 = this; |
| [7446](#L7446) | if(vm2.is\_display\_error != "1"){ |
| [7447](#L7447) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7448](#L7448) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7449](#L7449) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7450](#L7450) | { |
| [7451](#L7451) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7452](#L7452) | } |
| [7453](#L7453) | else { |
| [7454](#L7454) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7455](#L7455) | } |
| [7456](#L7456) |  |
| [7457](#L7457) | var postData = { action:"bookingpress\_front\_save\_appointment\_booking", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [7458](#L7458) | postData.appointment\_data = JSON.stringify( vm2.appointment\_step\_form\_data ); |
| [7459](#L7459) | ' . $bookingpress\_before\_book\_appointment\_data . ' |
| [7460](#L7460) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7461](#L7461) | .then( function (response) { |
| [7462](#L7462) | vm2.isLoadBookingLoader = "0"; |
| [7463](#L7463) | vm2.isBookingDisabled = false; |
| [7464](#L7464) | if(response.data.variant == "redirect"){ |
| [7465](#L7465) | vm2.bookingpress\_remove\_error\_msg(); |
| [7466](#L7466) | vm2.bookingpress\_external\_html = response.data.redirect\_data; |
| [7467](#L7467) | setTimeout(function(){ |
| [7468](#L7468) | var scripts = document.getElementById("bpa-external-script").querySelectorAll("script"); |
| [7469](#L7469) | if(scripts.length > 0){ |
| [7470](#L7470) | var text = scripts[scripts.length - 1].textContent; |
| [7471](#L7471) | eval(text); |
| [7472](#L7472) | } |
| [7473](#L7473) | },50); |
| [7474](#L7474) | }else if(response.data.variant == "redirect\_url"){ |
| [7475](#L7475) | vm2.bookingpress\_remove\_error\_msg(); |
| [7476](#L7476) | window.location.href = response.data.redirect\_data; |
| [7477](#L7477) | }else if(response.data.variant == "error"){ |
| [7478](#L7478) | vm2.bookingpress\_set\_error\_msg(response.data.msg); |
| [7479](#L7479) | }else{ |
| [7480](#L7480) | vm2.bookingpress\_remove\_error\_msg(); |
| [7481](#L7481) | } |
| [7482](#L7482) | if(response.data.error\_type == "dayoff"){ |
| [7483](#L7483) | vm2.service\_timing = []; |
| [7484](#L7484) | } |
| [7485](#L7485) | }.bind(this) ) |
| [7486](#L7486) | .catch( function (error) { |
| [7487](#L7487) | vm2.bookingpress\_set\_error\_msg(error); |
| [7488](#L7488) | }); |
| [7489](#L7489) | }else{ |
| [7490](#L7490) | vm2.isLoadBookingLoader = "0"; |
| [7491](#L7491) | vm2.isBookingDisabled = false; |
| [7492](#L7492) | } |
| [7493](#L7493) | }, |
| [7494](#L7494) | bpa\_check\_browser(){ |
| [7495](#L7495) | const vm = this; |
| [7496](#L7496) | let userAgent = navigator.userAgent; |
| [7497](#L7497) | let browserName; |
| [7498](#L7498) | if(userAgent.match(/edg/i)){ |
| [7499](#L7499) | browserName = "edge"; |
| [7500](#L7500) | } else if(userAgent.match(/opr\//i)){ |
| [7501](#L7501) | browserName = "opera"; |
| [7502](#L7502) | } else if(userAgent.match(/chrome|chromium|crios/i)){ |
| [7503](#L7503) | browserName = "chrome"; |
| [7504](#L7504) | } else if(userAgent.match(/firefox|fxios/i)) { |
| [7505](#L7505) | browserName = "firefox"; |
| [7506](#L7506) | } else if(userAgent.match(/safari/i)) { |
| [7507](#L7507) | browserName = "safari"; |
| [7508](#L7508) | } else { |
| [7509](#L7509) | browserName="Unknown"; |
| [7510](#L7510) | } |
| [7511](#L7511) |  |
| [7512](#L7512) | vm.browser\_details = browserName; |
| [7513](#L7513) | }, |
| [7514](#L7514) | bpa\_check\_browser\_version(){ |
| [7515](#L7515) | const vm = this; |
| [7516](#L7516) | var objappVersion = navigator.appVersion; |
| [7517](#L7517) | var browserAgent = navigator.userAgent; |
| [7518](#L7518) | var browserName = navigator.appName; |
| [7519](#L7519) | var browserVersion = "" + parseFloat(navigator.appVersion); |
| [7520](#L7520) | var browserMajorVersion = parseInt(navigator.appVersion, 10); |
| [7521](#L7521) | var Offset, OffsetVersion, ix; |
| [7522](#L7522) |  |
| [7523](#L7523) | /\* For Chrome \*/ |
| [7524](#L7524) | if ((OffsetVersion = browserAgent.indexOf("Chrome")) != -1) { |
| [7525](#L7525) | browserName = "Chrome"; |
| [7526](#L7526) | browserVersion = browserAgent.substring(OffsetVersion + 7); |
| [7527](#L7527) | } |
| [7528](#L7528) |  |
| [7529](#L7529) | /\* For Microsoft internet explorer  \*/ |
| [7530](#L7530) | else if ((OffsetVersion = browserAgent.indexOf("MSIE")) != -1) { |
| [7531](#L7531) | browserName = "Microsoft Internet Explorer"; |
| [7532](#L7532) | browserVersion = browserAgent.substring(OffsetVersion + 5); |
| [7533](#L7533) | } |
| [7534](#L7534) |  |
| [7535](#L7535) | /\* For Firefox \*/ |
| [7536](#L7536) | else if ((OffsetVersion = browserAgent.indexOf("Firefox")) != -1) { |
| [7537](#L7537) | browserName = "Firefox"; |
| [7538](#L7538) | } |
| [7539](#L7539) |  |
| [7540](#L7540) | /\* For Safari \*/ |
| [7541](#L7541) | else if ((OffsetVersion = browserAgent.indexOf("Safari")) != -1) { |
| [7542](#L7542) | browserName = "Safari"; |
| [7543](#L7543) | browserVersion = browserAgent.substring(OffsetVersion + 7); |
| [7544](#L7544) | if ((OffsetVersion = browserAgent.indexOf("Version")) != -1) |
| [7545](#L7545) | browserVersion = browserAgent.substring(OffsetVersion + 8); |
| [7546](#L7546) | } |
| [7547](#L7547) |  |
| [7548](#L7548) | /\* For other browser "name/version" is at the end of userAgent \*/ |
| [7549](#L7549) | else if ((Offset = browserAgent.lastIndexOf(" ") + 1) < (OffsetVersion = browserAgent.lastIndexOf("/"))) { |
| [7550](#L7550) | browserName = browserAgent.substring(Offset, OffsetVersion); |
| [7551](#L7551) | browserVersion = browserAgent.substring(OffsetVersion + 1); |
| [7552](#L7552) | if (browserName.toLowerCase() == browserName.toUpperCase()) { |
| [7553](#L7553) | browserName = navigator.appName; |
| [7554](#L7554) | } |
| [7555](#L7555) | } |
| [7556](#L7556) |  |
| [7557](#L7557) | /\* Trimming the fullVersion string at \*/ |
| [7558](#L7558) | /\* semicolon/space if present \*/ |
| [7559](#L7559) | if ((ix = browserVersion.indexOf(";")) != -1) |
| [7560](#L7560) | browserVersion = browserVersion.substring(0, ix); |
| [7561](#L7561) | if ((ix = browserVersion.indexOf(" ")) != -1) |
| [7562](#L7562) | browserVersion = browserVersion.substring(0, ix); |
| [7563](#L7563) |  |
| [7564](#L7564) |  |
| [7565](#L7565) | browserMajorVersion = parseInt("" + browserVersion, 10); |
| [7566](#L7566) | if (isNaN(browserMajorVersion)) { |
| [7567](#L7567) | browserVersion = "" + parseFloat(navigator.appVersion); |
| [7568](#L7568) | browserMajorVersion = parseInt(navigator.appVersion, 10); |
| [7569](#L7569) | } |
| [7570](#L7570) |  |
| [7571](#L7571) | vm.browser\_version = browserMajorVersion; |
| [7572](#L7572) | }, |
| [7573](#L7573) | bpa\_select\_category( selected\_cat\_id, selected\_cat\_name, total\_services, total\_category){ |
| [7574](#L7574) | const vm = this; |
| [7575](#L7575) | let category\_id = parseInt( selected\_cat\_id ); |
| [7576](#L7576) | vm.isLoadClass = 0; |
| [7577](#L7577) | if( 0 == selected\_cat\_id ){ |
| [7578](#L7578) | for( let bpa\_service\_id in vm.bookingpress\_all\_services\_data ){ |
| [7579](#L7579) | let current\_service = vm.bookingpress\_all\_services\_data[ bpa\_service\_id ]; |
| [7580](#L7580) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = true; |
| [7581](#L7581) | '.$bookingpress\_modify\_select\_service\_category.' |
| [7582](#L7582) | } |
| [7583](#L7583) | } else { |
| [7584](#L7584) | if( vm.bookingpress\_all\_services\_data != "" ){ |
| [7585](#L7585) | for( let bpa\_service\_id in vm.bookingpress\_all\_services\_data ){ |
| [7586](#L7586) | let current\_service = vm.bookingpress\_all\_services\_data[ bpa\_service\_id ]; |
| [7587](#L7587) | let current\_category = current\_service.bookingpress\_category\_id; |
| [7588](#L7588) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = false; |
| [7589](#L7589) | if( current\_category == category\_id ){ |
| [7590](#L7590) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = true; |
| [7591](#L7591) | } |
| [7592](#L7592) | '.$bookingpress\_modify\_select\_service\_category.' |
| [7593](#L7593) | } |
| [7594](#L7594) | } |
| [7595](#L7595) | } |
| [7596](#L7596) | setTimeout(function(){ |
| [7597](#L7597) | vm.isLoadClass = 1; |
| [7598](#L7598) | },1); |
| [7599](#L7599) | vm.appointment\_step\_form\_data.selected\_category = selected\_cat\_id; |
| [7600](#L7600) | vm.appointment\_step\_form\_data.selected\_cat\_name = selected\_cat\_name; |
| [7601](#L7601) | }, |
| [7602](#L7602) | selectStepCategory(selected\_cat\_id, selected\_cat\_name = "", total\_services = 0, total\_category="", display\_warn = true ){ |
| [7603](#L7603) | if( true == display\_warn ){ |
| [7604](#L7604) | console.trace("Deprecated step category function " ); |
| [7605](#L7605) | console.warn("selectStepCategory function is deprecated. Please update the BookingPress lite, premium, and add-ons to the latest version"); |
| [7606](#L7606) | } |
| [7607](#L7607) | const vm = this; |
| [7608](#L7608) | vm.isLoadClass = 0; |
| [7609](#L7609) | if( 0 == selected\_cat\_id ){ |
| [7610](#L7610) | let temp\_services = []; |
| [7611](#L7611) | let m = 0; |
| [7612](#L7612) | for( let x in vm.bpa\_services\_data\_from\_categories ){ |
| [7613](#L7613) | let service\_details = vm.bpa\_services\_data\_from\_categories[x]; |
| [7614](#L7614) | for( let n in service\_details ){ |
| [7615](#L7615) | let current\_service = service\_details[n]; |
| [7616](#L7616) | if( "undefined" != typeof current\_service.bookingpress\_staffmembers ){ |
| [7617](#L7617) | let selected\_staffmember = vm.appointment\_step\_form\_data.bookingpress\_selected\_staff\_member\_details.selected\_staff\_member\_id; |
| [7618](#L7618) | if( current\_service.bookingpress\_staffmembers.includes( selected\_staffmember ) && selected\_staffmember != ""){ |
| [7619](#L7619) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position); |
| [7620](#L7620) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7621](#L7621) | } else { |
| [7622](#L7622) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position ); |
| [7623](#L7623) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7624](#L7624) | } |
| [7625](#L7625) | } else { |
| [7626](#L7626) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position ); |
| [7627](#L7627) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7628](#L7628) | } |
| [7629](#L7629) | '.$bookingpress\_modify\_select\_step\_category.' |
| [7630](#L7630) | m++; |
| [7631](#L7631) | } |
| [7632](#L7632) | } |
| [7633](#L7633) | var bpa\_temp\_services= []; |
| [7634](#L7634) | temp\_services.sort(); |
| [7635](#L7635) | for( let n in temp\_services ){ |
| [7636](#L7636) | if(temp\_services[n] != "") { |
| [7637](#L7637) | bpa\_temp\_services[n] = temp\_services[n]; |
| [7638](#L7638) | } |
| [7639](#L7639) | } |
| [7640](#L7640) | vm.services\_data = bpa\_temp\_services.sort(); |
| [7641](#L7641) | } else { |
| [7642](#L7642) | vm.services\_data = vm.bpa\_services\_data\_from\_categories[selected\_cat\_id]; |
| [7643](#L7643) | '.$bookingpress\_modify\_select\_step\_category.' |
| [7644](#L7644) | } |
| [7645](#L7645) |  |
| [7646](#L7646) | vm.appointment\_step\_form\_data.selected\_category = selected\_cat\_id; |
| [7647](#L7647) | vm.appointment\_step\_form\_data.selected\_cat\_name = selected\_cat\_name; |
| [7648](#L7648) | setTimeout(function(){ |
| [7649](#L7649) | vm.isLoadClass = 1; |
| [7650](#L7650) | },1); |
| [7651](#L7651) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7652](#L7652) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7653](#L7653) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7654](#L7654) | { |
| [7655](#L7655) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7656](#L7656) | } |
| [7657](#L7657) | else { |
| [7658](#L7658) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7659](#L7659) | } |
| [7660](#L7660) | }, |
| [7661](#L7661) | async selectDate(selected\_service\_id, service\_name, service\_price, service\_price\_without\_currency, is\_move\_to\_next, service\_duration\_val = "",service\_duration\_unit = ""){ |
| [7662](#L7662) | const vm = this; |
| [7663](#L7663) | if(typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" && (selected\_service\_id != vm.appointment\_step\_form\_data.selected\_service && vm.appointment\_step\_form\_data.selected\_date != "")){ |
| [7664](#L7664) |  |
| [7665](#L7665) | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7666](#L7666) | let newDate = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [7667](#L7667) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [7668](#L7668) | if( !pattern.test( newDate ) ){ |
| [7669](#L7669) |  |
| [7670](#L7670) | let sel\_month = newDate.getMonth() + 1; |
| [7671](#L7671) | let sel\_year = newDate.getFullYear(); |
| [7672](#L7672) | let sel\_date = newDate.getDate(); |
| [7673](#L7673) |  |
| [7674](#L7674) | if( sel\_month < 10 ){ |
| [7675](#L7675) | sel\_month = "0" + sel\_month; |
| [7676](#L7676) | } |
| [7677](#L7677) |  |
| [7678](#L7678) | if( sel\_date < 10 ){ |
| [7679](#L7679) | sel\_date = "0" + sel\_date; |
| [7680](#L7680) | } |
| [7681](#L7681) |  |
| [7682](#L7682) | newDate = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [7683](#L7683) | } |
| [7684](#L7684) |  |
| [7685](#L7685) | vm.appointment\_step\_form\_data.selected\_date = newDate; |
| [7686](#L7686) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7687](#L7687) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7688](#L7688) | } |
| [7689](#L7689) | '.$bookingpress\_before\_selecting\_booking\_service\_data.' |
| [7690](#L7690) |  |
| [7691](#L7691) | vm.appointment\_step\_form\_data.selected\_service = selected\_service\_id; |
| [7692](#L7692) | vm.v\_calendar\_blocked\_dates = []; |
| [7693](#L7693) | vm.v\_calendar\_attributes\_current = []; |
| [7694](#L7694) |  |
| [7695](#L7695) | vm.appointment\_step\_form\_data.selected\_service\_name = service\_name; |
| [7696](#L7696) | vm.appointment\_step\_form\_data.selected\_service\_price = service\_price; |
| [7697](#L7697) | vm.appointment\_step\_form\_data.service\_price\_without\_currency = service\_price\_without\_currency; |
| [7698](#L7698) |  |
| [7699](#L7699) | /\* vm.appointment\_step\_form\_data.base\_price = service\_price; \*/ |
| [7700](#L7700) | vm.appointment\_step\_form\_data.base\_price\_without\_currency = service\_price\_without\_currency; |
| [7701](#L7701) | if( "" == service\_duration\_val ){ |
| [7702](#L7702) | service\_duration\_val = vm.bookingpress\_all\_services\_data[ selected\_service\_id ].bookingpress\_service\_duration\_val; |
| [7703](#L7703) | } |
| [7704](#L7704) |  |
| [7705](#L7705) | if( "" == service\_duration\_unit ){ |
| [7706](#L7706) | service\_duration\_unit = vm.bookingpress\_all\_services\_data[ selected\_service\_id ].bookingpress\_service\_duration\_unit; |
| [7707](#L7707) | } |
| [7708](#L7708) |  |
| [7709](#L7709) | vm.appointment\_step\_form\_data.selected\_service\_duration = service\_duration\_val; |
| [7710](#L7710) | vm.appointment\_step\_form\_data.selected\_service\_duration\_unit = service\_duration\_unit; |
| [7711](#L7711) |  |
| [7712](#L7712) | if(vm.previous\_selected\_tab\_id === 1 || vm.previous\_selected\_tab\_id === 2 || vm.current\_selected\_tab\_id === 1){ |
| [7713](#L7713) | vm.displayResponsiveCalendar = "1"; |
| [7714](#L7714) | } |
| [7715](#L7715) |  |
| [7716](#L7716) | vm.v\_calendar\_disable\_dates = []; |
| [7717](#L7717) | vm.bpa\_current\_selected\_date = ""; |
| [7718](#L7718) | if(is\_move\_to\_next === "true"){ |
| [7719](#L7719) | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
| [7720](#L7720) | } |
| [7721](#L7721) |  |
| [7722](#L7722) | var selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7723](#L7723) | var formatted\_date = vm.get\_formatted\_date(selected\_date); |
| [7724](#L7724) | vm.bookingpress\_remove\_error\_msg(); |
| [7725](#L7725) | ' . $bookingpress\_after\_selecting\_booking\_service\_data . ' |
| [7726](#L7726) | }, |
| [7727](#L7727) | dayClickedResponsive( day ){ |
| [7728](#L7728) | const vm = this; |
| [7729](#L7729) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7730](#L7730) | vm.displayResponsiveCalendar = "1"; |
| [7731](#L7731) | vm.isLoadDateTimeCalendar = "1"; |
| [7732](#L7732) | if( window.innerWidth <= 991 ){ |
| [7733](#L7733) | vm.service\_timing = "-1"; |
| [7734](#L7734) | } else { |
| [7735](#L7735) | vm.service\_timing = "-1"; |
| [7736](#L7736) | } |
| [7737](#L7737) | } |
| [7738](#L7738) | vm.dayClicked(day); |
| [7739](#L7739) |  |
| [7740](#L7740) | }, |
| [7741](#L7741) | dayClicked(day){ |
| [7742](#L7742) | const vm = this; |
| [7743](#L7743) | let available\_dates = vm.v\_calendar\_available\_dates; |
| [7744](#L7744) | let dayId = day.id; |
| [7745](#L7745) | let dayString = dayId + " 00:00:00"; |
| [7746](#L7746) | if( "undefined" == typeof dayString || "undefined" == typeof available\_dates || 0 > available\_dates.indexOf( dayString ) || vm.bpa\_current\_selected\_date == dayId || ("undefined" != typeof vm.v\_calendar\_blocked\_dates && vm.v\_calendar\_blocked\_dates.includes( day.id ) ) ){ |
| [7747](#L7747) | return false; |
| [7748](#L7748) | } |
| [7749](#L7749) | vm.service\_timing = "-2"; |
| [7750](#L7750) | vm.appointment\_step\_form\_data.selected\_date = dayId; |
| [7751](#L7751) | vm.bpa\_current\_selected\_date = dayId; |
| [7752](#L7752) | vm.no\_timeslot\_available = false; |
| [7753](#L7753) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7754](#L7754) | vm.displayResponsiveCalendar = "0"; |
| [7755](#L7755) | } |
| [7756](#L7756) |  |
| [7757](#L7757) | setTimeout(function(){ |
| [7758](#L7758) | vm.service\_timing = vm.bookingpress\_categories\_timeslots( vm.v\_calendar\_timeslots\_data[ dayId ] ); |
| [7759](#L7759) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7760](#L7760) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7761](#L7761) |  |
| [7762](#L7762) | ' . $bookingpress\_after\_selecting\_booking\_service\_data\_updated . ' |
| [7763](#L7763) | },10); |
| [7764](#L7764) |  |
| [7765](#L7765) | }, |
| [7766](#L7766) | dayClicked\_legacy(day) { |
| [7767](#L7767) | const vm = this; |
| [7768](#L7768) | let disable\_dates = vm.v\_calendar\_disable\_dates; |
| [7769](#L7769) | let max\_available\_date = vm.get\_formatted\_date( vm.booking\_cal\_maxdate ); |
| [7770](#L7770) | if( disable\_dates.includes( day.id + " 00:00:00" ) || disable\_dates.includes( day.id ) || max\_available\_date < day.id || (day.date < vm.jsCurrentDateFormatted && false == day.isToday) ){ |
| [7771](#L7771) | return false; |
| [7772](#L7772) | } |
| [7773](#L7773) | vm.appointment\_step\_form\_data.selected\_date = day.id; |
| [7774](#L7774) | vm.get\_date\_timings( day.id ); |
| [7775](#L7775) | }, |
| [7776](#L7776) | get\_date\_timings(current\_selected\_date = ""){ |
| [7777](#L7777) |  |
| [7778](#L7778) | const vm = this; |
| [7779](#L7779) | if( window.innerWidth <= 991 ){ |
| [7780](#L7780) | vm.service\_timing = "-1"; |
| [7781](#L7781) | }else{ |
| [7782](#L7782) | vm.service\_timing = "-2"; |
| [7783](#L7783) | } |
| [7784](#L7784) |  |
| [7785](#L7785) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7786](#L7786) | vm.displayResponsiveCalendar = "0"; |
| [7787](#L7787) | } |
| [7788](#L7788) |  |
| [7789](#L7789) | if( null == vm.appointment\_step\_form\_data.selected\_date ){ |
| [7790](#L7790) | vm.appointment\_step\_form\_data.selected\_date = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [7791](#L7791) | } |
| [7792](#L7792) |  |
| [7793](#L7793) | if( current\_selected\_date == "") { |
| [7794](#L7794) | current\_selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7795](#L7795) | } |
| [7796](#L7796) | vm.appointment\_step\_form\_data.selected\_date = current\_selected\_date; |
| [7797](#L7797) | var selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7798](#L7798) | if( "undefined" != typeof this.$refs.bkp\_front\_calendar ){ |
| [7799](#L7799) | const calendar = this.$refs.bkp\_front\_calendar; |
| [7800](#L7800) | calendar.move(current\_selected\_date); |
| [7801](#L7801) | } |
| [7802](#L7802) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [7803](#L7803) | if( !pattern.test( selected\_date ) ){ |
| [7804](#L7804) |  |
| [7805](#L7805) | let sel\_month = selected\_date.getMonth() + 1; |
| [7806](#L7806) | let sel\_year = selected\_date.getFullYear(); |
| [7807](#L7807) | let sel\_date = selected\_date.getDate(); |
| [7808](#L7808) |  |
| [7809](#L7809) | if( sel\_month < 10 ){ |
| [7810](#L7810) | sel\_month = "0" + sel\_month; |
| [7811](#L7811) | } |
| [7812](#L7812) |  |
| [7813](#L7813) | if( sel\_date < 10 ){ |
| [7814](#L7814) | sel\_date = "0" + sel\_date; |
| [7815](#L7815) | } |
| [7816](#L7816) |  |
| [7817](#L7817) | selected\_date = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [7818](#L7818) | } |
| [7819](#L7819) |  |
| [7820](#L7820) | vm.appointment\_step\_form\_data.selected\_date = selected\_date; |
| [7821](#L7821) |  |
| [7822](#L7822) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7823](#L7823) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7824](#L7824) | var selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [7825](#L7825) |  |
| [7826](#L7826) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7827](#L7827) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7828](#L7828) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7829](#L7829) | { |
| [7830](#L7830) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7831](#L7831) | } |
| [7832](#L7832) | else { |
| [7833](#L7833) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7834](#L7834) | } |
| [7835](#L7835) |  |
| [7836](#L7836) | var postData = { action:"bookingpress\_front\_get\_timings", service\_id: selected\_service\_id, selected\_date: selected\_date, \_wpnonce:bkp\_wpnonce\_pre\_fetch, }; |
| [7837](#L7837) | ' . $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request . ' |
| [7838](#L7838) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [7839](#L7839) | postData.bpa\_change\_store\_date = false; |
| [7840](#L7840) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [7841](#L7841) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [7842](#L7842) | postData.bpa\_change\_store\_date = true; |
| [7843](#L7843) | } |
| [7844](#L7844) |  |
| [7845](#L7845) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [7846](#L7846) | postData.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [7847](#L7847) | } |
| [7848](#L7848) | vm.no\_timeslot\_available = false; |
| [7849](#L7849) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7850](#L7850) | .then( function (response) { |
| [7851](#L7851) | var set\_waiting\_time\_limit = 1500; |
| [7852](#L7852) | '.$bookingpress\_after\_timeslot\_data\_load\_for\_single\_date.' |
| [7853](#L7853) | setTimeout(function(){ |
| [7854](#L7854) | vm.service\_timing = response.data; |
| [7855](#L7855) | if( response.data.morning\_time.length <= 0 && response.data.afternoon\_time.length <= 0 && response.data.evening\_time.length <= 0 && response.data.night\_time.length <= 0 ){ |
| [7856](#L7856) | vm.no\_timeslot\_available = true; |
| [7857](#L7857) | } |
| [7858](#L7858) | vm.isLoadTimeLoader = "0"; |
| [7859](#L7859) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7860](#L7860) | vm.displayResponsiveCalendar = "0"; |
| [7861](#L7861) | } |
| [7862](#L7862) | if(response.data == ""){ |
| [7863](#L7863) | vm.service\_timing = null; |
| [7864](#L7864) | } |
| [7865](#L7865) | }, set\_waiting\_time\_limit); |
| [7866](#L7866) |  |
| [7867](#L7867) | ' . $bookingpress\_after\_selecting\_booking\_service\_data . ' |
| [7868](#L7868) | }.bind(this) ) |
| [7869](#L7869) | .catch( function (error) { |
| [7870](#L7870) | console.log(error); |
| [7871](#L7871) | }); |
| [7872](#L7872) | }, |
| [7873](#L7873) | selectDisableTiming(time\_details){ |
| [7874](#L7874) | '.$bookingpress\_disable\_timeslot\_select\_data.' |
| [7875](#L7875) | }, |
| [7876](#L7876) | selectTiming(selected\_start\_time, selected\_end\_time, store\_start\_time = "", store\_end\_time = "", store\_selected\_date = "" ,formated\_start\_time = "",formated\_end\_time = "",time\_details = ""){ |
| [7877](#L7877) | const vm = this; |
| [7878](#L7878) | vm.appointment\_step\_form\_data.selected\_start\_time = selected\_start\_time; |
| [7879](#L7879) | vm.appointment\_step\_form\_data.selected\_end\_time = selected\_end\_time; |
| [7880](#L7880) |  |
| [7881](#L7881) | if( "" != formated\_end\_time && "" != formated\_start\_time ) { |
| [7882](#L7882) | vm.appointment\_step\_form\_data.selected\_formatted\_start\_time = formated\_start\_time; |
| [7883](#L7883) | vm.appointment\_step\_form\_data.selected\_formatted\_end\_time = formated\_end\_time; |
| [7884](#L7884) | } |
| [7885](#L7885) | if( "" != time\_details.formatted\_start\_end\_time && "undefined" != time\_details.formatted\_start\_end\_time ) { |
| [7886](#L7886) | vm.appointment\_step\_form\_data.selected\_formatted\_start\_end\_time = time\_details.formatted\_start\_end\_time; |
| [7887](#L7887) | } |
| [7888](#L7888) |  |
| [7889](#L7889) | if("" != store\_start\_time && "" != store\_end\_time && "" != store\_selected\_date ){ |
| [7890](#L7890) | vm.appointment\_step\_form\_data.store\_start\_time = store\_start\_time; |
| [7891](#L7891) | vm.appointment\_step\_form\_data.store\_end\_time = store\_end\_time; |
| [7892](#L7892) | vm.appointment\_step\_form\_data.client\_offset = vm.bookingpress\_timezone\_offset; |
| [7893](#L7893) | vm.appointment\_step\_form\_data.store\_selected\_date = store\_selected\_date; |
| [7894](#L7894) | vm.appointment\_step\_form\_data.store\_selected\_end\_date = time\_details.selected\_end\_date || store\_selected\_date; |
| [7895](#L7895) | } |
| [7896](#L7896) |  |
| [7897](#L7897) | vm.appointment\_step\_form\_data.customer\_selected\_date = time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [7898](#L7898) | vm.appointment\_step\_form\_data.customer\_selected\_end\_date = time\_details.client\_end\_date || time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [7899](#L7899) | vm.appointment\_step\_form\_data.customer\_selected\_time = time\_details.client\_start\_time || selected\_start\_time; |
| [7900](#L7900) | vm.appointment\_step\_form\_data.customer\_selected\_end\_time = time\_details.client\_end\_time || selected\_end\_time; |
| [7901](#L7901) |  |
| [7902](#L7902) | '.$bookingpress\_dynamic\_time\_select\_after.' |
| [7903](#L7903) | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
| [7904](#L7904) | vm.bookingpress\_update\_timestep\_token(); |
| [7905](#L7905) | }, |
| [7906](#L7906) | resetForm(){ |
| [7907](#L7907) | const vm2 = this; |
| [7908](#L7908) | vm2.appointment\_formdata.appointment\_selected\_customer = "' . $bookingpress\_current\_user\_id . '"; |
| [7909](#L7909) | vm2.appointment\_formdata.appointment\_selected\_service = ""; |
| [7910](#L7910) | vm2.appointment\_formdata.appointment\_booked\_date = "' . $bookingpress\_current\_date . '"; |
| [7911](#L7911) | vm2.appointment\_formdata.appointment\_booked\_time = ""; |
| [7912](#L7912) | }, |
| [7913](#L7913) | select\_service(selected\_service\_id){ |
| [7914](#L7914) | const vm = this; |
| [7915](#L7915) | vm.appointment\_step\_form\_data.selected\_service = selected\_service\_id; |
| [7916](#L7916) | }, |
| [7917](#L7917) | automatic\_next\_page(next\_tab\_id){ |
| [7918](#L7918) | const vm = this; |
| [7919](#L7919) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.'; |
| [7920](#L7920) | vm.current\_selected\_tab\_id = parseInt(next\_tab\_id); |
| [7921](#L7921) | vm.bookingpress\_remove\_error\_msg(); |
| [7922](#L7922) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [7923](#L7923) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [7924](#L7924) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [7925](#L7925) | window.scrollTo({ |
| [7926](#L7926) | top: bookingpress\_scroll\_position, |
| [7927](#L7927) | }); |
| [7928](#L7928) | }, |
| [7929](#L7929) | next\_page(customer\_form = "", current\_selected\_element = "", next\_selection\_element = ""){ |
| [7930](#L7930) | const vm = this; |
| [7931](#L7931) | var current\_selected\_tab = bpa\_selected\_tab = parseFloat(vm.current\_selected\_tab\_id); |
| [7932](#L7932) | vm.previous\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [7933](#L7933) | if(current\_selected\_element != undefined && current\_selected\_element != null){ |
| [7934](#L7934) | current\_selected\_tab = parseInt(current\_selected\_element); |
| [7935](#L7935) | } |
| [7936](#L7936) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [7937](#L7937) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [7938](#L7938) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [7939](#L7939) | window.scrollTo({ |
| [7940](#L7940) | top: bookingpress\_scroll\_position, |
| [7941](#L7941) | }); |
| [7942](#L7942) |  |
| [7943](#L7943) | if(current\_selected\_tab === 1 || vm.previous\_selected\_tab\_id === 1){ |
| [7944](#L7944) | vm.is\_display\_error = "0"; |
| [7945](#L7945) | if(vm.appointment\_step\_form\_data.selected\_service == "" || vm.appointment\_step\_form\_data.selected\_service == undefined || vm.appointment\_step\_form\_data.selected\_service == "undefined"){ |
| [7946](#L7946) | vm.bookingpress\_set\_error\_msg("' . $no\_service\_selected\_for\_the\_booking . '"); |
| [7947](#L7947) | vm.current\_selected\_tab\_id = 1; |
| [7948](#L7948) | return false; |
| [7949](#L7949) | }else{ |
| [7950](#L7950) | '.$bookingpress\_add\_data\_for\_first\_step\_on\_next\_page.'; |
| [7951](#L7951) | if(next\_selection\_element != ""){ |
| [7952](#L7952) | current\_selected\_tab = next\_selection\_element; |
| [7953](#L7953) | }else{ |
| [7954](#L7954) | current\_selected\_tab = current\_selected\_tab; |
| [7955](#L7955) | } |
| [7956](#L7956) | } |
| [7957](#L7957) | }else if(current\_selected\_tab === 2){ |
| [7958](#L7958) | if(current\_selected\_element != undefined && current\_selected\_element == 2  && vm.appointment\_step\_form\_data.selected\_start\_time == "" && bpa\_selected\_tab == "2" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d") { |
| [7959](#L7959) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7960](#L7960) | vm.current\_selected\_tab\_id = 2; |
| [7961](#L7961) | return false; |
| [7962](#L7962) | } |
| [7963](#L7963) | if(vm.appointment\_step\_form\_data.selected\_service != ""  && vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d") { |
| [7964](#L7964) | vm.selectDate(vm.appointment\_step\_form\_data.selected\_service, vm.appointment\_step\_form\_data.selected\_service\_name, vm.appointment\_step\_form\_data.selected\_service\_price, vm.appointment\_step\_form\_data.service\_price\_without\_currency, "true",vm.appointment\_step\_form\_data.selected\_service\_duration,vm.appointment\_step\_form\_data.selected\_service\_duration\_unit); |
| [7965](#L7965) | } |
| [7966](#L7966) | if(vm.is\_display\_error != "1"){ |
| [7967](#L7967) | if(next\_selection\_element != ""){ |
| [7968](#L7968) | current\_selected\_tab = next\_selection\_element |
| [7969](#L7969) | }else{ |
| [7970](#L7970) | current\_selected\_tab = current\_selected\_tab; |
| [7971](#L7971) | } |
| [7972](#L7972) | vm.bookingpress\_remove\_error\_msg() |
| [7973](#L7973) | }else{ |
| [7974](#L7974) | if(vm.is\_error\_msg == ""){ |
| [7975](#L7975) | vm.bookingpress\_set\_error\_msg("' . esc\_html\_\_('Something went wrong', 'bookingpress-appointment-booking') . '") |
| [7976](#L7976) | } |
| [7977](#L7977) | } |
| [7978](#L7978) | }else if(current\_selected\_tab === 3){ |
| [7979](#L7979) | if(vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.is\_enable\_validations == 1 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [7980](#L7980) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7981](#L7981) | vm.current\_selected\_tab\_id = 2; |
| [7982](#L7982) | return false; |
| [7983](#L7983) | }else{ |
| [7984](#L7984) | vm.$refs[customer\_form].validate((valid) => { |
| [7985](#L7985) | if (valid) { |
| [7986](#L7986) | if(next\_selection\_element != ""){ |
| [7987](#L7987) | current\_selected\_tab = next\_selection\_element |
| [7988](#L7988) | }else{ |
| [7989](#L7989) | current\_selected\_tab = current\_selected\_tab; |
| [7990](#L7990) | } |
| [7991](#L7991) | } |
| [7992](#L7992) | }); |
| [7993](#L7993) | } |
| [7994](#L7994) | }else{ |
| [7995](#L7995) | if(vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.is\_enable\_validations == 1 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [7996](#L7996) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7997](#L7997) | vm.current\_selected\_tab\_id = 2; |
| [7998](#L7998) | return false; |
| [7999](#L7999) | } else { |
| [8000](#L8000) | vm.$refs[customer\_form].validate((valid) => { |
| [8001](#L8001) | if (valid) { |
| [8002](#L8002) | if(next\_selection\_element != ""){ |
| [8003](#L8003) | current\_selected\_tab = next\_selection\_element; |
| [8004](#L8004) | }else{ |
| [8005](#L8005) | current\_selected\_tab = current\_selected\_tab; |
| [8006](#L8006) | } |
| [8007](#L8007) | }else{ |
| [8008](#L8008) | current\_selected\_tab = 3; |
| [8009](#L8009) | } |
| [8010](#L8010) | }); |
| [8011](#L8011) | } |
| [8012](#L8012) | } |
| [8013](#L8013) | if(current\_selected\_tab === 2 && vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.selected\_date != "" ) { |
| [8014](#L8014) | vm.get\_date\_timings(); |
| [8015](#L8015) | } |
| [8016](#L8016) |  |
| [8017](#L8017) | vm.current\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8018](#L8018) | if(current\_selected\_tab === 2 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit == "d"){ |
| [8019](#L8019) | vm.next\_selected\_tab\_id = 3; |
| [8020](#L8020) | } |
| [8021](#L8021) |  |
| [8022](#L8022) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.' |
| [8023](#L8023) | }, |
| [8024](#L8024) | previous\_page(previous\_selection\_tab\_id = ""){ |
| [8025](#L8025) | const vm = this; |
| [8026](#L8026) | var current\_selected\_tab = parseFloat(vm.current\_selected\_tab\_id); |
| [8027](#L8027) | if(previous\_selection\_tab\_id != ""){ |
| [8028](#L8028) | current\_selected\_tab = previous\_selection\_tab\_id; |
| [8029](#L8029) | }else{ |
| [8030](#L8030) | vm.previous\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8031](#L8031) | current\_selected\_tab = current\_selected\_tab - 1; |
| [8032](#L8032) | } |
| [8033](#L8033) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.' |
| [8034](#L8034) |  |
| [8035](#L8035) | vm.current\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8036](#L8036) | if(vm.previous\_selected\_tab\_id == "1"){ |
| [8037](#L8037) | vm.displayResponsiveCalendar = 1; |
| [8038](#L8038) | } |
| [8039](#L8039) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [8040](#L8040) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [8041](#L8041) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [8042](#L8042) | window.scrollTo({ |
| [8043](#L8043) | top: bookingpress\_scroll\_position, |
| [8044](#L8044) | }); |
| [8045](#L8045) | }, |
| [8046](#L8046) | select\_payment\_method(payment\_method){ |
| [8047](#L8047) | const vm = this; |
| [8048](#L8048) |  |
| [8049](#L8049) | vm.appointment\_step\_form\_data.selected\_payment\_method = payment\_method; |
| [8050](#L8050) | var bookingpress\_allowed\_payment\_gateways\_for\_card\_fields = []; |
| [8051](#L8051) | ' . $bookingpress\_after\_selecting\_payment\_method\_data . '; |
| [8052](#L8052) | if(bookingpress\_allowed\_payment\_gateways\_for\_card\_fields.includes(payment\_method)){ |
| [8053](#L8053) | vm.is\_display\_card\_option = 1; |
| [8054](#L8054) | }else{ |
| [8055](#L8055) | vm.is\_display\_card\_option = 0; |
| [8056](#L8056) | } |
| [8057](#L8057) | '.$bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form.' |
| [8058](#L8058) | }, |
| [8059](#L8059) | displayCalendar(){ |
| [8060](#L8060) | const vm = this; |
| [8061](#L8061) | if( "" == vm.appointment\_step\_form\_data.selected\_date ){ |
| [8062](#L8062) | return false; |
| [8063](#L8063) | } |
| [8064](#L8064) | vm.displayResponsiveCalendar = "1"; |
| [8065](#L8065) | }, |
| [8066](#L8066) | Change\_front\_appointment\_description(service\_id) { |
| [8067](#L8067) | const vm = this; |
| [8068](#L8068) | vm.services\_data.forEach(function(item, index, arr){ |
| [8069](#L8069) | if(item.bookingpress\_service\_id == service\_id ){ |
| [8070](#L8070) | if(item.display\_details\_more == 0 && item.display\_details\_less == 1) { |
| [8071](#L8071) | item.display\_details\_less = 0; |
| [8072](#L8072) | item.display\_details\_more = 1; |
| [8073](#L8073) | } else { |
| [8074](#L8074) | item.display\_details\_more = 0; |
| [8075](#L8075) | item.display\_details\_less = 1; |
| [8076](#L8076) | } |
| [8077](#L8077) | } |
| [8078](#L8078) | }); |
| [8079](#L8079) | }, |
| [8080](#L8080) | bookingpress\_phone\_country\_change\_func(bookingpress\_country\_obj){ |
| [8081](#L8081) | const vm = this; |
| [8082](#L8082) | var bookingpress\_selected\_country = bookingpress\_country\_obj.iso2; |
| [8083](#L8083) | vm.appointment\_step\_form\_data.customer\_phone\_country = bookingpress\_selected\_country; |
| [8084](#L8084) | vm.appointment\_step\_form\_data.customer\_phone\_dial\_code = bookingpress\_country\_obj.dialCode; |
| [8085](#L8085) | let exampleNumber = window.intlTelInputUtils.getExampleNumber( bookingpress\_selected\_country, true, 1 ); |
| [8086](#L8086) | if( typeof vm.bookingpress\_phone\_default\_placeholder == "undefined" &&  "" != exampleNumber ){ |
| [8087](#L8087) | vm.bookingpress\_tel\_input\_props.inputOptions.placeholder = exampleNumber; |
| [8088](#L8088) | } else if(vm.bookingpress\_phone\_default\_placeholder == "false" && "" != exampleNumber){ |
| [8089](#L8089) | vm.bookingpress\_tel\_input\_props.inputOptions.placeholder = exampleNumber; |
| [8090](#L8090) | } |
| [8091](#L8091) | }, |
| [8092](#L8092) | bookingpress\_phone\_country\_open( vmodel ){ |
| [8093](#L8093) | const vm = this; |
| [8094](#L8094) | if( "" != vmodel ){ |
| [8095](#L8095) | let elm = document.querySelector(`div[data-tel-id="${vmodel}"]`); |
| [8096](#L8096) | if( null != elm ){ |
| [8097](#L8097) | let parent = vm.bookingpress\_get\_parents( elm, ".el-col" ); |
| [8098](#L8098) | if( 0 < parent.length && null != parent[0] ){ |
| [8099](#L8099) | parent[0].classList.add("bpa-active-col"); |
| [8100](#L8100) | } |
| [8101](#L8101) | } |
| [8102](#L8102) | } |
| [8103](#L8103) | }, |
| [8104](#L8104) | bookingpress\_phone\_country\_close( vmodel ){ |
| [8105](#L8105) | const vm = this; |
| [8106](#L8106) | if( "" != vmodel ){ |
| [8107](#L8107) | let elm = document.querySelector(`div[data-tel-id="${vmodel}"]`); |
| [8108](#L8108) | if( null != elm ){ |
| [8109](#L8109) | let parent = vm.bookingpress\_get\_parents( elm, ".bpa-active-col" ); |
| [8110](#L8110) | if( 0 < parent.length && null != parent[0] ){ |
| [8111](#L8111) | parent[0].classList.remove("bpa-active-col"); |
| [8112](#L8112) | } |
| [8113](#L8113) | } |
| [8114](#L8114) | } |
| [8115](#L8115) | }, |
| [8116](#L8116) | bookingpress\_get\_parents( elem, selector ){ |
| [8117](#L8117) | if (!Element.prototype.matches) { |
| [8118](#L8118) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [8119](#L8119) | Element.prototype.mozMatchesSelector || |
| [8120](#L8120) | Element.prototype.msMatchesSelector || |
| [8121](#L8121) | Element.prototype.oMatchesSelector || |
| [8122](#L8122) | Element.prototype.webkitMatchesSelector || |
| [8123](#L8123) | function(s) { |
| [8124](#L8124) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [8125](#L8125) | i = matches.length; |
| [8126](#L8126) | while (--i >= 0 && matches.item(i) !== this) {} |
| [8127](#L8127) | return i > -1; |
| [8128](#L8128) | }; |
| [8129](#L8129) | } |
| [8130](#L8130) |  |
| [8131](#L8131) | var parents = []; |
| [8132](#L8132) |  |
| [8133](#L8133) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [8134](#L8134) | if (selector) { |
| [8135](#L8135) | if (elem.matches(selector)) { |
| [8136](#L8136) | parents.push(elem); |
| [8137](#L8137) | } |
| [8138](#L8138) | continue; |
| [8139](#L8139) | } |
| [8140](#L8140) | parents.push(elem); |
| [8141](#L8141) | } |
| [8142](#L8142) |  |
| [8143](#L8143) | return parents; |
| [8144](#L8144) | }, |
| [8145](#L8145) | async bookingpress\_disable\_date( bpa\_selected\_service = "", bpa\_selected\_date = "" ){ |
| [8146](#L8146) | '.$bookingpress\_disable\_date\_pre\_xhr\_data.' |
| [8147](#L8147) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8148](#L8148) | if( "true" == use\_legacy ){ |
| [8149](#L8149) | this.bookingpress\_disable\_date\_xhr( bpa\_selected\_service, bpa\_selected\_date ); |
| [8150](#L8150) | } else { |
| [8151](#L8151) | this.bookingpress\_disable\_date\_xhr\_v2( bpa\_selected\_service, bpa\_selected\_date ); |
| [8152](#L8152) | } |
| [8153](#L8153) | }, |
| [8154](#L8154) | bookingpress\_update\_timestep\_token( force\_update = false ){ |
| [8155](#L8155) | const vm = this; |
| [8156](#L8156) |  |
| [8157](#L8157) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8158](#L8158) |  |
| [8159](#L8159) | let current\_tab = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name; |
| [8160](#L8160) |  |
| [8161](#L8161) | if( (true == force\_update && typeof vm.v\_calendar\_time\_token\_data != "undefined") || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
| [8162](#L8162) |  |
| [8163](#L8163) | let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [8164](#L8164) | '.$bookingpress\_step\_navigation\_token\_selection\_data.' |
| [8165](#L8165) | let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0]; |
| [8166](#L8166) |  |
| [8167](#L8167) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [8168](#L8168) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8169](#L8169) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8170](#L8170) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8171](#L8171) | }else { |
| [8172](#L8172) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8173](#L8173) | } |
| [8174](#L8174) |  |
| [8175](#L8175) | let postData = { |
| [8176](#L8176) | action: "bpa\_set\_timeslot\_token", |
| [8177](#L8177) | tokenData: selected\_token\_data, |
| [8178](#L8178) | selectedDate: appointment\_selected\_date, |
| [8179](#L8179) | \_wpnonce:bkp\_wpnonce\_pre\_fetch |
| [8180](#L8180) | }; |
| [8181](#L8181) |  |
| [8182](#L8182) | '.$bookingpress\_step\_navigation\_token\_postdata.' |
| [8183](#L8183) |  |
| [8184](#L8184) | vm.is\_bookingpress\_updating\_token = true; |
| [8185](#L8185) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8186](#L8186) | .then( function (response) { |
| [8187](#L8187) | vm.is\_bookingpress\_updating\_token = false; |
| [8188](#L8188) | vm.is\_bookingpress\_token\_updated = true; |
| [8189](#L8189) | }.bind(this) ) |
| [8190](#L8190) | .catch( function (error) { |
| [8191](#L8191) | }); |
| [8192](#L8192) | } |
| [8193](#L8193) | }, |
| [8194](#L8194) | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
| [8195](#L8195) | const vm = this; |
| [8196](#L8196) |  |
| [8197](#L8197) | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
| [8198](#L8198) | let is\_client\_timezone = "'.$convert\_timeslot\_to\_client\_timezone.'"; |
| [8199](#L8199) | let updated\_working\_hour\_details = {}; |
| [8200](#L8200) | let available\_dates = []; |
| [8201](#L8201) | let response = {}; |
| [8202](#L8202) | let firstAvailableDate = ""; |
| [8203](#L8203) |  |
| [8204](#L8204) | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
| [8205](#L8205) |  |
| [8206](#L8206) | let sorted\_working\_hours = []; |
| [8207](#L8207) |  |
| [8208](#L8208) |  |
| [8209](#L8209) | for( let wdate in working\_hour\_details ){ |
| [8210](#L8210) | let x = 0; |
| [8211](#L8211) | let n = 0; |
| [8212](#L8212) |  |
| [8213](#L8213) | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
| [8214](#L8214) |  |
| [8215](#L8215) | let overnight\_booking\_date = ""; |
| [8216](#L8216) |  |
| [8217](#L8217) | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
| [8218](#L8218) |  |
| [8219](#L8219) | sorted\_working\_hours[wdate].sort( (a,b) => { |
| [8220](#L8220) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [8221](#L8221) | } ); |
| [8222](#L8222) |  |
| [8223](#L8223) | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
| [8224](#L8224) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [8225](#L8225) | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
| [8226](#L8226) | let timezone = wh\_data.store\_offset; |
| [8227](#L8227) |  |
| [8228](#L8228) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [8229](#L8229) | wh\_data.client\_start\_time = stTime; |
| [8230](#L8230) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [8231](#L8231) | wh\_data.client\_end\_time = etTime; |
| [8232](#L8232) |  |
| [8233](#L8233) | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
| [8234](#L8234) | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
| [8235](#L8235) |  |
| [8236](#L8236) | let updated\_wdate; |
| [8237](#L8237) | if( "string" == typeof stTimeNew ){ |
| [8238](#L8238) | updated\_wdate = wdate; |
| [8239](#L8239) | } else { |
| [8240](#L8240) | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
| [8241](#L8241) | } |
| [8242](#L8242) | let updated\_edate; |
| [8243](#L8243) | if( "string" == typeof etTimeNew ){ |
| [8244](#L8244) | updated\_edate = wh\_data.selected\_end\_date; |
| [8245](#L8245) | } else { |
| [8246](#L8246) | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
| [8247](#L8247) | } |
| [8248](#L8248) |  |
| [8249](#L8249) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [8250](#L8250) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [8251](#L8251) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8252](#L8252) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [8253](#L8253) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8254](#L8254) | } |
| [8255](#L8255) | n++; |
| [8256](#L8256) | } else { |
| [8257](#L8257) | continue; |
| [8258](#L8258) | } |
| [8259](#L8259) | } else { |
| [8260](#L8260) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [8261](#L8261) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8262](#L8262) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [8263](#L8263) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8264](#L8264) | } |
| [8265](#L8265) | n++; |
| [8266](#L8266) | } |
| [8267](#L8267) | } |
| [8268](#L8268) |  |
| [8269](#L8269) | if( "" == firstAvailableDate ){ |
| [8270](#L8270) | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
| [8271](#L8271) | } |
| [8272](#L8272) |  |
| [8273](#L8273) | wh\_data.client\_date = updated\_wdate; |
| [8274](#L8274) | wh\_data.client\_end\_date = updated\_edate; |
| [8275](#L8275) |  |
| [8276](#L8276) | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
| [8277](#L8277) | overnight\_booking\_date = updated\_wdate; |
| [8278](#L8278) | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
| [8279](#L8279) | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
| [8280](#L8280) | } |
| [8281](#L8281) | } |
| [8282](#L8282) | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
| [8283](#L8283) |  |
| [8284](#L8284) | if( true == is\_overnight\_booking ){ |
| [8285](#L8285) |  |
| [8286](#L8286) | if( "true" == is\_client\_timezone ){ |
| [8287](#L8287) | wh\_data.is\_next\_day = false; |
| [8288](#L8288) | } |
| [8289](#L8289) |  |
| [8290](#L8290) | if( updated\_edate > updated\_wdate ){ |
| [8291](#L8291) | wh\_data.is\_next\_day = true; |
| [8292](#L8292) | } |
| [8293](#L8293) |  |
| [8294](#L8294) | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
| [8295](#L8295) | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
| [8296](#L8296) | wh\_data.is\_next\_day = true; |
| [8297](#L8297) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [8298](#L8298) | } |
| [8299](#L8299) | } |
| [8300](#L8300) |  |
| [8301](#L8301) | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
| [8302](#L8302) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [8303](#L8303) | } |
| [8304](#L8304) |  |
| [8305](#L8305) | let startTimeHour = stTime.split(":")[0]; |
| [8306](#L8306) |  |
| [8307](#L8307) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [8308](#L8308) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [8309](#L8309) |  |
| [8310](#L8310) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8311](#L8311) | if( "1" == timeformat || "2" == timeformat ){ |
| [8312](#L8312) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [8313](#L8313) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [8314](#L8314) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8315](#L8315) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [8316](#L8316) | formatted\_datetime = formatted\_startTime; |
| [8317](#L8317) | } |
| [8318](#L8318) |  |
| [8319](#L8319) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [8320](#L8320) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [8321](#L8321) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [8322](#L8322) | wh\_data.start\_hour = startTimeHour; |
| [8323](#L8323) |  |
| [8324](#L8324) | if( true == is\_overnight\_booking ){ |
| [8325](#L8325) | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
| [8326](#L8326) | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
| [8327](#L8327) | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
| [8328](#L8328) | } |
| [8329](#L8329) | } else { |
| [8330](#L8330) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [8331](#L8331) | } |
| [8332](#L8332) |  |
| [8333](#L8333) | x++; |
| [8334](#L8334) | } |
| [8335](#L8335) | } |
| [8336](#L8336) |  |
| [8337](#L8337) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [8338](#L8338) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [8339](#L8339) |  |
| [8340](#L8340) | response.available\_dates = available\_dates; |
| [8341](#L8341) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [8342](#L8342) | response.selected\_date = firstAvailableDate; |
| [8343](#L8343) |  |
| [8344](#L8344) | return response; |
| [8345](#L8345) | }, |
| [8346](#L8346) | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
| [8347](#L8347) | const vm = this; |
| [8348](#L8348) | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
| [8349](#L8349) | let updated\_working\_hour\_details = {}; |
| [8350](#L8350) | let available\_dates = []; |
| [8351](#L8351) | let response = {}; |
| [8352](#L8352) | let firstAvailableDate = ""; |
| [8353](#L8353) | for( let wdate in working\_hour\_details ){ |
| [8354](#L8354) | let x = 0; |
| [8355](#L8355) | let n = 0; |
| [8356](#L8356) |  |
| [8357](#L8357) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [8358](#L8358) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [8359](#L8359) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [8360](#L8360) | let timezone = wh\_data.store\_offset; |
| [8361](#L8361) |  |
| [8362](#L8362) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [8363](#L8363) | wh\_data.client\_start\_time = stTime; |
| [8364](#L8364) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [8365](#L8365) | wh\_data.client\_end\_time = etTime; |
| [8366](#L8366) |  |
| [8367](#L8367) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [8368](#L8368) | let updated\_edate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wh\_data.selected\_end\_date, wh\_data ); |
| [8369](#L8369) |  |
| [8370](#L8370) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [8371](#L8371) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [8372](#L8372) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8373](#L8373) |  |
| [8374](#L8374) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8375](#L8375) | n++; |
| [8376](#L8376) | } else { |
| [8377](#L8377) | continue; |
| [8378](#L8378) | } |
| [8379](#L8379) | } else { |
| [8380](#L8380) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [8381](#L8381) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8382](#L8382) |  |
| [8383](#L8383) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8384](#L8384) | n++; |
| [8385](#L8385) | } |
| [8386](#L8386) | } |
| [8387](#L8387) |  |
| [8388](#L8388) |  |
| [8389](#L8389) | if( "" == firstAvailableDate ){ |
| [8390](#L8390) | firstAvailableDate = updated\_wdate; |
| [8391](#L8391) | } |
| [8392](#L8392) |  |
| [8393](#L8393) | wh\_data.client\_date = updated\_wdate; |
| [8394](#L8394) | wh\_data.client\_end\_date = updated\_edate; |
| [8395](#L8395) |  |
| [8396](#L8396) | let startTimeHour = stTime.split(":")[0]; |
| [8397](#L8397) |  |
| [8398](#L8398) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [8399](#L8399) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [8400](#L8400) |  |
| [8401](#L8401) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8402](#L8402) | if( "1" == timeformat || "2" == timeformat ){ |
| [8403](#L8403) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [8404](#L8404) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [8405](#L8405) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8406](#L8406) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [8407](#L8407) | formatted\_datetime = formatted\_startTime; |
| [8408](#L8408) | } |
| [8409](#L8409) |  |
| [8410](#L8410) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [8411](#L8411) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [8412](#L8412) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [8413](#L8413) | wh\_data.start\_hour = startTimeHour; |
| [8414](#L8414) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [8415](#L8415) | x++; |
| [8416](#L8416) | } |
| [8417](#L8417) | } |
| [8418](#L8418) |  |
| [8419](#L8419) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [8420](#L8420) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [8421](#L8421) |  |
| [8422](#L8422) | response.available\_dates = available\_dates; |
| [8423](#L8423) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [8424](#L8424) | response.selected\_date = firstAvailableDate; |
| [8425](#L8425) |  |
| [8426](#L8426) | return response; |
| [8427](#L8427) | }, |
| [8428](#L8428) | bookingpress\_disable\_date\_xhr\_v2( bpa\_selected\_service = "", bpa\_selected\_date = "", showLoader = true ){ |
| [8429](#L8429) | const vm = this; |
| [8430](#L8430) |  |
| [8431](#L8431) | if( true == showLoader ){ |
| [8432](#L8432) | vm.isLoadTimeLoader = "1"; |
| [8433](#L8433) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8434](#L8434) | }; |
| [8435](#L8435) |  |
| [8436](#L8436) | let preselect\_date = false; |
| [8437](#L8437) | if( "" != bpa\_selected\_date ){ |
| [8438](#L8438) | preselect\_date = true; |
| [8439](#L8439) | } |
| [8440](#L8440) |  |
| [8441](#L8441) | if( "" == bpa\_selected\_date ){ |
| [8442](#L8442) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [8443](#L8443) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [8444](#L8444) | } |
| [8445](#L8445) |  |
| [8446](#L8446) | vm.service\_timing = "-3"; |
| [8447](#L8447) |  |
| [8448](#L8448) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8449](#L8449) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8450](#L8450) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8451](#L8451) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8452](#L8452) | } else { |
| [8453](#L8453) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8454](#L8454) | } |
| [8455](#L8455) |  |
| [8456](#L8456) | if( "" == bpa\_selected\_service && "" != vm.appointment\_step\_form\_data.selected\_service ){ |
| [8457](#L8457) | bpa\_selected\_service = vm.appointment\_step\_form\_data.selected\_service; |
| [8458](#L8458) | } |
| [8459](#L8459) |  |
| [8460](#L8460) | if( typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" || vm.appointment\_step\_form\_data.cart\_items.length == 0 ){ |
| [8461](#L8461) | vm.appointment\_step\_form\_data.bookingpress\_form\_token = vm.appointment\_step\_form\_data.bookingpress\_uniq\_id + "\_" + ( Math.random().toString(36).slice(2) ); |
| [8462](#L8462) | } |
| [8463](#L8463) |  |
| [8464](#L8464) | let startTime = new Date().getTime(); |
| [8465](#L8465) |  |
| [8466](#L8466) | var postData = { action: "bookingpress\_fetch\_timeslot\_data", service\_id: bpa\_selected\_service, selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, is\_preselect: preselect\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [8467](#L8467) |  |
| [8468](#L8468) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8469](#L8469) |  |
| [8470](#L8470) | vm.no\_timeslot\_available = false; |
| [8471](#L8471) | vm.v\_calendar\_check\_month\_dates = false; |
| [8472](#L8472) | vm.v\_calendar\_next\_month\_dates; |
| [8473](#L8473) | vm.days\_off\_disabled\_dates = ""; |
| [8474](#L8474) | '.$bookingpress\_disable\_date\_send\_data.'; |
| [8475](#L8475) |  |
| [8476](#L8476) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8477](#L8477) | .then( function (response) { |
| [8478](#L8478) |  |
| [8479](#L8479) | let request\_time = new Date().getTime() - startTime; |
| [8480](#L8480) |  |
| [8481](#L8481) | '.$bookingpress\_disable\_date\_vue\_data.' |
| [8482](#L8482) | let working\_hour\_details = response.data.working\_details; |
| [8483](#L8483) |  |
| [8484](#L8484) | let selectedDate = response.data.selected\_date; |
| [8485](#L8485) |  |
| [8486](#L8486) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8487](#L8487) | let preselected\_date = ""; |
| [8488](#L8488) |  |
| [8489](#L8489) | if( "undefined" != typeof response.data.pre\_selected\_date && true == response.data.pre\_selected\_date ){ |
| [8490](#L8490) | preselected\_date = response.data.selected\_date; |
| [8491](#L8491) | } |
| [8492](#L8492) |  |
| [8493](#L8493) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [8494](#L8494) | vm.appointment\_step\_form\_data.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [8495](#L8495) | } |
| [8496](#L8496) |  |
| [8497](#L8497) | vm.appointment\_step\_form\_data.selected\_date = ""; |
| [8498](#L8498) | selectedDate = ( "" != preselected\_date ) ? preselected\_date : ( wh\_details.selected\_date || selectedDate ); |
| [8499](#L8499) |  |
| [8500](#L8500) | vm.v\_calendar\_available\_dates = wh\_details.available\_dates; |
| [8501](#L8501) | vm.v\_calendar\_timeslots\_data = wh\_details.updated\_working\_hour\_details; |
| [8502](#L8502) | vm.no\_timeslot\_available = false; |
| [8503](#L8503) | let v\_available\_dates\_only = []; |
| [8504](#L8504) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8505](#L8505) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8506](#L8506) | }); |
| [8507](#L8507) | if( !v\_available\_dates\_only.includes( selectedDate ) && wh\_details.selected\_date != selectedDate ){ |
| [8508](#L8508) | selectedDate = wh\_details.selected\_date; |
| [8509](#L8509) | } |
| [8510](#L8510) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8511](#L8511) |  |
| [8512](#L8512) | if( "undefined" != typeof selectedDate ){ |
| [8513](#L8513) | (function( $ref\_ ){ |
| [8514](#L8514) | setTimeout(function(){ |
| [8515](#L8515) | vm.appointment\_step\_form\_data.selected\_date = selectedDate; |
| [8516](#L8516) | vm.bookingpress\_select\_multi\_day\_range(); |
| [8517](#L8517) | if( "undefined" != typeof $ref\_.bkp\_front\_calendar ){ |
| [8518](#L8518) | const calendar = $ref\_.bkp\_front\_calendar; |
| [8519](#L8519) | try{ |
| [8520](#L8520) | calendar.move( selectedDate ); |
| [8521](#L8521) | } catch( e ){ |
| [8522](#L8522) | console.log( e ); |
| [8523](#L8523) | } |
| [8524](#L8524) | } |
| [8525](#L8525) | if( "undefined" != typeof $ref\_.bkp\_front\_calendar\_responsive ){ |
| [8526](#L8526) | const calendar\_r = $ref\_.bkp\_front\_calendar\_responsive; |
| [8527](#L8527) | try{ |
| [8528](#L8528) | calendar\_r.move( selectedDate ); |
| [8529](#L8529) | } catch( e ){ |
| [8530](#L8530) | console.log( e ); |
| [8531](#L8531) | } |
| [8532](#L8532) | } |
| [8533](#L8533) | },10); |
| [8534](#L8534) | })( this.$refs ); |
| [8535](#L8535) | } |
| [8536](#L8536) |  |
| [8537](#L8537) | /\* V-date-picker attributes \*/ |
| [8538](#L8538) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8539](#L8539) |  |
| [8540](#L8540) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8541](#L8541) | let vcal\_attr\_data = []; |
| [8542](#L8542) | let vcal\_attr\_data\_current = {}; |
| [8543](#L8543) | let k = 1; |
| [8544](#L8544) |  |
| [8545](#L8545) | for( let vcal\_date in vcal\_attributes ){ |
| [8546](#L8546) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8547](#L8547) |  |
| [8548](#L8548) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8549](#L8549) |  |
| [8550](#L8550) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8551](#L8551) | let vcal\_attr\_obj = { |
| [8552](#L8552) | key: k, |
| [8553](#L8553) | dates: vcal\_date, |
| [8554](#L8554) | customData:{ |
| [8555](#L8555) | title: vcal\_data |
| [8556](#L8556) | } |
| [8557](#L8557) | }; |
| [8558](#L8558) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8559](#L8559) | k++; |
| [8560](#L8560) | } |
| [8561](#L8561) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8562](#L8562) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8563](#L8563) | } |
| [8564](#L8564) |  |
| [8565](#L8565) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8566](#L8566) |  |
| [8567](#L8567) | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
| [8568](#L8568) | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
| [8569](#L8569) | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
| [8570](#L8570) | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
| [8571](#L8571) |  |
| [8572](#L8572) | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8573](#L8573) |  |
| [8574](#L8574) | if( "0" == vcal\_data\_v2 ){ |
| [8575](#L8575) | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
| [8576](#L8576) | } |
| [8577](#L8577) | } |
| [8578](#L8578) | } |
| [8579](#L8579) |  |
| [8580](#L8580) | /\* V-date-picker attributes \*/ |
| [8581](#L8581) |  |
| [8582](#L8582) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8583](#L8583) | vm.v\_calendar\_time\_token\_data = response.data.working\_hour\_timing\_token; |
| [8584](#L8584) | if( "undefined" != typeof wh\_details.updated\_working\_hour\_details[ selectedDate ] ){ |
| [8585](#L8585) | vm.service\_timing = vm.bookingpress\_categories\_timeslots( wh\_details.updated\_working\_hour\_details[ selectedDate ] ); |
| [8586](#L8586) | } else { |
| [8587](#L8587) |  |
| [8588](#L8588) | vm.service\_timing = { |
| [8589](#L8589) | "morning\_time":[], |
| [8590](#L8590) | "afternoon\_time":[], |
| [8591](#L8591) | "evening\_time":[], |
| [8592](#L8592) | "night\_time":[] |
| [8593](#L8593) | }; |
| [8594](#L8594) | vm.no\_timeslot\_available = true; |
| [8595](#L8595) | } |
| [8596](#L8596) | if( vm.current\_screen\_size != "desktop" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [8597](#L8597) | vm.displayResponsiveCalendar = 0; |
| [8598](#L8598) | } |
| [8599](#L8599) | vm.isLoadTimeLoader = "0"; |
| [8600](#L8600) | vm.isLoadDateTimeCalendarLoad = "0"; |
| [8601](#L8601) | if( "undefined" == typeof response.data.stop\_check || false == response.data.stop\_check ){ |
| [8602](#L8602) | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, 1 ); |
| [8603](#L8603) | } |
| [8604](#L8604) |  |
| [8605](#L8605) | if( "undefined" != typeof vm.is\_bookingpress\_token\_updated && true == vm.is\_bookingpress\_token\_updated ){ |
| [8606](#L8606) | vm.bookingpress\_update\_timestep\_token( true ); |
| [8607](#L8607) | } |
| [8608](#L8608) |  |
| [8609](#L8609) | '.$bookingpress\_disable\_date\_vue\_data\_after.' |
| [8610](#L8610) | }.bind(this) ) |
| [8611](#L8611) | .catch( function (error) { |
| [8612](#L8612) | console.log(error); |
| [8613](#L8613) | }); |
| [8614](#L8614) | }, |
| [8615](#L8615) | bookingpress\_retrieve\_future\_month\_details( next\_month\_date = "", counter = 1 ){ |
| [8616](#L8616) | const vm = this; |
| [8617](#L8617) | let startDate = next\_month\_date != "" ? next\_month\_date : vm.v\_calendar\_available\_dates.at(-1); |
| [8618](#L8618) |  |
| [8619](#L8619) | if( 4 == counter ){ |
| [8620](#L8620) | vm.v\_calendar\_check\_month\_dates = true; |
| [8621](#L8621) | vm.v\_calendar\_next\_month\_dates = next\_month\_date; |
| [8622](#L8622) | vm.isHoldBookingRequest = false; |
| [8623](#L8623) | return false; |
| [8624](#L8624) | } else { |
| [8625](#L8625) | vm.isHoldBookingRequest = true; |
| [8626](#L8626) | } |
| [8627](#L8627) |  |
| [8628](#L8628) | let postData = { |
| [8629](#L8629) | action: "bookingpress\_retrieve\_entire\_month\_details", |
| [8630](#L8630) | from\_date: startDate, |
| [8631](#L8631) | counter: counter |
| [8632](#L8632) | }; |
| [8633](#L8633) |  |
| [8634](#L8634) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8635](#L8635) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8636](#L8636) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8637](#L8637) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8638](#L8638) | } else { |
| [8639](#L8639) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8640](#L8640) | } |
| [8641](#L8641) |  |
| [8642](#L8642) | postData.\_wpnonce = bkp\_wpnonce\_pre; |
| [8643](#L8643) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8644](#L8644) |  |
| [8645](#L8645) | '.$bookingpress\_disable\_future\_date\_send\_data.' |
| [8646](#L8646) |  |
| [8647](#L8647) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8648](#L8648) | .then( function (response) { |
| [8649](#L8649) | '.$bookingpress\_disable\_future\_vue\_data.' |
| [8650](#L8650) | let working\_hour\_details = response.data.working\_details |
| [8651](#L8651) |  |
| [8652](#L8652) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8653](#L8653) | vm.v\_calendar\_available\_dates = vm.v\_calendar\_available\_dates.concat( wh\_details.available\_dates ); |
| [8654](#L8654) | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
| [8655](#L8655) | let v\_available\_dates\_only = []; |
| [8656](#L8656) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8657](#L8657) |  |
| [8658](#L8658) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8659](#L8659) | let vcal\_attr\_data = []; |
| [8660](#L8660) | let vcal\_attr\_data\_current = {}; |
| [8661](#L8661) | let k = 1; |
| [8662](#L8662) |  |
| [8663](#L8663) | for( let vcal\_date in vcal\_attributes ){ |
| [8664](#L8664) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8665](#L8665) |  |
| [8666](#L8666) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8667](#L8667) |  |
| [8668](#L8668) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8669](#L8669) | let vcal\_attr\_obj = { |
| [8670](#L8670) | key: k, |
| [8671](#L8671) | dates: vcal\_date, |
| [8672](#L8672) | customData:{ |
| [8673](#L8673) | title: vcal\_data |
| [8674](#L8674) | } |
| [8675](#L8675) | }; |
| [8676](#L8676) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8677](#L8677) | k++; |
| [8678](#L8678) | } |
| [8679](#L8679) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8680](#L8680) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8681](#L8681) | } |
| [8682](#L8682) |  |
| [8683](#L8683) | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
| [8684](#L8684) | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
| [8685](#L8685) | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
| [8686](#L8686) | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
| [8687](#L8687) |  |
| [8688](#L8688) | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8689](#L8689) |  |
| [8690](#L8690) | if( "0" == vcal\_data\_v2 ){ |
| [8691](#L8691) | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
| [8692](#L8692) | } |
| [8693](#L8693) | } |
| [8694](#L8694) | } |
| [8695](#L8695) |  |
| [8696](#L8696) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8697](#L8697) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8698](#L8698) | }); |
| [8699](#L8699) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8700](#L8700) | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
| [8701](#L8701) | vm.isLoadDateTimeCalendarLoad = 0; |
| [8702](#L8702) | ++counter; |
| [8703](#L8703) | counter = wp.hooks.applyFilters( "bookingpress\_modify\_next\_month\_check\_counter", counter, response.data ); |
| [8704](#L8704) | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, counter ); |
| [8705](#L8705) | '.$bookingpress\_disable\_future\_vue\_data\_after.' |
| [8706](#L8706) | }.bind(this) ) |
| [8707](#L8707) | .catch( function (error) { |
| [8708](#L8708) | console.log(error); |
| [8709](#L8709) | }); |
| [8710](#L8710) | }, |
| [8711](#L8711) | bookingpress\_retrieve\_future\_month\_details\_single( next\_month\_date = "", next\_month\_dates = "", counter = 1 ){ |
| [8712](#L8712) | const vm = this; |
| [8713](#L8713) | let startDate = next\_month\_date != "" ? next\_month\_date : vm.v\_calendar\_available\_dates.at(-1); |
| [8714](#L8714) |  |
| [8715](#L8715) | vm.v\_calendar\_check\_month\_dates = true; |
| [8716](#L8716) | vm.v\_calendar\_next\_month\_dates = next\_month\_date; |
| [8717](#L8717) | vm.isHoldBookingRequest = false; |
| [8718](#L8718) |  |
| [8719](#L8719) | let postData = { |
| [8720](#L8720) | action: "bookingpress\_retrieve\_entire\_month\_details", |
| [8721](#L8721) | from\_date: startDate, |
| [8722](#L8722) | counter: counter |
| [8723](#L8723) | }; |
| [8724](#L8724) |  |
| [8725](#L8725) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8726](#L8726) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8727](#L8727) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8728](#L8728) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8729](#L8729) | } else { |
| [8730](#L8730) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8731](#L8731) | } |
| [8732](#L8732) |  |
| [8733](#L8733) | postData.\_wpnonce = bkp\_wpnonce\_pre; |
| [8734](#L8734) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8735](#L8735) |  |
| [8736](#L8736) | '.$bookingpress\_disable\_future\_date\_send\_data.' |
| [8737](#L8737) |  |
| [8738](#L8738) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8739](#L8739) | .then( function (response) { |
| [8740](#L8740) | '.$bookingpress\_disable\_future\_vue\_data.' |
| [8741](#L8741) | let working\_hour\_details = response.data.working\_details |
| [8742](#L8742) |  |
| [8743](#L8743) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8744](#L8744) | vm.v\_calendar\_available\_dates = vm.v\_calendar\_available\_dates.concat( wh\_details.available\_dates ); |
| [8745](#L8745) | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
| [8746](#L8746) | let v\_available\_dates\_only = []; |
| [8747](#L8747) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8748](#L8748) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8749](#L8749) | }); |
| [8750](#L8750) |  |
| [8751](#L8751) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8752](#L8752) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8753](#L8753) | let vcal\_attr\_data = []; |
| [8754](#L8754) | let vcal\_attr\_data\_current = {}; |
| [8755](#L8755) | let k = 1; |
| [8756](#L8756) |  |
| [8757](#L8757) | for( let vcal\_date in vcal\_attributes ){ |
| [8758](#L8758) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8759](#L8759) |  |
| [8760](#L8760) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8761](#L8761) |  |
| [8762](#L8762) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8763](#L8763) | let vcal\_attr\_obj = { |
| [8764](#L8764) | key: k, |
| [8765](#L8765) | dates: vcal\_date, |
| [8766](#L8766) | customData:{ |
| [8767](#L8767) | title: vcal\_data |
| [8768](#L8768) | } |
| [8769](#L8769) | }; |
| [8770](#L8770) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8771](#L8771) | k++; |
| [8772](#L8772) | } |
| [8773](#L8773) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8774](#L8774) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8775](#L8775) | } |
| [8776](#L8776) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8777](#L8777) | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
| [8778](#L8778) | vm.isLoadDateTimeCalendarLoad = 0; |
| [8779](#L8779) | vm.bookingpress\_retrieve\_future\_month\_details( next\_month\_dates, counter ); |
| [8780](#L8780) | '.$bookingpress\_disable\_future\_vue\_data\_after.' |
| [8781](#L8781) | }.bind(this) ) |
| [8782](#L8782) | .catch( function (error) { |
| [8783](#L8783) | console.log(error); |
| [8784](#L8784) | }); |
| [8785](#L8785) | }, |
| [8786](#L8786) | bookingpress\_format\_time(value){ |
| [8787](#L8787) | var default\_time\_format = "'.esc\_html($bookingpress\_formatted\_timeslot).'"; |
| [8788](#L8788) | return moment(String(value), "HH:mm:ss").locale("' . esc\_html( $bookingpress\_site\_current\_lang\_moment\_locale ) . '").format(default\_time\_format) |
| [8789](#L8789) | }, |
| [8790](#L8790) | bookingpress\_categories\_timeslots( timeslot\_details ){ |
| [8791](#L8791) |  |
| [8792](#L8792) | let afternoon\_slot\_timings = parseInt( "'.$bpa\_afternoon\_solts\_timing.'" ); |
| [8793](#L8793) | let evening\_slot\_timings = parseInt( "'.$bpa\_evening\_solts\_timing.'" ); |
| [8794](#L8794) | let night\_slot\_timings = parseInt( "'.$bpa\_night\_solts\_timing.'" ); |
| [8795](#L8795) |  |
| [8796](#L8796) | if( "undefined" == typeof timeslot\_details ){ |
| [8797](#L8797) | return {}; |
| [8798](#L8798) | } |
| [8799](#L8799) |  |
| [8800](#L8800) | let service\_timings\_data = { |
| [8801](#L8801) | "morning\_time":[], |
| [8802](#L8802) | "afternoon\_time":[], |
| [8803](#L8803) | "evening\_time":[], |
| [8804](#L8804) | "night\_time":[] |
| [8805](#L8805) | }; |
| [8806](#L8806) | let x = 0; |
| [8807](#L8807) | for( let timeslot\_data of timeslot\_details ){ |
| [8808](#L8808) | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
| [8809](#L8809) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [8810](#L8810) | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
| [8811](#L8811) | service\_timings\_data.morning\_time.push( timeslot\_data ); |
| [8812](#L8812) | } else if( startHour >= afternoon\_slot\_timings && ( "" == evening\_slot\_timings || startHour < evening\_slot\_timings ) ){ |
| [8813](#L8813) | service\_timings\_data.afternoon\_time.push( timeslot\_data ); |
| [8814](#L8814) | } else if ( startHour >= evening\_slot\_timings && ( "" == night\_slot\_timings || startHour < night\_slot\_timings ) ){ |
| [8815](#L8815) | service\_timings\_data.evening\_time.push( timeslot\_data ); |
| [8816](#L8816) | } else { |
| [8817](#L8817) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [8818](#L8818) | } |
| [8819](#L8819) | x++; |
| [8820](#L8820) | } |
| [8821](#L8821) | } |
| [8822](#L8822) | if( timeslot\_details.length > x ){ |
| [8823](#L8823) | for( let timeslot\_data of timeslot\_details ){ |
| [8824](#L8824) | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
| [8825](#L8825) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [8826](#L8826) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [8827](#L8827) | } |
| [8828](#L8828) | } |
| [8829](#L8829) | } |
| [8830](#L8830) | let night\_time = service\_timings\_data.night\_time; |
| [8831](#L8831) | let night\_time\_sorted = []; |
| [8832](#L8832) | for( let x in night\_time ){ |
| [8833](#L8833) | night\_time\_sorted.push( night\_time[x] ); |
| [8834](#L8834) | } |
| [8835](#L8835) |  |
| [8836](#L8836) | night\_time\_sorted.sort( (a,b) => { |
| [8837](#L8837) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [8838](#L8838) | } ); |
| [8839](#L8839) | service\_timings\_data.night\_time = night\_time\_sorted; |
| [8840](#L8840) |  |
| [8841](#L8841) | return service\_timings\_data; |
| [8842](#L8842) | }, |
| [8843](#L8843) | bookingpress\_disable\_date\_xhr( bpa\_selected\_service = "", bpa\_selected\_date = "", showLoader = true ){ |
| [8844](#L8844) |  |
| [8845](#L8845) | const vm = this; |
| [8846](#L8846) |  |
| [8847](#L8847) | if( true == showLoader ){ |
| [8848](#L8848) | vm.isLoadTimeLoader = "1"; |
| [8849](#L8849) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8850](#L8850) | } |
| [8851](#L8851) |  |
| [8852](#L8852) | vm.service\_timing = "-3"; |
| [8853](#L8853) |  |
| [8854](#L8854) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8855](#L8855) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8856](#L8856) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8857](#L8857) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8858](#L8858) | } else { |
| [8859](#L8859) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8860](#L8860) | } |
| [8861](#L8861) |  |
| [8862](#L8862) | if( "" == bpa\_selected\_service && "" != vm.appointment\_step\_form\_data.selected\_service ){ |
| [8863](#L8863) | bpa\_selected\_service = vm.appointment\_step\_form\_data.selected\_service; |
| [8864](#L8864) | } |
| [8865](#L8865) |  |
| [8866](#L8866) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [8867](#L8867) | vm.appointment\_step\_form\_data.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [8868](#L8868) | } |
| [8869](#L8869) |  |
| [8870](#L8870) | if( typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" || vm.appointment\_step\_form\_data.cart\_items.length == 0 ){ |
| [8871](#L8871) | vm.appointment\_step\_form\_data.bookingpress\_form\_token = vm.appointment\_step\_form\_data.bookingpress\_uniq\_id + "\_" + ( Math.random().toString(36).slice(2) ); |
| [8872](#L8872) | } |
| [8873](#L8873) |  |
| [8874](#L8874) | var postData = { action: "bookingpress\_get\_disable\_date", service\_id: bpa\_selected\_service, selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [8875](#L8875) |  |
| [8876](#L8876) | postData.disabled\_dates = JSON.stringify( vm.v\_calendar\_disable\_dates ); |
| [8877](#L8877) |  |
| [8878](#L8878) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8879](#L8879) |  |
| [8880](#L8880) | postData.bpa\_change\_store\_date = false; |
| [8881](#L8881) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [8882](#L8882) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [8883](#L8883) | postData.bpa\_change\_store\_date = true; |
| [8884](#L8884) | } |
| [8885](#L8885) |  |
| [8886](#L8886) | vm.no\_timeslot\_available = false; |
| [8887](#L8887) | vm.v\_calendar\_check\_month\_dates = false; |
| [8888](#L8888) | vm.v\_calendar\_next\_month\_dates = {}; |
| [8889](#L8889) | vm.days\_off\_disabled\_dates = ""; |
| [8890](#L8890) | '.$bookingpress\_disable\_date\_send\_data.'; |
| [8891](#L8891) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8892](#L8892) | .then( function (response) |
| [8893](#L8893) | { |
| [8894](#L8894) | vm.service\_timing = []; |
| [8895](#L8895) | if(response.data.variant == "success" && (response.data.selected\_date != undefined && response.data.days\_off\_disabled\_dates != undefined)){ |
| [8896](#L8896) | '.$bookingpress\_disable\_date\_vue\_data.' |
| [8897](#L8897) | vm.days\_off\_disabled\_dates = ""; |
| [8898](#L8898) |  |
| [8899](#L8899) | /\*V-Calendar disabled dates change start\*/ |
| [8900](#L8900) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [8901](#L8901) | vm.v\_calendar\_disable\_dates = []; |
| [8902](#L8902) | for( let temp\_date in bpa\_disable\_date ){ |
| [8903](#L8903) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [8904](#L8904) | if( "string" != typeof disabled\_date){ |
| [8905](#L8905) | continue; |
| [8906](#L8906) | } |
| [8907](#L8907) |  |
| [8908](#L8908) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [8909](#L8909) | let disable\_date\_data = disabled\_date.split(" "); |
| [8910](#L8910) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [8911](#L8911) | } else { |
| [8912](#L8912) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [8913](#L8913) | } |
| [8914](#L8914) | } |
| [8915](#L8915) | /\*V-Calendar disabled dates change end\*/ |
| [8916](#L8916) |  |
| [8917](#L8917) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8918](#L8918) | let pro\_version = "'.$bookingpress\_use\_pro\_legacy.'"; |
| [8919](#L8919) |  |
| [8920](#L8920) | if( "true" == use\_legacy && "false" == pro\_version ){ |
| [8921](#L8921) | let min\_date = vm.jsCurrentDate; |
| [8922](#L8922) | let max\_date = vm.booking\_cal\_maxdate; |
| [8923](#L8923) |  |
| [8924](#L8924) | let loop = new Date( min\_date ); |
| [8925](#L8925) | let available\_dates = []; |
| [8926](#L8926) | while( loop <= max\_date ){ |
| [8927](#L8927) | let dt = loop.toISOString().split("T")[0] + " 00:00:00"; |
| [8928](#L8928) |  |
| [8929](#L8929) | if( dt.indexOf( vm.v\_calendar\_disable\_dates ) == -1 ){ |
| [8930](#L8930) | available\_dates.push( dt ); |
| [8931](#L8931) | } |
| [8932](#L8932) |  |
| [8933](#L8933) | loop.setDate( loop.getDate() + 1 ); |
| [8934](#L8934) | } |
| [8935](#L8935) | vm.v\_calendar\_available\_dates = available\_dates; |
| [8936](#L8936) | } |
| [8937](#L8937) |  |
| [8938](#L8938) | let resp\_selected\_date = response.data.selected\_date; |
| [8939](#L8939) |  |
| [8940](#L8940) | if( vm.current\_screen\_size != "desktop" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [8941](#L8941) | vm.displayResponsiveCalendar = 0; |
| [8942](#L8942) | } |
| [8943](#L8943) |  |
| [8944](#L8944) | /\* V-date-picker attributes \*/ |
| [8945](#L8945) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8946](#L8946) |  |
| [8947](#L8947) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8948](#L8948) | let vcal\_attr\_data = []; |
| [8949](#L8949) | let vcal\_attr\_data\_current = {}; |
| [8950](#L8950) | let k = 1; |
| [8951](#L8951) | for( let vcal\_date in vcal\_attributes ){ |
| [8952](#L8952) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8953](#L8953) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8954](#L8954) | let vcal\_attr\_obj = { |
| [8955](#L8955) | key: k, |
| [8956](#L8956) | dates: vcal\_date, |
| [8957](#L8957) | customData:{ |
| [8958](#L8958) | title: vcal\_data |
| [8959](#L8959) | } |
| [8960](#L8960) | }; |
| [8961](#L8961) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8962](#L8962) | k++; |
| [8963](#L8963) | } |
| [8964](#L8964) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8965](#L8965) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8966](#L8966) | } |
| [8967](#L8967) |  |
| [8968](#L8968) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8969](#L8969) | /\* V-date-picker attributes \*/ |
| [8970](#L8970) |  |
| [8971](#L8971) | vm.days\_off\_disabled\_dates = response.data.days\_off\_disabled\_dates; |
| [8972](#L8972) | vm.appointment\_step\_form\_data.selected\_date = response.data.selected\_date; |
| [8973](#L8973) | vm.bookingpress\_select\_multi\_day\_range(); |
| [8974](#L8974) | if( "undefined" != typeof response.data.front\_timings ){ |
| [8975](#L8975) | vm.service\_timing = response.data.front\_timings; |
| [8976](#L8976) |  |
| [8977](#L8977) | if( response.data.front\_timings.length <= 0 ){ |
| [8978](#L8978) | vm.no\_timeslot\_available = true; |
| [8979](#L8979) | } |
| [8980](#L8980) | } |
| [8981](#L8981) | if( "undefined" != typeof this.$refs.bkp\_front\_calendar ){ |
| [8982](#L8982) | const calendar = this.$refs.bkp\_front\_calendar; |
| [8983](#L8983) | calendar.move(vm.appointment\_step\_form\_data.selected\_date); |
| [8984](#L8984) | } |
| [8985](#L8985) |  |
| [8986](#L8986) | vm.isLoadTimeLoader = "0"; |
| [8987](#L8987) | if( "undefined" != typeof response.data.empty\_front\_timings && true == response.data.empty\_front\_timings  ){ |
| [8988](#L8988) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8989](#L8989) | vm.appointment\_step\_form\_data.selected\_date = response.data.next\_available\_date; |
| [8990](#L8990) | vm.bookingpress\_disable\_date( bpa\_selected\_service, response.data.next\_available\_date ); |
| [8991](#L8991) | return; |
| [8992](#L8992) | } else { |
| [8993](#L8993) | /\* Check full day appointments block \*/ |
| [8994](#L8994) |  |
| [8995](#L8995) | if( false == response.data.prevent\_next\_month\_check ){ |
| [8996](#L8996) | let postDataAction = "bookingpress\_get\_whole\_day\_appointments"; |
| [8997](#L8997) | if( true == response.data.check\_for\_multiple\_days\_event ){ |
| [8998](#L8998) | postDataAction = "bookingpress\_get\_whole\_day\_appointments\_multiple\_days"; |
| [8999](#L8999) | } |
| [9000](#L9000) |  |
| [9001](#L9001) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [9002](#L9002) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [9003](#L9003) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [9004](#L9004) | { |
| [9005](#L9005) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [9006](#L9006) | } |
| [9007](#L9007) | else { |
| [9008](#L9008) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [9009](#L9009) | } |
| [9010](#L9010) |  |
| [9011](#L9011) | var postData = { action: postDataAction,days\_off\_disabled\_dates: vm.days\_off\_disabled\_dates, service\_id: bpa\_selected\_service, max\_available\_year: response.data.max\_available\_year, max\_available\_month:response.data.max\_available\_month,  selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch, "next\_month": response.data.next\_month, "next\_year": response.data.next\_year, "counter": 1 }; |
| [9012](#L9012) |  |
| [9013](#L9013) | postData.bpa\_change\_store\_date = false; |
| [9014](#L9014) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [9015](#L9015) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [9016](#L9016) | postData.bpa\_change\_store\_date = true; |
| [9017](#L9017) | } |
| [9018](#L9018) |  |
| [9019](#L9019) | postData.appointment\_data\_obj = JSON.stringify( vm.appointment\_step\_form\_data ); |
| [9020](#L9020) | '.$bookingpress\_disable\_date\_xhr\_data.' |
| [9021](#L9021) | vm.bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ); |
| [9022](#L9022) | } |
| [9023](#L9023) | setTimeout(function(){ |
| [9024](#L9024) | vm.isLoadDateTimeCalendarLoad = "0" |
| [9025](#L9025) | },200); |
| [9026](#L9026) | } |
| [9027](#L9027) | } |
| [9028](#L9028) |  |
| [9029](#L9029) | }.bind(this) ) |
| [9030](#L9030) | .catch( function (error) { |
| [9031](#L9031) | console.log(error); |
| [9032](#L9032) | }); |
| [9033](#L9033) | }, |
| [9034](#L9034) | bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ){ |
| [9035](#L9035) | const vm = this; |
| [9036](#L9036) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ).then( function( response ) { |
| [9037](#L9037) | vm.days\_off\_disabled\_dates = response.data.days\_off\_disabled\_dates; |
| [9038](#L9038) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after.' |
| [9039](#L9039) |  |
| [9040](#L9040) | vm.isLoadDateTimeCalendarLoad = 0; |
| [9041](#L9041) | if(false == response.data.prevent\_next\_month\_check && response.data.counter <= 3 ){ /\*\* Currently data will be checked for next 3 months \*/ |
| [9042](#L9042) | postData.days\_off\_disabled\_dates = vm.days\_off\_disabled\_dates; |
| [9043](#L9043) | postData.next\_month = response.data.next\_month; |
| [9044](#L9044) | postData.next\_year = response.data.next\_year; |
| [9045](#L9045) | postData.counter++; |
| [9046](#L9046) |  |
| [9047](#L9047) | if( postData.counter < 4 ){ |
| [9048](#L9048) | vm.isHoldBookingRequest = true; |
| [9049](#L9049) | vm.bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ); |
| [9050](#L9050) | } else { |
| [9051](#L9051) | vm.v\_calendar\_check\_month\_dates = true; |
| [9052](#L9052) | let next\_month\_year = { |
| [9053](#L9053) | "month": parseInt( response.data.next\_month ), |
| [9054](#L9054) | "year": response.data.next\_year, |
| [9055](#L9055) | "postData": postData |
| [9056](#L9056) | }; |
| [9057](#L9057) | vm.v\_calendar\_next\_month\_dates = next\_month\_year; |
| [9058](#L9058) | vm.isHoldBookingRequest = false; |
| [9059](#L9059) | } |
| [9060](#L9060) |  |
| [9061](#L9061) | /\* V-Calendar disabled dates change start \*/ |
| [9062](#L9062) | if( "" != response.data.days\_off\_disabled\_dates\_string ){ |
| [9063](#L9063) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [9064](#L9064) | for( let temp\_date in bpa\_disable\_date ){ |
| [9065](#L9065) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [9066](#L9066) | if( "string" != typeof disabled\_date ){ |
| [9067](#L9067) | continue; |
| [9068](#L9068) | } |
| [9069](#L9069) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [9070](#L9070) | let disable\_date\_data = disabled\_date.split(" "); |
| [9071](#L9071) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [9072](#L9072) | } else { |
| [9073](#L9073) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [9074](#L9074) | } |
| [9075](#L9075) | } |
| [9076](#L9076) |  |
| [9077](#L9077) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [9078](#L9078) | let pro\_version = "'.$bookingpress\_use\_pro\_legacy.'"; |
| [9079](#L9079) |  |
| [9080](#L9080) | if( "true" == use\_legacy && "false" == pro\_version ){ |
| [9081](#L9081) | let min\_date = vm.jsCurrentDate; |
| [9082](#L9082) | let max\_date = vm.booking\_cal\_maxdate; |
| [9083](#L9083) |  |
| [9084](#L9084) | let loop = new Date( min\_date ); |
| [9085](#L9085) | let available\_dates = []; |
| [9086](#L9086) | while( loop <= max\_date ){ |
| [9087](#L9087) | let dt = loop.toISOString().split("T")[0] + " 00:00:00"; |
| [9088](#L9088) |  |
| [9089](#L9089) | if( dt.indexOf( vm.v\_calendar\_disable\_dates ) == -1 ){ |
| [9090](#L9090) | available\_dates.push( dt ); |
| [9091](#L9091) | } |
| [9092](#L9092) |  |
| [9093](#L9093) | loop.setDate( loop.getDate() + 1 ); |
| [9094](#L9094) | } |
| [9095](#L9095) | vm.v\_calendar\_available\_dates = available\_dates; |
| [9096](#L9096) | } |
| [9097](#L9097) |  |
| [9098](#L9098) | } |
| [9099](#L9099) | /\* V-Calendar disabled dates change end \*/ |
| [9100](#L9100) |  |
| [9101](#L9101) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp.' |
| [9102](#L9102) | } else { |
| [9103](#L9103) | /\* V-Calendar disabled dates change start \*/ |
| [9104](#L9104) | if( "" != response.data.days\_off\_disabled\_dates\_string ){ |
| [9105](#L9105) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [9106](#L9106) | for( let temp\_date in bpa\_disable\_date ){ |
| [9107](#L9107) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [9108](#L9108) | if( "string" != typeof disabled\_date ){ |
| [9109](#L9109) | continue; |
| [9110](#L9110) | } |
| [9111](#L9111) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [9112](#L9112) | let disable\_date\_data = disabled\_date.split(" "); |
| [9113](#L9113) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [9114](#L9114) | } else { |
| [9115](#L9115) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [9116](#L9116) | } |
| [9117](#L9117) | } |
| [9118](#L9118) |  |
| [9119](#L9119) | } |
| [9120](#L9120) | /\* V-Calendar disabled dates change end \*/ |
| [9121](#L9121) |  |
| [9122](#L9122) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp.' |
| [9123](#L9123) | } |
| [9124](#L9124) | }); |
| [9125](#L9125) | }, |
| [9126](#L9126) | bpaMoveMonthResponsive( page ){ |
| [9127](#L9127) | const vm = this; |
| [9128](#L9128) | if( "undefined" != typeof vm.v\_calendar\_check\_month\_dates && true == vm.v\_calendar\_check\_month\_dates && "undefined" != typeof vm.v\_calendar\_next\_month\_dates && false == vm.isHoldBookingRequest ){ |
| [9129](#L9129) |  |
| [9130](#L9130) | let current\_month = page.month; |
| [9131](#L9131) | let current\_year = page.year; |
| [9132](#L9132) |  |
| [9133](#L9133) | let next\_page\_month = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[1] ) || null; |
| [9134](#L9134) | let next\_page\_year = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[0] ) || null; |
| [9135](#L9135) |  |
| [9136](#L9136) | if( null != next\_page\_month && null != next\_page\_year ){ |
| [9137](#L9137) | if( current\_year == next\_page\_year && current\_month == next\_page\_month ){ |
| [9138](#L9138) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, 1 ); |
| [9139](#L9139) | } else if( current\_year == next\_page\_year && current\_month > next\_page\_month ){ |
| [9140](#L9140) | let current\_date = new Date( `${current\_year}-${current\_month}-1` ); |
| [9141](#L9141) | let next\_page\_date = new Date( `${next\_page\_year}-${next\_page\_month}-1` ); |
| [9142](#L9142) | const monthDiff = current\_date.getMonth() - next\_page\_date.getMonth(); |
| [9143](#L9143) | counter = 0 - monthDiff; |
| [9144](#L9144) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, counter ); |
| [9145](#L9145) | } |
| [9146](#L9146) | } |
| [9147](#L9147) | } |
| [9148](#L9148) | }, |
| [9149](#L9149) | bpaMoveMonth( page ){ |
| [9150](#L9150) | const vm = this; |
| [9151](#L9151) | if( "undefined" != typeof vm.v\_calendar\_check\_month\_dates && true == vm.v\_calendar\_check\_month\_dates && "undefined" != typeof vm.v\_calendar\_next\_month\_dates && false == vm.isHoldBookingRequest ){ |
| [9152](#L9152) |  |
| [9153](#L9153) | let current\_month = page.month; |
| [9154](#L9154) | let current\_year = page.year; |
| [9155](#L9155) |  |
| [9156](#L9156) | let next\_page\_month = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[1] ) || null; |
| [9157](#L9157) | let next\_page\_year = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[0] ) || null; |
| [9158](#L9158) |  |
| [9159](#L9159) | if( null != next\_page\_month && null != next\_page\_year ){ |
| [9160](#L9160) | if( current\_year == next\_page\_year && current\_month == next\_page\_month ){ |
| [9161](#L9161) | vm.isLoadDateTimeCalendarLoad = 1; |
| [9162](#L9162) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, 1 ); |
| [9163](#L9163) | } else if( current\_year == next\_page\_year && current\_month > next\_page\_month ){ |
| [9164](#L9164) | let current\_date = new Date( `${current\_year}-${current\_month}-1` ); |
| [9165](#L9165) | let next\_page\_date = new Date( `${next\_page\_year}-${next\_page\_month}-1` ); |
| [9166](#L9166) | const monthDiff = current\_date.getMonth() - next\_page\_date.getMonth(); |
| [9167](#L9167) |  |
| [9168](#L9168) | let month\_ = ( current\_month.toString().length == 1 ) ? ( "0" + current\_month.toString() ) : current\_month; |
| [9169](#L9169) | let nextMonthDate = current\_year + "-" + month\_ + "-01"; |
| [9170](#L9170) |  |
| [9171](#L9171) |  |
| [9172](#L9172) | counter = 0 - monthDiff; |
| [9173](#L9173) |  |
| [9174](#L9174) | vm.isLoadDateTimeCalendarLoad = 1; |
| [9175](#L9175) | vm.bookingpress\_retrieve\_future\_month\_details\_single( nextMonthDate, vm.v\_calendar\_next\_month\_dates, counter ); |
| [9176](#L9176) | } |
| [9177](#L9177) | } |
| [9178](#L9178) | } |
| [9179](#L9179) | }, |
| [9180](#L9180) | bookingpress\_get\_all\_parent\_node\_with\_overflow\_hidden( elem ){ |
| [9181](#L9181) | if (!Element.prototype.matches) { |
| [9182](#L9182) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [9183](#L9183) | Element.prototype.mozMatchesSelector || |
| [9184](#L9184) | Element.prototype.msMatchesSelector || |
| [9185](#L9185) | Element.prototype.oMatchesSelector || |
| [9186](#L9186) | Element.prototype.webkitMatchesSelector || |
| [9187](#L9187) | function(s) { |
| [9188](#L9188) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [9189](#L9189) | i = matches.length; |
| [9190](#L9190) | while (--i >= 0 && matches.item(i) !== this) {} |
| [9191](#L9191) | return i > -1; |
| [9192](#L9192) | }; |
| [9193](#L9193) | } |
| [9194](#L9194) |  |
| [9195](#L9195) | var parents = []; |
| [9196](#L9196) |  |
| [9197](#L9197) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [9198](#L9198) | let computed\_style = getComputedStyle( elem ); |
| [9199](#L9199) |  |
| [9200](#L9200) | if( computed\_style.overflow == "hidden" || computed\_style.overflowX == "hidden" || computed\_style.overflowY == "hidden" ){ |
| [9201](#L9201) | parents.push(elem); |
| [9202](#L9202) | } |
| [9203](#L9203) | } |
| [9204](#L9204) | return parents; |
| [9205](#L9205) | }, |
| [9206](#L9206) | bookingpress\_onload\_func(){ |
| [9207](#L9207) | const vm = this; |
| [9208](#L9208) | vm.current\_screen\_size = "desktop"; |
| [9209](#L9209) | if(window.outerWidth >= 1200){ |
| [9210](#L9210) | vm.current\_screen\_size = "desktop"; |
| [9211](#L9211) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [9212](#L9212) | vm.current\_screen\_size = "tablet"; |
| [9213](#L9213) | }else if(window.outerWidth < 768){ |
| [9214](#L9214) | vm.current\_screen\_size = "mobile"; |
| [9215](#L9215) | } |
| [9216](#L9216) |  |
| [9217](#L9217) | let is\_mobile\_device = "'.wp\_is\_mobile().'"; |
| [9218](#L9218) |  |
| [9219](#L9219) | if( "mobile" != vm.current\_screen\_size && ("true" == is\_mobile\_device || true == is\_mobile\_device) ){ |
| [9220](#L9220) | vm.current\_screen\_size = "mobile"; |
| [9221](#L9221) | } |
| [9222](#L9222) |  |
| [9223](#L9223) | if(window.innerWidth <= 576){ |
| [9224](#L9224) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9225](#L9225) | let bookingpress\_container = vm.$el; |
| [9226](#L9226) | let parents\_with\_hidden\_overflow = vm.bookingpress\_get\_all\_parent\_node\_with\_overflow\_hidden( bookingpress\_container ); |
| [9227](#L9227) | let apply\_overflow = ( parents\_with\_hidden\_overflow.length > 0 ) ? true : false; |
| [9228](#L9228) | window.addEventListener("scroll", function(e){ |
| [9229](#L9229) |  |
| [9230](#L9230) | let bookingpress\_scrollTop = bookingpress\_container.getBoundingClientRect().top; |
| [9231](#L9231) | let bookingpress\_scrollBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9232](#L9232) | let bpa\_current\_scroll = window.scrollY; |
| [9233](#L9233) |  |
| [9234](#L9234) | let targetBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9235](#L9235) | let viewportHeight = window.innerHeight || document.documentElement.clientHeight; |
| [9236](#L9236) |  |
| [9237](#L9237) |  |
| [9238](#L9238) | if( bookingpress\_scrollTop < 50 && bpa\_current\_scroll >= bookingpress\_scrollTop && targetBottom >= viewportHeight ){ |
| [9239](#L9239) | vm.bookingpress\_container\_dynamic\_class = "bpa-front\_\_mc--is-sticky" ; |
| [9240](#L9240) | vm.bookingpress\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9241](#L9241) | if( apply\_overflow ){ |
| [9242](#L9242) | for( let i = 0; i < parents\_with\_hidden\_overflow.length; i++ ){ |
| [9243](#L9243) | let parent = parents\_with\_hidden\_overflow[i]; |
| [9244](#L9244) | parent.classList.add("--bpa-is-overflow-visible"); |
| [9245](#L9245) | } |
| [9246](#L9246) | } |
| [9247](#L9247) | } else { |
| [9248](#L9248) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9249](#L9249) | vm.bookingpress\_footer\_dynamic\_class = ""; /\* Change this string \*/ |
| [9250](#L9250) | if( apply\_overflow ){ |
| [9251](#L9251) | for( let i = 0; i < parents\_with\_hidden\_overflow.length; i++ ){ |
| [9252](#L9252) | let parent = parents\_with\_hidden\_overflow[i]; |
| [9253](#L9253) | parent.classList.remove("--bpa-is-overflow-visible"); |
| [9254](#L9254) | } |
| [9255](#L9255) | } |
| [9256](#L9256) | } |
| [9257](#L9257) | }); |
| [9258](#L9258) | } |
| [9259](#L9259) | window.addEventListener("resize", function(e){ |
| [9260](#L9260) | if( window.innerWidth <= 576 ){ |
| [9261](#L9261) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9262](#L9262) | let bookingpress\_container = vm.$el; |
| [9263](#L9263) |  |
| [9264](#L9264) | let bookingpress\_scrollTop = bookingpress\_container.getBoundingClientRect().top; |
| [9265](#L9265) | let bookingpress\_scrollBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9266](#L9266) | let bpa\_current\_scroll = window.scrollY; |
| [9267](#L9267) | bookingpress\_scrollBottom = bpa\_current\_scroll + bookingpress\_scrollBottom + bookingpress\_scrollTop; |
| [9268](#L9268) |  |
| [9269](#L9269) | let targetBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9270](#L9270) | let viewportHeight = window.innerHeight || document.documentElement.clientHeight; |
| [9271](#L9271) |  |
| [9272](#L9272) | if( bookingpress\_scrollTop < 50 && bpa\_current\_scroll >= bookingpress\_scrollTop && targetBottom >= viewportHeight ){ |
| [9273](#L9273) | vm.bookingpress\_container\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9274](#L9274) | vm.bookingpress\_footer\_dynamic\_class = "\_\_bpa-is-sticky" /\* Change this string \*/ |
| [9275](#L9275) | } else { |
| [9276](#L9276) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9277](#L9277) | vm.bookingpress\_footer\_dynamic\_class = ""; /\* Change this string \*/ |
| [9278](#L9278) | } |
| [9279](#L9279) | } |
| [9280](#L9280) | }); |
| [9281](#L9281) | }, |
| [9282](#L9282) | bookingpress\_step\_navigation(current\_tab, next\_tab, previous\_tab, is\_strict\_validate = 1){ |
| [9283](#L9283) | const vm = this; |
| [9284](#L9284) | var bookingpress\_is\_validate = 0; |
| [9285](#L9285) |  |
| [9286](#L9286) | vm.bookingpress\_remove\_error\_msg(); |
| [9287](#L9287) |  |
| [9288](#L9288) | var bookingpress\_validate\_fields\_arr = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validate\_fields; |
| [9289](#L9289) |  |
| [9290](#L9290) | '.$bookingpress\_step\_navigation\_before\_validation.' |
| [9291](#L9291) |  |
| [9292](#L9292) | if((vm.bookingpress\_current\_tab == "basic\_details") && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9293](#L9293) | bookingpress\_validate\_fields\_arr.forEach(function(currentValue, index, arr){ |
| [9294](#L9294) | if(vm.bookingpress\_current\_tab == vm.bookingpress\_current\_tab && vm.appointment\_step\_form\_data[currentValue] == "" && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9295](#L9295) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9296](#L9296) | bookingpress\_is\_validate = 1; |
| [9297](#L9297) | } |
| [9298](#L9298) | }); |
| [9299](#L9299) |  |
| [9300](#L9300) | if(bookingpress\_is\_validate == 0 && is\_strict\_validate == 1){ |
| [9301](#L9301) | var customer\_form = "appointment\_step\_form\_data"; |
| [9302](#L9302) | vm.$refs[customer\_form].validate((valid) => { |
| [9303](#L9303) | if (!valid) { |
| [9304](#L9304) | bookingpress\_is\_validate = 1; |
| [9305](#L9305) | }else{ |
| [9306](#L9306) | bookingpress\_is\_validate = 0; |
| [9307](#L9307) | } |
| [9308](#L9308) | }); |
| [9309](#L9309) | } |
| [9310](#L9310) | }else{ |
| [9311](#L9311) | if(is\_strict\_validate == 1){ |
| [9312](#L9312) | bookingpress\_validate\_fields\_arr.forEach(function(currentValue, index, arr){ |
| [9313](#L9313) | if(vm.bookingpress\_current\_tab == vm.bookingpress\_current\_tab && vm.appointment\_step\_form\_data[currentValue] == "" && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9314](#L9314) | if( currentValue == "selected\_start\_time" && vm.appointment\_step\_form\_data[currentValue] == "" ) { |
| [9315](#L9315) | if( vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [9316](#L9316) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9317](#L9317) | bookingpress\_is\_validate = 1; |
| [9318](#L9318) | } |
| [9319](#L9319) | } else { |
| [9320](#L9320) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9321](#L9321) | bookingpress\_is\_validate = 1; |
| [9322](#L9322) | } |
| [9323](#L9323) |  |
| [9324](#L9324) | '. $bookingpress\_validation\_for\_outside\_step\_change\_filter.' |
| [9325](#L9325) | } |
| [9326](#L9326) | }); |
| [9327](#L9327) | } |
| [9328](#L9328) |  |
| [9329](#L9329) | '.$bookingpress\_dynamic\_validation\_for\_step\_change.' |
| [9330](#L9330) | } |
| [9331](#L9331) | if( "service" == current\_tab && "service" != vm.bookingpress\_current\_tab ){ |
| [9332](#L9332) | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date+"T00:00:00+00:00"; |
| [9333](#L9333) | var bookingpress\_disable\_dates\_arr = vm.days\_off\_disabled\_dates.split(","); |
| [9334](#L9334) | if(bookingpress\_disable\_dates\_arr.includes(bookingpress\_selected\_date)){ |
| [9335](#L9335) | let newDate = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [9336](#L9336) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [9337](#L9337) | if( !pattern.test( newDate ) ){ |
| [9338](#L9338) |  |
| [9339](#L9339) | let sel\_month = newDate.getMonth() + 1; |
| [9340](#L9340) | let sel\_year = newDate.getFullYear(); |
| [9341](#L9341) | let sel\_date = newDate.getDate(); |
| [9342](#L9342) |  |
| [9343](#L9343) | if( sel\_month < 10 ){ |
| [9344](#L9344) | sel\_month = "0" + sel\_month; |
| [9345](#L9345) | } |
| [9346](#L9346) |  |
| [9347](#L9347) | if( sel\_date < 10 ){ |
| [9348](#L9348) | sel\_date = "0" + sel\_date; |
| [9349](#L9349) | } |
| [9350](#L9350) |  |
| [9351](#L9351) | newDate = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [9352](#L9352) | } |
| [9353](#L9353) |  |
| [9354](#L9354) | vm.appointment\_step\_form\_data.selected\_date = newDate; |
| [9355](#L9355) | } |
| [9356](#L9356) | } |
| [9357](#L9357) |  |
| [9358](#L9358) | if( ("basic\_details" == current\_tab && "service" == vm.bookingpress\_current\_tab) || ("summary" == current\_tab && "service" == vm.bookingpress\_current\_tab) ){ |
| [9359](#L9359) | if(vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [9360](#L9360) | if(vm.appointment\_step\_form\_data.selected\_start\_time == ""){ |
| [9361](#L9361) | bookingpress\_is\_validate = 1; |
| [9362](#L9362) | } |
| [9363](#L9363) | } |
| [9364](#L9364) | } |
| [9365](#L9365) |  |
| [9366](#L9366) | if(bookingpress\_is\_validate == 0){ |
| [9367](#L9367) | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
| [9368](#L9368) | let current\_selected\_tab = vm.bookingpress\_current\_tab; |
| [9369](#L9369) | vm.bookingpress\_current\_tab = current\_tab; |
| [9370](#L9370) | vm.bookingpress\_next\_tab = next\_tab; |
| [9371](#L9371) | vm.bookngpress\_previous\_tab = previous\_tab; |
| [9372](#L9372) | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
| [9373](#L9373) |  |
| [9374](#L9374) | if( "datetime" == current\_tab ){ |
| [9375](#L9375) | let selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [9376](#L9376) | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
| [9377](#L9377) | } |
| [9378](#L9378) | } |
| [9379](#L9379) |  |
| [9380](#L9380) | if( window.innerWidth <= 576 ){ |
| [9381](#L9381) | let container = vm.$el; |
| [9382](#L9382) | let pos = 0; |
| [9383](#L9383) | if( null != container ){ |
| [9384](#L9384) | pos = container.getBoundingClientRect().top + window.scrollY; |
| [9385](#L9385) | } |
| [9386](#L9386) |  |
| [9387](#L9387) | const myVar = Error().stack; |
| [9388](#L9388) | let allow\_scroll = true; |
| [9389](#L9389) | if( /mounted/.test( myVar ) ){ |
| [9390](#L9390) | allow\_scroll = false; |
| [9391](#L9391) | } |
| [9392](#L9392) | if( allow\_scroll ){ |
| [9393](#L9393) | setTimeout(function(){ |
| [9394](#L9394) | window.scrollTo({ |
| [9395](#L9395) | top: pos, |
| [9396](#L9396) | behavior: "smooth", |
| [9397](#L9397) | }); |
| [9398](#L9398) | }, 500); |
| [9399](#L9399) | } |
| [9400](#L9400) | } |
| [9401](#L9401) |  |
| [9402](#L9402) | if( "summary" == current\_tab && "summary" == vm.bookingpress\_current\_tab ) { |
| [9403](#L9403) |  |
| [9404](#L9404) | const vm = this; |
| [9405](#L9405) | var total\_payment\_div\_count = document.querySelectorAll(".bpa-front-module--pm-body\_\_item").length; |
| [9406](#L9406) |  |
| [9407](#L9407) | if(total\_payment\_div\_count == 1){ |
| [9408](#L9408) | var total\_payment\_div = document.querySelector(".bpa-front-module--pm-body\_\_item"); |
| [9409](#L9409) | if( null != total\_payment\_div && "undefined" != typeof total\_payment\_div) { |
| [9410](#L9410) | vm.prevent\_verification\_on\_load = true; |
| [9411](#L9411) | total\_payment\_div.click(); |
| [9412](#L9412) | vm.prevent\_verification\_on\_load = false; |
| [9413](#L9413) | } |
| [9414](#L9414) | } |
| [9415](#L9415) |  |
| [9416](#L9416) | '.$bookingpress\_change\_on\_summary\_steps\_filter.' |
| [9417](#L9417) |  |
| [9418](#L9418) | if( total\_payment\_div\_count == 0 && vm.is\_only\_onsite\_enabled == "1" ){ |
| [9419](#L9419) | vm.appointment\_step\_form\_data.selected\_payment\_method = "on-site"; |
| [9420](#L9420) | vm.skip\_checking\_final\_step\_validation = true; |
| [9421](#L9421) | vm.select\_payment\_method("on-site"); |
| [9422](#L9422) | } |
| [9423](#L9423) | } |
| [9424](#L9424) |  |
| [9425](#L9425) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.'; |
| [9426](#L9426) | }, |
| [9427](#L9427) | bookingpress\_select\_multi\_day\_range(day = ""){ |
| [9428](#L9428) | const vm = this; |
| [9429](#L9429) | if(vm.appointment\_step\_form\_data.selected\_date){ |
| [9430](#L9430) | day = vm.appointment\_step\_form\_data.selected\_date; |
| [9431](#L9431) | vm.bookingpress\_selected\_date\_range = []; |
| [9432](#L9432) | if(vm.appointment\_step\_form\_data.selected\_service\_duration\_unit == "d"){ |
| [9433](#L9433) | vm.appointment\_step\_form\_data.selected\_end\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [9434](#L9434) | var selected\_date = new Date(day); |
| [9435](#L9435) | var selected\_service\_duration = vm.appointment\_step\_form\_data.selected\_service\_duration; |
| [9436](#L9436) | var bookingpress\_selected\_date\_range = []; |
| [9437](#L9437) |  |
| [9438](#L9438) | var new\_date = new Date(day + " 00:00:00"); |
| [9439](#L9439) | bookingpress\_selected\_date\_range.push(day); |
| [9440](#L9440) | for(var i = 1; i < selected\_service\_duration; i++) { |
| [9441](#L9441) | new\_date.setDate(new\_date.getDate() + 1); |
| [9442](#L9442) | var month = "" + (new\_date.getMonth() + 1), |
| [9443](#L9443) | day = "" + new\_date.getDate(), |
| [9444](#L9444) | year = new\_date.getFullYear(); |
| [9445](#L9445) | if (month.length < 2){ |
| [9446](#L9446) | month = "0" + month; |
| [9447](#L9447) | } |
| [9448](#L9448) | if (day.length < 2){ |
| [9449](#L9449) | day = "0" + day; |
| [9450](#L9450) | } |
| [9451](#L9451) | var add\_date = [year, month, day].join("-"); |
| [9452](#L9452) | bookingpress\_selected\_date\_range.push(add\_date); |
| [9453](#L9453) | if(i == selected\_service\_duration-1) { |
| [9454](#L9454) | vm.appointment\_step\_form\_data.selected\_end\_date = add\_date; |
| [9455](#L9455) | } |
| [9456](#L9456) | } |
| [9457](#L9457) | if(bookingpress\_selected\_date\_range.length > 0){ |
| [9458](#L9458) | vm.bookingpress\_selected\_date\_range = bookingpress\_selected\_date\_range; |
| [9459](#L9459) | } |
| [9460](#L9460) | } |
| [9461](#L9461) | } |
| [9462](#L9462) | },'; |
| [9463](#L9463) |  |
| [9464](#L9464) | $bookingpress\_vue\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_vue\_methods', $bookingpress\_vue\_methods\_data); |
| [9465](#L9465) |  |
| [9466](#L9466) | return $bookingpress\_vue\_methods\_data; |
| [9467](#L9467) | } |
| [9468](#L9468) |  |
| [9469](#L9469) | /\*\* |
| [9470](#L9470) | \* My Appointments Shortcode Data Fields function |
| [9471](#L9471) | \* |
| [9472](#L9472) | \* @return void |
| [9473](#L9473) | \*/ |
| [9474](#L9474) | function bookingpress\_front\_appointments\_dynamic\_data\_fields\_func() |
| [9475](#L9475) | { |
| [9476](#L9476) | global $bookingpress\_front\_appointment\_vue\_data\_fields, $BookingPress, $bookingpress\_global\_options; |
| [9477](#L9477) | $default\_daysoff\_details = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [9478](#L9478) | if (! empty($default\_daysoff\_details) ) { |
| [9479](#L9479) | $default\_daysoff\_details = array\_map( |
| [9480](#L9480) | function ( $date ) { |
| [9481](#L9481) | return date('Y-m-d', strtotime($date)); |
| [9482](#L9482) | }, |
| [9483](#L9483) | $default\_daysoff\_details |
| [9484](#L9484) | ); |
| [9485](#L9485) | $bookingpress\_front\_appointment\_vue\_data\_fields['disabledDates'] = $default\_daysoff\_details; |
| [9486](#L9486) | } else { |
| [9487](#L9487) | $bookingpress\_front\_appointment\_vue\_data\_fields['disabledDates'] = ''; |
| [9488](#L9488) | } |
| [9489](#L9489) |  |
| [9490](#L9490) | $bookingpress\_mybooking\_title\_text      = $BookingPress->bookingpress\_get\_customize\_settings('mybooking\_title\_text', 'booking\_my\_booking'); |
| [9491](#L9491) | $bookingpress\_hide\_customer\_details     = $BookingPress->bookingpress\_get\_customize\_settings('hide\_customer\_details', 'booking\_my\_booking'); |
| [9492](#L9492) | $bookingpress\_allow\_cancel\_appointments = $BookingPress->bookingpress\_get\_customize\_settings('allow\_to\_cancel\_appointment', 'booking\_my\_booking'); |
| [9493](#L9493) | $bookingpress\_reset\_button\_label        = $BookingPress->bookingpress\_get\_customize\_settings('reset\_button\_title', 'booking\_my\_booking'); |
| [9494](#L9494) | $bookingpress\_apply\_button\_label        = $BookingPress->bookingpress\_get\_customize\_settings('apply\_button\_title', 'booking\_my\_booking'); |
| [9495](#L9495) | $bookingpress\_search\_appointment\_label  = $BookingPress->bookingpress\_get\_customize\_settings('search\_appointment\_title', 'booking\_my\_booking'); |
| [9496](#L9496) | $bookingpress\_search\_date\_title  = $BookingPress->bookingpress\_get\_customize\_settings('search\_date\_title', 'booking\_my\_booking'); |
| [9497](#L9497) | $bookingpress\_search\_end\_date\_title  = $BookingPress->bookingpress\_get\_customize\_settings('search\_end\_date\_title', 'booking\_my\_booking'); |
| [9498](#L9498) | $bookingpress\_my\_appointment\_menu\_title  = $BookingPress->bookingpress\_get\_customize\_settings('my\_appointment\_menu\_title', 'booking\_my\_booking'); |
| [9499](#L9499) | $bookingpress\_delete\_appointment\_menu\_title  = $BookingPress->bookingpress\_get\_customize\_settings('delete\_appointment\_menu\_title', 'booking\_my\_booking'); |
| [9500](#L9500) | $confirmation\_message\_for\_the\_cancel\_appointment = $BookingPress->bookingpress\_get\_settings('confirmation\_message\_for\_the\_cancel\_appointment', 'message\_setting'); |
| [9501](#L9501) |  |
| [9502](#L9502) | $bookingpress\_mybooking\_title\_text = !empty($bookingpress\_mybooking\_title\_text) ? stripslashes\_deep($bookingpress\_mybooking\_title\_text) : ''; |
| [9503](#L9503) | $bookingpress\_reset\_button\_label = !empty($bookingpress\_reset\_button\_label) ? stripslashes\_deep($bookingpress\_reset\_button\_label) : ''; |
| [9504](#L9504) | $bookingpress\_apply\_button\_label = !empty($bookingpress\_apply\_button\_label) ? stripslashes\_deep($bookingpress\_apply\_button\_label) : ''; |
| [9505](#L9505) | $bookingpress\_search\_appointment\_label = !empty($bookingpress\_search\_appointment\_label) ? stripslashes\_deep($bookingpress\_search\_appointment\_label) : ''; |
| [9506](#L9506) | $bookingpress\_search\_date\_title = !empty($bookingpress\_search\_date\_title) ? stripslashes\_deep($bookingpress\_search\_date\_title) : ''; |
| [9507](#L9507) | $bookingpress\_search\_end\_date\_title = !empty($bookingpress\_search\_end\_date\_title) ? stripslashes\_deep($bookingpress\_search\_end\_date\_title) : ''; |
| [9508](#L9508) | $bookingpress\_my\_appointment\_menu\_title = !empty($bookingpress\_my\_appointment\_menu\_title) ? stripslashes\_deep($bookingpress\_my\_appointment\_menu\_title) : ''; |
| [9509](#L9509) | $bookingpress\_delete\_appointment\_menu\_title = !empty($bookingpress\_delete\_appointment\_menu\_title) ? stripslashes\_deep($bookingpress\_delete\_appointment\_menu\_title) : ''; |
| [9510](#L9510) | $confirmation\_message\_for\_the\_cancel\_appointment = !empty($confirmation\_message\_for\_the\_cancel\_appointment) ? stripslashes\_deep($confirmation\_message\_for\_the\_cancel\_appointment) : ''; |
| [9511](#L9511) | $bookingpress\_hide\_customer\_details = $bookingpress\_hide\_customer\_details = ( $bookingpress\_hide\_customer\_details == 'true' ) ? 1 : 0; |
| [9512](#L9512) | $bookingpress\_allow\_cancel\_appointments = $bookingpress\_allow\_cancel\_appointments = ( $bookingpress\_allow\_cancel\_appointments == 'true' ) ? 1 : 0; |
| [9513](#L9513) |  |
| [9514](#L9514) | $bookingpress\_front\_appointment\_vue\_data\_fields['mybooking\_title\_text'] = $bookingpress\_mybooking\_title\_text; |
| [9515](#L9515) | $bookingpress\_front\_appointment\_vue\_data\_fields['hide\_customer\_details'] = $bookingpress\_hide\_customer\_details; |
| [9516](#L9516) | $bookingpress\_front\_appointment\_vue\_data\_fields['allow\_cancel\_appointments'] = $bookingpress\_allow\_cancel\_appointments; |
| [9517](#L9517) | $bookingpress\_front\_appointment\_vue\_data\_fields['reset\_button\_title'] = $bookingpress\_reset\_button\_label; |
| [9518](#L9518) | $bookingpress\_front\_appointment\_vue\_data\_fields['apply\_button\_title'] = $bookingpress\_apply\_button\_label; |
| [9519](#L9519) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_appointment\_title'] = $bookingpress\_search\_appointment\_label; |
| [9520](#L9520) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_date\_title'] = $bookingpress\_search\_date\_title; |
| [9521](#L9521) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_end\_date\_title'] = $bookingpress\_search\_end\_date\_title; |
| [9522](#L9522) | $bookingpress\_front\_appointment\_vue\_data\_fields['my\_appointment\_menu\_title'] = $bookingpress\_my\_appointment\_menu\_title; |
| [9523](#L9523) | $bookingpress\_front\_appointment\_vue\_data\_fields['delete\_appointment\_menu\_title'] = $bookingpress\_delete\_appointment\_menu\_title; |
| [9524](#L9524) | $bookingpress\_front\_appointment\_vue\_data\_fields['confirmation\_message\_for\_the\_cancel\_appointment'] = $confirmation\_message\_for\_the\_cancel\_appointment; |
| [9525](#L9525) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_is\_user\_logged\_in'] =  is\_user\_logged\_in() ? '1' : '0'; |
| [9526](#L9526) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_user\_fullname'] =  ''; |
| [9527](#L9527) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_user\_email'] =  ''; |
| [9528](#L9528) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_avatar\_url'] = ''; |
| [9529](#L9529) |  |
| [9530](#L9530) |  |
| [9531](#L9531) | $bookingpress\_front\_appointment\_vue\_data\_fields["current\_screen\_size"] = ""; |
| [9532](#L9532) | $bookingpress\_front\_appointment\_vue\_data\_fields["container\_size"] = ""; |
| [9533](#L9533) |  |
| [9534](#L9534) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_myappointment\_footer\_dynamic\_class'] = ''; |
| [9535](#L9535) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_myappointment\_header\_dynamic\_class'] = ''; |
| [9536](#L9536) |  |
| [9537](#L9537) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_my\_booking\_current\_tab'] = 'my\_appointment'; |
| [9538](#L9538) |  |
| [9539](#L9539) | $bookingpress\_global\_options\_arr = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9540](#L9540) | $bookingpress\_default\_date\_format = $BookingPress->bookingpress\_check\_common\_date\_format($bookingpress\_global\_options\_arr['wp\_default\_date\_format']); |
| [9541](#L9541) |  |
| [9542](#L9542) | $bookingpress\_front\_appointment\_vue\_data\_fields['masks'] = array( |
| [9543](#L9543) | 'input' => strtoupper($bookingpress\_default\_date\_format), |
| [9544](#L9544) | ); |
| [9545](#L9545) |  |
| [9546](#L9546) | $bpa\_default\_date\_format = $BookingPress->bookingpress\_get\_settings( 'default\_date\_format', 'general\_setting' ); |
| [9547](#L9547) |  |
| [9548](#L9548) | $bookingpress\_front\_appointment\_vue\_data\_fields['bpa\_front\_date\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ) : $bookingpress\_default\_date\_format; |
| [9549](#L9549) |  |
| [9550](#L9550) | $bookingpress\_front\_appointment\_vue\_data\_fields['bpa\_front\_date\_time\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ).' HH:mm' : $bookingpress\_default\_date\_format.' HH:mm'; |
| [9551](#L9551) |  |
| [9552](#L9552) | $bookingpress\_delete\_account\_content  = $BookingPress->bookingpress\_get\_customize\_settings('delete\_account\_content', 'booking\_my\_booking'); |
| [9553](#L9553) | $bookingpress\_front\_appointment\_vue\_data\_fields['delete\_account\_content'] = do\_shortcode(stripslashes($bookingpress\_delete\_account\_content)); |
| [9554](#L9554) |  |
| [9555](#L9555) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_cancel\_appointment\_drawer'] = false; |
| [9556](#L9556) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_cancel\_drawer\_direction'] = 'btt'; |
| [9557](#L9557) |  |
| [9558](#L9558) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_previous\_row\_obj'] = ''; |
| [9559](#L9559) |  |
| [9560](#L9560) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_created\_nonce'] = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [9561](#L9561) |  |
| [9562](#L9562) | $bookingpress\_front\_appointment\_vue\_data\_fields['is\_display\_pagination'] = 0; |
| [9563](#L9563) |  |
| [9564](#L9564) | $bookingpress\_front\_appointment\_vue\_data\_fields['disable\_my\_appointments\_apply'] = false; |
| [9565](#L9565) |  |
| [9566](#L9566) | $bookingpress\_front\_appointment\_vue\_data\_fields = apply\_filters('bookingpress\_front\_appointment\_add\_dynamic\_data', $bookingpress\_front\_appointment\_vue\_data\_fields); |
| [9567](#L9567) |  |
| [9568](#L9568) | echo wp\_json\_encode($bookingpress\_front\_appointment\_vue\_data\_fields); |
| [9569](#L9569) | } |
| [9570](#L9570) |  |
| [9571](#L9571) | /\*\* |
| [9572](#L9572) | \* My Appointments Shortcode Helper Variables |
| [9573](#L9573) | \* |
| [9574](#L9574) | \* @return void |
| [9575](#L9575) | \*/ |
| [9576](#L9576) | function bookingpress\_front\_appointments\_dynamic\_helper\_vars\_func() |
| [9577](#L9577) | { |
| [9578](#L9578) | global $bookingpress\_global\_options; |
| [9579](#L9579) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9580](#L9580) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [9581](#L9581) | ?> |
| [9582](#L9582) | var lang = ELEMENT.lang.<?php echo esc\_html($bookingpress\_locale\_lang); ?>; |
| [9583](#L9583) | ELEMENT.locale(lang); |
| [9584](#L9584) | <?php |
| [9585](#L9585) | do\_action('bookingpress\_add\_front\_appointment\_helper\_vars'); |
| [9586](#L9586) | } |
| [9587](#L9587) |  |
| [9588](#L9588) | /\*\* |
| [9589](#L9589) | \* My Appointments Shortcode On Load Methods |
| [9590](#L9590) | \* |
| [9591](#L9591) | \* @return void |
| [9592](#L9592) | \*/ |
| [9593](#L9593) | function bookingpress\_front\_appointments\_dynamic\_on\_load\_methods\_func() |
| [9594](#L9594) | {   if(is\_user\_logged\_in()) { |
| [9595](#L9595) | ?> |
| [9596](#L9596) | this.loadFrontAppointments(); |
| [9597](#L9597) | <?php |
| [9598](#L9598) | } |
| [9599](#L9599) | ?> |
| [9600](#L9600) | this.bookingpress\_load\_mybooking\_form(); |
| [9601](#L9601) | this.bookingpress\_myappointments\_onload\_func(); |
| [9602](#L9602) | this.bookingpress\_dynamic\_add\_onload\_myappointment\_methods\_func(); |
| [9603](#L9603) | <?php |
| [9604](#L9604) | do\_action('bookingpress\_dynamic\_add\_onload\_myappointment\_methods'); |
| [9605](#L9605) | } |
| [9606](#L9606) |  |
| [9607](#L9607) | /\*\* |
| [9608](#L9608) | \* My Appointments methods or functions |
| [9609](#L9609) | \* |
| [9610](#L9610) | \* @return void |
| [9611](#L9611) | \*/ |
| [9612](#L9612) | function bookingpress\_front\_appointments\_dynamic\_vue\_methods\_func() |
| [9613](#L9613) | { |
| [9614](#L9614) |  |
| [9615](#L9615) | global $BookingPress, $bookingpress\_global\_options; |
| [9616](#L9616) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [9617](#L9617) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [9618](#L9618) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [9619](#L9619) |  |
| [9620](#L9620) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [9621](#L9621) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [9622](#L9622) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [9623](#L9623) |  |
| [9624](#L9624) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [9625](#L9625) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [9626](#L9626) |  |
| [9627](#L9627) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9628](#L9628) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [9629](#L9629) |  |
| [9630](#L9630) | $convert\_timeslot\_to\_client\_timezone = false; |
| [9631](#L9631) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [9632](#L9632) | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
| [9633](#L9633) | } |
| [9634](#L9634) |  |
| [9635](#L9635) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [9636](#L9636) | ?> |
| [9637](#L9637) | bookingpress\_toggle\_calendar(){ |
| [9638](#L9638) | const vm = this; |
| [9639](#L9639) | vm.$refs.bookingpress\_range\_calendar.togglePopover(); |
| [9640](#L9640) | }, |
| [9641](#L9641) | bookingpress\_clear\_datepicker(){ |
| [9642](#L9642) | const vm = this; |
| [9643](#L9643) | vm.appointment\_date\_range = ''; |
| [9644](#L9644) | }, |
| [9645](#L9645) | bookingpress\_working\_dates\_data\_single( working\_hour\_details, wdate, timeslot ){ |
| [9646](#L9646) |  |
| [9647](#L9647) | const vm = this; |
| [9648](#L9648) | let startTime = timeslot.start\_time || "00:00:00"; |
| [9649](#L9649) | let endTime = timeslot.end\_time || "00:00:00"; |
| [9650](#L9650) |  |
| [9651](#L9651) | let response = {}; |
| [9652](#L9652) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [9653](#L9653) |  |
| [9654](#L9654) | if( wh\_data.store\_start\_time == startTime && wh\_data.store\_end\_time == endTime ){ |
| [9655](#L9655) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9656](#L9656) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [9657](#L9657) | let timezone = wh\_data.store\_offset; |
| [9658](#L9658) |  |
| [9659](#L9659) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9660](#L9660) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9661](#L9661) |  |
| [9662](#L9662) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [9663](#L9663) |  |
| [9664](#L9664) | response.selected\_date = updated\_wdate; |
| [9665](#L9665) | response.start\_time = stTime; |
| [9666](#L9666) | response.end\_time = etTime; |
| [9667](#L9667) | } |
| [9668](#L9668) |  |
| [9669](#L9669) | } |
| [9670](#L9670) |  |
| [9671](#L9671) | return response; |
| [9672](#L9672) | }, |
| [9673](#L9673) | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
| [9674](#L9674) | const vm = this; |
| [9675](#L9675) |  |
| [9676](#L9676) | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
| [9677](#L9677) | let is\_client\_timezone = "<?php echo $convert\_timeslot\_to\_client\_timezone; ?>"; |
| [9678](#L9678) | let updated\_working\_hour\_details = {}; |
| [9679](#L9679) | let available\_dates = []; |
| [9680](#L9680) | let response = {}; |
| [9681](#L9681) | let firstAvailableDate = ""; |
| [9682](#L9682) |  |
| [9683](#L9683) | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
| [9684](#L9684) |  |
| [9685](#L9685) | let sorted\_working\_hours = []; |
| [9686](#L9686) |  |
| [9687](#L9687) | for( let wdate in working\_hour\_details ){ |
| [9688](#L9688) | let x = 0; |
| [9689](#L9689) | let n = 0; |
| [9690](#L9690) |  |
| [9691](#L9691) | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
| [9692](#L9692) |  |
| [9693](#L9693) | let overnight\_booking\_date = ""; |
| [9694](#L9694) |  |
| [9695](#L9695) | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
| [9696](#L9696) |  |
| [9697](#L9697) | sorted\_working\_hours[wdate].sort( (a,b) => { |
| [9698](#L9698) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [9699](#L9699) | } ); |
| [9700](#L9700) |  |
| [9701](#L9701) | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
| [9702](#L9702) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9703](#L9703) | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
| [9704](#L9704) | let timezone = wh\_data.store\_offset; |
| [9705](#L9705) |  |
| [9706](#L9706) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9707](#L9707) | wh\_data.client\_start\_time = stTime; |
| [9708](#L9708) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9709](#L9709) | wh\_data.client\_end\_time = etTime; |
| [9710](#L9710) |  |
| [9711](#L9711) | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
| [9712](#L9712) | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
| [9713](#L9713) |  |
| [9714](#L9714) | let updated\_wdate; |
| [9715](#L9715) | if( "string" == typeof stTimeNew ){ |
| [9716](#L9716) | updated\_wdate = wdate; |
| [9717](#L9717) | } else { |
| [9718](#L9718) | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
| [9719](#L9719) | } |
| [9720](#L9720) | let updated\_edate; |
| [9721](#L9721) | if( "string" == typeof etTimeNew ){ |
| [9722](#L9722) | updated\_edate = wh\_data.selected\_end\_date; |
| [9723](#L9723) | } else { |
| [9724](#L9724) | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
| [9725](#L9725) | } |
| [9726](#L9726) |  |
| [9727](#L9727) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [9728](#L9728) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [9729](#L9729) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9730](#L9730) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [9731](#L9731) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9732](#L9732) | } |
| [9733](#L9733) | n++; |
| [9734](#L9734) | } else { |
| [9735](#L9735) | continue; |
| [9736](#L9736) | } |
| [9737](#L9737) | } else { |
| [9738](#L9738) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [9739](#L9739) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9740](#L9740) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [9741](#L9741) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9742](#L9742) | } |
| [9743](#L9743) | n++; |
| [9744](#L9744) | } |
| [9745](#L9745) | } |
| [9746](#L9746) |  |
| [9747](#L9747) | if( "" == firstAvailableDate ){ |
| [9748](#L9748) | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
| [9749](#L9749) | } |
| [9750](#L9750) |  |
| [9751](#L9751) | wh\_data.client\_date = updated\_wdate; |
| [9752](#L9752) | wh\_data.client\_end\_date = updated\_edate; |
| [9753](#L9753) |  |
| [9754](#L9754) | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
| [9755](#L9755) | overnight\_booking\_date = updated\_wdate; |
| [9756](#L9756) | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
| [9757](#L9757) | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
| [9758](#L9758) | } |
| [9759](#L9759) | } |
| [9760](#L9760) | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
| [9761](#L9761) |  |
| [9762](#L9762) | if( true == is\_overnight\_booking ){ |
| [9763](#L9763) |  |
| [9764](#L9764) | if( "true" == is\_client\_timezone ){ |
| [9765](#L9765) | wh\_data.is\_next\_day = false; |
| [9766](#L9766) | } |
| [9767](#L9767) |  |
| [9768](#L9768) | if( updated\_edate > updated\_wdate ){ |
| [9769](#L9769) | wh\_data.is\_next\_day = true; |
| [9770](#L9770) | } |
| [9771](#L9771) |  |
| [9772](#L9772) | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
| [9773](#L9773) | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
| [9774](#L9774) | wh\_data.is\_next\_day = true; |
| [9775](#L9775) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [9776](#L9776) | } |
| [9777](#L9777) | } |
| [9778](#L9778) |  |
| [9779](#L9779) | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
| [9780](#L9780) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [9781](#L9781) | } |
| [9782](#L9782) |  |
| [9783](#L9783) | let startTimeHour = stTime.split(":")[0]; |
| [9784](#L9784) |  |
| [9785](#L9785) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [9786](#L9786) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [9787](#L9787) |  |
| [9788](#L9788) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9789](#L9789) | if( "1" == timeformat || "2" == timeformat ){ |
| [9790](#L9790) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [9791](#L9791) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [9792](#L9792) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9793](#L9793) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [9794](#L9794) | formatted\_datetime = formatted\_startTime; |
| [9795](#L9795) | } |
| [9796](#L9796) |  |
| [9797](#L9797) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [9798](#L9798) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [9799](#L9799) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [9800](#L9800) | wh\_data.start\_hour = startTimeHour; |
| [9801](#L9801) |  |
| [9802](#L9802) | if( true == is\_overnight\_booking ){ |
| [9803](#L9803) | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
| [9804](#L9804) | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
| [9805](#L9805) | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
| [9806](#L9806) | } |
| [9807](#L9807) | } else { |
| [9808](#L9808) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [9809](#L9809) | } |
| [9810](#L9810) |  |
| [9811](#L9811) | x++; |
| [9812](#L9812) | } |
| [9813](#L9813) | } |
| [9814](#L9814) |  |
| [9815](#L9815) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [9816](#L9816) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [9817](#L9817) |  |
| [9818](#L9818) | response.available\_dates = available\_dates; |
| [9819](#L9819) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [9820](#L9820) | response.selected\_date = firstAvailableDate; |
| [9821](#L9821) |  |
| [9822](#L9822) | return response; |
| [9823](#L9823) | }, |
| [9824](#L9824) | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
| [9825](#L9825) | const vm = this; |
| [9826](#L9826) | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
| [9827](#L9827) | let updated\_working\_hour\_details = {}; |
| [9828](#L9828) | let available\_dates = []; |
| [9829](#L9829) | let response = {}; |
| [9830](#L9830) | let firstAvailableDate = ""; |
| [9831](#L9831) | for( let wdate in working\_hour\_details ){ |
| [9832](#L9832) | let x = 0; |
| [9833](#L9833) | let n = 0; |
| [9834](#L9834) |  |
| [9835](#L9835) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [9836](#L9836) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9837](#L9837) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [9838](#L9838) | let timezone = wh\_data.store\_offset; |
| [9839](#L9839) |  |
| [9840](#L9840) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9841](#L9841) | wh\_data.client\_start\_time = stTime; |
| [9842](#L9842) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9843](#L9843) | wh\_data.client\_end\_time = etTime; |
| [9844](#L9844) |  |
| [9845](#L9845) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [9846](#L9846) |  |
| [9847](#L9847) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [9848](#L9848) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9849](#L9849) |  |
| [9850](#L9850) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9851](#L9851) | n++; |
| [9852](#L9852) | } |
| [9853](#L9853) |  |
| [9854](#L9854) | if( "" == firstAvailableDate ){ |
| [9855](#L9855) | firstAvailableDate = updated\_wdate; |
| [9856](#L9856) | } |
| [9857](#L9857) |  |
| [9858](#L9858) | wh\_data.client\_date = updated\_wdate; |
| [9859](#L9859) |  |
| [9860](#L9860) | let startTimeHour = stTime.split(":")[0]; |
| [9861](#L9861) |  |
| [9862](#L9862) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [9863](#L9863) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [9864](#L9864) |  |
| [9865](#L9865) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9866](#L9866) | if( "1" == timeformat || "2" == timeformat ){ |
| [9867](#L9867) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [9868](#L9868) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [9869](#L9869) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9870](#L9870) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [9871](#L9871) | formatted\_datetime = formatted\_startTime; |
| [9872](#L9872) | } |
| [9873](#L9873) |  |
| [9874](#L9874) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [9875](#L9875) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [9876](#L9876) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [9877](#L9877) | wh\_data.start\_hour = startTimeHour; |
| [9878](#L9878) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [9879](#L9879) | x++; |
| [9880](#L9880) | } |
| [9881](#L9881) | } |
| [9882](#L9882) |  |
| [9883](#L9883) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [9884](#L9884) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [9885](#L9885) |  |
| [9886](#L9886) | response.available\_dates = available\_dates; |
| [9887](#L9887) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [9888](#L9888) | response.selected\_date = firstAvailableDate; |
| [9889](#L9889) |  |
| [9890](#L9890) | return response; |
| [9891](#L9891) | }, |
| [9892](#L9892) | bookingpress\_format\_time(value){ |
| [9893](#L9893) | var default\_time\_format = "<?php echo esc\_html( $bookingpress\_formatted\_timeslot ); ?>"; |
| [9894](#L9894) | return moment(String(value), "HH:mm:ss").locale("<?php echo esc\_html( $bookingpress\_site\_current\_lang\_moment\_locale ); ?>").format(default\_time\_format) |
| [9895](#L9895) | }, |
| [9896](#L9896) | bookingpress\_categories\_timeslots( timeslot\_details ){ |
| [9897](#L9897) | let afternoon\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_afternoon\_solts\_timing); ?>" ); |
| [9898](#L9898) | let evening\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_evening\_solts\_timing); ?>" ); |
| [9899](#L9899) | let night\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_night\_solts\_timing); ?>" ); |
| [9900](#L9900) |  |
| [9901](#L9901) | if( "undefined" == typeof timeslot\_details ){ |
| [9902](#L9902) | return {}; |
| [9903](#L9903) | } |
| [9904](#L9904) |  |
| [9905](#L9905) | let service\_timings\_data = { |
| [9906](#L9906) | "morning\_time":[], |
| [9907](#L9907) | "afternoon\_time":[], |
| [9908](#L9908) | "evening\_time":[], |
| [9909](#L9909) | "night\_time":[] |
| [9910](#L9910) | }; |
| [9911](#L9911) | let x = 1; |
| [9912](#L9912) | for( let timeslot\_data of timeslot\_details ){ |
| [9913](#L9913) | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
| [9914](#L9914) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [9915](#L9915) | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
| [9916](#L9916) | service\_timings\_data.morning\_time.push( timeslot\_data ); |
| [9917](#L9917) | } else if( startHour >= afternoon\_slot\_timings && ( "" == evening\_slot\_timings || startHour < evening\_slot\_timings ) ){ |
| [9918](#L9918) | service\_timings\_data.afternoon\_time.push( timeslot\_data ); |
| [9919](#L9919) | } else if ( startHour >= evening\_slot\_timings && ( "" == night\_slot\_timings || startHour < night\_slot\_timings ) ){ |
| [9920](#L9920) | service\_timings\_data.evening\_time.push( timeslot\_data ); |
| [9921](#L9921) | } else { |
| [9922](#L9922) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [9923](#L9923) | } |
| [9924](#L9924) | x++; |
| [9925](#L9925) | } |
| [9926](#L9926) | } |
| [9927](#L9927) | if( timeslot\_details.length > x ){ |
| [9928](#L9928) | for( let timeslot\_data of timeslot\_details ){ |
| [9929](#L9929) | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
| [9930](#L9930) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [9931](#L9931) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [9932](#L9932) | } |
| [9933](#L9933) | } |
| [9934](#L9934) | } |
| [9935](#L9935) | return service\_timings\_data; |
| [9936](#L9936) | }, |
| [9937](#L9937) | bookingpress\_myappointments\_onload\_func(){ |
| [9938](#L9938) | const vm = this; |
| [9939](#L9939) | if(window.innerWidth <= 576){ |
| [9940](#L9940) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9941](#L9941) | var bookingpress\_uniq\_id = vm.bookingpress\_uniq\_id; |
| [9942](#L9942) | var bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9943](#L9943) | var bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9944](#L9944) | var bookingpress\_container\_top = bookingpress\_container\_vars - 20; |
| [9945](#L9945) | var current\_selected\_tab = vm.current\_selected\_tab\_id; |
| [9946](#L9946) | window.addEventListener("scroll", function(e){ |
| [9947](#L9947) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9948](#L9948) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9949](#L9949) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9950](#L9950) |  |
| [9951](#L9951) | var current\_position = window.scrollY; |
| [9952](#L9952) | if(current\_position >= bookingpress\_container\_top && current\_position <= bookingpress\_container\_bottom){ |
| [9953](#L9953) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9954](#L9954) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9955](#L9955) | }else{ |
| [9956](#L9956) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9957](#L9957) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9958](#L9958) | } |
| [9959](#L9959) | }); |
| [9960](#L9960) | } |
| [9961](#L9961) | window.addEventListener("resize", function(e){ |
| [9962](#L9962) | if(window.innerWidth <= 576){ |
| [9963](#L9963) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9964](#L9964) | var bookingpress\_uniq\_id = vm.bookingpress\_uniq\_id; |
| [9965](#L9965) |  |
| [9966](#L9966) | var bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9967](#L9967) | var bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight); |
| [9968](#L9968) | var bookingpress\_container\_top = bookingpress\_container\_vars - 20; |
| [9969](#L9969) |  |
| [9970](#L9970) |  |
| [9971](#L9971) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9972](#L9972) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9973](#L9973) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9974](#L9974) |  |
| [9975](#L9975) | var current\_position = window.scrollY; |
| [9976](#L9976) |  |
| [9977](#L9977) | if(current\_position >= bookingpress\_container\_top || current\_position <= bookingpress\_container\_bottom){ |
| [9978](#L9978) | if( current\_position > bookingpress\_container\_bottom || current\_position < bookingpress\_container\_top ){ |
| [9979](#L9979) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9980](#L9980) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9981](#L9981) | } else { |
| [9982](#L9982) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9983](#L9983) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9984](#L9984) | } |
| [9985](#L9985) | }else if(vm.bookingpress\_myappointment\_header\_dynamic\_class != ""){ |
| [9986](#L9986) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9987](#L9987) | }else{ |
| [9988](#L9988) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9989](#L9989) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9990](#L9990) | } |
| [9991](#L9991) |  |
| [9992](#L9992) | window.addEventListener("scroll", function(e){ |
| [9993](#L9993) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9994](#L9994) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9995](#L9995) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9996](#L9996) |  |
| [9997](#L9997) | var current\_position = window.scrollY; |
| [9998](#L9998) |  |
| [9999](#L9999) | if(current\_position >= bookingpress\_container\_top || current\_position <= bookingpress\_container\_bottom){ |
| [10000](#L10000) | if( current\_position > bookingpress\_container\_bottom || current\_position < bookingpress\_container\_top ){ |
| [10001](#L10001) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10002](#L10002) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10003](#L10003) | } else { |
| [10004](#L10004) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [10005](#L10005) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [10006](#L10006) | } |
| [10007](#L10007) | }else if(vm.bookingpress\_myappointment\_header\_dynamic\_class != ""){ |
| [10008](#L10008) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [10009](#L10009) | }else{ |
| [10010](#L10010) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10011](#L10011) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10012](#L10012) | } |
| [10013](#L10013) | }); |
| [10014](#L10014) | }else{ |
| [10015](#L10015) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10016](#L10016) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10017](#L10017) | } |
| [10018](#L10018) | }); |
| [10019](#L10019) | }, |
| [10020](#L10020) | bookingpress\_dynamic\_add\_onload\_myappointment\_methods\_func(){ |
| [10021](#L10021) | const vm = this; |
| [10022](#L10022) | vm.current\_screen\_size = "desktop"; |
| [10023](#L10023) | if(window.outerWidth >= 1200){ |
| [10024](#L10024) | vm.current\_screen\_size = "desktop"; |
| [10025](#L10025) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [10026](#L10026) | vm.current\_screen\_size = "tablet"; |
| [10027](#L10027) | }else if(window.outerWidth < 768){ |
| [10028](#L10028) | vm.current\_screen\_size = "mobile"; |
| [10029](#L10029) | } |
| [10030](#L10030) |  |
| [10031](#L10031) | window.addEventListener('resize', function(event) { |
| [10032](#L10032) | if(window.outerWidth >= 1200){ |
| [10033](#L10033) | vm.current\_screen\_size = "desktop"; |
| [10034](#L10034) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [10035](#L10035) | vm.current\_screen\_size = "tablet"; |
| [10036](#L10036) | }else if(window.outerWidth < 768){ |
| [10037](#L10037) | vm.current\_screen\_size = "mobile"; |
| [10038](#L10038) | } |
| [10039](#L10039) | /\* vm.current\_screen\_size = document.getElementById("bpa-front-customer-panel-container").offsetWidth; \*/ |
| [10040](#L10040) | }); |
| [10041](#L10041) | }, |
| [10042](#L10042) | toggleBusy() { |
| [10043](#L10043) | if(this.is\_display\_loader == '1'){ |
| [10044](#L10044) | this.is\_display\_loader = '0'; |
| [10045](#L10045) | }else{ |
| [10046](#L10046) | this.is\_display\_loader = '1'; |
| [10047](#L10047) | } |
| [10048](#L10048) | }, |
| [10049](#L10049) | bookingpress\_load\_mybooking\_form(){ |
| [10050](#L10050) | const vm = this; |
| [10051](#L10051) | setTimeout(function(){ |
| [10052](#L10052) | vm.is\_front\_appointment\_empty\_loader = "0"; |
| [10053](#L10053) | setTimeout(function(){ |
| [10054](#L10054) | if(document.getElementById("bpa-front-customer-panel-container") != null){ |
| [10055](#L10055) | document.getElementById("bpa-front-customer-panel-container").style.display = "block"; |
| [10056](#L10056) | } |
| [10057](#L10057) | if(document.getElementById("bpa-front-data-empty-view--my-bookings") != null){ |
| [10058](#L10058) | document.getElementById("bpa-front-data-empty-view--my-bookings").style.display = "flex"; |
| [10059](#L10059) | } |
| [10060](#L10060) | }, 500); |
| [10061](#L10061) | }, 1000); |
| [10062](#L10062) | }, |
| [10063](#L10063) | loadFrontAppointments( is\_display\_loader = 0 ) { |
| [10064](#L10064) |  |
| [10065](#L10065) | const vm = this; |
| [10066](#L10066) | vm.disable\_my\_appointments\_apply = true; |
| [10067](#L10067) | this.toggleBusy(); |
| [10068](#L10068) | var bookingpress\_search\_data = { 'search\_appointment':this.search\_appointment,'selected\_date\_range': this.appointment\_date\_range}; |
| [10069](#L10069) |  |
| [10070](#L10070) | if(is\_display\_loader == 1 ){ |
| [10071](#L10071) | vm.is\_front\_my\_appointment\_empty\_loader = "1"; |
| [10072](#L10072) | } |
| [10073](#L10073) |  |
| [10074](#L10074) | var bkp\_wpnonce\_pre = vm.bookingpress\_created\_nonce; |
| [10075](#L10075) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10076](#L10076) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10077](#L10077) | { |
| [10078](#L10078) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10079](#L10079) | } |
| [10080](#L10080) | else { |
| [10081](#L10081) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10082](#L10082) | } |
| [10083](#L10083) |  |
| [10084](#L10084) | var postData = { action:'bookingpress\_get\_customer\_appointments', perpage:this.per\_page, currentpage:this.currentPage, search\_data: bookingpress\_search\_data,\_wpnonce:bkp\_wpnonce\_pre\_fetch}; |
| [10085](#L10085) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [10086](#L10086) | .then( function (response) { |
| [10087](#L10087) | this.toggleBusy(); |
| [10088](#L10088) | vm.disable\_my\_appointments\_apply = false; |
| [10089](#L10089) | this.items = response.data.items; |
| [10090](#L10090) | this.total\_records = parseInt(response.data.total\_records); |
| [10091](#L10091) | this.is\_display\_pagination = 0; |
| [10092](#L10092) |  |
| [10093](#L10093) | if( is\_display\_loader == 1){ |
| [10094](#L10094) | vm.is\_front\_appointment\_empty\_loader = "0"; |
| [10095](#L10095) | vm.is\_front\_my\_appointment\_empty\_loader = "0"; |
| [10096](#L10096) | } |
| [10097](#L10097) |  |
| [10098](#L10098) | if(this.total\_records > 10) { |
| [10099](#L10099) | this.is\_display\_pagination = 1; |
| [10100](#L10100) | } |
| [10101](#L10101) |  |
| [10102](#L10102) | this.bookingpress\_user\_fullname = response.data.customer\_details.bookingpress\_user\_fullname; |
| [10103](#L10103) | this.bookingpress\_user\_email = response.data.customer\_details.bookingpress\_user\_email; |
| [10104](#L10104) | this.bookingpress\_avatar\_url = response.data.customer\_details.bookingpress\_avatar\_url; |
| [10105](#L10105) | this.bookingpress\_use\_placeholder = response.data.customer\_details.bookingpress\_use\_placeholder; |
| [10106](#L10106) | }.bind(this) ) |
| [10107](#L10107) | .catch( function (error) { |
| [10108](#L10108) | vm.disable\_my\_appointments\_apply = false; |
| [10109](#L10109) | vm.$notify({ |
| [10110](#L10110) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [10111](#L10111) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [10112](#L10112) | type: 'error', |
| [10113](#L10113) | customClass: 'error\_notification', |
| [10114](#L10114) | }); |
| [10115](#L10115) | }); |
| [10116](#L10116) | }, |
| [10117](#L10117) | get\_formatted\_date(iso\_date){ |
| [10118](#L10118) |  |
| [10119](#L10119) | if( true == /(\d{2})\T/.test( iso\_date ) ){ |
| [10120](#L10120) | let date\_time\_arr = iso\_date.split('T'); |
| [10121](#L10121) | return date\_time\_arr[0]; |
| [10122](#L10122) | } |
| [10123](#L10123) | var \_\_date = new Date(iso\_date); |
| [10124](#L10124) | var \_\_year = \_\_date.getFullYear(); |
| [10125](#L10125) | var \_\_month = \_\_date.getMonth()+1; |
| [10126](#L10126) | var \_\_day = \_\_date.getDate(); |
| [10127](#L10127) | if (\_\_day < 10) { |
| [10128](#L10128) | \_\_day = '0' + \_\_day; |
| [10129](#L10129) | } |
| [10130](#L10130) | if (\_\_month < 10) { |
| [10131](#L10131) | \_\_month = '0' + \_\_month; |
| [10132](#L10132) | } |
| [10133](#L10133) | var formatted\_date = \_\_year+'-'+\_\_month+'-'+\_\_day; |
| [10134](#L10134) | return formatted\_date; |
| [10135](#L10135) | }, |
| [10136](#L10136) | cancelAppointment( appointment\_id){ |
| [10137](#L10137) | const vm = new Vue(); |
| [10138](#L10138) | const vm2 = this; |
| [10139](#L10139) | vm2.is\_display\_loader = '1'; |
| [10140](#L10140) | vm2.is\_disabled = true; |
| [10141](#L10141) | var cancel\_id = appointment\_id; |
| [10142](#L10142) |  |
| [10143](#L10143) | var bkp\_wpnonce\_pre = vm2.bookingpress\_created\_nonce; |
| [10144](#L10144) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10145](#L10145) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10146](#L10146) | { |
| [10147](#L10147) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10148](#L10148) | } |
| [10149](#L10149) | else { |
| [10150](#L10150) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10151](#L10151) | } |
| [10152](#L10152) |  |
| [10153](#L10153) | var appointment\_cancel\_data = { action: 'bookingpress\_cancel\_appointment', cancel\_id: cancel\_id, \_wpnonce: bkp\_wpnonce\_pre\_fetch }; |
| [10154](#L10154) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( appointment\_cancel\_data ) ) |
| [10155](#L10155) | .then(function(response){ |
| [10156](#L10156) | vm2.is\_display\_loader = '0'; |
| [10157](#L10157) | vm2.is\_disabled = false; |
| [10158](#L10158) | if(response.data.variant != 'error'){ |
| [10159](#L10159) | window.location.href = response.data.redirect\_url; |
| [10160](#L10160) | }else{ |
| [10161](#L10161) | vm2.$notify({ |
| [10162](#L10162) | title: response.data.title, |
| [10163](#L10163) | message: response.data.msg, |
| [10164](#L10164) | type: response.data.variant, |
| [10165](#L10165) | customClass: response.data.variant+'\_notification', |
| [10166](#L10166) | }); |
| [10167](#L10167) | vm2.loadFrontAppointments(); |
| [10168](#L10168) | } |
| [10169](#L10169) | }).catch(function(error){ |
| [10170](#L10170) | console.log(error); |
| [10171](#L10171) | vm2.$notify({ |
| [10172](#L10172) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [10173](#L10173) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [10174](#L10174) | type: 'error', |
| [10175](#L10175) | customClass: 'error\_notification', |
| [10176](#L10176) | }); |
| [10177](#L10177) | }); |
| [10178](#L10178) | }, |
| [10179](#L10179) | resetFilter(){ |
| [10180](#L10180) | const vm = this; |
| [10181](#L10181) | if(vm.search\_appointment != '' || vm.appointment\_date\_range != '') { |
| [10182](#L10182) | vm.search\_appointment = ''; |
| [10183](#L10183) | vm.appointment\_date\_range = ''; |
| [10184](#L10184) | vm.loadFrontAppointments(); |
| [10185](#L10185) | } |
| [10186](#L10186) | }, |
| [10187](#L10187) | bookingpress\_activate\_myboooking\_tab(tab\_name){ |
| [10188](#L10188) | const vm = this; |
| [10189](#L10189) | vm.bookingpress\_my\_booking\_current\_tab = tab\_name; |
| [10190](#L10190) | <?php |
| [10191](#L10191) | do\_action('bookingpress\_activate\_my\_booking\_tab\_data'); |
| [10192](#L10192) | ?> |
| [10193](#L10193) | }, |
| [10194](#L10194) | bookingpress\_open\_cancel\_drawer(){ |
| [10195](#L10195) | const vm = this; |
| [10196](#L10196) | vm.bookingpress\_cancel\_appointment\_drawer = true; |
| [10197](#L10197) | vm.bookingpress\_hide\_drawer\_overlay('bpa-front-cp-cancel-mob-drawer'); |
| [10198](#L10198) | }, |
| [10199](#L10199) | bookingpress\_close\_cancel\_drawer(){ |
| [10200](#L10200) | const vm = this; |
| [10201](#L10201) | vm.bookingpress\_cancel\_appointment\_drawer = false; |
| [10202](#L10202) | }, |
| [10203](#L10203) | bookingpress\_full\_row\_clickable(row, column, event){ |
| [10204](#L10204) | const vm = this; |
| [10205](#L10205) | let target = event.target; |
| [10206](#L10206) | let getParent = vm.bookingpress\_get\_parent\_node( target, '.bpa-ma--action-btn-wrapper' ); |
| [10207](#L10207) | if( 0 < getParent.length && getParent[0] != null ){ |
| [10208](#L10208) | /\* Do Nothing \*/ |
| [10209](#L10209) | } else { |
| [10210](#L10210) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10211](#L10211) | } |
| [10212](#L10212) | }, |
| [10213](#L10213) | bookingpress\_get\_parent\_node( elem, selector ){ |
| [10214](#L10214) | if (!Element.prototype.matches) { |
| [10215](#L10215) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [10216](#L10216) | Element.prototype.mozMatchesSelector || |
| [10217](#L10217) | Element.prototype.msMatchesSelector || |
| [10218](#L10218) | Element.prototype.oMatchesSelector || |
| [10219](#L10219) | Element.prototype.webkitMatchesSelector || |
| [10220](#L10220) | function(s) { |
| [10221](#L10221) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [10222](#L10222) | i = matches.length; |
| [10223](#L10223) | while (--i >= 0 && matches.item(i) !== this) {} |
| [10224](#L10224) | return i > -1; |
| [10225](#L10225) | }; |
| [10226](#L10226) | } |
| [10227](#L10227) |  |
| [10228](#L10228) | var parents = []; |
| [10229](#L10229) |  |
| [10230](#L10230) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [10231](#L10231) | if (selector) { |
| [10232](#L10232) | if (elem.matches(selector)) { |
| [10233](#L10233) | parents.push(elem); |
| [10234](#L10234) | } |
| [10235](#L10235) | continue; |
| [10236](#L10236) | } |
| [10237](#L10237) | parents.push(elem); |
| [10238](#L10238) | } |
| [10239](#L10239) |  |
| [10240](#L10240) | return parents; |
| [10241](#L10241) | }, |
| [10242](#L10242) | bookingpress\_row\_expand(row, expanded){ |
| [10243](#L10243) | const vm = this; |
| [10244](#L10244) | if(vm.bookingpress\_previous\_row\_obj != ''){ |
| [10245](#L10245) | vm.$refs.multipleTable.toggleRowExpansion(vm.bookingpress\_previous\_row\_obj, false); |
| [10246](#L10246) | if(vm.bookingpress\_previous\_row\_obj != row){ |
| [10247](#L10247) | vm.$refs.multipleTable.toggleRowExpansion(vm.bookingpress\_previous\_row\_obj); |
| [10248](#L10248) | vm.bookingpress\_previous\_row\_obj = row; |
| [10249](#L10249) | }else{ |
| [10250](#L10250) | if(expanded.length == undefined){ |
| [10251](#L10251) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10252](#L10252) | } |
| [10253](#L10253) | vm.bookingpress\_previous\_row\_obj = ''; |
| [10254](#L10254) | } |
| [10255](#L10255) | }else{ |
| [10256](#L10256) | if(expanded.length == undefined){ |
| [10257](#L10257) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10258](#L10258) | } |
| [10259](#L10259) | vm.bookingpress\_previous\_row\_obj = row; |
| [10260](#L10260) | } |
| [10261](#L10261) | if(typeof vm.bookingpress\_reschedule\_drawer != "undefined") { |
| [10262](#L10262) | vm.bookingpress\_reschedule\_drawer = false; |
| [10263](#L10263) | } |
| [10264](#L10264) | if(typeof vm.bookingpress\_refund\_appointment\_drawer != "undefined") { |
| [10265](#L10265) | vm.bookingpress\_refund\_appointment\_drawer = false; |
| [10266](#L10266) | } |
| [10267](#L10267) | if(typeof vm.bookingpress\_cancel\_appointment\_drawer != "undefined") { |
| [10268](#L10268) | vm.bookingpress\_cancel\_appointment\_drawer = false; |
| [10269](#L10269) | } |
| [10270](#L10270) | }, |
| [10271](#L10271) | bookingpress\_cancel\_delete\_account(){ |
| [10272](#L10272) | const vm = this; |
| [10273](#L10273) | if( 1 == vm.allow\_customer\_edit\_profile ){ |
| [10274](#L10274) | tab\_name = "edit\_account"; |
| [10275](#L10275) | } else { |
| [10276](#L10276) | tab\_name = "my\_appointment"; |
| [10277](#L10277) | } |
| [10278](#L10278) | vm.bookingpress\_my\_booking\_current\_tab = tab\_name; |
| [10279](#L10279) | }, |
| [10280](#L10280) | bookingpress\_delete\_account(){ |
| [10281](#L10281) |  |
| [10282](#L10282) | var bkp\_wpnonce\_pre = "<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>"; |
| [10283](#L10283) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10284](#L10284) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10285](#L10285) | { |
| [10286](#L10286) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10287](#L10287) | } |
| [10288](#L10288) | else { |
| [10289](#L10289) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10290](#L10290) | } |
| [10291](#L10291) | var postData = { action: "bookingpress\_delete\_account", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [10292](#L10292) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [10293](#L10293) | .then( function (response) { |
| [10294](#L10294) | if(response.variant != "error"){ |
| [10295](#L10295) | location.reload(); |
| [10296](#L10296) | }else{ |
| [10297](#L10297) | vm.$notify({ |
| [10298](#L10298) | title: response.data.title, |
| [10299](#L10299) | message: response.data.msg, |
| [10300](#L10300) | type: response.data.variant, |
| [10301](#L10301) | customClass: "error\_notification", |
| [10302](#L10302) | }); |
| [10303](#L10303) | } |
| [10304](#L10304) | }.bind(this) ) |
| [10305](#L10305) | .catch( function (error) { |
| [10306](#L10306) | console.log(error); |
| [10307](#L10307) | }); |
| [10308](#L10308) | }, |
| [10309](#L10309) | bookingpress\_hide\_drawer\_overlay(selector\_class){ |
| [10310](#L10310) | setTimeout(function(){ |
| [10311](#L10311) | if(document.getElementsByClassName(selector\_class).length > 0 && document.getElementsByClassName("v-modal").length > 0){ |
| [10312](#L10312) | document.getElementsByClassName("v-modal")[0].style.display = "none"; |
| [10313](#L10313) | } |
| [10314](#L10314) | },2); |
| [10315](#L10315) | }, |
| [10316](#L10316) | <?php |
| [10317](#L10317) | do\_action('bookingpress\_front\_appointment\_add\_vue\_method'); |
| [10318](#L10318) | } |
| [10319](#L10319) | } |
| [10320](#L10320) | } |
| [10321](#L10321) |  |
| [10322](#L10322) | global $bookingpress\_appointment\_bookings, $bookingpress\_front\_vue\_data\_fields,$bookingpress\_front\_appointment\_vue\_data\_fields, $bookingpress\_version; |
| [10323](#L10323) | $bookingpress\_appointment\_bookings = new bookingpress\_appointment\_bookings(); |
| [10324](#L10324) | $bookingpress\_options              = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [10325](#L10325) | $bookingpress\_country\_list         = $bookingpress\_options['country\_lists']; |
| [10326](#L10326) |  |
| [10327](#L10327) |  |
| [10328](#L10328) | $bookingpress\_front\_vue\_data\_fields             = array( |
| [10329](#L10329) | 'appointment\_services\_list'   => array(), |
| [10330](#L10330) | 'appointment\_formdata'        => array( |
| [10331](#L10331) | 'appointment\_selected\_customer' => get\_current\_user\_id(), |
| [10332](#L10332) | 'appointment\_selected\_service'  => '', |
| [10333](#L10333) | 'appointment\_booked\_date'       => date('Y-m-d', current\_time('timestamp')), |
| [10334](#L10334) | 'appointment\_booked\_time'       => '', |
| [10335](#L10335) | 'appointment\_on\_site\_enabled'   => false, |
| [10336](#L10336) | ), |
| [10337](#L10337) | 'phone\_countries\_details'     => json\_decode($bookingpress\_country\_list), |
| [10338](#L10338) | 'final\_payable\_amount'        => '', |
| [10339](#L10339) | 'activeStepNumber'            => 0, |
| [10340](#L10340) | 'service\_categories'          => array(), |
| [10341](#L10341) | 'bookingpress\_all\_services'   => array(), |
| [10342](#L10342) | 'services\_data'               => array(), |
| [10343](#L10343) | 'service\_timing'              => array(), |
| [10344](#L10344) | 'no\_timeslot\_available'       => false, |
| [10345](#L10345) | 'on\_site\_payment'             => false, |
| [10346](#L10346) | 'paypal\_payment'              => false, |
| [10347](#L10347) | 'appointment\_step\_form\_data'  => array( |
| [10348](#L10348) | 'selected\_category'              => '', |
| [10349](#L10349) | 'selected\_cat\_name'              => '', |
| [10350](#L10350) | 'selected\_service'               => '', |
| [10351](#L10351) | 'selected\_service\_name'          => '', |
| [10352](#L10352) | 'selected\_service\_price'         => '', |
| [10353](#L10353) | 'service\_price\_without\_currency' => 0, |
| [10354](#L10354) | 'selected\_date'                  => date('Y-m-d', current\_time('timestamp')), |
| [10355](#L10355) | 'selected\_end\_date'              => '', |
| [10356](#L10356) | 'selected\_start\_time'            => '', |
| [10357](#L10357) | 'selected\_end\_time'              => '', |
| [10358](#L10358) | 'customer\_email'                 => '', |
| [10359](#L10359) | 'selected\_payment\_method'        => '', |
| [10360](#L10360) | 'customer\_phone\_country'         => 'us', |
| [10361](#L10361) | 'total\_services'                 => '', |
| [10362](#L10362) | 'total\_category'                 => '', |
| [10363](#L10363) | 'selected\_service\_duration'      => '', |
| [10364](#L10364) | 'selected\_service\_duration\_unit' => '', |
| [10365](#L10365) | 'is\_enable\_validations'          => 1, |
| [10366](#L10366) | 'check\_bookingpress\_username\_set' => '0', |
| [10367](#L10367) | 'bpa\_check\_user\_login'           => '0', |
| [10368](#L10368) | ), |
| [10369](#L10369) | 'customer\_details\_rule'       => array( |
| [10370](#L10370) | 'customer\_name'  => array( |
| [10371](#L10371) | 'required' => true, |
| [10372](#L10372) | 'message'  => esc\_html\_\_('Please enter customer name', 'bookingpress-appointment-booking'), |
| [10373](#L10373) | 'trigger'  => 'blur', |
| [10374](#L10374) | ), |
| [10375](#L10375) | 'customer\_email' => array( |
| [10376](#L10376) | 'required' => true, |
| [10377](#L10377) | 'message'  => esc\_html\_\_('Please enter customer email', 'bookingpress-appointment-booking'), |
| [10378](#L10378) | 'trigger'  => 'blur', |
| [10379](#L10379) | ), |
| [10380](#L10380) | ), |
| [10381](#L10381) | 'current\_selected\_tab\_id'     => 1, |
| [10382](#L10382) | 'previous\_selected\_tab\_id'    => 1, |
| [10383](#L10383) | 'next\_selected\_tab\_id'        => '2', |
| [10384](#L10384) | 'isLoadTimeLoader'            => '0', |
| [10385](#L10385) | 'isServiceLoadTimeLoader'     => '0', |
| [10386](#L10386) | 'isLoadDateTimeCalendarLoad'  => '0', |
| [10387](#L10387) | 'isLoadBookingLoader'         => '0', |
| [10388](#L10388) | 'isHoldBookingRequest'       => false, |
| [10389](#L10389) | 'isBookingDisabled'           => false, |
| [10390](#L10390) | 'displayResponsiveCalendar'   => '0', |
| [10391](#L10391) | 'display\_service\_description' => '0', |
| [10392](#L10392) | 'bookingpress\_container\_dynamic\_class' => '', |
| [10393](#L10393) | 'bookingpress\_footer\_dynamic\_class' => '', |
| [10394](#L10394) | 'bookingpress\_current\_tab' => 'service', |
| [10395](#L10395) | 'bookingpress\_next\_tab' => 'datetime', |
| [10396](#L10396) | 'bookingpress\_version' => $bookingpress\_version, |
| [10397](#L10397) | 'bookngpress\_previous\_tab' => '', |
| [10398](#L10398) | 'prevent\_verification\_on\_load' => false |
| [10399](#L10399) | ); |
| [10400](#L10400) |  |
| [10401](#L10401) | $bookingpress\_front\_appointment\_vue\_data\_fields = array( |
| [10402](#L10402) | 'items'                    => array(), |
| [10403](#L10403) | 'search\_appointment'       => '', |
| [10404](#L10404) | 'appointment\_date\_range'   => array(), |
| [10405](#L10405) | 'appointment\_service\_name' => '', |
| [10406](#L10406) | 'appointment\_date'         => '', |
| [10407](#L10407) | 'appointment\_duration'     => '', |
| [10408](#L10408) | 'appointment\_status'       => '', |
| [10409](#L10409) | 'appointment\_payment'      => '', |
| [10410](#L10410) | 'is\_disabled'              => false, |
| [10411](#L10411) | 'is\_front\_appointment\_empty\_loader' => '1', |
| [10412](#L10412) | 'is\_front\_my\_appointment\_empty\_loader' => '0', |
| [10413](#L10413) | 'bookingpress\_is\_user\_logged\_in' => '0', |
| [10414](#L10414) | 'per\_page' => 10, |
| [10415](#L10415) | 'pagination\_length' => 10, |
| [10416](#L10416) | 'currentPage' => 1, |
| [10417](#L10417) | 'total\_records' => 0, |
| [10418](#L10418) | 'bookingpress\_version' => $bookingpress\_version, |
| [10419](#L10419) | 'hide\_on\_single\_page' => true, |
| [10420](#L10420) | ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?format=txt)
* [Original Format](/export/3220813/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_1ff18bfe_20250111_194733.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Ffrontend%2Fclass.bookingpress_appointment_bookings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3210916 "Revision 3210916")
* Next Revision →
* [Blame](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

---

# [source:](/browser?order=name "Go to repository root") [bookingpress-appointment-booking](/browser/bookingpress-appointment-booking?order=name "View bookingpress-appointment-booking")/[trunk](/browser/bookingpress-appointment-booking/trunk?order=name "View trunk")/[core](/browser/bookingpress-appointment-booking/trunk/core?order=name "View core")/[classes](/browser/bookingpress-appointment-booking/trunk/core/classes?order=name "View classes")/[frontend](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend?order=name "View frontend")/[class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?order=name "View class.bookingpress_appointment_bookings.php")

View diff against:

View revision:

| [Last change](/changeset/3217529/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "View differences") on this file was [3217529](/changeset/3217529/ "View changeset 3217529"), checked in by reputeinfosystems, [5 days ago](/timeline?from=2025-01-06T09%3A23%3A13Z&precision=second "See timeline at 01/06/2025 09:23:13 AM") |
| --- |
| 1.1.25  * Fixed: add new service/appointment model hide behind the admin menu bar on websites hosted on wordpress.com * Other minor bug fixes |
| **File size:** 656.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | if ( ! defined( 'ABSPATH' ) ) { exit; } |
| [4](#L4) |  |
| [5](#L5) | if (! class\_exists('bookingpress\_appointment\_bookings')  && class\_exists('BookingPress\_Core')) { |
| [6](#L6) | class bookingpress\_appointment\_bookings Extends BookingPress\_Core |
| [7](#L7) | { |
| [8](#L8) | var $bookingpress\_form\_category; |
| [9](#L9) | var $bookingpress\_form\_service; |
| [10](#L10) | var $bookingpress\_hide\_category\_service; |
| [11](#L11) | var $bookingpress\_default\_date\_format; |
| [12](#L12) | var $bookingpress\_default\_time\_format; |
| [13](#L13) | var $bookingpress\_form\_fields\_error\_msg\_arr; |
| [14](#L14) | var $bookingpress\_form\_fields\_new; |
| [15](#L15) | var $bookingpress\_is\_service\_load\_from\_url; |
| [16](#L16) | var $bookingpress\_selected\_service\_param; |
| [17](#L17) |  |
| [18](#L18) | var $bookingpress\_mybooking\_random\_id; |
| [19](#L19) | var $bookingpress\_mybooking\_default\_date\_format; |
| [20](#L20) | var $bookingpress\_mybooking\_customer\_username; |
| [21](#L21) | var $bookingpress\_mybooking\_customer\_email; |
| [22](#L22) | var $bookingpress\_mybooking\_login\_user\_id; |
| [23](#L23) | var $bookingpress\_mybooking\_wpuser\_id; |
| [24](#L24) | var $bookingpress\_delete\_customer\_profile; |
| [25](#L25) | var $bookingpress\_calendar\_list; |
| [26](#L26) | var $bookingpress\_google\_calendar\_link; |
| [27](#L27) | var $bookingpress\_yahoo\_calendar\_link; |
| [28](#L28) |  |
| [29](#L29) | var $bookingpress\_all\_service\_data; |
| [30](#L30) |  |
| [31](#L31) | function \_\_construct() |
| [32](#L32) | { |
| [33](#L33) | global $BookingPress; |
| [34](#L34) |  |
| [35](#L35) | $this->bookingpress\_form\_category               = 0; |
| [36](#L36) | $this->bookingpress\_form\_service                = 0; |
| [37](#L37) | $this->bookingpress\_hide\_category\_service       = 0; |
| [38](#L38) | $this->bookingpress\_default\_date\_format         = get\_option('date\_format'); |
| [39](#L39) | $this->bookingpress\_default\_time\_format         = get\_option('time\_format'); |
| [40](#L40) | $this->bookingpress\_form\_fields\_error\_msg\_arr   = array(); |
| [41](#L41) | $this->bookingpress\_form\_fields\_new             = array(); |
| [42](#L42) | $this->bookingpress\_is\_service\_load\_from\_url    = 0; |
| [43](#L43) | $this->bookingpress\_calendar\_list               = ''; |
| [44](#L44) | $this->bookingpress\_google\_calendar\_link        = ''; |
| [45](#L45) | $this->bookingpress\_yahoo\_calendar\_link         = ''; |
| [46](#L46) | $this->bookingpress\_mybooking\_customer\_username = ''; |
| [47](#L47) | $this->bookingpress\_mybooking\_customer\_email    = ''; |
| [48](#L48) | $this->bookingpress\_mybooking\_wpuser\_id         = 0; |
| [49](#L49) |  |
| [50](#L50) | $this->bookingpress\_all\_service\_data           = array(); |
| [51](#L51) |  |
| [52](#L52) | add\_filter('bookingpress\_front\_booking\_dynamic\_data\_fields', array( $this, 'bookingpress\_booking\_dynamic\_data\_fields\_func' ), 10, 5); |
| [53](#L53) |  |
| [54](#L54) | add\_filter('bookingpress\_front\_booking\_dynamic\_helper\_vars', array( $this, 'bookingpress\_booking\_dynamic\_helper\_vars\_func' ), 10, 1); |
| [55](#L55) |  |
| [56](#L56) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [57](#L57) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [58](#L58) | add\_filter( 'bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func\_with\_pro')); |
| [59](#L59) | } else { |
| [60](#L60) | add\_filter('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func' ), 10, 1); |
| [61](#L61) | } |
| [62](#L62) | } else { |
| [63](#L63) | add\_filter('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_booking\_dynamic\_on\_load\_methods\_func' ), 10, 1); |
| [64](#L64) | } |
| [65](#L65) | add\_filter( 'bookingpress\_front\_booking\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_call\_autofocus\_method'), 100 ); |
| [66](#L66) |  |
| [67](#L67) | add\_filter('bookingpress\_front\_booking\_dynamic\_vue\_methods', array( $this, 'bookingpress\_booking\_dynamic\_vue\_methods\_func' ), 10, 1); |
| [68](#L68) | add\_action('media\_buttons', array( $this, 'bookingpress\_insert\_shortcode\_button' ), 20); |
| [69](#L69) |  |
| [70](#L70) | add\_shortcode('bookingpress\_form', array( $this, 'bookingpress\_front\_booking\_form' )); |
| [71](#L71) | add\_shortcode('bookingpress\_company\_avatar', array( $this, 'bookingpress\_company\_avatar\_func' )); |
| [72](#L72) | add\_shortcode('bookingpress\_company\_name', array( $this, 'bookingpress\_company\_name\_func' )); |
| [73](#L73) | add\_shortcode('bookingpress\_company\_website', array( $this, 'bookingpress\_company\_website\_func' )); |
| [74](#L74) | add\_shortcode('bookingpress\_company\_address', array( $this, 'bookingpress\_company\_address\_func' )); |
| [75](#L75) | add\_shortcode('bookingpress\_company\_phone', array( $this, 'bookingpress\_company\_phone\_func' )); |
| [76](#L76) | add\_shortcode('bookingpress\_appointment\_service', array( $this, 'bookingpress\_appointment\_service\_func' )); |
| [77](#L77) | add\_shortcode('bookingpress\_appointment\_datetime', array( $this, 'bookingpress\_appointment\_datetime\_func' )); |
| [78](#L78) | add\_shortcode('bookingpress\_appointment\_customername', array( $this, 'bookingpress\_appointment\_customername\_func' )); |
| [79](#L79) | add\_shortcode('bookingpress\_my\_appointments', array( $this, 'bookingpress\_my\_appointments\_func' )); |
| [80](#L80) | add\_shortcode('bookingpress\_delete\_account', array($this, 'bookingpress\_delete\_account\_func')); |
| [81](#L81) | add\_shortcode('booking\_id', array($this, 'bookingpress\_booking\_id\_func')); |
| [82](#L82) | add\_shortcode('bookingpress\_appointment\_cancellation\_confirmation', array($this, 'bookingpress\_appointment\_cancellation\_confirmation\_func')); |
| [83](#L83) |  |
| [84](#L84) | add\_action('wp\_ajax\_bookingpress\_front\_get\_category\_services', array( $this, 'bookingpress\_get\_category\_service\_data' ), 10); |
| [85](#L85) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_get\_category\_services', array( $this, 'bookingpress\_get\_category\_service\_data' ), 10); |
| [86](#L86) |  |
| [87](#L87) | add\_action('wp\_ajax\_bookingpress\_front\_get\_timings', array( $this, 'bookingpress\_retrieve\_timeslots' ), 10); |
| [88](#L88) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_get\_timings', array( $this, 'bookingpress\_retrieve\_timeslots' ), 10); |
| [89](#L89) |  |
| [90](#L90) | add\_action('wp\_ajax\_bookingpress\_front\_save\_appointment\_booking', array( $this, 'bookingpress\_save\_appointment\_booking\_func' ), 10); |
| [91](#L91) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_save\_appointment\_booking', array( $this, 'bookingpress\_save\_appointment\_booking\_func' ), 10); |
| [92](#L92) |  |
| [93](#L93) | add\_action('wp\_ajax\_nopriv\_bookingpress\_validate\_username', array( $this,'validate\_bookingpress\_username'),10); |
| [94](#L94) |  |
| [95](#L95) | /\* add\_action('wp\_ajax\_bookingpress\_before\_book\_appointment', array( $this, 'bookingpress\_before\_book\_appointment\_func' ), 10); |
| [96](#L96) | add\_action('wp\_ajax\_nopriv\_bookingpress\_before\_book\_appointment', array( $this, 'bookingpress\_before\_book\_appointment\_func' ), 10); \*/ |
| [97](#L97) |  |
| [98](#L98) | add\_action('wp\_ajax\_bookingpress\_cancel\_appointment', array( $this, 'bookingpress\_cancel\_appointment' ), 10); |
| [99](#L99) | add\_action('wp', array( $this, 'bookingpress\_cancel\_appointment\_func' ), 10); |
| [100](#L100) |  |
| [101](#L101) | add\_action('wp\_ajax\_bookingpress\_front\_cancel\_appointment', array( $this, 'bookingpress\_front\_cancel\_appointment\_func' ), 10); |
| [102](#L102) | add\_action('wp\_ajax\_nopriv\_bookingpress\_front\_cancel\_appointment', array( $this, 'bookingpress\_front\_cancel\_appointment\_func' ), 10); |
| [103](#L103) |  |
| [104](#L104) | /\* fornt-end mybooking \*/ |
| [105](#L105) |  |
| [106](#L106) | add\_action('bookingpress\_front\_appointments\_dynamic\_data\_fields', array( $this, 'bookingpress\_front\_appointments\_dynamic\_data\_fields\_func' )); |
| [107](#L107) | add\_action('bookingpress\_front\_appointments\_dynamic\_helper\_vars', array( $this, 'bookingpress\_front\_appointments\_dynamic\_helper\_vars\_func' )); |
| [108](#L108) | add\_action('bookingpress\_front\_appointments\_dynamic\_on\_load\_methods', array( $this, 'bookingpress\_front\_appointments\_dynamic\_on\_load\_methods\_func' )); |
| [109](#L109) | add\_action('bookingpress\_front\_appointments\_dynamic\_vue\_methods', array( $this, 'bookingpress\_front\_appointments\_dynamic\_vue\_methods\_func' )); |
| [110](#L110) |  |
| [111](#L111) | add\_action('wp\_ajax\_bookingpress\_get\_customer\_appointments', array( $this, 'bookingpress\_get\_customer\_appointments\_func' ), 10); |
| [112](#L112) |  |
| [113](#L113) | add\_action('wp\_ajax\_bookingpress\_get\_disable\_date', array( $this, 'bookingpress\_get\_disable\_date\_func' ), 10); |
| [114](#L114) | add\_action('wp\_ajax\_nopriv\_bookingpress\_get\_disable\_date', array( $this, 'bookingpress\_get\_disable\_date\_func' ), 10); |
| [115](#L115) |  |
| [116](#L116) | add\_action( 'wp\_ajax\_bookingpress\_fetch\_timeslot\_data', array( $this, 'bookingpress\_retrieve\_timeslot\_data\_callback'), 10 ); |
| [117](#L117) | add\_action( 'wp\_ajax\_nopriv\_bookingpress\_fetch\_timeslot\_data', array( $this, 'bookingpress\_retrieve\_timeslot\_data\_callback'), 10 ); |
| [118](#L118) |  |
| [119](#L119) | add\_action( 'wp\_ajax\_bpa\_set\_timeslot\_token', array( $this, 'bookingpress\_set\_timeslot\_token\_transient') ); |
| [120](#L120) | add\_action( 'wp\_ajax\_nopriv\_bpa\_set\_timeslot\_token', array( $this, 'bookingpress\_set\_timeslot\_token\_transient') ); |
| [121](#L121) |  |
| [122](#L122) | add\_action( 'wp\_ajax\_bookingpress\_retrieve\_entire\_month\_details', array( $this, 'bookingpress\_retrieve\_entire\_month\_data\_callback') ); |
| [123](#L123) | add\_action( 'wp\_ajax\_nopriv\_bookingpress\_retrieve\_entire\_month\_details', array( $this, 'bookingpress\_retrieve\_entire\_month\_data\_callback') ); |
| [124](#L124) |  |
| [125](#L125) |  |
| [126](#L126) | // New action for BG Calls to check disable dates for full day booking |
| [127](#L127) | add\_action('wp\_ajax\_bookingpress\_get\_whole\_day\_appointments', array( $this, 'bookingpress\_get\_whole\_day\_appointments\_func' ), 10); |
| [128](#L128) | add\_action('wp\_ajax\_nopriv\_bookingpress\_get\_whole\_day\_appointments', array( $this, 'bookingpress\_get\_whole\_day\_appointments\_func' ), 10); |
| [129](#L129) |  |
| [130](#L130) | add\_filter( 'bookingpress\_check\_available\_timeslot\_manual\_block', array( $this, 'bookingpress\_check\_available\_timeslot\_manual\_block\_func'), 12, 2); |
| [131](#L131) |  |
| [132](#L132) | /\*\* Calendar Integration Data \*/ |
| [133](#L133) | add\_shortcode( 'bookingpress\_appointment\_calendar\_integration', array( $this, 'bookingpress\_booking\_calendar\_options' ) ); |
| [134](#L134) | add\_action( 'init', array( $this, 'bookingpress\_download\_ics\_file' ) ); |
| [135](#L135) |  |
| [136](#L136) | add\_action('wp\_ajax\_bookingpress\_delete\_account', array($this, 'bookingpress\_delete\_customer\_account\_func')); |
| [137](#L137) |  |
| [138](#L138) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func' )); |
| [139](#L139) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func' )); |
| [140](#L140) | add\_action('bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods', array( $this, 'bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func' )); |
| [141](#L141) |  |
| [142](#L142) | /\*\* Action to set pre-loaded fonts \*/ |
| [143](#L143) | add\_action( 'wp\_head', array( $this, 'bookingpress\_preloaded\_fonts'), 99999 ); |
| [144](#L144) |  |
| [145](#L145) | add\_filter( 'jet-reviews/frontend/deps-scripts', array( $this, 'change\_jet\_review\_deps') ); |
| [146](#L146) |  |
| [147](#L147) | /\* Paypal Payment method added \*/ |
| [148](#L148) | $bookingpress\_pro = $this->bookingpress\_pro\_plugin\_active(); |
| [149](#L149) | if($bookingpress\_pro == 0){ |
| [150](#L150) | add\_filter('bookingpress\_after\_selecting\_payment\_method\_booking\_form',array($this,'bookingpress\_after\_selecting\_payment\_method\_func'),10,1); |
| [151](#L151) | add\_action('bookingpress\_paypal\_payment\_button\_html',array($this,'bookingpress\_paypal\_payment\_button\_html\_func'),10); |
| [152](#L152) | } |
| [153](#L153) |  |
| [154](#L154) |  |
| [155](#L155) | add\_action('bookingpress\_add\_frontend\_js', array($this, 'bookingpress\_paypal\_scripts\_add')); |
| [156](#L156) |  |
| [157](#L157) | /\* For Validate Paypal Request & add entries \*/ |
| [158](#L158) | add\_action('wp\_ajax\_bookingpress\_paypal\_booking\_validate\_lite', array($this, 'bookingpress\_paypal\_booking\_validate\_lite\_func'), 10); |
| [159](#L159) | add\_action('wp\_ajax\_nopriv\_bookingpress\_paypal\_booking\_validate\_lite', array($this, 'bookingpress\_paypal\_booking\_validate\_lite\_func'), 10); |
| [160](#L160) |  |
| [161](#L161) | /\* For Book Appointment Paypal Request \*/ |
| [162](#L162) | add\_action('wp\_ajax\_bookingpress\_paypal\_booking\_payment\_confirm\_lite', array($this, 'bookingpress\_paypal\_booking\_payment\_confirm\_lite'), 10); |
| [163](#L163) | add\_action('wp\_ajax\_nopriv\_bookingpress\_paypal\_booking\_payment\_confirm\_lite', array($this, 'bookingpress\_paypal\_booking\_payment\_confirm\_lite'), 10); |
| [164](#L164) |  |
| [165](#L165) | add\_action( 'wp\_ajax\_bookingpress\_update\_elementor\_widgets', array( $this, 'bookingpress\_elementor\_pre\_update\_check') ); |
| [166](#L166) |  |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | function bookingpress\_elementor\_pre\_update\_check(){ |
| [170](#L170) | global $wpdb; |
| [171](#L171) |  |
| [172](#L172) | $fetch\_records = $wpdb->get\_results( $wpdb->prepare( "SELECT post\_id,meta\_value FROM {$wpdb->postmeta} WHERE meta\_key = %s AND meta\_value LIKE '%\"widgetType\":\"Booking Forms - WordPress Booking Plugin\"%' OR meta\_value LIKE '%\"widgetType\":\"Customer Panel - BookingPress Appointment Plugin\"%'", '\_elementor\_data' ) ); //phpcs:ignore |
| [173](#L173) |  |
| [174](#L174) | if( !empty( $fetch\_records ) ){ |
| [175](#L175) | foreach( $fetch\_records as $key => $fetch\_data ){ |
| [176](#L176) | $post\_id = $fetch\_data->post\_id; |
| [177](#L177) |  |
| [178](#L178) | $meta\_value = json\_decode( $fetch\_data->meta\_value, true ); |
| [179](#L179) |  |
| [180](#L180) | $meta\_value\_updated = []; |
| [181](#L181) |  |
| [182](#L182) | foreach( $meta\_value as $meta\_key => $elementor\_metadata ){ |
| [183](#L183) | $elements = $elementor\_metadata['elements']; |
| [184](#L184) |  |
| [185](#L185) | foreach( $elements as $elm\_key => $elm\_data ){ |
| [186](#L186) | if( 'Booking Forms - WordPress Booking Plugin' == $elm\_data['widgetType'] ){ |
| [187](#L187) | $elementor\_metadata['elements'][ $elm\_key ]['widgetType'] = 'bookingpress\_elementor\_form\_widget'; |
| [188](#L188) | } else if( 'Customer Panel - BookingPress Appointment Plugin' == $elm\_data['widgetType'] ){ |
| [189](#L189) | $elementor\_metadata['elements'][ $elm\_key ]['widgetType'] = 'bookingpress\_elementor\_customer\_panel\_widget'; |
| [190](#L190) | } |
| [191](#L191) | } |
| [192](#L192) | $meta\_value\_updated[ $meta\_key ] = $elementor\_metadata; |
| [193](#L193) | } |
| [194](#L194) |  |
| [195](#L195) | $meta\_value\_updated = wp\_json\_encode( $meta\_value\_updated ); |
| [196](#L196) |  |
| [197](#L197) | update\_post\_meta( $post\_id, '\_elementor\_data', $meta\_value\_updated ); |
| [198](#L198) | delete\_post\_meta( $post\_id, '\_elementor\_element\_cache' ); |
| [199](#L199) | } |
| [200](#L200) | update\_option( 'bookingpress\_update\_elementor\_widget', 2 ); |
| [201](#L201) | } else { |
| [202](#L202) | update\_option( 'bookingpress\_update\_elementor\_widget', 2 ); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | echo wp\_json\_encode( |
| [206](#L206) | array( |
| [207](#L207) | 'type' => 'success', |
| [208](#L208) | 'message' => esc\_html\_\_( 'BookingPress widgets updated successfully!', 'bookingpress-appointment-booking' ) |
| [209](#L209) | ) |
| [210](#L210) | ); |
| [211](#L211) | die; |
| [212](#L212) |  |
| [213](#L213) | } |
| [214](#L214) |  |
| [215](#L215) |  |
| [216](#L216) | /\*\* |
| [217](#L217) | \* Paypal payment button html |
| [218](#L218) | \* |
| [219](#L219) | \*/ |
| [220](#L220) | function bookingpress\_paypal\_payment\_button\_html\_func(){ |
| [221](#L221) | ?> |
| [222](#L222) |  |
| [223](#L223) | <el-button v-if="paypal\_button\_loader != 'false'" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--primary bpa-loader-button bpa-front-btn--is-loader"> |
| [224](#L224) | <span class="bpa-btn\_\_label">Test Button</span> |
| [225](#L225) | <div class="bpa-front-btn--loader\_\_circles"> |
| [226](#L226) | <div></div> |
| [227](#L227) | <div></div> |
| [228](#L228) | <div></div> |
| [229](#L229) | </div> |
| [230](#L230) | </el-button> |
| [231](#L231) | <div v-if="paypal\_button\_loader != 'true'" id="paypal-button-container"></div> |
| [232](#L232) | <?php |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) |  |
| [236](#L236) | public function validate\_paypal\_order($order\_id){ |
| [237](#L237) | global $BookingPress; |
| [238](#L238) |  |
| [239](#L239) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [240](#L240) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [241](#L241) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [242](#L242) |  |
| [243](#L243) | $paypalAuthAPI = 'https://api-m.paypal.com/v1/oauth2/token'; |
| [244](#L244) | $paypalAPI = 'https://api-m.paypal.com/v2/checkout'; |
| [245](#L245) |  |
| [246](#L246) | $Sandbox = ($bookingpress\_payment\_mode == "sandbox")?true:false; |
| [247](#L247) | $paypalClientID = $paypal\_client\_id; |
| [248](#L248) | $paypalSecret = $paypal\_client\_secret; |
| [249](#L249) |  |
| [250](#L250) | if ($Sandbox) { |
| [251](#L251) | $paypalAuthAPI = 'https://api-m.sandbox.paypal.com/v1/oauth2/token'; |
| [252](#L252) | $paypalAPI = 'https://api-m.sandbox.paypal.com/v2/checkout'; |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | $request\_args = array( |
| [256](#L256) | 'headers'     => array( |
| [257](#L257) | 'Authorization' => 'Basic ' . base64\_encode($paypalClientID . ':' . $paypalSecret), |
| [258](#L258) | ), |
| [259](#L259) | 'body'        => array( |
| [260](#L260) | 'grant\_type' => 'client\_credentials', |
| [261](#L261) | ), |
| [262](#L262) | ); |
| [263](#L263) |  |
| [264](#L264) | $response = wp\_remote\_post($paypalAuthAPI, $request\_args); |
| [265](#L265) |  |
| [266](#L266) | if (is\_wp\_error($response)) { |
| [267](#L267) | throw new Exception('Error ' . $response->get\_error\_code() . ': ' . $response->get\_error\_message()); // phpcs:ignore |
| [268](#L268) | } |
| [269](#L269) |  |
| [270](#L270) | $auth\_response = json\_decode(wp\_remote\_retrieve\_body($response)); |
| [271](#L271) |  |
| [272](#L272) | if (empty($auth\_response)) { |
| [273](#L273) | return false; |
| [274](#L274) | } else { |
| [275](#L275) | if (!empty($auth\_response->access\_token)) { |
| [276](#L276) | $request\_args = array( |
| [277](#L277) | 'headers'     => array( |
| [278](#L278) | 'Authorization' => 'Bearer ' . $auth\_response->access\_token, |
| [279](#L279) | ), |
| [280](#L280) | ); |
| [281](#L281) |  |
| [282](#L282) | $response = wp\_remote\_get($paypalAPI . '/orders/' . $order\_id, $request\_args); |
| [283](#L283) |  |
| [284](#L284) | if (is\_wp\_error($response)) { |
| [285](#L285) | throw new Exception('Error ' . $response->get\_error\_code() . ': ' . $response->get\_error\_message()); // phpcs:ignore |
| [286](#L286) | } |
| [287](#L287) |  |
| [288](#L288) | $api\_data = json\_decode(wp\_remote\_retrieve\_body($response), true); |
| [289](#L289) |  |
| [290](#L290) | if (!empty($api\_data['error'])) { |
| [291](#L291) | throw new Exception('Error ' . $api\_data['error'] . ': ' . $api\_data['error\_description']); // phpcs:ignore |
| [292](#L292) | } |
| [293](#L293) |  |
| [294](#L294) | return !empty($api\_data) ? $api\_data : false; |
| [295](#L295) | } else { |
| [296](#L296) | return false; |
| [297](#L297) | } |
| [298](#L298) | } |
| [299](#L299) |  |
| [300](#L300) | } |
| [301](#L301) |  |
| [302](#L302) | function bookingpress\_paypal\_booking\_payment\_confirm\_lite(){ |
| [303](#L303) |  |
| [304](#L304) | global  $BookingPress,$bookingpress\_debug\_payment\_log\_id,$bookingpress\_payment\_gateways; |
| [305](#L305) | $wpnonce               = isset( $\_POST['\_wpnonce'] ) ? sanitize\_text\_field( $\_POST['\_wpnonce'] ) : ''; |
| [306](#L306) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce( $wpnonce, 'bpa\_wp\_nonce' ); |
| [307](#L307) | $response              = array(); |
| [308](#L308) |  |
| [309](#L309) | $response['variant'] = 'error'; |
| [310](#L310) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [311](#L311) | $response['msg']     = esc\_html\_\_( 'Sorry, payment is not successed with the paypal.', 'bookingpress-appointment-booking' ); |
| [312](#L312) |  |
| [313](#L313) | $bookingpress\_payment\_res = (isset($\_POST['bookingpress\_payment\_res'])) ? $\_POST['bookingpress\_payment\_res'] : ''; // phpcs:ignore |
| [314](#L314) | do\_action( 'bookingpress\_payment\_log\_entry', 'paypal', 'payment popup response data', 'bookingpress pro', $\_POST, $bookingpress\_debug\_payment\_log\_id ); |
| [315](#L315) | if ( ! $bpa\_verify\_nonce\_flag ) { |
| [316](#L316) | $response['variant'] = 'error'; |
| [317](#L317) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [318](#L318) | $response['msg']     = esc\_html\_\_( 'Sorry, Your request can not process due to security reason.', 'bookingpress-appointment-booking' ); |
| [319](#L319) | wp\_send\_json( $response ); |
| [320](#L320) | die(); |
| [321](#L321) | } |
| [322](#L322) |  |
| [323](#L323) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [324](#L324) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [325](#L325) |  |
| [326](#L326) | if (empty($paypal\_client\_id) ) { |
| [327](#L327) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal Client ID', 'bookingpress-appointment-booking'); |
| [328](#L328) | $response['variant']       = 'error'; |
| [329](#L329) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [330](#L330) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [331](#L331) | $response['is\_redirect']   = 0; |
| [332](#L332) | $response['redirect\_data'] = ''; |
| [333](#L333) | $response['is\_spam']       = 0; |
| [334](#L334) | echo wp\_json\_encode($response); |
| [335](#L335) | exit; |
| [336](#L336) | } |
| [337](#L337) | if (empty($paypal\_client\_secret) ) { |
| [338](#L338) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please Configure PayPal Client Secret', 'bookingpress-appointment-booking'); |
| [339](#L339) | $response['variant']       = 'error'; |
| [340](#L340) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [341](#L341) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [342](#L342) | $response['is\_redirect']   = 0; |
| [343](#L343) | $response['redirect\_data'] = ''; |
| [344](#L344) | $response['is\_spam']       = 0; |
| [345](#L345) | echo wp\_json\_encode($response); |
| [346](#L346) | exit; |
| [347](#L347) | } |
| [348](#L348) |  |
| [349](#L349) | $order\_id = (isset($bookingpress\_payment\_res['id']))?$bookingpress\_payment\_res['id']:''; |
| [350](#L350) | $order = ""; |
| [351](#L351) | if(!empty($order\_id)){ |
| [352](#L352) | try { |
| [353](#L353) | $order = $this->validate\_paypal\_order($order\_id); |
| [354](#L354) | } catch(Exception $e) { |
| [355](#L355) | $api\_error = $e->getMessage(); |
| [356](#L356) | $response['variant'] = 'error'; |
| [357](#L357) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [358](#L358) | $response['msg']     = $api\_error; |
| [359](#L359) | wp\_send\_json( $response ); |
| [360](#L360) | die(); |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | $reference\_id = (isset($order['purchase\_units'][0]['reference\_id']))?$order['purchase\_units'][0]['reference\_id']:''; |
| [364](#L364) | $order\_status = (isset($order['status']))?$order['status']:''; |
| [365](#L365) | $transaction\_id  =  (isset($order['purchase\_units'][0]['payments']['captures'][0]['id']))?$order['purchase\_units'][0]['payments']['captures'][0]['id']:''; |
| [366](#L366) | $payment\_status = (isset($order['purchase\_units'][0]['payments']['captures'][0]['status']))?$order['purchase\_units'][0]['payments']['captures'][0]['status']:''; |
| [367](#L367) | $amount = (isset($order['purchase\_units'][0]['amount']['value']))?$order['purchase\_units'][0]['amount']['value']:''; |
| [368](#L368) | $currency\_code = (isset($order['purchase\_units'][0]['amount']['currency\_code']))?$order['purchase\_units'][0]['amount']['currency\_code']:''; |
| [369](#L369) |  |
| [370](#L370) | if(!empty($reference\_id)){ |
| [371](#L371) |  |
| [372](#L372) | $entry\_id = $reference\_id; |
| [373](#L373) | if(!empty($order\_id) && $order\_status == 'COMPLETED' && !empty($entry\_id)){ |
| [374](#L374) |  |
| [375](#L375) | $bookingpress\_webhook\_data = array(); |
| [376](#L376) | $payer\_email = (isset($order['payer']['email\_address']))?$order['payer']['email\_address']:''; |
| [377](#L377) | $bookingpress\_webhook\_data['bookingpress\_payer\_email'] = $payer\_email; |
| [378](#L378) | $bookingpress\_webhook\_data['txn\_id'] = $transaction\_id; |
| [379](#L379) | $bookingpress\_webhook\_data['mc\_gross'] = $amount; |
| [380](#L380) | $bookingpress\_webhook\_data['mc\_currency'] = $currency\_code; |
| [381](#L381) | $bookingpress\_webhook\_data['amount'] = $amount; |
| [382](#L382) | $bookingpress\_webhook\_data['currency'] = $currency\_code; |
| [383](#L383) | $payment\_add\_status = '1'; |
| [384](#L384) | if($payment\_status == "PENDING"){ |
| [385](#L385) | $payment\_add\_status = '2'; |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | $payment\_log\_id = $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, $bookingpress\_webhook\_data, $payment\_add\_status, 'txn\_id', '', 1); |
| [389](#L389) | $response['variant'] = 'success'; |
| [390](#L390) | $response['title']   = esc\_html\_\_( 'Success', 'bookingpress-appointment-booking' ); |
| [391](#L391) | $response['msg']     = esc\_html\_\_( 'Appointment succesfully created.', 'bookingpress-appointment-booking' ); |
| [392](#L392) |  |
| [393](#L393) | wp\_send\_json( $response ); |
| [394](#L394) | die(); |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | } |
| [398](#L398) |  |
| [399](#L399) | } |
| [400](#L400) |  |
| [401](#L401) |  |
| [402](#L402) | echo wp\_json\_encode($response); |
| [403](#L403) | die; |
| [404](#L404) |  |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | /\*\* |
| [408](#L408) | \* Add for create paypal entries |
| [409](#L409) | \* |
| [410](#L410) | \*/ |
| [411](#L411) | function bookingpress\_paypal\_booking\_validate\_lite\_func(){ |
| [412](#L412) |  |
| [413](#L413) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customer\_bookings, $tbl\_bookingpress\_customers, $bookingpress\_payment\_gateways, $bookingpress\_debug\_payment\_log\_id; |
| [414](#L414) | $wpnonce               = isset( $\_POST['\_wpnonce'] ) ? sanitize\_text\_field( $\_POST['\_wpnonce'] ) : ''; |
| [415](#L415) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce( $wpnonce, 'bpa\_wp\_nonce' ); |
| [416](#L416) | $response              = array(); |
| [417](#L417) |  |
| [418](#L418) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [419](#L419) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [420](#L420) | if (! $bpa\_verify\_nonce\_flag ) { |
| [421](#L421) | $response['variant'] = 'error'; |
| [422](#L422) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [423](#L423) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [424](#L424) | wp\_send\_json($response); |
| [425](#L425) | die(); |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [429](#L429) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [430](#L430) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [431](#L431) |  |
| [432](#L432) | if (empty($paypal\_client\_id) ) { |
| [433](#L433) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal Client ID', 'bookingpress-appointment-booking'); |
| [434](#L434) | $response['variant']       = 'error'; |
| [435](#L435) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [436](#L436) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [437](#L437) | $response['is\_redirect']   = 0; |
| [438](#L438) | $response['redirect\_data'] = ''; |
| [439](#L439) | $response['is\_spam']       = 0; |
| [440](#L440) | echo wp\_json\_encode($response); |
| [441](#L441) | exit; |
| [442](#L442) | } |
| [443](#L443) | if (empty($paypal\_client\_secret) ) { |
| [444](#L444) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please Configure PayPal Client Secret', 'bookingpress-appointment-booking'); |
| [445](#L445) | $response['variant']       = 'error'; |
| [446](#L446) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [447](#L447) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [448](#L448) | $response['is\_redirect']   = 0; |
| [449](#L449) | $response['redirect\_data'] = ''; |
| [450](#L450) | $response['is\_spam']       = 0; |
| [451](#L451) | echo wp\_json\_encode($response); |
| [452](#L452) | exit; |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | $response['variant']       = 'error'; |
| [456](#L456) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [457](#L457) | $response['msg']           = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [458](#L458) | $response['is\_redirect']   = 0; |
| [459](#L459) | $response['redirect\_data'] = ''; |
| [460](#L460) | $response['is\_spam']       = 1; |
| [461](#L461) |  |
| [462](#L462) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [463](#L463) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [464](#L464) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [465](#L465) | } |
| [466](#L466) |  |
| [467](#L467) | $response = apply\_filters('bookingpress\_validate\_spam\_protection', $response, array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data'])); // phpcs:ignore |
| [468](#L468) |  |
| [469](#L469) | $booking\_response = $this->bookingpress\_before\_book\_appointment\_func(); |
| [470](#L470) |  |
| [471](#L471) | if( !empty( $booking\_response ) ){ |
| [472](#L472) | $booking\_response\_arr = json\_decode( $booking\_response, true ); |
| [473](#L473) | if( !empty( $booking\_response\_arr['variant'] ) && 'error' == $booking\_response\_arr['variant'] ){ |
| [474](#L474) | if(!empty($booking\_response\_arr['msg'])) { |
| [475](#L475) | $booking\_response\_arr['msg'] = stripslashes\_deep(html\_entity\_decode($booking\_response\_arr['msg'],ENT\_QUOTES)); |
| [476](#L476) | } |
| [477](#L477) | wp\_send\_json($booking\_response\_arr); |
| [478](#L478) | die; |
| [479](#L479) | } |
| [480](#L480) | } |
| [481](#L481) |  |
| [482](#L482) | $appointment\_booked\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_booked\_successfully', 'message\_setting'); |
| [483](#L483) |  |
| [484](#L484) | if (! empty($\_REQUEST) && ! empty($\_REQUEST['appointment\_data']) ) { |
| [485](#L485) |  |
| [486](#L486) | $bookingpress\_appointment\_data            = array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_data'] contains mixed array and sanitized properly using 'appointment\_sanatize\_field' function |
| [487](#L487) | $bookingpress\_payment\_gateway             = ! empty($bookingpress\_appointment\_data['selected\_payment\_method']) ? $bookingpress\_appointment\_data['selected\_payment\_method'] : ''; |
| [488](#L488) | $bookingpress\_appointment\_on\_site\_enabled = ( $bookingpress\_appointment\_data['selected\_payment\_method'] == 'onsite' ) ? 1 : 0; |
| [489](#L489) | $payment\_gateway                          = ( $bookingpress\_appointment\_on\_site\_enabled ) ? 'on-site' : $bookingpress\_payment\_gateway; |
| [490](#L490) |  |
| [491](#L491) | $bookingpress\_service\_price = isset($bookingpress\_appointment\_data['service\_price\_without\_currency']) ? floatval($bookingpress\_appointment\_data['service\_price\_without\_currency']) : 0; |
| [492](#L492) | if ($bookingpress\_service\_price == 0 ) { |
| [493](#L493) | $payment\_gateway = ' - '; |
| [494](#L494) | } |
| [495](#L495) |  |
| [496](#L496) | $bpa\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [497](#L497) |  |
| [498](#L498) | $bpa\_service\_data               = $BookingPress->get\_service\_by\_id( $bpa\_selected\_service ); |
| [499](#L499) | $bpa\_service\_amount             = ! empty($bpa\_service\_data['bookingpress\_service\_price']) ? (float) $bpa\_service\_data['bookingpress\_service\_price'] : 0; |
| [500](#L500) |  |
| [501](#L501) | if( $bpa\_service\_amount != $bookingpress\_service\_price ){ |
| [502](#L502) | $bookingpress\_invalid\_amount = esc\_html\_\_('Sorry! Appointment could not be processed', 'bookingpress-appointment-booking'); |
| [503](#L503) |  |
| [504](#L504) | $response['variant']       = 'error'; |
| [505](#L505) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [506](#L506) | $response['msg']           = $bookingpress\_invalid\_amount; |
| [507](#L507) | $response['is\_redirect']   = 0; |
| [508](#L508) | $response['reason']        = 'price mismatched ' . $bpa\_service\_amount . ' --- ' . $bookingpress\_service\_price; |
| [509](#L509) | $response['redirect\_data'] = ''; |
| [510](#L510) | $response['is\_spam']       = 0; |
| [511](#L511) |  |
| [512](#L512) | echo wp\_json\_encode($response); |
| [513](#L513) | exit; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | $bookingpress\_return\_data = apply\_filters('bookingpress\_validate\_submitted\_form', $payment\_gateway, $bookingpress\_appointment\_data); |
| [517](#L517) |  |
| [518](#L518) | $bookingpress\_service\_name = ! empty( $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] ) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_( 'Appointment Booking', 'bookingpress-appointment-booking' ); |
| [519](#L519) |  |
| [520](#L520) | if ($bookingpress\_service\_price == 0 ) { |
| [521](#L521) | $response['variant']       = 'error'; |
| [522](#L522) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [523](#L523) | $response['msg']           = esc\_html\_\_('Service price must be more then 0 for paypal.', 'bookingpress-appointment-booking'); |
| [524](#L524) | $response['is\_redirect']   = 0; |
| [525](#L525) | $response['reason']        = 'price 0'; |
| [526](#L526) | $response['redirect\_data'] = ''; |
| [527](#L527) | $response['is\_spam']       = 0; |
| [528](#L528) | echo wp\_json\_encode($response); |
| [529](#L529) | exit; |
| [530](#L530) | } |
| [531](#L531) |  |
| [532](#L532) | $entry\_id = ! empty( $bookingpress\_return\_data['entry\_id'] ) ? $bookingpress\_return\_data['entry\_id'] : ''; |
| [533](#L533) |  |
| [534](#L534) | if(!empty($entry\_id)){ |
| [535](#L535) |  |
| [536](#L536) | $order\_id = ""; |
| [537](#L537) | $currency                          = $bookingpress\_return\_data['currency']; |
| [538](#L538) | $currency\_symbol                   = $BookingPress->bookingpress\_get\_currency\_code($currency); |
| [539](#L539) | $bookingpress\_final\_payable\_amount = isset($bookingpress\_return\_data['payable\_amount']) ? $bookingpress\_return\_data['payable\_amount'] : 0; |
| [540](#L540) | $customer\_details                  = $bookingpress\_return\_data['customer\_details']; |
| [541](#L541) | $customer\_email                    = ! empty($customer\_details['customer\_email']) ? $customer\_details['customer\_email'] : ''; |
| [542](#L542) |  |
| [543](#L543) | $bookingpress\_service\_name = ! empty($bookingpress\_return\_data['service\_data']['bookingpress\_service\_name']) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_('Appointment Booking', 'bookingpress-appointment-booking'); |
| [544](#L544) |  |
| [545](#L545) | $custom\_var = $entry\_id; |
| [546](#L546) |  |
| [547](#L547) |  |
| [548](#L548) |  |
| [549](#L549) | $Sandbox = ($bookingpress\_payment\_mode == "sandbox")?true:false; |
| [550](#L550) | $paypalClientID = $paypal\_client\_id; |
| [551](#L551) | $paypalSecret = $paypal\_client\_secret; |
| [552](#L552) |  |
| [553](#L553) | $token\_url = 'https://api-m.paypal.com/v1/oauth2/token'; |
| [554](#L554) | $api\_url = 'https://api-m.paypal.com/v2/checkout/orders'; |
| [555](#L555) | if ($Sandbox) { |
| [556](#L556) | $token\_url = 'https://api-m.sandbox.paypal.com/v1/oauth2/token'; |
| [557](#L557) | $api\_url = 'https://api-m.sandbox.paypal.com/v2/checkout/orders'; |
| [558](#L558) | } |
| [559](#L559) | $request\_args = array( |
| [560](#L560) | 'headers'     => array( |
| [561](#L561) | 'Authorization' => 'Basic ' . base64\_encode($paypalClientID . ':' . $paypalSecret), |
| [562](#L562) | ), |
| [563](#L563) | 'body'        => array( |
| [564](#L564) | 'grant\_type' => 'client\_credentials', |
| [565](#L565) | ), |
| [566](#L566) | ); |
| [567](#L567) | $response\_return = wp\_remote\_post($token\_url, $request\_args); |
| [568](#L568) | if (is\_wp\_error($response\_return)) { |
| [569](#L569) | $error = $response\_return->get\_error\_code() . ': ' . $response\_return->get\_error\_message(); |
| [570](#L570) | $response['variant'] = 'error'; |
| [571](#L571) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [572](#L572) | $response['msg']     = $error; |
| [573](#L573) | wp\_send\_json( $response ); |
| [574](#L574) | die(); |
| [575](#L575) | } |
| [576](#L576) |  |
| [577](#L577) | $auth\_response = json\_decode(wp\_remote\_retrieve\_body($response\_return)); |
| [578](#L578) |  |
| [579](#L579) | if(isset($auth\_response->error\_description) && isset($auth\_response->error)){ |
| [580](#L580) | $response['variant'] = 'error'; |
| [581](#L581) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [582](#L582) | $response['msg']     = $auth\_response->error.' '.$auth\_response->error\_description; |
| [583](#L583) | echo wp\_json\_encode( $response ); |
| [584](#L584) | die(); |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | if (empty($auth\_response)) { |
| [588](#L588) | wp\_send\_json( $response ); |
| [589](#L589) | die(); |
| [590](#L590) | } else { |
| [591](#L591) | if (!empty($auth\_response->access\_token)) { |
| [592](#L592) | $headers = array( |
| [593](#L593) | 'Content-Type' => 'application/json', |
| [594](#L594) | 'Authorization' => 'Bearer ' . $auth\_response->access\_token, |
| [595](#L595) | ); |
| [596](#L596) | $body = array( |
| [597](#L597) | 'intent' => 'CAPTURE', |
| [598](#L598) | 'purchase\_units' => array( |
| [599](#L599) | array( |
| [600](#L600) | 'reference\_id'=> $custom\_var, |
| [601](#L601) | 'description' => $bookingpress\_service\_name, |
| [602](#L602) | 'amount' => array( |
| [603](#L603) | 'currency\_code' => ''.$currency\_symbol, |
| [604](#L604) | 'value' => $bookingpress\_final\_payable\_amount, |
| [605](#L605) | ), |
| [606](#L606) | ), |
| [607](#L607) | ), |
| [608](#L608) | ); |
| [609](#L609) |  |
| [610](#L610) |  |
| [611](#L611) | $response\_return = wp\_remote\_post( |
| [612](#L612) | $api\_url, |
| [613](#L613) | array( |
| [614](#L614) | 'method' => 'POST', |
| [615](#L615) | 'headers' => $headers, |
| [616](#L616) | 'body' => wp\_json\_encode($body), |
| [617](#L617) | ) |
| [618](#L618) | ); |
| [619](#L619) |  |
| [620](#L620) |  |
| [621](#L621) | if (is\_wp\_error($response\_return)) { |
| [622](#L622) | $error\_message = $response\_return->get\_error\_message(); |
| [623](#L623) | $response['variant'] = 'error'; |
| [624](#L624) | $response['title']   = esc\_html\_\_( 'Error', 'bookingpress-appointment-booking' ); |
| [625](#L625) | $response['msg']     = "Something went wrong:"; |
| [626](#L626) | wp\_send\_json( $response ); |
| [627](#L627) | die(); |
| [628](#L628) |  |
| [629](#L629) | } else { |
| [630](#L630) | $response\_body = wp\_remote\_retrieve\_body($response\_return); |
| [631](#L631) | $order\_data = json\_decode($response\_body, true); |
| [632](#L632) | $order\_id = (isset($order\_data['id']))?$order\_data['id']:''; |
| [633](#L633) | } |
| [634](#L634) | } |
| [635](#L635) | } |
| [636](#L636) | if(!empty($order\_id)){ |
| [637](#L637) |  |
| [638](#L638) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [639](#L639) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [640](#L640) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [641](#L641) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [642](#L642) | } |
| [643](#L643) |  |
| [644](#L644) | $bookingpress\_paypal\_cancel\_url\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_failed\_payment\_redirection', 'booking\_form'); |
| [645](#L645) | $bookingpress\_paypal\_cancel\_url = get\_permalink($bookingpress\_paypal\_cancel\_url\_id); |
| [646](#L646) | $cancel\_url                     = ! empty($bookingpress\_paypal\_cancel\_url) ? $bookingpress\_paypal\_cancel\_url : BOOKINGPRESS\_HOME\_URL; |
| [647](#L647) | $cancel\_url                     = add\_query\_arg('is\_cancel', 1, esc\_url($cancel\_url)); |
| [648](#L648) | $booking\_form\_redirection\_mode = 'external\_redirection'; |
| [649](#L649) |  |
| [650](#L650) | $response['variant'] = 'success'; |
| [651](#L651) | $response['title']   = esc\_html\_\_( 'Success', 'bookingpress-appointment-booking' ); |
| [652](#L652) | $response['msg']     = esc\_html\_\_( 'Appointment succesfully created.', 'bookingpress-appointment-booking' ); |
| [653](#L653) | $response['order\_id']  = $order\_id; |
| [654](#L654) | $response['paypal\_success\_url']  = $redirect\_url; |
| [655](#L655) | $response['paypal\_cancel\_url']  = $cancel\_url; |
| [656](#L656) | $response['paypal\_booking\_form\_redirection\_mode']  = $booking\_form\_redirection\_mode; |
| [657](#L657) |  |
| [658](#L658) | } |
| [659](#L659) |  |
| [660](#L660) | }else{ |
| [661](#L661) |  |
| [662](#L662) | $response['variant']       = 'error'; |
| [663](#L663) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [664](#L664) | $response['msg']           = esc\_html\_\_('Something Wrong', 'bookingpress-appointment-booking'); |
| [665](#L665) | $response['is\_redirect']   = 0; |
| [666](#L666) | $response['reason']        = 'price 0'; |
| [667](#L667) | $response['redirect\_data'] = ''; |
| [668](#L668) | $response['is\_spam']       = 0; |
| [669](#L669) | echo wp\_json\_encode($response); |
| [670](#L670) | exit; |
| [671](#L671) | } |
| [672](#L672) | } |
| [673](#L673) |  |
| [674](#L674) | wp\_send\_json( $response ); |
| [675](#L675) | die(); |
| [676](#L676) |  |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | function bookingpress\_paypal\_scripts\_add(){ |
| [680](#L680) | global $BookingPress; |
| [681](#L681) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment', 'payment\_setting' ); |
| [682](#L682) | $paypal\_payment\_method\_type = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment\_method\_type', 'payment\_setting' ); |
| [683](#L683) | if($paypal\_payment\_method\_type == 'popup' && $paypal\_payment == true){ |
| [684](#L684) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [685](#L685) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [686](#L686) | $bookingpress\_currency\_name   = $BookingPress->bookingpress\_get\_settings( 'payment\_default\_currency', 'payment\_setting' ); |
| [687](#L687) | $bookingpress\_currency\_code = $BookingPress->bookingpress\_get\_currency\_code( $bookingpress\_currency\_name ); |
| [688](#L688) |  |
| [689](#L689) | if(!empty($paypal\_client\_id) && !empty($paypal\_client\_secret)){ |
| [690](#L690) | wp\_enqueue\_script( 'bookingpress-paypal-script', 'https://www.paypal.com/sdk/js?client-id='.$paypal\_client\_id.'&currency='.$bookingpress\_currency\_code.'&disable-funding=credit,card', array(), null, true ); |
| [691](#L691) | } |
| [692](#L692) | } |
| [693](#L693) | } |
| [694](#L694) |  |
| [695](#L695) |  |
| [696](#L696) |  |
| [697](#L697) | /\*\* |
| [698](#L698) | \* After selection payment method paypal script added |
| [699](#L699) | \* |
| [700](#L700) | \*/ |
| [701](#L701) | function bookingpress\_after\_selecting\_payment\_method\_func($bookingpress\_after\_selecting\_payment\_method\_data){ |
| [702](#L702) | global $BookingPress; |
| [703](#L703) |  |
| [704](#L704) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment', 'payment\_setting' ); |
| [705](#L705) | if($paypal\_payment == true){ |
| [706](#L706) |  |
| [707](#L707) | $paypal\_payment\_method\_type = $BookingPress->bookingpress\_get\_settings( 'paypal\_payment\_method\_type', 'payment\_setting' ); |
| [708](#L708) | $paypal\_client\_id = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_id', 'payment\_setting' ); |
| [709](#L709) | $paypal\_client\_secret = $BookingPress->bookingpress\_get\_settings( 'paypal\_client\_secret', 'payment\_setting' ); |
| [710](#L710) |  |
| [711](#L711) | if($paypal\_payment\_method\_type == 'popup'){ |
| [712](#L712) |  |
| [713](#L713) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [714](#L714) | var vm7 = this; |
| [715](#L715) | if(payment\_method == "paypal"){ |
| [716](#L716) | vm7.show\_paypal\_popup\_button = "true"; |
| [717](#L717) | }else{ |
| [718](#L718) | vm7.show\_paypal\_popup\_button = "false"; |
| [719](#L719) | } |
| [720](#L720) | '; |
| [721](#L721) |  |
| [722](#L722) | if(empty($paypal\_client\_id)){ |
| [723](#L723) | $client\_id\_error = esc\_html\_\_( 'Client ID is required.', 'bookingpress-appointment-booking' ); |
| [724](#L724) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [725](#L725) | window.app.bookingpress\_set\_error\_msg("'.$client\_id\_error.'"); |
| [726](#L726) | '; |
| [727](#L727) | }else if(empty($paypal\_client\_secret)){ |
| [728](#L728) | $client\_secret\_error = esc\_html\_\_( 'Client secret is required.', 'bookingpress-appointment-booking' ); |
| [729](#L729) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [730](#L730) | window.app.bookingpress\_set\_error\_msg("'.$client\_secret\_error.'"); |
| [731](#L731) | '; |
| [732](#L732) | }else{ |
| [733](#L733) |  |
| [734](#L734) | $bookingpress\_after\_selecting\_payment\_method\_data.=' |
| [735](#L735) | if(payment\_method == "paypal"){ |
| [736](#L736) | document.getElementById("paypal-button-container").innerHTML = ""; |
| [737](#L737) | paypal.Buttons({ |
| [738](#L738) | async createOrder(data, actions) { |
| [739](#L739) | var vm2 = this; |
| [740](#L740) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [741](#L741) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [742](#L742) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [743](#L743) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [744](#L744) | }else { |
| [745](#L745) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [746](#L746) | } |
| [747](#L747) | var final\_order\_id = ""; |
| [748](#L748) | var postData = { action: "bookingpress\_paypal\_booking\_validate\_lite", \_wpnonce: bkp\_wpnonce\_pre\_fetch,appointment\_data:JSON.stringify( app.appointment\_step\_form\_data)} |
| [749](#L749) | var final\_data = ""; |
| [750](#L750) | try { |
| [751](#L751) | const response = await axios.post(appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData )); |
| [752](#L752) | if(response.data.variant != "error") { |
| [753](#L753) | if(typeof response.data.order\_id != "undefined" && response.data.order\_id != ""){ |
| [754](#L754) | app.paypal\_success\_url = response.data.paypal\_success\_url; |
| [755](#L755) | app.paypal\_cancel\_url = response.data.paypal\_cancel\_url; |
| [756](#L756) | app.paypal\_booking\_form\_redirection\_mode = response.data.paypal\_booking\_form\_redirection\_mode; |
| [757](#L757) | return response.data.order\_id; |
| [758](#L758) | } |
| [759](#L759) | }else{ |
| [760](#L760) | window.app.bookingpress\_set\_error\_msg(response.data.msg); |
| [761](#L761) | return 0; |
| [762](#L762) | } |
| [763](#L763) | } catch (error) { |
| [764](#L764) | window.app.bookingpress\_set\_error\_msg("Failed to create PayPal order"); |
| [765](#L765) | return 0; |
| [766](#L766) | } |
| [767](#L767) |  |
| [768](#L768) | }, |
| [769](#L769) | onCancel: function(data){}, |
| [770](#L770) | onApprove: (data, actions) => { |
| [771](#L771) | return actions.order.capture().then(function(orderData) { |
| [772](#L772) |  |
| [773](#L773) | app.paypal\_button\_loader = "true"; |
| [774](#L774) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [775](#L775) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [776](#L776) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [777](#L777) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [778](#L778) | }else { |
| [779](#L779) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [780](#L780) | } |
| [781](#L781) |  |
| [782](#L782) | var sca\_confirm\_booking\_data = { action: "bookingpress\_paypal\_booking\_payment\_confirm\_lite", bookingpress\_payment\_res: orderData, \_wpnonce: bkp\_wpnonce\_pre\_fetch} |
| [783](#L783) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( sca\_confirm\_booking\_data ) ) |
| [784](#L784) | .then(function(response) { |
| [785](#L785) | setTimeout(function(){ |
| [786](#L786) | app.paypal\_button\_loader = "false"; |
| [787](#L787) | },500); |
| [788](#L788) | if(response.data.variant != "error") { |
| [789](#L789) | window.location.href = app.paypal\_success\_url; |
| [790](#L790) | }else{ |
| [791](#L791) | window.app.bookingpress\_set\_error\_msg(response.data.msg); |
| [792](#L792) | } |
| [793](#L793) | }).catch(function(error){ |
| [794](#L794) | setTimeout(function(){ |
| [795](#L795) | app.paypal\_button\_loader = "false"; |
| [796](#L796) | },500); |
| [797](#L797) | console.log(error); |
| [798](#L798) | }); |
| [799](#L799) |  |
| [800](#L800) | }); |
| [801](#L801) | }, |
| [802](#L802) | style: { |
| [803](#L803) | layout: "vertical", |
| [804](#L804) | color: "gold", |
| [805](#L805) | shape: "pill", |
| [806](#L806) | label: "paypal", |
| [807](#L807) | fundingicons: false, |
| [808](#L808) | } |
| [809](#L809) | }).render("#paypal-button-container"); |
| [810](#L810) |  |
| [811](#L811) | }else{ |
| [812](#L812) | document.getElementById("paypal-button-container").innerHTML = ""; |
| [813](#L813) | } |
| [814](#L814) | '; |
| [815](#L815) | } |
| [816](#L816) | } |
| [817](#L817) |  |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) |  |
| [821](#L821) |  |
| [822](#L822) | return $bookingpress\_after\_selecting\_payment\_method\_data; |
| [823](#L823) | } |
| [824](#L824) |  |
| [825](#L825) | function bookingpress\_pro\_plugin\_active(){ |
| [826](#L826) | if (! function\_exists('is\_plugin\_active') ) { |
| [827](#L827) | include ABSPATH . '/wp-admin/includes/plugin.php'; |
| [828](#L828) | } |
| [829](#L829) | $bookingpress\_pro = (is\_plugin\_active('bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php'))?1:0; |
| [830](#L830) | return $bookingpress\_pro; |
| [831](#L831) | } |
| [832](#L832) |  |
| [833](#L833) | function change\_jet\_review\_deps( $jet\_vue\_deps ){ |
| [834](#L834) | foreach( $jet\_vue\_deps as $key => $dep ){ |
| [835](#L835) | if( 'jet-vue' == $dep ){ |
| [836](#L836) | $jet\_vue\_deps[ $key ] = 'bookingpress\_vue\_js'; |
| [837](#L837) | } |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | return $jet\_vue\_deps; |
| [841](#L841) | } |
| [842](#L842) |  |
| [843](#L843) | function validate\_bookingpress\_username(){ |
| [844](#L844) |  |
| [845](#L845) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_customers,$bookingpress\_payment\_gateways; |
| [846](#L846) | $response              = array(); |
| [847](#L847) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [848](#L848) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [849](#L849) | if (! $bpa\_verify\_nonce\_flag ) { |
| [850](#L850) | $response['variant']      = 'error'; |
| [851](#L851) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [852](#L852) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [853](#L853) | $response['redirect\_url'] = ''; |
| [854](#L854) | return wp\_json\_encode($response); |
| [855](#L855) |  |
| [856](#L856) | } |
| [857](#L857) | $response['variant']    = 'success'; |
| [858](#L858) | $response['title']      = ''; |
| [859](#L859) | $response['msg']        = ''; |
| [860](#L860) |  |
| [861](#L861) | if( !empty( $\_REQUEST['\_username'] ) && !is\_array( $\_REQUEST['\_username'] ) ){ |
| [862](#L862) | $response = apply\_filters('bpa\_password\_field\_validation\_outside', $response); |
| [863](#L863) | $username = sanitize\_text\_field($\_REQUEST['\_username']); |
| [864](#L864) | $check\_username = validate\_username( $username ); |
| [865](#L865) | if( $check\_username == 1 ){ |
| [866](#L866) | $response['variant'] = 'success'; |
| [867](#L867) | $response['title']   = esc\_html\_\_('success', 'bookingpress-appointment-booking'); |
| [868](#L868) | $response['msg']     = esc\_html\_\_('Validate Username', 'bookingpress-appointment-booking'); |
| [869](#L869) | echo wp\_json\_encode( $response ); |
| [870](#L870) | } else { |
| [871](#L871) | $response['variant'] = 'error'; |
| [872](#L872) | $response['title']   = esc\_html\_\_('error', 'bookingpress-appointment-booking'); |
| [873](#L873) | $response['msg']     = esc\_html\_\_('Please enter validate username', 'bookingpress-appointment-booking'); |
| [874](#L874) | echo wp\_json\_encode( $response ); |
| [875](#L875) | } |
| [876](#L876) | } |
| [877](#L877) | die; |
| [878](#L878) | } |
| [879](#L879) |  |
| [880](#L880) | function bookingpress\_front\_cancel\_appointment\_func() { |
| [881](#L881) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications, $bookingpress\_services; |
| [882](#L882) | $response              = array(); |
| [883](#L883) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [884](#L884) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [885](#L885) | if (! $bpa\_verify\_nonce\_flag ) { |
| [886](#L886) | $response['variant']      = 'error'; |
| [887](#L887) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [888](#L888) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [889](#L889) | wp\_send\_json($response); |
| [890](#L890) | die(); |
| [891](#L891) | } |
| [892](#L892) |  |
| [893](#L893) | $response['variant']    = 'error'; |
| [894](#L894) | $response['title']      = 'Error'; |
| [895](#L895) | $response['msg']        = 'Something went wrong when process with cancel appointment....'; |
| [896](#L896) |  |
| [897](#L897) | if(!empty($\_REQUEST['appointment\_id']) && !empty($\_REQUEST['cancel\_token'])) { |
| [898](#L898) |  |
| [899](#L899) | $appointment\_id = intval($\_REQUEST['appointment\_id']);// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [900](#L900) | $bookingpress\_cancel\_token = sanitize\_text\_field($\_REQUEST['cancel\_token']); |
| [901](#L901) |  |
| [902](#L902) | $bookingpress\_appointment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_customer\_email,bookingpress\_service\_id,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_customer\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d AND bookingpress\_appointment\_token = %s", $appointment\_id,$bookingpress\_cancel\_token), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_log\_data is table name defined globally. False Positive alarm |
| [903](#L903) |  |
| [904](#L904) | if (! empty($bookingpress\_appointment\_log\_data) ) { |
| [905](#L905) |  |
| [906](#L906) | $bookingpress\_appointment\_date = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_date']; |
| [907](#L907) | $bookingpress\_appointment\_time = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_time']; |
| [908](#L908) |  |
| [909](#L909) | $bookingpress\_appointment\_datetime = $bookingpress\_appointment\_date." ".$bookingpress\_appointment\_time; |
| [910](#L910) | $current\_datetime = date( 'Y-m-d H:i:s', current\_time('timestamp') ); |
| [911](#L911) | $allow\_cancel\_appointment = true; |
| [912](#L912) |  |
| [913](#L913) | if( $bookingpress\_appointment\_datetime <= $current\_datetime ){ |
| [914](#L914) | $allow\_cancel\_appointment = false; |
| [915](#L915) | } |
| [916](#L916) |  |
| [917](#L917) | $allow\_cancel\_appointment = apply\_filters( 'bookingpress\_modify\_cancel\_appointment\_flag', $allow\_cancel\_appointment, $bookingpress\_appointment\_log\_data ); |
| [918](#L918) |  |
| [919](#L919) | if($allow\_cancel\_appointment){ |
| [920](#L920) | $appointment\_cancelled\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_cancelled\_successfully', 'message\_setting'); |
| [921](#L921) | $response['variant']      = 'success'; |
| [922](#L922) | $response['title']        = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [923](#L923) | $response['msg']          = $appointment\_cancelled\_successfully; |
| [924](#L924) | $response = apply\_filters('bookingpress\_refund\_process\_before\_cancel\_appointment',$response,$appointment\_id); |
| [925](#L925) | if($response['variant'] == 'success' ) { |
| [926](#L926) | $bookingress\_customer\_email = $bookingpress\_appointment\_log\_data['bookingpress\_customer\_email']; |
| [927](#L927) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [928](#L928) | $bookingpress\_after\_canceled\_payment\_url     = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [929](#L929) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [930](#L930) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $appointment\_id )); |
| [931](#L931) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $appointment\_id, $bookingress\_customer\_email); |
| [932](#L932) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings,array('bookingpress\_appointment\_token' => ''),array('bookingpress\_appointment\_booking\_id' => $appointment\_id)); |
| [933](#L933) | do\_action('bookingpress\_after\_cancel\_appointment', $appointment\_id); |
| [934](#L934) | $response['redirect\_url'] = $bookingpress\_after\_canceled\_payment\_url; |
| [935](#L935) | } |
| [936](#L936) |  |
| [937](#L937) | } else { |
| [938](#L938) | $response['variant']    = 'error'; |
| [939](#L939) | $response['title']      = 'Error'; |
| [940](#L940) | $response['msg']        = esc\_html\_\_("We're sorry! you can't cancel this appointment because minimum required time for cancellation is already passed", "bookingpress-appointment-booking"); |
| [941](#L941) | } |
| [942](#L942) | } |
| [943](#L943) | } |
| [944](#L944) | wp\_send\_json( $response); |
| [945](#L945) | die(); |
| [946](#L946) | } |
| [947](#L947) |  |
| [948](#L948) | /\*\* |
| [949](#L949) | \* bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func |
| [950](#L950) | \* |
| [951](#L951) | \* @return void |
| [952](#L952) | \*/ |
| [953](#L953) | function bookingpress\_cancellation\_confirmation\_dynamic\_data\_fields\_func() |
| [954](#L954) | { |
| [955](#L955) | global $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields, $BookingPress, $bookingpress\_global\_options; |
| [956](#L956) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields = array(); |
| [957](#L957) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['is\_cancel\_appointment\_loader'] = '0'; |
| [958](#L958) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['is\_cancel\_button\_disabled'] = false; |
| [959](#L959) |  |
| [960](#L960) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['bookingpress\_cancel\_variant'] = ''; |
| [961](#L961) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields['bookingpress\_cancel\_msg'] = ''; |
| [962](#L962) |  |
| [963](#L963) | $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields = apply\_filters('bookingpress\_cancellation\_confirmation\_add\_dynamic\_data', $bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields); |
| [964](#L964) |  |
| [965](#L965) | echo wp\_json\_encode($bookingpress\_front\_confirmation\_appointment\_vue\_data\_fields); |
| [966](#L966) | } |
| [967](#L967) | /\*\* |
| [968](#L968) | \* bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | function bookingpress\_cancellation\_confirmation\_dynamic\_helper\_vars\_func() |
| [973](#L973) | { |
| [974](#L974) | global $bookingpress\_global\_options; |
| [975](#L975) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [976](#L976) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [977](#L977) | ?> |
| [978](#L978) | var lang = ELEMENT.lang.<?php echo esc\_html($bookingpress\_locale\_lang); ?>; |
| [979](#L979) | ELEMENT.locale(lang); |
| [980](#L980) | <?php |
| [981](#L981) | } |
| [982](#L982) |  |
| [983](#L983) | /\*\* |
| [984](#L984) | \* bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func |
| [985](#L985) | \* |
| [986](#L986) | \* @return void |
| [987](#L987) | \*/ |
| [988](#L988) | function bookingpress\_cancellation\_confirmation\_dynamic\_vue\_methods\_func() { |
| [989](#L989) | global $bookingpress\_notification\_duration; |
| [990](#L990) | ?> |
| [991](#L991) | bookingpress\_cancel\_appointment(appointment\_id,cancel\_token) { |
| [992](#L992) | const vm = this; |
| [993](#L993) | vm.is\_cancel\_appointment\_loader = '1' |
| [994](#L994) | vm.is\_cancel\_button\_disabled = true |
| [995](#L995) | var appointment\_cancel\_data = { action: 'bookingpress\_front\_cancel\_appointment',appointment\_id:appointment\_id,cancel\_token,\_wpnonce:'<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>' }; |
| [996](#L996) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( appointment\_cancel\_data ) ) |
| [997](#L997) | .then(function(response){ |
| [998](#L998) | vm.is\_cancel\_appointment\_loader = '0' |
| [999](#L999) | vm.is\_cancel\_button\_disabled = false |
| [1000](#L1000) |  |
| [1001](#L1001) | if(response.data.variant != undefined && response.data.variant != 'error'){ |
| [1002](#L1002) | window.location.href = response.data.redirect\_url; |
| [1003](#L1003) | } else { |
| [1004](#L1004) | vm.bookingpress\_cancel\_variant = response.data.variant; |
| [1005](#L1005) | vm.bookingpress\_cancel\_msg = response.data.msg; |
| [1006](#L1006) | } |
| [1007](#L1007) | }).catch(function(error){ |
| [1008](#L1008) | console.log(error); |
| [1009](#L1009) | vm.$notify({ |
| [1010](#L1010) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [1011](#L1011) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [1012](#L1012) | type: 'error', |
| [1013](#L1013) | customClass: 'error\_notification', |
| [1014](#L1014) | duration:<?php echo intval($bookingpress\_notification\_duration); ?>, |
| [1015](#L1015) | }); |
| [1016](#L1016) | }); |
| [1017](#L1017) | }, |
| [1018](#L1018) | <?php |
| [1019](#L1019) | } |
| [1020](#L1020) |  |
| [1021](#L1021) | function bookingpress\_preloaded\_fonts(){ |
| [1022](#L1022) |  |
| [1023](#L1023) | global $post; |
| [1024](#L1024) |  |
| [1025](#L1025) | if( empty( $post ) ){ |
| [1026](#L1026) | return; |
| [1027](#L1027) | } |
| [1028](#L1028) |  |
| [1029](#L1029) | $post\_content = $post->post\_content; |
| [1030](#L1030) |  |
| [1031](#L1031) | $pattern = '/\[(bookingpress\_(.\*?)\])/'; |
| [1032](#L1032) |  |
| [1033](#L1033) | if( preg\_match( $pattern, $post\_content ) ){ |
| [1034](#L1034) |  |
| [1035](#L1035) | global $BookingPress, $bookingpress\_global\_options; |
| [1036](#L1036) |  |
| [1037](#L1037) | $google\_fonts = $bookingpress\_global\_options->bookingpress\_get\_google\_fonts(); |
| [1038](#L1038) | $bookingpress\_title\_fonts = $BookingPress->bookingpress\_get\_customize\_settings( |
| [1039](#L1039) | 'title\_font\_family', |
| [1040](#L1040) | 'booking\_form' |
| [1041](#L1041) | ); |
| [1042](#L1042) |  |
| [1043](#L1043) | $bpa\_font\_dir\_url =  BOOKINGPRESS\_URL.'/css/fonts'; |
| [1044](#L1044) |  |
| [1045](#L1045) | $bpa\_preload\_font\_file\_arr = array( |
| [1046](#L1046) | 'element-icons.woff2' |
| [1047](#L1047) | ); |
| [1048](#L1048) |  |
| [1049](#L1049) | if( 'poppins' == strtolower( trim( $bookingpress\_title\_fonts) ) ){ |
| [1050](#L1050) | $bpa\_preload\_font\_file\_arr = array\_merge( $bpa\_preload\_font\_file\_arr, array( |
| [1051](#L1051) | 'poppins/Poppins-Bold.woff2', |
| [1052](#L1052) | 'poppins/Poppins-Medium.woff2', |
| [1053](#L1053) | 'poppins/Poppins-Regular.woff2', |
| [1054](#L1054) | 'poppins/Poppins-SemiBold.woff2' |
| [1055](#L1055) | )); |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | $bpa\_preload\_font\_file\_arr = apply\_filters( 'bookingpress\_modify\_preload\_font\_arr', $bpa\_preload\_font\_file\_arr ); |
| [1059](#L1059) |  |
| [1060](#L1060) | if( !empty( $bpa\_preload\_font\_file\_arr ) ){ |
| [1061](#L1061) | foreach( $bpa\_preload\_font\_file\_arr as $bpa\_font\_file ){ |
| [1062](#L1062) | if( filter\_var( $bpa\_font\_file, FILTER\_VALIDATE\_URL ) ){ |
| [1063](#L1063) | echo '<link rel="preload" href="'.$bpa\_font\_file.'" as="font" type="font/woff2" crossorigin />'; //phpcs:ignore |
| [1064](#L1064) | } else { |
| [1065](#L1065) | echo '<link rel="preload" href="'.$bpa\_font\_dir\_url.'/'.$bpa\_font\_file.'" as="font" type="font/woff2" crossorigin />'; //phpcs:ignore |
| [1066](#L1066) | } |
| [1067](#L1067) | } |
| [1068](#L1068) | } |
| [1069](#L1069) |  |
| [1070](#L1070) |  |
| [1071](#L1071) | } |
| [1072](#L1072) | } |
| [1073](#L1073) |  |
| [1074](#L1074) | /\*\* |
| [1075](#L1075) | \* Used for delete customer account |
| [1076](#L1076) | \* |
| [1077](#L1077) | \* @return void |
| [1078](#L1078) | \*/ |
| [1079](#L1079) | function bookingpress\_delete\_customer\_account\_func(){ |
| [1080](#L1080) | global $wpdb, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_appointment\_bookings, $BookingPress, $tbl\_bookingpress\_customers\_meta,$tbl\_bookingpress\_payment\_logs; |
| [1081](#L1081) | $response              = array(); |
| [1082](#L1082) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1083](#L1083) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1084](#L1084) |  |
| [1085](#L1085) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1086](#L1086) | $response['variant']      = 'error'; |
| [1087](#L1087) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1088](#L1088) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1089](#L1089) | wp\_send\_json($response); |
| [1090](#L1090) | die(); |
| [1091](#L1091) | } |
| [1092](#L1092) |  |
| [1093](#L1093) | $response['variant']    = 'error'; |
| [1094](#L1094) | $response['title']      = 'Error'; |
| [1095](#L1095) | $response['msg']        = 'Something went wrong....'; |
| [1096](#L1096) |  |
| [1097](#L1097) | $bookingpress\_login\_user\_id = get\_current\_user\_id(); |
| [1098](#L1098) |  |
| [1099](#L1099) | if(!empty($bookingpress\_login\_user\_id)){ |
| [1100](#L1100) | $bookingpress\_customer\_rows = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d ORDER BY bookingpress\_customer\_id DESC", $bookingpress\_login\_user\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_customers is a table name. false alarm |
| [1101](#L1101) |  |
| [1102](#L1102) | do\_action('bookingpress\_delete\_customer\_log',$bookingpress\_customer\_rows,$\_REQUEST); |
| [1103](#L1103) |  |
| [1104](#L1104) | if(!empty($bookingpress\_customer\_rows)){ |
| [1105](#L1105) | do\_action( 'bookingpress\_before\_delete\_customer', $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ); |
| [1106](#L1106) | $delete = $wpdb->delete( $tbl\_bookingpress\_customers, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1107](#L1107) | if ( $delete > 0 ) { |
| [1108](#L1108) | $delete1 = $wpdb->delete( $tbl\_bookingpress\_customers\_meta, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1109](#L1109) | $delete2 = $wpdb->delete( $tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1110](#L1110) | $delete3 = $wpdb->delete( $tbl\_bookingpress\_payment\_logs, array( 'bookingpress\_customer\_id' => $bookingpress\_customer\_rows['bookingpress\_customer\_id'] ), array( '%d' ) ); |
| [1111](#L1111) | $customer\_role\_id = new WP\_User( $bookingpress\_login\_user\_id ); |
| [1112](#L1112) | $customer\_role\_id->remove\_role('bookingpress-customer'); |
| [1113](#L1113) |  |
| [1114](#L1114) | wp\_logout(); |
| [1115](#L1115) |  |
| [1116](#L1116) | $response['variant'] = 'success'; |
| [1117](#L1117) | $response['title'] = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [1118](#L1118) | $response['msg'] = esc\_html\_\_('Account Deleted Successfully', 'bookingpress-appointment-booking'); |
| [1119](#L1119) | } |
| [1120](#L1120) | }else{ |
| [1121](#L1121) | $response['msg'] = esc\_html\_\_('No customers exist in BookingPress', 'bookingpress-appointment-booking'); |
| [1122](#L1122) | } |
| [1123](#L1123) | }else{ |
| [1124](#L1124) | $response['msg'] = esc\_html\_\_('Please login to your account for delete BookingPress account', 'bookingpress-appointment-booking'); |
| [1125](#L1125) | } |
| [1126](#L1126) |  |
| [1127](#L1127) | echo wp\_json\_encode($response); |
| [1128](#L1128) | exit; |
| [1129](#L1129) | } |
| [1130](#L1130) |  |
| [1131](#L1131) | /\*\* |
| [1132](#L1132) | \* Customer delete account shortcode callable function |
| [1133](#L1133) | \* |
| [1134](#L1134) | \* @param  mixed $atts |
| [1135](#L1135) | \* @param  mixed $content |
| [1136](#L1136) | \* @param  mixed $tag |
| [1137](#L1137) | \* @return void |
| [1138](#L1138) | \*/ |
| [1139](#L1139) | function bookingpress\_delete\_account\_func($atts, $content, $tag){ |
| [1140](#L1140) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [1141](#L1141) | $BookingPress->set\_front\_css(1); |
| [1142](#L1142) | $BookingPress->set\_front\_js(1); |
| [1143](#L1143) | $BookingPress->bookingpress\_load\_mybooking\_custom\_css(); |
| [1144](#L1144) | //$BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [1145](#L1145) |  |
| [1146](#L1146) | $bookingpress\_short\_atts = array( |
| [1147](#L1147) | 'cancel\_button\_text' => esc\_html\_\_('Cancel', 'bookingpress-appointment-booking'), |
| [1148](#L1148) | 'delete\_button\_text' => esc\_html\_\_('Delete', 'bookingpress-appointment-booking'), |
| [1149](#L1149) | ); |
| [1150](#L1150) |  |
| [1151](#L1151) | $atts = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [1152](#L1152) |  |
| [1153](#L1153) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [1154](#L1154) |  |
| [1155](#L1155) | $content = '<div class="bpa-front-dcw\_\_body-btn-group">'; |
| [1156](#L1156) | $content .= '<el-button class="el-button bpa-front-btn bpa-front-btn\_\_medium bpa-front-delete-account-txt" @click="bookingpress\_cancel\_delete\_account()"><span>'. $atts['cancel\_button\_text'].'</span></el-button>'; |
| [1157](#L1157) | $content .= '<el-button class="el-button bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--danger" @click="bookingpress\_delete\_account()"><span>'.$atts['delete\_button\_text'].'</span></el-button>'; |
| [1158](#L1158) | $content .= '</div>'; |
| [1159](#L1159) |  |
| [1160](#L1160) | return $content; |
| [1161](#L1161) | } |
| [1162](#L1162) |  |
| [1163](#L1163) | /\*\* |
| [1164](#L1164) | \* bookingpress\_appointment\_cancellation\_confirmation\_func |
| [1165](#L1165) | \* |
| [1166](#L1166) | \* @param  mixed $atts |
| [1167](#L1167) | \* @param  mixed $content |
| [1168](#L1168) | \* @param  mixed $tag |
| [1169](#L1169) | \* @return void |
| [1170](#L1170) | \*/ |
| [1171](#L1171) | function bookingpress\_appointment\_cancellation\_confirmation\_func($atts, $content, $tag)  { |
| [1172](#L1172) |  |
| [1173](#L1173) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [1174](#L1174) | $BookingPress->set\_front\_css(1); |
| [1175](#L1175) | $BookingPress->set\_front\_js(1); |
| [1176](#L1176) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [1177](#L1177) | $bookingpress\_uniq\_id = uniqid(); |
| [1178](#L1178) | $appointment\_id = 0; |
| [1179](#L1179) |  |
| [1180](#L1180) | if(!empty($\_GET['appointment\_id']) && !empty($\_GET['cancel\_token'])){ |
| [1181](#L1181) | $bkp\_ap\_id = intval(base64\_decode($\_GET['appointment\_id'])); //phpcs:ignore |
| [1182](#L1182) | $bookingpress\_cancel\_token = sanitize\_text\_field($\_GET['cancel\_token']); |
| [1183](#L1183) |  |
| [1184](#L1184) | $bpa\_cancel\_booking\_id\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_booking\_id\_text', 'booking\_my\_booking'); |
| [1185](#L1185) | $bpa\_cancel\_service\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_service\_text', 'booking\_my\_booking'); |
| [1186](#L1186) | $bpa\_cancel\_date\_time\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_date\_time\_text', 'booking\_my\_booking'); |
| [1187](#L1187) | $bpa\_cancel\_button\_text = $BookingPress->bookingpress\_get\_customize\_settings('cancel\_button\_text', 'booking\_my\_booking'); |
| [1188](#L1188) | $bpa\_appointment\_cancellation\_confirmation = $BookingPress->bookingpress\_get\_settings('cancel\_appointment\_confirmation','message\_setting'); |
| [1189](#L1189) | $bpa\_no\_appointment\_available\_for\_cancel = $BookingPress->bookingpress\_get\_settings('no\_appointment\_available\_for\_cancel','message\_setting'); |
| [1190](#L1190) |  |
| [1191](#L1191) | $bpa\_cancel\_booking\_id\_text = !empty($bpa\_cancel\_booking\_id\_text) ? esc\_html($bpa\_cancel\_booking\_id\_text) : ''; |
| [1192](#L1192) | $bpa\_cancel\_service\_text = !empty($bpa\_cancel\_service\_text) ? esc\_html($bpa\_cancel\_service\_text) : ''; |
| [1193](#L1193) | $bpa\_cancel\_date\_time\_text = !empty($bpa\_cancel\_date\_time\_text) ? esc\_html($bpa\_cancel\_date\_time\_text) : ''; |
| [1194](#L1194) | $bpa\_cancel\_button\_text = !empty($bpa\_cancel\_button\_text) ? esc\_html($bpa\_cancel\_button\_text) : ''; |
| [1195](#L1195) |  |
| [1196](#L1196) | $bpa\_no\_appointment\_available\_for\_cancel = !empty($bpa\_no\_appointment\_available\_for\_cancel) ? esc\_html($bpa\_no\_appointment\_available\_for\_cancel) : ''; |
| [1197](#L1197) |  |
| [1198](#L1198) | $bpa\_appointment\_cancellation\_confirmation = !empty($bpa\_appointment\_cancellation\_confirmation) ? esc\_html($bpa\_appointment\_cancellation\_confirmation) : ''; |
| [1199](#L1199) |  |
| [1200](#L1200) | $bookingpress\_appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_status,bookingpress\_appointment\_timezone,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_booking\_id,bookingpress\_service\_name FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$bkp\_ap\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [1201](#L1201) |  |
| [1202](#L1202) | if(!empty($bookingpress\_appointment\_data) && $bookingpress\_appointment\_data['bookingpress\_appointment\_status'] != '3') { |
| [1203](#L1203) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [1204](#L1204) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_details['wp\_default\_date\_format'] . ' ' . $bookingpress\_global\_details |
| [1205](#L1205) | ['wp\_default\_time\_format']; |
| [1206](#L1206) |  |
| [1207](#L1207) | $booked\_appointment\_datetime = esc\_html($bookingpress\_appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($bookingpress\_appointment\_data['bookingpress\_appointment\_time']); |
| [1208](#L1208) | $bpa\_appointment\_booking\_id = '#'.esc\_html($bookingpress\_appointment\_data['bookingpress\_booking\_id']); |
| [1209](#L1209) | $bpa\_appointment\_service\_name = stripslashes\_deep(esc\_html($bookingpress\_appointment\_data['bookingpress\_service\_name'])); |
| [1210](#L1210) |  |
| [1211](#L1211) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_appointment\_data['bookingpress\_appointment\_timezone'], $bookingpress\_appointment\_data ); |
| [1212](#L1212) | $bpa\_appointment\_date\_time = date($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [1213](#L1213) |  |
| [1214](#L1214) | $content .=' <el-main class="bpa-appointment-cancellation\_container" id="bookingpress\_appointment\_cancellation\_form\_'.$bookingpress\_uniq\_id.'"> |
| [1215](#L1215) | <div class="bpa-front-thankyou-module-container bpa-front-cancel-confirmation-container"> |
| [1216](#L1216) | <div class="bpa-front-cc\_\_error-toast-notification" v-if="bookingpress\_cancel\_variant == \'error\'" v-html="bookingpress\_cancel\_msg"></div> |
| [1217](#L1217) | <div class="bpa-front-tmc\_\_head"> |
| [1218](#L1218) | <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="bpa-front-tmc\_\_vector--confirmation" xmlns="http://www.w3.org/2000/svg"> |
| [1219](#L1219) | <path fill-rule="evenodd" clip-rule="evenodd" |
| [1220](#L1220) | d="M90.7002 85.4609C84.4375 93.0097 72.3956 90.9929 62.8277 93.3709C53.5335 95.6809 44.3866 102.22 35.2915 99.2322C26.2099 96.2487 22.8396 85.5958 16.7964 78.2483C10.8588 71.029 1.14803 65.6955 0.0978856 56.4422C-0.951171 47.1985 6.67152 39.5221 11.4957 31.5412C15.8676 24.3085 20.1527 17.1388 26.9344 12.0453C34.1982 6.58966 42.3994 1.52536 51.5153 1.48363C60.7 1.44158 68.4886 7.22002 76.4135 11.8188C84.8089 16.6906 95.7104 20.0478 99.0838 29.0876C102.453 38.117 94.606 47.2497 93.1897 56.7734C91.7484 66.465 96.9793 77.8922 90.7002 85.4609Z" |
| [1221](#L1221) | class="bpa-front-vc\_\_bg" /> |
| [1222](#L1222) | <path |
| [1223](#L1223) | d="M82.6133 69.7307C82.3433 70.1385 82.386 70.6258 82.2851 71.0748C80.968 76.9215 75.5745 81.4923 68.9549 81.3047C62.9363 81.13 57.6068 76.5791 56.5156 70.5647C56.1894 68.8291 56.2157 67.0455 56.5929 65.3202C56.9701 63.5949 57.6905 61.9631 58.7112 60.5219C59.7319 59.0808 61.0321 57.8596 62.5344 56.9311C64.0367 56.0027 65.7104 55.3859 67.4559 55.1175C74.6368 53.9809 81.444 59.0447 82.4911 66.3093C82.5082 66.4259 82.4286 66.5935 82.6133 66.6475V69.7307ZM63.219 73.5939C63.2276 73.7806 63.2905 73.9608 63.4 74.1123C63.5096 74.2637 63.661 74.3799 63.8357 74.4464C64.2903 74.6283 64.6541 74.4777 64.9723 74.1622C66.3932 72.7414 67.814 71.3419 69.2078 69.9126C69.492 69.617 69.6468 69.5772 69.958 69.8983C71.2026 71.1856 72.48 72.4402 73.7473 73.7062C73.8633 73.8323 73.9877 73.9505 74.1196 74.0599C74.3031 74.2167 74.5389 74.2986 74.7801 74.2894C75.0212 74.2802 75.2501 74.1805 75.4211 74.0102C75.5943 73.8436 75.6998 73.6188 75.7173 73.3791C75.7349 73.1394 75.6633 72.9017 75.5163 72.7116C75.399 72.5594 75.2698 72.4169 75.1298 72.2853C73.8511 71.0066 72.5723 69.7179 71.2936 68.4491C71.0449 68.2061 71.0222 68.0754 71.2865 67.8268C72.021 67.1348 72.7244 66.406 73.4404 65.6955L75.4296 63.7178C75.7223 63.4251 75.8473 63.0798 75.7138 62.6777C75.6621 62.5025 75.5615 62.3457 75.4238 62.2257C75.2862 62.1057 75.1172 62.0274 74.9366 62C74.5103 61.9176 74.2105 62.1321 73.9292 62.4134C72.6391 63.7092 71.3248 64.9837 70.0646 66.3065C69.6809 66.7086 69.4962 66.6319 69.1538 66.2838C67.8751 64.9738 66.5736 63.6908 65.2807 62.3978C65.1997 62.3168 65.1201 62.2344 65.0377 62.1563C64.5106 61.649 63.9635 61.6007 63.5245 62.0142C63.0855 62.4277 63.1267 63.0244 63.651 63.5771L63.732 63.6581C65.0661 64.9908 66.3804 66.3463 67.7472 67.6435C68.1848 68.0598 68.1209 68.2601 67.7245 68.6381C66.3647 69.9452 65.0491 71.2964 63.7106 72.6249C63.4378 72.8949 63.2119 73.1662 63.219 73.5939Z" |
| [1224](#L1224) | class="bpa-head\_\_vector-item" /> |
| [1225](#L1225) | <path |
| [1226](#L1226) | d="M46.9914 34.1763C54.4242 34.1763 61.8599 34.1716 69.2983 34.1621C69.8312 34.1621 69.942 34.3042 69.9406 34.8171C69.9216 40.6899 69.9216 46.5626 69.9406 52.4353C69.9406 52.9127 69.8212 53.0165 69.3523 53.0207C65.7787 53.0403 62.3274 54.3247 59.6103 56.6461C56.8933 58.9676 55.086 62.1762 54.509 65.703C54.2154 67.4168 54.24 69.1699 54.5815 70.8748C54.6738 71.3209 54.553 71.4133 54.1126 71.4133C45.7453 71.4005 37.3781 71.4133 29.0109 71.4005C26.0414 71.4005 24.0678 69.4113 24.0678 66.4489C24.0678 55.8894 24.0621 45.3303 24.0508 34.7716C24.0508 34.2189 24.2398 34.1735 24.6973 34.1735C32.1244 34.182 39.5558 34.1829 46.9914 34.1763ZM45.5976 49.1689H53.8824C54.7789 49.1689 55.6755 49.1816 56.5706 49.1589C56.6996 49.1597 56.8275 49.1347 56.9467 49.0855C57.0659 49.0363 57.1742 48.9638 57.265 48.8722C57.3559 48.7807 57.4277 48.6719 57.476 48.5523C57.5244 48.4327 57.5484 48.3047 57.5467 48.1757C57.5375 47.9256 57.436 47.6877 57.2617 47.508C57.0875 47.3283 56.853 47.2195 56.6033 47.2024C56.4328 47.1868 56.2609 47.1953 56.0889 47.1953H35.0536C34.8822 47.1889 34.7105 47.1918 34.5393 47.2039C34.4009 47.2136 34.2662 47.2528 34.1442 47.3188C34.0221 47.3847 33.9155 47.4759 33.8315 47.5863C33.7475 47.6967 33.6879 47.8237 33.6569 47.9589C33.6258 48.0941 33.6239 48.2344 33.6513 48.3704C33.738 48.9003 34.1273 49.1674 34.8476 49.1674C38.4309 49.1703 42.0143 49.1708 45.5976 49.1689ZM41.1419 58.3943H47.3097C48.2545 58.3943 48.7461 58.049 48.7461 57.3897C48.7461 56.7305 48.2659 56.3952 47.3054 56.3952H35.0281C34.838 56.3897 34.6479 56.4006 34.4597 56.4279C33.9724 56.5159 33.6783 56.8101 33.6413 57.3116C33.6044 57.8132 33.8332 58.1428 34.2992 58.3246C34.4993 58.3872 34.7096 58.4108 34.9187 58.3943H41.1419Z" |
| [1227](#L1227) | fill="#727E95" /> |
| [1228](#L1228) | <path |
| [1229](#L1229) | d="M46.9156 32.214C39.4838 32.214 32.051 32.2177 24.6172 32.2253C24.1469 32.2253 24.0034 32.1259 24.0318 31.6428C24.1114 30.2561 23.9025 28.8565 24.1455 27.4783C24.3243 26.4557 24.8489 25.5255 25.6315 24.8434C26.4142 24.1614 27.4074 23.7689 28.4449 23.7316C30.4824 23.6748 32.5227 23.7174 34.5616 23.7004C34.867 23.7004 34.9466 23.7941 34.9409 24.0883C34.9239 24.9265 34.9296 25.7648 34.9409 26.6031C34.9409 27.3533 35.3331 27.8137 35.9355 27.8137C36.5379 27.8137 36.9301 27.3547 36.9301 26.6017C36.9386 25.8217 36.9599 25.0388 36.9215 24.2588C36.9002 23.8112 37.0295 23.6904 37.4799 23.6904C42.4528 23.7075 47.4257 23.7018 52.3986 23.7018C53.7896 23.7018 55.182 23.7132 56.573 23.6933C56.9154 23.6933 57.0362 23.7657 57.0234 24.1309C56.9935 24.9493 57.0077 25.7691 57.0148 26.5889C57.0219 27.3434 57.4027 27.8023 58.0094 27.808C58.6161 27.8137 59.004 27.3519 59.0168 26.606C59.0253 25.7861 59.0338 24.9663 59.0168 24.1479C59.0083 23.814 59.0722 23.6876 59.443 23.6919C61.3668 23.7132 63.2935 23.6805 65.2173 23.7075C67.9623 23.7458 69.9188 25.7847 69.906 28.5383C69.906 29.567 69.8762 30.5971 69.9174 31.6243C69.9358 32.1017 69.808 32.2154 69.3306 32.214C61.8618 32.2045 54.3901 32.2045 46.9156 32.214Z" |
| [1230](#L1230) | fill="#727E95" /> |
| [1231](#L1231) | <path |
| [1232](#L1232) | d="M8.12945 32.8244L8.16195 32.9235H8.25458L8.17964 32.9774L8.21066 33.072L8.12945 33.0136L8.04823 33.072L8.07925 32.9774L8.00431 32.9235H8.09695L8.12945 32.8244Z" |
| [1233](#L1233) | stroke="#12D488" stroke-width="0.758084" /> |
| [1234](#L1234) | <path |
| [1235](#L1235) | d="M98.6334 39.8249L98.6659 39.924H98.7585L98.6835 39.9779L98.7146 40.0725L98.6334 40.0141L98.5521 40.0725L98.5832 39.9779L98.5082 39.924H98.6009L98.6334 39.8249Z" |
| [1236](#L1236) | stroke="#12D488" stroke-width="0.758084" /> |
| [1237](#L1237) | <path |
| [1238](#L1238) | d="M70.5904 92.4333L70.6229 92.5324H70.7155L70.6406 92.5863L70.6716 92.6809L70.5904 92.6225L70.5092 92.6809L70.5402 92.5863L70.4652 92.5324H70.5579L70.5904 92.4333Z" |
| [1239](#L1239) | stroke="#F5AE41" stroke-width="0.758084" /> |
| [1240](#L1240) | <path |
| [1241](#L1241) | d="M47.4161 1.12892C47.4161 1.53965 47.079 1.8788 46.6554 1.8788C46.2318 1.8788 45.8947 1.53965 45.8947 1.12892C45.8947 0.718185 46.2318 0.379042 46.6554 0.379042C47.079 0.379042 47.4161 0.718185 47.4161 1.12892Z" |
| [1242](#L1242) | stroke="#EE2445" stroke-opacity="0.7" stroke-width="0.758084" /> |
| [1243](#L1243) | <path |
| [1244](#L1244) | d="M94.1466 65.4766C94.1466 65.8873 93.8094 66.2265 93.3859 66.2265C92.9623 66.2265 92.6251 65.8873 92.6251 65.4766C92.6251 65.0658 92.9623 64.7267 93.3859 64.7267C93.8094 64.7267 94.1466 65.0658 94.1466 65.4766Z" |
| [1245](#L1245) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1246](#L1246) | <path |
| [1247](#L1247) | d="M2.50988 65.4766C2.50988 65.8873 2.17272 66.2265 1.74915 66.2265C1.32558 66.2265 0.988417 65.8873 0.988417 65.4766C0.988417 65.0658 1.32558 64.7267 1.74915 64.7267C2.17272 64.7267 2.50988 65.0658 2.50988 65.4766Z" |
| [1248](#L1248) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1249](#L1249) | <path |
| [1250](#L1250) | d="M77.6641 12.8238C78.4239 12.8238 78.7152 12.1011 78.7658 11.7397C78.7658 12.4874 79.551 12.7889 79.9436 12.8388C79.0318 12.8388 78.7785 13.6113 78.7658 13.9976C78.7658 13.1602 78.0313 12.8612 77.6641 12.8238Z" |
| [1251](#L1251) | stroke="#F4B125" stroke-width="0.758084" stroke-linejoin="round" /> |
| [1252](#L1252) | <line x1="78.6483" y1="10.683" x2="78.6483" y2="10.3121" stroke="#F4B125" stroke-width="0.758084" |
| [1253](#L1253) | stroke-linecap="round" /> |
| [1254](#L1254) | <line x1="78.6483" y1="16.3275" x2="78.6483" y2="15.2793" stroke="#F4B125" stroke-width="0.758084" |
| [1255](#L1255) | stroke-linecap="round" /> |
| [1256](#L1256) | <path d="M80.625 12.897H81.9927" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1257](#L1257) | <path d="M75.6094 12.897H76.4642" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1258](#L1258) | </svg> |
| [1259](#L1259) | <div class="bpa-front-tmc\_\_booking-id"> |
| [1260](#L1260) | <div class="bpa-front-bi\_\_label">'.$bpa\_appointment\_cancellation\_confirmation.'</div> |
| [1261](#L1261) | </div> |
| [1262](#L1262) | </div> |
| [1263](#L1263) | <div class="bpa-front-tmc\_\_summary-content"> |
| [1264](#L1264) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1265](#L1265) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_booking\_id\_text.':</div> |
| [1266](#L1266) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_booking\_id.'</div> |
| [1267](#L1267) | </div> |
| [1268](#L1268) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1269](#L1269) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_service\_text.':</div> |
| [1270](#L1270) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_service\_name.'</div> |
| [1271](#L1271) | </div> |
| [1272](#L1272) | <div class="bpa-front-tmc\_\_sc-item"> |
| [1273](#L1273) | <div class="bpa-front-sc-item\_\_label">'.$bpa\_cancel\_date\_time\_text.':</div> |
| [1274](#L1274) | <div class="bpa-front-sc-item\_\_val">'.$bpa\_appointment\_date\_time.'</div> |
| [1275](#L1275) | </div> |
| [1276](#L1276) | </div>'; |
| [1277](#L1277) | $content = apply\_filters('bookingpress\_add\_cancel\_appointment\_extra\_content',$content,$bkp\_ap\_id); |
| [1278](#L1278) | $content .="<el-button class='bpa-front-btn bpa-front-btn--primary' @click='bookingpress\_cancel\_appointment(bookingpress\_appointment\_id,bookingpress\_cancel\_token)' :disabled='is\_cancel\_button\_disabled' :class='(is\_cancel\_appointment\_loader == \"1\") ? \"bpa-front-btn--is-loader\" : \"\"'>"; |
| [1279](#L1279) | $content .= '<span class="bpa-btn\_\_label">'.$bpa\_cancel\_button\_text.'</span> |
| [1280](#L1280) | <div class="bpa-front-btn--loader\_\_circles"> |
| [1281](#L1281) | <div></div> |
| [1282](#L1282) | <div></div> |
| [1283](#L1283) | <div></div> |
| [1284](#L1284) | </div> |
| [1285](#L1285) | </el-button> |
| [1286](#L1286) | </div> |
| [1287](#L1287) |  |
| [1288](#L1288) | </el-main>'; |
| [1289](#L1289) | } else { |
| [1290](#L1290) | $content .=' |
| [1291](#L1291) | <div class="bpa-front-thankyou-module-container bpa-front-cancel-confirmation-container"> |
| [1292](#L1292) | <div class="bpa-front-tmc\_\_head"> |
| [1293](#L1293) | <svg width="100" height="100" viewBox="0 0 100 100" fill="none" class="bpa-front-tmc\_\_vector--confirmation" xmlns="http://www.w3.org/2000/svg"> |
| [1294](#L1294) | <path fill-rule="evenodd" clip-rule="evenodd" |
| [1295](#L1295) | d="M90.7002 85.4609C84.4375 93.0097 72.3956 90.9929 62.8277 93.3709C53.5335 95.6809 44.3866 102.22 35.2915 99.2322C26.2099 96.2487 22.8396 85.5958 16.7964 78.2483C10.8588 71.029 1.14803 65.6955 0.0978856 56.4422C-0.951171 47.1985 6.67152 39.5221 11.4957 31.5412C15.8676 24.3085 20.1527 17.1388 26.9344 12.0453C34.1982 6.58966 42.3994 1.52536 51.5153 1.48363C60.7 1.44158 68.4886 7.22002 76.4135 11.8188C84.8089 16.6906 95.7104 20.0478 99.0838 29.0876C102.453 38.117 94.606 47.2497 93.1897 56.7734C91.7484 66.465 96.9793 77.8922 90.7002 85.4609Z" |
| [1296](#L1296) | class="bpa-front-vc\_\_bg" /> |
| [1297](#L1297) | <path |
| [1298](#L1298) | d="M82.6133 69.7307C82.3433 70.1385 82.386 70.6258 82.2851 71.0748C80.968 76.9215 75.5745 81.4923 68.9549 81.3047C62.9363 81.13 57.6068 76.5791 56.5156 70.5647C56.1894 68.8291 56.2157 67.0455 56.5929 65.3202C56.9701 63.5949 57.6905 61.9631 58.7112 60.5219C59.7319 59.0808 61.0321 57.8596 62.5344 56.9311C64.0367 56.0027 65.7104 55.3859 67.4559 55.1175C74.6368 53.9809 81.444 59.0447 82.4911 66.3093C82.5082 66.4259 82.4286 66.5935 82.6133 66.6475V69.7307ZM63.219 73.5939C63.2276 73.7806 63.2905 73.9608 63.4 74.1123C63.5096 74.2637 63.661 74.3799 63.8357 74.4464C64.2903 74.6283 64.6541 74.4777 64.9723 74.1622C66.3932 72.7414 67.814 71.3419 69.2078 69.9126C69.492 69.617 69.6468 69.5772 69.958 69.8983C71.2026 71.1856 72.48 72.4402 73.7473 73.7062C73.8633 73.8323 73.9877 73.9505 74.1196 74.0599C74.3031 74.2167 74.5389 74.2986 74.7801 74.2894C75.0212 74.2802 75.2501 74.1805 75.4211 74.0102C75.5943 73.8436 75.6998 73.6188 75.7173 73.3791C75.7349 73.1394 75.6633 72.9017 75.5163 72.7116C75.399 72.5594 75.2698 72.4169 75.1298 72.2853C73.8511 71.0066 72.5723 69.7179 71.2936 68.4491C71.0449 68.2061 71.0222 68.0754 71.2865 67.8268C72.021 67.1348 72.7244 66.406 73.4404 65.6955L75.4296 63.7178C75.7223 63.4251 75.8473 63.0798 75.7138 62.6777C75.6621 62.5025 75.5615 62.3457 75.4238 62.2257C75.2862 62.1057 75.1172 62.0274 74.9366 62C74.5103 61.9176 74.2105 62.1321 73.9292 62.4134C72.6391 63.7092 71.3248 64.9837 70.0646 66.3065C69.6809 66.7086 69.4962 66.6319 69.1538 66.2838C67.8751 64.9738 66.5736 63.6908 65.2807 62.3978C65.1997 62.3168 65.1201 62.2344 65.0377 62.1563C64.5106 61.649 63.9635 61.6007 63.5245 62.0142C63.0855 62.4277 63.1267 63.0244 63.651 63.5771L63.732 63.6581C65.0661 64.9908 66.3804 66.3463 67.7472 67.6435C68.1848 68.0598 68.1209 68.2601 67.7245 68.6381C66.3647 69.9452 65.0491 71.2964 63.7106 72.6249C63.4378 72.8949 63.2119 73.1662 63.219 73.5939Z" |
| [1299](#L1299) | class="bpa-head\_\_vector-item" /> |
| [1300](#L1300) | <path |
| [1301](#L1301) | d="M46.9914 34.1763C54.4242 34.1763 61.8599 34.1716 69.2983 34.1621C69.8312 34.1621 69.942 34.3042 69.9406 34.8171C69.9216 40.6899 69.9216 46.5626 69.9406 52.4353C69.9406 52.9127 69.8212 53.0165 69.3523 53.0207C65.7787 53.0403 62.3274 54.3247 59.6103 56.6461C56.8933 58.9676 55.086 62.1762 54.509 65.703C54.2154 67.4168 54.24 69.1699 54.5815 70.8748C54.6738 71.3209 54.553 71.4133 54.1126 71.4133C45.7453 71.4005 37.3781 71.4133 29.0109 71.4005C26.0414 71.4005 24.0678 69.4113 24.0678 66.4489C24.0678 55.8894 24.0621 45.3303 24.0508 34.7716C24.0508 34.2189 24.2398 34.1735 24.6973 34.1735C32.1244 34.182 39.5558 34.1829 46.9914 34.1763ZM45.5976 49.1689H53.8824C54.7789 49.1689 55.6755 49.1816 56.5706 49.1589C56.6996 49.1597 56.8275 49.1347 56.9467 49.0855C57.0659 49.0363 57.1742 48.9638 57.265 48.8722C57.3559 48.7807 57.4277 48.6719 57.476 48.5523C57.5244 48.4327 57.5484 48.3047 57.5467 48.1757C57.5375 47.9256 57.436 47.6877 57.2617 47.508C57.0875 47.3283 56.853 47.2195 56.6033 47.2024C56.4328 47.1868 56.2609 47.1953 56.0889 47.1953H35.0536C34.8822 47.1889 34.7105 47.1918 34.5393 47.2039C34.4009 47.2136 34.2662 47.2528 34.1442 47.3188C34.0221 47.3847 33.9155 47.4759 33.8315 47.5863C33.7475 47.6967 33.6879 47.8237 33.6569 47.9589C33.6258 48.0941 33.6239 48.2344 33.6513 48.3704C33.738 48.9003 34.1273 49.1674 34.8476 49.1674C38.4309 49.1703 42.0143 49.1708 45.5976 49.1689ZM41.1419 58.3943H47.3097C48.2545 58.3943 48.7461 58.049 48.7461 57.3897C48.7461 56.7305 48.2659 56.3952 47.3054 56.3952H35.0281C34.838 56.3897 34.6479 56.4006 34.4597 56.4279C33.9724 56.5159 33.6783 56.8101 33.6413 57.3116C33.6044 57.8132 33.8332 58.1428 34.2992 58.3246C34.4993 58.3872 34.7096 58.4108 34.9187 58.3943H41.1419Z" |
| [1302](#L1302) | fill="#727E95" /> |
| [1303](#L1303) | <path |
| [1304](#L1304) | d="M46.9156 32.214C39.4838 32.214 32.051 32.2177 24.6172 32.2253C24.1469 32.2253 24.0034 32.1259 24.0318 31.6428C24.1114 30.2561 23.9025 28.8565 24.1455 27.4783C24.3243 26.4557 24.8489 25.5255 25.6315 24.8434C26.4142 24.1614 27.4074 23.7689 28.4449 23.7316C30.4824 23.6748 32.5227 23.7174 34.5616 23.7004C34.867 23.7004 34.9466 23.7941 34.9409 24.0883C34.9239 24.9265 34.9296 25.7648 34.9409 26.6031C34.9409 27.3533 35.3331 27.8137 35.9355 27.8137C36.5379 27.8137 36.9301 27.3547 36.9301 26.6017C36.9386 25.8217 36.9599 25.0388 36.9215 24.2588C36.9002 23.8112 37.0295 23.6904 37.4799 23.6904C42.4528 23.7075 47.4257 23.7018 52.3986 23.7018C53.7896 23.7018 55.182 23.7132 56.573 23.6933C56.9154 23.6933 57.0362 23.7657 57.0234 24.1309C56.9935 24.9493 57.0077 25.7691 57.0148 26.5889C57.0219 27.3434 57.4027 27.8023 58.0094 27.808C58.6161 27.8137 59.004 27.3519 59.0168 26.606C59.0253 25.7861 59.0338 24.9663 59.0168 24.1479C59.0083 23.814 59.0722 23.6876 59.443 23.6919C61.3668 23.7132 63.2935 23.6805 65.2173 23.7075C67.9623 23.7458 69.9188 25.7847 69.906 28.5383C69.906 29.567 69.8762 30.5971 69.9174 31.6243C69.9358 32.1017 69.808 32.2154 69.3306 32.214C61.8618 32.2045 54.3901 32.2045 46.9156 32.214Z" |
| [1305](#L1305) | fill="#727E95" /> |
| [1306](#L1306) | <path |
| [1307](#L1307) | d="M8.12945 32.8244L8.16195 32.9235H8.25458L8.17964 32.9774L8.21066 33.072L8.12945 33.0136L8.04823 33.072L8.07925 32.9774L8.00431 32.9235H8.09695L8.12945 32.8244Z" |
| [1308](#L1308) | stroke="#12D488" stroke-width="0.758084" /> |
| [1309](#L1309) | <path |
| [1310](#L1310) | d="M98.6334 39.8249L98.6659 39.924H98.7585L98.6835 39.9779L98.7146 40.0725L98.6334 40.0141L98.5521 40.0725L98.5832 39.9779L98.5082 39.924H98.6009L98.6334 39.8249Z" |
| [1311](#L1311) | stroke="#12D488" stroke-width="0.758084" /> |
| [1312](#L1312) | <path |
| [1313](#L1313) | d="M70.5904 92.4333L70.6229 92.5324H70.7155L70.6406 92.5863L70.6716 92.6809L70.5904 92.6225L70.5092 92.6809L70.5402 92.5863L70.4652 92.5324H70.5579L70.5904 92.4333Z" |
| [1314](#L1314) | stroke="#F5AE41" stroke-width="0.758084" /> |
| [1315](#L1315) | <path |
| [1316](#L1316) | d="M47.4161 1.12892C47.4161 1.53965 47.079 1.8788 46.6554 1.8788C46.2318 1.8788 45.8947 1.53965 45.8947 1.12892C45.8947 0.718185 46.2318 0.379042 46.6554 0.379042C47.079 0.379042 47.4161 0.718185 47.4161 1.12892Z" |
| [1317](#L1317) | stroke="#EE2445" stroke-opacity="0.7" stroke-width="0.758084" /> |
| [1318](#L1318) | <path |
| [1319](#L1319) | d="M94.1466 65.4766C94.1466 65.8873 93.8094 66.2265 93.3859 66.2265C92.9623 66.2265 92.6251 65.8873 92.6251 65.4766C92.6251 65.0658 92.9623 64.7267 93.3859 64.7267C93.8094 64.7267 94.1466 65.0658 94.1466 65.4766Z" |
| [1320](#L1320) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1321](#L1321) | <path |
| [1322](#L1322) | d="M2.50988 65.4766C2.50988 65.8873 2.17272 66.2265 1.74915 66.2265C1.32558 66.2265 0.988417 65.8873 0.988417 65.4766C0.988417 65.0658 1.32558 64.7267 1.74915 64.7267C2.17272 64.7267 2.50988 65.0658 2.50988 65.4766Z" |
| [1323](#L1323) | stroke="#EE2445" stroke-opacity="0.6" stroke-width="0.758084" /> |
| [1324](#L1324) | <path |
| [1325](#L1325) | d="M77.6641 12.8238C78.4239 12.8238 78.7152 12.1011 78.7658 11.7397C78.7658 12.4874 79.551 12.7889 79.9436 12.8388C79.0318 12.8388 78.7785 13.6113 78.7658 13.9976C78.7658 13.1602 78.0313 12.8612 77.6641 12.8238Z" |
| [1326](#L1326) | stroke="#F4B125" stroke-width="0.758084" stroke-linejoin="round" /> |
| [1327](#L1327) | <line x1="78.6483" y1="10.683" x2="78.6483" y2="10.3121" stroke="#F4B125" stroke-width="0.758084" |
| [1328](#L1328) | stroke-linecap="round" /> |
| [1329](#L1329) | <line x1="78.6483" y1="16.3275" x2="78.6483" y2="15.2793" stroke="#F4B125" stroke-width="0.758084" |
| [1330](#L1330) | stroke-linecap="round" /> |
| [1331](#L1331) | <path d="M80.625 12.897H81.9927" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1332](#L1332) | <path d="M75.6094 12.897H76.4642" stroke="#F4B125" stroke-width="0.758084" stroke-linecap="round" /> |
| [1333](#L1333) | </svg> |
| [1334](#L1334) | <div class="bpa-front-tmc\_\_booking-id"> |
| [1335](#L1335) | <div class="bpa-front-bi\_\_label">'.$bpa\_appointment\_cancellation\_confirmation.'</div> |
| [1336](#L1336) | </div> |
| [1337](#L1337) | </div> |
| [1338](#L1338) | <div class="bpa-front-refund-confirmation-content"> |
| [1339](#L1339) | <div class="bpa-front-rcc\_\_body"> |
| [1340](#L1340) | <div class="bpa-front-rcc\_\_empty-msg">'.$bpa\_no\_appointment\_available\_for\_cancel.'</div> |
| [1341](#L1341) | </div> |
| [1342](#L1342) | </div>'; |
| [1343](#L1343) | } |
| [1344](#L1344) |  |
| [1345](#L1345) | add\_action( |
| [1346](#L1346) | 'wp\_footer', |
| [1347](#L1347) | function () use ( &$bookingpress\_uniq\_id,$bkp\_ap\_id,$bookingpress\_cancel\_token ) { |
| [1348](#L1348) | global $bookingpress\_global\_options ,$BookingPress; |
| [1349](#L1349) | $requested\_module                = 'cancellation\_confirmation'; |
| [1350](#L1350) |  |
| [1351](#L1351) | ?> |
| [1352](#L1352) | <script> |
| [1353](#L1353) | window.addEventListener('DOMContentLoaded', function() { |
| [1354](#L1354) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_helper\_vars'); ?> |
| [1355](#L1355) | var app = new Vue({ |
| [1356](#L1356) | el: '#bookingpress\_appointment\_cancellation\_form\_<?php echo esc\_html($bookingpress\_uniq\_id); ?>', |
| [1357](#L1357) | directives: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_directives'); ?> }, |
| [1358](#L1358) | components: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_components'); ?> }, |
| [1359](#L1359) | data() { |
| [1360](#L1360) | var bookingpress\_return\_data = <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields'); ?>; |
| [1361](#L1361) | bookingpress\_return\_data['bookingpress\_uniq\_id'] = '<?php echo esc\_html($bookingpress\_uniq\_id); ?>'; |
| [1362](#L1362) | bookingpress\_return\_data['bookingpress\_appointment\_id'] = '<?php echo intval($bkp\_ap\_id); ?>'; |
| [1363](#L1363) | bookingpress\_return\_data['bookingpress\_cancel\_token'] = '<?php echo esc\_html($bookingpress\_cancel\_token); ?>'; |
| [1364](#L1364) | return bookingpress\_return\_data; |
| [1365](#L1365) | }, |
| [1366](#L1366) | filters:{ |
| [1367](#L1367) |  |
| [1368](#L1368) | }, |
| [1369](#L1369) | beforeCreate(){ |
| [1370](#L1370) | this.is\_front\_appointment\_empty\_loader = '1'; |
| [1371](#L1371) | }, |
| [1372](#L1372) | created(){ |
| [1373](#L1373) | }, |
| [1374](#L1374) | mounted() { |
| [1375](#L1375) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_on\_load\_methods'); ?> |
| [1376](#L1376) | }, |
| [1377](#L1377) | methods: { |
| [1378](#L1378) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_vue\_methods'); ?> |
| [1379](#L1379) | }, |
| [1380](#L1380) | }); |
| [1381](#L1381) | }); |
| [1382](#L1382) | </script> |
| [1383](#L1383) | <?php |
| [1384](#L1384) | }, |
| [1385](#L1385) | 100 |
| [1386](#L1386) | ); |
| [1387](#L1387) | } |
| [1388](#L1388) | return do\_shortcode($content); |
| [1389](#L1389) | } |
| [1390](#L1390) |  |
| [1391](#L1391) | /\*\* |
| [1392](#L1392) | \* Get appointment details for thank you page calendar |
| [1393](#L1393) | \* |
| [1394](#L1394) | \* @return void |
| [1395](#L1395) | \*/ |
| [1396](#L1396) | function bookingpress\_get\_appointment\_details\_for\_calendar\_func( $appointment\_id, $return = false ){ |
| [1397](#L1397) | global $wpdb, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_appointment\_bookings, $BookingPress; |
| [1398](#L1398) | $response              = array(); |
| [1399](#L1399) |  |
| [1400](#L1400) | $response['variant']    = 'error'; |
| [1401](#L1401) | $response['title']      = 'Error'; |
| [1402](#L1402) | $response['msg']        = 'Something went wrong....'; |
| [1403](#L1403) | $response['google\_calendar\_link'] = ''; |
| [1404](#L1404) | $response['yahoo\_calendar\_link'] = ''; |
| [1405](#L1405) |  |
| [1406](#L1406) | $bookingpress\_appointment\_id = $appointment\_id; |
| [1407](#L1407) |  |
| [1408](#L1408) | if(!empty($bookingpress\_appointment\_id)){ |
| [1409](#L1409) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d OR bookingpress\_entry\_id = %d", $bookingpress\_appointment\_id, $bookingpress\_appointment\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [1410](#L1410) |  |
| [1411](#L1411) | if(!empty($appointment\_data)){ |
| [1412](#L1412) | $service\_id = intval( $appointment\_data['bookingpress\_service\_id'] ); |
| [1413](#L1413) |  |
| [1414](#L1414) | $bookingpress\_start\_time = $start\_time =  sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_time'] ); |
| [1415](#L1415) | $bookingpress\_end\_time = $end\_time = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_end\_time'] ); |
| [1416](#L1416) |  |
| [1417](#L1417) | $bookingpress\_appointment\_date\_temp = $appointment\_data['bookingpress\_appointment\_date']; |
| [1418](#L1418) | if ($bookingpress\_end\_time === '24:00:00') { |
| [1419](#L1419) | $bookingpress\_appointment\_date\_temp = date('Y-m-d', strtotime($appointment\_data['bookingpress\_appointment\_date'] . ' +1 day')); |
| [1420](#L1420) | $bookingpress\_end\_time = '00:00:00'; |
| [1421](#L1421) | } |
| [1422](#L1422) |  |
| [1423](#L1423) | $service\_duration = sanitize\_text\_field( $appointment\_data['bookingpress\_service\_duration\_val'] ); |
| [1424](#L1424) |  |
| [1425](#L1425) | $service\_duration\_unit = sanitize\_text\_field( $appointment\_data['bookingpress\_service\_duration\_unit'] ); |
| [1426](#L1426) |  |
| [1427](#L1427) | $bookingpress\_start\_time\_for\_yahoo = date( 'Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ) . 'T' . date( 'His', strtotime( $bookingpress\_start\_time ) ) . 'Z'; |
| [1428](#L1428) |  |
| [1429](#L1429) | $bookingpress\_start\_time = $this->bookingpress\_convert\_date\_time\_to\_utc( $appointment\_data['bookingpress\_appointment\_date'], $bookingpress\_start\_time ); |
| [1430](#L1430) | $bookingpress\_end\_time = $this->bookingpress\_convert\_date\_time\_to\_utc( $bookingpress\_appointment\_date\_temp , $bookingpress\_end\_time ); |
| [1431](#L1431) |  |
| [1432](#L1432) | $bookingpress\_service\_name = ! empty( $appointment\_data['bookingpress\_service\_name'] ) ? stripslashes\_deep($appointment\_data['bookingpress\_service\_name']) : ''; |
| [1433](#L1433) |  |
| [1434](#L1434) | if ( 'd' != $service\_duration\_unit ) { |
| [1435](#L1435) | $bookingpress\_tmp\_start\_time = new DateTime($start\_time); |
| [1436](#L1436) | $bookingpress\_tmp\_end\_time = new DateTime($end\_time); |
| [1437](#L1437) | $booking\_date\_interval = $bookingpress\_tmp\_start\_time->diff($bookingpress\_tmp\_end\_time); |
| [1438](#L1438) | $service\_duration\_time = ($booking\_date\_interval->h \* 60) + ($booking\_date\_interval->i); |
| [1439](#L1439) | $service\_duration\_time = '00'.$service\_duration\_time; |
| [1440](#L1440) | } else { |
| [1441](#L1441) | $service\_duration\_time = $service\_duration . '00'; |
| [1442](#L1442) | $bookingpress\_start\_time = date('Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ); |
| [1443](#L1443) | $bookingpress\_end\_time = date('Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] . '+' . $service\_duration.' days' ) ); |
| [1444](#L1444) | } |
| [1445](#L1445) |  |
| [1446](#L1446) | $response['variant'] = 'success'; |
| [1447](#L1447) | $response['title'] = 'Success'; |
| [1448](#L1448) | $response['msg'] = 'Links generated successfully'; |
| [1449](#L1449) | $response['google\_calendar\_link'] = urlencode($bookingpress\_service\_name)."&dates=".esc\_html($bookingpress\_start\_time)."/".esc\_html($bookingpress\_end\_time); |
| [1450](#L1450) | $response['yahoo\_calendar\_link'] = urlencode($bookingpress\_service\_name)."&st=".esc\_html($bookingpress\_start\_time\_for\_yahoo)."&dur=".esc\_html($service\_duration\_time); |
| [1451](#L1451) | } |
| [1452](#L1452) | } |
| [1453](#L1453) |  |
| [1454](#L1454) | return $response; |
| [1455](#L1455) | } |
| [1456](#L1456) |  |
| [1457](#L1457) |  |
| [1458](#L1458) | /\*\* |
| [1459](#L1459) | \* Background function for disable future dates |
| [1460](#L1460) | \* |
| [1461](#L1461) | \* @return void |
| [1462](#L1462) | \*/ |
| [1463](#L1463) | function bookingpress\_get\_whole\_day\_appointments\_func($return\_data = false) { |
| [1464](#L1464) | // phpcs:ignore WordPress.Security.NonceVerification |
| [1465](#L1465) | global $BookingPress; |
| [1466](#L1466) |  |
| [1467](#L1467) | $month\_check = !empty( $\_POST['next\_month'] ) ? sanitize\_text\_field( $\_POST['next\_month'] ) : date('m', current\_time('timestamp') ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1468](#L1468) | $year\_check = !empty( $\_POST['next\_year'] ) ? sanitize\_text\_field( $\_POST['next\_year'] ) : date( 'Y', current\_time('timestamp') ); // phpcs:ignore WordPress.Security.NonceVerification |
| [1469](#L1469) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ // phpcs:ignore WordPress.Security.NonceVerification |
| [1470](#L1470) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [1471](#L1471) | $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1472](#L1472) | } |
| [1473](#L1473) |  |
| [1474](#L1474) | $bookingpress\_disabled\_dates = !empty($\_POST['days\_off\_disabled\_dates']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), explode(',',$\_POST['days\_off\_disabled\_dates']) ) : array(); // phpcs:ignore |
| [1475](#L1475) | $daysoff\_dates = $bookingpress\_disabled\_dates; |
| [1476](#L1476) |  |
| [1477](#L1477) | $first\_date\_of\_month = $year\_check . '-' . $month\_check . '-01'; |
| [1478](#L1478) | $last\_date\_of\_month = date('Y-m-t', strtotime( $first\_date\_of\_month ) ); |
| [1479](#L1479) |  |
| [1480](#L1480) | $start\_date = new DateTime( $first\_date\_of\_month ); |
| [1481](#L1481) | $end\_date = new DateTime( date('Y-m-d', strtotime($last\_date\_of\_month .'+1 day') ) ); |
| [1482](#L1482) |  |
| [1483](#L1483) | $interval = DateInterval::createFromDateString('1 day'); |
| [1484](#L1484) | $period = new DatePeriod( $start\_date, $interval, $end\_date ); |
| [1485](#L1485) |  |
| [1486](#L1486) | $extra\_disabled\_dates = array(); |
| [1487](#L1487) | $extra\_disabled\_dates\_t = array(); |
| [1488](#L1488) | foreach( $period as $dt ){ |
| [1489](#L1489) | $current\_date = $dt->format("Y-m-d H:i:s"); |
| [1490](#L1490) | $date\_t = date('c', strtotime( $current\_date ) ); |
| [1491](#L1491) | if( !in\_array( $date\_t, $daysoff\_dates ) ){ |
| [1492](#L1492) | $current\_selected\_date = $dt->format( 'Y-m-d' ); |
| [1493](#L1493) | $is\_time\_slot\_available = $this->bookingpress\_retrieve\_timeslots( $current\_selected\_date, true, true ); |
| [1494](#L1494) | if( false == $is\_time\_slot\_available ){ |
| [1495](#L1495) | $daysoff\_dates[] = $date\_t; |
| [1496](#L1496) | $extra\_disabled\_dates\_t[] = $date\_t; |
| [1497](#L1497) | $extra\_disabled\_dates[] = date('Y-m-d', strtotime( $date\_t) ); |
| [1498](#L1498) | } |
| [1499](#L1499) | } |
| [1500](#L1500) | } |
| [1501](#L1501) |  |
| [1502](#L1502) | $max\_available\_month = !empty( $\_POST['max\_available\_month'] ) ? sanitize\_text\_field( $\_POST['max\_available\_month'] ) : ''; // phpcs:ignore WordPress.Security.NonceVerification |
| [1503](#L1503) | $response['prevent\_next\_month\_check']  = false; |
| [1504](#L1504) | if( !empty( $max\_available\_month ) && $max\_available\_month == $month\_check && $\_POST['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ // phpcs:ignore |
| [1505](#L1505) | $response['prevent\_next\_month\_check']  = true; |
| [1506](#L1506) | } |
| [1507](#L1507) |  |
| [1508](#L1508) | $bookingpress\_selected\_service = !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [1509](#L1509) |  |
| [1510](#L1510) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1511](#L1511) |  |
| [1512](#L1512) | if(empty($bookingpress\_selected\_service)){ |
| [1513](#L1513) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [1514](#L1514) | } |
| [1515](#L1515) |  |
| [1516](#L1516) | $before\_daysoff\_dates = $daysoff\_dates; |
| [1517](#L1517) |  |
| [1518](#L1518) | $daysoff\_dates = apply\_filters( 'bookingpress\_modify\_disable\_dates\_with\_staffmember', $daysoff\_dates, $bookingpress\_selected\_service, $first\_date\_of\_month ); |
| [1519](#L1519) |  |
| [1520](#L1520) | $after\_daysoff\_dates = $daysoff\_dates; |
| [1521](#L1521) |  |
| [1522](#L1522) | foreach( $extra\_disabled\_dates\_t as $key => $v ){ |
| [1523](#L1523) | if( !in\_array( $v, $daysoff\_dates ) ){ |
| [1524](#L1524) | unset( $extra\_disabled\_dates[ $key ] ); |
| [1525](#L1525) | } |
| [1526](#L1526) | } |
| [1527](#L1527) |  |
| [1528](#L1528) | $bpa\_retrieves\_default\_disabled\_dates = array(); |
| [1529](#L1529) | if(!empty($extra\_disabled\_dates)){ |
| [1530](#L1530) | foreach($extra\_disabled\_dates as $val){ |
| [1531](#L1531) | $bpa\_retrieves\_default\_disabled\_dates[] = date('Y-m-d H:i:s', strtotime( $val ) ); |
| [1532](#L1532) | } |
| [1533](#L1533) | $extra\_disabled\_dates = $bpa\_retrieves\_default\_disabled\_dates; |
| [1534](#L1534) | } |
| [1535](#L1535) |  |
| [1536](#L1536) | $extra\_disabled\_dates = array\_values( $extra\_disabled\_dates ); |
| [1537](#L1537) |  |
| [1538](#L1538) | $response[ 'days\_off\_disabled\_dates' ] = implode( ',', $daysoff\_dates ); |
| [1539](#L1539) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$extra\_disabled\_dates ); |
| [1540](#L1540) |  |
| [1541](#L1541) | $response['next\_month'] = date( 'm', strtotime( $first\_date\_of\_month . '+1 month') ); |
| [1542](#L1542) | $response['next\_year'] =  date( 'Y', strtotime( $first\_date\_of\_month . '+1 month') ); |
| [1543](#L1543) |  |
| [1544](#L1544) | $next\_month\_check = date('Y-m', strtotime( $response['next\_year'] .'-'. $response['next\_month'] .'-01' ) ); |
| [1545](#L1545) |  |
| [1546](#L1546) | $max\_available\_year = !empty( $\_POST['max\_available\_year'] ) ? sanitize\_text\_field( $\_POST['max\_available\_year'] ) : ''; // phpcs:ignore |
| [1547](#L1547) | $max\_month\_check = date('Y-m', strtotime( $max\_available\_year . '-' . $max\_available\_month . '-01' ) ); // phpcs:ignore |
| [1548](#L1548) |  |
| [1549](#L1549) | if( strtotime( $max\_month\_check ) < strtotime( $next\_month\_check ) ){ |
| [1550](#L1550) | $response['prevent\_next\_month\_check'] = true; |
| [1551](#L1551) | } |
| [1552](#L1552) |  |
| [1553](#L1553) | $response = array\_merge( $\_POST, $response ); // phpcs:ignore |
| [1554](#L1554) | if($return\_data == true){ |
| [1555](#L1555) | return $response; |
| [1556](#L1556) | } |
| [1557](#L1557) | echo wp\_json\_encode( $response ); |
| [1558](#L1558) |  |
| [1559](#L1559) | die; |
| [1560](#L1560) | } |
| [1561](#L1561) |  |
| [1562](#L1562) | function bookingpress\_retrieve\_entire\_month\_data\_callback(){ |
| [1563](#L1563) | $start\_ms = microtime( true ); |
| [1564](#L1564) | $response              = []; |
| [1565](#L1565) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1566](#L1566) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1567](#L1567) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1568](#L1568) | $response['variant']      = 'error'; |
| [1569](#L1569) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1570](#L1570) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1571](#L1571) | $response['redirect\_url'] = ''; |
| [1572](#L1572) | if($return\_data){ |
| [1573](#L1573) | return $response; |
| [1574](#L1574) | } |
| [1575](#L1575) | wp\_send\_json($response); |
| [1576](#L1576) | die(); |
| [1577](#L1577) | } |
| [1578](#L1578) |  |
| [1579](#L1579) | $bookingpress\_start\_date = !empty( $\_POST['from\_date'] ) ? sanitize\_text\_field( $\_POST['from\_date'] ) : date('Y-m-d', current\_time( 'timestamp' ) ) .' 00:00:00'; |
| [1580](#L1580) |  |
| [1581](#L1581) | $bookingpress\_start\_date = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [1582](#L1582) |  |
| [1583](#L1583) | $entire\_month\_details = $this->bookingpress\_retrieve\_timeslot\_data\_callback( $bookingpress\_start\_date, true ); |
| [1584](#L1584) |  |
| [1585](#L1585) | $working\_hour\_details = $entire\_month\_details['working\_details']; |
| [1586](#L1586) | $last\_date = array\_key\_last( $working\_hour\_details ); |
| [1587](#L1587) |  |
| [1588](#L1588) | $response['working\_details'] = $working\_hour\_details; |
| [1589](#L1589) | $response['last\_date'] = $last\_date; |
| [1590](#L1590) | $response['next\_month\_date'] = $entire\_month\_details['next\_month\_date']; |
| [1591](#L1591) | $response['stop\_check'] = $entire\_month\_details['stop\_check']; |
| [1592](#L1592) | $response['working\_hour\_timing\_token'] = $entire\_month\_details['working\_hour\_timing\_token']; |
| [1593](#L1593) | $response['bpa\_disabled\_dates'] = $entire\_month\_details['bpa\_disabled\_dates']; |
| [1594](#L1594) | $response['overnight\_booking\_dates'] = $entire\_month\_details['overnight\_booking\_dates']; |
| [1595](#L1595) |  |
| [1596](#L1596) | $end\_ms = microtime( true ); |
| [1597](#L1597) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [1598](#L1598) |  |
| [1599](#L1599) | echo json\_encode( $response ); |
| [1600](#L1600) | die; |
| [1601](#L1601) |  |
| [1602](#L1602) | } |
| [1603](#L1603) |  |
| [1604](#L1604) | function bookingpress\_set\_timeslot\_token\_transient(){ |
| [1605](#L1605) | $start\_ms = microtime( true ); |
| [1606](#L1606) | global $wpdb; |
| [1607](#L1607) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1608](#L1608) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1609](#L1609) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1610](#L1610) | $response['variant']      = 'error'; |
| [1611](#L1611) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1612](#L1612) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1613](#L1613) | $response['redirect\_url'] = ''; |
| [1614](#L1614) | if($return\_data){ |
| [1615](#L1615) | return $response; |
| [1616](#L1616) | } |
| [1617](#L1617) | wp\_send\_json($response); |
| [1618](#L1618) | die(); |
| [1619](#L1619) | } |
| [1620](#L1620) |  |
| [1621](#L1621) | $tokenData = !empty( $\_POST['tokenData'] ) ? sanitize\_text\_field( $\_POST['tokenData'] ) : ''; |
| [1622](#L1622) |  |
| [1623](#L1623) | if( !empty( $tokenData ) ){ |
| [1624](#L1624) | $token\_json = json\_decode( base64\_decode( $tokenData ), true ); |
| [1625](#L1625) | $this->bookingpress\_update\_transient( $token\_json['token\_key'], $token\_json['token\_data'], HOUR\_IN\_SECONDS ); |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | die; |
| [1629](#L1629) | } |
| [1630](#L1630) |  |
| [1631](#L1631) | function bookingpress\_retrieve\_timeslot\_data\_callback( $start\_date = '', $return = false, $use\_start\_date = false ){ |
| [1632](#L1632) |  |
| [1633](#L1633) | $start\_ms = microtime( true ); |
| [1634](#L1634) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $tbl\_bookingpress\_default\_workhours; |
| [1635](#L1635) |  |
| [1636](#L1636) | $response = []; |
| [1637](#L1637) |  |
| [1638](#L1638) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1639](#L1639) |  |
| [1640](#L1640) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1641](#L1641) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1642](#L1642) | $response['variant']      = 'error'; |
| [1643](#L1643) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1644](#L1644) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1645](#L1645) | $response['redirect\_url'] = ''; |
| [1646](#L1646) | if($return\_data){ |
| [1647](#L1647) | return $response; |
| [1648](#L1648) | } |
| [1649](#L1649) | wp\_send\_json($response); |
| [1650](#L1650) | die(); |
| [1651](#L1651) | } |
| [1652](#L1652) |  |
| [1653](#L1653) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [1654](#L1654) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [1655](#L1655) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1656](#L1656) | } |
| [1657](#L1657) |  |
| [1658](#L1658) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [1659](#L1659) |  |
| [1660](#L1660) | $bpa\_get\_external\_response = apply\_filters( 'bookingpress\_fetch\_appointment\_timeslot\_external\_data', [], $bookingpress\_appointment\_data ); |
| [1661](#L1661) |  |
| [1662](#L1662) | if( !empty( $bpa\_get\_external\_response ) && !empty( $bpa\_get\_external\_response['stop\_process'] ) && true == $bpa\_get\_external\_response['stop\_process'] ){ |
| [1663](#L1663) | echo wp\_json\_encode( $bpa\_get\_external\_response ); |
| [1664](#L1664) | die; |
| [1665](#L1665) | } |
| [1666](#L1666) |  |
| [1667](#L1667) | $current\_date = date( 'Y-m-d', current\_time( 'timestamp' ) ); |
| [1668](#L1668) |  |
| [1669](#L1669) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [1670](#L1670) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [1671](#L1671) | $get\_period\_available\_for\_booking = 365; |
| [1672](#L1672) | } |
| [1673](#L1673) |  |
| [1674](#L1674) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp') ); |
| [1675](#L1675) |  |
| [1676](#L1676) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [1677](#L1677) |  |
| [1678](#L1678) | if(empty($bookingpress\_selected\_service)){ |
| [1679](#L1679) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [1680](#L1680) | } |
| [1681](#L1681) |  |
| [1682](#L1682) | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
| [1683](#L1683) | $get\_period\_available\_for\_booking = apply\_filters( 'bookingpress\_modify\_max\_available\_time\_for\_booking', $get\_period\_available\_for\_booking, $bookingpress\_start\_date, $bookingpress\_selected\_service ); |
| [1684](#L1684) |  |
| [1685](#L1685) | $bookingpress\_max\_date = date('Y-m-d', strtotime( '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [1686](#L1686) |  |
| [1687](#L1687) | $max\_service\_capacity = 1; |
| [1688](#L1688) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [1689](#L1689) |  |
| [1690](#L1690) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [1691](#L1691) |  |
| [1692](#L1692) | if( !empty( $start\_date ) ){ |
| [1693](#L1693) | $bookingpress\_start\_date = $start\_date; |
| [1694](#L1694) | } else { |
| [1695](#L1695) | $bookingpress\_start\_date = $current\_date; |
| [1696](#L1696) | } |
| [1697](#L1697) |  |
| [1698](#L1698) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [1699](#L1699) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [1700](#L1700) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [1701](#L1701) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [1702](#L1702) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [1703](#L1703) | } |
| [1704](#L1704) | } |
| [1705](#L1705) |  |
| [1706](#L1706) | $service\_duration\_val = $bookingpress\_appointment\_data['selected\_service\_duration']; |
| [1707](#L1707) | $service\_duration\_unit = $bookingpress\_appointment\_data['selected\_service\_duration\_unit']; |
| [1708](#L1708) |  |
| [1709](#L1709) | $selected\_date = !empty( $\_REQUEST['selected\_date'] ) ? sanitize\_text\_field( $\_REQUEST['selected\_date'] ) : ""; |
| [1710](#L1710) |  |
| [1711](#L1711) | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
| [1712](#L1712) | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
| [1713](#L1713) |  |
| [1714](#L1714) | $selected\_service\_duration\_in\_min = ''; |
| [1715](#L1715) | if( 'm' == $selected\_service\_duration\_unit ){ |
| [1716](#L1716) | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
| [1717](#L1717) | } else { |
| [1718](#L1718) | if( 'h' == $selected\_service\_duration\_unit ){ |
| [1719](#L1719) | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
| [1720](#L1720) | } |
| [1721](#L1721) | } |
| [1722](#L1722) |  |
| [1723](#L1723) | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [1724](#L1724) |  |
| [1725](#L1725) | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
| [1726](#L1726) |  |
| [1727](#L1727) | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
| [1728](#L1728) | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
| [1729](#L1729) |  |
| [1730](#L1730) |  |
| [1731](#L1731) | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [1732](#L1732) |  |
| [1733](#L1733) | /\*\* Get the default days off in the above limit \*/ |
| [1734](#L1734) | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
| [1735](#L1735) |  |
| [1736](#L1736) | //$bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
| [1737](#L1737) |  |
| [1738](#L1738) | if( true == $use\_start\_date ){ |
| [1739](#L1739) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $start\_date ) ) ); |
| [1740](#L1740) | } else if( !empty( $selected\_date ) ){ |
| [1741](#L1741) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $selected\_date ) ) ); |
| [1742](#L1742) | } else { |
| [1743](#L1743) | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $bookingpress\_start\_date ) ) ); |
| [1744](#L1744) | } |
| [1745](#L1745) |  |
| [1746](#L1746) | $bpa\_begin\_date = new DateTime( $bookingpress\_start\_date ); |
| [1747](#L1747) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [1748](#L1748) |  |
| [1749](#L1749) | $max\_end\_date = $bpa\_end\_date->format('Y-m-d'); |
| [1750](#L1750) |  |
| [1751](#L1751) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [1752](#L1752) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [1753](#L1753) |  |
| [1754](#L1754) | $working\_hour\_details = []; |
| [1755](#L1755) | $working\_hour\_timing\_token = []; |
| [1756](#L1756) | $disable\_dates = []; |
| [1757](#L1757) | $preselected\_date = ( !empty( $\_REQUEST['is\_preselect'] ) && (true === $\_REQUEST['is\_preselect'] || 'true' == $\_REQUEST['is\_preselect']) ) ? true : false; |
| [1758](#L1758) | $stop\_check = false; |
| [1759](#L1759) |  |
| [1760](#L1760) | $total\_dates = []; |
| [1761](#L1761) |  |
| [1762](#L1762) | $total\_booked\_appointment = []; |
| [1763](#L1763) |  |
| [1764](#L1764) | $bookingpress\_show\_time\_as\_per\_service\_duration = $BookingPress->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [1765](#L1765) | $bookingpress\_shared\_service\_timeslot = $BookingPress->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [1766](#L1766) | /\*\* total booked appointment of the selected date \*/ |
| [1767](#L1767) | $where\_clause = ''; |
| [1768](#L1768) | if( 'true' != $bookingpress\_shared\_service\_timeslot ){ |
| [1769](#L1769) | $where\_clause = $wpdb->prepare( ' AND bookingpress\_service\_id = %d ', $bookingpress\_selected\_service ); |
| [1770](#L1770) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_where\_clause', $where\_clause ); |
| [1771](#L1771) | }else{ |
| [1772](#L1772) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$bookingpress\_selected\_service); |
| [1773](#L1773) | } |
| [1774](#L1774) |  |
| [1775](#L1775) | $where\_clause .= $wpdb->prepare( ' AND (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s)', '1', '2' ); |
| [1776](#L1776) |  |
| [1777](#L1777) | if( strtotime( $bookingpress\_start\_date ) == strtotime( $bpa\_end\_date->format('Y-m-d') ) ){ |
| [1778](#L1778) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime( 'last day of this month', strtotime( $bpa\_end\_date->format('Y-m-d') ) ) ) ); |
| [1779](#L1779) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [1780](#L1780) | } |
| [1781](#L1781) |  |
| [1782](#L1782) | $booked\_check\_dates = []; |
| [1783](#L1783) | foreach( $period as $dt ){ |
| [1784](#L1784) | $bpa\_sel\_date = $dt->format( 'Y-m-d' ); |
| [1785](#L1785) | $booked\_check\_dates[] = $bpa\_sel\_date; |
| [1786](#L1786) | } |
| [1787](#L1787) |  |
| [1788](#L1788) | foreach( $bpa\_retrieves\_default\_disabled\_dates as $bpa\_key => $disabled\_date ){ |
| [1789](#L1789) | $bpa\_retrieves\_default\_disabled\_dates[ $bpa\_key ] = date('Y-m-d', strtotime( $disabled\_date ) ); |
| [1790](#L1790) | } |
| [1791](#L1791) |  |
| [1792](#L1792) | $selected\_where\_in  = ' AND bookingpress\_appointment\_date IN ('; |
| [1793](#L1793) | $selected\_where\_in .= rtrim( str\_repeat( '%s,', count( $booked\_check\_dates ) ), ',' ).' )'; |
| [1794](#L1794) |  |
| [1795](#L1795) | array\_unshift( $booked\_check\_dates, $selected\_where\_in ); |
| [1796](#L1796) |  |
| [1797](#L1797) | $selected\_where\_clause = call\_user\_func\_array( array( $wpdb, 'prepare' ), $booked\_check\_dates ); |
| [1798](#L1798) |  |
| [1799](#L1799) | $where\_clause .= $selected\_where\_clause; |
| [1800](#L1800) |  |
| [1801](#L1801) | $total\_booked\_appiontments = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE 1 = 1 $where\_clause", ARRAY\_A ); // phpcs:ignore |
| [1802](#L1802) | /\*\* Reputelog - new code - need to check for optimization start \*/ |
| [1803](#L1803) |  |
| [1804](#L1804) | $first\_available\_date = ''; |
| [1805](#L1805) | $overnight\_booking\_dates = []; |
| [1806](#L1806) | foreach( $period as $dt ){ |
| [1807](#L1807) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [1808](#L1808) | if( $bookingpress\_max\_date < $bpa\_check\_date ){ |
| [1809](#L1809) | $max\_end\_date = date('Y-m-d', strtotime( $bookingpress\_max\_date ) ); |
| [1810](#L1810) | $stop\_check = true; |
| [1811](#L1811) | $response['stop\_check'] = true; |
| [1812](#L1812) | break; |
| [1813](#L1813) | } |
| [1814](#L1814) |  |
| [1815](#L1815) | if( !empty( $bpa\_retrieves\_default\_disabled\_dates ) && in\_array( $bpa\_check\_date, $bpa\_retrieves\_default\_disabled\_dates ) ){ |
| [1816](#L1816) | continue; |
| [1817](#L1817) | } |
| [1818](#L1818) |  |
| [1819](#L1819) | $bpa\_check\_datetime = $dt->format( 'Y-m-d H:i:s'); |
| [1820](#L1820) | $front\_timings\_data = $bookingpress\_appointment\_bookings->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, false, false, $total\_booked\_appiontments ); |
| [1821](#L1821) |  |
| [1822](#L1822) |  |
| [1823](#L1823) | $front\_timings\_data\_combined = array\_merge( |
| [1824](#L1824) | $front\_timings\_data['morning\_time'], |
| [1825](#L1825) | $front\_timings\_data['afternoon\_time'], |
| [1826](#L1826) | $front\_timings\_data['evening\_time'], |
| [1827](#L1827) | $front\_timings\_data['night\_time'] |
| [1828](#L1828) | ); |
| [1829](#L1829) |  |
| [1830](#L1830) | $total\_available\_slots = count( $front\_timings\_data\_combined ); |
| [1831](#L1831) | $is\_booked = false; |
| [1832](#L1832) | $total\_booked = 0; |
| [1833](#L1833) | foreach( $front\_timings\_data\_combined as $slot\_data ){ |
| [1834](#L1834) | if( !empty( $slot\_data['is\_booked'] ) && 1 == $slot\_data['is\_booked'] ){ |
| [1835](#L1835) | $total\_booked++; |
| [1836](#L1836) | } |
| [1837](#L1837) | } |
| [1838](#L1838) |  |
| [1839](#L1839) | $bookingpress\_allow\_to\_disable\_booked\_date = apply\_filters('bookingpress\_allow\_to\_disable\_booked\_date',true,$bookingpress\_selected\_service); |
| [1840](#L1840) |  |
| [1841](#L1841) | if( $total\_booked == $total\_available\_slots && $bookingpress\_allow\_to\_disable\_booked\_date == true ){ |
| [1842](#L1842) | $front\_timings\_data\_combined = []; |
| [1843](#L1843) | } |
| [1844](#L1844) |  |
| [1845](#L1845) | $wp\_timezone\_offset = wp\_timezone\_string(); |
| [1846](#L1846) | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
| [1847](#L1847) | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
| [1848](#L1848) | } |
| [1849](#L1849) |  |
| [1850](#L1850) |  |
| [1851](#L1851) |  |
| [1852](#L1852) | if( !empty( $front\_timings\_data\_combined ) ){ |
| [1853](#L1853) | foreach( $front\_timings\_data\_combined as $timeslot\_data ){ |
| [1854](#L1854) |  |
| [1855](#L1855) | if( empty( $first\_available\_date ) ){ |
| [1856](#L1856) | $first\_available\_date = $timeslot\_data['store\_service\_date']; |
| [1857](#L1857) | } |
| [1858](#L1858) |  |
| [1859](#L1859) | $is\_next\_date = !empty( $timeslot\_data['is\_next\_day'] ) ? $timeslot\_data['is\_next\_day'] : false; |
| [1860](#L1860) |  |
| [1861](#L1861) | $startDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
| [1862](#L1862) | $endDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_end\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
| [1863](#L1863) | $wp\_offset\_org = $startDateTime->getTimezone()->getName(); |
| [1864](#L1864) |  |
| [1865](#L1865) | $timeslot\_data['store\_offset'] = $wp\_offset\_org; |
| [1866](#L1866) |  |
| [1867](#L1867) | $start\_time = date('Y-m-d H:i:s', strtotime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'] ) ); |
| [1868](#L1868) |  |
| [1869](#L1869) | if( true == $is\_next\_date && $timeslot\_data['store\_service\_date'] != $timeslot\_data['selected\_date']){ |
| [1870](#L1870) | $tmpStartDateTime = clone $startDateTime; |
| [1871](#L1871) | $tmpStartDateTime->modify( '-1 day'); |
| [1872](#L1872) | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $tmpStartDateTime->format('Y-m-d'), $start\_time ); |
| [1873](#L1873) | } else { |
| [1874](#L1874) | $start\_datetime = apply\_filters( 'bookingpress\_modify\_start\_date\_time', $startDateTime->format('Y-m-d'), $start\_time ); |
| [1875](#L1875) | } |
| [1876](#L1876) |  |
| [1877](#L1877) | $working\_hour\_details[ $start\_datetime ][] = $timeslot\_data; |
| [1878](#L1878) |  |
| [1879](#L1879) | if( !isset( $working\_hour\_timing\_token[ $start\_datetime ]) ){ |
| [1880](#L1880) | $working\_hour\_timing\_token[ $start\_datetime ] = []; |
| [1881](#L1881) | } |
| [1882](#L1882) | if( !in\_array( $front\_timings\_data['timing\_token\_data'], $working\_hour\_timing\_token[ $start\_datetime ] ) ){ |
| [1883](#L1883) | $working\_hour\_timing\_token[ $start\_datetime ][] = $front\_timings\_data['timing\_token\_data']; |
| [1884](#L1884) | } |
| [1885](#L1885) | if( !empty( $timeslot\_data['is\_next\_day'] ) && !in\_array( $start\_datetime, $overnight\_booking\_dates ) ){ |
| [1886](#L1886) | $overnight\_booking\_dates[] = $start\_datetime; |
| [1887](#L1887) | } |
| [1888](#L1888) | } |
| [1889](#L1889) |  |
| [1890](#L1890) | if( empty( $selected\_date ) ){ |
| [1891](#L1891) | $selected\_date = $start\_datetime; |
| [1892](#L1892) | } else { |
| [1893](#L1893) | if( !empty( $start\_date ) ){ |
| [1894](#L1894) | $preselected\_date = true; |
| [1895](#L1895) | } |
| [1896](#L1896) | } |
| [1897](#L1897) |  |
| [1898](#L1898) | if( strtotime( $selected\_date ) < strtotime( $first\_available\_date ) ){ |
| [1899](#L1899) | $selected\_date = $first\_available\_date; |
| [1900](#L1900) | } |
| [1901](#L1901) | } |
| [1902](#L1902) | } |
| [1903](#L1903) |  |
| [1904](#L1904) | if( empty( $working\_hour\_details ) && false == $stop\_check ){ |
| [1905](#L1905) | $working\_hour\_updated\_data = $this->bookingpress\_retrieve\_timeslot\_data\_callback( $max\_end\_date, true, true ); |
| [1906](#L1906) |  |
| [1907](#L1907) | $working\_hour\_details = $working\_hour\_updated\_data['working\_details']; |
| [1908](#L1908) | $working\_hour\_timing\_token = $working\_hour\_updated\_data['working\_hour\_timing\_token']; |
| [1909](#L1909) | $bpa\_retrieves\_default\_disabled\_dates = $working\_hour\_updated\_data['bpa\_disabled\_dates']; |
| [1910](#L1910) | $max\_end\_date = $working\_hour\_updated\_data['next\_month\_date']; |
| [1911](#L1911) | $preselected\_date = $working\_hour\_updated\_data['pre\_selected\_date']; |
| [1912](#L1912) | $stop\_check = $working\_hour\_updated\_data['stop\_check']; |
| [1913](#L1913) | $selected\_date = $working\_hour\_updated\_data['selected\_date']; |
| [1914](#L1914) | $overnight\_booking\_dates = $working\_hour\_updated\_data['overnight\_booking\_dates']; |
| [1915](#L1915) | } |
| [1916](#L1916) |  |
| [1917](#L1917) | /\*\* Reputelog - new code - need to check for optimization End \*/ |
| [1918](#L1918) |  |
| [1919](#L1919) | if( !empty( $bookingpress\_appointment\_data['appointment\_update\_id'] ) ){ |
| [1920](#L1920) | $preselected\_date = true; |
| [1921](#L1921) | $selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [1922](#L1922) | } |
| [1923](#L1923) |  |
| [1924](#L1924) |  |
| [1925](#L1925) | $response['working\_details'] = $working\_hour\_details; |
| [1926](#L1926) | $response['working\_hour\_timing\_token'] = $working\_hour\_timing\_token; |
| [1927](#L1927) | $response['next\_month\_date'] = $max\_end\_date; |
| [1928](#L1928) | $response['pre\_selected\_date'] = $preselected\_date; |
| [1929](#L1929) | $response['overnight\_booking\_dates'] = $overnight\_booking\_dates; |
| [1930](#L1930) | $response['bpa\_disabled\_dates'] = $bpa\_retrieves\_default\_disabled\_dates; |
| [1931](#L1931) | $response['stop\_check'] = ( false == $stop\_check && ( $bookingpress\_max\_date <= $max\_end\_date ) ) ? true : $stop\_check; |
| [1932](#L1932) | $response['variant'] = 'success'; |
| [1933](#L1933) | $response['selected\_date']  = $selected\_date; |
| [1934](#L1934) |  |
| [1935](#L1935) |  |
| [1936](#L1936) | if( true == $return ){ |
| [1937](#L1937) | return $response; |
| [1938](#L1938) | } |
| [1939](#L1939) |  |
| [1940](#L1940) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [1941](#L1941) |  |
| [1942](#L1942) | $end\_ms = microtime( true ); |
| [1943](#L1943) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [1944](#L1944) |  |
| [1945](#L1945) | $response = apply\_filters( 'bookingpress\_modify\_disable\_timeslot\_external', $response ); |
| [1946](#L1946) |  |
| [1947](#L1947) | echo wp\_json\_encode( $response ); |
| [1948](#L1948) | die; |
| [1949](#L1949) | } |
| [1950](#L1950) |  |
| [1951](#L1951) | function bookingpress\_get\_disable\_date\_func(){ |
| [1952](#L1952) |  |
| [1953](#L1953) | global $BookingPress; |
| [1954](#L1954) |  |
| [1955](#L1955) | $use\_legacy = false; |
| [1956](#L1956) | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.0', '<') ){ |
| [1957](#L1957) | $use\_legacy = true; |
| [1958](#L1958) | } |
| [1959](#L1959) |  |
| [1960](#L1960) | if( !$use\_legacy && is\_plugin\_active( 'bookingpress-custom-service-duration/bookingpress-custom-service-duration.php') ){ |
| [1961](#L1961) | global $bookingpress\_custom\_service\_duration\_version; |
| [1962](#L1962) |  |
| [1963](#L1963) | if( version\_compare( $bookingpress\_custom\_service\_duration\_version, '1.7', '<') ){ |
| [1964](#L1964) | $use\_legacy = true; |
| [1965](#L1965) | } |
| [1966](#L1966) | } |
| [1967](#L1967) |  |
| [1968](#L1968) | if( !$use\_legacy && is\_plugin\_active( 'bookingpress-waiting-list/bookingpress-waiting-list.php' ) ){ |
| [1969](#L1969) | global $bookingpress\_waiting\_list\_version; |
| [1970](#L1970) |  |
| [1971](#L1971) | if( version\_compare( $bookingpress\_waiting\_list\_version, '1.2', '<') ){ |
| [1972](#L1972) | $use\_legacy = true; |
| [1973](#L1973) | } |
| [1974](#L1974) | } |
| [1975](#L1975) |  |
| [1976](#L1976) | if( true == $use\_legacy ){ |
| [1977](#L1977) | $this->bookingpress\_get\_disable\_date\_func\_legacy(); |
| [1978](#L1978) | } else { |
| [1979](#L1979) | $this->bookingpress\_get\_disable\_date\_func\_optimized(); |
| [1980](#L1980) | } |
| [1981](#L1981) |  |
| [1982](#L1982) | } |
| [1983](#L1983) |  |
| [1984](#L1984) | function bookingpress\_get\_disable\_date\_func\_optimized($return\_data = false){ |
| [1985](#L1985) |  |
| [1986](#L1986) | $start\_ms = microtime( true ); |
| [1987](#L1987) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs; |
| [1988](#L1988) | $response              = array(); |
| [1989](#L1989) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [1990](#L1990) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [1991](#L1991) |  |
| [1992](#L1992) | if (! $bpa\_verify\_nonce\_flag ) { |
| [1993](#L1993) | $response['variant']      = 'error'; |
| [1994](#L1994) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [1995](#L1995) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [1996](#L1996) | $response['redirect\_url'] = ''; |
| [1997](#L1997) | if($return\_data){ |
| [1998](#L1998) | return $response; |
| [1999](#L1999) | } |
| [2000](#L2000) | wp\_send\_json($response); |
| [2001](#L2001) | die(); |
| [2002](#L2002) | } |
| [2003](#L2003) |  |
| [2004](#L2004) | $response['variant']    = 'error'; |
| [2005](#L2005) | $response['title']      = 'Error'; |
| [2006](#L2006) | $response['msg']        = 'Something went wrong....'; |
| [2007](#L2007) |  |
| [2008](#L2008) | //$consider\_selected\_date = false; |
| [2009](#L2009) |  |
| [2010](#L2010) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [2011](#L2011) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [2012](#L2012) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2013](#L2013) | } |
| [2014](#L2014) |  |
| [2015](#L2015) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2016](#L2016) | $bookingpress\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2017](#L2017) |  |
| [2018](#L2018) | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
| [2019](#L2019) | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
| [2020](#L2020) |  |
| [2021](#L2021) | $selected\_service\_duration\_in\_min = ''; |
| [2022](#L2022) | if( 'm' == $selected\_service\_duration\_unit ){ |
| [2023](#L2023) | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
| [2024](#L2024) | } else { |
| [2025](#L2025) | if( 'h' == $selected\_service\_duration\_unit ){ |
| [2026](#L2026) | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
| [2027](#L2027) | } |
| [2028](#L2028) | } |
| [2029](#L2029) |  |
| [2030](#L2030) | if(!empty($bookingpress\_selected\_date)){ |
| [2031](#L2031) | $bookingpress\_selected\_date = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2032](#L2032) | } |
| [2033](#L2033) |  |
| [2034](#L2034) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2035](#L2035) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2036](#L2036) | } |
| [2037](#L2037) |  |
| [2038](#L2038) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [2039](#L2039) |  |
| [2040](#L2040) | if(empty($bookingpress\_selected\_service)){ |
| [2041](#L2041) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [2042](#L2042) | } |
| [2043](#L2043) |  |
| [2044](#L2044) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [2045](#L2045) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [2046](#L2046) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [2047](#L2047) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [2048](#L2048) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [2049](#L2049) | } |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | /\*\* get maximum period available from booking \*/ |
| [2053](#L2053) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [2054](#L2054) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [2055](#L2055) | $get\_period\_available\_for\_booking = 365; |
| [2056](#L2056) | } |
| [2057](#L2057) |  |
| [2058](#L2058) | $posted\_disabled\_dates = !empty( $\_POST['disabled\_dates'] ) ? json\_decode( stripslashes\_deep( $\_POST['disabled\_dates'] ), true ) : array(); // phpcs:ignore |
| [2059](#L2059) |  |
| [2060](#L2060) | if( !empty( $posted\_disabled\_dates ) ){ |
| [2061](#L2061) | $posted\_disabled\_dates = array\_filter( $posted\_disabled\_dates ); |
| [2062](#L2062) | } |
| [2063](#L2063) |  |
| [2064](#L2064) | $max\_service\_capacity = 1; |
| [2065](#L2065) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [2066](#L2066) |  |
| [2067](#L2067) | if( !empty( $bookingpress\_selected\_service ) ){ |
| [2068](#L2068) |  |
| [2069](#L2069) | $response['prevent\_next\_month\_check'] = false; |
| [2070](#L2070) |  |
| [2071](#L2071) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2072](#L2072) |  |
| [2073](#L2073) | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [2074](#L2074) |  |
| [2075](#L2075) | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
| [2076](#L2076) |  |
| [2077](#L2077) | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
| [2078](#L2078) | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
| [2079](#L2079) |  |
| [2080](#L2080) | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [2081](#L2081) |  |
| [2082](#L2082) | $exclude\_dates = array(); |
| [2083](#L2083) | if( $bookingpress\_start\_date\_initial != $bookingpress\_start\_date ){ |
| [2084](#L2084) | //$start\_date\_with\_time = date('Y-m-d H:i:s', strtotime( $bookingpress\_start\_date\_initial ) ); |
| [2085](#L2085) |  |
| [2086](#L2086) | $timestamp\_init\_date = strtotime( $bookingpress\_start\_date\_with\_time ); |
| [2087](#L2087) | $timestamp\_start\_date = strtotime( $bookingpress\_start\_date ); |
| [2088](#L2088) |  |
| [2089](#L2089) | $time\_diff\_minuts =  round(abs($timestamp\_start\_date - $timestamp\_init\_date) / 60,2); |
| [2090](#L2090) |  |
| [2091](#L2091) | if( 1440 >= $time\_diff\_minuts ){ |
| [2092](#L2092) | $exclude\_dates[] = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
| [2093](#L2093) | } |
| [2094](#L2094) |  |
| [2095](#L2095) | } |
| [2096](#L2096) |  |
| [2097](#L2097) |  |
| [2098](#L2098) | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
| [2099](#L2099) | $get\_period\_available\_for\_booking = apply\_filters( 'bookingpress\_modify\_max\_available\_time\_for\_booking', $get\_period\_available\_for\_booking, $bookingpress\_start\_date, $bookingpress\_selected\_service ); |
| [2100](#L2100) |  |
| [2101](#L2101) | /\* if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2102](#L2102) | $bookingpress\_start\_date = $bpa\_selected\_date; |
| [2103](#L2103) | } \*/ |
| [2104](#L2104) |  |
| [2105](#L2105) | $bookingpress\_temp\_end\_date = date('Y-m-d', strtotime('last day of this month', strtotime( $bookingpress\_start\_date ))); |
| [2106](#L2106) |  |
| [2107](#L2107) | $bookingpress\_end\_date = date('Y-m-d', strtotime( '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2108](#L2108) |  |
| [2109](#L2109) | $next\_month = date( 'm', strtotime( $bookingpress\_temp\_end\_date . '+1 day' ) ); |
| [2110](#L2110) | $next\_year = date( 'Y', strtotime( $bookingpress\_temp\_end\_date . '+1 day' ) ); |
| [2111](#L2111) |  |
| [2112](#L2112) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [2113](#L2113) |  |
| [2114](#L2114) | /\*\* Get the default days off in the above limit \*/ |
| [2115](#L2115) | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
| [2116](#L2116) |  |
| [2117](#L2117) | $bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
| [2118](#L2118) |  |
| [2119](#L2119) | /\*\* loop through each days until the limit has been reached |
| [2120](#L2120) | \* for lite - it'll check for the next 365 days |
| [2121](#L2121) | \* for pro - it'll check up to the X number of days defined in the settings |
| [2122](#L2122) | \*/ |
| [2123](#L2123) | $bpa\_begin\_date = new DateTime( $bookingpress\_selected\_date ); |
| [2124](#L2124) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [2125](#L2125) |  |
| [2126](#L2126) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [2127](#L2127) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [2128](#L2128) |  |
| [2129](#L2129) | $bookingpress\_selected\_date = $bookingpress\_end\_date; |
| [2130](#L2130) | $front\_timings\_data = array(); |
| [2131](#L2131) |  |
| [2132](#L2132) | $count = 0; |
| [2133](#L2133) | $stop\_date = ''; |
| [2134](#L2134) |  |
| [2135](#L2135) |  |
| [2136](#L2136) |  |
| [2137](#L2137) | if( !empty( $bookingpress\_appointment\_data['appointment\_update\_id'] ) ){ |
| [2138](#L2138) | $sel\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2139](#L2139) | $front\_timings\_data = $this->bookingpress\_retrieve\_timeslots( $sel\_date, true ); |
| [2140](#L2140) | $bookingpress\_selected\_date = $sel\_date; |
| [2141](#L2141) | } else { |
| [2142](#L2142) | $empty\_slot\_dates = array(); |
| [2143](#L2143) | foreach( $period as $dt ){ |
| [2144](#L2144) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [2145](#L2145) |  |
| [2146](#L2146) | if( in\_array( $dt->format('Y-m-d H:i:s'), $bpa\_retrieves\_default\_disabled\_dates ) && !in\_array( $dt->format('Y-m-d'), $exclude\_dates )){ |
| [2147](#L2147) | continue; |
| [2148](#L2148) | } |
| [2149](#L2149) |  |
| [2150](#L2150) | /\*\* Stop the loop if the time slot is available & date is equals to the last day of the available date month \*/ |
| [2151](#L2151) | if( !empty( $stop\_date ) && $bpa\_check\_date > date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $stop\_date) ) ) ){ |
| [2152](#L2152) | $last\_date = date('Y-m-d', strtotime( 'last day of this month', strtotime( $stop\_date ) ) ); |
| [2153](#L2153) | $next\_month = date('m', strtotime( $last\_date . '+1 day') ); |
| [2154](#L2154) | $next\_year = date('Y', strtotime( $last\_date . '+1 day') ); |
| [2155](#L2155) | break; |
| [2156](#L2156) | } |
| [2157](#L2157) |  |
| [2158](#L2158) | $bookingpress\_time\_slots = $this->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, true, false ); |
| [2159](#L2159) |  |
| [2160](#L2160) | if( empty( $bookingpress\_time\_slots ) ){ |
| [2161](#L2161) | $bpa\_retrieves\_default\_disabled\_dates[] = date('Y-m-d H:i:s', strtotime( $bpa\_check\_date ) ); |
| [2162](#L2162) | $empty\_slot\_dates[] = date('Y-m-d', strtotime( $bpa\_check\_date ) ); |
| [2163](#L2163) | } else { |
| [2164](#L2164) | if( $count < 1 ){ |
| [2165](#L2165) | $date1 = new DateTime( $bookingpress\_start\_date ); |
| [2166](#L2166) | $date2 = new DateTime( $bpa\_check\_date ); |
| [2167](#L2167) | $interval = $date1->diff($date2); |
| [2168](#L2168) | $interval\_in\_days = $interval->days; |
| [2169](#L2169) | if( $interval\_in\_days < $get\_period\_available\_for\_booking ){ |
| [2170](#L2170) | $bookingpress\_selected\_date = $bpa\_check\_date; |
| [2171](#L2171) | /\*\* Check if the selected date is greater than end date in respect to service expiration \*/ |
| [2172](#L2172) | $front\_timings\_data = $this->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true ); |
| [2173](#L2173) |  |
| [2174](#L2174) | $stop\_date = $bpa\_check\_date; |
| [2175](#L2175) | $count++; |
| [2176](#L2176) | } |
| [2177](#L2177) | } |
| [2178](#L2178) | } |
| [2179](#L2179) | } |
| [2180](#L2180) | } |
| [2181](#L2181) |  |
| [2182](#L2182) | $bookingpress\_disable\_date = array(); |
| [2183](#L2183) | foreach( $bpa\_retrieves\_default\_disabled\_dates as $dis\_key => $disabled\_dates ){ |
| [2184](#L2184) | $dis\_date = date('Y-m-d', strtotime( $disabled\_dates) ); |
| [2185](#L2185) | if( !empty( $exclude\_dates ) && in\_array( $dis\_date, $exclude\_dates ) && ( empty( $empty\_slot\_dates ) || !in\_array( $dis\_date, $empty\_slot\_dates ) ) ){ |
| [2186](#L2186) | unset( $bpa\_retrieves\_default\_disabled\_dates[ $dis\_key ] ); |
| [2187](#L2187) | continue; |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | $bookingpress\_disable\_date[] = date('c', strtotime( $disabled\_dates ) ); |
| [2191](#L2191) | } |
| [2192](#L2192) |  |
| [2193](#L2193) | $bpa\_retrieves\_default\_disabled\_dates = array\_values( $bpa\_retrieves\_default\_disabled\_dates ); |
| [2194](#L2194) |  |
| [2195](#L2195) | $attributes = array(); |
| [2196](#L2196) |  |
| [2197](#L2197) | $response['prevent\_next\_month\_check'] = false; |
| [2198](#L2198) | if( !empty( $get\_period\_available\_for\_booking ) ){ |
| [2199](#L2199) | $bookingpress\_current\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2200](#L2200) | $max\_available\_date = date('Y-m-d', strtotime( $bookingpress\_current\_date . '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2201](#L2201) | $response['max\_available\_date'] = $max\_available\_date; |
| [2202](#L2202) | $response['max\_available\_month'] = date('m', strtotime( $max\_available\_date ) ); |
| [2203](#L2203) | $response['max\_available\_year'] = date('Y', strtotime( $max\_available\_date ) ); |
| [2204](#L2204) | if( isset($response['selected\_date']) && $max\_available\_date < $response['selected\_date'] ){ |
| [2205](#L2205) | $response['front\_timings'] = array(); |
| [2206](#L2206) | $response['next\_month'] = $next\_month; |
| [2207](#L2207) | if($return\_data){ |
| [2208](#L2208) | return $response; |
| [2209](#L2209) | } |
| [2210](#L2210) | wp\_send\_json( $response ); |
| [2211](#L2211) | die; |
| [2212](#L2212) | } |
| [2213](#L2213) | } |
| [2214](#L2214) |  |
| [2215](#L2215) | if( !empty( $response['max\_available\_month'] ) && $next\_month > $response['max\_available\_month'] && $response['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ |
| [2216](#L2216) | $response['prevent\_next\_month\_check'] = true; |
| [2217](#L2217) | } |
| [2218](#L2218) |  |
| [2219](#L2219) |  |
| [2220](#L2220) | $response['variant']    = 'success'; |
| [2221](#L2221) | $response['title']      = 'Success'; |
| [2222](#L2222) | $response['msg']        = 'Data reterive successfully'; |
| [2223](#L2223) | $response['days\_off\_disabled\_dates']  =  implode(',',$bookingpress\_disable\_date ); |
| [2224](#L2224) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$bpa\_retrieves\_default\_disabled\_dates ); |
| [2225](#L2225) | $response['selected\_date']  = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2226](#L2226) | $response['next\_month'] = $next\_month; |
| [2227](#L2227) | $response['vcal\_attributes'] = $attributes; |
| [2228](#L2228) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [2229](#L2229) | $response['front\_timings'] = $front\_timings\_data; |
| [2230](#L2230) | $response['next\_year'] = $next\_year; |
| [2231](#L2231) | $response['msg']        = 'Data reterive successfully'; |
| [2232](#L2232) | } |
| [2233](#L2233) |  |
| [2234](#L2234) | $end\_ms = microtime( true ); |
| [2235](#L2235) | $response['time\_taken'] = ( $end\_ms - $start\_ms ) . ' seconds'; |
| [2236](#L2236) |  |
| [2237](#L2237) | if($return\_data){ |
| [2238](#L2238) | return $response; |
| [2239](#L2239) | } |
| [2240](#L2240) | wp\_send\_json($response); |
| [2241](#L2241) | exit; |
| [2242](#L2242) | } |
| [2243](#L2243) |  |
| [2244](#L2244) | /\*\* |
| [2245](#L2245) | \* Get default disable dates |
| [2246](#L2246) | \* |
| [2247](#L2247) | \* @return void |
| [2248](#L2248) | \*/ |
| [2249](#L2249) | function bookingpress\_get\_disable\_date\_func\_legacy( $bpa\_selected\_date = '', $consider\_selected\_date = false, $counter = 1, $bpa\_total\_booked\_appointment = array(), $single\_disable\_date = array()) { |
| [2250](#L2250) |  |
| [2251](#L2251) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs; |
| [2252](#L2252) | $response              = array(); |
| [2253](#L2253) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [2254](#L2254) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [2255](#L2255) |  |
| [2256](#L2256) | if (! $bpa\_verify\_nonce\_flag ) { |
| [2257](#L2257) | $response['variant']      = 'error'; |
| [2258](#L2258) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2259](#L2259) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [2260](#L2260) | $response['redirect\_url'] = ''; |
| [2261](#L2261) | wp\_send\_json($response); |
| [2262](#L2262) | die(); |
| [2263](#L2263) | } |
| [2264](#L2264) |  |
| [2265](#L2265) | $response['variant']    = 'error'; |
| [2266](#L2266) | $response['title']      = 'Error'; |
| [2267](#L2267) | $response['msg']        = 'Something went wrong....'; |
| [2268](#L2268) |  |
| [2269](#L2269) |  |
| [2270](#L2270) | if( !empty( $\_POST['appointment\_data\_obj'] ) && !is\_array( $\_POST['appointment\_data\_obj'] ) ){ |
| [2271](#L2271) | $\_POST['appointment\_data\_obj'] = json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ); //phpcs:ignore |
| [2272](#L2272) | $\_REQUEST['appointment\_data\_obj'] = $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2273](#L2273) | } |
| [2274](#L2274) |  |
| [2275](#L2275) | $bookingpress\_appointment\_data = !empty($\_POST['appointment\_data\_obj']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [2276](#L2276) | $bookingpress\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2277](#L2277) |  |
| [2278](#L2278) | if(!empty($bookingpress\_selected\_date)){ |
| [2279](#L2279) | $bookingpress\_selected\_date = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2283](#L2283) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2284](#L2284) | } |
| [2285](#L2285) |  |
| [2286](#L2286) | $bookingpress\_selected\_service= !empty($\_REQUEST['selected\_service']) ? intval($\_REQUEST['selected\_service']) : ''; |
| [2287](#L2287) |  |
| [2288](#L2288) | if(empty($bookingpress\_selected\_service)){ |
| [2289](#L2289) | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [2290](#L2290) | } |
| [2291](#L2291) |  |
| [2292](#L2292) | if(empty($bookingpress\_appointment\_data['selected\_service\_duration\_unit']) || empty($bookingpress\_appointment\_data['selected\_service\_duration']) ){ |
| [2293](#L2293) | $bookingpress\_service\_data = $BookingPress->get\_service\_by\_id($bookingpress\_selected\_service); |
| [2294](#L2294) | if(!empty($bookingpress\_service\_data['bookingpress\_service\_duration\_unit'])){ |
| [2295](#L2295) | $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] = $bookingpress\_service\_data['bookingpress\_service\_duration\_unit']; |
| [2296](#L2296) | $bookingpress\_appointment\_data['selected\_service\_duration'] = intval($bookingpress\_service\_data['bookingpress\_service\_duration\_val']); |
| [2297](#L2297) | } |
| [2298](#L2298) | } |
| [2299](#L2299) |  |
| [2300](#L2300) | if(empty($bookingpress\_selected\_date)){ |
| [2301](#L2301) | $bookingpress\_selected\_date = !empty( $bookingpress\_appointment\_data['selected\_date'] ) ? $bookingpress\_appointment\_data['selected\_date'] : date('Y-m-d', current\_time('timestamp') ); |
| [2302](#L2302) | } |
| [2303](#L2303) | if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2304](#L2304) | $bookingpress\_selected\_date = $bpa\_selected\_date; |
| [2305](#L2305) | } |
| [2306](#L2306) |  |
| [2307](#L2307) | if( "NaN-NaN-NaN" == $bookingpress\_selected\_date || '1970-01-01' == $bookingpress\_selected\_date || !preg\_match('/(\d{4}\-\d{2}\-\d{2})/', $bookingpress\_selected\_date ) ){ |
| [2308](#L2308) | $bookingpress\_selected\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2309](#L2309) | } |
| [2310](#L2310) |  |
| [2311](#L2311) | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
| [2312](#L2312) |  |
| [2313](#L2313) |  |
| [2314](#L2314) | $is\_multiple\_day\_event = false; |
| [2315](#L2315) | if( !empty( $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ) && 'd' == $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ){ |
| [2316](#L2316) | $is\_multiple\_day\_event = true; |
| [2317](#L2317) | $multiple\_day\_response = array(); |
| [2318](#L2318) | $multiple\_day\_response = apply\_filters( 'bookingpress\_get\_multiple\_days\_disable\_dates', $multiple\_day\_response, $bookingpress\_selected\_date, $bookingpress\_selected\_service, $bookingpress\_appointment\_data ); |
| [2319](#L2319) | if( !empty( $multiple\_day\_response ) ){ |
| [2320](#L2320) | echo wp\_json\_encode( $multiple\_day\_response ); |
| [2321](#L2321) | die; |
| [2322](#L2322) | } |
| [2323](#L2323) | } |
| [2324](#L2324) |  |
| [2325](#L2325) | if(!empty($bookingpress\_selected\_service)) { |
| [2326](#L2326) | $bookingpress\_disable\_date = $BookingPress->bookingpress\_get\_default\_dayoff\_dates('','',$bookingpress\_selected\_service,$bookingpress\_selected\_staffmember\_id); |
| [2327](#L2327) |  |
| [2328](#L2328) | $bookingpress\_disable\_date = apply\_filters('bookingpress\_modify\_disable\_dates', $bookingpress\_disable\_date, $bookingpress\_selected\_service, $bookingpress\_selected\_date, $bookingpress\_appointment\_data); |
| [2329](#L2329) |  |
| [2330](#L2330) | $bookingpress\_start\_date = date('Y-m-d', current\_time('timestamp')); |
| [2331](#L2331) | if( true == $consider\_selected\_date && !empty( $bpa\_selected\_date ) ){ |
| [2332](#L2332) | $bookingpress\_start\_date = $bpa\_selected\_date; |
| [2333](#L2333) | } |
| [2334](#L2334) | $bookingpress\_end\_date = date('Y-m-d', strtotime('last day of this month', strtotime( $bookingpress\_start\_date ))); |
| [2335](#L2335) |  |
| [2336](#L2336) | $next\_month = date( 'm', strtotime( $bookingpress\_end\_date . '+1 day' ) ); |
| [2337](#L2337) | $next\_year = date( 'Y', strtotime( $bookingpress\_end\_date . '+1 day' ) ); |
| [2338](#L2338) |  |
| [2339](#L2339) | $bookingpress\_total\_booked\_appointment\_where\_clause = ''; |
| [2340](#L2340) | $bookingpress\_total\_booked\_appointment\_where\_clause = apply\_filters( 'bookingpress\_total\_booked\_appointment\_where\_clause', $bookingpress\_total\_booked\_appointment\_where\_clause ); |
| [2341](#L2341) |  |
| [2342](#L2342) | $max\_service\_capacity = 1; |
| [2343](#L2343) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
| [2344](#L2344) |  |
| [2345](#L2345) | $bpa\_begin\_date = new DateTime( $bookingpress\_start\_date ); |
| [2346](#L2346) | $bpa\_end\_date = new DateTime( date('Y-m-d', strtotime($bookingpress\_end\_date . '+1 day')) ); |
| [2347](#L2347) |  |
| [2348](#L2348) | $bpa\_interval = DateInterval::createFromDateString('1 day'); |
| [2349](#L2349) | $period = new DatePeriod($bpa\_begin\_date, $bpa\_interval, $bpa\_end\_date); |
| [2350](#L2350) |  |
| [2351](#L2351) | foreach ($period as $dt) { |
| [2352](#L2352) | $bpa\_check\_date = $dt->format('Y-m-d'); |
| [2353](#L2353) |  |
| [2354](#L2354) | $bpa\_check\_date\_formatted = $dt->format( 'c' ); |
| [2355](#L2355) | if( !empty( $bookingpress\_disable\_date) && in\_array( $bpa\_check\_date\_formatted, $bookingpress\_disable\_date ) ){ |
| [2356](#L2356) | continue; |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) | $bookingpress\_total\_appointment = $wpdb->get\_results($wpdb->prepare("SELECT bookingpress\_appointment\_date,bookingpress\_service\_duration\_val,bookingpress\_service\_duration\_unit FROM " . $tbl\_bookingpress\_appointment\_bookings . " WHERE (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s) AND bookingpress\_service\_id= %d AND bookingpress\_appointment\_date = %s ".$bookingpress\_total\_booked\_appointment\_where\_clause." GROUP BY bookingpress\_appointment\_date",'1','2',$bookingpress\_selected\_service,$bpa\_check\_date), ARRAY\_A); //phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [2360](#L2360) |  |
| [2361](#L2361) | $bookingpress\_total\_appointment = apply\_filters( 'bookingpress\_modify\_total\_booked\_appointment', $bookingpress\_total\_appointment, $bookingpress\_appointment\_data); |
| [2362](#L2362) |  |
| [2363](#L2363) | /\*\* reputelog - check for this loop as it's adding the current selected date to disabled time slots if an appointment is booked in the selected date \*/ |
| [2364](#L2364) | if( !empty( $bpa\_total\_booked\_appointment ) ){ |
| [2365](#L2365) | $bookingpress\_total\_appointment = array\_merge( $bookingpress\_total\_appointment, $bpa\_total\_booked\_appointment ); |
| [2366](#L2366) | } |
| [2367](#L2367) |  |
| [2368](#L2368) | $multiple\_days\_event = array(); |
| [2369](#L2369) |  |
| [2370](#L2370) | if( count( $bookingpress\_total\_appointment ) > 0 ){ |
| [2371](#L2371) | foreach($bookingpress\_total\_appointment as $key  => $value) { |
| [2372](#L2372) | if(!empty($value['bookingpress\_appointment\_date'])){ |
| [2373](#L2373) | $bookingpress\_appointment\_date = !empty($value['bookingpress\_appointment\_date']) ? $value['bookingpress\_appointment\_date'] : ''; |
| [2374](#L2374) | //$bookingpress\_time\_slot\_data = $BookingPress->bookingpress\_get\_service\_available\_time($bookingpress\_selected\_service,$bookingpress\_appointment\_date ); |
| [2375](#L2375) | $bookingpress\_time\_slots = $this->bookingpress\_check\_booked\_appointments( $bookingpress\_appointment\_date ); |
| [2376](#L2376) |  |
| [2377](#L2377) | $bookingpress\_time\_slot\_data = array\_merge( |
| [2378](#L2378) | $bookingpress\_time\_slots['morning\_time'], |
| [2379](#L2379) | $bookingpress\_time\_slots['afternoon\_time'], |
| [2380](#L2380) | $bookingpress\_time\_slots['evening\_time'], |
| [2381](#L2381) | $bookingpress\_time\_slots['night\_time'] |
| [2382](#L2382) | ); |
| [2383](#L2383) |  |
| [2384](#L2384) | if(!empty($bookingpress\_time\_slot\_data)) { |
| [2385](#L2385) | $is\_booked = 1; |
| [2386](#L2386) | foreach($bookingpress\_time\_slot\_data as $key2 => $value2) { |
| [2387](#L2387) | if( ( isset($value2['is\_booked']) && $value2['is\_booked'] == 0 ) || empty( $value2['is\_booked'] ) ){ |
| [2388](#L2388) | if( isset( $value2['max\_capacity'] ) && isset( $value2['total\_booked'] ) && $value2['total\_booked'] >= $value2['max\_total\_capacity'] ) { |
| [2389](#L2389) | /\*\* Do nothing \*/ |
| [2390](#L2390) | } else { |
| [2391](#L2391) | $is\_booked = 0; |
| [2392](#L2392) | break; |
| [2393](#L2393) | } |
| [2394](#L2394) | } |
| [2395](#L2395) | } |
| [2396](#L2396) |  |
| [2397](#L2397) | $bookingpress\_allow\_to\_disable\_booked\_date = apply\_filters('bookingpress\_allow\_to\_disable\_booked\_date',true,$bookingpress\_selected\_service); |
| [2398](#L2398) |  |
| [2399](#L2399) | if($is\_booked == 1 && $bookingpress\_allow\_to\_disable\_booked\_date) { |
| [2400](#L2400) | $bookingpress\_disable\_date[] = date('c', strtotime( $bookingpress\_appointment\_date)); |
| [2401](#L2401) | } |
| [2402](#L2402) | } else { |
| [2403](#L2403) | if( $is\_multiple\_day\_event ){ |
| [2404](#L2404) | $service\_duration\_val = $value['bookingpress\_service\_duration\_val']; |
| [2405](#L2405) | if( empty( $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ] ) ){ |
| [2406](#L2406) | $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ] = 1; |
| [2407](#L2407) | } else { |
| [2408](#L2408) | $multiple\_days\_event[ date('Y-m-d', strtotime( $bookingpress\_appointment\_date)) ]++; |
| [2409](#L2409) | } |
| [2410](#L2410) | for( $d = 1; $d < $service\_duration\_val; $d++ ){ |
| [2411](#L2411) | if( empty( $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ] ) ){ |
| [2412](#L2412) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ] = 1; |
| [2413](#L2413) | } else { |
| [2414](#L2414) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '+' . $d . ' days' )) ]++; |
| [2415](#L2415) | } |
| [2416](#L2416) | } |
| [2417](#L2417) |  |
| [2418](#L2418) | for( $dm = $service\_duration\_val - 1; $dm > 0; $dm-- ){ |
| [2419](#L2419) | if( empty( $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ] ) ){ |
| [2420](#L2420) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ] = 1; |
| [2421](#L2421) | } else { |
| [2422](#L2422) | $multiple\_days\_event[ date( 'Y-m-d', strtotime( $bookingpress\_appointment\_date . '-' . $dm . ' days' )) ]++; |
| [2423](#L2423) | } |
| [2424](#L2424) | } |
| [2425](#L2425) | } else { |
| [2426](#L2426) | $bookingpress\_disable\_date[] = date('Y-m-d', strtotime( $bookingpress\_appointment\_date)); |
| [2427](#L2427) | } |
| [2428](#L2428) | } |
| [2429](#L2429) | } |
| [2430](#L2430) | }; |
| [2431](#L2431) | } else { |
| [2432](#L2432) | if( !$is\_multiple\_day\_event ){ |
| [2433](#L2433) |  |
| [2434](#L2434) | $booked\_time\_slots = apply\_filters( 'bookingpress\_check\_available\_timeslot\_manual\_block', true, $bpa\_check\_date ); |
| [2435](#L2435) |  |
| [2436](#L2436) | if( false == $booked\_time\_slots ){ |
| [2437](#L2437) | $bookingpress\_disable\_date[] = date('Y-m-d', strtotime($bpa\_check\_date) ); |
| [2438](#L2438) | } |
| [2439](#L2439) | } |
| [2440](#L2440) | } |
| [2441](#L2441) | } |
| [2442](#L2442) |  |
| [2443](#L2443) | $attributes = array(); |
| [2444](#L2444) | if( !empty( $multiple\_days\_event ) ){ |
| [2445](#L2445) | $bookingpress\_slot\_left\_text = $BookingPress->bookingpress\_get\_customize\_settings('slot\_left\_text','booking\_form'); |
| [2446](#L2446) | $bookingpress\_slot\_left\_text = !empty($bookingpress\_slot\_left\_text) ? stripslashes\_deep($bookingpress\_slot\_left\_text) : esc\_html\_\_('Slots left', 'bookingpress-appointment-booking'); |
| [2447](#L2447) | foreach( $multiple\_days\_event as $md\_date => $md\_cap ){ |
| [2448](#L2448) |  |
| [2449](#L2449) | if( $md\_cap >= $max\_service\_capacity ){ |
| [2450](#L2450) | $bookingpress\_disable\_date[] = $md\_date; |
| [2451](#L2451) | } |
| [2452](#L2452) | $remaining\_capacity = ( $max\_service\_capacity - $md\_cap ); |
| [2453](#L2453) | $attributes[ $md\_date ] = ( ($remaining\_capacity < 0 ) ? 0 : $remaining\_capacity )  .' '. $bookingpress\_slot\_left\_text; |
| [2454](#L2454) | } |
| [2455](#L2455) | } |
| [2456](#L2456) |  |
| [2457](#L2457) | $bookingpress\_disable\_date = apply\_filters( 'bookingpress\_modify\_disable\_dates\_with\_staffmember', $bookingpress\_disable\_date, $bookingpress\_selected\_service); |
| [2458](#L2458) | $bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load($bookingpress\_selected\_date,$bookingpress\_disable\_date); |
| [2459](#L2459) |  |
| [2460](#L2460) | $bookingpress\_disable\_date = array\_unique( $bookingpress\_disable\_date ); |
| [2461](#L2461) |  |
| [2462](#L2462) | if( !empty( $single\_disable\_date ) ){ |
| [2463](#L2463) | $bookingpress\_disable\_date = array\_merge( $bookingpress\_disable\_date, $single\_disable\_date ); |
| [2464](#L2464) | } |
| [2465](#L2465) |  |
| [2466](#L2466) | $bpa\_disable\_dates = array(); |
| [2467](#L2467) | foreach( $bookingpress\_disable\_date as $disable\_date ){ |
| [2468](#L2468) | $bpa\_disable\_dates[] = date('Y-m-d H:i:s', strtotime( $disable\_date ) ); |
| [2469](#L2469) | } |
| [2470](#L2470) |  |
| [2471](#L2471) | $response['variant']    = 'success'; |
| [2472](#L2472) | $response['title']      = 'Success'; |
| [2473](#L2473) | $response['msg']        = 'Data reterive successfully'; |
| [2474](#L2474) | $response['days\_off\_disabled\_dates']  =  implode(',',$bookingpress\_disable\_date ); |
| [2475](#L2475) | $response['days\_off\_disabled\_dates\_string']  =  implode(',',$bpa\_disable\_dates ); |
| [2476](#L2476) | $response['selected\_date']  = date('Y-m-d', strtotime($bookingpress\_selected\_date)); |
| [2477](#L2477) | $response['next\_month'] = $next\_month; |
| [2478](#L2478) | $response['vcal\_attributes'] = $attributes; |
| [2479](#L2479) | $response['max\_capacity\_capacity'] = $max\_service\_capacity; |
| [2480](#L2480) | $response['next\_year'] = $next\_year; |
| [2481](#L2481) | $response['msg']        = 'Data reterive successfully'; |
| [2482](#L2482) | } |
| [2483](#L2483) |  |
| [2484](#L2484) | /\* $\_SESSION['disable\_dates'] = array(); |
| [2485](#L2485) | $\_SESSION['disable\_dates'] = $bookingpress\_disable\_date; \*/ |
| [2486](#L2486) | /\*\* Get Front Timings Changes Start \*/ |
| [2487](#L2487) | $get\_period\_available\_for\_booking = $BookingPress->bookingpress\_get\_settings('period\_available\_for\_booking', 'general\_setting'); |
| [2488](#L2488) |  |
| [2489](#L2489) | /\*\* Set max 365 days if setting not set or pro version is deactivated \*/ |
| [2490](#L2490) | if( empty( $get\_period\_available\_for\_booking ) || !$BookingPress->bpa\_is\_pro\_active() ){ |
| [2491](#L2491) | $get\_period\_available\_for\_booking = 365; |
| [2492](#L2492) | } |
| [2493](#L2493) |  |
| [2494](#L2494) | $response['prevent\_next\_month\_check'] = false; |
| [2495](#L2495) | if( !empty( $get\_period\_available\_for\_booking ) ){ |
| [2496](#L2496) | $bookingpress\_current\_date = date('Y-m-d', current\_time('timestamp') ); |
| [2497](#L2497) | $max\_available\_date = date('Y-m-d', strtotime( $bookingpress\_current\_date . '+' . $get\_period\_available\_for\_booking . ' days') ); |
| [2498](#L2498) | $response['max\_available\_date'] = $max\_available\_date; |
| [2499](#L2499) | $response['max\_available\_month'] = date('m', strtotime( $max\_available\_date ) ); |
| [2500](#L2500) | $response['max\_available\_year'] = date('Y', strtotime( $max\_available\_date ) ); |
| [2501](#L2501) | if( $max\_available\_date < $response['selected\_date'] ){ |
| [2502](#L2502) | $response['front\_timings'] = array(); |
| [2503](#L2503) | $response['next\_month'] = $next\_month; |
| [2504](#L2504) | wp\_send\_json( $response ); |
| [2505](#L2505) | die; |
| [2506](#L2506) | } |
| [2507](#L2507) | } |
| [2508](#L2508) |  |
| [2509](#L2509) | if( !empty( $response['max\_available\_month'] ) && $next\_month > $response['max\_available\_month'] && $response['max\_available\_year'] < date('Y', current\_time('timestamp') ) ){ |
| [2510](#L2510) | $response['prevent\_next\_month\_check'] = true; |
| [2511](#L2511) | } |
| [2512](#L2512) | $response['check\_for\_multiple\_days\_event'] = false; |
| [2513](#L2513) | if( !empty( $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ) && 'd' == $bookingpress\_appointment\_data['selected\_service\_duration\_unit'] ){ |
| [2514](#L2514) | $response['check\_for\_multiple\_days\_event'] = true; |
| [2515](#L2515) | } |
| [2516](#L2516) |  |
| [2517](#L2517) |  |
| [2518](#L2518) | /\*\* multiple days event \*/ |
| [2519](#L2519) | $multiple\_days\_event = false; |
| [2520](#L2520) | if( !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit'] ) && $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit'] == 'd' ){ |
| [2521](#L2521) | $multiple\_days\_event = true; |
| [2522](#L2522) | } |
| [2523](#L2523) |  |
| [2524](#L2524) | $front\_timings = $this->bookingpress\_retrieve\_timeslots( $response['selected\_date'], true ); |
| [2525](#L2525) |  |
| [2526](#L2526) | $is\_custom\_duration = ( !empty( $front\_timings['is\_custom\_duration'] ) && 1 == $front\_timings['is\_custom\_duration'] ) ? true : false; |
| [2527](#L2527) | if( !empty( $front\_timings ) && !$is\_custom\_duration ){ |
| [2528](#L2528) |  |
| [2529](#L2529) | $is\_front\_timings\_empty = false; |
| [2530](#L2530) | $total\_time\_slots = 0; |
| [2531](#L2531) | $total\_booked\_time\_slots = 0; |
| [2532](#L2532) | $total\_timings = count( $front\_timings ); |
| [2533](#L2533) | $empty\_slots = 0; |
| [2534](#L2534) |  |
| [2535](#L2535) | foreach( $front\_timings as $k => $val ){ |
| [2536](#L2536) |  |
| [2537](#L2537) | if( !empty( $val ) && count( $val ) > 0 ){ |
| [2538](#L2538) | foreach( $val as $ik => $iv ){ |
| [2539](#L2539) | if( 1 == $iv['is\_booked'] ){ |
| [2540](#L2540) | $total\_booked\_time\_slots++; |
| [2541](#L2541) | } else if( isset( $iv['max\_capacity'] ) && isset( $iv['total\_booked'] ) && $iv['total\_booked'] >= $iv['max\_total\_capacity'] ){ |
| [2542](#L2542) | $total\_booked\_time\_slots++; |
| [2543](#L2543) | } |
| [2544](#L2544) | $total\_time\_slots++; |
| [2545](#L2545) | } |
| [2546](#L2546) | } else if( empty( $val ) ){ |
| [2547](#L2547) | $empty\_slots++; |
| [2548](#L2548) | } |
| [2549](#L2549) | } |
| [2550](#L2550) | if( ( $total\_time\_slots == $total\_booked\_time\_slots && 0 < $total\_time\_slots && $total\_booked\_time\_slots ) || $total\_timings == $empty\_slots ){ |
| [2551](#L2551) | $is\_front\_timings\_empty = true; |
| [2552](#L2552) | } |
| [2553](#L2553) |  |
| [2554](#L2554) | if( $is\_front\_timings\_empty && $multiple\_days\_event ){ |
| [2555](#L2555) | $is\_front\_timings\_empty = false; |
| [2556](#L2556) | } |
| [2557](#L2557) |  |
| [2558](#L2558) | $response['front\_timings'] = $front\_timings; |
| [2559](#L2559) |  |
| [2560](#L2560) | $bookingpress\_add\_single\_disable\_date = apply\_filters('bookingpress\_add\_single\_disable\_date\_when\_no\_timeslot',true,$bookingpress\_selected\_service,$front\_timings); |
| [2561](#L2561) | if( true == $is\_front\_timings\_empty && $bookingpress\_add\_single\_disable\_date){ |
| [2562](#L2562) | $response['empty\_front\_timings'] = true; |
| [2563](#L2563) | if( true == $consider\_selected\_date ){ |
| [2564](#L2564) | $posted\_selected\_date = $bpa\_selected\_date; |
| [2565](#L2565) | } else { |
| [2566](#L2566) | $posted\_selected\_date = !empty($\_REQUEST['selected\_date']) ? sanitize\_text\_field($\_REQUEST['selected\_date']) : ''; |
| [2567](#L2567) | } |
| [2568](#L2568) | //$bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load($posted\_selected\_date,$bookingpress\_disable\_date); /\*\* reputelog - need to check with pro version data \*/ |
| [2569](#L2569) | $response['next\_available\_date'] = date('Y-m-d', strtotime($posted\_selected\_date.'+1 day') ); |
| [2570](#L2570) | if( !isset( $single\_disable\_date ) || !is\_array( $single\_disable\_date ) ){ |
| [2571](#L2571) | $single\_disable\_date = array(); |
| [2572](#L2572) | } |
| [2573](#L2573) | $single\_disable\_date[] = date('c',strtotime($posted\_selected\_date)); |
| [2574](#L2574) |  |
| [2575](#L2575) | $this->bookingpress\_get\_disable\_date\_func\_legacy( $response['next\_available\_date'], true, $counter++, $bookingpress\_total\_appointment, $single\_disable\_date ); |
| [2576](#L2576) |  |
| [2577](#L2577) | } |
| [2578](#L2578) | } |
| [2579](#L2579) |  |
| [2580](#L2580) |  |
| [2581](#L2581) | /\*\* Get Front Timings Changes End \*/ |
| [2582](#L2582) |  |
| [2583](#L2583) | $response = apply\_filters('bookingpress\_modify\_disable\_date\_data',$response); |
| [2584](#L2584) |  |
| [2585](#L2585) |  |
| [2586](#L2586) |  |
| [2587](#L2587) | wp\_send\_json($response); |
| [2588](#L2588) | exit; |
| [2589](#L2589) | } |
| [2590](#L2590) |  |
| [2591](#L2591) | function bookingpress\_check\_available\_timeslot\_manual\_block\_func( $block\_date, $check\_date ){ |
| [2592](#L2592) |  |
| [2593](#L2593) | if( false != $block\_date ){ |
| [2594](#L2594) | $block\_date = $this->bookingpress\_check\_booked\_appointments( $check\_date, true, false, true ); |
| [2595](#L2595) |  |
| [2596](#L2596) | } else{ |
| [2597](#L2597) | return true; |
| [2598](#L2598) | } |
| [2599](#L2599) | return $block\_date; |
| [2600](#L2600) | } |
| [2601](#L2601) |  |
| [2602](#L2602) | function bookingpress\_check\_booked\_appointments( $disabled\_date, $return = true, $check\_for\_whole\_day = false, $checked\_for\_one\_slot = false ){ |
| [2603](#L2603) | return $this->bookingpress\_retrieve\_timeslots( $disabled\_date, $return, $check\_for\_whole\_day, $checked\_for\_one\_slot ); |
| [2604](#L2604) | } |
| [2605](#L2605) |  |
| [2606](#L2606) |  |
| [2607](#L2607) | /\*\* |
| [2608](#L2608) | \* Insert shortcode from classic editor |
| [2609](#L2609) | \* |
| [2610](#L2610) | \* @param  mixed $content |
| [2611](#L2611) | \* @return void |
| [2612](#L2612) | \*/ |
| [2613](#L2613) | function bookingpress\_insert\_shortcode\_button( $content ) |
| [2614](#L2614) | { |
| [2615](#L2615) | global $bookingpress\_global\_options; |
| [2616](#L2616) | $allowed\_pages\_for\_media\_button = array( 'post.php', 'post-new.php' ); |
| [2617](#L2617) |  |
| [2618](#L2618) | if (isset($\_SERVER['PHP\_SELF']) && ! in\_array(basename($\_SERVER['PHP\_SELF']), $allowed\_pages\_for\_media\_button) ) { |
| [2619](#L2619) | return; |
| [2620](#L2620) | } |
| [2621](#L2621) | if (! isset($post\_type) ) { |
| [2622](#L2622) | $post\_type = ''; |
| [2623](#L2623) | } |
| [2624](#L2624) | if (isset($\_SERVER['PHP\_SELF']) && basename(sanitize\_text\_field($\_SERVER['PHP\_SELF'])) == 'post.php' ) { |
| [2625](#L2625) | $post\_id   = isset($\_REQUEST['post']) ? sanitize\_text\_field($\_REQUEST['post']) : 0; |
| [2626](#L2626) | $post\_type = get\_post\_type($post\_id); |
| [2627](#L2627) | } |
| [2628](#L2628) | if (isset($\_SERVER['PHP\_SELF']) && basename(sanitize\_text\_field($\_SERVER['PHP\_SELF'])) == 'post-new.php' ) { |
| [2629](#L2629) | if (isset($\_REQUEST['post\_type']) ) { |
| [2630](#L2630) | $post\_type = sanitize\_text\_field($\_REQUEST['post\_type']); |
| [2631](#L2631) | } else { |
| [2632](#L2632) | $post\_type = 'post'; |
| [2633](#L2633) | } |
| [2634](#L2634) | } |
| [2635](#L2635) |  |
| [2636](#L2636) | if( $content != 'content'){ |
| [2637](#L2637) | return; |
| [2638](#L2638) | } |
| [2639](#L2639) |  |
| [2640](#L2640) | $allowed\_post\_types = array( 'post', 'page' ); |
| [2641](#L2641) |  |
| [2642](#L2642) | if (! in\_array($post\_type, $allowed\_post\_types) ) { |
| [2643](#L2643) | return; |
| [2644](#L2644) | } |
| [2645](#L2645) | if (! wp\_script\_is('jquery', 'enqueued') ) { |
| [2646](#L2646) | wp\_enqueue\_script('jquery'); |
| [2647](#L2647) | } |
| [2648](#L2648) | if (! wp\_style\_is('bookingpress\_tinymce', 'enqueued') ) { |
| [2649](#L2649) | wp\_enqueue\_style('bookingpress\_tinymce', BOOKINGPRESS\_URL . '/css/bookingpress\_tinymce.css', array(), BOOKINGPRESS\_VERSION); |
| [2650](#L2650) | } |
| [2651](#L2651) | wp\_register\_script('bookingpress\_vue\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_vue.min.js', array(), BOOKINGPRESS\_VERSION, 0); |
| [2652](#L2652) | wp\_register\_script('bookingpress\_element\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element.js', array( '' ), '2.51.5', 0); |
| [2653](#L2653) | wp\_register\_script('bookingpress\_element\_en\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array( '' ), '2.51.5', 0); |
| [2654](#L2654) | wp\_register\_script('bookingpress\_wordpress\_vue\_helper\_js', BOOKINGPRESS\_URL . '/js/bookingpress\_wordpress\_vue\_qs\_helper.js', array( '' ), '6.5.1', 0); |
| [2655](#L2655) |  |
| [2656](#L2656) | wp\_enqueue\_script('bookingpress\_vue\_js'); |
| [2657](#L2657) | wp\_enqueue\_script('bookingpress\_element\_js'); |
| [2658](#L2658) | wp\_enqueue\_script('bookingpress\_element\_en\_js'); |
| [2659](#L2659) | wp\_enqueue\_script('bookingpress\_wordpress\_vue\_helper\_js'); |
| [2660](#L2660) |  |
| [2661](#L2661) | wp\_register\_style('bookingpress\_element\_css', BOOKINGPRESS\_URL . '/css/bookingpress\_element\_theme.css', array(), BOOKINGPRESS\_VERSION); |
| [2662](#L2662) | wp\_enqueue\_style('bookingpress\_element\_css'); |
| [2663](#L2663) |  |
| [2664](#L2664) | if (wp\_script\_is('bookingpress\_vue\_js', 'enqueued') ) { |
| [2665](#L2665) | $this->bookingpress\_insert\_shortcode\_popup(); |
| [2666](#L2666) | } |
| [2667](#L2667) |  |
| [2668](#L2668) | $bookingpress\_site\_current\_language = $bookingpress\_global\_options->bookingpress\_get\_site\_current\_language(); |
| [2669](#L2669) |  |
| [2670](#L2670) | if ($bookingpress\_site\_current\_language != 'en' ) { |
| [2671](#L2671) | wp\_register\_script('bookingpress\_vue\_cal\_locale', BOOKINGPRESS\_URL . '/js/locales/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2672](#L2672) | wp\_enqueue\_script('bookingpress\_vue\_cal\_locale'); |
| [2673](#L2673) |  |
| [2674](#L2674) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/elements\_locale/' . $bookingpress\_site\_current\_language . '.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2675](#L2675) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [2676](#L2676) | } else { |
| [2677](#L2677) | wp\_register\_script('bookingpress\_elements\_locale', BOOKINGPRESS\_URL . '/js/bookingpress\_element\_en.js', array(), BOOKINGPRESS\_VERSION, true); |
| [2678](#L2678) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [2679](#L2679) | } |
| [2680](#L2680) |  |
| [2681](#L2681) | $bpa\_inline\_script\_data = ' |
| [2682](#L2682) | var lang = ELEMENT.lang.' . $bookingpress\_site\_current\_language . '; |
| [2683](#L2683) | ELEMENT.locale(lang); |
| [2684](#L2684) | var app = new Vue({ |
| [2685](#L2685) | el: "#bookingpress\_shortcode\_form", |
| [2686](#L2686) | data() { |
| [2687](#L2687) | var bookingpress\_return\_data = { |
| [2688](#L2688) | open\_bookingpress\_shortcode\_modal: false, |
| [2689](#L2689) | close\_modal\_on\_esc: true, |
| [2690](#L2690) | centerDialogVisible: false, |
| [2691](#L2691) | selected\_bookingpress\_shortcode: "", |
| [2692](#L2692) | append\_modal\_to\_body: true, |
| [2693](#L2693) | }; |
| [2694](#L2694) | return bookingpress\_return\_data; |
| [2695](#L2695) | }, |
| [2696](#L2696) | mounted(){ |
| [2697](#L2697) | }, |
| [2698](#L2698) | methods: { |
| [2699](#L2699) | model\_action() { |
| [2700](#L2700) | const vm= this; |
| [2701](#L2701) | if(vm.open\_bookingpress\_shortcode\_modal == true ) { |
| [2702](#L2702) | vm.open\_bookingpress\_shortcode\_modal = false; |
| [2703](#L2703) | } else { |
| [2704](#L2704) | vm.open\_bookingpress\_shortcode\_modal = true; |
| [2705](#L2705) | } |
| [2706](#L2706) | }, |
| [2707](#L2707) | bookingpress\_open\_form\_shortcode\_popup(){ |
| [2708](#L2708) | this.model\_action(); |
| [2709](#L2709) | }, |
| [2710](#L2710) | add\_bookingpress\_shortcode(){ |
| [2711](#L2711) | const vm = this; |
| [2712](#L2712) | if(vm.selected\_bookingpress\_shortcode != "") { |
| [2713](#L2713) | if(tinyMCE.activeEditor != null){ |
| [2714](#L2714) | var editorContent = tinyMCE.activeEditor.getContent() |
| [2715](#L2715) | editorContent += "["+vm.selected\_bookingpress\_shortcode+"]" |
| [2716](#L2716) | tinyMCE.activeEditor.setContent(editorContent) |
| [2717](#L2717) | } |
| [2718](#L2718) | else{ |
| [2719](#L2719) | var textEditorContent = document.getElementById("content").innerHTML |
| [2720](#L2720) | textEditorContent += "\n["+vm.selected\_bookingpress\_shortcode+"]" |
| [2721](#L2721) | document.getElementById("content").innerHTML = textEditorContent |
| [2722](#L2722) | } |
| [2723](#L2723) | vm.model\_action(); |
| [2724](#L2724) | } |
| [2725](#L2725) | } |
| [2726](#L2726) | }, |
| [2727](#L2727) | });'; |
| [2728](#L2728) |  |
| [2729](#L2729) | wp\_add\_inline\_script('bookingpress\_elements\_locale', $bpa\_inline\_script\_data); |
| [2730](#L2730) | } |
| [2731](#L2731) |  |
| [2732](#L2732) | /\*\* |
| [2733](#L2733) | \* Load HTML content of classic editor button view |
| [2734](#L2734) | \* |
| [2735](#L2735) | \* @return void |
| [2736](#L2736) | \*/ |
| [2737](#L2737) | function bookingpress\_insert\_shortcode\_popup() |
| [2738](#L2738) | { |
| [2739](#L2739) | if (file\_exists(BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_tinymce\_options\_shortcodes.php') ) { |
| [2740](#L2740) | include BOOKINGPRESS\_VIEWS\_DIR . '/bookingpress\_tinymce\_options\_shortcodes.php'; |
| [2741](#L2741) | } |
| [2742](#L2742) | ?> |
| [2743](#L2743) | <?php |
| [2744](#L2744) | } |
| [2745](#L2745) |  |
| [2746](#L2746) | /\*\* |
| [2747](#L2747) | \* Server Side Validaton - Backend Side Validation |
| [2748](#L2748) | \* |
| [2749](#L2749) | \* @return void |
| [2750](#L2750) | \*/ |
| [2751](#L2751) | function bookingpress\_before\_book\_appointment\_func() |
| [2752](#L2752) | { |
| [2753](#L2753) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs,$tbl\_bookingpress\_customers,$bookingpress\_payment\_gateways,$tbl\_bookingpress\_form\_fields; |
| [2754](#L2754) | $response              = array(); |
| [2755](#L2755) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [2756](#L2756) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [2757](#L2757) | if (! $bpa\_verify\_nonce\_flag ) { |
| [2758](#L2758) | $response['variant']      = 'error'; |
| [2759](#L2759) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2760](#L2760) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [2761](#L2761) | $response['redirect\_url'] = ''; |
| [2762](#L2762) | return wp\_json\_encode($response); |
| [2763](#L2763) |  |
| [2764](#L2764) | } |
| [2765](#L2765) | $response['variant']    = 'success'; |
| [2766](#L2766) | $response['title']      = ''; |
| [2767](#L2767) | $response['msg']        = ''; |
| [2768](#L2768) | $response['error\_type'] = ''; |
| [2769](#L2769) |  |
| [2770](#L2770) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [2771](#L2771) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [2772](#L2772) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [2773](#L2773) | } |
| [2774](#L2774) | $bookingpress\_unique\_id =  !empty($\_REQUEST['appointment\_data']['bookingpress\_uniq\_id']) ? sanitize\_text\_field( $\_REQUEST['appointment\_data']['bookingpress\_uniq\_id'] ) : ''; |
| [2775](#L2775) | $bookingpress\_form\_token = !empty( $\_REQUEST['appointment\_data']['bookingpress\_form\_token'] ) ? sanitize\_text\_field( $\_REQUEST['appointment\_data']['bookingpress\_form\_token'] ) : $bookingpress\_unique\_id; |
| [2776](#L2776) |  |
| [2777](#L2777) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [2778](#L2778) |  |
| [2779](#L2779) | $no\_appointment\_date\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_date\_selected\_for\_the\_booking', 'message\_setting'); |
| [2780](#L2780) |  |
| [2781](#L2781) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [2782](#L2782) |  |
| [2783](#L2783) | $no\_payment\_method\_is\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_payment\_method\_is\_selected\_for\_the\_booking', 'message\_setting'); |
| [2784](#L2784) |  |
| [2785](#L2785) | $duplicate\_email\_address\_found = $BookingPress->bookingpress\_get\_settings('duplicate\_email\_address\_found', 'message\_setting'); |
| [2786](#L2786) |  |
| [2787](#L2787) | $unsupported\_currecy\_selected\_for\_the\_payment = $BookingPress->bookingpress\_get\_settings('unsupported\_currecy\_selected\_for\_the\_payment', 'message\_setting'); |
| [2788](#L2788) |  |
| [2789](#L2789) | $duplidate\_appointment\_time\_slot\_found = $BookingPress->bookingpress\_get\_settings('duplidate\_appointment\_time\_slot\_found', 'message\_setting'); |
| [2790](#L2790) |  |
| [2791](#L2791) | $bookingpress\_service\_price = isset($\_REQUEST['appointment\_data']['service\_price\_without\_currency']) ? floatval($\_REQUEST['appointment\_data']['service\_price\_without\_currency']) : 0; |
| [2792](#L2792) |  |
| [2793](#L2793) | /\* server side validation \*/ |
| [2794](#L2794) | $all\_fields = $wpdb->get\_results( "SELECT bookingpress\_field\_error\_message,bookingpress\_form\_field\_name,bookingpress\_field\_is\_default FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_field\_required = 1 AND bookingpress\_field\_is\_hide = 0" ); //phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_form\_fields is a table name. false alarm |
| [2795](#L2795) |  |
| [2796](#L2796) | $field\_validation\_message = array(); |
| [2797](#L2797) | $is\_required\_validation = false; |
| [2798](#L2798) | if ( ! empty( $all\_fields ) ) { |
| [2799](#L2799) | foreach ( $all\_fields as $field\_data ) { |
| [2800](#L2800) |  |
| [2801](#L2801) | $field\_error\_msg = $field\_data->bookingpress\_field\_error\_message; |
| [2802](#L2802) |  |
| [2803](#L2803) | if( $field\_data->bookingpress\_field\_is\_default == 1 ){ |
| [2804](#L2804) |  |
| [2805](#L2805) | if( $field\_data->bookingpress\_form\_field\_name == 'firstname'){ |
| [2806](#L2806) | $bpa\_visible\_field\_key = 'customer\_firstname'; |
| [2807](#L2807) | } |
| [2808](#L2808) | if( $field\_data->bookingpress\_form\_field\_name == 'lastname'){ |
| [2809](#L2809) | $bpa\_visible\_field\_key = 'customer\_lastname'; |
| [2810](#L2810) | } |
| [2811](#L2811) | if( $field\_data->bookingpress\_form\_field\_name == 'email\_address'){ |
| [2812](#L2812) | $bpa\_visible\_field\_key = 'customer\_email'; |
| [2813](#L2813) | } |
| [2814](#L2814) | if( $field\_data->bookingpress\_form\_field\_name == 'note'){ |
| [2815](#L2815) | $bpa\_visible\_field\_key = 'appointment\_note'; |
| [2816](#L2816) | } |
| [2817](#L2817) | if( $field\_data->bookingpress\_form\_field\_name == 'phone\_number'){ |
| [2818](#L2818) | $bpa\_visible\_field\_key = 'customer\_phone'; |
| [2819](#L2819) | } |
| [2820](#L2820) | if( $field\_data->bookingpress\_form\_field\_name == 'fullname'){ |
| [2821](#L2821) | $bpa\_visible\_field\_key = 'customer\_name'; |
| [2822](#L2822) | } |
| [2823](#L2823) | if( $field\_data->bookingpress\_form\_field\_name == 'username'){ |
| [2824](#L2824) | $bpa\_visible\_field\_key = 'customer\_username'; |
| [2825](#L2825) | } |
| [2826](#L2826) | if( $field\_data->bookingpress\_form\_field\_name == 'terms\_and\_conditions'){ |
| [2827](#L2827) | $bpa\_visible\_field\_key = 'appointment\_terms\_conditions'; |
| [2828](#L2828) | } |
| [2829](#L2829) | } |
| [2830](#L2830) |  |
| [2831](#L2831) | $val = isset($\_POST['appointment\_data'][ $bpa\_visible\_field\_key ]) ? $\_POST['appointment\_data'][ $bpa\_visible\_field\_key ] : ''; //phpcs:ignore |
| [2832](#L2832) |  |
| [2833](#L2833) | if( $bpa\_visible\_field\_key == 'appointment\_terms\_conditions'){ |
| [2834](#L2834) |  |
| [2835](#L2835) | if( empty($val[0])){ |
| [2836](#L2836) | $is\_required\_validation = true; |
| [2837](#L2837) | $field\_validation\_message[] = $field\_error\_msg; |
| [2838](#L2838) | } |
| [2839](#L2839) | } else { |
| [2840](#L2840) | if( '' === $val ){ |
| [2841](#L2841) | $is\_required\_validation = true; |
| [2842](#L2842) | $field\_validation\_message[] = $field\_error\_msg; |
| [2843](#L2843) | } |
| [2844](#L2844) | } |
| [2845](#L2845) |  |
| [2846](#L2846) | } |
| [2847](#L2847) | } |
| [2848](#L2848) |  |
| [2849](#L2849) | if( true == $is\_required\_validation ){ |
| [2850](#L2850) | $response['variant'] = 'error'; |
| [2851](#L2851) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2852](#L2852) | $response['msg']     = !empty($field\_validation\_message) ? implode(' ', $field\_validation\_message) : array(); |
| [2853](#L2853) | return wp\_json\_encode($response); |
| [2854](#L2854) | } |
| [2855](#L2855) |  |
| [2856](#L2856) | if (empty($\_POST['appointment\_data']['selected\_service']) ) { |
| [2857](#L2857) | $response['variant'] = 'error'; |
| [2858](#L2858) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2859](#L2859) | $response['msg']     = esc\_html($no\_service\_selected\_for\_the\_booking); |
| [2860](#L2860) | return wp\_json\_encode($response); |
| [2861](#L2861) | } |
| [2862](#L2862) |  |
| [2863](#L2863) | if (empty($\_POST['appointment\_data']['selected\_date']) ) { |
| [2864](#L2864) | $response['variant'] = 'error'; |
| [2865](#L2865) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2866](#L2866) | $response['msg']     = esc\_html($no\_appointment\_date\_selected\_for\_the\_booking); |
| [2867](#L2867) | return wp\_json\_encode($response); |
| [2868](#L2868) | } |
| [2869](#L2869) |  |
| [2870](#L2870) | if (empty($\_POST['appointment\_data']['selected\_start\_time']) || empty($\_POST['appointment\_data']['selected\_end\_time']) ) { |
| [2871](#L2871) | $response['variant'] = 'error'; |
| [2872](#L2872) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2873](#L2873) | $response['msg']     = esc\_html($no\_appointment\_time\_selected\_for\_the\_booking); |
| [2874](#L2874) | return wp\_json\_encode($response); |
| [2875](#L2875) | } |
| [2876](#L2876) |  |
| [2877](#L2877) | if (empty($\_POST['appointment\_data']['selected\_payment\_method']) && $bookingpress\_service\_price > 0 ) { |
| [2878](#L2878) | $response['variant'] = 'error'; |
| [2879](#L2879) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2880](#L2880) | $response['msg']     = esc\_html($no\_payment\_method\_is\_selected\_for\_the\_booking); |
| [2881](#L2881) | return wp\_json\_encode($response); |
| [2882](#L2882) | } |
| [2883](#L2883) |  |
| [2884](#L2884) | $bookingpress\_fullname  = ! empty($\_POST['appointment\_data']['customer\_name']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_name'])) : ''; |
| [2885](#L2885) | $bookingpress\_firstname = ! empty($\_POST['appointment\_data']['customer\_firstname']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_firstname'])) : ''; |
| [2886](#L2886) | $bookingpress\_lastname  = ! empty($\_POST['appointment\_data']['customer\_lastname']) ? trim(sanitize\_text\_field($\_POST['appointment\_data']['customer\_lastname'])) : ''; |
| [2887](#L2887) | $bookingpress\_email     = ! empty($\_POST['appointment\_data']['customer\_email']) ? sanitize\_email($\_POST['appointment\_data']['customer\_email']) : ''; |
| [2888](#L2888) |  |
| [2889](#L2889) | if (strlen($bookingpress\_fullname) > 255 ) { |
| [2890](#L2890) | $response['variant'] = 'error'; |
| [2891](#L2891) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2892](#L2892) | $response['msg']     = esc\_html\_\_('Fullname is too long...', 'bookingpress-appointment-booking'); |
| [2893](#L2893) | return wp\_json\_encode($response); |
| [2894](#L2894) | } |
| [2895](#L2895) | if (strlen($bookingpress\_firstname) > 255 ) { |
| [2896](#L2896) | $response['variant'] = 'error'; |
| [2897](#L2897) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2898](#L2898) | $response['msg']     = esc\_html\_\_('Firstname is too long...', 'bookingpress-appointment-booking'); |
| [2899](#L2899) | return wp\_json\_encode($response); |
| [2900](#L2900) | } |
| [2901](#L2901) | if (strlen($bookingpress\_lastname) > 255 ) { |
| [2902](#L2902) | $response['variant'] = 'error'; |
| [2903](#L2903) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2904](#L2904) | $response['msg']     = esc\_html\_\_('Lastname is too long...', 'bookingpress-appointment-booking'); |
| [2905](#L2905) | return wp\_json\_encode($response); |
| [2906](#L2906) | } |
| [2907](#L2907) | if (strlen($bookingpress\_email) > 255 ) { |
| [2908](#L2908) | $response['variant'] = 'error'; |
| [2909](#L2909) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2910](#L2910) | $response['msg']     = esc\_html\_\_('Email address is too long...', 'bookingpress-appointment-booking'); |
| [2911](#L2911) | return wp\_json\_encode($response); |
| [2912](#L2912) | } |
| [2913](#L2913) | $bookingpress\_selected\_payment\_method = sanitize\_text\_field($\_POST['appointment\_data']['selected\_payment\_method']); |
| [2914](#L2914) | $bookingpress\_currency\_name           = $BookingPress->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [2915](#L2915) |  |
| [2916](#L2916) | $bookingpress\_paypal\_currency = $bookingpress\_payment\_gateways->bookingpress\_paypal\_supported\_currency\_list(); |
| [2917](#L2917) | if ($bookingpress\_selected\_payment\_method == 'paypal' && !in\_array($bookingpress\_currency\_name,$bookingpress\_paypal\_currency ) ) { |
| [2918](#L2918) |  |
| [2919](#L2919) | $response['variant'] = 'error'; |
| [2920](#L2920) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2921](#L2921) | $response['msg']     = esc\_html($unsupported\_currecy\_selected\_for\_the\_payment); |
| [2922](#L2922) | return wp\_json\_encode($response); |
| [2923](#L2923) | } |
| [2924](#L2924) |  |
| [2925](#L2925) | $appointment\_service\_id    = intval($\_POST['appointment\_data']['selected\_service']); |
| [2926](#L2926) | $appointment\_selected\_date = date('Y-m-d', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_date']))); |
| [2927](#L2927) | $appointment\_start\_time    = date('H:i:s', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_start\_time']))); |
| [2928](#L2928) | $appointment\_end\_time      = date('H:i:s', strtotime(sanitize\_text\_field($\_POST['appointment\_data']['selected\_end\_time']))); |
| [2929](#L2929) |  |
| [2930](#L2930) | $is\_appointment\_exists = $BookingPress->bookingpress\_is\_appointment\_booked($appointment\_service\_id, $appointment\_selected\_date, $appointment\_start\_time, $appointment\_end\_time); |
| [2931](#L2931) | if ($is\_appointment\_exists) { |
| [2932](#L2932) | $response['variant']              = 'error'; |
| [2933](#L2933) | $response['title']                = 'Error'; |
| [2934](#L2934) | $response['msg']                  = esc\_html($duplidate\_appointment\_time\_slot\_found); |
| [2935](#L2935) | return wp\_json\_encode($response); |
| [2936](#L2936) | } |
| [2937](#L2937) |  |
| [2938](#L2938) | // If selected date is day off then display error. |
| [2939](#L2939) | $bookingpress\_search\_query              = preg\_quote($appointment\_selected\_date, '~'); |
| [2940](#L2940) | $bookingpress\_get\_default\_daysoff\_dates = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [2941](#L2941) | $bookingpress\_search\_date               = preg\_grep('~' . $bookingpress\_search\_query . '~', $bookingpress\_get\_default\_daysoff\_dates); |
| [2942](#L2942) | if (! empty($bookingpress\_search\_date) ) { |
| [2943](#L2943) | $booking\_dayoff\_msg     = esc\_html\_\_('Selected date is off day', 'bookingpress-appointment-booking'); |
| [2944](#L2944) | $booking\_dayoff\_msg    .= '. ' . esc\_html\_\_('So please select new date', 'bookingpress-appointment-booking') . '.'; |
| [2945](#L2945) | $response['error\_type'] = 'dayoff'; |
| [2946](#L2946) | $response['variant']    = 'error'; |
| [2947](#L2947) | $response['title']      = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2948](#L2948) | $response['msg']        = $booking\_dayoff\_msg; |
| [2949](#L2949) | return wp\_json\_encode($response); |
| [2950](#L2950) | } |
| [2951](#L2951) |  |
| [2952](#L2952) | // If payment gateway is disable then return error |
| [2953](#L2953) | if ($bookingpress\_selected\_payment\_method == 'on-site' && $bookingpress\_service\_price > 0 ) { |
| [2954](#L2954) | $on\_site\_payment = $BookingPress->bookingpress\_get\_settings('on\_site\_payment', 'payment\_setting'); |
| [2955](#L2955) | if (empty($on\_site\_payment) || ( $on\_site\_payment == 'false' ) ) { |
| [2956](#L2956) | $response['variant'] = 'error'; |
| [2957](#L2957) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2958](#L2958) | $response['msg']     = esc\_html\_\_('On site payment gateway is not active', 'bookingpress-appointment-booking') . '.'; |
| [2959](#L2959) | return wp\_json\_encode($response); |
| [2960](#L2960) | } |
| [2961](#L2961) | } elseif ( $bookingpress\_selected\_payment\_method == 'paypal' && $bookingpress\_service\_price > 0 ) { |
| [2962](#L2962) | $paypal\_payment = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [2963](#L2963) | if (empty($paypal\_payment) || ( $paypal\_payment == 'false' ) ) { |
| [2964](#L2964) | $response['variant'] = 'error'; |
| [2965](#L2965) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2966](#L2966) | $response['msg']     = esc\_html\_\_('PayPal payment gateway is not active', 'bookingpress-appointment-booking') . '.'; |
| [2967](#L2967) | return wp\_json\_encode($response); |
| [2968](#L2968) | } |
| [2969](#L2969) |  |
| [2970](#L2970) | if ($bookingpress\_service\_price < floatval('0.1') ) { |
| [2971](#L2971) | $response['variant'] = 'error'; |
| [2972](#L2972) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [2973](#L2973) | $response['msg']     = esc\_html\_\_('Paypal supports minimum amount 0.1', 'bookingpress-appointment-booking'); |
| [2974](#L2974) | return wp\_json\_encode($response); |
| [2975](#L2975) | } |
| [2976](#L2976) | } |
| [2977](#L2977) |  |
| [2978](#L2978) | $bpa\_front\_timings\_key = 'bpa\_front\_timings\_' .$bookingpress\_form\_token.'\_'.$appointment\_selected\_date; |
| [2979](#L2979) |  |
| [2980](#L2980) | $bpa\_front\_timings\_data = $this->bookingpress\_get\_transient( $bpa\_front\_timings\_key ); |
| [2981](#L2981) |  |
| [2982](#L2982) | // double confirm the timings |
| [2983](#L2983) | $timings = array\_values($bpa\_front\_timings\_data); |
| [2984](#L2984) |  |
| [2985](#L2985) | $appointment\_start\_time = date('H:i',strtotime($appointment\_start\_time)); |
| [2986](#L2986) | $appointment\_end\_time = $appointment\_end\_time != '00:00:00' ? date('H:i',strtotime($appointment\_end\_time)) : '24:00'; |
| [2987](#L2987) | $time\_slot\_start\_key = array\_search($appointment\_start\_time, array\_column( $timings, 'store\_start\_time' ) ); |
| [2988](#L2988) | $time\_slot\_end\_key = array\_search( $appointment\_end\_time, array\_column( $timings, 'store\_end\_time' ) ); |
| [2989](#L2989) | if( ( trim($time\_slot\_start\_key) === '' || trim($time\_slot\_end\_key) === '' || trim($time\_slot\_start\_key) != trim($time\_slot\_end\_key) ) && 'd' != $posted\_data['appointment\_data']['selected\_service\_duration\_unit'] ){ |
| [2990](#L2990) | $response['variant']              = 'error'; |
| [2991](#L2991) | $response['title']                = 'Error'; |
| [2992](#L2992) | $response['msg']                  = esc\_html\_\_("Sorry, Booking can not be done as booking time is different than selected timeslot", "bookingpress-appointment-booking"); |
| [2993](#L2993) | return wp\_json\_encode($response); |
| [2994](#L2994) | } |
| [2995](#L2995) |  |
| [2996](#L2996) | do\_action('bookingpress\_validate\_booking\_form', $\_POST); |
| [2997](#L2997) |  |
| [2998](#L2998) | } |
| [2999](#L2999) |  |
| [3000](#L3000) | /\*\* |
| [3001](#L3001) | \* Cancel appointment from customer cancel link |
| [3002](#L3002) | \* @deprecated on 07th March 2023 |
| [3003](#L3003) | \* |
| [3004](#L3004) | \* @return void |
| [3005](#L3005) | \*/ |
| [3006](#L3006) | function bookingpress\_cancel\_appointment\_func() |
| [3007](#L3007) | { |
| [3008](#L3008) | if( !empty($\_SERVER["HTTP\_USER\_AGENT"]) && $\_SERVER["HTTP\_USER\_AGENT"] == 'WhatsApp' ){ |
| [3009](#L3009) | return; |
| [3010](#L3010) | } |
| [3011](#L3011) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications, $bookingpress\_services; |
| [3012](#L3012) | $cancel\_id    = ! empty($\_REQUEST['bpa\_cancel']) ? intval(base64\_decode($\_REQUEST['bpa\_cancel'])) : 0; // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_REQUEST['bpa\_cancel'] is sanitized properly |
| [3013](#L3013) | $cancel\_token = ! empty($\_REQUEST['cancel\_id']) ? sanitize\_text\_field($\_REQUEST['cancel\_id']) : ''; |
| [3014](#L3014) |  |
| [3015](#L3015) | if (! empty($cancel\_id) && ! empty($cancel\_token) ) { |
| [3016](#L3016) |  |
| [3017](#L3017) | $bookingpress\_appointment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_customer\_email,bookingpress\_service\_id,bookingpress\_appointment\_date,bookingpress\_appointment\_time,bookingpress\_customer\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d AND bookingpress\_appointment\_token = %s", $cancel\_id,$cancel\_token), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_log\_data is table name defined globally. False Positive alarm |
| [3018](#L3018) |  |
| [3019](#L3019) | if (! empty($bookingpress\_appointment\_log\_data) ) { |
| [3020](#L3020) |  |
| [3021](#L3021) | $bookingpress\_appointment\_date = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_date']; |
| [3022](#L3022) | $bookingpress\_appointment\_time = $bookingpress\_appointment\_log\_data['bookingpress\_appointment\_time']; |
| [3023](#L3023) | $bookingpress\_appointment\_datetime = $bookingpress\_appointment\_date." ".$bookingpress\_appointment\_time; |
| [3024](#L3024) | $bookingpress\_service\_id = $bookingpress\_appointment\_log\_data['bookingpress\_service\_id']; |
| [3025](#L3025) | $current\_datetime = date( 'Y-m-d H:i:s', current\_time('timestamp') ); |
| [3026](#L3026) |  |
| [3027](#L3027) | $allow\_cancel\_appointment = true; |
| [3028](#L3028) | if( $bookingpress\_appointment\_datetime <= $current\_datetime ){ |
| [3029](#L3029) | $allow\_cancel\_appointment = false; |
| [3030](#L3030) | } |
| [3031](#L3031) |  |
| [3032](#L3032) | if($allow\_cancel\_appointment == true){ |
| [3033](#L3033) | $bookingpress\_min\_time\_before\_cancel = $BookingPress->bookingpress\_get\_settings('default\_minimum\_time\_for\_canceling', 'general\_setting'); |
| [3034](#L3034) |  |
| [3035](#L3035) | //Check service level minimum time required before cancel |
| [3036](#L3036) | $bookingpress\_service\_min\_time\_require\_before\_cancel = $bookingpress\_services->bookingpress\_get\_service\_meta($bookingpress\_service\_id, 'minimum\_time\_required\_before\_cancelling'); |
| [3037](#L3037) | if(!empty($bookingpress\_service\_min\_time\_require\_before\_cancel)){ |
| [3038](#L3038) | if($bookingpress\_service\_min\_time\_require\_before\_cancel == 'disabled'){ |
| [3039](#L3039) | $bookingpress\_min\_time\_before\_cancel = 'disabled'; |
| [3040](#L3040) | }else if($bookingpress\_service\_min\_time\_require\_before\_cancel != 'inherit'){ |
| [3041](#L3041) | $bookingpress\_min\_time\_before\_cancel = $bookingpress\_service\_min\_time\_require\_before\_cancel; |
| [3042](#L3042) | } |
| [3043](#L3043) | } |
| [3044](#L3044) |  |
| [3045](#L3045) | //Check minimum cancel time |
| [3046](#L3046) | if($allow\_cancel\_appointment && !empty($bookingpress\_min\_time\_before\_cancel) && $bookingpress\_min\_time\_before\_cancel != 'disabled'){ |
| [3047](#L3047) | $bookingpress\_from\_time = current\_time('timestamp'); |
| [3048](#L3048) | $bookingpress\_to\_time = strtotime($bookingpress\_appointment\_datetime); |
| [3049](#L3049) | $bookingpress\_time\_diff\_for\_cancel = round(abs($bookingpress\_to\_time - $bookingpress\_from\_time) / 60, 2); |
| [3050](#L3050) |  |
| [3051](#L3051) | if($bookingpress\_time\_diff\_for\_cancel < $bookingpress\_min\_time\_before\_cancel){ |
| [3052](#L3052) | $allow\_cancel\_appointment = false; |
| [3053](#L3053) | } |
| [3054](#L3054) | } |
| [3055](#L3055) | } |
| [3056](#L3056) |  |
| [3057](#L3057) | if($allow\_cancel\_appointment){ |
| [3058](#L3058) | $bookingress\_customer\_email = $bookingpress\_appointment\_log\_data['bookingpress\_customer\_email']; |
| [3059](#L3059) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [3060](#L3060) | $bookingpress\_after\_canceled\_payment\_url     = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [3061](#L3061) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [3062](#L3062) |  |
| [3063](#L3063) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $cancel\_id )); |
| [3064](#L3064) |  |
| [3065](#L3065) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $cancel\_id, $bookingress\_customer\_email); |
| [3066](#L3066) |  |
| [3067](#L3067) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings,array('bookingpress\_appointment\_token' => ''),array('bookingpress\_appointment\_booking\_id' => $cancel\_id)); |
| [3068](#L3068) |  |
| [3069](#L3069) | do\_action('bookingpress\_after\_cancel\_appointment', $cancel\_id); |
| [3070](#L3070) |  |
| [3071](#L3071) | wp\_redirect($bookingpress\_after\_canceled\_payment\_url); |
| [3072](#L3072) |  |
| [3073](#L3073) | }else{ |
| [3074](#L3074) | $bookingpress\_alert\_msg = esc\_html\_\_("We're sorry! you can't cancel this appointment because minimum required time for cancellation is already passed", "bookingpress-appointment-booking"); |
| [3075](#L3075) |  |
| [3076](#L3076) | $bookingpress\_alert\_script = "<script>"; |
| [3077](#L3077) | $bookingpress\_alert\_script .= "alert('".$bookingpress\_alert\_msg."')"; |
| [3078](#L3078) | $bookingpress\_alert\_script .= "</script>"; |
| [3079](#L3079) |  |
| [3080](#L3080) | echo $bookingpress\_alert\_script; // phpcs:ignore |
| [3081](#L3081) | } |
| [3082](#L3082) | } |
| [3083](#L3083) | } |
| [3084](#L3084) | } |
| [3085](#L3085) |  |
| [3086](#L3086) | /\*\* |
| [3087](#L3087) | \* Cancel appointment from ajax request |
| [3088](#L3088) | \* |
| [3089](#L3089) | \* @return void |
| [3090](#L3090) | \*/ |
| [3091](#L3091) | function bookingpress\_cancel\_appointment($return\_data = false,$user\_id = "") |
| [3092](#L3092) | { |
| [3093](#L3093) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_payment\_logs, $bookingpress\_email\_notifications; |
| [3094](#L3094) | $response              = array(); |
| [3095](#L3095) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [3096](#L3096) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [3097](#L3097) | if (! $bpa\_verify\_nonce\_flag ) { |
| [3098](#L3098) | $response['variant']      = 'error'; |
| [3099](#L3099) | $response['title']        = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3100](#L3100) | $response['msg']          = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [3101](#L3101) | $response['redirect\_url'] = ''; |
| [3102](#L3102) | if($return\_data){ |
| [3103](#L3103) | return $response; |
| [3104](#L3104) | } |
| [3105](#L3105) | wp\_send\_json($response); |
| [3106](#L3106) | die(); |
| [3107](#L3107) | } |
| [3108](#L3108) |  |
| [3109](#L3109) | $response['variant'] = 'error'; |
| [3110](#L3110) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3111](#L3111) | $response['msg']     = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [3112](#L3112) |  |
| [3113](#L3113) | $appointment\_cancelled\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_cancelled\_successfully', 'message\_setting'); |
| [3114](#L3114) | $cancel\_id                          = ! empty($\_REQUEST['cancel\_id']) ? intval($\_REQUEST['cancel\_id']) : 0; |
| [3115](#L3115) |  |
| [3116](#L3116) | $allow\_cancel\_appointment = $this->bookingpress\_check\_cancel\_appointment\_permission\_func( $cancel\_id,$user\_id ); |
| [3117](#L3117) |  |
| [3118](#L3118) | if (! empty($cancel\_id) && true == $allow\_cancel\_appointment ) { |
| [3119](#L3119) |  |
| [3120](#L3120) | $bookingpress\_after\_canceled\_payment\_page\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_cancelled\_appointment\_redirection', 'booking\_my\_booking'); |
| [3121](#L3121) | $bookingpress\_after\_canceled\_payment\_url = get\_permalink($bookingpress\_after\_canceled\_payment\_page\_id); |
| [3122](#L3122) |  |
| [3123](#L3123) | $bookingpress\_after\_canceled\_payment\_url = ! empty($bookingpress\_after\_canceled\_payment\_url) ? $bookingpress\_after\_canceled\_payment\_url : BOOKINGPRESS\_HOME\_URL; |
| [3124](#L3124) |  |
| [3125](#L3125) | $response['variant']      = 'success'; |
| [3126](#L3126) | $response['title']        = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [3127](#L3127) | $response['msg']          = esc\_html($appointment\_cancelled\_successfully); |
| [3128](#L3128) | $response['redirect\_url'] = $bookingpress\_after\_canceled\_payment\_url; |
| [3129](#L3129) |  |
| [3130](#L3130) |  |
| [3131](#L3131) | $response = apply\_filters('bookingpress\_refund\_process\_before\_cancel\_appointment',$response,$cancel\_id); |
| [3132](#L3132) |  |
| [3133](#L3133) | if($response['variant'] == 'success' ) { |
| [3134](#L3134) | $wpdb->update($tbl\_bookingpress\_appointment\_bookings, array( 'bookingpress\_appointment\_status' => '3' ), array( 'bookingpress\_appointment\_booking\_id' => $cancel\_id )); |
| [3135](#L3135) |  |
| [3136](#L3136) | do\_action('bookingpress\_after\_cancel\_appointment\_without\_check\_payment', $cancel\_id); |
| [3137](#L3137) | // Get payment log id and insert canceled appointment entry |
| [3138](#L3138) | $payment\_log\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_payment\_logs} WHERE bookingpress\_appointment\_booking\_ref = %d", $cancel\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_payment\_logs is table name defined globally. False Positive alarm |
| [3139](#L3139) |  |
| [3140](#L3140) | if (! empty($payment\_log\_data) ) { |
| [3141](#L3141) | $bookingress\_customer\_email = $payment\_log\_data['bookingpress\_customer\_email']; |
| [3142](#L3142) |  |
| [3143](#L3143) | $bookingpress\_email\_notifications->bookingpress\_send\_after\_payment\_log\_entry\_email\_notification('Appointment Canceled', $cancel\_id, $bookingress\_customer\_email); |
| [3144](#L3144) |  |
| [3145](#L3145) | do\_action('bookingpress\_after\_cancel\_appointment', $cancel\_id); |
| [3146](#L3146) | } |
| [3147](#L3147) | } |
| [3148](#L3148) | } |
| [3149](#L3149) | if($return\_data){ |
| [3150](#L3150) | return $response; |
| [3151](#L3151) | } |
| [3152](#L3152) | echo wp\_json\_encode($response); |
| [3153](#L3153) | exit(); |
| [3154](#L3154) | } |
| [3155](#L3155) |  |
| [3156](#L3156) | /\*\* |
| [3157](#L3157) | \* My appointment shortcode callback function |
| [3158](#L3158) | \* |
| [3159](#L3159) | \* @param  mixed $atts |
| [3160](#L3160) | \* @param  mixed $content |
| [3161](#L3161) | \* @param  mixed $tag |
| [3162](#L3162) | \* @return void |
| [3163](#L3163) | \*/ |
| [3164](#L3164) | function bookingpress\_my\_appointments\_func( $atts, $content, $tag ) |
| [3165](#L3165) | { |
| [3166](#L3166) |  |
| [3167](#L3167) | global $wpdb, $BookingPress,$bookingpress\_global\_options; |
| [3168](#L3168) |  |
| [3169](#L3169) | $this->bookingpress\_mybooking\_login\_user\_id = get\_current\_user\_id(); |
| [3170](#L3170) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3171](#L3171) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format']; |
| [3172](#L3172) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [3173](#L3173) | if ($bookingpress\_default\_date\_time\_format == 'F j, Y' ) { |
| [3174](#L3174) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [3175](#L3175) | } elseif ($bookingpress\_default\_date\_time\_format == 'Y-m-d' ) { |
| [3176](#L3176) | $bookingpress\_default\_date\_format = 'YYYY-MM-DD'; |
| [3177](#L3177) | } elseif ($bookingpress\_default\_date\_time\_format == 'm/d/Y' ) { |
| [3178](#L3178) | $bookingpress\_default\_date\_format = 'MM/DD/YYYY'; |
| [3179](#L3179) | } elseif($bookingpress\_default\_date\_time\_format == 'd/m/Y') { |
| [3180](#L3180) | $bookingpress\_default\_date\_format = 'DD/MM/YYYY'; |
| [3181](#L3181) | } elseif ($bookingpress\_default\_date\_time\_format == 'd.m.Y') { |
| [3182](#L3182) | $bookingpress\_default\_date\_format = 'DD.MM.YYYY'; |
| [3183](#L3183) | } elseif ($bookingpress\_default\_date\_time\_format == 'd-m-Y') { |
| [3184](#L3184) | $bookingpress\_default\_date\_format = 'DD-MM-YYYY'; |
| [3185](#L3185) | } |
| [3186](#L3186) |  |
| [3187](#L3187) | $this->bookingpress\_mybooking\_default\_date\_format = $bookingpress\_default\_date\_format; |
| [3188](#L3188) |  |
| [3189](#L3189) | $BookingPress->set\_front\_css(1); |
| [3190](#L3190) | $BookingPress->set\_front\_js(1); |
| [3191](#L3191) | $BookingPress->bookingpress\_load\_mybooking\_custom\_css(); |
| [3192](#L3192) | // $BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [3193](#L3193) |  |
| [3194](#L3194) | $bookingpress\_uniq\_id = uniqid(); |
| [3195](#L3195) | ob\_start(); |
| [3196](#L3196) | $bookingpress\_my\_appointments\_file\_url = BOOKINGPRESS\_VIEWS\_DIR . '/frontend/appointment\_my\_appointments.php'; |
| [3197](#L3197) | $bookingpress\_my\_appointments\_file\_url = apply\_filters('bookingpress\_change\_my\_appointmens\_shortcode\_file\_url', $bookingpress\_my\_appointments\_file\_url); |
| [3198](#L3198) | include $bookingpress\_my\_appointments\_file\_url; |
| [3199](#L3199) | $content .= ob\_get\_clean(); |
| [3200](#L3200) |  |
| [3201](#L3201) | add\_action( |
| [3202](#L3202) | 'wp\_footer', |
| [3203](#L3203) | function () use ( &$bookingpress\_uniq\_id ) { |
| [3204](#L3204) | global $bookingpress\_global\_options , $BookingPress; |
| [3205](#L3205) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3206](#L3206) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [3207](#L3207) | $requested\_module                = 'front\_appointments'; |
| [3208](#L3208) | ?> |
| [3209](#L3209) | <script data-cfasync="false"> |
| [3210](#L3210) | window.addEventListener('DOMContentLoaded', function() { |
| [3211](#L3211) | var bookingpress\_start\_of\_week = '<?php echo esc\_html($bookingpress\_global\_details['start\_of\_week']); ?>'; |
| [3212](#L3212) | var bpa\_customer\_username = '<?php echo esc\_html($this->bookingpress\_mybooking\_customer\_email); ?>'; |
| [3213](#L3213) | var bpa\_customer\_email = '<?php echo esc\_html($this->bookingpress\_mybooking\_customer\_email); ?>'; |
| [3214](#L3214) | var bpa\_customer\_id = '<?php echo esc\_html($this->bookingpress\_mybooking\_wpuser\_id); ?>'; |
| [3215](#L3215) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_helper\_vars'); ?> |
| [3216](#L3216) | var app = new Vue({ |
| [3217](#L3217) | el: '#bookingpress\_booking\_form\_<?php echo esc\_html($bookingpress\_uniq\_id); ?>', |
| [3218](#L3218) | directives: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_directives'); ?> }, |
| [3219](#L3219) | components: { <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_components'); ?> }, |
| [3220](#L3220) | data() { |
| [3221](#L3221) | var bookingpress\_return\_data = <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_data\_fields'); ?>; |
| [3222](#L3222) | bookingpress\_return\_data['is\_display\_loader'] = '0'; |
| [3223](#L3223) | bookingpress\_return\_data['bookingpress\_uniq\_id'] = '<?php echo esc\_html($bookingpress\_uniq\_id); ?>'; |
| [3224](#L3224) | bookingpress\_return\_data['pickerOptions'] = |
| [3225](#L3225) | { |
| [3226](#L3226) | disabledDate(Time) |
| [3227](#L3227) | { |
| [3228](#L3228) | var dd = String(Time.getDate()).padStart(2, '0'); |
| [3229](#L3229) | var mm = String(Time.getMonth() + 1).padStart(2, '0'); /\* January is 0! \*/ |
| [3230](#L3230) | var yyyy = Time.getFullYear(); |
| [3231](#L3231) | var time = yyyy+ '-' + mm + '-' + dd; |
| [3232](#L3232) | if( "undefined" == typeof bookingpress\_return\_data['disabledDates'].indexOf ){ |
| [3233](#L3233) | var date = new Date(); |
| [3234](#L3234) | var newDateArr = []; |
| [3235](#L3235) | for( let dcount in bookingpress\_return\_data['disabledDates'] ){ |
| [3236](#L3236) | let dis\_date = bookingpress\_return\_data['disabledDates'][dcount]; |
| [3237](#L3237) | newDateArr.push( dis\_date ); |
| [3238](#L3238) | } |
| [3239](#L3239) | var disable\_date = newDateArr.indexOf( time ) > -1; |
| [3240](#L3240) | var date = new Date(); |
| [3241](#L3241) | date.setDate(date.getDate()-1); |
| [3242](#L3242) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [3243](#L3243) | if(disable\_date == true) { |
| [3244](#L3244) | return disable\_date; |
| [3245](#L3245) | } else { |
| [3246](#L3246) | return disable\_past\_date; |
| [3247](#L3247) | } |
| [3248](#L3248) | } else { |
| [3249](#L3249) | var disable\_date= bookingpress\_return\_data['disabledDates'].indexOf(time)>-1; |
| [3250](#L3250) | var date = new Date(); |
| [3251](#L3251) | date.setDate(date.getDate()-1); |
| [3252](#L3252) | var disable\_past\_date = Time.getTime() < date.getTime(); |
| [3253](#L3253) | if(disable\_date == true) { |
| [3254](#L3254) | return disable\_date; |
| [3255](#L3255) | } else { |
| [3256](#L3256) | return disable\_past\_date; |
| [3257](#L3257) | } |
| [3258](#L3258) | } |
| [3259](#L3259) | }, |
| [3260](#L3260) | }; |
| [3261](#L3261) | bookingpress\_return\_data['filter\_pickerOptions'] = { |
| [3262](#L3262) | 'firstDayOfWeek': parseInt(bookingpress\_start\_of\_week), |
| [3263](#L3263) | }; |
| [3264](#L3264) | return bookingpress\_return\_data; |
| [3265](#L3265) | }, |
| [3266](#L3266) | filters:{ |
| [3267](#L3267) | bookingpress\_format\_date: function(value){ |
| [3268](#L3268) | var default\_date\_format = '<?php echo esc\_html($this->bookingpress\_mybooking\_default\_date\_format); ?>'; |
| [3269](#L3269) | <?php $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); ?> |
| [3270](#L3270) | return moment(String(value)).locale('<?php echo esc\_html($bookingpress\_site\_current\_lang\_moment\_locale); ?>').format(default\_date\_format); |
| [3271](#L3271) | }, |
| [3272](#L3272) | bookingpress\_format\_time: function(value){ |
| [3273](#L3273) | var default\_time\_format = '<?php echo esc\_html($bookingpress\_formatted\_timeslot); ?>'; |
| [3274](#L3274) | <?php $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); ?> |
| [3275](#L3275) | return moment(String(value), "HH:mm:ss").locale('<?php echo esc\_html($bookingpress\_site\_current\_lang\_moment\_locale); ?>').format(default\_time\_format) |
| [3276](#L3276) | } |
| [3277](#L3277) | }, |
| [3278](#L3278) | beforeCreate(){ |
| [3279](#L3279) | this.is\_front\_appointment\_empty\_loader = '1'; |
| [3280](#L3280) | }, |
| [3281](#L3281) | created(){ |
| [3282](#L3282) | }, |
| [3283](#L3283) | mounted() { |
| [3284](#L3284) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_on\_load\_methods'); ?> |
| [3285](#L3285) | }, |
| [3286](#L3286) | methods: { |
| [3287](#L3287) | <?php do\_action('bookingpress\_' . $requested\_module . '\_dynamic\_vue\_methods'); ?> |
| [3288](#L3288) | }, |
| [3289](#L3289) | }); |
| [3290](#L3290) | }); |
| [3291](#L3291) | </script> |
| [3292](#L3292) | <?php |
| [3293](#L3293) | }, |
| [3294](#L3294) | 100 |
| [3295](#L3295) | ); |
| [3296](#L3296) |  |
| [3297](#L3297) | $bookingress\_load\_js\_css\_all\_pages = $BookingPress->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [3298](#L3298) |  |
| [3299](#L3299) | if($bookingress\_load\_js\_css\_all\_pages != 'true' ) { |
| [3300](#L3300) |  |
| [3301](#L3301) | $bookingpress\_custom\_css = $BookingPress->bookingpress\_get\_customize\_settings('custom\_css', 'booking\_form'); |
| [3302](#L3302) | $bookingpress\_custom\_css = !empty($bookingpress\_custom\_css) ? stripslashes\_deep($bookingpress\_custom\_css) : ''; |
| [3303](#L3303) | wp\_add\_inline\_style( 'bookingpress\_front\_mybookings\_custom\_css', $bookingpress\_custom\_css, 'after' ); |
| [3304](#L3304) |  |
| [3305](#L3305) | } |
| [3306](#L3306) | return do\_shortcode($content); |
| [3307](#L3307) | } |
| [3308](#L3308) |  |
| [3309](#L3309) | /\*\* |
| [3310](#L3310) | \* Get customers my appointments list |
| [3311](#L3311) | \* |
| [3312](#L3312) | \* @return void |
| [3313](#L3313) | \*/ |
| [3314](#L3314) | function bookingpress\_get\_customer\_appointments\_func($return\_data = false, $user\_id = "") |
| [3315](#L3315) | { |
| [3316](#L3316) | global $BookingPress,$wpdb,$tbl\_bookingpress\_appointment\_bookings,$tbl\_bookingpress\_customers,$bookingpress\_global\_options, $tbl\_bookingpress\_payment\_logs; |
| [3317](#L3317) | $response              = array(); |
| [3318](#L3318) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [3319](#L3319) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [3320](#L3320) | if (! $bpa\_verify\_nonce\_flag ) { |
| [3321](#L3321) | $response['variant'] = 'error'; |
| [3322](#L3322) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [3323](#L3323) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [3324](#L3324) | if($return\_data){ |
| [3325](#L3325) | return $response; |
| [3326](#L3326) | } |
| [3327](#L3327) | wp\_send\_json($response); |
| [3328](#L3328) | die(); |
| [3329](#L3329) | } |
| [3330](#L3330) | $bpa\_login\_customer\_id             = get\_current\_user\_id(); |
| [3331](#L3331) | if(!empty($user\_id)){ |
| [3332](#L3332) | $bpa\_login\_customer\_id = $user\_id; |
| [3333](#L3333) | } |
| [3334](#L3334) |  |
| [3335](#L3335) | $bookingpress\_get\_customer\_details = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id =%d AND bookingpress\_user\_status = 1 ORDER BY bookingpress\_customer\_id DESC", $bpa\_login\_customer\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [3336](#L3336) | $bookingpress\_current\_user\_id      = ! empty($bookingpress\_get\_customer\_details['bookingpress\_customer\_id']) ? $bookingpress\_get\_customer\_details['bookingpress\_customer\_id'] : 0; |
| [3337](#L3337) | $bookingpress\_customer\_data = $appointments\_data = array(); |
| [3338](#L3338) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = ''; |
| [3339](#L3339) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = ''; |
| [3340](#L3340) | $bookingpress\_customer\_data['bookingpress\_avatar\_url'] = BOOKINGPRESS\_IMAGES\_URL . '/default-avatar.jpg'; |
| [3341](#L3341) |  |
| [3342](#L3342) | if(empty($bookingpress\_current\_user\_id) && (is\_user\_logged\_in() || !empty($user\_id))) { |
| [3343](#L3343) |  |
| [3344](#L3344) | $bookingpress\_current\_user\_obj = wp\_get\_current\_user(); |
| [3345](#L3345) | if(!empty($user\_id)){ |
| [3346](#L3346) | $bookingpress\_current\_user\_obj = get\_user\_by('id', $user\_id); |
| [3347](#L3347) | } |
| [3348](#L3348) | $bookingpress\_customer\_name  = ! empty($bookingpress\_current\_user\_obj->data->user\_login) ? $bookingpress\_current\_user\_obj->data->user\_login : ''; |
| [3349](#L3349) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [3350](#L3350) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = stripslashes\_deep($bookingpress\_customer\_email); |
| [3351](#L3351) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [3352](#L3352) | } |
| [3353](#L3353) |  |
| [3354](#L3354) | $bookingpress\_total\_appointments = 0; |
| [3355](#L3355) |  |
| [3356](#L3356) | $perpage     = isset($\_POST['perpage']) ? intval($\_POST['perpage']) : 10; |
| [3357](#L3357) | $currentpage = isset($\_POST['currentpage']) ? intval($\_POST['currentpage']) : 1; |
| [3358](#L3358) | $offset      = ( ! empty($currentpage) && $currentpage > 1 ) ? ( ( $currentpage - 1 ) \* $perpage ) : 0; |
| [3359](#L3359) |  |
| [3360](#L3360) | if (! empty($bookingpress\_current\_user\_id) ) { |
| [3361](#L3361) | $bpa\_customer\_firstname = ! empty($bookingpress\_get\_customer\_details['bookingpress\_user\_firstname']) ? stripslashes\_deep($bookingpress\_get\_customer\_details['bookingpress\_user\_firstname']) : ''; |
| [3362](#L3362) | $bpa\_customer\_lastname = ! empty($bookingpress\_get\_customer\_details['bookingpress\_user\_lastname']) ? stripslashes\_deep($bookingpress\_get\_customer\_details['bookingpress\_user\_lastname']) : ''; |
| [3363](#L3363) | $bookingpress\_user\_fullname = $bpa\_customer\_firstname.' '.$bpa\_customer\_lastname ; |
| [3364](#L3364) | if( is\_user\_logged\_in() ){ |
| [3365](#L3365) | if( is\_user\_logged\_in() ){ |
| [3366](#L3366) | $bookingpress\_current\_user\_obj = wp\_get\_current\_user(); |
| [3367](#L3367) |  |
| [3368](#L3368) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [3369](#L3369) | $bookingpress\_user\_email = stripslashes\_deep($bookingpress\_customer\_email); |
| [3370](#L3370) | } |
| [3371](#L3371) | } else { |
| [3372](#L3372) | $bookingpress\_user\_email = ! empty( $bookingpress\_get\_customer\_details['bookingpress\_user\_email'] ) ? sanitize\_email( $bookingpress\_get\_customer\_details['bookingpress\_user\_email'] ) : ''; |
| [3373](#L3373) | } |
| [3374](#L3374) | $bpa\_avatar\_url = get\_avatar\_url( $bpa\_login\_customer\_id ); |
| [3375](#L3375) |  |
| [3376](#L3376) | $bookingpress\_get\_existing\_avatar\_url = $BookingPress->get\_bookingpress\_customersmeta( $bookingpress\_current\_user\_id, 'customer\_avatar\_details' ); |
| [3377](#L3377) | $bookingpress\_get\_existing\_avatar\_url = ! empty( $bookingpress\_get\_existing\_avatar\_url ) ? maybe\_unserialize( $bookingpress\_get\_existing\_avatar\_url ) : array(); |
| [3378](#L3378) | $use\_default\_placeholder = false; |
| [3379](#L3379) | if ( ! empty( $bookingpress\_get\_existing\_avatar\_url[0]['url'] ) ) { |
| [3380](#L3380) | $bookingpress\_user\_avatar = $bookingpress\_get\_existing\_avatar\_url[0]['url']; |
| [3381](#L3381) | } else { |
| [3382](#L3382) | $bookingpress\_user\_avatar = BOOKINGPRESS\_IMAGES\_URL . '/default-avatar.jpg'; |
| [3383](#L3383) | $use\_default\_placeholder = true; |
| [3384](#L3384) | } |
| [3385](#L3385) | $bookingpress\_customer\_data['bookingpress\_user\_email'] = $bookingpress\_user\_email; |
| [3386](#L3386) | $bookingpress\_customer\_data['bookingpress\_user\_fullname'] = $bookingpress\_user\_fullname; |
| [3387](#L3387) | $bookingpress\_customer\_data['bookingpress\_avatar\_url'] = $bookingpress\_user\_avatar; |
| [3388](#L3388) | $bookingpress\_customer\_data['bookingpress\_use\_placeholder'] = $use\_default\_placeholder; |
| [3389](#L3389) |  |
| [3390](#L3390) | // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_REQUEST['search\_data'] contains mixed array and it's been sanitized properly using 'appointment\_sanatize\_field' function |
| [3391](#L3391) | $bookingpress\_search\_data        = ! empty($\_REQUEST['search\_data']) ? array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['search\_data']) : array(); |
| [3392](#L3392) | $bookingpress\_search\_query       = ''; |
| [3393](#L3393) | if( is\_user\_logged\_in() ){ |
| [3394](#L3394) | $bookingpress\_current\_user\_wpid = get\_current\_user\_id(); |
| [3395](#L3395) | $bookingpress\_search\_query\_where = "WHERE 1=1 AND ( bookingpress\_customer\_id IN ( SELECT bookingpress\_customer\_id FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = {$bookingpress\_current\_user\_wpid} ) ) "; |
| [3396](#L3396) | } else { |
| [3397](#L3397) | $bookingpress\_search\_query\_where = "WHERE 1=1 AND (bookingpress\_customer\_id={$bookingpress\_current\_user\_id}) "; |
| [3398](#L3398) | } |
| [3399](#L3399) |  |
| [3400](#L3400) | if (! empty($bookingpress\_search\_data) ) { |
| [3401](#L3401) | if (! empty($bookingpress\_search\_data['search\_appointment']) ) { |
| [3402](#L3402) | $bookingpress\_search\_string       = $bookingpress\_search\_data['search\_appointment']; |
| [3403](#L3403) | $bookingpress\_search\_query\_where .= "AND (bookingpress\_service\_name LIKE '%{$bookingpress\_search\_string}%') "; |
| [3404](#L3404) | } |
| [3405](#L3405) | if ( !empty ( $bookingpress\_search\_data['selected\_date\_range'] ) && ! empty($bookingpress\_search\_data['selected\_date\_range'][0]) && !empty($bookingpress\_search\_data['selected\_date\_range'][1]) ) { |
| [3406](#L3406) | $bookingpress\_search\_date         = $bookingpress\_search\_data['selected\_date\_range']; |
| [3407](#L3407) | $start\_date                       = date('Y-m-d', strtotime($bookingpress\_search\_date[0])); |
| [3408](#L3408) | $end\_date                         = date('Y-m-d', strtotime($bookingpress\_search\_date[1])); |
| [3409](#L3409) | $bookingpress\_search\_query\_where .= "AND (bookingpress\_appointment\_date BETWEEN '{$start\_date}' AND '{$end\_date}')"; |
| [3410](#L3410) | } |
| [3411](#L3411) | } |
| [3412](#L3412) |  |
| [3413](#L3413) | $bookingpress\_global\_data = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3414](#L3414) | $bookingpress\_date\_format = $bookingpress\_global\_data['wp\_default\_date\_format']; |
| [3415](#L3415) | $bookingpress\_time\_format = $bookingpress\_global\_data['wp\_default\_time\_format']; |
| [3416](#L3416) | $bookingpress\_appointment\_statuses = $bookingpress\_global\_data['appointment\_status']; |
| [3417](#L3417) | $bookingpress\_payment\_statuses = $bookingpress\_global\_data['payment\_status']; |
| [3418](#L3418) |  |
| [3419](#L3419) | $bookingpress\_total\_appointments = $wpdb->get\_var("SELECT COUNT(bookingpress\_appointment\_booking\_id) FROM {$tbl\_bookingpress\_appointment\_bookings} {$bookingpress\_search\_query} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_appointment\_date DESC"); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [3420](#L3420) | $appointments\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} {$bookingpress\_search\_query} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_appointment\_date DESC LIMIT {$offset} , {$perpage}", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [3421](#L3421) |  |
| [3422](#L3422) |  |
| [3423](#L3423) | if(!empty($appointments\_data) && is\_array($appointments\_data) ){ |
| [3424](#L3424) | foreach($appointments\_data as $k => $v){ |
| [3425](#L3425) | $use\_default\_date\_time = false; |
| [3426](#L3426) | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && '0000-00-00' != $v['bookingpress\_selected\_appointment\_date'] && $BookingPress->bpa\_is\_pro\_active() ){ |
| [3427](#L3427) | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_selected\_appointment\_date'])); |
| [3428](#L3428) | } else { |
| [3429](#L3429) | $use\_default\_date\_time = true; |
| [3430](#L3430) | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_appointment\_date'])); |
| [3431](#L3431) | } |
| [3432](#L3432) |  |
| [3433](#L3433) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_date'] = $bookingpress\_appointment\_date; |
| [3434](#L3434) |  |
| [3435](#L3435) | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) && $BookingPress->bpa\_is\_pro\_active() && '00:00:00' != $v['bookingpress\_selected\_appointment\_time'] && true == $use\_default\_date\_time ){ |
| [3436](#L3436) | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_time'])); |
| [3437](#L3437) | } else { |
| [3438](#L3438) | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_appointment\_time'])); |
| [3439](#L3439) | } |
| [3440](#L3440) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_start\_time'] = $bookingpress\_appointment\_start\_time; |
| [3441](#L3441) |  |
| [3442](#L3442) | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) && $BookingPress->bpa\_is\_pro\_active() && '00:00:00' != $v['bookingpress\_selected\_appointment\_end\_time'] && true == $use\_default\_date\_time ){ |
| [3443](#L3443) | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_end\_time'])); |
| [3444](#L3444) | } else { |
| [3445](#L3445) | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_appointment\_end\_time'])); |
| [3446](#L3446) | } |
| [3447](#L3447) | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_end\_time'] = $bookingpress\_appointment\_end\_time; |
| [3448](#L3448) |  |
| [3449](#L3449) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Minutes', 'bookingpress-appointment-booking'); |
| [3450](#L3450) | if($v['bookingpress\_service\_duration\_unit'] == 'h'){ |
| [3451](#L3451) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Hours', 'bookingpress-appointment-booking'); |
| [3452](#L3452) | } else if( 'd' == $v['bookingpress\_service\_duration\_unit'] ){ |
| [3453](#L3453) | $bookingpress\_appointment\_duration\_unit\_label = esc\_html\_\_('Days', 'bookingpress-appointment-booking'); |
| [3454](#L3454) | } |
| [3455](#L3455) |  |
| [3456](#L3456) | $appointments\_data[$k]['bookingpress\_service\_name'] = !empty($v['bookingpress\_service\_name']) ? stripslashes\_deep($v['bookingpress\_service\_name']) : ''; |
| [3457](#L3457) | $appointments\_data[$k]['bookingpress\_service\_duration\_label'] = $bookingpress\_appointment\_duration\_unit\_label; |
| [3458](#L3458) |  |
| [3459](#L3459) | $bookingpress\_appointment\_status\_label = ''; |
| [3460](#L3460) | foreach($bookingpress\_appointment\_statuses as $k2 => $v2){ |
| [3461](#L3461) | if($v2['value'] == $v['bookingpress\_appointment\_status']){ |
| [3462](#L3462) | $bookingpress\_appointment\_status\_label = $v2['text']; |
| [3463](#L3463) | } |
| [3464](#L3464) | } |
| [3465](#L3465) | $appointments\_data[$k]['bookingpress\_appointment\_status\_label'] = $bookingpress\_appointment\_status\_label; |
| [3466](#L3466) |  |
| [3467](#L3467) | $currency\_name   = $v['bookingpress\_service\_currency']; |
| [3468](#L3468) | $currency\_symbol = $BookingPress->bookingpress\_get\_currency\_symbol($currency\_name); |
| [3469](#L3469) | $bookingpress\_paid\_price\_with\_currency = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($v['bookingpress\_paid\_amount'], $currency\_symbol); |
| [3470](#L3470) | $appointments\_data[$k]['bookingpress\_paid\_price\_with\_currency'] = $bookingpress\_paid\_price\_with\_currency; |
| [3471](#L3471) |  |
| [3472](#L3472) | //get payment log details |
| [3473](#L3473) | $bookingpress\_appointment\_id = intval($v['bookingpress\_appointment\_booking\_id']); |
| [3474](#L3474) | $bookingpress\_payment\_log\_details = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_payment\_logs} WHERE bookingpress\_appointment\_booking\_ref = %d", $bookingpress\_appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_payment\_logs is a table name. false alarm |
| [3475](#L3475) |  |
| [3476](#L3476) | $appointments\_data[$k]['booking\_id'] = !empty($v['bookingpress\_booking\_id']) ? sanitize\_text\_field($v['bookingpress\_booking\_id']) : 1; |
| [3477](#L3477) |  |
| [3478](#L3478) | $bookingpress\_payment\_status = $bookingpress\_payment\_status\_label = $bookingpress\_payment\_method = ''; |
| [3479](#L3479) | if(!empty($bookingpress\_payment\_log\_details)){ |
| [3480](#L3480) | $bookingpress\_payment\_method = $bookingpress\_payment\_log\_details['bookingpress\_payment\_gateway']; |
| [3481](#L3481) | $bookingpress\_payment\_status = $bookingpress\_payment\_log\_details['bookingpress\_payment\_status']; |
| [3482](#L3482) |  |
| [3483](#L3483) | foreach($bookingpress\_payment\_statuses as $k2 => $v2){ |
| [3484](#L3484) | if($v2['value'] == $bookingpress\_payment\_status){ |
| [3485](#L3485) | $bookingpress\_payment\_status\_label = $v2['text']; |
| [3486](#L3486) | } |
| [3487](#L3487) | } |
| [3488](#L3488) | } |
| [3489](#L3489) | $appointments\_data[$k]['bookingpress\_payment\_status'] = $bookingpress\_payment\_status; |
| [3490](#L3490) | $appointments\_data[$k]['bookingpress\_payment\_status\_label'] = $bookingpress\_payment\_status\_label; |
| [3491](#L3491) | $bookingpress\_payment\_method\_label = $bookingpress\_payment\_method; |
| [3492](#L3492) |  |
| [3493](#L3493) | if(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method == 'on-site' ) { |
| [3494](#L3494) | $bookingpress\_payment\_method\_label = $BookingPress->bookingpress\_get\_customize\_settings('locally\_text','booking\_form'); |
| [3495](#L3495) | } elseif(!empty($bookingpress\_payment\_method) && $bookingpress\_payment\_method != 'manual') { |
| [3496](#L3496) | $bookingpress\_payment\_method\_label = $BookingPress->bookingpress\_get\_customize\_settings($bookingpress\_payment\_method.'\_text','booking\_form'); |
| [3497](#L3497) | if(empty($bookingpress\_payment\_method\_label)) { |
| [3498](#L3498) | $bookingpress\_payment\_method\_label = $bookingpress\_payment\_method; |
| [3499](#L3499) | } |
| [3500](#L3500) | } |
| [3501](#L3501) | $appointments\_data[$k]['bookingpress\_payment\_method'] = $bookingpress\_payment\_method; |
| [3502](#L3502) | $appointments\_data[$k]['bookingpress\_payment\_method\_label'] = $bookingpress\_payment\_method\_label; |
| [3503](#L3503) |  |
| [3504](#L3504) | $appointment\_status\_cls = ''; |
| [3505](#L3505) | $appointments\_data[$k]['bookingpress\_payment\_status\_class'] = $appointment\_status\_cls; |
| [3506](#L3506) |  |
| [3507](#L3507) | $appointments\_data = apply\_filters('bookingpress\_modify\_my\_appointment\_data', $appointments\_data, $k); |
| [3508](#L3508) | } |
| [3509](#L3509) | } |
| [3510](#L3510) | } |
| [3511](#L3511) | $data['customer\_details'] = $bookingpress\_customer\_data; |
| [3512](#L3512) | $data['items'] = $appointments\_data; |
| [3513](#L3513) | $data['total\_records'] = $bookingpress\_total\_appointments; |
| [3514](#L3514) |  |
| [3515](#L3515) | $data = apply\_filters('bookingpress\_modify\_my\_appointments\_data', $data); |
| [3516](#L3516) | if($return\_data){ |
| [3517](#L3517) | return $data; |
| [3518](#L3518) | } |
| [3519](#L3519) | wp\_send\_json($data); |
| [3520](#L3520) | exit; |
| [3521](#L3521) | } |
| [3522](#L3522) |  |
| [3523](#L3523) | /\*\* |
| [3524](#L3524) | \* Callback function of [bookingpress\_appointment\_service] shortcode |
| [3525](#L3525) | \* |
| [3526](#L3526) | \* @param  mixed $atts |
| [3527](#L3527) | \* @param  mixed $content |
| [3528](#L3528) | \* @param  mixed $tag |
| [3529](#L3529) | \* @return void |
| [3530](#L3530) | \*/ |
| [3531](#L3531) | function bookingpress\_appointment\_service\_func( $atts, $content, $tag ) |
| [3532](#L3532) | { |
| [3533](#L3533) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [3534](#L3534) | $BookingPress->set\_front\_css(1); |
| [3535](#L3535) | $BookingPress->set\_front\_js(1); |
| [3536](#L3536) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3537](#L3537) | $bookingpress\_short\_atts = array( |
| [3538](#L3538) | 'appointment\_id' => 0, |
| [3539](#L3539) | ); |
| [3540](#L3540) |  |
| [3541](#L3541) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3542](#L3542) | $appointment\_id = $atts['appointment\_id']; |
| [3543](#L3543) |  |
| [3544](#L3544) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3545](#L3545) |  |
| [3546](#L3546) | if(!empty($bookingpress\_uniq\_id)){ |
| [3547](#L3547) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3548](#L3548) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3549](#L3549) | } else { |
| [3550](#L3550) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3551](#L3551) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3552](#L3552) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3553](#L3553) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3554](#L3554) |  |
| [3555](#L3555) | if(!empty($bookingpress\_entry\_id)){ |
| [3556](#L3556) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3557](#L3557) |  |
| [3558](#L3558) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3559](#L3559) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3560](#L3560) | } |
| [3561](#L3561) | } |
| [3562](#L3562) | } |
| [3563](#L3563) | } |
| [3564](#L3564) | } |
| [3565](#L3565) |  |
| [3566](#L3566) | $appointment\_data = array(); |
| [3567](#L3567) |  |
| [3568](#L3568) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3569](#L3569) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3570](#L3570) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3571](#L3571) |  |
| [3572](#L3572) | if (empty($appointment\_id) && !empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification) { |
| [3573](#L3573) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id'])); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3574](#L3574) |  |
| [3575](#L3575) |  |
| [3576](#L3576) | //$bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3577](#L3577) |  |
| [3578](#L3578) |  |
| [3579](#L3579) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3580](#L3580) | if( false == $bookingpress\_entry\_details ){ |
| [3581](#L3581) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3582](#L3582) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3583](#L3583) | } |
| [3584](#L3584) |  |
| [3585](#L3585) |  |
| [3586](#L3586) |  |
| [3587](#L3587) | if (! empty($bookingpress\_entry\_details) ) { |
| [3588](#L3588) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3589](#L3589) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [3590](#L3590) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [3591](#L3591) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [3592](#L3592) |  |
| [3593](#L3593) |  |
| [3594](#L3594) | //$appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3595](#L3595) |  |
| [3596](#L3596) | $bookingpress\_entry\_id = $appointment\_id; |
| [3597](#L3597) | //$appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3598](#L3598) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3599](#L3599) | if( false == $bookingpress\_entry\_details ){ |
| [3600](#L3600) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3601](#L3601) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3602](#L3602) | } |
| [3603](#L3603) |  |
| [3604](#L3604) | if (empty($appointment\_data) ) { |
| [3605](#L3605) | // If no appointment data found then display data from entries table. |
| [3606](#L3606) | $appointment\_data = $bookingpress\_entry\_details; |
| [3607](#L3607) | } |
| [3608](#L3608) | } |
| [3609](#L3609) | } else { |
| [3610](#L3610) |  |
| [3611](#L3611) |  |
| [3612](#L3612) | if($appointment\_id > 0){ |
| [3613](#L3613) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3614](#L3614) | if( false == $appointment\_data ){ |
| [3615](#L3615) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3616](#L3616) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3617](#L3617) | } |
| [3618](#L3618) | } |
| [3619](#L3619) |  |
| [3620](#L3620) | } |
| [3621](#L3621) |  |
| [3622](#L3622) | $appointment\_data = apply\_filters('bookingpress\_modify\_service\_shortcode\_details', $appointment\_data, $appointment\_id); |
| [3623](#L3623) |  |
| [3624](#L3624) | $content .= '<div class="bookingpress\_service\_shortcode\_container">'; |
| [3625](#L3625) | if (! empty($appointment\_data) ) { |
| [3626](#L3626) | if(empty($appointment\_data['bookingpress\_service\_name'])){ |
| [3627](#L3627) | foreach($appointment\_data as $appointment\_data\_key => $appointment\_data\_val){ |
| [3628](#L3628) | $content .= "<div class='bookingpress\_service\_name\_div'>"; |
| [3629](#L3629) | $content .= "<span class='bookingpress\_service\_name'>" . stripslashes\_deep(esc\_html($appointment\_data\_val['bookingpress\_service\_name'])) . '</span>'; |
| [3630](#L3630) | $content .= '</div><br/>'; |
| [3631](#L3631) | } |
| [3632](#L3632) | }else{ |
| [3633](#L3633) | $content .= "<div class='bookingpress\_service\_name\_div'>"; |
| [3634](#L3634) | $content .= "<span class='bookingpress\_service\_name'>" . stripslashes\_deep(esc\_html($appointment\_data['bookingpress\_service\_name'])) . '</span>'; |
| [3635](#L3635) | $content .= '</div>'; |
| [3636](#L3636) | } |
| [3637](#L3637) | } |
| [3638](#L3638) | $content .= '</div>'; |
| [3639](#L3639) |  |
| [3640](#L3640) | return $content; |
| [3641](#L3641) | } |
| [3642](#L3642) |  |
| [3643](#L3643) | /\*\* |
| [3644](#L3644) | \* Callback function of [bookingpress\_appointment\_datetime] shortcode |
| [3645](#L3645) | \* |
| [3646](#L3646) | \* @param  mixed $atts |
| [3647](#L3647) | \* @param  mixed $content |
| [3648](#L3648) | \* @param  mixed $tag |
| [3649](#L3649) | \* @return void |
| [3650](#L3650) | \*/ |
| [3651](#L3651) | function bookingpress\_appointment\_datetime\_func( $atts, $content, $tag ) |
| [3652](#L3652) | { |
| [3653](#L3653) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries,$bookingpress\_global\_options; |
| [3654](#L3654) | $BookingPress->set\_front\_css(1); |
| [3655](#L3655) | $BookingPress->set\_front\_js(1); |
| [3656](#L3656) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3657](#L3657) |  |
| [3658](#L3658) | $bookingpress\_short\_atts = array( |
| [3659](#L3659) | 'appointment\_id' => 0, |
| [3660](#L3660) | ); |
| [3661](#L3661) |  |
| [3662](#L3662) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3663](#L3663) | $appointment\_id = $atts['appointment\_id']; |
| [3664](#L3664) |  |
| [3665](#L3665) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3666](#L3666) | if(!empty($bookingpress\_uniq\_id)){ |
| [3667](#L3667) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3668](#L3668) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3669](#L3669) | } else { |
| [3670](#L3670) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3671](#L3671) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3672](#L3672) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3673](#L3673) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3674](#L3674) |  |
| [3675](#L3675) | if(!empty($bookingpress\_entry\_id)){ |
| [3676](#L3676) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3677](#L3677) |  |
| [3678](#L3678) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3679](#L3679) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3680](#L3680) | } |
| [3681](#L3681) | } |
| [3682](#L3682) | } |
| [3683](#L3683) | } |
| [3684](#L3684) | } |
| [3685](#L3685) |  |
| [3686](#L3686) | $appointment\_data = array(); |
| [3687](#L3687) |  |
| [3688](#L3688) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3689](#L3689) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3690](#L3690) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3691](#L3691) |  |
| [3692](#L3692) | if (empty($appointment\_id) && ! empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification ) { |
| [3693](#L3693) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3694](#L3694) |  |
| [3695](#L3695) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3696](#L3696) | if( false == $bookingpress\_entry\_details ){ |
| [3697](#L3697) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3698](#L3698) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3699](#L3699) | } |
| [3700](#L3700) |  |
| [3701](#L3701) |  |
| [3702](#L3702) |  |
| [3703](#L3703) | if (! empty($bookingpress\_entry\_details) ) { |
| [3704](#L3704) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3705](#L3705) |  |
| [3706](#L3706) | $bookingpress\_entry\_id = $appointment\_id; |
| [3707](#L3707) |  |
| [3708](#L3708) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3709](#L3709) | if( false == $bookingpress\_entry\_details ){ |
| [3710](#L3710) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3711](#L3711) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3712](#L3712) | } |
| [3713](#L3713) |  |
| [3714](#L3714) |  |
| [3715](#L3715) | if (empty($appointment\_data) ) { |
| [3716](#L3716) | // If no appointment data found then display data from entries table. |
| [3717](#L3717) | $appointment\_data = $bookingpress\_entry\_details; |
| [3718](#L3718) | } |
| [3719](#L3719) | } |
| [3720](#L3720) | } else { |
| [3721](#L3721) |  |
| [3722](#L3722) |  |
| [3723](#L3723) | if($appointment\_id > 0){ |
| [3724](#L3724) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3725](#L3725) | if( false == $appointment\_data ){ |
| [3726](#L3726) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3727](#L3727) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3728](#L3728) | } |
| [3729](#L3729) | } |
| [3730](#L3730) |  |
| [3731](#L3731) |  |
| [3732](#L3732) | } |
| [3733](#L3733) |  |
| [3734](#L3734) | $appointment\_data = apply\_filters('bookingpress\_modify\_datetime\_shortcode\_data', $appointment\_data, $appointment\_id); |
| [3735](#L3735) |  |
| [3736](#L3736) | $content .= '<div class="bookinpress-datetime-container">'; |
| [3737](#L3737) | $content = apply\_filters('bookingpress\_modify\_datetime\_shortcode\_content', $content, $appointment\_data); |
| [3738](#L3738) | $bookingpress\_is\_group\_datetime = apply\_filters('bookingpress\_check\_group\_order\_for\_thankyou\_datetime', 0, $appointment\_data); |
| [3739](#L3739) |  |
| [3740](#L3740) | if ($bookingpress\_is\_group\_datetime == 0 && !empty($appointment\_data) ) { |
| [3741](#L3741) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [3742](#L3742) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format'] . ' ' . $bookingpress\_global\_options\_arr['wp\_default\_time\_format']; |
| [3743](#L3743) |  |
| [3744](#L3744) |  |
| [3745](#L3745) |  |
| [3746](#L3746) | if( empty( $appointment\_data['bookingpress\_appointment\_date'] ) ){ |
| [3747](#L3747) | foreach($appointment\_data as $appointment\_data\_key => $appointment\_data\_val){ |
| [3748](#L3748) | $content .= "<div class='bookingpress\_appointment\_datetime\_div'>"; |
| [3749](#L3749) | $check\_timezone = false; |
| [3750](#L3750) | if( !empty( $appointment\_data\_val['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data\_val['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data\_val['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data\_val['bookingpress\_selected\_appointment\_time'] ){ |
| [3751](#L3751) | $booked\_appointment\_datetime = esc\_html($appointment\_data\_val['bookingpress\_selected\_appointment\_date']) . ' ' . esc\_html($appointment\_data\_val['bookingpress\_selected\_appointment\_time']); |
| [3752](#L3752) | } else { |
| [3753](#L3753) | $check\_timezone = true; |
| [3754](#L3754) | $booked\_appointment\_datetime = esc\_html($appointment\_data\_val['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data\_val['bookingpress\_appointment\_time']); |
| [3755](#L3755) | } |
| [3756](#L3756) |  |
| [3757](#L3757) | if(empty($bookingpress\_entry\_details['bookingpress\_customer\_timezone'])){ |
| [3758](#L3758) | $bookingpress\_entry\_id = !empty($appointment\_data\_val['bookingpress\_entry\_id']) ? intval($appointment\_data\_val['bookingpress\_entry\_id']) : 0; |
| [3759](#L3759) | if(!empty($bookingpress\_entry\_id)){ |
| [3760](#L3760) |  |
| [3761](#L3761) | //Get entries details |
| [3762](#L3762) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3763](#L3763) | } |
| [3764](#L3764) | } |
| [3765](#L3765) |  |
| [3766](#L3766) | if( true == $check\_timezone ){ |
| [3767](#L3767) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_entry\_details['bookingpress\_customer\_timezone'], $bookingpress\_entry\_details ); |
| [3768](#L3768) | } |
| [3769](#L3769) |  |
| [3770](#L3770) | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data\_val ); |
| [3771](#L3771) |  |
| [3772](#L3772) | $booked\_appointment\_date = date($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [3773](#L3773) |  |
| [3774](#L3774) | $content .= "<span class='bookingpress\_appointment\_datetime'>" . $booked\_appointment\_date . '</span>'; |
| [3775](#L3775) | $content .= '</div><br/>'; |
| [3776](#L3776) | } |
| [3777](#L3777) | }else{ |
| [3778](#L3778) | $check\_timezone = false; |
| [3779](#L3779) |  |
| [3780](#L3780) | if( ( !empty( $appointment\_data['bookingpress\_selected\_appointment\_date'] ) && !empty( $appointment\_data['bookingpress\_selected\_appointment\_time'] ) && '0000-00-00' != $appointment\_data['bookingpress\_selected\_appointment\_date'] && '00:00:00' != $appointment\_data['bookingpress\_selected\_appointment\_time'] ) || 'd' == $appointment\_data['bookingpress\_service\_duration\_unit']  ){ |
| [3781](#L3781) | $booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_selected\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_selected\_appointment\_time']); |
| [3782](#L3782) | } else { |
| [3783](#L3783) | $check\_timezone = true; |
| [3784](#L3784) | $booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_appointment\_time']); |
| [3785](#L3785) | } |
| [3786](#L3786) | //$booked\_appointment\_datetime = esc\_html($appointment\_data['bookingpress\_appointment\_date']) . ' ' . esc\_html($appointment\_data['bookingpress\_appointment\_time']); |
| [3787](#L3787) |  |
| [3788](#L3788) | if(empty($bookingpress\_entry\_details['bookingpress\_customer\_timezone'])){ |
| [3789](#L3789) | $bookingpress\_entry\_id = !empty($appointment\_data['bookingpress\_entry\_id']) ? intval($appointment\_data['bookingpress\_entry\_id']) : 0; |
| [3790](#L3790) | if(!empty($bookingpress\_entry\_id)){ |
| [3791](#L3791) |  |
| [3792](#L3792) | //Get entries details |
| [3793](#L3793) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3794](#L3794) | } |
| [3795](#L3795) | } |
| [3796](#L3796) |  |
| [3797](#L3797) | if( true == $check\_timezone ){ |
| [3798](#L3798) | $booked\_appointment\_datetime = apply\_filters( 'bookingpress\_appointment\_change\_to\_client\_timezone', $booked\_appointment\_datetime, $bookingpress\_entry\_details['bookingpress\_customer\_timezone'], $bookingpress\_entry\_details ); |
| [3799](#L3799) | } |
| [3800](#L3800) |  |
| [3801](#L3801) | $bookingpress\_default\_date\_time\_format = apply\_filters( 'bookingpress\_modify\_default\_date\_time\_format', $bookingpress\_default\_date\_time\_format, $appointment\_data ); |
| [3802](#L3802) |  |
| [3803](#L3803) | $booked\_appointment\_date = date\_i18n($bookingpress\_default\_date\_time\_format, strtotime($booked\_appointment\_datetime)); |
| [3804](#L3804) | $content .= "<div class='bookingpress\_appointment\_datetime\_div'>"; |
| [3805](#L3805) | $content .= "<span class='bookingpress\_appointment\_datetime'>" . $booked\_appointment\_date . '</span>'; |
| [3806](#L3806) | $content .= '</div>'; |
| [3807](#L3807) | } |
| [3808](#L3808) | } |
| [3809](#L3809) | $content .= '</div>'; |
| [3810](#L3810) |  |
| [3811](#L3811) | return $content; |
| [3812](#L3812) | } |
| [3813](#L3813) |  |
| [3814](#L3814) | /\*\* |
| [3815](#L3815) | \* Callback function of [booking\_id] shortcode |
| [3816](#L3816) | \* |
| [3817](#L3817) | \* @param  mixed $atts |
| [3818](#L3818) | \* @param  mixed $content |
| [3819](#L3819) | \* @param  mixed $tag |
| [3820](#L3820) | \* @return void |
| [3821](#L3821) | \*/ |
| [3822](#L3822) | function bookingpress\_booking\_id\_func($atts, $content, $tag){ |
| [3823](#L3823) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries, $tbl\_bookingpress\_payment\_logs; |
| [3824](#L3824) | $BookingPress->set\_front\_css(1); |
| [3825](#L3825) | $BookingPress->set\_front\_js(1); |
| [3826](#L3826) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3827](#L3827) |  |
| [3828](#L3828) | $bookingpress\_short\_atts = array( |
| [3829](#L3829) | 'appointment\_id' => 0, |
| [3830](#L3830) | ); |
| [3831](#L3831) |  |
| [3832](#L3832) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3833](#L3833) | $appointment\_id = $atts['appointment\_id']; |
| [3834](#L3834) |  |
| [3835](#L3835) | $entry\_id = 0; |
| [3836](#L3836) |  |
| [3837](#L3837) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3838](#L3838) | if(!empty($bookingpress\_uniq\_id)){ |
| [3839](#L3839) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3840](#L3840) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3841](#L3841) | if(!empty($appointment\_id)){ |
| [3842](#L3842) | $bookingpress\_appointment\_details = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_order\_id = %d", $appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $bookingpress\_appointment\_details is table name defined globally. False Positive alarm |
| [3843](#L3843) | if(!empty($bookingpress\_appointment\_details)){ |
| [3844](#L3844) | $content .= '#'.$bookingpress\_appointment\_details['bookingpress\_booking\_id']; |
| [3845](#L3845) | return $content; |
| [3846](#L3846) | } |
| [3847](#L3847) | } |
| [3848](#L3848) | } else { |
| [3849](#L3849) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3850](#L3850) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3851](#L3851) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3852](#L3852) | $entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3853](#L3853) | } |
| [3854](#L3854) | } |
| [3855](#L3855) | } |
| [3856](#L3856) |  |
| [3857](#L3857) | if(empty($appointment\_id) && !empty($\_GET['appointment\_id']) ){ |
| [3858](#L3858) | $entry\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3859](#L3859) |  |
| [3860](#L3860) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3861](#L3861) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3862](#L3862) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3863](#L3863) |  |
| [3864](#L3864) | if(!$bookingpress\_nonce\_verification){ |
| [3865](#L3865) | return $content; |
| [3866](#L3866) | } |
| [3867](#L3867) | } |
| [3868](#L3868) |  |
| [3869](#L3869) |  |
| [3870](#L3870) |  |
| [3871](#L3871) | $appointment\_data  = array(); |
| [3872](#L3872) | $bookingpress\_booking\_id = ''; |
| [3873](#L3873) |  |
| [3874](#L3874) | if(!empty($entry\_id)){ |
| [3875](#L3875) | //Get appointment details |
| [3876](#L3876) | $bookingpress\_appointment\_details = $wpdb->get\_row($wpdb->prepare("SELECT bookingpress\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3877](#L3877) |  |
| [3878](#L3878) | $bookingpress\_booking\_id = !empty($bookingpress\_appointment\_details['bookingpress\_booking\_id']) ? $bookingpress\_appointment\_details['bookingpress\_booking\_id'] : ''; |
| [3879](#L3879) | } |
| [3880](#L3880) |  |
| [3881](#L3881) | $bookingpress\_booking\_id = apply\_filters('bookingpress\_modify\_booking\_id\_shortcode\_data', $bookingpress\_booking\_id, $entry\_id); |
| [3882](#L3882) |  |
| [3883](#L3883) | if(!empty($bookingpress\_booking\_id)){ |
| [3884](#L3884) | $content .= '#'.$bookingpress\_booking\_id; |
| [3885](#L3885) | } |
| [3886](#L3886) | return $content; |
| [3887](#L3887) | } |
| [3888](#L3888) |  |
| [3889](#L3889) | /\*\* |
| [3890](#L3890) | \* Callback function of [bookingpress\_appointment\_customername] shortcode |
| [3891](#L3891) | \* |
| [3892](#L3892) | \* @param  mixed $atts |
| [3893](#L3893) | \* @param  mixed $content |
| [3894](#L3894) | \* @param  mixed $tag |
| [3895](#L3895) | \* @return void |
| [3896](#L3896) | \*/ |
| [3897](#L3897) | function bookingpress\_appointment\_customername\_func( $atts, $content, $tag ) |
| [3898](#L3898) | { |
| [3899](#L3899) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [3900](#L3900) | $BookingPress->set\_front\_css(1); |
| [3901](#L3901) | $BookingPress->set\_front\_js(1); |
| [3902](#L3902) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [3903](#L3903) |  |
| [3904](#L3904) | $bookingpress\_short\_atts = array( |
| [3905](#L3905) | 'appointment\_id' => 0, |
| [3906](#L3906) | ); |
| [3907](#L3907) |  |
| [3908](#L3908) | $atts           = shortcode\_atts($bookingpress\_short\_atts, $atts, $tag); |
| [3909](#L3909) | $appointment\_id = $atts['appointment\_id']; |
| [3910](#L3910) |  |
| [3911](#L3911) | $bookingpress\_uniq\_id = !empty($\_POST['bookingpress\_uniq\_id']) ? sanitize\_text\_field($\_POST['bookingpress\_uniq\_id']) : ''; |
| [3912](#L3912) |  |
| [3913](#L3913) | if(!empty($bookingpress\_uniq\_id)){ |
| [3914](#L3914) | if(!empty($\_COOKIE['bookingpress\_cart\_id'])) { |
| [3915](#L3915) | $appointment\_id = base64\_decode($\_COOKIE['bookingpress\_cart\_id']); //phpcs:ignore |
| [3916](#L3916) | } else { |
| [3917](#L3917) | $bookingpress\_cookie\_name = $bookingpress\_uniq\_id."\_appointment\_data"; |
| [3918](#L3918) | if(!empty($\_COOKIE[$bookingpress\_cookie\_name])){ |
| [3919](#L3919) | $bookingpress\_cookie\_value = sanitize\_text\_field($\_COOKIE[$bookingpress\_cookie\_name]); |
| [3920](#L3920) | $bookingpress\_entry\_id = base64\_decode($bookingpress\_cookie\_value); |
| [3921](#L3921) | if(!empty($bookingpress\_entry\_id)){ |
| [3922](#L3922) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT bookingpress\_appointment\_booking\_id FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d",$bookingpress\_entry\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3923](#L3923) |  |
| [3924](#L3924) | if(!empty($bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id'])){ |
| [3925](#L3925) | $appointment\_id = $bookingpress\_entry\_details['bookingpress\_appointment\_booking\_id']; |
| [3926](#L3926) | } |
| [3927](#L3927) | } |
| [3928](#L3928) | } |
| [3929](#L3929) | } |
| [3930](#L3930) | } |
| [3931](#L3931) |  |
| [3932](#L3932) | $appointment\_data  = array(); |
| [3933](#L3933) |  |
| [3934](#L3934) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [3935](#L3935) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [3936](#L3936) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [3937](#L3937) |  |
| [3938](#L3938) | $customer\_fullname = ''; |
| [3939](#L3939) | if (empty($appointment\_id) && ! empty($\_GET['appointment\_id']) && $bookingpress\_nonce\_verification ) { |
| [3940](#L3940) | $appointment\_id = intval(base64\_decode($\_GET['appointment\_id']));// phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_id'] sanitized properly |
| [3941](#L3941) |  |
| [3942](#L3942) | //$bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3943](#L3943) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3944](#L3944) | if( false == $bookingpress\_entry\_details ){ |
| [3945](#L3945) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d",$appointment\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_entries is table name defined globally. False Positive alarm |
| [3946](#L3946) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $bookingpress\_entry\_details); |
| [3947](#L3947) | } |
| [3948](#L3948) |  |
| [3949](#L3949) |  |
| [3950](#L3950) | if (! empty($bookingpress\_entry\_details) ) { |
| [3951](#L3951) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [3952](#L3952) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [3953](#L3953) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [3954](#L3954) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [3955](#L3955) |  |
| [3956](#L3956) | //$appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3957](#L3957) |  |
| [3958](#L3958) | $bookingpress\_entry\_id = $appointment\_id; |
| [3959](#L3959) | //$appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3960](#L3960) | $bookingpress\_entry\_details = wp\_cache\_get( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id ); |
| [3961](#L3961) | if( false == $bookingpress\_entry\_details ){ |
| [3962](#L3962) | $appointment\_data = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_entry\_id = %d", $bookingpress\_entry\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3963](#L3963) | wp\_cache\_set( 'bpa\_bookingpress\_entry\_details\_id\_'.$appointment\_id , $appointment\_data); |
| [3964](#L3964) | } |
| [3965](#L3965) |  |
| [3966](#L3966) | if (empty($appointment\_data) ) { |
| [3967](#L3967) | // If no data found from appointments then display data from entries table. |
| [3968](#L3968) | $appointment\_data = $bookingpress\_entry\_details; |
| [3969](#L3969) | } |
| [3970](#L3970) | } |
| [3971](#L3971) | } else { |
| [3972](#L3972) |  |
| [3973](#L3973) | if($appointment\_id > 0){ |
| [3974](#L3974) | $appointment\_data = wp\_cache\_get( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id ); |
| [3975](#L3975) | if( false == $appointment\_data ){ |
| [3976](#L3976) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_appointment\_booking\_id = %d",$appointment\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_appointment\_bookings is table name defined globally. False Positive alarm |
| [3977](#L3977) | wp\_cache\_set( 'bpa\_appointment\_data\_with\_id\_'.$appointment\_id , $appointment\_data); |
| [3978](#L3978) | } |
| [3979](#L3979) | } |
| [3980](#L3980) |  |
| [3981](#L3981) |  |
| [3982](#L3982) | } |
| [3983](#L3983) |  |
| [3984](#L3984) | $appointment\_data = apply\_filters('bookingpress\_modify\_customer\_details\_shortcode\_data', $appointment\_data, $appointment\_id); |
| [3985](#L3985) |  |
| [3986](#L3986) | $content .= "<div class='bookingpress-appointment-customer-container'>"; |
| [3987](#L3987) | if (! empty($appointment\_data) ) { |
| [3988](#L3988) |  |
| [3989](#L3989) | $customer\_firstname = ! empty($appointment\_data['bookingpress\_customer\_firstname']) ? $appointment\_data['bookingpress\_customer\_firstname'] : ''; |
| [3990](#L3990) | $customer\_lastname  = ! empty($appointment\_data['bookingpress\_customer\_lastname']) ? $appointment\_data['bookingpress\_customer\_lastname'] : ''; |
| [3991](#L3991) | $customer\_email     = ! empty($appointment\_data['bookingpress\_customer\_email']) ? $appointment\_data['bookingpress\_customer\_email'] : ''; |
| [3992](#L3992) | $customer\_fullname = !empty($appointment\_data['bookingpress\_customer\_name']) ? $appointment\_data['bookingpress\_customer\_name'] : ($customer\_firstname . ' ' . $customer\_lastname); |
| [3993](#L3993) | if(empty($appointment\_data['bookingpress\_customer\_name']) && empty($customer\_firstname) && empty($customer\_lastname) ) { |
| [3994](#L3994) | $customer\_fullname = $customer\_email; |
| [3995](#L3995) | } |
| [3996](#L3996) | $content .= "<div class='bookingpress\_appointment\_customername\_div'>"; |
| [3997](#L3997) | $content .= "<span class='bookingpress\_appointment\_customername'>" . stripslashes\_deep(esc\_html($customer\_fullname)) . '</span>'; |
| [3998](#L3998) | $content .= '</div>'; |
| [3999](#L3999) | } |
| [4000](#L4000) | $content .= "</div>"; |
| [4001](#L4001) |  |
| [4002](#L4002) | return do\_shortcode($content); |
| [4003](#L4003) | } |
| [4004](#L4004) |  |
| [4005](#L4005) | /\*\* |
| [4006](#L4006) | \* Callback function of [bookingpress\_company\_avatar] shortcode |
| [4007](#L4007) | \* |
| [4008](#L4008) | \* @return void |
| [4009](#L4009) | \*/ |
| [4010](#L4010) | function bookingpress\_company\_avatar\_func() |
| [4011](#L4011) | { |
| [4012](#L4012) | global $BookingPress; |
| [4013](#L4013) | $BookingPress->set\_front\_css(1); |
| [4014](#L4014) | $BookingPress->set\_front\_js(1); |
| [4015](#L4015) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4016](#L4016) |  |
| [4017](#L4017) | $content                         = ''; |
| [4018](#L4018) | $bookingpress\_company\_avatar\_url = $BookingPress->bookingpress\_get\_settings('company\_avatar\_url', 'company\_setting'); |
| [4019](#L4019) | if ($bookingpress\_company\_avatar\_url != '' ) { |
| [4020](#L4020) | $bookingpress\_company\_avatar\_url = esc\_url($bookingpress\_company\_avatar\_url); |
| [4021](#L4021) | $content                         = '<img src=' . $bookingpress\_company\_avatar\_url . ' width=100 height=100 >'; |
| [4022](#L4022) | } else { |
| [4023](#L4023) | $content = esc\_html\_e('Company avatar not found', 'bookingpress-appointment-booking'); |
| [4024](#L4024) | } |
| [4025](#L4025) | return $content; |
| [4026](#L4026) | } |
| [4027](#L4027) |  |
| [4028](#L4028) | /\*\* |
| [4029](#L4029) | \* Callback function of [bookingpress\_company\_name] shortcode |
| [4030](#L4030) | \* |
| [4031](#L4031) | \* @return void |
| [4032](#L4032) | \*/ |
| [4033](#L4033) | function bookingpress\_company\_name\_func() |
| [4034](#L4034) | { |
| [4035](#L4035) | global $BookingPress; |
| [4036](#L4036) | $BookingPress->set\_front\_css(1); |
| [4037](#L4037) | $BookingPress->set\_front\_js(1); |
| [4038](#L4038) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4039](#L4039) |  |
| [4040](#L4040) | $content                   = ''; |
| [4041](#L4041) | $bookingpress\_company\_name = $BookingPress->bookingpress\_get\_settings('company\_name', 'company\_setting'); |
| [4042](#L4042) | if ($bookingpress\_company\_name != '' ) { |
| [4043](#L4043) | $content = esc\_html($bookingpress\_company\_name); |
| [4044](#L4044) | } else { |
| [4045](#L4045) | $content = esc\_html\_e('Company name not found', 'bookingpress-appointment-booking'); |
| [4046](#L4046) | } |
| [4047](#L4047) | return $content; |
| [4048](#L4048) | } |
| [4049](#L4049) |  |
| [4050](#L4050) | /\*\* |
| [4051](#L4051) | \* Callback function of [bookingpress\_company\_website] shortcode |
| [4052](#L4052) | \* |
| [4053](#L4053) | \* @return void |
| [4054](#L4054) | \*/ |
| [4055](#L4055) | function bookingpress\_company\_website\_func() |
| [4056](#L4056) | { |
| [4057](#L4057) | global $BookingPress; |
| [4058](#L4058) | $BookingPress->set\_front\_css(1); |
| [4059](#L4059) | $BookingPress->set\_front\_js(1); |
| [4060](#L4060) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4061](#L4061) |  |
| [4062](#L4062) | $content                      = ''; |
| [4063](#L4063) | $bookingpress\_company\_website = $BookingPress->bookingpress\_get\_settings('company\_website', 'company\_setting'); |
| [4064](#L4064) | if ($bookingpress\_company\_website != '' ) { |
| [4065](#L4065) | $content = esc\_html($bookingpress\_company\_website); |
| [4066](#L4066) | } else { |
| [4067](#L4067) | $content = esc\_html\_e('Company website name not found', 'bookingpress-appointment-booking'); |
| [4068](#L4068) | } |
| [4069](#L4069) | return $content; |
| [4070](#L4070) | } |
| [4071](#L4071) |  |
| [4072](#L4072) |  |
| [4073](#L4073) | /\*\* |
| [4074](#L4074) | \* Callback function of [bookingpress\_company\_address] shortcode |
| [4075](#L4075) | \* |
| [4076](#L4076) | \* @return void |
| [4077](#L4077) | \*/ |
| [4078](#L4078) | function bookingpress\_company\_address\_func() |
| [4079](#L4079) | { |
| [4080](#L4080) | global $BookingPress; |
| [4081](#L4081) | $BookingPress->set\_front\_css(1); |
| [4082](#L4082) | $BookingPress->set\_front\_js(1); |
| [4083](#L4083) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4084](#L4084) |  |
| [4085](#L4085) | $content                      = ''; |
| [4086](#L4086) | $bookingpress\_company\_address = $BookingPress->bookingpress\_get\_settings('company\_address', 'company\_setting'); |
| [4087](#L4087) | if ($bookingpress\_company\_address != '' ) { |
| [4088](#L4088) | $content = esc\_html($bookingpress\_company\_address); |
| [4089](#L4089) | } else { |
| [4090](#L4090) | $content = esc\_html\_e('Company address not found', 'bookingpress-appointment-booking'); |
| [4091](#L4091) | } |
| [4092](#L4092) | return $content; |
| [4093](#L4093) | } |
| [4094](#L4094) |  |
| [4095](#L4095) | /\*\* |
| [4096](#L4096) | \* Callback function of [bookingpress\_company\_phone] shortcode |
| [4097](#L4097) | \* |
| [4098](#L4098) | \* @return void |
| [4099](#L4099) | \*/ |
| [4100](#L4100) | function bookingpress\_company\_phone\_func() |
| [4101](#L4101) | { |
| [4102](#L4102) | global $BookingPress; |
| [4103](#L4103) | $BookingPress->set\_front\_css(1); |
| [4104](#L4104) | $BookingPress->set\_front\_js(1); |
| [4105](#L4105) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [4106](#L4106) |  |
| [4107](#L4107) | $content                      = ''; |
| [4108](#L4108) | $bookingpress\_company\_phone   = $BookingPress->bookingpress\_get\_settings('company\_phone\_number', 'company\_setting'); |
| [4109](#L4109) | $bookingpress\_company\_country = $BookingPress->bookingpress\_get\_settings('company\_phone\_country', 'company\_setting'); |
| [4110](#L4110) |  |
| [4111](#L4111) | if ($bookingpress\_company\_phone != '' ) { |
| [4112](#L4112) | $content = esc\_html($bookingpress\_company\_phone); |
| [4113](#L4113) | } else { |
| [4114](#L4114) | $content = esc\_html\_e('Company phone number not found', 'bookingpress-appointment-booking'); |
| [4115](#L4115) | } |
| [4116](#L4116) | return $content; |
| [4117](#L4117) | } |
| [4118](#L4118) |  |
| [4119](#L4119) | /\*\* |
| [4120](#L4120) | \* Function for add/update appointment |
| [4121](#L4121) | \* |
| [4122](#L4122) | \* @return void |
| [4123](#L4123) | \*/ |
| [4124](#L4124) | function bookingpress\_save\_appointment\_booking\_func() |
| [4125](#L4125) | { |
| [4126](#L4126) | global $wpdb, $BookingPress, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customer\_bookings, $tbl\_bookingpress\_customers, $bookingpress\_payment\_gateways, $bookingpress\_debug\_payment\_log\_id; |
| [4127](#L4127) | $response              = array(); |
| [4128](#L4128) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4129](#L4129) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4130](#L4130) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4131](#L4131) | $response['variant'] = 'error'; |
| [4132](#L4132) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4133](#L4133) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4134](#L4134) | wp\_send\_json($response); |
| [4135](#L4135) | die(); |
| [4136](#L4136) | } |
| [4137](#L4137) | $response['variant']       = 'error'; |
| [4138](#L4138) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4139](#L4139) | $response['msg']           = esc\_html\_\_('Something went wrong..', 'bookingpress-appointment-booking'); |
| [4140](#L4140) | $response['is\_redirect']   = 0; |
| [4141](#L4141) | $response['redirect\_data'] = ''; |
| [4142](#L4142) | $response['is\_spam']       = 1; |
| [4143](#L4143) |  |
| [4144](#L4144) | if( !empty( $\_REQUEST['appointment\_data'] ) && !is\_array( $\_REQUEST['appointment\_data'] ) ){ |
| [4145](#L4145) | $\_REQUEST['appointment\_data'] = json\_decode( stripslashes\_deep( $\_REQUEST['appointment\_data'] ), true ); //phpcs:ignore |
| [4146](#L4146) | $\_POST['appointment\_data'] = $\_REQUEST['appointment\_data'] =  !empty($\_REQUEST['appointment\_data']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_REQUEST['appointment\_data'] ) : array(); // phpcs:ignore |
| [4147](#L4147) | } |
| [4148](#L4148) |  |
| [4149](#L4149) | $response = apply\_filters('bookingpress\_validate\_spam\_protection', $response, array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data'])); // phpcs:ignore |
| [4150](#L4150) |  |
| [4151](#L4151) | $booking\_response = $this->bookingpress\_before\_book\_appointment\_func(); |
| [4152](#L4152) |  |
| [4153](#L4153) | if( !empty( $booking\_response ) ){ |
| [4154](#L4154) | $booking\_response\_arr = json\_decode( $booking\_response, true ); |
| [4155](#L4155) | if( !empty( $booking\_response\_arr['variant'] ) && 'error' == $booking\_response\_arr['variant'] ){ |
| [4156](#L4156) | if(!empty($booking\_response\_arr['msg'])) { |
| [4157](#L4157) | $booking\_response\_arr['msg'] = stripslashes\_deep(html\_entity\_decode($booking\_response\_arr['msg'],ENT\_QUOTES)); |
| [4158](#L4158) | } |
| [4159](#L4159) | wp\_send\_json($booking\_response\_arr); |
| [4160](#L4160) | die; |
| [4161](#L4161) | } |
| [4162](#L4162) | } |
| [4163](#L4163) |  |
| [4164](#L4164) | $appointment\_booked\_successfully = $BookingPress->bookingpress\_get\_settings('appointment\_booked\_successfully', 'message\_setting'); |
| [4165](#L4165) |  |
| [4166](#L4166) | if (! empty($\_REQUEST) && ! empty($\_REQUEST['appointment\_data']) ) { |
| [4167](#L4167) |  |
| [4168](#L4168) | $bookingpress\_appointment\_data            = array\_map(array( $BookingPress, 'appointment\_sanatize\_field' ), $\_REQUEST['appointment\_data']); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized --Reason - $\_GET['appointment\_data'] contains mixed array and sanitized properly using 'appointment\_sanatize\_field' function |
| [4169](#L4169) | $bookingpress\_payment\_gateway             = ! empty($bookingpress\_appointment\_data['selected\_payment\_method']) ? $bookingpress\_appointment\_data['selected\_payment\_method'] : ''; |
| [4170](#L4170) | $bookingpress\_appointment\_on\_site\_enabled = ( $bookingpress\_appointment\_data['selected\_payment\_method'] == 'onsite' ) ? 1 : 0; |
| [4171](#L4171) | $payment\_gateway                          = ( $bookingpress\_appointment\_on\_site\_enabled ) ? 'on-site' : $bookingpress\_payment\_gateway; |
| [4172](#L4172) |  |
| [4173](#L4173) | $bookingpress\_service\_price = isset($bookingpress\_appointment\_data['service\_price\_without\_currency']) ? floatval($bookingpress\_appointment\_data['service\_price\_without\_currency']) : 0; |
| [4174](#L4174) | if ($bookingpress\_service\_price == 0 ) { |
| [4175](#L4175) | $payment\_gateway = ' - '; |
| [4176](#L4176) | } |
| [4177](#L4177) |  |
| [4178](#L4178) | $bpa\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
| [4179](#L4179) |  |
| [4180](#L4180) | $bpa\_service\_data               = $BookingPress->get\_service\_by\_id( $bpa\_selected\_service ); |
| [4181](#L4181) | $bpa\_service\_amount             = ! empty($bpa\_service\_data['bookingpress\_service\_price']) ? (float) $bpa\_service\_data['bookingpress\_service\_price'] : 0; |
| [4182](#L4182) |  |
| [4183](#L4183) | if( $bpa\_service\_amount != $bookingpress\_service\_price ){ |
| [4184](#L4184) | $bookingpress\_invalid\_amount = esc\_html\_\_('Sorry! Appointment could not be processed', 'bookingpress-appointment-booking'); |
| [4185](#L4185) |  |
| [4186](#L4186) | $response['variant']       = 'error'; |
| [4187](#L4187) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4188](#L4188) | $response['msg']           = $bookingpress\_invalid\_amount; |
| [4189](#L4189) | $response['is\_redirect']   = 0; |
| [4190](#L4190) | $response['reason']        = 'price mismatched ' . $bpa\_service\_amount . ' --- ' . $bookingpress\_service\_price; |
| [4191](#L4191) | $response['redirect\_data'] = ''; |
| [4192](#L4192) | $response['is\_spam']       = 0; |
| [4193](#L4193) |  |
| [4194](#L4194) | echo wp\_json\_encode($response); |
| [4195](#L4195) | exit; |
| [4196](#L4196) | } |
| [4197](#L4197) |  |
| [4198](#L4198) | $bookingpress\_return\_data = apply\_filters('bookingpress\_validate\_submitted\_form', $payment\_gateway, $bookingpress\_appointment\_data); |
| [4199](#L4199) |  |
| [4200](#L4200) | if ($payment\_gateway == 'on-site' && $bookingpress\_service\_price > 0 ) { |
| [4201](#L4201) | $entry\_id = ! empty($bookingpress\_return\_data['entry\_id']) ? $bookingpress\_return\_data['entry\_id'] : 0; |
| [4202](#L4202) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('onsite\_appointment\_status', 'general\_setting'); |
| [4203](#L4203) |  |
| [4204](#L4204) | if($bookingpress\_appointment\_status ==  '1' ) { |
| [4205](#L4205) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '1', '', '', 1); |
| [4206](#L4206) | $bookingpress\_redirect\_url = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4207](#L4207) | } else { |
| [4208](#L4208) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '2', '', '', 1); |
| [4209](#L4209) | $bookingpress\_redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4210](#L4210) | } |
| [4211](#L4211) | if (! empty($bookingpress\_redirect\_url) ) { |
| [4212](#L4212) | $response['variant']       = 'redirect\_url'; |
| [4213](#L4213) | $response['title']         = ''; |
| [4214](#L4214) | $response['msg']           = ''; |
| [4215](#L4215) | $response['is\_redirect']   = 1; |
| [4216](#L4216) | $response['redirect\_data'] = $bookingpress\_redirect\_url; |
| [4217](#L4217) | } else { |
| [4218](#L4218) | $response['variant'] = 'success'; |
| [4219](#L4219) | $response['title']   = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [4220](#L4220) | $response['msg']     = esc\_html($appointment\_booked\_successfully); |
| [4221](#L4221) | } |
| [4222](#L4222) | } elseif ($bookingpress\_service\_price == 0 ) { |
| [4223](#L4223) | $entry\_id = ! empty($bookingpress\_return\_data['entry\_id']) ? $bookingpress\_return\_data['entry\_id'] : 0; |
| [4224](#L4224) | $bookingpress\_payment\_gateways->bookingpress\_confirm\_booking($entry\_id, array(), '1', '', '', 1); |
| [4225](#L4225) |  |
| [4226](#L4226) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4227](#L4227) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [4228](#L4228) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [4229](#L4229) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4230](#L4230) | } |
| [4231](#L4231) |  |
| [4232](#L4232) | $bookingpress\_redirect\_url = $redirect\_url; |
| [4233](#L4233) | if (! empty($bookingpress\_redirect\_url) ) { |
| [4234](#L4234) | $response['variant']       = 'redirect\_url'; |
| [4235](#L4235) | $response['title']         = ''; |
| [4236](#L4236) | $response['msg']           = ''; |
| [4237](#L4237) | $response['is\_redirect']   = 1; |
| [4238](#L4238) | $response['redirect\_data'] = $bookingpress\_redirect\_url; |
| [4239](#L4239) | } else { |
| [4240](#L4240) | $response['variant'] = 'success'; |
| [4241](#L4241) | $response['title']   = esc\_html\_\_('Success', 'bookingpress-appointment-booking'); |
| [4242](#L4242) | $response['msg']     = esc\_html($appointment\_booked\_successfully); |
| [4243](#L4243) | } |
| [4244](#L4244) | } else { |
| [4245](#L4245) | if ($payment\_gateway == 'paypal' ) { |
| [4246](#L4246) | $bookingpress\_payment\_mode    = $BookingPress->bookingpress\_get\_settings('paypal\_payment\_mode', 'payment\_setting'); |
| [4247](#L4247) | $bookingpress\_is\_sandbox\_mode = ( $bookingpress\_payment\_mode != 'live' ) ? true : false; |
| [4248](#L4248) | $bookingpress\_gateway\_status  = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [4249](#L4249) | $bookingpress\_merchant\_email  = $BookingPress->bookingpress\_get\_settings('paypal\_merchant\_email', 'payment\_setting'); |
| [4250](#L4250) | $bookingpress\_api\_username    = $BookingPress->bookingpress\_get\_settings('paypal\_api\_username', 'payment\_setting'); |
| [4251](#L4251) | $bookingpress\_api\_password    = $BookingPress->bookingpress\_get\_settings('paypal\_api\_password', 'payment\_setting'); |
| [4252](#L4252) | $bookingpress\_api\_signature   = $BookingPress->bookingpress\_get\_settings('paypal\_api\_signature', 'payment\_setting'); |
| [4253](#L4253) |  |
| [4254](#L4254) | $bookingpress\_paypal\_error\_msg  = esc\_html\_\_('PayPal Configuration Error', 'bookingpress-appointment-booking'); |
| [4255](#L4255) | $bookingpress\_paypal\_error\_msg .= ': '; |
| [4256](#L4256) | if (empty($bookingpress\_merchant\_email) ) { |
| [4257](#L4257) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure merchant email address', 'bookingpress-appointment-booking'); |
| [4258](#L4258) |  |
| [4259](#L4259) | $response['variant']       = 'error'; |
| [4260](#L4260) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4261](#L4261) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4262](#L4262) | $response['is\_redirect']   = 0; |
| [4263](#L4263) | $response['redirect\_data'] = ''; |
| [4264](#L4264) | $response['is\_spam']       = 0; |
| [4265](#L4265) |  |
| [4266](#L4266) | echo wp\_json\_encode($response); |
| [4267](#L4267) | exit; |
| [4268](#L4268) | } |
| [4269](#L4269) |  |
| [4270](#L4270) | if (empty($bookingpress\_api\_username) ) { |
| [4271](#L4271) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Username', 'bookingpress-appointment-booking'); |
| [4272](#L4272) |  |
| [4273](#L4273) | $response['variant']       = 'error'; |
| [4274](#L4274) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4275](#L4275) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4276](#L4276) | $response['is\_redirect']   = 0; |
| [4277](#L4277) | $response['redirect\_data'] = ''; |
| [4278](#L4278) | $response['is\_spam']       = 0; |
| [4279](#L4279) |  |
| [4280](#L4280) | echo wp\_json\_encode($response); |
| [4281](#L4281) | exit; |
| [4282](#L4282) | } |
| [4283](#L4283) |  |
| [4284](#L4284) | if (empty($bookingpress\_api\_password) ) { |
| [4285](#L4285) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Password', 'bookingpress-appointment-booking'); |
| [4286](#L4286) |  |
| [4287](#L4287) | $response['variant']       = 'error'; |
| [4288](#L4288) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4289](#L4289) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4290](#L4290) | $response['is\_redirect']   = 0; |
| [4291](#L4291) | $response['redirect\_data'] = ''; |
| [4292](#L4292) | $response['is\_spam']       = 0; |
| [4293](#L4293) |  |
| [4294](#L4294) | echo wp\_json\_encode($response); |
| [4295](#L4295) | exit; |
| [4296](#L4296) | } |
| [4297](#L4297) |  |
| [4298](#L4298) | if (empty($bookingpress\_api\_signature) ) { |
| [4299](#L4299) | $bookingpress\_paypal\_error\_msg .= esc\_html\_\_('Please configure PayPal API Signature', 'bookingpress-appointment-booking'); |
| [4300](#L4300) |  |
| [4301](#L4301) | $response['variant']       = 'error'; |
| [4302](#L4302) | $response['title']         = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4303](#L4303) | $response['msg']           = $bookingpress\_paypal\_error\_msg; |
| [4304](#L4304) | $response['is\_redirect']   = 0; |
| [4305](#L4305) | $response['redirect\_data'] = ''; |
| [4306](#L4306) | $response['is\_spam']       = 0; |
| [4307](#L4307) |  |
| [4308](#L4308) | echo wp\_json\_encode($response); |
| [4309](#L4309) | exit; |
| [4310](#L4310) | } |
| [4311](#L4311) |  |
| [4312](#L4312) | $entry\_id                          = $bookingpress\_return\_data['entry\_id']; |
| [4313](#L4313) | $currency                          = $bookingpress\_return\_data['currency']; |
| [4314](#L4314) | $currency\_symbol                   = $BookingPress->bookingpress\_get\_currency\_code($currency); |
| [4315](#L4315) | $bookingpress\_final\_payable\_amount = isset($bookingpress\_return\_data['payable\_amount']) ? $bookingpress\_return\_data['payable\_amount'] : 0; |
| [4316](#L4316) | $customer\_details                  = $bookingpress\_return\_data['customer\_details']; |
| [4317](#L4317) | $customer\_email                    = ! empty($customer\_details['customer\_email']) ? $customer\_details['customer\_email'] : ''; |
| [4318](#L4318) |  |
| [4319](#L4319) | $bookingpress\_service\_name = ! empty($bookingpress\_return\_data['service\_data']['bookingpress\_service\_name']) ? $bookingpress\_return\_data['service\_data']['bookingpress\_service\_name'] : esc\_html\_\_('Appointment Booking', 'bookingpress-appointment-booking'); |
| [4320](#L4320) |  |
| [4321](#L4321) | $custom\_var = $entry\_id; |
| [4322](#L4322) |  |
| [4323](#L4323) | $sandbox = $bookingpress\_is\_sandbox\_mode ? 'sandbox.' : ''; |
| [4324](#L4324) |  |
| [4325](#L4325) | $notify\_url = $bookingpress\_return\_data['notify\_url']; |
| [4326](#L4326) |  |
| [4327](#L4327) | $redirect\_url                    = $bookingpress\_return\_data['approved\_appointment\_url']; |
| [4328](#L4328) | $bookingpress\_appointment\_status = $BookingPress->bookingpress\_get\_settings('appointment\_status', 'general\_setting'); |
| [4329](#L4329) | if ($bookingpress\_appointment\_status == 'Pending' ) { |
| [4330](#L4330) | $redirect\_url = $bookingpress\_return\_data['pending\_appointment\_url']; |
| [4331](#L4331) | } |
| [4332](#L4332) |  |
| [4333](#L4333) | $bookingpress\_paypal\_cancel\_url\_id = $BookingPress->bookingpress\_get\_customize\_settings('after\_failed\_payment\_redirection', 'booking\_form'); |
| [4334](#L4334) | $bookingpress\_paypal\_cancel\_url = get\_permalink($bookingpress\_paypal\_cancel\_url\_id); |
| [4335](#L4335) | $cancel\_url                     = ! empty($bookingpress\_paypal\_cancel\_url) ? $bookingpress\_paypal\_cancel\_url : BOOKINGPRESS\_HOME\_URL; |
| [4336](#L4336) | $cancel\_url                     = add\_query\_arg('is\_cancel', 1, esc\_url($cancel\_url)); |
| [4337](#L4337) |  |
| [4338](#L4338) | $cmd          = '\_xclick'; |
| [4339](#L4339) | $paypal\_form  = '<form name="\_xclick" id="bookingpress\_paypal\_form" action="https://www.' . $sandbox . 'paypal.com/cgi-bin/webscr" method="post">'; |
| [4340](#L4340) | $paypal\_form .= '<input type="hidden" name="cmd" value="' . $cmd . '" />'; |
| [4341](#L4341) | $paypal\_form .= '<input type="hidden" name="amount" value="' . $bookingpress\_final\_payable\_amount . '" />'; |
| [4342](#L4342) | $paypal\_form .= '<input type="hidden" name="business" value="' . $bookingpress\_merchant\_email . '" />'; |
| [4343](#L4343) | $paypal\_form .= '<input type="hidden" name="notify\_url" value="' . $notify\_url . '" />'; |
| [4344](#L4344) | $paypal\_form .= '<input type="hidden" name="cancel\_return" value="' . $cancel\_url . '" />'; |
| [4345](#L4345) | $paypal\_form .= '<input type="hidden" name="return" value="' . $redirect\_url . '" />'; |
| [4346](#L4346) | $paypal\_form .= '<input type="hidden" name="rm" value="2" />'; |
| [4347](#L4347) | $paypal\_form .= '<input type="hidden" name="lc" value="en\_US" />'; |
| [4348](#L4348) | $paypal\_form .= '<input type="hidden" name="no\_shipping" value="1" />'; |
| [4349](#L4349) | $paypal\_form .= '<input type="hidden" name="custom" value="' . $custom\_var . '" />'; |
| [4350](#L4350) | $paypal\_form .= '<input type="hidden" name="on0" value="user\_email" />'; |
| [4351](#L4351) | $paypal\_form .= '<input type="hidden" name="os0" value="' . $customer\_email . '" />'; |
| [4352](#L4352) | $paypal\_form .= '<input type="hidden" name="currency\_code" value="' . $currency\_symbol . '" />'; |
| [4353](#L4353) | $paypal\_form .= '<input type="hidden" name="page\_style" value="primary" />'; |
| [4354](#L4354) | $paypal\_form .= '<input type="hidden" name="charset" value="UTF-8" />'; |
| [4355](#L4355) | $paypal\_form .= '<input type="hidden" name="item\_name" value="' . $bookingpress\_service\_name . '" />'; |
| [4356](#L4356) | $paypal\_form .= '<input type="hidden" name="item\_number" value="1" />'; |
| [4357](#L4357) | $paypal\_form .= '<input type="submit" value="Pay with PayPal!" />'; |
| [4358](#L4358) | $paypal\_form .= '</form>'; |
| [4359](#L4359) |  |
| [4360](#L4360) | do\_action('bookingpress\_payment\_log\_entry', 'paypal', 'payment form redirected data', 'bookingpress', $paypal\_form, $bookingpress\_debug\_payment\_log\_id); |
| [4361](#L4361) |  |
| [4362](#L4362) | $paypal\_form .= '<script type="text/javascript">document.getElementById("bookingpress\_paypal\_form").submit();</script>'; |
| [4363](#L4363) |  |
| [4364](#L4364) | $response['variant']       = 'redirect'; |
| [4365](#L4365) | $response['title']         = ''; |
| [4366](#L4366) | $response['msg']           = ''; |
| [4367](#L4367) | $response['is\_redirect']   = 1; |
| [4368](#L4368) | $response['redirect\_data'] = $paypal\_form; |
| [4369](#L4369) | $response['entry\_id']      = $entry\_id; |
| [4370](#L4370) | } |
| [4371](#L4371) | } |
| [4372](#L4372) | } |
| [4373](#L4373) |  |
| [4374](#L4374) | echo wp\_json\_encode($response); |
| [4375](#L4375) | exit(); |
| [4376](#L4376) | } |
| [4377](#L4377) |  |
| [4378](#L4378) |  |
| [4379](#L4379) | /\*\* |
| [4380](#L4380) | \* Function for retrieve booking time slots |
| [4381](#L4381) | \* |
| [4382](#L4382) | \* @param  mixed $selected\_date          Pass selected date |
| [4383](#L4383) | \* @param  mixed $return                 If paramter set to true then timeslots data will return |
| [4384](#L4384) | \* @param  mixed $check\_for\_whole\_days   Time should be check for whole day or not |
| [4385](#L4385) | \* @param  mixed $check\_only\_one\_slot    Check only for one available slots or not |
| [4386](#L4386) | \* @return void |
| [4387](#L4387) | \*/ |
| [4388](#L4388) | function bookingpress\_retrieve\_timeslots( $selected\_date = '' , $return = false, $check\_for\_whole\_days = false, $check\_only\_one\_slot = false, $total\_booked\_appiontments = [] ){ |
| [4389](#L4389) |  |
| [4390](#L4390) | global $wpdb, $BookingPress, $tbl\_bookingpress\_services, $bookingpress\_global\_options, $bookingpress\_other\_debug\_log\_id, $tbl\_bookingpress\_appointment\_bookings, $bookingpress\_services, $bookingpress\_other\_debug\_log\_id; |
| [4391](#L4391) |  |
| [4392](#L4392) | $response              = array(); |
| [4393](#L4393) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4394](#L4394) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4395](#L4395) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4396](#L4396) | $response['variant'] = 'error'; |
| [4397](#L4397) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4398](#L4398) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4399](#L4399) | echo wp\_json\_encode($response); |
| [4400](#L4400) | exit(); |
| [4401](#L4401) | } |
| [4402](#L4402) | if(!empty($\_POST['appointment\_data\_obj']) && !is\_array($\_POST['appointment\_data\_obj'])) { |
| [4403](#L4403) | $\_POST['appointment\_data\_obj'] = !empty( $\_POST['appointment\_data\_obj'] ) ? json\_decode( stripslashes\_deep( $\_POST['appointment\_data\_obj'] ), true ) : array(); //phpcs:ignore |
| [4404](#L4404) | $\_POST['appointment\_data\_obj'] =  !empty($\_POST['appointment\_data\_obj']) ? array\_map(array($this,'bookingpress\_boolean\_type\_cast'), $\_POST['appointment\_data\_obj'] ) : array(); // phpcs:ignore |
| [4405](#L4405) | } |
| [4406](#L4406) |  |
| [4407](#L4407) | $selected\_service\_id =  ! empty($\_POST['service\_id']) ? intval($\_POST['service\_id']) : 0; |
| [4408](#L4408) | if( empty( $selected\_service\_id ) ){ |
| [4409](#L4409) | $selected\_service\_id = !empty( $\_POST['appointment\_data\_obj']['selected\_service'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service'] ) : ( !empty( $\_POST['selected\_service'] ) ? intval( $\_POST['selected\_service'] ) : 0 ); |
| [4410](#L4410) | } |
| [4411](#L4411) |  |
| [4412](#L4412) | if( empty( $selected\_date ) ){ |
| [4413](#L4413) | $selected\_date       = ! empty($\_POST['selected\_date']) ? date('Y-m-d', strtotime(sanitize\_text\_field($\_POST['selected\_date']))) : date('Y-m-d',current\_time('timestamp')); |
| [4414](#L4414) | } |
| [4415](#L4415) | $service\_timings = array(); |
| [4416](#L4416) |  |
| [4417](#L4417) | $service\_timings\_data = array( |
| [4418](#L4418) | 'is\_daysoff' => false, |
| [4419](#L4419) | 'service\_timings' => array() |
| [4420](#L4420) | ); |
| [4421](#L4421) |  |
| [4422](#L4422) | $bookingpress\_form\_token = (isset($\_POST['appointment\_data\_obj']['bookingpress\_form\_token']))?sanitize\_text\_field($\_POST['appointment\_data\_obj']['bookingpress\_form\_token']):''; |
| [4423](#L4423) | if(empty($bookingpress\_form\_token)){ |
| [4424](#L4424) | $bookingpress\_form\_token = (isset($\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id']))?sanitize\_text\_field($\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id']):''; |
| [4425](#L4425) | } |
| [4426](#L4426) | //$bookingpress\_form\_token = !empty( $\_POST['appointment\_data\_obj']['bookingpress\_form\_token'] ) ? sanitize\_text\_field( $\_POST['appointment\_data\_obj']['bookingpress\_form\_token'] ) : sanitize\_text\_field( $\_POST['appointment\_data\_obj']['bookingpress\_uniq\_id'] ) ; |
| [4427](#L4427) |  |
| [4428](#L4428) | $no\_timeslots\_available = $BookingPress->bookingpress\_get\_settings('no\_timeslots\_available', 'message\_setting'); |
| [4429](#L4429) |  |
| [4430](#L4430) | /\*\* filter to check minimum time requirement \*/ |
| [4431](#L4431) | $minimum\_time\_required = 'disabled'; |
| [4432](#L4432) | $minimum\_time\_required = apply\_filters( 'bookingpress\_retrieve\_minimum\_required\_time', $minimum\_time\_required, $selected\_service\_id ); |
| [4433](#L4433) |  |
| [4434](#L4434) | /\*\* Check for the available capacity \*/ |
| [4435](#L4435) | $max\_service\_capacity = 1; |
| [4436](#L4436) | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $selected\_service\_id ); |
| [4437](#L4437) |  |
| [4438](#L4438) | /\*\* timeslot steps settings \*/ |
| [4439](#L4439) | $bookingpress\_show\_time\_as\_per\_service\_duration = $BookingPress->bookingpress\_get\_settings( 'show\_time\_as\_per\_service\_duration', 'general\_setting' ); |
| [4440](#L4440) | $bookingpress\_shared\_service\_timeslot = $BookingPress->bookingpress\_get\_settings('share\_timeslot\_between\_services', 'general\_setting'); |
| [4441](#L4441) | /\*\* total booked appointment of the selected date \*/ |
| [4442](#L4442) | $where\_clause = ''; |
| [4443](#L4443) | if( 'true' != $bookingpress\_shared\_service\_timeslot ){ |
| [4444](#L4444) | $where\_clause = $wpdb->prepare( ' AND bookingpress\_service\_id = %d ', $selected\_service\_id ); |
| [4445](#L4445) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_where\_clause', $where\_clause ); |
| [4446](#L4446) | }else{ |
| [4447](#L4447) | $where\_clause = apply\_filters( 'bookingpress\_booked\_appointment\_with\_share\_timeslot\_where\_clause\_check', $where\_clause,$selected\_service\_id); |
| [4448](#L4448) | } |
| [4449](#L4449) |  |
| [4450](#L4450) | $where\_clause .= $wpdb->prepare( ' AND (bookingpress\_appointment\_status = %s OR bookingpress\_appointment\_status = %s)', '1', '2' ); |
| [4451](#L4451) |  |
| [4452](#L4452) | $bookingpress\_hide\_already\_booked\_slot = $BookingPress->bookingpress\_get\_customize\_settings( 'hide\_already\_booked\_slot', 'booking\_form' ); |
| [4453](#L4453) | $bookingpress\_hide\_already\_booked\_slot = ( $bookingpress\_hide\_already\_booked\_slot == 'true' ) ? 1 : 0; |
| [4454](#L4454) | $bookingpress\_hide\_already\_booked\_slot = apply\_filters( 'bookingpress\_change\_hide\_already\_booked\_slot\_for\_service', $bookingpress\_hide\_already\_booked\_slot, $selected\_service\_id); |
| [4455](#L4455) |  |
| [4456](#L4456) |  |
| [4457](#L4457) | $bpa\_appointment\_edit\_id = !empty( $\_POST['appointment\_data\_obj']['appointment\_update\_id'] ) ? intval( $\_POST['appointment\_data\_obj']['appointment\_update\_id'] ) : 0; |
| [4458](#L4458) |  |
| [4459](#L4459) | if( !empty( $bpa\_appointment\_edit\_id ) ){ |
| [4460](#L4460) | $where\_clause .= $wpdb->prepare( ' AND bookingpress\_appointment\_booking\_id != %d', $bpa\_appointment\_edit\_id ); |
| [4461](#L4461) | } |
| [4462](#L4462) |  |
| [4463](#L4463) | if( empty( $total\_booked\_appiontments ) && !empty( $\_POST['action'] ) && in\_array( $\_POST['action'], ['bookingpress\_front\_get\_timings' ,'bookingpress\_get\_disable\_date','bookingpress\_get\_whole\_day\_appointments', 'bookingpress\_get\_recurring\_appointments' ] ) ){ |
| [4464](#L4464) |  |
| [4465](#L4465) | $where\_clause\_overnight\_booking = apply\_filters( 'bookingpress\_modify\_where\_clause\_for\_overnight\_booking', '', $selected\_date ); |
| [4466](#L4466) | $total\_booked\_appiontments = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE (bookingpress\_appointment\_date = %s $where\_clause\_overnight\_booking) $where\_clause", $selected\_date), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [4467](#L4467) | } |
| [4468](#L4468) |  |
| [4469](#L4469) | $shared\_quantity = apply\_filters('bookingpress\_get\_shared\_capacity\_data', 'true' ); |
| [4470](#L4470) |  |
| [4471](#L4471) | /\*\* service buffer times ends \*/ |
| [4472](#L4472) |  |
| [4473](#L4473) | /\*\* retrieving staff member and service time slots \*/ |
| [4474](#L4474) | $service\_timings\_data = apply\_filters('bookingpress\_retrieve\_pro\_modules\_timeslots', $service\_timings\_data, $selected\_service\_id, $selected\_date, $minimum\_time\_required, $max\_service\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration ); |
| [4475](#L4475) |  |
| [4476](#L4476) | if( empty( $service\_timings\_data['service\_timings'] ) && false == $service\_timings\_data['is\_daysoff'] ){ |
| [4477](#L4477) | $service\_timings = $BookingPress->bookinpgress\_retrieve\_default\_workhours($selected\_service\_id, $selected\_date, $minimum\_time\_required, $max\_service\_capacity, $bookingpress\_show\_time\_as\_per\_service\_duration); |
| [4478](#L4478) | } else { |
| [4479](#L4479) | $service\_timings = $service\_timings\_data['service\_timings']; |
| [4480](#L4480) | } |
| [4481](#L4481) |  |
| [4482](#L4482) | if( true == $check\_only\_one\_slot ){ |
| [4483](#L4483) | if( 0 < count( $service\_timings ) ){ |
| [4484](#L4484) | return true; |
| [4485](#L4485) | } else { |
| [4486](#L4486) | return false; |
| [4487](#L4487) | } |
| [4488](#L4488) | } |
| [4489](#L4489) |  |
| [4490](#L4490) | wp\_cache\_delete( 'bpa\_total\_booked\_appointment\_' . $selected\_date ); |
| [4491](#L4491) |  |
| [4492](#L4492) | $selected\_service\_duration\_unit = !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit']) ? sanitize\_text\_field($\_POST['appointment\_data\_obj']['selected\_service\_duration\_unit']) : ''; |
| [4493](#L4493) | $selected\_service\_duration\_val = !empty( $\_POST['appointment\_data\_obj']['selected\_service\_duration'] ) ? intval( $\_POST['appointment\_data\_obj']['selected\_service\_duration'] ) : ''; |
| [4494](#L4494) |  |
| [4495](#L4495) | $total\_booked\_appiontments = apply\_filters( 'bookingpress\_modify\_booked\_appointment\_data', $total\_booked\_appiontments, $selected\_date, $service\_timings, $selected\_service\_id ); |
| [4496](#L4496) |  |
| [4497](#L4497) | /\*\* Remove Booked Time Slots from the final service timings - start \*/ |
| [4498](#L4498) |  |
| [4499](#L4499) | if( !empty( $total\_booked\_appiontments ) && 'd' == $selected\_service\_duration\_unit && 1 == $selected\_service\_duration\_val && empty( $service\_timings ) ){ |
| [4500](#L4500) |  |
| [4501](#L4501) | $service\_timings = array( |
| [4502](#L4502) | array( |
| [4503](#L4503) | 'start\_time' => '00:00', |
| [4504](#L4504) | 'end\_time' => '00:00', |
| [4505](#L4505) | 'store\_start\_time' => '00:00', |
| [4506](#L4506) | 'store\_end\_time' => '00:00', |
| [4507](#L4507) | 'break\_start\_time' => '', |
| [4508](#L4508) | 'break\_end\_time' => '', |
| [4509](#L4509) | 'store\_service\_date' => $selected\_date, |
| [4510](#L4510) | 'is\_booked' => 0, |
| [4511](#L4511) | 'max\_capacity' => $max\_service\_capacity, |
| [4512](#L4512) | 'total\_booked' => '' |
| [4513](#L4513) | ) |
| [4514](#L4514) | ); |
| [4515](#L4515) | } |
| [4516](#L4516) |  |
| [4517](#L4517) | $bpa\_remove\_crossed\_time = apply\_filters( 'bookingpress\_remove\_crossed\_timeslot', true); |
| [4518](#L4518) |  |
| [4519](#L4519) | $booked\_timing\_keys = array(); |
| [4520](#L4520) |  |
| [4521](#L4521) | $service\_temp\_timings = $service\_timings; |
| [4522](#L4522) |  |
| [4523](#L4523) | if( !empty( $total\_booked\_appiontments ) && !empty( $service\_timings ) ){ |
| [4524](#L4524) | foreach( $total\_booked\_appiontments as $booked\_appointment\_data ){ |
| [4525](#L4525) | $total\_guests = 0; |
| [4526](#L4526) |  |
| [4527](#L4527) | $booked\_appointment\_start\_time = $booked\_appointment\_data['bookingpress\_appointment\_time']; |
| [4528](#L4528) | $booked\_appointment\_end\_time = $booked\_appointment\_data['bookingpress\_appointment\_end\_time']; |
| [4529](#L4529) |  |
| [4530](#L4530) | $booked\_appointment\_start\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_date'] : $selected\_date; |
| [4531](#L4531) | $booked\_appointment\_end\_date = ( !empty( $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) && '0000-00-00' != $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] ) ? $booked\_appointment\_data['bookingpress\_appointment\_end\_date'] : $booked\_appointment\_start\_date; |
| [4532](#L4532) |  |
| [4533](#L4533) | if( '00:00:00' == $booked\_appointment\_end\_time ){ |
| [4534](#L4534) | $booked\_appointment\_end\_time = apply\_filters( 'bookingpress\_modify\_booked\_end\_time','24:00:00', $booked\_appointment\_data ); |
| [4535](#L4535) | } |
| [4536](#L4536) |  |
| [4537](#L4537) | $booked\_appointment\_start\_datetime = $booked\_appointment\_start\_date.' ' . $booked\_appointment\_start\_time; |
| [4538](#L4538) | $booked\_appointment\_end\_datetime = $booked\_appointment\_end\_date.' ' . $booked\_appointment\_end\_time; |
| [4539](#L4539) |  |
| [4540](#L4540) | $tmp\_selected\_date = apply\_filters( 'bookingpress\_consider\_next\_day\_date', $selected\_date, $booked\_appointment\_data, $booked\_appointment\_start\_date ); |
| [4541](#L4541) |  |
| [4542](#L4542) | if( $booked\_appointment\_start\_date != $tmp\_selected\_date ){ |
| [4543](#L4543) | continue; |
| [4544](#L4544) | } |
| [4545](#L4545) |  |
| [4546](#L4546) | foreach( $service\_timings as $sk => $time\_slot\_data ){ |
| [4547](#L4547) | $current\_time\_start = $time\_slot\_data['store\_start\_time'].':00'; |
| [4548](#L4548) | $current\_time\_end = $time\_slot\_data['store\_end\_time'].':00'; |
| [4549](#L4549) |  |
| [4550](#L4550) | $current\_time\_start\_datetime = $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_start; |
| [4551](#L4551) | $current\_time\_end\_datetime = ( !empty( $time\_slot\_data['selected\_end\_date'] ) && '0000-00-00' != $time\_slot\_data['selected\_end\_date'] ) ? ( $time\_slot\_data['selected\_end\_date'] . ' '. $current\_time\_end ) : ( $time\_slot\_data['store\_service\_date'] . ' ' . $current\_time\_end ); |
| [4552](#L4552) |  |
| [4553](#L4553) |  |
| [4554](#L4554) | if( ( $booked\_appointment\_start\_datetime >= $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime <= $current\_time\_end\_datetime ) || ( $booked\_appointment\_start\_datetime < $current\_time\_end\_datetime && $booked\_appointment\_end\_datetime > $current\_time\_start\_datetime ) ){ |
| [4555](#L4555) |  |
| [4556](#L4556) | $bookingpress\_single\_time\_slot\_data = $time\_slot\_data; |
| [4557](#L4557) |  |
| [4558](#L4558) | $service\_timings[ $sk ]['total\_booked']++; |
| [4559](#L4559) | $capacity\_count = 1; |
| [4560](#L4560) | /\*\* increase capacity count if booked appointment has the extra members \*/ |
| [4561](#L4561) |  |
| [4562](#L4562) | $extra\_members = !empty($booked\_appointment\_data['bookingpress\_selected\_extra\_members'] ) ? intval($booked\_appointment\_data['bookingpress\_selected\_extra\_members']) : 0; |
| [4563](#L4563) |  |
| [4564](#L4564) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [4565](#L4565) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [4566](#L4566) | $extra\_members = $extra\_members - 1; |
| [4567](#L4567) | } |
| [4568](#L4568) | } |
| [4569](#L4569) |  |
| [4570](#L4570) | if( isset($booked\_appointment\_data['bookingpress\_selected\_extra\_members']) && $booked\_appointment\_data['bookingpress\_selected\_extra\_members'] > 0 ){ |
| [4571](#L4571) | $capacity\_count += $extra\_members; |
| [4572](#L4572) | $total\_guests = $extra\_members; |
| [4573](#L4573) | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
| [4574](#L4574) | } else { |
| [4575](#L4575) | $service\_timings[ $sk ]['guest\_members'] = $total\_guests; |
| [4576](#L4576) | } |
| [4577](#L4577) |  |
| [4578](#L4578) | /\* Share capacity betweenslot issue fixed start \*/ |
| [4579](#L4579) | $bookingpress\_reduce\_capacity = true; |
| [4580](#L4580) | if( 'true' == $shared\_quantity ){ |
| [4581](#L4581) |  |
| [4582](#L4582) | $max\_capacity = (isset($time\_slot\_data['max\_capacity']))?$time\_slot\_data['max\_capacity']:1; |
| [4583](#L4583) |  |
| [4584](#L4584) | if(isset($service\_temp\_timings[$sk]['booked\_timeslot'])){ |
| [4585](#L4585) |  |
| [4586](#L4586) | $total\_block\_capacity = 0; |
| [4587](#L4587) | foreach( $total\_booked\_appiontments as $booked\_appointment\_data\_for\_total ){ |
| [4588](#L4588) | $total\_guests = 0; |
| [4589](#L4589) | $booked\_appointment\_start\_time\_new = $booked\_appointment\_data\_for\_total['bookingpress\_appointment\_time']; |
| [4590](#L4590) | $booked\_appointment\_end\_time\_new = $booked\_appointment\_data\_for\_total['bookingpress\_appointment\_end\_time']; |
| [4591](#L4591) | if( ( $booked\_appointment\_start\_time\_new >= $current\_time\_start && $booked\_appointment\_end\_time\_new <= $current\_time\_end ) || ( $booked\_appointment\_start\_time\_new < $current\_time\_end && $booked\_appointment\_end\_time\_new > $current\_time\_start) ){ |
| [4592](#L4592) | if( isset($booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members']) && $booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members'] > 0 ){ |
| [4593](#L4593) | $block\_capacity\_count = $booked\_appointment\_data\_for\_total['bookingpress\_selected\_extra\_members']; |
| [4594](#L4594) | } else { |
| [4595](#L4595) | $block\_capacity\_count = 1; |
| [4596](#L4596) | } |
| [4597](#L4597) | $total\_block\_capacity = $total\_block\_capacity + $block\_capacity\_count; |
| [4598](#L4598) | } |
| [4599](#L4599) | } |
| [4600](#L4600) |  |
| [4601](#L4601) | $booked\_timeslot\_data = $service\_temp\_timings[$sk]['booked\_timeslot']; |
| [4602](#L4602) | if(!empty($booked\_timeslot\_data) && $max\_capacity > $total\_block\_capacity){ |
| [4603](#L4603) | foreach($booked\_timeslot\_data as $booked\_slot){ |
| [4604](#L4604) | $start\_time = $booked\_slot['start\_time']; |
| [4605](#L4605) | $end\_time = $booked\_slot['end\_time']; |
| [4606](#L4606) | $block\_cap\_count = $booked\_slot['capacity\_count']; |
| [4607](#L4607) | if($booked\_appointment\_start\_time > $start\_time && $booked\_appointment\_start\_time >= $end\_time){ |
| [4608](#L4608) | if($capacity\_count > $block\_cap\_count){ |
| [4609](#L4609) | $final\_capacity\_count = $capacity\_count - $block\_cap\_count; |
| [4610](#L4610) | $capacity\_count = $capacity\_count+$final\_capacity\_count; |
| [4611](#L4611) | }else{ |
| [4612](#L4612) | $bookingpress\_reduce\_capacity = false; |
| [4613](#L4613) | } |
| [4614](#L4614) | } |
| [4615](#L4615) | } |
| [4616](#L4616) | } |
| [4617](#L4617) | } |
| [4618](#L4618) | $service\_temp\_timings[$sk]['booked\_timeslot'][] = array('start\_time'=>$booked\_appointment\_start\_time,'end\_time'=>$booked\_appointment\_end\_time,'capacity\_count'=>$capacity\_count); |
| [4619](#L4619) | if(!$bookingpress\_reduce\_capacity){ |
| [4620](#L4620) | $service\_timings[ $sk ] = $bookingpress\_single\_time\_slot\_data; |
| [4621](#L4621) | continue; |
| [4622](#L4622) | } |
| [4623](#L4623) |  |
| [4624](#L4624) | } |
| [4625](#L4625) | /\* Share capacity betweenslot issue fixed start \*/ |
| [4626](#L4626) |  |
| [4627](#L4627) | if( 'true' == $shared\_quantity ){ |
| [4628](#L4628) | $service\_timings[ $sk ]['max\_capacity'] -= $capacity\_count; |
| [4629](#L4629) | if( $service\_timings[ $sk ]['max\_capacity'] < 0 ){ |
| [4630](#L4630) | $service\_timings[ $sk ]['max\_capacity'] = 0; |
| [4631](#L4631) | } |
| [4632](#L4632) | $service\_timings[ $sk ]['is\_reduced\_capacity'] = true; |
| [4633](#L4633) | } else { |
| [4634](#L4634) | if( $booked\_appointment\_start\_datetime == $current\_time\_start\_datetime && $booked\_appointment\_end\_datetime == $current\_time\_end\_datetime ){ |
| [4635](#L4635) |  |
| [4636](#L4636) | $service\_timings[ $sk ]['max\_capacity'] -= $capacity\_count; // reduce capacity for exact time slot |
| [4637](#L4637) | if( $service\_timings[ $sk ]['max\_capacity'] < 0 ){ |
| [4638](#L4638) | $service\_timings[ $sk ]['max\_capacity'] = 0; |
| [4639](#L4639) | } |
| [4640](#L4640) |  |
| [4641](#L4641) | if( 0 == $service\_timings[ $sk ]['max\_capacity'] ){ |
| [4642](#L4642) | $service\_timings[ $sk ]['is\_booked'] = 1; |
| [4643](#L4643) | } |
| [4644](#L4644) | /\*\* reputelog - need to check once \*/ |
| [4645](#L4645) | if( isset( $booked\_appointment\_data['bookingpress\_appointment\_booking\_id'] )){ |
| [4646](#L4646) |  |
| [4647](#L4647) | $booked\_timing\_keys[ $booked\_appointment\_data['bookingpress\_appointment\_booking\_id'] ] = $sk; |
| [4648](#L4648) | } |
| [4649](#L4649) | } else { |
| [4650](#L4650) | /\*\* Removed time slot for booking if the booked appointment's time slots are crossed between time slots and capacity is not sharing \*/ |
| [4651](#L4651) | if( true == $bpa\_remove\_crossed\_time ){ |
| [4652](#L4652) | unset( $service\_timings[ $sk ] ); |
| [4653](#L4653) | } |
| [4654](#L4654) | } |
| [4655](#L4655) | } |
| [4656](#L4656) |  |
| [4657](#L4657) | /\*\* Filter to Check BAWY \*/ |
| [4658](#L4658) | $service\_timings = apply\_filters( 'bookingpress\_modify\_timeslot\_data\_for\_bawy', $service\_timings, $sk ); |
| [4659](#L4659) |  |
| [4660](#L4660) | /\*\* shared timeslot \*/ |
| [4661](#L4661) |  |
| [4662](#L4662) | if( 'true' == $bookingpress\_shared\_service\_timeslot && !empty( $service\_timings[$sk] )  ){ |
| [4663](#L4663) | if( empty( $service\_timings[ $sk ]['reason\_for\_not\_available'] ) ){ |
| [4664](#L4664) | $service\_timings[ $sk ]['reason\_for\_not\_available'] = array( 'Due to shared time slot from ' . $booked\_appointment\_start\_time . ' to  ' . $booked\_appointment\_end\_time ); |
| [4665](#L4665) | } else { |
| [4666](#L4666) | $service\_timings[ $sk ]['reason\_for\_not\_available'][] = 'Due to shared time slot from ' . $booked\_appointment\_start\_time . ' to  ' . $booked\_appointment\_end\_time; |
| [4667](#L4667) | } |
| [4668](#L4668) | if( 0 == $service\_timings[ $sk ]['max\_capacity'] ){ |
| [4669](#L4669) | $service\_timings[ $sk ]['is\_booked'] = 1; |
| [4670](#L4670) | } else { |
| [4671](#L4671) | $is\_booked\_flag = isset( $service\_timings[ $sk ]['is\_booked'] ) ? $service\_timings[ $sk ]['is\_booked'] : false; |
| [4672](#L4672) | if( $selected\_service\_id != $booked\_appointment\_data['bookingpress\_service\_id'] ){ |
| [4673](#L4673) | $is\_booked\_flag = true; |
| [4674](#L4674) | } |
| [4675](#L4675) | $service\_timings[ $sk ]['is\_booked'] = apply\_filters( 'bookingpress\_is\_slot\_booked\_with\_share\_timeslot', $is\_booked\_flag, $selected\_service\_id, $booked\_appointment\_data ); |
| [4676](#L4676) | } |
| [4677](#L4677) | } |
| [4678](#L4678) | $service\_timings[ $sk ]['is\_booked\_appointment'] = true; |
| [4679](#L4679) | } |
| [4680](#L4680) |  |
| [4681](#L4681) | $service\_timings[ $sk ]['max\_total\_capacity'] = $max\_service\_capacity; |
| [4682](#L4682) |  |
| [4683](#L4683) | if(!isset( $service\_timings[ $sk ]['store\_start\_time'] ) || !isset($service\_timings[ $sk ]['store\_end\_time'])) { |
| [4684](#L4684) | unset( $service\_timings[ $sk ] ); |
| [4685](#L4685) | } |
| [4686](#L4686) |  |
| [4687](#L4687) | } |
| [4688](#L4688) | } |
| [4689](#L4689) | } |
| [4690](#L4690) |  |
| [4691](#L4691) | /\*\* Remove Booked Time Slots from the final service timings - end \*/ |
| [4692](#L4692) |  |
| [4693](#L4693) | $service\_timings = apply\_filters( 'bookingpress\_check\_available\_timings\_with\_staffmember', $service\_timings, $selected\_service\_id, $selected\_date, $total\_booked\_appiontments ); |
| [4694](#L4694) |  |
| [4695](#L4695) | $service\_timings = apply\_filters( 'bookingpress\_buffer\_calculations', $service\_timings, $total\_booked\_appiontments, $selected\_service\_id, $shared\_quantity, $booked\_timing\_keys ); |
| [4696](#L4696) |  |
| [4697](#L4697) | $service\_timings = array\_values( $service\_timings ); |
| [4698](#L4698) |  |
| [4699](#L4699) | if( true == $check\_for\_whole\_days ){ |
| [4700](#L4700) | $is\_available = false; |
| [4701](#L4701) | foreach( $service\_timings as $sk => $time\_slot\_data ){ |
| [4702](#L4702) | if( !empty( $time\_slot\_data['guest\_members'] ) ){ |
| [4703](#L4703) | $time\_slot\_data['total\_booked'] += $time\_slot\_data['guest\_members']; |
| [4704](#L4704) | } |
| [4705](#L4705) | $current\_time\_start  = $time\_slot\_data['start\_time']; |
| [4706](#L4706) | $current\_time\_end  = $time\_slot\_data['end\_time']; |
| [4707](#L4707) | $service\_max\_capacity = $time\_slot\_data['max\_capacity']; |
| [4708](#L4708) | $total\_booked = $time\_slot\_data['total\_booked']; |
| [4709](#L4709) | $is\_booked = isset( $time\_slot\_data['is\_booked'] ) ? $time\_slot\_data['is\_booked'] : false; |
| [4710](#L4710) |  |
| [4711](#L4711) | $total\_members = apply\_filters( 'bookingpress\_fetch\_bring\_members', 1 ); |
| [4712](#L4712) |  |
| [4713](#L4713) |  |
| [4714](#L4714) |  |
| [4715](#L4715) | if ( !empty( $time\_slot\_data['disable\_timeslot'] ) && 1 == $time\_slot\_data['disable\_timeslot'] ) { |
| [4716](#L4716) | continue; |
| [4717](#L4717) | } else { |
| [4718](#L4718) | if(isset($time\_slot\_data['max\_total\_capacity'])){ |
| [4719](#L4719) | $total\_max\_capacity = $time\_slot\_data['max\_total\_capacity']; |
| [4720](#L4720) | if( !$is\_booked && ( $total\_booked < $total\_max\_capacity || $total\_members < $service\_max\_capacity ) ){ |
| [4721](#L4721) | $is\_available = true; |
| [4722](#L4722) | break; |
| [4723](#L4723) | } |
| [4724](#L4724) | } else{ |
| [4725](#L4725) | if( !$is\_booked && ( $total\_booked < $service\_max\_capacity || $total\_members < $service\_max\_capacity ) ){ |
| [4726](#L4726) | $is\_available = true; |
| [4727](#L4727) | break; |
| [4728](#L4728) | } |
| [4729](#L4729) | } |
| [4730](#L4730) | } |
| [4731](#L4731) |  |
| [4732](#L4732) | } |
| [4733](#L4733) | return $is\_available; |
| [4734](#L4734) | } |
| [4735](#L4735) |  |
| [4736](#L4736) | $bookingpress\_global\_details = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [4737](#L4737) | $bpa\_wp\_default\_time\_format  = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [4738](#L4738) | $bpa\_wp\_default\_time\_format = apply\_filters('bookingpress\_change\_time\_slot\_format',$bpa\_wp\_default\_time\_format); |
| [4739](#L4739) |  |
| [4740](#L4740) | $service\_timings = apply\_filters('bookingpress\_modify\_service\_timings\_data\_filter', $service\_timings, $selected\_service\_id, $selected\_date, $\_POST, $max\_service\_capacity); |
| [4741](#L4741) |  |
| [4742](#L4742) | if(is\_plugin\_active('bookingpress-appointment-booking-pro/bookingpress-appointment-booking-pro.php')){ |
| [4743](#L4743) | $bookingpress\_pro\_version = get\_option( 'bookingpress\_pro\_version'); |
| [4744](#L4744) | if( version\_compare( $bookingpress\_pro\_version, '2.6', '<' ) ){ |
| [4745](#L4745) |  |
| [4746](#L4746) | if(session\_id() == '' OR session\_status() === PHP\_SESSION\_NONE) { |
| [4747](#L4747) | session\_start(); |
| [4748](#L4748) | } |
| [4749](#L4749) | $\_SESSION['front\_timings'] = array(); |
| [4750](#L4750) | $\_SESSION['front\_timings'] = $service\_timings; |
| [4751](#L4751) |  |
| [4752](#L4752) | } |
| [4753](#L4753) | } |
| [4754](#L4754) | if(is\_plugin\_active('bookingpress-cart/bookingpress-cart.php')){ |
| [4755](#L4755) | $bookingpress\_cart\_version = get\_option( 'bookingpress\_cart\_module' ); |
| [4756](#L4756) | if( version\_compare( $bookingpress\_cart\_version, '2.2', '<' ) ){ |
| [4757](#L4757) |  |
| [4758](#L4758) | if(session\_id() == '' OR session\_status() === PHP\_SESSION\_NONE) { |
| [4759](#L4759) | session\_start(); |
| [4760](#L4760) | } |
| [4761](#L4761) | $\_SESSION['front\_timings'] = array(); |
| [4762](#L4762) | $\_SESSION['front\_timings'] = $service\_timings; |
| [4763](#L4763) |  |
| [4764](#L4764) | } |
| [4765](#L4765) | } |
| [4766](#L4766) |  |
| [4767](#L4767) | $bpa\_front\_timings\_key = 'bpa\_front\_timings\_' .$bookingpress\_form\_token.'\_'.$selected\_date; |
| [4768](#L4768) | $bpa\_front\_timings\_key\_old = 'bpa\_front\_timings\_' .$bookingpress\_form\_token; |
| [4769](#L4769) |  |
| [4770](#L4770) | $update\_transient = apply\_filters( 'bookingpress\_modify\_update\_transient\_flag', false ); |
| [4771](#L4771) |  |
| [4772](#L4772) | if( true == $update\_transient ){ |
| [4773](#L4773) | $this->bookingpress\_update\_transient( $bpa\_front\_timings\_key, $service\_timings, HOUR\_IN\_SECONDS ); |
| [4774](#L4774) | } |
| [4775](#L4775) | $time\_token\_data = ''; |
| [4776](#L4776) | if( !empty( $service\_timings ) ){ |
| [4777](#L4777) | $time\_token\_data = base64\_encode( wp\_json\_encode( |
| [4778](#L4778) | [ |
| [4779](#L4779) | 'token\_key' => $bpa\_front\_timings\_key, |
| [4780](#L4780) | 'token\_data' => $service\_timings |
| [4781](#L4781) | ] |
| [4782](#L4782) | ) ); |
| [4783](#L4783) | } |
| [4784](#L4784) |  |
| [4785](#L4785) | /\*\* For premium older version compatability \*/ |
| [4786](#L4786) | if( true == $update\_transient ){ |
| [4787](#L4787) | $bpa\_front\_timings\_expiration = ( 60 \* MINUTE\_IN\_SECONDS ); |
| [4788](#L4788) | set\_transient( $bpa\_front\_timings\_key, $service\_timings, $bpa\_front\_timings\_expiration ); |
| [4789](#L4789) | set\_transient( $bpa\_front\_timings\_key\_old, $service\_timings, $bpa\_front\_timings\_expiration ); |
| [4790](#L4790) | } |
| [4791](#L4791) | /\*\* For premium older version compatability \*/ |
| [4792](#L4792) |  |
| [4793](#L4793) | $morning\_time   = array(); |
| [4794](#L4794) | $afternoon\_time = array(); |
| [4795](#L4795) | $evening\_time   = array(); |
| [4796](#L4796) | $night\_time     = array(); |
| [4797](#L4797) |  |
| [4798](#L4798) | if (! empty($service\_timings) ) { |
| [4799](#L4799) | $an = 1; |
| [4800](#L4800) | $total\_members = apply\_filters( 'bookingpress\_fetch\_bring\_members', 1 ); |
| [4801](#L4801) | foreach ( $service\_timings as $service\_time\_key => $service\_time\_val ) { |
| [4802](#L4802) | if(!empty($service\_time\_val['start\_time']) && $service\_time\_val['end\_time']) { |
| [4803](#L4803) | $service\_start\_time = date('H', strtotime($service\_time\_val['start\_time'])); |
| [4804](#L4804) | $service\_end\_time   = date('H', strtotime($service\_time\_val['end\_time'])); |
| [4805](#L4805) |  |
| [4806](#L4806) | $service\_formatted\_start\_time = date\_i18n($bpa\_wp\_default\_time\_format, strtotime($service\_time\_val['start\_time'])); |
| [4807](#L4807) | $service\_formatted\_end\_time   = date\_i18n($bpa\_wp\_default\_time\_format, strtotime($service\_time\_val['end\_time'])); |
| [4808](#L4808) |  |
| [4809](#L4809) | if( $service\_formatted\_end\_time == '00:00') { |
| [4810](#L4810) | $service\_formatted\_end\_time = '24:00'; |
| [4811](#L4811) | } |
| [4812](#L4812) | $service\_time\_arr = $service\_time\_val; |
| [4813](#L4813) | if( !empty( $service\_time\_arr['guest\_members'] ) ){ |
| [4814](#L4814) | $service\_time\_arr['total\_booked'] += $service\_time\_arr['guest\_members']; |
| [4815](#L4815) | } |
| [4816](#L4816) | $service\_time\_arr['disable\_flag\_timeslot'] = false; |
| [4817](#L4817) | if( $service\_time\_arr['total\_booked'] >= $max\_service\_capacity || $total\_members > $max\_service\_capacity ){ |
| [4818](#L4818) | /\*\* Remove timeslot when Hide already booked time slot option is enabled \*/ |
| [4819](#L4819) | if( !empty( $bookingpress\_hide\_already\_booked\_slot ) && 1 == $bookingpress\_hide\_already\_booked\_slot ){ |
| [4820](#L4820) | unset( $service\_timings[ $service\_time\_key ] ); |
| [4821](#L4821) | continue; |
| [4822](#L4822) | } else { |
| [4823](#L4823) | $service\_time\_arr['disable\_flag\_timeslot'] = true; |
| [4824](#L4824) | } |
| [4825](#L4825) | } |
| [4826](#L4826) | if( !isset( $service\_time\_arr['max\_total\_capacity'] ) ){ |
| [4827](#L4827) | $service\_time\_arr['max\_total\_capacity'] = $max\_service\_capacity; |
| [4828](#L4828) | } |
| [4829](#L4829) |  |
| [4830](#L4830) | $service\_time\_arr = apply\_filters('bookingpress\_modify\_single\_time\_slot\_data',$service\_time\_arr, $selected\_service\_id, $selected\_date); |
| [4831](#L4831) |  |
| [4832](#L4832) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [4833](#L4833) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [4834](#L4834) | if( !$BookingPress->bpa\_is\_pro\_active() ){ |
| [4835](#L4835) | $bookigpress\_time\_format\_for\_booking\_form = ''; |
| [4836](#L4836) | } |
| [4837](#L4837) |  |
| [4838](#L4838) | if($bookigpress\_time\_format\_for\_booking\_form == '1' || $bookigpress\_time\_format\_for\_booking\_form == '2') { |
| [4839](#L4839) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s to %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4840](#L4840) | } |
| [4841](#L4841) | if($bookigpress\_time\_format\_for\_booking\_form == '5' || $bookigpress\_time\_format\_for\_booking\_form == '6'){ |
| [4842](#L4842) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s - %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4843](#L4843) | } |
| [4844](#L4844) | if($bookigpress\_time\_format\_for\_booking\_form == '3' || $bookigpress\_time\_format\_for\_booking\_form == '4'){ |
| [4845](#L4845) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time); // phpcs:ignore |
| [4846](#L4846) | } |
| [4847](#L4847) | if($bookigpress\_time\_format\_for\_booking\_form == 'bookingpress-wp-inherit-time-format' || $bookigpress\_time\_format\_for\_booking\_form == ''){ |
| [4848](#L4848) | $service\_formatted\_start\_end\_time = sprintf( esc\_html\_\_( '%1$s - %2$s', 'bookingpress-appointment-booking' ),$service\_formatted\_start\_time, $service\_formatted\_end\_time); // phpcs:ignore |
| [4849](#L4849) | } |
| [4850](#L4850) |  |
| [4851](#L4851) |  |
| [4852](#L4852) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [4853](#L4853) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [4854](#L4854) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [4855](#L4855) |  |
| [4856](#L4856) |  |
| [4857](#L4857) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [4858](#L4858) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [4859](#L4859) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [4860](#L4860) |  |
| [4861](#L4861) |  |
| [4862](#L4862) | $service\_time\_arr['css\_animation\_class'] = $css\_animation\_class = 'bpa-front--ts-item-' . $an; |
| [4863](#L4863) | if ($service\_start\_time >= 0 && $service\_start\_time < $bpa\_afternoon\_solts\_timing ) { |
| [4864](#L4864) |  |
| [4865](#L4865) | $morning\_time[] = array\_merge( $service\_time\_arr, array( |
| [4866](#L4866) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4867](#L4867) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4868](#L4868) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4869](#L4869) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4870](#L4870) | ) ); |
| [4871](#L4871) | } elseif ($service\_start\_time >= $bpa\_afternoon\_solts\_timing && ( '' == $bpa\_evening\_solts\_timing || $service\_start\_time < $bpa\_evening\_solts\_timing ) ) { |
| [4872](#L4872) | $afternoon\_time[] = array\_merge( $service\_time\_arr, array( |
| [4873](#L4873) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4874](#L4874) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4875](#L4875) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4876](#L4876) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4877](#L4877) | ) ); |
| [4878](#L4878) | } elseif ($service\_start\_time >= $bpa\_evening\_solts\_timing && ( '' == $bpa\_night\_solts\_timing || $service\_start\_time < $bpa\_night\_solts\_timing ) ) { |
| [4879](#L4879) | $evening\_time[] = array\_merge( $service\_time\_arr, array( |
| [4880](#L4880) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4881](#L4881) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4882](#L4882) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4883](#L4883) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4884](#L4884) | ) ); |
| [4885](#L4885) | } else { |
| [4886](#L4886) | $night\_time[] = array\_merge( $service\_time\_arr, array( |
| [4887](#L4887) | 'formatted\_start\_time' => $service\_formatted\_start\_time, |
| [4888](#L4888) | 'formatted\_end\_time'   => $service\_formatted\_end\_time, |
| [4889](#L4889) | 'formatted\_start\_end\_time' => $service\_formatted\_start\_end\_time, |
| [4890](#L4890) | 'class'                => ( $service\_time\_arr['is\_booked'] ) ? '\_\_bpa-is-disabled' : '', |
| [4891](#L4891) | ) ); |
| [4892](#L4892) | } |
| [4893](#L4893) | $an++; |
| [4894](#L4894) | } |
| [4895](#L4895) | } |
| [4896](#L4896) | } |
| [4897](#L4897) |  |
| [4898](#L4898) | $bookingpress\_timeslot\_counts = count($service\_timings); |
| [4899](#L4899) | $bookingpress\_selected\_start\_time = ""; |
| [4900](#L4900) | $bookingpress\_selected\_end\_time = ""; |
| [4901](#L4901) | if($bookingpress\_timeslot\_counts == 1 && (!empty($service\_timings[0]['end\_time']) && $service\_timings[0]['end\_time'] == "24:00") && ($service\_timings[0]['is\_booked'] == 0) ){ |
| [4902](#L4902) | $bookingpress\_selected\_start\_time = $service\_timings[0]['start\_time']; |
| [4903](#L4903) | $bookingpress\_selected\_end\_time = $service\_timings[0]['end\_time']; |
| [4904](#L4904) | } |
| [4905](#L4905) |  |
| [4906](#L4906) | $next\_day\_times = []; |
| [4907](#L4907) | foreach( $morning\_time as $mkey => $mvalue ){ |
| [4908](#L4908) | if( !empty( $mvalue['is\_next\_day'] ) && ( true === $mvalue['is\_next\_day'] || 'true' == $mvalue['is\_next\_day'] ) ){ |
| [4909](#L4909) | $next\_day\_times[] = $mvalue; |
| [4910](#L4910) | unset( $morning\_time[ $mkey ] ); |
| [4911](#L4911) | } |
| [4912](#L4912) | } |
| [4913](#L4913) |  |
| [4914](#L4914) | $morning\_time = array\_values( $morning\_time ); |
| [4915](#L4915) |  |
| [4916](#L4916) | $return\_data = array( |
| [4917](#L4917) | 'morning\_time'   => $morning\_time, |
| [4918](#L4918) | 'afternoon\_time' => $afternoon\_time, |
| [4919](#L4919) | 'evening\_time'   => $evening\_time, |
| [4920](#L4920) | 'night\_time'     => array\_merge( $night\_time, $next\_day\_times ) |
| [4921](#L4921) | ); |
| [4922](#L4922) |  |
| [4923](#L4923) | if( !empty( $service\_timings\_data['is\_custom\_duration'] ) ){ |
| [4924](#L4924) | $return\_data['is\_custom\_duration'] = true; |
| [4925](#L4925) | } |
| [4926](#L4926) |  |
| [4927](#L4927) | $return\_data['timing\_token\_data'] = $time\_token\_data; |
| [4928](#L4928) |  |
| [4929](#L4929) |  |
| [4930](#L4930) | //$return\_data = apply\_filters('bookingpress\_modify\_service\_return\_timings\_filter', $return\_data, $selected\_service\_id, $selected\_date, $\_POST, $max\_service\_capacity); |
| [4931](#L4931) |  |
| [4932](#L4932) | if( true == $return ){ |
| [4933](#L4933) | return $return\_data; |
| [4934](#L4934) | } else { |
| [4935](#L4935) | echo wp\_json\_encode($return\_data); |
| [4936](#L4936) | exit(); |
| [4937](#L4937) | } |
| [4938](#L4938) |  |
| [4939](#L4939) | } |
| [4940](#L4940) |  |
| [4941](#L4941) | /\*\* |
| [4942](#L4942) | \* Get category specific service |
| [4943](#L4943) | \* |
| [4944](#L4944) | \* @return void |
| [4945](#L4945) | \*/ |
| [4946](#L4946) | function bookingpress\_get\_category\_service\_data() |
| [4947](#L4947) | { |
| [4948](#L4948) | global $wpdb, $BookingPress, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $bookingpress\_other\_debug\_log\_id; |
| [4949](#L4949) | do\_action('bookingpress\_other\_debug\_log\_entry', 'appointment\_debug\_logs', 'Get category service posted data', 'bookingpress\_bookingform', $\_REQUEST, $bookingpress\_other\_debug\_log\_id); |
| [4950](#L4950) | $response              = array(); |
| [4951](#L4951) | $wpnonce               = isset($\_REQUEST['\_wpnonce']) ? sanitize\_text\_field($\_REQUEST['\_wpnonce']) : ''; |
| [4952](#L4952) | $bpa\_verify\_nonce\_flag = wp\_verify\_nonce($wpnonce, 'bpa\_wp\_nonce'); |
| [4953](#L4953) | if (! $bpa\_verify\_nonce\_flag ) { |
| [4954](#L4954) | $response['variant'] = 'error'; |
| [4955](#L4955) | $response['title']   = esc\_html\_\_('Error', 'bookingpress-appointment-booking'); |
| [4956](#L4956) | $response['msg']     = esc\_html\_\_('Sorry, Your request can not be processed due to security reason.', 'bookingpress-appointment-booking'); |
| [4957](#L4957) | echo wp\_json\_encode($response); |
| [4958](#L4958) | exit(); |
| [4959](#L4959) | } |
| [4960](#L4960) | if ( ! empty( $\_POST['category\_id'] ) || intval($\_POST['category\_id']) == 0 ) { |
| [4961](#L4961) | $selected\_category\_id        = intval($\_POST['category\_id']); |
| [4962](#L4962) | $bookingpress\_posted\_data = !empty($\_POST['posted\_data']) ? array\_map( array( $BookingPress, 'appointment\_sanatize\_field' ), $\_POST['posted\_data'] ) : array(); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [4963](#L4963) | $bookingpress\_total\_services = 0; |
| [4964](#L4964) | if (! empty($\_POST['total\_service']) ) { |
| [4965](#L4965) | $bookingpress\_total\_services = sanitize\_text\_field($\_POST['total\_service']); |
| [4966](#L4966) | } |
| [4967](#L4967) | if ( ! empty( $\_POST['total\_category'] ) ) { |
| [4968](#L4968) | $bookingpress\_total\_category = sanitize\_text\_field( $\_POST['total\_category'] ); |
| [4969](#L4969) | } |
| [4970](#L4970) | // Fetch services of selected categories |
| [4971](#L4971) | $bookingpress\_search\_query\_where       = ''; |
| [4972](#L4972) | if ( ! empty( $selected\_category\_id ) && $selected\_category\_id != 0 ) { |
| [4973](#L4973) | $bookingpress\_search\_query\_where .= " WHERE (bookingpress\_category\_id = '{$selected\_category\_id}')"; |
| [4974](#L4974) | } |
| [4975](#L4975) | $bookingpress\_search\_query\_placeholder = ''; |
| [4976](#L4976) | if ( ! empty( $bookingpress\_total\_category ) && $bookingpress\_total\_category != 0 ) { |
| [4977](#L4977) | $bookingpress\_search\_query\_where       .= ! empty( $bookingpress\_search\_query\_where ) ? ' AND' : ' WHERE'; |
| [4978](#L4978) | $bookingpress\_search\_query\_placeholder  = ' bookingpress\_category\_id IN ('; |
| [4979](#L4979) | $bookingpress\_total\_category\_arr        = explode( ',', $bookingpress\_total\_category ); |
| [4980](#L4980) | $bookingpress\_search\_query\_placeholder .= rtrim( str\_repeat( '%d,', count( $bookingpress\_total\_category\_arr ) ), ',' ); |
| [4981](#L4981) | $bookingpress\_search\_query\_placeholder .= ')'; |
| [4982](#L4982) | array\_unshift( $bookingpress\_total\_category\_arr, $bookingpress\_search\_query\_placeholder ); |
| [4983](#L4983) | $bookingpress\_search\_query\_where .= call\_user\_func\_array( array( $wpdb, 'prepare' ), $bookingpress\_total\_category\_arr ); |
| [4984](#L4984) | } |
| [4985](#L4985) | $bookingpress\_search\_query\_placeholder = ''; |
| [4986](#L4986) | if (! empty($bookingpress\_total\_services) && $bookingpress\_total\_services != 0 ) { |
| [4987](#L4987) | $bookingpress\_search\_query\_where       .= ! empty( $bookingpress\_search\_query\_where ) ? ' AND' : ' WHERE'; |
| [4988](#L4988) | $bookingpress\_search\_query\_placeholder  = ' bookingpress\_service\_id IN ('; |
| [4989](#L4989) | $bookingpress\_total\_services\_arr        = explode(',', $bookingpress\_total\_services); |
| [4990](#L4990) | $bookingpress\_search\_query\_placeholder .= rtrim(str\_repeat('%d,', count($bookingpress\_total\_services\_arr)), ','); |
| [4991](#L4991) | $bookingpress\_search\_query\_placeholder .= ')'; |
| [4992](#L4992) | array\_unshift($bookingpress\_total\_services\_arr, $bookingpress\_search\_query\_placeholder); |
| [4993](#L4993) | $bookingpress\_search\_query\_where .= call\_user\_func\_array( array( $wpdb, 'prepare' ), $bookingpress\_total\_services\_arr ); |
| [4994](#L4994) | } |
| [4995](#L4995) |  |
| [4996](#L4996) | $service\_data = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_services} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_service\_position ASC" ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally and $bookingpress\_search\_query\_where is properly prepared. False Positive alarm |
| [4997](#L4997) |  |
| [4998](#L4998) | $bookingpress\_display\_service\_description = $BookingPress->bookingpress\_get\_customize\_settings('display\_service\_description', 'booking\_form'); |
| [4999](#L4999) |  |
| [5000](#L5000) | foreach ( $service\_data as $service\_key => $service\_val ) { |
| [5001](#L5001) | $service\_data[ $service\_key ]['bookingpress\_service\_price']     = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($service\_val['bookingpress\_service\_price']); |
| [5002](#L5002) | $service\_data[ $service\_key ]['service\_price\_without\_currency'] = (float) $service\_val['bookingpress\_service\_price']; |
| [5003](#L5003) | $service\_data[ $service\_key ]['bookingpress\_service\_name'] = stripslashes\_deep($service\_val['bookingpress\_service\_name']); |
| [5004](#L5004) | $service\_id                              = $service\_val['bookingpress\_service\_id']; |
| [5005](#L5005) | $service\_meta\_details                    = $wpdb->get\_row($wpdb->prepare("SELECT \* FROM {$tbl\_bookingpress\_servicesmeta} WHERE bookingpress\_service\_id = %d AND bookingpress\_servicemeta\_name = 'service\_image\_details'", $service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_servicesmeta is table name defined globally. False Positive alarm |
| [5006](#L5006) | $service\_img\_details                     = ! empty($service\_meta\_details['bookingpress\_servicemeta\_value']) ? maybe\_unserialize($service\_meta\_details['bookingpress\_servicemeta\_value']) : array(); |
| [5007](#L5007) | $service\_data[ $service\_key ]['img\_url'] = ! empty($service\_img\_details[0]['url']) ? $service\_img\_details[0]['url'] : BOOKINGPRESS\_URL . '/images/placeholder-img.jpg'; |
| [5008](#L5008) | $service\_data[ $service\_key ]['bookingpress\_service\_description'] = stripslashes\_deep($service\_data[ $service\_key ]['bookingpress\_service\_description']); |
| [5009](#L5009) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [5010](#L5010) | $service\_data[ $service\_key ]['display\_read\_more\_less'] = 1; |
| [5011](#L5011) | $default\_service\_description   = $service\_data[ $service\_key ]['bookingpress\_service\_description']; |
| [5012](#L5012) | if (strlen($default\_service\_description) > 140 ) { |
| [5013](#L5013) | $service\_data[ $service\_key ]['bookingpress\_service\_description\_with\_excerpt'] = substr($default\_service\_description, 0, 140); |
| [5014](#L5014) | $service\_data[ $service\_key ]['display\_details\_more']                          = 0; |
| [5015](#L5015) | $service\_data[ $service\_key ]['display\_details\_less']                          = 1; |
| [5016](#L5016) | } else { |
| [5017](#L5017) | $service\_data[ $service\_key ]['display\_read\_more\_less'] = 0; |
| [5018](#L5018) | } |
| [5019](#L5019) | } |
| [5020](#L5020) | } |
| [5021](#L5021) | $service\_data = apply\_filters('bookingpress\_modify\_service\_data\_on\_category\_selection', $service\_data, $selected\_category\_id, $bookingpress\_posted\_data); |
| [5022](#L5022) |  |
| [5023](#L5023) | do\_action('bookingpress\_other\_debug\_log\_entry', 'appointment\_debug\_logs', 'Get category service - service data', 'bookingpress\_bookingform', $service\_data, $bookingpress\_other\_debug\_log\_id); |
| [5024](#L5024) |  |
| [5025](#L5025) | echo wp\_json\_encode($service\_data); |
| [5026](#L5026) | exit(); |
| [5027](#L5027) | } |
| [5028](#L5028) | } |
| [5029](#L5029) |  |
| [5030](#L5030) | /\*\* |
| [5031](#L5031) | \* Callback function for [bookingpress\_form] shortcode |
| [5032](#L5032) | \* |
| [5033](#L5033) | \* @param  mixed $atts |
| [5034](#L5034) | \* @param  mixed $content |
| [5035](#L5035) | \* @param  mixed $tag |
| [5036](#L5036) | \* @return void |
| [5037](#L5037) | \*/ |
| [5038](#L5038) | function bookingpress\_front\_booking\_form( $atts, $content, $tag ) |
| [5039](#L5039) | { |
| [5040](#L5040) | global $wpdb, $BookingPress, $bookingpress\_common\_date\_format, $tbl\_bookingpress\_form\_fields, $tbl\_bookingpress\_services, $tbl\_bookingpress\_customers, $bookingpress\_global\_options,$bookingpress\_front\_vue\_data\_fields; |
| [5041](#L5041) |  |
| [5042](#L5042) | do\_action('bookingpress\_front\_booking\_form\_load\_before'); |
| [5043](#L5043) |  |
| [5044](#L5044) | $defaults = array( |
| [5045](#L5045) | 'service'  => 0, |
| [5046](#L5046) | 'category' => 0, |
| [5047](#L5047) | 'selected\_service' => 0, |
| [5048](#L5048) | ); |
| [5049](#L5049) | $args     = shortcode\_atts($defaults, $atts, $tag); |
| [5050](#L5050) |  |
| [5051](#L5051) | if( !empty( $atts ) ){ |
| [5052](#L5052) | if( !empty( $atts['service'] ) && !preg\_match( '/^[(\d+)\,]+$/', $atts['service'] ) ){ |
| [5053](#L5053) | $atts['service'] = ''; |
| [5054](#L5054) | } |
| [5055](#L5055) |  |
| [5056](#L5056) | $atts['category'] = !empty( $atts['category'] ) ? intval( $atts['category'] ) : ''; |
| [5057](#L5057) | $atts['selected\_service'] = !empty( $atts['selected\_service'] ) ? intval( $atts['selected\_service'] ) : ''; |
| [5058](#L5058) | } |
| [5059](#L5059) |  |
| [5060](#L5060) |  |
| [5061](#L5061) | extract($args); |
| [5062](#L5062) |  |
| [5063](#L5063) |  |
| [5064](#L5064) | $category = explode( ',', $category ); |
| [5065](#L5065) | $category = array\_map( 'intval', $category ); |
| [5066](#L5066) | $category = implode( ',', $category ); |
| [5067](#L5067) |  |
| [5068](#L5068) | $Bookingpress\_service  = 0; |
| [5069](#L5069) | $Bookingpress\_category = 0; |
| [5070](#L5070) | $selected\_category = 0; |
| [5071](#L5071) | if (! empty($category) && $category != 0 ) { |
| [5072](#L5072) | $Bookingpress\_category            = $category; |
| [5073](#L5073) | $this->bookingpress\_form\_category = $category; |
| [5074](#L5074) | } |
| [5075](#L5075) | $service = apply\_filters('bookingpress\_modify\_booking\_form\_default\_display\_services', $service); |
| [5076](#L5076) |  |
| [5077](#L5077) | if( ! empty( $service ) ) { |
| [5078](#L5078) | $service\_arr = explode( ',', $service ); |
| [5079](#L5079) | $service\_arr = array\_map( 'intval', $service\_arr ); |
| [5080](#L5080) | $service = implode( ', ', $service\_arr ); |
| [5081](#L5081) | $Bookingpress\_service            = $service; |
| [5082](#L5082) | $this->bookingpress\_form\_service = $service; |
| [5083](#L5083) | } |
| [5084](#L5084) |  |
| [5085](#L5085) | /\*\* Set flag to display no service placeholder \*/ |
| [5086](#L5086) | $bookingpress\_display\_no\_service\_placeholder = false; |
| [5087](#L5087) |  |
| [5088](#L5088) | /\*\* Fetch all services \*/ |
| [5089](#L5089) |  |
| [5090](#L5090) | if (( ! empty($service) && $service != 0 ) || ( !empty($selected\_service) && $selected\_service != 0 ) || ( isset($\_GET['bpservice\_id']) && ! empty($\_GET['bpservice\_id']) ) || ( isset($\_GET['s\_id']) && ! empty($\_GET['s\_id']) ) ) { |
| [5091](#L5091) | $total\_service = array(); |
| [5092](#L5092) | $bookingpress\_is\_service\_load\_from\_url = 0; |
| [5093](#L5093) | $bookingpress\_search\_query\_where = 'WHERE 1=1 '; |
| [5094](#L5094) | if (!empty($\_GET['bpservice\_id']) || !empty($\_GET['s\_id']) ) { |
| [5095](#L5095) | if(!empty($\_GET['bpservice\_id']) && !isset($\_GET['s\_id']) ){ |
| [5096](#L5096) | $selected\_service = intval($\_GET['bpservice\_id']); |
| [5097](#L5097) | }else if(!empty($\_GET['s\_id'])){ |
| [5098](#L5098) | $selected\_service = intval($\_GET['s\_id']); |
| [5099](#L5099) | $category = 0; |
| [5100](#L5100) | $service = 0; |
| [5101](#L5101) | $this->bookingpress\_form\_service = 0; |
| [5102](#L5102) | $this->bookingpress\_form\_category = 0; |
| [5103](#L5103) | } |
| [5104](#L5104) | $bookingpress\_is\_service\_load\_from\_url = 1; |
| [5105](#L5105) | } else { |
| [5106](#L5106) | $selected\_service = intval($selected\_service); |
| [5107](#L5107) | $this->bookingpress\_form\_service = $service; |
| [5108](#L5108) | } |
| [5109](#L5109) |  |
| [5110](#L5110) | if(!empty($category)) { |
| [5111](#L5111) | $bookingpress\_search\_query\_where .= " AND bookingpress\_category\_id IN ({$category})"; |
| [5112](#L5112) | } |
| [5113](#L5113) | if(!empty($service)) { |
| [5114](#L5114) | $bookingpress\_search\_query\_where .= " AND bookingpress\_service\_id IN ({$service})"; |
| [5115](#L5115) | } |
| [5116](#L5116) | $is\_service\_exist = ''; |
| [5117](#L5117) | if(!empty($selected\_service)) { |
| [5118](#L5118) |  |
| [5119](#L5119) | $bookingpress\_search\_query\_where .= " AND bookingpress\_service\_id = {$selected\_service}"; |
| [5120](#L5120) | $is\_service\_exist = $wpdb->get\_row( "SELECT bookingpress\_service\_id FROM ".$tbl\_bookingpress\_services." ".$bookingpress\_search\_query\_where); // phpcs:ignore WordPress.DB.PreparedSQL.NotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [5121](#L5121) |  |
| [5122](#L5122) | if(!empty($selected\_service) && !empty($is\_service\_exist)) { |
| [5123](#L5123) | // Get category id |
| [5124](#L5124) | $bookingpress\_service\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_service\_id = %d", $selected\_service ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_services is table name defined globally. False Positive alarm |
| [5125](#L5125) | if (! empty($bookingpress\_service\_details) ) { |
| [5126](#L5126) | $selected\_category = $bookingpress\_service\_details['bookingpress\_category\_id']; |
| [5127](#L5127) | } |
| [5128](#L5128) | if($bookingpress\_is\_service\_load\_from\_url == 1) { |
| [5129](#L5129) | $this->bookingpress\_is\_service\_load\_from\_url = 1; |
| [5130](#L5130) | } |
| [5131](#L5131) | } else{ |
| [5132](#L5132) | $selected\_service = 0; |
| [5133](#L5133) | } |
| [5134](#L5134) | } |
| [5135](#L5135) | } |
| [5136](#L5136) |  |
| [5137](#L5137) | if( !empty( $atts['selected\_service'] ) ){ |
| [5138](#L5138) | $this->bookingpress\_selected\_service\_param = true; |
| [5139](#L5139) | } |
| [5140](#L5140) |  |
| [5141](#L5141) | $bpa\_all\_services = $BookingPress->bookingpress\_retrieve\_all\_services( $service, $selected\_service, $Bookingpress\_category ); |
| [5142](#L5142) | $this->bookingpress\_all\_service\_data = $bpa\_all\_services; |
| [5143](#L5143) |  |
| [5144](#L5144) | $bookingpress\_is\_display\_empty\_view = apply\_filters( 'bpa\_is\_display\_emtpy\_view', false, $bpa\_all\_services ); |
| [5145](#L5145) |  |
| [5146](#L5146) | if( empty( $bpa\_all\_services ) || true == $bookingpress\_is\_display\_empty\_view ){ |
| [5147](#L5147) | $bookingpress\_display\_no\_service\_placeholder = true; |
| [5148](#L5148) | } |
| [5149](#L5149) |  |
| [5150](#L5150) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_display\_no\_service\_placeholder'] = $bookingpress\_display\_no\_service\_placeholder; |
| [5151](#L5151) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data'] = $bpa\_all\_services; |
| [5152](#L5152) |  |
| [5153](#L5153) | $bookingpress\_front\_vue\_data\_fields['browser\_details'] = ''; |
| [5154](#L5154) | $bookingpress\_front\_vue\_data\_fields['browser\_version'] = ''; |
| [5155](#L5155) |  |
| [5156](#L5156) | $bpa\_all\_categories = $BookingPress->bookingpress\_retrieve\_all\_categories( $bpa\_all\_services ); |
| [5157](#L5157) |  |
| [5158](#L5158) | $bookingpress\_front\_vue\_data\_fields['hide\_category\_selection'] = false; |
| [5159](#L5159) | if( count( $bpa\_all\_categories ) == 1 && 0 < $bpa\_all\_categories[0]['category\_id'] ){ |
| [5160](#L5160) | $bookingpress\_front\_vue\_data\_fields['hide\_category\_selection'] = true; |
| [5161](#L5161) | } |
| [5162](#L5162) |  |
| [5163](#L5163) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_categories'] = $bpa\_all\_categories; |
| [5164](#L5164) |  |
| [5165](#L5165) | $bookingpress\_service\_details = $BookingPress->get\_bookingpress\_service\_data\_group\_with\_category(); |
| [5166](#L5166) |  |
| [5167](#L5167) | // Get labels and tabs names generated from customize |
| [5168](#L5168) | // ----------------------------------------------------- |
| [5169](#L5169) |  |
| [5170](#L5170) | $bookingpress\_customize\_settings = $BookingPress->bookingpress\_get\_customize\_settings( |
| [5171](#L5171) | array( |
| [5172](#L5172) | 'service\_title', |
| [5173](#L5173) | 'datetime\_title', |
| [5174](#L5174) | 'basic\_details\_title', |
| [5175](#L5175) | 'summary\_title', |
| [5176](#L5176) | 'category\_title', |
| [5177](#L5177) | 'service\_heading\_title', |
| [5178](#L5178) | 'timeslot\_text', |
| [5179](#L5179) | 'summary\_content\_text', |
| [5180](#L5180) | 'service\_duration\_label', |
| [5181](#L5181) | 'service\_price\_label', |
| [5182](#L5182) | 'paypal\_text', |
| [5183](#L5183) | 'locally\_text', |
| [5184](#L5184) | 'total\_amount\_text', |
| [5185](#L5185) | 'service\_text', |
| [5186](#L5186) | 'customer\_text', |
| [5187](#L5187) | 'date\_time\_text', |
| [5188](#L5188) | 'appointment\_details', |
| [5189](#L5189) | 'payment\_method\_text', |
| [5190](#L5190) | 'morning\_text', |
| [5191](#L5191) | 'afternoon\_text', |
| [5192](#L5192) | 'evening\_text', |
| [5193](#L5193) | 'night\_text', |
| [5194](#L5194) | 'goback\_button\_text', |
| [5195](#L5195) | 'next\_button\_text', |
| [5196](#L5196) | 'book\_appointment\_btn\_text', |
| [5197](#L5197) | 'book\_appointment\_hours\_text', |
| [5198](#L5198) | 'book\_appointment\_min\_text', |
| [5199](#L5199) | 'booking\_form\_tabs\_position', |
| [5200](#L5200) | 'hide\_category\_service\_selection', |
| [5201](#L5201) | 'title\_font\_family', |
| [5202](#L5202) | 'content\_font\_family', |
| [5203](#L5203) | 'display\_service\_description', |
| [5204](#L5204) | 'all\_category\_title', |
| [5205](#L5205) | 'date\_time\_step\_note', |
| [5206](#L5206) | 'summary\_step\_note', |
| [5207](#L5207) | ), |
| [5208](#L5208) | 'booking\_form' |
| [5209](#L5209) | ); |
| [5210](#L5210) |  |
| [5211](#L5211) | $bookingpress\_first\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['service\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_title', 'booking\_form'); |
| [5212](#L5212) | $bookingpress\_second\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['datetime\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('', 'booking\_form'); |
| [5213](#L5213) | $bookingpress\_third\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['basic\_details\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('basic\_details\_title', 'booking\_form'); |
| [5214](#L5214) | $bookingpress\_fourth\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['summary\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('summary\_title', 'booking\_form'); |
| [5215](#L5215) | $bookingpress\_all\_category\_title = stripslashes\_deep($bookingpress\_customize\_settings['all\_category\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('all\_category\_title', 'booking\_form'); |
| [5216](#L5216) | $bookingpress\_category\_title       = stripslashes\_deep($bookingpress\_customize\_settings['category\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('category\_title', 'booking\_form'); |
| [5217](#L5217) | $bookingpress\_services\_title       = stripslashes\_deep($bookingpress\_customize\_settings['service\_heading\_title']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_heading\_title', 'booking\_form'); |
| [5218](#L5218) | $bookingpress\_timeslot\_title       = stripslashes\_deep($bookingpress\_customize\_settings['timeslot\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('timeslot\_text', 'booking\_form'); |
| [5219](#L5219) | $bookingpress\_summary\_content\_text = stripslashes\_deep($bookingpress\_customize\_settings['summary\_content\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('summary\_content\_text', 'booking\_form'); |
| [5220](#L5220) | $bookingpress\_date\_time\_step\_note = !empty( $bookingpress\_customize\_settings['date\_time\_step\_note'] ) ? stripslashes\_deep($bookingpress\_customize\_settings['date\_time\_step\_note']) : ''; |
| [5221](#L5221) | $bookingpress\_summary\_step\_note = !empty( $bookingpress\_customize\_settings['summary\_step\_note'] ) ? stripslashes\_deep($bookingpress\_customize\_settings['summary\_step\_note']) : ''; |
| [5222](#L5222) |  |
| [5223](#L5223) | $bookingpress\_service\_duration\_text = !empty($bookingpress\_customize\_settings['service\_duration\_label']) ? stripslashes\_deep($bookingpress\_customize\_settings['service\_duration\_label']) : '';//$BookingPress->bookingpress\_get\_customize\_settings('service\_duration\_label', 'booking\_form'); |
| [5224](#L5224) | if (empty($bookingpress\_service\_duration\_text) ) { |
| [5225](#L5225) | $bookingpress\_service\_duration\_text = esc\_html\_\_('Duration', 'bookingpress-appointment-booking') . ':'; |
| [5226](#L5226) | } |
| [5227](#L5227) | $bookingpress\_service\_price\_text = !empty($bookingpress\_customize\_settings['service\_price\_label']) ? stripslashes\_deep($bookingpress\_customize\_settings['service\_price\_label']) : '';//$BookingPress->bookingpress\_get\_customize\_settings('service\_price\_label', 'booking\_form'); |
| [5228](#L5228) | if (empty($bookingpress\_service\_price\_text) ) { |
| [5229](#L5229) | $bookingpress\_service\_price\_text = esc\_html\_\_('Price', 'bookingpress-appointment-booking') . ':'; |
| [5230](#L5230) | } |
| [5231](#L5231) |  |
| [5232](#L5232) | $bookingpress\_paypal\_text = stripslashes\_deep($bookingpress\_customize\_settings['paypal\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('paypal\_text', 'booking\_form'); |
| [5233](#L5233) | if (empty($bookingpress\_paypal\_text) ) { |
| [5234](#L5234) | $bookingpress\_paypal\_text = esc\_html\_\_('PayPal', 'bookingpress-appointment-booking'); |
| [5235](#L5235) | } |
| [5236](#L5236) |  |
| [5237](#L5237) | $bookingpress\_locally\_text = stripslashes\_deep($bookingpress\_customize\_settings['locally\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('locally\_text', 'booking\_form'); |
| [5238](#L5238) | if (empty($bookingpress\_locally\_text) ) { |
| [5239](#L5239) | $bookingpress\_locally\_text = esc\_html\_\_('Pay Locally', 'bookingpress-appointment-booking'); |
| [5240](#L5240) | } |
| [5241](#L5241) |  |
| [5242](#L5242) | $bookingpress\_total\_amount\_text = stripslashes\_deep($bookingpress\_customize\_settings['total\_amount\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('total\_amount\_text', 'booking\_form'); |
| [5243](#L5243) | if (empty($bookingpress\_total\_amount\_text) ) { |
| [5244](#L5244) | $bookingpress\_total\_amount\_text = esc\_html\_\_('Total Amount Payable', 'bookingpress-appointment-booking'); |
| [5245](#L5245) | } |
| [5246](#L5246) |  |
| [5247](#L5247) | $bookingpress\_service\_text = stripslashes\_deep($bookingpress\_customize\_settings['service\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('service\_text', 'booking\_form'); |
| [5248](#L5248) | if (empty($bookingpress\_service\_text) ) { |
| [5249](#L5249) | $bookingpress\_service\_text = esc\_html\_\_('Service', 'bookingpress-appointment-booking'); |
| [5250](#L5250) | } |
| [5251](#L5251) |  |
| [5252](#L5252) | $bookingpress\_customer\_text = stripslashes\_deep($bookingpress\_customize\_settings['customer\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('customer\_text', 'booking\_form'); |
| [5253](#L5253) | if (empty($bookingpress\_customer\_text) ) { |
| [5254](#L5254) | $bookingpress\_customer\_text = esc\_html\_\_('Customer', 'bookingpress-appointment-booking'); |
| [5255](#L5255) | } |
| [5256](#L5256) |  |
| [5257](#L5257) | $bookingpress\_date\_time\_text = stripslashes\_deep($bookingpress\_customize\_settings['date\_time\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('date\_time\_text', 'booking\_form'); |
| [5258](#L5258) | if (empty($bookingpress\_date\_time\_text) ) { |
| [5259](#L5259) | $bookingpress\_date\_time\_text = esc\_html\_\_('Date &amp; Time', 'bookingpress-appointment-booking'); |
| [5260](#L5260) | } |
| [5261](#L5261) |  |
| [5262](#L5262) | $bookingpress\_appointment\_details\_title\_text = stripslashes\_deep($bookingpress\_customize\_settings['appointment\_details']);//$BookingPress->bookingpress\_get\_customize\_settings('date\_time\_text', 'booking\_form'); |
| [5263](#L5263) | if (empty($bookingpress\_appointment\_details\_title\_text) ) { |
| [5264](#L5264) | $bookingpress\_appointment\_details\_title\_text = esc\_html\_\_('Appointment Details', 'bookingpress-appointment-booking'); |
| [5265](#L5265) | } |
| [5266](#L5266) |  |
| [5267](#L5267) | $bookingpress\_payment\_method\_text = stripslashes\_deep($bookingpress\_customize\_settings['payment\_method\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('payment\_method\_text', 'booking\_form'); |
| [5268](#L5268) | if (empty($bookingpress\_payment\_method\_text) ) { |
| [5269](#L5269) | $bookingpress\_payment\_method\_text = esc\_html\_\_('Select Payment Method', 'bookingpress-appointment-booking'); |
| [5270](#L5270) | } |
| [5271](#L5271) |  |
| [5272](#L5272) | $bookingpress\_morning\_text = stripslashes\_deep($bookingpress\_customize\_settings['morning\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('morning\_text', 'booking\_form'); |
| [5273](#L5273) | if (empty($bookingpress\_morning\_text) ) { |
| [5274](#L5274) | $bookingpress\_morning\_text = esc\_html\_\_('Morning', 'bookingpress-appointment-booking'); |
| [5275](#L5275) | } |
| [5276](#L5276) | $bookingpress\_afternoon\_text = stripslashes\_deep($bookingpress\_customize\_settings['afternoon\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('afternoon\_text', 'booking\_form'); |
| [5277](#L5277) | if (empty($bookingpress\_afternoon\_text) ) { |
| [5278](#L5278) | $bookingpress\_afternoon\_text = esc\_html\_\_('Afternoon', 'bookingpress-appointment-booking'); |
| [5279](#L5279) | } |
| [5280](#L5280) | $bookingpress\_evening\_text = stripslashes\_deep($bookingpress\_customize\_settings['evening\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('evening\_text', 'booking\_form'); |
| [5281](#L5281) | if (empty($bookingpress\_evening\_text) ) { |
| [5282](#L5282) | $bookingpress\_evening\_text = esc\_html\_\_('Evening', 'bookingpress-appointment-booking'); |
| [5283](#L5283) | } |
| [5284](#L5284) | $bookingpress\_night\_text = stripslashes\_deep($bookingpress\_customize\_settings['night\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('night\_text', 'booking\_form'); |
| [5285](#L5285) | if (empty($bookingpress\_night\_text) ) { |
| [5286](#L5286) | $bookingpress\_night\_text = esc\_html\_\_('Night', 'bookingpress-appointment-booking'); |
| [5287](#L5287) | } |
| [5288](#L5288) | $bookingpress\_date\_time\_step\_note = !empty($bookingpress\_date\_time\_step\_note) ? stripslashes\_deep($bookingpress\_date\_time\_step\_note) : ''; |
| [5289](#L5289) | $bookingpress\_summary\_step\_note = !empty($bookingpress\_summary\_step\_note) ? stripslashes\_deep($bookingpress\_summary\_step\_note) : ''; |
| [5290](#L5290) |  |
| [5291](#L5291) | $bookingpress\_goback\_btn\_text           = stripslashes\_deep($bookingpress\_customize\_settings['goback\_button\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('goback\_button\_text', 'booking\_form'); |
| [5292](#L5292) | $bookingpress\_next\_btn\_text             = stripslashes\_deep($bookingpress\_customize\_settings['next\_button\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('next\_button\_text', 'booking\_form'); |
| [5293](#L5293) | $bookingpress\_book\_appointment\_btn\_text = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_btn\_text']);//$BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_btn\_text', 'booking\_form'); |
| [5294](#L5294) | $bookingpress\_book\_appointment\_hours\_label = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_hours\_text']); |
| [5295](#L5295) | $bookingpress\_book\_appointment\_min\_label = stripslashes\_deep($bookingpress\_customize\_settings['book\_appointment\_min\_text']); |
| [5296](#L5296) | $bookingpress\_tabs\_position             = $bookingpress\_customize\_settings['booking\_form\_tabs\_position'];//$BookingPress->bookingpress\_get\_customize\_settings('booking\_form\_tabs\_position', 'booking\_form'); |
| [5297](#L5297) |  |
| [5298](#L5298) | $bookingpress\_hide\_category\_service       = $bookingpress\_customize\_settings['hide\_category\_service\_selection'];//$BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection', 'booking\_form'); |
| [5299](#L5299) |  |
| [5300](#L5300) |  |
| [5301](#L5301) |  |
| [5302](#L5302) |  |
| [5303](#L5303) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_book\_appointment\_btn\_text'] = $bookingpress\_book\_appointment\_btn\_text; |
| [5304](#L5304) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_total\_amount\_text'] = $bookingpress\_total\_amount\_text; |
| [5305](#L5305) |  |
| [5306](#L5306) | $bpa\_default\_date\_format = $BookingPress->bookingpress\_get\_settings( 'default\_date\_format', 'general\_setting' ); |
| [5307](#L5307) | $bookingpress\_front\_vue\_data\_fields['bpa\_front\_date\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ) : $bookingpress\_default\_date\_format; |
| [5308](#L5308) |  |
| [5309](#L5309) | $bookingpress\_front\_vue\_data\_fields['bpa\_front\_date\_time\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ).' HH:mm' : $bookingpress\_default\_date\_format.' HH:mm'; |
| [5310](#L5310) |  |
| [5311](#L5311) |  |
| [5312](#L5312) | $bookingpress\_hide\_category\_service       = ( $bookingpress\_hide\_category\_service == 'true' ) ? 1 : 0; |
| [5313](#L5313) | $bookingpress\_loaded\_from\_share\_url       = false; |
| [5314](#L5314) | if(!empty($\_GET['s\_id']) && ( isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '0' ) ){ |
| [5315](#L5315) | $bookingpress\_hide\_category\_service = 1; |
| [5316](#L5316) | $bookingpress\_loaded\_from\_share\_url = true; |
| [5317](#L5317) | } else if(!empty($\_GET['s\_id']) && ( isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '1' ) ){ |
| [5318](#L5318) | $bookingpress\_hide\_category\_service = 0; |
| [5319](#L5319) | $bookingpress\_loaded\_from\_share\_url = true; |
| [5320](#L5320) | } |
| [5321](#L5321) |  |
| [5322](#L5322) |  |
| [5323](#L5323) | if( 1 == $bookingpress\_hide\_category\_service && $bookingpress\_loaded\_from\_share\_url ){ |
| [5324](#L5324) | if( $selected\_service == 0 ){ |
| [5325](#L5325) | $bookingpress\_hide\_category\_service = 0; |
| [5326](#L5326) | } |
| [5327](#L5327) | } |
| [5328](#L5328) |  |
| [5329](#L5329) | $this->bookingpress\_hide\_category\_service = $bookingpress\_hide\_category\_service; |
| [5330](#L5330) |  |
| [5331](#L5331) | $bookingpress\_global\_options\_arr       = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5332](#L5332) | $bookingpress\_default\_date\_time\_format = $bookingpress\_global\_options\_arr['wp\_default\_date\_format']; |
| [5333](#L5333) |  |
| [5334](#L5334) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [5335](#L5335) | if ($bookingpress\_default\_date\_time\_format == 'F j, Y' ) { |
| [5336](#L5336) | $bookingpress\_default\_date\_format = 'MMMM D, YYYY'; |
| [5337](#L5337) | } elseif ($bookingpress\_default\_date\_time\_format == 'Y-m-d' ) { |
| [5338](#L5338) | $bookingpress\_default\_date\_format = 'YYYY-MM-DD'; |
| [5339](#L5339) | } elseif ($bookingpress\_default\_date\_time\_format == 'm/d/Y' ) { |
| [5340](#L5340) | $bookingpress\_default\_date\_format = 'MM/DD/YYYY'; |
| [5341](#L5341) | } elseif($bookingpress\_default\_date\_time\_format == 'd/m/Y') { |
| [5342](#L5342) | $bookingpress\_default\_date\_format = 'DD/MM/YYYY'; |
| [5343](#L5343) | } elseif ($bookingpress\_default\_date\_time\_format == 'd.m.Y') { |
| [5344](#L5344) | $bookingpress\_default\_date\_format = 'DD.MM.YYYY'; |
| [5345](#L5345) | } elseif ($bookingpress\_default\_date\_time\_format == 'd-m-Y') { |
| [5346](#L5346) | $bookingpress\_default\_date\_format = 'DD-MM-YYYY'; |
| [5347](#L5347) | } |
| [5348](#L5348) |  |
| [5349](#L5349) | $this->bookingpress\_default\_date\_format = $bookingpress\_default\_date\_format; |
| [5350](#L5350) |  |
| [5351](#L5351) | // ----------------------------------------------------- |
| [5352](#L5352) |  |
| [5353](#L5353) | // Get form fields details |
| [5354](#L5354) | // ----------------------------------------------------- |
| [5355](#L5355) |  |
| [5356](#L5356) | /\*\* Check if Pro version is exists but not activated \*/ |
| [5357](#L5357) | if( $BookingPress->bpa\_is\_pro\_exists() && !$BookingPress->bpa\_is\_pro\_active() ){ |
| [5358](#L5358) | if( empty( $BookingPress->bpa\_pro\_plugin\_version() ) ){ |
| [5359](#L5359) | $bookingpress\_form\_fields               = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} ORDER BY bookingpress\_field\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5360](#L5360) | } else { |
| [5361](#L5361) | $bookingpress\_form\_fields               = $wpdb->get\_results( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_form\_fields} WHERE bookingpress\_field\_is\_default = %d ORDER BY bookingpress\_field\_position ASC", 1), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5362](#L5362) | } |
| [5363](#L5363) | } else { |
| [5364](#L5364) |  |
| [5365](#L5365) |  |
| [5366](#L5366) | $bookingpress\_form\_fields = wp\_cache\_get( 'bpa\_appointment\_booking\_form\_fields\_data\_'); |
| [5367](#L5367) |  |
| [5368](#L5368) |  |
| [5369](#L5369) | if( false == $bookingpress\_form\_fields ) |
| [5370](#L5370) | { |
| [5371](#L5371) | $bookingpress\_form\_fields = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_form\_fields} ORDER BY bookingpress\_field\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_form\_fields is table name defined globally. False Positive alarm |
| [5372](#L5372) |  |
| [5373](#L5373) | wp\_cache\_set( 'bpa\_appointment\_booking\_form\_fields\_data\_', $bookingpress\_form\_fields); |
| [5374](#L5374) | } |
| [5375](#L5375) |  |
| [5376](#L5376) | } |
| [5377](#L5377) |  |
| [5378](#L5378) |  |
| [5379](#L5379) | $bookingpress\_form\_fields\_error\_msg\_arr = $bookingpress\_form\_fields\_new = array(); |
| [5380](#L5380) |  |
| [5381](#L5381) | $bookingpress\_form\_fields        = apply\_filters('bookingpress\_modify\_field\_data\_before\_prepare', $bookingpress\_form\_fields); |
| [5382](#L5382) |  |
| [5383](#L5383) |  |
| [5384](#L5384) | foreach ( $bookingpress\_form\_fields as $bookingpress\_form\_field\_key => $bookingpress\_form\_field\_val ) { |
| [5385](#L5385) |  |
| [5386](#L5386) | if($bookingpress\_form\_field\_val['bookingpress\_field\_is\_hide'] == 0) { |
| [5387](#L5387) |  |
| [5388](#L5388) | $bookingpress\_v\_model\_value = ''; |
| [5389](#L5389) | if ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'fullname' ) { |
| [5390](#L5390) | $bookingpress\_v\_model\_value = 'customer\_name'; |
| [5391](#L5391) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'firstname' ) { |
| [5392](#L5392) | $bookingpress\_v\_model\_value = 'customer\_firstname'; |
| [5393](#L5393) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'lastname' ) { |
| [5394](#L5394) | $bookingpress\_v\_model\_value = 'customer\_lastname'; |
| [5395](#L5395) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'email\_address' ) { |
| [5396](#L5396) | $bookingpress\_v\_model\_value = 'customer\_email'; |
| [5397](#L5397) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'phone\_number' ) { |
| [5398](#L5398) | $bookingpress\_v\_model\_value = 'customer\_phone'; |
| [5399](#L5399) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'note' ) { |
| [5400](#L5400) | $bookingpress\_v\_model\_value = 'appointment\_note'; |
| [5401](#L5401) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'username' ){ |
| [5402](#L5402) | $bookingpress\_v\_model\_value = 'customer\_username'; |
| [5403](#L5403) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'terms\_and\_conditions' ) { |
| [5404](#L5404) | $bookingpress\_v\_model\_value = 'appointment\_terms\_conditions'; |
| [5405](#L5405) | } else { |
| [5406](#L5406) | $bookingpress\_v\_model\_value = $bookingpress\_form\_field\_val['bookingpress\_field\_meta\_key']; |
| [5407](#L5407) | } |
| [5408](#L5408) |  |
| [5409](#L5409) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'][$bookingpress\_v\_model\_value] = ''; |
| [5410](#L5410) | if( 'appointment\_terms\_conditions' == $bookingpress\_v\_model\_value ){ |
| [5411](#L5411) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'][$bookingpress\_v\_model\_value] = array(); |
| [5412](#L5412) | } |
| [5413](#L5413) |  |
| [5414](#L5414) | $bookingpress\_field\_type = ''; |
| [5415](#L5415) | if ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'fullname' ) { |
| [5416](#L5416) | $bookingpress\_field\_type = 'Text'; |
| [5417](#L5417) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'firstname' ) { |
| [5418](#L5418) | $bookingpress\_field\_type = 'Text'; |
| [5419](#L5419) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'lastname' ) { |
| [5420](#L5420) | $bookingpress\_field\_type = 'Text'; |
| [5421](#L5421) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'email\_address' ) { |
| [5422](#L5422) | $bookingpress\_field\_type = 'Email'; |
| [5423](#L5423) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'phone\_number' ) { |
| [5424](#L5424) | $bookingpress\_field\_type = 'Dropdown'; |
| [5425](#L5425) | } elseif ($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'note' ) { |
| [5426](#L5426) | $bookingpress\_field\_type = 'Textarea'; |
| [5427](#L5427) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'username' ){ |
| [5428](#L5428) | $bookingpress\_field\_type = 'Text'; |
| [5429](#L5429) | } elseif($bookingpress\_form\_field\_val['bookingpress\_form\_field\_name'] == 'terms\_and\_conditions'){ |
| [5430](#L5430) | $bookingpress\_field\_type = 'terms\_and\_conditions'; |
| [5431](#L5431) | } else { |
| [5432](#L5432) | $bookingpress\_field\_type = $bookingpress\_form\_field\_val['bookingpress\_field\_type']; |
| [5433](#L5433) | } |
| [5434](#L5434) |  |
| [5435](#L5435) | $bookingpress\_field\_setting\_fields\_tmp                   = array(); |
| [5436](#L5436) | $bookingpress\_field\_setting\_fields\_tmp['id']             = intval($bookingpress\_form\_field\_val['bookingpress\_form\_field\_id']); |
| [5437](#L5437) | $bookingpress\_field\_setting\_fields\_tmp['field\_name']     = $bookingpress\_form\_field\_val['bookingpress\_form\_field\_name']; |
| [5438](#L5438) | $bookingpress\_field\_setting\_fields\_tmp['field\_type']     = $bookingpress\_field\_type; |
| [5439](#L5439) | $bookingpress\_field\_setting\_fields\_tmp['is\_edit']        = false; |
| [5440](#L5440) |  |
| [5441](#L5441) | $bookingpress\_field\_setting\_fields\_tmp['is\_required']    = ( $bookingpress\_form\_field\_val['bookingpress\_field\_required'] == 0 ) ? false : true; |
| [5442](#L5442) | $bookingpress\_field\_setting\_fields\_tmp['label']          = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_label']); |
| [5443](#L5443) | $bookingpress\_field\_setting\_fields\_tmp['placeholder']    = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_placeholder']); |
| [5444](#L5444) | $bookingpress\_field\_setting\_fields\_tmp['error\_message']  = stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']); |
| [5445](#L5445) | $bookingpress\_field\_setting\_fields\_tmp['is\_hide']        = ( $bookingpress\_form\_field\_val['bookingpress\_field\_is\_hide'] == 0 ) ? false : true; |
| [5446](#L5446) | $bookingpress\_field\_setting\_fields\_tmp['field\_position'] = floatval($bookingpress\_form\_field\_val['bookingpress\_field\_position']); |
| [5447](#L5447) | $bookingpress\_field\_setting\_fields\_tmp['v\_model\_value']  = $bookingpress\_v\_model\_value; |
| [5448](#L5448) |  |
| [5449](#L5449) | $bookingpress\_field\_setting\_fields\_tmp = apply\_filters( 'bookingpress\_arrange\_form\_fields\_outside', $bookingpress\_field\_setting\_fields\_tmp, $bookingpress\_form\_field\_val); |
| [5450](#L5450) |  |
| [5451](#L5451) |  |
| [5452](#L5452) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'] = apply\_filters('bookingpress\_add\_appointment\_step\_form\_data\_filter',$bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data'],$bookingpress\_field\_setting\_fields\_tmp); |
| [5453](#L5453) |  |
| [5454](#L5454) | $bookingpress\_front\_vue\_data\_fields['bpa\_current\_selected\_date'] = ''; |
| [5455](#L5455) |  |
| [5456](#L5456) | array\_push( $bookingpress\_form\_fields\_new, $bookingpress\_field\_setting\_fields\_tmp ); |
| [5457](#L5457) |  |
| [5458](#L5458) | if ($bookingpress\_form\_field\_val['bookingpress\_field\_required'] == '1' ) { |
| [5459](#L5459) | if ($bookingpress\_v\_model\_value == 'customer\_email' ) { |
| [5460](#L5460) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ] = array( |
| [5461](#L5461) | array( |
| [5462](#L5462) | 'required' => true, |
| [5463](#L5463) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5464](#L5464) | 'trigger'  => 'blur', |
| [5465](#L5465) | ), |
| [5466](#L5466) | array( |
| [5467](#L5467) | 'type'    => 'email', |
| [5468](#L5468) | 'message' => esc\_html\_\_('Please enter valid email address', 'bookingpress-appointment-booking'), |
| [5469](#L5469) | 'trigger' => 'blur', |
| [5470](#L5470) | ), |
| [5471](#L5471) | ); |
| [5472](#L5472) | } elseif( $bookingpress\_v\_model\_value == 'appointment\_terms\_conditions') { |
| [5473](#L5473) |  |
| [5474](#L5474) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][] = array( |
| [5475](#L5475) | 'required' => true, |
| [5476](#L5476) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5477](#L5477) | 'trigger'  => 'change', |
| [5478](#L5478) | ); |
| [5479](#L5479) | } else { |
| [5480](#L5480) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][] = array( |
| [5481](#L5481) | 'required' => true, |
| [5482](#L5482) | 'message'  => stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_error\_message']), |
| [5483](#L5483) | 'trigger'  => 'blur', |
| [5484](#L5484) | ); |
| [5485](#L5485) | } |
| [5486](#L5486) |  |
| [5487](#L5487) | if(isset($bookingpress\_form\_fields\_error\_msg\_arr[$bookingpress\_v\_model\_value][0]['message']) && $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value][0]['message'] == '') { |
| [5488](#L5488) | $bookingpress\_form\_fields\_error\_msg\_arr[ $bookingpress\_v\_model\_value ][0]['message'] = !empty($bookingpress\_form\_field\_val['bookingpress\_field\_label']) ?  stripslashes\_deep($bookingpress\_form\_field\_val['bookingpress\_field\_label']).' '.esc\_html\_\_('is required','bookingpress-appointment-booking') : ''; |
| [5489](#L5489) | } |
| [5490](#L5490) | } |
| [5491](#L5491) | $bookingpress\_form\_fields\_error\_msg\_arr = apply\_filters( 'bookingpress\_modify\_form\_fields\_rules\_arr', $bookingpress\_form\_fields\_error\_msg\_arr,$bookingpress\_field\_setting\_fields\_tmp ); |
| [5492](#L5492) | } |
| [5493](#L5493) | } |
| [5494](#L5494) |  |
| [5495](#L5495) | $this->bookingpress\_form\_fields\_error\_msg\_arr = apply\_filters( 'bookingpress\_modify\_form\_fields\_msg\_array', $bookingpress\_form\_fields\_error\_msg\_arr ); |
| [5496](#L5496) |  |
| [5497](#L5497) | $this->bookingpress\_form\_fields\_new           = $bookingpress\_form\_fields\_new; |
| [5498](#L5498) |  |
| [5499](#L5499) | $bookingress\_load\_js\_css\_all\_pages = $BookingPress->bookingpress\_get\_settings('load\_js\_css\_all\_pages', 'general\_setting'); |
| [5500](#L5500) |  |
| [5501](#L5501) | // ----------------------------------------------------- |
| [5502](#L5502) |  |
| [5503](#L5503) | if (is\_user\_logged\_in() ) { |
| [5504](#L5504) | $bookingpress\_wp\_user\_id              = get\_current\_user\_id(); |
| [5505](#L5505) | $bookingpress\_check\_user\_exist\_or\_not = $wpdb->get\_var( $wpdb->prepare( "SELECT COUNT(bookingpress\_customer\_id) as total FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d AND bookingpress\_user\_status = 0 AND bookingpress\_user\_type = 0", $bookingpress\_wp\_user\_id ));  // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [5506](#L5506) | if ($bookingpress\_check\_user\_exist\_or\_not > 0 ) { |
| [5507](#L5507) | $bookingpress\_update\_customer\_data = array( |
| [5508](#L5508) | 'bookingpress\_user\_status' => 1, |
| [5509](#L5509) | 'bookingpress\_user\_type'   => 2, |
| [5510](#L5510) | ); |
| [5511](#L5511) |  |
| [5512](#L5512) | $bookingpress\_where\_condition = array( |
| [5513](#L5513) | 'bookingpress\_wpuser\_id' => $bookingpress\_wp\_user\_id, |
| [5514](#L5514) | ); |
| [5515](#L5515) |  |
| [5516](#L5516) | $wpdb->update($tbl\_bookingpress\_customers, $bookingpress\_update\_customer\_data, $bookingpress\_where\_condition); |
| [5517](#L5517) | } |
| [5518](#L5518) | } |
| [5519](#L5519) |  |
| [5520](#L5520) | $bookingpress\_uniq\_id = uniqid(); |
| [5521](#L5521) |  |
| [5522](#L5522) | $BookingPress->set\_front\_css(1); |
| [5523](#L5523) | $BookingPress->set\_front\_js(1); |
| [5524](#L5524) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [5525](#L5525) |  |
| [5526](#L5526) | $BookingPress->bookingpress\_load\_mybookings\_custom\_js(); |
| [5527](#L5527) |  |
| [5528](#L5528) | //Code for modify front shortcode data from outside |
| [5529](#L5529) | //------------------------------------------------------- |
| [5530](#L5530) | $bookingpress\_class\_vars\_val = array( |
| [5531](#L5531) | 'form\_category' => $this->bookingpress\_form\_category, |
| [5532](#L5532) | 'form\_service' => $this->bookingpress\_form\_service, |
| [5533](#L5533) | 'hide\_category\_service' => $this->bookingpress\_hide\_category\_service, |
| [5534](#L5534) | 'default\_date\_format' => $this->bookingpress\_default\_date\_format, |
| [5535](#L5535) | 'default\_time\_format' => $this->bookingpress\_default\_time\_format, |
| [5536](#L5536) | 'form\_field\_err\_msg\_arr' => $this->bookingpress\_form\_fields\_error\_msg\_arr, |
| [5537](#L5537) | 'form\_fields\_new' => $this->bookingpress\_form\_fields\_new, |
| [5538](#L5538) | 'is\_service\_load\_from\_url' => $this->bookingpress\_is\_service\_load\_from\_url, |
| [5539](#L5539) | ); |
| [5540](#L5540) |  |
| [5541](#L5541) | do\_action('bookingpress\_add\_dynamic\_details\_booking\_shortcode', $bookingpress\_uniq\_id, $bookingpress\_class\_vars\_val, $args); |
| [5542](#L5542) | //------------------------------------------------------- |
| [5543](#L5543) |  |
| [5544](#L5544) | ob\_start(); |
| [5545](#L5545) | $bookingpress\_shortcode\_file\_url = BOOKINGPRESS\_VIEWS\_DIR . '/frontend/appointment\_booking\_form.php'; |
| [5546](#L5546) | $bookingpress\_shortcode\_file\_url = apply\_filters('bookingpress\_change\_booking\_shortcode\_file\_url', $bookingpress\_shortcode\_file\_url); |
| [5547](#L5547) | include $bookingpress\_shortcode\_file\_url; |
| [5548](#L5548) | $content .= ob\_get\_clean(); |
| [5549](#L5549) |  |
| [5550](#L5550) | // Main data loading script |
| [5551](#L5551) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5552](#L5552) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [5553](#L5553) | $bookingpress\_wp\_default\_time\_format = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [5554](#L5554) |  |
| [5555](#L5555) | $bookingpress\_site\_current\_language = get\_locale(); |
| [5556](#L5556) | if ($bookingpress\_site\_current\_language == 'ru\_RU' ) { |
| [5557](#L5557) | $bookingpress\_site\_current\_language = 'ru'; |
| [5558](#L5558) | } elseif ($bookingpress\_site\_current\_language == 'ar' ) { |
| [5559](#L5559) | $bookingpress\_site\_current\_language = 'ar'; // arabic |
| [5560](#L5560) | } elseif ($bookingpress\_site\_current\_language == 'bg\_BG' ) { |
| [5561](#L5561) | $bookingpress\_site\_current\_language = 'bg'; // Bulgeria |
| [5562](#L5562) | } elseif ($bookingpress\_site\_current\_language == 'ca' ) { |
| [5563](#L5563) | $bookingpress\_site\_current\_language = 'ca'; // Canada |
| [5564](#L5564) | } elseif ($bookingpress\_site\_current\_language == 'da\_DK' ) { |
| [5565](#L5565) | $bookingpress\_site\_current\_language = 'da'; // Denmark |
| [5566](#L5566) | } elseif ($bookingpress\_site\_current\_language == 'de\_DE' || $bookingpress\_site\_current\_language == 'de\_CH\_informal' || $bookingpress\_site\_current\_language == 'de\_AT' || $bookingpress\_site\_current\_language == 'de\_CH' || $bookingpress\_site\_current\_language == 'de\_DE\_formal' ) { |
| [5567](#L5567) | $bookingpress\_site\_current\_language = 'de'; // Germany |
| [5568](#L5568) | } elseif ($bookingpress\_site\_current\_language == 'el' ) { |
| [5569](#L5569) | $bookingpress\_site\_current\_language = 'el'; // Greece |
| [5570](#L5570) | } elseif ($bookingpress\_site\_current\_language == 'es\_ES' ) { |
| [5571](#L5571) | $bookingpress\_site\_current\_language = 'es'; // Spain |
| [5572](#L5572) | } elseif ($bookingpress\_site\_current\_language == 'fr\_FR' ) { |
| [5573](#L5573) | $bookingpress\_site\_current\_language = 'fr'; // France |
| [5574](#L5574) | } elseif ($bookingpress\_site\_current\_language == 'hr' ) { |
| [5575](#L5575) | $bookingpress\_site\_current\_language = 'hr'; // Croatia |
| [5576](#L5576) | } elseif ($bookingpress\_site\_current\_language == 'hu\_HU' ) { |
| [5577](#L5577) | $bookingpress\_site\_current\_language = 'hu'; // Hungary |
| [5578](#L5578) | } elseif ($bookingpress\_site\_current\_language == 'id\_ID' ) { |
| [5579](#L5579) | $bookingpress\_site\_current\_language = 'id'; // Indonesia |
| [5580](#L5580) | } elseif ($bookingpress\_site\_current\_language == 'is\_IS' ) { |
| [5581](#L5581) | $bookingpress\_site\_current\_language = 'is'; // Iceland |
| [5582](#L5582) | } elseif ($bookingpress\_site\_current\_language == 'it\_IT' ) { |
| [5583](#L5583) | $bookingpress\_site\_current\_language = 'it'; // Italy |
| [5584](#L5584) | } elseif ($bookingpress\_site\_current\_language == 'ja' ) { |
| [5585](#L5585) | $bookingpress\_site\_current\_language = 'ja'; // Japan |
| [5586](#L5586) | } elseif ($bookingpress\_site\_current\_language == 'ka\_GE' ) { |
| [5587](#L5587) | $bookingpress\_site\_current\_language = 'ka'; // Georgia |
| [5588](#L5588) | } elseif ($bookingpress\_site\_current\_language == 'ko\_KR' ) { |
| [5589](#L5589) | $bookingpress\_site\_current\_language = 'ko'; // Korean |
| [5590](#L5590) | } elseif ($bookingpress\_site\_current\_language == 'lt\_LT' ) { |
| [5591](#L5591) | $bookingpress\_site\_current\_language = 'lt'; // Lithunian |
| [5592](#L5592) | } elseif ($bookingpress\_site\_current\_language == 'mn' ) { |
| [5593](#L5593) | $bookingpress\_site\_current\_language = 'mn'; // Mongolia |
| [5594](#L5594) | } elseif ($bookingpress\_site\_current\_language == 'nl\_NL' ) { |
| [5595](#L5595) | $bookingpress\_site\_current\_language = 'nl'; // Netherlands |
| [5596](#L5596) | } elseif ($bookingpress\_site\_current\_language == 'nn\_NO' ) { |
| [5597](#L5597) | $bookingpress\_site\_current\_language = 'no'; // Norway |
| [5598](#L5598) | } elseif ($bookingpress\_site\_current\_language == 'pl\_PL' ) { |
| [5599](#L5599) | $bookingpress\_site\_current\_language = 'pl'; // Poland |
| [5600](#L5600) | } elseif ($bookingpress\_site\_current\_language == 'pt\_BR' ) { |
| [5601](#L5601) | $bookingpress\_site\_current\_language = 'pt-br'; // Portuguese |
| [5602](#L5602) | } elseif ($bookingpress\_site\_current\_language == 'ro\_RO' ) { |
| [5603](#L5603) | $bookingpress\_site\_current\_language = 'ro'; // Romania |
| [5604](#L5604) | } elseif ($bookingpress\_site\_current\_language == 'sk\_SK' ) { |
| [5605](#L5605) | $bookingpress\_site\_current\_language = 'sk'; // Slovakia |
| [5606](#L5606) | } elseif ($bookingpress\_site\_current\_language == 'sl\_SI' ) { |
| [5607](#L5607) | $bookingpress\_site\_current\_language = 'sl'; // Slovenia |
| [5608](#L5608) | } elseif ($bookingpress\_site\_current\_language == 'sq' ) { |
| [5609](#L5609) | $bookingpress\_site\_current\_language = 'sq'; // Albanian |
| [5610](#L5610) | } elseif ($bookingpress\_site\_current\_language == 'sr\_RS' ) { |
| [5611](#L5611) | $bookingpress\_site\_current\_language = 'sr'; // Suriname |
| [5612](#L5612) | } elseif ($bookingpress\_site\_current\_language == 'sv\_SE' ) { |
| [5613](#L5613) | $bookingpress\_site\_current\_language = 'sv'; // El Salvador |
| [5614](#L5614) | } elseif ($bookingpress\_site\_current\_language == 'tr\_TR' ) { |
| [5615](#L5615) | $bookingpress\_site\_current\_language = 'tr'; // Turkey |
| [5616](#L5616) | } elseif ($bookingpress\_site\_current\_language == 'uk' ) { |
| [5617](#L5617) | $bookingpress\_site\_current\_language = 'uk'; // Ukrain |
| [5618](#L5618) | } elseif ($bookingpress\_site\_current\_language == 'vi' ) { |
| [5619](#L5619) | $bookingpress\_site\_current\_language = 'vi'; // Virgin Islands (U.S.) |
| [5620](#L5620) | } elseif ($bookingpress\_site\_current\_language == 'zh\_CN' ) { |
| [5621](#L5621) | $bookingpress\_site\_current\_language = 'zh-cn'; // Chinese |
| [5622](#L5622) | } elseif ($bookingpress\_site\_current\_language == 'nl\_BE'){ |
| [5623](#L5623) | $bookingpress\_site\_current\_language = 'nl-be'; // Nederlands ( Belgi ) |
| [5624](#L5624) | } elseif ($bookingpress\_site\_current\_language == 'cs\_CZ'){ |
| [5625](#L5625) | $bookingpress\_site\_current\_language = 'cs'; |
| [5626](#L5626) | }elseif ($bookingpress\_site\_current\_language == 'pt\_PT'){ |
| [5627](#L5627) | $bookingpress\_site\_current\_language = 'pt'; |
| [5628](#L5628) | }elseif ($bookingpress\_site\_current\_language == 'et'){ |
| [5629](#L5629) | $bookingpress\_site\_current\_language = 'et'; |
| [5630](#L5630) | }elseif ($bookingpress\_site\_current\_language == 'nb\_NO'){ |
| [5631](#L5631) | $bookingpress\_site\_current\_language = 'no'; |
| [5632](#L5632) | } elseif ($bookingpress\_site\_current\_language == 'lv'){ |
| [5633](#L5633) | $bookingpress\_site\_current\_language = 'lv'; |
| [5634](#L5634) | }elseif ($bookingpress\_site\_current\_language == 'az'){ |
| [5635](#L5635) | $bookingpress\_site\_current\_language = 'az'; |
| [5636](#L5636) | }elseif ($bookingpress\_site\_current\_language == 'fi'){ |
| [5637](#L5637) | $bookingpress\_site\_current\_language = 'fi'; //Finnish |
| [5638](#L5638) | }elseif ($bookingpress\_site\_current\_language == 'gl\_ES'){ |
| [5639](#L5639) | $bookingpress\_site\_current\_language = 'gl'; //Galician |
| [5640](#L5640) | }elseif ($bookingpress\_site\_current\_language == 'he\_IL' ) { |
| [5641](#L5641) | $bookingpress\_site\_current\_language = 'he';//Hebrew |
| [5642](#L5642) | }else { |
| [5643](#L5643) | $bookingpress\_site\_current\_language = 'en'; |
| [5644](#L5644) | } |
| [5645](#L5645) |  |
| [5646](#L5646) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [5647](#L5647) |  |
| [5648](#L5648) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [5649](#L5649) |  |
| [5650](#L5650) | $bookingpress\_script\_return\_data = ''; |
| [5651](#L5651) |  |
| [5652](#L5652) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = ''; |
| [5653](#L5653) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = apply\_filters('bookingpress\_front\_booking\_dynamic\_helper\_vars', $bookingpress\_front\_booking\_dynamic\_helper\_vars); |
| [5654](#L5654) |  |
| [5655](#L5655) | $bookingpress\_vue\_root\_element\_id = '#bookingpress\_booking\_form\_' . $bookingpress\_uniq\_id; |
| [5656](#L5656) | $bookingpress\_vue\_root\_element\_id\_without\_hash = 'bookingpress\_booking\_form\_' . $bookingpress\_uniq\_id; |
| [5657](#L5657) | $bookingpress\_vue\_root\_element\_id\_el = 'method\_' . $bookingpress\_uniq\_id; |
| [5658](#L5658) |  |
| [5659](#L5659) | $bookingpress\_dynamic\_directive\_data = ''; |
| [5660](#L5660) | $bookingpress\_dynamic\_directive\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_directives', $bookingpress\_dynamic\_directive\_data); |
| [5661](#L5661) |  |
| [5662](#L5662) | $bookingpress\_dynamic\_data\_fields = ''; |
| [5663](#L5663) | $bookingpress\_dynamic\_data\_fields = apply\_filters('bookingpress\_front\_booking\_dynamic\_data\_fields', $bookingpress\_dynamic\_data\_fields, $this->bookingpress\_form\_category, $this->bookingpress\_form\_service,$selected\_service,$selected\_category); |
| [5664](#L5664) |  |
| [5665](#L5665) |  |
| [5666](#L5666) |  |
| [5667](#L5667) |  |
| [5668](#L5668) |  |
| [5669](#L5669) | $bookingpress\_dynamic\_on\_load\_methods\_data = ''; |
| [5670](#L5670) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [5671](#L5671) |  |
| [5672](#L5672) | $bookingpress\_vue\_methods\_data = ''; |
| [5673](#L5673) | $bookingpress\_vue\_methods\_data = apply\_filters('bookingpress\_front\_booking\_dynamic\_vue\_methods', $bookingpress\_vue\_methods\_data); |
| [5674](#L5674) |  |
| [5675](#L5675) | $bookingpress\_password\_check\_data = ''; |
| [5676](#L5676) | $bookingpress\_password\_check\_data = apply\_filters('bookingpress\_front\_check\_password\_validation', $bookingpress\_password\_check\_data); |
| [5677](#L5677) |  |
| [5678](#L5678) | $bookingpress\_password\_check\_for\_username = ''; |
| [5679](#L5679) | $bookingpress\_password\_check\_for\_username = apply\_filters('bookingpress\_front\_check\_password\_with\_username\_validation', $bookingpress\_password\_check\_for\_username); |
| [5680](#L5680) |  |
| [5681](#L5681) |  |
| [5682](#L5682) | if (! empty($bookingpress\_front\_booking\_dynamic\_helper\_vars) ) { |
| [5683](#L5683) | $bookingpress\_script\_return\_data .= $bookingpress\_front\_booking\_dynamic\_helper\_vars; |
| [5684](#L5684) | } |
| [5685](#L5685) |  |
| [5686](#L5686) | $bookingpress\_script\_return\_data .= "var bookingpress\_uniq\_id\_js\_var = '" . $bookingpress\_uniq\_id . "';"; |
| [5687](#L5687) |  |
| [5688](#L5688) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [5689](#L5689) |  |
| [5690](#L5690) | $bookingpress\_site\_date = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [5691](#L5691) | $bookingpress\_site\_date = apply\_filters( 'bookingpress\_modify\_current\_date', $bookingpress\_site\_date ); |
| [5692](#L5692) | if( !empty( $bookingpress\_site\_date ) ){ |
| [5693](#L5693) | $bookingpress\_site\_current\_date = date( 'Y-m-d', strtotime( $bookingpress\_site\_date ) ) . ' 00:00:00'; |
| [5694](#L5694) | } else { |
| [5695](#L5695) | $bookingpress\_site\_current\_date = ""; |
| [5696](#L5696) | } |
| [5697](#L5697) | $bookingpress\_site\_date = str\_replace('-', '/', $bookingpress\_site\_date); |
| [5698](#L5698) |  |
| [5699](#L5699) | $bpa\_allow\_modify\_from\_url = !empty($\_GET['allow\_modify']) ? 1 : 0; |
| [5700](#L5700) |  |
| [5701](#L5701) | if( ( isset($\_GET['bpservice\_id']) ) || isset($\_GET['s\_id']) ){ |
| [5702](#L5702) | $this->bookingpress\_is\_service\_load\_from\_url = 1; |
| [5703](#L5703) | } |
| [5704](#L5704) |  |
| [5705](#L5705) | if( 1 == $this->bookingpress\_is\_service\_load\_from\_url ){ |
| [5706](#L5706) | if( empty( $selected\_service ) ){ |
| [5707](#L5707) | $this->bookingpress\_is\_service\_load\_from\_url = 0; |
| [5708](#L5708) | } |
| [5709](#L5709) | } |
| [5710](#L5710) |  |
| [5711](#L5711) | $first\_day\_of\_week = (int)  $bookingpress\_global\_options\_arr['start\_of\_week']; |
| [5712](#L5712) | $first\_day\_of\_week\_inc = $first\_day\_of\_week + 1; |
| [5713](#L5713) |  |
| [5714](#L5714) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [5715](#L5715) |  |
| [5716](#L5716) | if($bookingpress\_site\_current\_lang\_moment\_locale == "am" || $bookingpress\_site\_current\_lang\_moment\_locale == "ary" || $bookingpress\_site\_current\_lang\_moment\_locale == "skr") { |
| [5717](#L5717) | $bookingpress\_site\_current\_lang\_moment\_locale = "ar"; |
| [5718](#L5718) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "azb" ) { |
| [5719](#L5719) | $bookingpress\_site\_current\_lang\_moment\_locale = "fa\_AF"; |
| [5720](#L5720) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "dsb" || $bookingpress\_site\_current\_lang\_moment\_locale == "hsb" || $bookingpress\_site\_current\_lang\_moment\_locale == "szl" ) { |
| [5721](#L5721) | $bookingpress\_site\_current\_lang\_moment\_locale = "pl"; |
| [5722](#L5722) | }else if( $bookingpress\_site\_current\_lang\_moment\_locale == "fur" ) { |
| [5723](#L5723) | $bookingpress\_site\_current\_lang\_moment\_locale = "it"; |
| [5724](#L5724) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "ckb" ) { |
| [5725](#L5725) | $bookingpress\_site\_current\_lang\_moment\_locale = "ku"; |
| [5726](#L5726) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "oci" ) { |
| [5727](#L5727) | $bookingpress\_site\_current\_lang\_moment\_locale = "ca"; |
| [5728](#L5728) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "sah" ) { |
| [5729](#L5729) | $bookingpress\_site\_current\_lang\_moment\_locale = "ky"; |
| [5730](#L5730) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "tl" ) { |
| [5731](#L5731) | $bookingpress\_site\_current\_lang\_moment\_locale = "fil"; |
| [5732](#L5732) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "as" ) { |
| [5733](#L5733) | $bookingpress\_site\_current\_lang\_moment\_locale = "bn"; |
| [5734](#L5734) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "hy" ) { |
| [5735](#L5735) | $bookingpress\_site\_current\_lang\_moment\_locale = "hy-am"; |
| [5736](#L5736) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "et" ) { |
| [5737](#L5737) | $bookingpress\_site\_current\_lang\_moment\_locale = "et"; |
| [5738](#L5738) | }else if ( $bookingpress\_site\_current\_lang\_moment\_locale == "nb\_NO" ) { |
| [5739](#L5739) | $bookingpress\_site\_current\_lang\_moment\_locale = "no"; |
| [5740](#L5740) | } |
| [5741](#L5741) |  |
| [5742](#L5742) | $bookingpress\_global\_details  = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [5743](#L5743) | $bookingpress\_wp\_default\_time\_format = $bookingpress\_global\_details['wp\_default\_time\_format']; |
| [5744](#L5744) | $bookingpress\_inherit\_from\_wordpress\_arr = json\_decode($bookingpress\_global\_details['bookingpress\_inherit\_from\_wordpress\_arr'],true); |
| [5745](#L5745) |  |
| [5746](#L5746) | if(isset($bookingpress\_inherit\_from\_wordpress\_arr[$bookingpress\_wp\_default\_time\_format])){ |
| [5747](#L5747) | $bookingpress\_formatted\_timeslot = $bookingpress\_inherit\_from\_wordpress\_arr[$bookingpress\_wp\_default\_time\_format]; |
| [5748](#L5748) | } |
| [5749](#L5749) |  |
| [5750](#L5750) | $bookingpress\_script\_return\_data .= 'app = new Vue({ |
| [5751](#L5751) | el: "' . $bookingpress\_vue\_root\_element\_id . '", |
| [5752](#L5752) | components: {}, |
| [5753](#L5753) | directives: { ' . $bookingpress\_dynamic\_directive\_data . ' }, |
| [5754](#L5754) | data(){ |
| [5755](#L5755) |  |
| [5756](#L5756) | var bpa\_check\_username = ( rule, value, callback ) =>{ |
| [5757](#L5757) | const vm = this; |
| [5758](#L5758) |  |
| [5759](#L5759) | if( "undefined" == vm.appointment\_step\_form\_data.check\_username\_validation || false == vm.appointment\_step\_form\_data.check\_username\_validation ){ |
| [5760](#L5760) | if( "undefined" != vm.appointment\_step\_form\_data.invalid\_customer\_username && true == vm.appointment\_step\_form\_data.invalid\_customer\_username ){ |
| [5761](#L5761) | return callback( new Error( vm.appointment\_step\_form\_data.invalid\_customer\_message ) ); |
| [5762](#L5762) | } else { |
| [5763](#L5763) | return callback(); |
| [5764](#L5764) | } |
| [5765](#L5765) | } |
| [5766](#L5766) |  |
| [5767](#L5767) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [5768](#L5768) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5769](#L5769) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [5770](#L5770) | { |
| [5771](#L5771) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [5772](#L5772) | } |
| [5773](#L5773) | else { |
| [5774](#L5774) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [5775](#L5775) | } |
| [5776](#L5776) | let bookingpress\_username\_value = value; |
| [5777](#L5777) |  |
| [5778](#L5778) | var bookingpress\_username = { action:"bookingpress\_validate\_username", \_username: bookingpress\_username\_value, \_wpnonce:bkp\_wpnonce\_pre\_fetch}; |
| [5779](#L5779) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( bookingpress\_username ) ) |
| [5780](#L5780) | .then( function (response) { |
| [5781](#L5781) | vm.appointment\_step\_form\_data.check\_username\_validation = false; |
| [5782](#L5782) | '.$bookingpress\_password\_check\_data.'; |
| [5783](#L5783) | if(response.data.variant == "error"){ |
| [5784](#L5784) | vm.appointment\_step\_form\_data.invalid\_customer\_username = true; |
| [5785](#L5785) | vm.appointment\_step\_form\_data.invalid\_customer\_message = response.data.msg; |
| [5786](#L5786) | return callback(new Error( response.data.msg )); |
| [5787](#L5787) | } else { |
| [5788](#L5788) | if(this.$refs.appointment\_step\_form\_data && "undefined" != typeof vm.appointment\_step\_form\_data.form\_fields.customer\_password){ |
| [5789](#L5789) | this.$refs.appointment\_step\_form\_data.clearValidate("customer\_password"); |
| [5790](#L5790) | } |
| [5791](#L5791) | vm.appointment\_step\_form\_data.invalid\_customer\_username = false; |
| [5792](#L5792) | callback(); |
| [5793](#L5793) | } |
| [5794](#L5794) | }.bind(this) ) |
| [5795](#L5795) | .catch( function (error) { |
| [5796](#L5796) | vm.bookingpress\_set\_error\_msg(error) |
| [5797](#L5797) | }); |
| [5798](#L5798) | }; |
| [5799](#L5799) |  |
| [5800](#L5800) | var bookingpress\_return\_data = ' . $bookingpress\_dynamic\_data\_fields . '; |
| [5801](#L5801) | bookingpress\_return\_data["jsCurrentDate"] = new Date('. ( !empty( $bookingpress\_site\_date ) ? '"'.$bookingpress\_site\_date.'"' : '' ) .'); |
| [5802](#L5802) | bookingpress\_return\_data["jsCurrentDateFormatted"] = new Date ('. ( !empty( $bookingpress\_site\_current\_date ) ? '"'.$bookingpress\_site\_current\_date.'"' : '' ) .'); |
| [5803](#L5803) | bookingpress\_return\_data["jsCurrentOnlyDate"] = bookingpress\_return\_data["jsCurrentDateFormatted"].toISOString().split("T")[0]; |
| [5804](#L5804) | bookingpress\_return\_data["appointment\_step\_form\_data"]["stime"] = ' . ( time() + 14921 ) . '; |
| [5805](#L5805) | bookingpress\_return\_data["appointment\_step\_form\_data"]["spam\_captcha"] = ""; |
| [5806](#L5806) | bookingpress\_return\_data["hide\_category\_service"] = "' . $this->bookingpress\_hide\_category\_service . '"; |
| [5807](#L5807) | bookingpress\_return\_data["default\_date\_format"] = "' . $this->bookingpress\_default\_date\_format . '"; |
| [5808](#L5808) | bookingpress\_return\_data["customer\_details\_rule"] = ' . wp\_json\_encode($this->bookingpress\_form\_fields\_error\_msg\_arr) . '; |
| [5809](#L5809) |  |
| [5810](#L5810) | if( "undefined" != typeof bookingpress\_return\_data["customer\_details\_rule"].customer\_username && bookingpress\_return\_data["check\_bookingpress\_username\_set"] == 0 ){ |
| [5811](#L5811) |  |
| [5812](#L5812) | let rule\_for\_username = { |
| [5813](#L5813) | "validator": bpa\_check\_username, |
| [5814](#L5814) | "trigger": "blur" |
| [5815](#L5815) | }; |
| [5816](#L5816) |  |
| [5817](#L5817) | bookingpress\_return\_data["customer\_details\_rule"].customer\_username.push( rule\_for\_username ); |
| [5818](#L5818) |  |
| [5819](#L5819) | } |
| [5820](#L5820) |  |
| [5821](#L5821) | bookingpress\_return\_data["customer\_form\_fields"] = ' . wp\_json\_encode($this->bookingpress\_form\_fields\_new) . '; |
| [5822](#L5822) | bookingpress\_return\_data["is\_error\_msg"] = ""; |
| [5823](#L5823) | bookingpress\_return\_data["is\_display\_error"] = "0"; |
| [5824](#L5824) | bookingpress\_return\_data["is\_service\_loaded\_from\_url"] = "' . $this->bookingpress\_is\_service\_load\_from\_url . '"; |
| [5825](#L5825) | bookingpress\_return\_data["booking\_cal\_maxdate"] = new Date( Date.now() + ( 3600 \* 1000 \* (24 \* 365) ) ); |
| [5826](#L5826) | bookingpress\_return\_data["is\_booking\_form\_empty\_loader"] = "1"; |
| [5827](#L5827) | bookingpress\_return\_data["bpa\_allow\_modify\_from\_url"] = "'.$bpa\_allow\_modify\_from\_url.'"; |
| [5828](#L5828) |  |
| [5829](#L5829) | bookingpress\_return\_data["site\_locale"] = "' . $bookingpress\_site\_current\_language . '"; |
| [5830](#L5830) | bookingpress\_return\_data["appointment\_step\_form\_data"]["bookingpress\_uniq\_id"] = "' . $bookingpress\_uniq\_id . '"; |
| [5831](#L5831) | var bookingpress\_captcha\_key = "bookingpress\_captcha\_' . $bookingpress\_uniq\_id . '"; |
| [5832](#L5832) | bookingpress\_return\_data["appointment\_step\_form\_data"][bookingpress\_captcha\_key] = ""; |
| [5833](#L5833) |  |
| [5834](#L5834) | bookingpress\_return\_data["first\_day\_of\_week"] = "' . $first\_day\_of\_week\_inc. '"; |
| [5835](#L5835) | bookingpress\_return\_data["filter\_pickerOptions"] = { |
| [5836](#L5836) | "firstDayOfWeek": '.$first\_day\_of\_week.', |
| [5837](#L5837) | }; |
| [5838](#L5838) | bookingpress\_return\_data["appointment\_step\_form\_data"]["base\_price\_without\_currency"] = 0; |
| [5839](#L5839) | bookingpress\_return\_data["use\_base\_price\_for\_calculation"] = true; |
| [5840](#L5840) |  |
| [5841](#L5841) | bookingpress\_return\_data["modelConfig"] = { |
| [5842](#L5842) | "type": "string", |
| [5843](#L5843) | "mask": "YYYY-MM-DD", |
| [5844](#L5844) | }; |
| [5845](#L5845) |  |
| [5846](#L5846) |  |
| [5847](#L5847) | return bookingpress\_return\_data; |
| [5848](#L5848) | }, |
| [5849](#L5849) | filters: { |
| [5850](#L5850) | bookingpress\_format\_date: function(value){ |
| [5851](#L5851) | var default\_date\_format = "' . $this->bookingpress\_default\_date\_format . '"; |
| [5852](#L5852) | return moment(String(value)).locale("'.$bookingpress\_site\_current\_lang\_moment\_locale.'").format(default\_date\_format) |
| [5853](#L5853) | }, |
| [5854](#L5854) | bookingpress\_format\_time: function(value){ |
| [5855](#L5855) | var default\_time\_format = "' . $bookingpress\_formatted\_timeslot . '"; |
| [5856](#L5856) | return moment(String(value), "HH:mm:ss").locale("'.$bookingpress\_site\_current\_lang\_moment\_locale.'").format(default\_time\_format) |
| [5857](#L5857) | } |
| [5858](#L5858) | }, |
| [5859](#L5859) | beforeCreate(){ |
| [5860](#L5860) | this.is\_booking\_form\_empty\_loader = "1"; |
| [5861](#L5861) | }, |
| [5862](#L5862) | created(){ |
| [5863](#L5863) | this.bookingpress\_load\_booking\_form(); |
| [5864](#L5864) | }, |
| [5865](#L5865) | mounted(){ |
| [5866](#L5866) | const vm\_onload = this; |
| [5867](#L5867) |  |
| [5868](#L5868) | if( "undefined" != typeof window.location.href && /post\.php/.test( window.location.href ) ){ |
| [5869](#L5869) | return; |
| [5870](#L5870) | } |
| [5871](#L5871) |  |
| [5872](#L5872) | vm\_onload.bpa\_check\_browser(); |
| [5873](#L5873) | vm\_onload.bpa\_check\_browser\_version(); |
| [5874](#L5874) |  |
| [5875](#L5875) | let selected\_category = vm\_onload.appointment\_step\_form\_data.selected\_category; |
| [5876](#L5876) | vm\_onload.bpa\_select\_category( selected\_category ); |
| [5877](#L5877) |  |
| [5878](#L5878) | this.loadSpamProtection(); |
| [5879](#L5879) |  |
| [5880](#L5880) | ' . $bookingpress\_dynamic\_on\_load\_methods\_data . ' |
| [5881](#L5881) |  |
| [5882](#L5882) | }, |
| [5883](#L5883) | computed:{ |
| [5884](#L5884) | bpasortedServices: function(){ |
| [5885](#L5885) | let bookingpress\_all\_services\_data = []; |
| [5886](#L5886) | for( let i in this.bookingpress\_all\_services\_data ){ |
| [5887](#L5887) | bookingpress\_all\_services\_data.push( this.bookingpress\_all\_services\_data[i] ); |
| [5888](#L5888) | } |
| [5889](#L5889) | return bookingpress\_all\_services\_data.sort( (a, b) =>{ |
| [5890](#L5890) | return ( parseInt( a.bookingpress\_service\_position ) < parseInt( b.bookingpress\_service\_position ) ) ? -1 : 1; |
| [5891](#L5891) | }); |
| [5892](#L5892) | } |
| [5893](#L5893) | }, |
| [5894](#L5894) | methods: { |
| [5895](#L5895) | bpa\_check\_username\_validation(bpa\_username){ |
| [5896](#L5896) | const vm = this; |
| [5897](#L5897) | if( bpa\_username != ""){ |
| [5898](#L5898) | vm.appointment\_step\_form\_data.check\_username\_validation = true; |
| [5899](#L5899) | } else { |
| [5900](#L5900) | vm.appointment\_step\_form\_data.check\_username\_validation = false; |
| [5901](#L5901) | '.$bookingpress\_password\_check\_for\_username.'; |
| [5902](#L5902) | } |
| [5903](#L5903) | }, |
| [5904](#L5904) | bookingpress\_load\_booking\_form(){ |
| [5905](#L5905) | const vm = this; |
| [5906](#L5906) | setTimeout(function(){ |
| [5907](#L5907) | vm.is\_booking\_form\_empty\_loader = "0"; |
| [5908](#L5908) | setTimeout(function(){ |
| [5909](#L5909) | var elms = document.querySelectorAll("#bpa-front-tabs"); |
| [5910](#L5910) | for(var i = 0; i < elms.length; i++)  { |
| [5911](#L5911) | elms[i].style.display = "flex"; |
| [5912](#L5912) | } |
| [5913](#L5913) |  |
| [5914](#L5914) |  |
| [5915](#L5915) | var elms2 = document.querySelectorAll("#bpa-front-data-empty-view"); |
| [5916](#L5916) | for(var i = 0; i < elms2.length; i++)  { |
| [5917](#L5917) | elms2[i].style.display = "flex"; |
| [5918](#L5918) | } |
| [5919](#L5919) |  |
| [5920](#L5920) | }, 500); |
| [5921](#L5921) | }, 2000); |
| [5922](#L5922) | }, |
| [5923](#L5923) | generateSpamCaptcha(){ |
| [5924](#L5924) | const vm = this; |
| [5925](#L5925) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [5926](#L5926) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5927](#L5927) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [5928](#L5928) | { |
| [5929](#L5929) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [5930](#L5930) | } |
| [5931](#L5931) | else { |
| [5932](#L5932) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [5933](#L5933) | } |
| [5934](#L5934) | var postData = { action: "bookingpress\_generate\_spam\_captcha", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [5935](#L5935) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [5936](#L5936) | .then( function (response) { |
| [5937](#L5937) | if(response.variant != "error" && (response.data.captcha\_val != "" && response.data.captcha\_val != undefined)){ |
| [5938](#L5938) | vm.appointment\_step\_form\_data.spam\_captcha = response.data.captcha\_val; |
| [5939](#L5939) | }else{ |
| [5940](#L5940) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [5941](#L5941) | if(typeof bkp\_wpnonce\_pre\_fetch!="undefined" && bkp\_wpnonce\_pre\_fetch!=null && response.data.updated\_nonce!="") |
| [5942](#L5942) | { |
| [5943](#L5943) | document.getElementById("\_wpnonce").value = response.data.updated\_nonce; |
| [5944](#L5944) | } else { |
| [5945](#L5945) | vm.$notify({ |
| [5946](#L5946) | title: response.data.title, |
| [5947](#L5947) | message: response.data.msg, |
| [5948](#L5948) | type: response.data.variant, |
| [5949](#L5949) | customClass: "error\_notification" |
| [5950](#L5950) | }); |
| [5951](#L5951) | } |
| [5952](#L5952) | } |
| [5953](#L5953) | }.bind(this) ) |
| [5954](#L5954) | .catch( function (error) { |
| [5955](#L5955) | console.log(error); |
| [5956](#L5956) | }); |
| [5957](#L5957) | }, |
| [5958](#L5958) | loadSpamProtection(){ |
| [5959](#L5959) | const vm = this; |
| [5960](#L5960) | vm.generateSpamCaptcha(); |
| [5961](#L5961) | }, |
| [5962](#L5962) | bookingpress\_price\_with\_currency\_symbol( price\_amount, ignore\_symbol = false ){ |
| [5963](#L5963) | const vm = this; |
| [5964](#L5964) | if( "String" == typeof price\_amount ){ |
| [5965](#L5965) | price\_amount = parseFloat( price\_amount ); |
| [5966](#L5966) | } |
| [5967](#L5967) |  |
| [5968](#L5968) | let currency\_separator = vm.bookingpress\_currency\_separator; |
| [5969](#L5969) | let decimal\_points = vm.bookingpress\_decimal\_points; |
| [5970](#L5970) |  |
| [5971](#L5971) | if( "comma-dot" == currency\_separator ){ |
| [5972](#L5972) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ".", ",", ignore\_symbol ); |
| [5973](#L5973) | } else if( "dot-comma" == currency\_separator ){ |
| [5974](#L5974) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ",", ".", ignore\_symbol ); |
| [5975](#L5975) | } else if( "space-dot" == currency\_separator ){ |
| [5976](#L5976) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ".", " ", ignore\_symbol ); |
| [5977](#L5977) | } else if( "space-comma" == currency\_separator ){ |
| [5978](#L5978) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, ",", " ", ignore\_symbol ); |
| [5979](#L5979) | } else if( "Custom" == currency\_separator){ |
| [5980](#L5980) | let custom\_comma\_separator = vm.bookingpress\_custom\_comma\_separator; |
| [5981](#L5981) | let custom\_thousand\_separator = vm.bookingpress\_custom\_thousand\_separator; |
| [5982](#L5982) | price\_amount = vm.bookingpress\_number\_format( price\_amount, decimal\_points, custom\_comma\_separator, custom\_thousand\_separator ); |
| [5983](#L5983) | } |
| [5984](#L5984) |  |
| [5985](#L5985) | if( true == ignore\_symbol ){ |
| [5986](#L5986) | return price\_amount; |
| [5987](#L5987) | } |
| [5988](#L5988) |  |
| [5989](#L5989) | let currency\_symbol = vm.bookingpress\_currency\_symbol; |
| [5990](#L5990) | let currency\_symbol\_pos = vm.bookingpress\_currency\_symbol\_position; |
| [5991](#L5991) |  |
| [5992](#L5992) | if( "before" == currency\_symbol\_pos ){ |
| [5993](#L5993) | price\_amount = currency\_symbol + price\_amount; |
| [5994](#L5994) | } else if( "before\_with\_space" == currency\_symbol\_pos ){ |
| [5995](#L5995) | price\_amount = currency\_symbol + " " + price\_amount; |
| [5996](#L5996) | } else if( "after" == currency\_symbol\_pos ){ |
| [5997](#L5997) | price\_amount = price\_amount + currency\_symbol; |
| [5998](#L5998) | } else if( "after\_with\_space" == currency\_symbol\_pos ){ |
| [5999](#L5999) | price\_amount = price\_amount + " " + currency\_symbol; |
| [6000](#L6000) | } |
| [6001](#L6001) |  |
| [6002](#L6002) | return price\_amount; |
| [6003](#L6003) |  |
| [6004](#L6004) | }, |
| [6005](#L6005) | bookingpress\_number\_format( number, decimals, decPoint, thousandsSep, skip\_separator = false ){ |
| [6006](#L6006) | number = (number + "").replace(/[^0-9+\-Ee.]/g, ""); |
| [6007](#L6007) | const n = !isFinite(+number) ? 0 : +number; |
| [6008](#L6008) | const prec = !isFinite(+decimals) ? 0 : Math.abs(decimals); |
| [6009](#L6009) | const sep = (typeof thousandsSep === "undefined") ? "," : thousandsSep; |
| [6010](#L6010) | const dec = (typeof decPoint === "undefined" || true == skip\_separator ) ? "." : decPoint; |
| [6011](#L6011) | let s = ""; |
| [6012](#L6012) | const toFixedFix = function (n, prec) { |
| [6013](#L6013) | if (("" + n).indexOf("e") === -1) { |
| [6014](#L6014) | return +(Math.round(n + "e+" + prec) + "e-" + prec); |
| [6015](#L6015) | } else { |
| [6016](#L6016) | const arr = ("" + n).split("e"); |
| [6017](#L6017) | let sig = ""; |
| [6018](#L6018) | if (+arr[1] + prec > 0) { |
| [6019](#L6019) | sig = "+"; |
| [6020](#L6020) | } |
| [6021](#L6021) | return (+(Math.round(+arr[0] + "e" + sig + (+arr[1] + prec)) + "e-" + prec)).toFixed(prec); |
| [6022](#L6022) | } |
| [6023](#L6023) | }; |
| [6024](#L6024) | /\* @todo: for IE parseFloat(0.55).toFixed(0) = 0; \*/ |
| [6025](#L6025) | s = (prec ? toFixedFix(n, prec).toString() : "" + Math.round(n)).split("."); |
| [6026](#L6026) | if( false == skip\_separator ){ |
| [6027](#L6027) | if (s[0].length > 3) { |
| [6028](#L6028) | s[0] = s[0].replace(/\B(?=(?:\d{3})+(?!\d))/g, sep); |
| [6029](#L6029) | } |
| [6030](#L6030) | } |
| [6031](#L6031) | if ((s[1] || "").length < prec) { |
| [6032](#L6032) | s[1] = s[1] || ""; |
| [6033](#L6033) | s[1] += new Array(prec - s[1].length + 1).join("0"); |
| [6034](#L6034) | } |
| [6035](#L6035) | if( true == skip\_separator ){ |
| [6036](#L6036) | return parseFloat( s.join(dec) ); |
| [6037](#L6037) | } else { |
| [6038](#L6038) | return s.join(dec); |
| [6039](#L6039) | } |
| [6040](#L6040) | }, |
| [6041](#L6041) | ' . $bookingpress\_vue\_methods\_data . ' |
| [6042](#L6042) | }, |
| [6043](#L6043) | });'; |
| [6044](#L6044) |  |
| [6045](#L6045) | $bpa\_script\_data = " var app; |
| [6046](#L6046) | var is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el = false; |
| [6047](#L6047) | bookingpress\_beforeload\_data = ''; |
| [6048](#L6048) | if( null != document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash') ){ |
| [6049](#L6049) | bookingpress\_beforeload\_data = document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash').innerHTML; |
| [6050](#L6050) | } |
| [6051](#L6051) | window.addEventListener('DOMContentLoaded', function() { |
| [6052](#L6052) | if( is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el == false) { |
| [6053](#L6053) | is\_script\_loaded\_$bookingpress\_vue\_root\_element\_id\_el = true; |
| [6054](#L6054) | bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(); |
| [6055](#L6055) | } |
| [6056](#L6056) | }); |
| [6057](#L6057) |  |
| [6058](#L6058) | window.addEventListener( 'elementor/popup/show', (event) => { |
| [6059](#L6059) | let element = event.detail.instance.\$element[0].querySelector('.bpa-frontend-main-container'); |
| [6060](#L6060) | if( 'undefined' != typeof element ){ |
| [6061](#L6061) | document.getElementById('$bookingpress\_vue\_root\_element\_id\_without\_hash').innerHTML = bookingpress\_beforeload\_data; |
| [6062](#L6062) | bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(); |
| [6063](#L6063) | } |
| [6064](#L6064) | }); |
| [6065](#L6065) |  |
| [6066](#L6066) | function bpa\_load\_vue\_shortcode\_$bookingpress\_vue\_root\_element\_id\_el(){ |
| [6067](#L6067) | {$bookingpress\_script\_return\_data} |
| [6068](#L6068) | }"; |
| [6069](#L6069) |  |
| [6070](#L6070) | if( $bookingress\_load\_js\_css\_all\_pages == 'true' ){ |
| [6071](#L6071) | wp\_enqueue\_script('bookingpress\_elements\_locale'); |
| [6072](#L6072) | $bpa\_script\_data .= 'if( false == is\_script\_loaded\_'.$bookingpress\_vue\_root\_element\_id\_el.' ) {  is\_script\_loaded\_'.$bookingpress\_vue\_root\_element\_id\_el.' = true; bpa\_load\_vue\_shortcode\_'.$bookingpress\_vue\_root\_element\_id\_el.'(); }'; |
| [6073](#L6073) | } |
| [6074](#L6074) |  |
| [6075](#L6075) | wp\_add\_inline\_script('bookingpress\_elements\_locale', $bpa\_script\_data, 'after'); |
| [6076](#L6076) |  |
| [6077](#L6077) | if($bookingress\_load\_js\_css\_all\_pages != 'true' ) { |
| [6078](#L6078) |  |
| [6079](#L6079) | $bookingpress\_custom\_css = $BookingPress->bookingpress\_get\_customize\_settings('custom\_css', 'booking\_form'); |
| [6080](#L6080) | $bookingpress\_custom\_css = !empty($bookingpress\_custom\_css) ? stripslashes\_deep( $bookingpress\_custom\_css ) : ''; |
| [6081](#L6081) | wp\_add\_inline\_style( 'bookingpress\_front\_custom\_css', $bookingpress\_custom\_css, 'after' ); |
| [6082](#L6082) | } |
| [6083](#L6083) |  |
| [6084](#L6084) |  |
| [6085](#L6085) | $this->bookingpress\_form\_category = 0; |
| [6086](#L6086) | $this->bookingpress\_form\_service = 0 ; |
| [6087](#L6087) | $this->bookingpress\_hide\_category\_service= 0; |
| [6088](#L6088) | $this->bookingpress\_is\_service\_load\_from\_url = 0; |
| [6089](#L6089) | $this->bookingpress\_form\_fields\_error\_msg\_arr = array(); |
| [6090](#L6090) | $this->bookingpress\_form\_fields\_new = array(); |
| [6091](#L6091) |  |
| [6092](#L6092) | return do\_shortcode( $content ); |
| [6093](#L6093) | } |
| [6094](#L6094) |  |
| [6095](#L6095) | /\*\* |
| [6096](#L6096) | \* Hook for add data variables for Booking Form shortcode |
| [6097](#L6097) | \* |
| [6098](#L6098) | \* @param  mixed $bookingpress\_dynamic\_data\_fields      Global data variable for Booking Form |
| [6099](#L6099) | \* @param  mixed $bookingpress\_category                 Shortcode allowed category |
| [6100](#L6100) | \* @param  mixed $bookingpress\_service                  Shortcode allowed service |
| [6101](#L6101) | \* @param  mixed $selected\_service                      Shortcode default selected service |
| [6102](#L6102) | \* @param  mixed $selected\_category                     Shortcode default selected category |
| [6103](#L6103) | \* @return void |
| [6104](#L6104) | \*/ |
| [6105](#L6105) | function bookingpress\_booking\_dynamic\_data\_fields\_func( $bookingpress\_dynamic\_data\_fields, $bookingpress\_category, $bookingpress\_service, $selected\_service,$selected\_category ) |
| [6106](#L6106) | { |
| [6107](#L6107) | global $wpdb, $BookingPress, $bookingpress\_front\_vue\_data\_fields, $tbl\_bookingpress\_customers, $tbl\_bookingpress\_categories, $tbl\_bookingpress\_services, $tbl\_bookingpress\_servicesmeta, $tbl\_bookingpress\_form\_fields, $bookingpress\_global\_options; |
| [6108](#L6108) | // Get categories |
| [6109](#L6109) |  |
| [6110](#L6110) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['is\_waiting\_list'] = 0; |
| [6111](#L6111) | $bookingpress\_search\_query\_where = 'WHERE 1=1 '; |
| [6112](#L6112) | $bookingpress\_search\_query\_join  = ''; |
| [6113](#L6113) | if (! empty($bookingpress\_category) ) { |
| [6114](#L6114) | $bookingpress\_search\_query\_where .= " AND category.bookingpress\_category\_id IN ({$bookingpress\_category})"; |
| [6115](#L6115) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['total\_category'] = $bookingpress\_category; |
| [6116](#L6116) | } |
| [6117](#L6117) | $bookingpress\_search\_query\_join  .= "LEFT JOIN {$tbl\_bookingpress\_services} AS service ON category.bookingpress\_category\_id = service.bookingpress\_category\_id"; |
| [6118](#L6118) | $bookingpress\_search\_query\_where .= ' AND category.bookingpress\_category\_id = service.bookingpress\_category\_id'; |
| [6119](#L6119) | if (! empty($bookingpress\_service) ) { |
| [6120](#L6120) | $bookingpress\_search\_query\_where .= " AND service.bookingpress\_service\_id IN ({$bookingpress\_service})"; |
| [6121](#L6121) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['total\_services'] = $bookingpress\_service; |
| [6122](#L6122) | } |
| [6123](#L6123) |  |
| [6124](#L6124) |  |
| [6125](#L6125) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['check\_username\_validation'] = false; |
| [6126](#L6126) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['invalid\_customer\_username'] = false; |
| [6127](#L6127) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['invalid\_customer\_message'] = 'Invalid Username'; |
| [6128](#L6128) |  |
| [6129](#L6129) | $bookingpress\_search\_query\_where .= ' GROUP BY bookingpress\_category\_id'; |
| [6130](#L6130) | $bookingpress\_service\_categories  = $wpdb->get\_results("SELECT category.\* FROM {$tbl\_bookingpress\_categories} AS category {$bookingpress\_search\_query\_join} {$bookingpress\_search\_query\_where} ORDER BY bookingpress\_category\_position ASC", ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_categories is a table name. false alarm |
| [6131](#L6131) |  |
| [6132](#L6132) | foreach (  $bookingpress\_service\_categories as $key => $val ) { |
| [6133](#L6133) | $bookingpress\_service\_categories[$key]['bookingpress\_category\_name'] = stripslashes\_deep($val['bookingpress\_category\_name']); |
| [6134](#L6134) | $bookingpress\_service\_categories[$key]['is\_visible'] = true; |
| [6135](#L6135) | } |
| [6136](#L6136) | $bookingpress\_front\_vue\_data\_fields['service\_categories'] = $bookingpress\_service\_categories; |
| [6137](#L6137) | $default\_service\_category = ! empty($bookingpress\_service\_categories[0]['bookingpress\_category\_id']) ? $bookingpress\_service\_categories[0]['bookingpress\_category\_id'] : 0; |
| [6138](#L6138) | $default\_service\_category  = empty($selected\_category) ? $default\_service\_category : $selected\_category; |
| [6139](#L6139) |  |
| [6140](#L6140) |  |
| [6141](#L6141) |  |
| [6142](#L6142) | //$bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $default\_service\_category; |
| [6143](#L6143) |  |
| [6144](#L6144) | $all\_categories = $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_categories']; |
| [6145](#L6145) |  |
| [6146](#L6146) |  |
| [6147](#L6147) |  |
| [6148](#L6148) | if( !empty($all\_categories) && count( $all\_categories ) == 1 ){ |
| [6149](#L6149) | $first\_category\_data = $all\_categories[ array\_key\_first( $all\_categories ) ]; |
| [6150](#L6150) | if( 0 === $first\_category\_data['category\_id'] ){ |
| [6151](#L6151) |  |
| [6152](#L6152) | } |
| [6153](#L6153) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $all\_categories[ array\_key\_first( $all\_categories ) ]['category\_id']; |
| [6154](#L6154) |  |
| [6155](#L6155) | } else if( count( $all\_categories ) > 1 ){ |
| [6156](#L6156) | $default\_category = ''; |
| [6157](#L6157) | $n = 0; |
| [6158](#L6158) | foreach( $all\_categories as $all\_cat\_data ){ |
| [6159](#L6159) | if( $n == 0 && $all\_cat\_data['category\_id'] == 0 ){ |
| [6160](#L6160) | $n++; |
| [6161](#L6161) | continue; |
| [6162](#L6162) | } |
| [6163](#L6163) | if( $n < 2 && empty( $default\_category )){ |
| [6164](#L6164) | $default\_category = $all\_cat\_data['category\_id']; |
| [6165](#L6165) | break; |
| [6166](#L6166) | } |
| [6167](#L6167) | $n++; |
| [6168](#L6168) | } |
| [6169](#L6169) |  |
| [6170](#L6170) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $default\_category; |
| [6171](#L6171) | } |
| [6172](#L6172) |  |
| [6173](#L6173) | $bookingpress\_service\_search\_query\_where = ''; |
| [6174](#L6174) | $bookingpress\_service\_cache\_param = $default\_service\_category; |
| [6175](#L6175) |  |
| [6176](#L6176) | if (! empty($bookingpress\_service) ) { |
| [6177](#L6177) | $bookingpress\_service\_search\_query\_where .= " AND bookingpress\_service\_id IN ({$bookingpress\_service})"; |
| [6178](#L6178) | $bookingpress\_service\_cache\_param .= '\_' . $bookingpress\_service; |
| [6179](#L6179) | } |
| [6180](#L6180) |  |
| [6181](#L6181) | //$service\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE bookingpress\_category\_id = {$default\_service\_category} {$bookingpress\_service\_search\_query\_where} ORDER BY bookingpress\_service\_position", ARRAY\_A); |
| [6182](#L6182) | $all\_service\_data = $wpdb->get\_results("SELECT \* FROM {$tbl\_bookingpress\_services} WHERE 1=1 {$bookingpress\_service\_search\_query\_where} ORDER BY bookingpress\_service\_position", ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_services is a table name. false alarm |
| [6183](#L6183) | $service\_data = array(); |
| [6184](#L6184) | $temp\_service\_data = array(); |
| [6185](#L6185) | $bpa\_services\_categories\_data = array(); |
| [6186](#L6186) | $all\_services\_data = array(); |
| [6187](#L6187) | $bookingpress\_display\_service\_description = $BookingPress->bookingpress\_get\_customize\_settings('display\_service\_description', 'booking\_form'); |
| [6188](#L6188) |  |
| [6189](#L6189) | $all\_service\_data = apply\_filters( 'bookingpress\_remove\_disabled\_services', $all\_service\_data ); |
| [6190](#L6190) |  |
| [6191](#L6191) | $min\_text = $BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_min\_text', 'booking\_form'); |
| [6192](#L6192) | $hour\_text = $BookingPress->bookingpress\_get\_customize\_settings('book\_appointment\_hours\_text', 'booking\_form'); |
| [6193](#L6193) |  |
| [6194](#L6194) | $bookingpress\_duration\_suffix\_labels = array( |
| [6195](#L6195) | 'm' => !empty( $min\_text ) ? stripslashes\_deep($min\_text) : esc\_html\_\_('m', 'bookingpress-appointment-booking'), |
| [6196](#L6196) | 'h' => !empty( $hour\_text ) ? stripslashes\_deep($hour\_text) : esc\_html\_\_('h', 'bookingpress-appointment-booking'), |
| [6197](#L6197) | ); |
| [6198](#L6198) |  |
| [6199](#L6199) | $bookingpress\_duration\_suffix\_labels = apply\_filters( 'bookingpress\_modify\_service\_duration\_label', $bookingpress\_duration\_suffix\_labels ); |
| [6200](#L6200) |  |
| [6201](#L6201) |  |
| [6202](#L6202) | $bookingpress\_related\_category\_service = array(); |
| [6203](#L6203) | $bookingpress\_all\_service\_data = (isset($bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data']))?$bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data']:array(); |
| [6204](#L6204) | foreach ( $all\_service\_data as $service\_key => $service\_val ) { |
| [6205](#L6205) | $temp\_service\_data[ $service\_key ] = $all\_service\_data[ $service\_key ]; |
| [6206](#L6206) |  |
| [6207](#L6207) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_duration\_label'] = !empty( $bookingpress\_duration\_suffix\_labels[ $service\_val['bookingpress\_service\_duration\_unit'] ] ) ? $bookingpress\_duration\_suffix\_labels[ $service\_val['bookingpress\_service\_duration\_unit'] ] : $service\_val['bookingpress\_service\_duration\_unit']; |
| [6208](#L6208) | $temp\_service\_data[ $service\_key ]['service\_position'] = $service\_val['bookingpress\_service\_position']; |
| [6209](#L6209) | $temp\_service\_data[ $service\_key ]['service\_price\_without\_currency'] = $service\_val['bookingpress\_service\_price']; |
| [6210](#L6210) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_price']     = $BookingPress->bookingpress\_price\_formatter\_with\_currency\_symbol($service\_val['bookingpress\_service\_price']); |
| [6211](#L6211) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_name'] = stripslashes($service\_val['bookingpress\_service\_name']); |
| [6212](#L6212) |  |
| [6213](#L6213) | $service\_id                              = $service\_val['bookingpress\_service\_id']; |
| [6214](#L6214) | $service\_img\_details                     = ''; |
| [6215](#L6215) | if($service\_id && !empty($bookingpress\_all\_service\_data) && isset($bookingpress\_all\_service\_data[$service\_id]['services\_meta'])){ |
| [6216](#L6216) | $service\_img\_details  = (isset($bookingpress\_all\_service\_data[$service\_id]['services\_meta']['service\_image\_details']))?$bookingpress\_all\_service\_data[$service\_id]['services\_meta']['service\_image\_details']:array(); |
| [6217](#L6217) | $service\_img\_details = (!empty($service\_img\_details))?$service\_img\_details:array(); |
| [6218](#L6218) | }else{ |
| [6219](#L6219) | $service\_meta\_details                    = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_servicesmeta} WHERE bookingpress\_service\_id = %d AND bookingpress\_servicemeta\_name = 'service\_image\_details'", $service\_id), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_servicesmeta is table name defined globally. False Positive alarm |
| [6220](#L6220) | $service\_img\_details                     = ! empty($service\_meta\_details['bookingpress\_servicemeta\_value']) ? maybe\_unserialize($service\_meta\_details['bookingpress\_servicemeta\_value']) : array(); |
| [6221](#L6221) | } |
| [6222](#L6222) |  |
| [6223](#L6223) | $bpa\_user\_placeholder = !empty( $service\_img\_details[0]['url'] ) ? false : true; |
| [6224](#L6224) | $temp\_service\_data[ $service\_key ]['img\_url'] = ! empty($service\_img\_details[0]['url']) ? $service\_img\_details[0]['url'] : BOOKINGPRESS\_URL . '/images/placeholder-img.jpg'; |
| [6225](#L6225) | $temp\_service\_data[ $service\_key ]['use\_placeholder'] = $bpa\_user\_placeholder; |
| [6226](#L6226) | $temp\_service\_data[ $service\_key ]['is\_visible'] = true; |
| [6227](#L6227) | $temp\_service\_data[ $service\_key ]['is\_disabled'] = false; |
| [6228](#L6228) |  |
| [6229](#L6229) | $default\_service\_description = ! empty($service\_val['bookingpress\_service\_description']) ? $service\_val['bookingpress\_service\_description'] : ''; |
| [6230](#L6230) |  |
| [6231](#L6231) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [6232](#L6232) | $temp\_service\_data[ $service\_key ]['display\_read\_more\_less']           = 1; |
| [6233](#L6233) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_description'] = stripslashes\_deep($default\_service\_description); |
| [6234](#L6234) | if (strlen($default\_service\_description) > 140 ) { |
| [6235](#L6235) | $temp\_service\_data[ $service\_key ]['bookingpress\_service\_description\_with\_excerpt'] = stripslashes(substr($default\_service\_description, 0, 140)); |
| [6236](#L6236) | $temp\_service\_data[ $service\_key ]['display\_details\_more']                          = 0; |
| [6237](#L6237) | $temp\_service\_data[ $service\_key ]['display\_details\_less']                          = 1; |
| [6238](#L6238) | } else { |
| [6239](#L6239) | $temp\_service\_data[ $service\_key ]['display\_read\_more\_less'] = 0; |
| [6240](#L6240) | } |
| [6241](#L6241) | } |
| [6242](#L6242) | if($service\_val['bookingpress\_category\_id'] || $service\_val['bookingpress\_category\_id'] == 0){ |
| [6243](#L6243) | $bookingpress\_related\_category\_service[$service\_val['bookingpress\_category\_id']][] = $service\_val['bookingpress\_service\_id']; |
| [6244](#L6244) | } |
| [6245](#L6245) |  |
| [6246](#L6246) | if( $service\_val['bookingpress\_category\_id'] == $default\_service\_category ){ |
| [6247](#L6247) | $service\_data[ $service\_key ] = $temp\_service\_data[ $service\_key ]; |
| [6248](#L6248) | } |
| [6249](#L6249) | if( empty( $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ] ) ){ |
| [6250](#L6250) | $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ] = array(); |
| [6251](#L6251) | } |
| [6252](#L6252) | $all\_services\_data[ $service\_key ] = $temp\_service\_data[ $service\_key ]; |
| [6253](#L6253) | $bpa\_services\_categories\_data[ $service\_val['bookingpress\_category\_id'] ][] = $temp\_service\_data[ $service\_key ]; |
| [6254](#L6254) | } |
| [6255](#L6255) |  |
| [6256](#L6256) | if ($bookingpress\_display\_service\_description == 'false' ) { |
| [6257](#L6257) | $bookingpress\_front\_vue\_data\_fields['display\_service\_description'] = '1'; |
| [6258](#L6258) | } |
| [6259](#L6259) |  |
| [6260](#L6260) | $bookingpress\_front\_vue\_data\_fields['services\_data'] = $service\_data; |
| [6261](#L6261) |  |
| [6262](#L6262) | $bookingpress\_front\_vue\_data\_fields['bpa\_services\_data\_from\_categories'] = $bpa\_services\_categories\_data; |
| [6263](#L6263) | $bookingpress\_front\_vue\_data\_fields['all\_services\_data'] = $all\_services\_data; |
| [6264](#L6264) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['related\_category\_service'] = $bookingpress\_related\_category\_service; |
| [6265](#L6265) |  |
| [6266](#L6266) | $bookingpress\_is\_uncategorized\_service\_added = 0; |
| [6267](#L6267) | foreach($all\_services\_data as $ser\_key => $ser\_val){ |
| [6268](#L6268) | if(empty($ser\_val['bookingpress\_category\_id']) && empty($bookingpress\_service) && empty($bookingpress\_category)){ |
| [6269](#L6269) | $bookingpress\_is\_uncategorized\_service\_added = 1; |
| [6270](#L6270) | break; |
| [6271](#L6271) | }else if(empty($ser\_val['bookingpress\_category\_id']) && !empty($bookingpress\_service) && empty($bookingpress\_category)){ |
| [6272](#L6272) | $bookingpress\_is\_uncategorized\_service\_added = 1; |
| [6273](#L6273) | break; |
| [6274](#L6274) | } |
| [6275](#L6275) | } |
| [6276](#L6276) | $bookingpress\_front\_vue\_data\_fields['is\_uncategorize\_service\_added'] = $bookingpress\_is\_uncategorized\_service\_added; |
| [6277](#L6277) | $default\_service\_id = 0; |
| [6278](#L6278) |  |
| [6279](#L6279) | $default\_service\_name = $default\_price = $default\_service\_duration = $default\_service\_duration\_unit = $default\_price\_with\_currency = ""; |
| [6280](#L6280) | $service\_data= array\_values($service\_data); |
| [6281](#L6281) | if(!empty($service\_data)) { |
| [6282](#L6282) | foreach($service\_data as $key => $val) { |
| [6283](#L6283) | if((!empty($selected\_service) ) ) { |
| [6284](#L6284) | if($selected\_service == $val['bookingpress\_service\_id']) { |
| [6285](#L6285) | $default\_service\_id                                  = ! empty($val['bookingpress\_service\_id']) ? $val['bookingpress\_service\_id'] : 0; |
| [6286](#L6286) | $default\_service\_name                                = ! empty($val['bookingpress\_service\_name']) ? stripslashes\_deep($val['bookingpress\_service\_name']) : ''; |
| [6287](#L6287) | $default\_price                                       = ! empty($val['bookingpress\_service\_price']) ? $val['bookingpress\_service\_price'] : 0; |
| [6288](#L6288) | $default\_price\_with\_currency                         = ! empty($val['service\_price\_without\_currency']) ? $val['service\_price\_without\_currency'] : 0; |
| [6289](#L6289) | $default\_service\_duration\_unit                         = ! empty($val['bookingpress\_service\_duration\_unit']) ? $val |
| [6290](#L6290) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6291](#L6291) | $default\_service\_duration                         = ! empty($val['bookingpress\_service\_duration\_val']) ? $val |
| [6292](#L6292) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6293](#L6293) |  |
| [6294](#L6294) | } |
| [6295](#L6295) | } else { |
| [6296](#L6296) | $default\_service\_id   = ! empty($service\_data[0]['bookingpress\_service\_id']) ? $service\_data[0]['bookingpress\_service\_id'] : $all\_services\_data[0]['bookingpress\_service\_id']; |
| [6297](#L6297) | $default\_service\_name  = ! empty($service\_data[0]['bookingpress\_service\_name']) ? stripslashes($service\_data[0]['bookingpress\_service\_name']) : ''; |
| [6298](#L6298) | $default\_price   = ! empty($service\_data[0]['bookingpress\_service\_price']) ? $service\_data[0]['bookingpress\_service\_price'] : 0; |
| [6299](#L6299) | $default\_price\_with\_currency  = ! empty($service\_data[0]['service\_price\_without\_currency']) ? $service\_data[0]['service\_price\_without\_currency'] : 0; |
| [6300](#L6300) | $default\_service\_duration\_unit= ! empty($service\_data[0]['bookingpress\_service\_duration\_unit']) ? $service\_data[0] |
| [6301](#L6301) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6302](#L6302) | $default\_service\_duration                         = ! empty($service\_data[0]['bookingpress\_service\_duration\_val']) ? $service\_data[0] |
| [6303](#L6303) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6304](#L6304) | } |
| [6305](#L6305) | } |
| [6306](#L6306) | } |
| [6307](#L6307) |  |
| [6308](#L6308) | if(empty($default\_service\_id) && !empty($selected\_service)){ |
| [6309](#L6309) | //If default no service selected and selected service parameter pass from booking form shortcode then this condition will executed |
| [6310](#L6310) | foreach($all\_services\_data as $key => $val) { |
| [6311](#L6311) | if((!empty($selected\_service) ) ) { |
| [6312](#L6312) | if($selected\_service == $val['bookingpress\_service\_id']) { |
| [6313](#L6313) | $default\_service\_id                                  = ! empty($val['bookingpress\_service\_id']) ? $val['bookingpress\_service\_id'] : 0; |
| [6314](#L6314) | $default\_service\_name                                = ! empty($val['bookingpress\_service\_name']) ? stripslashes\_deep($val['bookingpress\_service\_name']) : ''; |
| [6315](#L6315) | $default\_price                                       = ! empty($val['bookingpress\_service\_price']) ? $val['bookingpress\_service\_price'] : 0; |
| [6316](#L6316) | $default\_price\_with\_currency                         = ! empty($val['service\_price\_without\_currency']) ? $val['service\_price\_without\_currency'] : 0; |
| [6317](#L6317) | $default\_service\_duration\_unit                         = ! empty($val['bookingpress\_service\_duration\_unit']) ? $val |
| [6318](#L6318) | ['bookingpress\_service\_duration\_unit'] : ''; |
| [6319](#L6319) | $default\_service\_duration                         = ! empty($val['bookingpress\_service\_duration\_val']) ? $val |
| [6320](#L6320) | ['bookingpress\_service\_duration\_val'] : ''; |
| [6321](#L6321) | } |
| [6322](#L6322) | } |
| [6323](#L6323) | } |
| [6324](#L6324) | } |
| [6325](#L6325) |  |
| [6326](#L6326) | $bookingpress\_is\_hide\_category\_service\_selection = $BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection', 'booking\_form'); |
| [6327](#L6327) |  |
| [6328](#L6328) | $bpa\_move\_from\_service\_selection\_step = false; |
| [6329](#L6329) |  |
| [6330](#L6330) | if( empty( $default\_service\_id ) ){ |
| [6331](#L6331) | $default\_service\_id = apply\_filters( 'bookingpress\_modify\_default\_servide\_id', $default\_service\_id, $bookingpress\_front\_vue\_data\_fields ); |
| [6332](#L6332) | } |
| [6333](#L6333) |  |
| [6334](#L6334) | if ( $bookingpress\_is\_hide\_category\_service\_selection == 'true' || ! empty( $selected\_service ) || ( !empty($bookingpress\_service) && (count($all\_services\_data) == 1) && empty($bookingpress\_category) ) ) { |
| [6335](#L6335) | // If hide category service step option enabled then by default service selected |
| [6336](#L6336) | // If only 1 service display from shortcode parameter then by default that 1 service also selected automatically |
| [6337](#L6337) | // If there is any service selected from parameter then also service automatically selected |
| [6338](#L6338) |  |
| [6339](#L6339) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service']               = $default\_service\_id; |
| [6340](#L6340) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_name']          = $default\_service\_name; |
| [6341](#L6341) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_price']         = $default\_price; |
| [6342](#L6342) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['service\_price\_without\_currency'] = $default\_price\_with\_currency; |
| [6343](#L6343) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_duration\_unit'] = $default\_service\_duration\_unit; |
| [6344](#L6344) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service\_duration'] = $default\_service\_duration; |
| [6345](#L6345) |  |
| [6346](#L6346) | $bookingpress\_front\_vue\_data\_fields['displayResponsiveCalendar'] = "1"; |
| [6347](#L6347) | } |
| [6348](#L6348) |  |
| [6349](#L6349) | if( 'true' == $bookingpress\_is\_hide\_category\_service\_selection ){ |
| [6350](#L6350) | $bpa\_move\_from\_service\_selection\_step = true; |
| [6351](#L6351) | } else if( !empty( $default\_service\_id ) && 1 == $this->bookingpress\_is\_service\_load\_from\_url ){ |
| [6352](#L6352) | $bpa\_move\_from\_service\_selection\_step = true; |
| [6353](#L6353) | } |
| [6354](#L6354) |  |
| [6355](#L6355) | $bpa\_move\_from\_service\_selection\_step = apply\_filters( 'bookingpress\_check\_flag\_to\_move\_next\_from\_serfice', $bpa\_move\_from\_service\_selection\_step, $bookingpress\_front\_vue\_data\_fields ); |
| [6356](#L6356) |  |
| [6357](#L6357) | $on\_site\_payment = $BookingPress->bookingpress\_get\_settings('on\_site\_payment', 'payment\_setting'); |
| [6358](#L6358) | $paypal\_payment  = $BookingPress->bookingpress\_get\_settings('paypal\_payment', 'payment\_setting'); |
| [6359](#L6359) |  |
| [6360](#L6360) | $bookingpress\_front\_vue\_data\_fields['on\_site\_payment'] = $on\_site\_payment; |
| [6361](#L6361) | $bookingpress\_front\_vue\_data\_fields['paypal\_payment']  = $paypal\_payment; |
| [6362](#L6362) |  |
| [6363](#L6363) | $bookingpress\_total\_configure\_gateways = 0; |
| [6364](#L6364) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6365](#L6365) | if (( $on\_site\_payment == 'true' || $on\_site\_payment == '1' ) && ( $paypal\_payment == 'true' || $paypal\_payment == '1' ) ) { |
| [6366](#L6366) | $bookingpress\_total\_configure\_gateways = 2; |
| [6367](#L6367) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6368](#L6368) | } elseif (( $on\_site\_payment == 'true' || $on\_site\_payment == '1' ) && ( $paypal\_payment == 'false' || empty($paypal\_payment) ) ) { |
| [6369](#L6369) | $bookingpress\_total\_configure\_gateways = 1; |
| [6370](#L6370) | $bookingpress\_is\_only\_onsite\_enabled   = 1; |
| [6371](#L6371) | } elseif (( $on\_site\_payment == 'false' || empty($on\_site\_payment) ) && ( $paypal\_payment == 'true' || $paypal\_payment == '1' ) ) { |
| [6372](#L6372) | $bookingpress\_total\_configure\_gateways = 1; |
| [6373](#L6373) | $bookingpress\_is\_only\_onsite\_enabled   = 0; |
| [6374](#L6374) | } |
| [6375](#L6375) |  |
| [6376](#L6376) | $bookingpress\_front\_vue\_data\_fields['total\_configure\_gateways'] = $bookingpress\_total\_configure\_gateways; |
| [6377](#L6377) | $bookingpress\_front\_vue\_data\_fields['is\_only\_onsite\_enabled']   = $bookingpress\_is\_only\_onsite\_enabled; |
| [6378](#L6378) |  |
| [6379](#L6379) |  |
| [6380](#L6380) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_payment\_method'] = ''; |
| [6381](#L6381) |  |
| [6382](#L6382) | if ($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_payment\_method'] == '' && ( $paypal\_payment == 'true' ) ) { |
| [6383](#L6383) | $bookingpress\_front\_vue\_data\_fields['paypal\_payment'] = 'paypal'; |
| [6384](#L6384) | } |
| [6385](#L6385) |  |
| [6386](#L6386) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 0; |
| [6387](#L6387) | $bookingpress\_front\_vue\_data\_fields['bpa\_check\_user\_login'] = 0; |
| [6388](#L6388) |  |
| [6389](#L6389) | if (is\_user\_logged\_in() ) { |
| [6390](#L6390) | $current\_user\_id               = get\_current\_user\_id(); |
| [6391](#L6391) | $bookingpress\_current\_user\_obj = new WP\_User($current\_user\_id); |
| [6392](#L6392) | $bookingpress\_front\_vue\_data\_fields['bpa\_check\_user\_login'] = 1; |
| [6393](#L6393) |  |
| [6394](#L6394) | $get\_current\_user\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_customers} WHERE bookingpress\_wpuser\_id = %d AND bookingpress\_user\_type = 2", $current\_user\_id ), ARRAY\_A); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared -- Reason: $tbl\_bookingpress\_customers is table name defined globally. False Positive alarm |
| [6395](#L6395) | if (! empty($get\_current\_user\_data) ) { |
| [6396](#L6396) | $bookingpress\_firstname = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_firstname']); |
| [6397](#L6397) | $bookingpress\_lastname = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_lastname']); |
| [6398](#L6398) | $bookingpress\_customername = !empty($get\_current\_user\_data['bookingpress\_user\_name']) ? stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_name']) : ''; |
| [6399](#L6399) | $bookingpress\_customername\_full\_name = !empty($get\_current\_user\_data['bookingpress\_customer\_full\_name']) ? stripslashes\_deep($get\_current\_user\_data['bookingpress\_customer\_full\_name']) : ''; |
| [6400](#L6400) |  |
| [6401](#L6401) | /\* if( empty($bookingpress\_customername\_full\_name)){ |
| [6402](#L6402) | $bookingpress\_customername\_full\_name = $bookingpress\_customername; |
| [6403](#L6403) | } \*/ |
| [6404](#L6404) |  |
| [6405](#L6405) | if( !empty($bookingpress\_customername)){ |
| [6406](#L6406) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 1; |
| [6407](#L6407) | } |
| [6408](#L6408) |  |
| [6409](#L6409) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'])) { |
| [6410](#L6410) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'] = stripslashes\_deep($bookingpress\_customername\_full\_name); |
| [6411](#L6411) | } |
| [6412](#L6412) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'])) { |
| [6413](#L6413) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'] = stripslashes\_deep($bookingpress\_customername); |
| [6414](#L6414) | } |
| [6415](#L6415) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone'])) { |
| [6416](#L6416) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone'] = $get\_current\_user\_data['bookingpress\_user\_phone']; |
| [6417](#L6417) | } |
| [6418](#L6418) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'])) { |
| [6419](#L6419) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'] = stripslashes\_deep($get\_current\_user\_data['bookingpress\_user\_email']); |
| [6420](#L6420) | } |
| [6421](#L6421) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'])) { |
| [6422](#L6422) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'] = stripslashes\_deep($bookingpress\_firstname); |
| [6423](#L6423) | } |
| [6424](#L6424) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname'])) { |
| [6425](#L6425) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname']  = stripslashes\_deep($bookingpress\_lastname); |
| [6426](#L6426) | } |
| [6427](#L6427) | } elseif (! empty($current\_user\_id) && ! empty($bookingpress\_current\_user\_obj) ) { |
| [6428](#L6428) | $bookingpress\_customer\_name  = ! empty($bookingpress\_current\_user\_obj->data->user\_login) ? $bookingpress\_current\_user\_obj->data->user\_login : ''; |
| [6429](#L6429) | $bookingpress\_customer\_email = ! empty($bookingpress\_current\_user\_obj->data->user\_email) ? $bookingpress\_current\_user\_obj->data->user\_email : ''; |
| [6430](#L6430) | $bookingpress\_firstname      = get\_user\_meta($current\_user\_id, 'first\_name', true); |
| [6431](#L6431) | $bookingpress\_lastname       = get\_user\_meta($current\_user\_id, 'last\_name', true); |
| [6432](#L6432) |  |
| [6433](#L6433) | if( !empty($bookingpress\_customer\_name)){ |
| [6434](#L6434) | $bookingpress\_front\_vue\_data\_fields['check\_bookingpress\_username\_set'] = 1; |
| [6435](#L6435) | } |
| [6436](#L6436) |  |
| [6437](#L6437) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'])) { |
| [6438](#L6438) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_username'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [6439](#L6439) | } |
| [6440](#L6440) |  |
| [6441](#L6441) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'])) { |
| [6442](#L6442) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_name'] = stripslashes\_deep($bookingpress\_customer\_name); |
| [6443](#L6443) | } |
| [6444](#L6444) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email'])) { |
| [6445](#L6445) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_email']     = stripslashes\_deep($bookingpress\_customer\_email); |
| [6446](#L6446) | } |
| [6447](#L6447) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'])) { |
| [6448](#L6448) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_firstname'] = stripslashes\_deep($bookingpress\_firstname); |
| [6449](#L6449) | } |
| [6450](#L6450) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname'])) { |
| [6451](#L6451) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_lastname']  = stripslashes\_deep($bookingpress\_lastname); |
| [6452](#L6452) | } |
| [6453](#L6453) | } |
| [6454](#L6454) | } |
| [6455](#L6455) | $bookingpress\_phone\_mandatory\_option = $BookingPress->bookingpress\_get\_settings('phone\_number\_mandatory', 'general\_setting'); |
| [6456](#L6456) | if (! empty($bookingpress\_phone\_mandatory\_option) && $bookingpress\_phone\_mandatory\_option == 'true' ) { |
| [6457](#L6457) | $mandatory\_field\_data = array( |
| [6458](#L6458) | 'required' => true, |
| [6459](#L6459) | 'message'  => esc\_html\_\_('Please enter customer phone number', 'bookingpress-appointment-booking'), |
| [6460](#L6460) | 'trigger'  => 'blur', |
| [6461](#L6461) | ); |
| [6462](#L6462) | $bookingpress\_front\_vue\_data\_fields['customer\_details\_rule']['customer\_phone'] = $mandatory\_field\_data; |
| [6463](#L6463) | } |
| [6464](#L6464) |  |
| [6465](#L6465) | $bookingpress\_phone\_country\_option = $BookingPress->bookingpress\_get\_settings('default\_phone\_country\_code', 'general\_setting'); |
| [6466](#L6466) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone\_country'] = $bookingpress\_phone\_country\_option; |
| [6467](#L6467) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['customer\_phone\_dial\_code'] = ''; |
| [6468](#L6468) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['bookingpress\_customer\_timezone'] = $bookingpress\_global\_options->bookingpress\_get\_site\_timezone\_offset(); |
| [6469](#L6469) |  |
| [6470](#L6470) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_tel\_input\_props'] = array( |
| [6471](#L6471) | 'defaultCountry' => $bookingpress\_phone\_country\_option, |
| [6472](#L6472) | 'inputOptions'   => array( |
| [6473](#L6473) | 'placeholder' => '', |
| [6474](#L6474) | ), |
| [6475](#L6475) | 'validCharactersOnly' => true, |
| [6476](#L6476) | ); |
| [6477](#L6477) |  |
| [6478](#L6478) | $default\_daysoff\_details = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [6479](#L6479) | $disabled\_date           = implode(',', $default\_daysoff\_details); |
| [6480](#L6480) | $bookingpress\_front\_vue\_data\_fields['days\_off\_disabled\_dates'] = $disabled\_date; |
| [6481](#L6481) |  |
| [6482](#L6482) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_disable\_dates'] = array(); |
| [6483](#L6483) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_dates'] = array(); |
| [6484](#L6484) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_blocked\_dates'] = array(); |
| [6485](#L6485) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_available\_only\_date'] = array(); |
| [6486](#L6486) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_timeslots\_data'] = array(); |
| [6487](#L6487) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_time\_token\_data'] = array(); |
| [6488](#L6488) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_attributes'] = array(); |
| [6489](#L6489) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_attributes\_current'] = array(); |
| [6490](#L6490) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_default\_label'] = array(); |
| [6491](#L6491) |  |
| [6492](#L6492) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_check\_month\_dates'] = false; |
| [6493](#L6493) | $bookingpress\_front\_vue\_data\_fields['v\_calendar\_next\_month\_dates'] = ''; |
| [6494](#L6494) |  |
| [6495](#L6495) | $bookingpress\_selected\_date = $BookingPress->bookingpress\_select\_date\_before\_load(); |
| [6496](#L6496) |  |
| [6497](#L6497) | if (! empty($bookingpress\_selected\_date) ) { |
| [6498](#L6498) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_date'] = $bookingpress\_selected\_date; |
| [6499](#L6499) | } |
| [6500](#L6500) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_activate\_payment\_gateway\_counter'] = 0; |
| [6501](#L6501) |  |
| [6502](#L6502) | if($bookingpress\_front\_vue\_data\_fields['bookingpress\_activate\_payment\_gateway\_counter'] > 0) { |
| [6503](#L6503) | $bookingpress\_front\_vue\_data\_fields['is\_only\_onsite\_enabled']   = 0; |
| [6504](#L6504) | } |
| [6505](#L6505) |  |
| [6506](#L6506) | $bookingpress\_customize\_settings = $BookingPress->bookingpress\_get\_customize\_settings( |
| [6507](#L6507) | array( |
| [6508](#L6508) | 'service\_title', |
| [6509](#L6509) | 'datetime\_title', |
| [6510](#L6510) | 'basic\_details\_title', |
| [6511](#L6511) | 'summary\_title', |
| [6512](#L6512) | 'hide\_category\_service\_selection' |
| [6513](#L6513) | ), |
| [6514](#L6514) | 'booking\_form' |
| [6515](#L6515) | ); |
| [6516](#L6516) |  |
| [6517](#L6517) | $bookingpress\_hide\_category\_service\_selection = stripslashes\_deep($bookingpress\_customize\_settings['hide\_category\_service\_selection']); |
| [6518](#L6518) | $bookingpress\_is\_loaded\_from\_share\_url = false; |
| [6519](#L6519) | if(!empty($\_GET['s\_id']) && (isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '0' ) ){ |
| [6520](#L6520) | $bookingpress\_hide\_category\_service\_selection = 'true'; |
| [6521](#L6521) | $bookingpress\_is\_loaded\_from\_share\_url = true; |
| [6522](#L6522) | }else if(!empty($\_GET['s\_id']) && (isset($\_GET['allow\_modify']) && $\_GET['allow\_modify'] == '1' ) ){ |
| [6523](#L6523) | $bookingpress\_hide\_category\_service\_selection = 'false'; |
| [6524](#L6524) | $bookingpress\_is\_loaded\_from\_share\_url = true; |
| [6525](#L6525) | } |
| [6526](#L6526) |  |
| [6527](#L6527) | if( 'true' == $bookingpress\_hide\_category\_service\_selection && empty( $selected\_service ) && true == $bookingpress\_is\_loaded\_from\_share\_url ){ |
| [6528](#L6528) | $bookingpress\_hide\_category\_service\_selection = 'false'; |
| [6529](#L6529) | } |
| [6530](#L6530) |  |
| [6531](#L6531) | $bookingpress\_service\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['service\_title']); |
| [6532](#L6532) | $bookingpress\_datetime\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['datetime\_title']);// |
| [6533](#L6533) | $bookingpress\_basic\_details\_tab\_name  = stripslashes\_deep($bookingpress\_customize\_settings['basic\_details\_title']); |
| [6534](#L6534) | $bookingpress\_summary\_tab\_name = stripslashes\_deep($bookingpress\_customize\_settings['summary\_title']); |
| [6535](#L6535) |  |
| [6536](#L6536) | $no\_service\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [6537](#L6537) |  |
| [6538](#L6538) | $no\_appointment\_date\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_date\_selected\_for\_the\_booking', 'message\_setting'); |
| [6539](#L6539) |  |
| [6540](#L6540) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [6541](#L6541) |  |
| [6542](#L6542) | $no\_payment\_method\_is\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_payment\_method\_is\_selected\_for\_the\_booking', 'message\_setting'); |
| [6543](#L6543) |  |
| [6544](#L6544) | $bookingpress\_date\_time\_step\_note = $BookingPress->bookingpress\_get\_customize\_settings('date\_time\_step\_note','booking\_form'); |
| [6545](#L6545) | $bookingpress\_date\_time\_step\_note = !empty($bookingpress\_date\_time\_step\_note) ? stripslashes\_deep($bookingpress\_date\_time\_step\_note) : ''; |
| [6546](#L6546) | $bookingpress\_front\_vue\_data\_fields['date\_time\_step\_note'] = $bookingpress\_date\_time\_step\_note; |
| [6547](#L6547) |  |
| [6548](#L6548) | $bookingpress\_summary\_step\_note = $BookingPress->bookingpress\_get\_customize\_settings('summary\_step\_note','booking\_form'); |
| [6549](#L6549) | $bookingpress\_summary\_step\_note = !empty($bookingpress\_summary\_step\_note) ? stripslashes\_deep($bookingpress\_summary\_step\_note) : ''; |
| [6550](#L6550) | $bookingpress\_front\_vue\_data\_fields['summary\_step\_note'] = $bookingpress\_summary\_step\_note; |
| [6551](#L6551) |  |
| [6552](#L6552) | $bookingpress\_sidebar\_steps\_data = array( |
| [6553](#L6553) | 'service' => array( |
| [6554](#L6554) | 'tab\_name' => $bookingpress\_service\_tab\_name, |
| [6555](#L6555) | 'tab\_value' => 'service', |
| [6556](#L6556) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 13H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2v-4c0-1.1-.9-2-2-2zM7 19c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2zM19 3H5c-1.1 0-2 .9-2 2v4c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zM7 9c-1.1 0-2-.9-2-2s.9-2 2-2 2 .9 2 2-.9 2-2 2z"/></svg>', |
| [6557](#L6557) | 'next\_tab\_name' => 'datetime', |
| [6558](#L6558) | 'next\_tab\_label' => '', |
| [6559](#L6559) | 'previous\_tab\_name' => '', |
| [6560](#L6560) | 'validate\_fields' => array( |
| [6561](#L6561) | 'selected\_service', |
| [6562](#L6562) | ), |
| [6563](#L6563) | 'auto\_focus\_tab\_callback' => array(), |
| [6564](#L6564) | 'validation\_msg' => array( |
| [6565](#L6565) | 'selected\_service' => stripslashes\_deep($no\_service\_selected\_for\_the\_booking), |
| [6566](#L6566) | ), |
| [6567](#L6567) | 'is\_allow\_navigate' => 1, |
| [6568](#L6568) | 'is\_navigate\_to\_next' => $bpa\_move\_from\_service\_selection\_step, |
| [6569](#L6569) | 'is\_display\_step' => 1, |
| [6570](#L6570) | 'sorting\_key' => 'service\_selection', |
| [6571](#L6571) | ), |
| [6572](#L6572) | 'datetime' => array( |
| [6573](#L6573) | 'tab\_name' => $bookingpress\_datetime\_tab\_name, |
| [6574](#L6574) | 'tab\_value' => 'datetime', |
| [6575](#L6575) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 4h-1V3c0-.55-.45-1-1-1s-1 .45-1 1v1H8V3c0-.55-.45-1-1-1s-1 .45-1 1v1H5c-1.11 0-1.99.9-1.99 2L3 20c0 1.1.89 2 2 2h14c1.1 0 2-.9 2-2V6c0-1.1-.9-2-2-2zm0 15c0 .55-.45 1-1 1H6c-.55 0-1-.45-1-1V9h14v10zM7 11h2v2H7zm4 0h2v2h-2zm4 0h2v2h-2z"/></svg>', |
| [6576](#L6576) | 'next\_tab\_name' => 'basic\_details', |
| [6577](#L6577) | 'previous\_tab\_name' => 'service', |
| [6578](#L6578) | 'auto\_focus\_tab\_callback' => array( |
| [6579](#L6579) | 'bookingpress\_disable\_date' => array() |
| [6580](#L6580) | ), |
| [6581](#L6581) | 'validate\_fields' => array( |
| [6582](#L6582) | 'selected\_date', |
| [6583](#L6583) | 'selected\_start\_time', |
| [6584](#L6584) | ), |
| [6585](#L6585) | 'validation\_msg' => array( |
| [6586](#L6586) | 'selected\_date' => stripslashes\_deep($no\_appointment\_date\_selected\_for\_the\_booking), |
| [6587](#L6587) | 'selected\_start\_time' => stripslashes\_deep($no\_appointment\_time\_selected\_for\_the\_booking), |
| [6588](#L6588) | ), |
| [6589](#L6589) | 'is\_allow\_navigate' => 0, |
| [6590](#L6590) | 'is\_display\_step' => 1, |
| [6591](#L6591) | 'is\_navigate\_to\_next' => false, |
| [6592](#L6592) | 'sorting\_key' => 'datetime\_selection', |
| [6593](#L6593) | ), |
| [6594](#L6594) | 'basic\_details' => array( |
| [6595](#L6595) | 'tab\_name' => $bookingpress\_basic\_details\_tab\_name, |
| [6596](#L6596) | 'tab\_value' => 'basic\_details', |
| [6597](#L6597) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" enable-background="new 0 0 24 24" viewBox="0 0 24 24"><g><rect fill="none" height="24" width="24"/><path d="M19,3H5C3.9,3,3,3.9,3,5v14c0,1.1,0.9,2,2,2h14c1.1,0,2-0.9,2-2V5C21,3.9,20.1,3,19,3z M13,17H8c-0.55,0-1-0.45-1-1 c0-0.55,0.45-1,1-1h5c0.55,0,1,0.45,1,1C14,16.55,13.55,17,13,17z M16,13H8c-0.55,0-1-0.45-1-1c0-0.55,0.45-1,1-1h8 c0.55,0,1,0.45,1,1C17,12.55,16.55,13,16,13z M16,9H8C7.45,9,7,8.55,7,8c0-0.55,0.45-1,1-1h8c0.55,0,1,0.45,1,1 C17,8.55,16.55,9,16,9z"/></g></svg>', |
| [6598](#L6598) | 'auto\_focus\_tab\_callback' => array(), |
| [6599](#L6599) | 'next\_tab\_name' => 'summary', |
| [6600](#L6600) | 'previous\_tab\_name' => 'datetime', |
| [6601](#L6601) | 'validate\_fields' => array(), |
| [6602](#L6602) | 'is\_allow\_navigate' => 0, |
| [6603](#L6603) | 'is\_display\_step' => 1, |
| [6604](#L6604) | 'is\_navigate\_to\_next' => false, |
| [6605](#L6605) | 'sorting\_key' => 'basic\_details\_selection', |
| [6606](#L6606) | ), |
| [6607](#L6607) | 'summary' => array( |
| [6608](#L6608) | 'tab\_name' => $bookingpress\_summary\_tab\_name, |
| [6609](#L6609) | 'tab\_value' => 'summary', |
| [6610](#L6610) | 'tab\_icon' => '<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M0 0h24v24H0V0z" fill="none"/><path d="M19 3h-4.18C14.4 1.84 13.3 1 12 1s-2.4.84-2.82 2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-7 0c.55 0 1 .45 1 1s-.45 1-1 1-1-.45-1-1 .45-1 1-1zM9.29 16.29L6.7 13.7c-.39-.39-.39-1.02 0-1.41.39-.39 1.02-.39 1.41 0L10 14.17l5.88-5.88c.39-.39 1.02-.39 1.41 0 .39.39.39 1.02 0 1.41l-6.59 6.59c-.38.39-1.02.39-1.41 0z"/></svg>', |
| [6611](#L6611) | 'next\_tab\_name' => 'summary', |
| [6612](#L6612) | 'auto\_focus\_tab\_callback' => array(), |
| [6613](#L6613) | 'previous\_tab\_name' => 'basic\_details', |
| [6614](#L6614) | 'validate\_fields' => array(), |
| [6615](#L6615) | 'is\_allow\_navigate' => 0, |
| [6616](#L6616) | 'is\_display\_step' => 1, |
| [6617](#L6617) | 'is\_navigate\_to\_next' => false, |
| [6618](#L6618) | 'sorting\_key' => 'summary\_selection', |
| [6619](#L6619) | ), |
| [6620](#L6620) | ); |
| [6621](#L6621) |  |
| [6622](#L6622) |  |
| [6623](#L6623) | if($bookingpress\_hide\_category\_service\_selection == 'true'){ |
| [6624](#L6624) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [6625](#L6625) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.5', '>' ) ){ |
| [6626](#L6626) | $bookingpress\_sidebar\_steps\_data['service']['is\_display\_step'] = 0; |
| [6627](#L6627) | } else { |
| [6628](#L6628) | /\*\* remove service step when pro version is lower than 1.5 \*/ |
| [6629](#L6629) | unset( $bookingpress\_sidebar\_steps\_data['service'] ); |
| [6630](#L6630) | } |
| [6631](#L6631) | } else { |
| [6632](#L6632) | $bookingpress\_sidebar\_steps\_data['service']['is\_display\_step'] = 0; |
| [6633](#L6633) | } |
| [6634](#L6634) | } |
| [6635](#L6635) |  |
| [6636](#L6636) | /\*\* compatibility change for pro version lower than 1.7 \*/ |
| [6637](#L6637) | if( $BookingPress->bpa\_is\_pro\_exists() && $BookingPress->bpa\_is\_pro\_active() ){ |
| [6638](#L6638) | if( !empty( $BookingPress->bpa\_pro\_plugin\_version() ) && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '1.7', '<' ) ){ |
| [6639](#L6639) | $bookingpress\_sidebar\_steps\_data['service']['tab\_icon'] = 'dns'; |
| [6640](#L6640) | $bookingpress\_sidebar\_steps\_data['datetime']['tab\_icon'] = 'date\_range'; |
| [6641](#L6641) | $bookingpress\_sidebar\_steps\_data['basic\_details']['tab\_icon'] = 'article'; |
| [6642](#L6642) | $bookingpress\_sidebar\_steps\_data['summary']['tab\_icon'] = 'assignment\_turned\_in'; |
| [6643](#L6643) | } |
| [6644](#L6644) | } |
| [6645](#L6645) | /\*\* compatibility change for pro version lower than 1.7 \*/ |
| [6646](#L6646) |  |
| [6647](#L6647) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_sidebar\_step\_data'] = $bookingpress\_sidebar\_steps\_data; |
| [6648](#L6648) | $bookingpress\_front\_vue\_data\_fields['isLoadClass'] = 1; |
| [6649](#L6649) |  |
| [6650](#L6650) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_external\_html'] = ''; |
| [6651](#L6651) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_is\_display\_external\_html'] = true; |
| [6652](#L6652) |  |
| [6653](#L6653) | $bookingpress\_decimal\_points = $BookingPress->bookingpress\_get\_settings('price\_number\_of\_decimals', 'payment\_setting'); |
| [6654](#L6654) | $bookingpress\_decimal\_points = intval($bookingpress\_decimal\_points); |
| [6655](#L6655) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_decimal\_points'] = $bookingpress\_decimal\_points; |
| [6656](#L6656) |  |
| [6657](#L6657) | $bookingpress\_currency\_separator = $BookingPress->bookingpress\_get\_settings('price\_separator', 'payment\_setting'); |
| [6658](#L6658) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_separator'] = $bookingpress\_currency\_separator; |
| [6659](#L6659) |  |
| [6660](#L6660) | $bookingpress\_currency\_name = $BookingPress->bookingpress\_get\_settings('payment\_default\_currency', 'payment\_setting'); |
| [6661](#L6661) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_name'] = $bookingpress\_currency\_name; |
| [6662](#L6662) |  |
| [6663](#L6663) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_symbol'] = $BookingPress->bookingpress\_get\_currency\_symbol($bookingpress\_currency\_name); |
| [6664](#L6664) |  |
| [6665](#L6665) | $bookingpress\_price\_symbol\_position = $BookingPress->bookingpress\_get\_settings('price\_symbol\_position', 'payment\_setting'); |
| [6666](#L6666) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_currency\_symbol\_position'] = $bookingpress\_price\_symbol\_position; |
| [6667](#L6667) |  |
| [6668](#L6668) | $bookingpress\_custom\_comma\_separator = $BookingPress->bookingpress\_get\_settings('custom\_comma\_separator', 'payment\_setting'); |
| [6669](#L6669) | $bookingpress\_custom\_thousand\_separator = $BookingPress->bookingpress\_get\_settings('custom\_dot\_separator', 'payment\_setting'); |
| [6670](#L6670) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_custom\_comma\_separator'] = $bookingpress\_custom\_comma\_separator; |
| [6671](#L6671) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_custom\_thousand\_separator'] = $bookingpress\_custom\_thousand\_separator; |
| [6672](#L6672) |  |
| [6673](#L6673) | $selected\_service = !empty( $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service'] ) ? $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_service'] : ''; |
| [6674](#L6674) | $default\_selected\_category = !empty( $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] ) ? $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] : ''; |
| [6675](#L6675) |  |
| [6676](#L6676) | if( !empty( $selected\_service ) ){ |
| [6677](#L6677) | $selected\_services\_data = $bookingpress\_front\_vue\_data\_fields['bookingpress\_all\_services\_data'][ $selected\_service ]; |
| [6678](#L6678) |  |
| [6679](#L6679) | $selected\_service\_category = $selected\_services\_data['bookingpress\_category\_id']; |
| [6680](#L6680) |  |
| [6681](#L6681) | if( $selected\_service\_category != $default\_selected\_category ){ |
| [6682](#L6682) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = $selected\_service\_category; |
| [6683](#L6683) | } |
| [6684](#L6684) | } |
| [6685](#L6685) |  |
| [6686](#L6686) | $bookingpress\_default\_select\_all\_category = $BookingPress->bookingpress\_get\_customize\_settings('default\_select\_all\_category','booking\_form'); |
| [6687](#L6687) | if(!empty($bookingpress\_default\_select\_all\_category ) && $bookingpress\_default\_select\_all\_category == 'true') { |
| [6688](#L6688) | $hide\_category\_service\_selection = $BookingPress->bookingpress\_get\_customize\_settings('hide\_category\_service\_selection','booking\_form'); |
| [6689](#L6689) | if($hide\_category\_service\_selection != 'true') { |
| [6690](#L6690) | if(isset($bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'])){ |
| [6691](#L6691) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['selected\_category'] = 0; |
| [6692](#L6692) | } |
| [6693](#L6693) | } |
| [6694](#L6694) | } |
| [6695](#L6695) |  |
| [6696](#L6696) | $bookingpress\_front\_vue\_data\_fields['bookingpress\_selected\_date\_range'] = array(); |
| [6697](#L6697) |  |
| [6698](#L6698) | $bookingpress\_front\_vue\_data\_fields['vue\_tel\_mode'] = 'international'; |
| [6699](#L6699) | $bookingpress\_front\_vue\_data\_fields['vue\_tel\_auto\_format'] = true; |
| [6700](#L6700) |  |
| [6701](#L6701) | $bookingpress\_front\_vue\_data\_fields['appointment\_step\_form\_data']['bookingpress\_form\_token'] = ''; |
| [6702](#L6702) |  |
| [6703](#L6703) | $bookingpress\_front\_vue\_data\_fields['show\_paypal\_popup\_button'] = "false"; |
| [6704](#L6704) | $bookingpress\_front\_vue\_data\_fields['paypal\_button\_loader'] = "false"; |
| [6705](#L6705) | $bookingpress\_front\_vue\_data\_fields['paypal\_success\_url'] = ""; |
| [6706](#L6706) | $bookingpress\_front\_vue\_data\_fields['paypal\_cancel\_url'] = ""; |
| [6707](#L6707) | $bookingpress\_front\_vue\_data\_fields['paypal\_booking\_form\_redirection\_mode'] = ""; |
| [6708](#L6708) |  |
| [6709](#L6709) | $bookingpress\_front\_vue\_data\_fields = apply\_filters('bookingpress\_frontend\_apointment\_form\_add\_dynamic\_data', $bookingpress\_front\_vue\_data\_fields); |
| [6710](#L6710) |  |
| [6711](#L6711) | $bookingpress\_dynamic\_data\_fields = wp\_json\_encode($bookingpress\_front\_vue\_data\_fields); |
| [6712](#L6712) | return $bookingpress\_dynamic\_data\_fields; |
| [6713](#L6713) | } |
| [6714](#L6714) |  |
| [6715](#L6715) | /\*\* |
| [6716](#L6716) | \* Callback function for [bookingpress\_appointment\_calendar\_integration] shortcode |
| [6717](#L6717) | \* |
| [6718](#L6718) | \* @param  mixed $atts |
| [6719](#L6719) | \* @param  mixed $content |
| [6720](#L6720) | \* @param  mixed $tag |
| [6721](#L6721) | \* @return void |
| [6722](#L6722) | \*/ |
| [6723](#L6723) | function bookingpress\_booking\_calendar\_options($atts, $content, $tag) { |
| [6724](#L6724) | global $wpdb, $tbl\_bookingpress\_appointment\_bookings, $tbl\_bookingpress\_entries; |
| [6725](#L6725) | $defaults = array( |
| [6726](#L6726) | 'gateways'  => 'google,yahoo,outlook,ical', |
| [6727](#L6727) | 'gateways\_label' => '', |
| [6728](#L6728) | 'button\_spacing' => '12' |
| [6729](#L6729) | ); |
| [6730](#L6730) | $args = shortcode\_atts($defaults, $atts, $tag); |
| [6731](#L6731) | extract($args); |
| [6732](#L6732) | $bookingpress\_calendar\_list = array(); |
| [6733](#L6733) | $bookingpress\_default\_arr = array('google' => esc\_html\_\_('Google Calendar','bookingpress-appointment-booking'), |
| [6734](#L6734) | 'yahoo'=> esc\_html\_\_('Yahoo Calendar','bookingpress-appointment-booking'), |
| [6735](#L6735) | 'outlook'=>  esc\_html\_\_('Outlook Calendar','bookingpress-appointment-booking'), |
| [6736](#L6736) | 'ical'=>  esc\_html\_\_('iCal Calendar','bookingpress-appointment-booking'), |
| [6737](#L6737) | ); |
| [6738](#L6738) | $bookingpress\_default\_arr2 = array('google' => 'google\_calendar' , |
| [6739](#L6739) | 'yahoo'=> 'yahoo\_calendar' , |
| [6740](#L6740) | 'outlook'=> 'outlook\_calendar', |
| [6741](#L6741) | 'ical'=> 'ical\_calendar', |
| [6742](#L6742) | ); |
| [6743](#L6743) | if(!empty($gateways)) { |
| [6744](#L6744) | $gateways = explode(',',$gateways); |
| [6745](#L6745) | $gateways\_label = explode(',',$gateways\_label); |
| [6746](#L6746) | foreach($gateways as $key => $value ) { |
| [6747](#L6747) | if(array\_key\_exists($value,$bookingpress\_default\_arr) ) { |
| [6748](#L6748) | $label\_value =!empty($gateways\_label[$key]) ? sanitize\_text\_field($gateways\_label[$key]) : $bookingpress\_default\_arr[$value]; |
| [6749](#L6749) | if(!empty($label\_value)) { |
| [6750](#L6750) | $bookingpress\_calendar\_list[] = array( |
| [6751](#L6751) | 'value' => $bookingpress\_default\_arr2[$value], |
| [6752](#L6752) | 'name' => $label\_value, |
| [6753](#L6753) | ); |
| [6754](#L6754) | } |
| [6755](#L6755) | } |
| [6756](#L6756) | } |
| [6757](#L6757) | } |
| [6758](#L6758) | $this->bookingpress\_calendar\_list = wp\_json\_encode($bookingpress\_calendar\_list); |
| [6759](#L6759) |  |
| [6760](#L6760) | global $BookingPress; |
| [6761](#L6761) | $BookingPress->set\_front\_css( 1 ); |
| [6762](#L6762) | $BookingPress->set\_front\_js( 1 ); |
| [6763](#L6763) | $BookingPress->bookingpress\_load\_booking\_form\_custom\_css(); |
| [6764](#L6764) |  |
| [6765](#L6765) | $bookingpress\_is\_render\_calendar = 1; |
| [6766](#L6766) | $bookingpress\_calendar\_html = ""; |
| [6767](#L6767) |  |
| [6768](#L6768) | $appointment\_id = 0; |
| [6769](#L6769) | if(!empty($\_GET['appointment\_id'])){ |
| [6770](#L6770) | $bookingpress\_nonce\_val = !empty($\_GET['bp\_tp\_nonce']) ? sanitize\_text\_field($\_GET['bp\_tp\_nonce']) : ''; |
| [6771](#L6771) | $bookingpress\_verification\_hash = !empty($\_GET['appointment\_id']) ? md5(base64\_decode(sanitize\_text\_field($\_GET['appointment\_id']))) : ''; |
| [6772](#L6772) | $bookingpress\_nonce\_verification = wp\_verify\_nonce($bookingpress\_nonce\_val, 'bpa\_nonce\_url-'.$bookingpress\_verification\_hash); |
| [6773](#L6773) | $appointment\_id = base64\_decode(sanitize\_text\_field($\_GET['appointment\_id'])); |
| [6774](#L6774) | if(!$bookingpress\_nonce\_verification){ |
| [6775](#L6775) | $bookingpress\_is\_render\_calendar = 0; |
| [6776](#L6776) | } |
| [6777](#L6777) | } |
| [6778](#L6778) |  |
| [6779](#L6779) | $bpa\_calendar\_details = $this->bookingpress\_get\_appointment\_details\_for\_calendar\_func($appointment\_id,true); |
| [6780](#L6780) |  |
| [6781](#L6781) | $bpa\_google\_data = $bpa\_calendar\_details['google\_calendar\_link']; |
| [6782](#L6782) | $bpa\_yahoo\_data =  $bpa\_calendar\_details['yahoo\_calendar\_link']; |
| [6783](#L6783) |  |
| [6784](#L6784) | $bpa\_google\_link = "https://www.google.com/calendar/render?action=TEMPLATE&text=$bpa\_google\_data"; |
| [6785](#L6785) | $bpa\_yahoo\_link = "http://calendar.yahoo.com/?v=60&view=d&type=20&title=$bpa\_yahoo\_data"; |
| [6786](#L6786) |  |
| [6787](#L6787) | $this->bookingpress\_google\_calendar\_link = $bpa\_google\_link; |
| [6788](#L6788) | $this->bookingpress\_yahoo\_calendar\_link = $bpa\_yahoo\_link; |
| [6789](#L6789) |  |
| [6790](#L6790) | if($bookingpress\_is\_render\_calendar){ |
| [6791](#L6791) | $bookingpress\_calendar\_html = '<div id="bpa-front-module-calendar-integration">'; |
| [6792](#L6792) | $bookingpress\_calendar\_html     .= '<div class="bpa-front-module--atc-wrapper">'; |
| [6793](#L6793) | $bookingpress\_calendar\_html .= ' |
| [6794](#L6794) | <div v-for="item in bookingpress\_calendar\_list" :class="\'bpa-front-module--atc\_\_item bpa-fm--atc\_\_\'+item.value" style="margin:0px '.$button\_spacing.'px '.$button\_spacing.'px 0px"> |
| [6795](#L6795) | <el-button class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width" id="bookingpress\_ical\_calendar" v-if="item.value == \'ical\_calendar\'"> |
| [6796](#L6796) | <span class="bpa-thank-you-add-cal"> |
| [6797](#L6797) | <svg width="14" height="16" viewBox="0 0 14 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6798](#L6798) | <g clip-path="url(#clip0\_1235\_2762)"> |
| [6799](#L6799) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.21165 1.39313C8.26508 0.00788564 9.72934 0 9.72934 0C9.72934 0 9.94793 1.30376 8.89977 2.55758C7.78313 3.89814 6.51375 3.67734 6.51375 3.67734C6.51375 3.67734 6.2741 2.6233 7.21165 1.39313Z" fill="black"/> |
| [6800](#L6800) | <path fill-rule="evenodd" clip-rule="evenodd" d="M6.64714 4.59251C7.18965 4.59251 8.19568 3.84863 9.50456 3.84863C11.7589 3.84863 12.6438 5.44942 12.6438 5.44942C12.6438 5.44942 10.9109 6.33524 10.9109 8.48014C10.9109 10.901 13.0704 11.7369 13.0704 11.7369C13.0704 11.7369 11.5614 15.9794 9.52037 15.9794C8.58281 15.9794 7.85595 15.3486 6.86836 15.3486C5.86233 15.3486 4.86421 16.0031 4.21372 16.0031C2.35178 16.0004 0 11.9787 0 8.743C0 5.55982 1.99098 3.89069 3.85818 3.89069C5.07226 3.89332 6.01508 4.59251 6.64714 4.59251Z" fill="black"/> |
| [6801](#L6801) | </g> |
| [6802](#L6802) | <defs> |
| [6803](#L6803) | <clipPath id="clip0\_1235\_2762"> |
| [6804](#L6804) | <rect width="13.0704" height="16" fill="white"/> |
| [6805](#L6805) | </clipPath> |
| [6806](#L6806) | </defs> |
| [6807](#L6807) | </svg> |
| [6808](#L6808) | </span> |
| [6809](#L6809) | {{ item.name}} |
| [6810](#L6810) | </el-button> |
| [6811](#L6811) | <el-link :href="bookingpress\_google\_calendar\_link" target="\_blank" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width bpa-front-link--no-underline" id="bookingpress\_google\_calendar" v-if="item.value == \'google\_calendar\'"> |
| [6812](#L6812) | <span class="bpa-thank-you-add-cal"> |
| [6813](#L6813) | <svg width="16" class="bookingpress\_google\_calendar\_svg" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6814](#L6814) | <path fill-rule="evenodd" clip-rule="evenodd" d="M15.6444 8.17812C15.6444 7.64479 15.5556 7.02257 15.4667 6.57812H8V9.68924H12.2667C12.0889 10.667 11.5556 11.467 10.6667 12.0892V14.1337H13.3333C14.8444 12.7115 15.6444 10.5781 15.6444 8.17812Z" fill="#4285F4"/> |
| [6815](#L6815) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99978 15.9996C10.1331 15.9996 11.9998 15.2885 13.3331 14.0441L10.6664 12.0885C9.95534 12.5329 9.06645 12.8885 7.99978 12.8885C5.95534 12.8885 4.17756 11.4663 3.55534 9.59961H0.888672V11.5552C2.13312 14.2218 4.88867 15.9996 7.99978 15.9996Z" fill="#34A853"/> |
| [6816](#L6816) | <path fill-rule="evenodd" clip-rule="evenodd" d="M3.55556 9.511C3.37778 9.06656 3.28889 8.53322 3.28889 7.99989C3.28889 7.46656 3.37778 6.93322 3.55556 6.48878V4.44434H0.888889C0.355556 5.511 0 6.75545 0 7.99989C0 9.24434 0.266667 10.4888 0.888889 11.5554L3.55556 9.511Z" fill="#FBBC05"/> |
| [6817](#L6817) | <path fill-rule="evenodd" clip-rule="evenodd" d="M7.99978 3.2C9.15534 3.2 10.222 3.64444 11.022 4.35556L13.3331 2.04444C11.9998 0.8 10.1331 0 7.99978 0C4.88867 0 2.13312 1.77778 0.888672 4.44444L3.55534 6.48889C4.17756 4.62222 5.95534 3.2 7.99978 3.2Z" fill="#EA4335"/> |
| [6818](#L6818) | </svg> |
| [6819](#L6819) | </span> |
| [6820](#L6820) | {{ item.name}} |
| [6821](#L6821) | </el-link> |
| [6822](#L6822) | <el-button class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width" id="bookingpress\_outlook\_calendar" v-if="item.value ==  \'outlook\_calendar\'"> |
| [6823](#L6823) | <span class="bpa-thank-you-add-cal"> |
| [6824](#L6824) | <svg width="16" height="16" viewBox="0 0 16 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6825](#L6825) | <g clip-path="url(#clip0\_1235\_2768)"> |
| [6826](#L6826) | <path d="M7.57897 0H0V7.57897H7.57897V0Z" fill="#F25022"/> |
| [6827](#L6827) | <path d="M7.57897 8.4209H0V15.9999H7.57897V8.4209Z" fill="#00A4EF"/> |
| [6828](#L6828) | <path d="M16.0008 0H8.42188V7.57897H16.0008V0Z" fill="#7FBA00"/> |
| [6829](#L6829) | <path d="M16.0008 8.4209H8.42188V15.9999H16.0008V8.4209Z" fill="#FFB900"/> |
| [6830](#L6830) | </g> |
| [6831](#L6831) | <defs> |
| [6832](#L6832) | <clipPath id="clip0\_1235\_2768"> |
| [6833](#L6833) | <rect width="16" height="16" fill="white"/> |
| [6834](#L6834) | </clipPath> |
| [6835](#L6835) | </defs> |
| [6836](#L6836) | </svg> |
| [6837](#L6837) | </span> |
| [6838](#L6838) | {{ item.name}} |
| [6839](#L6839) | </el-button> |
| [6840](#L6840) | <el-link :href="bookingpress\_yahoo\_calendar\_link" target="\_blank" class="bpa-front-btn bpa-front-btn\_\_medium bpa-front-btn--full-width bpa-front-link--no-underline" id="bookingpress\_yahoo\_calendar" v-if="item.value == |
| [6841](#L6841) | \'yahoo\_calendar\'"> |
| [6842](#L6842) | <span class="bpa-thank-you-add-cal"> |
| [6843](#L6843) | <svg width="18" height="16" viewBox="0 0 18 16" fill="none" xmlns="http://www.w3.org/2000/svg"> |
| [6844](#L6844) | <g clip-path="url(#clip0\_1235\_2766)"> |
| [6845](#L6845) | <path d="M0 3.89506H3.43247L5.43118 9.00836L7.45588 3.89506H10.7976L5.76558 16H2.40215L3.77968 12.7924L0.000106295 3.89506H0ZM14.6891 7.98076H10.9461L14.2682 0L17.9975 0.000159442L14.6891 7.98076V7.98076ZM11.9266 8.74459C13.075 8.74459 14.006 9.67558 14.006 10.8238C14.006 11.9721 13.075 12.9031 11.9266 12.9031C10.7783 12.9031 9.84751 11.9721 9.84751 10.8238C9.84751 9.67558 10.7784 8.74459 11.9266 8.74459Z" fill="#5F01D1"/> |
| [6846](#L6846) | </g> |
| [6847](#L6847) | <defs> |
| [6848](#L6848) | <clipPath id="clip0\_1235\_2766"> |
| [6849](#L6849) | <rect width="17.9975" height="16" fill="white"/> |
| [6850](#L6850) | </clipPath> |
| [6851](#L6851) | </defs> |
| [6852](#L6852) | </svg> |
| [6853](#L6853) | </span> |
| [6854](#L6854) | {{ item.name}} |
| [6855](#L6855) | </el-link> |
| [6856](#L6856) | </div>'; |
| [6857](#L6857) | $bookingpress\_calendar\_html             .= '</div>'; |
| [6858](#L6858) | $bookingpress\_calendar\_html .= '</div>'; |
| [6859](#L6859) |  |
| [6860](#L6860) | add\_action( |
| [6861](#L6861) | 'wp\_footer', |
| [6862](#L6862) | function() { |
| [6863](#L6863) | $appointment\_id = ( ! empty( $\_REQUEST['appointment\_id'] ) ? intval( base64\_decode( $\_REQUEST['appointment\_id'] ) ) : '' ); // phpcs:ignore WordPress.Security.ValidatedSanitizedInput.InputNotSanitized |
| [6864](#L6864) | ?> |
| [6865](#L6865) | <script> |
| [6866](#L6866) | wp.hooks.addAction('bpa\_calendar\_js\_init' , 'bookingpress-appointment-booking-pro', bookingpress\_load\_calendar\_list, 10, 1 ); |
| [6867](#L6867) | function bookingpress\_load\_calendar\_list(bookingpress\_appointment\_id){ |
| [6868](#L6868) | var app = new Vue({ |
| [6869](#L6869) | el:'#bpa-front-module-calendar-integration', |
| [6870](#L6870) | data(){ |
| [6871](#L6871) | var bookingpress\_return\_data = {}; |
| [6872](#L6872) | bookingpress\_return\_data['bookingpress\_calendar\_list'] = <?php echo \_wp\_specialchars($this->bookingpress\_calendar\_list,ENT\_NOQUOTES,'UTF-8', true); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped ?>; |
| [6873](#L6873) | bookingpress\_return\_data['bookingpress\_selected\_calendar'] = ''; |
| [6874](#L6874) | bookingpress\_return\_data['bookingpress\_appointment\_id'] = '<?php echo esc\_html($appointment\_id); ?>'; |
| [6875](#L6875) | bookingpress\_return\_data['bookingpress\_calendar\_link'] = ''; |
| [6876](#L6876) | bookingpress\_return\_data['bookingpress\_google\_calendar\_link'] = '<?php echo esc\_url\_raw($this->bookingpress\_google\_calendar\_link); ?>'; //phpcs:ignore |
| [6877](#L6877) | bookingpress\_return\_data['bookingpress\_yahoo\_calendar\_link'] = '<?php echo esc\_url\_raw($this->bookingpress\_yahoo\_calendar\_link); ?>'; //phpcs:ignore |
| [6878](#L6878) | return bookingpress\_return\_data; |
| [6879](#L6879) | }, |
| [6880](#L6880) | mounted(){ |
| [6881](#L6881) | const vm = this; |
| [6882](#L6882) | document.getElementById("bpa-front-module-calendar-integration").style.display = "block"; |
| [6883](#L6883) | document.getElementById("bookingpress\_ical\_calendar").addEventListener("click", function(e){ |
| [6884](#L6884) | let cal\_ics\_nonce = '<?php esc\_html\_e( wp\_create\_nonce( 'bookingpress\_calendar\_ics' ) );// phpcs:ignore ?>'; |
| [6885](#L6885) | if( null != document.getElementById('bpa\_ics\_nonce') ){ |
| [6886](#L6886) | cal\_ics\_nonce = document.getElementById('bpa\_ics\_nonce').value; |
| [6887](#L6887) | } |
| [6888](#L6888) | var bookingpress\_calendar\_link = "<?php echo esc\_url(BOOKINGPRESS\_HOME\_URL)."?bpa\_page=bookingpress\_download&action=generate\_ics&state=";?>" + cal\_ics\_nonce+ "<?php echo "&appointment\_id="; ?>"; |
| [6889](#L6889) | bookingpress\_calendar\_link = bookingpress\_calendar\_link + bookingpress\_appointment\_id; |
| [6890](#L6890) | bookingpress\_calendar\_link = wp.hooks.applyFilters( 'bookingpress\_change\_calendar\_url', bookingpress\_calendar\_link, 'ical', bookingpress\_appointment\_id ); |
| [6891](#L6891) | window.open(bookingpress\_calendar\_link, '\_self'); |
| [6892](#L6892) | }); |
| [6893](#L6893) | document.getElementById("bookingpress\_outlook\_calendar").addEventListener("click", function(e){ |
| [6894](#L6894) | let cal\_ics\_nonce = '<?php esc\_html\_e( wp\_create\_nonce( 'bookingpress\_calendar\_ics' ) );// phpcs:ignore ?>'; |
| [6895](#L6895) | if( null != document.getElementById('bpa\_ics\_nonce') ){ |
| [6896](#L6896) | cal\_ics\_nonce = document.getElementById('bpa\_ics\_nonce').value; |
| [6897](#L6897) | } |
| [6898](#L6898) | var bookingpress\_calendar\_link = "<?php echo esc\_url(BOOKINGPRESS\_HOME\_URL)."?bpa\_page=bookingpress\_download&action=generate\_ics&state=";?>" + cal\_ics\_nonce+ "<?php echo "&appointment\_id="; ?>"; |
| [6899](#L6899) | bookingpress\_calendar\_link = bookingpress\_calendar\_link + bookingpress\_appointment\_id; |
| [6900](#L6900) | bookingpress\_calendar\_link = wp.hooks.applyFilters( 'bookingpress\_change\_calendar\_url', bookingpress\_calendar\_link, 'outlook\_calendar', bookingpress\_appointment\_id ); |
| [6901](#L6901) | window.open(bookingpress\_calendar\_link, '\_self'); |
| [6902](#L6902) | }); |
| [6903](#L6903) | <?php do\_action( 'bookingpress\_calendar\_integration\_events' ); ?> |
| [6904](#L6904) | }, |
| [6905](#L6905) | }); |
| [6906](#L6906) | } |
| [6907](#L6907) |  |
| [6908](#L6908) | var bookingpress\_redirection\_mode = '<?php echo esc\_html(!empty($appointment\_id) ? 'external\_redirection' : 'in\_built'); ?>'; |
| [6909](#L6909) | if(bookingpress\_redirection\_mode == "external\_redirection"){ |
| [6910](#L6910) | var bookingpress\_appointment\_id = '<?php echo esc\_html($appointment\_id); ?>'; |
| [6911](#L6911) | wp.hooks.doAction("bpa\_calendar\_js\_init", bookingpress\_appointment\_id); |
| [6912](#L6912) | } |
| [6913](#L6913) | </script> |
| [6914](#L6914) | <?php |
| [6915](#L6915) | }, |
| [6916](#L6916) | 100 |
| [6917](#L6917) | ); |
| [6918](#L6918) | } |
| [6919](#L6919) |  |
| [6920](#L6920) | return $bookingpress\_calendar\_html; |
| [6921](#L6921) | } |
| [6922](#L6922) |  |
| [6923](#L6923) | /\*\* |
| [6924](#L6924) | \* Download ICS file from if it enable in email notification |
| [6925](#L6925) | \* |
| [6926](#L6926) | \* @return void |
| [6927](#L6927) | \*/ |
| [6928](#L6928) | function bookingpress\_download\_ics\_file() { |
| [6929](#L6929) |  |
| [6930](#L6930) | if ( ( ( !empty( $\_GET['page'] ) && 'bookingpress\_download' == $\_GET['page'] ) || ( !empty( $\_GET['bpa\_page'] ) && 'bookingpress\_download' == $\_GET['bpa\_page'] )) && ! empty( $\_GET['action'] ) && 'generate\_ics' == $\_GET['action'] ) { |
| [6931](#L6931) |  |
| [6932](#L6932) | $nonce = ! empty( $\_GET['state'] ) ? sanitize\_text\_field( $\_GET['state'] ) : ''; |
| [6933](#L6933) | if ( ! wp\_verify\_nonce( $nonce, 'bookingpress\_calendar\_ics' ) ) { |
| [6934](#L6934) | return false; |
| [6935](#L6935) | } |
| [6936](#L6936) |  |
| [6937](#L6937) | if ( empty( $\_GET['appointment\_id'] ) ) { |
| [6938](#L6938) | return false; |
| [6939](#L6939) | } |
| [6940](#L6940) |  |
| [6941](#L6941) | $appointment\_id = intval( $\_GET['appointment\_id'] ); |
| [6942](#L6942) |  |
| [6943](#L6943) | global $wpdb,$tbl\_bookingpress\_entries, $tbl\_bookingpress\_appointment\_bookings, $BookingPress, $bookingpress\_global\_options; |
| [6944](#L6944) | // $appointment\_id = base64\_decode( $\_REQUEST['appointment\_id'] ); |
| [6945](#L6945) | $bookingpress\_entry\_details = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_entries} WHERE bookingpress\_entry\_id = %d", $appointment\_id ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_entries is a table name. false alarm |
| [6946](#L6946) |  |
| [6947](#L6947) |  |
| [6948](#L6948) |  |
| [6949](#L6949) | if ( ! empty( $bookingpress\_entry\_details ) ) { |
| [6950](#L6950) | $bookingpress\_service\_id         = $bookingpress\_entry\_details['bookingpress\_service\_id']; |
| [6951](#L6951) | $bookingpress\_appointment\_date   = $bookingpress\_entry\_details['bookingpress\_appointment\_date']; |
| [6952](#L6952) | $bookingpress\_appointment\_time   = $bookingpress\_entry\_details['bookingpress\_appointment\_time']; |
| [6953](#L6953) | $bookingpress\_appointment\_status = $bookingpress\_entry\_details['bookingpress\_appointment\_status']; |
| [6954](#L6954) |  |
| [6955](#L6955) | $appointment\_data = $wpdb->get\_row( $wpdb->prepare( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE bookingpress\_service\_id = %d AND bookingpress\_appointment\_date = %s AND bookingpress\_appointment\_time = %s AND bookingpress\_appointment\_status = %s", $bookingpress\_service\_id, $bookingpress\_appointment\_date, $bookingpress\_appointment\_time, $bookingpress\_appointment\_status ), ARRAY\_A ); // phpcs:ignore WordPress.DB.PreparedSQL.InterpolatedNotPrepared --Reason: $tbl\_bookingpress\_appointment\_bookings is a table name. false alarm |
| [6956](#L6956) |  |
| [6957](#L6957) | if ( ! empty( $appointment\_data ) ) { |
| [6958](#L6958) | $service\_id              = intval( $appointment\_data['bookingpress\_service\_id'] ); |
| [6959](#L6959) |  |
| [6960](#L6960) | $bookingpress\_start\_time = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_time'] ); |
| [6961](#L6961) | $bookingpress\_end\_time   = sanitize\_text\_field( $appointment\_data['bookingpress\_appointment\_end\_time'] ); |
| [6962](#L6962) |  |
| [6963](#L6963) | $bookingpress\_appointment\_date\_temp = $appointment\_data['bookingpress\_appointment\_date']; |
| [6964](#L6964) | if ($bookingpress\_end\_time === '24:00:00') { |
| [6965](#L6965) | $bookingpress\_appointment\_date\_temp = date('Y-m-d', strtotime($appointment\_data['bookingpress\_appointment\_date'] . ' +1 day')); |
| [6966](#L6966) | $bookingpress\_end\_time = '00:00:00'; |
| [6967](#L6967) | } |
| [6968](#L6968) |  |
| [6969](#L6969) | $bookingpress\_start\_time = date( 'Ymd', strtotime( $appointment\_data['bookingpress\_appointment\_date'] ) ) . 'T' . date( 'His', strtotime( $bookingpress\_start\_time ) ); |
| [6970](#L6970) |  |
| [6971](#L6971) | $bookingpress\_end\_time = date( 'Ymd', strtotime( $bookingpress\_appointment\_date\_temp ) ) . 'T' . date( 'His', strtotime( $bookingpress\_end\_time ) ); |
| [6972](#L6972) | $user\_timezone             = $bookingpress\_global\_options->bookingpress\_get\_site\_timezone\_offset(); |
| [6973](#L6973) | $bookingpress\_service\_name = ! empty( $appointment\_data['bookingpress\_service\_name'] ) ? sanitize\_text\_field( $appointment\_data['bookingpress\_service\_name'] ) : ''; |
| [6974](#L6974) | } |
| [6975](#L6975) | $booking\_stime = $this->bookingpress\_convert\_date\_time\_to\_utc( $appointment\_data['bookingpress\_appointment\_date'], $bookingpress\_start\_time ); |
| [6976](#L6976) | $booking\_etime = $this->bookingpress\_convert\_date\_time\_to\_utc( $bookingpress\_appointment\_date\_temp, $bookingpress\_end\_time ); |
| [6977](#L6977) | $current\_dtime = $this->bookingpress\_convert\_date\_time\_to\_utc( date( 'm/d/Y' ), 'g:i A' ); |
| [6978](#L6978) |  |
| [6979](#L6979) | $string  = "BEGIN:VCALENDAR\r\n"; |
| [6980](#L6980) | $string .= "VERSION:2.0\r\n"; |
| [6981](#L6981) | $string .= 'PRODID:BOOKINGPRESS APPOINTMENT BOOKING\\\\' . get\_bloginfo('title') . "\r\n"; |
| [6982](#L6982) | $string .= "X-PUBLISHED-TTL:P1W\r\n"; |
| [6983](#L6983) | $string .= "BEGIN:VEVENT\r\n"; |
| [6984](#L6984) | $string .= 'UID:' . md5( time() ) . "\r\n"; |
| [6985](#L6985) | $string .= 'DTSTART:' . $booking\_stime . "\r\n"; |
| [6986](#L6986) | $string .= "SEQUENCE:0\r\n"; |
| [6987](#L6987) | $string .= "TRANSP:OPAQUE\r\n"; |
| [6988](#L6988) | $string .= "DTEND:{$booking\_etime}\r\n"; |
| [6989](#L6989) | $string .= "SUMMARY:{$bookingpress\_service\_name}\r\n"; |
| [6990](#L6990) | $string .= "CLASS:PUBLIC\r\n"; |
| [6991](#L6991) | $string .= "DTSTAMP:{$current\_dtime}\r\n"; |
| [6992](#L6992) | $string .= "END:VEVENT\r\n"; |
| [6993](#L6993) | $string .= "END:VCALENDAR\r\n"; |
| [6994](#L6994) |  |
| [6995](#L6995) | $string  = apply\_filters( 'bpa\_add\_timezone\_parameters\_for\_ics', $string, $appointment\_data ); |
| [6996](#L6996) |  |
| [6997](#L6997) | header( 'Content-Type: text/calendar; charset=utf-8' ); |
| [6998](#L6998) | header( 'Content-Disposition: attachment; filename="cal.ics"' ); |
| [6999](#L6999) |  |
| [7000](#L7000) |  |
| [7001](#L7001) | echo $string; //phpcs:ignore |
| [7002](#L7002) | } |
| [7003](#L7003) |  |
| [7004](#L7004) | die; |
| [7005](#L7005) |  |
| [7006](#L7006) | } |
| [7007](#L7007) | } |
| [7008](#L7008) |  |
| [7009](#L7009) | /\*\* |
| [7010](#L7010) | \* Convert Date and Time to UTC format |
| [7011](#L7011) | \* |
| [7012](#L7012) | \* @param  mixed $date      Convert date |
| [7013](#L7013) | \* @param  mixed $time      Convert time |
| [7014](#L7014) | \* @param  mixed $formated  Formatted date time should be return |
| [7015](#L7015) | \* @return void |
| [7016](#L7016) | \*/ |
| [7017](#L7017) | function bookingpress\_convert\_date\_time\_to\_utc( $date, $time, $formated = false ) { |
| [7018](#L7018) |  |
| [7019](#L7019) | if ( empty( $date ) ) { |
| [7020](#L7020) | $date = date( 'm/d/Y' ); |
| [7021](#L7021) | } |
| [7022](#L7022) |  |
| [7023](#L7023) | if ( empty( $time ) ) { |
| [7024](#L7024) | $time = date( 'g:i A' ); |
| [7025](#L7025) | } |
| [7026](#L7026) |  |
| [7027](#L7027) | $bookingpress\_time = date( 'm/d/Y', strtotime( $date ) ) . ' ' . date( 'g:i A', strtotime( $time ) ); |
| [7028](#L7028) |  |
| [7029](#L7029) | $tz\_from = wp\_timezone\_string(); |
| [7030](#L7030) | $tz\_to   = 'UTC'; |
| [7031](#L7031) | if ( $formated ) { |
| [7032](#L7032) | $format = 'Y-m-d\TH:i:s\Z'; |
| [7033](#L7033) | } else { |
| [7034](#L7034) | $format = 'Ymd\THis\Z'; |
| [7035](#L7035) | } |
| [7036](#L7036) |  |
| [7037](#L7037) | $start\_dt = new DateTime( $bookingpress\_time, new DateTimeZone( $tz\_from ) ); |
| [7038](#L7038) | $start\_dt->setTimeZone( new DateTimeZone( $tz\_to ) ); |
| [7039](#L7039) | $bookingpress\_time = $start\_dt->format( $format ); |
| [7040](#L7040) |  |
| [7041](#L7041) | return $bookingpress\_time; |
| [7042](#L7042) |  |
| [7043](#L7043) | } |
| [7044](#L7044) |  |
| [7045](#L7045) | /\*\* |
| [7046](#L7046) | \* Helper variables for Booking Form Shortcode |
| [7047](#L7047) | \* |
| [7048](#L7048) | \* @param  mixed $bookingpress\_front\_booking\_dynamic\_helper\_vars |
| [7049](#L7049) | \* @return void |
| [7050](#L7050) | \*/ |
| [7051](#L7051) | function bookingpress\_booking\_dynamic\_helper\_vars\_func( $bookingpress\_front\_booking\_dynamic\_helper\_vars ) |
| [7052](#L7052) | { |
| [7053](#L7053) | global $bookingpress\_global\_options; |
| [7054](#L7054) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [7055](#L7055) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [7056](#L7056) |  |
| [7057](#L7057) | $bookingpress\_front\_booking\_dynamic\_helper\_vars .= 'var lang = ELEMENT.lang.' . $bookingpress\_locale\_lang . ';'; |
| [7058](#L7058) | $bookingpress\_front\_booking\_dynamic\_helper\_vars .= 'ELEMENT.locale(lang);'; |
| [7059](#L7059) |  |
| [7060](#L7060) | $bookingpress\_front\_booking\_dynamic\_helper\_vars = apply\_filters('bookingpress\_add\_frontbooking\_dynamic\_helper\_vars', $bookingpress\_front\_booking\_dynamic\_helper\_vars); |
| [7061](#L7061) |  |
| [7062](#L7062) | return $bookingpress\_front\_booking\_dynamic\_helper\_vars; |
| [7063](#L7063) | } |
| [7064](#L7064) |  |
| [7065](#L7065) |  |
| [7066](#L7066) | /\*\* |
| [7067](#L7067) | \* Booking Form Shortcode onload methods |
| [7068](#L7068) | \* |
| [7069](#L7069) | \* @param  mixed $bookingpress\_dynamic\_on\_load\_methods\_data |
| [7070](#L7070) | \* @return void |
| [7071](#L7071) | \*/ |
| [7072](#L7072) | function bookingpress\_booking\_dynamic\_on\_load\_methods\_func( $bookingpress\_dynamic\_on\_load\_methods\_data ) |
| [7073](#L7073) | { |
| [7074](#L7074) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.bookingpress\_onload\_func();'; |
| [7075](#L7075) |  |
| [7076](#L7076) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.appointment\_step\_form\_data.bookingpress\_customer\_timezone = new Date().getTimezoneOffset();'; |
| [7077](#L7077) |  |
| [7078](#L7078) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'if(this.hide\_category\_service == "1" || this.is\_service\_loaded\_from\_url == "1"){ |
| [7079](#L7079) | this.bookingpress\_current\_tab = "datetime"; |
| [7080](#L7080) | }'; |
| [7081](#L7081) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [7082](#L7082) |  |
| [7083](#L7083) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7084](#L7084) | } |
| [7085](#L7085) |  |
| [7086](#L7086) | /\*\* |
| [7087](#L7087) | \* Booking Form Shortcode onload methods |
| [7088](#L7088) | \* |
| [7089](#L7089) | \* @param  mixed $bookingpress\_dynamic\_on\_load\_methods\_data |
| [7090](#L7090) | \* @return void |
| [7091](#L7091) | \*/ |
| [7092](#L7092) | function bookingpress\_booking\_dynamic\_on\_load\_methods\_func\_with\_pro( $bookingpress\_dynamic\_on\_load\_methods\_data ){ |
| [7093](#L7093) |  |
| [7094](#L7094) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.bookingpress\_onload\_func();'; |
| [7095](#L7095) |  |
| [7096](#L7096) | $bookingpress\_dynamic\_on\_load\_methods\_data .= 'this.appointment\_step\_form\_data.bookingpress\_customer\_timezone = new Date().getTimezoneOffset();'; |
| [7097](#L7097) |  |
| [7098](#L7098) | $bookingpress\_dynamic\_on\_load\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_on\_load\_methods', $bookingpress\_dynamic\_on\_load\_methods\_data); |
| [7099](#L7099) |  |
| [7100](#L7100) | $bookingpress\_is\_guest\_load\_from\_share\_url = !empty($\_GET['g\_id']) ? 1 : 0; |
| [7101](#L7101) | $bookingpress\_selected\_guest\_from\_url = !empty($\_GET['g\_id']) ? intval($\_GET['g\_id']) : 0; |
| [7102](#L7102) |  |
| [7103](#L7103) | $bookingpress\_dynamic\_on\_load\_methods\_data .= ' |
| [7104](#L7104) |  |
| [7105](#L7105) | var bookingpress\_guests\_load\_from\_share\_url = "'.$bookingpress\_is\_guest\_load\_from\_share\_url.'"; |
| [7106](#L7106) | var bookingpress\_selected\_guest\_from\_url = "'.$bookingpress\_selected\_guest\_from\_url.'"; |
| [7107](#L7107) |  |
| [7108](#L7108) | let current\_tab = this.bookingpress\_current\_tab; |
| [7109](#L7109) | let step\_data = this.bookingpress\_sidebar\_step\_data[ current\_tab ]; |
| [7110](#L7110) |  |
| [7111](#L7111) | if( this.hide\_category\_service == "1" || this.is\_service\_loaded\_from\_url == "1" ){ |
| [7112](#L7112) |  |
| [7113](#L7113) | let next\_tab = this.bookingpress\_sidebar\_step\_data["service"].next\_tab\_name; |
| [7114](#L7114) | let bookingpress\_selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [7115](#L7115) | let bookingpress\_selected\_service\_name = vm.appointment\_step\_form\_data.selected\_service\_name; |
| [7116](#L7116) | let bookingpress\_selected\_service\_price = vm.appointment\_step\_form\_data.selected\_service\_price; |
| [7117](#L7117) | let bookingpress\_selected\_service\_price\_without\_currency = vm.appointment\_step\_form\_data.service\_price\_without\_currency; |
| [7118](#L7118) |  |
| [7119](#L7119) | let useFlag = "false"; |
| [7120](#L7120) | if( "undefined" != typeof vm.is\_bring\_anyone\_with\_you\_activated && 1 == vm.is\_bring\_anyone\_with\_you\_activated && bookingpress\_guests\_load\_from\_share\_url == "1" && bookingpress\_selected\_guest\_from\_url != "" ){ |
| [7121](#L7121) | /\*\* Do Nothing as selectDate function has already been called before \*/ |
| [7122](#L7122) | } else { |
| [7123](#L7123) | vm.selectDate( bookingpress\_selected\_service\_id, bookingpress\_selected\_service\_name, bookingpress\_selected\_service\_price, bookingpress\_selected\_service\_price\_without\_currency, useFlag ); |
| [7124](#L7124) | } |
| [7125](#L7125) | } else { |
| [7126](#L7126) | if( "undefined" != typeof step\_data.is\_navigate\_to\_next && true == step\_data.is\_navigate\_to\_next ){ |
| [7127](#L7127) | this.bookingpress\_current\_tab = step\_data.next\_tab\_name; |
| [7128](#L7128) | } |
| [7129](#L7129) | } |
| [7130](#L7130) | '; |
| [7131](#L7131) | /\*'if((this.is\_staffmember\_activated == 1 && typeof this.appointment\_step\_form\_data.hide\_staff\_selection !== "undefined" && this.appointment\_step\_form\_data.hide\_staff\_selection == "false" && this.hide\_category\_service == "1" && this.is\_service\_loaded\_from\_url != "1" )) { |
| [7132](#L7132) | this.bookingpress\_current\_tab = "staffmembers"; |
| [7133](#L7133) | }'; \*/ |
| [7134](#L7134) |  |
| [7135](#L7135) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7136](#L7136) | } |
| [7137](#L7137) |  |
| [7138](#L7138) | function bookingpress\_call\_autofocus\_method( $bookingpress\_dynamic\_on\_load\_methods\_data ){ |
| [7139](#L7139) |  |
| [7140](#L7140) | $bookingpress\_dynamic\_on\_load\_methods\_data .= ' |
| [7141](#L7141) | let bpa\_current\_tab = this.bookingpress\_current\_tab; |
| [7142](#L7142) |  |
| [7143](#L7143) | let bpa\_side\_bar\_step\_data = this.bookingpress\_sidebar\_step\_data[bpa\_current\_tab]; |
| [7144](#L7144) | let bpa\_callback\_funcs = bpa\_side\_bar\_step\_data.auto\_focus\_tab\_callback; |
| [7145](#L7145) |  |
| [7146](#L7146) | for( let callback in bpa\_callback\_funcs ){ |
| [7147](#L7147) | let args = bpa\_callback\_funcs[callback]; |
| [7148](#L7148) |  |
| [7149](#L7149) | this[callback].apply( callback, args ); |
| [7150](#L7150) | } |
| [7151](#L7151) |  |
| [7152](#L7152) | '; |
| [7153](#L7153) |  |
| [7154](#L7154) | return $bookingpress\_dynamic\_on\_load\_methods\_data; |
| [7155](#L7155) | } |
| [7156](#L7156) |  |
| [7157](#L7157) | /\*\* |
| [7158](#L7158) | \* Booking Form Shortcode methods or functions |
| [7159](#L7159) | \* |
| [7160](#L7160) | \* @param  mixed $bookingpress\_vue\_methods\_data |
| [7161](#L7161) | \* @return void |
| [7162](#L7162) | \*/ |
| [7163](#L7163) | function bookingpress\_booking\_dynamic\_vue\_methods\_func( $bookingpress\_vue\_methods\_data ) |
| [7164](#L7164) | { |
| [7165](#L7165) | global $BookingPress, $bookingpress\_global\_options; |
| [7166](#L7166) |  |
| [7167](#L7167) | $bookingpress\_current\_date                    = date('Y-m-d', current\_time('timestamp')); |
| [7168](#L7168) | $no\_appointment\_time\_selected\_for\_the\_booking = $BookingPress->bookingpress\_get\_settings('no\_appointment\_time\_selected\_for\_the\_booking', 'message\_setting'); |
| [7169](#L7169) | $no\_service\_selected\_for\_the\_booking          = $BookingPress->bookingpress\_get\_settings('no\_service\_selected\_for\_the\_booking', 'message\_setting'); |
| [7170](#L7170) |  |
| [7171](#L7171) | $bookingpress\_nonce = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [7172](#L7172) |  |
| [7173](#L7173) | $bookingpress\_current\_user\_id = get\_current\_user\_id(); |
| [7174](#L7174) |  |
| [7175](#L7175) | $bookingpress\_before\_book\_appointment\_data = ''; |
| [7176](#L7176) | $bookingpress\_before\_book\_appointment\_data = apply\_filters('bookingpress\_before\_book\_appointment', $bookingpress\_before\_book\_appointment\_data); |
| [7177](#L7177) |  |
| [7178](#L7178) | $bookingpress\_before\_selecting\_booking\_service\_data = ''; |
| [7179](#L7179) | $bookingpress\_before\_selecting\_booking\_service\_data = apply\_filters('bookingpress\_before\_selecting\_booking\_service', $bookingpress\_before\_selecting\_booking\_service\_data); |
| [7180](#L7180) |  |
| [7181](#L7181) | $bookingpress\_after\_selecting\_booking\_service\_data = ''; |
| [7182](#L7182) | $bookingpress\_after\_selecting\_booking\_service\_data = apply\_filters('bookingpress\_after\_selecting\_booking\_service', $bookingpress\_after\_selecting\_booking\_service\_data); |
| [7183](#L7183) |  |
| [7184](#L7184) | $bookingpress\_after\_selecting\_booking\_service\_data\_updated = ''; |
| [7185](#L7185) | $bookingpress\_after\_selecting\_booking\_service\_data\_updated = apply\_filters('bookingpress\_after\_selecting\_booking\_service\_updated', $bookingpress\_after\_selecting\_booking\_service\_data\_updated); |
| [7186](#L7186) |  |
| [7187](#L7187) | $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date = ''; |
| [7188](#L7188) | $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date = apply\_filters('bookingpress\_after\_timeslot\_data\_load\_for\_single\_date', $bookingpress\_after\_timeslot\_data\_load\_for\_single\_date); |
| [7189](#L7189) |  |
| [7190](#L7190) |  |
| [7191](#L7191) | $bookingpress\_after\_selecting\_payment\_method\_data = ''; |
| [7192](#L7192) | $bookingpress\_after\_selecting\_payment\_method\_data = apply\_filters('bookingpress\_after\_selecting\_payment\_method', $bookingpress\_after\_selecting\_payment\_method\_data); |
| [7193](#L7193) |  |
| [7194](#L7194) | $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form = ''; |
| [7195](#L7195) | $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form = apply\_filters('bookingpress\_after\_selecting\_payment\_method\_booking\_form', $bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form); |
| [7196](#L7196) |  |
| [7197](#L7197) | $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request = ''; |
| [7198](#L7198) | $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request = apply\_filters('bookingpress\_dynamic\_add\_params\_for\_timeslot\_request', $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request); |
| [7199](#L7199) |  |
| [7200](#L7200) | $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page = ''; |
| [7201](#L7201) | $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page = apply\_filters('bookingpress\_add\_data\_for\_first\_step\_on\_next\_page', $bookingpress\_add\_data\_for\_first\_step\_on\_next\_page); |
| [7202](#L7202) |  |
| [7203](#L7203) | $bookingpress\_add\_data\_for\_previous\_page = ''; |
| [7204](#L7204) | $bookingpress\_add\_data\_for\_previous\_page = apply\_filters('bookingpress\_add\_data\_for\_previous\_page', $bookingpress\_add\_data\_for\_previous\_page); |
| [7205](#L7205) |  |
| [7206](#L7206) | $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page = ''; |
| [7207](#L7207) | $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page = apply\_filters('bookingpress\_add\_data\_for\_second\_step\_on\_next\_page', $bookingpress\_add\_data\_for\_second\_step\_on\_next\_page); |
| [7208](#L7208) |  |
| [7209](#L7209) | $bookingpress\_dynamic\_next\_page\_request\_filter = ''; |
| [7210](#L7210) | $bookingpress\_dynamic\_next\_page\_request\_filter = apply\_filters('bookingpress\_dynamic\_next\_page\_request\_filter', $bookingpress\_dynamic\_next\_page\_request\_filter); |
| [7211](#L7211) |  |
| [7212](#L7212) | $bookingpress\_change\_on\_summary\_steps\_filter = ''; |
| [7213](#L7213) | $bookingpress\_change\_on\_summary\_steps\_filter = apply\_filters('bookingpress\_change\_on\_summary\_steps\_filter', $bookingpress\_change\_on\_summary\_steps\_filter); |
| [7214](#L7214) |  |
| [7215](#L7215) | $bookingpress\_dynamic\_validation\_for\_step\_change = ''; |
| [7216](#L7216) | $bookingpress\_dynamic\_validation\_for\_step\_change = apply\_filters('bookingpress\_dynamic\_validation\_for\_step\_change', $bookingpress\_dynamic\_validation\_for\_step\_change); |
| [7217](#L7217) |  |
| [7218](#L7218) | $bookingpress\_validation\_for\_outside\_step\_change\_filter = ''; |
| [7219](#L7219) | $bookingpress\_validation\_for\_outside\_step\_change\_filter = apply\_filters('bookingpress\_validation\_for\_outside\_step\_change\_filter',$bookingpress\_validation\_for\_outside\_step\_change\_filter); |
| [7220](#L7220) |  |
| [7221](#L7221) | $bookingpress\_disable\_date\_xhr\_data = ''; |
| [7222](#L7222) | $bookingpress\_disable\_date\_xhr\_data = apply\_filters( 'bookingpress\_disable\_date\_xhr\_data', $bookingpress\_disable\_date\_xhr\_data ); |
| [7223](#L7223) |  |
| [7224](#L7224) | $bookingpress\_disable\_date\_pre\_xhr\_data = ''; |
| [7225](#L7225) | $bookingpress\_disable\_date\_pre\_xhr\_data = apply\_filters( 'bookingpress\_disable\_date\_pre\_xhr\_data', $bookingpress\_disable\_date\_pre\_xhr\_data ); |
| [7226](#L7226) |  |
| [7227](#L7227) | $bookingpress\_use\_legacy\_functions = 'false'; |
| [7228](#L7228) | $bookingpress\_use\_pro\_legacy = 'false'; |
| [7229](#L7229) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [7230](#L7230) | if( version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
| [7231](#L7231) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7232](#L7232) | $bookingpress\_use\_pro\_legacy = 'true'; |
| [7233](#L7233) | } |
| [7234](#L7234) |  |
| [7235](#L7235) | if( is\_plugin\_active( 'bookingpress-custom-service-duration/bookingpress-custom-service-duration.php' ) ){ |
| [7236](#L7236) | global $bookingpress\_custom\_service\_duration\_version; |
| [7237](#L7237) | if( version\_compare( $bookingpress\_custom\_service\_duration\_version, '2.1', '<' ) ){ |
| [7238](#L7238) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7239](#L7239) | } |
| [7240](#L7240) | } |
| [7241](#L7241) | } |
| [7242](#L7242) |  |
| [7243](#L7243) | $bookingpress\_disable\_date\_vue\_data = ''; |
| [7244](#L7244) | $bookingpress\_disable\_date\_vue\_data = apply\_filters( 'bookingpress\_disable\_date\_vue\_data\_modify', $bookingpress\_disable\_date\_vue\_data ); |
| [7245](#L7245) |  |
| [7246](#L7246) | $bookingpress\_disable\_date\_vue\_data\_after = ''; |
| [7247](#L7247) | $bookingpress\_disable\_date\_vue\_data\_after = apply\_filters( 'bookingpress\_disable\_date\_vue\_data\_after\_modify', $bookingpress\_disable\_date\_vue\_data\_after ); |
| [7248](#L7248) |  |
| [7249](#L7249) |  |
| [7250](#L7250) | $bookingpress\_disable\_future\_vue\_data = ''; |
| [7251](#L7251) | $bookingpress\_disable\_future\_vue\_data = apply\_filters( 'bookingpress\_disable\_future\_date\_vue\_data\_modify', $bookingpress\_disable\_future\_vue\_data ); |
| [7252](#L7252) |  |
| [7253](#L7253) | $bookingpress\_disable\_future\_vue\_data\_after = ''; |
| [7254](#L7254) | $bookingpress\_disable\_future\_vue\_data\_after = apply\_filters( 'bookingpress\_disable\_future\_date\_after\_vue\_data\_modify', $bookingpress\_disable\_future\_vue\_data\_after); |
| [7255](#L7255) |  |
| [7256](#L7256) | $bookingpress\_modify\_select\_step\_category = ''; |
| [7257](#L7257) | $bookingpress\_modify\_select\_step\_category = apply\_filters('bookingpress\_modify\_select\_step\_category', $bookingpress\_modify\_select\_step\_category); |
| [7258](#L7258) |  |
| [7259](#L7259) | $bookingpress\_modify\_select\_service\_category = ''; |
| [7260](#L7260) | $bookingpress\_modify\_select\_service\_category = apply\_filters( 'bookingpress\_modify\_select\_service\_category', $bookingpress\_modify\_select\_service\_category ); |
| [7261](#L7261) |  |
| [7262](#L7262) |  |
| [7263](#L7263) | $bookingpress\_step\_navigation\_before\_validation = ''; |
| [7264](#L7264) | $bookingpress\_step\_navigation\_before\_validation = apply\_filters( 'bookingpress\_step\_navigation\_before\_validation', $bookingpress\_step\_navigation\_before\_validation ); |
| [7265](#L7265) |  |
| [7266](#L7266) |  |
| [7267](#L7267) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after = ''; |
| [7268](#L7268) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after = apply\_filters( 'bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after', $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after ); |
| [7269](#L7269) |  |
| [7270](#L7270) |  |
| [7271](#L7271) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp = ''; |
| [7272](#L7272) | $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp = apply\_filters( 'bookingpress\_disable\_multiple\_days\_xhr\_response', $bookingpress\_disable\_multiple\_days\_event\_xhr\_resp ); |
| [7273](#L7273) |  |
| [7274](#L7274) | $bookingpress\_dynamic\_time\_select\_after = ''; |
| [7275](#L7275) | $bookingpress\_dynamic\_time\_select\_after = apply\_filters('bookingpress\_dynamic\_time\_select\_after', $bookingpress\_dynamic\_time\_select\_after); |
| [7276](#L7276) |  |
| [7277](#L7277) | $bookingpress\_site\_date = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
| [7278](#L7278) | $bookingpress\_site\_date = apply\_filters( 'bookingpress\_modify\_current\_date', $bookingpress\_site\_date ); |
| [7279](#L7279) |  |
| [7280](#L7280) | $bookingpress\_disable\_timeslot\_select\_data = ''; |
| [7281](#L7281) | $bookingpress\_disable\_timeslot\_select\_data = apply\_filters('bookingpress\_disable\_timeslot\_select\_data', $bookingpress\_disable\_timeslot\_select\_data); |
| [7282](#L7282) |  |
| [7283](#L7283) | $bookingpress\_disable\_date\_send\_data = ''; |
| [7284](#L7284) | $bookingpress\_disable\_date\_send\_data = apply\_filters('bookingpress\_disable\_date\_send\_data\_before', $bookingpress\_disable\_date\_send\_data); |
| [7285](#L7285) |  |
| [7286](#L7286) | $bookingpress\_disable\_future\_date\_send\_data = ''; |
| [7287](#L7287) | $bookingpress\_disable\_future\_date\_send\_data = apply\_filters( 'bookingpress\_disable\_future\_date\_send\_data\_before', $bookingpress\_disable\_future\_date\_send\_data ); |
| [7288](#L7288) |  |
| [7289](#L7289) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [7290](#L7290) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [7291](#L7291) |  |
| [7292](#L7292) | $convert\_timeslot\_to\_client\_timezone = false; |
| [7293](#L7293) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [7294](#L7294) | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
| [7295](#L7295) | } |
| [7296](#L7296) |  |
| [7297](#L7297) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [7298](#L7298) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [7299](#L7299) |  |
| [7300](#L7300) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [7301](#L7301) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [7302](#L7302) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [7303](#L7303) |  |
| [7304](#L7304) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [7305](#L7305) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [7306](#L7306) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [7307](#L7307) |  |
| [7308](#L7308) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [7309](#L7309) |  |
| [7310](#L7310) | $wp\_timezone\_offset = wp\_timezone\_string(); |
| [7311](#L7311) |  |
| [7312](#L7312) | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
| [7313](#L7313) | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
| [7314](#L7314) | } |
| [7315](#L7315) |  |
| [7316](#L7316) | $bookingpress\_step\_navigation\_token\_postdata = ''; |
| [7317](#L7317) | $bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata ); |
| [7318](#L7318) |  |
| [7319](#L7319) | $bookingpress\_step\_navigation\_token\_selection\_data = ''; |
| [7320](#L7320) | $bookingpress\_step\_navigation\_token\_selection\_data = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_date\_selection', $bookingpress\_step\_navigation\_token\_selection\_data ); |
| [7321](#L7321) |  |
| [7322](#L7322) | $bookingpress\_use\_legacy\_functions = 'false'; |
| [7323](#L7323) | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
| [7324](#L7324) | $bookingpress\_use\_legacy\_functions = 'true'; |
| [7325](#L7325) | } |
| [7326](#L7326) |  |
| [7327](#L7327) | $bookingpress\_vue\_methods\_data .= ' |
| [7328](#L7328) | get\_formatted\_date(iso\_date){ |
| [7329](#L7329) |  |
| [7330](#L7330) | if( true == /(\d{2})\T/.test( iso\_date ) ){ |
| [7331](#L7331) | let date\_time\_arr = iso\_date.split("T"); |
| [7332](#L7332) | return date\_time\_arr[0]; |
| [7333](#L7333) | } |
| [7334](#L7334) | var \_\_date = new Date(iso\_date); |
| [7335](#L7335) | var \_\_year = \_\_date.getFullYear(); |
| [7336](#L7336) | var \_\_month = \_\_date.getMonth()+1; |
| [7337](#L7337) | var \_\_day = \_\_date.getDate(); |
| [7338](#L7338) | if (\_\_day < 10) { |
| [7339](#L7339) | \_\_day = "0" + \_\_day; |
| [7340](#L7340) | } |
| [7341](#L7341) | if (\_\_month < 10) { |
| [7342](#L7342) | \_\_month = "0" + \_\_month; |
| [7343](#L7343) | } |
| [7344](#L7344) | var formatted\_date = \_\_year+"-"+\_\_month+"-"+\_\_day; |
| [7345](#L7345) | return formatted\_date; |
| [7346](#L7346) | }, |
| [7347](#L7347) | get\_formatted\_datetime(iso\_date) { |
| [7348](#L7348) | var \_\_date = new Date(iso\_date); |
| [7349](#L7349) | var hour = \_\_date.getHours(); |
| [7350](#L7350) | var minute = \_\_date.getMinutes(); |
| [7351](#L7351) | var second = \_\_date.getSeconds(); |
| [7352](#L7352) |  |
| [7353](#L7353) | if (minute < 10) { |
| [7354](#L7354) | minute = "0" + minute; |
| [7355](#L7355) | } |
| [7356](#L7356) | if (second < 10) { |
| [7357](#L7357) | second = "0" + second; |
| [7358](#L7358) | } |
| [7359](#L7359) | var formatted\_time = hour + ":" + minute + ":" + second; |
| [7360](#L7360) | var \_\_year = \_\_date.getFullYear(); |
| [7361](#L7361) | var \_\_month = \_\_date.getMonth()+1; |
| [7362](#L7362) | var \_\_day = \_\_date.getDate(); |
| [7363](#L7363) | if (\_\_day < 10) { |
| [7364](#L7364) | \_\_day = "0" + \_\_day; |
| [7365](#L7365) | } |
| [7366](#L7366) | if (\_\_month < 10) { |
| [7367](#L7367) | \_\_month = "0" + \_\_month; |
| [7368](#L7368) | } |
| [7369](#L7369) |  |
| [7370](#L7370) | var formatted\_date = \_\_year+"-"+\_\_month+"-"+\_\_day; |
| [7371](#L7371) | return formatted\_date+" "+formatted\_time; |
| [7372](#L7372) | }, |
| [7373](#L7373) | bookingpress\_set\_error\_msg(error\_msg){ |
| [7374](#L7374) | const vm = this; |
| [7375](#L7375) | let container = vm.$el; |
| [7376](#L7376) | let pos = 0; |
| [7377](#L7377) | if( null != container ){ |
| [7378](#L7378) | pos = container.getBoundingClientRect().top + window.scrollY; |
| [7379](#L7379) | } |
| [7380](#L7380) | vm.is\_display\_error = "1"; |
| [7381](#L7381) | vm.is\_error\_msg = error\_msg; |
| [7382](#L7382) | const myVar = Error().stack; |
| [7383](#L7383) |  |
| [7384](#L7384) | let allow\_scroll = true; |
| [7385](#L7385) | if( /mounted/.test( myVar ) ){ |
| [7386](#L7386) | allow\_scroll = false; |
| [7387](#L7387) | } |
| [7388](#L7388) | if( allow\_scroll ){ |
| [7389](#L7389) | window.scrollTo({ |
| [7390](#L7390) | top: pos, |
| [7391](#L7391) | behavior: "smooth", |
| [7392](#L7392) | }); |
| [7393](#L7393) | } |
| [7394](#L7394) | setTimeout(function(){ |
| [7395](#L7395) | vm.bookingpress\_remove\_error\_msg(); |
| [7396](#L7396) | },6000); |
| [7397](#L7397) | }, |
| [7398](#L7398) | bookingpress\_remove\_error\_msg(){ |
| [7399](#L7399) | const vm = this; |
| [7400](#L7400) | vm.is\_display\_error = "0"; |
| [7401](#L7401) | vm.is\_error\_msg = ""; |
| [7402](#L7402) | }, |
| [7403](#L7403) | checkBeforeBookAppointment(){ |
| [7404](#L7404) | const vm = this; |
| [7405](#L7405) | setTimeout(function(){ |
| [7406](#L7406) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7407](#L7407) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7408](#L7408) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7409](#L7409) | { |
| [7410](#L7410) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7411](#L7411) | } |
| [7412](#L7412) | else { |
| [7413](#L7413) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7414](#L7414) | } |
| [7415](#L7415) |  |
| [7416](#L7416) | var postData = { action:"bookingpress\_before\_book\_appointment",\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [7417](#L7417) | postData.appointment\_data = JSON.stringify( vm.appointment\_step\_form\_data ); |
| [7418](#L7418) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7419](#L7419) | .then( function (response) { |
| [7420](#L7420) | if(response.data.variant == "error"){ |
| [7421](#L7421) | vm.bookingpress\_set\_error\_msg(response.data.msg); |
| [7422](#L7422) | if(response.data.error\_type == "dayoff"){ |
| [7423](#L7423) | vm.service\_timing = []; |
| [7424](#L7424) | } |
| [7425](#L7425) | vm.isLoadBookingLoader = "0"; |
| [7426](#L7426) | vm.isBookingDisabled = false; |
| [7427](#L7427) | }else{ |
| [7428](#L7428) | vm.bookingpress\_remove\_error\_msg(); |
| [7429](#L7429) | vm.bookingpress\_process\_to\_book\_appointment(); |
| [7430](#L7430) | } |
| [7431](#L7431) | }.bind(this) ) |
| [7432](#L7432) | .catch( function (error) { |
| [7433](#L7433) | vm.bookingpress\_set\_error\_msg(error); |
| [7434](#L7434) | }); |
| [7435](#L7435) | },1500); |
| [7436](#L7436) | }, |
| [7437](#L7437) | book\_appointment(){ |
| [7438](#L7438) | const vm2 = this; |
| [7439](#L7439) | vm2.isLoadBookingLoader = "1"; |
| [7440](#L7440) | vm2.isBookingDisabled = true; |
| [7441](#L7441) | vm2.bookingpress\_process\_to\_book\_appointment(); |
| [7442](#L7442) |  |
| [7443](#L7443) | }, |
| [7444](#L7444) | async bookingpress\_process\_to\_book\_appointment(){ |
| [7445](#L7445) | const vm2 = this; |
| [7446](#L7446) | if(vm2.is\_display\_error != "1"){ |
| [7447](#L7447) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7448](#L7448) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7449](#L7449) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7450](#L7450) | { |
| [7451](#L7451) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7452](#L7452) | } |
| [7453](#L7453) | else { |
| [7454](#L7454) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7455](#L7455) | } |
| [7456](#L7456) |  |
| [7457](#L7457) | var postData = { action:"bookingpress\_front\_save\_appointment\_booking", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [7458](#L7458) | postData.appointment\_data = JSON.stringify( vm2.appointment\_step\_form\_data ); |
| [7459](#L7459) | ' . $bookingpress\_before\_book\_appointment\_data . ' |
| [7460](#L7460) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7461](#L7461) | .then( function (response) { |
| [7462](#L7462) | vm2.isLoadBookingLoader = "0"; |
| [7463](#L7463) | vm2.isBookingDisabled = false; |
| [7464](#L7464) | if(response.data.variant == "redirect"){ |
| [7465](#L7465) | vm2.bookingpress\_remove\_error\_msg(); |
| [7466](#L7466) | vm2.bookingpress\_external\_html = response.data.redirect\_data; |
| [7467](#L7467) | setTimeout(function(){ |
| [7468](#L7468) | var scripts = document.getElementById("bpa-external-script").querySelectorAll("script"); |
| [7469](#L7469) | if(scripts.length > 0){ |
| [7470](#L7470) | var text = scripts[scripts.length - 1].textContent; |
| [7471](#L7471) | eval(text); |
| [7472](#L7472) | } |
| [7473](#L7473) | },50); |
| [7474](#L7474) | }else if(response.data.variant == "redirect\_url"){ |
| [7475](#L7475) | vm2.bookingpress\_remove\_error\_msg(); |
| [7476](#L7476) | window.location.href = response.data.redirect\_data; |
| [7477](#L7477) | }else if(response.data.variant == "error"){ |
| [7478](#L7478) | vm2.bookingpress\_set\_error\_msg(response.data.msg); |
| [7479](#L7479) | }else{ |
| [7480](#L7480) | vm2.bookingpress\_remove\_error\_msg(); |
| [7481](#L7481) | } |
| [7482](#L7482) | if(response.data.error\_type == "dayoff"){ |
| [7483](#L7483) | vm2.service\_timing = []; |
| [7484](#L7484) | } |
| [7485](#L7485) | }.bind(this) ) |
| [7486](#L7486) | .catch( function (error) { |
| [7487](#L7487) | vm2.bookingpress\_set\_error\_msg(error); |
| [7488](#L7488) | }); |
| [7489](#L7489) | }else{ |
| [7490](#L7490) | vm2.isLoadBookingLoader = "0"; |
| [7491](#L7491) | vm2.isBookingDisabled = false; |
| [7492](#L7492) | } |
| [7493](#L7493) | }, |
| [7494](#L7494) | bpa\_check\_browser(){ |
| [7495](#L7495) | const vm = this; |
| [7496](#L7496) | let userAgent = navigator.userAgent; |
| [7497](#L7497) | let browserName; |
| [7498](#L7498) | if(userAgent.match(/edg/i)){ |
| [7499](#L7499) | browserName = "edge"; |
| [7500](#L7500) | } else if(userAgent.match(/opr\//i)){ |
| [7501](#L7501) | browserName = "opera"; |
| [7502](#L7502) | } else if(userAgent.match(/chrome|chromium|crios/i)){ |
| [7503](#L7503) | browserName = "chrome"; |
| [7504](#L7504) | } else if(userAgent.match(/firefox|fxios/i)) { |
| [7505](#L7505) | browserName = "firefox"; |
| [7506](#L7506) | } else if(userAgent.match(/safari/i)) { |
| [7507](#L7507) | browserName = "safari"; |
| [7508](#L7508) | } else { |
| [7509](#L7509) | browserName="Unknown"; |
| [7510](#L7510) | } |
| [7511](#L7511) |  |
| [7512](#L7512) | vm.browser\_details = browserName; |
| [7513](#L7513) | }, |
| [7514](#L7514) | bpa\_check\_browser\_version(){ |
| [7515](#L7515) | const vm = this; |
| [7516](#L7516) | var objappVersion = navigator.appVersion; |
| [7517](#L7517) | var browserAgent = navigator.userAgent; |
| [7518](#L7518) | var browserName = navigator.appName; |
| [7519](#L7519) | var browserVersion = "" + parseFloat(navigator.appVersion); |
| [7520](#L7520) | var browserMajorVersion = parseInt(navigator.appVersion, 10); |
| [7521](#L7521) | var Offset, OffsetVersion, ix; |
| [7522](#L7522) |  |
| [7523](#L7523) | /\* For Chrome \*/ |
| [7524](#L7524) | if ((OffsetVersion = browserAgent.indexOf("Chrome")) != -1) { |
| [7525](#L7525) | browserName = "Chrome"; |
| [7526](#L7526) | browserVersion = browserAgent.substring(OffsetVersion + 7); |
| [7527](#L7527) | } |
| [7528](#L7528) |  |
| [7529](#L7529) | /\* For Microsoft internet explorer  \*/ |
| [7530](#L7530) | else if ((OffsetVersion = browserAgent.indexOf("MSIE")) != -1) { |
| [7531](#L7531) | browserName = "Microsoft Internet Explorer"; |
| [7532](#L7532) | browserVersion = browserAgent.substring(OffsetVersion + 5); |
| [7533](#L7533) | } |
| [7534](#L7534) |  |
| [7535](#L7535) | /\* For Firefox \*/ |
| [7536](#L7536) | else if ((OffsetVersion = browserAgent.indexOf("Firefox")) != -1) { |
| [7537](#L7537) | browserName = "Firefox"; |
| [7538](#L7538) | } |
| [7539](#L7539) |  |
| [7540](#L7540) | /\* For Safari \*/ |
| [7541](#L7541) | else if ((OffsetVersion = browserAgent.indexOf("Safari")) != -1) { |
| [7542](#L7542) | browserName = "Safari"; |
| [7543](#L7543) | browserVersion = browserAgent.substring(OffsetVersion + 7); |
| [7544](#L7544) | if ((OffsetVersion = browserAgent.indexOf("Version")) != -1) |
| [7545](#L7545) | browserVersion = browserAgent.substring(OffsetVersion + 8); |
| [7546](#L7546) | } |
| [7547](#L7547) |  |
| [7548](#L7548) | /\* For other browser "name/version" is at the end of userAgent \*/ |
| [7549](#L7549) | else if ((Offset = browserAgent.lastIndexOf(" ") + 1) < (OffsetVersion = browserAgent.lastIndexOf("/"))) { |
| [7550](#L7550) | browserName = browserAgent.substring(Offset, OffsetVersion); |
| [7551](#L7551) | browserVersion = browserAgent.substring(OffsetVersion + 1); |
| [7552](#L7552) | if (browserName.toLowerCase() == browserName.toUpperCase()) { |
| [7553](#L7553) | browserName = navigator.appName; |
| [7554](#L7554) | } |
| [7555](#L7555) | } |
| [7556](#L7556) |  |
| [7557](#L7557) | /\* Trimming the fullVersion string at \*/ |
| [7558](#L7558) | /\* semicolon/space if present \*/ |
| [7559](#L7559) | if ((ix = browserVersion.indexOf(";")) != -1) |
| [7560](#L7560) | browserVersion = browserVersion.substring(0, ix); |
| [7561](#L7561) | if ((ix = browserVersion.indexOf(" ")) != -1) |
| [7562](#L7562) | browserVersion = browserVersion.substring(0, ix); |
| [7563](#L7563) |  |
| [7564](#L7564) |  |
| [7565](#L7565) | browserMajorVersion = parseInt("" + browserVersion, 10); |
| [7566](#L7566) | if (isNaN(browserMajorVersion)) { |
| [7567](#L7567) | browserVersion = "" + parseFloat(navigator.appVersion); |
| [7568](#L7568) | browserMajorVersion = parseInt(navigator.appVersion, 10); |
| [7569](#L7569) | } |
| [7570](#L7570) |  |
| [7571](#L7571) | vm.browser\_version = browserMajorVersion; |
| [7572](#L7572) | }, |
| [7573](#L7573) | bpa\_select\_category( selected\_cat\_id, selected\_cat\_name, total\_services, total\_category){ |
| [7574](#L7574) | const vm = this; |
| [7575](#L7575) | let category\_id = parseInt( selected\_cat\_id ); |
| [7576](#L7576) | vm.isLoadClass = 0; |
| [7577](#L7577) | if( 0 == selected\_cat\_id ){ |
| [7578](#L7578) | for( let bpa\_service\_id in vm.bookingpress\_all\_services\_data ){ |
| [7579](#L7579) | let current\_service = vm.bookingpress\_all\_services\_data[ bpa\_service\_id ]; |
| [7580](#L7580) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = true; |
| [7581](#L7581) | '.$bookingpress\_modify\_select\_service\_category.' |
| [7582](#L7582) | } |
| [7583](#L7583) | } else { |
| [7584](#L7584) | if( vm.bookingpress\_all\_services\_data != "" ){ |
| [7585](#L7585) | for( let bpa\_service\_id in vm.bookingpress\_all\_services\_data ){ |
| [7586](#L7586) | let current\_service = vm.bookingpress\_all\_services\_data[ bpa\_service\_id ]; |
| [7587](#L7587) | let current\_category = current\_service.bookingpress\_category\_id; |
| [7588](#L7588) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = false; |
| [7589](#L7589) | if( current\_category == category\_id ){ |
| [7590](#L7590) | vm.bookingpress\_all\_services\_data[ bpa\_service\_id ].is\_visible = true; |
| [7591](#L7591) | } |
| [7592](#L7592) | '.$bookingpress\_modify\_select\_service\_category.' |
| [7593](#L7593) | } |
| [7594](#L7594) | } |
| [7595](#L7595) | } |
| [7596](#L7596) | setTimeout(function(){ |
| [7597](#L7597) | vm.isLoadClass = 1; |
| [7598](#L7598) | },1); |
| [7599](#L7599) | vm.appointment\_step\_form\_data.selected\_category = selected\_cat\_id; |
| [7600](#L7600) | vm.appointment\_step\_form\_data.selected\_cat\_name = selected\_cat\_name; |
| [7601](#L7601) | }, |
| [7602](#L7602) | selectStepCategory(selected\_cat\_id, selected\_cat\_name = "", total\_services = 0, total\_category="", display\_warn = true ){ |
| [7603](#L7603) | if( true == display\_warn ){ |
| [7604](#L7604) | console.trace("Deprecated step category function " ); |
| [7605](#L7605) | console.warn("selectStepCategory function is deprecated. Please update the BookingPress lite, premium, and add-ons to the latest version"); |
| [7606](#L7606) | } |
| [7607](#L7607) | const vm = this; |
| [7608](#L7608) | vm.isLoadClass = 0; |
| [7609](#L7609) | if( 0 == selected\_cat\_id ){ |
| [7610](#L7610) | let temp\_services = []; |
| [7611](#L7611) | let m = 0; |
| [7612](#L7612) | for( let x in vm.bpa\_services\_data\_from\_categories ){ |
| [7613](#L7613) | let service\_details = vm.bpa\_services\_data\_from\_categories[x]; |
| [7614](#L7614) | for( let n in service\_details ){ |
| [7615](#L7615) | let current\_service = service\_details[n]; |
| [7616](#L7616) | if( "undefined" != typeof current\_service.bookingpress\_staffmembers ){ |
| [7617](#L7617) | let selected\_staffmember = vm.appointment\_step\_form\_data.bookingpress\_selected\_staff\_member\_details.selected\_staff\_member\_id; |
| [7618](#L7618) | if( current\_service.bookingpress\_staffmembers.includes( selected\_staffmember ) && selected\_staffmember != ""){ |
| [7619](#L7619) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position); |
| [7620](#L7620) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7621](#L7621) | } else { |
| [7622](#L7622) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position ); |
| [7623](#L7623) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7624](#L7624) | } |
| [7625](#L7625) | } else { |
| [7626](#L7626) | var bookingpress\_service\_pos = parseFloat(current\_service.bookingpress\_service\_position ); |
| [7627](#L7627) | temp\_services[bookingpress\_service\_pos] = current\_service; |
| [7628](#L7628) | } |
| [7629](#L7629) | '.$bookingpress\_modify\_select\_step\_category.' |
| [7630](#L7630) | m++; |
| [7631](#L7631) | } |
| [7632](#L7632) | } |
| [7633](#L7633) | var bpa\_temp\_services= []; |
| [7634](#L7634) | temp\_services.sort(); |
| [7635](#L7635) | for( let n in temp\_services ){ |
| [7636](#L7636) | if(temp\_services[n] != "") { |
| [7637](#L7637) | bpa\_temp\_services[n] = temp\_services[n]; |
| [7638](#L7638) | } |
| [7639](#L7639) | } |
| [7640](#L7640) | vm.services\_data = bpa\_temp\_services.sort(); |
| [7641](#L7641) | } else { |
| [7642](#L7642) | vm.services\_data = vm.bpa\_services\_data\_from\_categories[selected\_cat\_id]; |
| [7643](#L7643) | '.$bookingpress\_modify\_select\_step\_category.' |
| [7644](#L7644) | } |
| [7645](#L7645) |  |
| [7646](#L7646) | vm.appointment\_step\_form\_data.selected\_category = selected\_cat\_id; |
| [7647](#L7647) | vm.appointment\_step\_form\_data.selected\_cat\_name = selected\_cat\_name; |
| [7648](#L7648) | setTimeout(function(){ |
| [7649](#L7649) | vm.isLoadClass = 1; |
| [7650](#L7650) | },1); |
| [7651](#L7651) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7652](#L7652) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7653](#L7653) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7654](#L7654) | { |
| [7655](#L7655) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7656](#L7656) | } |
| [7657](#L7657) | else { |
| [7658](#L7658) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7659](#L7659) | } |
| [7660](#L7660) | }, |
| [7661](#L7661) | async selectDate(selected\_service\_id, service\_name, service\_price, service\_price\_without\_currency, is\_move\_to\_next, service\_duration\_val = "",service\_duration\_unit = ""){ |
| [7662](#L7662) | const vm = this; |
| [7663](#L7663) | if(typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" && (selected\_service\_id != vm.appointment\_step\_form\_data.selected\_service && vm.appointment\_step\_form\_data.selected\_date != "")){ |
| [7664](#L7664) |  |
| [7665](#L7665) | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7666](#L7666) | let newDate = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [7667](#L7667) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [7668](#L7668) | if( !pattern.test( newDate ) ){ |
| [7669](#L7669) |  |
| [7670](#L7670) | let sel\_month = newDate.getMonth() + 1; |
| [7671](#L7671) | let sel\_year = newDate.getFullYear(); |
| [7672](#L7672) | let sel\_date = newDate.getDate(); |
| [7673](#L7673) |  |
| [7674](#L7674) | if( sel\_month < 10 ){ |
| [7675](#L7675) | sel\_month = "0" + sel\_month; |
| [7676](#L7676) | } |
| [7677](#L7677) |  |
| [7678](#L7678) | if( sel\_date < 10 ){ |
| [7679](#L7679) | sel\_date = "0" + sel\_date; |
| [7680](#L7680) | } |
| [7681](#L7681) |  |
| [7682](#L7682) | newDate = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [7683](#L7683) | } |
| [7684](#L7684) |  |
| [7685](#L7685) | vm.appointment\_step\_form\_data.selected\_date = newDate; |
| [7686](#L7686) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7687](#L7687) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7688](#L7688) | } |
| [7689](#L7689) | '.$bookingpress\_before\_selecting\_booking\_service\_data.' |
| [7690](#L7690) |  |
| [7691](#L7691) | vm.appointment\_step\_form\_data.selected\_service = selected\_service\_id; |
| [7692](#L7692) | vm.v\_calendar\_blocked\_dates = []; |
| [7693](#L7693) | vm.v\_calendar\_attributes\_current = []; |
| [7694](#L7694) |  |
| [7695](#L7695) | vm.appointment\_step\_form\_data.selected\_service\_name = service\_name; |
| [7696](#L7696) | vm.appointment\_step\_form\_data.selected\_service\_price = service\_price; |
| [7697](#L7697) | vm.appointment\_step\_form\_data.service\_price\_without\_currency = service\_price\_without\_currency; |
| [7698](#L7698) |  |
| [7699](#L7699) | /\* vm.appointment\_step\_form\_data.base\_price = service\_price; \*/ |
| [7700](#L7700) | vm.appointment\_step\_form\_data.base\_price\_without\_currency = service\_price\_without\_currency; |
| [7701](#L7701) | if( "" == service\_duration\_val ){ |
| [7702](#L7702) | service\_duration\_val = vm.bookingpress\_all\_services\_data[ selected\_service\_id ].bookingpress\_service\_duration\_val; |
| [7703](#L7703) | } |
| [7704](#L7704) |  |
| [7705](#L7705) | if( "" == service\_duration\_unit ){ |
| [7706](#L7706) | service\_duration\_unit = vm.bookingpress\_all\_services\_data[ selected\_service\_id ].bookingpress\_service\_duration\_unit; |
| [7707](#L7707) | } |
| [7708](#L7708) |  |
| [7709](#L7709) | vm.appointment\_step\_form\_data.selected\_service\_duration = service\_duration\_val; |
| [7710](#L7710) | vm.appointment\_step\_form\_data.selected\_service\_duration\_unit = service\_duration\_unit; |
| [7711](#L7711) |  |
| [7712](#L7712) | if(vm.previous\_selected\_tab\_id === 1 || vm.previous\_selected\_tab\_id === 2 || vm.current\_selected\_tab\_id === 1){ |
| [7713](#L7713) | vm.displayResponsiveCalendar = "1"; |
| [7714](#L7714) | } |
| [7715](#L7715) |  |
| [7716](#L7716) | vm.v\_calendar\_disable\_dates = []; |
| [7717](#L7717) | vm.bpa\_current\_selected\_date = ""; |
| [7718](#L7718) | if(is\_move\_to\_next === "true"){ |
| [7719](#L7719) | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
| [7720](#L7720) | } |
| [7721](#L7721) |  |
| [7722](#L7722) | var selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7723](#L7723) | var formatted\_date = vm.get\_formatted\_date(selected\_date); |
| [7724](#L7724) | vm.bookingpress\_remove\_error\_msg(); |
| [7725](#L7725) | ' . $bookingpress\_after\_selecting\_booking\_service\_data . ' |
| [7726](#L7726) | }, |
| [7727](#L7727) | dayClickedResponsive( day ){ |
| [7728](#L7728) | const vm = this; |
| [7729](#L7729) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7730](#L7730) | vm.displayResponsiveCalendar = "1"; |
| [7731](#L7731) | vm.isLoadDateTimeCalendar = "1"; |
| [7732](#L7732) | if( window.innerWidth <= 991 ){ |
| [7733](#L7733) | vm.service\_timing = "-1"; |
| [7734](#L7734) | } else { |
| [7735](#L7735) | vm.service\_timing = "-1"; |
| [7736](#L7736) | } |
| [7737](#L7737) | } |
| [7738](#L7738) | vm.dayClicked(day); |
| [7739](#L7739) |  |
| [7740](#L7740) | }, |
| [7741](#L7741) | dayClicked(day){ |
| [7742](#L7742) | const vm = this; |
| [7743](#L7743) | let available\_dates = vm.v\_calendar\_available\_dates; |
| [7744](#L7744) | let dayId = day.id; |
| [7745](#L7745) | let dayString = dayId + " 00:00:00"; |
| [7746](#L7746) | if( "undefined" == typeof dayString || "undefined" == typeof available\_dates || 0 > available\_dates.indexOf( dayString ) || vm.bpa\_current\_selected\_date == dayId || ("undefined" != typeof vm.v\_calendar\_blocked\_dates && vm.v\_calendar\_blocked\_dates.includes( day.id ) ) ){ |
| [7747](#L7747) | return false; |
| [7748](#L7748) | } |
| [7749](#L7749) | vm.service\_timing = "-2"; |
| [7750](#L7750) | vm.appointment\_step\_form\_data.selected\_date = dayId; |
| [7751](#L7751) | vm.bpa\_current\_selected\_date = dayId; |
| [7752](#L7752) | vm.no\_timeslot\_available = false; |
| [7753](#L7753) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7754](#L7754) | vm.displayResponsiveCalendar = "0"; |
| [7755](#L7755) | } |
| [7756](#L7756) |  |
| [7757](#L7757) | setTimeout(function(){ |
| [7758](#L7758) | vm.service\_timing = vm.bookingpress\_categories\_timeslots( vm.v\_calendar\_timeslots\_data[ dayId ] ); |
| [7759](#L7759) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7760](#L7760) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7761](#L7761) |  |
| [7762](#L7762) | ' . $bookingpress\_after\_selecting\_booking\_service\_data\_updated . ' |
| [7763](#L7763) | },10); |
| [7764](#L7764) |  |
| [7765](#L7765) | }, |
| [7766](#L7766) | dayClicked\_legacy(day) { |
| [7767](#L7767) | const vm = this; |
| [7768](#L7768) | let disable\_dates = vm.v\_calendar\_disable\_dates; |
| [7769](#L7769) | let max\_available\_date = vm.get\_formatted\_date( vm.booking\_cal\_maxdate ); |
| [7770](#L7770) | if( disable\_dates.includes( day.id + " 00:00:00" ) || disable\_dates.includes( day.id ) || max\_available\_date < day.id || (day.date < vm.jsCurrentDateFormatted && false == day.isToday) ){ |
| [7771](#L7771) | return false; |
| [7772](#L7772) | } |
| [7773](#L7773) | vm.appointment\_step\_form\_data.selected\_date = day.id; |
| [7774](#L7774) | vm.get\_date\_timings( day.id ); |
| [7775](#L7775) | }, |
| [7776](#L7776) | get\_date\_timings(current\_selected\_date = ""){ |
| [7777](#L7777) |  |
| [7778](#L7778) | const vm = this; |
| [7779](#L7779) | if( window.innerWidth <= 991 ){ |
| [7780](#L7780) | vm.service\_timing = "-1"; |
| [7781](#L7781) | }else{ |
| [7782](#L7782) | vm.service\_timing = "-2"; |
| [7783](#L7783) | } |
| [7784](#L7784) |  |
| [7785](#L7785) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7786](#L7786) | vm.displayResponsiveCalendar = "0"; |
| [7787](#L7787) | } |
| [7788](#L7788) |  |
| [7789](#L7789) | if( null == vm.appointment\_step\_form\_data.selected\_date ){ |
| [7790](#L7790) | vm.appointment\_step\_form\_data.selected\_date = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [7791](#L7791) | } |
| [7792](#L7792) |  |
| [7793](#L7793) | if( current\_selected\_date == "") { |
| [7794](#L7794) | current\_selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7795](#L7795) | } |
| [7796](#L7796) | vm.appointment\_step\_form\_data.selected\_date = current\_selected\_date; |
| [7797](#L7797) | var selected\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [7798](#L7798) | if( "undefined" != typeof this.$refs.bkp\_front\_calendar ){ |
| [7799](#L7799) | const calendar = this.$refs.bkp\_front\_calendar; |
| [7800](#L7800) | calendar.move(current\_selected\_date); |
| [7801](#L7801) | } |
| [7802](#L7802) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [7803](#L7803) | if( !pattern.test( selected\_date ) ){ |
| [7804](#L7804) |  |
| [7805](#L7805) | let sel\_month = selected\_date.getMonth() + 1; |
| [7806](#L7806) | let sel\_year = selected\_date.getFullYear(); |
| [7807](#L7807) | let sel\_date = selected\_date.getDate(); |
| [7808](#L7808) |  |
| [7809](#L7809) | if( sel\_month < 10 ){ |
| [7810](#L7810) | sel\_month = "0" + sel\_month; |
| [7811](#L7811) | } |
| [7812](#L7812) |  |
| [7813](#L7813) | if( sel\_date < 10 ){ |
| [7814](#L7814) | sel\_date = "0" + sel\_date; |
| [7815](#L7815) | } |
| [7816](#L7816) |  |
| [7817](#L7817) | selected\_date = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [7818](#L7818) | } |
| [7819](#L7819) |  |
| [7820](#L7820) | vm.appointment\_step\_form\_data.selected\_date = selected\_date; |
| [7821](#L7821) |  |
| [7822](#L7822) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [7823](#L7823) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [7824](#L7824) | var selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [7825](#L7825) |  |
| [7826](#L7826) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [7827](#L7827) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [7828](#L7828) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [7829](#L7829) | { |
| [7830](#L7830) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [7831](#L7831) | } |
| [7832](#L7832) | else { |
| [7833](#L7833) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [7834](#L7834) | } |
| [7835](#L7835) |  |
| [7836](#L7836) | var postData = { action:"bookingpress\_front\_get\_timings", service\_id: selected\_service\_id, selected\_date: selected\_date, \_wpnonce:bkp\_wpnonce\_pre\_fetch, }; |
| [7837](#L7837) | ' . $bookingpress\_dynamic\_add\_params\_for\_timeslot\_request . ' |
| [7838](#L7838) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [7839](#L7839) | postData.bpa\_change\_store\_date = false; |
| [7840](#L7840) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [7841](#L7841) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [7842](#L7842) | postData.bpa\_change\_store\_date = true; |
| [7843](#L7843) | } |
| [7844](#L7844) |  |
| [7845](#L7845) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [7846](#L7846) | postData.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [7847](#L7847) | } |
| [7848](#L7848) | vm.no\_timeslot\_available = false; |
| [7849](#L7849) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [7850](#L7850) | .then( function (response) { |
| [7851](#L7851) | var set\_waiting\_time\_limit = 1500; |
| [7852](#L7852) | '.$bookingpress\_after\_timeslot\_data\_load\_for\_single\_date.' |
| [7853](#L7853) | setTimeout(function(){ |
| [7854](#L7854) | vm.service\_timing = response.data; |
| [7855](#L7855) | if( response.data.morning\_time.length <= 0 && response.data.afternoon\_time.length <= 0 && response.data.evening\_time.length <= 0 && response.data.night\_time.length <= 0 ){ |
| [7856](#L7856) | vm.no\_timeslot\_available = true; |
| [7857](#L7857) | } |
| [7858](#L7858) | vm.isLoadTimeLoader = "0"; |
| [7859](#L7859) | if( "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && vm.current\_screen\_size != "desktop"){ |
| [7860](#L7860) | vm.displayResponsiveCalendar = "0"; |
| [7861](#L7861) | } |
| [7862](#L7862) | if(response.data == ""){ |
| [7863](#L7863) | vm.service\_timing = null; |
| [7864](#L7864) | } |
| [7865](#L7865) | }, set\_waiting\_time\_limit); |
| [7866](#L7866) |  |
| [7867](#L7867) | ' . $bookingpress\_after\_selecting\_booking\_service\_data . ' |
| [7868](#L7868) | }.bind(this) ) |
| [7869](#L7869) | .catch( function (error) { |
| [7870](#L7870) | console.log(error); |
| [7871](#L7871) | }); |
| [7872](#L7872) | }, |
| [7873](#L7873) | selectDisableTiming(time\_details){ |
| [7874](#L7874) | '.$bookingpress\_disable\_timeslot\_select\_data.' |
| [7875](#L7875) | }, |
| [7876](#L7876) | selectTiming(selected\_start\_time, selected\_end\_time, store\_start\_time = "", store\_end\_time = "", store\_selected\_date = "" ,formated\_start\_time = "",formated\_end\_time = "",time\_details = ""){ |
| [7877](#L7877) | const vm = this; |
| [7878](#L7878) | vm.appointment\_step\_form\_data.selected\_start\_time = selected\_start\_time; |
| [7879](#L7879) | vm.appointment\_step\_form\_data.selected\_end\_time = selected\_end\_time; |
| [7880](#L7880) |  |
| [7881](#L7881) | if( "" != formated\_end\_time && "" != formated\_start\_time ) { |
| [7882](#L7882) | vm.appointment\_step\_form\_data.selected\_formatted\_start\_time = formated\_start\_time; |
| [7883](#L7883) | vm.appointment\_step\_form\_data.selected\_formatted\_end\_time = formated\_end\_time; |
| [7884](#L7884) | } |
| [7885](#L7885) | if( "" != time\_details.formatted\_start\_end\_time && "undefined" != time\_details.formatted\_start\_end\_time ) { |
| [7886](#L7886) | vm.appointment\_step\_form\_data.selected\_formatted\_start\_end\_time = time\_details.formatted\_start\_end\_time; |
| [7887](#L7887) | } |
| [7888](#L7888) |  |
| [7889](#L7889) | if("" != store\_start\_time && "" != store\_end\_time && "" != store\_selected\_date ){ |
| [7890](#L7890) | vm.appointment\_step\_form\_data.store\_start\_time = store\_start\_time; |
| [7891](#L7891) | vm.appointment\_step\_form\_data.store\_end\_time = store\_end\_time; |
| [7892](#L7892) | vm.appointment\_step\_form\_data.client\_offset = vm.bookingpress\_timezone\_offset; |
| [7893](#L7893) | vm.appointment\_step\_form\_data.store\_selected\_date = store\_selected\_date; |
| [7894](#L7894) | vm.appointment\_step\_form\_data.store\_selected\_end\_date = time\_details.selected\_end\_date || store\_selected\_date; |
| [7895](#L7895) | } |
| [7896](#L7896) |  |
| [7897](#L7897) | vm.appointment\_step\_form\_data.customer\_selected\_date = time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [7898](#L7898) | vm.appointment\_step\_form\_data.customer\_selected\_end\_date = time\_details.client\_end\_date || time\_details.client\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [7899](#L7899) | vm.appointment\_step\_form\_data.customer\_selected\_time = time\_details.client\_start\_time || selected\_start\_time; |
| [7900](#L7900) | vm.appointment\_step\_form\_data.customer\_selected\_end\_time = time\_details.client\_end\_time || selected\_end\_time; |
| [7901](#L7901) |  |
| [7902](#L7902) | '.$bookingpress\_dynamic\_time\_select\_after.' |
| [7903](#L7903) | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
| [7904](#L7904) | vm.bookingpress\_update\_timestep\_token(); |
| [7905](#L7905) | }, |
| [7906](#L7906) | resetForm(){ |
| [7907](#L7907) | const vm2 = this; |
| [7908](#L7908) | vm2.appointment\_formdata.appointment\_selected\_customer = "' . $bookingpress\_current\_user\_id . '"; |
| [7909](#L7909) | vm2.appointment\_formdata.appointment\_selected\_service = ""; |
| [7910](#L7910) | vm2.appointment\_formdata.appointment\_booked\_date = "' . $bookingpress\_current\_date . '"; |
| [7911](#L7911) | vm2.appointment\_formdata.appointment\_booked\_time = ""; |
| [7912](#L7912) | }, |
| [7913](#L7913) | select\_service(selected\_service\_id){ |
| [7914](#L7914) | const vm = this; |
| [7915](#L7915) | vm.appointment\_step\_form\_data.selected\_service = selected\_service\_id; |
| [7916](#L7916) | }, |
| [7917](#L7917) | automatic\_next\_page(next\_tab\_id){ |
| [7918](#L7918) | const vm = this; |
| [7919](#L7919) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.'; |
| [7920](#L7920) | vm.current\_selected\_tab\_id = parseInt(next\_tab\_id); |
| [7921](#L7921) | vm.bookingpress\_remove\_error\_msg(); |
| [7922](#L7922) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [7923](#L7923) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [7924](#L7924) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [7925](#L7925) | window.scrollTo({ |
| [7926](#L7926) | top: bookingpress\_scroll\_position, |
| [7927](#L7927) | }); |
| [7928](#L7928) | }, |
| [7929](#L7929) | next\_page(customer\_form = "", current\_selected\_element = "", next\_selection\_element = ""){ |
| [7930](#L7930) | const vm = this; |
| [7931](#L7931) | var current\_selected\_tab = bpa\_selected\_tab = parseFloat(vm.current\_selected\_tab\_id); |
| [7932](#L7932) | vm.previous\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [7933](#L7933) | if(current\_selected\_element != undefined && current\_selected\_element != null){ |
| [7934](#L7934) | current\_selected\_tab = parseInt(current\_selected\_element); |
| [7935](#L7935) | } |
| [7936](#L7936) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [7937](#L7937) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [7938](#L7938) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [7939](#L7939) | window.scrollTo({ |
| [7940](#L7940) | top: bookingpress\_scroll\_position, |
| [7941](#L7941) | }); |
| [7942](#L7942) |  |
| [7943](#L7943) | if(current\_selected\_tab === 1 || vm.previous\_selected\_tab\_id === 1){ |
| [7944](#L7944) | vm.is\_display\_error = "0"; |
| [7945](#L7945) | if(vm.appointment\_step\_form\_data.selected\_service == "" || vm.appointment\_step\_form\_data.selected\_service == undefined || vm.appointment\_step\_form\_data.selected\_service == "undefined"){ |
| [7946](#L7946) | vm.bookingpress\_set\_error\_msg("' . $no\_service\_selected\_for\_the\_booking . '"); |
| [7947](#L7947) | vm.current\_selected\_tab\_id = 1; |
| [7948](#L7948) | return false; |
| [7949](#L7949) | }else{ |
| [7950](#L7950) | '.$bookingpress\_add\_data\_for\_first\_step\_on\_next\_page.'; |
| [7951](#L7951) | if(next\_selection\_element != ""){ |
| [7952](#L7952) | current\_selected\_tab = next\_selection\_element; |
| [7953](#L7953) | }else{ |
| [7954](#L7954) | current\_selected\_tab = current\_selected\_tab; |
| [7955](#L7955) | } |
| [7956](#L7956) | } |
| [7957](#L7957) | }else if(current\_selected\_tab === 2){ |
| [7958](#L7958) | if(current\_selected\_element != undefined && current\_selected\_element == 2  && vm.appointment\_step\_form\_data.selected\_start\_time == "" && bpa\_selected\_tab == "2" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d") { |
| [7959](#L7959) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7960](#L7960) | vm.current\_selected\_tab\_id = 2; |
| [7961](#L7961) | return false; |
| [7962](#L7962) | } |
| [7963](#L7963) | if(vm.appointment\_step\_form\_data.selected\_service != ""  && vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d") { |
| [7964](#L7964) | vm.selectDate(vm.appointment\_step\_form\_data.selected\_service, vm.appointment\_step\_form\_data.selected\_service\_name, vm.appointment\_step\_form\_data.selected\_service\_price, vm.appointment\_step\_form\_data.service\_price\_without\_currency, "true",vm.appointment\_step\_form\_data.selected\_service\_duration,vm.appointment\_step\_form\_data.selected\_service\_duration\_unit); |
| [7965](#L7965) | } |
| [7966](#L7966) | if(vm.is\_display\_error != "1"){ |
| [7967](#L7967) | if(next\_selection\_element != ""){ |
| [7968](#L7968) | current\_selected\_tab = next\_selection\_element |
| [7969](#L7969) | }else{ |
| [7970](#L7970) | current\_selected\_tab = current\_selected\_tab; |
| [7971](#L7971) | } |
| [7972](#L7972) | vm.bookingpress\_remove\_error\_msg() |
| [7973](#L7973) | }else{ |
| [7974](#L7974) | if(vm.is\_error\_msg == ""){ |
| [7975](#L7975) | vm.bookingpress\_set\_error\_msg("' . esc\_html\_\_('Something went wrong', 'bookingpress-appointment-booking') . '") |
| [7976](#L7976) | } |
| [7977](#L7977) | } |
| [7978](#L7978) | }else if(current\_selected\_tab === 3){ |
| [7979](#L7979) | if(vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.is\_enable\_validations == 1 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [7980](#L7980) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7981](#L7981) | vm.current\_selected\_tab\_id = 2; |
| [7982](#L7982) | return false; |
| [7983](#L7983) | }else{ |
| [7984](#L7984) | vm.$refs[customer\_form].validate((valid) => { |
| [7985](#L7985) | if (valid) { |
| [7986](#L7986) | if(next\_selection\_element != ""){ |
| [7987](#L7987) | current\_selected\_tab = next\_selection\_element |
| [7988](#L7988) | }else{ |
| [7989](#L7989) | current\_selected\_tab = current\_selected\_tab; |
| [7990](#L7990) | } |
| [7991](#L7991) | } |
| [7992](#L7992) | }); |
| [7993](#L7993) | } |
| [7994](#L7994) | }else{ |
| [7995](#L7995) | if(vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.is\_enable\_validations == 1 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [7996](#L7996) | vm.bookingpress\_set\_error\_msg("' . $no\_appointment\_time\_selected\_for\_the\_booking . '"); |
| [7997](#L7997) | vm.current\_selected\_tab\_id = 2; |
| [7998](#L7998) | return false; |
| [7999](#L7999) | } else { |
| [8000](#L8000) | vm.$refs[customer\_form].validate((valid) => { |
| [8001](#L8001) | if (valid) { |
| [8002](#L8002) | if(next\_selection\_element != ""){ |
| [8003](#L8003) | current\_selected\_tab = next\_selection\_element; |
| [8004](#L8004) | }else{ |
| [8005](#L8005) | current\_selected\_tab = current\_selected\_tab; |
| [8006](#L8006) | } |
| [8007](#L8007) | }else{ |
| [8008](#L8008) | current\_selected\_tab = 3; |
| [8009](#L8009) | } |
| [8010](#L8010) | }); |
| [8011](#L8011) | } |
| [8012](#L8012) | } |
| [8013](#L8013) | if(current\_selected\_tab === 2 && vm.appointment\_step\_form\_data.selected\_start\_time == "" && vm.appointment\_step\_form\_data.selected\_date != "" ) { |
| [8014](#L8014) | vm.get\_date\_timings(); |
| [8015](#L8015) | } |
| [8016](#L8016) |  |
| [8017](#L8017) | vm.current\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8018](#L8018) | if(current\_selected\_tab === 2 && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit == "d"){ |
| [8019](#L8019) | vm.next\_selected\_tab\_id = 3; |
| [8020](#L8020) | } |
| [8021](#L8021) |  |
| [8022](#L8022) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.' |
| [8023](#L8023) | }, |
| [8024](#L8024) | previous\_page(previous\_selection\_tab\_id = ""){ |
| [8025](#L8025) | const vm = this; |
| [8026](#L8026) | var current\_selected\_tab = parseFloat(vm.current\_selected\_tab\_id); |
| [8027](#L8027) | if(previous\_selection\_tab\_id != ""){ |
| [8028](#L8028) | current\_selected\_tab = previous\_selection\_tab\_id; |
| [8029](#L8029) | }else{ |
| [8030](#L8030) | vm.previous\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8031](#L8031) | current\_selected\_tab = current\_selected\_tab - 1; |
| [8032](#L8032) | } |
| [8033](#L8033) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.' |
| [8034](#L8034) |  |
| [8035](#L8035) | vm.current\_selected\_tab\_id = parseInt(current\_selected\_tab); |
| [8036](#L8036) | if(vm.previous\_selected\_tab\_id == "1"){ |
| [8037](#L8037) | vm.displayResponsiveCalendar = 1; |
| [8038](#L8038) | } |
| [8039](#L8039) | var bookingpress\_scroll\_pos = document.querySelector("#bookingpress\_booking\_form\_"+vm.appointment\_step\_form\_data.bookingpress\_uniq\_id); |
| [8040](#L8040) | bookingpress\_scroll\_pos = bookingpress\_scroll\_pos.getBoundingClientRect(); |
| [8041](#L8041) | var bookingpress\_scroll\_position = (bookingpress\_scroll\_pos.top + window.scrollY) - 300; |
| [8042](#L8042) | window.scrollTo({ |
| [8043](#L8043) | top: bookingpress\_scroll\_position, |
| [8044](#L8044) | }); |
| [8045](#L8045) | }, |
| [8046](#L8046) | select\_payment\_method(payment\_method){ |
| [8047](#L8047) | const vm = this; |
| [8048](#L8048) |  |
| [8049](#L8049) | vm.appointment\_step\_form\_data.selected\_payment\_method = payment\_method; |
| [8050](#L8050) | var bookingpress\_allowed\_payment\_gateways\_for\_card\_fields = []; |
| [8051](#L8051) | ' . $bookingpress\_after\_selecting\_payment\_method\_data . '; |
| [8052](#L8052) | if(bookingpress\_allowed\_payment\_gateways\_for\_card\_fields.includes(payment\_method)){ |
| [8053](#L8053) | vm.is\_display\_card\_option = 1; |
| [8054](#L8054) | }else{ |
| [8055](#L8055) | vm.is\_display\_card\_option = 0; |
| [8056](#L8056) | } |
| [8057](#L8057) | '.$bookingpress\_after\_selecting\_payment\_method\_data\_booking\_form.' |
| [8058](#L8058) | }, |
| [8059](#L8059) | displayCalendar(){ |
| [8060](#L8060) | const vm = this; |
| [8061](#L8061) | if( "" == vm.appointment\_step\_form\_data.selected\_date ){ |
| [8062](#L8062) | return false; |
| [8063](#L8063) | } |
| [8064](#L8064) | vm.displayResponsiveCalendar = "1"; |
| [8065](#L8065) | }, |
| [8066](#L8066) | Change\_front\_appointment\_description(service\_id) { |
| [8067](#L8067) | const vm = this; |
| [8068](#L8068) | vm.services\_data.forEach(function(item, index, arr){ |
| [8069](#L8069) | if(item.bookingpress\_service\_id == service\_id ){ |
| [8070](#L8070) | if(item.display\_details\_more == 0 && item.display\_details\_less == 1) { |
| [8071](#L8071) | item.display\_details\_less = 0; |
| [8072](#L8072) | item.display\_details\_more = 1; |
| [8073](#L8073) | } else { |
| [8074](#L8074) | item.display\_details\_more = 0; |
| [8075](#L8075) | item.display\_details\_less = 1; |
| [8076](#L8076) | } |
| [8077](#L8077) | } |
| [8078](#L8078) | }); |
| [8079](#L8079) | }, |
| [8080](#L8080) | bookingpress\_phone\_country\_change\_func(bookingpress\_country\_obj){ |
| [8081](#L8081) | const vm = this; |
| [8082](#L8082) | var bookingpress\_selected\_country = bookingpress\_country\_obj.iso2; |
| [8083](#L8083) | vm.appointment\_step\_form\_data.customer\_phone\_country = bookingpress\_selected\_country; |
| [8084](#L8084) | vm.appointment\_step\_form\_data.customer\_phone\_dial\_code = bookingpress\_country\_obj.dialCode; |
| [8085](#L8085) | let exampleNumber = window.intlTelInputUtils.getExampleNumber( bookingpress\_selected\_country, true, 1 ); |
| [8086](#L8086) | if( typeof vm.bookingpress\_phone\_default\_placeholder == "undefined" &&  "" != exampleNumber ){ |
| [8087](#L8087) | vm.bookingpress\_tel\_input\_props.inputOptions.placeholder = exampleNumber; |
| [8088](#L8088) | } else if(vm.bookingpress\_phone\_default\_placeholder == "false" && "" != exampleNumber){ |
| [8089](#L8089) | vm.bookingpress\_tel\_input\_props.inputOptions.placeholder = exampleNumber; |
| [8090](#L8090) | } |
| [8091](#L8091) | }, |
| [8092](#L8092) | bookingpress\_phone\_country\_open( vmodel ){ |
| [8093](#L8093) | const vm = this; |
| [8094](#L8094) | if( "" != vmodel ){ |
| [8095](#L8095) | let elm = document.querySelector(`div[data-tel-id="${vmodel}"]`); |
| [8096](#L8096) | if( null != elm ){ |
| [8097](#L8097) | let parent = vm.bookingpress\_get\_parents( elm, ".el-col" ); |
| [8098](#L8098) | if( 0 < parent.length && null != parent[0] ){ |
| [8099](#L8099) | parent[0].classList.add("bpa-active-col"); |
| [8100](#L8100) | } |
| [8101](#L8101) | } |
| [8102](#L8102) | } |
| [8103](#L8103) | }, |
| [8104](#L8104) | bookingpress\_phone\_country\_close( vmodel ){ |
| [8105](#L8105) | const vm = this; |
| [8106](#L8106) | if( "" != vmodel ){ |
| [8107](#L8107) | let elm = document.querySelector(`div[data-tel-id="${vmodel}"]`); |
| [8108](#L8108) | if( null != elm ){ |
| [8109](#L8109) | let parent = vm.bookingpress\_get\_parents( elm, ".bpa-active-col" ); |
| [8110](#L8110) | if( 0 < parent.length && null != parent[0] ){ |
| [8111](#L8111) | parent[0].classList.remove("bpa-active-col"); |
| [8112](#L8112) | } |
| [8113](#L8113) | } |
| [8114](#L8114) | } |
| [8115](#L8115) | }, |
| [8116](#L8116) | bookingpress\_get\_parents( elem, selector ){ |
| [8117](#L8117) | if (!Element.prototype.matches) { |
| [8118](#L8118) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [8119](#L8119) | Element.prototype.mozMatchesSelector || |
| [8120](#L8120) | Element.prototype.msMatchesSelector || |
| [8121](#L8121) | Element.prototype.oMatchesSelector || |
| [8122](#L8122) | Element.prototype.webkitMatchesSelector || |
| [8123](#L8123) | function(s) { |
| [8124](#L8124) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [8125](#L8125) | i = matches.length; |
| [8126](#L8126) | while (--i >= 0 && matches.item(i) !== this) {} |
| [8127](#L8127) | return i > -1; |
| [8128](#L8128) | }; |
| [8129](#L8129) | } |
| [8130](#L8130) |  |
| [8131](#L8131) | var parents = []; |
| [8132](#L8132) |  |
| [8133](#L8133) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [8134](#L8134) | if (selector) { |
| [8135](#L8135) | if (elem.matches(selector)) { |
| [8136](#L8136) | parents.push(elem); |
| [8137](#L8137) | } |
| [8138](#L8138) | continue; |
| [8139](#L8139) | } |
| [8140](#L8140) | parents.push(elem); |
| [8141](#L8141) | } |
| [8142](#L8142) |  |
| [8143](#L8143) | return parents; |
| [8144](#L8144) | }, |
| [8145](#L8145) | async bookingpress\_disable\_date( bpa\_selected\_service = "", bpa\_selected\_date = "" ){ |
| [8146](#L8146) | '.$bookingpress\_disable\_date\_pre\_xhr\_data.' |
| [8147](#L8147) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8148](#L8148) | if( "true" == use\_legacy ){ |
| [8149](#L8149) | this.bookingpress\_disable\_date\_xhr( bpa\_selected\_service, bpa\_selected\_date ); |
| [8150](#L8150) | } else { |
| [8151](#L8151) | this.bookingpress\_disable\_date\_xhr\_v2( bpa\_selected\_service, bpa\_selected\_date ); |
| [8152](#L8152) | } |
| [8153](#L8153) | }, |
| [8154](#L8154) | bookingpress\_update\_timestep\_token( force\_update = false ){ |
| [8155](#L8155) | const vm = this; |
| [8156](#L8156) |  |
| [8157](#L8157) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8158](#L8158) |  |
| [8159](#L8159) | let current\_tab = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name; |
| [8160](#L8160) |  |
| [8161](#L8161) | if( (true == force\_update && typeof vm.v\_calendar\_time\_token\_data != "undefined") || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
| [8162](#L8162) |  |
| [8163](#L8163) | let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date; |
| [8164](#L8164) | '.$bookingpress\_step\_navigation\_token\_selection\_data.' |
| [8165](#L8165) | let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0]; |
| [8166](#L8166) |  |
| [8167](#L8167) | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
| [8168](#L8168) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8169](#L8169) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8170](#L8170) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8171](#L8171) | }else { |
| [8172](#L8172) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8173](#L8173) | } |
| [8174](#L8174) |  |
| [8175](#L8175) | let postData = { |
| [8176](#L8176) | action: "bpa\_set\_timeslot\_token", |
| [8177](#L8177) | tokenData: selected\_token\_data, |
| [8178](#L8178) | selectedDate: appointment\_selected\_date, |
| [8179](#L8179) | \_wpnonce:bkp\_wpnonce\_pre\_fetch |
| [8180](#L8180) | }; |
| [8181](#L8181) |  |
| [8182](#L8182) | '.$bookingpress\_step\_navigation\_token\_postdata.' |
| [8183](#L8183) |  |
| [8184](#L8184) | vm.is\_bookingpress\_updating\_token = true; |
| [8185](#L8185) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8186](#L8186) | .then( function (response) { |
| [8187](#L8187) | vm.is\_bookingpress\_updating\_token = false; |
| [8188](#L8188) | vm.is\_bookingpress\_token\_updated = true; |
| [8189](#L8189) | }.bind(this) ) |
| [8190](#L8190) | .catch( function (error) { |
| [8191](#L8191) | }); |
| [8192](#L8192) | } |
| [8193](#L8193) | }, |
| [8194](#L8194) | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
| [8195](#L8195) | const vm = this; |
| [8196](#L8196) |  |
| [8197](#L8197) | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
| [8198](#L8198) | let is\_client\_timezone = "'.$convert\_timeslot\_to\_client\_timezone.'"; |
| [8199](#L8199) | let updated\_working\_hour\_details = {}; |
| [8200](#L8200) | let available\_dates = []; |
| [8201](#L8201) | let response = {}; |
| [8202](#L8202) | let firstAvailableDate = ""; |
| [8203](#L8203) |  |
| [8204](#L8204) | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
| [8205](#L8205) |  |
| [8206](#L8206) | let sorted\_working\_hours = []; |
| [8207](#L8207) |  |
| [8208](#L8208) |  |
| [8209](#L8209) | for( let wdate in working\_hour\_details ){ |
| [8210](#L8210) | let x = 0; |
| [8211](#L8211) | let n = 0; |
| [8212](#L8212) |  |
| [8213](#L8213) | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
| [8214](#L8214) |  |
| [8215](#L8215) | let overnight\_booking\_date = ""; |
| [8216](#L8216) |  |
| [8217](#L8217) | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
| [8218](#L8218) |  |
| [8219](#L8219) | sorted\_working\_hours[wdate].sort( (a,b) => { |
| [8220](#L8220) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [8221](#L8221) | } ); |
| [8222](#L8222) |  |
| [8223](#L8223) | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
| [8224](#L8224) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [8225](#L8225) | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
| [8226](#L8226) | let timezone = wh\_data.store\_offset; |
| [8227](#L8227) |  |
| [8228](#L8228) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [8229](#L8229) | wh\_data.client\_start\_time = stTime; |
| [8230](#L8230) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [8231](#L8231) | wh\_data.client\_end\_time = etTime; |
| [8232](#L8232) |  |
| [8233](#L8233) | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
| [8234](#L8234) | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
| [8235](#L8235) |  |
| [8236](#L8236) | let updated\_wdate; |
| [8237](#L8237) | if( "string" == typeof stTimeNew ){ |
| [8238](#L8238) | updated\_wdate = wdate; |
| [8239](#L8239) | } else { |
| [8240](#L8240) | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
| [8241](#L8241) | } |
| [8242](#L8242) | let updated\_edate; |
| [8243](#L8243) | if( "string" == typeof etTimeNew ){ |
| [8244](#L8244) | updated\_edate = wh\_data.selected\_end\_date; |
| [8245](#L8245) | } else { |
| [8246](#L8246) | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
| [8247](#L8247) | } |
| [8248](#L8248) |  |
| [8249](#L8249) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [8250](#L8250) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [8251](#L8251) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8252](#L8252) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [8253](#L8253) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8254](#L8254) | } |
| [8255](#L8255) | n++; |
| [8256](#L8256) | } else { |
| [8257](#L8257) | continue; |
| [8258](#L8258) | } |
| [8259](#L8259) | } else { |
| [8260](#L8260) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [8261](#L8261) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8262](#L8262) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [8263](#L8263) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8264](#L8264) | } |
| [8265](#L8265) | n++; |
| [8266](#L8266) | } |
| [8267](#L8267) | } |
| [8268](#L8268) |  |
| [8269](#L8269) | if( "" == firstAvailableDate ){ |
| [8270](#L8270) | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
| [8271](#L8271) | } |
| [8272](#L8272) |  |
| [8273](#L8273) | wh\_data.client\_date = updated\_wdate; |
| [8274](#L8274) | wh\_data.client\_end\_date = updated\_edate; |
| [8275](#L8275) |  |
| [8276](#L8276) | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
| [8277](#L8277) | overnight\_booking\_date = updated\_wdate; |
| [8278](#L8278) | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
| [8279](#L8279) | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
| [8280](#L8280) | } |
| [8281](#L8281) | } |
| [8282](#L8282) | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
| [8283](#L8283) |  |
| [8284](#L8284) | if( true == is\_overnight\_booking ){ |
| [8285](#L8285) |  |
| [8286](#L8286) | if( "true" == is\_client\_timezone ){ |
| [8287](#L8287) | wh\_data.is\_next\_day = false; |
| [8288](#L8288) | } |
| [8289](#L8289) |  |
| [8290](#L8290) | if( updated\_edate > updated\_wdate ){ |
| [8291](#L8291) | wh\_data.is\_next\_day = true; |
| [8292](#L8292) | } |
| [8293](#L8293) |  |
| [8294](#L8294) | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
| [8295](#L8295) | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
| [8296](#L8296) | wh\_data.is\_next\_day = true; |
| [8297](#L8297) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [8298](#L8298) | } |
| [8299](#L8299) | } |
| [8300](#L8300) |  |
| [8301](#L8301) | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
| [8302](#L8302) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [8303](#L8303) | } |
| [8304](#L8304) |  |
| [8305](#L8305) | let startTimeHour = stTime.split(":")[0]; |
| [8306](#L8306) |  |
| [8307](#L8307) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [8308](#L8308) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [8309](#L8309) |  |
| [8310](#L8310) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8311](#L8311) | if( "1" == timeformat || "2" == timeformat ){ |
| [8312](#L8312) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [8313](#L8313) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [8314](#L8314) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8315](#L8315) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [8316](#L8316) | formatted\_datetime = formatted\_startTime; |
| [8317](#L8317) | } |
| [8318](#L8318) |  |
| [8319](#L8319) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [8320](#L8320) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [8321](#L8321) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [8322](#L8322) | wh\_data.start\_hour = startTimeHour; |
| [8323](#L8323) |  |
| [8324](#L8324) | if( true == is\_overnight\_booking ){ |
| [8325](#L8325) | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
| [8326](#L8326) | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
| [8327](#L8327) | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
| [8328](#L8328) | } |
| [8329](#L8329) | } else { |
| [8330](#L8330) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [8331](#L8331) | } |
| [8332](#L8332) |  |
| [8333](#L8333) | x++; |
| [8334](#L8334) | } |
| [8335](#L8335) | } |
| [8336](#L8336) |  |
| [8337](#L8337) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [8338](#L8338) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [8339](#L8339) |  |
| [8340](#L8340) | response.available\_dates = available\_dates; |
| [8341](#L8341) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [8342](#L8342) | response.selected\_date = firstAvailableDate; |
| [8343](#L8343) |  |
| [8344](#L8344) | return response; |
| [8345](#L8345) | }, |
| [8346](#L8346) | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
| [8347](#L8347) | const vm = this; |
| [8348](#L8348) | let timeformat = "'.$bookigpress\_time\_format\_for\_booking\_form.'"; |
| [8349](#L8349) | let updated\_working\_hour\_details = {}; |
| [8350](#L8350) | let available\_dates = []; |
| [8351](#L8351) | let response = {}; |
| [8352](#L8352) | let firstAvailableDate = ""; |
| [8353](#L8353) | for( let wdate in working\_hour\_details ){ |
| [8354](#L8354) | let x = 0; |
| [8355](#L8355) | let n = 0; |
| [8356](#L8356) |  |
| [8357](#L8357) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [8358](#L8358) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [8359](#L8359) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [8360](#L8360) | let timezone = wh\_data.store\_offset; |
| [8361](#L8361) |  |
| [8362](#L8362) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [8363](#L8363) | wh\_data.client\_start\_time = stTime; |
| [8364](#L8364) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [8365](#L8365) | wh\_data.client\_end\_time = etTime; |
| [8366](#L8366) |  |
| [8367](#L8367) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [8368](#L8368) | let updated\_edate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wh\_data.selected\_end\_date, wh\_data ); |
| [8369](#L8369) |  |
| [8370](#L8370) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [8371](#L8371) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [8372](#L8372) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8373](#L8373) |  |
| [8374](#L8374) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8375](#L8375) | n++; |
| [8376](#L8376) | } else { |
| [8377](#L8377) | continue; |
| [8378](#L8378) | } |
| [8379](#L8379) | } else { |
| [8380](#L8380) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [8381](#L8381) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [8382](#L8382) |  |
| [8383](#L8383) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [8384](#L8384) | n++; |
| [8385](#L8385) | } |
| [8386](#L8386) | } |
| [8387](#L8387) |  |
| [8388](#L8388) |  |
| [8389](#L8389) | if( "" == firstAvailableDate ){ |
| [8390](#L8390) | firstAvailableDate = updated\_wdate; |
| [8391](#L8391) | } |
| [8392](#L8392) |  |
| [8393](#L8393) | wh\_data.client\_date = updated\_wdate; |
| [8394](#L8394) | wh\_data.client\_end\_date = updated\_edate; |
| [8395](#L8395) |  |
| [8396](#L8396) | let startTimeHour = stTime.split(":")[0]; |
| [8397](#L8397) |  |
| [8398](#L8398) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [8399](#L8399) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [8400](#L8400) |  |
| [8401](#L8401) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8402](#L8402) | if( "1" == timeformat || "2" == timeformat ){ |
| [8403](#L8403) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [8404](#L8404) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [8405](#L8405) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [8406](#L8406) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [8407](#L8407) | formatted\_datetime = formatted\_startTime; |
| [8408](#L8408) | } |
| [8409](#L8409) |  |
| [8410](#L8410) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [8411](#L8411) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [8412](#L8412) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [8413](#L8413) | wh\_data.start\_hour = startTimeHour; |
| [8414](#L8414) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [8415](#L8415) | x++; |
| [8416](#L8416) | } |
| [8417](#L8417) | } |
| [8418](#L8418) |  |
| [8419](#L8419) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [8420](#L8420) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [8421](#L8421) |  |
| [8422](#L8422) | response.available\_dates = available\_dates; |
| [8423](#L8423) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [8424](#L8424) | response.selected\_date = firstAvailableDate; |
| [8425](#L8425) |  |
| [8426](#L8426) | return response; |
| [8427](#L8427) | }, |
| [8428](#L8428) | bookingpress\_disable\_date\_xhr\_v2( bpa\_selected\_service = "", bpa\_selected\_date = "", showLoader = true ){ |
| [8429](#L8429) | const vm = this; |
| [8430](#L8430) |  |
| [8431](#L8431) | if( true == showLoader ){ |
| [8432](#L8432) | vm.isLoadTimeLoader = "1"; |
| [8433](#L8433) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8434](#L8434) | }; |
| [8435](#L8435) |  |
| [8436](#L8436) | let preselect\_date = false; |
| [8437](#L8437) | if( "" != bpa\_selected\_date ){ |
| [8438](#L8438) | preselect\_date = true; |
| [8439](#L8439) | } |
| [8440](#L8440) |  |
| [8441](#L8441) | if( "" == bpa\_selected\_date ){ |
| [8442](#L8442) | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
| [8443](#L8443) | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
| [8444](#L8444) | } |
| [8445](#L8445) |  |
| [8446](#L8446) | vm.service\_timing = "-3"; |
| [8447](#L8447) |  |
| [8448](#L8448) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8449](#L8449) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8450](#L8450) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8451](#L8451) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8452](#L8452) | } else { |
| [8453](#L8453) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8454](#L8454) | } |
| [8455](#L8455) |  |
| [8456](#L8456) | if( "" == bpa\_selected\_service && "" != vm.appointment\_step\_form\_data.selected\_service ){ |
| [8457](#L8457) | bpa\_selected\_service = vm.appointment\_step\_form\_data.selected\_service; |
| [8458](#L8458) | } |
| [8459](#L8459) |  |
| [8460](#L8460) | if( typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" || vm.appointment\_step\_form\_data.cart\_items.length == 0 ){ |
| [8461](#L8461) | vm.appointment\_step\_form\_data.bookingpress\_form\_token = vm.appointment\_step\_form\_data.bookingpress\_uniq\_id + "\_" + ( Math.random().toString(36).slice(2) ); |
| [8462](#L8462) | } |
| [8463](#L8463) |  |
| [8464](#L8464) | let startTime = new Date().getTime(); |
| [8465](#L8465) |  |
| [8466](#L8466) | var postData = { action: "bookingpress\_fetch\_timeslot\_data", service\_id: bpa\_selected\_service, selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, is\_preselect: preselect\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [8467](#L8467) |  |
| [8468](#L8468) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8469](#L8469) |  |
| [8470](#L8470) | vm.no\_timeslot\_available = false; |
| [8471](#L8471) | vm.v\_calendar\_check\_month\_dates = false; |
| [8472](#L8472) | vm.v\_calendar\_next\_month\_dates; |
| [8473](#L8473) | vm.days\_off\_disabled\_dates = ""; |
| [8474](#L8474) | '.$bookingpress\_disable\_date\_send\_data.'; |
| [8475](#L8475) |  |
| [8476](#L8476) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8477](#L8477) | .then( function (response) { |
| [8478](#L8478) |  |
| [8479](#L8479) | let request\_time = new Date().getTime() - startTime; |
| [8480](#L8480) |  |
| [8481](#L8481) | '.$bookingpress\_disable\_date\_vue\_data.' |
| [8482](#L8482) | let working\_hour\_details = response.data.working\_details; |
| [8483](#L8483) |  |
| [8484](#L8484) | let selectedDate = response.data.selected\_date; |
| [8485](#L8485) |  |
| [8486](#L8486) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8487](#L8487) | let preselected\_date = ""; |
| [8488](#L8488) |  |
| [8489](#L8489) | if( "undefined" != typeof response.data.pre\_selected\_date && true == response.data.pre\_selected\_date ){ |
| [8490](#L8490) | preselected\_date = response.data.selected\_date; |
| [8491](#L8491) | } |
| [8492](#L8492) |  |
| [8493](#L8493) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [8494](#L8494) | vm.appointment\_step\_form\_data.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [8495](#L8495) | } |
| [8496](#L8496) |  |
| [8497](#L8497) | vm.appointment\_step\_form\_data.selected\_date = ""; |
| [8498](#L8498) | selectedDate = ( "" != preselected\_date ) ? preselected\_date : ( wh\_details.selected\_date || selectedDate ); |
| [8499](#L8499) |  |
| [8500](#L8500) | vm.v\_calendar\_available\_dates = wh\_details.available\_dates; |
| [8501](#L8501) | vm.v\_calendar\_timeslots\_data = wh\_details.updated\_working\_hour\_details; |
| [8502](#L8502) | vm.no\_timeslot\_available = false; |
| [8503](#L8503) | let v\_available\_dates\_only = []; |
| [8504](#L8504) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8505](#L8505) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8506](#L8506) | }); |
| [8507](#L8507) | if( !v\_available\_dates\_only.includes( selectedDate ) && wh\_details.selected\_date != selectedDate ){ |
| [8508](#L8508) | selectedDate = wh\_details.selected\_date; |
| [8509](#L8509) | } |
| [8510](#L8510) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8511](#L8511) |  |
| [8512](#L8512) | if( "undefined" != typeof selectedDate ){ |
| [8513](#L8513) | (function( $ref\_ ){ |
| [8514](#L8514) | setTimeout(function(){ |
| [8515](#L8515) | vm.appointment\_step\_form\_data.selected\_date = selectedDate; |
| [8516](#L8516) | vm.bookingpress\_select\_multi\_day\_range(); |
| [8517](#L8517) | if( "undefined" != typeof $ref\_.bkp\_front\_calendar ){ |
| [8518](#L8518) | const calendar = $ref\_.bkp\_front\_calendar; |
| [8519](#L8519) | try{ |
| [8520](#L8520) | calendar.move( selectedDate ); |
| [8521](#L8521) | } catch( e ){ |
| [8522](#L8522) | console.log( e ); |
| [8523](#L8523) | } |
| [8524](#L8524) | } |
| [8525](#L8525) | if( "undefined" != typeof $ref\_.bkp\_front\_calendar\_responsive ){ |
| [8526](#L8526) | const calendar\_r = $ref\_.bkp\_front\_calendar\_responsive; |
| [8527](#L8527) | try{ |
| [8528](#L8528) | calendar\_r.move( selectedDate ); |
| [8529](#L8529) | } catch( e ){ |
| [8530](#L8530) | console.log( e ); |
| [8531](#L8531) | } |
| [8532](#L8532) | } |
| [8533](#L8533) | },10); |
| [8534](#L8534) | })( this.$refs ); |
| [8535](#L8535) | } |
| [8536](#L8536) |  |
| [8537](#L8537) | /\* V-date-picker attributes \*/ |
| [8538](#L8538) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8539](#L8539) |  |
| [8540](#L8540) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8541](#L8541) | let vcal\_attr\_data = []; |
| [8542](#L8542) | let vcal\_attr\_data\_current = {}; |
| [8543](#L8543) | let k = 1; |
| [8544](#L8544) |  |
| [8545](#L8545) | for( let vcal\_date in vcal\_attributes ){ |
| [8546](#L8546) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8547](#L8547) |  |
| [8548](#L8548) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8549](#L8549) |  |
| [8550](#L8550) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8551](#L8551) | let vcal\_attr\_obj = { |
| [8552](#L8552) | key: k, |
| [8553](#L8553) | dates: vcal\_date, |
| [8554](#L8554) | customData:{ |
| [8555](#L8555) | title: vcal\_data |
| [8556](#L8556) | } |
| [8557](#L8557) | }; |
| [8558](#L8558) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8559](#L8559) | k++; |
| [8560](#L8560) | } |
| [8561](#L8561) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8562](#L8562) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8563](#L8563) | } |
| [8564](#L8564) |  |
| [8565](#L8565) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8566](#L8566) |  |
| [8567](#L8567) | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
| [8568](#L8568) | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
| [8569](#L8569) | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
| [8570](#L8570) | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
| [8571](#L8571) |  |
| [8572](#L8572) | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8573](#L8573) |  |
| [8574](#L8574) | if( "0" == vcal\_data\_v2 ){ |
| [8575](#L8575) | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
| [8576](#L8576) | } |
| [8577](#L8577) | } |
| [8578](#L8578) | } |
| [8579](#L8579) |  |
| [8580](#L8580) | /\* V-date-picker attributes \*/ |
| [8581](#L8581) |  |
| [8582](#L8582) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8583](#L8583) | vm.v\_calendar\_time\_token\_data = response.data.working\_hour\_timing\_token; |
| [8584](#L8584) | if( "undefined" != typeof wh\_details.updated\_working\_hour\_details[ selectedDate ] ){ |
| [8585](#L8585) | vm.service\_timing = vm.bookingpress\_categories\_timeslots( wh\_details.updated\_working\_hour\_details[ selectedDate ] ); |
| [8586](#L8586) | } else { |
| [8587](#L8587) |  |
| [8588](#L8588) | vm.service\_timing = { |
| [8589](#L8589) | "morning\_time":[], |
| [8590](#L8590) | "afternoon\_time":[], |
| [8591](#L8591) | "evening\_time":[], |
| [8592](#L8592) | "night\_time":[] |
| [8593](#L8593) | }; |
| [8594](#L8594) | vm.no\_timeslot\_available = true; |
| [8595](#L8595) | } |
| [8596](#L8596) | if( vm.current\_screen\_size != "desktop" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [8597](#L8597) | vm.displayResponsiveCalendar = 0; |
| [8598](#L8598) | } |
| [8599](#L8599) | vm.isLoadTimeLoader = "0"; |
| [8600](#L8600) | vm.isLoadDateTimeCalendarLoad = "0"; |
| [8601](#L8601) | if( "undefined" == typeof response.data.stop\_check || false == response.data.stop\_check ){ |
| [8602](#L8602) | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, 1 ); |
| [8603](#L8603) | } |
| [8604](#L8604) |  |
| [8605](#L8605) | if( "undefined" != typeof vm.is\_bookingpress\_token\_updated && true == vm.is\_bookingpress\_token\_updated ){ |
| [8606](#L8606) | vm.bookingpress\_update\_timestep\_token( true ); |
| [8607](#L8607) | } |
| [8608](#L8608) |  |
| [8609](#L8609) | '.$bookingpress\_disable\_date\_vue\_data\_after.' |
| [8610](#L8610) | }.bind(this) ) |
| [8611](#L8611) | .catch( function (error) { |
| [8612](#L8612) | console.log(error); |
| [8613](#L8613) | }); |
| [8614](#L8614) | }, |
| [8615](#L8615) | bookingpress\_retrieve\_future\_month\_details( next\_month\_date = "", counter = 1 ){ |
| [8616](#L8616) | const vm = this; |
| [8617](#L8617) | let startDate = next\_month\_date != "" ? next\_month\_date : vm.v\_calendar\_available\_dates.at(-1); |
| [8618](#L8618) |  |
| [8619](#L8619) | if( 4 == counter ){ |
| [8620](#L8620) | vm.v\_calendar\_check\_month\_dates = true; |
| [8621](#L8621) | vm.v\_calendar\_next\_month\_dates = next\_month\_date; |
| [8622](#L8622) | vm.isHoldBookingRequest = false; |
| [8623](#L8623) | return false; |
| [8624](#L8624) | } else { |
| [8625](#L8625) | vm.isHoldBookingRequest = true; |
| [8626](#L8626) | } |
| [8627](#L8627) |  |
| [8628](#L8628) | let postData = { |
| [8629](#L8629) | action: "bookingpress\_retrieve\_entire\_month\_details", |
| [8630](#L8630) | from\_date: startDate, |
| [8631](#L8631) | counter: counter |
| [8632](#L8632) | }; |
| [8633](#L8633) |  |
| [8634](#L8634) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8635](#L8635) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8636](#L8636) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8637](#L8637) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8638](#L8638) | } else { |
| [8639](#L8639) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8640](#L8640) | } |
| [8641](#L8641) |  |
| [8642](#L8642) | postData.\_wpnonce = bkp\_wpnonce\_pre; |
| [8643](#L8643) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8644](#L8644) |  |
| [8645](#L8645) | '.$bookingpress\_disable\_future\_date\_send\_data.' |
| [8646](#L8646) |  |
| [8647](#L8647) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8648](#L8648) | .then( function (response) { |
| [8649](#L8649) | '.$bookingpress\_disable\_future\_vue\_data.' |
| [8650](#L8650) | let working\_hour\_details = response.data.working\_details |
| [8651](#L8651) |  |
| [8652](#L8652) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8653](#L8653) | vm.v\_calendar\_available\_dates = vm.v\_calendar\_available\_dates.concat( wh\_details.available\_dates ); |
| [8654](#L8654) | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
| [8655](#L8655) | let v\_available\_dates\_only = []; |
| [8656](#L8656) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8657](#L8657) |  |
| [8658](#L8658) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8659](#L8659) | let vcal\_attr\_data = []; |
| [8660](#L8660) | let vcal\_attr\_data\_current = {}; |
| [8661](#L8661) | let k = 1; |
| [8662](#L8662) |  |
| [8663](#L8663) | for( let vcal\_date in vcal\_attributes ){ |
| [8664](#L8664) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8665](#L8665) |  |
| [8666](#L8666) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8667](#L8667) |  |
| [8668](#L8668) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8669](#L8669) | let vcal\_attr\_obj = { |
| [8670](#L8670) | key: k, |
| [8671](#L8671) | dates: vcal\_date, |
| [8672](#L8672) | customData:{ |
| [8673](#L8673) | title: vcal\_data |
| [8674](#L8674) | } |
| [8675](#L8675) | }; |
| [8676](#L8676) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8677](#L8677) | k++; |
| [8678](#L8678) | } |
| [8679](#L8679) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8680](#L8680) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8681](#L8681) | } |
| [8682](#L8682) |  |
| [8683](#L8683) | let vcal\_capacity\_attrs = response.data.vcal\_capacity\_attrs; |
| [8684](#L8684) | if( "undefined" != typeof vcal\_capacity\_attrs && vcal\_capacity\_attrs.length != "" ){ |
| [8685](#L8685) | for( let vcal\_date\_v2 in vcal\_capacity\_attrs ){ |
| [8686](#L8686) | let vcal\_data\_v2 = vcal\_capacity\_attrs[ vcal\_date\_v2 ]; |
| [8687](#L8687) |  |
| [8688](#L8688) | vcal\_date\_v2 = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date\_v2, {"store\_service\_date":vcal\_date\_v2,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8689](#L8689) |  |
| [8690](#L8690) | if( "0" == vcal\_data\_v2 ){ |
| [8691](#L8691) | vm.v\_calendar\_blocked\_dates.push( vcal\_date\_v2 ); |
| [8692](#L8692) | } |
| [8693](#L8693) | } |
| [8694](#L8694) | } |
| [8695](#L8695) |  |
| [8696](#L8696) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8697](#L8697) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8698](#L8698) | }); |
| [8699](#L8699) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8700](#L8700) | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
| [8701](#L8701) | vm.isLoadDateTimeCalendarLoad = 0; |
| [8702](#L8702) | ++counter; |
| [8703](#L8703) | counter = wp.hooks.applyFilters( "bookingpress\_modify\_next\_month\_check\_counter", counter, response.data ); |
| [8704](#L8704) | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, counter ); |
| [8705](#L8705) | '.$bookingpress\_disable\_future\_vue\_data\_after.' |
| [8706](#L8706) | }.bind(this) ) |
| [8707](#L8707) | .catch( function (error) { |
| [8708](#L8708) | console.log(error); |
| [8709](#L8709) | }); |
| [8710](#L8710) | }, |
| [8711](#L8711) | bookingpress\_retrieve\_future\_month\_details\_single( next\_month\_date = "", next\_month\_dates = "", counter = 1 ){ |
| [8712](#L8712) | const vm = this; |
| [8713](#L8713) | let startDate = next\_month\_date != "" ? next\_month\_date : vm.v\_calendar\_available\_dates.at(-1); |
| [8714](#L8714) |  |
| [8715](#L8715) | vm.v\_calendar\_check\_month\_dates = true; |
| [8716](#L8716) | vm.v\_calendar\_next\_month\_dates = next\_month\_date; |
| [8717](#L8717) | vm.isHoldBookingRequest = false; |
| [8718](#L8718) |  |
| [8719](#L8719) | let postData = { |
| [8720](#L8720) | action: "bookingpress\_retrieve\_entire\_month\_details", |
| [8721](#L8721) | from\_date: startDate, |
| [8722](#L8722) | counter: counter |
| [8723](#L8723) | }; |
| [8724](#L8724) |  |
| [8725](#L8725) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8726](#L8726) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8727](#L8727) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8728](#L8728) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8729](#L8729) | } else { |
| [8730](#L8730) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8731](#L8731) | } |
| [8732](#L8732) |  |
| [8733](#L8733) | postData.\_wpnonce = bkp\_wpnonce\_pre; |
| [8734](#L8734) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8735](#L8735) |  |
| [8736](#L8736) | '.$bookingpress\_disable\_future\_date\_send\_data.' |
| [8737](#L8737) |  |
| [8738](#L8738) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8739](#L8739) | .then( function (response) { |
| [8740](#L8740) | '.$bookingpress\_disable\_future\_vue\_data.' |
| [8741](#L8741) | let working\_hour\_details = response.data.working\_details |
| [8742](#L8742) |  |
| [8743](#L8743) | let wh\_details = vm.bookingpress\_working\_dates\_data( working\_hour\_details, response.data ); |
| [8744](#L8744) | vm.v\_calendar\_available\_dates = vm.v\_calendar\_available\_dates.concat( wh\_details.available\_dates ); |
| [8745](#L8745) | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
| [8746](#L8746) | let v\_available\_dates\_only = []; |
| [8747](#L8747) | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
| [8748](#L8748) | v\_available\_dates\_only.push( i.split(" ")[0] ); |
| [8749](#L8749) | }); |
| [8750](#L8750) |  |
| [8751](#L8751) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8752](#L8752) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8753](#L8753) | let vcal\_attr\_data = []; |
| [8754](#L8754) | let vcal\_attr\_data\_current = {}; |
| [8755](#L8755) | let k = 1; |
| [8756](#L8756) |  |
| [8757](#L8757) | for( let vcal\_date in vcal\_attributes ){ |
| [8758](#L8758) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8759](#L8759) |  |
| [8760](#L8760) | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
| [8761](#L8761) |  |
| [8762](#L8762) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8763](#L8763) | let vcal\_attr\_obj = { |
| [8764](#L8764) | key: k, |
| [8765](#L8765) | dates: vcal\_date, |
| [8766](#L8766) | customData:{ |
| [8767](#L8767) | title: vcal\_data |
| [8768](#L8768) | } |
| [8769](#L8769) | }; |
| [8770](#L8770) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8771](#L8771) | k++; |
| [8772](#L8772) | } |
| [8773](#L8773) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8774](#L8774) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8775](#L8775) | } |
| [8776](#L8776) | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
| [8777](#L8777) | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
| [8778](#L8778) | vm.isLoadDateTimeCalendarLoad = 0; |
| [8779](#L8779) | vm.bookingpress\_retrieve\_future\_month\_details( next\_month\_dates, counter ); |
| [8780](#L8780) | '.$bookingpress\_disable\_future\_vue\_data\_after.' |
| [8781](#L8781) | }.bind(this) ) |
| [8782](#L8782) | .catch( function (error) { |
| [8783](#L8783) | console.log(error); |
| [8784](#L8784) | }); |
| [8785](#L8785) | }, |
| [8786](#L8786) | bookingpress\_format\_time(value){ |
| [8787](#L8787) | var default\_time\_format = "'.esc\_html($bookingpress\_formatted\_timeslot).'"; |
| [8788](#L8788) | return moment(String(value), "HH:mm:ss").locale("' . esc\_html( $bookingpress\_site\_current\_lang\_moment\_locale ) . '").format(default\_time\_format) |
| [8789](#L8789) | }, |
| [8790](#L8790) | bookingpress\_categories\_timeslots( timeslot\_details ){ |
| [8791](#L8791) |  |
| [8792](#L8792) | let afternoon\_slot\_timings = parseInt( "'.$bpa\_afternoon\_solts\_timing.'" ); |
| [8793](#L8793) | let evening\_slot\_timings = parseInt( "'.$bpa\_evening\_solts\_timing.'" ); |
| [8794](#L8794) | let night\_slot\_timings = parseInt( "'.$bpa\_night\_solts\_timing.'" ); |
| [8795](#L8795) |  |
| [8796](#L8796) | if( "undefined" == typeof timeslot\_details ){ |
| [8797](#L8797) | return {}; |
| [8798](#L8798) | } |
| [8799](#L8799) |  |
| [8800](#L8800) | let service\_timings\_data = { |
| [8801](#L8801) | "morning\_time":[], |
| [8802](#L8802) | "afternoon\_time":[], |
| [8803](#L8803) | "evening\_time":[], |
| [8804](#L8804) | "night\_time":[] |
| [8805](#L8805) | }; |
| [8806](#L8806) | let x = 0; |
| [8807](#L8807) | for( let timeslot\_data of timeslot\_details ){ |
| [8808](#L8808) | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
| [8809](#L8809) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [8810](#L8810) | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
| [8811](#L8811) | service\_timings\_data.morning\_time.push( timeslot\_data ); |
| [8812](#L8812) | } else if( startHour >= afternoon\_slot\_timings && ( "" == evening\_slot\_timings || startHour < evening\_slot\_timings ) ){ |
| [8813](#L8813) | service\_timings\_data.afternoon\_time.push( timeslot\_data ); |
| [8814](#L8814) | } else if ( startHour >= evening\_slot\_timings && ( "" == night\_slot\_timings || startHour < night\_slot\_timings ) ){ |
| [8815](#L8815) | service\_timings\_data.evening\_time.push( timeslot\_data ); |
| [8816](#L8816) | } else { |
| [8817](#L8817) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [8818](#L8818) | } |
| [8819](#L8819) | x++; |
| [8820](#L8820) | } |
| [8821](#L8821) | } |
| [8822](#L8822) | if( timeslot\_details.length > x ){ |
| [8823](#L8823) | for( let timeslot\_data of timeslot\_details ){ |
| [8824](#L8824) | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
| [8825](#L8825) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [8826](#L8826) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [8827](#L8827) | } |
| [8828](#L8828) | } |
| [8829](#L8829) | } |
| [8830](#L8830) | let night\_time = service\_timings\_data.night\_time; |
| [8831](#L8831) | let night\_time\_sorted = []; |
| [8832](#L8832) | for( let x in night\_time ){ |
| [8833](#L8833) | night\_time\_sorted.push( night\_time[x] ); |
| [8834](#L8834) | } |
| [8835](#L8835) |  |
| [8836](#L8836) | night\_time\_sorted.sort( (a,b) => { |
| [8837](#L8837) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [8838](#L8838) | } ); |
| [8839](#L8839) | service\_timings\_data.night\_time = night\_time\_sorted; |
| [8840](#L8840) |  |
| [8841](#L8841) | return service\_timings\_data; |
| [8842](#L8842) | }, |
| [8843](#L8843) | bookingpress\_disable\_date\_xhr( bpa\_selected\_service = "", bpa\_selected\_date = "", showLoader = true ){ |
| [8844](#L8844) |  |
| [8845](#L8845) | const vm = this; |
| [8846](#L8846) |  |
| [8847](#L8847) | if( true == showLoader ){ |
| [8848](#L8848) | vm.isLoadTimeLoader = "1"; |
| [8849](#L8849) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8850](#L8850) | } |
| [8851](#L8851) |  |
| [8852](#L8852) | vm.service\_timing = "-3"; |
| [8853](#L8853) |  |
| [8854](#L8854) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [8855](#L8855) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [8856](#L8856) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
| [8857](#L8857) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [8858](#L8858) | } else { |
| [8859](#L8859) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [8860](#L8860) | } |
| [8861](#L8861) |  |
| [8862](#L8862) | if( "" == bpa\_selected\_service && "" != vm.appointment\_step\_form\_data.selected\_service ){ |
| [8863](#L8863) | bpa\_selected\_service = vm.appointment\_step\_form\_data.selected\_service; |
| [8864](#L8864) | } |
| [8865](#L8865) |  |
| [8866](#L8866) | if( "undefined" != typeof vm.bookingpress\_dst\_timezone ){ |
| [8867](#L8867) | vm.appointment\_step\_form\_data.client\_dst\_timezone = vm.bookingpress\_dst\_timezone; |
| [8868](#L8868) | } |
| [8869](#L8869) |  |
| [8870](#L8870) | if( typeof vm.appointment\_step\_form\_data.cart\_items == "undefined" || vm.appointment\_step\_form\_data.cart\_items.length == 0 ){ |
| [8871](#L8871) | vm.appointment\_step\_form\_data.bookingpress\_form\_token = vm.appointment\_step\_form\_data.bookingpress\_uniq\_id + "\_" + ( Math.random().toString(36).slice(2) ); |
| [8872](#L8872) | } |
| [8873](#L8873) |  |
| [8874](#L8874) | var postData = { action: "bookingpress\_get\_disable\_date", service\_id: bpa\_selected\_service, selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [8875](#L8875) |  |
| [8876](#L8876) | postData.disabled\_dates = JSON.stringify( vm.v\_calendar\_disable\_dates ); |
| [8877](#L8877) |  |
| [8878](#L8878) | postData.appointment\_data\_obj = JSON.stringify(vm.appointment\_step\_form\_data); |
| [8879](#L8879) |  |
| [8880](#L8880) | postData.bpa\_change\_store\_date = false; |
| [8881](#L8881) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [8882](#L8882) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [8883](#L8883) | postData.bpa\_change\_store\_date = true; |
| [8884](#L8884) | } |
| [8885](#L8885) |  |
| [8886](#L8886) | vm.no\_timeslot\_available = false; |
| [8887](#L8887) | vm.v\_calendar\_check\_month\_dates = false; |
| [8888](#L8888) | vm.v\_calendar\_next\_month\_dates = {}; |
| [8889](#L8889) | vm.days\_off\_disabled\_dates = ""; |
| [8890](#L8890) | '.$bookingpress\_disable\_date\_send\_data.'; |
| [8891](#L8891) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [8892](#L8892) | .then( function (response) |
| [8893](#L8893) | { |
| [8894](#L8894) | vm.service\_timing = []; |
| [8895](#L8895) | if(response.data.variant == "success" && (response.data.selected\_date != undefined && response.data.days\_off\_disabled\_dates != undefined)){ |
| [8896](#L8896) | '.$bookingpress\_disable\_date\_vue\_data.' |
| [8897](#L8897) | vm.days\_off\_disabled\_dates = ""; |
| [8898](#L8898) |  |
| [8899](#L8899) | /\*V-Calendar disabled dates change start\*/ |
| [8900](#L8900) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [8901](#L8901) | vm.v\_calendar\_disable\_dates = []; |
| [8902](#L8902) | for( let temp\_date in bpa\_disable\_date ){ |
| [8903](#L8903) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [8904](#L8904) | if( "string" != typeof disabled\_date){ |
| [8905](#L8905) | continue; |
| [8906](#L8906) | } |
| [8907](#L8907) |  |
| [8908](#L8908) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [8909](#L8909) | let disable\_date\_data = disabled\_date.split(" "); |
| [8910](#L8910) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [8911](#L8911) | } else { |
| [8912](#L8912) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [8913](#L8913) | } |
| [8914](#L8914) | } |
| [8915](#L8915) | /\*V-Calendar disabled dates change end\*/ |
| [8916](#L8916) |  |
| [8917](#L8917) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [8918](#L8918) | let pro\_version = "'.$bookingpress\_use\_pro\_legacy.'"; |
| [8919](#L8919) |  |
| [8920](#L8920) | if( "true" == use\_legacy && "false" == pro\_version ){ |
| [8921](#L8921) | let min\_date = vm.jsCurrentDate; |
| [8922](#L8922) | let max\_date = vm.booking\_cal\_maxdate; |
| [8923](#L8923) |  |
| [8924](#L8924) | let loop = new Date( min\_date ); |
| [8925](#L8925) | let available\_dates = []; |
| [8926](#L8926) | while( loop <= max\_date ){ |
| [8927](#L8927) | let dt = loop.toISOString().split("T")[0] + " 00:00:00"; |
| [8928](#L8928) |  |
| [8929](#L8929) | if( dt.indexOf( vm.v\_calendar\_disable\_dates ) == -1 ){ |
| [8930](#L8930) | available\_dates.push( dt ); |
| [8931](#L8931) | } |
| [8932](#L8932) |  |
| [8933](#L8933) | loop.setDate( loop.getDate() + 1 ); |
| [8934](#L8934) | } |
| [8935](#L8935) | vm.v\_calendar\_available\_dates = available\_dates; |
| [8936](#L8936) | } |
| [8937](#L8937) |  |
| [8938](#L8938) | let resp\_selected\_date = response.data.selected\_date; |
| [8939](#L8939) |  |
| [8940](#L8940) | if( vm.current\_screen\_size != "desktop" && vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [8941](#L8941) | vm.displayResponsiveCalendar = 0; |
| [8942](#L8942) | } |
| [8943](#L8943) |  |
| [8944](#L8944) | /\* V-date-picker attributes \*/ |
| [8945](#L8945) | let vcal\_attributes = response.data.vcal\_attributes; |
| [8946](#L8946) |  |
| [8947](#L8947) | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
| [8948](#L8948) | let vcal\_attr\_data = []; |
| [8949](#L8949) | let vcal\_attr\_data\_current = {}; |
| [8950](#L8950) | let k = 1; |
| [8951](#L8951) | for( let vcal\_date in vcal\_attributes ){ |
| [8952](#L8952) | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
| [8953](#L8953) | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
| [8954](#L8954) | let vcal\_attr\_obj = { |
| [8955](#L8955) | key: k, |
| [8956](#L8956) | dates: vcal\_date, |
| [8957](#L8957) | customData:{ |
| [8958](#L8958) | title: vcal\_data |
| [8959](#L8959) | } |
| [8960](#L8960) | }; |
| [8961](#L8961) | vcal\_attr\_data.push( vcal\_attr\_obj ); |
| [8962](#L8962) | k++; |
| [8963](#L8963) | } |
| [8964](#L8964) | vm.v\_calendar\_attributes = vcal\_attr\_data; |
| [8965](#L8965) | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
| [8966](#L8966) | } |
| [8967](#L8967) |  |
| [8968](#L8968) | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
| [8969](#L8969) | /\* V-date-picker attributes \*/ |
| [8970](#L8970) |  |
| [8971](#L8971) | vm.days\_off\_disabled\_dates = response.data.days\_off\_disabled\_dates; |
| [8972](#L8972) | vm.appointment\_step\_form\_data.selected\_date = response.data.selected\_date; |
| [8973](#L8973) | vm.bookingpress\_select\_multi\_day\_range(); |
| [8974](#L8974) | if( "undefined" != typeof response.data.front\_timings ){ |
| [8975](#L8975) | vm.service\_timing = response.data.front\_timings; |
| [8976](#L8976) |  |
| [8977](#L8977) | if( response.data.front\_timings.length <= 0 ){ |
| [8978](#L8978) | vm.no\_timeslot\_available = true; |
| [8979](#L8979) | } |
| [8980](#L8980) | } |
| [8981](#L8981) | if( "undefined" != typeof this.$refs.bkp\_front\_calendar ){ |
| [8982](#L8982) | const calendar = this.$refs.bkp\_front\_calendar; |
| [8983](#L8983) | calendar.move(vm.appointment\_step\_form\_data.selected\_date); |
| [8984](#L8984) | } |
| [8985](#L8985) |  |
| [8986](#L8986) | vm.isLoadTimeLoader = "0"; |
| [8987](#L8987) | if( "undefined" != typeof response.data.empty\_front\_timings && true == response.data.empty\_front\_timings  ){ |
| [8988](#L8988) | vm.isLoadDateTimeCalendarLoad = "1"; |
| [8989](#L8989) | vm.appointment\_step\_form\_data.selected\_date = response.data.next\_available\_date; |
| [8990](#L8990) | vm.bookingpress\_disable\_date( bpa\_selected\_service, response.data.next\_available\_date ); |
| [8991](#L8991) | return; |
| [8992](#L8992) | } else { |
| [8993](#L8993) | /\* Check full day appointments block \*/ |
| [8994](#L8994) |  |
| [8995](#L8995) | if( false == response.data.prevent\_next\_month\_check ){ |
| [8996](#L8996) | let postDataAction = "bookingpress\_get\_whole\_day\_appointments"; |
| [8997](#L8997) | if( true == response.data.check\_for\_multiple\_days\_event ){ |
| [8998](#L8998) | postDataAction = "bookingpress\_get\_whole\_day\_appointments\_multiple\_days"; |
| [8999](#L8999) | } |
| [9000](#L9000) |  |
| [9001](#L9001) | var bkp\_wpnonce\_pre = "' . $bookingpress\_nonce . '"; |
| [9002](#L9002) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [9003](#L9003) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [9004](#L9004) | { |
| [9005](#L9005) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [9006](#L9006) | } |
| [9007](#L9007) | else { |
| [9008](#L9008) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [9009](#L9009) | } |
| [9010](#L9010) |  |
| [9011](#L9011) | var postData = { action: postDataAction,days\_off\_disabled\_dates: vm.days\_off\_disabled\_dates, service\_id: bpa\_selected\_service, max\_available\_year: response.data.max\_available\_year, max\_available\_month:response.data.max\_available\_month,  selected\_service:bpa\_selected\_service, selected\_date:bpa\_selected\_date, service\_id:bpa\_selected\_service,\_wpnonce:bkp\_wpnonce\_pre\_fetch, "next\_month": response.data.next\_month, "next\_year": response.data.next\_year, "counter": 1 }; |
| [9012](#L9012) |  |
| [9013](#L9013) | postData.bpa\_change\_store\_date = false; |
| [9014](#L9014) | if( "undefined" != typeof vm.bookingpress\_timezone\_offset ){ |
| [9015](#L9015) | postData.client\_timezone\_offset = vm.bookingpress\_timezone\_offset; |
| [9016](#L9016) | postData.bpa\_change\_store\_date = true; |
| [9017](#L9017) | } |
| [9018](#L9018) |  |
| [9019](#L9019) | postData.appointment\_data\_obj = JSON.stringify( vm.appointment\_step\_form\_data ); |
| [9020](#L9020) | '.$bookingpress\_disable\_date\_xhr\_data.' |
| [9021](#L9021) | vm.bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ); |
| [9022](#L9022) | } |
| [9023](#L9023) | setTimeout(function(){ |
| [9024](#L9024) | vm.isLoadDateTimeCalendarLoad = "0" |
| [9025](#L9025) | },200); |
| [9026](#L9026) | } |
| [9027](#L9027) | } |
| [9028](#L9028) |  |
| [9029](#L9029) | }.bind(this) ) |
| [9030](#L9030) | .catch( function (error) { |
| [9031](#L9031) | console.log(error); |
| [9032](#L9032) | }); |
| [9033](#L9033) | }, |
| [9034](#L9034) | bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ){ |
| [9035](#L9035) | const vm = this; |
| [9036](#L9036) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ).then( function( response ) { |
| [9037](#L9037) | vm.days\_off\_disabled\_dates = response.data.days\_off\_disabled\_dates; |
| [9038](#L9038) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp\_after.' |
| [9039](#L9039) |  |
| [9040](#L9040) | vm.isLoadDateTimeCalendarLoad = 0; |
| [9041](#L9041) | if(false == response.data.prevent\_next\_month\_check && response.data.counter <= 3 ){ /\*\* Currently data will be checked for next 3 months \*/ |
| [9042](#L9042) | postData.days\_off\_disabled\_dates = vm.days\_off\_disabled\_dates; |
| [9043](#L9043) | postData.next\_month = response.data.next\_month; |
| [9044](#L9044) | postData.next\_year = response.data.next\_year; |
| [9045](#L9045) | postData.counter++; |
| [9046](#L9046) |  |
| [9047](#L9047) | if( postData.counter < 4 ){ |
| [9048](#L9048) | vm.isHoldBookingRequest = true; |
| [9049](#L9049) | vm.bookingpress\_retrieve\_daysoff\_for\_booked\_appointment( postData ); |
| [9050](#L9050) | } else { |
| [9051](#L9051) | vm.v\_calendar\_check\_month\_dates = true; |
| [9052](#L9052) | let next\_month\_year = { |
| [9053](#L9053) | "month": parseInt( response.data.next\_month ), |
| [9054](#L9054) | "year": response.data.next\_year, |
| [9055](#L9055) | "postData": postData |
| [9056](#L9056) | }; |
| [9057](#L9057) | vm.v\_calendar\_next\_month\_dates = next\_month\_year; |
| [9058](#L9058) | vm.isHoldBookingRequest = false; |
| [9059](#L9059) | } |
| [9060](#L9060) |  |
| [9061](#L9061) | /\* V-Calendar disabled dates change start \*/ |
| [9062](#L9062) | if( "" != response.data.days\_off\_disabled\_dates\_string ){ |
| [9063](#L9063) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [9064](#L9064) | for( let temp\_date in bpa\_disable\_date ){ |
| [9065](#L9065) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [9066](#L9066) | if( "string" != typeof disabled\_date ){ |
| [9067](#L9067) | continue; |
| [9068](#L9068) | } |
| [9069](#L9069) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [9070](#L9070) | let disable\_date\_data = disabled\_date.split(" "); |
| [9071](#L9071) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [9072](#L9072) | } else { |
| [9073](#L9073) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [9074](#L9074) | } |
| [9075](#L9075) | } |
| [9076](#L9076) |  |
| [9077](#L9077) | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
| [9078](#L9078) | let pro\_version = "'.$bookingpress\_use\_pro\_legacy.'"; |
| [9079](#L9079) |  |
| [9080](#L9080) | if( "true" == use\_legacy && "false" == pro\_version ){ |
| [9081](#L9081) | let min\_date = vm.jsCurrentDate; |
| [9082](#L9082) | let max\_date = vm.booking\_cal\_maxdate; |
| [9083](#L9083) |  |
| [9084](#L9084) | let loop = new Date( min\_date ); |
| [9085](#L9085) | let available\_dates = []; |
| [9086](#L9086) | while( loop <= max\_date ){ |
| [9087](#L9087) | let dt = loop.toISOString().split("T")[0] + " 00:00:00"; |
| [9088](#L9088) |  |
| [9089](#L9089) | if( dt.indexOf( vm.v\_calendar\_disable\_dates ) == -1 ){ |
| [9090](#L9090) | available\_dates.push( dt ); |
| [9091](#L9091) | } |
| [9092](#L9092) |  |
| [9093](#L9093) | loop.setDate( loop.getDate() + 1 ); |
| [9094](#L9094) | } |
| [9095](#L9095) | vm.v\_calendar\_available\_dates = available\_dates; |
| [9096](#L9096) | } |
| [9097](#L9097) |  |
| [9098](#L9098) | } |
| [9099](#L9099) | /\* V-Calendar disabled dates change end \*/ |
| [9100](#L9100) |  |
| [9101](#L9101) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp.' |
| [9102](#L9102) | } else { |
| [9103](#L9103) | /\* V-Calendar disabled dates change start \*/ |
| [9104](#L9104) | if( "" != response.data.days\_off\_disabled\_dates\_string ){ |
| [9105](#L9105) | let bpa\_disable\_date = response.data.days\_off\_disabled\_dates\_string.split(","); |
| [9106](#L9106) | for( let temp\_date in bpa\_disable\_date ){ |
| [9107](#L9107) | let disabled\_date = bpa\_disable\_date[temp\_date]; |
| [9108](#L9108) | if( "string" != typeof disabled\_date ){ |
| [9109](#L9109) | continue; |
| [9110](#L9110) | } |
| [9111](#L9111) | if( "undefined" != typeof vm.browser\_details && "safari" == vm.browser\_details && 16 > vm.browser\_version ){ |
| [9112](#L9112) | let disable\_date\_data = disabled\_date.split(" "); |
| [9113](#L9113) | vm.v\_calendar\_disable\_dates.push( disable\_date\_data[0] ); |
| [9114](#L9114) | } else { |
| [9115](#L9115) | vm.v\_calendar\_disable\_dates.push( disabled\_date ); |
| [9116](#L9116) | } |
| [9117](#L9117) | } |
| [9118](#L9118) |  |
| [9119](#L9119) | } |
| [9120](#L9120) | /\* V-Calendar disabled dates change end \*/ |
| [9121](#L9121) |  |
| [9122](#L9122) | '.$bookingpress\_disable\_multiple\_days\_event\_xhr\_resp.' |
| [9123](#L9123) | } |
| [9124](#L9124) | }); |
| [9125](#L9125) | }, |
| [9126](#L9126) | bpaMoveMonthResponsive( page ){ |
| [9127](#L9127) | const vm = this; |
| [9128](#L9128) | if( "undefined" != typeof vm.v\_calendar\_check\_month\_dates && true == vm.v\_calendar\_check\_month\_dates && "undefined" != typeof vm.v\_calendar\_next\_month\_dates && false == vm.isHoldBookingRequest ){ |
| [9129](#L9129) |  |
| [9130](#L9130) | let current\_month = page.month; |
| [9131](#L9131) | let current\_year = page.year; |
| [9132](#L9132) |  |
| [9133](#L9133) | let next\_page\_month = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[1] ) || null; |
| [9134](#L9134) | let next\_page\_year = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[0] ) || null; |
| [9135](#L9135) |  |
| [9136](#L9136) | if( null != next\_page\_month && null != next\_page\_year ){ |
| [9137](#L9137) | if( current\_year == next\_page\_year && current\_month == next\_page\_month ){ |
| [9138](#L9138) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, 1 ); |
| [9139](#L9139) | } else if( current\_year == next\_page\_year && current\_month > next\_page\_month ){ |
| [9140](#L9140) | let current\_date = new Date( `${current\_year}-${current\_month}-1` ); |
| [9141](#L9141) | let next\_page\_date = new Date( `${next\_page\_year}-${next\_page\_month}-1` ); |
| [9142](#L9142) | const monthDiff = current\_date.getMonth() - next\_page\_date.getMonth(); |
| [9143](#L9143) | counter = 0 - monthDiff; |
| [9144](#L9144) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, counter ); |
| [9145](#L9145) | } |
| [9146](#L9146) | } |
| [9147](#L9147) | } |
| [9148](#L9148) | }, |
| [9149](#L9149) | bpaMoveMonth( page ){ |
| [9150](#L9150) | const vm = this; |
| [9151](#L9151) | if( "undefined" != typeof vm.v\_calendar\_check\_month\_dates && true == vm.v\_calendar\_check\_month\_dates && "undefined" != typeof vm.v\_calendar\_next\_month\_dates && false == vm.isHoldBookingRequest ){ |
| [9152](#L9152) |  |
| [9153](#L9153) | let current\_month = page.month; |
| [9154](#L9154) | let current\_year = page.year; |
| [9155](#L9155) |  |
| [9156](#L9156) | let next\_page\_month = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[1] ) || null; |
| [9157](#L9157) | let next\_page\_year = parseInt( vm.v\_calendar\_next\_month\_dates.split("-")[0] ) || null; |
| [9158](#L9158) |  |
| [9159](#L9159) | if( null != next\_page\_month && null != next\_page\_year ){ |
| [9160](#L9160) | if( current\_year == next\_page\_year && current\_month == next\_page\_month ){ |
| [9161](#L9161) | vm.isLoadDateTimeCalendarLoad = 1; |
| [9162](#L9162) | vm.bookingpress\_retrieve\_future\_month\_details( vm.v\_calendar\_next\_month\_dates, 1 ); |
| [9163](#L9163) | } else if( current\_year == next\_page\_year && current\_month > next\_page\_month ){ |
| [9164](#L9164) | let current\_date = new Date( `${current\_year}-${current\_month}-1` ); |
| [9165](#L9165) | let next\_page\_date = new Date( `${next\_page\_year}-${next\_page\_month}-1` ); |
| [9166](#L9166) | const monthDiff = current\_date.getMonth() - next\_page\_date.getMonth(); |
| [9167](#L9167) |  |
| [9168](#L9168) | let month\_ = ( current\_month.toString().length == 1 ) ? ( "0" + current\_month.toString() ) : current\_month; |
| [9169](#L9169) | let nextMonthDate = current\_year + "-" + month\_ + "-01"; |
| [9170](#L9170) |  |
| [9171](#L9171) |  |
| [9172](#L9172) | counter = 0 - monthDiff; |
| [9173](#L9173) |  |
| [9174](#L9174) | vm.isLoadDateTimeCalendarLoad = 1; |
| [9175](#L9175) | vm.bookingpress\_retrieve\_future\_month\_details\_single( nextMonthDate, vm.v\_calendar\_next\_month\_dates, counter ); |
| [9176](#L9176) | } |
| [9177](#L9177) | } |
| [9178](#L9178) | } |
| [9179](#L9179) | }, |
| [9180](#L9180) | bookingpress\_get\_all\_parent\_node\_with\_overflow\_hidden( elem ){ |
| [9181](#L9181) | if (!Element.prototype.matches) { |
| [9182](#L9182) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [9183](#L9183) | Element.prototype.mozMatchesSelector || |
| [9184](#L9184) | Element.prototype.msMatchesSelector || |
| [9185](#L9185) | Element.prototype.oMatchesSelector || |
| [9186](#L9186) | Element.prototype.webkitMatchesSelector || |
| [9187](#L9187) | function(s) { |
| [9188](#L9188) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [9189](#L9189) | i = matches.length; |
| [9190](#L9190) | while (--i >= 0 && matches.item(i) !== this) {} |
| [9191](#L9191) | return i > -1; |
| [9192](#L9192) | }; |
| [9193](#L9193) | } |
| [9194](#L9194) |  |
| [9195](#L9195) | var parents = []; |
| [9196](#L9196) |  |
| [9197](#L9197) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [9198](#L9198) | let computed\_style = getComputedStyle( elem ); |
| [9199](#L9199) |  |
| [9200](#L9200) | if( computed\_style.overflow == "hidden" || computed\_style.overflowX == "hidden" || computed\_style.overflowY == "hidden" ){ |
| [9201](#L9201) | parents.push(elem); |
| [9202](#L9202) | } |
| [9203](#L9203) | } |
| [9204](#L9204) | return parents; |
| [9205](#L9205) | }, |
| [9206](#L9206) | bookingpress\_onload\_func(){ |
| [9207](#L9207) | const vm = this; |
| [9208](#L9208) | vm.current\_screen\_size = "desktop"; |
| [9209](#L9209) | if(window.outerWidth >= 1200){ |
| [9210](#L9210) | vm.current\_screen\_size = "desktop"; |
| [9211](#L9211) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [9212](#L9212) | vm.current\_screen\_size = "tablet"; |
| [9213](#L9213) | }else if(window.outerWidth < 768){ |
| [9214](#L9214) | vm.current\_screen\_size = "mobile"; |
| [9215](#L9215) | } |
| [9216](#L9216) |  |
| [9217](#L9217) | let is\_mobile\_device = "'.wp\_is\_mobile().'"; |
| [9218](#L9218) |  |
| [9219](#L9219) | if( "mobile" != vm.current\_screen\_size && ("true" == is\_mobile\_device || true == is\_mobile\_device) ){ |
| [9220](#L9220) | vm.current\_screen\_size = "mobile"; |
| [9221](#L9221) | } |
| [9222](#L9222) |  |
| [9223](#L9223) | if(window.innerWidth <= 576){ |
| [9224](#L9224) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9225](#L9225) | let bookingpress\_container = vm.$el; |
| [9226](#L9226) | let parents\_with\_hidden\_overflow = vm.bookingpress\_get\_all\_parent\_node\_with\_overflow\_hidden( bookingpress\_container ); |
| [9227](#L9227) | let apply\_overflow = ( parents\_with\_hidden\_overflow.length > 0 ) ? true : false; |
| [9228](#L9228) | window.addEventListener("scroll", function(e){ |
| [9229](#L9229) |  |
| [9230](#L9230) | let bookingpress\_scrollTop = bookingpress\_container.getBoundingClientRect().top; |
| [9231](#L9231) | let bookingpress\_scrollBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9232](#L9232) | let bpa\_current\_scroll = window.scrollY; |
| [9233](#L9233) |  |
| [9234](#L9234) | let targetBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9235](#L9235) | let viewportHeight = window.innerHeight || document.documentElement.clientHeight; |
| [9236](#L9236) |  |
| [9237](#L9237) |  |
| [9238](#L9238) | if( bookingpress\_scrollTop < 50 && bpa\_current\_scroll >= bookingpress\_scrollTop && targetBottom >= viewportHeight ){ |
| [9239](#L9239) | vm.bookingpress\_container\_dynamic\_class = "bpa-front\_\_mc--is-sticky" ; |
| [9240](#L9240) | vm.bookingpress\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9241](#L9241) | if( apply\_overflow ){ |
| [9242](#L9242) | for( let i = 0; i < parents\_with\_hidden\_overflow.length; i++ ){ |
| [9243](#L9243) | let parent = parents\_with\_hidden\_overflow[i]; |
| [9244](#L9244) | parent.classList.add("--bpa-is-overflow-visible"); |
| [9245](#L9245) | } |
| [9246](#L9246) | } |
| [9247](#L9247) | } else { |
| [9248](#L9248) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9249](#L9249) | vm.bookingpress\_footer\_dynamic\_class = ""; /\* Change this string \*/ |
| [9250](#L9250) | if( apply\_overflow ){ |
| [9251](#L9251) | for( let i = 0; i < parents\_with\_hidden\_overflow.length; i++ ){ |
| [9252](#L9252) | let parent = parents\_with\_hidden\_overflow[i]; |
| [9253](#L9253) | parent.classList.remove("--bpa-is-overflow-visible"); |
| [9254](#L9254) | } |
| [9255](#L9255) | } |
| [9256](#L9256) | } |
| [9257](#L9257) | }); |
| [9258](#L9258) | } |
| [9259](#L9259) | window.addEventListener("resize", function(e){ |
| [9260](#L9260) | if( window.innerWidth <= 576 ){ |
| [9261](#L9261) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9262](#L9262) | let bookingpress\_container = vm.$el; |
| [9263](#L9263) |  |
| [9264](#L9264) | let bookingpress\_scrollTop = bookingpress\_container.getBoundingClientRect().top; |
| [9265](#L9265) | let bookingpress\_scrollBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9266](#L9266) | let bpa\_current\_scroll = window.scrollY; |
| [9267](#L9267) | bookingpress\_scrollBottom = bpa\_current\_scroll + bookingpress\_scrollBottom + bookingpress\_scrollTop; |
| [9268](#L9268) |  |
| [9269](#L9269) | let targetBottom = bookingpress\_container.getBoundingClientRect().bottom; |
| [9270](#L9270) | let viewportHeight = window.innerHeight || document.documentElement.clientHeight; |
| [9271](#L9271) |  |
| [9272](#L9272) | if( bookingpress\_scrollTop < 50 && bpa\_current\_scroll >= bookingpress\_scrollTop && targetBottom >= viewportHeight ){ |
| [9273](#L9273) | vm.bookingpress\_container\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9274](#L9274) | vm.bookingpress\_footer\_dynamic\_class = "\_\_bpa-is-sticky" /\* Change this string \*/ |
| [9275](#L9275) | } else { |
| [9276](#L9276) | vm.bookingpress\_container\_dynamic\_class = ""; |
| [9277](#L9277) | vm.bookingpress\_footer\_dynamic\_class = ""; /\* Change this string \*/ |
| [9278](#L9278) | } |
| [9279](#L9279) | } |
| [9280](#L9280) | }); |
| [9281](#L9281) | }, |
| [9282](#L9282) | bookingpress\_step\_navigation(current\_tab, next\_tab, previous\_tab, is\_strict\_validate = 1){ |
| [9283](#L9283) | const vm = this; |
| [9284](#L9284) | var bookingpress\_is\_validate = 0; |
| [9285](#L9285) |  |
| [9286](#L9286) | vm.bookingpress\_remove\_error\_msg(); |
| [9287](#L9287) |  |
| [9288](#L9288) | var bookingpress\_validate\_fields\_arr = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validate\_fields; |
| [9289](#L9289) |  |
| [9290](#L9290) | '.$bookingpress\_step\_navigation\_before\_validation.' |
| [9291](#L9291) |  |
| [9292](#L9292) | if((vm.bookingpress\_current\_tab == "basic\_details") && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9293](#L9293) | bookingpress\_validate\_fields\_arr.forEach(function(currentValue, index, arr){ |
| [9294](#L9294) | if(vm.bookingpress\_current\_tab == vm.bookingpress\_current\_tab && vm.appointment\_step\_form\_data[currentValue] == "" && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9295](#L9295) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9296](#L9296) | bookingpress\_is\_validate = 1; |
| [9297](#L9297) | } |
| [9298](#L9298) | }); |
| [9299](#L9299) |  |
| [9300](#L9300) | if(bookingpress\_is\_validate == 0 && is\_strict\_validate == 1){ |
| [9301](#L9301) | var customer\_form = "appointment\_step\_form\_data"; |
| [9302](#L9302) | vm.$refs[customer\_form].validate((valid) => { |
| [9303](#L9303) | if (!valid) { |
| [9304](#L9304) | bookingpress\_is\_validate = 1; |
| [9305](#L9305) | }else{ |
| [9306](#L9306) | bookingpress\_is\_validate = 0; |
| [9307](#L9307) | } |
| [9308](#L9308) | }); |
| [9309](#L9309) | } |
| [9310](#L9310) | }else{ |
| [9311](#L9311) | if(is\_strict\_validate == 1){ |
| [9312](#L9312) | bookingpress\_validate\_fields\_arr.forEach(function(currentValue, index, arr){ |
| [9313](#L9313) | if(vm.bookingpress\_current\_tab == vm.bookingpress\_current\_tab && vm.appointment\_step\_form\_data[currentValue] == "" && vm.bookingpress\_current\_tab != next\_tab && current\_tab != previous\_tab){ |
| [9314](#L9314) | if( currentValue == "selected\_start\_time" && vm.appointment\_step\_form\_data[currentValue] == "" ) { |
| [9315](#L9315) | if( vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d" ){ |
| [9316](#L9316) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9317](#L9317) | bookingpress\_is\_validate = 1; |
| [9318](#L9318) | } |
| [9319](#L9319) | } else { |
| [9320](#L9320) | vm.bookingpress\_set\_error\_msg(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].validation\_msg[currentValue]); |
| [9321](#L9321) | bookingpress\_is\_validate = 1; |
| [9322](#L9322) | } |
| [9323](#L9323) |  |
| [9324](#L9324) | '. $bookingpress\_validation\_for\_outside\_step\_change\_filter.' |
| [9325](#L9325) | } |
| [9326](#L9326) | }); |
| [9327](#L9327) | } |
| [9328](#L9328) |  |
| [9329](#L9329) | '.$bookingpress\_dynamic\_validation\_for\_step\_change.' |
| [9330](#L9330) | } |
| [9331](#L9331) | if( "service" == current\_tab && "service" != vm.bookingpress\_current\_tab ){ |
| [9332](#L9332) | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date+"T00:00:00+00:00"; |
| [9333](#L9333) | var bookingpress\_disable\_dates\_arr = vm.days\_off\_disabled\_dates.split(","); |
| [9334](#L9334) | if(bookingpress\_disable\_dates\_arr.includes(bookingpress\_selected\_date)){ |
| [9335](#L9335) | let newDate = new Date('.( !empty( $bookingpress\_site\_date ) ? '"' . $bookingpress\_site\_date . '"' : '' ).'); |
| [9336](#L9336) | let pattern = /(\d{4}\-\d{2}\-\d{2})/; |
| [9337](#L9337) | if( !pattern.test( newDate ) ){ |
| [9338](#L9338) |  |
| [9339](#L9339) | let sel\_month = newDate.getMonth() + 1; |
| [9340](#L9340) | let sel\_year = newDate.getFullYear(); |
| [9341](#L9341) | let sel\_date = newDate.getDate(); |
| [9342](#L9342) |  |
| [9343](#L9343) | if( sel\_month < 10 ){ |
| [9344](#L9344) | sel\_month = "0" + sel\_month; |
| [9345](#L9345) | } |
| [9346](#L9346) |  |
| [9347](#L9347) | if( sel\_date < 10 ){ |
| [9348](#L9348) | sel\_date = "0" + sel\_date; |
| [9349](#L9349) | } |
| [9350](#L9350) |  |
| [9351](#L9351) | newDate = sel\_year + "-" + sel\_month + "-" + sel\_date; |
| [9352](#L9352) | } |
| [9353](#L9353) |  |
| [9354](#L9354) | vm.appointment\_step\_form\_data.selected\_date = newDate; |
| [9355](#L9355) | } |
| [9356](#L9356) | } |
| [9357](#L9357) |  |
| [9358](#L9358) | if( ("basic\_details" == current\_tab && "service" == vm.bookingpress\_current\_tab) || ("summary" == current\_tab && "service" == vm.bookingpress\_current\_tab) ){ |
| [9359](#L9359) | if(vm.appointment\_step\_form\_data.selected\_service\_duration\_unit != "d"){ |
| [9360](#L9360) | if(vm.appointment\_step\_form\_data.selected\_start\_time == ""){ |
| [9361](#L9361) | bookingpress\_is\_validate = 1; |
| [9362](#L9362) | } |
| [9363](#L9363) | } |
| [9364](#L9364) | } |
| [9365](#L9365) |  |
| [9366](#L9366) | if(bookingpress\_is\_validate == 0){ |
| [9367](#L9367) | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
| [9368](#L9368) | let current\_selected\_tab = vm.bookingpress\_current\_tab; |
| [9369](#L9369) | vm.bookingpress\_current\_tab = current\_tab; |
| [9370](#L9370) | vm.bookingpress\_next\_tab = next\_tab; |
| [9371](#L9371) | vm.bookngpress\_previous\_tab = previous\_tab; |
| [9372](#L9372) | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
| [9373](#L9373) |  |
| [9374](#L9374) | if( "datetime" == current\_tab ){ |
| [9375](#L9375) | let selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
| [9376](#L9376) | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
| [9377](#L9377) | } |
| [9378](#L9378) | } |
| [9379](#L9379) |  |
| [9380](#L9380) | if( window.innerWidth <= 576 ){ |
| [9381](#L9381) | let container = vm.$el; |
| [9382](#L9382) | let pos = 0; |
| [9383](#L9383) | if( null != container ){ |
| [9384](#L9384) | pos = container.getBoundingClientRect().top + window.scrollY; |
| [9385](#L9385) | } |
| [9386](#L9386) |  |
| [9387](#L9387) | const myVar = Error().stack; |
| [9388](#L9388) | let allow\_scroll = true; |
| [9389](#L9389) | if( /mounted/.test( myVar ) ){ |
| [9390](#L9390) | allow\_scroll = false; |
| [9391](#L9391) | } |
| [9392](#L9392) | if( allow\_scroll ){ |
| [9393](#L9393) | setTimeout(function(){ |
| [9394](#L9394) | window.scrollTo({ |
| [9395](#L9395) | top: pos, |
| [9396](#L9396) | behavior: "smooth", |
| [9397](#L9397) | }); |
| [9398](#L9398) | }, 500); |
| [9399](#L9399) | } |
| [9400](#L9400) | } |
| [9401](#L9401) |  |
| [9402](#L9402) | if( "summary" == current\_tab && "summary" == vm.bookingpress\_current\_tab ) { |
| [9403](#L9403) |  |
| [9404](#L9404) | const vm = this; |
| [9405](#L9405) | var total\_payment\_div\_count = document.querySelectorAll(".bpa-front-module--pm-body\_\_item").length; |
| [9406](#L9406) |  |
| [9407](#L9407) | if(total\_payment\_div\_count == 1){ |
| [9408](#L9408) | var total\_payment\_div = document.querySelector(".bpa-front-module--pm-body\_\_item"); |
| [9409](#L9409) | if( null != total\_payment\_div && "undefined" != typeof total\_payment\_div) { |
| [9410](#L9410) | vm.prevent\_verification\_on\_load = true; |
| [9411](#L9411) | total\_payment\_div.click(); |
| [9412](#L9412) | vm.prevent\_verification\_on\_load = false; |
| [9413](#L9413) | } |
| [9414](#L9414) | } |
| [9415](#L9415) |  |
| [9416](#L9416) | '.$bookingpress\_change\_on\_summary\_steps\_filter.' |
| [9417](#L9417) |  |
| [9418](#L9418) | if( total\_payment\_div\_count == 0 && vm.is\_only\_onsite\_enabled == "1" ){ |
| [9419](#L9419) | vm.appointment\_step\_form\_data.selected\_payment\_method = "on-site"; |
| [9420](#L9420) | vm.skip\_checking\_final\_step\_validation = true; |
| [9421](#L9421) | vm.select\_payment\_method("on-site"); |
| [9422](#L9422) | } |
| [9423](#L9423) | } |
| [9424](#L9424) |  |
| [9425](#L9425) | '.$bookingpress\_dynamic\_next\_page\_request\_filter.'; |
| [9426](#L9426) | }, |
| [9427](#L9427) | bookingpress\_select\_multi\_day\_range(day = ""){ |
| [9428](#L9428) | const vm = this; |
| [9429](#L9429) | if(vm.appointment\_step\_form\_data.selected\_date){ |
| [9430](#L9430) | day = vm.appointment\_step\_form\_data.selected\_date; |
| [9431](#L9431) | vm.bookingpress\_selected\_date\_range = []; |
| [9432](#L9432) | if(vm.appointment\_step\_form\_data.selected\_service\_duration\_unit == "d"){ |
| [9433](#L9433) | vm.appointment\_step\_form\_data.selected\_end\_date = vm.appointment\_step\_form\_data.selected\_date; |
| [9434](#L9434) | var selected\_date = new Date(day); |
| [9435](#L9435) | var selected\_service\_duration = vm.appointment\_step\_form\_data.selected\_service\_duration; |
| [9436](#L9436) | var bookingpress\_selected\_date\_range = []; |
| [9437](#L9437) |  |
| [9438](#L9438) | var new\_date = new Date(day + " 00:00:00"); |
| [9439](#L9439) | bookingpress\_selected\_date\_range.push(day); |
| [9440](#L9440) | for(var i = 1; i < selected\_service\_duration; i++) { |
| [9441](#L9441) | new\_date.setDate(new\_date.getDate() + 1); |
| [9442](#L9442) | var month = "" + (new\_date.getMonth() + 1), |
| [9443](#L9443) | day = "" + new\_date.getDate(), |
| [9444](#L9444) | year = new\_date.getFullYear(); |
| [9445](#L9445) | if (month.length < 2){ |
| [9446](#L9446) | month = "0" + month; |
| [9447](#L9447) | } |
| [9448](#L9448) | if (day.length < 2){ |
| [9449](#L9449) | day = "0" + day; |
| [9450](#L9450) | } |
| [9451](#L9451) | var add\_date = [year, month, day].join("-"); |
| [9452](#L9452) | bookingpress\_selected\_date\_range.push(add\_date); |
| [9453](#L9453) | if(i == selected\_service\_duration-1) { |
| [9454](#L9454) | vm.appointment\_step\_form\_data.selected\_end\_date = add\_date; |
| [9455](#L9455) | } |
| [9456](#L9456) | } |
| [9457](#L9457) | if(bookingpress\_selected\_date\_range.length > 0){ |
| [9458](#L9458) | vm.bookingpress\_selected\_date\_range = bookingpress\_selected\_date\_range; |
| [9459](#L9459) | } |
| [9460](#L9460) | } |
| [9461](#L9461) | } |
| [9462](#L9462) | },'; |
| [9463](#L9463) |  |
| [9464](#L9464) | $bookingpress\_vue\_methods\_data = apply\_filters('bookingpress\_add\_appointment\_booking\_vue\_methods', $bookingpress\_vue\_methods\_data); |
| [9465](#L9465) |  |
| [9466](#L9466) | return $bookingpress\_vue\_methods\_data; |
| [9467](#L9467) | } |
| [9468](#L9468) |  |
| [9469](#L9469) | /\*\* |
| [9470](#L9470) | \* My Appointments Shortcode Data Fields function |
| [9471](#L9471) | \* |
| [9472](#L9472) | \* @return void |
| [9473](#L9473) | \*/ |
| [9474](#L9474) | function bookingpress\_front\_appointments\_dynamic\_data\_fields\_func() |
| [9475](#L9475) | { |
| [9476](#L9476) | global $bookingpress\_front\_appointment\_vue\_data\_fields, $BookingPress, $bookingpress\_global\_options; |
| [9477](#L9477) | $default\_daysoff\_details = $BookingPress->bookingpress\_get\_default\_dayoff\_dates(); |
| [9478](#L9478) | if (! empty($default\_daysoff\_details) ) { |
| [9479](#L9479) | $default\_daysoff\_details = array\_map( |
| [9480](#L9480) | function ( $date ) { |
| [9481](#L9481) | return date('Y-m-d', strtotime($date)); |
| [9482](#L9482) | }, |
| [9483](#L9483) | $default\_daysoff\_details |
| [9484](#L9484) | ); |
| [9485](#L9485) | $bookingpress\_front\_appointment\_vue\_data\_fields['disabledDates'] = $default\_daysoff\_details; |
| [9486](#L9486) | } else { |
| [9487](#L9487) | $bookingpress\_front\_appointment\_vue\_data\_fields['disabledDates'] = ''; |
| [9488](#L9488) | } |
| [9489](#L9489) |  |
| [9490](#L9490) | $bookingpress\_mybooking\_title\_text      = $BookingPress->bookingpress\_get\_customize\_settings('mybooking\_title\_text', 'booking\_my\_booking'); |
| [9491](#L9491) | $bookingpress\_hide\_customer\_details     = $BookingPress->bookingpress\_get\_customize\_settings('hide\_customer\_details', 'booking\_my\_booking'); |
| [9492](#L9492) | $bookingpress\_allow\_cancel\_appointments = $BookingPress->bookingpress\_get\_customize\_settings('allow\_to\_cancel\_appointment', 'booking\_my\_booking'); |
| [9493](#L9493) | $bookingpress\_reset\_button\_label        = $BookingPress->bookingpress\_get\_customize\_settings('reset\_button\_title', 'booking\_my\_booking'); |
| [9494](#L9494) | $bookingpress\_apply\_button\_label        = $BookingPress->bookingpress\_get\_customize\_settings('apply\_button\_title', 'booking\_my\_booking'); |
| [9495](#L9495) | $bookingpress\_search\_appointment\_label  = $BookingPress->bookingpress\_get\_customize\_settings('search\_appointment\_title', 'booking\_my\_booking'); |
| [9496](#L9496) | $bookingpress\_search\_date\_title  = $BookingPress->bookingpress\_get\_customize\_settings('search\_date\_title', 'booking\_my\_booking'); |
| [9497](#L9497) | $bookingpress\_search\_end\_date\_title  = $BookingPress->bookingpress\_get\_customize\_settings('search\_end\_date\_title', 'booking\_my\_booking'); |
| [9498](#L9498) | $bookingpress\_my\_appointment\_menu\_title  = $BookingPress->bookingpress\_get\_customize\_settings('my\_appointment\_menu\_title', 'booking\_my\_booking'); |
| [9499](#L9499) | $bookingpress\_delete\_appointment\_menu\_title  = $BookingPress->bookingpress\_get\_customize\_settings('delete\_appointment\_menu\_title', 'booking\_my\_booking'); |
| [9500](#L9500) | $confirmation\_message\_for\_the\_cancel\_appointment = $BookingPress->bookingpress\_get\_settings('confirmation\_message\_for\_the\_cancel\_appointment', 'message\_setting'); |
| [9501](#L9501) |  |
| [9502](#L9502) | $bookingpress\_mybooking\_title\_text = !empty($bookingpress\_mybooking\_title\_text) ? stripslashes\_deep($bookingpress\_mybooking\_title\_text) : ''; |
| [9503](#L9503) | $bookingpress\_reset\_button\_label = !empty($bookingpress\_reset\_button\_label) ? stripslashes\_deep($bookingpress\_reset\_button\_label) : ''; |
| [9504](#L9504) | $bookingpress\_apply\_button\_label = !empty($bookingpress\_apply\_button\_label) ? stripslashes\_deep($bookingpress\_apply\_button\_label) : ''; |
| [9505](#L9505) | $bookingpress\_search\_appointment\_label = !empty($bookingpress\_search\_appointment\_label) ? stripslashes\_deep($bookingpress\_search\_appointment\_label) : ''; |
| [9506](#L9506) | $bookingpress\_search\_date\_title = !empty($bookingpress\_search\_date\_title) ? stripslashes\_deep($bookingpress\_search\_date\_title) : ''; |
| [9507](#L9507) | $bookingpress\_search\_end\_date\_title = !empty($bookingpress\_search\_end\_date\_title) ? stripslashes\_deep($bookingpress\_search\_end\_date\_title) : ''; |
| [9508](#L9508) | $bookingpress\_my\_appointment\_menu\_title = !empty($bookingpress\_my\_appointment\_menu\_title) ? stripslashes\_deep($bookingpress\_my\_appointment\_menu\_title) : ''; |
| [9509](#L9509) | $bookingpress\_delete\_appointment\_menu\_title = !empty($bookingpress\_delete\_appointment\_menu\_title) ? stripslashes\_deep($bookingpress\_delete\_appointment\_menu\_title) : ''; |
| [9510](#L9510) | $confirmation\_message\_for\_the\_cancel\_appointment = !empty($confirmation\_message\_for\_the\_cancel\_appointment) ? stripslashes\_deep($confirmation\_message\_for\_the\_cancel\_appointment) : ''; |
| [9511](#L9511) | $bookingpress\_hide\_customer\_details = $bookingpress\_hide\_customer\_details = ( $bookingpress\_hide\_customer\_details == 'true' ) ? 1 : 0; |
| [9512](#L9512) | $bookingpress\_allow\_cancel\_appointments = $bookingpress\_allow\_cancel\_appointments = ( $bookingpress\_allow\_cancel\_appointments == 'true' ) ? 1 : 0; |
| [9513](#L9513) |  |
| [9514](#L9514) | $bookingpress\_front\_appointment\_vue\_data\_fields['mybooking\_title\_text'] = $bookingpress\_mybooking\_title\_text; |
| [9515](#L9515) | $bookingpress\_front\_appointment\_vue\_data\_fields['hide\_customer\_details'] = $bookingpress\_hide\_customer\_details; |
| [9516](#L9516) | $bookingpress\_front\_appointment\_vue\_data\_fields['allow\_cancel\_appointments'] = $bookingpress\_allow\_cancel\_appointments; |
| [9517](#L9517) | $bookingpress\_front\_appointment\_vue\_data\_fields['reset\_button\_title'] = $bookingpress\_reset\_button\_label; |
| [9518](#L9518) | $bookingpress\_front\_appointment\_vue\_data\_fields['apply\_button\_title'] = $bookingpress\_apply\_button\_label; |
| [9519](#L9519) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_appointment\_title'] = $bookingpress\_search\_appointment\_label; |
| [9520](#L9520) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_date\_title'] = $bookingpress\_search\_date\_title; |
| [9521](#L9521) | $bookingpress\_front\_appointment\_vue\_data\_fields['search\_end\_date\_title'] = $bookingpress\_search\_end\_date\_title; |
| [9522](#L9522) | $bookingpress\_front\_appointment\_vue\_data\_fields['my\_appointment\_menu\_title'] = $bookingpress\_my\_appointment\_menu\_title; |
| [9523](#L9523) | $bookingpress\_front\_appointment\_vue\_data\_fields['delete\_appointment\_menu\_title'] = $bookingpress\_delete\_appointment\_menu\_title; |
| [9524](#L9524) | $bookingpress\_front\_appointment\_vue\_data\_fields['confirmation\_message\_for\_the\_cancel\_appointment'] = $confirmation\_message\_for\_the\_cancel\_appointment; |
| [9525](#L9525) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_is\_user\_logged\_in'] =  is\_user\_logged\_in() ? '1' : '0'; |
| [9526](#L9526) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_user\_fullname'] =  ''; |
| [9527](#L9527) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_user\_email'] =  ''; |
| [9528](#L9528) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_avatar\_url'] = ''; |
| [9529](#L9529) |  |
| [9530](#L9530) |  |
| [9531](#L9531) | $bookingpress\_front\_appointment\_vue\_data\_fields["current\_screen\_size"] = ""; |
| [9532](#L9532) | $bookingpress\_front\_appointment\_vue\_data\_fields["container\_size"] = ""; |
| [9533](#L9533) |  |
| [9534](#L9534) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_myappointment\_footer\_dynamic\_class'] = ''; |
| [9535](#L9535) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_myappointment\_header\_dynamic\_class'] = ''; |
| [9536](#L9536) |  |
| [9537](#L9537) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_my\_booking\_current\_tab'] = 'my\_appointment'; |
| [9538](#L9538) |  |
| [9539](#L9539) | $bookingpress\_global\_options\_arr = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9540](#L9540) | $bookingpress\_default\_date\_format = $BookingPress->bookingpress\_check\_common\_date\_format($bookingpress\_global\_options\_arr['wp\_default\_date\_format']); |
| [9541](#L9541) |  |
| [9542](#L9542) | $bookingpress\_front\_appointment\_vue\_data\_fields['masks'] = array( |
| [9543](#L9543) | 'input' => strtoupper($bookingpress\_default\_date\_format), |
| [9544](#L9544) | ); |
| [9545](#L9545) |  |
| [9546](#L9546) | $bpa\_default\_date\_format = $BookingPress->bookingpress\_get\_settings( 'default\_date\_format', 'general\_setting' ); |
| [9547](#L9547) |  |
| [9548](#L9548) | $bookingpress\_front\_appointment\_vue\_data\_fields['bpa\_front\_date\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ) : $bookingpress\_default\_date\_format; |
| [9549](#L9549) |  |
| [9550](#L9550) | $bookingpress\_front\_appointment\_vue\_data\_fields['bpa\_front\_date\_time\_format'] = !empty( $bpa\_default\_date\_format ) ? $BookingPress->bookingpress\_check\_common\_date\_format( $bpa\_default\_date\_format ).' HH:mm' : $bookingpress\_default\_date\_format.' HH:mm'; |
| [9551](#L9551) |  |
| [9552](#L9552) | $bookingpress\_delete\_account\_content  = $BookingPress->bookingpress\_get\_customize\_settings('delete\_account\_content', 'booking\_my\_booking'); |
| [9553](#L9553) | $bookingpress\_front\_appointment\_vue\_data\_fields['delete\_account\_content'] = do\_shortcode(stripslashes($bookingpress\_delete\_account\_content)); |
| [9554](#L9554) |  |
| [9555](#L9555) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_cancel\_appointment\_drawer'] = false; |
| [9556](#L9556) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_cancel\_drawer\_direction'] = 'btt'; |
| [9557](#L9557) |  |
| [9558](#L9558) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_previous\_row\_obj'] = ''; |
| [9559](#L9559) |  |
| [9560](#L9560) | $bookingpress\_front\_appointment\_vue\_data\_fields['bookingpress\_created\_nonce'] = esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); |
| [9561](#L9561) |  |
| [9562](#L9562) | $bookingpress\_front\_appointment\_vue\_data\_fields['is\_display\_pagination'] = 0; |
| [9563](#L9563) |  |
| [9564](#L9564) | $bookingpress\_front\_appointment\_vue\_data\_fields['disable\_my\_appointments\_apply'] = false; |
| [9565](#L9565) |  |
| [9566](#L9566) | $bookingpress\_front\_appointment\_vue\_data\_fields = apply\_filters('bookingpress\_front\_appointment\_add\_dynamic\_data', $bookingpress\_front\_appointment\_vue\_data\_fields); |
| [9567](#L9567) |  |
| [9568](#L9568) | echo wp\_json\_encode($bookingpress\_front\_appointment\_vue\_data\_fields); |
| [9569](#L9569) | } |
| [9570](#L9570) |  |
| [9571](#L9571) | /\*\* |
| [9572](#L9572) | \* My Appointments Shortcode Helper Variables |
| [9573](#L9573) | \* |
| [9574](#L9574) | \* @return void |
| [9575](#L9575) | \*/ |
| [9576](#L9576) | function bookingpress\_front\_appointments\_dynamic\_helper\_vars\_func() |
| [9577](#L9577) | { |
| [9578](#L9578) | global $bookingpress\_global\_options; |
| [9579](#L9579) | $bookingpress\_options     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9580](#L9580) | $bookingpress\_locale\_lang = $bookingpress\_options['locale']; |
| [9581](#L9581) | ?> |
| [9582](#L9582) | var lang = ELEMENT.lang.<?php echo esc\_html($bookingpress\_locale\_lang); ?>; |
| [9583](#L9583) | ELEMENT.locale(lang); |
| [9584](#L9584) | <?php |
| [9585](#L9585) | do\_action('bookingpress\_add\_front\_appointment\_helper\_vars'); |
| [9586](#L9586) | } |
| [9587](#L9587) |  |
| [9588](#L9588) | /\*\* |
| [9589](#L9589) | \* My Appointments Shortcode On Load Methods |
| [9590](#L9590) | \* |
| [9591](#L9591) | \* @return void |
| [9592](#L9592) | \*/ |
| [9593](#L9593) | function bookingpress\_front\_appointments\_dynamic\_on\_load\_methods\_func() |
| [9594](#L9594) | {   if(is\_user\_logged\_in()) { |
| [9595](#L9595) | ?> |
| [9596](#L9596) | this.loadFrontAppointments(); |
| [9597](#L9597) | <?php |
| [9598](#L9598) | } |
| [9599](#L9599) | ?> |
| [9600](#L9600) | this.bookingpress\_load\_mybooking\_form(); |
| [9601](#L9601) | this.bookingpress\_myappointments\_onload\_func(); |
| [9602](#L9602) | this.bookingpress\_dynamic\_add\_onload\_myappointment\_methods\_func(); |
| [9603](#L9603) | <?php |
| [9604](#L9604) | do\_action('bookingpress\_dynamic\_add\_onload\_myappointment\_methods'); |
| [9605](#L9605) | } |
| [9606](#L9606) |  |
| [9607](#L9607) | /\*\* |
| [9608](#L9608) | \* My Appointments methods or functions |
| [9609](#L9609) | \* |
| [9610](#L9610) | \* @return void |
| [9611](#L9611) | \*/ |
| [9612](#L9612) | function bookingpress\_front\_appointments\_dynamic\_vue\_methods\_func() |
| [9613](#L9613) | { |
| [9614](#L9614) |  |
| [9615](#L9615) | global $BookingPress, $bookingpress\_global\_options; |
| [9616](#L9616) | $bpa\_afternoon\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_afternoon\_start\_time','general\_setting'); |
| [9617](#L9617) | $bpa\_evening\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_evening\_start\_time','general\_setting'); |
| [9618](#L9618) | $bpa\_night\_start\_time = $BookingPress->bookingpress\_get\_settings('bpa\_night\_start\_time','general\_setting'); |
| [9619](#L9619) |  |
| [9620](#L9620) | $bpa\_afternoon\_solts\_timing = !empty( $bpa\_afternoon\_start\_time ) ? date('H', strtotime($bpa\_afternoon\_start\_time)) : ''; |
| [9621](#L9621) | $bpa\_evening\_solts\_timing = !empty( $bpa\_evening\_start\_time ) ? date('H', strtotime($bpa\_evening\_start\_time)) : ''; |
| [9622](#L9622) | $bpa\_night\_solts\_timing = !empty( $bpa\_night\_start\_time ) ? date('H', strtotime($bpa\_night\_start\_time)) : ''; |
| [9623](#L9623) |  |
| [9624](#L9624) | $bookigpress\_time\_format\_for\_booking\_form = $BookingPress->bookingpress\_get\_customize\_settings('bookigpress\_time\_format\_for\_booking\_form','booking\_form'); |
| [9625](#L9625) | $bookigpress\_time\_format\_for\_booking\_form = !empty($bookigpress\_time\_format\_for\_booking\_form) ? $bookigpress\_time\_format\_for\_booking\_form : '2'; |
| [9626](#L9626) |  |
| [9627](#L9627) | $bookingpress\_global\_details     = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [9628](#L9628) | $bookingpress\_formatted\_timeslot = $bookingpress\_global\_details['bpa\_time\_format\_for\_timeslot']; |
| [9629](#L9629) |  |
| [9630](#L9630) | $convert\_timeslot\_to\_client\_timezone = false; |
| [9631](#L9631) | if( $BookingPress->bpa\_is\_pro\_active() ){ |
| [9632](#L9632) | $convert\_timeslot\_to\_client\_timezone = $BookingPress->bookingpress\_get\_settings( 'show\_bookingslots\_in\_client\_timezone', 'general\_setting' ); |
| [9633](#L9633) | } |
| [9634](#L9634) |  |
| [9635](#L9635) | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
| [9636](#L9636) | ?> |
| [9637](#L9637) | bookingpress\_toggle\_calendar(){ |
| [9638](#L9638) | const vm = this; |
| [9639](#L9639) | vm.$refs.bookingpress\_range\_calendar.togglePopover(); |
| [9640](#L9640) | }, |
| [9641](#L9641) | bookingpress\_clear\_datepicker(){ |
| [9642](#L9642) | const vm = this; |
| [9643](#L9643) | vm.appointment\_date\_range = ''; |
| [9644](#L9644) | }, |
| [9645](#L9645) | bookingpress\_working\_dates\_data\_single( working\_hour\_details, wdate, timeslot ){ |
| [9646](#L9646) |  |
| [9647](#L9647) | const vm = this; |
| [9648](#L9648) | let startTime = timeslot.start\_time || "00:00:00"; |
| [9649](#L9649) | let endTime = timeslot.end\_time || "00:00:00"; |
| [9650](#L9650) |  |
| [9651](#L9651) | let response = {}; |
| [9652](#L9652) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [9653](#L9653) |  |
| [9654](#L9654) | if( wh\_data.store\_start\_time == startTime && wh\_data.store\_end\_time == endTime ){ |
| [9655](#L9655) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9656](#L9656) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [9657](#L9657) | let timezone = wh\_data.store\_offset; |
| [9658](#L9658) |  |
| [9659](#L9659) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9660](#L9660) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9661](#L9661) |  |
| [9662](#L9662) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [9663](#L9663) |  |
| [9664](#L9664) | response.selected\_date = updated\_wdate; |
| [9665](#L9665) | response.start\_time = stTime; |
| [9666](#L9666) | response.end\_time = etTime; |
| [9667](#L9667) | } |
| [9668](#L9668) |  |
| [9669](#L9669) | } |
| [9670](#L9670) |  |
| [9671](#L9671) | return response; |
| [9672](#L9672) | }, |
| [9673](#L9673) | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
| [9674](#L9674) | const vm = this; |
| [9675](#L9675) |  |
| [9676](#L9676) | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
| [9677](#L9677) | let is\_client\_timezone = "<?php echo $convert\_timeslot\_to\_client\_timezone; ?>"; |
| [9678](#L9678) | let updated\_working\_hour\_details = {}; |
| [9679](#L9679) | let available\_dates = []; |
| [9680](#L9680) | let response = {}; |
| [9681](#L9681) | let firstAvailableDate = ""; |
| [9682](#L9682) |  |
| [9683](#L9683) | let overnight\_booking = ("undefined" != typeof response\_data.overnight\_booking\_dates ) ? response\_data.overnight\_booking\_dates : []; |
| [9684](#L9684) |  |
| [9685](#L9685) | let sorted\_working\_hours = []; |
| [9686](#L9686) |  |
| [9687](#L9687) | for( let wdate in working\_hour\_details ){ |
| [9688](#L9688) | let x = 0; |
| [9689](#L9689) | let n = 0; |
| [9690](#L9690) |  |
| [9691](#L9691) | let is\_overnight\_booking = overnight\_booking.includes( wdate ) || false; |
| [9692](#L9692) |  |
| [9693](#L9693) | let overnight\_booking\_date = ""; |
| [9694](#L9694) |  |
| [9695](#L9695) | sorted\_working\_hours[wdate] = working\_hour\_details[ wdate ]; |
| [9696](#L9696) |  |
| [9697](#L9697) | sorted\_working\_hours[wdate].sort( (a,b) => { |
| [9698](#L9698) | return ( parseInt( a.counter\_pos ) < parseInt( b.counter\_pos ) ) ? -1 : 1; |
| [9699](#L9699) | } ); |
| [9700](#L9700) |  |
| [9701](#L9701) | for( let wh\_data of sorted\_working\_hours[wdate] ){ |
| [9702](#L9702) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9703](#L9703) | let end\_datetime = wh\_data.selected\_end\_date + " " + wh\_data.store\_end\_time; |
| [9704](#L9704) | let timezone = wh\_data.store\_offset; |
| [9705](#L9705) |  |
| [9706](#L9706) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9707](#L9707) | wh\_data.client\_start\_time = stTime; |
| [9708](#L9708) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9709](#L9709) | wh\_data.client\_end\_time = etTime; |
| [9710](#L9710) |  |
| [9711](#L9711) | let stTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", start\_datetime, wh\_data, "start", true ); |
| [9712](#L9712) | let etTimeNew = wp.hooks.applyFilters( "bookingpress\_modify\_datetime\_with\_timezone", end\_datetime, wh\_data, "end", true ); |
| [9713](#L9713) |  |
| [9714](#L9714) | let updated\_wdate; |
| [9715](#L9715) | if( "string" == typeof stTimeNew ){ |
| [9716](#L9716) | updated\_wdate = wdate; |
| [9717](#L9717) | } else { |
| [9718](#L9718) | updated\_wdate = stTimeNew.toISOString().split("T")[0]; |
| [9719](#L9719) | } |
| [9720](#L9720) | let updated\_edate; |
| [9721](#L9721) | if( "string" == typeof etTimeNew ){ |
| [9722](#L9722) | updated\_edate = wh\_data.selected\_end\_date; |
| [9723](#L9723) | } else { |
| [9724](#L9724) | updated\_edate = etTimeNew.toISOString().split("T")[0]; |
| [9725](#L9725) | } |
| [9726](#L9726) |  |
| [9727](#L9727) | if( "undefined" != typeof wh\_data.is\_day\_service && true == wh\_data.is\_day\_service ){ |
| [9728](#L9728) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] && updated\_wdate >= vm.jsCurrentDate.toISOString().split("T")[0] ){ |
| [9729](#L9729) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9730](#L9730) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [9731](#L9731) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9732](#L9732) | } |
| [9733](#L9733) | n++; |
| [9734](#L9734) | } else { |
| [9735](#L9735) | continue; |
| [9736](#L9736) | } |
| [9737](#L9737) | } else { |
| [9738](#L9738) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [9739](#L9739) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9740](#L9740) | if( false == is\_overnight\_booking && !available\_dates.includes( updated\_wdate + " 00:00:00" ) ){ |
| [9741](#L9741) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9742](#L9742) | } |
| [9743](#L9743) | n++; |
| [9744](#L9744) | } |
| [9745](#L9745) | } |
| [9746](#L9746) |  |
| [9747](#L9747) | if( "" == firstAvailableDate ){ |
| [9748](#L9748) | firstAvailableDate = ( "undefined" != typeof response\_data.pre\_selected\_date && true == response\_data.pre\_selected\_date && "undefined" != typeof vm.open\_customer\_reschedule\_appointment\_modal && true == vm.open\_customer\_reschedule\_appointment\_modal ) ? response\_data.selected\_date : updated\_wdate; |
| [9749](#L9749) | } |
| [9750](#L9750) |  |
| [9751](#L9751) | wh\_data.client\_date = updated\_wdate; |
| [9752](#L9752) | wh\_data.client\_end\_date = updated\_edate; |
| [9753](#L9753) |  |
| [9754](#L9754) | if( true == is\_overnight\_booking && "" == overnight\_booking\_date ){ |
| [9755](#L9755) | overnight\_booking\_date = updated\_wdate; |
| [9756](#L9756) | if( "undefined" == typeof updated\_working\_hour\_details[ overnight\_booking\_date ] ){ |
| [9757](#L9757) | updated\_working\_hour\_details[ overnight\_booking\_date ] = []; |
| [9758](#L9758) | } |
| [9759](#L9759) | } |
| [9760](#L9760) | wh\_data.is\_both\_next\_day\_time\_v2 = false; |
| [9761](#L9761) |  |
| [9762](#L9762) | if( true == is\_overnight\_booking ){ |
| [9763](#L9763) |  |
| [9764](#L9764) | if( "true" == is\_client\_timezone ){ |
| [9765](#L9765) | wh\_data.is\_next\_day = false; |
| [9766](#L9766) | } |
| [9767](#L9767) |  |
| [9768](#L9768) | if( updated\_edate > updated\_wdate ){ |
| [9769](#L9769) | wh\_data.is\_next\_day = true; |
| [9770](#L9770) | } |
| [9771](#L9771) |  |
| [9772](#L9772) | if( updated\_edate == updated\_wdate && updated\_wdate > overnight\_booking\_date ){ |
| [9773](#L9773) | wh\_data.is\_both\_next\_day\_time\_v2 = true; |
| [9774](#L9774) | wh\_data.is\_next\_day = true; |
| [9775](#L9775) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [9776](#L9776) | } |
| [9777](#L9777) | } |
| [9778](#L9778) |  |
| [9779](#L9779) | if( true == wh\_data.is\_both\_next\_day\_time && wh\_data.client\_end\_date > wh\_data.client\_date ){ |
| [9780](#L9780) | wh\_data.client\_date = wh\_data.client\_end\_date; |
| [9781](#L9781) | } |
| [9782](#L9782) |  |
| [9783](#L9783) | let startTimeHour = stTime.split(":")[0]; |
| [9784](#L9784) |  |
| [9785](#L9785) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [9786](#L9786) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [9787](#L9787) |  |
| [9788](#L9788) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9789](#L9789) | if( "1" == timeformat || "2" == timeformat ){ |
| [9790](#L9790) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [9791](#L9791) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [9792](#L9792) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9793](#L9793) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [9794](#L9794) | formatted\_datetime = formatted\_startTime; |
| [9795](#L9795) | } |
| [9796](#L9796) |  |
| [9797](#L9797) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [9798](#L9798) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [9799](#L9799) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [9800](#L9800) | wh\_data.start\_hour = startTimeHour; |
| [9801](#L9801) |  |
| [9802](#L9802) | if( true == is\_overnight\_booking ){ |
| [9803](#L9803) | updated\_working\_hour\_details[ overnight\_booking\_date ][x] = wh\_data; |
| [9804](#L9804) | if( !available\_dates.includes( overnight\_booking\_date + " 00:00:00" ) ){ |
| [9805](#L9805) | available\_dates.push( overnight\_booking\_date + " 00:00:00" ); |
| [9806](#L9806) | } |
| [9807](#L9807) | } else { |
| [9808](#L9808) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [9809](#L9809) | } |
| [9810](#L9810) |  |
| [9811](#L9811) | x++; |
| [9812](#L9812) | } |
| [9813](#L9813) | } |
| [9814](#L9814) |  |
| [9815](#L9815) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [9816](#L9816) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [9817](#L9817) |  |
| [9818](#L9818) | response.available\_dates = available\_dates; |
| [9819](#L9819) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [9820](#L9820) | response.selected\_date = firstAvailableDate; |
| [9821](#L9821) |  |
| [9822](#L9822) | return response; |
| [9823](#L9823) | }, |
| [9824](#L9824) | bookingpress\_working\_dates\_data\_legacy( working\_hour\_details, response\_data ){ |
| [9825](#L9825) | const vm = this; |
| [9826](#L9826) | let timeformat = "<?php echo esc\_html( $bookigpress\_time\_format\_for\_booking\_form ); ?>"; |
| [9827](#L9827) | let updated\_working\_hour\_details = {}; |
| [9828](#L9828) | let available\_dates = []; |
| [9829](#L9829) | let response = {}; |
| [9830](#L9830) | let firstAvailableDate = ""; |
| [9831](#L9831) | for( let wdate in working\_hour\_details ){ |
| [9832](#L9832) | let x = 0; |
| [9833](#L9833) | let n = 0; |
| [9834](#L9834) |  |
| [9835](#L9835) | for( let wh\_data of working\_hour\_details[ wdate ] ){ |
| [9836](#L9836) | let start\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_start\_time; |
| [9837](#L9837) | let end\_datetime = wh\_data.store\_service\_date + " " + wh\_data.store\_end\_time; |
| [9838](#L9838) | let timezone = wh\_data.store\_offset; |
| [9839](#L9839) |  |
| [9840](#L9840) | let stTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_start\_time, wh\_data, "start" ); |
| [9841](#L9841) | wh\_data.client\_start\_time = stTime; |
| [9842](#L9842) | let etTime = wp.hooks.applyFilters( "bookingpress\_modify\_time\_with\_timezone", wh\_data.store\_end\_time, wh\_data, "end" ); |
| [9843](#L9843) | wh\_data.client\_end\_time = etTime; |
| [9844](#L9844) |  |
| [9845](#L9845) | let updated\_wdate = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", wdate, wh\_data ); |
| [9846](#L9846) |  |
| [9847](#L9847) | if( "undefined" == typeof updated\_working\_hour\_details[ updated\_wdate ] ){ |
| [9848](#L9848) | updated\_working\_hour\_details[ updated\_wdate ] = []; |
| [9849](#L9849) |  |
| [9850](#L9850) | available\_dates.push( updated\_wdate + " 00:00:00" ); |
| [9851](#L9851) | n++; |
| [9852](#L9852) | } |
| [9853](#L9853) |  |
| [9854](#L9854) | if( "" == firstAvailableDate ){ |
| [9855](#L9855) | firstAvailableDate = updated\_wdate; |
| [9856](#L9856) | } |
| [9857](#L9857) |  |
| [9858](#L9858) | wh\_data.client\_date = updated\_wdate; |
| [9859](#L9859) |  |
| [9860](#L9860) | let startTimeHour = stTime.split(":")[0]; |
| [9861](#L9861) |  |
| [9862](#L9862) | let formatted\_startTime = vm.bookingpress\_format\_time( stTime ); |
| [9863](#L9863) | let formatted\_endTime = vm.bookingpress\_format\_time( etTime ); |
| [9864](#L9864) |  |
| [9865](#L9865) | let formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9866](#L9866) | if( "1" == timeformat || "2" == timeformat ){ |
| [9867](#L9867) | formatted\_datetime = formatted\_startTime + " to " + formatted\_endTime; |
| [9868](#L9868) | } else if ( "5" == timeformat || "6" == timeformat ){ |
| [9869](#L9869) | formatted\_datetime = formatted\_startTime + " - " + formatted\_endTime; |
| [9870](#L9870) | } else if( "3" == timeformat || "4" == timeformat ){ |
| [9871](#L9871) | formatted\_datetime = formatted\_startTime; |
| [9872](#L9872) | } |
| [9873](#L9873) |  |
| [9874](#L9874) | wh\_data.formatted\_start\_time = formatted\_startTime; |
| [9875](#L9875) | wh\_data.formatted\_end\_time = formatted\_endTime; |
| [9876](#L9876) | wh\_data.formatted\_start\_end\_time = formatted\_datetime; |
| [9877](#L9877) | wh\_data.start\_hour = startTimeHour; |
| [9878](#L9878) | updated\_working\_hour\_details[ updated\_wdate ][x] = wh\_data; |
| [9879](#L9879) | x++; |
| [9880](#L9880) | } |
| [9881](#L9881) | } |
| [9882](#L9882) |  |
| [9883](#L9883) | available\_dates = wp.hooks.applyFilters( "bookingpress\_modify\_available\_dates\_with\_day\_service", available\_dates, working\_hour\_details, response\_data, vm ); |
| [9884](#L9884) | firstAvailableDate = wp.hooks.applyFilters( "bookingpress\_modify\_first\_available\_date\_with\_day\_service", firstAvailableDate, available\_dates, vm ); |
| [9885](#L9885) |  |
| [9886](#L9886) | response.available\_dates = available\_dates; |
| [9887](#L9887) | response.updated\_working\_hour\_details = updated\_working\_hour\_details; |
| [9888](#L9888) | response.selected\_date = firstAvailableDate; |
| [9889](#L9889) |  |
| [9890](#L9890) | return response; |
| [9891](#L9891) | }, |
| [9892](#L9892) | bookingpress\_format\_time(value){ |
| [9893](#L9893) | var default\_time\_format = "<?php echo esc\_html( $bookingpress\_formatted\_timeslot ); ?>"; |
| [9894](#L9894) | return moment(String(value), "HH:mm:ss").locale("<?php echo esc\_html( $bookingpress\_site\_current\_lang\_moment\_locale ); ?>").format(default\_time\_format) |
| [9895](#L9895) | }, |
| [9896](#L9896) | bookingpress\_categories\_timeslots( timeslot\_details ){ |
| [9897](#L9897) | let afternoon\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_afternoon\_solts\_timing); ?>" ); |
| [9898](#L9898) | let evening\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_evening\_solts\_timing); ?>" ); |
| [9899](#L9899) | let night\_slot\_timings = parseInt( "<?php echo esc\_html($bpa\_night\_solts\_timing); ?>" ); |
| [9900](#L9900) |  |
| [9901](#L9901) | if( "undefined" == typeof timeslot\_details ){ |
| [9902](#L9902) | return {}; |
| [9903](#L9903) | } |
| [9904](#L9904) |  |
| [9905](#L9905) | let service\_timings\_data = { |
| [9906](#L9906) | "morning\_time":[], |
| [9907](#L9907) | "afternoon\_time":[], |
| [9908](#L9908) | "evening\_time":[], |
| [9909](#L9909) | "night\_time":[] |
| [9910](#L9910) | }; |
| [9911](#L9911) | let x = 1; |
| [9912](#L9912) | for( let timeslot\_data of timeslot\_details ){ |
| [9913](#L9913) | if( "undefined" != typeof timeslot\_data && ( "undefined" == typeof timeslot\_data.is\_next\_day || timeslot\_data.is\_next\_day == false) ){ |
| [9914](#L9914) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [9915](#L9915) | if( startHour >= 0 && startHour < afternoon\_slot\_timings ){ |
| [9916](#L9916) | service\_timings\_data.morning\_time.push( timeslot\_data ); |
| [9917](#L9917) | } else if( startHour >= afternoon\_slot\_timings && ( "" == evening\_slot\_timings || startHour < evening\_slot\_timings ) ){ |
| [9918](#L9918) | service\_timings\_data.afternoon\_time.push( timeslot\_data ); |
| [9919](#L9919) | } else if ( startHour >= evening\_slot\_timings && ( "" == night\_slot\_timings || startHour < night\_slot\_timings ) ){ |
| [9920](#L9920) | service\_timings\_data.evening\_time.push( timeslot\_data ); |
| [9921](#L9921) | } else { |
| [9922](#L9922) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [9923](#L9923) | } |
| [9924](#L9924) | x++; |
| [9925](#L9925) | } |
| [9926](#L9926) | } |
| [9927](#L9927) | if( timeslot\_details.length > x ){ |
| [9928](#L9928) | for( let timeslot\_data of timeslot\_details ){ |
| [9929](#L9929) | if( "undefined" != typeof timeslot\_data && "undefined" != typeof timeslot\_data.is\_next\_day && timeslot\_data.is\_next\_day == true ){ |
| [9930](#L9930) | let startHour = parseInt( timeslot\_data.start\_hour ); |
| [9931](#L9931) | service\_timings\_data.night\_time.push( timeslot\_data ); |
| [9932](#L9932) | } |
| [9933](#L9933) | } |
| [9934](#L9934) | } |
| [9935](#L9935) | return service\_timings\_data; |
| [9936](#L9936) | }, |
| [9937](#L9937) | bookingpress\_myappointments\_onload\_func(){ |
| [9938](#L9938) | const vm = this; |
| [9939](#L9939) | if(window.innerWidth <= 576){ |
| [9940](#L9940) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9941](#L9941) | var bookingpress\_uniq\_id = vm.bookingpress\_uniq\_id; |
| [9942](#L9942) | var bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9943](#L9943) | var bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9944](#L9944) | var bookingpress\_container\_top = bookingpress\_container\_vars - 20; |
| [9945](#L9945) | var current\_selected\_tab = vm.current\_selected\_tab\_id; |
| [9946](#L9946) | window.addEventListener("scroll", function(e){ |
| [9947](#L9947) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9948](#L9948) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9949](#L9949) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9950](#L9950) |  |
| [9951](#L9951) | var current\_position = window.scrollY; |
| [9952](#L9952) | if(current\_position >= bookingpress\_container\_top && current\_position <= bookingpress\_container\_bottom){ |
| [9953](#L9953) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9954](#L9954) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9955](#L9955) | }else{ |
| [9956](#L9956) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9957](#L9957) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9958](#L9958) | } |
| [9959](#L9959) | }); |
| [9960](#L9960) | } |
| [9961](#L9961) | window.addEventListener("resize", function(e){ |
| [9962](#L9962) | if(window.innerWidth <= 576){ |
| [9963](#L9963) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9964](#L9964) | var bookingpress\_uniq\_id = vm.bookingpress\_uniq\_id; |
| [9965](#L9965) |  |
| [9966](#L9966) | var bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9967](#L9967) | var bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight); |
| [9968](#L9968) | var bookingpress\_container\_top = bookingpress\_container\_vars - 20; |
| [9969](#L9969) |  |
| [9970](#L9970) |  |
| [9971](#L9971) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9972](#L9972) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9973](#L9973) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9974](#L9974) |  |
| [9975](#L9975) | var current\_position = window.scrollY; |
| [9976](#L9976) |  |
| [9977](#L9977) | if(current\_position >= bookingpress\_container\_top || current\_position <= bookingpress\_container\_bottom){ |
| [9978](#L9978) | if( current\_position > bookingpress\_container\_bottom || current\_position < bookingpress\_container\_top ){ |
| [9979](#L9979) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9980](#L9980) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9981](#L9981) | } else { |
| [9982](#L9982) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [9983](#L9983) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9984](#L9984) | } |
| [9985](#L9985) | }else if(vm.bookingpress\_myappointment\_header\_dynamic\_class != ""){ |
| [9986](#L9986) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [9987](#L9987) | }else{ |
| [9988](#L9988) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [9989](#L9989) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [9990](#L9990) | } |
| [9991](#L9991) |  |
| [9992](#L9992) | window.addEventListener("scroll", function(e){ |
| [9993](#L9993) | bookingpress\_container\_vars = document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop; |
| [9994](#L9994) | bookingpress\_container\_bottom = (document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetTop + document.getElementById("bookingpress\_booking\_form\_"+bookingpress\_uniq\_id).offsetHeight) - (window.innerHeight - 100); |
| [9995](#L9995) | bookingpress\_container\_top = bookingpress\_container\_vars; |
| [9996](#L9996) |  |
| [9997](#L9997) | var current\_position = window.scrollY; |
| [9998](#L9998) |  |
| [9999](#L9999) | if(current\_position >= bookingpress\_container\_top || current\_position <= bookingpress\_container\_bottom){ |
| [10000](#L10000) | if( current\_position > bookingpress\_container\_bottom || current\_position < bookingpress\_container\_top ){ |
| [10001](#L10001) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10002](#L10002) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10003](#L10003) | } else { |
| [10004](#L10004) | vm.bookingpress\_myappointment\_header\_dynamic\_class = "bpa-front\_\_mc--is-sticky"; |
| [10005](#L10005) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [10006](#L10006) | } |
| [10007](#L10007) | }else if(vm.bookingpress\_myappointment\_header\_dynamic\_class != ""){ |
| [10008](#L10008) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = "\_\_bpa-is-sticky"; /\* Change this string \*/ |
| [10009](#L10009) | }else{ |
| [10010](#L10010) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10011](#L10011) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10012](#L10012) | } |
| [10013](#L10013) | }); |
| [10014](#L10014) | }else{ |
| [10015](#L10015) | vm.bookingpress\_myappointment\_header\_dynamic\_class = ""; |
| [10016](#L10016) | vm.bookingpress\_myappointment\_footer\_dynamic\_class = ""; |
| [10017](#L10017) | } |
| [10018](#L10018) | }); |
| [10019](#L10019) | }, |
| [10020](#L10020) | bookingpress\_dynamic\_add\_onload\_myappointment\_methods\_func(){ |
| [10021](#L10021) | const vm = this; |
| [10022](#L10022) | vm.current\_screen\_size = "desktop"; |
| [10023](#L10023) | if(window.outerWidth >= 1200){ |
| [10024](#L10024) | vm.current\_screen\_size = "desktop"; |
| [10025](#L10025) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [10026](#L10026) | vm.current\_screen\_size = "tablet"; |
| [10027](#L10027) | }else if(window.outerWidth < 768){ |
| [10028](#L10028) | vm.current\_screen\_size = "mobile"; |
| [10029](#L10029) | } |
| [10030](#L10030) |  |
| [10031](#L10031) | window.addEventListener('resize', function(event) { |
| [10032](#L10032) | if(window.outerWidth >= 1200){ |
| [10033](#L10033) | vm.current\_screen\_size = "desktop"; |
| [10034](#L10034) | }else if(window.outerWidth < 1200 && window.outerWidth >= 768){ |
| [10035](#L10035) | vm.current\_screen\_size = "tablet"; |
| [10036](#L10036) | }else if(window.outerWidth < 768){ |
| [10037](#L10037) | vm.current\_screen\_size = "mobile"; |
| [10038](#L10038) | } |
| [10039](#L10039) | /\* vm.current\_screen\_size = document.getElementById("bpa-front-customer-panel-container").offsetWidth; \*/ |
| [10040](#L10040) | }); |
| [10041](#L10041) | }, |
| [10042](#L10042) | toggleBusy() { |
| [10043](#L10043) | if(this.is\_display\_loader == '1'){ |
| [10044](#L10044) | this.is\_display\_loader = '0'; |
| [10045](#L10045) | }else{ |
| [10046](#L10046) | this.is\_display\_loader = '1'; |
| [10047](#L10047) | } |
| [10048](#L10048) | }, |
| [10049](#L10049) | bookingpress\_load\_mybooking\_form(){ |
| [10050](#L10050) | const vm = this; |
| [10051](#L10051) | setTimeout(function(){ |
| [10052](#L10052) | vm.is\_front\_appointment\_empty\_loader = "0"; |
| [10053](#L10053) | setTimeout(function(){ |
| [10054](#L10054) | if(document.getElementById("bpa-front-customer-panel-container") != null){ |
| [10055](#L10055) | document.getElementById("bpa-front-customer-panel-container").style.display = "block"; |
| [10056](#L10056) | } |
| [10057](#L10057) | if(document.getElementById("bpa-front-data-empty-view--my-bookings") != null){ |
| [10058](#L10058) | document.getElementById("bpa-front-data-empty-view--my-bookings").style.display = "flex"; |
| [10059](#L10059) | } |
| [10060](#L10060) | }, 500); |
| [10061](#L10061) | }, 1000); |
| [10062](#L10062) | }, |
| [10063](#L10063) | loadFrontAppointments( is\_display\_loader = 0 ) { |
| [10064](#L10064) |  |
| [10065](#L10065) | const vm = this; |
| [10066](#L10066) | vm.disable\_my\_appointments\_apply = true; |
| [10067](#L10067) | this.toggleBusy(); |
| [10068](#L10068) | var bookingpress\_search\_data = { 'search\_appointment':this.search\_appointment,'selected\_date\_range': this.appointment\_date\_range}; |
| [10069](#L10069) |  |
| [10070](#L10070) | if(is\_display\_loader == 1 ){ |
| [10071](#L10071) | vm.is\_front\_my\_appointment\_empty\_loader = "1"; |
| [10072](#L10072) | } |
| [10073](#L10073) |  |
| [10074](#L10074) | var bkp\_wpnonce\_pre = vm.bookingpress\_created\_nonce; |
| [10075](#L10075) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10076](#L10076) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10077](#L10077) | { |
| [10078](#L10078) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10079](#L10079) | } |
| [10080](#L10080) | else { |
| [10081](#L10081) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10082](#L10082) | } |
| [10083](#L10083) |  |
| [10084](#L10084) | var postData = { action:'bookingpress\_get\_customer\_appointments', perpage:this.per\_page, currentpage:this.currentPage, search\_data: bookingpress\_search\_data,\_wpnonce:bkp\_wpnonce\_pre\_fetch}; |
| [10085](#L10085) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [10086](#L10086) | .then( function (response) { |
| [10087](#L10087) | this.toggleBusy(); |
| [10088](#L10088) | vm.disable\_my\_appointments\_apply = false; |
| [10089](#L10089) | this.items = response.data.items; |
| [10090](#L10090) | this.total\_records = parseInt(response.data.total\_records); |
| [10091](#L10091) | this.is\_display\_pagination = 0; |
| [10092](#L10092) |  |
| [10093](#L10093) | if( is\_display\_loader == 1){ |
| [10094](#L10094) | vm.is\_front\_appointment\_empty\_loader = "0"; |
| [10095](#L10095) | vm.is\_front\_my\_appointment\_empty\_loader = "0"; |
| [10096](#L10096) | } |
| [10097](#L10097) |  |
| [10098](#L10098) | if(this.total\_records > 10) { |
| [10099](#L10099) | this.is\_display\_pagination = 1; |
| [10100](#L10100) | } |
| [10101](#L10101) |  |
| [10102](#L10102) | this.bookingpress\_user\_fullname = response.data.customer\_details.bookingpress\_user\_fullname; |
| [10103](#L10103) | this.bookingpress\_user\_email = response.data.customer\_details.bookingpress\_user\_email; |
| [10104](#L10104) | this.bookingpress\_avatar\_url = response.data.customer\_details.bookingpress\_avatar\_url; |
| [10105](#L10105) | this.bookingpress\_use\_placeholder = response.data.customer\_details.bookingpress\_use\_placeholder; |
| [10106](#L10106) | }.bind(this) ) |
| [10107](#L10107) | .catch( function (error) { |
| [10108](#L10108) | vm.disable\_my\_appointments\_apply = false; |
| [10109](#L10109) | vm.$notify({ |
| [10110](#L10110) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [10111](#L10111) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [10112](#L10112) | type: 'error', |
| [10113](#L10113) | customClass: 'error\_notification', |
| [10114](#L10114) | }); |
| [10115](#L10115) | }); |
| [10116](#L10116) | }, |
| [10117](#L10117) | get\_formatted\_date(iso\_date){ |
| [10118](#L10118) |  |
| [10119](#L10119) | if( true == /(\d{2})\T/.test( iso\_date ) ){ |
| [10120](#L10120) | let date\_time\_arr = iso\_date.split('T'); |
| [10121](#L10121) | return date\_time\_arr[0]; |
| [10122](#L10122) | } |
| [10123](#L10123) | var \_\_date = new Date(iso\_date); |
| [10124](#L10124) | var \_\_year = \_\_date.getFullYear(); |
| [10125](#L10125) | var \_\_month = \_\_date.getMonth()+1; |
| [10126](#L10126) | var \_\_day = \_\_date.getDate(); |
| [10127](#L10127) | if (\_\_day < 10) { |
| [10128](#L10128) | \_\_day = '0' + \_\_day; |
| [10129](#L10129) | } |
| [10130](#L10130) | if (\_\_month < 10) { |
| [10131](#L10131) | \_\_month = '0' + \_\_month; |
| [10132](#L10132) | } |
| [10133](#L10133) | var formatted\_date = \_\_year+'-'+\_\_month+'-'+\_\_day; |
| [10134](#L10134) | return formatted\_date; |
| [10135](#L10135) | }, |
| [10136](#L10136) | cancelAppointment( appointment\_id){ |
| [10137](#L10137) | const vm = new Vue(); |
| [10138](#L10138) | const vm2 = this; |
| [10139](#L10139) | vm2.is\_display\_loader = '1'; |
| [10140](#L10140) | vm2.is\_disabled = true; |
| [10141](#L10141) | var cancel\_id = appointment\_id; |
| [10142](#L10142) |  |
| [10143](#L10143) | var bkp\_wpnonce\_pre = vm2.bookingpress\_created\_nonce; |
| [10144](#L10144) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10145](#L10145) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10146](#L10146) | { |
| [10147](#L10147) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10148](#L10148) | } |
| [10149](#L10149) | else { |
| [10150](#L10150) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10151](#L10151) | } |
| [10152](#L10152) |  |
| [10153](#L10153) | var appointment\_cancel\_data = { action: 'bookingpress\_cancel\_appointment', cancel\_id: cancel\_id, \_wpnonce: bkp\_wpnonce\_pre\_fetch }; |
| [10154](#L10154) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( appointment\_cancel\_data ) ) |
| [10155](#L10155) | .then(function(response){ |
| [10156](#L10156) | vm2.is\_display\_loader = '0'; |
| [10157](#L10157) | vm2.is\_disabled = false; |
| [10158](#L10158) | if(response.data.variant != 'error'){ |
| [10159](#L10159) | window.location.href = response.data.redirect\_url; |
| [10160](#L10160) | }else{ |
| [10161](#L10161) | vm2.$notify({ |
| [10162](#L10162) | title: response.data.title, |
| [10163](#L10163) | message: response.data.msg, |
| [10164](#L10164) | type: response.data.variant, |
| [10165](#L10165) | customClass: response.data.variant+'\_notification', |
| [10166](#L10166) | }); |
| [10167](#L10167) | vm2.loadFrontAppointments(); |
| [10168](#L10168) | } |
| [10169](#L10169) | }).catch(function(error){ |
| [10170](#L10170) | console.log(error); |
| [10171](#L10171) | vm2.$notify({ |
| [10172](#L10172) | title: '<?php esc\_html\_e('Error', 'bookingpress-appointment-booking'); ?>', |
| [10173](#L10173) | message: '<?php esc\_html\_e('Something went wrong..', 'bookingpress-appointment-booking'); ?>', |
| [10174](#L10174) | type: 'error', |
| [10175](#L10175) | customClass: 'error\_notification', |
| [10176](#L10176) | }); |
| [10177](#L10177) | }); |
| [10178](#L10178) | }, |
| [10179](#L10179) | resetFilter(){ |
| [10180](#L10180) | const vm = this; |
| [10181](#L10181) | if(vm.search\_appointment != '' || vm.appointment\_date\_range != '') { |
| [10182](#L10182) | vm.search\_appointment = ''; |
| [10183](#L10183) | vm.appointment\_date\_range = ''; |
| [10184](#L10184) | vm.loadFrontAppointments(); |
| [10185](#L10185) | } |
| [10186](#L10186) | }, |
| [10187](#L10187) | bookingpress\_activate\_myboooking\_tab(tab\_name){ |
| [10188](#L10188) | const vm = this; |
| [10189](#L10189) | vm.bookingpress\_my\_booking\_current\_tab = tab\_name; |
| [10190](#L10190) | <?php |
| [10191](#L10191) | do\_action('bookingpress\_activate\_my\_booking\_tab\_data'); |
| [10192](#L10192) | ?> |
| [10193](#L10193) | }, |
| [10194](#L10194) | bookingpress\_open\_cancel\_drawer(){ |
| [10195](#L10195) | const vm = this; |
| [10196](#L10196) | vm.bookingpress\_cancel\_appointment\_drawer = true; |
| [10197](#L10197) | vm.bookingpress\_hide\_drawer\_overlay('bpa-front-cp-cancel-mob-drawer'); |
| [10198](#L10198) | }, |
| [10199](#L10199) | bookingpress\_close\_cancel\_drawer(){ |
| [10200](#L10200) | const vm = this; |
| [10201](#L10201) | vm.bookingpress\_cancel\_appointment\_drawer = false; |
| [10202](#L10202) | }, |
| [10203](#L10203) | bookingpress\_full\_row\_clickable(row, column, event){ |
| [10204](#L10204) | const vm = this; |
| [10205](#L10205) | let target = event.target; |
| [10206](#L10206) | let getParent = vm.bookingpress\_get\_parent\_node( target, '.bpa-ma--action-btn-wrapper' ); |
| [10207](#L10207) | if( 0 < getParent.length && getParent[0] != null ){ |
| [10208](#L10208) | /\* Do Nothing \*/ |
| [10209](#L10209) | } else { |
| [10210](#L10210) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10211](#L10211) | } |
| [10212](#L10212) | }, |
| [10213](#L10213) | bookingpress\_get\_parent\_node( elem, selector ){ |
| [10214](#L10214) | if (!Element.prototype.matches) { |
| [10215](#L10215) | Element.prototype.matches = Element.prototype.matchesSelector || |
| [10216](#L10216) | Element.prototype.mozMatchesSelector || |
| [10217](#L10217) | Element.prototype.msMatchesSelector || |
| [10218](#L10218) | Element.prototype.oMatchesSelector || |
| [10219](#L10219) | Element.prototype.webkitMatchesSelector || |
| [10220](#L10220) | function(s) { |
| [10221](#L10221) | var matches = (this.document || this.ownerDocument).querySelectorAll(s), |
| [10222](#L10222) | i = matches.length; |
| [10223](#L10223) | while (--i >= 0 && matches.item(i) !== this) {} |
| [10224](#L10224) | return i > -1; |
| [10225](#L10225) | }; |
| [10226](#L10226) | } |
| [10227](#L10227) |  |
| [10228](#L10228) | var parents = []; |
| [10229](#L10229) |  |
| [10230](#L10230) | for (; elem && elem !== document; elem = elem.parentNode) { |
| [10231](#L10231) | if (selector) { |
| [10232](#L10232) | if (elem.matches(selector)) { |
| [10233](#L10233) | parents.push(elem); |
| [10234](#L10234) | } |
| [10235](#L10235) | continue; |
| [10236](#L10236) | } |
| [10237](#L10237) | parents.push(elem); |
| [10238](#L10238) | } |
| [10239](#L10239) |  |
| [10240](#L10240) | return parents; |
| [10241](#L10241) | }, |
| [10242](#L10242) | bookingpress\_row\_expand(row, expanded){ |
| [10243](#L10243) | const vm = this; |
| [10244](#L10244) | if(vm.bookingpress\_previous\_row\_obj != ''){ |
| [10245](#L10245) | vm.$refs.multipleTable.toggleRowExpansion(vm.bookingpress\_previous\_row\_obj, false); |
| [10246](#L10246) | if(vm.bookingpress\_previous\_row\_obj != row){ |
| [10247](#L10247) | vm.$refs.multipleTable.toggleRowExpansion(vm.bookingpress\_previous\_row\_obj); |
| [10248](#L10248) | vm.bookingpress\_previous\_row\_obj = row; |
| [10249](#L10249) | }else{ |
| [10250](#L10250) | if(expanded.length == undefined){ |
| [10251](#L10251) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10252](#L10252) | } |
| [10253](#L10253) | vm.bookingpress\_previous\_row\_obj = ''; |
| [10254](#L10254) | } |
| [10255](#L10255) | }else{ |
| [10256](#L10256) | if(expanded.length == undefined){ |
| [10257](#L10257) | vm.$refs.multipleTable.toggleRowExpansion(row); |
| [10258](#L10258) | } |
| [10259](#L10259) | vm.bookingpress\_previous\_row\_obj = row; |
| [10260](#L10260) | } |
| [10261](#L10261) | if(typeof vm.bookingpress\_reschedule\_drawer != "undefined") { |
| [10262](#L10262) | vm.bookingpress\_reschedule\_drawer = false; |
| [10263](#L10263) | } |
| [10264](#L10264) | if(typeof vm.bookingpress\_refund\_appointment\_drawer != "undefined") { |
| [10265](#L10265) | vm.bookingpress\_refund\_appointment\_drawer = false; |
| [10266](#L10266) | } |
| [10267](#L10267) | if(typeof vm.bookingpress\_cancel\_appointment\_drawer != "undefined") { |
| [10268](#L10268) | vm.bookingpress\_cancel\_appointment\_drawer = false; |
| [10269](#L10269) | } |
| [10270](#L10270) | }, |
| [10271](#L10271) | bookingpress\_cancel\_delete\_account(){ |
| [10272](#L10272) | const vm = this; |
| [10273](#L10273) | if( 1 == vm.allow\_customer\_edit\_profile ){ |
| [10274](#L10274) | tab\_name = "edit\_account"; |
| [10275](#L10275) | } else { |
| [10276](#L10276) | tab\_name = "my\_appointment"; |
| [10277](#L10277) | } |
| [10278](#L10278) | vm.bookingpress\_my\_booking\_current\_tab = tab\_name; |
| [10279](#L10279) | }, |
| [10280](#L10280) | bookingpress\_delete\_account(){ |
| [10281](#L10281) |  |
| [10282](#L10282) | var bkp\_wpnonce\_pre = "<?php echo esc\_html(wp\_create\_nonce('bpa\_wp\_nonce')); ?>"; |
| [10283](#L10283) | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
| [10284](#L10284) | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null) |
| [10285](#L10285) | { |
| [10286](#L10286) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
| [10287](#L10287) | } |
| [10288](#L10288) | else { |
| [10289](#L10289) | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
| [10290](#L10290) | } |
| [10291](#L10291) | var postData = { action: "bookingpress\_delete\_account", \_wpnonce:bkp\_wpnonce\_pre\_fetch }; |
| [10292](#L10292) | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
| [10293](#L10293) | .then( function (response) { |
| [10294](#L10294) | if(response.variant != "error"){ |
| [10295](#L10295) | location.reload(); |
| [10296](#L10296) | }else{ |
| [10297](#L10297) | vm.$notify({ |
| [10298](#L10298) | title: response.data.title, |
| [10299](#L10299) | message: response.data.msg, |
| [10300](#L10300) | type: response.data.variant, |
| [10301](#L10301) | customClass: "error\_notification", |
| [10302](#L10302) | }); |
| [10303](#L10303) | } |
| [10304](#L10304) | }.bind(this) ) |
| [10305](#L10305) | .catch( function (error) { |
| [10306](#L10306) | console.log(error); |
| [10307](#L10307) | }); |
| [10308](#L10308) | }, |
| [10309](#L10309) | bookingpress\_hide\_drawer\_overlay(selector\_class){ |
| [10310](#L10310) | setTimeout(function(){ |
| [10311](#L10311) | if(document.getElementsByClassName(selector\_class).length > 0 && document.getElementsByClassName("v-modal").length > 0){ |
| [10312](#L10312) | document.getElementsByClassName("v-modal")[0].style.display = "none"; |
| [10313](#L10313) | } |
| [10314](#L10314) | },2); |
| [10315](#L10315) | }, |
| [10316](#L10316) | <?php |
| [10317](#L10317) | do\_action('bookingpress\_front\_appointment\_add\_vue\_method'); |
| [10318](#L10318) | } |
| [10319](#L10319) | } |
| [10320](#L10320) | } |
| [10321](#L10321) |  |
| [10322](#L10322) | global $bookingpress\_appointment\_bookings, $bookingpress\_front\_vue\_data\_fields,$bookingpress\_front\_appointment\_vue\_data\_fields, $bookingpress\_version; |
| [10323](#L10323) | $bookingpress\_appointment\_bookings = new bookingpress\_appointment\_bookings(); |
| [10324](#L10324) | $bookingpress\_options              = $bookingpress\_global\_options->bookingpress\_global\_options(); |
| [10325](#L10325) | $bookingpress\_country\_list         = $bookingpress\_options['country\_lists']; |
| [10326](#L10326) |  |
| [10327](#L10327) |  |
| [10328](#L10328) | $bookingpress\_front\_vue\_data\_fields             = array( |
| [10329](#L10329) | 'appointment\_services\_list'   => array(), |
| [10330](#L10330) | 'appointment\_formdata'        => array( |
| [10331](#L10331) | 'appointment\_selected\_customer' => get\_current\_user\_id(), |
| [10332](#L10332) | 'appointment\_selected\_service'  => '', |
| [10333](#L10333) | 'appointment\_booked\_date'       => date('Y-m-d', current\_time('timestamp')), |
| [10334](#L10334) | 'appointment\_booked\_time'       => '', |
| [10335](#L10335) | 'appointment\_on\_site\_enabled'   => false, |
| [10336](#L10336) | ), |
| [10337](#L10337) | 'phone\_countries\_details'     => json\_decode($bookingpress\_country\_list), |
| [10338](#L10338) | 'final\_payable\_amount'        => '', |
| [10339](#L10339) | 'activeStepNumber'            => 0, |
| [10340](#L10340) | 'service\_categories'          => array(), |
| [10341](#L10341) | 'bookingpress\_all\_services'   => array(), |
| [10342](#L10342) | 'services\_data'               => array(), |
| [10343](#L10343) | 'service\_timing'              => array(), |
| [10344](#L10344) | 'no\_timeslot\_available'       => false, |
| [10345](#L10345) | 'on\_site\_payment'             => false, |
| [10346](#L10346) | 'paypal\_payment'              => false, |
| [10347](#L10347) | 'appointment\_step\_form\_data'  => array( |
| [10348](#L10348) | 'selected\_category'              => '', |
| [10349](#L10349) | 'selected\_cat\_name'              => '', |
| [10350](#L10350) | 'selected\_service'               => '', |
| [10351](#L10351) | 'selected\_service\_name'          => '', |
| [10352](#L10352) | 'selected\_service\_price'         => '', |
| [10353](#L10353) | 'service\_price\_without\_currency' => 0, |
| [10354](#L10354) | 'selected\_date'                  => date('Y-m-d', current\_time('timestamp')), |
| [10355](#L10355) | 'selected\_end\_date'              => '', |
| [10356](#L10356) | 'selected\_start\_time'            => '', |
| [10357](#L10357) | 'selected\_end\_time'              => '', |
| [10358](#L10358) | 'customer\_email'                 => '', |
| [10359](#L10359) | 'selected\_payment\_method'        => '', |
| [10360](#L10360) | 'customer\_phone\_country'         => 'us', |
| [10361](#L10361) | 'total\_services'                 => '', |
| [10362](#L10362) | 'total\_category'                 => '', |
| [10363](#L10363) | 'selected\_service\_duration'      => '', |
| [10364](#L10364) | 'selected\_service\_duration\_unit' => '', |
| [10365](#L10365) | 'is\_enable\_validations'          => 1, |
| [10366](#L10366) | 'check\_bookingpress\_username\_set' => '0', |
| [10367](#L10367) | 'bpa\_check\_user\_login'           => '0', |
| [10368](#L10368) | ), |
| [10369](#L10369) | 'customer\_details\_rule'       => array( |
| [10370](#L10370) | 'customer\_name'  => array( |
| [10371](#L10371) | 'required' => true, |
| [10372](#L10372) | 'message'  => esc\_html\_\_('Please enter customer name', 'bookingpress-appointment-booking'), |
| [10373](#L10373) | 'trigger'  => 'blur', |
| [10374](#L10374) | ), |
| [10375](#L10375) | 'customer\_email' => array( |
| [10376](#L10376) | 'required' => true, |
| [10377](#L10377) | 'message'  => esc\_html\_\_('Please enter customer email', 'bookingpress-appointment-booking'), |
| [10378](#L10378) | 'trigger'  => 'blur', |
| [10379](#L10379) | ), |
| [10380](#L10380) | ), |
| [10381](#L10381) | 'current\_selected\_tab\_id'     => 1, |
| [10382](#L10382) | 'previous\_selected\_tab\_id'    => 1, |
| [10383](#L10383) | 'next\_selected\_tab\_id'        => '2', |
| [10384](#L10384) | 'isLoadTimeLoader'            => '0', |
| [10385](#L10385) | 'isServiceLoadTimeLoader'     => '0', |
| [10386](#L10386) | 'isLoadDateTimeCalendarLoad'  => '0', |
| [10387](#L10387) | 'isLoadBookingLoader'         => '0', |
| [10388](#L10388) | 'isHoldBookingRequest'       => false, |
| [10389](#L10389) | 'isBookingDisabled'           => false, |
| [10390](#L10390) | 'displayResponsiveCalendar'   => '0', |
| [10391](#L10391) | 'display\_service\_description' => '0', |
| [10392](#L10392) | 'bookingpress\_container\_dynamic\_class' => '', |
| [10393](#L10393) | 'bookingpress\_footer\_dynamic\_class' => '', |
| [10394](#L10394) | 'bookingpress\_current\_tab' => 'service', |
| [10395](#L10395) | 'bookingpress\_next\_tab' => 'datetime', |
| [10396](#L10396) | 'bookingpress\_version' => $bookingpress\_version, |
| [10397](#L10397) | 'bookngpress\_previous\_tab' => '', |
| [10398](#L10398) | 'prevent\_verification\_on\_load' => false |
| [10399](#L10399) | ); |
| [10400](#L10400) |  |
| [10401](#L10401) | $bookingpress\_front\_appointment\_vue\_data\_fields = array( |
| [10402](#L10402) | 'items'                    => array(), |
| [10403](#L10403) | 'search\_appointment'       => '', |
| [10404](#L10404) | 'appointment\_date\_range'   => array(), |
| [10405](#L10405) | 'appointment\_service\_name' => '', |
| [10406](#L10406) | 'appointment\_date'         => '', |
| [10407](#L10407) | 'appointment\_duration'     => '', |
| [10408](#L10408) | 'appointment\_status'       => '', |
| [10409](#L10409) | 'appointment\_payment'      => '', |
| [10410](#L10410) | 'is\_disabled'              => false, |
| [10411](#L10411) | 'is\_front\_appointment\_empty\_loader' => '1', |
| [10412](#L10412) | 'is\_front\_my\_appointment\_empty\_loader' => '0', |
| [10413](#L10413) | 'bookingpress\_is\_user\_logged\_in' => '0', |
| [10414](#L10414) | 'per\_page' => 10, |
| [10415](#L10415) | 'pagination\_length' => 10, |
| [10416](#L10416) | 'currentPage' => 1, |
| [10417](#L10417) | 'total\_records' => 0, |
| [10418](#L10418) | 'bookingpress\_version' => $bookingpress\_version, |
| [10419](#L10419) | 'hide\_on\_single\_page' => true, |
| [10420](#L10420) | ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?format=txt)
* [Original Format](/export/3220813/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_50339665_20250111_194744.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress <= 1.1.16 - Authenticated (Subscriber+) SQL Injection

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress <= 1.1.16 - Authenticated (Subscriber+) SQL Injection

5.3

**Improper Neutralization of Special Elements used in an SQL Command ('SQL Injection')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:H/PR:L/UI:N/S:U/C:H/I:N/A:N)

| CVE | [CVE-2024-10540](https://www.cve.org/CVERecord?id=CVE-2024-10540) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | November 1, 2024 |
| Last Updated | November 2, 2024 |
| Researcher | [Arkadiusz Hydzik](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/arkadiusz-hydzik) |

### Description

The Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress plugin for WordPress is vulnerable to SQL Injection via the 'service' parameter of the bookingpress\_form shortcode in all versions up to, and including, 1.1.16 due to insufficient escaping on the user supplied parameter and lack of sufficient preparation on the existing SQL query. This makes it possible for authenticated attackers, with Subscriber-level access and above, to append additional SQL queries into already existing queries that can be used to extract sensitive information from the database.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bookingpress-appointment-booking/trunk/core/classes/class.bookingpress.php#L358)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php#L3683)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php#L4620)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3179229/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1116-authenticated-subscriber-sql-injection&t=Appointment%20Booking%20Calendar%20Plugin%20and%20Scheduling%20Plugin%20%E2%80%93%20BookingPress%20%3C%3D%201.1.16%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1116-authenticated-subscriber-sql-injection&text=Appointment%20Booking%20Calendar%20Plugin%20and%20Scheduling%20Plugin%20%E2%80%93%20BookingPress%20%3C%3D%201.1.16%20-%20Authenticated%20%28Subscriber%2B%29%20SQL%20Injection "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fbookingpress-appointment-booking%2Fappointment-booking-calendar-plugin-and-scheduling-plugin-bookingpress-1116-authenticated-subscriber-sql-injection "LinkedIn")
Email

## Vulnerability Details for Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress

#### [Appointment Booking Calendar Plugin and Scheduling Plugin – BookingPress](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/bookingpress-appointment-booking)

| Software Type | Plugin |
| --- | --- |
| Software Slug | bookingpress-appointment-booking [(view on wordpress.org)](https://wordpress.org/plugins/bookingpress-appointment-booking) |
| Patched? | Yes |
| Remediation | Update to version 1.1.17, or a newer patched version |
| Affected Version | * <= 1.1.16 |
| Patched Version | * 1.1.17 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


