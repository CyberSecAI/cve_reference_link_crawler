

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3179229%2Fbookingpress-appointment-booking%2Ftrunk%2Fcore%2Fclasses%2Ffrontend%2Fclass.bookingpress_appointment_bookings.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3175695/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3175695 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")
* [Next Change](/changeset/3179779/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Changeset 3179779 for bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php") →

---

# Changeset [3179229](/changeset/3179229 "Show full changeset") for [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/31/2024 06:28:26 AM
([2 months](/timeline?from=2024-10-31T06%3A28%3A26Z&precision=second "See timeline at 10/31/2024 06:28:26 AM") ago)

Author:
reputeinfosystems
Message:
# 1.1.17

* Minor bug fixes

File:

1 edited

* [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229 "Show entry in browser")
  (modified)
  ([40 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress\_appointment\_bookings.php](/changeset/3179229/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php "Show the changeset 3179229 restricted to bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php")

  | [r3175695](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L165 "Show revision 3175695 of this file in browser") | [r3179229](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L165 "Show revision 3179229 of this file in browser") |  |
  | --- | --- | --- |
  | 165 | 165 | add\_action( 'wp\_ajax\_bookingpress\_update\_elementor\_widgets', array( $this, 'bookingpress\_elementor\_pre\_update\_check') ); |
  | 166 | 166 |  |
  | 167 |  | ~~add\_filter( 'bookingpress\_dynamic\_next\_page\_request\_filter', array( $this, 'bookingpress\_dynamic\_next\_page\_request\_filter\_func'), 1000);~~ |
  | 168 |  |  |
  | 169 |  | ~~}~~ |
  | 170 |  |  |
  | 171 |  | ~~function bookingpress\_dynamic\_next\_page\_request\_filter\_func( $bookingpress\_dynamic\_next\_page\_request\_filter ){~~ |
  | 172 |  |  |
  | 173 |  | ~~global $BookingPress;~~ |
  | 174 |  |  |
  | 175 |  | ~~$bookingpress\_step\_navigation\_token\_postdata = '';~~ |
  | 176 |  | ~~$bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata );~~ |
  | 177 |  |  |
  | 178 |  | ~~$bookingpress\_use\_legacy\_functions = 'false';~~ |
  | 179 |  | ~~if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){~~ |
  | 180 |  | ~~$bookingpress\_use\_legacy\_functions = 'true';~~ |
  | 181 |  | ~~}~~ |
  | 182 |  |  |
  | 183 |  | ~~$bookingpress\_dynamic\_next\_page\_request\_filter .= '~~ |
  | 184 |  | ~~let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'";~~ |
  | 185 |  | ~~if( "datetime" == vm.bookingpress\_sidebar\_step\_data[ current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ){~~ |
  | 186 |  | ~~let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date;~~ |
  | 187 |  | ~~let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0];~~ |
  | 188 |  |  |
  | 189 |  | ~~var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'";~~ |
  | 190 |  | ~~var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce");~~ |
  | 191 |  | ~~if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){~~ |
  | 192 |  | ~~bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre;~~ |
  | 193 |  | ~~}else {~~ |
  | 194 |  | ~~bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value;~~ |
  | 195 |  | ~~}~~ |
  | 196 |  |  |
  | 197 |  | ~~let postData = {~~ |
  | 198 |  | ~~action: "bpa\_set\_timeslot\_token",~~ |
  | 199 |  | ~~tokenData: selected\_token\_data,~~ |
  | 200 |  | ~~selectedDate: appointment\_selected\_date,~~ |
  | 201 |  | ~~\_wpnonce:bkp\_wpnonce\_pre\_fetch~~ |
  | 202 |  | ~~};~~ |
  | 203 |  |  |
  | 204 |  | ~~'.$bookingpress\_step\_navigation\_token\_postdata.'~~ |
  | 205 |  |  |
  | 206 |  | ~~axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) )~~ |
  | 207 |  | ~~.then( function (response) {~~ |
  | 208 |  | ~~}.bind(this) )~~ |
  | 209 |  | ~~.catch( function (error) {~~ |
  | 210 |  | ~~});~~ |
  | 211 |  | ~~}~~ |
  | 212 |  | ~~';~~ |
  | 213 |  |  |
  | 214 |  | ~~return $bookingpress\_dynamic\_next\_page\_request\_filter;~~ |
  | 215 | 167 | } |
  | 216 | 168 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1206) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1158) |  |
  | 1206 | 1158 | $content .= '</div>'; |
  | 1207 | 1159 |  |
  | 1208 |  | return ~~do\_shortcode($content)~~; |
  |  | 1160 | return $content; |
  | 1209 | 1161 | } |
  | 1210 | 1162 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1639) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1591) |  |
  | 1639 | 1591 | $response['stop\_check'] = $entire\_month\_details['stop\_check']; |
  | 1640 | 1592 | $response['working\_hour\_timing\_token'] = $entire\_month\_details['working\_hour\_timing\_token']; |
  |  | 1593 | $response['bpa\_disabled\_dates'] = $entire\_month\_details['bpa\_disabled\_dates']; |
  | 1641 | 1594 |  |
  | 1642 | 1595 | $end\_ms = microtime( true ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1725) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1678) |  |
  | 1725 | 1678 | $bookingpress\_selected\_service = $bookingpress\_appointment\_data['selected\_service']; |
  | 1726 | 1679 | } |
  | 1727 |  |  |
  | 1728 | 1680 |  |
  | 1729 | 1681 | /\*\* Modify get available time of booking if the service expiration time is set \*/ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1734) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1686) |  |
  | 1734 | 1686 | $max\_service\_capacity = 1; |
  | 1735 | 1687 | $max\_service\_capacity = apply\_filters( 'bookingpress\_retrieve\_capacity', $max\_service\_capacity, $bookingpress\_selected\_service ); |
  | 1736 |  |  |
  | 1737 |  | /\*\* Minimum Time required before booking start \*/ |
  | 1738 |  | /\*\* Minimum Time required before booking end \*/ |
  |  | 1688 |  |
  |  | 1689 | $bookingpress\_selected\_staffmember\_id = !empty($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) ? intval($bookingpress\_appointment\_data['bookingpress\_selected\_staff\_member\_details']['selected\_staff\_member\_id']) : ''; |
  | 1739 | 1690 |  |
  | 1740 | 1691 | if( !empty( $start\_date ) ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1756) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1707) |  |
  | 1756 | 1707 |  |
  | 1757 | 1708 | $selected\_date = !empty( $\_REQUEST['selected\_date'] ) ? sanitize\_text\_field( $\_REQUEST['selected\_date'] ) : ""; |
  | 1758 |  |  |
  |  | 1709 |  |
  |  | 1710 | $selected\_service\_duration\_unit = (isset($bookingpress\_appointment\_data['selected\_service\_duration\_unit']))?$bookingpress\_appointment\_data['selected\_service\_duration\_unit']:''; |
  |  | 1711 | $selected\_service\_duration = (isset($bookingpress\_appointment\_data['selected\_service\_duration']))?$bookingpress\_appointment\_data['selected\_service\_duration']:0; |
  |  | 1712 |  |
  |  | 1713 | $selected\_service\_duration\_in\_min = ''; |
  |  | 1714 | if( 'm' == $selected\_service\_duration\_unit ){ |
  |  | 1715 | $selected\_service\_duration\_in\_min = $selected\_service\_duration; |
  |  | 1716 | } else { |
  |  | 1717 | if( 'h' == $selected\_service\_duration\_unit ){ |
  |  | 1718 | $selected\_service\_duration\_in\_min = ( MINUTE\_IN\_SECONDS \* $selected\_service\_duration ); |
  |  | 1719 | } |
  |  | 1720 | } |
  |  | 1721 |  |
  |  | 1722 | $bookingpress\_start\_date\_with\_time = date('Y-m-d H:i:s', current\_time( 'timestamp') ); |
  |  | 1723 |  |
  |  | 1724 | $bookingpress\_start\_date\_initial = $bookingpress\_start\_date; |
  |  | 1725 |  |
  |  | 1726 | /\*\* apply filter to modify start date. in case of Minimum Time Required Booking \*/ |
  |  | 1727 | $bookingpress\_start\_date = apply\_filters( 'bookingpress\_modify\_disable\_date\_start\_date', $bookingpress\_start\_date, $bookingpress\_selected\_service, $bookingpress\_start\_date\_with\_time ); |
  |  | 1728 |  |
  |  | 1729 | $bookingpress\_start\_date\_without\_time = date('Y-m-d', strtotime( $bookingpress\_start\_date ) ); |
  |  | 1730 |  |
  |  | 1731 | /\*\* Get the default days off in the above limit \*/ |
  |  | 1732 | $bpa\_retrieves\_default\_disabled\_dates = $BookingPress->bookingpress\_retrieve\_off\_days( $bookingpress\_start\_date\_without\_time, ( $get\_period\_available\_for\_booking + 1 ), $bookingpress\_selected\_service, $selected\_service\_duration\_in\_min, $bookingpress\_selected\_staffmember\_id ); |
  |  | 1733 |  |
  |  | 1734 | //$bpa\_retrieves\_default\_disabled\_dates = array\_merge( $bpa\_retrieves\_default\_disabled\_dates, $posted\_disabled\_dates ); |
  |  | 1735 |  |
  | 1759 | 1736 | if( !empty( $selected\_date ) ){ |
  | 1760 | 1737 | $bookingpress\_end\_date = date( 'Y-m-d', strtotime( 'last day of this month', strtotime( $selected\_date ) ) ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1800) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1777) |  |
  | 1800 | 1777 | } |
  | 1801 | 1778 |  |
  |  | 1779 | foreach( $bpa\_retrieves\_default\_disabled\_dates as $bpa\_key => $disabled\_date ){ |
  |  | 1780 | $bpa\_retrieves\_default\_disabled\_dates[ $bpa\_key ] = date('Y-m-d', strtotime( $disabled\_date ) ); |
  |  | 1781 | } |
  |  | 1782 |  |
  | 1802 | 1783 | $selected\_where\_in  = ' AND bookingpress\_appointment\_date IN ('; |
  | 1803 | 1784 | $selected\_where\_in .= rtrim( str\_repeat( '%s,', count( $booked\_check\_dates ) ), ',' ).' )'; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1811) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1792) |  |
  | 1811 | 1792 | $total\_booked\_appiontments = $wpdb->get\_results( "SELECT \* FROM {$tbl\_bookingpress\_appointment\_bookings} WHERE 1 = 1 $where\_clause", ARRAY\_A ); // phpcs:ignore |
  | 1812 | 1793 | /\*\* Reputelog - new code - need to check for optimization start \*/ |
  |  | 1794 |  |
  |  | 1795 | $first\_available\_date = ''; |
  | 1813 | 1796 |  |
  | 1814 | 1797 | foreach( $period as $dt ){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1821) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1804) |  |
  | 1821 | 1804 | } |
  | 1822 | 1805 |  |
  |  | 1806 | if( !empty( $bpa\_retrieves\_default\_disabled\_dates ) && in\_array( $bpa\_check\_date, $bpa\_retrieves\_default\_disabled\_dates ) ){ |
  |  | 1807 | continue; |
  |  | 1808 | } |
  |  | 1809 |  |
  | 1823 | 1810 | $bpa\_check\_datetime = $dt->format( 'Y-m-d H:i:s'); |
  | 1824 | 1811 | $front\_timings\_data = $bookingpress\_appointment\_bookings->bookingpress\_retrieve\_timeslots( $bpa\_check\_date, true, false, false, $total\_booked\_appiontments ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1852) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1839) |  |
  | 1852 | 1839 | foreach( $front\_timings\_data\_combined as $timeslot\_data ){ |
  | 1853 | 1840 |  |
  |  | 1841 | if( empty( $first\_available\_date ) ){ |
  |  | 1842 | $first\_available\_date = $timeslot\_data['store\_service\_date']; |
  |  | 1843 | } |
  |  | 1844 |  |
  | 1854 | 1845 | $startDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_start\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
  | 1855 | 1846 | $endDateTime = new DateTime( $timeslot\_data['store\_service\_date'] . ' ' . $timeslot\_data['store\_end\_time'], new DateTimeZone( $wp\_timezone\_offset ) ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1879) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1870) |  |
  | 1879 | 1870 | } |
  | 1880 | 1871 | } |
  |  | 1872 |  |
  |  | 1873 | if( strtotime( $selected\_date ) < strtotime( $first\_available\_date ) ){ |
  |  | 1874 | $selected\_date = $first\_available\_date; |
  |  | 1875 | } |
  | 1881 | 1876 | } |
  | 1882 | 1877 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1887) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1882) |  |
  | 1887 | 1882 | $working\_hour\_details = $working\_hour\_updated\_data['working\_details']; |
  | 1888 | 1883 | $working\_hour\_timing\_token = $working\_hour\_updated\_data['working\_hour\_timing\_token']; |
  |  | 1884 | $bpa\_retrieves\_default\_disabled\_dates = $working\_hour\_updated\_data['bpa\_disabled\_dates']; |
  | 1889 | 1885 | $max\_end\_date = $working\_hour\_updated\_data['next\_month\_date']; |
  | 1890 | 1886 | $preselected\_date = $working\_hour\_updated\_data['pre\_selected\_date']; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L1904) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L1900) |  |
  | 1904 | 1900 | $response['next\_month\_date'] = $max\_end\_date; |
  | 1905 | 1901 | $response['pre\_selected\_date'] = $preselected\_date; |
  |  | 1902 | $response['bpa\_disabled\_dates'] = $bpa\_retrieves\_default\_disabled\_dates; |
  | 1906 | 1903 | $response['stop\_check'] = ( false == $stop\_check && ( $bookingpress\_max\_date <= $max\_end\_date ) ) ? true : $stop\_check; |
  | 1907 | 1904 | $response['variant'] = 'success'; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3392) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3389) |  |
  | 3392 | 3389 | if(!empty($appointments\_data) && is\_array($appointments\_data) ){ |
  | 3393 | 3390 | foreach($appointments\_data as $k => $v){ |
  | 3394 |  | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) ){ |
  |  | 3391 | if( !empty( $v['bookingpress\_selected\_appointment\_date'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3395 | 3392 | $bookingpress\_appointment\_date = date\_i18n($bookingpress\_date\_format, strtotime($v['bookingpress\_selected\_appointment\_date'])); |
  | 3396 | 3393 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3399) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3396) |  |
  | 3399 | 3396 | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_date'] = $bookingpress\_appointment\_date; |
  | 3400 | 3397 |  |
  | 3401 |  | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) ){ |
  |  | 3398 | if( !empty( $v['bookingpress\_selected\_appointment\_time'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3402 | 3399 | $bookingpress\_appointment\_start\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_time'])); |
  | 3403 | 3400 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3406) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3403) |  |
  | 3406 | 3403 | $appointments\_data[$k]['bookingpress\_appointment\_formatted\_start\_time'] = $bookingpress\_appointment\_start\_time; |
  | 3407 | 3404 |  |
  | 3408 |  | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) ){ |
  |  | 3405 | if( !empty( $v['bookingpress\_selected\_appointment\_end\_time'] ) && $BookingPress->bpa\_is\_pro\_active() ){ |
  | 3409 | 3406 | $bookingpress\_appointment\_end\_time = date($bookingpress\_time\_format, strtotime($v['bookingpress\_selected\_appointment\_end\_time'])); |
  | 3410 | 3407 | } else { |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3604) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3601) |  |
  | 3604 | 3601 | $content .= '</div>'; |
  | 3605 | 3602 |  |
  | 3606 |  | return ~~do\_shortcode($content)~~; |
  |  | 3603 | return $content; |
  | 3607 | 3604 | } |
  | 3608 | 3605 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3771) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3768) |  |
  | 3771 | 3768 | $content .= '</div>'; |
  | 3772 | 3769 |  |
  | 3773 |  | return ~~do\_shortcode($content)~~; |
  |  | 3770 | return $content; |
  | 3774 | 3771 | } |
  | 3775 | 3772 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3805) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3802) |  |
  | 3805 | 3802 | if(!empty($bookingpress\_appointment\_details)){ |
  | 3806 | 3803 | $content .= '#'.$bookingpress\_appointment\_details['bookingpress\_booking\_id']; |
  | 3807 |  | return ~~do\_shortcode($content)~~; |
  |  | 3804 | return $content; |
  | 3808 | 3805 | } |
  | 3809 | 3806 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3825) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3822) |  |
  | 3825 | 3822 |  |
  | 3826 | 3823 | if(!$bookingpress\_nonce\_verification){ |
  | 3827 |  | return ~~do\_shortcode($content)~~; |
  |  | 3824 | return $content; |
  | 3828 | 3825 | } |
  | 3829 | 3826 | } |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3846) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3843) |  |
  | 3846 | 3843 | $content .= '#'.$bookingpress\_booking\_id; |
  | 3847 | 3844 | } |
  | 3848 |  | return ~~do\_shortcode($content)~~; |
  |  | 3845 | return $content; |
  | 3849 | 3846 | } |
  | 3850 | 3847 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L3985) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L3982) |  |
  | 3985 | 3982 | $content = esc\_html\_e('Company avatar not found', 'bookingpress-appointment-booking'); |
  | 3986 | 3983 | } |
  | 3987 |  | return ~~do\_shortcode($content)~~; |
  |  | 3984 | return $content; |
  | 3988 | 3985 | } |
  | 3989 | 3986 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4007) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4004) |  |
  | 4007 | 4004 | $content = esc\_html\_e('Company name not found', 'bookingpress-appointment-booking'); |
  | 4008 | 4005 | } |
  | 4009 |  | return ~~do\_shortcode($content)~~; |
  |  | 4006 | return $content; |
  | 4010 | 4007 | } |
  | 4011 | 4008 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4029) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4026) |  |
  | 4029 | 4026 | $content = esc\_html\_e('Company website name not found', 'bookingpress-appointment-booking'); |
  | 4030 | 4027 | } |
  | 4031 |  | return ~~do\_shortcode($content)~~; |
  |  | 4028 | return $content; |
  | 4032 | 4029 | } |
  | 4033 | 4030 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4052) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4049) |  |
  | 4052 | 4049 | $content = esc\_html\_e('Company address not found', 'bookingpress-appointment-booking'); |
  | 4053 | 4050 | } |
  | 4054 |  | return ~~do\_shortcode($content)~~; |
  |  | 4051 | return $content; |
  | 4055 | 4052 | } |
  | 4056 | 4053 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4076) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4073) |  |
  | 4076 | 4073 | $content = esc\_html\_e('Company phone number not found', 'bookingpress-appointment-booking'); |
  | 4077 | 4074 | } |
  | 4078 |  | return ~~do\_shortcode($content)~~; |
  |  | 4075 | return $content; |
  | 4079 | 4076 | } |
  | 4080 | 4077 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L4993) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L4990) |  |
  | 4993 | 4990 | } |
  | 4994 | 4991 |  |
  |  | 4992 |  |
  | 4995 | 4993 | extract($args); |
  |  | 4994 |  |
  |  | 4995 |  |
  | 4996 | 4996 | $Bookingpress\_service  = 0; |
  | 4997 | 4997 | $Bookingpress\_category = 0; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L5000) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L5000) |  |
  | 5000 | 5000 | $Bookingpress\_category            = $category; |
  | 5001 | 5001 | $this->bookingpress\_form\_category = $category; |
  | 5002 |  | } |
  |  | 5002 | } |
  | 5003 | 5003 | $service = apply\_filters('bookingpress\_modify\_booking\_form\_default\_display\_services', $service); |
  | 5004 |  | if( ! empty($service) && $service != 0 ) { |
  |  | 5004 |  |
  |  | 5005 | if( ! empty( $service ) ) { |
  |  | 5006 | $service\_arr = explode( ',', $service ); |
  |  | 5007 | $service\_arr = array\_map( 'intval', $service\_arr ); |
  |  | 5008 | $service = implode( ', ', $service\_arr ); |
  | 5005 | 5009 | $Bookingpress\_service            = $service; |
  | 5006 | 5010 | $this->bookingpress\_form\_service = $service; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L7223) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L7227) |  |
  | 7223 | 7227 | $bookingpress\_site\_current\_lang\_moment\_locale = get\_locale(); |
  | 7224 | 7228 |  |
  |  | 7229 | $wp\_timezone\_offset = wp\_timezone\_string(); |
  |  | 7230 |  |
  |  | 7231 | if ( ! preg\_match( '/(\d+)\:(\d+)/', $wp\_timezone\_offset ) ) { |
  |  | 7232 | $wp\_timezone\_offset = $BookingPress->bookingpress\_convert\_timezone\_to\_offset( $wp\_timezone\_offset ); |
  |  | 7233 | } |
  |  | 7234 |  |
  |  | 7235 | $bookingpress\_step\_navigation\_token\_postdata = ''; |
  |  | 7236 | $bookingpress\_step\_navigation\_token\_postdata = apply\_filters( 'bookingpress\_modify\_step\_navigation\_token\_postdata', $bookingpress\_step\_navigation\_token\_postdata ); |
  |  | 7237 |  |
  |  | 7238 | $bookingpress\_use\_legacy\_functions = 'false'; |
  |  | 7239 | if( $BookingPress->bpa\_is\_pro\_active() && version\_compare( $BookingPress->bpa\_pro\_plugin\_version(), '3.9.8', '<' ) ){ |
  |  | 7240 | $bookingpress\_use\_legacy\_functions = 'true'; |
  |  | 7241 | } |
  |  | 7242 |  |
  | 7225 | 7243 | $bookingpress\_vue\_methods\_data .= ' |
  | 7226 | 7244 | get\_formatted\_date(iso\_date){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L7792) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L7810) |  |
  | 7792 | 7810 |  |
  | 7793 | 7811 | '.$bookingpress\_dynamic\_time\_select\_after.' |
  | 7794 |  |  |
  | 7795 |  | vm.bookingpress\_~~step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name)~~ |
  |  | 7812 | vm.bookingpress\_step\_navigation(vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name, vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].previous\_tab\_name); |
  |  | 7813 | vm.bookingpress\_update\_timestep\_token(); |
  | 7796 | 7814 | }, |
  | 7797 | 7815 | resetForm(){ |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8043) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8061) |  |
  | 8043 | 8061 | } |
  | 8044 | 8062 | }, |
  |  | 8063 | bookingpress\_update\_timestep\_token( force\_update = false ){ |
  |  | 8064 | const vm = this; |
  |  | 8065 |  |
  |  | 8066 | let use\_legacy = "'.$bookingpress\_use\_legacy\_functions.'"; |
  |  | 8067 |  |
  |  | 8068 | let current\_tab = vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].next\_tab\_name; |
  |  | 8069 |  |
  |  | 8070 | if( true == force\_update || ( "datetime" == vm.bookingpress\_sidebar\_step\_data[ vm.bookingpress\_current\_tab ].previous\_tab\_name && "d" != vm.appointment\_step\_form\_data.selected\_service\_duration\_unit && "datetime" != vm.bookingpress\_current\_tab && "false" == use\_legacy ) ){ |
  |  | 8071 | console.log( vm.is\_bookingpress\_updating\_token ); |
  |  | 8072 | let appointment\_selected\_date = vm.appointment\_step\_form\_data.store\_selected\_date || vm.appointment\_step\_form\_data.selected\_date; |
  |  | 8073 | let selected\_token\_data = vm.v\_calendar\_time\_token\_data[ appointment\_selected\_date ][0]; |
  |  | 8074 |  |
  |  | 8075 | var bkp\_wpnonce\_pre = "'.wp\_create\_nonce( 'bpa\_wp\_nonce' ).'"; |
  |  | 8076 | var bkp\_wpnonce\_pre\_fetch = document.getElementById("\_wpnonce"); |
  |  | 8077 | if(typeof bkp\_wpnonce\_pre\_fetch=="undefined" || bkp\_wpnonce\_pre\_fetch==null){ |
  |  | 8078 | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre; |
  |  | 8079 | }else { |
  |  | 8080 | bkp\_wpnonce\_pre\_fetch = bkp\_wpnonce\_pre\_fetch.value; |
  |  | 8081 | } |
  |  | 8082 |  |
  |  | 8083 | let postData = { |
  |  | 8084 | action: "bpa\_set\_timeslot\_token", |
  |  | 8085 | tokenData: selected\_token\_data, |
  |  | 8086 | selectedDate: appointment\_selected\_date, |
  |  | 8087 | \_wpnonce:bkp\_wpnonce\_pre\_fetch |
  |  | 8088 | }; |
  |  | 8089 |  |
  |  | 8090 | '.$bookingpress\_step\_navigation\_token\_postdata.' |
  |  | 8091 |  |
  |  | 8092 | vm.is\_bookingpress\_updating\_token = true; |
  |  | 8093 | axios.post( appoint\_ajax\_obj.ajax\_url, Qs.stringify( postData ) ) |
  |  | 8094 | .then( function (response) { |
  |  | 8095 | vm.is\_bookingpress\_updating\_token = false; |
  |  | 8096 | vm.is\_bookingpress\_token\_updated = true; |
  |  | 8097 | }.bind(this) ) |
  |  | 8098 | .catch( function (error) { |
  |  | 8099 | }); |
  |  | 8100 | } |
  |  | 8101 | }, |
  | 8045 | 8102 | bookingpress\_working\_dates\_data( working\_hour\_details, response\_data ){ |
  | 8046 | 8103 | const vm = this; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8134) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8191) |  |
  | 8134 | 8191 | if( "" != bpa\_selected\_date ){ |
  | 8135 | 8192 | preselect\_date = true; |
  |  | 8193 | } |
  |  | 8194 |  |
  |  | 8195 | if( "" == bpa\_selected\_date ){ |
  |  | 8196 | vm.appointment\_step\_form\_data.selected\_start\_time = ""; |
  |  | 8197 | vm.appointment\_step\_form\_data.selected\_end\_time = ""; |
  | 8136 | 8198 | } |
  | 8137 | 8199 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8222) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8284) |  |
  | 8222 | 8284 | }); |
  | 8223 | 8285 | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
  |  | 8286 |  |
  |  | 8287 | /\* V-date-picker attributes \*/ |
  |  | 8288 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8289 |  |
  |  | 8290 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8291 | let vcal\_attr\_data = []; |
  |  | 8292 | let vcal\_attr\_data\_current = {}; |
  |  | 8293 | let k = 1; |
  |  | 8294 |  |
  |  | 8295 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8296 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8297 |  |
  |  | 8298 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8299 |  |
  |  | 8300 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8301 | let vcal\_attr\_obj = { |
  |  | 8302 | key: k, |
  |  | 8303 | dates: vcal\_date, |
  |  | 8304 | customData:{ |
  |  | 8305 | title: vcal\_data |
  |  | 8306 | } |
  |  | 8307 | }; |
  |  | 8308 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8309 | k++; |
  |  | 8310 | } |
  |  | 8311 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8312 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8313 | } |
  |  | 8314 |  |
  |  | 8315 | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
  |  | 8316 | /\* V-date-picker attributes \*/ |
  |  | 8317 |  |
  | 8224 | 8318 | vm.v\_calendar\_default\_label = response.data.max\_capacity\_capacity; |
  | 8225 | 8319 | vm.v\_calendar\_time\_token\_data = response.data.working\_hour\_timing\_token; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8244) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8338) |  |
  | 8244 | 8338 | vm.bookingpress\_retrieve\_future\_month\_details( response.data.next\_month\_date, 1 ); |
  | 8245 | 8339 | } |
  |  | 8340 |  |
  |  | 8341 | if( "undefined" != typeof vm.is\_bookingpress\_token\_updated && true == vm.is\_bookingpress\_token\_updated ){ |
  |  | 8342 | vm.bookingpress\_update\_timestep\_token( true ); |
  |  | 8343 | } |
  |  | 8344 |  |
  | 8246 | 8345 | '.$bookingpress\_disable\_date\_vue\_data\_after.' |
  | 8247 | 8346 | }.bind(this) ) |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8291) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8390) |  |
  | 8291 | 8390 | vm.v\_calendar\_time\_token\_data = Object.assign( {},vm.v\_calendar\_time\_token\_data, response.data.working\_hour\_timing\_token ); |
  | 8292 | 8391 | let v\_available\_dates\_only = []; |
  |  | 8392 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8393 |  |
  |  | 8394 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8395 | let vcal\_attr\_data = []; |
  |  | 8396 | let vcal\_attr\_data\_current = {}; |
  |  | 8397 | let k = 1; |
  |  | 8398 |  |
  |  | 8399 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8400 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8401 |  |
  |  | 8402 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8403 |  |
  |  | 8404 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8405 | let vcal\_attr\_obj = { |
  |  | 8406 | key: k, |
  |  | 8407 | dates: vcal\_date, |
  |  | 8408 | customData:{ |
  |  | 8409 | title: vcal\_data |
  |  | 8410 | } |
  |  | 8411 | }; |
  |  | 8412 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8413 | k++; |
  |  | 8414 | } |
  |  | 8415 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8416 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8417 | } |
  |  | 8418 |  |
  | 8293 | 8419 | vm.v\_calendar\_available\_dates.forEach( function( i,e ){ |
  | 8294 | 8420 | v\_available\_dates\_only.push( i.split(" ")[0] ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8345) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8471) |  |
  | 8345 | 8471 | v\_available\_dates\_only.push( i.split(" ")[0] ); |
  | 8346 | 8472 | }); |
  |  | 8473 |  |
  |  | 8474 | let vcal\_attributes = response.data.vcal\_attributes; |
  |  | 8475 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  |  | 8476 | let vcal\_attr\_data = []; |
  |  | 8477 | let vcal\_attr\_data\_current = {}; |
  |  | 8478 | let k = 1; |
  |  | 8479 |  |
  |  | 8480 | for( let vcal\_date in vcal\_attributes ){ |
  |  | 8481 | let vcal\_data = vcal\_attributes[ vcal\_date ]; |
  |  | 8482 |  |
  |  | 8483 | vcal\_date = wp.hooks.applyFilters( "bookingpress\_modify\_date\_with\_timezone", vcal\_date, {"store\_service\_date":vcal\_date,"store\_start\_time":"00:00:00","store\_offset":"'.$wp\_timezone\_offset.'"} ); |
  |  | 8484 |  |
  |  | 8485 | vcal\_attr\_data\_current[ vcal\_date ] = vcal\_data; |
  |  | 8486 | let vcal\_attr\_obj = { |
  |  | 8487 | key: k, |
  |  | 8488 | dates: vcal\_date, |
  |  | 8489 | customData:{ |
  |  | 8490 | title: vcal\_data |
  |  | 8491 | } |
  |  | 8492 | }; |
  |  | 8493 | vcal\_attr\_data.push( vcal\_attr\_obj ); |
  |  | 8494 | k++; |
  |  | 8495 | } |
  |  | 8496 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  |  | 8497 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  |  | 8498 | } |
  | 8347 | 8499 | vm.v\_calendar\_available\_only\_date = v\_available\_dates\_only; |
  | 8348 | 8500 | vm.v\_calendar\_timeslots\_data = Object.assign({},vm.v\_calendar\_timeslots\_data, wh\_details.updated\_working\_hour\_details ); |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8497) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8649) |  |
  | 8497 | 8649 | let vcal\_attributes = response.data.vcal\_attributes; |
  | 8498 | 8650 |  |
  | 8499 |  | if( vcal\_attributes.length != "" ){ |
  |  | 8651 | if( "undefined" != typeof vcal\_attributes && vcal\_attributes.length != "" ){ |
  | 8500 | 8652 | let vcal\_attr\_data = []; |
  | 8501 | 8653 | let vcal\_attr\_data\_current = {}; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8515) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L8667) |  |
  | 8515 | 8667 | } |
  | 8516 | 8668 | vm.v\_calendar\_attributes = vcal\_attr\_data; |
  | 8517 |  | vm.v\_calendar\_attributes\_current = ~~vcal\_attr\_data\_current~~; |
  |  | 8669 | vm.v\_calendar\_attributes\_current = Object.assign( {}, vm.v\_calendar\_attributes\_current, vcal\_attr\_data\_current ); |
  | 8518 | 8670 | } |
  | 8519 | 8671 |  |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8881) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L9033) |  |
  | 8881 | 9033 | '.$bookingpress\_dynamic\_validation\_for\_step\_change.' |
  | 8882 | 9034 | } |
  | 8883 |  |  |
  | 8884 | 9035 | if( "service" == current\_tab && "service" != vm.bookingpress\_current\_tab ){ |
  | 8885 | 9036 | var bookingpress\_selected\_date = vm.appointment\_step\_form\_data.selected\_date+"T00:00:00+00:00"; |
  | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3175695#L8924) | […](/browser/bookingpress-appointment-booking/trunk/core/classes/frontend/class.bookingpress_appointment_bookings.php?rev=3179229#L9075) |  |
  | 8924 | 9075 | vm.bookngpress\_previous\_tab = previous\_tab; |
  | 8925 | 9076 | vm.bookingpress\_sidebar\_step\_data[vm.bookingpress\_current\_tab].is\_allow\_navigate = 1; |
  | 8926 |  |  |
  | 8927 |  | ~~let tabsArr = ["cart","basic\_details","summary"];~~ |
  | 8928 | 9077 |  |
  | 8929 | 9078 | if( "datetime" == current\_tab ){ |
  | 8930 | 9079 | let selected\_service\_id = vm.appointment\_step\_form\_data.selected\_service; |
  | 8931 |  | if( tabsArr.indexOf( current\_selected\_tab ) > -1 ){ |
  | 8932 |  | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
  | 8933 |  | } else { |
  | 8934 |  | vm.bookingpress\_disable\_date(selected\_service\_id); |
  | 8935 |  | } |
  |  | 9080 | vm.bookingpress\_disable\_date(selected\_service\_id,vm.appointment\_step\_form\_data.selected\_date); |
  | 8936 | 9081 | } |
  | 8937 | 9082 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3179229)
* [Zip Archive](?format=zip&new=3179229)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

