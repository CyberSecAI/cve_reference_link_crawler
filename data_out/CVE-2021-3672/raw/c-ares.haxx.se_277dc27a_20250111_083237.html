<!DOCTYPE html>
<html lang="en"><head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1"><!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Missing input validation on hostnames returned by DNS servers | c-ares: a modern asynchronous DNS resolver</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Missing input validation on hostnames returned by DNS servers" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="c-ares is a modern DNS (stub) resolver library, written in C. It provides interfaces for asynchronous queries while trying to abstract the intricacies of the underlying DNS protocol. It was originally intended for applications which need to perform DNS queries without blocking, or need to perform multiple DNS queries in parallel." />
<meta property="og:description" content="c-ares is a modern DNS (stub) resolver library, written in C. It provides interfaces for asynchronous queries while trying to abstract the intricacies of the underlying DNS protocol. It was originally intended for applications which need to perform DNS queries without blocking, or need to perform multiple DNS queries in parallel." />
<link rel="canonical" href="https://c-ares.org/adv_20210810.html" />
<meta property="og:url" content="https://c-ares.org/adv_20210810.html" />
<meta property="og:site_name" content="c-ares: a modern asynchronous DNS resolver" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Missing input validation on hostnames returned by DNS servers" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebPage","description":"c-ares is a modern DNS (stub) resolver library, written in C. It provides interfaces for asynchronous queries while trying to abstract the intricacies of the underlying DNS protocol. It was originally intended for applications which need to perform DNS queries without blocking, or need to perform multiple DNS queries in parallel.","headline":"Missing input validation on hostnames returned by DNS servers","url":"https://c-ares.org/adv_20210810.html"}</script>
<!-- End Jekyll SEO tag -->
<link rel="stylesheet" href="/assets/main.css"><link type="application/atom+xml" rel="alternate" href="https://c-ares.org/feed.xml" title="c-ares: a modern asynchronous DNS resolver" /></head>
<body><header class="site-header" role="banner">

  <div class="wrapper"><a class="site-title" rel="author" href="/"><img height=45 alt="c-ares" src="/assets/c-ares-logo.svg"></img></a><nav class="site-nav">
        <input type="checkbox" id="nav-trigger" class="nav-trigger" />
        <label for="nav-trigger">
          <span class="menu-icon">
            <svg viewBox="0 0 18 15" width="18px" height="15px">
              <path d="M18,1.484c0,0.82-0.665,1.484-1.484,1.484H1.484C0.665,2.969,0,2.304,0,1.484l0,0C0,0.665,0.665,0,1.484,0 h15.032C17.335,0,18,0.665,18,1.484L18,1.484z M18,7.516C18,8.335,17.335,9,16.516,9H1.484C0.665,9,0,8.335,0,7.516l0,0 c0-0.82,0.665-1.484,1.484-1.484h15.032C17.335,6.031,18,6.696,18,7.516L18,7.516z M18,13.516C18,14.335,17.335,15,16.516,15H1.484 C0.665,15,0,14.335,0,13.516l0,0c0-0.82,0.665-1.483,1.484-1.483h15.032C17.335,12.031,18,12.695,18,13.516L18,13.516z"/>
            </svg>
          </span>
        </label>

        <div class="trigger"><a class="page-link" href="/docs.html">Docs</a><a class="page-link" href="/features/">Features</a><a class="page-link" href="https://github.com/c-ares/c-ares"target="_blank" rel="noopener noreferrer">GitHub</a><a class="page-link" href="/license.html">License</a><a class="page-link" href="/mailarchive.html">Mail Archive</a><a class="page-link" href="/why.html">Why</a></div>
      </nav></div>
</header>
<main class="page-content" aria-label="Content">
      <div class="wrapper">
        <article class="post">

  <header class="post-header">
    <h1 class="post-title">Missing input validation on hostnames returned by DNS servers</h1>
  </header>

  <div class="post-content">
    <h1 id="missing-input-validation-on-hostnames-returned-by-dns-servers">Missing input validation on hostnames returned by DNS servers</h1>

<p>Project c-ares Security Advisory, August 10, 2021 -
<a href="https://c-ares.org/adv_20210810.html">Permalink</a></p>

<h2 id="vulnerability">VULNERABILITY</h2>

<p>Missing input validation of host names returned by Domain Name Servers in
the c-ares library can lead to output of wrong hostnames (leading to Domain
Hijacking).</p>

<p>The Common Vulnerabilities and Exposures (CVE) project has assigned the name
CVE-2021-3672 to this issue.</p>

<h2 id="steps-to-reproduce">STEPS TO REPRODUCE</h2>

<p>An example domain which has a cname including a zero byte:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ adig cnamezero.test2.xdi-attack.net

Answers:
     cnamezero.test2.xdi-attack.net. 0 CNAME victim.test2.xdi-attack.net\000.test2.xdi-attack.net.
     victim.test2.xdi-attack.net\000.test2.xdi-attack.net. 0 A 141.12.174.88
</code></pre></div></div>

<p>When resolved via a vulnerable implementation, the CNAME alias and name of the
A record will seem to be <code class="language-plaintext highlighter-rouge">victim.test2.xdi-attack.net</code> instead of
<code class="language-plaintext highlighter-rouge">victim.test2.xdi-attack.net\000.test2.xdi-attack.net</code>, a totally different
domain.</p>

<p>This is a clear error in zero-byte handling and can potentially lead to
DNS-cache injections in case an application implements a cache based on the
library.</p>

<h2 id="affected-versions">AFFECTED VERSIONS</h2>

<p>This flaw exists in the following c-ares versions.</p>

<ul>
  <li>Affected versions: c-ares 1.0.0 to and including 1.17.1</li>
  <li>Not affected versions: c-ares &gt;= 1.17.2</li>
</ul>

<h2 id="the-solution">THE SOLUTION</h2>

<p>In version 1.17.2, the function has been corrected and a test case have been
added to verify.</p>

<p>A <a href="https://github.com/c-ares/c-ares/compare/809d5e8..44c009b.patch">patch for 
CVE-2021-3672</a> 
is available.</p>

<h2 id="recommendations">RECOMMENDATIONS</h2>

<p>We suggest you take one of the following actions immediately, in order of
preference:</p>

<p>A - Upgrade c-ares to version 1.17.2</p>

<p>B - Apply the patch to your version and rebuild</p>

<h2 id="time-line">TIME LINE</h2>

<p>It was reported to the c-ares project on June 11, 2021 by Philipp Jeitner and
Haya Shulman, Fraunhofer SIT.</p>

<p>c-ares 1.17.2 was released on August 10 2021, coordinated with the publication
of this advisory.</p>

<h2 id="credits">CREDITS</h2>

<p>Thanks to Philipp Jeitner and Haya Shulman, Fraunhofer SIT for the report.</p>

  </div>

</article>

      </div>
    </main><footer class="site-footer h-card">
  <data class="u-url" href="/"></data>
  <div class="wrapper">
    <div style="text-align: center;"><ul class="social-media-list"><li><a href="https://github.com/c-ares"><svg class="svg-icon"><use xlink:href="/assets/minima-social-icons.svg#github"></use></svg> <span class="username">c-ares</span></a></li></ul>
&copy; 2024 the c-ares project and its contributors
    </div>
  </div>

</footer>
</body>

</html>
