

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2fee84030d12d9fddfa874e4562d71761a129277)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fee84030d12d9fddfa874e4562d71761a129277)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fee84030d12d9fddfa874e4562d71761a129277)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fee84030d12d9fddfa874e4562d71761a129277)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harry Wentland <harry.wentland@amd.com> | 2023-11-08 11:36:24 -0500 |
| --- | --- | --- |
| committer | Melissa Wen <melissa.srw@gmail.com> | 2024-01-02 12:06:53 -0100 |
| commit | [2fee84030d12d9fddfa874e4562d71761a129277](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2fee84030d12d9fddfa874e4562d71761a129277) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2fee84030d12d9fddfa874e4562d71761a129277)) | |
| tree | [7b6c3651e8f72cff64a0b5465c2b14e2c0ca985e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2fee84030d12d9fddfa874e4562d71761a129277) | |
| parent | [ffcc67cd79ff2e93fd0bdb837c99cbab6c59d38c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ffcc67cd79ff2e93fd0bdb837c99cbab6c59d38c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fee84030d12d9fddfa874e4562d71761a129277&id2=ffcc67cd79ff2e93fd0bdb837c99cbab6c59d38c)) | |
| download | [linux-2fee84030d12d9fddfa874e4562d71761a129277.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2fee84030d12d9fddfa874e4562d71761a129277.tar.gz) | |

drm/vkms: Avoid reading beyond LUT arrayWhen the floor LUT index (drm\_fixp2int(lut\_index) is the last
index of the array the ceil LUT index will point to an entry
beyond the array. Make sure we guard against it and use the
value of the floor LUT index.
v3:
- Drop bits from commit description that didn't contribute
anything of value
Fixes: db1f254f2cfa ("drm/vkms: Add support to 1D gamma LUT")
Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Cc: Arthur Grillo <arthurgrillo@riseup.net>
Reviewed-by: Arthur Grillo <arthurgrillo@riseup.net>
Reviewed-by: Melissa Wen <mwen@igalia.com>
Signed-off-by: Melissa Wen <melissa.srw@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20231108163647.106853-6-harry.wentland@amd.com](https://patchwork.freedesktop.org/patch/msgid/20231108163647.106853-6-harry.wentland%40amd.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2fee84030d12d9fddfa874e4562d71761a129277)

| -rw-r--r-- | [drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/vkms/vkms_composer.c?id=2fee84030d12d9fddfa874e4562d71761a129277) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/drivers/gpu/drm/vkms/vkms\_composer.c b/drivers/gpu/drm/vkms/vkms\_composer.cindex 3c99fb8b54e2df..e7441b227b3cea 100644--- a/[drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vkms/vkms_composer.c?id=ffcc67cd79ff2e93fd0bdb837c99cbab6c59d38c)+++ b/[drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vkms/vkms_composer.c?id=2fee84030d12d9fddfa874e4562d71761a129277)@@ -123,6 +123,8 @@ static u16 apply\_lut\_to\_channel\_value(const struct vkms\_color\_lut \*lut, u16 chan enum lut\_channel channel) { s64 lut\_index = get\_lut\_index(lut, channel\_value);+ u16 \*floor\_lut\_value, \*ceil\_lut\_value;+ u16 floor\_channel\_value, ceil\_channel\_value;  /\* \* This checks if `struct drm\_color\_lut` has any gap added by the compiler@@ -130,11 +132,15 @@ static u16 apply\_lut\_to\_channel\_value(const struct vkms\_color\_lut \*lut, u16 chan \*/ static\_assert(sizeof(struct drm\_color\_lut) == sizeof(\_\_u16) \* 4); - u16 \*floor\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int(lut\_index)];- u16 \*ceil\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int\_ceil(lut\_index)];+ floor\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int(lut\_index)];+ if (drm\_fixp2int(lut\_index) == (lut->lut\_length - 1))+ /\* We're at the end of the LUT array, use same value for ceil and floor \*/+ ceil\_lut\_value = floor\_lut\_value;+ else+ ceil\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int\_ceil(lut\_index)]; - u16 floor\_channel\_value = floor\_lut\_value[channel];- u16 ceil\_channel\_value = ceil\_lut\_value[channel];+ floor\_channel\_value = floor\_lut\_value[channel];+ ceil\_channel\_value = ceil\_lut\_value[channel];  return lerp\_u16(floor\_channel\_value, ceil\_channel\_value, lut\_index & DRM\_FIXED\_DECIMAL\_MASK); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:44:44 +0000

