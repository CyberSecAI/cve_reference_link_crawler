

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harry Wentland <harry.wentland@amd.com> | 2023-11-08 11:36:24 -0500 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:16:59 -0400 |
| commit | [92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)) | |
| tree | [f304688951e689fc948b74007843d9cd9b5326fc](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d) | |
| parent | [da2d94af7ba950b33ce7dfd326894460c5536988](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=da2d94af7ba950b33ce7dfd326894460c5536988) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d&id2=da2d94af7ba950b33ce7dfd326894460c5536988)) | |
| download | [linux-92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d.tar.gz) | |

drm/vkms: Avoid reading beyond LUT array[ Upstream commit 2fee84030d12d9fddfa874e4562d71761a129277 ]
When the floor LUT index (drm\_fixp2int(lut\_index) is the last
index of the array the ceil LUT index will point to an entry
beyond the array. Make sure we guard against it and use the
value of the floor LUT index.
v3:
- Drop bits from commit description that didn't contribute
anything of value
Fixes: db1f254f2cfa ("drm/vkms: Add support to 1D gamma LUT")
Signed-off-by: Harry Wentland <harry.wentland@amd.com>
Cc: Arthur Grillo <arthurgrillo@riseup.net>
Reviewed-by: Arthur Grillo <arthurgrillo@riseup.net>
Reviewed-by: Melissa Wen <mwen@igalia.com>
Signed-off-by: Melissa Wen <melissa.srw@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20231108163647.106853-6-harry.wentland@amd.com](https://patchwork.freedesktop.org/patch/msgid/20231108163647.106853-6-harry.wentland%40amd.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)

| -rw-r--r-- | [drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/vkms/vkms_composer.c?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 4 deletions

| diff --git a/drivers/gpu/drm/vkms/vkms\_composer.c b/drivers/gpu/drm/vkms/vkms\_composer.cindex 3c99fb8b54e2df..e7441b227b3cea 100644--- a/[drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vkms/vkms_composer.c?id=da2d94af7ba950b33ce7dfd326894460c5536988)+++ b/[drivers/gpu/drm/vkms/vkms\_composer.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/vkms/vkms_composer.c?id=92800aaeff51b8358d1e0a7eb74daf8aa2d7ce9d)@@ -123,6 +123,8 @@ static u16 apply\_lut\_to\_channel\_value(const struct vkms\_color\_lut \*lut, u16 chan enum lut\_channel channel) { s64 lut\_index = get\_lut\_index(lut, channel\_value);+ u16 \*floor\_lut\_value, \*ceil\_lut\_value;+ u16 floor\_channel\_value, ceil\_channel\_value;  /\* \* This checks if `struct drm\_color\_lut` has any gap added by the compiler@@ -130,11 +132,15 @@ static u16 apply\_lut\_to\_channel\_value(const struct vkms\_color\_lut \*lut, u16 chan \*/ static\_assert(sizeof(struct drm\_color\_lut) == sizeof(\_\_u16) \* 4); - u16 \*floor\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int(lut\_index)];- u16 \*ceil\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int\_ceil(lut\_index)];+ floor\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int(lut\_index)];+ if (drm\_fixp2int(lut\_index) == (lut->lut\_length - 1))+ /\* We're at the end of the LUT array, use same value for ceil and floor \*/+ ceil\_lut\_value = floor\_lut\_value;+ else+ ceil\_lut\_value = (\_\_u16 \*)&lut->base[drm\_fixp2int\_ceil(lut\_index)]; - u16 floor\_channel\_value = floor\_lut\_value[channel];- u16 ceil\_channel\_value = ceil\_lut\_value[channel];+ floor\_channel\_value = floor\_lut\_value[channel];+ ceil\_channel\_value = ceil\_lut\_value[channel];  return lerp\_u16(floor\_channel\_value, ceil\_channel\_value, lut\_index & DRM\_FIXED\_DECIMAL\_MASK); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:44:44 +0000

