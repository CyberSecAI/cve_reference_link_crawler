

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-recaptcha-integration%2Ftags%2F1.2.5%2Finc%2Fclass-wp_recaptcha_options.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-recaptcha-integration/trunk/inc/class-wp_recaptcha_options.php?rev=2257275 "Revision 2257275")
* [Next Revision](/browser/wp-recaptcha-integration/trunk/inc/class-wp_recaptcha_options.php?rev=3176796 "Revision 3176796") →
* [Blame](/browser/wp-recaptcha-integration/trunk/inc/class-wp_recaptcha_options.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-recaptcha-integration/tags/1.2.5/inc/class-wp_recaptcha_options.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-recaptcha-integration](/browser/wp-recaptcha-integration?order=name "View wp-recaptcha-integration")/[tags](/browser/wp-recaptcha-integration/tags?order=name "View tags")/[1.2.5](/browser/wp-recaptcha-integration/tags/1.2.5?order=name "View 1.2.5")/[inc](/browser/wp-recaptcha-integration/tags/1.2.5/inc?order=name "View inc")/[class-wp\_recaptcha\_options.php](/browser/wp-recaptcha-integration/tags/1.2.5/inc/class-wp_recaptcha_options.php?order=name "View class-wp_recaptcha_options.php")

View diff against:

View revision:

| [Last change](/changeset/2335798/wp-recaptcha-integration/trunk/inc/class-wp_recaptcha_options.php "View differences") on this file was [2335798](/changeset/2335798/ "View changeset 2335798"), checked in by tareq1988, [5 years ago](/timeline?from=2020-07-06T03%3A11%3A40Z&precision=second "See timeline at 07/06/2020 03:11:40 AM") |
| --- |
| Update codebase of 1.2.4 |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 28.6 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) |  |
| [4](#L4) |  |
| [5](#L5) | /\*\* |
| [6](#L6) | \*      Class to manage the recaptcha options. |
| [7](#L7) | \*/ |
| [8](#L8) | class WP\_reCaptcha\_Options { |
| [9](#L9) | private $enter\_api\_key; |
| [10](#L10) | /\*\* |
| [11](#L11) | \*      Holding the singleton instance |
| [12](#L12) | \*/ |
| [13](#L13) | private static $\_instance = null; |
| [14](#L14) |  |
| [15](#L15) | /\*\* |
| [16](#L16) | \*      @return WP\_reCaptcha\_Options The options manager instance |
| [17](#L17) | \*/ |
| [18](#L18) | public static function instance(){ |
| [19](#L19) | if ( is\_null( self::$\_instance ) ) |
| [20](#L20) | self::$\_instance = new self(); |
| [21](#L21) | return self::$\_instance; |
| [22](#L22) | } |
| [23](#L23) |  |
| [24](#L24) | /\*\* |
| [25](#L25) | \*      Prevent from creating more than one instance |
| [26](#L26) | \*/ |
| [27](#L27) | private function \_\_clone() { |
| [28](#L28) | } |
| [29](#L29) |  |
| [30](#L30) | /\*\* |
| [31](#L31) | \*      Prevent from creating more than one instance |
| [32](#L32) | \*/ |
| [33](#L33) | private function \_\_construct() { |
| [34](#L34) | add\_action('admin\_init', array(&$this,'admin\_init') ); |
| [35](#L35) | add\_action('admin\_menu', array(&$this,'add\_options\_page') ); |
| [36](#L36) |  |
| [37](#L37) | if ( WP\_reCaptcha::is\_network\_activated() ) { |
| [38](#L38) | $page\_hook = 'settings\_page\_racaptcha-settings'; |
| [39](#L39) | add\_action( "load-{$page\_hook}", array( &$this , 'enqueue\_styles' )); |
| [40](#L40) | add\_action( "load-{$page\_hook}", array( &$this , 'process\_network\_settings' )); |
| [41](#L41) | add\_action( 'network\_admin\_menu', array( &$this , 'network\_settings\_menu' )); |
| [42](#L42) | } |
| [43](#L43) |  |
| [44](#L44) | add\_action( 'pre\_update\_option\_recaptcha\_publickey' , array( &$this , 'update\_option\_recaptcha\_apikey' ) , 10 , 2 ); |
| [45](#L45) | add\_action( 'pre\_update\_option\_recaptcha\_privatekey' , array( &$this , 'update\_option\_recaptcha\_apikey' ) , 10 , 2 ); |
| [46](#L46) | add\_action( 'add\_option\_recaptcha\_publickey' , array( &$this , 'add\_option\_recaptcha\_apikey' ) , 10 , 2 ); |
| [47](#L47) | add\_action( 'add\_option\_recaptcha\_privatekey' , array( &$this , 'add\_option\_recaptcha\_apikey' ) , 10 , 2 ); |
| [48](#L48) | } |
| [49](#L49) |  |
| [50](#L50) |  |
| [51](#L51) | /\*\* |
| [52](#L52) | \*      Process network options |
| [53](#L53) | \*/ |
| [54](#L54) | function process\_network\_settings() { |
| [55](#L55) | if ( current\_user\_can('manage\_network') ) { |
| [56](#L56) | $opts = array( |
| [57](#L57) | 'recaptcha\_publickey' => 'trim', |
| [58](#L58) | 'recaptcha\_privatekey' => 'trim', |
| [59](#L59) | 'recaptcha\_enable\_comments' => 'intval', |
| [60](#L60) | 'recaptcha\_enable\_signup' => 'intval', |
| [61](#L61) | 'recaptcha\_enable\_login' => 'intval', |
| [62](#L62) | 'recaptcha\_enable\_lostpw' => 'intval', |
| [63](#L63) | 'recaptcha\_enable\_wc\_order' => 'intval', |
| [64](#L64) | 'recaptcha\_disable\_for\_known\_users' => 'intval', |
| [65](#L65) | 'recaptcha\_noscript' => 'intval', |
| [66](#L66) | 'recaptcha\_comment\_use\_42\_filter' => 'intval', |
| [67](#L67) | ); |
| [68](#L68) | if ( array\_intersect( array\_keys( $\_POST ) , array\_keys( $opts ) ) ) |
| [69](#L69) | check\_admin\_referer( 'recaptcha-network-settings' ); |
| [70](#L70) |  |
| [71](#L71) | $updated = false; |
| [72](#L72) | foreach ( $opts as $option\_name => $sanitize\_cb ) { |
| [73](#L73) | if ( isset( $\_POST[ $option\_name ] ) ) { |
| [74](#L74) | $option\_value = sanitize\_text\_field( $\_POST[ $option\_name ] ); |
| [75](#L75) | if ( is\_callable($sanitize\_cb) ) |
| [76](#L76) | $option\_value = call\_user\_func($sanitize\_cb,$\_POST[$option\_name]); |
| [77](#L77) | update\_site\_option( $option\_name , $option\_value ); |
| [78](#L78) | $updated = true; |
| [79](#L79) | } |
| [80](#L80) | } |
| [81](#L81) | if ( $updated ) { |
| [82](#L82) | $redirect = $this->remove\_new\_apikey\_url(add\_query\_arg(array('updated'=>'true') ) ); |
| [83](#L83) | wp\_redirect( $redirect ); |
| [84](#L84) | } |
| [85](#L85) | } else { |
| [86](#L86) | wp\_die('Cheating, uh?'); |
| [87](#L87) | } |
| [88](#L88) | // expecting api keys, |
| [89](#L89) | } |
| [90](#L90) |  |
| [91](#L91) | /\*\* |
| [92](#L92) | \*      Network menu hook |
| [93](#L93) | \*/ |
| [94](#L94) | function network\_settings\_menu(){ |
| [95](#L95) | add\_submenu\_page( |
| [96](#L96) | 'settings.php', |
| [97](#L97) | \_\_( 'reCaptcha Settings' , 'wp-recaptcha-integration' ), |
| [98](#L98) | \_\_( 'reCaptcha' , 'wp-recaptcha-integration' ), |
| [99](#L99) | 'manage\_network', 'racaptcha-settings', |
| [100](#L100) | array(&$this , 'network\_settings\_page' ) ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \*      Network Settings page |
| [105](#L105) | \*/ |
| [106](#L106) | function network\_settings\_page() { |
| [107](#L107) | // h1, form, nonce, sanitize, process |
| [108](#L108) | ?><div class="wrap"><?php |
| [109](#L109) | ?><h2><?php \_e( 'reCaptcha Settings' , 'wp-recaptcha-integration' ) ?></h2><?php |
| [110](#L110) | ?><form method="post"><?php |
| [111](#L111) | wp\_nonce\_field( 'recaptcha-network-settings'  ); |
| [112](#L112) | do\_settings\_sections('recaptcha'); |
| [113](#L113) | submit\_button(); |
| [114](#L114) | ?></form><?php |
| [115](#L115) | ?></div><?php |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) |  |
| [120](#L120) | /\*\* |
| [121](#L121) | \*      Update option hook. Remove url params for redirect |
| [122](#L122) | \* |
| [123](#L123) | \*      @param new updated option value |
| [124](#L124) | \*      @param old old option value |
| [125](#L125) | \*/ |
| [126](#L126) | function update\_option\_recaptcha\_apikey( $new , $old ){ |
| [127](#L127) | delete\_transient('recaptcha\_keys\_okay'); |
| [128](#L128) | add\_filter( 'wp\_redirect' , array( &$this , 'remove\_new\_apikey\_url' ) ); |
| [129](#L129) | return $new; |
| [130](#L130) | } |
| [131](#L131) | /\*\* |
| [132](#L132) | \*      Add option hook. See update\_option\_recaptcha\_apikey() |
| [133](#L133) | \* |
| [134](#L134) | \*      @param option option name |
| [135](#L135) | \*      @param value option value |
| [136](#L136) | \*/ |
| [137](#L137) | function add\_option\_recaptcha\_apikey( $option , $value ){ |
| [138](#L138) | delete\_transient('recaptcha\_keys\_okay'); |
| [139](#L139) | if ( in\_array( $option , array('recaptcha\_publickey','recaptcha\_privatekey') ) ) |
| [140](#L140) | add\_filter( 'wp\_redirect' , array( &$this , 'remove\_new\_apikey\_url' ) ); |
| [141](#L141) | } |
| [142](#L142) |  |
| [143](#L143) | /\*\* |
| [144](#L144) | \*      Removes Update api key url params |
| [145](#L145) | \*      @param url URL |
| [146](#L146) | \*      @return string URL without params removed |
| [147](#L147) | \*/ |
| [148](#L148) | function remove\_new\_apikey\_url( $url = null ) { |
| [149](#L149) | return remove\_query\_arg( array('\_wpnonce' , 'recaptcha-action' , 'settings-updated' ) , $url ); |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) | /\*\* |
| [153](#L153) | \*      Admin Notices hook to show up when the api keys heve not been entered. |
| [154](#L154) | \*/ |
| [155](#L155) | function api\_key\_notice() { |
| [156](#L156) | ?><div class="notice error above-h1"><p><?php |
| [157](#L157) | printf( |
| [158](#L158) | \_\_( '<strong>reCaptcha needs your attention:</strong> To make it work You need to enter an api key. <br />You can do so at the <a href="%s">reCaptcha settings page</a>.' , 'wp-recaptcha-integration' ), |
| [159](#L159) | admin\_url( add\_query\_arg( 'page' , 'recaptcha' , 'options-general.php' ) ) |
| [160](#L160) | ); |
| [161](#L161) | ?></p></div><?php |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | /\*\* |
| [165](#L165) | \*      admin init hook. Setup settings according. |
| [166](#L166) | \*/ |
| [167](#L167) | function admin\_init( ) { |
| [168](#L168) | $has\_api\_key = WP\_reCaptcha::instance()->has\_api\_key(); |
| [169](#L169) | if ( ! $has\_api\_key && current\_user\_can( 'manage\_options' ) ) { |
| [170](#L170) | add\_action('admin\_notices',array( &$this , 'api\_key\_notice')); |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | $this->enter\_api\_key = ! $has\_api\_key || ( isset($\_REQUEST['recaptcha-action']) && $\_REQUEST['recaptcha-action'] == 'recaptcha-set-api-key'); |
| [174](#L174) |  |
| [175](#L175) | if ( ! $this->enter\_api\_key ) { |
| [176](#L176) | add\_settings\_section( 'recaptcha\_protection' , \_\_( 'Protect' , 'wp-recaptcha-integration' ), array( &$this , 'explain\_protection' ), 'recaptcha'); |
| [177](#L177) | add\_settings\_section( 'recaptcha\_styling' ,  \_\_( 'Style' , 'wp-recaptcha-integration' ), array( &$this , 'explain\_styling' ), 'recaptcha'); |
| [178](#L178) | } |
| [179](#L179) | add\_settings\_section( 'recaptcha\_apikey' , \_\_( 'Connect' , 'wp-recaptcha-integration' ), array( &$this , 'explain\_apikey' ), 'recaptcha'); |
| [180](#L180) | if ( ! $this->enter\_api\_key ) { |
| [181](#L181) | add\_settings\_section( 'recaptcha\_advanced' ,  \_\_( 'Advanced' , 'wp-recaptcha-integration' ), array( &$this , 'explain\_advanced' ), 'recaptcha'); |
| [182](#L182) | } |
| [183](#L183) | if ( $this->enter\_api\_key ) { |
| [184](#L184) | // no API Key. Let the user enter it. |
| [185](#L185) | register\_setting( 'recaptcha\_options', 'recaptcha\_publickey' , 'trim' ); |
| [186](#L186) | register\_setting( 'recaptcha\_options', 'recaptcha\_privatekey' , 'trim' ); |
| [187](#L187) | add\_settings\_field('recaptcha\_publickey', \_\_('Site key','wp-recaptcha-integration'), array(&$this,'secret\_input\_text'), 'recaptcha', 'recaptcha\_apikey' , array('name'=>'recaptcha\_publickey') ); |
| [188](#L188) | add\_settings\_field('recaptcha\_privatekey', \_\_('Secret key','wp-recaptcha-integration'), array(&$this,'secret\_input\_text'), 'recaptcha', 'recaptcha\_apikey', array('name'=>'recaptcha\_privatekey')); |
| [189](#L189) | if ( $has\_api\_key ) { |
| [190](#L190) | add\_settings\_field('cancel', '' , array(&$this,'cancel\_enter\_api\_key'), 'recaptcha', 'recaptcha\_apikey' ); |
| [191](#L191) | } |
| [192](#L192) | } else { |
| [193](#L193) | // API Key. Add test tool. |
| [194](#L194) | add\_action('wp\_ajax\_recaptcha-init-test-api-key' , array( &$this , 'ajax\_init\_test\_api\_key' ) ); |
| [195](#L195) | add\_action('wp\_ajax\_recaptcha-test-api-key' , array( &$this , 'ajax\_test\_api\_key' ) ); |
| [196](#L196) | add\_action('wp\_ajax\_recaptcha-test-verification' , array( &$this , 'ajax\_test\_api\_key\_verification' ) ); |
| [197](#L197) | } |
| [198](#L198) |  |
| [199](#L199) | if ( $has\_api\_key ) { |
| [200](#L200) | if (  ! WP\_reCaptcha::is\_network\_activated() ||  ! is\_network\_admin()  ) { |
| [201](#L201) | // local options |
| [202](#L202) | register\_setting( 'recaptcha\_options', 'recaptcha\_language'  , array( &$this , 'sanitize\_language' ) ); |
| [203](#L203) | register\_setting( 'recaptcha\_options', 'recaptcha\_flavor' , array( &$this , 'sanitize\_flavor' ) ); |
| [204](#L204) | register\_setting( 'recaptcha\_options', 'recaptcha\_theme'  , array( &$this , 'sanitize\_theme' ) ); |
| [205](#L205) | register\_setting( 'recaptcha\_options', 'recaptcha\_disable\_submit' , 'intval'); |
| [206](#L206) |  |
| [207](#L207) | register\_setting( 'recaptcha\_options', 'recaptcha\_noscript' , 'intval'); |
| [208](#L208) |  |
| [209](#L209) |  |
| [210](#L210) | add\_settings\_field('recaptcha\_flavor', \_\_('Flavor','wp-recaptcha-integration'), |
| [211](#L211) | array(&$this,'input\_radio'), 'recaptcha', 'recaptcha\_styling', |
| [212](#L212) | array( |
| [213](#L213) | 'name' => 'recaptcha\_flavor', |
| [214](#L214) | 'items' => array( |
| [215](#L215) | array( |
| [216](#L216) | 'value' => 'grecaptcha', |
| [217](#L217) | 'label' => \_\_( 'No Captcha where you just click a button' , 'wp-recaptcha-integration' ), |
| [218](#L218) | ), |
| [219](#L219) | array( |
| [220](#L220) | 'value' => 'recaptcha', |
| [221](#L221) | 'label' => \_\_( 'Old style reCAPTCHA where you type some cryptic text' , 'wp-recaptcha-integration' ), |
| [222](#L222) | ), |
| [223](#L223) | ), |
| [224](#L224) | ) ); |
| [225](#L225) |  |
| [226](#L226) | add\_settings\_field('recaptcha\_language', \_\_( 'Language Settings','wp-recaptcha-integration' ), array(&$this,'select\_language'), 'recaptcha', 'recaptcha\_styling'); |
| [227](#L227) |  |
| [228](#L228) | add\_settings\_field('recaptcha\_theme', \_\_('Theme','wp-recaptcha-integration'), array(&$this,'select\_theme'), 'recaptcha', 'recaptcha\_styling'); |
| [229](#L229) |  |
| [230](#L230) | add\_settings\_field('recaptcha\_disable\_submit', \_\_('Disable Submit Button','wp-recaptcha-integration'), |
| [231](#L231) | array(&$this,'input\_checkbox'), 'recaptcha', 'recaptcha\_styling' , |
| [232](#L232) | array('name'=>'recaptcha\_disable\_submit','label'=>\_\_( 'Disable Form Submit Button until no-captcha is entered.' ,'wp-recaptcha-integration' ) ) |
| [233](#L233) | ); |
| [234](#L234) | add\_settings\_field('recaptcha\_noscript', \_\_('Noscript Fallback','wp-recaptcha-integration'), |
| [235](#L235) | array(&$this,'input\_checkbox'), 'recaptcha', 'recaptcha\_advanced' , |
| [236](#L236) | array( |
| [237](#L237) | 'name'=>'recaptcha\_noscript', |
| [238](#L238) | 'label'=>\_\_( 'Provide a fallback for non javascript capable browsers.','wp-recaptcha-integration' ), |
| [239](#L239) | 'description' => \_\_( 'Leave this unchecked when your site requires JavaScript anyway.','wp-recaptcha-integration' ), |
| [240](#L240) | 'class' => 'flavor-grecaptcha', |
| [241](#L241) | ) |
| [242](#L242) | ); |
| [243](#L243) |  |
| [244](#L244) | global $wp\_version; |
| [245](#L245) | if ( version\_compare( $wp\_version , '4.2' ) >= 0 ) { |
| [246](#L246) | register\_setting( 'recaptcha\_options', 'recaptcha\_comment\_use\_42\_filter' , 'intval'); |
| [247](#L247) | add\_settings\_field('recaptcha\_comment\_use\_42\_filter', \_\_('Comment Form rendering','wp-recaptcha-integration'), |
| [248](#L248) | array(&$this,'input\_checkbox'), 'recaptcha', 'recaptcha\_advanced' , |
| [249](#L249) | array( |
| [250](#L250) | 'name'=>'recaptcha\_comment\_use\_42\_filter', |
| [251](#L251) | 'label'=>\_\_( 'My Comment Form is WordPress 4.2 compatible.','wp-recaptcha-integration' ), |
| [252](#L252) | 'description' => \_\_( 'Enable this when your comment form uses the <code>comment\_form\_submit\_button</code> filter. (Or just try if it works.)','wp-recaptcha-integration' ), |
| [253](#L253) | 'class' => 'flavor-grecaptcha', |
| [254](#L254) | ) |
| [255](#L255) | ); |
| [256](#L256) | } |
| [257](#L257) | } |
| [258](#L258) |  |
| [259](#L259) | if ( ! WP\_reCaptcha::is\_network\_activated() || is\_network\_admin() ) { |
| [260](#L260) | // network options |
| [261](#L261) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_comments' , 'intval'); |
| [262](#L262) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_signup', 'intval' ); |
| [263](#L263) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_login' , 'intval'); |
| [264](#L264) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_lostpw' , 'intval'); |
| [265](#L265) | register\_setting( 'recaptcha\_options', 'recaptcha\_lockout' , 'intval'); |
| [266](#L266) |  |
| [267](#L267) | if ( function\_exists('WC') ) { |
| [268](#L268) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_wc\_order' , 'intval'); |
| [269](#L269) | } |
| [270](#L270) | if ( class\_exists( 'Awesome\_Support' ) ) { |
| [271](#L271) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_as\_registration' , 'intval'); |
| [272](#L272) | } |
| [273](#L273) | if ( class\_exists( 'bbPress' ) ) { |
| [274](#L274) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_bbp\_topic' , 'intval'); |
| [275](#L275) | register\_setting( 'recaptcha\_options', 'recaptcha\_enable\_bbp\_reply' , 'intval'); |
| [276](#L276) | } |
| [277](#L277) |  |
| [278](#L278) | register\_setting( 'recaptcha\_options', 'recaptcha\_disable\_for\_known\_users' , 'intval'); |
| [279](#L279) |  |
| [280](#L280) | $protect\_settings = array(); |
| [281](#L281) | $protect\_settings[] = array( |
| [282](#L282) | 'name'                  =>      'recaptcha\_enable\_comments', |
| [283](#L283) | 'label'                 =>      \_\_('Comment Form','wp-recaptcha-integration'), |
| [284](#L284) | 'class'                 =>      '', |
| [285](#L285) | ); |
| [286](#L286) | $protect\_settings[] = array( |
| [287](#L287) | 'name'                  =>      'recaptcha\_enable\_signup', |
| [288](#L288) | 'label'                 =>      \_\_('Signup Form','wp-recaptcha-integration'), |
| [289](#L289) | 'class'                 =>      '', |
| [290](#L290) | ); |
| [291](#L291) | $protect\_settings[] = array( |
| [292](#L292) | 'name'                  =>      'recaptcha\_enable\_login', |
| [293](#L293) | 'label'                 =>      \_\_('Login Form','wp-recaptcha-integration'), |
| [294](#L294) | 'class'                 =>      '', |
| [295](#L295) | ); |
| [296](#L296) | $protect\_settings[] = array( |
| [297](#L297) | 'name'                  =>      'recaptcha\_enable\_lostpw', |
| [298](#L298) | 'label'                 =>      \_\_('Lost Password Form','wp-recaptcha-integration'), |
| [299](#L299) | 'class'                 =>      '', |
| [300](#L300) | ); |
| [301](#L301) |  |
| [302](#L302) | if ( function\_exists('WC') ) { |
| [303](#L303) | $wc\_warn =  WP\_reCaptcha::instance()->get\_option('recaptcha\_enable\_wc\_order') && WP\_reCaptcha::instance()->get\_option('recaptcha\_flavor') !== 'grecaptcha'; |
| [304](#L304) | $protect\_settings[] = array( |
| [305](#L305) | 'name'=>'recaptcha\_enable\_wc\_order', |
| [306](#L306) | 'label'=>\_\_( 'woocommerce Checkout','wp-recaptcha-integration' ), |
| [307](#L307) | 'class' => 'flavor-grecaptcha', |
| [308](#L308) | ); |
| [309](#L309) | } |
| [310](#L310) |  |
| [311](#L311) | if ( class\_exists( 'Awesome\_Support' ) ) { |
| [312](#L312) |  |
| [313](#L313) | $protect\_settings[] = array( |
| [314](#L314) | 'name'=>'recaptcha\_enable\_as\_registration', |
| [315](#L315) | 'label'=>\_\_( 'Awesome Support Registration','wp-recaptcha-integration' ), |
| [316](#L316) | 'class' => '', |
| [317](#L317) | ); |
| [318](#L318) | } |
| [319](#L319) |  |
| [320](#L320) | if ( class\_exists( 'bbPress' ) ) { |
| [321](#L321) | $protect\_settings[] = array( |
| [322](#L322) | 'name'  => 'recaptcha\_enable\_bbp\_topic', |
| [323](#L323) | 'label' => \_\_( 'bbPress New Topic','wp-recaptcha-integration' ), |
| [324](#L324) | 'class' => 'flavor-grecaptcha', |
| [325](#L325) | ); |
| [326](#L326) |  |
| [327](#L327) | $protect\_settings[] = array( |
| [328](#L328) | 'name'  => 'recaptcha\_enable\_bbp\_reply', |
| [329](#L329) | 'label' => \_\_( 'bbPress New Reply','wp-recaptcha-integration' ), |
| [330](#L330) | 'class' => 'flavor-grecaptcha', |
| [331](#L331) | ); |
| [332](#L332) | } |
| [333](#L333) |  |
| [334](#L334) | add\_settings\_field('recaptcha\_protection', \_\_('Forms to protect','wp-recaptcha-integration'), |
| [335](#L335) | array(&$this,'input\_protect'), 'recaptcha', 'recaptcha\_protection' , |
| [336](#L336) | $protect\_settings |
| [337](#L337) | ); |
| [338](#L338) |  |
| [339](#L339) | add\_settings\_field('recaptcha\_disable\_for\_known\_users', \_\_('Disable for known users','wp-recaptcha-integration'), |
| [340](#L340) | array(&$this,'input\_checkbox'), 'recaptcha', 'recaptcha\_protection' , |
| [341](#L341) | array('name'=>'recaptcha\_disable\_for\_known\_users','label'=>\_\_( 'Disable reCaptcha verification for logged in users.','wp-recaptcha-integration' )) |
| [342](#L342) | ); |
| [343](#L343) |  |
| [344](#L344) | add\_settings\_field('recaptcha\_lockout', \_\_('Prevent lockout','wp-recaptcha-integration'), |
| [345](#L345) | array(&$this,'input\_checkbox'), 'recaptcha', 'recaptcha\_protection' , |
| [346](#L346) | array( |
| [347](#L347) | 'name'=>'recaptcha\_lockout', |
| [348](#L348) | 'label'=>\_\_( 'Allow administrator to log in if API keys do not work.','wp-recaptcha-integration' ), |
| [349](#L349) | 'description' => \_\_( 'When the captcha verification fails, and the private or public API key does not work the plugin will let you in anyway. Please note that with this option checked plus a broken keypair your site will be open to brute force attacks, that try to guess an administrator password.','wp-recaptcha-integration' ), |
| [350](#L350) | ) |
| [351](#L351) | ); |
| [352](#L352) | } |
| [353](#L353) |  |
| [354](#L354) | if ( ! WP\_reCaptcha::instance()->get\_option( 'recaptcha\_publickey' ) || ! WP\_reCaptcha::instance()->get\_option( 'recaptcha\_privatekey' ) ) |
| [355](#L355) | add\_settings\_error('recaptcha',1,\_\_('Please configure the public and private key. <a href="http://www.google.com/recaptcha/whyrecaptcha">What are you trying to tell me?</a>','wp-recaptcha-integration'),'updated'); |
| [356](#L356) | } |
| [357](#L357) | } |
| [358](#L358) |  |
| [359](#L359) | /\*\* |
| [360](#L360) | \*      Intro text for the api key setting |
| [361](#L361) | \*/ |
| [362](#L362) | public function explain\_apikey( ) { |
| [363](#L363) | if ( $this->enter\_api\_key ) { |
| [364](#L364) | ?><p class="description"><?php |
| [365](#L365) | $info\_url = 'https://developers.google.com/recaptcha/intro'; |
| [366](#L366) | $admin\_url = 'https://www.google.com/recaptcha/admin'; |
| [367](#L367) | printf( |
| [368](#L368) | \_\_( 'Please register your blog through the <a href="%s">Google reCAPTCHA admin page</a> and enter the public and private key in the fields below. <a href="%s">What is this all about?</a>', 'wp-recaptcha-integration' ) , |
| [369](#L369) | $admin\_url , $info\_url |
| [370](#L370) | ); |
| [371](#L371) | ?></p><?php |
| [372](#L372) | ?><input type="hidden" name="recaptcha-action" value="recaptcha-set-api-key" /><?php |
| [373](#L373) | } else { |
| [374](#L374) | ?><div class="recaptcha-explain"><?php |
| [375](#L375) | ?><p class="description"><?php |
| [376](#L376) | \_e( 'You already entered an API Key. Use the button below to enter it again.','wp-recaptcha-integration'); |
| [377](#L377) | ?></p><?php |
| [378](#L378) | $action = 'recaptcha-set-api-key'; |
| [379](#L379) | $nonce = wp\_create\_nonce( $action ); |
| [380](#L380) | $new\_url = add\_query\_arg( array('\_wpnonce' => $nonce , 'recaptcha-action' => $action ) ); |
| [381](#L381) |  |
| [382](#L382) | $action = 'recaptcha-test-api-key'; |
| [383](#L383) | $nonce = wp\_create\_nonce( $action ); |
| [384](#L384) | $test\_url = add\_query\_arg( array('\_wpnonce' => $nonce , 'action' => $action ) , admin\_url( 'admin-ajax.php' ) ); |
| [385](#L385) |  |
| [386](#L386) | $action = 'recaptcha-init-test-api-key'; |
| [387](#L387) | $nonce = wp\_create\_nonce( $action ); |
| [388](#L388) | $init\_test\_url = add\_query\_arg( array('\_wpnonce' => $nonce , 'action' => $action ) , admin\_url( 'admin-ajax.php' ) ); |
| [389](#L389) |  |
| [390](#L390) | ?><p class="submit"><?php |
| [391](#L391) | ?><a class="button" href="<?php echo $new\_url ?>"><?php \_e('New API Key' , 'wp-recaptcha-integration') ?></a><?php |
| [392](#L392) | ?><a id="test-api-key" class="button" data-init-href="<?php echo $init\_test\_url ?>" href="<?php echo $test\_url ?>"><?php \_e('Test API Key' , 'wp-recaptcha-integration') ?></a><?php |
| [393](#L393) | ?></p><?php |
| [394](#L394) | ?></div><?php |
| [395](#L395) | } |
| [396](#L396) | } |
| [397](#L397) |  |
| [398](#L398) | /\*\* |
| [399](#L399) | \*      Intro text for the Protection setting |
| [400](#L400) | \*/ |
| [401](#L401) | public function explain\_protection() { |
| [402](#L402) | ?><div class="recaptcha-explain"><?php |
| [403](#L403) | ?><p class="description"><?php |
| [404](#L404) | \_e( 'Select which forms you want to protect with a captcha.' , 'wp-recaptcha-integration' ); |
| [405](#L405) | ?></p><?php |
| [406](#L406) | ?></div><?php |
| [407](#L407) | } |
| [408](#L408) |  |
| [409](#L409) | /\*\* |
| [410](#L410) | \*      Intro text for the Protection setting |
| [411](#L411) | \*/ |
| [412](#L412) | public function explain\_advanced() { |
| [413](#L413) | // nothing to say here, huh? |
| [414](#L414) | } |
| [415](#L415) | /\*\* |
| [416](#L416) | \*      Intro text for the Styling setting |
| [417](#L417) | \*/ |
| [418](#L418) | public function explain\_styling() { |
| [419](#L419) | ?><div class="recaptcha-explain"><?php |
| [420](#L420) | ?><p class="description"><?php |
| [421](#L421) | \_e( 'Choose a flavor and theme for your Captcha. Please note that with the old style reCaptcha you cannot have more than one captcha per page.' , 'wp-recaptcha-integration' ); |
| [422](#L422) | ?></p><?php |
| [423](#L423) | ?></div><?php |
| [424](#L424) | } |
| [425](#L425) |  |
| [426](#L426) |  |
| [427](#L427) | /\*\* |
| [428](#L428) | \*      Test api key ajax response. |
| [429](#L429) | \*      Returns reCaptcha HTML |
| [430](#L430) | \*/ |
| [431](#L431) | public function ajax\_init\_test\_api\_key() { |
| [432](#L432) | if ( isset( $\_REQUEST['\_wpnonce'] ) && wp\_verify\_nonce( $\_REQUEST['\_wpnonce'] , $\_REQUEST['action'] ) ) { |
| [433](#L433) | header('Content-Type: text/html'); |
| [434](#L434) | add\_filter('option\_recaptcha\_disable\_submit','\_\_return\_false'); |
| [435](#L435) | WP\_reCaptcha\_noCaptcha::instance()->print\_head( 'grecaptcha' ); |
| [436](#L436) | WP\_reCaptcha\_noCaptcha::instance()->print\_foot( 'grecaptcha' ); |
| [437](#L437) | } |
| [438](#L438) | exit(0); |
| [439](#L439) | } |
| [440](#L440) | /\*\* |
| [441](#L441) | \*      Test api key ajax response. |
| [442](#L442) | \*      Returns reCaptcha HTML |
| [443](#L443) | \*/ |
| [444](#L444) | public function ajax\_test\_api\_key() { |
| [445](#L445) | if ( isset( $\_REQUEST['\_wpnonce'] ) && wp\_verify\_nonce( $\_REQUEST['\_wpnonce'] , $\_REQUEST['action'] ) ) { |
| [446](#L446) | header('Content-Type: text/html'); |
| [447](#L447) | //                      WP\_reCaptcha::instance()->recaptcha\_head( 'grecaptcha' ); |
| [448](#L448) | //                      WP\_reCaptcha::instance()->recaptcha\_foot( 'grecaptcha' ); |
| [449](#L449) | echo WP\_reCaptcha\_noCaptcha::instance()->get\_html( 'grecaptcha' ); |
| [450](#L450) | $action = 'recaptcha-test-verification'; |
| [451](#L451) | $nonce = wp\_create\_nonce( $action ); |
| [452](#L452) | ?><input type="hidden" name="<?php echo $action ?>-nonce" value="<?php echo $nonce ?>" /><?php |
| [453](#L453) | ?><button id="<?php echo $action ?>" name="action" class="button-primary" value="<?php echo $action ?>"><?php \_e('Test verfication','wp-recaptcha-integration') ?></button><?php |
| [454](#L454) | } |
| [455](#L455) | exit(0); |
| [456](#L456) | } |
| [457](#L457) | /\*\* |
| [458](#L458) | \*      Test api key ajax response. |
| [459](#L459) | \*      checks the verification process and shows an error on fail. |
| [460](#L460) | \*/ |
| [461](#L461) | public function ajax\_test\_api\_key\_verification() { |
| [462](#L462) | if ( isset( $\_REQUEST['\_wpnonce'] ) && wp\_verify\_nonce( $\_REQUEST['\_wpnonce'] , $\_REQUEST['action'] ) ) { |
| [463](#L463) | header('Content-Type: text/html'); |
| [464](#L464) | if ( ! WP\_reCaptcha\_noCaptcha::instance()->check( 'grecaptcha' ) ) { |
| [465](#L465) | $errs = array( |
| [466](#L466) | 'missing-input-secret' => \_\_('The secret Key is missing.','wp-recaptcha-integration'), |
| [467](#L467) | 'invalid-input-secret' => \_\_('The secret Key is invalid. You better check your domain configuration and enter it again.','wp-recaptcha-integration'), |
| [468](#L468) | 'missing-input-response' => \_\_('The user response was missing','wp-recaptcha-integration'), |
| [469](#L469) | 'invalid-input-response' => \_\_('Invalid user response','wp-recaptcha-integration'), |
| [470](#L470) | ); |
| [471](#L471) | $result = (array) WP\_reCaptcha\_noCaptcha::instance()->get\_last\_result(); |
| [472](#L472) | if ( isset( $result['error-codes'] ) ) { |
| [473](#L473) | foreach ( $result['error-codes'] as $err ) { |
| [474](#L474) | ?><div class="error"><p><?php echo $errs[$err]; ?></p></div><?php |
| [475](#L475) | } |
| [476](#L476) | } |
| [477](#L477) | } else { |
| [478](#L478) | ?><div class="updated"><p><?php \_e('Works! All good!','wp-recaptcha-integration') ?></p></div><?php |
| [479](#L479) | } |
| [480](#L480) | } |
| [481](#L481) | exit(0); |
| [482](#L482) | } |
| [483](#L483) |  |
| [484](#L484) | /\*\* |
| [485](#L485) | \*      Link for canceling api key entering |
| [486](#L486) | \*      checks the verification process and shows an error on fail. |
| [487](#L487) | \*/ |
| [488](#L488) | public function cancel\_enter\_api\_key() { |
| [489](#L489) | $url = $this->remove\_new\_apikey\_url( add\_query\_arg(null,null) ); |
| [490](#L490) | ?><a class="button" href="<?php echo $url ?>"><?php \_e( 'Cancel' ) ?></a><?php |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | /\*\* |
| [494](#L494) | \*      Radio buttons |
| [495](#L495) | \* |
| [496](#L496) | \*      @param args array( |
| [497](#L497) | \*                                      'name' => name of the input field, |
| [498](#L498) | \*                                      'items' => array( |
| [499](#L499) | \*                                              array( |
| [500](#L500) | \*                                                      'value' => '', // the radio button value, must match an option name |
| [501](#L501) | \*                                                      'label' => '', // the button label |
| [502](#L502) | \*                                              ), |
| [503](#L503) | \*                                              ... |
| [504](#L504) | \*                                      ) |
| [505](#L505) | \*                              ) |
| [506](#L506) | \*/ |
| [507](#L507) | public function input\_radio( $args ) { |
| [508](#L508) | extract($args); // name, items |
| [509](#L509) | $option = WP\_reCaptcha::instance()->get\_option( $name ); |
| [510](#L510) | foreach ( $items as $item ) { |
| [511](#L511) | extract( $item ); // value, label |
| [512](#L512) | ?><label for="<?php echo "$name-$value" ?>"><?php |
| [513](#L513) | ?><input id="<?php echo "$name-$value" ?>" type="radio" name="<?php echo $name ?>" value="<?php echo $value ?>" <?php checked($value,$option,true) ?> /> |
| [514](#L514) | <?php |
| [515](#L515) | echo $label; |
| [516](#L516) | ?></label><br /><?php |
| [517](#L517) | } |
| [518](#L518) | } |
| [519](#L519) |  |
| [520](#L520) | /\*\* |
| [521](#L521) | \*      A Checkbox |
| [522](#L522) | \* |
| [523](#L523) | \*      @param args array( |
| [524](#L524) | \*                                      'name' => '', // checkbox field name, must match an option name |
| [525](#L525) | \*                                      'label' => '', // button label |
| [526](#L526) | \*                              ) |
| [527](#L527) | \*/ |
| [528](#L528) | public function input\_checkbox($args) { |
| [529](#L529) | $args = wp\_parse\_args($args,array( |
| [530](#L530) | 'name' => '', |
| [531](#L531) | 'label' => '', |
| [532](#L532) | 'description' => '', |
| [533](#L533) | 'class' => '', |
| [534](#L534) | )); |
| [535](#L535) | extract($args); |
| [536](#L536) | $value = WP\_reCaptcha::instance()->get\_option( $name ); |
| [537](#L537) | $class\_attr = $class ? "class=\"{$class}\"" : ''; |
| [538](#L538) | ?><label <?php echo $class\_attr ?> for="<?php echo $name ?>"><?php |
| [539](#L539) | ?><input type="hidden" name="<?php echo $name ?>" value="0" /><?php |
| [540](#L540) | ?><input id="<?php echo $name ?>" type="checkbox" name="<?php echo $name ?>" value="1" <?php checked($value,1,true) ?> /> |
| [541](#L541) | <?php |
| [542](#L542) | echo $label; |
| [543](#L543) | if ( $description ) { |
| [544](#L544) | ?><p class="description"><?php echo $description ?></p><?php |
| [545](#L545) | } |
| [546](#L546) | ?></label><?php |
| [547](#L547) | } |
| [548](#L548) |  |
| [549](#L549) | /\*\* |
| [550](#L550) | \*      On/off switch. Basically A Checkbox |
| [551](#L551) | \* |
| [552](#L552) | \*      @param args array( |
| [553](#L553) | \*                                      'name' => '', // checkbox field name, must match an option name |
| [554](#L554) | \*                                      'label' => '', // button label |
| [555](#L555) | \*                                      'description' => '', // button label |
| [556](#L556) | \*                                      'class' => '', // button label |
| [557](#L557) | \*                              ) |
| [558](#L558) | \*/ |
| [559](#L559) | public function input\_check\_onoff($args) { |
| [560](#L560) | $args = wp\_parse\_args($args,array( |
| [561](#L561) | 'name' => '', |
| [562](#L562) | 'label' => '', |
| [563](#L563) | 'class' => '', |
| [564](#L564) | )); |
| [565](#L565) | extract($args); |
| [566](#L566) | $value = WP\_reCaptcha::instance()->get\_option( $name ); |
| [567](#L567) |  |
| [568](#L568) | ?><div class="recaptcha-onoff <?php echo $class ?>"><?php |
| [569](#L569) | ?><input type="hidden" name="<?php echo $name ?>" value="0" /><?php |
| [570](#L570) | ?><input id="<?php echo $name ?>" type="checkbox" name="<?php echo $name ?>" value="1" <?php checked($value,1,true) ?> /><?php |
| [571](#L571) | ?><label for="<?php echo $name ?>"><?php |
| [572](#L572) | ?><span class="dashicons dashicons-lock"></span><?php |
| [573](#L573) | ?><span class="title"><?php echo $label ?></span><?php |
| [574](#L574) | ?></label><?php |
| [575](#L575) | ?></div><?php |
| [576](#L576) | } |
| [577](#L577) |  |
| [578](#L578) | public function input\_protect( $switches ) { |
| [579](#L579) | foreach ( $switches as $switch ) |
| [580](#L580) | $this->input\_check\_onoff( $switch ); |
| [581](#L581) | } |
| [582](#L582) |  |
| [583](#L583) | /\*\* |
| [584](#L584) | \*      A Text field. |
| [585](#L585) | \*      Used for api key input. |
| [586](#L586) | \* |
| [587](#L587) | \*      @param args array( |
| [588](#L588) | \*                                      'name' => checkbox field name, must match an option name |
| [589](#L589) | \*                              ) |
| [590](#L590) | \*/ |
| [591](#L591) | public function secret\_input\_text( $args ) { |
| [592](#L592) | extract( $args ); |
| [593](#L593) | $value = WP\_reCaptcha::instance()->get\_option( $name ); |
| [594](#L594) | ?><input type="text" class="regular-text ltr" name="<?php echo $name ?>" value="<?php //echo $value ?>" /><?php |
| [595](#L595) | } |
| [596](#L596) | /\*\* |
| [597](#L597) | \*      Selector for recaptcha theme |
| [598](#L598) | \*/ |
| [599](#L599) | public function select\_language() { |
| [600](#L600) | $option\_name   = 'recaptcha\_language'; |
| [601](#L601) | $option\_value  = WP\_reCaptcha::instance()->get\_option( $option\_name ); |
| [602](#L602) | $option\_flavor = WP\_reCaptcha::instance()->get\_option( 'recaptcha\_flavor' ); |
| [603](#L603) |  |
| [604](#L604) | $all\_available\_langs = array( |
| [605](#L605) | 'recaptcha'             =>      WP\_reCaptcha\_ReCaptcha::instance()->get\_supported\_languages(), |
| [606](#L606) | 'grecaptcha'    =>      WP\_reCaptcha\_NoCaptcha::instance()->get\_supported\_languages(), |
| [607](#L607) | ); |
| [608](#L608) |  |
| [609](#L609) | ?><div class="recaptcha-select-language flavor-<?php echo $option\_flavor ?>"><?php |
| [610](#L610) | foreach( $all\_available\_langs as $flavor => $available\_langs ) { |
| [611](#L611) | ?><select class="flavor-<?php echo $flavor ?>" name="<?php echo $option\_name ?>[<?php echo $flavor ?>]"><?php |
| [612](#L612) | ?><option <?php selected($option\_value,'',true); ?> value=""><?php \_e( 'Automatic','wp-recaptcha-integration' ); ?></option><?php |
| [613](#L613) | ?><option <?php selected($option\_value,'WPLANG',true); ?> value="WPLANG"><?php \_e( 'Site Language' ); ?></option><?php |
| [614](#L614) | ?><optgroup label="<?php \_e('Other','wp-recaptcha-integration' ) ?>"><?php |
| [615](#L615) | foreach ( $available\_langs as $lang => $lang\_name ) { |
| [616](#L616) | ?><option <?php selected($option\_value,$lang,true); ?> value="<?php echo $lang; ?>"><?php \_e( $lang\_name ); ?></option><?php |
| [617](#L617) | } |
| [618](#L618) | ?></optgroup><?php |
| [619](#L619) | ?></select><?php |
| [620](#L620) | } |
| [621](#L621) | ?></div><?php |
| [622](#L622) | } |
| [623](#L623) | /\*\* |
| [624](#L624) | \*      Selector for recaptcha theme |
| [625](#L625) | \*/ |
| [626](#L626) | public function select\_theme() { |
| [627](#L627) | $option\_name = 'recaptcha\_theme'; |
| [628](#L628) |  |
| [629](#L629) | $grecaptcha\_themes = WP\_reCaptcha\_NoCaptcha::instance()->get\_supported\_themes(); |
| [630](#L630) | $grecaptcha\_themes = array\_map( array( $this , '\_map\_grecaptcha' ) , $grecaptcha\_themes ); |
| [631](#L631) |  |
| [632](#L632) | $recaptcha\_themes  = WP\_reCaptcha\_ReCaptcha::instance()->get\_supported\_themes(); |
| [633](#L633) | $recaptcha\_themes = array\_map( array( $this , '\_map\_recaptcha' ) , $recaptcha\_themes ); |
| [634](#L634) |  |
| [635](#L635) | $themes = $grecaptcha\_themes + $recaptcha\_themes; |
| [636](#L636) |  |
| [637](#L637) | $option\_theme = WP\_reCaptcha::instance()->get\_option($option\_name); |
| [638](#L638) | $option\_flavor = WP\_reCaptcha::instance()->get\_option( 'recaptcha\_flavor' ); |
| [639](#L639) |  |
| [640](#L640) | ?><div class="recaptcha-select-theme"><?php |
| [641](#L641) |  |
| [642](#L642) | foreach ( $themes as $value => $theme ) { |
| [643](#L643) | extract( $theme ); // label, flavor |
| [644](#L644) | ?><div class="theme-item flavor-<?php echo $flavor ?>"><?php |
| [645](#L645) | ?><input <?php checked($value,$option\_theme,true); ?> id="<?php echo "$option\_name-$value" ?>" type="radio" name="<?php echo $option\_name ?>" value="<?php echo $value ?>" /><?php |
| [646](#L646) | ?><label for="<?php echo "$option\_name-$value" ?>"><?php |
| [647](#L647) | ?><span class="title"><?php |
| [648](#L648) | echo $label; |
| [649](#L649) | ?></span><?php |
| [650](#L650) | if ( $value == 'custom' ) { |
| [651](#L651) | ?><span class="visual"><?php |
| [652](#L652) | \_e( 'Unstyled HTML to apply your own Stylesheets.' , 'wp-recaptcha-integration' ); |
| [653](#L653) | ?></span><?php |
| [654](#L654) | } else { |
| [655](#L655) | $src = plugins\_url( "images/{$flavor}-theme-{$value}.png" , dirname(\_\_FILE\_\_)); |
| [656](#L656) | printf( '<img src="%s" alt="%s" />' , $src , $label ); |
| [657](#L657) | } |
| [658](#L658) | ?></label><?php |
| [659](#L659) | ?></div><?php |
| [660](#L660) |  |
| [661](#L661) | } |
| [662](#L662) | ?></div><?php |
| [663](#L663) | ?></div><?php |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) | /\*\* |
| [667](#L667) | \*      @usage select\_theme() |
| [668](#L668) | \*/ |
| [669](#L669) | private function \_map\_grecaptcha( $val ) { |
| [670](#L670) | $val['flavor'] = 'grecaptcha'; |
| [671](#L671) | return $val; |
| [672](#L672) | } |
| [673](#L673) | /\*\* |
| [674](#L674) | \*      @usage select\_theme() |
| [675](#L675) | \*/ |
| [676](#L676) | private function \_map\_recaptcha( $val ) { |
| [677](#L677) | $val['flavor'] = 'recaptcha'; |
| [678](#L678) | return $val; |
| [679](#L679) | } |
| [680](#L680) |  |
| [681](#L681) | /\*\* |
| [682](#L682) | \*      Check if language is supported by current recaptcha flavor |
| [683](#L683) | \*/ |
| [684](#L684) | public function sanitize\_language( $language ) { |
| [685](#L685) | $flavor = isset($\_REQUEST['recaptcha\_flavor']) ? $\_REQUEST['recaptcha\_flavor'] : WP\_reCaptcha::instance()->get\_option('recaptcha\_flavor'); |
| [686](#L686) |  |
| [687](#L687) | if ( isset( $language[$flavor] ) ) |
| [688](#L688) | $language = $language[$flavor]; |
| [689](#L689) |  |
| [690](#L690) | if ( $language != 'WPLANG' ) |
| [691](#L691) | $language = WP\_reCaptcha::instance()->captcha\_instance\_by\_flavor( $flavor )->get\_language( $language ); |
| [692](#L692) | return $language; |
| [693](#L693) | } |
| [694](#L694) | /\*\* |
| [695](#L695) | \*      Check valid recaptcha theme, check if theme fits to flavor |
| [696](#L696) | \*/ |
| [697](#L697) | public function sanitize\_theme( $theme ) { |
| [698](#L698) | $themes\_available = array( |
| [699](#L699) | 'recaptcha' => array( 'white','red','blackglass','clean','custom' ), |
| [700](#L700) | 'grecaptcha' => array( 'light','dark' ), |
| [701](#L701) | ); |
| [702](#L702) | $flavor = WP\_reCaptcha::instance()->get\_option('recaptcha\_flavor'); |
| [703](#L703) |  |
| [704](#L704) | if ( isset($themes\_available[$flavor] ) && in\_array($theme,$themes\_available[$flavor]) ) |
| [705](#L705) | return $theme; |
| [706](#L706) | else if ( isset($themes\_available[$flavor] ) ) |
| [707](#L707) | return $themes\_available[$flavor][0]; |
| [708](#L708) | return 'light'; |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | /\*\* |
| [712](#L712) | \*      Check valid flavor |
| [713](#L713) | \*/ |
| [714](#L714) | public function sanitize\_flavor( $flavor ) { |
| [715](#L715) | if ( in\_array($flavor,array('recaptcha','grecaptcha')) ) |
| [716](#L716) | return $flavor; |
| [717](#L717) | return 'grecaptcha'; |
| [718](#L718) | } |
| [719](#L719) |  |
| [720](#L720) | /\*\* |
| [721](#L721) | \*      Admin menu hook, adds blogs local options page |
| [722](#L722) | \*/ |
| [723](#L723) | public function add\_options\_page() { |
| [724](#L724) | $page\_slug = add\_options\_page( |
| [725](#L725) | \_\_('ReCaptcha','wp-recaptcha-integration'), \_\_('ReCaptcha','wp-recaptcha-integration'), |
| [726](#L726) | 'manage\_options', 'recaptcha', |
| [727](#L727) | array(&$this,'render\_options\_page') |
| [728](#L728) | ); |
| [729](#L729) |  |
| [730](#L730) | add\_action( "load-$page\_slug" , array( &$this , 'enqueue\_styles' ) ); |
| [731](#L731) | } |
| [732](#L732) |  |
| [733](#L733) | /\*\* |
| [734](#L734) | \*      Enqueue script and css for options page. |
| [735](#L735) | \*/ |
| [736](#L736) | public function enqueue\_styles() { |
| [737](#L737) | wp\_enqueue\_style( 'recaptcha-options' , plugins\_url( "css/recaptcha-options.css" , dirname(\_\_FILE\_\_)) ); |
| [738](#L738) | wp\_enqueue\_script( 'recaptcha-options' , plugins\_url( "js/recaptcha-options.js" , dirname(\_\_FILE\_\_)) , array( 'jquery' ) ); |
| [739](#L739) | remove\_action('admin\_notices',array( &$this , 'api\_key\_notice')); |
| [740](#L740) | } |
| [741](#L741) | /\*\* |
| [742](#L742) | \*      Rendering the options page |
| [743](#L743) | \*/ |
| [744](#L744) | public function render\_options\_page() { |
| [745](#L745) | $option\_flavor = WP\_reCaptcha::instance()->get\_option( 'recaptcha\_flavor' ); |
| [746](#L746) | ?><div class="wrap flavor-<?php echo $option\_flavor ?>"><?php |
| [747](#L747) | ?><h2><?php /\*icon\*/ |
| [748](#L748) | \_e('Settings'); |
| [749](#L749) | echo ' › '; |
| [750](#L750) | \_e( 'ReCaptcha' , 'wp-recaptcha-integration' ); |
| [751](#L751) | ?></h2><?php |
| [752](#L752) | /\*      ?><p><?php \_e( '...' , 'googlefont' ); ?></p><?php \*/ |
| [753](#L753) | ?><form action="options.php" method="post"><?php |
| [754](#L754) | settings\_fields( 'recaptcha\_options' ); |
| [755](#L755) | do\_settings\_sections( 'recaptcha' ); |
| [756](#L756) | submit\_button( null , 'primary' , null, null, array('autocomplete'=>'off')); |
| [757](#L757) | ?></form><?php |
| [758](#L758) | ?></div><?php |
| [759](#L759) | } |
| [760](#L760) |  |
| [761](#L761) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-recaptcha-integration/tags/1.2.5/inc/class-wp_recaptcha_options.php?format=txt)
* [Original Format](/export/3220605/wp-recaptcha-integration/tags/1.2.5/inc/class-wp_recaptcha_options.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

