

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3131499)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3131498 "Changeset 3131498")
* [Next Changeset](/changeset/3131500 "Changeset 3131500") →

---

# Changeset 3131499

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
08/06/2024 09:50:31 AM
([5 months](/timeline?from=2024-08-06T09%3A50%3A31Z&precision=second "See timeline at 08/06/2024 09:50:31 AM") ago)

Author:
sbouey
Message:

Update to version 1.3.53

Location:
[falang](/browser/falang?rev=3131499)
Files:

8 edited
1 copied

* [tags/1.3.53](/browser/falang/tags/1.3.53?rev=3131499 "Show entry in browser")
  (copied)
  *(copied from [falang/trunk](/browser/falang/trunk?rev=3103641 "Show original file (revision 3131497)"))*
* [tags/1.3.53/README.txt](/browser/falang/tags/1.3.53/README.txt?rev=3131499 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [tags/1.3.53/admin/class-falang-admin.php](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499 "Show entry in browser")
  (modified)
  ([6 diffs](#file2 "Show differences"))
* [tags/1.3.53/changelog.txt](/browser/falang/tags/1.3.53/changelog.txt?rev=3131499 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [tags/1.3.53/src/Falang/Core/FString.php](/browser/falang/tags/1.3.53/src/Falang/Core/FString.php?rev=3131499 "Show entry in browser")
  (modified)
  ([4 diffs](#file4 "Show differences"))
* [trunk/README.txt](/browser/falang/trunk/README.txt?rev=3131499 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))
* [trunk/admin/class-falang-admin.php](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499 "Show entry in browser")
  (modified)
  ([6 diffs](#file6 "Show differences"))
* [trunk/changelog.txt](/browser/falang/trunk/changelog.txt?rev=3131499 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [trunk/src/Falang/Core/FString.php](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3131499 "Show entry in browser")
  (modified)
  ([4 diffs](#file8 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [falang/tags/1.3.53/README.txt](/changeset/3131499/falang/tags/1.3.53/README.txt "Show the changeset 3131499 restricted to falang/tags/1.3.53/README.txt")

  | [r3103641](/browser/falang/trunk/README.txt?rev=3103641#L4 "Show revision 3103641 of this file in browser") | [r3131499](/browser/falang/tags/1.3.53/README.txt?rev=3131499#L4 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: multilingual, translation, translate, bilingual, localization |
  | 5 | 5 | Requires at least: 4.7 |
  | 6 |  | Tested up to: 6.~~5~~ |
  |  | 6 | Tested up to: 6.6 |
  | 7 | 7 | Requires PHP: 5.6 |
  | 8 |  | Stable tag: 1.3.5~~2~~ |
  |  | 8 | Stable tag: 1.3.53 |
  | 9 | 9 | License: GPLv3 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | […](/browser/falang/trunk/README.txt?rev=3103641#L105) | […](/browser/falang/tags/1.3.53/README.txt?rev=3131499#L105) |  |
  | 105 | 105 | == Changelog == |
  | 106 | 106 |  |
  | 107 |  | \* 1.3.52 (2024/06/17) |
  | 108 |  | \* fix string translation frontend |
  | 109 |  | \* fix security CSRF |
  |  | 107 | \* 1.3.53 (2024/08/06) |
  |  | 108 | \* add User Roles and Capabilities on Ajax query |
  |  | 109 | \* fix ajax warning on string translation |
  |  | 110 | \* WordPress 6.6 compatible |
  | 110 | 111 |  |
  | 111 | 112 | == Known issues == |
* ## [falang/tags/1.3.53/admin/class-falang-admin.php](/changeset/3131499/falang/tags/1.3.53/admin/class-falang-admin.php "Show the changeset 3131499 restricted to falang/tags/1.3.53/admin/class-falang-admin.php")

  | [r3103639](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L828 "Show revision 3103639 of this file in browser") | [r3131499](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L828 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 828 | 828 | \* |
  | 829 | 829 | \* @from 1.0 |
  |  | 830 | \* @update 1.3.53 add User Roles and Capabilities |
  | 830 | 831 | \*/ |
  | 831 | 832 | public function ajax\_export\_options() |
  | 832 | 833 | { |
  |  | 834 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 835 | wp\_die( 'Not Allowed' ); |
  |  | 836 | } |
  |  | 837 |  |
  | 833 | 838 | global $wpdb; |
  | 834 | 839 |  |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L1531) | […](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L1536) |  |
  | 1531 | 1536 |  |
  | 1532 | 1537 |  |
  |  | 1538 | /\*\* |
  |  | 1539 | \* Delete Term translation |
  |  | 1540 | \* @from 1.0 |
  |  | 1541 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 1542 | \*/ |
  | 1533 | 1543 | public function ajax\_falang\_term\_delete\_translation() |
  | 1534 | 1544 | { |
  | 1535 |  |  |
  | 1536 |  | $response = new stdClass(); |
  | 1537 |  | $response->success = true; |
  | 1538 |  | $response->success = $this->term\_delete\_translation(); |
  | 1539 |  | if ($response->success) { |
  | 1540 |  | $response->message = esc\_html\_\_('Term translation deleted', 'falang'); |
  |  | 1545 | $user = wp\_get\_current\_user(); |
  |  | 1546 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 1547 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 1548 | $response = new stdClass(); |
  |  | 1549 | $response->success = true; |
  |  | 1550 | $response->success = $this->term\_delete\_translation(); |
  |  | 1551 | if ($response->success) { |
  |  | 1552 | $response->message = esc\_html\_\_('Term translation deleted', 'falang'); |
  |  | 1553 | } else { |
  |  | 1554 | $response->message = esc\_html\_\_('Term translation not deleted', 'falang'); |
  |  | 1555 | } |
  |  | 1556 | $this->return\_json($response); |
  |  | 1557 | exit(); |
  | 1541 | 1558 | } else { |
  | 1542 |  | $response->message = esc\_html\_\_('Term translation not deleted', 'falang'); |
  | 1543 |  | } |
  | 1544 |  | $this->return\_json($response); |
  | 1545 |  | exit(); |
  |  | 1559 | wp\_die('Not Allowed'); |
  |  | 1560 | } |
  | 1546 | 1561 |  |
  | 1547 | 1562 | } |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L1997) | […](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L2012) |  |
  | 1997 | 2012 | } |
  | 1998 | 2013 |  |
  |  | 2014 | /\* |
  |  | 2015 | \* Update string |
  |  | 2016 | \* from 1.0 |
  |  | 2017 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2018 | \* \*/ |
  | 1999 | 2019 | public function ajax\_update\_string\_translation() |
  | 2000 | 2020 | { |
  | 2001 |  | // build response |
  | 2002 |  | $response = new stdClass(); |
  | 2003 |  | $response->success = $this->save\_string\_translation(); |
  | 2004 |  | $this->return\_json($response); |
  | 2005 |  | exit(); |
  | 2006 |  | } |
  | 2007 |  |  |
  |  | 2021 | $user = wp\_get\_current\_user(); |
  |  | 2022 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2023 | if (array\_intersect($allowed\_roles, (array) $user->roles)){ |
  |  | 2024 | $response = new stdClass(); |
  |  | 2025 | $response->success = $this->save\_string\_translation(); |
  |  | 2026 | $this->return\_json($response); |
  |  | 2027 | exit(); |
  |  | 2028 | } else { |
  |  | 2029 | wp\_die( 'Not Allowed' ); |
  |  | 2030 | } |
  |  | 2031 | } |
  |  | 2032 |  |
  |  | 2033 | /\* |
  |  | 2034 | \* Update option translation |
  |  | 2035 | \* from 1.0 |
  |  | 2036 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2037 | \*/ |
  | 2008 | 2038 | public function ajax\_update\_option\_translation() |
  | 2009 | 2039 | { |
  |  | 2040 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 2041 | wp\_die( 'Not Allowed' ); |
  |  | 2042 | } |
  |  | 2043 |  |
  | 2010 | 2044 | // build response |
  | 2011 | 2045 | $response = new stdClass(); |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2015) | […](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L2049) |  |
  | 2015 | 2049 | } |
  | 2016 | 2050 |  |
  |  | 2051 | /\* |
  |  | 2052 | \* Delete option translation |
  |  | 2053 | \* from 1.0 |
  |  | 2054 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2055 | \*/ |
  | 2017 | 2056 | public function ajax\_delete\_option\_translation() |
  | 2018 | 2057 | { |
  |  | 2058 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 2059 | wp\_die( 'Not Allowed' ); |
  |  | 2060 | } |
  |  | 2061 |  |
  | 2019 | 2062 | $response = new stdClass(); |
  | 2020 | 2063 | $response->success = $this->delete\_option\_translation(); |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2898) | […](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L2941) |  |
  | 2898 | 2941 | /\*\* |
  | 2899 | 2942 | \* update langauge order (position) |
  | 2900 |  | \*~~get an array of locale~~ |
  |  | 2943 | \* |
  | 2901 | 2944 | \* @from 1.3.9 |
  |  | 2945 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2946 | \* |
  | 2902 | 2947 | \*/ |
  | 2903 | 2948 | public function ajax\_falang\_save\_post() |
  | 2904 | 2949 | { |
  | 2905 |  | $this->save\_translation\_post(); |
  | 2906 |  | $success = true; |
  | 2907 |  |  |
  | 2908 |  | // build response |
  | 2909 |  | $response = new stdClass(); |
  | 2910 |  | $response->success = $success; |
  | 2911 |  | $this->return\_json($response); |
  | 2912 |  | exit(); |
  |  | 2950 |  |
  |  | 2951 | $user = wp\_get\_current\_user(); |
  |  | 2952 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2953 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 2954 | $this->save\_translation\_post(); |
  |  | 2955 | $success = true; |
  |  | 2956 |  |
  |  | 2957 | // build response |
  |  | 2958 | $response = new stdClass(); |
  |  | 2959 | $response->success = $success; |
  |  | 2960 | $this->return\_json($response); |
  |  | 2961 | exit(); |
  |  | 2962 | } else { |
  |  | 2963 | wp\_die('Not Allowed'); |
  |  | 2964 | } |
  | 2913 | 2965 | } |
  | 2914 | 2966 |  |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2917) | […](/browser/falang/tags/1.3.53/admin/class-falang-admin.php?rev=3131499#L2969) |  |
  | 2917 | 2969 | \* get an array of locale |
  | 2918 | 2970 | \* @from 1.3.9 |
  |  | 2971 | \* @update 1.3.53 add User Roles and Capabilities |
  | 2919 | 2972 | \*/ |
  | 2920 | 2973 | public function ajax\_falang\_save\_menu() |
  | 2921 | 2974 | { |
  | 2922 |  | $this->save\_translation\_menu(); |
  | 2923 |  | $success = true; |
  | 2924 |  |  |
  | 2925 |  | // build response |
  | 2926 |  | $response = new stdClass(); |
  | 2927 |  | $response->success = $success; |
  | 2928 |  | $this->return\_json($response); |
  | 2929 |  | exit(); |
  |  | 2975 | $user = wp\_get\_current\_user(); |
  |  | 2976 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2977 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 2978 |  |
  |  | 2979 | $this->save\_translation\_menu(); |
  |  | 2980 | $success = true; |
  |  | 2981 |  |
  |  | 2982 | // build response |
  |  | 2983 | $response = new stdClass(); |
  |  | 2984 | $response->success = $success; |
  |  | 2985 | $this->return\_json($response); |
  |  | 2986 | exit(); |
  |  | 2987 | } else { |
  |  | 2988 | wp\_die('Not Allowed'); |
  |  | 2989 | } |
  | 2930 | 2990 | } |
  | 2931 | 2991 |  |
* ## [falang/tags/1.3.53/changelog.txt](/changeset/3131499/falang/tags/1.3.53/changelog.txt "Show the changeset 3131499 restricted to falang/tags/1.3.53/changelog.txt")

  | [r3103639](/browser/falang/trunk/changelog.txt?rev=3103639#L1 "Show revision 3103639 of this file in browser") | [r3131499](/browser/falang/tags/1.3.53/changelog.txt?rev=3131499#L1 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | \* 1.3.52 (2024/06/17) |
  |  | 2 | \* fix string translation frontend |
  |  | 3 | \* fix security CSRF |
  |  | 4 |  |
  | 1 | 5 | \* 1.3.51 (2024/05/20) |
  | 2 | 6 | \* add text domain to sting to support translation |
* ## [falang/tags/1.3.53/src/Falang/Core/FString.php](/changeset/3131499/falang/tags/1.3.53/src/Falang/Core/FString.php "Show the changeset 3131499 restricted to falang/tags/1.3.53/src/Falang/Core/FString.php")

  | [r3089355](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L16 "Show revision 3089355 of this file in browser") | [r3131499](/browser/falang/tags/1.3.53/src/Falang/Core/FString.php?rev=3131499#L16 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 |  |
  | 17 | 17 | static protected $strings = array(); // strings to translate |
  | 18 |  | static protected $default\_strings~~; // default strings to register~~ |
  |  | 18 | static protected $default\_strings = array(); // default strings to register//fix 1.3.53 |
  | 19 | 19 |  |
  | 20 | 20 | /\*\* |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L87) | […](/browser/falang/tags/1.3.53/src/Falang/Core/FString.php?rev=3131499#L87) |  |
  | 87 | 87 | self::register\_string( self::$default\_strings['widget\_text'], $text, 'Widget', true ); |
  | 88 | 88 | } |
  | 89 |  | } |
  |  | 89 | //use to enabled content widget translation for custom html and other |
  |  | 90 | //                    if ( isset( $widget\_settings[ $number ]['content'] ) && $text = $widget\_settings[ $number ]['content'] ) { |
  |  | 91 | //                        self::register\_string( self::$default\_strings['widget\_content'], $text, 'Widget', true ); |
  |  | 92 | //                    } |
  |  | 93 |  |
  |  | 94 | } |
  | 90 | 95 | } |
  | 91 | 96 | } |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L112) | […](/browser/falang/tags/1.3.53/src/Falang/Core/FString.php?rev=3131499#L117) |  |
  | 112 | 117 | \* @update 1.3.50 esc\_attr translation allow & to be save at &amp; |
  | 113 | 118 | \* @update 1.3.51 & need to be save like & , html code can be set in the String (ex: widget) |
  |  | 119 | \* @update 1.3.53 fix waring self::$default\_strings not initialised |
  | 114 | 120 | \* |
  | 115 | 121 | \* @param string $translation translation to sanitize |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L120) | […](/browser/falang/tags/1.3.53/src/Falang/Core/FString.php?rev=3131499#L126) |  |
  | 120 | 126 | $translation = wp\_unslash( trim( $translation ) ); |
  | 121 | 127 |  |
  | 122 |  | if ( ~~$name == self::$default\_strings['widget\_title']~~ ) { |
  |  | 128 | if ( isset(self::$default\_strings['widget\_title']) && ($name == self::$default\_strings['widget\_title']) ) { |
  | 123 | 129 | $translation = sanitize\_text\_field( $translation ); |
  | 124 | 130 | } |
  | 125 | 131 |  |
  | 126 |  | if ( ~~$name == self::$default\_strings['widget\_text']~~ && ! current\_user\_can( 'unfiltered\_html' ) ) { |
  |  | 132 | if ( isset(self::$default\_strings['widget\_text']) && ($name == self::$default\_strings['widget\_text']) && ! current\_user\_can( 'unfiltered\_html' ) ) { |
  | 127 | 133 | $translation = wp\_kses\_post( $translation ); |
  | 128 | 134 | } |
* ## [falang/trunk/README.txt](/changeset/3131499/falang/trunk/README.txt "Show the changeset 3131499 restricted to falang/trunk/README.txt")

  | [r3103641](/browser/falang/trunk/README.txt?rev=3103641#L4 "Show revision 3103641 of this file in browser") | [r3131499](/browser/falang/trunk/README.txt?rev=3131499#L4 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Tags: multilingual, translation, translate, bilingual, localization |
  | 5 | 5 | Requires at least: 4.7 |
  | 6 |  | Tested up to: 6.~~5~~ |
  |  | 6 | Tested up to: 6.6 |
  | 7 | 7 | Requires PHP: 5.6 |
  | 8 |  | Stable tag: 1.3.5~~2~~ |
  |  | 8 | Stable tag: 1.3.53 |
  | 9 | 9 | License: GPLv3 or later |
  | 10 | 10 | License URI: http://www.gnu.org/licenses/gpl-3.0.html |
  | […](/browser/falang/trunk/README.txt?rev=3103641#L105) | […](/browser/falang/trunk/README.txt?rev=3131499#L105) |  |
  | 105 | 105 | == Changelog == |
  | 106 | 106 |  |
  | 107 |  | \* 1.3.52 (2024/06/17) |
  | 108 |  | \* fix string translation frontend |
  | 109 |  | \* fix security CSRF |
  |  | 107 | \* 1.3.53 (2024/08/06) |
  |  | 108 | \* add User Roles and Capabilities on Ajax query |
  |  | 109 | \* fix ajax warning on string translation |
  |  | 110 | \* WordPress 6.6 compatible |
  | 110 | 111 |  |
  | 111 | 112 | == Known issues == |
* ## [falang/trunk/admin/class-falang-admin.php](/changeset/3131499/falang/trunk/admin/class-falang-admin.php "Show the changeset 3131499 restricted to falang/trunk/admin/class-falang-admin.php")

  | [r3103639](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L828 "Show revision 3103639 of this file in browser") | [r3131499](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L828 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 828 | 828 | \* |
  | 829 | 829 | \* @from 1.0 |
  |  | 830 | \* @update 1.3.53 add User Roles and Capabilities |
  | 830 | 831 | \*/ |
  | 831 | 832 | public function ajax\_export\_options() |
  | 832 | 833 | { |
  |  | 834 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 835 | wp\_die( 'Not Allowed' ); |
  |  | 836 | } |
  |  | 837 |  |
  | 833 | 838 | global $wpdb; |
  | 834 | 839 |  |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L1531) | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L1536) |  |
  | 1531 | 1536 |  |
  | 1532 | 1537 |  |
  |  | 1538 | /\*\* |
  |  | 1539 | \* Delete Term translation |
  |  | 1540 | \* @from 1.0 |
  |  | 1541 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 1542 | \*/ |
  | 1533 | 1543 | public function ajax\_falang\_term\_delete\_translation() |
  | 1534 | 1544 | { |
  | 1535 |  |  |
  | 1536 |  | $response = new stdClass(); |
  | 1537 |  | $response->success = true; |
  | 1538 |  | $response->success = $this->term\_delete\_translation(); |
  | 1539 |  | if ($response->success) { |
  | 1540 |  | $response->message = esc\_html\_\_('Term translation deleted', 'falang'); |
  |  | 1545 | $user = wp\_get\_current\_user(); |
  |  | 1546 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 1547 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 1548 | $response = new stdClass(); |
  |  | 1549 | $response->success = true; |
  |  | 1550 | $response->success = $this->term\_delete\_translation(); |
  |  | 1551 | if ($response->success) { |
  |  | 1552 | $response->message = esc\_html\_\_('Term translation deleted', 'falang'); |
  |  | 1553 | } else { |
  |  | 1554 | $response->message = esc\_html\_\_('Term translation not deleted', 'falang'); |
  |  | 1555 | } |
  |  | 1556 | $this->return\_json($response); |
  |  | 1557 | exit(); |
  | 1541 | 1558 | } else { |
  | 1542 |  | $response->message = esc\_html\_\_('Term translation not deleted', 'falang'); |
  | 1543 |  | } |
  | 1544 |  | $this->return\_json($response); |
  | 1545 |  | exit(); |
  |  | 1559 | wp\_die('Not Allowed'); |
  |  | 1560 | } |
  | 1546 | 1561 |  |
  | 1547 | 1562 | } |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L1997) | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L2012) |  |
  | 1997 | 2012 | } |
  | 1998 | 2013 |  |
  |  | 2014 | /\* |
  |  | 2015 | \* Update string |
  |  | 2016 | \* from 1.0 |
  |  | 2017 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2018 | \* \*/ |
  | 1999 | 2019 | public function ajax\_update\_string\_translation() |
  | 2000 | 2020 | { |
  | 2001 |  | // build response |
  | 2002 |  | $response = new stdClass(); |
  | 2003 |  | $response->success = $this->save\_string\_translation(); |
  | 2004 |  | $this->return\_json($response); |
  | 2005 |  | exit(); |
  | 2006 |  | } |
  | 2007 |  |  |
  |  | 2021 | $user = wp\_get\_current\_user(); |
  |  | 2022 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2023 | if (array\_intersect($allowed\_roles, (array) $user->roles)){ |
  |  | 2024 | $response = new stdClass(); |
  |  | 2025 | $response->success = $this->save\_string\_translation(); |
  |  | 2026 | $this->return\_json($response); |
  |  | 2027 | exit(); |
  |  | 2028 | } else { |
  |  | 2029 | wp\_die( 'Not Allowed' ); |
  |  | 2030 | } |
  |  | 2031 | } |
  |  | 2032 |  |
  |  | 2033 | /\* |
  |  | 2034 | \* Update option translation |
  |  | 2035 | \* from 1.0 |
  |  | 2036 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2037 | \*/ |
  | 2008 | 2038 | public function ajax\_update\_option\_translation() |
  | 2009 | 2039 | { |
  |  | 2040 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 2041 | wp\_die( 'Not Allowed' ); |
  |  | 2042 | } |
  |  | 2043 |  |
  | 2010 | 2044 | // build response |
  | 2011 | 2045 | $response = new stdClass(); |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2015) | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L2049) |  |
  | 2015 | 2049 | } |
  | 2016 | 2050 |  |
  |  | 2051 | /\* |
  |  | 2052 | \* Delete option translation |
  |  | 2053 | \* from 1.0 |
  |  | 2054 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2055 | \*/ |
  | 2017 | 2056 | public function ajax\_delete\_option\_translation() |
  | 2018 | 2057 | { |
  |  | 2058 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  |  | 2059 | wp\_die( 'Not Allowed' ); |
  |  | 2060 | } |
  |  | 2061 |  |
  | 2019 | 2062 | $response = new stdClass(); |
  | 2020 | 2063 | $response->success = $this->delete\_option\_translation(); |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2898) | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L2941) |  |
  | 2898 | 2941 | /\*\* |
  | 2899 | 2942 | \* update langauge order (position) |
  | 2900 |  | \*~~get an array of locale~~ |
  |  | 2943 | \* |
  | 2901 | 2944 | \* @from 1.3.9 |
  |  | 2945 | \* @update 1.3.53 add User Roles and Capabilities |
  |  | 2946 | \* |
  | 2902 | 2947 | \*/ |
  | 2903 | 2948 | public function ajax\_falang\_save\_post() |
  | 2904 | 2949 | { |
  | 2905 |  | $this->save\_translation\_post(); |
  | 2906 |  | $success = true; |
  | 2907 |  |  |
  | 2908 |  | // build response |
  | 2909 |  | $response = new stdClass(); |
  | 2910 |  | $response->success = $success; |
  | 2911 |  | $this->return\_json($response); |
  | 2912 |  | exit(); |
  |  | 2950 |  |
  |  | 2951 | $user = wp\_get\_current\_user(); |
  |  | 2952 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2953 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 2954 | $this->save\_translation\_post(); |
  |  | 2955 | $success = true; |
  |  | 2956 |  |
  |  | 2957 | // build response |
  |  | 2958 | $response = new stdClass(); |
  |  | 2959 | $response->success = $success; |
  |  | 2960 | $this->return\_json($response); |
  |  | 2961 | exit(); |
  |  | 2962 | } else { |
  |  | 2963 | wp\_die('Not Allowed'); |
  |  | 2964 | } |
  | 2913 | 2965 | } |
  | 2914 | 2966 |  |
  | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3103639#L2917) | […](/browser/falang/trunk/admin/class-falang-admin.php?rev=3131499#L2969) |  |
  | 2917 | 2969 | \* get an array of locale |
  | 2918 | 2970 | \* @from 1.3.9 |
  |  | 2971 | \* @update 1.3.53 add User Roles and Capabilities |
  | 2919 | 2972 | \*/ |
  | 2920 | 2973 | public function ajax\_falang\_save\_menu() |
  | 2921 | 2974 | { |
  | 2922 |  | $this->save\_translation\_menu(); |
  | 2923 |  | $success = true; |
  | 2924 |  |  |
  | 2925 |  | // build response |
  | 2926 |  | $response = new stdClass(); |
  | 2927 |  | $response->success = $success; |
  | 2928 |  | $this->return\_json($response); |
  | 2929 |  | exit(); |
  |  | 2975 | $user = wp\_get\_current\_user(); |
  |  | 2976 | $allowed\_roles = array('administrator', 'translator'); |
  |  | 2977 | if (array\_intersect($allowed\_roles, (array)$user->roles)) { |
  |  | 2978 |  |
  |  | 2979 | $this->save\_translation\_menu(); |
  |  | 2980 | $success = true; |
  |  | 2981 |  |
  |  | 2982 | // build response |
  |  | 2983 | $response = new stdClass(); |
  |  | 2984 | $response->success = $success; |
  |  | 2985 | $this->return\_json($response); |
  |  | 2986 | exit(); |
  |  | 2987 | } else { |
  |  | 2988 | wp\_die('Not Allowed'); |
  |  | 2989 | } |
  | 2930 | 2990 | } |
  | 2931 | 2991 |  |
* ## [falang/trunk/changelog.txt](/changeset/3131499/falang/trunk/changelog.txt "Show the changeset 3131499 restricted to falang/trunk/changelog.txt")

  | [r3103639](/browser/falang/trunk/changelog.txt?rev=3103639#L1 "Show revision 3103639 of this file in browser") | [r3131499](/browser/falang/trunk/changelog.txt?rev=3131499#L1 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  |  | 1 | \* 1.3.52 (2024/06/17) |
  |  | 2 | \* fix string translation frontend |
  |  | 3 | \* fix security CSRF |
  |  | 4 |  |
  | 1 | 5 | \* 1.3.51 (2024/05/20) |
  | 2 | 6 | \* add text domain to sting to support translation |
* ## [falang/trunk/src/Falang/Core/FString.php](/changeset/3131499/falang/trunk/src/Falang/Core/FString.php "Show the changeset 3131499 restricted to falang/trunk/src/Falang/Core/FString.php")

  | [r3089355](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L16 "Show revision 3089355 of this file in browser") | [r3131499](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3131499#L16 "Show revision 3131499 of this file in browser") |  |
  | --- | --- | --- |
  | 16 | 16 |  |
  | 17 | 17 | static protected $strings = array(); // strings to translate |
  | 18 |  | static protected $default\_strings~~; // default strings to register~~ |
  |  | 18 | static protected $default\_strings = array(); // default strings to register//fix 1.3.53 |
  | 19 | 19 |  |
  | 20 | 20 | /\*\* |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L87) | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3131499#L87) |  |
  | 87 | 87 | self::register\_string( self::$default\_strings['widget\_text'], $text, 'Widget', true ); |
  | 88 | 88 | } |
  | 89 |  | } |
  |  | 89 | //use to enabled content widget translation for custom html and other |
  |  | 90 | //                    if ( isset( $widget\_settings[ $number ]['content'] ) && $text = $widget\_settings[ $number ]['content'] ) { |
  |  | 91 | //                        self::register\_string( self::$default\_strings['widget\_content'], $text, 'Widget', true ); |
  |  | 92 | //                    } |
  |  | 93 |  |
  |  | 94 | } |
  | 90 | 95 | } |
  | 91 | 96 | } |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L112) | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3131499#L117) |  |
  | 112 | 117 | \* @update 1.3.50 esc\_attr translation allow & to be save at &amp; |
  | 113 | 118 | \* @update 1.3.51 & need to be save like & , html code can be set in the String (ex: widget) |
  |  | 119 | \* @update 1.3.53 fix waring self::$default\_strings not initialised |
  | 114 | 120 | \* |
  | 115 | 121 | \* @param string $translation translation to sanitize |
  | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3089355#L120) | […](/browser/falang/trunk/src/Falang/Core/FString.php?rev=3131499#L126) |  |
  | 120 | 126 | $translation = wp\_unslash( trim( $translation ) ); |
  | 121 | 127 |  |
  | 122 |  | if ( ~~$name == self::$default\_strings['widget\_title']~~ ) { |
  |  | 128 | if ( isset(self::$default\_strings['widget\_title']) && ($name == self::$default\_strings['widget\_title']) ) { |
  | 123 | 129 | $translation = sanitize\_text\_field( $translation ); |
  | 124 | 130 | } |
  | 125 | 131 |  |
  | 126 |  | if ( ~~$name == self::$default\_strings['widget\_text']~~ && ! current\_user\_can( 'unfiltered\_html' ) ) { |
  |  | 132 | if ( isset(self::$default\_strings['widget\_text']) && ($name == self::$default\_strings['widget\_text']) && ! current\_user\_can( 'unfiltered\_html' ) ) { |
  | 127 | 133 | $translation = wp\_kses\_post( $translation ); |
  | 128 | 134 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3131499)
* [Zip Archive](?format=zip&new=3131499)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

