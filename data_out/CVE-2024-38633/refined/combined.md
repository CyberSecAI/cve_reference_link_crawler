=== Content from git.kernel.org_6a945321_20250110_145429.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:39:08 +0200 |
| commit | [fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)) | |
| tree | [d46b823904b0ed9300403b2f82c8149d453cabef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0) | |
| parent | [865b30c8661924ee9145f442bf32cea549faa869](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=865b30c8661924ee9145f442bf32cea549faa869) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0&id2=865b30c8661924ee9145f442bf32cea549faa869)) | |
| download | [linux-fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 45022f2909f0af..b3e63b6a402e15 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=865b30c8661924ee9145f442bf32cea549faa869)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=fa84ca78b048dfb00df0ef446f5c35e0a98ca6a0)@@ -749,13 +749,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -841,6 +842,7 @@ static void max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:06 +0000



=== Content from git.kernel.org_d122635a_20250110_145425.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:39:35 +0200 |
| commit | [361a92c9038e8c8c3996f8eeaa14522a8ad90752](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)) | |
| tree | [baf3881b381ead5f9a21ed4d0bb385008cb6b920](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752) | |
| parent | [78dbda51bb4241b88a52d71620f06231a341f9ba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=78dbda51bb4241b88a52d71620f06231a341f9ba) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752&id2=78dbda51bb4241b88a52d71620f06231a341f9ba)) | |
| download | [linux-361a92c9038e8c8c3996f8eeaa14522a8ad90752.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-361a92c9038e8c8c3996f8eeaa14522a8ad90752.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex b3b77ffd5b423e..24cd345ea6e3df 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=78dbda51bb4241b88a52d71620f06231a341f9ba)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=361a92c9038e8c8c3996f8eeaa14522a8ad90752)@@ -751,13 +751,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -843,6 +844,7 @@ static int max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:02 +0000



=== Content from git.kernel.org_e9f9ecb6_20250110_145424.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:23:32 +0200 |
| commit | [21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)) | |
| tree | [6f24dbf023ad7077fe6dfec7159318b1d63f3f98](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b) | |
| parent | [44b38924135d2093e2ec1812969464845dd66dc9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=44b38924135d2093e2ec1812969464845dd66dc9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b&id2=44b38924135d2093e2ec1812969464845dd66dc9)) | |
| download | [linux-21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 915d7753eec2f9..c1ee88f530334a 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=44b38924135d2093e2ec1812969464845dd66dc9)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=21a61a7fbcfdd3493cede43ebc7c4dfae2147a8b)@@ -754,13 +754,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -846,6 +847,7 @@ static int max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:02 +0000



=== Content from git.kernel.org_30cff9c8_20250110_145429.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8e2a4339decad7e59425b594a98613402652d72)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e2a4339decad7e59425b594a98613402652d72)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e2a4339decad7e59425b594a98613402652d72)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e2a4339decad7e59425b594a98613402652d72)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:32:16 +0200 |
| commit | [e8e2a4339decad7e59425b594a98613402652d72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8e2a4339decad7e59425b594a98613402652d72) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8e2a4339decad7e59425b594a98613402652d72)) | |
| tree | [f2f72198417a5f82b6c68dc24b928396fc5323f4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8e2a4339decad7e59425b594a98613402652d72) | |
| parent | [cc121e3722a0a2c8f716ef991e5425b180a5fb94](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cc121e3722a0a2c8f716ef991e5425b180a5fb94) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e2a4339decad7e59425b594a98613402652d72&id2=cc121e3722a0a2c8f716ef991e5425b180a5fb94)) | |
| download | [linux-e8e2a4339decad7e59425b594a98613402652d72.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8e2a4339decad7e59425b594a98613402652d72.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8e2a4339decad7e59425b594a98613402652d72)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=e8e2a4339decad7e59425b594a98613402652d72) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 915d7753eec2f9..c1ee88f530334a 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=cc121e3722a0a2c8f716ef991e5425b180a5fb94)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=e8e2a4339decad7e59425b594a98613402652d72)@@ -754,13 +754,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -846,6 +847,7 @@ static int max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:06 +0000



=== Content from git.kernel.org_ab5e1730_20250110_145427.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:28:42 +0200 |
| commit | [9db4222ed8cd3e50b81c8b910ae74c26427a4003](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)) | |
| tree | [8a05a36f70f77d7174ac671248f7fae6986fb233](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003) | |
| parent | [ea9b35372b58ac2931bfc1d5bc25e839d1221e30](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea9b35372b58ac2931bfc1d5bc25e839d1221e30) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003&id2=ea9b35372b58ac2931bfc1d5bc25e839d1221e30)) | |
| download | [linux-9db4222ed8cd3e50b81c8b910ae74c26427a4003.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9db4222ed8cd3e50b81c8b910ae74c26427a4003.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 915d7753eec2f9..c1ee88f530334a 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=ea9b35372b58ac2931bfc1d5bc25e839d1221e30)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=9db4222ed8cd3e50b81c8b910ae74c26427a4003)@@ -754,13 +754,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -846,6 +847,7 @@ static int max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:04 +0000



=== Content from git.kernel.org_ac6aca36_20250110_145427.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:03:35 +0200 |
| commit | [b6eb7aff23e05f362e8c9b560f6ac5e727b70e00](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)) | |
| tree | [f97a8c853e609fffe7e210817780c9cfa535d9de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00) | |
| parent | [8296bb9e5925b6634259c5d4daee88f0cc0884ec](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8296bb9e5925b6634259c5d4daee88f0cc0884ec) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00&id2=8296bb9e5925b6634259c5d4daee88f0cc0884ec)) | |
| download | [linux-b6eb7aff23e05f362e8c9b560f6ac5e727b70e00.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b6eb7aff23e05f362e8c9b560f6ac5e727b70e00.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 1c4a2b1b1f6904..b71676e1f612fc 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=8296bb9e5925b6634259c5d4daee88f0cc0884ec)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=b6eb7aff23e05f362e8c9b560f6ac5e727b70e00)@@ -750,13 +750,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -842,6 +843,7 @@ static void max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:05 +0000



=== Content from git.kernel.org_19f1e739_20250110_145426.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-09 15:51:35 +0200 |
| commit | [712a1fcb38dc7cac6da63ee79a88708fbf9c45ec](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)) | |
| tree | [5a08d9ca766017b7cd89b672bc066b03433e548b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec) | |
| parent | [77ab53371a2066fdf9b895246505f5ef5a4b5d47](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=77ab53371a2066fdf9b895246505f5ef5a4b5d47) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec&id2=77ab53371a2066fdf9b895246505f5ef5a4b5d47)) | |
| download | [linux-712a1fcb38dc7cac6da63ee79a88708fbf9c45ec.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-712a1fcb38dc7cac6da63ee79a88708fbf9c45ec.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removalThe removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 53dde3391abf49..14873576e52db5 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=77ab53371a2066fdf9b895246505f5ef5a4b5d47)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=712a1fcb38dc7cac6da63ee79a88708fbf9c45ec)@@ -749,13 +749,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -841,6 +842,7 @@ static void max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:03 +0000



=== Content from git.kernel.org_cce84a6f_20250110_145428.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andy Shevchenko <andriy.shevchenko@linux.intel.com> | 2024-04-02 22:50:29 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:12:17 +0200 |
| commit | [e8a10089eddba40d4b2080c9d3fc2d2b2488f762](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)) | |
| tree | [3ab9ea94ae1c8a77dd40fa5e11c9deed6f51dc6d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762) | |
| parent | [93df2fba6c7dfa9a2f08546ea9a5ca4728758458](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93df2fba6c7dfa9a2f08546ea9a5ca4728758458) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762&id2=93df2fba6c7dfa9a2f08546ea9a5ca4728758458)) | |
| download | [linux-e8a10089eddba40d4b2080c9d3fc2d2b2488f762.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e8a10089eddba40d4b2080c9d3fc2d2b2488f762.tar.gz) | |

serial: max3100: Update uart\_driver\_registered on driver removal[ Upstream commit 712a1fcb38dc7cac6da63ee79a88708fbf9c45ec ]
The removal of the last MAX3100 device triggers the removal of
the driver. However, code doesn't update the respective global
variable and after insmod — rmmod — insmod cycle the kernel
oopses:
max3100 spi-PRP0001:01: max3100\_probe: adding port 0
BUG: kernel NULL pointer dereference, address: 0000000000000408
...
RIP: 0010:serial\_core\_register\_port+0xa0/0x840
...
max3100\_probe+0x1b6/0x280 [max3100]
spi\_probe+0x8d/0xb0
Update the actual state so next time UART driver will be registered
again.
Hugo also noticed, that the error path in the probe also affected
by having the variable set, and not cleared. Instead of clearing it
move the assignment after the successfull uart\_register\_driver() call.
Fixes: 7831d56b0a35 ("tty: MAX3100")
Signed-off-by: Andy Shevchenko <andriy.shevchenko@linux.intel.com>
Reviewed-by: Hugo Villeneuve <hvilleneuve@dimonoff.com>
Link: [https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko@linux.intel.com](https://lore.kernel.org/r/20240402195306.269276-3-andriy.shevchenko%40linux.intel.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)

| -rw-r--r-- | [drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/max3100.c?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/tty/serial/max3100.c b/drivers/tty/serial/max3100.cindex 45022f2909f0af..b3e63b6a402e15 100644--- a/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=93df2fba6c7dfa9a2f08546ea9a5ca4728758458)+++ b/[drivers/tty/serial/max3100.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/max3100.c?id=e8a10089eddba40d4b2080c9d3fc2d2b2488f762)@@ -749,13 +749,14 @@ static int max3100\_probe(struct spi\_device \*spi) mutex\_lock(&max3100s\_lock);  if (!uart\_driver\_registered) {- uart\_driver\_registered = 1; retval = uart\_register\_driver(&max3100\_uart\_driver); if (retval) { printk(KERN\_ERR "Couldn't register max3100 uart driver\n"); mutex\_unlock(&max3100s\_lock); return retval; }++ uart\_driver\_registered = 1; }  for (i = 0; i < MAX\_MAX3100; i++)@@ -841,6 +842,7 @@ static void max3100\_remove(struct spi\_device \*spi) } pr\_debug("removing max3100 driver\n"); uart\_unregister\_driver(&max3100\_uart\_driver);+ uart\_driver\_registered = 0;  mutex\_unlock(&max3100s\_lock); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:53:05 +0000


