

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Improved IFD-Loop Handling (fixes [#455](/libtiff/libtiff/-/issues/455 "[security] A crafted TIFF files will cause the program to enter an infinite loop"))

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/libtiff/libtiff/-/merge_requests/386.patch)
* [Plain diff](/libtiff/libtiff/-/merge_requests/386.diff)

[Su Laus](/Su_Laus) requested to merge  [Su\_Laus/libtiff:fix-455\_Improved-IFD-loop-handling](/Su_Laus/libtiff/-/tree/fix-455_Improved-IFD-loop-handling "Su_Laus/libtiff:fix-455_Improved-IFD-loop-handling")
 into [master](/libtiff/libtiff/-/tree/master "master") Sep 02, 2022

* [Overview
  21](/libtiff/libtiff/-/merge_requests/386)
* [Commits
  4](/libtiff/libtiff/-/merge_requests/386/commits)
* [Pipelines
  6](/libtiff/libtiff/-/merge_requests/386/pipelines)
* [Changes
  6](/libtiff/libtiff/-/merge_requests/386/diffs)

Expand

IFD infinite looping is not fixed by MR 20 (see [#455 (closed)](/libtiff/libtiff/-/issues/455 "[security] A crafted TIFF files will cause the program to enter an infinite loop")).

An improved IFD loop handling is proposed.

Basic approach:

* The order in the entire chain must be checked, and not only whether an offset has already been read once.
* To do this, pairs of directory number and offset are stored and checked.
* The offset of a directory number can change.
* TIFFAdvanceDirectory() must also perform an IFD loop check.
* TIFFCheckDirOffset() is replaced by \_TIFFCheckDirNumberAndOffset().

Rules for the check:

* If an offset is already in the list, it must have the same IFD number. Otherwise it is an IDF loop.
* If the offset is not in the list and the IFD number is greater than there are list entries, a new list entry is added.
* Otherwise, the offset of the IFD number is updated.

Reference is also made to old bugzilla bug 2772 and MR 20, which did not solve the general issue.

This MR closes [#455 (closed)](/libtiff/libtiff/-/issues/455 "[security] A crafted TIFF files will cause the program to enter an infinite loop")

## Merge request reports

Assignee
Loading

Reviewers
Loading

Select reviewersRequest review fromLoading

Time tracking
Loading

Loading

