

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3046092%2540buddyforms%252Ftrunk%26old%3D3031945%2540buddyforms%252Ftrunk)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3031945/buddyforms/trunk?old=3046092&old_path=%2Fbuddyforms%2Ftrunk)

---

# Changes in [buddyforms/trunk](/browser/buddyforms/trunk?rev=3046092 "Show entry in browser") [[3031945:3046092]](/log/buddyforms/trunk?rev=3046092&stop_rev=3031945 "Show revision log")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Location:
[buddyforms/trunk](/browser/buddyforms/trunk?rev=3046092)
Files:

11 edited

* [BuddyForms.php](/browser/buddyforms/trunk/BuddyForms.php?rev=3046092 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [assets/admin/js/admin.js](/browser/buddyforms/trunk/assets/admin/js/admin.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file1 "Show differences"))
* [assets/admin/js/admin.min.js](/browser/buddyforms/trunk/assets/admin/js/admin.min.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [assets/resources/dropzone/initializer.js](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file3 "Show differences"))
* [assets/resources/dropzone/initializer.min.js](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.min.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [assets/resources/featured-image/featured-image-initializer.js](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file5 "Show differences"))
* [assets/resources/featured-image/featured-image-initializer.min.js](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [includes/admin/admin-ajax.php](/browser/buddyforms/trunk/includes/admin/admin-ajax.php?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file7 "Show differences"))
* [includes/admin/form-builder/meta-boxes/metabox-form-setup.php](/browser/buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php?rev=3046092 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [includes/functions.php](/browser/buddyforms/trunk/includes/functions.php?rev=3046092 "Show entry in browser")
  (modified)
  ([2 diffs](#file9 "Show differences"))
* [readme.txt](/browser/buddyforms/trunk/readme.txt?rev=3046092 "Show entry in browser")
  (modified)
  ([2 diffs](#file10 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [buddyforms/trunk/BuddyForms.php](/changeset/3046092/buddyforms/trunk/BuddyForms.php?old=3031945&old_path=buddyforms%2Ftrunk%2FBuddyForms.php "Show the [3031945:3046092] differences restricted to buddyforms/trunk/BuddyForms.php")

  | [r3031945](/browser/buddyforms/trunk/BuddyForms.php?rev=3031945#L8 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/BuddyForms.php?rev=3046092#L8 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* Plugin URI:  https://themekraft.com/buddyforms/ |
  | 9 | 9 | \* Description: Contact Forms, Post Forms for User Generated Content and Registration Forms easily build in minutes. Ideal for User Submitted Posts. Extendable with Addons! |
  | 10 |  | \* Version: 2.8.~~7~~ |
  |  | 10 | \* Version: 2.8.8 |
  | 11 | 11 | \* Author: ThemeKraft |
  | 12 | 12 | \* Author URI: https://themekraft.com/buddyforms/ |
  | […](/browser/buddyforms/trunk/BuddyForms.php?rev=3031945#L46) | […](/browser/buddyforms/trunk/BuddyForms.php?rev=3046092#L46) |  |
  | 46 | 46 | \* @var string |
  | 47 | 47 | \*/ |
  | 48 |  | public  $version = '2.8.~~7~~' ; |
  |  | 48 | public  $version = '2.8.8' ; |
  | 49 | 49 | /\*\* |
  | 50 | 50 | \* @var array Frontend Global JS parameters |
* ## [buddyforms/trunk/assets/admin/js/admin.js](/changeset/3046092/buddyforms/trunk/assets/admin/js/admin.js?old=2562052&old_path=buddyforms%2Ftrunk%2Fassets%2Fadmin%2Fjs%2Fadmin.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/admin/js/admin.js")

  | [r3031945](/browser/buddyforms/trunk/assets/admin/js/admin.js?rev=2562052#L32 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/admin/js/admin.js?rev=3046092#L32 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 32 | 32 | data: { |
  | 33 | 33 | "action": "buddyforms\_new\_page", |
  | 34 |  | "page\_name": page\_name |
  |  | 34 | "page\_name": page\_name, |
  |  | 35 | "nonce": buddyformsGlobal.ajaxnonce // Add the nonce parameter |
  | 35 | 36 | }, |
  | 36 | 37 | success: function (data) { |
* ## [buddyforms/trunk/assets/admin/js/admin.min.js](/changeset/3046092/buddyforms/trunk/assets/admin/js/admin.min.js?old=2562052&old_path=buddyforms%2Ftrunk%2Fassets%2Fadmin%2Fjs%2Fadmin.min.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/admin/js/admin.min.js")

  | [r3031945](/browser/buddyforms/trunk/assets/admin/js/admin.min.js?rev=2562052#L1 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/admin/js/admin.min.js?rev=3046092#L1 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | (function(e){e.getStylesheet=function(t){var ~~r=e.Deferred(),o=e('<link/>',{rel:'stylesheet',type:'text/css',href:t}).appendTo('head');r.resolve(o);return r.promise()}})(jQuery);function createNewPageOpenModal(e){var t=jQuery('<div></div>').dialog({modal:!0,title:'Info',open:function(){var e='Name your Page<input id="bf\_create\_page\_name" type="text" value="">';jQuery(this).html(e)},buttons:{'Add':function(){var e=jQuery('#bf\_create\_page\_name').val();t.html('<span class="spinner is-active"></span>');if(buddyformsGlobal){jQuery.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_new\_page','page\_name':~~e},success:function(e){if(e['error']){console.log(e['error'])} |
  | 2 |  | else{jQuery('#attached\_page').append(jQuery('<option>',{value:e['id'],text:e['name']}));jQuery('#attached\_page').val(e['id'])};t.dialog('close')},error:function(){t.dialog('close')}})}}}});e.preventDefault();return!1};var bf\_getUrlParameter=function(e){var a=decodeURIComponent(window.location.search.substring(1)),~~o=a.split('&'),t,r;for(r=0;r<o.length;r++){t=o[r].split('=');if(t[0]===e){return t[1]===undefined?!0:t[1]}}};function buddyformsMakeFieldId(){var t='',r='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';for(var e=0;e<5;e++)t+=r.charAt(Math.floor(Math.random()\*r.length));return t};function buddyformAutoFillEmptyOrDuplicateSlugs(){var e=jQuery('#post input[name^=\'buddyforms\_options[form\_fields]\'][name$=\'[slug]\'][type!=\'hidden\']');e.each(function(){var t=jQuery(this);if(!t.val()){console.log('empty field slug');var r=t.attr('data'),o=jQuery('li#field\_'+r);if(o&&o.length>0){var a=o.find('tr.use\_as\_slug input[name="buddyforms\_options[form\_fields]['+r+'][name]"]').val();if(a){var i=slug(a,{lower:!1});o.find('tr.slug'+r+' input[name="buddyforms\_options[form\_fields]['+r+'][slug]"]').val(i)}}};e.each(function(){if(jQuery(this).val()===t.val()&&t.attr('name')!==jQuery(this).attr('name')){t.val(t.val()+'\_'+buddyformsMakeFieldId());return!1}})})};function buddyformsIsEmailOrShortcode(e){var t=/^([a-zA-Z0-9\_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})|\[(.\*?)(\s.\*?)?\]$/;return t.test(e)};function buddyformsValidateMultiEmail(e){var t=!0;if(e){var o=/[;,]+/.test(e);if(o){var r=e.split(/[;,]+/);jQuery.each(r,function(e,r){t=buddyformsIsEmailOrShortcode(r~~.trim());if(!t){return t}})} |
  |  | 1 | (function(e){e.getStylesheet=function(t){var o=e.Deferred(),r=e('<link/>',{rel:'stylesheet',type:'text/css',href:t}).appendTo('head');o.resolve(r);return o.promise()}})(jQuery);function createNewPageOpenModal(e){var t=jQuery('<div></div>').dialog({modal:!0,title:'Info',open:function(){var e='Name your Page<input id="bf\_create\_page\_name" type="text" value="">';jQuery(this).html(e)},buttons:{'Add':function(){var e=jQuery('#bf\_create\_page\_name').val();t.html('<span class="spinner is-active"></span>');if(buddyformsGlobal){jQuery.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_new\_page','page\_name':e,'nonce':buddyformsGlobal.ajaxnonce},success:function(e){if(e['error']){console.log(e['error'])} |
  |  | 2 | else{jQuery('#attached\_page').append(jQuery('<option>',{value:e['id'],text:e['name']}));jQuery('#attached\_page').val(e['id'])};t.dialog('close')},error:function(){t.dialog('close')}})}}}});e.preventDefault();return!1};var bf\_getUrlParameter=function(e){var a=decodeURIComponent(window.location.search.substring(1)),r=a.split('&'),t,o;for(o=0;o<r.length;o++){t=r[o].split('=');if(t[0]===e){return t[1]===undefined?!0:t[1]}}};function buddyformsMakeFieldId(){var t='',o='ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789';for(var e=0;e<5;e++)t+=o.charAt(Math.floor(Math.random()\*o.length));return t};function buddyformAutoFillEmptyOrDuplicateSlugs(){var e=jQuery('#post input[name^=\'buddyforms\_options[form\_fields]\'][name$=\'[slug]\'][type!=\'hidden\']');e.each(function(){var t=jQuery(this);if(!t.val()){console.log('empty field slug');var o=t.attr('data'),r=jQuery('li#field\_'+o);if(r&&r.length>0){var a=r.find('tr.use\_as\_slug input[name="buddyforms\_options[form\_fields]['+o+'][name]"]').val();if(a){var i=slug(a,{lower:!1});r.find('tr.slug'+o+' input[name="buddyforms\_options[form\_fields]['+o+'][slug]"]').val(i)}}};e.each(function(){if(jQuery(this).val()===t.val()&&t.attr('name')!==jQuery(this).attr('name')){t.val(t.val()+'\_'+buddyformsMakeFieldId());return!1}})})};function buddyformsIsEmailOrShortcode(e){var t=/^([a-zA-Z0-9\_.+-])+\@(([a-zA-Z0-9-])+\.)+([a-zA-Z0-9]{2,4})|\[(.\*?)(\s.\*?)?\]$/;return t.test(e)};function buddyformsValidateMultiEmail(e){var t=!0;if(e){var r=/[;,]+/.test(e);if(r){var o=e.split(/[;,]+/);jQuery.each(o,function(e,o){t=buddyformsIsEmailOrShortcode(o.trim());if(!t){return t}})} |
  | 3 | 3 | else{t=buddyformsIsEmailOrShortcode(e);if(!t){return t}}} |
  | 4 |  | else{t=!1};return t};function buddyforms\_validate\_notifications\_email(e){if(e){var ~~r=jQuery(e).val();if(r~~){var t=buddyformsValidateMultiEmail(jQuery(e).val());if(!t){jQuery(e)[0].setCustomValidity('Invalid Email(s)');jQuery(e).addClass('bf-error')} |
  |  | 4 | else{t=!1};return t};function buddyforms\_validate\_notifications\_email(e){if(e){var o=jQuery(e).val();if(o){var t=buddyformsValidateMultiEmail(jQuery(e).val());if(!t){jQuery(e)[0].setCustomValidity('Invalid Email(s)');jQuery(e).addClass('bf-error')} |
  | 5 | 5 | else{jQuery(e)[0].setCustomValidity('');jQuery(e).removeClass('bf-error')};return t} |
  | 6 | 6 | else{jQuery(e)[0].setCustomValidity('');jQuery(e).removeClass('bf-error')}};return!0};function bf\_update\_list\_item\_number(){jQuery('.buddyforms\_forms\_builder ul').each(function(){jQuery(this).children('li').each(function(e){jQuery(this).find('td.field\_order .circle').first().html(e+1)})})};function bf\_alert(e){jQuery('<div></div>').dialog({modal:!0,title:'Info',open:function(){jQuery(this).html(e)},buttons:{Ok:function(){jQuery(this).dialog('close')}}})};function bf\_update\_list\_item\_number\_mail(){jQuery('#mailcontainer .bf\_trigger\_list\_item').each(function(e){jQuery(this).find('td.field\_order .circle').first().html(e+1)})};function buddyforms\_load\_select2(e){jQuery.when(jQuery.getStylesheet(buddyformsGlobal.assets.select2\_css),jQuery.getScript(buddyformsGlobal.assets.select2\_js)).then(function(){if(jQuery.fn.select2){e.select2({placeholder:'Select an option'})} |
  | 7 | 7 | else{console.log('BF-Error loading select2 assets, please contact support.')}},function(){console.log('BF-Error loading select2 assets, please contact support.')})};function setStatusDateFormat(e){if(e.checked){jQuery('.status-date-format').show();jQuery('.status-time-format').show()} |
  | 8 |  | else{jQuery('.status-date-format').hide();jQuery('.status-time-format').hide()}};function load\_formbuilder\_template(e,t){var ~~r=jQuery('input#title');if(buddyformsGlobal){jQuery.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_form\_template','template':e,'title':r.val()},success:function(e){jQuery.each(e,function(e,t){switch(e){case'formbuilder':var r=jQuery('.buddyforms\_forms\_builder');r.replaceWith(t);bf\_update\_list\_item\_number();jQuery(document.body).trigger({type:'buddyform:load\_fields'});break;case'mail\_notification':jQuery('.buddyforms\_accordion\_notification').html(t);jQuery('#no-trigger-mailcontainer').hide();tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();break;case'form\_setup':jQuery.each(t,function(e,t){if(t instanceof Object){jQuery.each(t,function(t,r){var o;if(r instanceof Object){jQuery.each(r,function(r,a){o=jQuery('[name="buddyforms\_options['+e+']['+t+']['+r+']"]');buddyform\_apply\_template\_to\_element(o~~,a)})} |
  | 9 |  | else{~~o=jQuery('[name="buddyforms\_options['+e+']['+t+']"]');buddyform\_apply\_template\_to\_element(o,r~~)}})};if(t instanceof Array){buddyform\_apply\_template\_to\_element(jQuery('[name="buddyforms\_options['+e+'][]"]'),t)} |
  | 10 |  | else{buddyform\_apply\_template\_to\_element(jQuery('[name="buddyforms\_options['+e+']"]'),t)};var ~~r=jQuery('.bf-select2');if(r.length>0){buddyforms\_load\_select2(r)};from\_setup\_form\_type(jQuery('#bf-form-type-select').val())});break;default:bf\_alert(t)}});tb\_remove();if(!r.val()){r.val(buddyformsMakeFieldId());jQuery('input#title').focus();jQuery('#title-prompt-text').addClass('screen-reader-text')};jQuery('[name="buddyforms\_options[slug]"]').val('')},error:function(){jQuery('<div></div>').dialog({modal:!0,title:'Info',open:function(){var e='Something went wrong ;-(sorry)';jQuery(this).html(e)},buttons:{Ok:function(){jQuery(this).dialog('close')}}})},complete:function(e,r){if(typeof t==='function'){t(e,r~~)}}})};return!1};function buddyform\_apply\_template\_to\_element(e,t){if(e.length===1){e.val(t).trigger('change')} |
  | 11 |  | else{jQuery.each(e,function(){var e=jQuery(this),~~r=e.val();e.prop('checked',(r===t))})}};function buddyforms\_process\_errors(e){var t=!0;if(e.length>0){jQuery.each(e,function(e,r){if(!r.isValid){t=!1;var s=r.type||'accordion';switch(s){case'title':case'content':case'textarea':case'text':case'post\_excerpt':case'number':case'subject':case'message':{jQuery('a[href=\'#validation-'+s+'-'+r.field\_id+'\']').trigger('click');var o=jQuery('#sortable\_buddyforms\_elements');o.accordion({active:!1});jQuery(r.element).closest('.accordion-body.ui-accordion-content.collapse').addClass('ui-accordion-content-active').css('height','auto');var a=jQuery(r.element).closest('li.bf\_list\_item'),i=jQuery('#sortable\_buddyforms\_elements li.bf\_list\_item').index(jQuery(a));o.accordion({active:i});jQuery('#buddyforms\_form\_setup').removeClass('closed');jQuery('#buddyforms\_form\_elements').removeClass('closed');break};case'accordion':{var d=jQuery(r.element).closest('div').parent().attr('id');jQuery('a[href=\'#'+d+'\']').trigger('click');var o=jQuery('#sortable\_buddyforms\_elements');o.accordion({active:!1});jQuery(r.element).closest('.accordion-body.ui-accordion-content.collapse').addClass('ui-accordion-content-active').css('height','auto');var a=jQuery(r.element).closest('li.bf\_list\_item'),i=jQuery('#sortable\_buddyforms\_elements li.bf\_list\_item').index(jQuery(a));o.accordion({active:i});jQuery('#buddyforms\_form\_setup').removeClass('closed');jQuery('#buddyforms\_form\_elements').removeClass('closed');break};case'settings':{if(!jQuery(r.element).is(':visible')){var l=jQuery(r.element).closest('div.tab-pane.ui-widget-content.ui-corner-bottom').attr('id');jQuery('.buddyform-nav-tabs li[aria-controls="'+l+'"]>a').trigger('click')};break}};var n=jQuery(r.element).attr('name');jQuery('html, body').animate({scrollTop:jQuery('[name="'+n+'"]').offset().top-250},1000);return!1}})};return t};var bfErrors=[];function bfValidateRule(e,t,d,a){var r=jQuery('[field\_id='+e+'\_validation\_minlength]')[0],o=jQuery('[field\_id='+e+'\_validation\_maxlength]')[0];if(o&&r){var i=parseInt(r.value),s=parseInt(o.value),n=jQuery(r).parent(),l=jQuery(o~~).parent();jQuery(n).find('label#'+e+'\_validation\_error\_message').remove();jQuery(l).find('label#'+e+'\_validation\_error\_message').remove();if(i===0&&s===0){bfErrors=bfErrors.filter(function(t){return t.field\_id!==e})} |
  | 12 |  | else{if(t==='min'){if(i<0){bfErrors.push({isValid:!1,element:~~r~~,type:a,field\_id:e});jQuery(n).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Value must be greater or equals zero.</label>')} |
  | 13 |  | else{if(i>=s){bfErrors.push({isValid:!1,element:~~r~~,type:a,field\_id:e});jQuery(n).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Min value must be lesser than Max.</label>')} |
  |  | 8 | else{jQuery('.status-date-format').hide();jQuery('.status-time-format').hide()}};function load\_formbuilder\_template(e,t){var o=jQuery('input#title');if(buddyformsGlobal){jQuery.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_form\_template','template':e,'title':o.val()},success:function(e){jQuery.each(e,function(e,t){switch(e){case'formbuilder':var o=jQuery('.buddyforms\_forms\_builder');o.replaceWith(t);bf\_update\_list\_item\_number();jQuery(document.body).trigger({type:'buddyform:load\_fields'});break;case'mail\_notification':jQuery('.buddyforms\_accordion\_notification').html(t);jQuery('#no-trigger-mailcontainer').hide();tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();break;case'form\_setup':jQuery.each(t,function(e,t){if(t instanceof Object){jQuery.each(t,function(t,o){var r;if(o instanceof Object){jQuery.each(o,function(o,a){r=jQuery('[name="buddyforms\_options['+e+']['+t+']['+o+']"]');buddyform\_apply\_template\_to\_element(r,a)})} |
  |  | 9 | else{r=jQuery('[name="buddyforms\_options['+e+']['+t+']"]');buddyform\_apply\_template\_to\_element(r,o)}})};if(t instanceof Array){buddyform\_apply\_template\_to\_element(jQuery('[name="buddyforms\_options['+e+'][]"]'),t)} |
  |  | 10 | else{buddyform\_apply\_template\_to\_element(jQuery('[name="buddyforms\_options['+e+']"]'),t)};var o=jQuery('.bf-select2');if(o.length>0){buddyforms\_load\_select2(o)};from\_setup\_form\_type(jQuery('#bf-form-type-select').val())});break;default:bf\_alert(t)}});tb\_remove();if(!o.val()){o.val(buddyformsMakeFieldId());jQuery('input#title').focus();jQuery('#title-prompt-text').addClass('screen-reader-text')};jQuery('[name="buddyforms\_options[slug]"]').val('')},error:function(){jQuery('<div></div>').dialog({modal:!0,title:'Info',open:function(){var e='Something went wrong ;-(sorry)';jQuery(this).html(e)},buttons:{Ok:function(){jQuery(this).dialog('close')}}})},complete:function(e,o){if(typeof t==='function'){t(e,o)}}})};return!1};function buddyform\_apply\_template\_to\_element(e,t){if(e.length===1){e.val(t).trigger('change')} |
  |  | 11 | else{jQuery.each(e,function(){var e=jQuery(this),o=e.val();e.prop('checked',(o===t))})}};function buddyforms\_process\_errors(e){var t=!0;if(e.length>0){jQuery.each(e,function(e,o){if(!o.isValid){t=!1;var s=o.type||'accordion';switch(s){case'title':case'content':case'textarea':case'text':case'post\_excerpt':case'number':case'subject':case'message':{jQuery('a[href=\'#validation-'+s+'-'+o.field\_id+'\']').trigger('click');var r=jQuery('#sortable\_buddyforms\_elements');r.accordion({active:!1});jQuery(o.element).closest('.accordion-body.ui-accordion-content.collapse').addClass('ui-accordion-content-active').css('height','auto');var a=jQuery(o.element).closest('li.bf\_list\_item'),i=jQuery('#sortable\_buddyforms\_elements li.bf\_list\_item').index(jQuery(a));r.accordion({active:i});jQuery('#buddyforms\_form\_setup').removeClass('closed');jQuery('#buddyforms\_form\_elements').removeClass('closed');break};case'accordion':{var d=jQuery(o.element).closest('div').parent().attr('id');jQuery('a[href=\'#'+d+'\']').trigger('click');var r=jQuery('#sortable\_buddyforms\_elements');r.accordion({active:!1});jQuery(o.element).closest('.accordion-body.ui-accordion-content.collapse').addClass('ui-accordion-content-active').css('height','auto');var a=jQuery(o.element).closest('li.bf\_list\_item'),i=jQuery('#sortable\_buddyforms\_elements li.bf\_list\_item').index(jQuery(a));r.accordion({active:i});jQuery('#buddyforms\_form\_setup').removeClass('closed');jQuery('#buddyforms\_form\_elements').removeClass('closed');break};case'settings':{if(!jQuery(o.element).is(':visible')){var l=jQuery(o.element).closest('div.tab-pane.ui-widget-content.ui-corner-bottom').attr('id');jQuery('.buddyform-nav-tabs li[aria-controls="'+l+'"]>a').trigger('click')};break}};var n=jQuery(o.element).attr('name');jQuery('html, body').animate({scrollTop:jQuery('[name="'+n+'"]').offset().top-250},1000);return!1}})};return t};var bfErrors=[];function bfValidateRule(e,t,d,a){var o=jQuery('[field\_id='+e+'\_validation\_minlength]')[0],r=jQuery('[field\_id='+e+'\_validation\_maxlength]')[0];if(r&&o){var i=parseInt(o.value),s=parseInt(r.value),n=jQuery(o).parent(),l=jQuery(r).parent();jQuery(n).find('label#'+e+'\_validation\_error\_message').remove();jQuery(l).find('label#'+e+'\_validation\_error\_message').remove();if(i===0&&s===0){bfErrors=bfErrors.filter(function(t){return t.field\_id!==e})} |
  |  | 12 | else{if(t==='min'){if(i<0){bfErrors.push({isValid:!1,element:o,type:a,field\_id:e});jQuery(n).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Value must be greater or equals zero.</label>')} |
  |  | 13 | else{if(i>=s){bfErrors.push({isValid:!1,element:o,type:a,field\_id:e});jQuery(n).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Min value must be lesser than Max.</label>')} |
  | 14 | 14 | else{bfErrors=bfErrors.filter(function(t){return t.field\_id!==e})}}} |
  | 15 |  | else if(t==='max'){if(s<0){bfErrors.push({isValid:!1,element:~~o~~,type:a,field\_id:e});jQuery(l).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Value must be greater or equals zero.</label>')} |
  | 16 |  | else{if(s<=i){bfErrors.push({isValid:!1,element:~~o~~,type:a,field\_id:e});jQuery(l).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Max value must be greater than Min.</label>')} |
  | 17 |  | else{bfErrors=bfErrors.filter(function(t){return t.field\_id!==e})}}}}}};function buddyformsCopyStringToClipboard(e){var t=document.createElement('textarea');t.value=e;t.setAttribute('readonly','');t.style.position='absolute';t.style.left='-9999px';document.body.appendChild(t);var ~~r=document.getSelection().rangeCount>0?document.getSelection().getRangeAt(0):!1;t.select();document.execCommand('copy');document.body.removeChild(t);if(r){document.getSelection().removeAllRanges();document.getSelection().addRange(r)}};function bf\_trans(e){if(typeof e==='string'&&typeof buddyformsGlobal!=='undefined'&&typeof buddyformsGlobal.localize!=='undefined'&&typeof buddyformsGlobal.localize.bf\_trans!=='undefined'){const localize\_str=Object.values(buddyformsGlobal.localize.bf\_trans).find(function(t){return t.msgid===e});return(typeof localize\_str!=='undefined')?localize\_str.msgstr:e};return e};jQuery(document).ready(function(e){if(buddyformsGlobal){var t=buddyformsGlobal.current\_screen||!1,s=buddyformsGlobal.is\_admin||!1;if(t&&s){if(t.id==='edit-buddyforms'||t.id==='buddyforms'||t.id==='buddyforms\_page\_buddyforms\_submissions'||t.id==='buddyforms\_page\_buddyforms\_settings'||t.id==='buddyforms\_page\_bf\_add\_ons'){var a=e('#post');e('#wpbody-content').html('<div class="wrap"></div>');e('#wpbody-content .wrap').html(a);e(window).scrollTop(0);e('div .postbox').not('.buddyforms-metabox, #submitdiv').remove();e('#submitdiv').show();a.removeClass('hidden')}}};var o=e('.bf-select2');if(o.length>0){buddyforms\_load\_select2(o)};e(document).on('keyup keypress','form input[type="text"]',function(e){if(e.which===13){e.preventDefault();return!1}});e(document.body).on('click','.bf-preview',function(){var r=e(this).attr('data-key'),o=e(this).attr('data-src'),t=e('#iframe-'+r);if(t.length>0){t.attr('src',o)}});var r=e('table.wp-list-table.element\_field\_table\_sortable');if(r&&r.length>0){r~~.sortable({items:'tr.field\_item'})};e(document.body).on('change','.bf\_mail\_from\_name\_multi\_checkbox input',function(){var t=e(this).val();if(t==='custom'){e(this).closest('.wp-list-table').find('.mail\_from\_name\_custom').removeClass('hidden')} |
  |  | 15 | else if(t==='max'){if(s<0){bfErrors.push({isValid:!1,element:r,type:a,field\_id:e});jQuery(l).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Value must be greater or equals zero.</label>')} |
  |  | 16 | else{if(s<=i){bfErrors.push({isValid:!1,element:r,type:a,field\_id:e});jQuery(l).append('<label id=\''+e+'\_validation\_error\_message\' class=\'error\'>Max value must be greater than Min.</label>')} |
  |  | 17 | else{bfErrors=bfErrors.filter(function(t){return t.field\_id!==e})}}}}}};function buddyformsCopyStringToClipboard(e){var t=document.createElement('textarea');t.value=e;t.setAttribute('readonly','');t.style.position='absolute';t.style.left='-9999px';document.body.appendChild(t);var o=document.getSelection().rangeCount>0?document.getSelection().getRangeAt(0):!1;t.select();document.execCommand('copy');document.body.removeChild(t);if(o){document.getSelection().removeAllRanges();document.getSelection().addRange(o)}};function bf\_trans(e){if(typeof e==='string'&&typeof buddyformsGlobal!=='undefined'&&typeof buddyformsGlobal.localize!=='undefined'&&typeof buddyformsGlobal.localize.bf\_trans!=='undefined'){const localize\_str=Object.values(buddyformsGlobal.localize.bf\_trans).find(function(t){return t.msgid===e});return(typeof localize\_str!=='undefined')?localize\_str.msgstr:e};return e};jQuery(document).ready(function(e){if(buddyformsGlobal){var t=buddyformsGlobal.current\_screen||!1,s=buddyformsGlobal.is\_admin||!1;if(t&&s){if(t.id==='edit-buddyforms'||t.id==='buddyforms'||t.id==='buddyforms\_page\_buddyforms\_submissions'||t.id==='buddyforms\_page\_buddyforms\_settings'||t.id==='buddyforms\_page\_bf\_add\_ons'){var a=e('#post');e('#wpbody-content').html('<div class="wrap"></div>');e('#wpbody-content .wrap').html(a);e(window).scrollTop(0);e('div .postbox').not('.buddyforms-metabox, #submitdiv').remove();e('#submitdiv').show();a.removeClass('hidden')}}};var r=e('.bf-select2');if(r.length>0){buddyforms\_load\_select2(r)};e(document).on('keyup keypress','form input[type="text"]',function(e){if(e.which===13){e.preventDefault();return!1}});e(document.body).on('click','.bf-preview',function(){var o=e(this).attr('data-key'),r=e(this).attr('data-src'),t=e('#iframe-'+o);if(t.length>0){t.attr('src',r)}});var o=e('table.wp-list-table.element\_field\_table\_sortable');if(o&&o.length>0){o.sortable({items:'tr.field\_item'})};e(document.body).on('change','.bf\_mail\_from\_name\_multi\_checkbox input',function(){var t=e(this).val();if(t==='custom'){e(this).closest('.wp-list-table').find('.mail\_from\_name\_custom').removeClass('hidden')} |
  | 18 | 18 | else{e(this).closest('.wp-list-table').find('.mail\_from\_name\_custom').addClass('hidden')}});e(document.body).on('change','.bf\_mail\_from\_multi\_checkbox input',function(){var t=e(this).val();if(t==='custom'){e(this).closest('.wp-list-table').find('.mail\_from\_custom').removeClass('hidden')} |
  | 19 | 19 | else{e(this).closest('.wp-list-table').find('.mail\_from\_custom').addClass('hidden')}});e(document.body).on('change','.bf\_sent\_mail\_to\_multi\_checkbox input',function(){var t=e(this).val();if(e(this).is(':checked')){e(this).closest('.wp-list-table').find('.mail\_to\_'+t+'\_address').removeClass('hidden').prop('required',!0)} |
  | 20 | 20 | else{e(this).closest('.wp-list-table').find('.mail\_to\_'+t+'\_address').addClass('hidden').prop('required',!1)}});e('#publish').on('click',function(){var t=e('[name="post\_title"]');if(t.val()===''){t.removeClass('bf-ok');t.addClass('bf-error');bfErrors.push({isValid:!1,element:t,type:'title'})} |
  | 21 |  | else{t.removeClass('bf-error');t.addClass('bf-ok')};var n=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_cc\_address]"]');e.each(n,function(e,t){var ~~r=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:r,element:t,type:'settings'})});var s=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_bcc\_address]"]');e.each(s,function(e,t){var r=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:r,element:t,type:'settings'})});var i=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_address]"]');e.each(i,function(e,t){var r=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:r,element:t,type:'settings'})});var r=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_from\_custom]"]');if(r.length>0){var a=buddyforms\_validate\_notifications\_email(r);bfErrors.push({isValid:a,element:r,type:'settings'})};buddyformAutoFillEmptyOrDuplicateSlugs();e('#post input[required]').each(function(){var r=(e(this).val()!='');if(r~~){e(this).removeClass('bf-error');var t=e(this).eq(0).attr('name');bfErrors=bfErrors.filter(function(e){return e.field\_name!==t})} |
  | 22 |  | else{var t=e(this).eq(0).attr('name');bfErrors.push({isValid:~~r,element:e(this)[0],type:'accordion',field\_name:t});e(this).addClass('bf-error');return!1}});var o=buddyforms\_process\_errors(bfErrors);return o});e(document).on('click','button#btn-compile-custom',function(t){t.preventDefault();e('#buddyforms\_template\_header\_container').show('slow').css('display','flex');e('#formbuilder-action-templates').show('slow');e('#buddyforms\_template\_list\_container').hide('fast')});e(document).on('click','#formbuilder-show-templates',function(){e('#buddyforms\_template\_header\_container').hide('fast');e('#buddyforms\_template\_list\_container').show('slow');e('#formbuilder-show-templates').hide()});e(document).on('click','.bf\_delete\_field',function(){var t=e(this).attr('id'),r=bf\_trans('Delete Permanently');if(confirm(r))e('#field\_'+t).remove();return!1});e(document).on('click','.bf\_delete\_trigger',function(){var t=e(this).attr('id'),r=bf\_trans('Delete Permanently');if(confirm(r)){e('#trigger'+t).remove();e('.trigger'+t).remove()};return!1});e(document).on('click','.bf\_add\_gdpr',function(){if(buddyformsGlobal){var s=e(this),t=e(this).attr('data-gdpr-type'),r=e('#table\_row\_'+t+'\_select\_options table.element\_field\_table\_sortable tbody tr').size(),a=e('#gdpr\_option\_type').val(),i='';if(buddyformsGlobal.admin\_text[a]){i=buddyformsGlobal.admin\_text[a]};var o='';if(buddyformsGlobal.admin\_text['error\_message']){o=buddyformsGlobal.admin\_text['error\_message']};r=r+1;e('#table\_row\_'+t+'\_select\_options table.element\_field\_table\_sortable tbody').append('<tr class="field\_item field\_item\_'+t+'\_'+r+'"><td><div class="dashicons dashicons-image-flip-vertical"></div></td><td><p><b>Agreement Text</b></p><textarea rows="3" name="buddyforms\_options[form\_fields]['+t+'][options]['+r+'][label]" cols="50">'+i+'</textarea><p><b>Error Message</b></p><textarea rows="3" name="buddyforms\_options[form\_fields]['+t+'][options]['+r+'][error\_message]" cols="50">'+o+'</textarea></td><td class="manage-column column-author"><div class="checkbox">   <label class="">       <input type="checkbox" name="buddyforms\_options[form\_fields]['+t+'][options]['+r+'][checked][]" value="checked"><span>Checked</span>   </label></div><div class="checkbox">   <label class="">       <input type="checkbox" name="buddyforms\_options[form\_fields]['+t+'][options]['+r+'][required][]" value="required"><span>Required</span>   </label></div></td><td class="manage-column column-author"><a href="#" id="'+t+'\_'+r+'" class="bf\_delete\_input">Delete</a></td></tr>');return!1}});e(document.body).on('click','.button.bf\_reset\_multi\_input',function(t){t.preventDefault();var r=e(this).attr('data-group-name'),o=e(this).attr('data-field-id');e('input[name="buddyforms\_options[form\_fields]['+o+'][default]"][value="'+r+'"]').attr('checked',!1);return!1});e(document).on('click','.bf\_add\_input',function(){var o=e(this),t=o.attr('href').split('/'),r=e('#table\_row\_'+t[0]+'\_select\_options table.element\_field\_table\_sortable tbody tr').size();r=r+1;e('#table\_row\_'+t[0]+'\_select\_options table.element\_field\_table\_sortable tbody').append('<tr class="field\_item field\_item\_'+t[0]+'\_'+r+'"><td><div class="dashicons dashicons-image-flip-vertical"></div></td><td><input class="field-sortable" required="required" type="text" name="buddyforms\_options[form\_fields]['+t[0]+'][options]['+r+'][label]"></td><td><input class="field-sortable" required="required" type="text" name="buddyforms\_options[form\_fields]['+t[0]+'][options]['+r+'][value]"></td><td class="manage-column column-default"><p>Save the Form</p></td><td class="manage-column column-default"><a href="#" id="'+t[0]+'\_'+r+'" class="bf\_delete\_input">Delete</a></td></tr>');return!1});e(document).on('click','.bf\_delete\_input',function(){var t=e(this).attr('id'),r=bf\_trans('Delete Permanently');if(confirm(r))e('.field\_item\_'+t).remove();return!1});bf\_update\_list\_item\_number();e(document).on('mousedown','.bf\_list\_item',function(){itemList=e(this).closest('.sortable').sortable({update:function(e,t){bf\_update\_list\_item\_number()}})});bf\_update\_list\_item\_number\_mail();e(document).on('click','.bf\_test\_trigger:not(disabled)',function(t){t.preventDefault();t.stopPropagation();var o=e(this).attr('id'),r=e(this);r.attr('disabled',!0);r.text('Sending...');e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_test\_email','notification\_id':o,'form\_slug':r.attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,},success:function(e){alert(e)},error:function(e){alert(e.responseText)},complete:function(){r.removeAttr('disabled');r.text('Test')}});return!1});e(document).on('click','#mail\_notification\_add\_new',function(){if(buddyformsGlobal){e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_new\_mail\_notification','form\_slug':e(this).attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,},success:function(t){e('#no-trigger-mailcontainer').hide();e('#mailcontainer').append(t['html']);tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();e(document.body).trigger({type:'buddyform:load\_notifications'})}})};return!1});e(document).on('click','#post\_status\_mail\_notification\_add\_new',function(){var r=!1,t=e('.post\_status\_mail\_notification\_trigger select').val();if(!t){return!1};if(t==='none'){bf\_alert('You have to select a trigger first.');return!1};e('#post-status-mail-container li.bf\_trigger\_list\_item').each(function(){if(e(this).attr('id')=='trigger'+t){bf\_alert('Trigger already exists');r=!0}});if(r~~==!0)return!1;if(buddyformsGlobal){e.ajax({type:'POST',url:buddyformsGlobal.admin\_url,dataType:'json',data:{'action':'buddyforms\_new\_post\_status\_mail\_notification','form\_slug':e(this).attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,'trigger':t},success:function(t){if(t==0){bf\_alert('trigger already exists');return!1};e('#no-trigger-post-status-mail-container').hide();e('#post-status-mail-container').append(t['html']);tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();e(document.body).trigger({type:'buddyform:load\_notifications'})}})};return!1});e(document).on('click','.bf\_check\_all',function(t){if(buddyformsGlobal){e('.bf\_permissions :checkbox').not('[disabled]').prop('checked',!0);e(this).removeClass();e(this).addClass('bf\_uncheck\_all');e(this).text(buddyformsGlobal.admin\_text.uncheck)};t.preventDefault()});e(document).on('click','.bf\_uncheck\_all',function(t){if(buddyformsGlobal){e('.bf\_permissions :checkbox').not('[disabled]').prop('checked',!1);e(this).removeClass();e(this).addClass('bf\_check\_all');e(this).text(buddyformsGlobal.admin\_text.check)};t.preventDefault()});e(document).on('click','.bf\_check',function(t){if(buddyformsGlobal){if(e('.bf\_permissions input[type=\'checkbox\']').prop('checked')){e(this).text(buddyformsGlobal.admin\_text.check)} |
  | 23 |  | else{e(this).text(buddyformsGlobal.admin\_text.uncheck)}};t.preventDefault()});e('.bf\_check').trigger('click');if(window.location.search.indexOf('post\_type=buddyforms')!==-1){e('\*[class^="vc\_"]').remove()};if(buddyformsGlobal&&buddyformsGlobal.post\_type==='buddyforms'){e(document).on('click','#bf\_load\_layout\_options',function(){e('.layout-spinner').addClass('is-active').show();var t=e('#bf\_form\_layout\_select').val();e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_load\_form\_layout','form\_slug':t},success:function(e){i(e)}});return!1});e(document).on('click','#bf\_reset\_layout\_options',function(t){e('.layout-spinner-reset').addClass('is-active').show();e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_load\_form\_layout','form\_slug':'reset'},success:function(e){i(e)}});return!1});function i(t){e('.layout-spinner').removeClass('is-active').hide();var ~~r=e('#buddyforms\_form\_designer');if(r.length>0){e.each(t,function(t,o){var s=e(r).find('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"]'),i=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][name$="[color]"]'),n=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][name$="[style]"][value="'+o.style+'"]'),a;if(s||i||n){a=s.attr('type');if((typeof a==='undefined'||!a)&&i.length>0){a=i.attr('type')}};if('custom\_css'===t){e('#'+t).text(o)};if(s.length>0&&a){switch(a){case'text':case'number':s.val(o||'');break;case'radio':e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][value="'+o+'"]').prop('checked',!0).trigger('change');break;case'checkbox':var l=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"]');l.prop('checked',(o&&l.val()===o)).trigger('change');break}};if(i.length>0){i.val(o&&o.color||'').trigger('change')};if(n.length>0){n.prop('checked',o&&o.style).trigger('change')}})}}};e(document).on('change','select.captcha-version',function(t){var r=e(this).val();if(r~~==='v3'){e('tr[id$="\_captcha\_v3\_action"]').show();e('tr[id$="\_captcha\_v3\_score"]').show();e('.bf\_hide\_captcha\_v2\_options').show()} |
  | 24 |  | else{e('tr[id$="\_captcha\_v3\_action"]').hide();e('tr[id$="\_captcha\_v3\_score"]').hide();e('.bf\_hide\_captcha\_v2\_options').hide()}});e(document).on('click','.bf-ready-to-copy',function(t){t.preventDefault();t.stopPropagation();var ~~r=e(this);if(r.is('input')){buddyformsCopyStringToClipboard(r~~.val())} |
  | 25 |  | else{var a=e(this).closest('.accordion-heading-options'),~~o=a.parent().find('.accordion-body');o.removeClass('ui-accordion-content-active').hide();buddyformsCopyStringToClipboard(r.text());o~~.addClass('ui-accordion-content-active')};return!1})}); |
  |  | 21 | else{t.removeClass('bf-error');t.addClass('bf-ok')};var n=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_cc\_address]"]');e.each(n,function(e,t){var o=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:o,element:t,type:'settings'})});var s=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_bcc\_address]"]');e.each(s,function(e,t){var o=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:o,element:t,type:'settings'})});var i=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_to\_address]"]');e.each(i,function(e,t){var o=buddyforms\_validate\_notifications\_email(t);bfErrors.push({isValid:o,element:t,type:'settings'})});var o=e('input[name^="buddyforms\_options[mail\_submissions]"][name$="[mail\_from\_custom]"]');if(o.length>0){var a=buddyforms\_validate\_notifications\_email(o);bfErrors.push({isValid:a,element:o,type:'settings'})};buddyformAutoFillEmptyOrDuplicateSlugs();e('#post input[required]').each(function(){var o=(e(this).val()!='');if(o){e(this).removeClass('bf-error');var t=e(this).eq(0).attr('name');bfErrors=bfErrors.filter(function(e){return e.field\_name!==t})} |
  |  | 22 | else{var t=e(this).eq(0).attr('name');bfErrors.push({isValid:o,element:e(this)[0],type:'accordion',field\_name:t});e(this).addClass('bf-error');return!1}});var r=buddyforms\_process\_errors(bfErrors);return r});e(document).on('click','button#btn-compile-custom',function(t){t.preventDefault();e('#buddyforms\_template\_header\_container').show('slow').css('display','flex');e('#formbuilder-action-templates').show('slow');e('#buddyforms\_template\_list\_container').hide('fast')});e(document).on('click','#formbuilder-show-templates',function(){e('#buddyforms\_template\_header\_container').hide('fast');e('#buddyforms\_template\_list\_container').show('slow');e('#formbuilder-show-templates').hide()});e(document).on('click','.bf\_delete\_field',function(){var t=e(this).attr('id'),o=bf\_trans('Delete Permanently');if(confirm(o))e('#field\_'+t).remove();return!1});e(document).on('click','.bf\_delete\_trigger',function(){var t=e(this).attr('id'),o=bf\_trans('Delete Permanently');if(confirm(o)){e('#trigger'+t).remove();e('.trigger'+t).remove()};return!1});e(document).on('click','.bf\_add\_gdpr',function(){if(buddyformsGlobal){var s=e(this),t=e(this).attr('data-gdpr-type'),o=e('#table\_row\_'+t+'\_select\_options table.element\_field\_table\_sortable tbody tr').size(),a=e('#gdpr\_option\_type').val(),i='';if(buddyformsGlobal.admin\_text[a]){i=buddyformsGlobal.admin\_text[a]};var r='';if(buddyformsGlobal.admin\_text['error\_message']){r=buddyformsGlobal.admin\_text['error\_message']};o=o+1;e('#table\_row\_'+t+'\_select\_options table.element\_field\_table\_sortable tbody').append('<tr class="field\_item field\_item\_'+t+'\_'+o+'"><td><div class="dashicons dashicons-image-flip-vertical"></div></td><td><p><b>Agreement Text</b></p><textarea rows="3" name="buddyforms\_options[form\_fields]['+t+'][options]['+o+'][label]" cols="50">'+i+'</textarea><p><b>Error Message</b></p><textarea rows="3" name="buddyforms\_options[form\_fields]['+t+'][options]['+o+'][error\_message]" cols="50">'+r+'</textarea></td><td class="manage-column column-author"><div class="checkbox">   <label class="">       <input type="checkbox" name="buddyforms\_options[form\_fields]['+t+'][options]['+o+'][checked][]" value="checked"><span>Checked</span>   </label></div><div class="checkbox">   <label class="">       <input type="checkbox" name="buddyforms\_options[form\_fields]['+t+'][options]['+o+'][required][]" value="required"><span>Required</span>   </label></div></td><td class="manage-column column-author"><a href="#" id="'+t+'\_'+o+'" class="bf\_delete\_input">Delete</a></td></tr>');return!1}});e(document.body).on('click','.button.bf\_reset\_multi\_input',function(t){t.preventDefault();var o=e(this).attr('data-group-name'),r=e(this).attr('data-field-id');e('input[name="buddyforms\_options[form\_fields]['+r+'][default]"][value="'+o+'"]').attr('checked',!1);return!1});e(document).on('click','.bf\_add\_input',function(){var r=e(this),t=r.attr('href').split('/'),o=e('#table\_row\_'+t[0]+'\_select\_options table.element\_field\_table\_sortable tbody tr').size();o=o+1;e('#table\_row\_'+t[0]+'\_select\_options table.element\_field\_table\_sortable tbody').append('<tr class="field\_item field\_item\_'+t[0]+'\_'+o+'"><td><div class="dashicons dashicons-image-flip-vertical"></div></td><td><input class="field-sortable" required="required" type="text" name="buddyforms\_options[form\_fields]['+t[0]+'][options]['+o+'][label]"></td><td><input class="field-sortable" required="required" type="text" name="buddyforms\_options[form\_fields]['+t[0]+'][options]['+o+'][value]"></td><td class="manage-column column-default"><p>Save the Form</p></td><td class="manage-column column-default"><a href="#" id="'+t[0]+'\_'+o+'" class="bf\_delete\_input">Delete</a></td></tr>');return!1});e(document).on('click','.bf\_delete\_input',function(){var t=e(this).attr('id'),o=bf\_trans('Delete Permanently');if(confirm(o))e('.field\_item\_'+t).remove();return!1});bf\_update\_list\_item\_number();e(document).on('mousedown','.bf\_list\_item',function(){itemList=e(this).closest('.sortable').sortable({update:function(e,t){bf\_update\_list\_item\_number()}})});bf\_update\_list\_item\_number\_mail();e(document).on('click','.bf\_test\_trigger:not(disabled)',function(t){t.preventDefault();t.stopPropagation();var r=e(this).attr('id'),o=e(this);o.attr('disabled',!0);o.text('Sending...');e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_test\_email','notification\_id':r,'form\_slug':o.attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,},success:function(e){alert(e)},error:function(e){alert(e.responseText)},complete:function(){o.removeAttr('disabled');o.text('Test')}});return!1});e(document).on('click','#mail\_notification\_add\_new',function(){if(buddyformsGlobal){e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_new\_mail\_notification','form\_slug':e(this).attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,},success:function(t){e('#no-trigger-mailcontainer').hide();e('#mailcontainer').append(t['html']);tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();e(document.body).trigger({type:'buddyform:load\_notifications'})}})};return!1});e(document).on('click','#post\_status\_mail\_notification\_add\_new',function(){var o=!1,t=e('.post\_status\_mail\_notification\_trigger select').val();if(!t){return!1};if(t==='none'){bf\_alert('You have to select a trigger first.');return!1};e('#post-status-mail-container li.bf\_trigger\_list\_item').each(function(){if(e(this).attr('id')=='trigger'+t){bf\_alert('Trigger already exists');o=!0}});if(o==!0)return!1;if(buddyformsGlobal){e.ajax({type:'POST',url:buddyformsGlobal.admin\_url,dataType:'json',data:{'action':'buddyforms\_new\_post\_status\_mail\_notification','form\_slug':e(this).attr('data-form-slug'),'nonce':buddyformsGlobal.ajaxnonce,'trigger':t},success:function(t){if(t==0){bf\_alert('trigger already exists');return!1};e('#no-trigger-post-status-mail-container').hide();e('#post-status-mail-container').append(t['html']);tinymce.execCommand('mceRemoveEditor',!1,'bf\_mail\_body'+t['trigger\_id']);tinymce.execCommand('mceAddEditor',!1,'bf\_mail\_body'+t['trigger\_id']);bf\_update\_list\_item\_number\_mail();e(document.body).trigger({type:'buddyform:load\_notifications'})}})};return!1});e(document).on('click','.bf\_check\_all',function(t){if(buddyformsGlobal){e('.bf\_permissions :checkbox').not('[disabled]').prop('checked',!0);e(this).removeClass();e(this).addClass('bf\_uncheck\_all');e(this).text(buddyformsGlobal.admin\_text.uncheck)};t.preventDefault()});e(document).on('click','.bf\_uncheck\_all',function(t){if(buddyformsGlobal){e('.bf\_permissions :checkbox').not('[disabled]').prop('checked',!1);e(this).removeClass();e(this).addClass('bf\_check\_all');e(this).text(buddyformsGlobal.admin\_text.check)};t.preventDefault()});e(document).on('click','.bf\_check',function(t){if(buddyformsGlobal){if(e('.bf\_permissions input[type=\'checkbox\']').prop('checked')){e(this).text(buddyformsGlobal.admin\_text.check)} |
  |  | 23 | else{e(this).text(buddyformsGlobal.admin\_text.uncheck)}};t.preventDefault()});e('.bf\_check').trigger('click');if(window.location.search.indexOf('post\_type=buddyforms')!==-1){e('\*[class^="vc\_"]').remove()};if(buddyformsGlobal&&buddyformsGlobal.post\_type==='buddyforms'){e(document).on('click','#bf\_load\_layout\_options',function(){e('.layout-spinner').addClass('is-active').show();var t=e('#bf\_form\_layout\_select').val();e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_load\_form\_layout','form\_slug':t},success:function(e){i(e)}});return!1});e(document).on('click','#bf\_reset\_layout\_options',function(t){e('.layout-spinner-reset').addClass('is-active').show();e.ajax({type:'POST',dataType:'json',url:buddyformsGlobal.admin\_url,data:{'action':'buddyforms\_load\_form\_layout','form\_slug':'reset'},success:function(e){i(e)}});return!1});function i(t){e('.layout-spinner').removeClass('is-active').hide();var o=e('#buddyforms\_form\_designer');if(o.length>0){e.each(t,function(t,r){var s=e(o).find('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"]'),i=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][name$="[color]"]'),n=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][name$="[style]"][value="'+r.style+'"]'),a;if(s||i||n){a=s.attr('type');if((typeof a==='undefined'||!a)&&i.length>0){a=i.attr('type')}};if('custom\_css'===t){e('#'+t).text(r)};if(s.length>0&&a){switch(a){case'text':case'number':s.val(r||'');break;case'radio':e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"][value="'+r+'"]').prop('checked',!0).trigger('change');break;case'checkbox':var l=e('input[name^="buddyforms\_options[layout]"][name\*="'+t+'"]');l.prop('checked',(r&&l.val()===r)).trigger('change');break}};if(i.length>0){i.val(r&&r.color||'').trigger('change')};if(n.length>0){n.prop('checked',r&&r.style).trigger('change')}})}}};e(document).on('change','select.captcha-version',function(t){var o=e(this).val();if(o==='v3'){e('tr[id$="\_captcha\_v3\_action"]').show();e('tr[id$="\_captcha\_v3\_score"]').show();e('.bf\_hide\_captcha\_v2\_options').show()} |
  |  | 24 | else{e('tr[id$="\_captcha\_v3\_action"]').hide();e('tr[id$="\_captcha\_v3\_score"]').hide();e('.bf\_hide\_captcha\_v2\_options').hide()}});e(document).on('click','.bf-ready-to-copy',function(t){t.preventDefault();t.stopPropagation();var o=e(this);if(o.is('input')){buddyformsCopyStringToClipboard(o.val())} |
  |  | 25 | else{var a=e(this).closest('.accordion-heading-options'),r=a.parent().find('.accordion-body');r.removeClass('ui-accordion-content-active').hide();buddyformsCopyStringToClipboard(o.text());r.addClass('ui-accordion-content-active')};return!1})}); |
* ## [buddyforms/trunk/assets/resources/dropzone/initializer.js](/changeset/3046092/buddyforms/trunk/assets/resources/dropzone/initializer.js?old=2533343&old_path=buddyforms%2Ftrunk%2Fassets%2Fresources%2Fdropzone%2Finitializer.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/resources/dropzone/initializer.js")

  | [r3031945](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.js?rev=2533343#L102 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.js?rev=3046092#L102 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 102 | 102 | function DropZoneSending(file, xhr, formData) { |
  | 103 | 103 | disableSubmitButtons(true); |
  |  | 104 | var form\_slug = jQuery('#form\_slug').val(); |
  | 104 | 105 | formData.append('action', 'handle\_dropped\_media'); |
  | 105 | 106 | formData.append('nonce', buddyformsGlobal.ajaxnonce); |
  |  | 107 | formData.append('form\_slug', form\_slug ); |
  | 106 | 108 | } |
  | 107 | 109 |  |
* ## [buddyforms/trunk/assets/resources/dropzone/initializer.min.js](/changeset/3046092/buddyforms/trunk/assets/resources/dropzone/initializer.min.js?old=2533343&old_path=buddyforms%2Ftrunk%2Fassets%2Fresources%2Fdropzone%2Finitializer.min.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/resources/dropzone/initializer.min.js")

  | [r3031945](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.min.js?rev=2533343#L1 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/resources/dropzone/initializer.min.js?rev=3046092#L1 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | ;function uploadHandler(){var e,t,i="";function d(e){t=jQuery.map(e,function(e){return(jQuery(e).attr("type")==="submit"&&jQuery(e).hasClass("bf-submit"))?jQuery(e):null})[0];i=t.html()};function n(){jQuery(".upload\_field").each(function(){var e=jQuery(this),t=(e.attr("page")!=="buddyforms\_submissions"),a=e.attr("file\_limit"),i=e.attr("accepted\_files"),l=e.attr("multiple\_files"),o=e.data("entry"),r=e.attr("form-slug");jQuery("#buddyforms\_form\_"+r).show();u(e,e.attr("id"),a,i,l,t,o)})};function u(e,t,i,n,u,r,a){var d=jQuery(e).find("input[type=\"text\"][style\*=\"hidden\"]"),b="#"+t;if(buddyformsGlobal){var m={url:buddyformsGlobal.admin\_url,maxFilesize:i,parallelUploads:1,acceptedFiles:n,maxFiles:u,clickable:r,addRemoveLinks:r,init:function(){this.on("queuecomplete",function(){e.removeClass("error")});this.on("addedfile",function(){s(b)});this.on("success",function(e,t){c(e,t,d)});this.on("error",f);this.on("sending",o);this.on("sendingmultiple",o);this.on("complete",l);this.on("completemultiple",l);this.on("removedfile",function(e){p(e,d)});if(a){for(var i in a){if(i){var t={name:a[i]["name"],size:a[i]["size"],url:a[i]["url"],attachment\_id:a[i]["attachment\_id"],};this.emit("addedfile",t);this.emit("thumbnail",t,t.url);this.emit("complete",t);this.files.push(t)}}}},dictMaxFilesExceeded:buddyformsGlobal.localize.upload.dictMaxFilesExceeded||"You can not upload any more files.",dictRemoveFile:buddyformsGlobal.localize.upload.dictRemoveFile||"Remove file",dictCancelUploadConfirmation:buddyformsGlobal.localize.upload.dictCancelUploadConfirmation||"Are you sure you want to cancel this upload?",dictCancelUpload:buddyformsGlobal.localize.upload.dictCancelUpload||"Cancel upload",dictResponseError:buddyformsGlobal.localize.upload.dictResponseError||"Server responded with {{statusCode}} code.",dictInvalidFileType:buddyformsGlobal.localize.upload.dictInvalidFileType||"You can't upload files of this type.",dictFileTooBig:buddyformsGlobal.localize.upload.dictFileTooBig||"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictFallbackMessage:buddyformsGlobal.localize.upload.dictFallbackMessage||"Your browser does not support drag'n'drop file uploads.",dictDefaultMessage:buddyformsGlobal.localize.upload.dictDefaultMessage||"Drop files here to upload",};jQuery(e).dropzone(m)}};function l(){a()};function s(e){jQuery(e).find("label[class\*='error']").text("");jQuery(e).find(".dz-progress").hide()};function o(e,t,a){r(!0);~~a.append("action","handle\_dropped\_media");a.append("nonce",buddyformsGlobal.ajaxnonce~~)};function c(e,t,a){e.previewElement.classList.add("dz-success");e["attachment\_id"]=t;var i=jQuery(a).val()+","+t,l="";if(i[0]===","){l=i.substring(1,i.length)} |
  |  | 1 | ;function uploadHandler(){var e,t,i="";function d(e){t=jQuery.map(e,function(e){return(jQuery(e).attr("type")==="submit"&&jQuery(e).hasClass("bf-submit"))?jQuery(e):null})[0];i=t.html()};function n(){jQuery(".upload\_field").each(function(){var e=jQuery(this),t=(e.attr("page")!=="buddyforms\_submissions"),a=e.attr("file\_limit"),i=e.attr("accepted\_files"),l=e.attr("multiple\_files"),o=e.data("entry"),r=e.attr("form-slug");jQuery("#buddyforms\_form\_"+r).show();u(e,e.attr("id"),a,i,l,t,o)})};function u(e,t,i,n,u,r,a){var d=jQuery(e).find("input[type=\"text\"][style\*=\"hidden\"]"),b="#"+t;if(buddyformsGlobal){var m={url:buddyformsGlobal.admin\_url,maxFilesize:i,parallelUploads:1,acceptedFiles:n,maxFiles:u,clickable:r,addRemoveLinks:r,init:function(){this.on("queuecomplete",function(){e.removeClass("error")});this.on("addedfile",function(){s(b)});this.on("success",function(e,t){c(e,t,d)});this.on("error",f);this.on("sending",o);this.on("sendingmultiple",o);this.on("complete",l);this.on("completemultiple",l);this.on("removedfile",function(e){p(e,d)});if(a){for(var i in a){if(i){var t={name:a[i]["name"],size:a[i]["size"],url:a[i]["url"],attachment\_id:a[i]["attachment\_id"],};this.emit("addedfile",t);this.emit("thumbnail",t,t.url);this.emit("complete",t);this.files.push(t)}}}},dictMaxFilesExceeded:buddyformsGlobal.localize.upload.dictMaxFilesExceeded||"You can not upload any more files.",dictRemoveFile:buddyformsGlobal.localize.upload.dictRemoveFile||"Remove file",dictCancelUploadConfirmation:buddyformsGlobal.localize.upload.dictCancelUploadConfirmation||"Are you sure you want to cancel this upload?",dictCancelUpload:buddyformsGlobal.localize.upload.dictCancelUpload||"Cancel upload",dictResponseError:buddyformsGlobal.localize.upload.dictResponseError||"Server responded with {{statusCode}} code.",dictInvalidFileType:buddyformsGlobal.localize.upload.dictInvalidFileType||"You can't upload files of this type.",dictFileTooBig:buddyformsGlobal.localize.upload.dictFileTooBig||"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictFallbackMessage:buddyformsGlobal.localize.upload.dictFallbackMessage||"Your browser does not support drag'n'drop file uploads.",dictDefaultMessage:buddyformsGlobal.localize.upload.dictDefaultMessage||"Drop files here to upload",};jQuery(e).dropzone(m)}};function l(){a()};function s(e){jQuery(e).find("label[class\*='error']").text("");jQuery(e).find(".dz-progress").hide()};function o(e,t,a){r(!0);var i=jQuery("#form\_slug").val();a.append("action","handle\_dropped\_media");a.append("nonce",buddyformsGlobal.ajaxnonce);a.append("form\_slug",i)};function c(e,t,a){e.previewElement.classList.add("dz-success");e["attachment\_id"]=t;var i=jQuery(a).val()+","+t,l="";if(i[0]===","){l=i.substring(1,i.length)} |
  | 2 | 2 | else{l=i};jQuery(a).attr("value",l)};function f(e,t){e.previewElement.classList.add("dz-error");jQuery(e.previewElement).find("div.dz-error-message>span").text(t);a()};function p(e,a){var i=e.attachment\_id,l=jQuery(a).val(),t=l.replace(i,"");if(t[0]===","){t=t.substring(1,l.length)};var o=t[t.length-1];if(o===","){t=t.slice(0,-1)};jQuery(a).attr("value",t);m(i)};function m(e){r(!1);jQuery.post(buddyformsGlobal.admin\_url,{action:"handle\_deleted\_media",media\_id:e,nonce:buddyformsGlobal.ajaxnonce},function(e){console.log(e)}).always(function(){a()})};function r(a){if(buddyformsGlobal){if(e.length>0){a=!!(a);e.attr("disabled","disabled");if(a){t.html(buddyformsGlobal.localize.upload.submitButton||"Upload in progress")}}}};function b(){var e=!0;jQuery(".upload\_field").each(function(){var t=jQuery(this)[0].dropzone;if(t&&t.files.length>0){var a=t.files.filter(function(e){return e.status===Dropzone.UPLOADING});e=a.length===0}});return e};function a(){if(e.length>0&&b()){e.removeAttr("disabled");t.html(i)}};return{init:function(){var t=jQuery(".upload\_field");e=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=submit]");if(e.length>0){d(e)};if(t.length>0){n()}}}};function validateAndUploadImage(e){var l=jQuery(e),t=l.attr("field-id"),o=l.attr("accepted\_files");jQuery("#"+t+"\_label").text("");jQuery("#"+t+"\_image").attr("src","");jQuery("#field\_"+t).val("");var i=jQuery("#"+t+"\_upload\_from\_url").val();if(checkURL(i)){jQuery("#"+t+"\_upload\_button").text("Uploading..");jQuery("#"+t+"\_upload\_button").attr("disabled",!0);var a=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=button]");a.attr("disabled",!0);jQuery.ajax({url:buddyformsGlobal.admin\_url,type:"post",data:{action:"upload\_image\_from\_url",url:encodeURIComponent(i),accepted\_files:o,id:t},success:function(e){var i=JSON.parse(e);if(i.status==="OK"){jQuery("#"+t+"\_image").attr("src",i.response);jQuery("#"+t+"\_image").attr("width",300);jQuery("#"+t+"\_image").attr("height",300);jQuery("#field\_"+t).val(i.attachment\_id);jQuery("#"+t+"\_upload\_button").text("Upload");jQuery("#"+t+"\_upload\_button").attr("disabled",!1);a.attr("disabled",!1)} |
  | 3 | 3 | else{if(i.status==="FAILED"){jQuery("#"+t+"\_label").text(i.response);jQuery("#"+t+"\_upload\_button").text("Upload");jQuery("#"+t+"\_upload\_button").attr("disabled",!1);a.attr("disabled",!1)}}},error:function(e){var t=JSON.parse(e)}})} |
* ## [buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js](/changeset/3046092/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js?old=2442551&old_path=buddyforms%2Ftrunk%2Fassets%2Fresources%2Ffeatured-image%2Ffeatured-image-initializer.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js")

  | [r3031945](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js?rev=2442551#L55 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.js?rev=3046092#L55 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 |  |
  | 56 | 56 | this.on('sending', function (file, xhr, formData) { |
  |  | 57 | var form\_slug = jQuery('#form\_slug').val(); |
  | 57 | 58 | formData.append('action', 'handle\_dropped\_media'); |
  | 58 | 59 | formData.append('nonce', buddyformsGlobal.ajaxnonce); |
  |  | 60 | formData.append('form\_slug', form\_slug ); |
  | 59 | 61 | }); |
  | 60 | 62 |  |
* ## [buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js](/changeset/3046092/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js?old=2442551&old_path=buddyforms%2Ftrunk%2Fassets%2Fresources%2Ffeatured-image%2Ffeatured-image-initializer.min.js "Show the [3031945:3046092] differences restricted to buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js")

  | [r3031945](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js?rev=2442551#L1 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/assets/resources/featured-image/featured-image-initializer.min.js?rev=3046092#L1 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | ;jQuery(document).ready(function(){var e=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=button]"),o;if(e.length>0){o=jQuery.map(e,function(e){return(jQuery(e).attr("type")==="submit"&&jQuery(e).hasClass("bf-submit"))?jQuery(e):null})[0];var i=o.html()};jQuery(".featured-image-uploader").each(function(l,r){var a=jQuery(this),s=a.attr("id"),u=a.attr("max\_file\_size"),c=a.attr("page"),t=a.data("entry"),n=c!=="buddyforms\_submissions",d=jQuery("#field\_"+s);if(buddyformsGlobal){const dropzoneControl=a[0].dropzone;if(dropzoneControl){dropzoneControl.destroy()};var f=new Dropzone("div#"+s,{url:buddyformsGlobal.admin\_url,maxFilesize:u,acceptedFiles:"image/\*",maxFiles:1,clickable:n,addRemoveLinks:n,init:function(){this.on("complete",function(){if(e.length>0){e.removeAttr("disabled");o.html(i)}});this.on("addedfile",function(){jQuery("#field\_"+s+"-error").text("");if(this.files.length>1){this.removeFile(this.files[0])};if(e.length>0){e.attr("disabled","disabled");o.html(buddyformsGlobal.localize.upload.submitButton||"Upload in progress")}});this.on("sending",function(e,o,i){~~i.append("action","handle\_dropped\_media");i.append("nonce",buddyformsGlobal.ajaxnonce~~)});this.on("success",function(e,o){a.removeClass("error");e.previewElement.classList.add("dz-success");e["attachment\_id"]=o;var i=d.val()+","+o,l="";if(i[0]===","){l=i.substring(1,i.length)} |
  |  | 1 | ;jQuery(document).ready(function(){var e=jQuery("div.form-actions button.bf-submit[type=submit], div.form-actions button.bf-draft[type=button]"),o;if(e.length>0){o=jQuery.map(e,function(e){return(jQuery(e).attr("type")==="submit"&&jQuery(e).hasClass("bf-submit"))?jQuery(e):null})[0];var i=o.html()};jQuery(".featured-image-uploader").each(function(l,r){var a=jQuery(this),s=a.attr("id"),u=a.attr("max\_file\_size"),c=a.attr("page"),t=a.data("entry"),n=c!=="buddyforms\_submissions",d=jQuery("#field\_"+s);if(buddyformsGlobal){const dropzoneControl=a[0].dropzone;if(dropzoneControl){dropzoneControl.destroy()};var f=new Dropzone("div#"+s,{url:buddyformsGlobal.admin\_url,maxFilesize:u,acceptedFiles:"image/\*",maxFiles:1,clickable:n,addRemoveLinks:n,init:function(){this.on("complete",function(){if(e.length>0){e.removeAttr("disabled");o.html(i)}});this.on("addedfile",function(){jQuery("#field\_"+s+"-error").text("");if(this.files.length>1){this.removeFile(this.files[0])};if(e.length>0){e.attr("disabled","disabled");o.html(buddyformsGlobal.localize.upload.submitButton||"Upload in progress")}});this.on("sending",function(e,o,i){var l=jQuery("#form\_slug").val();i.append("action","handle\_dropped\_media");i.append("nonce",buddyformsGlobal.ajaxnonce);i.append("form\_slug",l)});this.on("success",function(e,o){a.removeClass("error");e.previewElement.classList.add("dz-success");e["attachment\_id"]=o;var i=d.val()+","+o,l="";if(i[0]===","){l=i.substring(1,i.length)} |
  | 2 | 2 | else{l=i};d.val(l)});this.on("error",function(l,a){l.previewElement.classList.add("dz-error");jQuery(l.previewElement).find("div.dz-error-message>span").text(a);if(e.length>0){e.removeAttr("disabled");o.html(i)}});this.on("removedfile",function(a){var t=a.attachment\_id,r=d.val(),l=r.replace(t,"");if(l[0]===","){l=l.substring(1,r.length)};var s=l[l.length-1];if(s===","){l=l.slice(0,-1)};d.val(l);e.attr("disabled","disabled");jQuery.post(buddyformsGlobal.admin\_url,{action:"handle\_deleted\_media",media\_id:t,nonce:buddyformsGlobal.ajaxnonce},function(e){console.log(e)}).always(function(){if(e.length>0){e.removeAttr("disabled");o.html(i)}})});if(t){for(var r in t){if(r){var l={name:t[r]["name"],size:t[r]["size"],url:t[r]["url"],attachment\_id:t[r]["attachment\_id"]};this.emit("addedfile",l);this.emit("thumbnail",l,l.url);this.emit("complete",l);this.files.push(l)}}}},dictMaxFilesExceeded:buddyformsGlobal.localize.upload.dictMaxFilesExceeded||"You can not upload any more files.",dictRemoveFile:buddyformsGlobal.localize.upload.dictRemoveFile||"Remove file",dictCancelUploadConfirmation:buddyformsGlobal.localize.upload.dictCancelUploadConfirmation||"Are you sure you want to cancel this upload?",dictCancelUpload:buddyformsGlobal.localize.upload.dictCancelUpload||"Cancel upload",dictResponseError:buddyformsGlobal.localize.upload.dictResponseError||"Server responded with {{statusCode}} code.",dictInvalidFileType:buddyformsGlobal.localize.upload.dictInvalidFileType||"You can't upload files of this type.",dictFileTooBig:buddyformsGlobal.localize.upload.dictFileTooBig||"File is too big ({{filesize}}MiB). Max filesize: {{maxFilesize}}MiB.",dictFallbackMessage:buddyformsGlobal.localize.upload.dictFallbackMessage||"Your browser does not support drag'n'drop file uploads.",dictDefaultMessage:buddyformsGlobal.localize.upload.dictDefaultMessage||"Drop files here to upload",})}})});if(Dropzone){Dropzone.autoDiscover=!1}; |
* ## [buddyforms/trunk/includes/admin/admin-ajax.php](/changeset/3046092/buddyforms/trunk/includes/admin/admin-ajax.php?old=2820257&old_path=buddyforms%2Ftrunk%2Fincludes%2Fadmin%2Fadmin-ajax.php "Show the [3031945:3046092] differences restricted to buddyforms/trunk/includes/admin/admin-ajax.php")

  | [r3031945](/browser/buddyforms/trunk/includes/admin/admin-ajax.php?rev=2820257#L80 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/includes/admin/admin-ajax.php?rev=3046092#L80 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 80 | 80 | function buddyforms\_new\_page() { |
  | 81 | 81 |  |
  | 82 |  | if ( ! is\_admin() ) { |
  |  | 82 | check\_ajax\_referer( 'fac\_drop', 'nonce' ); |
  |  | 83 |  |
  |  | 84 | if ( ! current\_user\_can( 'manage\_options' ) ) { |
  | 83 | 85 | return; |
  | 84 | 86 | } |
* ## [buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php](/changeset/3046092/buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php?old=2909864&old_path=buddyforms%2Ftrunk%2Fincludes%2Fadmin%2Fform-builder%2Fmeta-boxes%2Fmetabox-form-setup.php "Show the [3031945:3046092] differences restricted to buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php")

  | [r3031945](/browser/buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php?rev=2909864#L511 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/includes/admin/form-builder/meta-boxes/metabox-form-setup.php?rev=3046092#L511 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 511 | 511 | ?> |
  | 512 | 512 | <p class="description"><?php |
  | 513 |  | echo  wp\_kses( $field->getShortDesc(), buddyforms\_wp\_kses\_allowed\_atts() ) ; |
  |  | 513 | echo  $field->getShortDesc() ; |
  |  | 514 | // WPCS: XSS ok. |
  | 514 | 515 | ?></p> |
  | 515 | 516 | </td> |
* ## [buddyforms/trunk/includes/functions.php](/changeset/3046092/buddyforms/trunk/includes/functions.php?old=3023795&old_path=buddyforms%2Ftrunk%2Fincludes%2Ffunctions.php "Show the [3031945:3046092] differences restricted to buddyforms/trunk/includes/functions.php")

  | [r3031945](/browser/buddyforms/trunk/includes/functions.php?rev=3023795#L1467 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/includes/functions.php?rev=3046092#L1467 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 1467 | 1467 | { |
  | 1468 | 1468 | check\_ajax\_referer( 'fac\_drop', 'nonce' ); |
  | 1469 |  | status\_header( 200 ); |
  | 1470 |  | $newupload = 0; |
  | 1471 |  |  |
  | 1472 |  | if ( !empty($\_FILES) ) { |
  | 1473 |  | $files = $\_FILES; |
  | 1474 |  | foreach ( $files as $file\_id => $file ) { |
  | 1475 |  | $newupload = media\_handle\_upload( $file\_id, 0 ); |
  | 1476 |  | } |
  | 1477 |  | } |
  | 1478 |  |  |
  | 1479 |  |  |
  | 1480 |  | if ( is\_wp\_error( $newupload ) ) { |
  | 1481 |  | status\_header( '500' ); |
  | 1482 |  | echo  wp\_kses\_post( $newupload->get\_error\_message() ) ; |
  |  | 1469 | $form\_slug = ( isset( $\_POST['form\_slug'] ) ? sanitize\_text\_field( wp\_unslash( $\_POST['form\_slug'] ) ) : '' ); |
  |  | 1470 | $current\_user = wp\_get\_current\_user(); |
  |  | 1471 | $current\_user\_can\_edit = bf\_user\_can( |
  |  | 1472 | $current\_user->ID, |
  |  | 1473 | 'buddyforms\_' . $form\_slug . '\_edit', |
  |  | 1474 | array(), |
  |  | 1475 | $form\_slug |
  |  | 1476 | ); |
  |  | 1477 | $current\_user\_can\_create = bf\_user\_can( |
  |  | 1478 | $current\_user->ID, |
  |  | 1479 | 'buddyforms\_' . $form\_slug . '\_create', |
  |  | 1480 | array(), |
  |  | 1481 | $form\_slug |
  |  | 1482 | ); |
  |  | 1483 | $current\_user\_can\_draft = bf\_user\_can( |
  |  | 1484 | $current\_user->ID, |
  |  | 1485 | 'buddyforms\_' . $form\_slug . '\_draft', |
  |  | 1486 | array(), |
  |  | 1487 | $form\_slug |
  |  | 1488 | ); |
  |  | 1489 |  |
  |  | 1490 | if ( $current\_user\_can\_edit || $current\_user\_can\_create || $current\_user\_can\_draft ) { |
  |  | 1491 | status\_header( 200 ); |
  |  | 1492 | $newupload = 0; |
  |  | 1493 |  |
  |  | 1494 | if ( !empty($\_FILES) ) { |
  |  | 1495 | $files = $\_FILES; |
  |  | 1496 | foreach ( $files as $file\_id => $file ) { |
  |  | 1497 | $newupload = media\_handle\_upload( $file\_id, 0 ); |
  |  | 1498 | } |
  |  | 1499 | } |
  |  | 1500 |  |
  |  | 1501 |  |
  |  | 1502 | if ( is\_wp\_error( $newupload ) ) { |
  |  | 1503 | status\_header( '500' ); |
  |  | 1504 | echo  wp\_kses\_post( $newupload->get\_error\_message() ) ; |
  |  | 1505 | } else { |
  |  | 1506 | status\_header( '200' ); |
  |  | 1507 | echo  wp\_kses\_post( $newupload ) ; |
  |  | 1508 | } |
  |  | 1509 |  |
  |  | 1510 | die; |
  | 1483 | 1511 | } else { |
  | 1484 |  | status\_header( '200' ); |
  | 1485 |  | echo  wp\_kses\_post( $newupload ) ; |
  | 1486 |  | } |
  | 1487 |  |  |
  | 1488 |  | die; |
  |  | 1512 | die; |
  |  | 1513 | } |
  |  | 1514 |  |
  | 1489 | 1515 | } |
  | 1490 | 1516 |  |
  | […](/browser/buddyforms/trunk/includes/functions.php?rev=3023795#L1497) | […](/browser/buddyforms/trunk/includes/functions.php?rev=3046092#L1523) |  |
  | 1497 | 1523 | if ( isset( $\_REQUEST['media\_id'] ) ) { |
  | 1498 | 1524 | $post\_id = absint( $\_REQUEST['media\_id'] ); |
  | 1499 |  | $status = wp\_delete\_attachment( $post\_id, true ); |
  |  | 1525 | $post = get\_post( $post\_id ); |
  |  | 1526 | $current\_user = wp\_get\_current\_user(); |
  |  | 1527 |  |
  |  | 1528 | if ( $post->post\_author == $current\_user->ID ) { |
  |  | 1529 | $status = wp\_delete\_attachment( $post\_id, true ); |
  |  | 1530 | } else { |
  |  | 1531 | $status = false; |
  |  | 1532 | } |
  |  | 1533 |  |
  | 1500 | 1534 |  |
  | 1501 | 1535 | if ( $status ) { |
* ## [buddyforms/trunk/readme.txt](/changeset/3046092/buddyforms/trunk/readme.txt?old=3031945&old_path=buddyforms%2Ftrunk%2Freadme.txt "Show the [3031945:3046092] differences restricted to buddyforms/trunk/readme.txt")

  | [r3031945](/browser/buddyforms/trunk/readme.txt?rev=3031945#L4 "Show revision 3031945 of this file in browser") | [r3046092](/browser/buddyforms/trunk/readme.txt?rev=3046092#L4 "Show revision 3046092 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | Requires at least: 4.0 |
  | 5 | 5 | Tested up to: 6.4.3 |
  | 6 |  | Stable tag: 2.8.~~7~~ |
  |  | 6 | Stable tag: 2.8.8 |
  | 7 | 7 | Requires PHP: 5.3 |
  | 8 | 8 | License: GPLv2 |
  | […](/browser/buddyforms/trunk/readme.txt?rev=3031945#L265) | […](/browser/buddyforms/trunk/readme.txt?rev=3046092#L265) |  |
  | 265 | 265 |  |
  | 266 | 266 | == Changelog == |
  |  | 267 | = 2.8.8 - 06 Mar 2024 = |
  |  | 268 | \* Improved security. |
  |  | 269 | \* Fixed issue with creation of pages from submissions setup tab. |
  |  | 270 |  |
  | 267 | 271 | = 2.8.7 - 06 Feb 2024 = |
  | 268 | 272 | \* Added new hook to filter custom field value. |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3046092&old=3031945&new_path=%2Fbuddyforms%2Ftrunk&old_path=%2Fbuddyforms%2Ftrunk)
* [Zip Archive](?format=zip&new=3046092&old=3031945&new_path=%2Fbuddyforms%2Ftrunk&old_path=%2Fbuddyforms%2Ftrunk)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

