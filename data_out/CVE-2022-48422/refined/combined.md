=== Content from forum.onlyoffice.com_7725aa4e_20250108_130219.html ===


![ONLYOFFICE](data:image/svg;base64...)
Loading

[ONLYOFFICE](/)

# [Security hole - library from cwd](/t/security-hole-library-from-cwd/3302)

[Desktop editors](/c/desktop-editors/35)

[linux](https://forum.onlyoffice.com/tag/linux),
[bug](https://forum.onlyoffice.com/tag/bug)

[alef](https://forum.onlyoffice.com/u/alef)

13 December 2022 12:19

1

sorry, I write in my native language (translated with google)

desktop editor searches and tries to load libraries from several places, and the search in the current directory is performed earlier than in the traditional places where these libraries are located

for example, a piece of the strace log with loading the libgcc\_s.so.1 library

```

openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/converter/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/lib64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0\300-\0\0\0\0\0\0"..., 832) = 832
lseek(3, 92528, SEEK_SET)               = 92528
read(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32) = 32
fstat(3, {st_mode=S_IFREG|0755, st_size=99688, ...}) = 0
lseek(3, 92528, SEEK_SET)               = 92528
read(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32) = 32
mmap(NULL, 2192080, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7fe665268000
mprotect(0x7fe66527f000, 2093056, PROT_NONE) = 0
mmap(0x7fe66547e000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x16000) = 0x7fe66547e000
close(3)                                = 0

```

The penultimate line of openat shows that onlyoffice tries to load libgcc\_s.so.1 from the current directory, and then successfully picks it up from /lib64

An attacker can place his version of the libgcc\_s.so.1 library (not only this one - the full list can be taken from the strace log) next to any document and get it loaded and executed with the rights of the user who opened the document.

for example, I copied the libgcc\_s.so.1 library to the home directory of the test user and opened the document located there with onlyoffice.

strace output (partial):

```

openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/converter/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "/opt/onlyoffice/desktopeditors/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "tls/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "x86_64/libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = -1 ENOENT (No such file or directory)
openat(AT_FDCWD, "libgcc_s.so.1", O_RDONLY|O_CLOEXEC) = 3
read(3, "\177ELF\2\1\1\0\0\0\0\0\0\0\0\0\3\0>\0\1\0\0\0\300-\0\0\0\0\0\0"..., 832) = 832
lseek(3, 92528, SEEK_SET)               = 92528
read(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32) = 32
fstat(3, {st_mode=S_IFREG|0755, st_size=99688, ...}) = 0
getcwd("/home/test", 128)               = 11
lseek(3, 92528, SEEK_SET)               = 92528
read(3, "\4\0\0\0\20\0\0\0\5\0\0\0GNU\0\2\0\0\300\4\0\0\0\3\0\0\0\0\0\0\0", 32) = 32
mmap(NULL, 2192080, PROT_READ|PROT_EXEC, MAP_PRIVATE|MAP_DENYWRITE, 3, 0) = 0x7ff863223000
mprotect(0x7ff86323a000, 2093056, PROT_NONE) = 0
mmap(0x7ff863439000, 8192, PROT_READ|PROT_WRITE, MAP_PRIVATE|MAP_FIXED|MAP_DENYWRITE, 3, 0x16000) = 0x7ff863439000
close(3)                                = 0

```

lsof output:

```
$ lsof +d ~
COMMAND      PID USER   FD   TYPE DEVICE SIZE/OFF    NODE NAME
pipewire  128360 test  cwd    DIR    8,3     4096 6688047 /home/test
dbus-brok 128397 test  cwd    DIR    8,3     4096 6688047 /home/test
dbus-brok 128398 test  cwd    DIR    8,3     4096 6688047 /home/test
pipewire- 128399 test  cwd    DIR    8,3     4096 6688047 /home/test
gvfsd     128451 test  cwd    DIR    8,3     4096 6688047 /home/test
bash      128566 test  cwd    DIR    8,3     4096 6688047 /home/test
DesktopEd 128828 test  cwd    DIR    8,3     4096 6688047 /home/test
DesktopEd 128828 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
editors_h 128834 test  cwd    DIR    8,3     4096 6688047 /home/test
editors_h 128834 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
editors_h 128844 test  cwd    DIR    8,3     4096 6688047 /home/test
editors_h 128844 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
editors_h 128854 test  cwd    DIR    8,3     4096 6688047 /home/test
editors_h 128854 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
editors_h 128856 test  cwd    DIR    8,3     4096 6688047 /home/test
editors_h 128856 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
editors_h 128889 test  cwd    DIR    8,3     4096 6688047 /home/test
editors_h 128889 test  mem    REG    8,3    99688 6688226 /home/test/libgcc_s.so.1
lsof      128901 test  cwd    DIR    8,3     4096 6688047 /home/test
lsof      128902 test  cwd    DIR    8,3     4096 6688047 /home/test

```

[Constantine](https://forum.onlyoffice.com/u/Constantine)

15 December 2022 09:23

2

Hello [@alef](/u/alef)

Thanks for reporting this scenario.

Our team is analyzing it.

Some of the content was hidden in terms of safety.

[Constantine](https://forum.onlyoffice.com/u/Constantine)

19 December 2022 14:36

4

Based on this scenario we have created bug report number 60244.

Thank you very much for contributing to the security of our editors.

1 Like

[alef](https://forum.onlyoffice.com/u/alef)

23 January 2023 04:27

6

Good afternoon, it’s been a month already - it’s time for me to register CVE

[Constantine](https://forum.onlyoffice.com/u/Constantine)

23 January 2023 08:36

7

Hello again [@alef](/u/alef)

Security is the prior aim for us.

This bug is a major task and our team is working hard on fixing this issue as soon as possible.

[alef](https://forum.onlyoffice.com/u/alef)

15 April 2023 17:23

8

hi. it’s a simple trojan horse

content of file **evil.c**:

`Was hidden`

content of file **vers**:

`Was hidden`

compile with the following command:

`Was hidden`

put the **libselinux.so.1** library next to the document and check (in the console):

`Was hidden`

[Constantine](https://forum.onlyoffice.com/u/Constantine)

17 April 2023 10:21

9

Hello [@alef](/u/alef)

Again thank you very much for the report.

We are checking the situation with that. I will let you know when any results come up.

> Some of the content was hidden in terms of safety.

In addition, please specify on which version of Desktop Editors this vulnerability can be used. Is it the actual version 7.3.3?

[alef](https://forum.onlyoffice.com/u/alef)

19 April 2023 18:11

11

Good afternoon. Judging by the commit KOROL dated 02/23/2023, you are on the right track. Tomorrow I will install version 7.3.3 and write the results of the check

[Constantine](https://forum.onlyoffice.com/u/Constantine)

20 April 2023 08:04

12

Hello [@alef](/u/alef)

Gladly waiting for your results.

[alef](https://forum.onlyoffice.com/u/alef)

20 April 2023 09:09

13

Hello. It’s ok, I checked

[Constantine](https://forum.onlyoffice.com/u/Constantine)

20 April 2023 09:14

14

I’m sorry but does it meant that the trojan horse is not executable on the actual version?

Apologies if I misunderstand.

[alef](https://forum.onlyoffice.com/u/alef)

20 April 2023 11:55

15

I confirm that the trojan does not work ![:slight_smile:](https://forum.onlyoffice.com/images/emoji/twitter/slight_smile.png?v=10 ":slight_smile:")

[Constantine](https://forum.onlyoffice.com/u/Constantine)

20 April 2023 12:07

16

Thank you for the confirmation, I’m glad to hear that it doesn’t.

* [Home](/)
* [Categories](/categories)
* [FAQ/Guidelines](/guidelines)
* [Terms of Service](https://help.onlyoffice.com/Products/Files/doceditor.aspx?fileid=6615734&doc=cy9XcGc5TXNONjVTMkNrR2NZUEVTT2E1Y1FDZGVRQ1YvOTJYTnpkZ3JEWT0_IjY2MTU3MzQi0)
* [Privacy Policy](https://help.onlyoffice.com/products/files/doceditor.aspx?fileid=5048502&doc=SXhWMEVzSEYxNlVVaXJJeUVtS0kyYk14YWdXTEFUQmRWL250NllHNUFGbz0_IjUwNDg1MDIi0&_ga=2.101739969.1105072466.1587625676-1002786878.1584771261)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

[**ONLYOFFICE DocSpace 3.0 released:** Updated user types•Virtual Data rooms•
OAuth2.0•Improved room & File management•and more](https://www.onlyoffice.com/blog/2024/11/onlyoffice-docspace-3-0-released)
[ONLYOFFICE DocSpace 3.0 released](https://www.onlyoffice.com/blog/2024/11/onlyoffice-docspace-3-0-released)


