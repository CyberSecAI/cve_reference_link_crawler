

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-5024)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-5024)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-5024](/browse/XWIKI-5024)

# A user without PR right can save a document which will have PR

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-5024 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/critical.svg "Critical - Crashes, loss of data, severe memory leak.") Critical
* **Fix Version/s:**
  [13.0](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+13.0 "13.0 ")
* **Affects Version/s:**
  2.2.2
* **Component/s:**
  [Old Core](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Old+Core%22 "Old Core ")
* **Labels:**
  + [attack\_impersonation](/issues/?jql=labels+%3D+attack_impersonation "attack_impersonation")
  + [attacker\_script](/issues/?jql=labels+%3D+attacker_script "attacker_script")
  + [bugfixingday](/issues/?jql=labels+%3D+bugfixingday "bugfixingday")
  + [security](/issues/?jql=labels+%3D+security "security")

* **keywords:**
  security
* **Development Priority:**
  Low
* **Difficulty:**
  Hard
* **Documentation:**
  <https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-f4cj-3q3h-884r>
* **Documentation in Release Notes:**
  <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/13.0/#HAuthorrightisnowimportantwhensaving>
* **Similar issues:**

#### Description

This is a major and very old security flaw.

A Velocity script, even written by guest in a comment, could be later executed with the access rights of a priviledged user (apart from the programming rights, but this could be gained later).

If an XWiki administrator look at

* the comment of an anonymous user,
* a page written by a simple user
* a rendered textarea field
* a user panels
* in fact, anything rendered from a user input...

the Velocity script is executed with all the access rights of this administrator.

The causes is that all access rights are always checked against the context.user, not against the user that have written the script (the only right the script will not have is the programming right, until the context.doc is content authored by an administrator).

Without programming rigths (PR), the API currently allows to view, create and overwrite any documents with the right access of the viewer and authoring as the viewer (api.XWiki#getDocument() and api.Document#save()).

Saving a document is the worse, since with something like this:

```
{{velocity}}
#set($docname="AnySpace.AnyDocs")
#set($newdoc=$xwiki.getDocument($docname))
$newdoc.setContent('{{velocity}}$xwiki.XWiki.evilcode{{/velocity}}')
$newdoc.save()
{{/velocity}}
{{include document="AnySpace.AnyDocs"/}}

```

you may event create and execute scripts that has Programming Rights, since the content author of the created document could be a viewer having programming rights !

Now be really careful next time you logs in with Programming Rights, you may loose control... ![](/images/icons/emoticons/smile.png)

#### Attachments

#### Issue Links

depends on

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-18222](/browse/XWIKI-18222)
Administration sections are not executed with the right of their author

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

is duplicated by

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-7903](/browse/XWIKI-7903)
PR leak in Document#save() when current user has PR

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

#### Activity

#### People

Assignee:

![tmortagne](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Thomas Mortagne

Reporter:

![softec](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Denis Gervalle

Votes:
0
Vote for this issue

Watchers:
3
Start watching this issue

#### Dates

Created:

18/Mar/10 18:19

Updated:

07/Jul/22 11:30

Resolved:

31/Dec/20 15:16

Date of First Response:

18/Mar/10 6:47 PM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

