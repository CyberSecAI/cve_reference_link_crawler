
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgreenpau%2Fcaddy-security%2Fissues%2F265)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgreenpau%2Fcaddy-security%2Fissues%2F265)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=greenpau%2Fcaddy-security)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[greenpau](/greenpau)
/
**[caddy-security](/greenpau/caddy-security)**
Public

* [Notifications](/login?return_to=%2Fgreenpau%2Fcaddy-security) You must be signed in to change notification settings
* [Fork
  75](/login?return_to=%2Fgreenpau%2Fcaddy-security)
* [Star
   1.6k](/login?return_to=%2Fgreenpau%2Fcaddy-security)

* [Code](/greenpau/caddy-security)
* [Issues
  167](/greenpau/caddy-security/issues)
* [Pull requests
  2](/greenpau/caddy-security/pulls)
* [Actions](/greenpau/caddy-security/actions)
* [Security](/greenpau/caddy-security/security)
* [Insights](/greenpau/caddy-security/pulse)

Additional navigation options

* [Code](/greenpau/caddy-security)
* [Issues](/greenpau/caddy-security/issues)
* [Pull requests](/greenpau/caddy-security/pulls)
* [Actions](/greenpau/caddy-security/actions)
* [Security](/greenpau/caddy-security/security)
* [Insights](/greenpau/caddy-security/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fgreenpau%2Fcaddy-security%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fgreenpau%2Fcaddy-security%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Insecure Randomness #265

Closed

[ahpaleus](/ahpaleus) opened this issue
Sep 19, 2023
¬∑ 6 comments

Closed

# [Insecure Randomness](#top) #265

[ahpaleus](/ahpaleus) opened this issue
Sep 19, 2023
¬∑ 6 comments

Assignees
[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&v=4)](/greenpau)

Labels
[security](/greenpau/caddy-security/labels/security)

## Comments

[![@ahpaleus](https://avatars.githubusercontent.com/u/38883201?s=80&u=c796cd02e1b2615a0544402c430e580a3d5ff760&v=4)](/ahpaleus)

Copy link

### **[ahpaleus](/ahpaleus)** commented [Sep 19, 2023](#issue-1902581538)

| *Severity: High*  The caddy-security plugin uses the math/rand Golang library with a seed based on the Unix timestamp to generate strings for three security-critical contexts in the application, which could possibly be predicted via a brute-force search. Attackers could use the potentially predictable nonce value used for authentication purposes in the OAuth flow to conduct OAuth replay attacks. In addition, insecure randomness is used while generating multifactor authentication (MFA) secrets and creating API keys in the database package.   * <https://github.com/greenpau/go-authcrunch/blob/a6e434247876ad0b01940ac2947f17ca32a714bf/pkg/idp/oauth/authenticate.go#L204-L204> * <https://github.com/greenpau/go-authcrunch/blob/a6e434247876ad0b01940ac2947f17ca32a714bf/pkg/authn/handle_http_login.go#L193-L193>   To immediately mitigate this vulnerability, use a cryptographically secure random number generator for generating the random strings. Golang‚Äôs library crypto/rand is designed for secure random number generation.  In addition to that fix, we recommend considering the following long-term recommendations:   * Review the application for other instances where the math/rand package is used for secure context. Create secure wrapping functions and use them throughout the code to serve a cryptographically secure string with the requested length. * Avoid duplicating code. Having a single function, such as secureRandomString, rather than multiple duplicate functions makes it easier to audit and verify the system‚Äôs security. It also prevents future changes to the codebase from reintroducing issues. * Implement Semgrep in the CI/CD. The math-random-used Semgrep rule will catch instances where math/rand is used. Refer to our [Testing Handbook on Semgrep](https://appsec.guide/docs/static-analysis/semgrep/) for more information. * Read textbooks such as Real World Cryptography, as it is a great resource for practical cryptographic considerations.   More information about our public disclosure:   * <https://blog.trailofbits.com/2023/09/18/security-flaws-in-an-sso-plugin-for-caddy/> |
| --- |
| The text was updated successfully, but these errors were encountered: |

 ‚ù§Ô∏è
1
 ptman reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

[![@st3fan](https://avatars.githubusercontent.com/u/28052?s=80&u=9179ebbd67123d4b696e961d6cdf787165f80713&v=4)](/st3fan)

Copy link

### **[st3fan](/st3fan)** commented [Sep 21, 2023](#issuecomment-1728638353)

| [@greenpau](https://github.com/greenpau) let me know if you accept contributions for this issue. I was reading the `util` code in `go-authcrunch` and I think it is relatively simple to convert it to use `crypto/rand` instead. I'm happy to give that a shot. |
| --- |

All reactions

Sorry, something went wrong.

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=80&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)

Copy link

Owner

### **[greenpau](/greenpau)** commented [Sep 21, 2023](#issuecomment-1728683231)

| [@st3fan](https://github.com/st3fan) , please do! üòÑ thank you for the offer! |
| --- |

All reactions

Sorry, something went wrong.

[![@gedw99](https://avatars.githubusercontent.com/u/53147028?s=80&v=4)](/gedw99)

Copy link

### **[gedw99](/gedw99)** commented [Nov 9, 2023](#issuecomment-1803994994)

| Thos looks like a simple fix. Is anyone working on it ? |
| --- |

All reactions

Sorry, something went wrong.

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=80&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)

Copy link

Owner

### **[greenpau](/greenpau)** commented [Nov 9, 2023](#issuecomment-1804347879)

| [@gedw99](https://github.com/gedw99) , feel free to contribute! |
| --- |

All reactions

Sorry, something went wrong.

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)
[greenpau](/greenpau)
self-assigned this
[Dec 2, 2023](#event-11129113481)

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)
[greenpau](/greenpau)
added
the
[security](/greenpau/caddy-security/labels/security)
label
[Dec 2, 2023](#event-11129113725)

[greenpau](/greenpau)
added a commit
to greenpau/go-authcrunch
that referenced
this issue
[Dec 2, 2023](#ref-commit-ecd3725)
[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)

`[security: addresses insecure randomness finding](/greenpau/go-authcrunch/commit/ecd3725baf2683eb1519bb3c81ae41085fbf7dc2 "security: addresses insecure randomness finding

See also: https://github.com/greenpau/caddy-security/issues/265")`
‚Ä¶

`[ecd3725](/greenpau/go-authcrunch/commit/ecd3725baf2683eb1519bb3c81ae41085fbf7dc2)`

```
See also: [greenpau/caddy-security#265](https://github.com/greenpau/caddy-security/issues/265)
```

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=80&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)

Copy link

Owner

### **[greenpau](/greenpau)** commented [Dec 2, 2023](#issuecomment-1837197472)

| [@ahpaleus](https://github.com/ahpaleus) , please see if the fix addresses your concerns. |
| --- |

All reactions

Sorry, something went wrong.

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=80&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)

Copy link

Owner

### **[greenpau](/greenpau)** commented [Dec 9, 2023](#issuecomment-1848429031)

| No activity. Closing. |
| --- |

All reactions

Sorry, something went wrong.

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&u=d4ea13bb3b14f67228e14cb058ba72f1f900979d&v=4)](/greenpau)
[greenpau](/greenpau)
closed this as [completed](/greenpau/caddy-security/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Dec 9, 2023](#event-11200712825)

[![@GoVulnBot](https://avatars.githubusercontent.com/u/96493708?s=40&v=4)](/GoVulnBot)
[GoVulnBot](/GoVulnBot)
mentioned this issue
[Feb 17, 2024](#ref-issue-2139867322)

[x/vulndb: potential Go vuln in github.com/greenpau/caddy-security: CVE-2024-21495
golang/vulndb#2565](/golang/vulndb/issues/2565)

Closed

[![@FiloSottile](https://avatars.githubusercontent.com/u/1225294?s=40&v=4)](/FiloSottile)
[FiloSottile](/FiloSottile)
mentioned this issue
[Apr 26, 2024](#ref-issue-2265495604)

[crypto/rand: add func Text
golang/go#67057](/golang/go/issues/67057)

Closed

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fgreenpau%2Fcaddy-security%2Fissues%2F265)

Assignees

[![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=40&v=4)](/greenpau) [greenpau](/greenpau)

Labels

[security](/greenpau/caddy-security/labels/security)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@st3fan](https://avatars.githubusercontent.com/u/28052?s=52&v=4)](/st3fan) [![@greenpau](https://avatars.githubusercontent.com/u/3826416?s=52&v=4)](/greenpau) [![@ahpaleus](https://avatars.githubusercontent.com/u/38883201?s=52&v=4)](/ahpaleus) [![@gedw99](https://avatars.githubusercontent.com/u/53147028?s=52&v=4)](/gedw99)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

