=== Content from lists.debian.org_d2f6bdd6_20250108_143702.html ===


---

[[Date Prev](msg00009.html)][[Date Next](msg00011.html)]
[[Thread Prev](msg00009.html)][[Thread Next](msg00011.html)]
[[Date Index](maillist.html#00010)]
[[Thread Index](threads.html#00010)]

# [SECURITY] [DLA 2785-1] linux-4.19 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 2785-1] linux-4.19 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Fri, 15 Oct 2021 23:50:44 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/YWn3tOip6kKWRy1f%40decadent.org.uk)Â [YWn3tOip6kKWRy1f@decadent.org.uk](msg00010.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-2785-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
October 15, 2021                              <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-4.19
Version        : 4.19.208-1~deb9u1
CVE ID         : CVE-2020-3702 CVE-2020-16119 CVE-2021-3444 CVE-2021-3600
                 CVE-2021-3612 CVE-2021-3653 CVE-2021-3655 CVE-2021-3656
                 CVE-2021-3679 CVE-2021-3732 CVE-2021-3743 CVE-2021-3753
                 CVE-2021-22543 CVE-2021-33624 CVE-2021-34556 CVE-2021-35039
                 CVE-2021-35477 CVE-2021-37159 CVE-2021-38160 CVE-2021-38198
                 CVE-2021-38199 CVE-2021-38205 CVE-2021-40490

Several vulnerabilities have been discovered in the Linux kernel that
may lead to a privilege escalation, denial of service or information
leaks.

CVE-2020-3702

    A flaw was found in the driver for Atheros IEEE 802.11n family of
    chipsets (ath9k) allowing information disclosure.

CVE-2020-16119

    Hadar Manor reported a use-after-free in the DCCP protocol
    implementation in the Linux kernel. A local attacker can take
    advantage of this flaw to cause a denial of service or potentially
    to execute arbitrary code.

CVE-2021-3444, CVE-2021-3600

    Two flaws were discovered in the Extended BPF (eBPF) verifier.  A
    local user could exploit these to read and write arbitrary memory
    in the kernel, which could be used for privilege escalation.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-3612

    Murray McAllister reported a flaw in the joystick input subsystem.
    A local user permitted to access a joystick device could exploit
    this to read and write out-of-bounds in the kernel, which could
    be used for privilege escalation.

CVE-2021-3653

   Maxim Levitsky discovered a vulnerability in the KVM hypervisor
   implementation for AMD processors in the Linux kernel: Missing
   validation of the `int_ctl` VMCB field could allow a malicious L1
   guest to enable AVIC support (Advanced Virtual Interrupt
   Controller) for the L2 guest. The L2 guest can take advantage of
   this flaw to write to a limited but still relatively large subset
   of the host physical memory.

CVE-2021-3655

    Ilja Van Sprundel and Marcelo Ricardo Leitner found multiple flaws
    in the SCTP implementation, where missing validation could lead to
    an out-of-bounds read.  On a system using SCTP, a networked
    attacker could exploit these to cause a denial of service (crash).

CVE-2021-3656

    Maxim Levitsky and Paolo Bonzini discovered a flaw in the KVM
    hypervisor implementation for AMD processors in the Linux
    kernel. Missing validation of the `virt_ext` VMCB field could
    allow a malicious L1 guest to disable both VMLOAD/VMSAVE
    intercepts and VLS (Virtual VMLOAD/VMSAVE) for the L2 guest. Under
    these circumstances, the L2 guest is able to run VMLOAD/VMSAVE
    unintercepted and thus read/write portions of the host's physical
    memory.

CVE-2021-3679

    A flaw in the Linux kernel tracing module functionality could
    allow a privileged local user (with CAP_SYS_ADMIN capability) to
    cause a denial of service (resource starvation).

CVE-2021-3732

    Alois Wohlschlager reported a flaw in the implementation of the
    overlayfs subsystem, allowing a local attacker with privileges to
    mount a filesystem to reveal files hidden in the original mount.

CVE-2021-3743

    An out-of-bounds memory read was discovered in the Qualcomm IPC
    router protocol implementation, allowing to cause a denial of
    service or information leak.

CVE-2021-3753

    Minh Yuan reported a race condition in the vt_k_ioctl in
    drivers/tty/vt/vt_ioctl.c, which may cause an out of bounds read
    in vt.

CVE-2021-22543

    David Stevens discovered a flaw in how the KVM hypervisor maps
    host memory into a guest.  A local user permitted to access
    /dev/kvm could use this to cause certain pages to be freed when
    they should not, leading to a use-after-free.  This could be used
    to cause a denial of service (crash or memory corruption) or
    possibly for privilege escalation.

CVE-2021-33624, CVE-2021-34556, CVE-2021-35477

    Multiple researchers discovered flaws in the Extended BPF (eBPF)
    verifier's protections against information leaks through
    speculation execution.  A local user could exploit these to read
    sensitive information.

    This can be mitigated by setting sysctl
    kernel.unprivileged_bpf_disabled=1, which disables eBPF use by
    unprivileged users.

CVE-2021-35039

    A flaw was discovered in module signature enforcement.  A custom
    kernel with IMA enabled might have allowed loading unsigned kernel
    modules when it should not have.

CVE-2021-37159

    A flaw was discovered in the hso driver for Option mobile
    broadband modems.  An error during initialisation could lead to a
    double-free or use-after-free.  An attacker able to plug in USB
    devices could use this to cause a denial of service (crash or
    memory corruption) or possibly to run arbitrary code.

CVE-2021-38160

    A flaw in the virtio_console was discovered allowing data
    corruption or data loss by an untrusted device.

CVE-2021-38198

    A flaw was discovered in the KVM implementation for x86
    processors, that could result in virtual memory protection within
    a guest not being applied correctly.  When shadow page tables are
    used - i.e. for nested virtualisation, or on CPUs lacking the EPT
    or NPT feature - a user of the guest OS might be able to exploit
    this for denial of service or privilege escalation within the
    guest.

CVE-2021-38199

    Michael Wakabayashi reported a flaw in the NFSv4 client
    implementation, where incorrect connection setup ordering allows
    operations of a remote NFSv4 server to cause a denial of service.

CVE-2021-38205

    An information leak was discovered in the xilinx_emaclite network
    driver.  On a custom kernel where this driver is enabled and used,
    this might make it easier to exploit other kernel bugs.

CVE-2021-40490

    A race condition was discovered in the ext4 subsystem when writing
    to an inline_data file while its xattrs are changing. This could
    result in denial of service.

For Debian 9 stretch, these problems have been fixed in version
4.19.208-1~deb9u1.

We recommend that you upgrade your linux-4.19 packages.

For the detailed security status of linux-4.19 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-4.19>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

--
Ben Hutchings
The generation of random numbers is too important to be left to chance.
                                                       - Robert Coveyou

```

**Attachment:
[signature.asc](pgp6E6YCV4Roe.pgp)**

*Description:* PGP signature

---



=== Content from github.com_5a9928b8_20250108_143702.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9183671af6dbf60a1219371d4ed73e23f43b49db)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9183671af6dbf60a1219371d4ed73e23f43b49db)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=torvalds%2Flinux)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[torvalds](/torvalds)
/
**[linux](/torvalds/linux)**
Public

* [Notifications](/login?return_to=%2Ftorvalds%2Flinux) You must be signed in to change notification settings
* [Fork
  54.7k](/login?return_to=%2Ftorvalds%2Flinux)
* [Star
   186k](/login?return_to=%2Ftorvalds%2Flinux)

* [Code](/torvalds/linux)
* [Pull requests
  434](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects
  0](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

Additional navigation options

* [Code](/torvalds/linux)
* [Pull requests](/torvalds/linux/pulls)
* [Actions](/torvalds/linux/actions)
* [Projects](/torvalds/linux/projects)
* [Security](/torvalds/linux/security)
* [Insights](/torvalds/linux/pulse)

## Commit

[Permalink](/torvalds/linux/commit/9183671af6dbf60a1219371d4ed73e23f43b49db)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

bpf: Fix leakage under speculation on mispredicted branches

[Browse files](/torvalds/linux/tree/9183671af6dbf60a1219371d4ed73e23f43b49db)
Browse the repository at this point in the history

```
The verifier only enumerates valid control-flow paths and skips paths that
are unreachable in the non-speculative domain. And so it can miss issues
under speculative execution on mispredicted branches.

For example, a type confusion has been demonstrated with the following
crafted program:

  // r0 = pointer to a map array entry
  // r6 = pointer to readable stack slot
  // r9 = scalar controlled by attacker
  1: r0 = *(u64 *)(r0) // cache miss
  2: if r0 != 0x0 goto line 4
  3: r6 = r9
  4: if r0 != 0x1 goto line 6
  5: r9 = *(u8 *)(r6)
  6: // leak r9

Since line 3 runs iff r0 == 0 and line 5 runs iff r0 == 1, the verifier
concludes that the pointer dereference on line 5 is safe. But: if the
attacker trains both the branches to fall-through, such that the following
is speculatively executed ...

  r6 = r9
  r9 = *(u8 *)(r6)
  // leak r9

... then the program will dereference an attacker-controlled value and could
leak its content under speculative execution via side-channel. This requires
to mistrain the branch predictor, which can be rather tricky, because the
branches are mutually exclusive. However such training can be done at
congruent addresses in user space using different branches that are not
mutually exclusive. That is, by training branches in user space ...

  A:  if r0 != 0x0 goto line C
  B:  ...
  C:  if r0 != 0x0 goto line D
  D:  ...

... such that addresses A and C collide to the same CPU branch prediction
entries in the PHT (pattern history table) as those of the BPF program's
lines 2 and 4, respectively. A non-privileged attacker could simply brute
force such collisions in the PHT until observing the attack succeeding.

Alternative methods to mistrain the branch predictor are also possible that
avoid brute forcing the collisions in the PHT. A reliable attack has been
demonstrated, for example, using the following crafted program:

  // r0 = pointer to a [control] map array entry
  // r7 = *(u64 *)(r0 + 0), training/attack phase
  // r8 = *(u64 *)(r0 + 8), oob address
  // [...]
  // r0 = pointer to a [data] map array entry
  1: if r7 == 0x3 goto line 3
  2: r8 = r0
  // crafted sequence of conditional jumps to separate the conditional
  // branch in line 193 from the current execution flow
  3: if r0 != 0x0 goto line 5
  4: if r0 == 0x0 goto exit
  5: if r0 != 0x0 goto line 7
  6: if r0 == 0x0 goto exit
  [...]
  187: if r0 != 0x0 goto line 189
  188: if r0 == 0x0 goto exit
  // load any slowly-loaded value (due to cache miss in phase 3) ...
  189: r3 = *(u64 *)(r0 + 0x1200)
  // ... and turn it into known zero for verifier, while preserving slowly-
  // loaded dependency when executing:
  190: r3 &= 1
  191: r3 &= 2
  // speculatively bypassed phase dependency
  192: r7 += r3
  193: if r7 == 0x3 goto exit
  194: r4 = *(u8 *)(r8 + 0)
  // leak r4

As can be seen, in training phase (phase != 0x3), the condition in line 1
turns into false and therefore r8 with the oob address is overridden with
the valid map value address, which in line 194 we can read out without
issues. However, in attack phase, line 2 is skipped, and due to the cache
miss in line 189 where the map value is (zeroed and later) added to the
phase register, the condition in line 193 takes the fall-through path due
to prior branch predictor training, where under speculation, it'll load the
byte at oob address r8 (unknown scalar type at that point) which could then
be leaked via side-channel.

One way to mitigate these is to 'branch off' an unreachable path, meaning,
the current verification path keeps following the is_branch_taken() path
and we push the other branch to the verification stack. Given this is
unreachable from the non-speculative domain, this branch's vstate is
explicitly marked as speculative. This is needed for two reasons: i) if
this path is solely seen from speculative execution, then we later on still
want the dead code elimination to kick in in order to sanitize these
instructions with jmp-1s, and ii) to ensure that paths walked in the
non-speculative domain are not pruned from earlier walks of paths walked in
the speculative domain. Additionally, for robustness, we mark the registers
which have been part of the conditional as unknown in the speculative path
given there should be no assumptions made on their content.

The fix in here mitigates type confusion attacks described earlier due to
i) all code paths in the BPF program being explored and ii) existing
verifier logic already ensuring that given memory access instruction
references one specific data structure.

An alternative to this fix that has also been looked at in this scope was to
mark aux->alu_state at the jump instruction with a BPF_JMP_TAKEN state as
well as direction encoding (always-goto, always-fallthrough, unknown), such
that mixing of different always-* directions themselves as well as mixing of
always-* with unknown directions would cause a program rejection by the
verifier, e.g. programs with constructs like 'if ([...]) { x = 0; } else
{ x = 1; }' with subsequent 'if (x == 1) { [...] }'. For unprivileged, this
would result in only single direction always-* taken paths, and unknown taken
paths being allowed, such that the former could be patched from a conditional
jump to an unconditional jump (ja). Compared to this approach here, it would
have two downsides: i) valid programs that otherwise are not performing any
pointer arithmetic, etc, would potentially be rejected/broken, and ii) we are
required to turn off path pruning for unprivileged, where both can be avoided
in this work through pushing the invalid branch to the verification stack.

The issue was originally discovered by Adam and Ofek, and later independently
discovered and reported as a result of Benedict and Piotr's research work.

Fixes: [b215739](https://github.com/torvalds/linux/commit/b2157399cc9898260d6031c5bfe45fe137c1fbe7) ("bpf: prevent out-of-bounds speculation")
Reported-by: Adam Morrison <mad@cs.tau.ac.il>
Reported-by: Ofek Kirzner <ofekkir@gmail.com>
Reported-by: Benedict Schlueter <benedict.schlueter@rub.de>
Reported-by: Piotr Krysiuk <piotras@gmail.com>
Signed-off-by: Daniel Borkmann <daniel@iogearbox.net>
Reviewed-by: John Fastabend <john.fastabend@gmail.com>
Reviewed-by: Benedict Schlueter <benedict.schlueter@rub.de>
Reviewed-by: Piotr Krysiuk <piotras@gmail.com>
Acked-by: Alexei Starovoitov <ast@kernel.org>
```

* Loading branch information

[![@borkmann](https://avatars.githubusercontent.com/u/677393?s=40&v=4)](/borkmann)

[borkmann](/torvalds/linux/commits?author=borkmann "View all commits by borkmann")
committed
Jun 14, 2021

1 parent
[fe9a5ca](/torvalds/linux/commit/fe9a5ca7e370e613a9a75a13008a3845ea759d6e)

commit 9183671

Showing
**1 changed file**
with
**40 additions**
and
**4 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

44 changes: 40 additions & 4 deletions

44
[kernel/bpf/verifier.c](#diff-edbb57adf10d1ce1fbb830a34fa92712fd01db1fbd9b6f2504001eb7bcc7b9d0 "kernel/bpf/verifier.c")

Show comments

[View file](/torvalds/linux/blob/9183671af6dbf60a1219371d4ed73e23f43b49db/kernel/bpf/verifier.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6483,6 +6483,27 @@ struct bpf\_sanitize\_info { |
|  |  | bool mask\_to\_left; |
|  |  | }; |
|  |  |  |
|  |  | static struct bpf\_verifier\_state \* |
|  |  | sanitize\_speculative\_path(struct bpf\_verifier\_env \*env, |
|  |  | const struct bpf\_insn \*insn, |
|  |  | u32 next\_idx, u32 curr\_idx) |
|  |  | { |
|  |  | struct bpf\_verifier\_state \*branch; |
|  |  | struct bpf\_reg\_state \*regs; |
|  |  |  |
|  |  | branch = push\_stack(env, next\_idx, curr\_idx, true); |
|  |  | if (branch && insn) { |
|  |  | regs = branch->frame[branch->curframe]->regs; |
|  |  | if (BPF\_SRC(insn->code) == BPF\_K) { |
|  |  | mark\_reg\_unknown(env, regs, insn->dst\_reg); |
|  |  | } else if (BPF\_SRC(insn->code) == BPF\_X) { |
|  |  | mark\_reg\_unknown(env, regs, insn->dst\_reg); |
|  |  | mark\_reg\_unknown(env, regs, insn->src\_reg); |
|  |  | } |
|  |  | } |
|  |  | return branch; |
|  |  | } |
|  |  |  |
|  |  | static int sanitize\_ptr\_alu(struct bpf\_verifier\_env \*env, |
|  |  | struct bpf\_insn \*insn, |
|  |  | const struct bpf\_reg\_state \*ptr\_reg, |
| Expand Down  Expand Up | | @@ -6566,7 +6587,8 @@ static int sanitize\_ptr\_alu(struct bpf\_verifier\_env \*env, |
|  |  | tmp = \*dst\_reg; |
|  |  | \*dst\_reg = \*ptr\_reg; |
|  |  | } |
|  |  | ret = push\_stack(env, env->insn\_idx + 1, env->insn\_idx, true); |
|  |  | ret = sanitize\_speculative\_path(env, NULL, env->insn\_idx + 1, |
|  |  | env->insn\_idx); |
|  |  | if (!ptr\_is\_dst\_reg && ret) |
|  |  | \*dst\_reg = tmp; |
|  |  | return !ret ? REASON\_STACK : 0; |
| Expand Down  Expand Up | | @@ -8763,14 +8785,28 @@ static int check\_cond\_jmp\_op(struct bpf\_verifier\_env \*env, |
|  |  | if (err) |
|  |  | return err; |
|  |  | } |
|  |  |  |
|  |  | if (pred == 1) { |
|  |  | /\* only follow the goto, ignore fall-through \*/ |
|  |  | /\* Only follow the goto, ignore fall-through. If needed, push |
|  |  | \* the fall-through branch for simulation under speculative |
|  |  | \* execution. |
|  |  | \*/ |
|  |  | if (!env->bypass\_spec\_v1 && |
|  |  | !sanitize\_speculative\_path(env, insn, \*insn\_idx + 1, |
|  |  | \*insn\_idx)) |
|  |  | return -EFAULT; |
|  |  | \*insn\_idx += insn->off; |
|  |  | return 0; |
|  |  | } else if (pred == 0) { |
|  |  | /\* only follow fall-through branch, since |
|  |  | \* that's where the program will go |
|  |  | /\* Only follow the fall-through branch, since that's where the |
|  |  | \* program will go. If needed, push the goto branch for |
|  |  | \* simulation under speculative execution. |
|  |  | \*/ |
|  |  | if (!env->bypass\_spec\_v1 && |
|  |  | !sanitize\_speculative\_path(env, insn, |
|  |  | \*insn\_idx + insn->off + 1, |
|  |  | \*insn\_idx)) |
|  |  | return -EFAULT; |
|  |  | return 0; |
|  |  | } |
|  |  |  |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `9183671`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftorvalds%2Flinux%2Fcommit%2F9183671af6dbf60a1219371d4ed73e23f43b49db) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from www.usenix.org_d9fdb47b_20250108_143703.html ===


 [usenix\_logo\_notag\_white](/)

* [Sign In](/user?destination=conference/usenixsecurity21/presentation/kirzner)
* [Conferences](/conferences)

 [![](https://www.usenix.org/sites/default/files/styles/neat_conference_menu_logo/public/sec21_wordmark_stacked_ol.png?itok=ekl4YSFW)](/conference/usenixsecurity21)

* [Attend](/conference/usenixsecurity21#registration)
  + [Registration Information](/conference/usenixsecurity21/registration-information)
  + [Student Grant Application](/conference/usenixsecurity21/student-grant-application)
  + [Diversity Grant Application](/conference/usenixsecurity21/diversity-grants-application)
  + [Grants for Black Computer Science Students Application](/conference/usenixsecurity21/grant-application-black-students)
* [Program](/conference/usenixsecurity21/technical-sessions)
  + [Technical Sessions](/conference/usenixsecurity21/technical-sessions)
  + [Summer Accepted Papers](/conference/usenixsecurity21/summer-accepted-papers)
  + [Fall Accepted Papers](/conference/usenixsecurity21/fall-accepted-papers)
* [Participate](/conference/usenixsecurity21/call-for-papers)
  + [Call for Papers](/conference/usenixsecurity21/call-for-papers)
  + [Submission Policies and Instructions](/conference/usenixsecurity21/submission-policies-and-instructions)

  + [Call for Artifacts](/conference/usenixsecurity21/call-for-artifacts)
  + [Artifact Evaluation Information](/conference/usenixsecurity21/artifact-evaluation-information)

  + [Instructions for Presenters](/conference/usenixsecurity21/instructions-presenters)
  + [Hack@Sec](https://hackatevent.org/hacksec21/)
* [Sponsors](/conference/usenixsecurity21#sponsorship)
  + [Sponsor Events](/conference/usenixsecurity21/sponsor-events)

  + [Sponsor and Exhibitor Info](/conference/usenixsecurity21/sponsor-exhibitor-info)
* [About](/conference/usenixsecurity21#marquee)
  + [Symposium Organizers](/conference/usenixsecurity21#organizers)
  + [Past Symposia](https://www.usenix.org/conferences/byname/108)

  + [Conference Policies](https://www.usenix.org/policies)
  + [Code of Conduct](https://www.usenix.org/conferences/coc)
  + [Questions](/conference/usenixsecurity21#questions)

# An Analysis of Speculative Type Confusion Vulnerabilities in the Wild

Authors:

Ofek Kirzner and Adam Morrison, *Tel Aviv University*

Distinguished Paper Award Winner and First Prize winner of the 2021 Internet Defense Prize

Abstract:

Spectre v1 attacks, which exploit conditional branch misprediction, are often identified with attacks that bypass array bounds checking to leak data from a victim's memory. Generally, however, Spectre v1 attacks can exploit *any* conditional branch misprediction that makes the victim execute code incorrectly. In this paper, we investigate *speculative type confusion*, a Spectre v1 attack vector in which branch mispredictions make the victim execute with variables holding values of the wrong type and thereby leak memory content.

We observe that speculative type confusion can be inadvertently introduced by a compiler, making it extremely hard for programmers to reason about security and manually apply Spectre mitigations. We thus set out to determine the extent to which speculative type confusion affects the Linux kernel. Our analysis finds exploitable and potentially-exploitable *arbitrary* memory disclosure vulnerabilities. We also find many *latent* vulnerabilities, which could become exploitable due to innocuous system changes, such as coding style changes.

Our results suggest that Spectre mitigations which rely on statically/manually identifying "bad" code patterns need to be rethought, and more comprehensive mitigations are needed.

## [Ofek Kirzner, Tel Aviv University](/conference/usenixsecurity21/speaker-or-organizer/ofek-kirzner-tel-aviv-university)

## [Adam Morrison, Tel Aviv University](/conference/usenixsecurity21/speaker-or-organizer/adam-morrison-tel-aviv-university)

## Open Access Media

USENIX is committed to Open Access to the research presented at our events. Papers and proceedings are freely available to everyone once the event begins. Any video, audio, and/or slides that are posted after the event are also free and open to everyone. [Support USENIX](/annual-fund) and our commitment to Open Access.

BibTeX@inproceedings {263784,

author = {Ofek Kirzner and Adam Morrison},

title = {An Analysis of Speculative Type Confusion Vulnerabilities in the Wild},

booktitle = {30th USENIX Security Symposium (USENIX Security 21)},

year = {2021},

isbn = {978-1-939133-24-3},

pages = {2399--2416},

url = {https://www.usenix.org/conference/usenixsecurity21/presentation/kirzner},

publisher = {USENIX Association},

month = aug

}

[Download](/biblio/export/bibtex/263784)![PDF icon](/modules/file/icons/application-pdf.png "application/pdf") [Kirzner PDF](https://www.usenix.org/system/files/sec21-kirzner.pdf "sec21-kirzner.pdf")![PDF icon](/modules/file/icons/application-pdf.png "application/pdf") [Kirzner Paper (Prepublication) PDF](https://www.usenix.org/system/files/sec21summer_kirzner.pdf "sec21summer_kirzner.pdf")![](https://www.usenix.org/sites/all/modules/usenix/usenix_files/images/usenix-unlocked.png)[View the slides](https://www.usenix.org/system/files/sec21_slides_kirzner.pdf)
## Presentation Video

* [Attend](/conference/usenixsecurity21#registration)
  + [Registration Information](/conference/usenixsecurity21/registration-information)
  + [Student Grant Application](/conference/usenixsecurity21/student-grant-application)
  + [Diversity Grant Application](/conference/usenixsecurity21/diversity-grants-application)
  + [Grants for Black Computer Science Students Application](/conference/usenixsecurity21/grant-application-black-students)
* [Program](/conference/usenixsecurity21/technical-sessions)
  + [Technical Sessions](/conference/usenixsecurity21/technical-sessions)
  + [Summer Accepted Papers](/conference/usenixsecurity21/summer-accepted-papers)
  + [Fall Accepted Papers](/conference/usenixsecurity21/fall-accepted-papers)
* [Participate](/conference/usenixsecurity21/call-for-papers)
  + [Call for Papers](/conference/usenixsecurity21/call-for-papers)
  + [Submission Policies and Instructions](/conference/usenixsecurity21/submission-policies-and-instructions)
  + [Call for Artifacts](/conference/usenixsecurity21/call-for-artifacts)
  + [Artifact Evaluation Information](/conference/usenixsecurity21/artifact-evaluation-information)
  + [Instructions for Presenters](/conference/usenixsecurity21/instructions-presenters)
  + [Hack@Sec](https://hackatevent.org/hacksec21/)
* [Sponsors](/conference/usenixsecurity21#sponsorship)
  + [Sponsor Events](/conference/usenixsecurity21/sponsor-events)
  + [Sponsor and Exhibitor Info](/conference/usenixsecurity21/sponsor-exhibitor-info)
* [About](/conference/usenixsecurity21#marquee)
  + [Symposium Organizers](/conference/usenixsecurity21#organizers)
  + [Past Symposia](https://www.usenix.org/conferences/byname/108)
  + [Conference Policies](https://www.usenix.org/policies)
  + [Code of Conduct](https://www.usenix.org/conferences/coc)
  + [Questions](/conference/usenixsecurity21#questions)

[Twitter](http://twitter.com/usenixsecurity)[Facebook](https://www.facebook.com/USENIX-Security-Symposium-13544602263)[Youtube](http://www.youtube.com/user/USENIXAssociation)

* [Privacy Policy](/privacy-policy)
* [Contact Us](/contact)

Â© USENIX



=== Content from cveform.mitre.org_c3616b63_20250108_163740.html ===


[![CVE logo](Content/cveLogoR.svg)](https://cve.org/)

[CVE Records
![CVE Record search](Content/search_icon.png)](https://cve.mitre.org/cve/search_cve_list.html)

[Search CVE Records](https://cve.mitre.org/cve/search_cve_list.html)

## Submit a CVE Request

\* Required

![errors](Content/exclamation.jpg)

\* Select a request type

- Please choose an action -
Report Vulnerability/Request CVE ID
Notify CVE about a publication
Request an update to an existing CVE Entry
Request information on the CVE Numbering Authority (CNA) Program
Other

![errors](Content/exclamation.jpg)

\* Enter your e-mail address

![alert](Content/info.jpg)

IMPORTANT: Please add cve-request@mitre.org and cve@mitre.org as
safe senders in your email client before completing this form.

Enter a PGP Key (to encrypt)

Processing....

#### Legal

* [Terms of Use](https://cve.org/Legal/TermsOfUse)
* [Privacy Policy](https://cve.org/Legal/PrivacyPolicy)

#### Media

* [News](https://cve.org/Media/News)
* [Events](https://cve.org/Media/Events)
* [Sign up for e-newsletter](https://cve.mitre.org/news/newsletter.html)

##### Social Media

[github

![](Content/github.png)](https://github.com/CVEProject)
[linkedin

![](Content/linkedin.png)](https://www.linkedin.com/showcase/cve-cwe-capec)
[youtube

![](Content/youtube.png)](https://www.youtube.com/channel/UCUHd2XFDsKH8kjMZQaSKpDQ/)
[twitter for CVE New

![](Content/twitter.png)
New CVE Records](https://twitter.com/CVEnew/)
[twitter for CVE announce

![](Content/twitter.png)
 CVE Announce](https://twitter.com/CVEannounce/)

#### Contact

* [CVE Program Support](https://cveform.mitre.org)
* [CNA](https://cve.org/PartnerInformation/ListofPartners)
* [CVE Website Support](https://cveform.mitre.org)

Use of the CVEÂ® List and the associated references from this website are subject to the
[terms of use](https://cve.org/Legal/TermsOfUse). CVE is sponsored by the
[U.S. Department of Homeland Security (DHS)](https://www.dhs.gov/)
 [Cybersecurity and Infrastructure Security Agency (CISA)](https://www.dhs.gov/cisa/cybersecurity-division/). Copyright Â© 1999-2023,
[The MITRE Corporation](https://www.mitre.org/). CVE and the CVE logo are registered trademarks of The MITRE Corporation.

Ã—
#### Vulnerability Information

Vulnerability Type

CWE-ID

Definition

Buffer Overflow

[CWE-119](http://cwe.mitre.org/data/definitions/119.html)

The software performs operations on a memory buffer, but it can read from or write to a memory location that is outside of the intended boundary of the buffer.

Cross Site Scripting (XSS)

[CWE-79](http://cwe.mitre.org/data/definitions/79.html)

The software does not neutralize or incorrectly neutralizes user-controllable input before it is placed in output that is used as a web page that is served to other users.

SQL Injection

[CWE-89](http://cwe.mitre.org/data/definitions/89.html)

The software constructs all or part of an SQL command using externally-influenced input from an upstream component, but it does not neutralize or incorrectly neutralizes special elements that could modify the intended SQL command when it is sent to a downstream component.

Directory Traversal

[CWE-22](http://cwe.mitre.org/data/definitions/22.html)

The software uses external input to construct a pathname that is intended to identify a file or directory that is located underneath a restricted parent directory, but the software does not properly neutralize special elements within the pathname that can cause the pathname to resolve to a location that is outside of the restricted directory.

XML External Entity (XXE)

[CWE-611](http://cwe.mitre.org/data/definitions/611.html)

The software processes an XML document that can contain XML entities with URIs that resolve to documents outside of the intended sphere of control, causing the product to embed incorrect documents into its output.

Insecure Permissions

[CWE-276](http://cwe.mitre.org/data/definitions/276.html)

The software, upon installation, sets incorrect permissions for an object that exposes it to an unintended actor.

Incorrect Access Control

[CWE-284](http://cwe.mitre.org/data/definitions/284.html)

The software does not restrict or incorrectly restricts access to a resource from an unauthorized actor.

Integer Overflow

[CWE-190](http://cwe.mitre.org/data/definitions/190.html)

The software performs a calculation that can produce an integer overflow or wraparound, when the logic assumes that the resulting value will always be larger than the original value. This can introduce other weaknesses when the calculation is used for resource management or execution control.

Cross Site Request Forgery (CSRF)

[CWE-352](http://cwe.mitre.org/data/definitions/352.html)

The web application does not, or can not, sufficiently verify whether a well-formed, valid, consistent request was intentionally provided by the user who submitted the request.

Missing SSL certification verification

[CWE-599](http://cwe.mitre.org/data/definitions/599.html)

The software uses OpenSSL and trusts or uses a certificate without using the SSL\_get\_verify\_result() function to ensure that the certificate satisfies all necessary security requirements.

Other or Unknown

N/A

The software contains a mistake other than above which can be directly used by a hacker to gain access to a system or network.

Ã—
#### Other Vulnerability Information

You can find more information at [cwe.mitre.org](http://cwe.mitre.org)

* Algorithm complexity
* Array index error
* Auth bypass using cookie
* Buffer Overflow
* Cross-Site Request Forgery (CSRF)
* Cross-Site Scripting (XSS)
* Directory Traversal
* Double free
* Eval injection
* File Upload
* Format String
* HTTP Response Splitting

* HTTP Request Splitting
* Incomplete blacklist
* Integer Overflow
* Integer Signedness
* Memory Leak
* Shell Metacharacter Injectoin
* Open Redirect
* Redirect without Exit
* Path Disclosure
* Insecure Permissions
* PHP remote file inclusion
* Session Fixation

* SQL Injection
* Symbolic Link Following
* Untrusted Search Path
* Unquoted Windows search path
* Use after free
* Default user/password
* Large or infinite loop
* Exposed insecure/unsafe method in ActiveX control
* Generation of insufficiently random numbers
* XML Extneral Entity (XXE)
* Incorrect Access Control
* Missing SSL certificate validation

Ã—
#### Vulnerability Information

Attack Type

Definition

Remote

The vulnerability can be exploited through a network. The attacker may be either on the adjacent or remote network.

Local

To exploit the vulnerability, the attacker needs to be logged into the operating system on a local machine or a guest operating system.

Physical

The attacker needs to be located near the victim or have physical access to the vulnerable system to exploit the vulnerability. Examples include touching a workstation keyboard or USB device, "shoulder surfing" to see a workstation's display, and touching the screen of a mobile device.

Context-dependent

The type of access needed to exploit the vulnerability is dependent on how the vulnerable product is used. This is most often used for libraries.

Ã—
#### Vulnerability Information

Update Type

Definition

Duplicate

More than one CVE ID has been assigned to a single vulnerability.

Rejection

Vendor rejects the assignment of a particular CVE ID.

Split/Merge

A single CVE Entry should be split into two or more CVE Entries OR Two or more existing CVE Entries should be merged into a single CVE Entry.

Update Description

Update the description in an existing CVE Entry.

Update References

Add, remove, or change a reference for an existing CVE Entry.

Other

Any request related to an existing CVE Entry that does not fall within one of the other categories.



=== Content from www.openwall.com_bf2c52cf_20250108_143701.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux Â  *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper Â  *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists Â  *for password cracking*](/wordlists/)+ [passwdqc Â  *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt Â  *KDF & password hashing*](/yescrypt/)+ [yespower Â  *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish Â  *password hashing*](/crypt/)+ [phpass Â  *ditto in PHP*](/phpass/)+ [tcb Â  *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd Â  *port scan detector*](/scanlogd/)+ [popa3d Â  *tiny POP3 daemon*](/popa3d/)+ [blists Â  *web interface to mailing lists*](/blists/)+ [msulogin Â  *single user mode login*](/msulogin/)+ [php\_mt\_seed Â  *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2021/06/19/2) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <CAHMfzJkhZ01FG62sfMdXayK_NwD3g=5NcpGmg+-PVZLBpjJ9Fw@mail.gmail.com>
Date: Mon, 21 Jun 2021 17:47:27 +0300
From: Adam Morrison <mad@...tau.ac.il>
To: oss-security@...ts.openwall.com
Subject: [CVE-2021-33624] Linux kernel BPF protection against speculative
 execution attacks can be bypassed to read arbitrary kernel memory

The Linux kernel BPF subsystem's protection against speculative
execution attacks (Spectre mitigation) can be bypassed.

On affected systems, an unprivileged BPF program can exploit this
vulnerability to leak the contents of arbitrary kernel memory (and
therefore, of all physical memory) via a side-channel.

The issue is that when the kernel's BPF verifier enumerates the
possible execution paths of a BPF program, it skips any branch
outcomes that are impossible according to the ISA semantics.
However, when the BPF program executes, such branch outcomes may be
mispredicted and so a path could speculatively execute that was
missed by the verifier.

For example, when analyzing a memory load instruction, the paths
inspected by the verifier could use an address register that is always
in-bounds, and so the instruction is deemed safe. Whereas a path
missed by the verifier could put an arbitrary attacker-controlled
scalar into the address register before a branch that mispredicts
to the load instruction. This can be abused to read and leak the
contents of any kernel address via a side-channel.

Several PoCs of this vulnerability have been shared privately with
<security@...nel.org> and the BPF maintainers to assist developing
the fix.

The following patch series (available from the mainline git
repository) fixes the vulnerability (the 3rd one is the main patch):

* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=d203b0fd863a2261e5d00b97f3d060c4c2a6db71>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=fe9a5ca7e370e613a9a75a13008a3845ea759d6e>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=9183671af6dbf60a1219371d4ed73e23f43b49db>
* <https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=973377ffe8148180b2651825b92ae91988141b05>

Thanks to Piotr Krysiuk for collaborating on this advisory.

# Discoverers

Ofek Kirzner <ofekkir@...il.com> and Adam Morrison <mad@...tau.ac.il>
Benedict Schlueter <benedict.schlueter@....de> (independent report)
Piotr Krysiuk <piotras@...il.com> (independent report)

# References

CVE-2021-33624 (reserved via <https://cveform.mitre.org/>)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


