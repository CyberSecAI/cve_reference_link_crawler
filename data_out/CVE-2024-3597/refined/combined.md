=== Content from www.wordfence.com_a90d3d87_20250111_172913.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Export WP Page to Static HTML/CSS <= 2.2.2 - Open Redirect

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Export WP Page to Static HTML/CSS <= 2.2.2 - Open Redirect

7.1

**URL Redirection to Untrusted Site ('Open Redirect')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:L)

| CVE | [CVE-2024-3597](https://www.cve.org/CVERecord?id=CVE-2024-3597) |
| --- | --- |
| CVSS | 7.1 (High) |
| Publicly Published | June 19, 2024 |
| Last Updated | July 1, 2024 |
| Researcher | [Krzysztof Zając - CERT PL](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/krzysztof-zajac) |

### Description

The Export WP Page to Static HTML/CSS plugin for WordPress is vulnerable to Open Redirect in all versions up to, and including, 2.2.2. This is due to insufficient validation on the redirect url supplied via the rc\_exported\_zip\_file parameter. This makes it possible for unauthenticated attackers to redirect users to potentially malicious sites if they can successfully trick them into performing an action.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php#L1289)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3110378/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fexport-wp-page-to-static-html%2Fexport-wp-page-to-static-htmlcss-222-open-redirect&t=Export%20WP%20Page%20to%20Static%20HTML%2FCSS%20%3C%3D%202.2.2%20-%20Open%20Redirect "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fexport-wp-page-to-static-html%2Fexport-wp-page-to-static-htmlcss-222-open-redirect&text=Export%20WP%20Page%20to%20Static%20HTML%2FCSS%20%3C%3D%202.2.2%20-%20Open%20Redirect "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fexport-wp-page-to-static-html%2Fexport-wp-page-to-static-htmlcss-222-open-redirect "LinkedIn")
Email

## Vulnerability Details for Export WP Page to Static HTML/CSS

#### [Export WP Page to Static HTML/CSS](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/export-wp-page-to-static-html)

| Software Type | Plugin |
| --- | --- |
| Software Slug | export-wp-page-to-static-html [(view on wordpress.org)](https://wordpress.org/plugins/export-wp-page-to-static-html) |
| Patched? | Yes |
| Remediation | Update to version 2.2.3, or a newer patched version |
| Affected Version | * <= 2.2.2 |
| Patched Version | * 2.2.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_33fbfe64_20250111_172912.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fexport-wp-page-to-static-html%2Ftrunk%2Fadmin%2Fclass-export-wp-page-to-static-html-admin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php?rev=3110378 "Revision 3110378")
* Next Revision →
* [Blame](/browser/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php)

---

# [source:](/browser?order=name "Go to repository root") [export-wp-page-to-static-html](/browser/export-wp-page-to-static-html?order=name "View export-wp-page-to-static-html")/[trunk](/browser/export-wp-page-to-static-html/trunk?order=name "View trunk")/[admin](/browser/export-wp-page-to-static-html/trunk/admin?order=name "View admin")/[class-export-wp-page-to-static-html-admin.php](/browser/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php?order=name "View class-export-wp-page-to-static-html-admin.php")

View diff against:

View revision:

| [Last change](/changeset/3132836/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php "View differences") on this file was [3132836](/changeset/3132836/ "View changeset 3132836"), checked in by recorp, [5 months ago](/timeline?from=2024-08-08T18%3A08%3A23Z&precision=second "See timeline at 08/08/2024 06:08:23 PM") |
| --- |
| Fixed lots of tweaks |
| **File size:** 75.3 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* The admin-specific functionality of the plugin. |
| [5](#L5) | \* |
| [6](#L6) | \* @link       https://www.upwork.com/fl/rayhan1 |
| [7](#L7) | \* @since      1.0.0 |
| [8](#L8) | \* |
| [9](#L9) | \* @package    Export\_Wp\_Page\_To\_Static\_Html |
| [10](#L10) | \* @subpackage Export\_Wp\_Page\_To\_Static\_Html/admin |
| [11](#L11) | \*/ |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* The admin-specific functionality of the plugin. |
| [15](#L15) | \* |
| [16](#L16) | \* Defines the plugin name, version, and two examples hooks for how to |
| [17](#L17) | \* enqueue the admin-specific stylesheet and JavaScript. |
| [18](#L18) | \* |
| [19](#L19) | \* @package    Export\_Wp\_Page\_To\_Static\_Html |
| [20](#L20) | \* @subpackage Export\_Wp\_Page\_To\_Static\_Html/admin |
| [21](#L21) | \* @author     ReCorp <rayhankabir1000@gmail.com> |
| [22](#L22) | \*/ |
| [23](#L23) |  |
| [24](#L24) | namespace ExportHtmlAdmin; |
| [25](#L25) |  |
| [26](#L26) | ini\_set('max\_execution\_time', 60\*60\*24); |
| [27](#L27) | ini\_set('memory\_limit','30240M'); |
| [28](#L28) | /\*ini\_set('display\_errors','Off'); |
| [29](#L29) | ini\_set('error\_reporting', E\_ALL );\*/ |
| [30](#L30) | ini\_set('xdebug.max\_nesting\_level', 2000); |
| [31](#L31) |  |
| [32](#L32) | #[AllowDynamicProperties] |
| [33](#L33) | class Export\_Wp\_Page\_To\_Static\_Html\_Admin { |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* The ID of this plugin. |
| [37](#L37) | \* |
| [38](#L38) | \* @since    1.0.0 |
| [39](#L39) | \* @access   private |
| [40](#L40) | \* @var      string    $plugin\_name    The ID of this plugin. |
| [41](#L41) | \*/ |
| [42](#L42) | private $plugin\_name; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* The version of this plugin. |
| [46](#L46) | \* |
| [47](#L47) | \* @since    1.0.0 |
| [48](#L48) | \* @access   private |
| [49](#L49) | \* @var      string    $version    The current version of this plugin. |
| [50](#L50) | \*/ |
| [51](#L51) | private $version; |
| [52](#L52) |  |
| [53](#L53) | public $upload\_dir; |
| [54](#L54) | public $upload\_url; |
| [55](#L55) | public $export\_dir; |
| [56](#L56) | public $export\_url; |
| [57](#L57) | public $export\_temp\_dir; |
| [58](#L58) | public $export\_temp\_url; |
| [59](#L59) | public $css\_path; |
| [60](#L60) | public $fonts\_path; |
| [61](#L61) | public $js\_path; |
| [62](#L62) | public $img\_path; |
| [63](#L63) | public $video\_path; |
| [64](#L64) | public $audio\_path; |
| [65](#L65) | public $docs\_path; |
| [66](#L66) |  |
| [67](#L67) | public $site\_data; |
| [68](#L68) | private $image\_extensions; |
| [69](#L69) | private $video\_extensions; |
| [70](#L70) | private $audio\_extensions; |
| [71](#L71) | private $docs\_extensions; |
| [72](#L72) | private $html\_extensions; |
| [73](#L73) | private $saveAllAssetsToSpecificDir; |
| [74](#L74) | private $keepSameName; |
| [75](#L75) | private $rcExportHtmlAddContentsToTheHeader; |
| [76](#L76) | private $rcExportHtmlAddContentsToTheFooter; |
| [77](#L77) | public $settingsKey = "rc\_export\_page\_to\_html\_\_"; |
| [78](#L78) |  |
| [79](#L79) | /\*Extract methods\*/ |
| [80](#L80) | private $extract\_stylesheets; |
| [81](#L81) | private $extract\_scripts; |
| [82](#L82) | private $extract\_images; |
| [83](#L83) | private $inline\_css; |
| [84](#L84) | private $extract\_meta\_images; |
| [85](#L85) | private $extract\_videos; |
| [86](#L86) | private $extract\_audios; |
| [87](#L87) | private $extract\_docs; |
| [88](#L88) | public $extract\_html; |
| [89](#L89) |  |
| [90](#L90) | /\*\* |
| [91](#L91) | \* Initialize the class and set its properties. |
| [92](#L92) | \* |
| [93](#L93) | \* @since    1.0.0 |
| [94](#L94) | \* @param      string    $plugin\_name       The name of this plugin. |
| [95](#L95) | \* @param      string    $version    The version of this plugin. |
| [96](#L96) | \*/ |
| [97](#L97) | public function \_\_construct( $plugin\_name, $version ) { |
| [98](#L98) |  |
| [99](#L99) | $this->plugin\_name = $plugin\_name; |
| [100](#L100) | $this->version = $version; |
| [101](#L101) |  |
| [102](#L102) |  |
| [103](#L103) |  |
| [104](#L104) | $this->upload\_dir = wp\_upload\_dir()['basedir']; |
| [105](#L105) | $this->upload\_url = wp\_upload\_dir()['baseurl']; |
| [106](#L106) | $this->export\_dir = $this->upload\_dir . '/exported\_html\_files'; |
| [107](#L107) | $this->export\_url = $this->upload\_url . '/exported\_html\_files'; |
| [108](#L108) | $this->export\_temp\_dir = $this->upload\_dir . '/exported\_html\_files/tmp\_files'; |
| [109](#L109) | $this->export\_temp\_url = $this->upload\_url . '/exported\_html\_files/tmp\_files'; |
| [110](#L110) |  |
| [111](#L111) | $this->css\_path = $this->export\_temp\_dir . '/css/'; |
| [112](#L112) | $this->fonts\_path = $this->export\_temp\_dir . '/fonts/'; |
| [113](#L113) | $this->js\_path = $this->export\_temp\_dir . '/js/'; |
| [114](#L114) | $this->img\_path = $this->export\_temp\_dir . '/images/'; |
| [115](#L115) | $this->video\_path = $this->export\_temp\_dir . '/videos/'; |
| [116](#L116) | $this->audio\_path = $this->export\_temp\_dir . '/audios/'; |
| [117](#L117) | $this->docs\_path = $this->export\_temp\_dir . '/documents/'; |
| [118](#L118) |  |
| [119](#L119) | $this->image\_extensions = array("gif", "jpg", "jpeg", "png", "tiff", "tif", "bmp", "svg", "ico", "webp"); |
| [120](#L120) | $this->video\_extensions = array("flv", "mp4", "m3u8", "ts", "gp", "mov", "avi", "wmv", "webm", "mpg", "mpv", "ogg", "mpv", "m4p", "m4v", "swf", "avchd"); |
| [121](#L121) | $this->audio\_extensions = array("m4a", "aa", "aac", "aax", "amr", "m4b", "mp3", "mpc", "ogg", "tta", "wav", "wv", "webm", "cda"); |
| [122](#L122) | $this->docs\_extensions = array("doc", "docx", "odt", "pdf", "xls", "xlsx", "ods", "ppt", "pptx", "txt"); |
| [123](#L123) | $this->html\_extensions = array("html", "htm"); |
| [124](#L124) |  |
| [125](#L125) |  |
| [126](#L126) | $this->saveAllAssetsToSpecificDir = get\_option('rcExportHtmlSaveAllAssetsToSpecificDir', true); |
| [127](#L127) | $this->keepSameName = false; |
| [128](#L128) | $this->rcExportHtmlAddContentsToTheHeader = get\_option('rcExportHtmlAddContentsToTheHeader', ""); |
| [129](#L129) | $this->rcExportHtmlAddContentsToTheFooter = get\_option('rcExportHtmlAddContentsToTheFooter', ""); |
| [130](#L130) | $this->require\_dirs(); |
| [131](#L131) |  |
| [132](#L132) | /\*Adding inline scripts for cdata\*/ |
| [133](#L133) | add\_action('wp\_print\_scripts', array( $this, 'rc\_cdata\_inlice\_Script\_for\_export\_html' )); |
| [134](#L134) |  |
| [135](#L135) |  |
| [136](#L136) | add\_action('template\_redirect', array ( $this, 'rc\_redirect\_for\_export\_page\_as\_html') ); |
| [137](#L137) |  |
| [138](#L138) | /\*Main tasks\*/ |
| [139](#L139) | add\_action( 'start\_export\_internal\_wp\_page\_to\_html\_event', array( $this, 'start\_export\_wp\_pages\_to\_html\_cron\_task'), 10, 2 ); |
| [140](#L140) | add\_action( 'start\_export\_custom\_url\_to\_html\_event', array( $this, 'start\_export\_custom\_url\_to\_html\_cron\_task'), 10, 2 ); |
| [141](#L141) | /\*End main task\*/ |
| [142](#L142) |  |
| [143](#L143) |  |
| [144](#L144) | add\_action('admin\_notices', array ( $this, 'rc\_export\_html\_general\_admin\_notice') ); |
| [145](#L145) |  |
| [146](#L146) | //add\_filter("before\_basename\_change", array($this, "before\_basename\_change2"), 10, 2); |
| [147](#L147) |  |
| [148](#L148) | //add\_filter( 'cron\_schedules', array( $this, 'rc\_add\_cron\_interval\_five\_minutes') ); |
| [149](#L149) |  |
| [150](#L150) | /\*Exclude urls\*/ |
| [151](#L151) | add\_filter( 'wp\_page\_to\_html\_exclude\_urls', array( $this, 'exclude\_urls'), 10, 2 ); |
| [152](#L152) |  |
| [153](#L153) | /\*Include urls\*/ |
| [154](#L154) | add\_filter( 'wp\_page\_to\_html\_urls\_to\_export', array( $this, 'include\_urls'), 10, 2 ); |
| [155](#L155) |  |
| [156](#L156) | $this->extract\_stylesheets = new extract\_stylesheets\extract\_stylesheets($this); |
| [157](#L157) | $this->extract\_scripts = new extract\_scripts\extract\_scripts($this); |
| [158](#L158) | $this->extract\_images = new extract\_images\extract\_images($this); |
| [159](#L159) | $this->inline\_css = new inline\_css\inline\_css($this); |
| [160](#L160) | $this->extract\_meta\_images = new extract\_meta\_images\extract\_meta\_images($this); |
| [161](#L161) | $this->extract\_videos = new extract\_videos\extract\_videos($this); |
| [162](#L162) | $this->extract\_audios = new extract\_audios\extract\_audios($this); |
| [163](#L163) | $this->extract\_docs = new extract\_documents\extract\_documents($this); |
| [164](#L164) | $this->extract\_html = new extract\_html\extract\_html($this); |
| [165](#L165) |  |
| [166](#L166) | } |
| [167](#L167) | public function hasAccess() |
| [168](#L168) | { |
| [169](#L169) | require\_once( ABSPATH . WPINC . '/pluggable.php' ); |
| [170](#L170) | $capabilities = \get\_option('wpptsh\_user\_roles',array('administrator')); |
| [171](#L171) |  |
| [172](#L172) | if (!empty($capabilities)){ |
| [173](#L173) | foreach ($capabilities as $cap) { |
| [174](#L174) | if (current\_user\_can($cap)){ |
| [175](#L175) | return true; |
| [176](#L176) | break; |
| [177](#L177) | } |
| [178](#L178) | } |
| [179](#L179) | } |
| [180](#L180) | if (current\_user\_can('administrator')){ |
| [181](#L181) | return true; |
| [182](#L182) | } |
| [183](#L183) | return false; |
| [184](#L184) | } |
| [185](#L185) | private function require\_dirs() |
| [186](#L186) | { |
| [187](#L187) | /\*\* |
| [188](#L188) | \* The class responsible for defining all ajax requests |
| [189](#L189) | \*/ |
| [190](#L190) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/includes/ajax\_requests.php'; |
| [191](#L191) |  |
| [192](#L192) | /\*\* |
| [193](#L193) | \* The class responsible for menu page |
| [194](#L194) | \*/ |
| [195](#L195) | require\_once plugin\_dir\_path( dirname( \_\_FILE\_\_ ) ) . 'admin/includes/add-menu-page.php'; |
| [196](#L196) | new AddMenuPage($this); |
| [197](#L197) |  |
| [198](#L198) | require 'simple\_html\_dom.php'; |
| [199](#L199) | require 'includes/url\_to\_absolute/url\_to\_absolute.php'; |
| [200](#L200) | require 'includes/extractors.php'; |
| [201](#L201) |  |
| [202](#L202) | } |
| [203](#L203) |  |
| [204](#L204) |  |
| [205](#L205) | public function rc\_cdata\_inlice\_Script\_for\_export\_html() { |
| [206](#L206) | ?> |
| [207](#L207) | <script> |
| [208](#L208) | /\* <![CDATA[ \*/ |
| [209](#L209) | var rcewpp = { |
| [210](#L210) | "ajax\_url":"<?php echo esc\_html(admin\_url('admin-ajax.php')); ?>", |
| [211](#L211) | "nonce": "<?php echo esc\_html(wp\_create\_nonce( 'rc-nonce' )); ?>", |
| [212](#L212) | "home\_url": "<?php echo esc\_html(home\_url('/')); ?>", |
| [213](#L213) | "settings\_icon": '<?php echo plugin\_dir\_url( \_\_FILE\_\_ ) . 'images/settings.png' ?>', |
| [214](#L214) | "settings\_hover\_icon": '<?php echo plugin\_dir\_url( \_\_FILE\_\_ ) . 'images/settings\_hover.png' ?>' |
| [215](#L215) | }; |
| [216](#L216) | /\* ]]\> \*/ |
| [217](#L217) | </script> |
| [218](#L218) | <?php |
| [219](#L219) | } |
| [220](#L220) |  |
| [221](#L221) | public function get\_string\_between($string, $start, $end){ |
| [222](#L222) | $string = ' ' . $string; |
| [223](#L223) | $ini = strpos($string, $start); |
| [224](#L224) | if ($ini == 0) return ''; |
| [225](#L225) | $ini += strlen($start); |
| [226](#L226) | $len = strpos($string, $end, $ini) - $ini; |
| [227](#L227) | return substr($string, $ini, $len); |
| [228](#L228) | } |
| [229](#L229) |  |
| [230](#L230) | //    public function rmdir\_recursive($dir) { |
| [231](#L231) | //        if(file\_exists($dir)){ |
| [232](#L232) | //            foreach(scandir($dir) as $file) { |
| [233](#L233) | //                if ('.' === $file || '..' === $file) continue; |
| [234](#L234) | //                if (is\_dir("$dir/$file")) $this->rmdir\_recursive("$dir/$file"); |
| [235](#L235) | //                else @unlink("$dir/$file"); |
| [236](#L236) | //            } |
| [237](#L237) | //            rmdir($dir); |
| [238](#L238) | //        } |
| [239](#L239) | //    } |
| [240](#L240) |  |
| [241](#L241) | public function rmdir\_recursive($dir) { |
| [242](#L242) | global $wp\_filesystem; |
| [243](#L243) |  |
| [244](#L244) | // Initialize the WP\_Filesystem |
| [245](#L245) | if ( ! function\_exists( 'WP\_Filesystem' ) ) { |
| [246](#L246) | require\_once( ABSPATH . 'wp-admin/includes/file.php' ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | WP\_Filesystem(); |
| [250](#L250) |  |
| [251](#L251) | if ( $wp\_filesystem->exists( $dir ) ) { |
| [252](#L252) | $dir\_contents = $wp\_filesystem->dirlist( $dir ); |
| [253](#L253) |  |
| [254](#L254) | foreach ( $dir\_contents as $file => $fileinfo ) { |
| [255](#L255) | if ( $fileinfo['type'] === 'd' ) { |
| [256](#L256) | $this->rmdir\_recursive( $dir . '/' . $file ); |
| [257](#L257) | } else { |
| [258](#L258) | $wp\_filesystem->delete( $dir . '/' . $file ); |
| [259](#L259) | } |
| [260](#L260) | } |
| [261](#L261) |  |
| [262](#L262) | $wp\_filesystem->rmdir( $dir ); |
| [263](#L263) | } |
| [264](#L264) | } |
| [265](#L265) |  |
| [266](#L266) |  |
| [267](#L267) | public function get\_site\_data\_by\_url($url='') |
| [268](#L268) | { |
| [269](#L269) | $arrContextOptions=array( |
| [270](#L270) | "http" => array( |
| [271](#L271) | /\*"header" => |
| [272](#L272) | "User-Agent: Mozilla/5.0 (Windows NT 10.0; WOW64) |
| [273](#L273) | AppleWebKit/537.36 (KHTML, like Gecko) |
| [274](#L274) | Chrome/50.0.2661.102 Safari/537.36rn",\*/ |
| [275](#L275) | "ignore\_errors" => true, |
| [276](#L276) | "timeout" => (float)15, |
| [277](#L277) | ), |
| [278](#L278) | "ssl"=>array( |
| [279](#L279) | "allow\_self\_signed"=>true, |
| [280](#L280) | "verify\_peer"=>false, |
| [281](#L281) | "verify\_peer\_name"=>false, |
| [282](#L282) | ), |
| [283](#L283) | ); |
| [284](#L284) |  |
| [285](#L285) | if (!empty($url)) { |
| [286](#L286) | $html = file\_get\_html($url, false, stream\_context\_create($arrContextOptions)); |
| [287](#L287) |  |
| [288](#L288) | if (!$html) { |
| [289](#L289) | $html = $this->xcurl($url); |
| [290](#L290) | $html = str\_get\_html($html); |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | $this->site\_data = $html; |
| [294](#L294) |  |
| [295](#L295) | update\_option('sddddddddd2', $url); |
| [296](#L296) | //update\_option('sddddddddd2', $html->find('body',0)->plaintext); |
| [297](#L297) | return $html; |
| [298](#L298) | } |
| [299](#L299) | else{ |
| [300](#L300) | return $this->get\_site\_data\_by\_url(); |
| [301](#L301) | } |
| [302](#L302) | } |
| [303](#L303) |  |
| [304](#L304) | /\*\* |
| [305](#L305) | \* @return string |
| [306](#L306) | \*/ |
| [307](#L307) | public function get\_url\_data($url="") |
| [308](#L308) | { |
| [309](#L309) | $url = $this->url\_basename\_space\_to\_percent20($url); |
| [310](#L310) | //        $arrContextOptions=array( |
| [311](#L311) | //            "http" => array( |
| [312](#L312) | //                /\*"method" => "POST", |
| [313](#L313) | //                "header" => |
| [314](#L314) | //                    "Content-Type: application/xml; charset=utf-8;\r\n". |
| [315](#L315) | //                    "Connection: close\r\n",\*/ |
| [316](#L316) | //                "ignore\_errors" => true, |
| [317](#L317) | //                "timeout" => (float)300, |
| [318](#L318) | //            ), |
| [319](#L319) | //            "ssl"=>array( |
| [320](#L320) | //                "allow\_self\_signed"=>true, |
| [321](#L321) | //                "verify\_peer"=>false, |
| [322](#L322) | //                "verify\_peer\_name"=>false, |
| [323](#L323) | //            ), |
| [324](#L324) | //        ); |
| [325](#L325) |  |
| [326](#L326) | //$html = @file\_get\_contents($url, false, stream\_context\_create($arrContextOptions)); |
| [327](#L327) |  |
| [328](#L328) | // Use wp\_remote\_get to fetch the URL |
| [329](#L329) | $response = wp\_remote\_get($url, array( |
| [330](#L330) | 'sslverify' => false, |
| [331](#L331) | 'timeout' => 10, |
| [332](#L332) | )); |
| [333](#L333) |  |
| [334](#L334) | // Check for errors |
| [335](#L335) | if (is\_wp\_error($response)) { |
| [336](#L336) | // Handle error, maybe return false or an empty string |
| [337](#L337) | $html = ''; |
| [338](#L338) | } else { |
| [339](#L339) | // Retrieve the body of the response |
| [340](#L340) | $html = wp\_remote\_retrieve\_body($response); |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | if (!$html) { |
| [344](#L344) | $html = $this->xcurl($url); |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | return $html; |
| [348](#L348) | } |
| [349](#L349) |  |
| [350](#L350) | //    public function get\_url\_data($url = "") |
| [351](#L351) | //    { |
| [352](#L352) | //        $url = $this->url\_basename\_space\_to\_percent20($url); |
| [353](#L353) | // |
| [354](#L354) | //        // Set arguments for wp\_remote\_get() |
| [355](#L355) | //        $args = array( |
| [356](#L356) | //            'timeout' => 300, |
| [357](#L357) | //            'sslverify' => false, |
| [358](#L358) | //        ); |
| [359](#L359) | // |
| [360](#L360) | //        // Fetch the remote content |
| [361](#L361) | //        $response = wp\_remote\_get($url, $args); |
| [362](#L362) | // |
| [363](#L363) | //        // Check for WP\_Error or empty body |
| [364](#L364) | //        if (is\_wp\_error($response) || wp\_remote\_retrieve\_response\_code($response) != 200) { |
| [365](#L365) | //            // Handle error |
| [366](#L366) | //            $html = $this->xcurl($url);  // Fallback method |
| [367](#L367) | //        } else { |
| [368](#L368) | //            // Get the body content |
| [369](#L369) | //            $html = wp\_remote\_retrieve\_body($response); |
| [370](#L370) | //        } |
| [371](#L371) | // |
| [372](#L372) | //        return $html; |
| [373](#L373) | //    } |
| [374](#L374) |  |
| [375](#L375) | public function url\_basename\_space\_to\_percent20($url="") |
| [376](#L376) | { |
| [377](#L377) | $pos = strrpos($url, '/') + 1; |
| [378](#L378) | return substr($url, 0, $pos) . str\_replace(' ', '%20', substr($url, $pos)); |
| [379](#L379) | } |
| [380](#L380) |  |
| [381](#L381) |  |
| [382](#L382) |  |
| [383](#L383) | public function add\_urls\_log($url="", $found\_on="", $type="", $exported=0, $new\_url="") |
| [384](#L384) | { |
| [385](#L385) | if (strpos($url, 'data:') == false && strpos($url, 'svg+xml') == false && strpos($url, 'base64') == false) { |
| [386](#L386) |  |
| [387](#L387) | //$url = $this->url\_without\_hash($url); |
| [388](#L388) | global $wpdb; |
| [389](#L389) | $table\_name = $wpdb->prefix . 'export\_urls\_logs'; |
| [390](#L390) |  |
| [391](#L391) | // Prepare the SQL statement with placeholders |
| [392](#L392) | // Prepare the SQL query |
| [393](#L393) | $sql = $wpdb->prepare("SELECT COUNT(\*) FROM {$table\_name} WHERE url = %s", $url); |
| [394](#L394) |  |
| [395](#L395) | // Execute the query |
| [396](#L396) | $found = $wpdb->get\_var($sql); |
| [397](#L397) |  |
| [398](#L398) |  |
| [399](#L399) |  |
| [400](#L400) | if (!$found) { |
| [401](#L401) |  |
| [402](#L402) | $url = sanitize\_text\_field($url); |
| [403](#L403) | $new\_url = sanitize\_text\_field($new\_url); |
| [404](#L404) | $found\_on = sanitize\_text\_field($found\_on); |
| [405](#L405) | $type = sanitize\_text\_field($type); |
| [406](#L406) | $exported = intval($exported); |
| [407](#L407) |  |
| [408](#L408) | $res = $wpdb->insert( |
| [409](#L409) | $table\_name, |
| [410](#L410) | array( |
| [411](#L411) | 'url' => $url, |
| [412](#L412) | 'new\_file\_name' => $new\_url, |
| [413](#L413) | 'found\_on' => $found\_on, |
| [414](#L414) | 'type' => $type, |
| [415](#L415) | 'exported' => $exported, |
| [416](#L416) | ), |
| [417](#L417) | array( |
| [418](#L418) | '%s', |
| [419](#L419) | '%s', |
| [420](#L420) | '%s', |
| [421](#L421) | '%s', |
| [422](#L422) | '%d', |
| [423](#L423) | ) |
| [424](#L424) | ); |
| [425](#L425) |  |
| [426](#L426) | return $res; |
| [427](#L427) | } |
| [428](#L428) | } |
| [429](#L429) | return 0; |
| [430](#L430) | } |
| [431](#L431) | public function update\_urls\_log($url="", $value="", $by='exported', $type = "url") |
| [432](#L432) | { |
| [433](#L433) | global $wpdb; |
| [434](#L434) | $table\_name = $wpdb->prefix . 'export\_urls\_logs'; |
| [435](#L435) |  |
| [436](#L436) | // Sanitize the input data |
| [437](#L437) | $url = sanitize\_text\_field($url); |
| [438](#L438) | $value = sanitize\_text\_field($value); |
| [439](#L439) | $by = sanitize\_text\_field($by); |
| [440](#L440) | $type = sanitize\_text\_field($type); |
| [441](#L441) |  |
| [442](#L442) | // Prepare the SQL query safely |
| [443](#L443) | $sql = $wpdb->prepare("SELECT COUNT(\*) FROM {$table\_name} WHERE url = %s", $url); |
| [444](#L444) | $found = $wpdb->get\_var($sql); |
| [445](#L445) |  |
| [446](#L446) | if ($found){ |
| [447](#L447) | if($by == 'exported'){ |
| [448](#L448) | $res = $wpdb->update( |
| [449](#L449) | $table\_name, |
| [450](#L450) | array('exported' => $value), |
| [451](#L451) | array('url' => $url), |
| [452](#L452) | array('%d'), // value format |
| [453](#L453) | array('%s')  // where format |
| [454](#L454) | ); |
| [455](#L455) | } elseif($by == 'new\_file\_name'){ |
| [456](#L456) | $res = $wpdb->update( |
| [457](#L457) | $table\_name, |
| [458](#L458) | array('new\_file\_name' => $value), |
| [459](#L459) | array('url' => $url), |
| [460](#L460) | array('%s'), // value format |
| [461](#L461) | array('%s')  // where format |
| [462](#L462) | ); |
| [463](#L463) | } |
| [464](#L464) | } else { |
| [465](#L465) | if($by == 'exported'){ |
| [466](#L466) | $res = $wpdb->insert( |
| [467](#L467) | $table\_name, |
| [468](#L468) | array( |
| [469](#L469) | 'url' => $url, |
| [470](#L470) | 'found\_on' => $url, |
| [471](#L471) | 'type' => $type, |
| [472](#L472) | 'exported' => $value, |
| [473](#L473) | ), |
| [474](#L474) | array('%s', '%s', '%s', '%d') // data formats |
| [475](#L475) | ); |
| [476](#L476) | } elseif($by == 'new\_file\_name'){ |
| [477](#L477) | $res = $wpdb->insert( |
| [478](#L478) | $table\_name, |
| [479](#L479) | array( |
| [480](#L480) | 'url' => $url, |
| [481](#L481) | 'found\_on' => $url, |
| [482](#L482) | 'type' => $type, |
| [483](#L483) | 'new\_file\_name' => $value, |
| [484](#L484) | ), |
| [485](#L485) | array('%s', '%s', '%s', '%s') // data formats |
| [486](#L486) | ); |
| [487](#L487) | } |
| [488](#L488) | } |
| [489](#L489) |  |
| [490](#L490) | return $res ? $res : 0; |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | public function url\_without\_hash($url="") |
| [494](#L494) | { |
| [495](#L495) | $url = explode('#', $url)[0]; |
| [496](#L496) |  |
| [497](#L497) | return $url; |
| [498](#L498) | } |
| [499](#L499) |  |
| [500](#L500) | public function is\_link\_exists($url = "", $found\_on = false, $found\_on\_url = "") |
| [501](#L501) | { |
| [502](#L502) | global $wpdb; |
| [503](#L503) | $table\_name = $wpdb->prefix . 'export\_urls\_logs'; |
| [504](#L504) |  |
| [505](#L505) | // Sanitize the input data |
| [506](#L506) | $url = sanitize\_text\_field($url); |
| [507](#L507) | $found\_on\_url = sanitize\_text\_field($found\_on\_url); |
| [508](#L508) |  |
| [509](#L509) | // Prepare and execute the SQL query safely |
| [510](#L510) | if (!$found\_on) { |
| [511](#L511) | $sql = $wpdb->prepare("SELECT COUNT(\*) FROM {$table\_name} WHERE url LIKE %s", $url); |
| [512](#L512) | } else { |
| [513](#L513) | $sql = $wpdb->prepare("SELECT COUNT(\*) FROM {$table\_name} WHERE url LIKE %s AND found\_on LIKE %s", $url, $found\_on\_url); |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | $found = $wpdb->get\_var($sql); |
| [517](#L517) |  |
| [518](#L518) | return $found ? true : false; |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) |  |
| [522](#L522) | public function get\_all\_links($url="") |
| [523](#L523) | { |
| [524](#L524) | $path\_to\_dot = $this->rc\_path\_to\_dot($url, true, true); |
| [525](#L525) | $url\_middle\_path = $this->rc\_get\_url\_middle\_path($url, true, true); |
| [526](#L526) | $basename = $this->url\_to\_basename($url); |
| [527](#L527) |  |
| [528](#L528) | $src = $this->site\_data; |
| [529](#L529) | $findLinks = $src->find('a'); |
| [530](#L530) | $all\_a = array(); |
| [531](#L531) |  |
| [532](#L532) | if(!empty($findLinks)){ |
| [533](#L533) | foreach ($findLinks as $link) { |
| [534](#L534) | if (!empty($url)){ |
| [535](#L535) | $imgExts = array("gif", "jpg", "jpeg", "png", "tiff", "tif", "svg", "pdf"); |
| [536](#L536) | $urlExt = pathinfo($link->href, PATHINFO\_EXTENSION); |
| [537](#L537) | $exclude\_url = apply\_filters('wp\_page\_to\_html\_exclude\_urls', false, $link->href); |
| [538](#L538) | if (($this->get\_host($link->href) == $this->get\_host($url) ) && !in\_array($urlExt, $imgExts) && !$exclude\_url){ |
| [539](#L539) | $link\_href = $link->href; |
| [540](#L540) | $link\_href = $this->url\_without\_hash($link\_href); |
| [541](#L541) | //$link\_href = url\_to\_absolute($url, $link\_href); |
| [542](#L542) |  |
| [543](#L543) | $this->add\_urls\_log($link\_href, $url, 'url'); |
| [544](#L544) |  |
| [545](#L545) | $all\_a[] = $link\_href; |
| [546](#L546) | //$this->create\_html\_file($link->href); |
| [547](#L547) |  |
| [548](#L548) | $imgExts = $this->getImageExtensions(); |
| [549](#L549) | $urlExt = pathinfo($url, PATHINFO\_EXTENSION); |
| [550](#L550) | //echo $urlExt; |
| [551](#L551) | if (in\_array($urlExt, $imgExts)) { |
| [552](#L552) | $link->href = $path\_to\_dot .'images/'. $basename; |
| [553](#L553) | }else{ |
| [554](#L554) | $link->href = $path\_to\_dot . $url\_middle\_path . $basename . '.html'; |
| [555](#L555) | } |
| [556](#L556) | } |
| [557](#L557) | } |
| [558](#L558) | } |
| [559](#L559) | } |
| [560](#L560) | $this->site\_data = $src; |
| [561](#L561) |  |
| [562](#L562) | return $all\_a; |
| [563](#L563) | } |
| [564](#L564) |  |
| [565](#L565) | public function create\_required\_directories($value='') |
| [566](#L566) | { |
| [567](#L567) |  |
| [568](#L568) | if (!file\_exists($this->export\_dir)) { |
| [569](#L569) | $this->create\_directory($this->export\_dir); |
| [570](#L570) | } |
| [571](#L571) |  |
| [572](#L572) | if (!file\_exists($this->export\_temp\_dir)) { |
| [573](#L573) | $this->create\_directory($this->export\_temp\_dir); |
| [574](#L574) | } |
| [575](#L575) |  |
| [576](#L576) | if (!file\_exists($this->css\_path)) { |
| [577](#L577) |  |
| [578](#L578) | if ($this->update\_export\_log('', 'creating', 'CSS Directory')) { |
| [579](#L579) | $this->create\_directory($this->css\_path); |
| [580](#L580) | } |
| [581](#L581) | } |
| [582](#L582) | if (!file\_exists($this->fonts\_path)) { |
| [583](#L583) | if ($this->update\_export\_log('', 'creating', 'Fonts Directory')) { |
| [584](#L584) | $this->create\_directory($this->fonts\_path); |
| [585](#L585) | } |
| [586](#L586) | } |
| [587](#L587) | if (!file\_exists($this->js\_path)) { |
| [588](#L588) | if ($this->update\_export\_log('', 'creating', 'JS Directory')) { |
| [589](#L589) | $this->create\_directory($this->js\_path); |
| [590](#L590) | } |
| [591](#L591) | } |
| [592](#L592) | if (!file\_exists($this->img\_path)) { |
| [593](#L593) | if ($this->update\_export\_log('', 'creating', 'Images Directory')) { |
| [594](#L594) | $this->create\_directory($this->img\_path); |
| [595](#L595) | } |
| [596](#L596) | } |
| [597](#L597) | } |
| [598](#L598) |  |
| [599](#L599) | public function clear\_tables\_and\_files() |
| [600](#L600) | { |
| [601](#L601) | global $wpdb; |
| [602](#L602) |  |
| [603](#L603) | // Step 1: Remove files and directories |
| [604](#L604) | $this->rmdir\_recursive($this->upload\_dir . '/exported\_html\_files/tmp\_files'); |
| [605](#L605) |  |
| [606](#L606) | // Step 2: Clear the database tables |
| [607](#L607) | $wpdb->query("TRUNCATE TABLE {$wpdb->prefix}export\_page\_to\_html\_logs"); |
| [608](#L608) | $wpdb->query("TRUNCATE TABLE {$wpdb->prefix}export\_urls\_logs "); |
| [609](#L609) |  |
| [610](#L610) | // Step 3: Return true after successful clearing |
| [611](#L611) | return true; |
| [612](#L612) | } |
| [613](#L613) |  |
| [614](#L614) |  |
| [615](#L615) | public function export\_wp\_page\_as\_static\_html\_by\_page\_id($main\_url = '', $html\_filename = 'index.html') |
| [616](#L616) | { |
| [617](#L617) | if ($this->is\_cancel\_command\_found()) { |
| [618](#L618) | return false; |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | $prev\_main\_url = $main\_url; |
| [622](#L622) | $this->update\_urls\_log($prev\_main\_url, 1); |
| [623](#L623) |  |
| [624](#L624) | $main\_url = explode('#', $main\_url)[0]; |
| [625](#L625) |  |
| [626](#L626) | $middle\_path = $this->rc\_get\_url\_middle\_path($main\_url); |
| [627](#L627) | $full\_site = $this->getSettings('full\_site'); |
| [628](#L628) |  |
| [629](#L629) | if (!$this->rc\_is\_link\_already\_generated($main\_url)) { |
| [630](#L630) |  |
| [631](#L631) | if (!empty($middle\_path) && !file\_exists($this->upload\_dir . '/exported\_html\_files/tmp\_files/' . $middle\_path)) { |
| [632](#L632) | $path = $this->upload\_dir . '/exported\_html\_files/tmp\_files/' . $middle\_path; |
| [633](#L633) | @$this->create\_directory($path, 0777, true); |
| [634](#L634) | } |
| [635](#L635) | $this->update\_export\_log($main\_url, 'reading', ''); |
| [636](#L636) | //$this->add\_urls\_log($link->href, $url, 'url'); |
| [637](#L637) |  |
| [638](#L638) | $this->get\_site\_data\_by\_url($main\_url); |
| [639](#L639) |  |
| [640](#L640) | $skip = $this->getSettings('skipAssetsFiles', array()); |
| [641](#L641) |  |
| [642](#L642) | /\*Get stylesheet urls\*/ |
| [643](#L643) | if(!array\_key\_exists('stylesheets', $skip)){ |
| [644](#L644) | $this->ExtractStylesheets()->get\_stylesheets($main\_url); |
| [645](#L645) |  |
| [646](#L646) | /\*Working with inline css\*/ |
| [647](#L647) | $this->InlineCss()->get\_inline\_css($main\_url); |
| [648](#L648) |  |
| [649](#L649) | /\*Working with div inline css\*/ |
| [650](#L650) | $this->InlineCss()->get\_div\_inline\_css($main\_url); |
| [651](#L651) | } |
| [652](#L652) |  |
| [653](#L653) | /\*Get scripts\*/ |
| [654](#L654) | if(!array\_key\_exists('scripts', $skip)){ |
| [655](#L655) | $this->ExtractScripts()->get\_scripts($main\_url); |
| [656](#L656) |  |
| [657](#L657) | } |
| [658](#L658) |  |
| [659](#L659) | /\*Get images\*/ |
| [660](#L660) | if(!array\_key\_exists('images', $skip)){ |
| [661](#L661) | $this->ExtractImages()->get\_images($main\_url); |
| [662](#L662) |  |
| [663](#L663) | /\*Extract meta images\*/ |
| [664](#L664) | $this->ExtractMetaImages()->get\_meta\_images($main\_url); |
| [665](#L665) | } |
| [666](#L666) |  |
| [667](#L667) | /\*Extract videos\*/ |
| [668](#L668) | if(!array\_key\_exists('videos', $skip)){ |
| [669](#L669) | $this->ExtractVideos()->get\_videos($main\_url); |
| [670](#L670) | } |
| [671](#L671) |  |
| [672](#L672) |  |
| [673](#L673) | /\*Extract audios\*/ |
| [674](#L674) | if(!array\_key\_exists('audios', $skip)){ |
| [675](#L675) | $this->ExtractAudios()->get\_audios($main\_url); |
| [676](#L676) | } |
| [677](#L677) |  |
| [678](#L678) | /\*Extract audios\*/ |
| [679](#L679) | if(!array\_key\_exists('docs', $skip)){ |
| [680](#L680) | $this->ExtractDocs()->get\_documents($main\_url); |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) |  |
| [684](#L684) |  |
| [685](#L685) |  |
| [686](#L686) | /\*Save the html\*/ |
| [687](#L687) | $this->saveHtmlFile($main\_url, $full\_site, $middle\_path, $html\_filename); |
| [688](#L688) |  |
| [689](#L689) | $this->update\_urls\_log($prev\_main\_url, 1); |
| [690](#L690) | $this->update\_urls\_log($main\_url, 1); |
| [691](#L691) |  |
| [692](#L692) |  |
| [693](#L693) | if ($full\_site) { |
| [694](#L694) | $all\_links\_href = $this->get\_all\_links($main\_url); |
| [695](#L695) | $this->readAllLinks($all\_links\_href, $full\_site); |
| [696](#L696) | } /\*End condition full\_site\*/ |
| [697](#L697) |  |
| [698](#L698) | } |
| [699](#L699) |  |
| [700](#L700) | return true; |
| [701](#L701) |  |
| [702](#L702) | } |
| [703](#L703) |  |
| [704](#L704) | public function url\_to\_basename($url="", $parm=false, $type="") |
| [705](#L705) | { |
| [706](#L706) | if($this->getSettings('customUrl') && $this->getSettings('full\_site')){ |
| [707](#L707) | $url = str\_replace( $this->getSettings('customUrlAddress'), '', $url); |
| [708](#L708) | } |
| [709](#L709) |  |
| [710](#L710) | $url = str\_replace( array(home\_url(), $this->get\_host($url)), array('', ''), $url); |
| [711](#L711) |  |
| [712](#L712) |  |
| [713](#L713) | $url = $this->ltrim\_and\_rtrim($url, '/'); |
| [714](#L714) |  |
| [715](#L715) | if(!$parm){ |
| [716](#L716) | $urlPart = explode('?', $url); |
| [717](#L717) | $urlPart = explode('#', $urlPart[0]); |
| [718](#L718) | $url = $urlPart[0]; |
| [719](#L719) |  |
| [720](#L720) | $basename = ""; |
| [721](#L721) | if (!empty($url)) { |
| [722](#L722) | return basename($url).$type; |
| [723](#L723) | } |
| [724](#L724) | else{ |
| [725](#L725) | return "index".$type; |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) | else{ |
| [729](#L729) | //$urlPart = explode('?', $url); |
| [730](#L730) | $urlPart = explode('#', $url); |
| [731](#L731) | $url = $urlPart[0]; |
| [732](#L732) |  |
| [733](#L733) | $parm = isset($urlPart[1]) ? '#' . $urlPart[1] : ""; |
| [734](#L734) |  |
| [735](#L735) | $basename = ""; |
| [736](#L736) |  |
| [737](#L737) | if (!empty($url)) { |
| [738](#L738) | return basename($url).$type.$parm; |
| [739](#L739) | } |
| [740](#L740) | else{ |
| [741](#L741) | return "index".$type.$parm; |
| [742](#L742) | } |
| [743](#L743) | } |
| [744](#L744) | } |
| [745](#L745) |  |
| [746](#L746) |  |
| [747](#L747) |  |
| [748](#L748) | public function update\_export\_log($path = "", $type = "copying", $comment = ""){ |
| [749](#L749) | global $wpdb; |
| [750](#L750) |  |
| [751](#L751) | // Sanitize inputs |
| [752](#L752) | $path = sanitize\_text\_field($path); |
| [753](#L753) | $type = sanitize\_text\_field($type); |
| [754](#L754) | $comment = sanitize\_text\_field($comment); |
| [755](#L755) |  |
| [756](#L756) | // Insert sanitized data into the database |
| [757](#L757) | $wpdb->insert( |
| [758](#L758) | $wpdb->prefix . 'export\_page\_to\_html\_logs', |
| [759](#L759) | array( |
| [760](#L760) | 'path' => $path, |
| [761](#L761) | 'type' => $type, |
| [762](#L762) | 'comment' => $comment, |
| [763](#L763) | ), |
| [764](#L764) | array( |
| [765](#L765) | '%s', |
| [766](#L766) | '%s', |
| [767](#L767) | '%s', |
| [768](#L768) | ) |
| [769](#L769) | ); |
| [770](#L770) |  |
| [771](#L771) | return true; |
| [772](#L772) | } |
| [773](#L773) |  |
| [774](#L774) |  |
| [775](#L775) |  |
| [776](#L776) | public function get\_all\_files\_as\_array($all\_files){ |
| [777](#L777) |  |
| [778](#L778) |  |
| [779](#L779) | ob\_start(); |
| [780](#L780) | $this->rc\_get\_sub\_dir1($all\_files); |
| [781](#L781) | $files = ob\_get\_clean(); |
| [782](#L782) | $files = rtrim($files, ','); |
| [783](#L783) | $files = explode(',', $files); |
| [784](#L784) |  |
| [785](#L785) | return $files; |
| [786](#L786) | } |
| [787](#L787) |  |
| [788](#L788) | public function rc\_get\_sub\_dir1($dir) { |
| [789](#L789) | if (file\_exists($dir)) { |
| [790](#L790) | foreach (scandir($dir) as $file) { |
| [791](#L791) | if ('.' === $file || '..' === $file) continue; |
| [792](#L792) | if (is\_dir("$dir/$file")) $this->rc\_get\_sub\_dir1("$dir/$file"); |
| [793](#L793) | echo esc\_html("$dir/$file") . ','; |
| [794](#L794) | } |
| [795](#L795) | } |
| [796](#L796) | } |
| [797](#L797) |  |
| [798](#L798) |  |
| [799](#L799) |  |
| [800](#L800) | public function get\_all\_files\_as\_array2($all\_files){ |
| [801](#L801) |  |
| [802](#L802) | ob\_start(); |
| [803](#L803) | $this->rc\_get\_sub\_dir($all\_files); |
| [804](#L804) | $files = ob\_get\_clean(); |
| [805](#L805) | $files = rtrim($files, ','); |
| [806](#L806) | $files = explode(',', $files); |
| [807](#L807) | return $files; |
| [808](#L808) |  |
| [809](#L809) | } |
| [810](#L810) | public function rc\_get\_sub\_dir($dir) { |
| [811](#L811) | if (file\_exists($dir)) { |
| [812](#L812) | foreach (scandir($dir) as $file) { |
| [813](#L813) | if ('.' === $file || '..' === $file) continue; |
| [814](#L814) | if (is\_dir("$dir/$file")) $this->rc\_get\_sub\_dir("$dir/$file"); |
| [815](#L815) | if (is\_file("$dir/$file")) echo esc\_html("$dir/$file") . ','; |
| [816](#L816) | } |
| [817](#L817) | } |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) |  |
| [821](#L821) |  |
| [822](#L822) | public function start\_export\_wp\_pages\_to\_html\_cron\_task( $datas, $settigs ) { |
| [823](#L823) | if(empty($datas) && $this->is\_cancel\_command\_found()){ |
| [824](#L824) | return; |
| [825](#L825) | } |
| [826](#L826) | if(!empty($settigs)){ |
| [827](#L827) | foreach ($settigs as $key => $setting){ |
| [828](#L828) | $this->setSettings($key, $setting); |
| [829](#L829) | } |
| [830](#L830) | } |
| [831](#L831) | //$this->removeAllSettings(); |
| [832](#L832) | $this->setSettings('task', 'running'); |
| [833](#L833) | $this->setSettings('pages\_data', $datas); |
| [834](#L834) |  |
| [835](#L835) |  |
| [836](#L836) | $ok = $this->create\_html\_files($datas); |
| [837](#L837) |  |
| [838](#L838) | if ($ok) { |
| [839](#L839) |  |
| [840](#L840) | $zipCreated = $this->zipWorkers($datas); |
| [841](#L841) | if($zipCreated){ |
| [842](#L842) | if ($this->getSettings('receive\_email')) { |
| [843](#L843) | /\*Sent emails\*/ |
| [844](#L844) | $this->sent\_email(); |
| [845](#L845) |  |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | $this->setSettings('task', 'completed'); |
| [849](#L849) | }else{ |
| [850](#L850) | $this->setTaskFailed(); |
| [851](#L851) |  |
| [852](#L852) | if ($this->getSettings('receive\_email')) { |
| [853](#L853) | /\*Sent emails\*/ |
| [854](#L854) | $this->sent\_email(true); |
| [855](#L855) | } |
| [856](#L856) | } |
| [857](#L857) | } else { |
| [858](#L858) | $this->setTaskFailed(); |
| [859](#L859) |  |
| [860](#L860) | if ($this->getSettings('receive\_email')) { |
| [861](#L861) | /\*Sent emails\*/ |
| [862](#L862) | $this->sent\_email(true); |
| [863](#L863) | } |
| [864](#L864) | } |
| [865](#L865) | //delete\_transient( 'doing\_cron' ); |
| [866](#L866) | } |
| [867](#L867) |  |
| [868](#L868) | public function setTaskFailed() |
| [869](#L869) | { |
| [870](#L870) | $this->setSettings('task', 'failed'); |
| [871](#L871) | } |
| [872](#L872) |  |
| [873](#L873) | /\*\* |
| [874](#L874) | \* @param $url |
| [875](#L875) | \* @param $replace\_urls |
| [876](#L876) | \* @param $receive\_email |
| [877](#L877) | \* @param $full\_site |
| [878](#L878) | \* @param $path2 |
| [879](#L879) | \*/ |
| [880](#L880) | public function start\_export\_custom\_url\_to\_html\_cron\_task($url, $settings ) { |
| [881](#L881) | if(empty($url)){ |
| [882](#L882) | return false; |
| [883](#L883) | } |
| [884](#L884) | if(!empty($settings)){ |
| [885](#L885) | foreach ($settings as $key => $setting){ |
| [886](#L886) | $this->setSettings($key, $setting); |
| [887](#L887) | } |
| [888](#L888) | } |
| [889](#L889) | //$this->removeAllSettings(); |
| [890](#L890) | $this->setSettings('task', 'running'); |
| [891](#L891) |  |
| [892](#L892) | $ok = $this->create\_html\_files($url, true); |
| [893](#L893) |  |
| [894](#L894) | if ($ok && !$this->is\_cancel\_command\_found()) { |
| [895](#L895) |  |
| [896](#L896) | $zipCreated = $this->zipWorkers($url, true); |
| [897](#L897) | if($zipCreated){ |
| [898](#L898) | if ($this->getSettings('receive\_email')) { |
| [899](#L899) | /\*Sent emails\*/ |
| [900](#L900) | $this->sent\_email(); |
| [901](#L901) | } |
| [902](#L902) |  |
| [903](#L903) | $this->setSettings('is\_zip\_downloaded', 'no'); |
| [904](#L904) | $this->setSettings('task', 'completed'); |
| [905](#L905) | }else{ |
| [906](#L906) | $this->setSettings('task', 'failed'); |
| [907](#L907) | if ($this->getSettings('receive\_email')) { |
| [908](#L908) | /\*Sent emails\*/ |
| [909](#L909) | $this->sent\_email(true); |
| [910](#L910) | } |
| [911](#L911) | } |
| [912](#L912) |  |
| [913](#L913) | } else { |
| [914](#L914) | $this->setSettings('task', 'failed'); |
| [915](#L915) | if ($this->getSettings('receive\_email')) { |
| [916](#L916) | /\*Sent emails\*/ |
| [917](#L917) | $this->sent\_email(true); |
| [918](#L918) | } |
| [919](#L919) | } |
| [920](#L920) | //wp\_clear\_scheduled\_hook('start\_export\_internal\_wp\_page\_to\_html\_event'); |
| [921](#L921) | } |
| [922](#L922) |  |
| [923](#L923) |  |
| [924](#L924) | public function get\_host($url='', $isScheme=true) |
| [925](#L925) | { |
| [926](#L926) | $url = parse\_url($url); |
| [927](#L927) | $scheme = isset($url['scheme']) ? $url['scheme'] : ''; |
| [928](#L928) |  |
| [929](#L929) | if($isScheme){ |
| [930](#L930) | $host = isset($url['host']) ? $scheme.'://'.$url['host'] : ''; |
| [931](#L931) | }else{ |
| [932](#L932) | $host = isset($url['host']) ? $url['host'] : ''; |
| [933](#L933) | } |
| [934](#L934) | return $host; |
| [935](#L935) | } |
| [936](#L936) |  |
| [937](#L937) | public function sent\_email($error = false) |
| [938](#L938) | { |
| [939](#L939) | $emails = $this->getSettings('email\_lists'); |
| [940](#L940) | $zipLink = $this->getSettings('zipDownloadLink'); |
| [941](#L941) | if (!empty($emails)) { |
| [942](#L942) |  |
| [943](#L943) | $emails = explode(',', $emails); |
| [944](#L944) |  |
| [945](#L945) | foreach ($emails as $key => $email) { |
| [946](#L946) | $to = $email; |
| [947](#L947) |  |
| [948](#L948) | if(!$error){ |
| [949](#L949) | $subject = 'HTML export has been completed!'; |
| [950](#L950) | $body = "Your last html export request has been completed. Please download the file from here: <a href='{$zipLink}'>{$zipLink}</a>"; |
| [951](#L951) | } |
| [952](#L952) | else{ |
| [953](#L953) | $subject = 'HTML export has been failed!'; |
| [954](#L954) | $body = "Your last html export request has been failed. Please check the logs"; |
| [955](#L955) | } |
| [956](#L956) | $headers = array('Content-Type: text/html; charset=UTF-8'); |
| [957](#L957) |  |
| [958](#L958) | $mailed = wp\_mail( $to, $subject, $body, $headers ); |
| [959](#L959) | if($mailed){ |
| [960](#L960) | $this->setSettings('mail\_send', true); |
| [961](#L961) | $this->update\_export\_log('mail\_send\_successfully' ); |
| [962](#L962) | } |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) | } |
| [966](#L966) | else { |
| [967](#L967) | $to = get\_bloginfo('admin\_email'); |
| [968](#L968) | if(!$error){ |
| [969](#L969) | $subject = 'HTML export has been completed!'; |
| [970](#L970) | $body = "Your last html export request has been completed. Please download the file from here: <a href='{$zipLink}'>{$zipLink}</a>"; |
| [971](#L971) | } |
| [972](#L972) | else{ |
| [973](#L973) | $subject = 'HTML export has been failed!'; |
| [974](#L974) | $body = "Your last html export request has been failed. Please check the logs"; |
| [975](#L975) | } |
| [976](#L976) | $headers = array('Content-Type: text/html; charset=UTF-8'); |
| [977](#L977) |  |
| [978](#L978) | $mailed = wp\_mail( $to, $subject, $body, $headers ); |
| [979](#L979) | if($mailed){ |
| [980](#L980) | $this->setSettings('mail\_send', true); |
| [981](#L981) | $this->update\_export\_log('mail\_send\_successfully' ); |
| [982](#L982) | } |
| [983](#L983) | } |
| [984](#L984) | } |
| [985](#L985) |  |
| [986](#L986) | public function create\_html\_files($datas, $custom\_url = false){ |
| [987](#L987) | if (!empty($datas)) { |
| [988](#L988) |  |
| [989](#L989) | /\*Clearing previous files and tables data\*/ |
| [990](#L990) | $this->clear\_tables\_and\_files(); |
| [991](#L991) |  |
| [992](#L992) | /\*Creating required direcories\*/ |
| [993](#L993) | if($this->getSaveAllAssetsToSpecificDir()){ |
| [994](#L994) | $this->create\_required\_directories(); |
| [995](#L995) | } |
| [996](#L996) |  |
| [997](#L997) | $this->setSettings('creating\_html\_process', 'running'); |
| [998](#L998) |  |
| [999](#L999) | if (!$custom\_url) { |
| [1000](#L1000) | if (!empty($datas)){ |
| [1001](#L1001) | $c = count($datas); |
| [1002](#L1002) | foreach ($datas as $page) { |
| [1003](#L1003) | $page\_id = $page; |
| [1004](#L1004) | if($page\_id=='home\_page'){ |
| [1005](#L1005) | $html\_filename = 'index.html'; |
| [1006](#L1006) | $url = home\_url('/'); |
| [1007](#L1007) | } |
| [1008](#L1008) | else{ |
| [1009](#L1009) | $post = get\_post($page\_id); |
| [1010](#L1010) | $html\_filename = $post->post\_name . '.html'; |
| [1011](#L1011) | $url = get\_permalink($page\_id); |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) | if($c == 1 && get\_option('rcExportHtmlCreateIndexOnSinglePage', true)){ |
| [1015](#L1015) | $html\_filename = 'index.html'; |
| [1016](#L1016) | } |
| [1017](#L1017) | $ok = $this->export\_wp\_page\_as\_static\_html\_by\_page\_id($url, $html\_filename); |
| [1018](#L1018) |  |
| [1019](#L1019) | if (!$ok) { |
| [1020](#L1020) | return  false; |
| [1021](#L1021) | break; |
| [1022](#L1022) | } |
| [1023](#L1023) | } |
| [1024](#L1024) | } |
| [1025](#L1025) |  |
| [1026](#L1026) |  |
| [1027](#L1027) | } |
| [1028](#L1028) | else { |
| [1029](#L1029) | $url = $datas; |
| [1030](#L1030) | $host = $this->get\_host($url); |
| [1031](#L1031) | if($this->getSettings('singlePage') && get\_option('rcExportHtmlCreateIndexOnSinglePage', true)){ |
| [1032](#L1032) | $html\_filename = 'index.html'; |
| [1033](#L1033) | } |
| [1034](#L1034) | elseif ($this->getSettings('full\_site')){ |
| [1035](#L1035) | $html\_filename = 'index.html'; |
| [1036](#L1036) | } |
| [1037](#L1037) | else{ |
| [1038](#L1038) | $html\_filename = $this->filter\_filename(basename($url)) . '.html'; |
| [1039](#L1039) | } |
| [1040](#L1040) | $ok = $this->export\_wp\_page\_as\_static\_html\_by\_page\_id($url, $html\_filename); |
| [1041](#L1041) | if (!$ok) { |
| [1042](#L1042) | return  false; |
| [1043](#L1043) | } |
| [1044](#L1044) | } |
| [1045](#L1045) |  |
| [1046](#L1046) | $log = $this->update\_export\_log('', 'all\_pages\_exported'); |
| [1047](#L1047) | $this->setSettings('creating\_html\_process', 'completed'); |
| [1048](#L1048) |  |
| [1049](#L1049) | /\*update\_option('rc\_expoting\_errors\_appear', false); |
| [1050](#L1050) | update\_option('rc\_previous\_logs\_count', '0');\*/ |
| [1051](#L1051) |  |
| [1052](#L1052) | } |
| [1053](#L1053) |  |
| [1054](#L1054) | return true; |
| [1055](#L1055) | } |
| [1056](#L1056) |  |
| [1057](#L1057) | public function setSettings( $settings\_name="", $value ="") |
| [1058](#L1058) | { |
| [1059](#L1059) | if(!empty($settings\_name)){ |
| [1060](#L1060) | $settings\_name = $this->settingsKey . $settings\_name; |
| [1061](#L1061) | update\_option($settings\_name, $value); |
| [1062](#L1062) | } |
| [1063](#L1063) | return true; |
| [1064](#L1064) | } |
| [1065](#L1065) |  |
| [1066](#L1066) | public function getSettings( $settings\_name="", $default = "") |
| [1067](#L1067) | { |
| [1068](#L1068) | $settings\_name = $this->settingsKey . $settings\_name; |
| [1069](#L1069) | $rc\_ewppth\_settings = get\_option($settings\_name); |
| [1070](#L1070) |  |
| [1071](#L1071) | if(empty($rc\_ewppth\_settings) && !empty($default)){ |
| [1072](#L1072) | return $default; |
| [1073](#L1073) | } |
| [1074](#L1074) |  |
| [1075](#L1075) | return $rc\_ewppth\_settings; |
| [1076](#L1076) | } |
| [1077](#L1077) |  |
| [1078](#L1078) | public function removeSettings( $settings\_name="") |
| [1079](#L1079) | { |
| [1080](#L1080) | $settings\_name = $this->settingsKey . $settings\_name; |
| [1081](#L1081) | $rc\_ewppth\_settings = delete\_option($settings\_name); |
| [1082](#L1082) |  |
| [1083](#L1083) | if ($rc\_ewppth\_settings) { |
| [1084](#L1084) | return true; |
| [1085](#L1085) | } |
| [1086](#L1086) | return false; |
| [1087](#L1087) | } |
| [1088](#L1088) |  |
| [1089](#L1089) | public function removeAllSettings() |
| [1090](#L1090) | { |
| [1091](#L1091) | global $wpdb; |
| [1092](#L1092) |  |
| [1093](#L1093) | // Sanitize settingsKey |
| [1094](#L1094) | $settingsKey = esc\_sql($this->settingsKey); |
| [1095](#L1095) |  |
| [1096](#L1096) | // Construct the SQL query |
| [1097](#L1097) | $query = " |
| [1098](#L1098) | UPDATE {$wpdb->prefix}options |
| [1099](#L1099) | SET option\_value = '' |
| [1100](#L1100) | WHERE option\_name LIKE '{$settingsKey}%' |
| [1101](#L1101) | "; |
| [1102](#L1102) |  |
| [1103](#L1103) | // Execute the query |
| [1104](#L1104) | $removefromdb = $wpdb->query($query); |
| [1105](#L1105) |  |
| [1106](#L1106) | return $removefromdb !== false; |
| [1107](#L1107) | } |
| [1108](#L1108) |  |
| [1109](#L1109) |  |
| [1110](#L1110) |  |
| [1111](#L1111) |  |
| [1112](#L1112) | public function get\_zip\_name($datas='') |
| [1113](#L1113) | { |
| [1114](#L1114) | $name = ""; |
| [1115](#L1115) | $x = 0; |
| [1116](#L1116) | if (!empty($datas)) { |
| [1117](#L1117) | foreach ($datas as $page) { |
| [1118](#L1118) | if ($x <= 2) { |
| [1119](#L1119) |  |
| [1120](#L1120) | if($page == "home\_page"){ |
| [1121](#L1121) | $zipFileName = $this->get\_host(home\_url(), false) . '-homepage'; |
| [1122](#L1122) | } |
| [1123](#L1123) | else{ |
| [1124](#L1124) | $post = get\_post($page); |
| [1125](#L1125) | $zipFileName = isset($post->post\_name) ? $post->post\_name : ""; |
| [1126](#L1126) | } |
| [1127](#L1127) | } |
| [1128](#L1128) | $name .= $zipFileName . '&'; |
| [1129](#L1129) |  |
| [1130](#L1130) | $x++; |
| [1131](#L1131) | } |
| [1132](#L1132) | } |
| [1133](#L1133) |  |
| [1134](#L1134) | if ($x>2) { |
| [1135](#L1135) | $more = ($this->get\_exported\_html\_files\_count()-3); |
| [1136](#L1136) |  |
| [1137](#L1137) | if($more !== 0){ |
| [1138](#L1138) | if ($more < 2) { |
| [1139](#L1139) | $name .= $more . '-more-page'; |
| [1140](#L1140) | } |
| [1141](#L1141) | else{ |
| [1142](#L1142) | $name .= $more . '-more-pages'; |
| [1143](#L1143) | } |
| [1144](#L1144) | } |
| [1145](#L1145) |  |
| [1146](#L1146) | } |
| [1147](#L1147) |  |
| [1148](#L1148) | return rtrim($name, '&'); |
| [1149](#L1149) | } |
| [1150](#L1150) |  |
| [1151](#L1151) | public function get\_exported\_html\_files\_count() |
| [1152](#L1152) | { |
| [1153](#L1153) | global $wpdb; |
| [1154](#L1154) |  |
| [1155](#L1155) | // Prepare the SQL query |
| [1156](#L1156) | $query = $wpdb->prepare( |
| [1157](#L1157) | "SELECT COUNT(\*) FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE type = %s", |
| [1158](#L1158) | 'created\_html\_file' |
| [1159](#L1159) | ); |
| [1160](#L1160) |  |
| [1161](#L1161) | // Execute the query and get the count |
| [1162](#L1162) | $count = $wpdb->get\_var($query); |
| [1163](#L1163) |  |
| [1164](#L1164) | return $count; |
| [1165](#L1165) | } |
| [1166](#L1166) |  |
| [1167](#L1167) |  |
| [1168](#L1168) | public function if\_fullsite\_export\_command\_found($datas, $return\_data = false){ |
| [1169](#L1169) | if (!empty($datas)) { |
| [1170](#L1170) | foreach ($datas as $key => $page) { |
| [1171](#L1171) | if ($page->page\_id == 'home\_page') { |
| [1172](#L1172) | if ($page->is\_full\_site == true) { |
| [1173](#L1173) | if ($return\_data) { |
| [1174](#L1174) | return $page; |
| [1175](#L1175) | } |
| [1176](#L1176) | else { |
| [1177](#L1177) | return true; |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | break; |
| [1181](#L1181) | } |
| [1182](#L1182) | } |
| [1183](#L1183) | } |
| [1184](#L1184) | } |
| [1185](#L1185) | return false; |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | public function add\_rc\_url\_to\_replace\_data($find\_data = "", $replace\_data = ""){ |
| [1189](#L1189) |  |
| [1190](#L1190) | $gop = get\_option('rc\_url\_to\_replace'); |
| [1191](#L1191) |  |
| [1192](#L1192) | $find = $replace = array(); |
| [1193](#L1193) | if (!empty($gop)) { |
| [1194](#L1194) | $find = $gop['find']; |
| [1195](#L1195) | $replace = $gop['replace']; |
| [1196](#L1196) | } |
| [1197](#L1197) |  |
| [1198](#L1198) | if (!empty($find\_data)&&!in\_array($find\_data, $find)) { |
| [1199](#L1199) | $find[] = $find\_data; |
| [1200](#L1200) | $replace[] = $replace\_data; |
| [1201](#L1201) |  |
| [1202](#L1202) | $u = array(); |
| [1203](#L1203) | $u['find'] = $find; |
| [1204](#L1204) | $u['replace'] = $replace; |
| [1205](#L1205) |  |
| [1206](#L1206) | update\_option('rc\_url\_to\_replace', $u); |
| [1207](#L1207) |  |
| [1208](#L1208) | return $u; |
| [1209](#L1209) | } else { |
| [1210](#L1210) | return $gop; |
| [1211](#L1211) | } |
| [1212](#L1212) |  |
| [1213](#L1213) | } |
| [1214](#L1214) |  |
| [1215](#L1215) | public function get\_find\_as\_key\_replace\_as\_value($f\_link = "", $middle\_path = false){ |
| [1216](#L1216) | $values = $this->add\_rc\_url\_to\_replace\_data(); |
| [1217](#L1217) |  |
| [1218](#L1218) | $fr = array(); |
| [1219](#L1219) | if (isset($values['find'])&&isset($values['replace'])&&!empty($values['find'])&&!empty($values['replace'])) { |
| [1220](#L1220) | foreach ($values['find'] as $key => $value) { |
| [1221](#L1221) |  |
| [1222](#L1222) | if ($middle\_path && !empty($f\_link)) { |
| [1223](#L1223) | if ($fr[$value] == $f\_link) { |
| [1224](#L1224) | return $values['replace'][$key]; |
| [1225](#L1225) | break; |
| [1226](#L1226) | } |
| [1227](#L1227) | } else { |
| [1228](#L1228) | $fr[$value] = $values['replace'][$key]; |
| [1229](#L1229) | } |
| [1230](#L1230) | } |
| [1231](#L1231) | } |
| [1232](#L1232) |  |
| [1233](#L1233) |  |
| [1234](#L1234) | return $fr; |
| [1235](#L1235) | } |
| [1236](#L1236) |  |
| [1237](#L1237) | public function get\_replace\_data\_by\_url($url='') |
| [1238](#L1238) | { |
| [1239](#L1239) | $values = $this->add\_rc\_url\_to\_replace\_data(); |
| [1240](#L1240) |  |
| [1241](#L1241) | $fr = array(); |
| [1242](#L1242) | if (isset($values['find'])&&isset($values['replace'])&&!empty($values['find'])&&!empty($values['replace'])) { |
| [1243](#L1243) | foreach ($values['find'] as $key => $value) { |
| [1244](#L1244) | /\*$arr = array(); |
| [1245](#L1245) | $arr['find'] = $value; |
| [1246](#L1246) | $arr['replace'] = $values['replace'][$key]; |
| [1247](#L1247) | $fr[] = $arr;\*/ |
| [1248](#L1248) |  |
| [1249](#L1249) | if ($url == $value) { |
| [1250](#L1250) | return $values['replace'][$key]; |
| [1251](#L1251) | break; |
| [1252](#L1252) | } |
| [1253](#L1253) | } |
| [1254](#L1254) | } |
| [1255](#L1255) | return false; |
| [1256](#L1256) | } |
| [1257](#L1257) |  |
| [1258](#L1258) | public function get\_find\_data\_by\_slug($slug='') |
| [1259](#L1259) | { |
| [1260](#L1260) | $values = $this->add\_rc\_url\_to\_replace\_data(); |
| [1261](#L1261) |  |
| [1262](#L1262) | $fr = array(); |
| [1263](#L1263) | if (isset($values['find'])&&isset($values['replace'])&&!empty($values['find'])&&!empty($values['replace'])) { |
| [1264](#L1264) | foreach ($values['replace'] as $key => $value) { |
| [1265](#L1265) |  |
| [1266](#L1266) | if ($slug == $value) { |
| [1267](#L1267) | return $values['find'][$key]; |
| [1268](#L1268) | break; |
| [1269](#L1269) | } |
| [1270](#L1270) | } |
| [1271](#L1271) | } |
| [1272](#L1272) | return false; |
| [1273](#L1273) | } |
| [1274](#L1274) |  |
| [1275](#L1275) | public function rc\_path\_to\_dot($url){ |
| [1276](#L1276) | if($this->getSettings('customUrl') && $this->getSettings('full\_site')){ |
| [1277](#L1277) | $url = str\_replace( array($this->getSettings('customUrlAddress')), array(''), $url); |
| [1278](#L1278) | } |
| [1279](#L1279) | $middle\_path = str\_replace( array(home\_url(), $this->get\_host($url)), array('', ''), $url); |
| [1280](#L1280) | $middle\_path = $this->ltrim\_and\_rtrim($middle\_path, '/'); |
| [1281](#L1281) |  |
| [1282](#L1282) | if($this->getSettings('customUrl') && $this->getSettings('singlePage')){ |
| [1283](#L1283) | $middle\_path = ""; |
| [1284](#L1284) | } |
| [1285](#L1285) |  |
| [1286](#L1286) | $p = './'; |
| [1287](#L1287) | if (!empty($middle\_path)) { |
| [1288](#L1288) | $middle\_path = explode('/', $middle\_path); |
| [1289](#L1289) | for ($i=1; $i < count($middle\_path); $i++) { |
| [1290](#L1290) | $p .= '../'; |
| [1291](#L1291) | } |
| [1292](#L1292) | } |
| [1293](#L1293) |  |
| [1294](#L1294) | return $p; |
| [1295](#L1295) | } |
| [1296](#L1296) | public function host($url) { |
| [1297](#L1297) | $url = parse\_url($url); |
| [1298](#L1298) | //$scheme = isset($url['scheme']) ? $url['scheme'] : ''; |
| [1299](#L1299) | $host = isset($url['host']) ? $url['host'] : ''; |
| [1300](#L1300) | return $host; |
| [1301](#L1301) | } |
| [1302](#L1302) | public function rc\_get\_url\_middle\_path($url, $custom\_url = false, $full\_site = false){ |
| [1303](#L1303) | $url = explode('?', $url)[0]; |
| [1304](#L1304) | $url = explode('#', $url)[0]; |
| [1305](#L1305) | if($this->getSettings('customUrl') && $this->getSettings('full\_site')){ |
| [1306](#L1306) | $url = str\_replace( array($this->getSettings('customUrlAddress')), array(''), $url); |
| [1307](#L1307) | } |
| [1308](#L1308) | $middle\_path = str\_replace( array(home\_url(), $this->get\_host($url)), array('', ''), $url); |
| [1309](#L1309) | $middle\_path = $this->ltrim\_and\_rtrim($middle\_path, '/'); |
| [1310](#L1310) | //$middle\_path = explode($middle\_path); |
| [1311](#L1311) |  |
| [1312](#L1312) |  |
| [1313](#L1313) | $middle\_path = str\_replace( basename($url), '', $middle\_path); |
| [1314](#L1314) |  |
| [1315](#L1315) | if($this->getSettings('customUrl') && $this->getSettings('singlePage')){ |
| [1316](#L1316) | $middle\_path = ""; |
| [1317](#L1317) | } |
| [1318](#L1318) |  |
| [1319](#L1319) |  |
| [1320](#L1320) | return $middle\_path; |
| [1321](#L1321) | } |
| [1322](#L1322) |  |
| [1323](#L1323) | public function middle\_path\_for\_filename($url='') |
| [1324](#L1324) | { |
| [1325](#L1325) | $middle\_path = $this->rc\_get\_url\_middle\_path($url); |
| [1326](#L1326) | $middle\_path\_slash\_cut = rtrim($middle\_path, '/') ; |
| [1327](#L1327) |  |
| [1328](#L1328) | $path\_dir = explode( '/', $middle\_path\_slash\_cut); |
| [1329](#L1329) |  |
| [1330](#L1330) | $path\_dir\_dash = ''; |
| [1331](#L1331) |  |
| [1332](#L1332) | if (strpos($url, '-child') !== false) { |
| [1333](#L1333) | if (count($path\_dir) > 2) { |
| [1334](#L1334) | for ($i=1; $i < count($path\_dir); $i++) { |
| [1335](#L1335) | $path\_dir\_dash .= $path\_dir[$i] . '-'; |
| [1336](#L1336) | } |
| [1337](#L1337) | } |
| [1338](#L1338) | } else { |
| [1339](#L1339) | if (count($path\_dir) > 2) { |
| [1340](#L1340) | for ($i=2; $i < count($path\_dir); $i++) { |
| [1341](#L1341) | $path\_dir\_dash .= $path\_dir[$i] . '-'; |
| [1342](#L1342) | } |
| [1343](#L1343) | } |
| [1344](#L1344) | } |
| [1345](#L1345) |  |
| [1346](#L1346) | if(empty($path\_dir\_dash)){ |
| [1347](#L1347) | $path\_dir\_dash = $this->generate\_string(3) . '-'; |
| [1348](#L1348) | } |
| [1349](#L1349) |  |
| [1350](#L1350) | //$path\_dir\_dash = rtrim($path\_dir\_dash, '-'); |
| [1351](#L1351) |  |
| [1352](#L1352) | return $path\_dir\_dash; |
| [1353](#L1353) | } |
| [1354](#L1354) |  |
| [1355](#L1355) |  |
| [1356](#L1356) | /\*\* |
| [1357](#L1357) | \* @since 2.0.4 |
| [1358](#L1358) | \* @param int $strength |
| [1359](#L1359) | \* @return string |
| [1360](#L1360) | \*/ |
| [1361](#L1361) | public function generate\_string($strength = 16) { |
| [1362](#L1362) | $input = '0123456789abcdefghijklmnopqrstuvwxyz'; |
| [1363](#L1363) | $input\_length = strlen($input); |
| [1364](#L1364) | $random\_string = ''; |
| [1365](#L1365) | for($i = 0; $i < $strength; $i++) { |
| [1366](#L1366) | $random\_character = $input[mt\_rand(0, $input\_length - 1)]; |
| [1367](#L1367) | $random\_string .= $random\_character; |
| [1368](#L1368) | } |
| [1369](#L1369) |  |
| [1370](#L1370) | return $random\_string; |
| [1371](#L1371) | } |
| [1372](#L1372) |  |
| [1373](#L1373) | public function rc\_is\_link\_already\_generated($url = '') |
| [1374](#L1374) | { |
| [1375](#L1375) | global $wpdb; |
| [1376](#L1376) |  |
| [1377](#L1377) | // Remove protocol from URL |
| [1378](#L1378) | $url = str\_replace(array('http:', 'https:'), '', $url); |
| [1379](#L1379) | $url = $this->removeParam(urldecode($url), 'ver'); |
| [1380](#L1380) |  |
| [1381](#L1381) | // Sanitize the URL for use in a SQL LIKE statement |
| [1382](#L1382) | $like\_url = '%' . $wpdb->esc\_like($url); |
| [1383](#L1383) |  |
| [1384](#L1384) | // Prepare and execute the SQL query |
| [1385](#L1385) | $query = $wpdb->prepare( |
| [1386](#L1386) | "SELECT \* FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE path LIKE %s", |
| [1387](#L1387) | $like\_url |
| [1388](#L1388) | ); |
| [1389](#L1389) |  |
| [1390](#L1390) | $results = $wpdb->get\_results($query); |
| [1391](#L1391) |  |
| [1392](#L1392) | return !empty($results); |
| [1393](#L1393) | } |
| [1394](#L1394) |  |
| [1395](#L1395) |  |
| [1396](#L1396) |  |
| [1397](#L1397) |  |
| [1398](#L1398) | public function rc\_redirect\_for\_export\_page\_as\_html() { |
| [1399](#L1399) | if (isset($\_GET['rc\_exported\_zip\_file'])) { |
| [1400](#L1400) | $url = urldecode(esc\_url($\_GET['rc\_exported\_zip\_file'])); |
| [1401](#L1401) | //$this->setSettings('rc\_is\_export\_pages\_zip\_downloaded', 'yes'); |
| [1402](#L1402) | wp\_safe\_redirect($url); |
| [1403](#L1403) | exit; |
| [1404](#L1404) | } |
| [1405](#L1405) | } |
| [1406](#L1406) |  |
| [1407](#L1407) |  |
| [1408](#L1408) | public function ltrim\_and\_rtrim($backend\_file\_url\_full='', $sym = "") |
| [1409](#L1409) | { |
| [1410](#L1410) | if (empty($sym)) { |
| [1411](#L1411) | $backend\_file\_url\_full = urldecode($backend\_file\_url\_full); |
| [1412](#L1412) | $backend\_file\_url\_full = ltrim($backend\_file\_url\_full, "'"); |
| [1413](#L1413) | $backend\_file\_url\_full = rtrim($backend\_file\_url\_full, "'"); |
| [1414](#L1414) | $backend\_file\_url\_full = ltrim($backend\_file\_url\_full, '"'); |
| [1415](#L1415) | $backend\_file\_url\_full = rtrim($backend\_file\_url\_full, '"'); |
| [1416](#L1416) |  |
| [1417](#L1417) | } |
| [1418](#L1418) | else { |
| [1419](#L1419) | $backend\_file\_url\_full = ltrim($backend\_file\_url\_full, $sym); |
| [1420](#L1420) | $backend\_file\_url\_full = rtrim($backend\_file\_url\_full, $sym); |
| [1421](#L1421) | } |
| [1422](#L1422) | return $backend\_file\_url\_full; |
| [1423](#L1423) | } |
| [1424](#L1424) |  |
| [1425](#L1425) |  |
| [1426](#L1426) |  |
| [1427](#L1427) | public function rc\_export\_html\_general\_admin\_notice(){ |
| [1428](#L1428) |  |
| [1429](#L1429) | $html\_export\_process = $this->getSettings('task'); |
| [1430](#L1430) | $is\_zip\_downloaded = $this->getSettings('is\_export\_pages\_zip\_downloaded', false); |
| [1431](#L1431) |  |
| [1432](#L1432) | if ($html\_export\_process == 'running' && !$is\_zip\_downloaded) { |
| [1433](#L1433) | echo '<div class="notice notice-warning is-dismissible export-html-notice"> |
| [1434](#L1434) | <p>HTML exporting task has been running... <a href="options-general.php?page=export-wp-page-to-html&notice=true">View details</a></p> |
| [1435](#L1435) | </div>'; |
| [1436](#L1436) | } |
| [1437](#L1437) | elseif ($html\_export\_process == 'completed') { |
| [1438](#L1438) | echo '<div class="notice notice-success is-dismissible export-html-notice"> |
| [1439](#L1439) | <p>HTML exporting task has been completed. <a href="options-general.php?page=export-wp-page-to-html&notice=true">View results</a></p> |
| [1440](#L1440) | </div>'; |
| [1441](#L1441) | } |
| [1442](#L1442) | } |
| [1443](#L1443) |  |
| [1444](#L1444) |  |
| [1445](#L1445) | public function xcurl($url,$print=false,$ref=null,$post=array(),$ua="Mozilla/5.0 (Windows NT 10.0; Win64; x64; rv:66.0) Gecko/20100101 Firefox/66.0") { |
| [1446](#L1446) | $ch = curl\_init(); |
| [1447](#L1447) | curl\_setopt($ch, CURLOPT\_AUTOREFERER, true); |
| [1448](#L1448) | if(!empty($ref)) { |
| [1449](#L1449) | curl\_setopt($ch, CURLOPT\_REFERER, $ref); |
| [1450](#L1450) | } |
| [1451](#L1451) | curl\_setopt($ch, CURLOPT\_URL, $url); |
| [1452](#L1452) | curl\_setopt($ch, CURLOPT\_HEADER, 0); |
| [1453](#L1453) | curl\_setopt($ch, CURLOPT\_FOLLOWLOCATION, 1); |
| [1454](#L1454) | curl\_setopt($ch, CURLOPT\_RETURNTRANSFER, 1); |
| [1455](#L1455) | if(!empty($ua)) { |
| [1456](#L1456) | curl\_setopt($ch, CURLOPT\_USERAGENT, $ua); |
| [1457](#L1457) | } |
| [1458](#L1458) | if(!empty($post)){ |
| [1459](#L1459) | curl\_setopt($ch, CURLOPT\_POST, 1); |
| [1460](#L1460) | curl\_setopt($ch, CURLOPT\_POSTFIELDS, $post); |
| [1461](#L1461) | } |
| [1462](#L1462) | curl\_setopt($ch, CURLOPT\_SSL\_VERIFYPEER, false); |
| [1463](#L1463) | $output = curl\_exec($ch); |
| [1464](#L1464) | curl\_close($ch); |
| [1465](#L1465) | //        if($print) { |
| [1466](#L1466) | //            print($output); |
| [1467](#L1467) | //        } else { |
| [1468](#L1468) | return $output; |
| [1469](#L1469) | //        } |
| [1470](#L1470) | } |
| [1471](#L1471) |  |
| [1472](#L1472) |  |
| [1473](#L1473) | public function is\_url\_already\_read($url = '') |
| [1474](#L1474) | { |
| [1475](#L1475) | global $wpdb; |
| [1476](#L1476) |  |
| [1477](#L1477) | // Prepare and execute the SQL query |
| [1478](#L1478) | $query = $wpdb->prepare( |
| [1479](#L1479) | "SELECT \* FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE path = %s", |
| [1480](#L1480) | $url |
| [1481](#L1481) | ); |
| [1482](#L1482) |  |
| [1483](#L1483) | $result = $wpdb->get\_results($query); |
| [1484](#L1484) |  |
| [1485](#L1485) | return !empty($result); |
| [1486](#L1486) | } |
| [1487](#L1487) |  |
| [1488](#L1488) |  |
| [1489](#L1489) |  |
| [1490](#L1490) |  |
| [1491](#L1491) | public function normalizePath($path) |
| [1492](#L1492) | { |
| [1493](#L1493) | $parts = array();// Array to build a new path from the good parts |
| [1494](#L1494) | $path = str\_replace('\\', '/', $path);// Replace backslashes with forwardslashes |
| [1495](#L1495) | $path = preg\_replace('/\/+/', '/', $path);// Combine multiple slashes into a single slash |
| [1496](#L1496) | $segments = explode('/', $path);// Collect path segments |
| [1497](#L1497) | $test = '';// Initialize testing variable |
| [1498](#L1498) | foreach($segments as $segment) |
| [1499](#L1499) | { |
| [1500](#L1500) | if($segment != '.') |
| [1501](#L1501) | { |
| [1502](#L1502) | $test = array\_pop($parts); |
| [1503](#L1503) | if(is\_null($test)) |
| [1504](#L1504) | $parts[] = $segment; |
| [1505](#L1505) | else if($segment == '..') |
| [1506](#L1506) | { |
| [1507](#L1507) | if($test == '..') |
| [1508](#L1508) | $parts[] = $test; |
| [1509](#L1509) |  |
| [1510](#L1510) | if($test == '..' || $test == '') |
| [1511](#L1511) | $parts[] = $segment; |
| [1512](#L1512) | } |
| [1513](#L1513) | else |
| [1514](#L1514) | { |
| [1515](#L1515) | $parts[] = $test; |
| [1516](#L1516) | $parts[] = $segment; |
| [1517](#L1517) | } |
| [1518](#L1518) | } |
| [1519](#L1519) | } |
| [1520](#L1520) | return implode('/', $parts); |
| [1521](#L1521) | } |
| [1522](#L1522) | public function get\_absolute\_path($path) { |
| [1523](#L1523) | $path = str\_replace(array('/', '\\'), DIRECTORY\_SEPARATOR, $path); |
| [1524](#L1524) | $parts = array\_filter(explode(DIRECTORY\_SEPARATOR, $path), 'strlen'); |
| [1525](#L1525) | $absolutes = array(); |
| [1526](#L1526) | foreach ($parts as $part) { |
| [1527](#L1527) | if ('.' == $part) continue; |
| [1528](#L1528) | if ('..' == $part) { |
| [1529](#L1529) | array\_pop($absolutes); |
| [1530](#L1530) | } else { |
| [1531](#L1531) | $absolutes[] = $part; |
| [1532](#L1532) | } |
| [1533](#L1533) | } |
| [1534](#L1534) | return implode('/', $absolutes); |
| [1535](#L1535) | } |
| [1536](#L1536) |  |
| [1537](#L1537) |  |
| [1538](#L1538) |  |
| [1539](#L1539) | public function is\_cancel\_command\_found() |
| [1540](#L1540) | { |
| [1541](#L1541) |  |
| [1542](#L1542) | //        global $wpdb; |
| [1543](#L1543) | //        $result = $wpdb->get\_var("SELECT COUNT(\*) FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE type = 'cancel\_export\_process' "); |
| [1544](#L1544) | $result = $this->getSettings('cancel\_command', 0); |
| [1545](#L1545) | if ($result) { |
| [1546](#L1546) | return true; |
| [1547](#L1547) | } |
| [1548](#L1548) | return false; |
| [1549](#L1549) | } |
| [1550](#L1550) |  |
| [1551](#L1551) | public function get\_total\_exported\_file() |
| [1552](#L1552) | { |
| [1553](#L1553) | global $wpdb; |
| [1554](#L1554) |  |
| [1555](#L1555) | // Prepare and execute the SQL query |
| [1556](#L1556) | $query = $wpdb->prepare( |
| [1557](#L1557) | "SELECT COUNT(\*) FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE type = %s OR type = %s", |
| [1558](#L1558) | 'copying', |
| [1559](#L1559) | 'creating\_html\_file' |
| [1560](#L1560) | ); |
| [1561](#L1561) |  |
| [1562](#L1562) | $result = $wpdb->get\_var($query); |
| [1563](#L1563) |  |
| [1564](#L1564) | return $result; |
| [1565](#L1565) | } |
| [1566](#L1566) |  |
| [1567](#L1567) | public function get\_total\_uploaded\_file() |
| [1568](#L1568) | { |
| [1569](#L1569) | global $wpdb; |
| [1570](#L1570) |  |
| [1571](#L1571) | // Prepare and execute the SQL query |
| [1572](#L1572) | $query = $wpdb->prepare( |
| [1573](#L1573) | "SELECT COUNT(\*) FROM {$wpdb->prefix}export\_page\_to\_html\_logs WHERE type = %s", |
| [1574](#L1574) | 'file\_uploaded\_to\_ftp' |
| [1575](#L1575) | ); |
| [1576](#L1576) |  |
| [1577](#L1577) | $result = $wpdb->get\_var($query); |
| [1578](#L1578) |  |
| [1579](#L1579) | return $result; |
| [1580](#L1580) | } |
| [1581](#L1581) |  |
| [1582](#L1582) |  |
| [1583](#L1583) |  |
| [1584](#L1584) | public function before\_basename\_change2($basename, $url){ |
| [1585](#L1585) |  |
| [1586](#L1586) | $gop = get\_option('rc\_url\_to\_replace'); |
| [1587](#L1587) | return str\_replace($gop['find'], $gop['replace'], $basename); |
| [1588](#L1588) | } |
| [1589](#L1589) |  |
| [1590](#L1590) | public function get\_site\_scheme($url="") |
| [1591](#L1591) | { |
| [1592](#L1592) | $parse\_url = parse\_url($url); |
| [1593](#L1593) | if(isset($parse\_url['scheme'])){ |
| [1594](#L1594) | return $parse\_url['scheme']; |
| [1595](#L1595) | } |
| [1596](#L1596) |  |
| [1597](#L1597) | return false; |
| [1598](#L1598) | } |
| [1599](#L1599) |  |
| [1600](#L1600) | /\*\* |
| [1601](#L1601) | \* @return string |
| [1602](#L1602) | \*/ |
| [1603](#L1603) | public function getFontsPath() |
| [1604](#L1604) | { |
| [1605](#L1605) | return $this->fonts\_path; |
| [1606](#L1606) | } |
| [1607](#L1607) |  |
| [1608](#L1608) | /\*\* |
| [1609](#L1609) | \* @return string |
| [1610](#L1610) | \*/ |
| [1611](#L1611) | public function getCssPath() |
| [1612](#L1612) | { |
| [1613](#L1613) | return $this->css\_path; |
| [1614](#L1614) | } |
| [1615](#L1615) |  |
| [1616](#L1616) | /\*\* |
| [1617](#L1617) | \* @return string |
| [1618](#L1618) | \*/ |
| [1619](#L1619) | public function getImgPath() |
| [1620](#L1620) | { |
| [1621](#L1621) | return $this->img\_path; |
| [1622](#L1622) | } |
| [1623](#L1623) |  |
| [1624](#L1624) | /\*\* |
| [1625](#L1625) | \* @return string |
| [1626](#L1626) | \*/ |
| [1627](#L1627) | public function getVideosPath() |
| [1628](#L1628) | { |
| [1629](#L1629) | return $this->video\_path; |
| [1630](#L1630) | } |
| [1631](#L1631) | /\*\* |
| [1632](#L1632) | \* @return string |
| [1633](#L1633) | \*/ |
| [1634](#L1634) | public function getAudiosPath() |
| [1635](#L1635) | { |
| [1636](#L1636) | return $this->audio\_path; |
| [1637](#L1637) | } |
| [1638](#L1638) |  |
| [1639](#L1639) | /\*\* |
| [1640](#L1640) | \* @return string |
| [1641](#L1641) | \*/ |
| [1642](#L1642) | public function getDocsPath() |
| [1643](#L1643) | { |
| [1644](#L1644) | return $this->docs\_path; |
| [1645](#L1645) | } |
| [1646](#L1646) | /\*\* |
| [1647](#L1647) | \* @return string[] |
| [1648](#L1648) | \*/ |
| [1649](#L1649) | public function getImageExtensions() |
| [1650](#L1650) | { |
| [1651](#L1651) | return $this->image\_extensions; |
| [1652](#L1652) | } |
| [1653](#L1653) |  |
| [1654](#L1654) | /\*\* |
| [1655](#L1655) | \* @return string[] |
| [1656](#L1656) | \*/ |
| [1657](#L1657) | public function getVideoExtensions() |
| [1658](#L1658) | { |
| [1659](#L1659) | return $this->video\_extensions; |
| [1660](#L1660) | } |
| [1661](#L1661) | /\*\* |
| [1662](#L1662) | \* @return string[] |
| [1663](#L1663) | \*/ |
| [1664](#L1664) | public function getAudioExtensions() |
| [1665](#L1665) | { |
| [1666](#L1666) | return $this->audio\_extensions; |
| [1667](#L1667) | } |
| [1668](#L1668) |  |
| [1669](#L1669) | /\*\* |
| [1670](#L1670) | \* @return string[] |
| [1671](#L1671) | \*/ |
| [1672](#L1672) | public function getDocsExtensions() |
| [1673](#L1673) | { |
| [1674](#L1674) | return $this->docs\_extensions; |
| [1675](#L1675) | } |
| [1676](#L1676) | /\*\* |
| [1677](#L1677) | \* @return string[] |
| [1678](#L1678) | \*/ |
| [1679](#L1679) | public function getHtmlExtensions() |
| [1680](#L1680) | { |
| [1681](#L1681) | return $this->html\_extensions; |
| [1682](#L1682) | } |
| [1683](#L1683) |  |
| [1684](#L1684) | /\*\* |
| [1685](#L1685) | \* @return string[] |
| [1686](#L1686) | \*/ |
| [1687](#L1687) | public function getSiteData() |
| [1688](#L1688) | { |
| [1689](#L1689) | return $this->site\_data; |
| [1690](#L1690) | } |
| [1691](#L1691) |  |
| [1692](#L1692) | /\*\* |
| [1693](#L1693) | \* @return string |
| [1694](#L1694) | \*/ |
| [1695](#L1695) | public function getJsPath() |
| [1696](#L1696) | { |
| [1697](#L1697) | return $this->js\_path; |
| [1698](#L1698) | } |
| [1699](#L1699) |  |
| [1700](#L1700) | /\*\* |
| [1701](#L1701) | \* @return mixed |
| [1702](#L1702) | \*/ |
| [1703](#L1703) | public function getUploadDir() |
| [1704](#L1704) | { |
| [1705](#L1705) | return $this->upload\_dir; |
| [1706](#L1706) | } |
| [1707](#L1707) |  |
| [1708](#L1708) | /\*\* |
| [1709](#L1709) | \* @return extract\_stylesheets |
| [1710](#L1710) | \*/ |
| [1711](#L1711) | public function ExtractStylesheets() |
| [1712](#L1712) | { |
| [1713](#L1713) | return $this->extract\_stylesheets; |
| [1714](#L1714) | } |
| [1715](#L1715) |  |
| [1716](#L1716) | /\*\* |
| [1717](#L1717) | \* @return extract\_scripts |
| [1718](#L1718) | \*/ |
| [1719](#L1719) | public function ExtractScripts() |
| [1720](#L1720) | { |
| [1721](#L1721) | return $this->extract\_scripts; |
| [1722](#L1722) | } |
| [1723](#L1723) |  |
| [1724](#L1724) | /\*\* |
| [1725](#L1725) | \* @return extract\_images |
| [1726](#L1726) | \*/ |
| [1727](#L1727) | public function ExtractImages() |
| [1728](#L1728) | { |
| [1729](#L1729) | return $this->extract\_images; |
| [1730](#L1730) | } |
| [1731](#L1731) |  |
| [1732](#L1732) | /\*\* |
| [1733](#L1733) | \* @return inline\_css |
| [1734](#L1734) | \*/ |
| [1735](#L1735) | public function InlineCss() |
| [1736](#L1736) | { |
| [1737](#L1737) | return $this->inline\_css; |
| [1738](#L1738) | } |
| [1739](#L1739) |  |
| [1740](#L1740) | /\*\* |
| [1741](#L1741) | \* @return extract\_meta\_images |
| [1742](#L1742) | \*/ |
| [1743](#L1743) | public function ExtractMetaImages() |
| [1744](#L1744) | { |
| [1745](#L1745) | return $this->extract\_meta\_images; |
| [1746](#L1746) | } |
| [1747](#L1747) |  |
| [1748](#L1748) | /\*\* |
| [1749](#L1749) | \* @return extract\_videos |
| [1750](#L1750) | \*/ |
| [1751](#L1751) | public function ExtractVideos() |
| [1752](#L1752) | { |
| [1753](#L1753) | return $this->extract\_videos; |
| [1754](#L1754) | } |
| [1755](#L1755) |  |
| [1756](#L1756) | /\*\* |
| [1757](#L1757) | \* @return extract\_audios |
| [1758](#L1758) | \*/ |
| [1759](#L1759) | public function ExtractAudios() |
| [1760](#L1760) | { |
| [1761](#L1761) | return $this->extract\_audios; |
| [1762](#L1762) | } |
| [1763](#L1763) | /\*\* |
| [1764](#L1764) | \* @return extract\_docs |
| [1765](#L1765) | \*/ |
| [1766](#L1766) | public function ExtractDocs() |
| [1767](#L1767) | { |
| [1768](#L1768) | return $this->extract\_docs; |
| [1769](#L1769) | } |
| [1770](#L1770) |  |
| [1771](#L1771) |  |
| [1772](#L1772) | public function getExportDir() |
| [1773](#L1773) | { |
| [1774](#L1774) | return $this->export\_dir; |
| [1775](#L1775) | } |
| [1776](#L1776) | /\*\* |
| [1777](#L1777) | \* @return export\_temp\_dir |
| [1778](#L1778) | \*/ |
| [1779](#L1779) | public function getExportTempDir() |
| [1780](#L1780) | { |
| [1781](#L1781) | return $this->export\_temp\_dir; |
| [1782](#L1782) | } |
| [1783](#L1783) |  |
| [1784](#L1784) | public function getKeepSameName() |
| [1785](#L1785) | { |
| [1786](#L1786) | return $this->keepSameName; |
| [1787](#L1787) | } |
| [1788](#L1788) |  |
| [1789](#L1789) | public function getSaveAllAssetsToSpecificDir() |
| [1790](#L1790) | { |
| [1791](#L1791) | return $this->saveAllAssetsToSpecificDir; |
| [1792](#L1792) | } |
| [1793](#L1793) |  |
| [1794](#L1794) | public function getExportHtmlAddContentsToTheHeader() |
| [1795](#L1795) | { |
| [1796](#L1796) | return $this->rcExportHtmlAddContentsToTheHeader; |
| [1797](#L1797) | } |
| [1798](#L1798) |  |
| [1799](#L1799) | public function getExportHtmlAddContentsToTheFooter() |
| [1800](#L1800) | { |
| [1801](#L1801) | return $this->rcExportHtmlAddContentsToTheFooter; |
| [1802](#L1802) | } |
| [1803](#L1803) |  |
| [1804](#L1804) | public function exclude\_urls($exclude\_bool, $url) |
| [1805](#L1805) | { |
| [1806](#L1806) |  |
| [1807](#L1807) |  |
| [1808](#L1808) | $settingsExcludeUrls = str\_replace('%', '', get\_option('rcExportHtmlExcludeUrls')); |
| [1809](#L1809) | $settingsExcludeUrls = explode("\n", $settingsExcludeUrls); |
| [1810](#L1810) | if (!empty($settingsExcludeUrls)){ |
| [1811](#L1811) | foreach ($settingsExcludeUrls as $exclude\_url){ |
| [1812](#L1812) | if( !empty($exclude\_url) && strpos($url, $exclude\_url) !== false  ){ |
| [1813](#L1813) | return true; |
| [1814](#L1814) | break; |
| [1815](#L1815) | } |
| [1816](#L1816) | } |
| [1817](#L1817) | } |
| [1818](#L1818) |  |
| [1819](#L1819) | $urlBasename = $this->filter\_filename($url); |
| [1820](#L1820) | $urlExt = pathinfo($urlBasename, PATHINFO\_EXTENSION); |
| [1821](#L1821) |  |
| [1822](#L1822) | if(strpos( |
| [1823](#L1823) | $url, 'wp-admin') !== false |
| [1824](#L1824) | || strpos($url, 'action=lostpassword') !== false |
| [1825](#L1825) | || strpos($url, 'wp-login.php') !== false |
| [1826](#L1826) | || strpos($url, 'data:') !== false |
| [1827](#L1827) | || in\_array($urlExt, $this->getAudioExtensions()) |
| [1828](#L1828) | || in\_array($urlExt, $this->getVideoExtensions()) |
| [1829](#L1829) | || in\_array($urlExt, $this->getImageExtensions()) |
| [1830](#L1830) | || in\_array($urlExt, $this->getDocsExtensions()) |
| [1831](#L1831) | || in\_array($urlExt, $this->getHtmlExtensions()) |
| [1832](#L1832) | ){ |
| [1833](#L1833) | return true; |
| [1834](#L1834) | } |
| [1835](#L1835) |  |
| [1836](#L1836) | return $exclude\_bool; |
| [1837](#L1837) | } |
| [1838](#L1838) |  |
| [1839](#L1839) | public function exclude\_urls\_settings\_only($exclude\_bool, $url) |
| [1840](#L1840) | { |
| [1841](#L1841) | $settingsExcludeUrls = str\_replace('%', '', get\_option('rcExportHtmlExcludeUrls')); |
| [1842](#L1842) | $settingsExcludeUrls = explode("\n", $settingsExcludeUrls); |
| [1843](#L1843) | if (!empty($settingsExcludeUrls)){ |
| [1844](#L1844) | foreach ($settingsExcludeUrls as $exclude\_url){ |
| [1845](#L1845) | if( !empty($exclude\_url) && strpos($url, $exclude\_url) !== false  ){ |
| [1846](#L1846) | return true; |
| [1847](#L1847) | break; |
| [1848](#L1848) | } |
| [1849](#L1849) | } |
| [1850](#L1850) | } |
| [1851](#L1851) |  |
| [1852](#L1852) | if(strpos( |
| [1853](#L1853) | $url, 'wp-admin') !== false |
| [1854](#L1854) | || strpos($url, 'action=lostpassword') !== false |
| [1855](#L1855) | || strpos($url, 'wp-login.php') !== false |
| [1856](#L1856) | || strpos($url, 'data:') !== false |
| [1857](#L1857) | ){ |
| [1858](#L1858) | return true; |
| [1859](#L1859) | } |
| [1860](#L1860) |  |
| [1861](#L1861) | return $exclude\_bool; |
| [1862](#L1862) | } |
| [1863](#L1863) |  |
| [1864](#L1864) | public function include\_urls($include\_bool, $url) |
| [1865](#L1865) | { |
| [1866](#L1866) | $datas = $this->getSettings('pages\_data'); |
| [1867](#L1867) | //        $datas = stripslashes($datas); |
| [1868](#L1868) | //        $datas = @json\_decode($datas); |
| [1869](#L1869) | $url = rtrim($url, '/'); |
| [1870](#L1870) | if(!empty($datas)){ |
| [1871](#L1871) | foreach ($datas as $data) { |
| [1872](#L1872) | if($data == 'home\_page'){ |
| [1873](#L1873) | $permalink = home\_url(); |
| [1874](#L1874) | } |
| [1875](#L1875) | else{ |
| [1876](#L1876) | $permalink = @get\_permalink($data); |
| [1877](#L1877) | } |
| [1878](#L1878) | $permalink = rtrim($permalink, '/'); |
| [1879](#L1879) |  |
| [1880](#L1880) | if($url==$permalink){ |
| [1881](#L1881) | return true; |
| [1882](#L1882) | break; |
| [1883](#L1883) | } |
| [1884](#L1884) | } |
| [1885](#L1885) | } |
| [1886](#L1886) | return $include\_bool; |
| [1887](#L1887) | } |
| [1888](#L1888) |  |
| [1889](#L1889) | /\*\* |
| [1890](#L1890) | \* @param $main\_url |
| [1891](#L1891) | \* @param $full\_site |
| [1892](#L1892) | \* @param $middle\_path |
| [1893](#L1893) | \* @param $html\_filename |
| [1894](#L1894) | \*/ |
| [1895](#L1895) | public function saveHtmlFile($main\_url, $full\_site, $middle\_path, $html\_filename) |
| [1896](#L1896) | { |
| [1897](#L1897) | $path\_to\_dot = $this->rc\_path\_to\_dot($main\_url); |
| [1898](#L1898) |  |
| [1899](#L1899) |  |
| [1900](#L1900) | $html\_filename = $this->filter\_filename($html\_filename); |
| [1901](#L1901) | $my\_file = $this->getUploadDir() . '/exported\_html\_files/tmp\_files/' . $middle\_path . $html\_filename; |
| [1902](#L1902) | if (!file\_exists($my\_file)/\* && $this->update\_export\_log('', 'creating\_html\_file', $html\_filename)\*/) { |
| [1903](#L1903) |  |
| [1904](#L1904) | $src = str\_get\_html($this->site\_data); |
| [1905](#L1905) |  |
| [1906](#L1906) | /\*Replace urls to html path\*/ |
| [1907](#L1907) | //$this->replaceUrlsToLocalHtmlPath($main\_url, $full\_site, $path\_to\_dot, $middle\_path) |
| [1908](#L1908) | /\*$src = preg\_replace\_callback("/(?<=href=\").\*?(?=\")/", |
| [1909](#L1909) | function ($matches) use ($main\_url, $full\_site, $path\_to\_dot, $middle\_path) { |
| [1910](#L1910) | return call\_user\_func(array( $this, 'rc\_replaceUrlsToLocalHtmlPath'), $matches[0], $main\_url, $full\_site, $path\_to\_dot, $middle\_path); |
| [1911](#L1911) | } |
| [1912](#L1912) | , $src);\*/ |
| [1913](#L1913) | $anchors = $src->find('a'); |
| [1914](#L1914) | if(!empty($anchors)){ |
| [1915](#L1915) | foreach ($anchors as $anchor) { |
| [1916](#L1916) | $a = $anchor->href; |
| [1917](#L1917) |  |
| [1918](#L1918) | $url = apply\_filters('before\_url\_change\_to\_html', $a); |
| [1919](#L1919) | $url\_middle\_path = $this->rc\_get\_url\_middle\_path($url, true, true); |
| [1920](#L1920) |  |
| [1921](#L1921) | $exclude\_url = apply\_filters('wp\_page\_to\_html\_exclude\_urls', false, $url); |
| [1922](#L1922) | $urlsToExport = apply\_filters('wp\_page\_to\_html\_urls\_to\_export', false, $url); |
| [1923](#L1923) |  |
| [1924](#L1924) | if (!$full\_site) { |
| [1925](#L1925) | if ( $this->getSettings('replaceUrlsToHash', false) && !$urlsToExport) { |
| [1926](#L1926) | $anchor->href = "#"; |
| [1927](#L1927) | continue; |
| [1928](#L1928) | } |
| [1929](#L1929) | } |
| [1930](#L1930) |  |
| [1931](#L1931) | if(!$exclude\_url){ |
| [1932](#L1932) | if ($this->get\_host($url, false) == $this->get\_host($main\_url, false) && ($full\_site||$urlsToExport) ) { |
| [1933](#L1933) | //$basename = apply\_filters('before\_basename\_change', $basename); |
| [1934](#L1934) |  |
| [1935](#L1935) | $imgExts = array("gif", "jpg", "jpeg", "png", "tiff", "tif"); |
| [1936](#L1936) | $urlExt = pathinfo($url, PATHINFO\_EXTENSION); |
| [1937](#L1937) | //echo $urlExt; |
| [1938](#L1938) | if (in\_array($urlExt, $imgExts)) { |
| [1939](#L1939) | $basename = $this->url\_to\_basename($url); |
| [1940](#L1940) | $basename = $this->filter\_filename($basename); |
| [1941](#L1941) | $anchor->href =  $path\_to\_dot . 'images/' . $basename; |
| [1942](#L1942) | } else { |
| [1943](#L1943) | $basename = $this->url\_to\_basename($url, true, '.html'); |
| [1944](#L1944) | $basename = $this->filter\_filename($basename); |
| [1945](#L1945) | $anchor->href =  $path\_to\_dot . $url\_middle\_path . $basename; |
| [1946](#L1946) | } |
| [1947](#L1947) | } |
| [1948](#L1948) | } |
| [1949](#L1949) | } |
| [1950](#L1950) | } |
| [1951](#L1951) |  |
| [1952](#L1952) | if (!empty($this->getExportHtmlAddContentsToTheHeader()) || !empty($this->getExportHtmlAddContentsToTheHeader())) { |
| [1953](#L1953) | $e = @$src->find("body", 0); |
| [1954](#L1954) |  |
| [1955](#L1955) | if (!empty($e)) { |
| [1956](#L1956) | $e->outertext = wp\_kses\_post($this->getExportHtmlAddContentsToTheHeader()) . wp\_kses\_post($e->outertext) . wp\_kses\_post($this->getExportHtmlAddContentsToTheFooter()); |
| [1957](#L1957) | } |
| [1958](#L1958) | } |
| [1959](#L1959) |  |
| [1960](#L1960) | $src = (string) $src; |
| [1961](#L1961) |  |
| [1962](#L1962) | //            $src = $this->replaceOtherSiteUrls($src, $main\_url); |
| [1963](#L1963) | //            //$this->site\_data = $src2; |
| [1964](#L1964) | //            $handle = @fopen(esc\_html($my\_file), 'w') or die('Cannot open file:  ' . esc\_html($my\_file)); |
| [1965](#L1965) | //            $t = @fwrite($handle, $src); |
| [1966](#L1966) | //            if ($t) { |
| [1967](#L1967) | //                $this->update\_export\_log('', 'created\_html\_file', $middle\_path . $html\_filename); |
| [1968](#L1968) | //            } |
| [1969](#L1969) | //            fclose($handle); |
| [1970](#L1970) |  |
| [1971](#L1971) | // Ensure the WP\_Filesystem is available |
| [1972](#L1972) | if ( ! function\_exists( 'request\_filesystem\_credentials' ) ) { |
| [1973](#L1973) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [1974](#L1974) | } |
| [1975](#L1975) |  |
| [1976](#L1976) | // Get the credentials and initialize the WP\_Filesystem |
| [1977](#L1977) | $creds = request\_filesystem\_credentials( site\_url() ); |
| [1978](#L1978) | if ( ! WP\_Filesystem( $creds ) ) { |
| [1979](#L1979) | // If we cannot initialize the filesystem, handle the error appropriately |
| [1980](#L1980) | return false; |
| [1981](#L1981) | } |
| [1982](#L1982) |  |
| [1983](#L1983) | global $wp\_filesystem; |
| [1984](#L1984) |  |
| [1985](#L1985) | // Replace the site URLs |
| [1986](#L1986) | $src = $this->replaceOtherSiteUrls($src, $main\_url); |
| [1987](#L1987) |  |
| [1988](#L1988) | // Use WP\_Filesystem to write to the file |
| [1989](#L1989) | if ( $wp\_filesystem->put\_contents( $my\_file, $src, FS\_CHMOD\_FILE ) ) { |
| [1990](#L1990) | $this->update\_export\_log('', 'created\_html\_file', $middle\_path . $html\_filename); |
| [1991](#L1991) | } else { |
| [1992](#L1992) | die('Cannot open file: ' . esc\_html($my\_file)); |
| [1993](#L1993) | } |
| [1994](#L1994) |  |
| [1995](#L1995) | } |
| [1996](#L1996) | $this->update\_urls\_log($main\_url, 1); |
| [1997](#L1997) |  |
| [1998](#L1998) | } |
| [1999](#L1999) |  |
| [2000](#L2000) |  |
| [2001](#L2001) | public function makeUrlWithoutProtocol($url) |
| [2002](#L2002) | { |
| [2003](#L2003) | $parsedUrl = parse\_url($url); |
| [2004](#L2004) | $host = isset($parsedUrl['host']) ? $parsedUrl['host'] : ''; |
| [2005](#L2005) | $path = isset($parsedUrl['path']) ? $parsedUrl['path'] : ''; |
| [2006](#L2006) |  |
| [2007](#L2007) | return $host . $path; |
| [2008](#L2008) | } |
| [2009](#L2009) |  |
| [2010](#L2010) |  |
| [2011](#L2011) | function addBackSlash($url){ |
| [2012](#L2012) | return str\_replace('/', '\/', $url); |
| [2013](#L2013) | } |
| [2014](#L2014) |  |
| [2015](#L2015) | public function replaceOtherSiteUrls($contents, $main\_url) |
| [2016](#L2016) | { |
| [2017](#L2017) | // Get the home URL without protocol |
| [2018](#L2018) | $home\_url\_without\_protocol = $this->makeUrlWithoutProtocol(home\_url()); |
| [2019](#L2019) |  |
| [2020](#L2020) | // Get the main URL without protocol |
| [2021](#L2021) | $main\_url\_without\_protocol = $this->makeUrlWithoutProtocol($main\_url); |
| [2022](#L2022) |  |
| [2023](#L2023) | // Check if the main URL is part of the home URL |
| [2024](#L2024) | if (strpos($main\_url\_without\_protocol, $home\_url\_without\_protocol) !== false) { |
| [2025](#L2025) | $main\_url = home\_url('/'); |
| [2026](#L2026) | } |
| [2027](#L2027) |  |
| [2028](#L2028) | // URLs to replace |
| [2029](#L2029) | $urlsToReplace = array( |
| [2030](#L2030) | 'https:\/\/' . $this->addBackSlash($main\_url\_without\_protocol), |
| [2031](#L2031) | 'http:\/\/' . $this->addBackSlash($main\_url\_without\_protocol), |
| [2032](#L2032) | '\/\/' . $this->addBackSlash($main\_url\_without\_protocol), |
| [2033](#L2033) | ); |
| [2034](#L2034) |  |
| [2035](#L2035) |  |
| [2036](#L2036) | // Escape the URLs for use in the regular expression |
| [2037](#L2037) | $escapedUrls = array\_map('preg\_quote', $urlsToReplace, array('/','/','/')); |
| [2038](#L2038) |  |
| [2039](#L2039) | // Pattern to match the specific URLs |
| [2040](#L2040) | $pattern = '/' . implode('|', $escapedUrls) . '/i'; |
| [2041](#L2041) |  |
| [2042](#L2042) | // Replace the specific URLs with a desired string, e.g., './' |
| [2043](#L2043) | $replacement = './'; |
| [2044](#L2044) | $processedText = preg\_replace($pattern, $replacement, $contents); |
| [2045](#L2045) |  |
| [2046](#L2046) | return $processedText; |
| [2047](#L2047) | } |
| [2048](#L2048) |  |
| [2049](#L2049) |  |
| [2050](#L2050) |  |
| [2051](#L2051) | /\* |
| [2052](#L2052) | \* @since 2.0.4 |
| [2053](#L2053) | \* @parm $name |
| [2054](#L2054) | \* @returns filename. |
| [2055](#L2055) | \*/ |
| [2056](#L2056) | public function filter\_filename($name) { |
| [2057](#L2057) | // remove illegal file system characters https://en.wikipedia.org/wiki/Filename#Reserved\_characters\_and\_words |
| [2058](#L2058) | $name = str\_replace(array\_merge( |
| [2059](#L2059) | array\_map('chr', range(0, 31)), |
| [2060](#L2060) | array('<', '>', ':', '"', '/', '\\', '|', '?', '\*') |
| [2061](#L2061) | ), '', $name); |
| [2062](#L2062) | // maximise filename length to 255 bytes http://serverfault.com/a/9548/44086 |
| [2063](#L2063) | $ext = pathinfo($name, PATHINFO\_EXTENSION); |
| [2064](#L2064) | $name= mb\_strcut(pathinfo($name, PATHINFO\_FILENAME), 0, 255 - ($ext ? strlen($ext) + 1 : 0), mb\_detect\_encoding($name)) . ($ext ? '.' . $ext : ''); |
| [2065](#L2065) | $name = str\_replace('=', '', $name); |
| [2066](#L2066) | return urldecode($name); |
| [2067](#L2067) | } |
| [2068](#L2068) |  |
| [2069](#L2069) | /\*\* |
| [2070](#L2070) | \* @param array $all\_links\_href |
| [2071](#L2071) | \* @param $custom\_url\_host |
| [2072](#L2072) | \* @param $full\_site |
| [2073](#L2073) | \* @param $replace\_urls\_to\_hash |
| [2074](#L2074) | \* @param $all\_links |
| [2075](#L2075) | \*/ |
| [2076](#L2076) | public function readAllLinks(array $all\_links\_href, $full\_site) |
| [2077](#L2077) | { |
| [2078](#L2078) | if (!empty($all\_links\_href)) { |
| [2079](#L2079) | foreach ($all\_links\_href as $key => $link) { |
| [2080](#L2080) |  |
| [2081](#L2081) | $url = $link; |
| [2082](#L2082) | $slug = basename($url); |
| [2083](#L2083) | $html\_filename = $slug . '.html'; |
| [2084](#L2084) |  |
| [2085](#L2085) | if (!$this->rc\_is\_link\_already\_generated($url)) { |
| [2086](#L2086) |  |
| [2087](#L2087) | $home\_url = home\_url(); |
| [2088](#L2088) |  |
| [2089](#L2089) | $url = explode('#', $url)[0]; |
| [2090](#L2090) | $url = explode('?', $url)[0]; |
| [2091](#L2091) |  |
| [2092](#L2092) | if ($slug !== 0 && !$this->is\_url\_already\_read($url)) { |
| [2093](#L2093) |  |
| [2094](#L2094) | if ($full\_site) { |
| [2095](#L2095) | $this->export\_wp\_page\_as\_static\_html\_by\_page\_id($url, $html\_filename); |
| [2096](#L2096) | } |
| [2097](#L2097) |  |
| [2098](#L2098) | } |
| [2099](#L2099) |  |
| [2100](#L2100) | } |
| [2101](#L2101) | } |
| [2102](#L2102) | } |
| [2103](#L2103) | } |
| [2104](#L2104) |  |
| [2105](#L2105) |  |
| [2106](#L2106) | public function create\_zip($files = array(), $destination = '', $middle\_patheplace\_path = "", $overwrite = true) { |
| [2107](#L2107) | if ($this->is\_cancel\_command\_found()) { |
| [2108](#L2108) | return false; |
| [2109](#L2109) | } |
| [2110](#L2110) | //if the zip file already exists and overwrite is false, return false |
| [2111](#L2111) | if(file\_exists($destination) && !$overwrite) { return false; } |
| [2112](#L2112) | //vars |
| [2113](#L2113) | $valid\_files = array(); |
| [2114](#L2114) | //if files were passed in... |
| [2115](#L2115) | if(is\_array($files)) { |
| [2116](#L2116) | //cycle through each file |
| [2117](#L2117) | foreach($files as $file) { |
| [2118](#L2118) | if($this->is\_cancel\_command\_found()){ |
| [2119](#L2119) | exit; |
| [2120](#L2120) | } |
| [2121](#L2121) | //make sure the file exists |
| [2122](#L2122) | if(file\_exists($file)) { |
| [2123](#L2123) | if (is\_file($file)) { |
| [2124](#L2124) | $valid\_files[] = $file; |
| [2125](#L2125) | } |
| [2126](#L2126) |  |
| [2127](#L2127) | } |
| [2128](#L2128) | } |
| [2129](#L2129) | } |
| [2130](#L2130) | //if we have good files... |
| [2131](#L2131) | if(count($valid\_files)) { |
| [2132](#L2132) |  |
| [2133](#L2133) | //create the archive |
| [2134](#L2134) | $overwrite = file\_exists($destination) ? true : false ; |
| [2135](#L2135) | $zip = new \ZipArchive(); |
| [2136](#L2136) | if($zip->open($destination, $overwrite ? \ZIPARCHIVE::OVERWRITE : \ZIPARCHIVE::CREATE) !== true) { |
| [2137](#L2137) | return false; |
| [2138](#L2138) | } |
| [2139](#L2139) |  |
| [2140](#L2140) | //add the files |
| [2141](#L2141) | foreach($valid\_files as $file) { |
| [2142](#L2142) | if($this->is\_cancel\_command\_found()){ |
| [2143](#L2143) | exit; |
| [2144](#L2144) | } |
| [2145](#L2145) | $filename = str\_replace( $middle\_patheplace\_path, '', $file); |
| [2146](#L2146) | $zip->addFile($file, $filename); |
| [2147](#L2147) | $this->update\_export\_log($filename, 'added\_into\_zip\_file'); |
| [2148](#L2148) | } |
| [2149](#L2149) | //debug |
| [2150](#L2150) | //echo 'The zip archive contains ',$zip->numFiles,' files with a status of ',$zip->status; |
| [2151](#L2151) |  |
| [2152](#L2152) | //close the zip -- done! |
| [2153](#L2153) | $zip->close(); |
| [2154](#L2154) |  |
| [2155](#L2155) | //check to make sure the file exists |
| [2156](#L2156) | return file\_exists($destination) ? 'created' : 'not' ; |
| [2157](#L2157) | } |
| [2158](#L2158) | else |
| [2159](#L2159) | { |
| [2160](#L2160) | return false; |
| [2161](#L2161) | } |
| [2162](#L2162) | } |
| [2163](#L2163) |  |
| [2164](#L2164) |  |
| [2165](#L2165) | public function zipWorkers($datas, $customUrl = false) |
| [2166](#L2166) | { |
| [2167](#L2167) | if(!$customUrl){ |
| [2168](#L2168) | if (count($datas) == 1) { |
| [2169](#L2169) | $postId = isset($datas[0]) ? $datas[0] : 0; |
| [2170](#L2170) | $post = get\_post($postId); |
| [2171](#L2171) | $permalink = isset($post->permalink) ? $post->permalink : ""; |
| [2172](#L2172) | if($permalink == home\_url() || $postId = "home\_page"){ |
| [2173](#L2173) | $zipFileName = $this->get\_host(home\_url(), false) . '-homepage'; |
| [2174](#L2174) | } |
| [2175](#L2175) | else{ |
| [2176](#L2176) | $zipFileName = $post->post\_name; |
| [2177](#L2177) | } |
| [2178](#L2178) | } |
| [2179](#L2179) | elseif (count($datas) > 1) { |
| [2180](#L2180) |  |
| [2181](#L2181) | $zipFileName = $this->get\_zip\_name($datas); |
| [2182](#L2182) | } |
| [2183](#L2183) | }else{ |
| [2184](#L2184) | if ($this->get\_host($datas) == $datas && !$this->getSettings('full\_site')) { |
| [2185](#L2185) | $zipFileName = $this->get\_host($datas, false); |
| [2186](#L2186) | } |
| [2187](#L2187) | else { |
| [2188](#L2188) | $zipFileName = $this->url\_to\_basename($datas); |
| [2189](#L2189) | } |
| [2190](#L2190) | } |
| [2191](#L2191) |  |
| [2192](#L2192) | $zipFileName = $this->filter\_filename($zipFileName); |
| [2193](#L2193) |  |
| [2194](#L2194) | if($this->getSettings('full\_site')){ |
| [2195](#L2195) | if(!$customUrl){ |
| [2196](#L2196) | $site\_name = $this->get\_host(home\_url(), false); |
| [2197](#L2197) | } |
| [2198](#L2198) | else{ |
| [2199](#L2199) | $site\_name = $this->get\_host($datas, false); |
| [2200](#L2200) | } |
| [2201](#L2201) | $zipFileName = $site\_name . "-fullsite"; |
| [2202](#L2202) | } |
| [2203](#L2203) |  |
| [2204](#L2204) | $this->update\_export\_log('', 'creating\_zip\_file', $zipFileName.'-html.zip'); |
| [2205](#L2205) | $this->setSettings('creating\_zip\_process', 'running'); |
| [2206](#L2206) | //sleep(1.1); |
| [2207](#L2207) |  |
| [2208](#L2208) | $upload\_path = $this->export\_dir; |
| [2209](#L2209) | $all\_files = $this->export\_temp\_dir; |
| [2210](#L2210) | $files = $this->get\_all\_files\_as\_array($all\_files); |
| [2211](#L2211) | $totalFiles = $this->totalExtractedFiles($files); |
| [2212](#L2212) | $this->setSettings('total\_zip\_files', $totalFiles); |
| [2213](#L2213) |  |
| [2214](#L2214) |  |
| [2215](#L2215) | $zip\_file\_name = $upload\_path.'/'.$zipFileName.'-html.zip'; |
| [2216](#L2216) |  |
| [2217](#L2217) | ob\_start(); |
| [2218](#L2218) | echo esc\_html($this->create\_zip($files, $zip\_file\_name, $all\_files . '/')); |
| [2219](#L2219) | $create\_zip = ob\_get\_clean(); |
| [2220](#L2220) |  |
| [2221](#L2221) | global $wpdb; |
| [2222](#L2222) | if ($create\_zip == 'created') { |
| [2223](#L2223) | $uploadPath = $upload\_path . '/'.sanitize\_file\_name($zipFileName).'-html.zip'; |
| [2224](#L2224) | $downloadUrl = $this->export\_url . '/'.sanitize\_file\_name($zipFileName).'-html.zip'; |
| [2225](#L2225) |  |
| [2226](#L2226) | $this->update\_export\_log($uploadPath, 'created\_zip\_file', $downloadUrl); |
| [2227](#L2227) | $this->setSettings('zipDownloadLink', $downloadUrl); |
| [2228](#L2228) | $this->setSettings('rc\_is\_export\_pages\_zip\_downloaded', 'no'); |
| [2229](#L2229) | $this->setSettings('creating\_zip\_process', 'completed'); |
| [2230](#L2230) |  |
| [2231](#L2231) | return true; |
| [2232](#L2232) | } |
| [2233](#L2233) | else{ |
| [2234](#L2234) | return false; |
| [2235](#L2235) | } |
| [2236](#L2236) | } |
| [2237](#L2237) |  |
| [2238](#L2238) | public function totalExtractedFiles($files = array()) |
| [2239](#L2239) | { |
| [2240](#L2240) | $total = 0; |
| [2241](#L2241) | if(!empty($files)){ |
| [2242](#L2242) | foreach ($files as $file) { |
| [2243](#L2243) | if(is\_file($file)){ |
| [2244](#L2244) | $total++; |
| [2245](#L2245) | } |
| [2246](#L2246) | } |
| [2247](#L2247) | } |
| [2248](#L2248) | return $total; |
| [2249](#L2249) | } |
| [2250](#L2250) |  |
| [2251](#L2251) | /\*\* |
| [2252](#L2252) | \* @param $main\_url |
| [2253](#L2253) | \* @param $full\_site |
| [2254](#L2254) | \* @param string $path\_to\_dot |
| [2255](#L2255) | \* @param $middle\_path |
| [2256](#L2256) | \* @return \Closure |
| [2257](#L2257) | \*/ |
| [2258](#L2258) | public function replaceUrlsToLocalHtmlPath($main\_url, $full\_site, string $path\_to\_dot, $middle\_path) |
| [2259](#L2259) | { |
| [2260](#L2260) | return function ($matches) use ($main\_url, $full\_site, $path\_to\_dot, $middle\_path) { |
| [2261](#L2261) |  |
| [2262](#L2262) | $url = apply\_filters('before\_url\_change\_to\_html', $matches[0]); |
| [2263](#L2263) | $url\_middle\_path = $this->rc\_get\_url\_middle\_path($url, true, true); |
| [2264](#L2264) |  |
| [2265](#L2265) | $exclude\_url = apply\_filters('wp\_page\_to\_html\_exclude\_urls', false, $url); |
| [2266](#L2266) |  |
| [2267](#L2267) | if (!$full\_site) { |
| [2268](#L2268) | if (!$this->is\_link\_exists($url)) { |
| [2269](#L2269) | return "#"; |
| [2270](#L2270) | } |
| [2271](#L2271) | } |
| [2272](#L2272) | if ($this->get\_host($url, false) == $this->get\_host($main\_url, false) && !$exclude\_url) { |
| [2273](#L2273) | //$basename = apply\_filters('before\_basename\_change', $basename); |
| [2274](#L2274) |  |
| [2275](#L2275) | $imgExts = array("gif", "jpg", "jpeg", "png", "tiff", "tif"); |
| [2276](#L2276) | $urlExt = pathinfo($url, PATHINFO\_EXTENSION); |
| [2277](#L2277) | //echo $urlExt; |
| [2278](#L2278) | if (in\_array($urlExt, $imgExts)) { |
| [2279](#L2279) | $basename = $this->url\_to\_basename($url); |
| [2280](#L2280) | return $path\_to\_dot . 'images/' . $basename; |
| [2281](#L2281) | } else { |
| [2282](#L2282) | $basename = $this->url\_to\_basename($url, true, '.html'); |
| [2283](#L2283) | return $path\_to\_dot . $url\_middle\_path . $basename; |
| [2284](#L2284) | } |
| [2285](#L2285) | } else { |
| [2286](#L2286) | if (strpos($url, '../') !== false) { |
| [2287](#L2287) | return ""; |
| [2288](#L2288) | } |
| [2289](#L2289) | return $url; |
| [2290](#L2290) | } |
| [2291](#L2291) |  |
| [2292](#L2292) | return $url; |
| [2293](#L2293) |  |
| [2294](#L2294) | }; |
| [2295](#L2295) | } |
| [2296](#L2296) |  |
| [2297](#L2297) |  |
| [2298](#L2298) | public function rc\_replaceUrlsToLocalHtmlPath($match, $main\_url, $full\_site, $path\_to\_dot, $middle\_path){ |
| [2299](#L2299) |  |
| [2300](#L2300) | $url = apply\_filters('before\_url\_change\_to\_html', $match); |
| [2301](#L2301) | $url\_middle\_path = $this->rc\_get\_url\_middle\_path($url, true, true); |
| [2302](#L2302) |  |
| [2303](#L2303) | $urlsToExport = apply\_filters('wp\_page\_to\_html\_urls\_to\_export', false, $url); |
| [2304](#L2304) |  |
| [2305](#L2305) | if (!$full\_site) { |
| [2306](#L2306) | if ( !$this->is\_link\_exists($url) && $this->getSettings('replaceUrlsToHash', false) && !$urlsToExport ) { |
| [2307](#L2307) | return "#"; |
| [2308](#L2308) | } |
| [2309](#L2309) | } |
| [2310](#L2310) | if ($this->get\_host($url, false) == $this->get\_host($main\_url, false) && ($full\_site||$urlsToExport)) { |
| [2311](#L2311) | //$basename = apply\_filters('before\_basename\_change', $basename); |
| [2312](#L2312) |  |
| [2313](#L2313) | $imgExts = array("gif", "jpg", "jpeg", "png", "tiff", "tif"); |
| [2314](#L2314) | $urlExt = pathinfo($url, PATHINFO\_EXTENSION); |
| [2315](#L2315) | //echo $urlExt; |
| [2316](#L2316) | if (in\_array($urlExt, $imgExts)) { |
| [2317](#L2317) | $basename = $this->url\_to\_basename($url); |
| [2318](#L2318) | return $path\_to\_dot . 'images/' . $basename; |
| [2319](#L2319) | } else { |
| [2320](#L2320) | $basename = $this->url\_to\_basename($url, true, '.html'); |
| [2321](#L2321) | return $path\_to\_dot . $url\_middle\_path . $basename; |
| [2322](#L2322) | } |
| [2323](#L2323) | } else { |
| [2324](#L2324) | if (strpos($url, '../') !== false) { |
| [2325](#L2325) | return ""; |
| [2326](#L2326) | } |
| [2327](#L2327) | return $url; |
| [2328](#L2328) | } |
| [2329](#L2329) |  |
| [2330](#L2330) | return $url; |
| [2331](#L2331) | } |
| [2332](#L2332) |  |
| [2333](#L2333) |  |
| [2334](#L2334) | public function rc\_get\_url\_middle\_path\_for\_assets($url){ |
| [2335](#L2335) | $url = explode('?', $url)[0]; |
| [2336](#L2336) | $url = explode('#', $url)[0]; |
| [2337](#L2337) | if($this->getSettings('customUrl') && $this->getSettings('full\_site')){ |
| [2338](#L2338) | $url = str\_replace( array($this->getSettings('customUrlAddress')), array(''), $url); |
| [2339](#L2339) | } |
| [2340](#L2340) | $middle\_path = str\_replace( array(home\_url(), $this->get\_host($url)), array('', ''), $url); |
| [2341](#L2341) | $middle\_path = $this->ltrim\_and\_rtrim($middle\_path, '/'); |
| [2342](#L2342) | //$middle\_path = explode($middle\_path); |
| [2343](#L2343) |  |
| [2344](#L2344) |  |
| [2345](#L2345) | $middle\_path = str\_replace( basename($url), '', $middle\_path); |
| [2346](#L2346) |  |
| [2347](#L2347) | return $middle\_path; |
| [2348](#L2348) | } |
| [2349](#L2349) |  |
| [2350](#L2350) |  |
| [2351](#L2351) | public function abs\_url\_to\_path( $path = '' ) { |
| [2352](#L2352) | return str\_replace( |
| [2353](#L2353) | site\_url(), |
| [2354](#L2354) | wp\_normalize\_path( untrailingslashit( ABSPATH ) ), |
| [2355](#L2355) | wp\_normalize\_path( $path ) |
| [2356](#L2356) | ); |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) |  |
| [2360](#L2360) | function removeParam($url, $param) { |
| [2361](#L2361) | $url = preg\_replace('/(&|\?)'.preg\_quote($param).'=[^&]\*$/', '', $url); |
| [2362](#L2362) | $url = preg\_replace('/(&|\?)'.preg\_quote($param).'=[^&]\*&/', '$1', $url); |
| [2363](#L2363) | return $url; |
| [2364](#L2364) | } |
| [2365](#L2365) |  |
| [2366](#L2366) |  |
| [2367](#L2367) |  |
| [2368](#L2368) | //    public function saveFile($url, $savePath) |
| [2369](#L2369) | //    { |
| [2370](#L2370) | //        $abs\_url\_to\_path = $this->abs\_url\_to\_path($url); |
| [2371](#L2371) | //        if (strpos($url, home\_url()) !== false && file\_exists($abs\_url\_to\_path)){ |
| [2372](#L2372) | //            @copy($abs\_url\_to\_path, esc\_html($savePath)); |
| [2373](#L2373) | //        } |
| [2374](#L2374) | //        else{ |
| [2375](#L2375) | //            $handle = @fopen(esc\_html($savePath), 'w') or die('Cannot open file:  ' . esc\_html($savePath)); |
| [2376](#L2376) | //            $data = $this->get\_url\_data($url); |
| [2377](#L2377) | //            @fwrite($handle, $data); |
| [2378](#L2378) | //            @fclose($handle); |
| [2379](#L2379) | //        } |
| [2380](#L2380) | // |
| [2381](#L2381) | //    } |
| [2382](#L2382) |  |
| [2383](#L2383) | public function saveFile($url, $savePath) |
| [2384](#L2384) | { |
| [2385](#L2385) | // Ensure the WP\_Filesystem is available |
| [2386](#L2386) | if ( ! function\_exists( 'request\_filesystem\_credentials' ) ) { |
| [2387](#L2387) | require\_once ABSPATH . 'wp-admin/includes/file.php'; |
| [2388](#L2388) | } |
| [2389](#L2389) |  |
| [2390](#L2390) | // Get the credentials and initialize the WP\_Filesystem |
| [2391](#L2391) | $creds = request\_filesystem\_credentials( site\_url() ); |
| [2392](#L2392) | if ( ! WP\_Filesystem( $creds ) ) { |
| [2393](#L2393) | // If we cannot initialize the filesystem, handle the error appropriately |
| [2394](#L2394) | return false; |
| [2395](#L2395) | } |
| [2396](#L2396) |  |
| [2397](#L2397) | global $wp\_filesystem; |
| [2398](#L2398) |  |
| [2399](#L2399) | $abs\_url\_to\_path = $this->abs\_url\_to\_path($url); |
| [2400](#L2400) |  |
| [2401](#L2401) | // Use WP\_Filesystem to check if the file exists and copy it |
| [2402](#L2402) | if ( strpos($url, home\_url()) !== false && $wp\_filesystem->exists($abs\_url\_to\_path) ) { |
| [2403](#L2403) | if ( !$wp\_filesystem->copy($abs\_url\_to\_path, $savePath, true) ) { |
| [2404](#L2404) | die('Cannot copy file: ' . esc\_html($abs\_url\_to\_path)); |
| [2405](#L2405) | } |
| [2406](#L2406) | } else { |
| [2407](#L2407) | $data = $this->get\_url\_data($url); |
| [2408](#L2408) | if ( !$wp\_filesystem->put\_contents($savePath, $data, FS\_CHMOD\_FILE) ) { |
| [2409](#L2409) | die('Cannot open file: ' . esc\_html($savePath)); |
| [2410](#L2410) | } |
| [2411](#L2411) | } |
| [2412](#L2412) | } |
| [2413](#L2413) |  |
| [2414](#L2414) |  |
| [2415](#L2415) | public function create\_directory($exportTempDir, $middle\_p = '') { |
| [2416](#L2416) | global $wp\_filesystem; |
| [2417](#L2417) |  |
| [2418](#L2418) | if (empty($wp\_filesystem)) { |
| [2419](#L2419) | require\_once ABSPATH . '/wp-admin/includes/file.php'; |
| [2420](#L2420) | WP\_Filesystem(); |
| [2421](#L2421) | } |
| [2422](#L2422) |  |
| [2423](#L2423) | // Build the directory path |
| [2424](#L2424) | $directory = $exportTempDir; |
| [2425](#L2425) | if (!empty($middle\_p)) { |
| [2426](#L2426) | $directory .= '/' . $middle\_p; |
| [2427](#L2427) | } |
| [2428](#L2428) |  |
| [2429](#L2429) | if (!$wp\_filesystem->mkdir($directory, 0777)) { |
| [2430](#L2430) | // Handle error appropriately |
| [2431](#L2431) | error\_log('Failed to create directory: ' . $directory); |
| [2432](#L2432) | } |
| [2433](#L2433) | } |
| [2434](#L2434) |  |
| [2435](#L2435) |  |
| [2436](#L2436) | } |
| [2437](#L2437) |  |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php?format=txt)
* [Original Format](/export/3220789/export-wp-page-to-static-html/trunk/admin/class-export-wp-page-to-static-html-admin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


