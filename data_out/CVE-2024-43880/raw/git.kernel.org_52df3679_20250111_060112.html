<!DOCTYPE html>
<html lang='en'>
<head>
<title>mlxsw: spectrum_acl_erp: Fix object nesting warning - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='25c6fd9648ad05da493a5d30881896a78a08b624'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='25c6fd9648ad05da493a5d30881896a78a08b624'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='25c6fd9648ad05da493a5d30881896a78a08b624'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Ido Schimmel &lt;idosch@nvidia.com&gt;</td><td class='right'>2024-06-06 16:49:42 +0200</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-08-03 08:49:05 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>25c6fd9648ad05da493a5d30881896a78a08b624</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>b2903039a8bc75c5ac14b20de637c0ef4cc7ac74</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7'>5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25c6fd9648ad05da493a5d30881896a78a08b624&amp;id2=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-25c6fd9648ad05da493a5d30881896a78a08b624.tar.gz'>linux-25c6fd9648ad05da493a5d30881896a78a08b624.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>mlxsw: spectrum_acl_erp: Fix object nesting warning</div><div class='commit-msg'>[ Upstream commit 97d833ceb27dc19f8777d63f90be4a27b5daeedf ]

ACLs in Spectrum-2 and newer ASICs can reside in the algorithmic TCAM
(A-TCAM) or in the ordinary circuit TCAM (C-TCAM). The former can
contain more ACLs (i.e., tc filters), but the number of masks in each
region (i.e., tc chain) is limited.

In order to mitigate the effects of the above limitation, the device
allows filters to share a single mask if their masks only differ in up
to 8 consecutive bits. For example, dst_ip/25 can be represented using
dst_ip/24 with a delta of 1 bit. The C-TCAM does not have a limit on the
number of masks being used (and therefore does not support mask
aggregation), but can contain a limited number of filters.

The driver uses the "objagg" library to perform the mask aggregation by
passing it objects that consist of the filter's mask and whether the
filter is to be inserted into the A-TCAM or the C-TCAM since filters in
different TCAMs cannot share a mask.

The set of created objects is dependent on the insertion order of the
filters and is not necessarily optimal. Therefore, the driver will
periodically ask the library to compute a more optimal set ("hints") by
looking at all the existing objects.

When the library asks the driver whether two objects can be aggregated
the driver only compares the provided masks and ignores the A-TCAM /
C-TCAM indication. This is the right thing to do since the goal is to
move as many filters as possible to the A-TCAM. The driver also forbids
two identical masks from being aggregated since this can only happen if
one was intentionally put in the C-TCAM to avoid a conflict in the
A-TCAM.

The above can result in the following set of hints:

H1: {mask X, A-TCAM} -&gt; H2: {mask Y, A-TCAM} // X is Y + delta
H3: {mask Y, C-TCAM} -&gt; H4: {mask Z, A-TCAM} // Y is Z + delta

After getting the hints from the library the driver will start migrating
filters from one region to another while consulting the computed hints
and instructing the device to perform a lookup in both regions during
the transition.

Assuming a filter with mask X is being migrated into the A-TCAM in the
new region, the hints lookup will return H1. Since H2 is the parent of
H1, the library will try to find the object associated with it and
create it if necessary in which case another hints lookup (recursive)
will be performed. This hints lookup for {mask Y, A-TCAM} will either
return H2 or H3 since the driver passes the library an object comparison
function that ignores the A-TCAM / C-TCAM indication.

This can eventually lead to nested objects which are not supported by
the library [1].

Fix by removing the object comparison function from both the driver and
the library as the driver was the only user. That way the lookup will
only return exact matches.

I do not have a reliable reproducer that can reproduce the issue in a
timely manner, but before the fix the issue would reproduce in several
minutes and with the fix it does not reproduce in over an hour.

Note that the current usefulness of the hints is limited because they
include the C-TCAM indication and represent aggregation that cannot
actually happen. This will be addressed in net-next.

[1]
WARNING: CPU: 0 PID: 153 at lib/objagg.c:170 objagg_obj_parent_assign+0xb5/0xd0
Modules linked in:
CPU: 0 PID: 153 Comm: kworker/0:18 Not tainted 6.9.0-rc6-custom-g70fbc2c1c38b #42
Hardware name: Mellanox Technologies Ltd. MSN3700C/VMOD0008, BIOS 5.11 10/10/2018
Workqueue: mlxsw_core mlxsw_sp_acl_tcam_vregion_rehash_work
RIP: 0010:objagg_obj_parent_assign+0xb5/0xd0
[...]
Call Trace:
 &lt;TASK&gt;
 __objagg_obj_get+0x2bb/0x580
 objagg_obj_get+0xe/0x80
 mlxsw_sp_acl_erp_mask_get+0xb5/0xf0
 mlxsw_sp_acl_atcam_entry_add+0xe8/0x3c0
 mlxsw_sp_acl_tcam_entry_create+0x5e/0xa0
 mlxsw_sp_acl_tcam_vchunk_migrate_one+0x16b/0x270
 mlxsw_sp_acl_tcam_vregion_rehash_work+0xbe/0x510
 process_one_work+0x151/0x370

Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Signed-off-by: Ido Schimmel &lt;idosch@nvidia.com&gt;
Reviewed-by: Amit Cohen &lt;amcohen@nvidia.com&gt;
Tested-by: Alexander Zubkov &lt;green@qrator.net&gt;
Signed-off-by: Petr Machata &lt;petrm@nvidia.com&gt;
Reviewed-by: Simon Horman &lt;horms@kernel.org&gt;
Signed-off-by: David S. Miller &lt;davem@davemloft.net&gt;
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25c6fd9648ad05da493a5d30881896a78a08b624'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c?id=25c6fd9648ad05da493a5d30881896a78a08b624'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c</a></td><td class='right'>13</td><td class='graph'><table summary='file diffstat' width='15%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 86.7%;'/><td class='none' style='width: 13.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/linux/objagg.h?id=25c6fd9648ad05da493a5d30881896a78a08b624'>include/linux/objagg.h</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='15%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 6.7%;'/><td class='none' style='width: 93.3%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=25c6fd9648ad05da493a5d30881896a78a08b624'>lib/objagg.c</a></td><td class='right'>15</td><td class='graph'><table summary='file diffstat' width='15%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 100.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>3 files changed, 0 insertions, 29 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c b/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c<br/>index d231f4d2888bee..9eee229303cced 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c?id=25c6fd9648ad05da493a5d30881896a78a08b624'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_erp.c</a></div><div class='hunk'>@@ -1217,18 +1217,6 @@ static bool mlxsw_sp_acl_erp_delta_check(void *priv, const void *parent_obj,</div><div class='ctx'> 	return err ? false : true;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='del'>-static int mlxsw_sp_acl_erp_hints_obj_cmp(const void *obj1, const void *obj2)</div><div class='del'>-{</div><div class='del'>-	const struct mlxsw_sp_acl_erp_key *key1 = obj1;</div><div class='del'>-	const struct mlxsw_sp_acl_erp_key *key2 = obj2;</div><div class='del'>-</div><div class='del'>-	/* For hints purposes, two objects are considered equal</div><div class='del'>-	 * in case the masks are the same. Does not matter what</div><div class='del'>-	 * the "ctcam" value is.</div><div class='del'>-	 */</div><div class='del'>-	return memcmp(key1-&gt;mask, key2-&gt;mask, sizeof(key1-&gt;mask));</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> static void *mlxsw_sp_acl_erp_delta_create(void *priv, void *parent_obj,</div><div class='ctx'> 					   void *obj)</div><div class='ctx'> {</div><div class='hunk'>@@ -1308,7 +1296,6 @@ static void mlxsw_sp_acl_erp_root_destroy(void *priv, void *root_priv)</div><div class='ctx'> static const struct objagg_ops mlxsw_sp_acl_erp_objagg_ops = {</div><div class='ctx'> 	.obj_size = sizeof(struct mlxsw_sp_acl_erp_key),</div><div class='ctx'> 	.delta_check = mlxsw_sp_acl_erp_delta_check,</div><div class='del'>-	.hints_obj_cmp = mlxsw_sp_acl_erp_hints_obj_cmp,</div><div class='ctx'> 	.delta_create = mlxsw_sp_acl_erp_delta_create,</div><div class='ctx'> 	.delta_destroy = mlxsw_sp_acl_erp_delta_destroy,</div><div class='ctx'> 	.root_create = mlxsw_sp_acl_erp_root_create,</div><div class='head'>diff --git a/include/linux/objagg.h b/include/linux/objagg.h<br/>index 78021777df4626..6df5b887dc547c 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/objagg.h?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7'>include/linux/objagg.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/linux/objagg.h?id=25c6fd9648ad05da493a5d30881896a78a08b624'>include/linux/objagg.h</a></div><div class='hunk'>@@ -8,7 +8,6 @@ struct objagg_ops {</div><div class='ctx'> 	size_t obj_size;</div><div class='ctx'> 	bool (*delta_check)(void *priv, const void *parent_obj,</div><div class='ctx'> 			    const void *obj);</div><div class='del'>-	int (*hints_obj_cmp)(const void *obj1, const void *obj2);</div><div class='ctx'> 	void * (*delta_create)(void *priv, void *parent_obj, void *obj);</div><div class='ctx'> 	void (*delta_destroy)(void *priv, void *delta_priv);</div><div class='ctx'> 	void * (*root_create)(void *priv, void *obj, unsigned int root_id);</div><div class='head'>diff --git a/lib/objagg.c b/lib/objagg.c<br/>index 90f3aa68c30a0e..1608895b009c8b 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7'>lib/objagg.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=25c6fd9648ad05da493a5d30881896a78a08b624'>lib/objagg.c</a></div><div class='hunk'>@@ -906,20 +906,6 @@ static const struct objagg_opt_algo *objagg_opt_algos[] = {</div><div class='ctx'> 	[OBJAGG_OPT_ALGO_SIMPLE_GREEDY] = &amp;objagg_opt_simple_greedy,</div><div class='ctx'> };</div><div class='ctx'> </div><div class='del'>-static int objagg_hints_obj_cmp(struct rhashtable_compare_arg *arg,</div><div class='del'>-				const void *obj)</div><div class='del'>-{</div><div class='del'>-	struct rhashtable *ht = arg-&gt;ht;</div><div class='del'>-	struct objagg_hints *objagg_hints =</div><div class='del'>-			container_of(ht, struct objagg_hints, node_ht);</div><div class='del'>-	const struct objagg_ops *ops = objagg_hints-&gt;ops;</div><div class='del'>-	const char *ptr = obj;</div><div class='del'>-</div><div class='del'>-	ptr += ht-&gt;p.key_offset;</div><div class='del'>-	return ops-&gt;hints_obj_cmp ? ops-&gt;hints_obj_cmp(ptr, arg-&gt;key) :</div><div class='del'>-				    memcmp(ptr, arg-&gt;key, ht-&gt;p.key_len);</div><div class='del'>-}</div><div class='del'>-</div><div class='ctx'> /**</div><div class='ctx'>  * objagg_hints_get - obtains hints instance</div><div class='ctx'>  * @objagg:		objagg instance</div><div class='hunk'>@@ -958,7 +944,6 @@ struct objagg_hints *objagg_hints_get(struct objagg *objagg,</div><div class='ctx'> 				offsetof(struct objagg_hints_node, obj);</div><div class='ctx'> 	objagg_hints-&gt;ht_params.head_offset =</div><div class='ctx'> 				offsetof(struct objagg_hints_node, ht_node);</div><div class='del'>-	objagg_hints-&gt;ht_params.obj_cmpfn = objagg_hints_obj_cmp;</div><div class='ctx'> </div><div class='ctx'> 	err = rhashtable_init(&amp;objagg_hints-&gt;node_ht, &amp;objagg_hints-&gt;ht_params);</div><div class='ctx'> 	if (err)</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 05:59:50 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
