The provided content is related to CVE-2024-26741.

**Root Cause of Vulnerability:**
The vulnerability arises from a failure to properly revert changes made during the connection process of an unbound socket when a subsequent memory allocation for a bhash2 bucket fails. Specifically, after a socket is added to the ehash and its `inet_num` is set, a memory allocation for the corresponding `bhash2` bucket can fail. If this allocation fails, the socket is not removed from the ehash, leading to a situation where an unconnected socket occupies an ehash entry.

**Weaknesses/Vulnerabilities Present:**
- Incorrect state management: A socket is added to the ehash and marked as having an assigned port number (`inet_num`) before it is fully connected and a corresponding bhash2 bucket is allocated. If allocation fails the socket remains in ehash
- Race condition: The issue is triggered by a race where memory allocation fails after a check that is done before, that marks the socket as established.

**Impact of Exploitation:**
An unconnected socket illegally occupies an ehash entry. This can lead to resource exhaustion. The warning in `inet_csk_destroy_sock()` indicates a state where a socket has an `inet_num` but no `icsk_bind_hash`, which should not occur.

**Attack Vectors:**
The vulnerability is triggered by a specific sequence of events during a connect() call on an unbound socket:
1. The system searches for an available ephemeral port.
2. The system checks if a bhash bucket exists for the port and if the bucket is reusable.
3. If reusable, the socket is added to ehash, and inet_sk(sk)->inet_num is set.
4. The system tries to allocate a bhash2 bucket, but the allocation fails.
5. If this allocation fails, the socket is not removed from the ehash, leading to the vulnerability.
This can be triggered by inducing memory allocation failures during the connection phase, possibly via fault injection.

**Required Attacker Capabilities/Position:**
- The attacker needs to be able to trigger the connect() syscall on an unbound socket.
- The attacker needs the capability to induce memory allocation failures (e.g. by using fault injection or memory exhaustion techniques).
- The vulnerability can be triggered by a local user who can create sockets.