

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3028627%2Freview-schema%2Ftrunk%2Fapp%2FControllers%2FAjax%2FReview.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2900015/review-schema/trunk/app/Controllers/Ajax/Review.php "Changeset 2900015 for review-schema/trunk/app/Controllers/Ajax/Review.php")
* [Next Change](/changeset/3112190/review-schema/trunk/app/Controllers/Ajax/Review.php "Changeset 3112190 for review-schema/trunk/app/Controllers/Ajax/Review.php") →

---

# Changeset [3028627](/changeset/3028627 "Show full changeset") for [review-schema/trunk/app/Controllers/Ajax/Review.php](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
01/30/2024 09:37:31 AM
([12 months](/timeline?from=2024-01-30T09%3A37%3A31Z&precision=second "See timeline at 01/30/2024 09:37:31 AM") ago)

Author:
techlabpro1
Message:

Release new version 2.2.0

File:

1 edited

* [review-schema/trunk/app/Controllers/Ajax/Review.php](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627 "Show entry in browser")
  (modified)
  ([16 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [review-schema/trunk/app/Controllers/Ajax/Review.php](/changeset/3028627/review-schema/trunk/app/Controllers/Ajax/Review.php "Show the changeset 3028627 restricted to review-schema/trunk/app/Controllers/Ajax/Review.php")

  | [r2900015](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L46 "Show revision 2900015 of this file in browser") | [r3028627](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L46 "Show revision 3028627 of this file in browser") |  |
  | --- | --- | --- |
  | 46 | 46 | public function get\_reviews($sort\_by, $filter\_by) { |
  | 47 | 47 | // $per\_page = get\_option('comments\_per\_page') == 0 ? 5 : get\_option('comments\_per\_page'); |
  |  | 48 |  |
  |  | 49 | if (! wp\_verify\_nonce( Functions::get\_nonce() , rtrs()->getNonceId())) { |
  |  | 50 | die('Not allowed!'); |
  |  | 51 | } |
  |  | 52 |  |
  |  | 53 |  |
  | 48 | 54 | $per\_page = get\_option('comments\_per\_page'); |
  | 49 | 55 | $cur\_page = isset($\_REQUEST['current\_page']) ? absint($\_REQUEST['current\_page']) : 1; |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L158) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L164) |  |
  | 158 | 164 | global $wp\_rewrite; |
  | 159 | 165 | $args    = ['prev\_text' => '<i class="rtrs-angle-left"></i>', 'next\_text' => '<i class="rtrs-angle-right"></i>']; |
  |  | 166 | // phpcs:ignore WordPress.Security.NonceVerification.Recommended |
  | 160 | 167 | $post\_id = isset($\_REQUEST['post\_id']) ? absint($\_REQUEST['post\_id']) : null; |
  | 161 | 168 |  |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L188) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L195) |  |
  | 188 | 195 | \*/ |
  | 189 | 196 | public function get\_total\_reviews($sort\_by, $filter\_by) { |
  |  | 197 | // phpcs:ignore WordPress.Security.NonceVerification.Recommended |
  | 190 | 198 | $post\_id = isset($\_REQUEST['post\_id']) ? absint($\_REQUEST['post\_id']) : null; |
  | 191 | 199 |  |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L275) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L283) |  |
  | 275 | 283 | \*/ |
  | 276 | 284 | public function rtrs\_review\_filter() { |
  |  | 285 |  |
  |  | 286 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 287 | die('Not allowed!'); |
  |  | 288 | } |
  |  | 289 |  |
  | 277 | 290 | $sort\_by   = isset($\_REQUEST['sort\_by']) ? sanitize\_text\_field($\_REQUEST['sort\_by']) : ''; |
  | 278 | 291 | $filter\_by = isset($\_REQUEST['filter\_by']) ? sanitize\_text\_field($\_REQUEST['filter\_by']) : ''; |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L297) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L310) |  |
  | 297 | 310 | \*/ |
  | 298 | 311 | public function rtrs\_pagination() { |
  |  | 312 |  |
  |  | 313 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 314 | die('Not allowed!'); |
  |  | 315 | } |
  |  | 316 |  |
  | 299 | 317 | $sort\_by   = isset($\_REQUEST['sort\_by']) ? sanitize\_text\_field($\_REQUEST['sort\_by']) : ''; |
  | 300 | 318 | $filter\_by = isset($\_REQUEST['filter\_by']) ? sanitize\_text\_field($\_REQUEST['filter\_by']) : ''; |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L323) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L341) |  |
  | 323 | 341 | \*/ |
  | 324 | 342 | public function rtrs\_image\_upload() { |
  | 325 |  | if (! wp\_verify\_nonce($\_POST['nonce'], rtrs()->getNonceId())) { |
  |  | 343 |  |
  |  | 344 | if ( ! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId()) ) { |
  | 326 | 345 | die('Not allowed!'); |
  | 327 | 346 | } |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L402) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L421) |  |
  | 402 | 421 | \*/ |
  | 403 | 422 | public function rtrs\_video\_upload() { |
  | 404 |  | if (! wp\_verify\_nonce(~~$\_POST['nonce']~~, rtrs()->getNonceId())) { |
  |  | 423 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  | 405 | 424 | die('Not allowed!'); |
  | 406 | 425 | } |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L477) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L496) |  |
  | 477 | 496 | \*/ |
  | 478 | 497 | public function rtrs\_remove\_file() { |
  |  | 498 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 499 | die('Not allowed!'); |
  |  | 500 | } |
  |  | 501 | // phpcs:ignore WordPress.Security.NonceVerification.Recommended |
  | 479 | 502 | $attachment\_id = isset($\_REQUEST['attachment\_id']) ? absint($\_REQUEST['attachment\_id']) : ''; |
  | 480 | 503 |  |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L499) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L522) |  |
  | 499 | 522 | \*/ |
  | 500 | 523 | public function rtrs\_review\_hightlight() { |
  |  | 524 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 525 | die('Not allowed!'); |
  |  | 526 | } |
  | 501 | 527 | if (current\_user\_can('administrator')) { |
  |  | 528 | // phpcs:ignore WordPress.Security.NonceVerification.Recommended |
  | 502 | 529 | $comment\_id = isset($\_REQUEST['comment\_id']) ? absint($\_REQUEST['comment\_id']) : null; |
  | 503 |  |  |
  |  | 530 | // phpcs:ignore WordPress.Security.NonceVerification.Recommended |
  | 504 | 531 | $highlight = (isset($\_REQUEST['highlight']) && $\_REQUEST['highlight'] == 'highlight') ? 1 : 0; |
  | 505 | 532 | if ($comment\_id) { |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L518) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L545) |  |
  | 518 | 545 | \*/ |
  | 519 | 546 | public function rtrs\_review\_helpful() { |
  | 520 |  | if (! wp\_verify\_nonce(~~$\_POST['nonce']~~, rtrs()->getNonceId())) { |
  |  | 547 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  | 521 | 548 | die('Not allowed!'); |
  | 522 | 549 | } |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L577) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L604) |  |
  | 577 | 604 | \*/ |
  | 578 | 605 | public function rtrs\_review\_edit\_form() { |
  |  | 606 |  |
  |  | 607 | if ( ! wp\_verify\_nonce( Functions::get\_nonce(), rtrs()->getNonceId() ) ) { |
  |  | 608 | return; |
  |  | 609 | } |
  |  | 610 |  |
  | 579 | 611 | $comment\_post\_id = isset($\_REQUEST['comment\_post\_id']) ? absint($\_REQUEST['comment\_post\_id']) : null; |
  | 580 | 612 | $comment\_id      = isset($\_REQUEST['comment\_id']) ? absint($\_REQUEST['comment\_id']) : null; |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L836) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L868) |  |
  | 836 | 868 | <input type="hidden" name="comment\_ID" value="<?php echo esc\_attr($comment\_id); ?>" id="comment\_ID"> |
  | 837 | 869 | <input type="hidden" name="comment\_parent" id="comment\_parent" value="0"> |
  |  | 870 | <?php // wp\_nonce\_field( 'rtrs-review-edit' ); ?> |
  |  | 871 | <?php // wp\_nonce\_field( rtrs()->getNonceText(), rtrs()->getNonceId() ); ?> |
  |  | 872 | <?php // wp\_nonce\_field( 'update-comment\_' . $comment\_id ); ?> |
  | 838 | 873 | </div> |
  | 839 | 874 |  |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L854) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L889) |  |
  | 854 | 889 | \*/ |
  | 855 | 890 | public function rtrs\_review\_edit() { |
  |  | 891 |  |
  |  | 892 | if ( ! wp\_verify\_nonce( Functions::get\_nonce(), rtrs()->getNonceId() ) ) { |
  |  | 893 | return; |
  |  | 894 | } |
  |  | 895 |  |
  | 856 | 896 | $comment\_id = absint($\_POST['comment\_ID']); |
  | 857 |  |  |
  | 858 |  | // if ( !current\_user\_can( 'edit\_comment', $comment\_id ) ) return; |
  |  | 897 | // WordFence Responsible Disclosure Reported Issue Fixed. |
  |  | 898 | if ( ! current\_user\_can( 'edit\_comment', $comment\_id ) ){ |
  |  | 899 | $comment = get\_comment( $comment\_id ); |
  |  | 900 | if( get\_current\_user\_id() != $comment->user\_id ){ |
  |  | 901 | return ; |
  |  | 902 | } |
  |  | 903 | } |
  | 859 | 904 |  |
  | 860 | 905 | //not isset means not enable criteria |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L903) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L948) |  |
  | 903 | 948 | $highlight = isset($\_POST['rt\_highlight']) ? 1 : 0; |
  | 904 | 949 | update\_comment\_meta($comment\_id, 'rt\_highlight', $highlight); |
  | 905 |  |  |
  | 906 |  | ~~// $rt\_sticky\_review = isset($\_POST['rt\_sticky\_review']) ? 1 : 0;~~ |
  | 907 |  | ~~// update\_comment\_meta($comment\_id, 'rt\_sticky\_review', $rt\_sticky\_review);~~ |
  | 908 | 950 | } |
  | 909 | 951 | // add recommendation |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L973) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L1015) |  |
  | 973 | 1015 | $html       = null; |
  | 974 | 1016 | $metaData   = []; |
  |  | 1017 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 1018 | die('Not allowed!'); |
  |  | 1019 | } |
  |  | 1020 |  |
  | 975 | 1021 | $post\_id    = isset($\_REQUEST['post\_id']) ? absint($\_REQUEST['post\_id']) : null; |
  | 976 | 1022 | $schema\_cat = isset($\_REQUEST['snippet\_cat']) ? sanitize\_text\_field($\_REQUEST['snippet\_cat']) : null; |
  | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=2900015#L1421) | […](/browser/review-schema/trunk/app/Controllers/Ajax/Review.php?rev=3028627#L1467) |  |
  | 1421 | 1467 | \*/ |
  | 1422 | 1468 | public function rtrs\_self\_video\_popup() { |
  |  | 1469 | if (! wp\_verify\_nonce(Functions::get\_nonce(), rtrs()->getNonceId())) { |
  |  | 1470 | die('Not allowed!'); |
  |  | 1471 | } |
  | 1423 | 1472 | $video\_url = isset($\_REQUEST['video\_url']) ? esc\_url($\_REQUEST['video\_url']) : null; |
  | 1424 | 1473 | ob\_start(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3028627)
* [Zip Archive](?format=zip&new=3028627)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

