The provided content relates to CVE-2022-29180.

**Root cause of vulnerability:**
The vulnerability stems from the lack of proper path sanitization before accessing the file store. Specifically, the application was using `pattern.Path(r.Context())` directly, which could be manipulated by an attacker to access or delete files outside of the intended directory.

**Weaknesses/vulnerabilities present:**
- Path Traversal: The application does not properly sanitize or validate the path provided in HTTP requests. This allows an attacker to manipulate the path to access files outside the intended user's data directory.

**Impact of exploitation:**
- Unauthorized access: Attackers can read files from the server's filesystem.
- Unauthorized deletion: Attackers can delete files from the server's filesystem.
- Data manipulation: Attackers could potentially modify file content, although this is not explicitly mentioned.

**Attack vectors:**
- HTTP Request manipulation: Attackers can forge HTTP requests containing malicious path values in the URL to access arbitrary files on the server's filesystem.

**Required attacker capabilities/position:**
- Network access to the `charm` server: An attacker must be able to send HTTP requests to the server.
- Knowledge of how the `pattern.Path(r.Context())` function extracts paths: The attacker needs to know how to manipulate the path within the URL to traverse directories and reach files beyond the intended user's data directory.

**Additional notes:**
- The vulnerability was fixed by applying `filepath.Clean()` to the path before accessing the file store.
- Encrypted user data is not at risk as the server cannot decrypt it.
- Users running the official charm docker images are at minimal risk because of the containerized file system.