=== Content from github.com_358cfd24_20250111_163939.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2Fsecurity-dashboards-plugin%2Fcommit%2Ffc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2Fsecurity-dashboards-plugin%2Fcommit%2Ffc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=opensearch-project%2Fsecurity-dashboards-plugin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensearch-project](/opensearch-project)
/
**[security-dashboards-plugin](/opensearch-project/security-dashboards-plugin)**
Public

* [Notifications](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin) You must be signed in to change notification settings
* [Fork
  164](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin)
* [Star
   72](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin)

* [Code](/opensearch-project/security-dashboards-plugin)
* [Issues
  104](/opensearch-project/security-dashboards-plugin/issues)
* [Pull requests
  6](/opensearch-project/security-dashboards-plugin/pulls)
* [Actions](/opensearch-project/security-dashboards-plugin/actions)
* [Projects
  0](/opensearch-project/security-dashboards-plugin/projects)
* [Security](/opensearch-project/security-dashboards-plugin/security)
* [Insights](/opensearch-project/security-dashboards-plugin/pulse)

Additional navigation options

* [Code](/opensearch-project/security-dashboards-plugin)
* [Issues](/opensearch-project/security-dashboards-plugin/issues)
* [Pull requests](/opensearch-project/security-dashboards-plugin/pulls)
* [Actions](/opensearch-project/security-dashboards-plugin/actions)
* [Projects](/opensearch-project/security-dashboards-plugin/projects)
* [Security](/opensearch-project/security-dashboards-plugin/security)
* [Insights](/opensearch-project/security-dashboards-plugin/pulse)

## Commit

[Permalink](/opensearch-project/security-dashboards-plugin/commit/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Update nextUrl validation to incorporate serverBasePath ([#2048](https://github.com/opensearch-project/security-dashboards-plugin/pull/2048)) ([#2050](https://github.com/opensearch-project/security-dashboards-plugin/pull/2050))

[Browse files](/opensearch-project/security-dashboards-plugin/tree/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13)
Browse the repository at this point in the history

```
* Fix the nextUrl validation test and test url path using regex

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Update nextUrl validation regex

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Add missing tests

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Combine url split to single line

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Update docstring

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Simplify condition

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Add origin on redirect

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Remove absolute url on redirect

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Update login-page tests

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Remove url.origin

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Account for server base path that can be numeric

Signed-off-by: Craig Perkins <cwperx@amazon.com>

* Update docstring

Signed-off-by: Craig Perkins <cwperx@amazon.com>

---------

Signed-off-by: Craig Perkins <cwperx@amazon.com>
(cherry picked from commit [a44e265](https://github.com/opensearch-project/security-dashboards-plugin/commit/a44e26539345c17e066bc3ceb9ff1e5c07d50428))

Co-authored-by: Craig Perkins <cwperx@amazon.com>
```

* Loading branch information

[![@opensearch-trigger-bot](https://avatars.githubusercontent.com/u/80134844?s=40&v=4)](/apps/opensearch-trigger-bot) [![@cwperks](https://avatars.githubusercontent.com/u/17432265?s=40&v=4)](/cwperks)

[opensearch-trigger-bot[bot]](/opensearch-project/security-dashboards-plugin/commits?author=opensearch-trigger-bot%5Bbot%5D "View all commits by opensearch-trigger-bot[bot]")
and
[cwperks](/opensearch-project/security-dashboards-plugin/commits?author=cwperks "View all commits by cwperks")
authored
Jul 23, 2024

1 parent
[6e89c3c](/opensearch-project/security-dashboards-plugin/commit/6e89c3cc4edd44eb4def03cbafe62bba182b7212)

commit fc4f6a2

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**67 additions**
and
**27 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* server

  + auth/types

    - basic

      * server/auth/types/basic/routes.ts
        [routes.ts](#diff-44bc8ae04ac52bb2e445b9cc579594c6dfa75c7c9561b02f9335b4d034bee24f)
    - openid

      * server/auth/types/openid/routes.ts
        [routes.ts](#diff-55f93c47c667faee3f68b8b8f5e98157fb36eefdc7b856355d5a9b4350526070)
    - proxy

      * server/auth/types/proxy/routes.ts
        [routes.ts](#diff-a6c9e96166ad71cfc9cdf67847bf1b1991d9e23112aa29693bf7a3b2c36e4a31)
    - saml

      * server/auth/types/saml/routes.ts
        [routes.ts](#diff-eb01c2943a155b82e4c013dc2e15aa9a838863a78878acf4b794c7a329ce2d80)
  + utils

    - server/utils/next\_url.test.ts
      [next\_url.test.ts](#diff-9c8e6f5bc73946921d39e91e8a33afed83a221ee9e51ecd51acb72e25cd443ca)
    - server/utils/next\_url.ts
      [next\_url.ts](#diff-9debaa649e5922696e1ea472fdad2de1a90575cfd710a865b7e3ac8d96cac3fb)

## There are no files selected for viewing

13 changes: 12 additions & 1 deletion

13
[server/auth/types/basic/routes.ts](#diff-44bc8ae04ac52bb2e445b9cc579594c6dfa75c7c9561b02f9335b4d034bee24f "server/auth/types/basic/routes.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/auth/types/basic/routes.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -31,6 +31,7 @@ import { |
|  |  | import { resolveTenant } from '../../../multitenancy/tenant\_resolver'; |
|  |  | import { encodeUriQuery } from '../../../../../../src/plugins/opensearch\_dashboards\_utils/common/url/encode\_uri\_query'; |
|  |  | import { AuthType } from '../../../../common'; |
|  |  | import { validateNextUrl } from '../../../utils/next\_url'; |
|  |  |  |
|  |  | export class BasicAuthRoutes { |
|  |  | constructor( |
| Expand All | | @@ -47,7 +48,17 @@ export class BasicAuthRoutes { |
|  |  | this.coreSetup.http.resources.register( |
|  |  | { |
|  |  | path: LOGIN\_PAGE\_URI, |
|  |  | validate: false, |
|  |  | validate: { |
|  |  | query: schema.object({ |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.coreSetup.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | }), |
|  |  | }, |
|  |  | options: { |
|  |  | authRequired: false, |
|  |  | }, |
| Expand Down | |  |

8 changes: 6 additions & 2 deletions

8
[server/auth/types/openid/routes.ts](#diff-55f93c47c667faee3f68b8b8f5e98157fb36eefdc7b856355d5a9b4350526070 "server/auth/types/openid/routes.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/auth/types/openid/routes.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -96,7 +96,9 @@ export class OpenIdAuthRoutes { |
|  |  | code: schema.maybe(schema.string()), |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: validateNextUrl, |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.core.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | redirectHash: schema.maybe(schema.boolean()), |
| Expand Down  Expand Up | | @@ -293,7 +295,9 @@ export class OpenIdAuthRoutes { |
|  |  | query: schema.object({ |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: validateNextUrl, |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.core.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | }), |
| Expand Down | |  |

4 changes: 3 additions & 1 deletion

4
[server/auth/types/proxy/routes.ts](#diff-a6c9e96166ad71cfc9cdf67847bf1b1991d9e23112aa29693bf7a3b2c36e4a31 "server/auth/types/proxy/routes.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/auth/types/proxy/routes.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -38,7 +38,9 @@ export class ProxyAuthRoutes { |
|  |  | query: schema.object({ |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: validateNextUrl, |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.coreSetup.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | }), |
| Expand Down | |  |

8 changes: 6 additions & 2 deletions

8
[server/auth/types/saml/routes.ts](#diff-eb01c2943a155b82e4c013dc2e15aa9a838863a78878acf4b794c7a329ce2d80 "server/auth/types/saml/routes.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/auth/types/saml/routes.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -55,7 +55,9 @@ export class SamlAuthRoutes { |
|  |  | query: schema.object({ |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: validateNextUrl, |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.coreSetup.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | redirectHash: schema.string(), |
| Expand Down  Expand Up | | @@ -270,7 +272,9 @@ export class SamlAuthRoutes { |
|  |  | query: schema.object({ |
|  |  | nextUrl: schema.maybe( |
|  |  | schema.string({ |
|  |  | validate: validateNextUrl, |
|  |  | validate: (nexturl) => { |
|  |  | return validateNextUrl(nexturl, this.coreSetup.http.basePath.serverBasePath); |
|  |  | }, |
|  |  | }) |
|  |  | ), |
|  |  | }), |
| Expand Down | |  |

33 changes: 23 additions & 10 deletions

33
[server/utils/next\_url.test.ts](#diff-9c8e6f5bc73946921d39e91e8a33afed83a221ee9e51ecd51acb72e25cd443ca "server/utils/next_url.test.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/utils/next_url.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -69,48 +69,54 @@ describe('test composeNextUrlQueryParam', () => { |
|  |  | describe('test validateNextUrl', () => { |
|  |  | test('accept relative url', () => { |
|  |  | const url = '/relative/path'; |
|  |  | expect(validateNextUrl(url)).toEqual(undefined); |
|  |  | expect(validateNextUrl(url, '')).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | test('accept relative url with # and query', () => { |
|  |  | const url = '/relative/path#hash?a=b'; |
|  |  | expect(validateNextUrl(url)).toEqual(undefined); |
|  |  | expect(validateNextUrl(url, undefined)).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | test('reject url not start with /', () => { |
|  |  | const url = 'exmaple.com/relative/path'; |
|  |  | expect(validateNextUrl(url)).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | expect(validateNextUrl(url, '')).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | }); |
|  |  |  |
|  |  | test('reject absolute url', () => { |
|  |  | const url = 'https://exmaple.com/relative/path'; |
|  |  | expect(validateNextUrl(url)).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | expect(validateNextUrl(url, '')).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | }); |
|  |  |  |
|  |  | test('reject url starts with //', () => { |
|  |  | const url = '//exmaple.com/relative/path'; |
|  |  | expect(validateNextUrl(url)).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | expect(validateNextUrl(url, '')).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | }); |
|  |  |  |
|  |  | test('accpet url has @ in query parameters', () => { |
|  |  | const url = '/test/path?key=a@b&k2=v'; |
|  |  | expect(validateNextUrl(url)).toEqual(undefined); |
|  |  | expect(validateNextUrl(url, '')).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | test('allow slash', () => { |
|  |  | const url = '/'; |
|  |  | expect(validateNextUrl(url)).toEqual(undefined); |
|  |  | expect(validateNextUrl(url, '')).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | test('allow dashboard url', () => { |
|  |  | const url = |
|  |  | '/\_plugin/opensearch-dashboards/app/opensearch-dashboards#dashbard/dashboard-id?\_g=(param=a&p=b)'; |
|  |  | expect(validateNextUrl(url)).toEqual(undefined); |
|  |  | expect(validateNextUrl(url, '')).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | test('allow basePath with numbers', () => { |
|  |  | const url = '/123/app/dashboards'; |
|  |  | expect(validateNextUrl(url, '/123')).toEqual(undefined); |
|  |  | }); |
|  |  |  |
|  |  | // test cases from https://pentester.land/cheatsheets/2018/11/02/open-redirect-cheatsheet.html |
|  |  | test('test list', () => { |
|  |  | const urlList = [ |
|  |  | '/\t/example.com/', |
|  |  | '<>//â“ð¨ð—°ï¿½ð•â…†ð“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦', |
|  |  | '//;@â“ð¨ð—°ï¿½ð•â…†ð“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦', |
|  |  | '/////â“ð¨ð—°ï¿½ð•â…†ð“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/', |
| Expand Down  Expand Up | | @@ -624,10 +630,17 @@ describe('test validateNextUrl', () => { |
|  |  | '//XY>.7d8T\\205pZM@whitelisted.com+@â“ð¨ð—°ï¿½ð•â…†ð“¸â“œâ‚â„¹â“ƒï½¡ï¼°â“¦/', |
|  |  | '//XY>.7d8T\\205pZM@whitelisted.com@google.com/', |
|  |  | '//XY>.7d8T\\205pZM@whitelisted.com+@google.com/', |
|  |  | 'javascript://sub.domain.com/%0Aalert(1)', |
|  |  | 'javascript://%250Aalert(1)', |
|  |  | 'javascript://%250Aalert(1)//?1', |
|  |  | 'javascript://%250A1?alert(1):0', |
|  |  | '%09Jav%09ascript:alert(document.domain)', |
|  |  | 'javascript://%250Alert(document.location=document.cookie)', |
|  |  | '\\j\\av\\a\\s\\cr\\i\\pt\\:\\a\\l\\ert\\(1\\)', |
|  |  | ]; |
|  |  | for (const url in urlList) { |
|  |  | for (const url of urlList) { |
|  |  | if (url) { |
|  |  | expect(validateNextUrl(url)).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | expect(validateNextUrl(url, '')).toEqual(INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE); |
|  |  | } |
|  |  | } |
|  |  | }); |
| Expand Down | |  |

28 changes: 17 additions & 11 deletions

28
[server/utils/next\_url.ts](#diff-9debaa649e5922696e1ea472fdad2de1a90575cfd710a865b7e3ac8d96cac3fb "server/utils/next_url.ts")

Show comments

[View file](/opensearch-project/security-dashboards-plugin/blob/fc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13/server/utils/next_url.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,25 +45,31 @@ export const INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE = 'Invalid nextUrl parameter.'; |
|  |  | /\*\* |
|  |  | \* We require the nextUrl parameter to be an relative url. |
|  |  | \* |
|  |  | \* Here we leverage the normalizeUrl function. If the library can parse the url |
|  |  | \* parameter, which means it is an absolute url, then we reject it. Otherwise, the |
|  |  | \* library cannot parse the url, which means it is not an absolute url, we let to |
|  |  | \* go through. |
|  |  | \* Here we validate the nextUrl parameter by checking if it meets the following criteria: |
|  |  | \*  - nextUrl starts with the basePath (/ if no serverBasePath is set) |
|  |  | \*  - If nextUrl is longer than 2 chars then the second character must be alphabetical or underscore |
|  |  | \*  - The following characters must be alphanumeric, dash or underscore |
|  |  | \* Note: url has been decoded by OpenSearchDashboards. |
|  |  | \* |
|  |  | \* @param url url string. |
|  |  | \* @returns error message if nextUrl is invalid, otherwise void. |
|  |  | \*/ |
|  |  | export const validateNextUrl = (url: string | undefined): string | void => { |
|  |  | export function validateNextUrl( |
|  |  | url: string | undefined, |
|  |  | basePath: string | undefined |
|  |  | ): string | void { |
|  |  | if (url) { |
|  |  | const path = url.split('?')[0]; |
|  |  | const path = url.split(/\?|#/)[0]; |
|  |  | const bp = basePath || ''; |
|  |  | if (!path.startsWith(bp)) { |
|  |  | return INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE; |
|  |  | } |
|  |  | const pathMinusBase = path.replace(bp, ''); |
|  |  | if ( |
|  |  | !path.startsWith('/') || |
|  |  | path.startsWith('//') || |
|  |  | path.includes('\\') || |
|  |  | path.includes('@') |
|  |  | !pathMinusBase.startsWith('/') || |
|  |  | (pathMinusBase.length >= 2 && !/^\/[a-zA-Z\_][\/a-zA-Z0-9-\_]+$/.test(pathMinusBase)) |
|  |  | ) { |
|  |  | return INVALID\_NEXT\_URL\_PARAMETER\_MESSAGE; |
|  |  | } |
|  |  | } |
|  |  | }; |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fc4f6a2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2Fsecurity-dashboards-plugin%2Fcommit%2Ffc4f6a27c0c80881be9e8ed6b9259a25c3fa0e13) to comment.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.



=== Content from github.com_db435b08_20250111_163940.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2Fsecurity-dashboards-plugin%2Fsecurity%2Fadvisories%2FGHSA-3fph-6cqp-5mfc)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2Fsecurity-dashboards-plugin%2Fsecurity%2Fadvisories%2FGHSA-3fph-6cqp-5mfc)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=opensearch-project%2Fsecurity-dashboards-plugin)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensearch-project](/opensearch-project)
/
**[security-dashboards-plugin](/opensearch-project/security-dashboards-plugin)**
Public

* [Notifications](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin) You must be signed in to change notification settings
* [Fork
  164](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin)
* [Star
   72](/login?return_to=%2Fopensearch-project%2Fsecurity-dashboards-plugin)

* [Code](/opensearch-project/security-dashboards-plugin)
* [Issues
  104](/opensearch-project/security-dashboards-plugin/issues)
* [Pull requests
  6](/opensearch-project/security-dashboards-plugin/pulls)
* [Actions](/opensearch-project/security-dashboards-plugin/actions)
* [Projects
  0](/opensearch-project/security-dashboards-plugin/projects)
* [Security](/opensearch-project/security-dashboards-plugin/security)
* [Insights](/opensearch-project/security-dashboards-plugin/pulse)

Additional navigation options

* [Code](/opensearch-project/security-dashboards-plugin)
* [Issues](/opensearch-project/security-dashboards-plugin/issues)
* [Pull requests](/opensearch-project/security-dashboards-plugin/pulls)
* [Actions](/opensearch-project/security-dashboards-plugin/actions)
* [Projects](/opensearch-project/security-dashboards-plugin/projects)
* [Security](/opensearch-project/security-dashboards-plugin/security)
* [Insights](/opensearch-project/security-dashboards-plugin/pulse)

# Improper nextUrl validation can lead to external redirect

Moderate

[cwperks](/cwperks)
published
GHSA-3fph-6cqp-5mfc
Aug 23, 2024

## Package

OpenSearch

## Affected versions

< 2.16.0, <1.3.19

## Patched versions

1.3.19, 2.16.0

## Description

### Impact

Improper validation of the nextUrl parameter can lead to external redirect on login to OpenSearch-Dashboards for specially crafted parameters.

### Mitigation

A patch is available in 1.3.19 and 2.16.0 for this issue.

### For more information

If you have any questions or comments about this advisory, please contact AWS/Amazon Security via our issue reporting page (<https://aws.amazon.com/security/vulnerability-reporting/>) or directly via email to aws-security@amazon.com. Please do not create a public GitHub issue.

### Severity

Moderate

6.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N

### CVE ID

CVE-2024-43794

### Weaknesses

[CWE-601](/advisories?query=cwe%3A601)

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.


