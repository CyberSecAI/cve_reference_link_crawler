
Commit Information:
------------------
Author: Brian Delwiche  1691456117 +0000
Date: Android Build Coastguard Worker  1697064650 +0000
Bug ID: Bug: 291500341
Commit Message:
--------------
Fix UAF in ~CallbackEnvcom\_android\_bluetooth\_btservice\_AdapterService does not null its localJNI environment variable after detaching the thread (which frees theenvironment context), allowing UAF under certain conditions.Null the variable in this case.Testing here was done through a custom unit test; see patchsets 4-6 forcontents. However, unit testing of the JNI layer is problematic inproduction, so that part of the patch is omitted for final merge.Bug: 291500341Test: atest bluetooth\_test\_gd\_unit, atest net\_test\_stack\_btmTag: #securityIgnore-AOSP-First: Security(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:7a5c71c32d382c0e14083f0d093ae4f5420968ff)Merged-In: I3e5e3c51412640aa19f0981caaa809313d6ad030Change-Id: I3e5e3c51412640aa19f0981caaa809313d6ad030
