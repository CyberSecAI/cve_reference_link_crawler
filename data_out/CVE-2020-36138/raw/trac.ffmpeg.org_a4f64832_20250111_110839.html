

<!DOCTYPE html>
<html lang="en-US">   <head>
    <!-- # block head (placeholder in theme.html) -->
        <!-- # block head (content inherited from layout.html) -->
    <title>
      #8960 (The function decode_frame in  libavcodec/tiff.c  has an uninitialized variable which may cause  application crash)
          â€“ FFmpeg

    </title>

    <meta http-equiv="Content-Type" content="text/html; charset=UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <!--[if IE]><script>
        if (/^#__msie303:/.test(window.location.hash))
        window.location.replace(window.location.hash.replace(/^#__msie303:/, '#'));
        </script><![endif]-->

    <link rel="start"  href="/wiki" />
    <link rel="search"  href="/search" />
    <link rel="help"  href="/wiki/TracGuide" />
    <link rel="stylesheet"  href="/chrome/common/css/trac.css" type="text/css" />
    <link rel="stylesheet"  href="/chrome/common/css/ticket.css" type="text/css" />
    <link rel="stylesheet"  href="/chrome/common/css/jquery-ui/jquery-ui.css" type="text/css" />
    <link rel="stylesheet"  href="/chrome/common/css/jquery-ui-addons.css" type="text/css" />
    <link rel="stylesheet"  href="/chrome/vote/css/tracvote.css" type="text/css" />
    <link rel="icon"  href="/chrome/common/trac.ico" type="image/x-icon" />
    <link rel="first"  href="/ticket/1" title="Ticket #1" />
    <link rel="prev"  href="/ticket/8959" title="Ticket #8959" />
    <link rel="last"  href="/ticket/11410" title="Ticket #11410" />
    <link rel="next"  href="/ticket/8961" title="Ticket #8961" />
    <link rel="alternate"  class="rss" href="/ticket/8960?format=rss" title="RSS Feed" type="application/rss+xml" />
    <link rel="alternate"  class="csv" href="/ticket/8960?format=csv" title="Comma-delimited Text" type="text/csv" />
    <link rel="alternate"  class="tab" href="/ticket/8960?format=tab" title="Tab-delimited Text" type="text/tab-separated-values" />
    <noscript>
      <style>
        .trac-noscript { display: none !important }
      </style>     </noscript>
    <link type="application/opensearchdescription+xml" rel="search"
          href="/search/opensearch"
          title="Search FFmpeg"/>
    <script>
      var comments_prefs={"comments_order":"oldest","show_comments":"true","show_prop_changes":"true"};
      var old_values={"analyzed":"0","blockedby":"","blocking":"","cc":"","changetime":"2023-08-13T01:32:15Z","component":"avcodec","description":"commit ae9a1a96982669926a4ecb92b066814f5f27dc38\r\n{{{\r\n$ ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan poc1\r\n======================= INFO =========================\r\nThis binary is built for AFL-fuzz.\r\nTo run the target function on individual input(s) execute this:\r\n  ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan \u003c INPUT_FILE\r\nor\r\n  ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan INPUT_FILE1 [INPUT_FILE2 ... ]\r\nTo fuzz with afl-fuzz execute this:\r\n  afl-fuzz [afl-flags] ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan [-N]\r\nafl-fuzz will run N iterations before re-spawning the process (default: 1000)\r\n======================================================\r\nReading 21170 bytes from poc1\r\nAddressSanitizer:DEADLYSIGNAL\r\n=================================================================\r\n==13995==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000001 (pc 0x0000006674d1 bp 0x7ffc9154b5c0 sp 0x7ffc9154b5a0 T0)\r\n==13995==The signal is caused by a READ memory access.\r\n==13995==Hint: address points to the zero page.\r\n    #0 0x6674d1 in bytestream_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #1 0x6674d1 in bytestream2_get_be32u /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #2 0x6674d1 in bytestream2_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #3 0x6674d1 in ff_tget_long /src/ffmpeg/libavcodec/tiff_common.c:51:44\r\n    #4 0x668b14 in ff_tget /src/ffmpeg/libavcodec/tiff_common.c:67:29\r\n    #5 0x6006e3 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2002:25\r\n    #6 0x523428 in decode_simple_internal /src/ffmpeg/libavcodec/decode.c:352:15\r\n    #7 0x52257e in decode_simple_receive_frame /src/ffmpeg/libavcodec/decode.c:556:15\r\n    #8 0x4f75c4 in decode_receive_frame_internal /src/ffmpeg/libavcodec/decode.c:576:15\r\n    #9 0x4f6e9e in avcodec_send_packet /src/ffmpeg/libavcodec/decode.c:634:15\r\n    #10 0x4fcadb in compat_decode /src/ffmpeg/libavcodec/decode.c:769:15\r\n    #11 0x4d40dc in LLVMFuzzerTestOneInput /src/ffmpeg/tools/target_dec_fuzzer.c:338:23\r\n    #12 0x1749bea in main (/mnt/disk/out/ffmpeg-single/ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan+0x1749bea)\r\n    #13 0x7fe3803f783f in __libc_start_main /build/glibc-e6zv40/glibc-2.23/csu/../csu/libc-start.c:291\r\n    #14 0x41e198 in _start (/mnt/disk/out/ffmpeg-single/ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan+0x41e198)\r\n\r\nAddressSanitizer can not provide additional info.\r\nSUMMARY: AddressSanitizer: SEGV /src/ffmpeg/libavcodec/bytestream.h:96:1 in bytestream_get_be32\r\n==13995==ABORTING\r\n}}}\r\n\r\nCompilation parameters\uff1a\r\n{{{\r\n#!/bin/bash -eux\r\nexport CC=\"/afl/afl-clang-fast\"\r\nexport CXX=\"/afl/afl-clang-fast++\"\r\nexport CFLAGS=\"-pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport CXXFLAGS=\"-stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport LIB_FUZZING_ENGINE=\"/libAFLDriver.a\"\r\nexport ARCHITECTURE=\"x86_64\"\r\n\r\nexport CFLAGS=\"$CFLAGS -fno-sanitize=vptr\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fno-sanitize=vptr\"\r\n\r\n#add llvm-coverage\r\nexport CFLAGS=\"$CFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\n\r\n# Build dependencies.\r\nexport FFMPEG_DEPS_PATH=$SRC/ffmpeg_deps\r\nmkdir -p $FFMPEG_DEPS_PATH\r\n\r\nexport PATH=\"$FFMPEG_DEPS_PATH/bin:$PATH\"\r\nexport LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib\"\r\n\r\n\r\nexport AFL_LLVM_LAF_SPLIT_SWITCHES=1\r\nexport AFL_LLVM_LAF_SPLIT_COMPARES=1\r\n\r\n\r\ncd $SRC\r\nbzip2 -f -d alsa-lib-*\r\ntar xf alsa-lib-*\r\ncd alsa-lib-*\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/fdk-aac\r\nautoreconf -fiv\r\nCXXFLAGS=\"$CXXFLAGS -fno-sanitize=shift-base,signed-integer-overflow\" \\\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libXext\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libXfixes\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libva\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvdpau\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvpx\r\nLDFLAGS=\"$CXXFLAGS\" ./configure --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --disable-examples --disable-unit-tests \\\r\n    --size-limit=12288x12288 \\\r\n    --extra-cflags=\"-DVPX_MAX_ALLOCABLE_MEMORY=1073741824\"\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/ogg\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-crc\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/opus\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/theora\r\n# theora requires ogg, need to pass its location to the \"configure\" script.\r\nCFLAGS=\"$CFLAGS -fPIC\" LDFLAGS=\"-L$FFMPEG_DEPS_PATH/lib/\" \\\r\n    CPPFLAGS=\"$CXXFLAGS -I$FFMPEG_DEPS_PATH/include/\" \\\r\n    LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib/\" \\\r\n    ./autogen.sh\r\n./configure --with-ogg=\"$FFMPEG_DEPS_PATH\" --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --enable-static --disable-examples\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/vorbis\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\n# Remove shared libraries to avoid accidental linking against them.\r\nrm $FFMPEG_DEPS_PATH/lib/*.so\r\nrm $FFMPEG_DEPS_PATH/lib/*.so.*\r\n\r\nexport AFL_USE_ASAN=1\r\ncd $SRC/ffmpeg\r\nmake clean\r\nPKG_CONFIG_PATH=\"$FFMPEG_DEPS_PATH/lib/pkgconfig\" ./configure \\\r\n    --cc=$CC --cxx=$CXX --ld=\"$CXX $CXXFLAGS -std=c++11\" \\\r\n    --extra-cflags=\"-I$FFMPEG_DEPS_PATH/include\" \\\r\n    --extra-ldflags=\"-L$FFMPEG_DEPS_PATH/lib\" \\\r\n    --extra-ldflags=\"-L/afl/\" \\\r\n    --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --pkg-config-flags=\"--static\" \\\r\n    --libfuzzer=$LIB_FUZZING_ENGINE \\\r\n    --optflags=-O1 \\\r\n    --enable-gpl \\\r\n    --enable-libass \\\r\n    --enable-libfdk-aac \\\r\n    --enable-libfreetype \\\r\n    --enable-libopus \\\r\n    --enable-libtheora \\\r\n    --enable-libvorbis \\\r\n    --enable-libvpx \\\r\n    --enable-nonfree \\\r\n    --disable-muxers \\\r\n    --disable-protocols \\\r\n    --disable-demuxer=rtp,rtsp,sdp \\\r\n    --disable-devices \\\r\n    --disable-shared --enable-cross-compile \r\nmake clean\r\nmake -j$(nproc) install\r\n\r\n# Build the fuzzers.\r\ncd $SRC/ffmpeg\r\n\r\nFUZZ_TARGET_SOURCE=$SRC/ffmpeg/tools/target_dec_fuzzer.c\r\n\r\nexport TEMP_VAR_CODEC=\"TIFF\"\r\nexport TEMP_VAR_CODEC_TYPE=\"VIDEO\"\r\n\r\n\r\n# Build fuzzers for decoders.\r\nfuzzer_name=ffmpeg_AV_CODEC_ID_${TEMP_VAR_CODEC}_fuzzer\r\nsymbol=`echo $TEMP_VAR_CODEC | sed \"s/.*/\\L\\0/\"`\r\nmake tools/target_dec_${symbol}_fuzzer\r\nmv tools/target_dec_${symbol}_fuzzer $OUT/${fuzzer_name}_asan\r\n\r\n}}}\r\n\r\nCredit: 1vanChen of NSFOCUS Security Team","id":8960,"keywords":"tif crash regression","owner":"","priority":"important","reporter":"1vanChen","reproduced":"0","resolution":"","status":"reopened","summary":"The function decode_frame in  libavcodec/tiff.c  has an uninitialized variable which may cause  application crash","time":"2020-11-03T01:41:48Z","type":"defect","version":"git-master"};
      var changes=[{"author":"1vanChen","comment":"","comment_history":{"0":{"author":"1vanChen","comment":"","date":1604367844950646}},"date":1604367844950646,"fields":{"attachment":{"label":"Attachment","new":"poc1","old":"","rendered":"\"\u2192 \\u003cspan class=\\\"trac-field-new\\\"\\u003epoc1\\u003c/span\\u003e\""}},"permanent":0},{"author":"1vanChen","cnum":1,"comment":"When  s-\u003eis_tiled=1  , the initialization of the variable  '''stripdata ''' will be skipped. The function ff_tget will crash.","comment_history":{"0":{"author":"1vanChen","comment":"When  s-\u003eis_tiled=1  , the initialization of the variable  '''stripdata ''' will be skipped. The function ff_tget will crash.","date":1604368788723257}},"date":1604368788723257,"fields":{"status":{"label":"Status","new":"open","old":"new","rendered":"\"\\u003cspan class=\\\"trac-field-old\\\"\\u003enew\\u003c/span\\u003e \u2192 \\u003cspan class=\\\"trac-field-new\\\"\\u003eopen\\u003c/span\\u003e\""}},"permanent":1},{"author":"cehoyos","cnum":2,"comment":"Is this issue reproducible with `ffmpeg`, the application?","comment_history":{"0":{"author":"cehoyos","comment":"Is this issue reproducible with `ffmpeg`, the application?","date":1604884068271620}},"date":1604884068271620,"fields":{"keywords":{"label":"Keywords","new":"tif","old":"","rendered":"\"tif added\""}},"permanent":1},{"author":"1vanChen","cnum":3,"comment":"Replying to [comment:2 cehoyos]:\r\n\u003e Is this issue reproducible with `ffmpeg`, the application?\r\n\r\nI tried several parameter combinations but none of them reached the decode_frame().I even downloaded a standard tiff file and it still fails.\r\n{{{\r\n./ffmpeg_g -i file_example_TIFF_1MB.tiff test.tiff\r\n./ffmpeg_g -i pipe:0 test.tiff -y -report \u003c ./file_example_TIFF_1MB.tiff\r\n}}}\r\n","comment_history":{"0":{"author":"1vanChen","comment":"Replying to [comment:2 cehoyos]:\r\n\u003e Is this issue reproducible with `ffmpeg`, the application?\r\n\r\nI tried several parameter combinations but none of them reached the decode_frame().I even downloaded a standard tiff file and it still fails.\r\n{{{\r\n./ffmpeg_g -i file_example_TIFF_1MB.tiff test.tiff\r\n./ffmpeg_g -i pipe:0 test.tiff -y -report \u003c ./file_example_TIFF_1MB.tiff\r\n}}}\r\n","date":1604971562737027}},"date":1604971562737027,"fields":{},"permanent":1,"replyto":"2"},{"author":"1vanChen","cnum":4,"comment":"Replying to [comment:2 cehoyos]:\r\n\u003e Is this issue reproducible with `ffmpeg`, the application?\r\nIt can crash after modifying the compilation parameters\r\n{{{\r\nroot@85943f9aa2c3:/src/ffmpeg# ./ffmpeg_g -i /out/poc1.tiff test.tiff\r\nffmpeg version git-2020-11-09-d2dcb11 Copyright (c) 2000-2020 the FFmpeg developers\r\n  built with clang version 11.0.0 (https://github.com/llvm/llvm-project.git f7f1abdb8893af4a606ca1a8f5347a426e9c7f9e)\r\n  configuration: --cc=/afl/afl-clang-fast --cxx=/afl/afl-clang-fast++ --ld='/afl/afl-clang-fast++ -stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3 -fno-sanitize=vptr -fprofile-instr-generate -fcoverage-mapping -std=c++11' --extra-cflags=-I/src/ffmpeg_deps/include --extra-ldflags=-L/src/ffmpeg_deps/lib --extra-ldflags=-L/afl/ --prefix=/src/ffmpeg_deps --pkg-config-flags=--static --optflags=-O1 --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-nonfree --enable-cross-compile\r\n  libavutil      56. 60.100 / 56. 60.100\r\n  libavcodec     58.112.101 / 58.112.101\r\n  libavformat    58. 64.100 / 58. 64.100\r\n  libavdevice    58. 11.102 / 58. 11.102\r\n  libavfilter     7. 89.100 /  7. 89.100\r\n  libswscale      5.  8.100 /  5.  8.100\r\n  libswresample   3.  8.100 /  3.  8.100\r\n  libpostproc    55.  8.100 / 55.  8.100\r\n[tiff @ 0x619000000580] Tiled TIFF is not allowed to strip\r\nInput #0, tiff_pipe, from '/out/poc1.tiff':\r\n  Duration: N/A, bitrate: N/A\r\n    Stream #0:0: Video: tiff, rgb24, 601x81, 25 tbr, 25 tbn, 25 tbc\r\nStream mapping:\r\n  Stream #0:0 -\u003e #0:0 (tiff (native) -\u003e tiff (native))\r\nPress [q] to stop, [?] for help\r\n[tiff @ 0x619000002880] Tiled TIFF is not allowed to strip\r\nAddressSanitizer:DEADLYSIGNAL\r\n=================================================================\r\n==18==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x0000068aef0a bp 0x7fce8a2fe9e0 sp 0x7fce8a2fe9c0 T1)\r\n==18==The signal is caused by a READ memory access.\r\n==18==Hint: this fault was caused by a dereference of a high value address (see register values below).  Dissassemble the provided pc to learn which register was used.\r\n    #0 0x68aef0a in bytestream_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #1 0x68aef0a in bytestream2_get_be32u /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #2 0x68aef0a in bytestream2_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #3 0x68aef0a in ff_tget_long /src/ffmpeg/libavcodec/tiff_common.c:51:44\r\n    #4 0x68b0574 in ff_tget /src/ffmpeg/libavcodec/tiff_common.c:67:29\r\n    #5 0x6848146 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2002:25\r\n    #6 0x60ae782 in frame_worker_thread /src/ffmpeg/libavcodec/pthread_frame.c:201:21\r\n    #7 0x7fce8ff566b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n    #8 0x7fce8ed324dc in clone (/lib/x86_64-linux-gnu/libc.so.6+0x1074dc)\r\n}}}\r\ncompilation parameters\uff1a\r\n\r\n{{{\r\n\r\n# Disable UBSan vptr since several targets built with -fno-rtti.\r\nexport CC=\"/afl/afl-clang-fast\"\r\nexport CXX=\"/afl/afl-clang-fast++\"\r\nexport CFLAGS=\"-pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport CXXFLAGS=\"-stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport ARCHITECTURE=\"x86_64\"\r\n\r\nexport CFLAGS=\"$CFLAGS -fno-sanitize=vptr\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fno-sanitize=vptr\"\r\n\r\n#add llvm-coverage\r\nexport CFLAGS=\"$CFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\n\r\n# Build dependencies.\r\nexport FFMPEG_DEPS_PATH=$SRC/ffmpeg_deps\r\nmkdir -p $FFMPEG_DEPS_PATH\r\n\r\nexport PATH=\"$FFMPEG_DEPS_PATH/bin:$PATH\"\r\nexport LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib\"\r\n\r\n\r\nexport AFL_LLVM_LAF_SPLIT_SWITCHES=1\r\nexport AFL_LLVM_LAF_SPLIT_COMPARES=1\r\n\r\n\r\ncd $SRC\r\nbzip2 -f -d alsa-lib-*\r\ntar xf alsa-lib-*\r\ncd alsa-lib-*\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/fdk-aac\r\nautoreconf -fiv\r\nCXXFLAGS=\"$CXXFLAGS -fno-sanitize=shift-base,signed-integer-overflow\" \\\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libXext\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libXfixes\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libva\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvdpau\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvpx\r\nLDFLAGS=\"$CXXFLAGS\" ./configure --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --disable-examples --disable-unit-tests \\\r\n    --size-limit=12288x12288 \\\r\n    --extra-cflags=\"-DVPX_MAX_ALLOCABLE_MEMORY=1073741824\"\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/ogg\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-crc\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/opus\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/theora\r\nCFLAGS=\"$CFLAGS -fPIC\" LDFLAGS=\"-L$FFMPEG_DEPS_PATH/lib/\" \\\r\n    CPPFLAGS=\"$CXXFLAGS -I$FFMPEG_DEPS_PATH/include/\" \\\r\n    LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib/\" \\\r\n    ./autogen.sh\r\n./configure --with-ogg=\"$FFMPEG_DEPS_PATH\" --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --enable-static --disable-examples\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/vorbis\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\n# Remove shared libraries to avoid accidental linking against them.\r\nrm $FFMPEG_DEPS_PATH/lib/*.so\r\nrm $FFMPEG_DEPS_PATH/lib/*.so.*\r\n\r\nexport AFL_USE_ASAN=1\r\ncd $SRC/ffmpeg\r\nPKG_CONFIG_PATH=\"$FFMPEG_DEPS_PATH/lib/pkgconfig\" ./configure \\\r\n    --cc=$CC --cxx=$CXX --ld=\"$CXX $CXXFLAGS -std=c++11\" \\\r\n    --extra-cflags=\"-I$FFMPEG_DEPS_PATH/include\" \\\r\n    --extra-ldflags=\"-L$FFMPEG_DEPS_PATH/lib\" \\\r\n    --extra-ldflags=\"-L/afl/\" \\\r\n    --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --pkg-config-flags=\"--static\" \\\r\n    --optflags=-O1 \\\r\n    --enable-gpl \\\r\n    --enable-libass \\\r\n    --enable-libfdk-aac \\\r\n    --enable-libfreetype \\\r\n    --enable-libopus \\\r\n    --enable-libtheora \\\r\n    --enable-libvorbis \\\r\n    --enable-libvpx \\\r\n    --enable-nonfree \\\r\n    --enable-cross-compile\r\n\r\nmake -j$(nproc) install\r\n\r\ncp -r $SRC/ffmpeg/  $OUT\r\n\r\n}}}\r\n","comment_history":{"0":{"author":"1vanChen","comment":"Replying to [comment:2 cehoyos]:\r\n\u003e Is this issue reproducible with `ffmpeg`, the application?\r\nIt can crash after modifying the compilation parameters\r\n{{{\r\nroot@85943f9aa2c3:/src/ffmpeg# ./ffmpeg_g -i /out/poc1.tiff test.tiff\r\nffmpeg version git-2020-11-09-d2dcb11 Copyright (c) 2000-2020 the FFmpeg developers\r\n  built with clang version 11.0.0 (https://github.com/llvm/llvm-project.git f7f1abdb8893af4a606ca1a8f5347a426e9c7f9e)\r\n  configuration: --cc=/afl/afl-clang-fast --cxx=/afl/afl-clang-fast++ --ld='/afl/afl-clang-fast++ -stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3 -fno-sanitize=vptr -fprofile-instr-generate -fcoverage-mapping -std=c++11' --extra-cflags=-I/src/ffmpeg_deps/include --extra-ldflags=-L/src/ffmpeg_deps/lib --extra-ldflags=-L/afl/ --prefix=/src/ffmpeg_deps --pkg-config-flags=--static --optflags=-O1 --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-nonfree --enable-cross-compile\r\n  libavutil      56. 60.100 / 56. 60.100\r\n  libavcodec     58.112.101 / 58.112.101\r\n  libavformat    58. 64.100 / 58. 64.100\r\n  libavdevice    58. 11.102 / 58. 11.102\r\n  libavfilter     7. 89.100 /  7. 89.100\r\n  libswscale      5.  8.100 /  5.  8.100\r\n  libswresample   3.  8.100 /  3.  8.100\r\n  libpostproc    55.  8.100 / 55.  8.100\r\n[tiff @ 0x619000000580] Tiled TIFF is not allowed to strip\r\nInput #0, tiff_pipe, from '/out/poc1.tiff':\r\n  Duration: N/A, bitrate: N/A\r\n    Stream #0:0: Video: tiff, rgb24, 601x81, 25 tbr, 25 tbn, 25 tbc\r\nStream mapping:\r\n  Stream #0:0 -\u003e #0:0 (tiff (native) -\u003e tiff (native))\r\nPress [q] to stop, [?] for help\r\n[tiff @ 0x619000002880] Tiled TIFF is not allowed to strip\r\nAddressSanitizer:DEADLYSIGNAL\r\n=================================================================\r\n==18==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x0000068aef0a bp 0x7fce8a2fe9e0 sp 0x7fce8a2fe9c0 T1)\r\n==18==The signal is caused by a READ memory access.\r\n==18==Hint: this fault was caused by a dereference of a high value address (see register values below).  Dissassemble the provided pc to learn which register was used.\r\n    #0 0x68aef0a in bytestream_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #1 0x68aef0a in bytestream2_get_be32u /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #2 0x68aef0a in bytestream2_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1\r\n    #3 0x68aef0a in ff_tget_long /src/ffmpeg/libavcodec/tiff_common.c:51:44\r\n    #4 0x68b0574 in ff_tget /src/ffmpeg/libavcodec/tiff_common.c:67:29\r\n    #5 0x6848146 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2002:25\r\n    #6 0x60ae782 in frame_worker_thread /src/ffmpeg/libavcodec/pthread_frame.c:201:21\r\n    #7 0x7fce8ff566b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)\r\n    #8 0x7fce8ed324dc in clone (/lib/x86_64-linux-gnu/libc.so.6+0x1074dc)\r\n}}}\r\ncompilation parameters\uff1a\r\n\r\n{{{\r\n\r\n# Disable UBSan vptr since several targets built with -fno-rtti.\r\nexport CC=\"/afl/afl-clang-fast\"\r\nexport CXX=\"/afl/afl-clang-fast++\"\r\nexport CFLAGS=\"-pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport CXXFLAGS=\"-stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3\"\r\nexport ARCHITECTURE=\"x86_64\"\r\n\r\nexport CFLAGS=\"$CFLAGS -fno-sanitize=vptr\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fno-sanitize=vptr\"\r\n\r\n#add llvm-coverage\r\nexport CFLAGS=\"$CFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\nexport CXXFLAGS=\"$CXXFLAGS -fprofile-instr-generate -fcoverage-mapping\"\r\n\r\n# Build dependencies.\r\nexport FFMPEG_DEPS_PATH=$SRC/ffmpeg_deps\r\nmkdir -p $FFMPEG_DEPS_PATH\r\n\r\nexport PATH=\"$FFMPEG_DEPS_PATH/bin:$PATH\"\r\nexport LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib\"\r\n\r\n\r\nexport AFL_LLVM_LAF_SPLIT_SWITCHES=1\r\nexport AFL_LLVM_LAF_SPLIT_COMPARES=1\r\n\r\n\r\ncd $SRC\r\nbzip2 -f -d alsa-lib-*\r\ntar xf alsa-lib-*\r\ncd alsa-lib-*\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/fdk-aac\r\nautoreconf -fiv\r\nCXXFLAGS=\"$CXXFLAGS -fno-sanitize=shift-base,signed-integer-overflow\" \\\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libXext\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libXfixes\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/libva\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvdpau\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-shared\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/libvpx\r\nLDFLAGS=\"$CXXFLAGS\" ./configure --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --disable-examples --disable-unit-tests \\\r\n    --size-limit=12288x12288 \\\r\n    --extra-cflags=\"-DVPX_MAX_ALLOCABLE_MEMORY=1073741824\"\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/ogg\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static --disable-crc\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/opus\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc) all\r\nmake install\r\n\r\ncd $SRC/theora\r\nCFLAGS=\"$CFLAGS -fPIC\" LDFLAGS=\"-L$FFMPEG_DEPS_PATH/lib/\" \\\r\n    CPPFLAGS=\"$CXXFLAGS -I$FFMPEG_DEPS_PATH/include/\" \\\r\n    LD_LIBRARY_PATH=\"$FFMPEG_DEPS_PATH/lib/\" \\\r\n    ./autogen.sh\r\n./configure --with-ogg=\"$FFMPEG_DEPS_PATH\" --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --enable-static --disable-examples\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\ncd $SRC/vorbis\r\n./autogen.sh\r\n./configure --prefix=\"$FFMPEG_DEPS_PATH\" --enable-static\r\nmake clean\r\nmake -j$(nproc)\r\nmake install\r\n\r\n# Remove shared libraries to avoid accidental linking against them.\r\nrm $FFMPEG_DEPS_PATH/lib/*.so\r\nrm $FFMPEG_DEPS_PATH/lib/*.so.*\r\n\r\nexport AFL_USE_ASAN=1\r\ncd $SRC/ffmpeg\r\nPKG_CONFIG_PATH=\"$FFMPEG_DEPS_PATH/lib/pkgconfig\" ./configure \\\r\n    --cc=$CC --cxx=$CXX --ld=\"$CXX $CXXFLAGS -std=c++11\" \\\r\n    --extra-cflags=\"-I$FFMPEG_DEPS_PATH/include\" \\\r\n    --extra-ldflags=\"-L$FFMPEG_DEPS_PATH/lib\" \\\r\n    --extra-ldflags=\"-L/afl/\" \\\r\n    --prefix=\"$FFMPEG_DEPS_PATH\" \\\r\n    --pkg-config-flags=\"--static\" \\\r\n    --optflags=-O1 \\\r\n    --enable-gpl \\\r\n    --enable-libass \\\r\n    --enable-libfdk-aac \\\r\n    --enable-libfreetype \\\r\n    --enable-libopus \\\r\n    --enable-libtheora \\\r\n    --enable-libvorbis \\\r\n    --enable-libvpx \\\r\n    --enable-nonfree \\\r\n    --enable-cross-compile\r\n\r\nmake -j$(nproc) install\r\n\r\ncp -r $SRC/ffmpeg/  $OUT\r\n\r\n}}}\r\n","date":1604975005357825}},"date":1604975005357825,"fields":{},"permanent":1,"replyto":"2"},{"author":"cehoyos","cnum":5,"comment":"Regression since 33b6752a708f9afc2a99a86ff28a42803e52bc28","comment_history":{"0":{"author":"cehoyos","comment":"Regression since 33b6752a708f9afc2a99a86ff28a42803e52bc28","date":1605046577718293}},"date":1605046577718293,"fields":{"keywords":{"label":"Keywords","new":"tif crash regression","old":"tif","rendered":"\"crash regression added\""}},"permanent":1},{"author":"1vanChen","cnum":6,"comment":"Fixed in commit 292e41ce650a7b5ca5de4ae87fff0d6a90d9fc97","comment_history":{"0":{"author":"1vanChen","comment":"Fixed in commit 292e41ce650a7b5ca5de4ae87fff0d6a90d9fc97","date":1609399426528403}},"date":1609399426528403,"fields":{"resolution":{"label":"Resolution","new":"fixed","old":"","rendered":"\"\u2192 \\u003cspan class=\\\"trac-field-new\\\"\\u003efixed\\u003c/span\\u003e\""},"status":{"label":"Status","new":"closed","old":"open","rendered":"\"\\u003cspan class=\\\"trac-field-old\\\"\\u003eopen\\u003c/span\\u003e \u2192 \\u003cspan class=\\\"trac-field-new\\\"\\u003eclosed\\u003c/span\\u003e\""}},"permanent":1},{"author":"Balling","cnum":7,"comment":"That is not really fixed. Real DNG files are still printing \"Tiled TIFF is not allowed to strip\" \r\nhttp://www.astro-electronic.de/IMG_3459.dng\r\n\r\n","comment_history":{"0":{"author":"Balling","comment":"That is not really fixed. Real DNG files are still printing \"Tiled TIFF is not allowed to strip\" \r\nhttp://www.astro-electronic.de/IMG_3459.dng\r\n\r\n","date":1690421670370678}},"date":1690421670370678,"fields":{},"permanent":1},{"author":"Balling","cnum":8,"comment":"See previous comment.","comment_history":{"0":{"author":"Balling","comment":"See previous comment.","date":1691890335216843}},"date":1691890335216843,"fields":{"resolution":{"label":"Resolution","new":"","old":"fixed","rendered":"\"\\u003cspan class=\\\"trac-field-deleted\\\"\\u003efixed\\u003c/span\\u003e\""},"status":{"label":"Status","new":"reopened","old":"closed","rendered":"\"\\u003cspan class=\\\"trac-field-old\\\"\\u003eclosed\\u003c/span\\u003e \u2192 \\u003cspan class=\\\"trac-field-new\\\"\\u003ereopened\\u003c/span\\u003e\""}},"permanent":1}];
      var auto_preview_timeout=2.0;
      var form_token="5cc8e352205c61067abfa952";
      var jquery_ui={"ampm":true,"date_format":"M d, yy","day_names":{"abbreviated":["Sun","Mon","Tue","Wed","Thu","Fri","Sat"],"narrow":["S","M","T","W","T","F","S"],"wide":["Sunday","Monday","Tuesday","Wednesday","Thursday","Friday","Saturday"]},"default_timezone":0,"first_week_day":0,"month_names":{"abbreviated":["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"],"wide":["January","February","March","April","May","June","July","August","September","October","November","December"]},"period_names":{"am":["AM","AM"],"pm":["PM","PM"]},"show_timezone":false,"time_format":"h:mm:ss TT","timepicker_separator":", ","timezone_iso8601":false,"timezone_list":null};
      var tags={"autocomplete_field":"field-keywords","help_href":null,"help_new_window":false,"keywords":["\"keep","-","-map","-t","-tmcd",".ape",".yuv","/","10","100i","1088","2-pass","2024","264_metadata","3.3.2","302","3221225725","3gpp","404","60000","8","AAC","AIF","AMF","APE","AVI","AVS2","Atmos","Audio","Audiotoolbox","Broken","Build","CC_IDENT","CHUNK","CLosed-caption","CP1252","CSS","ChromaLocation","Crop","D3D11","DASH","DNxHD","DTS","Error","FFREPORT","FFmpeg","FLAC","FPE","G723_1","GPMF","H264","HDS","HLS","HTML","Hevc","ICY","ID3","ID3v2","IDR","IMX","Intel","LCW2","LEAD","LTO","Lyra","METADATA","MP3","MQA","MXF","Metadata","NUT","NVDEC","NVENC","NewTek","No","Non-monotonic","Non-monotonous","Nvidia","OOM","OPUS","PGS","QSV","RDP","RIFF","RTMP","RTP","RTSP","ReplayGain","Rext","SAP","SCTE-35","SDL2","SEEK","SEGFAULT","SIGSEGV","STF","SVQ1","Static","Suffix","TARGETDURATION","TIF","TMCD","Tag","VAAPI","VBK","VPP_QSV","Version","WAV","Widevine","Win32;","Windows","YUV4MPEG2","ZyGo","a","a12v","aac","aax","abort","ac3","ac4","acrossfade","adpcm","aes","afade","aja","alac","alimiter","alive\"","alpha","als","alsa","altivec","amd","amf","amovie","amr","amr_nb","amrnb","amrp","analyzeduration","android","anim","animation","ansi","anull","anullsrc","ape","apng","apple","aptx","arm","art","artifact","asegment","asf","asp","aspect","ass","assertion","astats","astreamselect","async","atmos","atrac","atrac3","atrac3p","audio","audio/video","audiotoolbox","auth","auto","av1","av1_amf","av1_nvenc","av_get_token","av_interleaved_write_frame","av_log","avc","avchroma","avcodec","avfilter","avfoundation","avi","avid","avio","avio_close_dir","avio_open_dir","avio_skip","avisynth","b_adapt","big-endian","binary","bit","bitexact","bitrate","bk2","black","blackmagic","blueiris","blur","bluray","books","bounce","bounty","bpg","bsf","buffer","buffersink","bugs","build","build;","building","bwdif","bytes","cache","caf","callback","caption","capture","carbon","cavs","cc","cc1","cdxl","centos","cfhd","cfr","channel_layout","channelmap","channels","chapters","checksum","chromakey","chunk","clang","clipping","cllc","closed","clv","cmyk","codecpar","coder","colon","color_primaries","color_trc","colorhold","colorspace","command","comment","compilation","compile","concat","concatenate","configuration","conversion","convert","convertion","cook","cookie","copy","copyts","corrupted","coverrect","crash","crc","creation","creation_time","crop","cropdetect","cropping","csf","css","csv","cts","cuda","cues","cursor","curve","curves","cuts","cuvid","d3d11va","d3d12va","dash","dashdec","dashencoder","data","dca","ddagrab","dead","deadlock","debug","decimate","decklink","decode","decoder","decoding","default","delay","demuxer","denoise","deshake","desync","detelecine","device","dicom","direct3d","directio","directshow","disable-x86asm","disconnected","discontinuity","disposition","dither","dithering","divx","djgpp","dn","dnxhd","dnxhr","doc","docs","documentation","dolby_e","dovi","downmix","dplii","dpx","drawtext","drm","drmeter","drop","dropouts","ds2","dshow","dss","dts","dtsshift","dual","duplicate","duration","dv","dvb_subtitle","dvb_teletext","dvbsub","dvcpro50","dvd","dvdsub","dvdsubdec","dvvideo","dwab","dxva2","dynaudnorm","eac3","ease_of_use","easy","ebur128","editlist","edl","edts","eia-608","electronicarts","email","encoder","encoding","encrypt","eof","eq","equirect","error","examples","exif","exit","expression","exr","facebook","failed","faststart","fate","fateclient","fault","fec","fedora","ffjni","ffmetadata","ffmpeg","ffmpeg-vaapi","ffplay","ffpreset","ffprobe","ffreport","ffrprobe","ffserver","fftools","ffv1","ffv1_vulkan","ffvvc","file","filename","filter","filter_complex","filtering","filters","fits","flac","flic","flif","flite","flv","fmp4","font","force_key_frames","format","formatting","fps","fps_mode","frame","frame_num","frame_pts","framerate","frames","framesync","freeze","freezing","frei0r","fsb","fuzz","fuzzer","fuzzing","g722","g726","g729","gamma","gapless","gaps","gaussian","gblur","gdigrab","gif","glob","global","gmp4","gnutls","gpu","gradfun","granule","grayscale","gsm","gsoc","gxf","h.264","h261","h263","h264","h264_amf","h264_mmal","h264_nvenc","h264_omx","h264_qsv","h264_vaapi","h264_vulkan","h265","haiku","handbrake","hang","hardware","hdcd","hdr","header","header.","headers","heif","help","hevc","hevc_amf","hevc_cuvid","hevc_nvenc","hevc_vaapi","hevc_videotoolbox","hevc_vulkan","histogram","hls","htmlsubtitles","http","http_proxy","https","huge","hv60","hw_decode","hwaccel","hwcontext_qsv","hwdownload","hwupload","hwupload_qsv","i686","iXML","iac","id","id3","id3v1","id3v2","iec61883","ieee1394","iff","image2","images","indeo3","indeo4","init","initialization","input","intel","interlaced","interrupt","ios","ip","is","ismindex","itsoffset","ivalid","j2k","jack","join","jpeg2000","jpegls","jump","keyframe","kitty","klfs","klv","kmsgrab","kodi","lame","language","latency","latm","lavf","lavfi","leading","leak","lensfun","libaom","libaom-av1","libass","libatomic","libav","libcdio","libfdk-aac","libiec61883","libjxl","libmp3lame","libndi","libopenh264","libopenjpeg","libopenmpt","libopus","libplacebo","librtmp","libsrt","libsvtav1","libvidstab","libvmaf","libvorbis","libvpx","libx264","libx265","libxvid","libzvbi","linear","links","live","ljpeg","log","logging","login","loglevel","lookahead","loop","loss","lossless","loudness","loudnorm","lowres","lrc","lto","lut3d","lxf","lyrics","m2v","m3u8","m4a","m4b","m4v","macos","manifest","map","matroska","matrox","max_interleave_delta","maxrate","mbedtls","mcdeint","mdec","media","mediacodec","mediafoundation","memleak","memory","mesa","mestimate","metadata","mingw","mips","mismatch","misplaced","missing","mitchell","mjpeg","mka","mkv","mlp","mlv","mmal","mms","mmsh","mmst","monkey's","mosaic","mouse","mov","mov_text","movement","movie","movtomp4","mp1","mp2","mp3","mp4","mp4a","mpc","mpeg2_vaapi","mpeg2video","mpeg4","mpeg4ssp","mpegps","mpegts","mpegtsraw","mpegvideo","mpfilter","mpg123","mpjpeg","mpjpegdec","mpv","msc","msmpeg4","msvc","msvideo1","multi-client","multiple","multivariante","muxer","muxer:","muxing","mvc","mxf","nasm","native","network","nlmeans","nodisp","noexec","nokey","non-existing","normalization","normalize","npp","nsv","null","nullsrc","nut","nvdec","nvenc","nvidia","ocr","ogg","oma","omx","on2avc","oom","op1a","openCL","openal","opencl","opencv","opengl","opus","opw","order","osx","outreachy","overflow","overlay","packed","packet","pad","paf","pal8","palettegen","paletteuse","pan","pass","password","pat","pattern_type","pause","pcm_dvd","pcm_s16le","pcm_s24le","pcm_u8","performance","perspective","pgssub","photocd","pipe","pixels","pixfmt","pkg-config","pkt_duration","plain-text","playback","pmf","pmp","pmt","png","pngdec","pos","postprocessing","powerpc","ppc","ppc64el","premiere","preset","probe","prompeg","prores","protocol","proxy","psf2","psnr","pts","pulldown","pulseaudio","qclp","qcp","qdm2","qdraw","qmax","qmin","qmv","qscale","qsv","qtkit","quality","quick","quicksync","quicktime","r3d","ra28","race","range","rawvideo","rdft","real","reconnect","rectilinear","redirection","reencode","reference","refs","regression","remux","render","report","resampling","resolv","resources","reverb","rfc6381","rhel","rhozet","riff","rotate","rounding","roundup","rpl","rpuenc","rtcp","rtm","rtmp","rtmpe","rtmps","rtp","rtsp","rv10","rv20","rv30","rv40","rw_timeout","s12m","s302m","s337m","sanm","sar","saturation","sbr","scale","scale_cuda","scale_qsv","scaling","scenecut","scpr","screen","screencasting","sdk","sdl","sdp","sdp_file","search","security","seek","seeking","segment","select","sendcmd","separator","sequence","series","server","setpts","sfd","shader","sharpen","sharpen_npp","shorten","shortest","shoutcast","showcqt","showcwt","showspectrumpic","showwaves","showwavespic","shq","sighup","sigint","signaling","signature","sigpipe","silicon","sipr","skip","slide","slideshow","slow","slower","smaf","smartblur","smpl","smush","sn40","snow","sofdec","solaris","spdif","speedhq","speedhqenc","speex","srt","srtdec","srtp","ssegment","ssim","stack-overflow","start_time_realtime","status","stdin","stdout","stream","stream_loop","stream_map","streaming","streamselect","stsd","studio","sub","sub-rip","submitting","subrip","subtitle","subtitles","subviewer","sup","surfaces","svq3","swf","swr_convert","sws_dither","sws_flags","swscale","symbol","sync","synchronous","system;","tags","targa","tcp","tee","template","terminology","test","texi","textfile","thd","the","theora","thumbnail","tif","tiff","time","timecode","timeline","timeout","timescale","timestamp","tiny_psnr","title","tls","tmpdir","to","tpad","track","tracks","tracwiki","transform.trf","transparent","transpose","trim","truehd","truncation","tsan","tta","tunneled","twitch","tx3g","typo","ubsan","udp","underflow","unicode","unix-socket","unsharp","unsupported","url","uspp","ustream","utf16","v360","v4l","v4l2","v4l2loopback","v4l2m2m","va-api","vaapi","variance","vbr","vbv","vc1","vce","vda","vdom","vdpau","vfr","vfwcap","via","video","video4linux2","videolan","videotoolbox","vidstabdetect","vimeo","visual","vobsub","volume","volumedetect","vorbis","voxware","vp3","vp6","vp7","vp8","vp9","vpp_qsv","vqavideo","vs2015","vsx","vsync","vulkan","vvc","wav","waveform","wavpack","webcam","webm","webp","webvtt","wiki","wiki-redirect","win","win10","win32","windows","winrt","with","wma","wmalossless","wmapro","wmav2","wmavoice","wmserver","wmv2","wmv3","wrap","wtv","x11grab","x264","x265","x86","xHE-AAC","xerror","xfade","xml","xmv","xsub","xvba","xvid","xyz","y4v","yadif","youtube","yuv","yuv2rgb","yuv420p","yuv420p10le","yuv422p10le","zip","zmq","zoompan","zvr"],"match_from_start":"","separator":" "};
    </script>
    <script src="/chrome/common/js/jquery.js"></script>
    <script src="/chrome/common/js/babel.js"></script>
    <script src="/chrome/common/js/trac.js"></script>
    <script src="/chrome/common/js/search.js"></script>
    <script src="/chrome/common/js/folding.js"></script>
    <script src="/chrome/common/js/wikitoolbar.js"></script>
    <script src="/chrome/common/js/resizer.js"></script>
    <script src="/chrome/common/js/auto_preview.js"></script>
    <script src="/chrome/common/js/jquery-ui.js"></script>
    <script src="/chrome/common/js/jquery-ui-addons.js"></script>
    <script src="/chrome/common/js/jquery-ui-i18n.js"></script>
    <script src="/chrome/tags/js/autocomplete_tags.js"></script>
    <script>
      jQuery(function($) {
        $(".trac-autofocus").focus();
        $(".trac-target-new").attr("target", "_blank");
        if ($.ui) { /* is jquery-ui added? */
          $(".trac-datepicker:not([readonly])")
            .prop("autocomplete", "off").datepicker();
          // Input current date when today is pressed.
          var _goToToday = $.datepicker._gotoToday;
          $.datepicker._gotoToday = function(id) {
            _goToToday.call(this, id);
            this._selectDate(id)
          };
          $(".trac-datetimepicker:not([readonly])")
            .prop("autocomplete", "off").datetimepicker();
        }
        $(".trac-disable").disableSubmit(".trac-disable-determinant");
        setTimeout(function() { $(".trac-scroll").scrollToTop() }, 1);
        $(".trac-disable-on-submit").disableOnSubmit();
      });
    </script>
    <!--   # include 'site_head.html' (layout.html) -->
    <!--   end of site_head.html -->
    <!-- # endblock head (content inherited from layout.html) -->


    <script src="/chrome/common/js/threaded_comments.js"></script>
    <script>
      jQuery(function($) {
        $("div.description").find("h1,h2,h3,h4,h5,h6")
          .addAnchor(_("Link to this section"));
        $(".foldable").enableFolding(false, true);
        $("#attachments").toggleClass("collapsed");
        $("#trac-up-attachments").click(function () {
          $("#attachments").removeClass("collapsed");
          return true;
        });
        $("#modify").parent().toggleClass("collapsed");
        $(".trac-topnav a").click(function() {
          $("#modify").parent().removeClass("collapsed");
        });

        function setRevertHandler() {
          $("button.trac-revert").click(function() {
            var div = $("div", this);
            var field_name = div[0].id.substr(7);
            var field_value = div.text();
            var input = $("#propertyform *[name=field_" + field_name + "]");
            if (input.length > 0) {
              if (input.filter("input[type=radio]").length > 0) {
                input.val([field_value]);
              } else if (input.filter("input[type=checkbox]").length > 0) {
                input.val(field_value == "1" ? [field_value] : []);
              } else {
                input.val(field_value);
              }
            } else { // Special case for CC checkbox
              input = $("#propertyform input[name=cc_update]").val([]);
            }
            input.change();
            // Remove the revert button
            if ($(this).closest("tbody").children("tr").length === 1)
              $(this).closest(".trac-change-panel").remove();
            else
              $(this).closest("tr").remove();
            return false;
          });
        }
        setRevertHandler();

        var comment_focused = false;
        $("#comment").focus(function() { comment_focused = true; })
                     .blur(function() { comment_focused = false; });
        $("#propertyform").autoSubmit({preview: '1'}, function(data, reply) {
          var items = $(reply);
          // Update ticket box
          $("#ticket").replaceWith(items.filter('#ticket'));
          // Replaces content of #changelog, without recreating it
          $("#changelog").empty().append(items.filter("#changelog").contents());
          // Apply comments order and "Show" preferences
          applyCommentsOrder(
            $('#prefs input[name="trac-comments-order"]:checked').val());
          // Show warnings
          var new_changes = $("#changelog .trac-new");
          $("#trac-edit-warning").toggle(new_changes.length != 0);
          if (new_changes.length != 0)
            $("#changelog").parent().show().removeClass("collapsed");
          $("#trac-preview-warning").remove();
          $("#trac-edit-warning").before(items.filter('#trac-preview-warning'));
          // Update view time
          $("#propertyform input[name='view_time']")
            .replaceWith(items.filter("input[name='view_time']"));
          // Update preview
          var preview = $("#ticketchange")
            .html(items.filter('#preview').children());
          var show_preview = preview.children().length != 0;
          $("#ticketchange").toggle(show_preview);
          setRevertHandler();
          // Execute scripts to load stylesheets
          items.filter("script").appendTo("head");
        }, "#ticketchange .trac-loading");
        $("#trac-comment-editor")
            .autoSubmit({preview_comment: '1'}, function(data, reply) {
          var comment = $("#trac-comment-editor")
            .next("div.comment").html(reply);
          comment.toggle(comment.children().length != 0);
        }, "#changelog .trac-loading");

      });
    </script>
    <!-- # endblock head (placeholder in theme.html) -->
  </head> 
  <body>
    <!-- # block body (content inherited from theme.html) -->
    <!--   # include 'site_header.html' (theme.html) -->
    <!--   end of site_header.html -->

    <div id="banner">
      <div id="header">
        <a id="logo"
           href="https://ffmpeg.org">
          <img  alt="FFmpeg" src="/ffmpeg-logo.png" /></a>


      </div>
      <form id="search" action="/search" method="get">
        <div>
          <label for="proj-search">Search:</label>
          <input type="text" id="proj-search" name="q" size="18"
                  value="" />
          <input type="submit" value="Search" />
        </div>
      </form>
          <div id="metanav" class="nav">
      <ul><li  class="first"><a href="/login">Login</a></li><li ><a href="/prefs">Preferences</a></li><li ><a href="/wiki/TracGuide">Help/Guide</a></li><li ><a href="/about">About Trac</a></li><li ><a href="/register">Register</a></li><li  class="last"><a href="/reset_password">Forgot your password?</a></li></ul>
    </div>

    </div>
        <div id="mainnav" class="nav">
      <ul><li  class="first"><a href="/wiki">Wiki</a></li><li ><a href="/timeline">Timeline</a></li><li  class="active"><a href="/report">View Tickets</a></li><li ><a href="/search">Search</a></li><li  class="last"><a accesskey="T" href="/tags">Tags</a></li></ul>
    </div>


    <div id="main"
         >
      <div id="ctxtnav" class="nav">
        <h2>Context Navigation</h2>
        <ul>
          <li  class="first"><span id="vote" title="Vote count"><img alt="Up-vote" src="/chrome/vote/aupgray.png" /><span id="votes">+0</span><img alt="Down-vote" src="/chrome/vote/adowngray.png" /></span></li>
          <li ><span>&larr; <a class="prev" href="/ticket/8959" title="Ticket #8959">Previous Ticket</a></span></li>
          <li  class="last"><span><a class="next" href="/ticket/8961" title="Ticket #8961">Next Ticket</a> &rarr;</span></li>
        </ul>
        <hr />
      </div>

      

      

      <!-- # block content (placeholder in theme.html) -->
    <div id="content" class="ticket">



<div id="ticket">
  <div id="ticketbox" class="trac-content">
    <div class="date">
      <p>Opened <a class="timeline" href="/timeline?from=2020-11-03T01%3A41%3A48Z&amp;precision=second" title="See timeline at Nov 3, 2020, 1:41:48 AM">4 years ago</a></p>
      <p>Last modified <a class="timeline" href="/timeline?from=2023-08-13T01%3A32%3A15Z&amp;precision=second" title="See timeline at Aug 13, 2023, 1:32:15 AM">17 months ago</a></p>
    </div>


    <h2>
      <a href="/ticket/8960" class="trac-id">#8960</a>
      <span class="trac-status">
        <a href="/query?status=reopened">reopened</a>
      </span>
      <span class="trac-type">
        <a href="/query?status=!closed&amp;type=defect">defect</a>
      </span>
    </h2>

    <h1 id="trac-ticket-title" class="searchable">
      <span class="summary">The function decode_frame in  libavcodec/tiff.c  has an uninitialized variable which may cause  application crash</span>
    </h1>

    <table class="properties">

      <tr>
        <th id="h_reporter">Reported by:</th>
        <td class="searchable" headers="h_reporter"><a class="trac-author" href="/query?reporter=1vanChen&amp;status=!closed">1vanChen</a></td>

        <th id="h_owner" class="missing">Owned by:</th>
        <td headers="h_owner"></td>
      </tr>
      <tr>
        <th id="h_priority">
          Priority:
        </th>
        <td headers="h_priority">
          <a href="/query?priority=important&amp;status=!closed">important</a>
        </td>
        <th id="h_component">
          Component:
        </th>
        <td headers="h_component">
          <a href="/query?component=avcodec&amp;status=!closed">avcodec</a>
        </td>
      </tr>
      <tr>
        <th id="h_version">
          Version:
        </th>
        <td headers="h_version">
          <a href="/query?status=!closed&amp;version=git-master">git-master</a>
        </td>
        <th id="h_keywords">
          Keywords:
        </th>
        <td class="searchable" headers="h_keywords">
          <a href="/query?keywords=~tif&amp;status=!closed">tif</a> <a href="/query?keywords=~crash&amp;status=!closed">crash</a> <a href="/query?keywords=~regression&amp;status=!closed">regression</a>
        </td>
      </tr>
      <tr>
        <th class="missing" id="h_cc">
          Cc:
        </th>
        <td class="searchable" headers="h_cc">
          
        </td>
        <th class="missing" id="h_blockedby">
          Blocked By:
        </th>
        <td headers="h_blockedby">
        </td>
      </tr>
      <tr>
        <th class="missing" id="h_blocking">
          Blocking:
        </th>
        <td headers="h_blocking">
        </td>
        <th id="h_reproduced">
          Reproduced by developer:
        </th>
        <td headers="h_reproduced">
          <a href="/query?reproduced=0&amp;status=!closed">no</a>
        </td>
      </tr>
      <tr>
        <th id="h_analyzed">
          Analyzed by developer:
        </th>
        <td headers="h_analyzed">
          <a href="/query?analyzed=0&amp;status=!closed">no</a>
        </td>
        <th class="missing">
        </th>
        <td>
        </td>
      </tr>
    </table>
    <div class="description">
      <h2 id="comment:description">Description
      </h2>



      <script>
        // float left elements like inlinebuttons will be presented in
        // right-to-left order, i.e. those added before #addreply will
        // be on the right, those added after will be on the left
        function insertNearReplyToDescription(content, side) {
          if (side === 'right') {
            $("#ticket .description #addreply").before(content);
          } else if (side === 'rightmost') {
            $("#ticket .description > h2").after(content);
          } else if (side === 'leftmost') {
            $("#ticket .description").children(".searchable, br")
              .before(content);
          } else { // 'left'
            $("#ticket .description #addreply").after(content);
          }
        }
      </script>

      <div class="searchable">
        <p>
commit <a class="changeset" href="/changeset/ae9a1a96982669926a4ecb92b066814f5f27dc38/ffmpeg" title="lavf/url: fix relative url parsing when the query string or fragment ...">ae9a1a96982669926a4ecb92b066814f5f27dc38</a><br />
</p>
<pre class="wiki">$ ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan poc1
======================= INFO =========================
This binary is built for AFL-fuzz.
To run the target function on individual input(s) execute this:
  ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan &lt; INPUT_FILE
or
  ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan INPUT_FILE1 [INPUT_FILE2 ... ]
To fuzz with afl-fuzz execute this:
  afl-fuzz [afl-flags] ./ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan [-N]
afl-fuzz will run N iterations before re-spawning the process (default: 1000)
======================================================
Reading 21170 bytes from poc1
AddressSanitizer:DEADLYSIGNAL
=================================================================
==13995==ERROR: AddressSanitizer: SEGV on unknown address 0x000000000001 (pc 0x0000006674d1 bp 0x7ffc9154b5c0 sp 0x7ffc9154b5a0 T0)
==13995==The signal is caused by a READ memory access.
==13995==Hint: address points to the zero page.
    #0 0x6674d1 in bytestream_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1
    #1 0x6674d1 in bytestream2_get_be32u /src/ffmpeg/libavcodec/bytestream.h:96:1
    #2 0x6674d1 in bytestream2_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1
    #3 0x6674d1 in ff_tget_long /src/ffmpeg/libavcodec/tiff_common.c:51:44
    #4 0x668b14 in ff_tget /src/ffmpeg/libavcodec/tiff_common.c:67:29
    #5 0x6006e3 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2002:25
    #6 0x523428 in decode_simple_internal /src/ffmpeg/libavcodec/decode.c:352:15
    #7 0x52257e in decode_simple_receive_frame /src/ffmpeg/libavcodec/decode.c:556:15
    #8 0x4f75c4 in decode_receive_frame_internal /src/ffmpeg/libavcodec/decode.c:576:15
    #9 0x4f6e9e in avcodec_send_packet /src/ffmpeg/libavcodec/decode.c:634:15
    #10 0x4fcadb in compat_decode /src/ffmpeg/libavcodec/decode.c:769:15
    #11 0x4d40dc in LLVMFuzzerTestOneInput /src/ffmpeg/tools/target_dec_fuzzer.c:338:23
    #12 0x1749bea in main (/mnt/disk/out/ffmpeg-single/ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan+0x1749bea)
    #13 0x7fe3803f783f in __libc_start_main /build/glibc-e6zv40/glibc-2.23/csu/../csu/libc-start.c:291
    #14 0x41e198 in _start (/mnt/disk/out/ffmpeg-single/ffmpeg_AV_CODEC_ID_TIFF_fuzzer_asan+0x41e198)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV /src/ffmpeg/libavcodec/bytestream.h:96:1 in bytestream_get_be32
==13995==ABORTING
</pre><p>
Compilation parametersï¼š<br />
</p>
<pre class="wiki">#!/bin/bash -eux
export CC="/afl/afl-clang-fast"
export CXX="/afl/afl-clang-fast++"
export CFLAGS="-pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3"
export CXXFLAGS="-stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3"
export LIB_FUZZING_ENGINE="/libAFLDriver.a"
export ARCHITECTURE="x86_64"

export CFLAGS="$CFLAGS -fno-sanitize=vptr"
export CXXFLAGS="$CXXFLAGS -fno-sanitize=vptr"

#add llvm-coverage
export CFLAGS="$CFLAGS -fprofile-instr-generate -fcoverage-mapping"
export CXXFLAGS="$CXXFLAGS -fprofile-instr-generate -fcoverage-mapping"

# Build dependencies.
export FFMPEG_DEPS_PATH=$SRC/ffmpeg_deps
mkdir -p $FFMPEG_DEPS_PATH

export PATH="$FFMPEG_DEPS_PATH/bin:$PATH"
export LD_LIBRARY_PATH="$FFMPEG_DEPS_PATH/lib"


export AFL_LLVM_LAF_SPLIT_SWITCHES=1
export AFL_LLVM_LAF_SPLIT_COMPARES=1


cd $SRC
bzip2 -f -d alsa-lib-*
tar xf alsa-lib-*
cd alsa-lib-*
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/fdk-aac
autoreconf -fiv
CXXFLAGS="$CXXFLAGS -fno-sanitize=shift-base,signed-integer-overflow" \
./configure --prefix="$FFMPEG_DEPS_PATH" --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libXext
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

cd $SRC/libXfixes
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

cd $SRC/libva
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libvdpau
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libvpx
LDFLAGS="$CXXFLAGS" ./configure --prefix="$FFMPEG_DEPS_PATH" \
    --disable-examples --disable-unit-tests \
    --size-limit=12288x12288 \
    --extra-cflags="-DVPX_MAX_ALLOCABLE_MEMORY=1073741824"
make clean
make -j$(nproc) all
make install

cd $SRC/ogg
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-crc
make clean
make -j$(nproc)
make install

cd $SRC/opus
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc) all
make install

cd $SRC/theora
# theora requires ogg, need to pass its location to the "configure" script.
CFLAGS="$CFLAGS -fPIC" LDFLAGS="-L$FFMPEG_DEPS_PATH/lib/" \
    CPPFLAGS="$CXXFLAGS -I$FFMPEG_DEPS_PATH/include/" \
    LD_LIBRARY_PATH="$FFMPEG_DEPS_PATH/lib/" \
    ./autogen.sh
./configure --with-ogg="$FFMPEG_DEPS_PATH" --prefix="$FFMPEG_DEPS_PATH" \
    --enable-static --disable-examples
make clean
make -j$(nproc)
make install

cd $SRC/vorbis
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

# Remove shared libraries to avoid accidental linking against them.
rm $FFMPEG_DEPS_PATH/lib/*.so
rm $FFMPEG_DEPS_PATH/lib/*.so.*

export AFL_USE_ASAN=1
cd $SRC/ffmpeg
make clean
PKG_CONFIG_PATH="$FFMPEG_DEPS_PATH/lib/pkgconfig" ./configure \
    --cc=$CC --cxx=$CXX --ld="$CXX $CXXFLAGS -std=c++11" \
    --extra-cflags="-I$FFMPEG_DEPS_PATH/include" \
    --extra-ldflags="-L$FFMPEG_DEPS_PATH/lib" \
    --extra-ldflags="-L/afl/" \
    --prefix="$FFMPEG_DEPS_PATH" \
    --pkg-config-flags="--static" \
    --libfuzzer=$LIB_FUZZING_ENGINE \
    --optflags=-O1 \
    --enable-gpl \
    --enable-libass \
    --enable-libfdk-aac \
    --enable-libfreetype \
    --enable-libopus \
    --enable-libtheora \
    --enable-libvorbis \
    --enable-libvpx \
    --enable-nonfree \
    --disable-muxers \
    --disable-protocols \
    --disable-demuxer=rtp,rtsp,sdp \
    --disable-devices \
    --disable-shared --enable-cross-compile 
make clean
make -j$(nproc) install

# Build the fuzzers.
cd $SRC/ffmpeg

FUZZ_TARGET_SOURCE=$SRC/ffmpeg/tools/target_dec_fuzzer.c

export TEMP_VAR_CODEC="TIFF"
export TEMP_VAR_CODEC_TYPE="VIDEO"


# Build fuzzers for decoders.
fuzzer_name=ffmpeg_AV_CODEC_ID_${TEMP_VAR_CODEC}_fuzzer
symbol=`echo $TEMP_VAR_CODEC | sed "s/.*/\L\0/"`
make tools/target_dec_${symbol}_fuzzer
mv tools/target_dec_${symbol}_fuzzer $OUT/${fuzzer_name}_asan

</pre><p>
Credit: 1vanChen of NSFOCUS Security Team<br />
</p>

      </div>
    </div>
  </div>
</div>






<div id="attachments">
  <h3  class="foldable">
    Attachments
    <span class="trac-count">(1)</span></h3>
  <div class="attachments">
    <dl class="attachments">
      <dt><a href="/attachment/ticket/8960/poc1" title="View attachment">poc1</a><a href="/raw-attachment/ticket/8960/poc1"
          class="trac-rawlink" title="Download">&#8203;</a>
 (<span title="21170 bytes">20.7 KB</span>
) - added by <span class="trac-author">1vanChen</span> <a class="timeline" href="/timeline?from=2020-11-03T01%3A44%3A04Z&amp;precision=second" title="See timeline at Nov 3, 2020, 1:44:04 AM">4 years ago</a>.</dt>
    </dl>
    <p>
  Download all attachments as:
  <a rel="nofollow" href="/zip-attachment/ticket/8960/">.zip</a>
</p>




  </div>
</div>
      <div>
        <div class="trac-noscript" style="position: relative">
          <form id="prefs" method="get" action="/prefs"
                style="position: absolute; right: 0">
            <div id="trac-comments-order">
              <input type="radio" id="trac-comments-oldest"
                     name="trac-comments-order" value="oldest"
                     checked="checked" />
              <label for="trac-comments-oldest">Oldest first</label>
              <input type="radio" id="trac-comments-newest"
                     name="trac-comments-order" value="newest" />
              <label for="trac-comments-newest">Newest first</label>
              <span id="trac-threaded-toggle" style="display: none">
                <input type="radio" id="trac-comments-threaded"
                       name="trac-comments-order" value="threaded" />
                <label for="trac-comments-threaded">Threaded</label>
              </span>
            </div>
            <div>
              <input id="trac-show-comments-toggle" type="checkbox"
                     checked="checked" />
              <label for="trac-show-comments-toggle">Show comments</label>
              <input id="trac-show-property-changes-toggle" type="checkbox" />
              <label for="trac-show-property-changes-toggle">
                Show property changes</label>
            </div>
          </form>
        </div>

        <h3 class="foldable">
          Change History
          <span class="trac-count">(9)</span></h3>

        <div id="changelog">
          <div class="change">






<h3 class="change">
  <span class="threading">
  </span>
  by <span class="trac-author">1vanChen</span>, <a class="timeline" href="/timeline?from=2020-11-03T01%3A44%3A04Z&amp;precision=second" title="See timeline at Nov 3, 2020, 1:44:04 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-attachment">
      <th class="trac-field-attachment">Attachment:</th>
      <td>
        <a href="/attachment/ticket/8960/poc1"><em>poc1</em></a><a href="/raw-attachment/ticket/8960/poc1"
                                  title="Download"
                                  class="trac-rawlink">&#8203;</a>
 added      </td>
    </tr>
  </table>
</div>





          </div>
          <div class="change" id="trac-change-1-1604368788723257">






<h3 class="change" id="comment:1">
  <span class="threading">
  </span>
  <span class="cnum"><a href="#comment:1" class="">comment:1</a>
</span>
  by <span class="trac-author">1vanChen</span>, <a class="timeline" href="/timeline?from=2020-11-03T01%3A59%3A48Z&amp;precision=second" title="See timeline at Nov 3, 2020, 1:59:48 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-status">
      <th class="trac-field-status">Status:</th>
      <td>
        <span class="trac-field-old">new</span> â†’ <span class="trac-field-new">open</span>
      </td>
    </tr>
  </table>
</div>





<div class="comment searchable">
  <p>
When  s-&gt;is_tiled=1  , the initialization of the variable  <strong>stripdata </strong> will be skipped. The function ff_tget will crash.<br />
</p>

</div>
          </div>
          <div class="change" id="trac-change-2-1604884068271620">






<h3 class="change" id="comment:2">
  <span class="threading">
    <span class="trac-follow-ups">
      <span>follow-ups:</span>
      <a href="#comment:3" class="follow-up">&nbsp;3</a>

      <a href="#comment:4" class="follow-up">&nbsp;4</a>

    </span>
  </span>
  <span class="cnum"><a href="#comment:2" class="">comment:2</a>
</span>
  by <span class="trac-author">Carl Eugen Hoyos</span>, <a class="timeline" href="/timeline?from=2020-11-09T01%3A07%3A48Z&amp;precision=second" title="See timeline at Nov 9, 2020, 1:07:48 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-keywords">
      <th class="trac-field-keywords">Keywords:</th>
      <td>
        tif added
      </td>
    </tr>
  </table>
</div>





<div class="comment searchable">
  <p>
Is this issue reproducible with <code>ffmpeg</code>, the application?<br />
</p>

</div>
          </div>
          <div class="change" id="trac-change-3-1604971562737027">






<h3 class="change" id="comment:3">
  <span class="threading">
    <span class="trac-in-reply-to">
in reply to: <a href="#comment:2" class="in-reply-to">&nbsp;2</a>


    </span>
  </span>
  <span class="cnum"><a href="#comment:3" class="">comment:3</a>
</span>
  by <span class="trac-author">1vanChen</span>, <a class="timeline" href="/timeline?from=2020-11-10T01%3A26%3A02Z&amp;precision=second" title="See timeline at Nov 10, 2020, 1:26:02 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


</div>





<div class="comment searchable">
  <p>
Replying to <a class="ticket" href="/ticket/8960#comment:2" title="Comment 2">cehoyos</a>:<br />
</p>
<blockquote class="citation">
<p>
Is this issue reproducible with <code>ffmpeg</code>, the application?<br />
</p>
</blockquote>
<p>
I tried several parameter combinations but none of them reached the decode_frame().I even downloaded a standard tiff file and it still fails.<br />
</p>
<pre class="wiki">./ffmpeg_g -i file_example_TIFF_1MB.tiff test.tiff
./ffmpeg_g -i pipe:0 test.tiff -y -report &lt; ./file_example_TIFF_1MB.tiff
</pre>
</div>
          </div>
          <div class="change" id="trac-change-4-1604975005357825">






<h3 class="change" id="comment:4">
  <span class="threading">
    <span class="trac-in-reply-to">
in reply to: <a href="#comment:2" class="in-reply-to">&nbsp;2</a>


    </span>
  </span>
  <span class="cnum"><a href="#comment:4" class="">comment:4</a>
</span>
  by <span class="trac-author">1vanChen</span>, <a class="timeline" href="/timeline?from=2020-11-10T02%3A23%3A25Z&amp;precision=second" title="See timeline at Nov 10, 2020, 2:23:25 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


</div>





<div class="comment searchable">
  <p>
Replying to <a class="ticket" href="/ticket/8960#comment:2" title="Comment 2">cehoyos</a>:<br />
</p>
<blockquote class="citation">
<p>
Is this issue reproducible with <code>ffmpeg</code>, the application?<br />
</p>
</blockquote>
<p>
It can crash after modifying the compilation parameters<br />
</p>
<pre class="wiki">root@85943f9aa2c3:/src/ffmpeg# ./ffmpeg_g -i /out/poc1.tiff test.tiff
ffmpeg version git-2020-11-09-d2dcb11 Copyright (c) 2000-2020 the FFmpeg developers
  built with clang version 11.0.0 (https://github.com/llvm/llvm-project.git f7f1abdb8893af4a606ca1a8f5347a426e9c7f9e)
  configuration: --cc=/afl/afl-clang-fast --cxx=/afl/afl-clang-fast++ --ld='/afl/afl-clang-fast++ -stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3 -fno-sanitize=vptr -fprofile-instr-generate -fcoverage-mapping -std=c++11' --extra-cflags=-I/src/ffmpeg_deps/include --extra-ldflags=-L/src/ffmpeg_deps/lib --extra-ldflags=-L/afl/ --prefix=/src/ffmpeg_deps --pkg-config-flags=--static --optflags=-O1 --enable-gpl --enable-libass --enable-libfdk-aac --enable-libfreetype --enable-libopus --enable-libtheora --enable-libvorbis --enable-libvpx --enable-nonfree --enable-cross-compile
  libavutil      56. 60.100 / 56. 60.100
  libavcodec     58.112.101 / 58.112.101
  libavformat    58. 64.100 / 58. 64.100
  libavdevice    58. 11.102 / 58. 11.102
  libavfilter     7. 89.100 /  7. 89.100
  libswscale      5.  8.100 /  5.  8.100
  libswresample   3.  8.100 /  3.  8.100
  libpostproc    55.  8.100 / 55.  8.100
[tiff @ 0x619000000580] Tiled TIFF is not allowed to strip
Input #0, tiff_pipe, from '/out/poc1.tiff':
  Duration: N/A, bitrate: N/A
    Stream #0:0: Video: tiff, rgb24, 601x81, 25 tbr, 25 tbn, 25 tbc
Stream mapping:
  Stream #0:0 -&gt; #0:0 (tiff (native) -&gt; tiff (native))
Press [q] to stop, [?] for help
[tiff @ 0x619000002880] Tiled TIFF is not allowed to strip
AddressSanitizer:DEADLYSIGNAL
=================================================================
==18==ERROR: AddressSanitizer: SEGV on unknown address (pc 0x0000068aef0a bp 0x7fce8a2fe9e0 sp 0x7fce8a2fe9c0 T1)
==18==The signal is caused by a READ memory access.
==18==Hint: this fault was caused by a dereference of a high value address (see register values below).  Dissassemble the provided pc to learn which register was used.
    #0 0x68aef0a in bytestream_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1
    #1 0x68aef0a in bytestream2_get_be32u /src/ffmpeg/libavcodec/bytestream.h:96:1
    #2 0x68aef0a in bytestream2_get_be32 /src/ffmpeg/libavcodec/bytestream.h:96:1
    #3 0x68aef0a in ff_tget_long /src/ffmpeg/libavcodec/tiff_common.c:51:44
    #4 0x68b0574 in ff_tget /src/ffmpeg/libavcodec/tiff_common.c:67:29
    #5 0x6848146 in decode_frame /src/ffmpeg/libavcodec/tiff.c:2002:25
    #6 0x60ae782 in frame_worker_thread /src/ffmpeg/libavcodec/pthread_frame.c:201:21
    #7 0x7fce8ff566b9 in start_thread (/lib/x86_64-linux-gnu/libpthread.so.0+0x76b9)
    #8 0x7fce8ed324dc in clone (/lib/x86_64-linux-gnu/libc.so.6+0x1074dc)
</pre><p>
compilation parametersï¼š<br />
</p>
<pre class="wiki">
# Disable UBSan vptr since several targets built with -fno-rtti.
export CC="/afl/afl-clang-fast"
export CXX="/afl/afl-clang-fast++"
export CFLAGS="-pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3"
export CXXFLAGS="-stdlib=libc++ -pthread -Wl,--no-as-needed -Wl,-ldl -Wl,-lm -Wno-unused-command-line-argument -O3"
export ARCHITECTURE="x86_64"

export CFLAGS="$CFLAGS -fno-sanitize=vptr"
export CXXFLAGS="$CXXFLAGS -fno-sanitize=vptr"

#add llvm-coverage
export CFLAGS="$CFLAGS -fprofile-instr-generate -fcoverage-mapping"
export CXXFLAGS="$CXXFLAGS -fprofile-instr-generate -fcoverage-mapping"

# Build dependencies.
export FFMPEG_DEPS_PATH=$SRC/ffmpeg_deps
mkdir -p $FFMPEG_DEPS_PATH

export PATH="$FFMPEG_DEPS_PATH/bin:$PATH"
export LD_LIBRARY_PATH="$FFMPEG_DEPS_PATH/lib"


export AFL_LLVM_LAF_SPLIT_SWITCHES=1
export AFL_LLVM_LAF_SPLIT_COMPARES=1


cd $SRC
bzip2 -f -d alsa-lib-*
tar xf alsa-lib-*
cd alsa-lib-*
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/fdk-aac
autoreconf -fiv
CXXFLAGS="$CXXFLAGS -fno-sanitize=shift-base,signed-integer-overflow" \
./configure --prefix="$FFMPEG_DEPS_PATH" --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libXext
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

cd $SRC/libXfixes
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

cd $SRC/libva
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libvdpau
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-shared
make clean
make -j$(nproc) all
make install

cd $SRC/libvpx
LDFLAGS="$CXXFLAGS" ./configure --prefix="$FFMPEG_DEPS_PATH" \
    --disable-examples --disable-unit-tests \
    --size-limit=12288x12288 \
    --extra-cflags="-DVPX_MAX_ALLOCABLE_MEMORY=1073741824"
make clean
make -j$(nproc) all
make install

cd $SRC/ogg
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static --disable-crc
make clean
make -j$(nproc)
make install

cd $SRC/opus
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc) all
make install

cd $SRC/theora
CFLAGS="$CFLAGS -fPIC" LDFLAGS="-L$FFMPEG_DEPS_PATH/lib/" \
    CPPFLAGS="$CXXFLAGS -I$FFMPEG_DEPS_PATH/include/" \
    LD_LIBRARY_PATH="$FFMPEG_DEPS_PATH/lib/" \
    ./autogen.sh
./configure --with-ogg="$FFMPEG_DEPS_PATH" --prefix="$FFMPEG_DEPS_PATH" \
    --enable-static --disable-examples
make clean
make -j$(nproc)
make install

cd $SRC/vorbis
./autogen.sh
./configure --prefix="$FFMPEG_DEPS_PATH" --enable-static
make clean
make -j$(nproc)
make install

# Remove shared libraries to avoid accidental linking against them.
rm $FFMPEG_DEPS_PATH/lib/*.so
rm $FFMPEG_DEPS_PATH/lib/*.so.*

export AFL_USE_ASAN=1
cd $SRC/ffmpeg
PKG_CONFIG_PATH="$FFMPEG_DEPS_PATH/lib/pkgconfig" ./configure \
    --cc=$CC --cxx=$CXX --ld="$CXX $CXXFLAGS -std=c++11" \
    --extra-cflags="-I$FFMPEG_DEPS_PATH/include" \
    --extra-ldflags="-L$FFMPEG_DEPS_PATH/lib" \
    --extra-ldflags="-L/afl/" \
    --prefix="$FFMPEG_DEPS_PATH" \
    --pkg-config-flags="--static" \
    --optflags=-O1 \
    --enable-gpl \
    --enable-libass \
    --enable-libfdk-aac \
    --enable-libfreetype \
    --enable-libopus \
    --enable-libtheora \
    --enable-libvorbis \
    --enable-libvpx \
    --enable-nonfree \
    --enable-cross-compile

make -j$(nproc) install

cp -r $SRC/ffmpeg/  $OUT

</pre>
</div>
          </div>
          <div class="change" id="trac-change-5-1605046577718293">






<h3 class="change" id="comment:5">
  <span class="threading">
  </span>
  <span class="cnum"><a href="#comment:5" class="">comment:5</a>
</span>
  by <span class="trac-author">Carl Eugen Hoyos</span>, <a class="timeline" href="/timeline?from=2020-11-10T22%3A16%3A17Z&amp;precision=second" title="See timeline at Nov 10, 2020, 10:16:17 PM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-keywords">
      <th class="trac-field-keywords">Keywords:</th>
      <td>
        crash regression added
      </td>
    </tr>
  </table>
</div>





<div class="comment searchable">
  <p>
Regression since <a class="changeset" href="/changeset/33b6752a708f9afc2a99a86ff28a42803e52bc28/ffmpeg" title="lavc/tiff: Don't apply strips-related logic to tiled images
 ...">33b6752a708f9afc2a99a86ff28a42803e52bc28</a><br />
</p>

</div>
          </div>
          <div class="change" id="trac-change-6-1609399426528403">






<h3 class="change" id="comment:6">
  <span class="threading">
  </span>
  <span class="cnum"><a href="#comment:6" class="">comment:6</a>
</span>
  by <span class="trac-author">1vanChen</span>, <a class="timeline" href="/timeline?from=2020-12-31T07%3A23%3A46Z&amp;precision=second" title="See timeline at Dec 31, 2020, 7:23:46 AM">4 years ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-resolution">
      <th class="trac-field-resolution">Resolution:</th>
      <td>
        â†’ <span class="trac-field-new">fixed</span>
      </td>
    </tr>

    <tr class="trac-field-status">
      <th class="trac-field-status">Status:</th>
      <td>
        <span class="trac-field-old">open</span> â†’ <span class="trac-field-new">closed</span>
      </td>
    </tr>
  </table>
</div>





<div class="comment searchable">
  <p>
Fixed in commit <a class="changeset" href="/changeset/292e41ce650a7b5ca5de4ae87fff0d6a90d9fc97/ffmpeg" title="avcodec/tiff: Disallow striped and tiled tiffs except for DNG

strips ...">292e41ce650a7b5ca5de4ae87fff0d6a90d9fc97</a><br />
</p>

</div>
          </div>
          <div class="change" id="trac-change-7-1690421670370678">






<h3 class="change" id="comment:7">
  <span class="threading">
  </span>
  <span class="cnum"><a href="#comment:7" class="">comment:7</a>
</span>
  by <span class="trac-author">Balling</span>, <a class="timeline" href="/timeline?from=2023-07-27T01%3A34%3A30Z&amp;precision=second" title="See timeline at Jul 27, 2023, 1:34:30 AM">18 months ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


</div>





<div class="comment searchable">
  <p>
That is not really fixed. Real DNG files are still printing "Tiled TIFF is not allowed to strip" <br />
<a class="ext-link" href="http://www.astro-electronic.de/IMG_3459.dng"><span class="icon">â€‹</span>http://www.astro-electronic.de/IMG_3459.dng</a><br />
</p>

</div>
          </div>
          <div class="change" id="trac-change-8-1691890335216843">






<h3 class="change" id="comment:8">
  <span class="threading">
  </span>
  <span class="cnum"><a href="#comment:8" class="">comment:8</a>
</span>
  by <span class="trac-author">Balling</span>, <a class="timeline" href="/timeline?from=2023-08-13T01%3A32%3A15Z&amp;precision=second" title="See timeline at Aug 13, 2023, 1:32:15 AM">17 months ago</a>

</h3>

<div class="trac-change-panel">



  <div class="trac-ticket-buttons">
  </div>


  <table class="changes">


    <tr class="trac-field-resolution">
      <th class="trac-field-resolution">Resolution:</th>
      <td>
        <span class="trac-field-deleted">fixed</span>
      </td>
    </tr>

    <tr class="trac-field-status">
      <th class="trac-field-status">Status:</th>
      <td>
        <span class="trac-field-old">closed</span> â†’ <span class="trac-field-new">reopened</span>
      </td>
    </tr>
  </table>
</div>





<div class="comment searchable">
  <p>
See previous comment.<br />
</p>

</div>
          </div>
          <script>
            // inlinebuttons in ticket change are presented in
            // left-to-right order, i.e. those added before
            // #reply-to-comment-n will be on its left, those added
            // after will be on its right
            function insertNearReplyToComment(num, content, side) {
              var $replyto = $("#reply-to-comment-" + num);
              if (side === 'right') {
                $replyto.after(content);
              } else if (side === 'rightmost') {
                $replyto.parent().append(content);
              } else if (side === 'leftmost') {
                $replyto.parent().prepend(content);
              } else { // 'left'
                $replyto.before(content);
              }
            }
          </script>

        </div>
      </div>


<div class="trac-help">
  <strong>Note:</strong>
 See   <a href="/wiki/TracTickets">TracTickets</a>
 for help on using tickets.
</div>
    </div>
        <!-- # block content (content inherited from layout.html) -->
    <script type="text/javascript">
      jQuery("body").addClass("trac-has-js");
    </script>
    <div id="altlinks">
      <h3>Download in other formats:</h3>
      <ul>
        <li class="first">
          <a rel="nofollow" href="/ticket/8960?format=rss"
              class="rss">
            RSS Feed</a>
        </li>
        <li class="">
          <a rel="nofollow" href="/ticket/8960?format=csv"
              class="csv">
            Comma-delimited Text</a>
        </li>
        <li class="last">
          <a rel="nofollow" href="/ticket/8960?format=tab"
              class="tab">
            Tab-delimited Text</a>
        </li>
      </ul>
    </div>
    <!-- # endblock content (content inherited from layout.html) -->

      <!-- # endblock content (placeholder in theme.html) -->
    </div>

    <div id="footer"><hr/>
      <a id="tracpowered" href="https://trac.edgewall.org/"
         ><img src="/chrome/common/trac_logo_mini.png" height="30"
               width="107" alt="Trac Powered"/></a>
      <p class="left">
Powered by         <a href="/about"><strong>Trac 1.6</strong></a>
        <br />
 By         <a href="http://www.edgewall.org/">Edgewall Software</a>
.      </p>
      <p class="right">Visit the Trac open source project at<br /><a href="http://trac.edgewall.org/">http://trac.edgewall.org/</a></p>
    </div>
    <!--   # include 'site_footer.html' (theme.html) -->
    <!--   end of site_footer.html -->
    <!-- # endblock body (content inherited from theme.html) -->
  </body> </html>