

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3068711%2Fwp-easycart%2Ftrunk%2Fwpeasycart.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3047999/wp-easycart/trunk/wpeasycart.php "Changeset 3047999 for wp-easycart/trunk/wpeasycart.php")
* [Next Change](/changeset/3084202/wp-easycart/trunk/wpeasycart.php "Changeset 3084202 for wp-easycart/trunk/wpeasycart.php") →

---

# Changeset [3068711](/changeset/3068711 "Show full changeset") for [wp-easycart/trunk/wpeasycart.php](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/11/2024 12:05:07 AM
([9 months](/timeline?from=2024-04-11T00%3A05%3A07Z&precision=second "See timeline at 04/11/2024 12:05:07 AM") ago)

Author:
levelfourstorefront
Message:

Committing version 5.6.4, check the change log for more info.

File:

1 edited

* [wp-easycart/trunk/wpeasycart.php](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711 "Show entry in browser")
  (modified)
  ([29 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-easycart/trunk/wpeasycart.php](/changeset/3068711/wp-easycart/trunk/wpeasycart.php "Show the changeset 3068711 restricted to wp-easycart/trunk/wpeasycart.php")

  | [r3047999](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L5 "Show revision 3047999 of this file in browser") | [r3068711](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L5 "Show revision 3068711 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \* Description: The WordPress Shopping Cart by WP EasyCart is a simple eCommerce solution that installs into new or existing WordPress blogs. Customers purchase directly from your store! Get a full ecommerce platform in WordPress! Sell products, downloadable goods, gift cards, clothing and more! Now with WordPress, the powerful features are still very easy to administrate! If you have any questions, please view our website at <a href="http://www.wpeasycart.com" target="\_blank">WP EasyCart</a>. |
  | 6 | 6 |  |
  | 7 |  | \* Version: 5.6.~~3~~ |
  |  | 7 | \* Version: 5.6.4 |
  | 8 | 8 | \* Author: WP EasyCart |
  | 9 | 9 | \* Author URI: http://www.wpeasycart.com |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L14) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L14) |  |
  | 14 | 14 | \* |
  | 15 | 15 | \* @package wpeasycart |
  | 16 |  | \* @version 5.6.~~3~~ |
  |  | 16 | \* @version 5.6.4 |
  | 17 | 17 | \* @author WP EasyCart <sales@wpeasycart.com> |
  | 18 | 18 | \* @copyright Copyright (c) 2012, WP EasyCart |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L23) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L23) |  |
  | 23 | 23 | define( 'EC\_PLUGIN\_DIRECTORY', \_\_DIR\_\_ ); |
  | 24 | 24 | define( 'EC\_PLUGIN\_DATA\_DIRECTORY', \_\_DIR\_\_ . '-data' ); |
  | 25 |  | define( 'EC\_CURRENT\_VERSION', '5\_6\_~~3~~' ); |
  |  | 25 | define( 'EC\_CURRENT\_VERSION', '5\_6\_4' ); |
  | 26 | 26 | define( 'EC\_CURRENT\_DB', '1\_30' );/\* Backwards Compatibility \*/ |
  | 27 |  | define( 'EC\_UPGRADE\_DB', '9~~0~~' ); |
  |  | 27 | define( 'EC\_UPGRADE\_DB', '91' ); |
  | 28 | 28 |  |
  | 29 | 29 | require\_once( EC\_PLUGIN\_DIRECTORY . '/inc/ec\_config.php' ); |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2790) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2790) |  |
  | 2790 | 2790 | 'background\_add' => false, |
  | 2791 | 2791 | ), $atts ) ); |
  |  | 2792 | $productid = (int) $productid; |
  | 2792 | 2793 | ob\_start(); |
  | 2793 | 2794 | global $wpdb; |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2803) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2804) |  |
  | 2803 | 2804 | } |
  | 2804 | 2805 | } else { |
  | 2805 |  | $products = $mysqli->get\_product\_list( ~~" WHERE product.product\_id = " . $productid~~, "", "", "" ); |
  |  | 2806 | $products = $mysqli->get\_product\_list( $wpdb->prepare( " WHERE product.product\_id = %d", $productid ), "", "", "" ); |
  | 2806 | 2807 | } |
  | 2807 | 2808 | if ( count( $products ) > 0 ) { |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2820) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2821) |  |
  | 2820 | 2821 | //[ec\_cartdisplay] |
  | 2821 | 2822 | function load\_ec\_cartdisplay( $atts ) { |
  | 2822 |  |  |
  | 2823 | 2823 | ob\_start(); |
  | 2824 | 2824 | $cart = new ec\_cart( $GLOBALS['ec\_cart\_data']->ec\_cart\_id ); |
  | 2825 |  | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_cartdisplay\_shortcode.php' ) ) |
  |  | 2825 | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_cartdisplay\_shortcode.php' ) ) { |
  | 2826 | 2826 | include( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_cartdisplay\_shortcode.php' ); |
  | 2827 |  | ~~else~~ |
  |  | 2827 | } else { |
  | 2828 | 2828 | include( EC\_PLUGIN\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_latest\_layout' ) . '/ec\_cartdisplay\_shortcode.php' ); |
  | 2829 |  |  |
  |  | 2829 | } |
  | 2830 | 2830 | return ob\_get\_clean(); |
  | 2831 | 2831 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2847) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2847) |  |
  | 2847 | 2847 |  |
  | 2848 | 2848 | if ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'wpec\_manager' ) ) { |
  | 2849 |  |  |
  | 2850 | 2849 | return "<h4>MEMBER AND NON MEMBER CONTENT SHOWN TO ADMIN USER</h4><hr />" . do\_shortcode( $content ) . "<hr />"; |
  | 2851 | 2850 |  |
  | 2852 | 2851 | } else if ( $GLOBALS['ec\_user']->user\_id ) { |
  | 2853 |  |  |
  | 2854 | 2852 | $db = new ec\_db(); |
  | 2855 | 2853 | $is\_member = false; |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2857) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2855) |  |
  | 2857 | 2855 | if ( $productid != '' ) { |
  | 2858 | 2856 | $is\_member = $db->has\_membership\_product\_ids( $productid ); |
  | 2859 |  |  |
  | 2860 | 2857 | } |
  | 2861 | 2858 |  |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2863) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2860) |  |
  | 2863 | 2860 | $user\_role\_array = explode( ',', $userroles ); |
  | 2864 | 2861 |  |
  | 2865 |  | if ( in\_array( $GLOBALS['ec\_user']->user\_level, $user\_role\_array ) ) |
  |  | 2862 | if ( in\_array( $GLOBALS['ec\_user']->user\_level, $user\_role\_array ) ) { |
  | 2866 | 2863 | $is\_member = true; |
  | 2867 |  |  |
  | 2868 |  | } |
  | 2869 |  |  |
  | 2870 |  | if ( $is\_member ) |
  |  | 2864 | } |
  |  | 2865 | } |
  |  | 2866 |  |
  |  | 2867 | if ( $is\_member ) { |
  | 2871 | 2868 | return do\_shortcode( $content ); |
  | 2872 |  |  |
  | 2873 |  | else |
  |  | 2869 | } else { |
  | 2874 | 2870 | return ""; |
  | 2875 |  |  |
  | 2876 |  | } |
  | 2877 |  |  |
  |  | 2871 | } |
  |  | 2872 | } |
  | 2878 | 2873 | } |
  | 2879 | 2874 |  |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2886) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2881) |  |
  | 2886 | 2881 |  |
  | 2887 | 2882 | if ( current\_user\_can( 'manage\_options' ) || current\_user\_can( 'wpec\_manager' ) ) { |
  | 2888 |  |  |
  | 2889 | 2883 | return "<h4>NON-MEMBER CONTENT (WORDPRESS ADMIN DISPLAY ONLY)</h4><hr />" . do\_shortcode( $content ) . "<hr />"; |
  | 2890 | 2884 |  |
  | 2891 | 2885 | } else if ( $GLOBALS['ec\_user']->user\_id ) { |
  | 2892 |  |  |
  | 2893 | 2886 | $db = new ec\_db(); |
  | 2894 | 2887 | $is\_member = false; |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2896) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2889) |  |
  | 2896 | 2889 | if ( $productid != '' ) { |
  | 2897 | 2890 | $is\_member = $db->has\_membership\_product\_ids( $productid ); |
  | 2898 |  |  |
  | 2899 | 2891 | } |
  | 2900 | 2892 |  |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2902) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2894) |  |
  | 2902 | 2894 | $user\_role\_array = explode( ',', $userroles ); |
  | 2903 | 2895 |  |
  | 2904 |  | if ( in\_array( $GLOBALS['ec\_user']->user\_level, $user\_role\_array ) ) |
  |  | 2896 | if ( in\_array( $GLOBALS['ec\_user']->user\_level, $user\_role\_array ) ) { |
  | 2905 | 2897 | $is\_member = true; |
  | 2906 |  |  |
  | 2907 |  | } |
  | 2908 |  |  |
  | 2909 |  |  |
  | 2910 |  | if ( !~~$is\_member )~~ |
  |  | 2898 | } |
  |  | 2899 | } |
  |  | 2900 |  |
  |  | 2901 |  |
  |  | 2902 | if ( ! $is\_member ) { |
  | 2911 | 2903 | return do\_shortcode( $content ); |
  | 2912 |  |  |
  | 2913 |  | else |
  |  | 2904 | } else { |
  | 2914 | 2905 | return ""; |
  | 2915 |  |  |
  | 2916 |  | } else { |
  | 2917 |  |  |
  |  | 2906 | } |
  |  | 2907 |  |
  |  | 2908 | } else { |
  | 2918 | 2909 | return do\_shortcode( "[ec\_account redirect='" . get\_the\_ID() . "']" ) . do\_shortcode( $content ); |
  | 2919 |  |  |
  | 2920 |  | } |
  | 2921 |  |  |
  |  | 2910 | } |
  | 2922 | 2911 | } |
  | 2923 | 2912 |  |
  | 2924 | 2913 | //[ec\_store\_table] |
  | 2925 | 2914 | function load\_ec\_store\_table\_display( $atts ) { |
  | 2926 |  |  |
  | 2927 | 2915 | global $wpdb; |
  | 2928 |  |  |
  | 2929 | 2916 | extract( shortcode\_atts( array( |
  | 2930 | 2917 | 'productid' => '', |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2944) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2931) |  |
  | 2944 | 2931 | $labels = array(); |
  | 2945 | 2932 |  |
  | 2946 |  | for ( $k~~=0; $k<count($columns\_start~~); $k++ ) { |
  |  | 2933 | for ( $k = 0; $k < count( $columns\_start ); $k++ ) { |
  | 2947 | 2934 | if ( $columns\_start[$k] != '0' ) { |
  | 2948 | 2935 | $columns[] = $columns\_start[$k]; |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2964) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2951) |  |
  | 2964 | 2951 | } |
  | 2965 | 2952 |  |
  | 2966 |  | if (substr\_count($storepage, '?'))                          $permalink\_divider = "&"; |
  | 2967 |  | else                                                        $permalink\_divider = "?"; |
  |  | 2953 | if ( substr\_count( $storepage, '?' ) ) { |
  |  | 2954 | $permalink\_divider = "&"; |
  |  | 2955 | } else { |
  |  | 2956 | $permalink\_divider = "?"; |
  |  | 2957 | } |
  | 2968 | 2958 |  |
  | 2969 | 2959 | $product\_ids = array(); |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L2995) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L2985) |  |
  | 2995 | 2985 | $has\_added\_to\_where = false; |
  | 2996 | 2986 | $where\_query = ""; |
  | 2997 |  | if ( count( $product\_ids ) > 0 || |
  | 2998 |  | count( $menu\_ids ) > 0 || |
  | 2999 |  | count( $submenu\_ids ) > 0 || |
  | 3000 |  | count( $subsubmenu\_ids ) > 0 || |
  | 3001 |  | count( $category\_ids ) > 0 ) { |
  | 3002 |  |  |
  |  | 2987 | if ( count( $product\_ids ) > 0 || count( $menu\_ids ) > 0 || count( $submenu\_ids ) > 0 || count( $subsubmenu\_ids ) > 0 || count( $category\_ids ) > 0 ) { |
  | 3003 | 2988 | $where\_query = " WHERE"; |
  | 3004 |  |  |
  | 3005 | 2989 | } |
  | 3006 | 2990 |  |
  | 3007 | 2991 | if ( count( $product\_ids ) > 0 ) { |
  | 3008 |  | if ( !~~$has\_added\_to\_where )~~ |
  |  | 2992 | if ( ! $has\_added\_to\_where ) { |
  | 3009 | 2993 | $where\_query .= " ("; |
  | 3010 |  | ~~else~~ |
  |  | 2994 | } else { |
  | 3011 | 2995 | $where\_query .= " OR ("; |
  | 3012 |  |  |
  | 3013 |  | for ( $i~~=0; $i<~~count( $product\_ids ); $i++ ) { |
  | 3014 |  | if ( $i > 0 ) |
  |  | 2996 | } |
  |  | 2997 | for ( $i = 0; $i < count( $product\_ids ); $i++ ) { |
  |  | 2998 | if ( $i > 0 ) { |
  | 3015 | 2999 | $where\_query .= " OR"; |
  |  | 3000 | } |
  | 3016 | 3001 | $where\_query .= $wpdb->prepare( " product.product\_id = %d", $product\_ids[$i] ); |
  | 3017 | 3002 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3021) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3006) |  |
  | 3021 | 3006 |  |
  | 3022 | 3007 | if ( count( $menu\_ids ) > 0 ) { |
  | 3023 |  | if ( !~~$has\_added\_to\_where )~~ |
  |  | 3008 | if ( ! $has\_added\_to\_where ) { |
  | 3024 | 3009 | $where\_query .= " ("; |
  | 3025 |  | ~~else~~ |
  |  | 3010 | } else { |
  | 3026 | 3011 | $where\_query .= " OR ("; |
  | 3027 |  |  |
  |  | 3012 | } |
  | 3028 | 3013 | for ( $i=0; $i<count( $menu\_ids ); $i++ ) { |
  | 3029 |  | if ( $i > 0 ) |
  |  | 3014 | if ( $i > 0 ) { |
  | 3030 | 3015 | $where\_query .= " OR"; |
  | 3031 |  |  |
  |  | 3016 | } |
  | 3032 | 3017 | $where\_query .= $wpdb->prepare( " ( product.menulevel1\_id\_1 = %d OR product.menulevel2\_id\_1 = %d OR product.menulevel3\_id\_1 = %d )", $menu\_ids[$i], $menu\_ids[$i], $menu\_ids[$i] ); |
  | 3033 | 3018 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3037) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3022) |  |
  | 3037 | 3022 |  |
  | 3038 | 3023 | if ( count( $submenu\_ids ) > 0 ) { |
  | 3039 |  | if ( !~~$has\_added\_to\_where )~~ |
  |  | 3024 | if ( ! $has\_added\_to\_where ) { |
  | 3040 | 3025 | $where\_query .= " ("; |
  | 3041 |  | ~~else~~ |
  |  | 3026 | } else { |
  | 3042 | 3027 | $where\_query .= " OR ("; |
  | 3043 |  |  |
  |  | 3028 | } |
  | 3044 | 3029 | for ( $i=0; $i<count( $submenu\_ids ); $i++ ) { |
  | 3045 |  | if ( $i > 0 ) |
  |  | 3030 | if ( $i > 0 ) { |
  | 3046 | 3031 | $where\_query .= " OR"; |
  | 3047 |  |  |
  |  | 3032 | } |
  | 3048 | 3033 | $where\_query .= $wpdb->prepare( " ( product.menulevel1\_id\_2 = %d OR product.menulevel2\_id\_2 = %d OR product.menulevel3\_id\_2 = %d )", $submenu\_ids[$i], $submenu\_ids[$i], $submenu\_ids[$i] ); |
  | 3049 | 3034 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3059) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3044) |  |
  | 3059 | 3044 |  |
  | 3060 | 3045 | for ( $i=0; $i<count( $subsubmenu\_ids ); $i++ ) { |
  | 3061 |  | if ( $i > 0 ) |
  |  | 3046 | if ( $i > 0 ) { |
  | 3062 | 3047 | $where\_query .= " OR"; |
  | 3063 |  |  |
  |  | 3048 | } |
  | 3064 | 3049 | $where\_query .= $wpdb->prepare( " ( product.menulevel1\_id\_3 = %d OR product.menulevel2\_id\_3 = %d OR product.menulevel3\_id\_3 = %d )", $subsubmenu\_ids[$i], $subsubmenu\_ids[$i], $subsubmenu\_ids[$i] ); |
  | 3065 | 3050 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3069) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3054) |  |
  | 3069 | 3054 |  |
  | 3070 | 3055 | if ( count( $category\_ids ) > 0 ) { |
  | 3071 |  | if ( !~~$has\_added\_to\_where )~~ |
  |  | 3056 | if ( ! $has\_added\_to\_where ) { |
  | 3072 | 3057 | $where\_query .= " ("; |
  | 3073 |  | ~~else~~ |
  |  | 3058 | } else { |
  | 3074 | 3059 | $where\_query .= " OR ("; |
  | 3075 |  |  |
  |  | 3060 | } |
  | 3076 | 3061 | for ( $i=0; $i<count( $category\_ids ); $i++ ) { |
  | 3077 |  | if ( $i > 0 ) |
  |  | 3062 | if ( $i > 0 ) { |
  | 3078 | 3063 | $where\_query .= " OR"; |
  | 3079 |  |  |
  |  | 3064 | } |
  | 3080 | 3065 | $where\_query .= $wpdb->prepare( " ec\_categoryitem.category\_id = %d", $category\_ids[$i] ); |
  | 3081 | 3066 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3091) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3076) |  |
  | 3091 | 3076 |  |
  | 3092 | 3077 | ob\_start(); |
  | 3093 |  | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_store\_table\_display.php' ) ) |
  |  | 3078 | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_store\_table\_display.php' ) ) { |
  | 3094 | 3079 | include( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_store\_table\_display.php' ); |
  | 3095 |  | ~~else~~ |
  |  | 3080 | } else { |
  | 3096 | 3081 | include( EC\_PLUGIN\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_latest\_layout' ) . '/ec\_store\_table\_display.php' ); |
  | 3097 |  |  |
  |  | 3082 | } |
  | 3098 | 3083 | return ob\_get\_clean(); |
  | 3099 | 3084 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3101) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3086) |  |
  | 3101 | 3086 | //[ec\_category\_view] |
  | 3102 | 3087 | function load\_ec\_category\_view( $atts ) { |
  | 3103 |  |  |
  | 3104 | 3088 | extract( shortcode\_atts( array( |
  | 3105 | 3089 | 'parentid' => '0', |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3108) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3092) |  |
  | 3108 | 3092 |  |
  | 3109 | 3093 | ob\_start(); |
  | 3110 |  | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_category\_view.php' ) ) |
  |  | 3094 | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_category\_view.php' ) ) { |
  | 3111 | 3095 | include( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_category\_view.php' ); |
  | 3112 |  | ~~else~~ |
  |  | 3096 | } else { |
  | 3113 | 3097 | include( EC\_PLUGIN\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_latest\_layout' ) . '/ec\_category\_view.php' ); |
  | 3114 |  |  |
  |  | 3098 | } |
  | 3115 | 3099 | return ob\_get\_clean(); |
  | 3116 |  |  |
  | 3117 | 3100 | } |
  | 3118 | 3101 |  |
  | 3119 | 3102 | //[ec\_categories] |
  | 3120 | 3103 | function load\_ec\_categories( $atts ) { |
  | 3121 |  |  |
  | 3122 |  | if ( !defined( 'DONOTCACHEPAGE' ) ) |
  |  | 3104 | if ( !defined( 'DONOTCACHEPAGE' ) ) { |
  | 3123 | 3105 | define( "DONOTCACHEPAGE", true ); |
  | 3124 |  |  |
  | 3125 |  | if ( !~~defined( 'DONOTCDN' ) )~~ |
  |  | 3106 | } |
  |  | 3107 | if ( ! defined( 'DONOTCDN' ) ) { |
  | 3126 | 3108 | define('DONOTCDN', true); |
  | 3127 |  |  |
  |  | 3109 | } |
  | 3128 | 3110 | extract( shortcode\_atts( array( |
  | 3129 | 3111 | 'menuid' => 'NOMENU', |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3148) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3130) |  |
  | 3148 | 3130 | $store\_page->display\_category\_page(); |
  | 3149 | 3131 | return ob\_get\_clean(); |
  | 3150 |  |  |
  | 3151 | 3132 | } |
  | 3152 | 3133 |  |
  | 3153 | 3134 | //[ec\_search] |
  | 3154 | 3135 | function load\_ec\_search( $atts ) { |
  | 3155 |  |  |
  | 3156 | 3136 | extract( shortcode\_atts( array( |
  | 3157 | 3137 | 'label' => 'Search', |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3178) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3158) |  |
  | 3178 | 3158 | } |
  | 3179 | 3159 |  |
  | 3180 |  | if ( substr\_count( $store\_page, '?' ) )                     $permalink\_divider = "&"; |
  | 3181 |  | else                                                        $permalink\_divider = "?"; |
  |  | 3160 | if ( substr\_count( $store\_page, '?' ) ) { |
  |  | 3161 | $permalink\_divider = "&"; |
  |  | 3162 | } else { |
  |  | 3163 | $permalink\_divider = "?"; |
  |  | 3164 | } |
  | 3182 | 3165 |  |
  | 3183 | 3166 | ob\_start(); |
  | 3184 |  | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_search\_widget.php' ) ) |
  |  | 3167 | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_search\_widget.php' ) ) { |
  | 3185 | 3168 | include( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_search\_widget.php' ); |
  | 3186 |  | ~~else~~ |
  |  | 3169 | } else { |
  | 3187 | 3170 | include( EC\_PLUGIN\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_latest\_layout' ) . '/ec\_search\_widget.php' ); |
  |  | 3171 | } |
  | 3188 | 3172 | return ob\_get\_clean(); |
  | 3189 |  |  |
  | 3190 | 3173 | } |
  | 3191 | 3174 |  |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L3200) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L3183) |  |
  | 3200 | 3183 | function ec\_footer\_load() { |
  | 3201 | 3184 | if ( get\_option( 'ec\_option\_enable\_newsletter\_popup' ) && !isset( $\_COOKIE['ec\_newsletter\_popup'] ) ) { |
  | 3202 |  | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_newsletter\_popup.php' ) ) |
  |  | 3185 | if ( file\_exists( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_newsletter\_popup.php' ) ) { |
  | 3203 | 3186 | include( EC\_PLUGIN\_DATA\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_base\_layout' ) . '/ec\_newsletter\_popup.php' ); |
  | 3204 |  | ~~else~~ |
  |  | 3187 | } else { |
  | 3205 | 3188 | include( EC\_PLUGIN\_DIRECTORY . '/design/layout/' . get\_option( 'ec\_option\_latest\_layout' ) . '/ec\_newsletter\_popup.php' ); |
  | 3206 |  |  |
  |  | 3189 | } |
  | 3207 | 3190 | } |
  | 3208 | 3191 | } |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L5328) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L5311) |  |
  | 5328 | 5311 | die(); |
  | 5329 | 5312 | } |
  |  | 5313 | $ec\_db = new ec\_db(); |
  | 5330 | 5314 | $cartpage = new ec\_cartpage(); |
  | 5331 | 5315 | if ( isset( $\_POST['shipping\_address\_first\_name'] ) && '' != $\_POST['shipping\_address\_first\_name'] && 'undefined' != $\_POST['shipping\_address\_first\_name'] ) { |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L5414) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L5398) |  |
  | 5414 | 5398 | $GLOBALS['ec\_cart\_data']->cart\_data->guest\_key = ""; |
  | 5415 | 5399 | } |
  |  | 5400 |  |
  |  | 5401 | // Manage Subscriber |
  |  | 5402 | $is\_subscriber = ( isset( $\_POST['ec\_cart\_is\_subscriber'] ) && '1' == $\_POST['ec\_cart\_is\_subscriber'] ) ? 1 : 0; |
  |  | 5403 | if ( isset( $\_POST['ec\_cart\_is\_subscriber'] ) && '1' == $\_POST['ec\_cart\_is\_subscriber'] ) { |
  |  | 5404 | $first\_name = sanitize\_text\_field( $GLOBALS['ec\_cart\_data']->cart\_data->shipping\_first\_name ); |
  |  | 5405 | $last\_name = sanitize\_text\_field( $GLOBALS['ec\_cart\_data']->cart\_data->shipping\_last\_name ); |
  |  | 5406 | $email = sanitize\_text\_field( $GLOBALS['ec\_cart\_data']->cart\_data->email ); |
  |  | 5407 |  |
  |  | 5408 | $ec\_db->insert\_subscriber( $email, $first\_name, $last\_name ); |
  |  | 5409 |  |
  |  | 5410 | if ( $GLOBALS['ec\_user']->user\_id ) { |
  |  | 5411 | global $wpdb; |
  |  | 5412 | $wpdb->query( $wpdb->prepare( "UPDATE ec\_user SET is\_subscriber = 1 WHERE ec\_user.user\_id = %d", $GLOBALS['ec\_user']->user\_id ) ); |
  |  | 5413 | } |
  |  | 5414 |  |
  |  | 5415 | // MyMail Hook |
  |  | 5416 | if ( function\_exists( 'mailster' ) ) { |
  |  | 5417 | $subscriber\_id = mailster('subscribers')->add(array( |
  |  | 5418 | 'firstname' => $first\_name, |
  |  | 5419 | 'lastname' => $last\_name, |
  |  | 5420 | 'email' => $email, |
  |  | 5421 | 'status' => 1, |
  |  | 5422 | ), false ); |
  |  | 5423 | } |
  |  | 5424 |  |
  |  | 5425 | do\_action( 'wpeasycart\_insert\_subscriber', $email, $first\_name, $last\_name ); |
  |  | 5426 | } |
  |  | 5427 |  |
  | 5416 | 5428 | $GLOBALS['ec\_cart\_data']->save\_session\_to\_db(); |
  | 5417 | 5429 |  |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L6550) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L6562) |  |
  | 6550 | 6562 | $GLOBALS['ec\_cart\_data']->cart\_data->payment\_type = $payment\_type; |
  | 6551 | 6563 | $GLOBALS['ec\_cart\_data']->save\_session\_to\_db(); |
  |  | 6564 |  |
  |  | 6565 | if ( 'stripe' == get\_option( 'ec\_option\_payment\_process\_method' ) || 'stripe\_connect' == get\_option( 'ec\_option\_payment\_process\_method' ) ) { |
  |  | 6566 | if ( 'stripe' == get\_option( 'ec\_option\_payment\_process\_method' ) ) { |
  |  | 6567 | $stripe = new ec\_stripe(); |
  |  | 6568 | } else { |
  |  | 6569 | $stripe = new ec\_stripe\_connect(); |
  |  | 6570 | } |
  |  | 6571 | $stripe->update\_payment\_intent\_total( $GLOBALS['ec\_cart\_data']->cart\_data->stripe\_paymentintent\_id, $order\_totals ); |
  |  | 6572 | } |
  | 6552 | 6573 |  |
  | 6553 | 6574 | $return\_array = ec\_get\_cart\_data(); |
  | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3047999#L7310) | […](/browser/wp-easycart/trunk/wpeasycart.php?rev=3068711#L7331) |  |
  | 7310 | 7331 | add\_action( 'wp\_ajax\_nopriv\_ec\_ajax\_get\_dynamic\_cart\_page', 'ec\_ajax\_get\_dynamic\_cart\_page' ); |
  | 7311 | 7332 | function ec\_ajax\_get\_dynamic\_cart\_page() { |
  | 7312 |  |  |
  |  | 7333 | wpeasycart\_session()->handle\_session(); |
  | 7313 | 7334 | if ( ! isset( $\_POST['nonce'] ) || ! wp\_verify\_nonce( sanitize\_text\_field( $\_POST['nonce'] ), 'wp-easycart-get-dynamic-cart-page' ) ) { |
  | 7314 | 7335 | die(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3068711)
* [Zip Archive](?format=zip&new=3068711)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

