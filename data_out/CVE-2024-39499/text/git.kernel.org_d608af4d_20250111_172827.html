

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f70ff737346744633e7b655c1fb23e1578491ff3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f70ff737346744633e7b655c1fb23e1578491ff3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f70ff737346744633e7b655c1fb23e1578491ff3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f70ff737346744633e7b655c1fb23e1578491ff3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hagar Gamal Halim Hemdan <hagarhem@amazon.com> | 2024-04-30 08:59:16 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:12:30 +0200 |
| commit | [f70ff737346744633e7b655c1fb23e1578491ff3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f70ff737346744633e7b655c1fb23e1578491ff3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f70ff737346744633e7b655c1fb23e1578491ff3)) | |
| tree | [cbdf0bc47ed486eb4dccbbac7ccd488443b995c3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f70ff737346744633e7b655c1fb23e1578491ff3) | |
| parent | [4dfffb50316c761c59386c9b002a10ac6d7bb6c9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4dfffb50316c761c59386c9b002a10ac6d7bb6c9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f70ff737346744633e7b655c1fb23e1578491ff3&id2=4dfffb50316c761c59386c9b002a10ac6d7bb6c9)) | |
| download | [linux-f70ff737346744633e7b655c1fb23e1578491ff3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f70ff737346744633e7b655c1fb23e1578491ff3.tar.gz) | |

vmci: prevent speculation leaks by sanitizing event in event\_deliver()commit 8003f00d895310d409b2bf9ef907c56b42a4e0f4 upstream.
Coverity spotted that event\_msg is controlled by user-space,
event\_msg->event\_data.event is passed to event\_deliver() and used
as an index without sanitization.
This change ensures that the event index is sanitized to mitigate any
possibility of speculative information leaks.
This bug was discovered and resolved using Coverity Static Analysis
Security Testing (SAST) by Synopsys, Inc.
Only compile tested, no access to HW.
Fixes: 1d990201f9bb ("VMCI: event handling implementation.")
Cc: stable <stable@kernel.org>
Signed-off-by: Hagar Gamal Halim Hemdan <hagarhem@amazon.com>
Link: <https://lore.kernel.org/stable/20231127193533.46174-1-hagarhem%40amazon.com>
Link: [https://lore.kernel.org/r/20240430085916.4753-1-hagarhem@amazon.com](https://lore.kernel.org/r/20240430085916.4753-1-hagarhem%40amazon.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f70ff737346744633e7b655c1fb23e1578491ff3)

| -rw-r--r-- | [drivers/misc/vmw\_vmci/vmci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/misc/vmw_vmci/vmci_event.c?id=f70ff737346744633e7b655c1fb23e1578491ff3) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/drivers/misc/vmw\_vmci/vmci\_event.c b/drivers/misc/vmw\_vmci/vmci\_event.cindex e3436abf39f458..5b7ef47f4c1186 100644--- a/[drivers/misc/vmw\_vmci/vmci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/misc/vmw_vmci/vmci_event.c?id=4dfffb50316c761c59386c9b002a10ac6d7bb6c9)+++ b/[drivers/misc/vmw\_vmci/vmci\_event.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/misc/vmw_vmci/vmci_event.c?id=f70ff737346744633e7b655c1fb23e1578491ff3)@@ -9,6 +9,7 @@ #include <linux/vmw\_vmci\_api.h> #include <linux/list.h> #include <linux/module.h>+#include <linux/nospec.h> #include <linux/sched.h> #include <linux/slab.h> #include <linux/rculist.h>@@ -86,9 +87,12 @@ static void event\_deliver(struct vmci\_event\_msg \*event\_msg) { struct vmci\_subscription \*cur; struct list\_head \*subscriber\_list;+ u32 sanitized\_event, max\_vmci\_event;  rcu\_read\_lock();- subscriber\_list = &subscriber\_array[event\_msg->event\_data.event];+ max\_vmci\_event = ARRAY\_SIZE(subscriber\_array);+ sanitized\_event = array\_index\_nospec(event\_msg->event\_data.event, max\_vmci\_event);+ subscriber\_list = &subscriber\_array[sanitized\_event]; list\_for\_each\_entry\_rcu(cur, subscriber\_list, node) { cur->callback(cur->id, &event\_msg->event\_data, cur->callback\_data); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 17:27:04 +0000

