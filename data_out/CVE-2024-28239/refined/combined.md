=== Content from github.com_43d61e63_20250111_040115.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fsecurity%2Fadvisories%2FGHSA-fr3w-2p22-6w7p)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fsecurity%2Fadvisories%2FGHSA-fr3w-2p22-6w7p)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=directus%2Fdirectus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[directus](/directus)
/
**[directus](/directus/directus)**
Public

* [Notifications](/login?return_to=%2Fdirectus%2Fdirectus) You must be signed in to change notification settings
* [Fork
  4k](/login?return_to=%2Fdirectus%2Fdirectus)
* [Star
   28.7k](/login?return_to=%2Fdirectus%2Fdirectus)

* [Code](/directus/directus)
* [Issues
  536](/directus/directus/issues)
* [Pull requests
  24](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects
  0](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

Additional navigation options

* [Code](/directus/directus)
* [Issues](/directus/directus/issues)
* [Pull requests](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

# CWE-601: URL Redirection to Untrusted Site in OAuth2/OpenID

Moderate

[rijkvanzanten](/rijkvanzanten)
published
GHSA-fr3w-2p22-6w7p
Mar 12, 2024

## Package

npm

directus/directus
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 10.10.0

## Patched versions

10.10.0

## Description

### Summary

The authentication API has a `redirect` parameter that can be exploited as an open redirect vulnerability as the user tries to log in via the API URL <https://docs.directus.io/reference/authentication.html#login-using-sso-providers> /auth/login/google?redirect for example.

### Details

There's a redirect that is done after successful login via the Auth API GET request to `directus/auth/login/google?redirect=http://malicious-fishing-site.com`, which I think is here: <https://github.com/directus/directus/blob/main/api/src/auth/drivers/oauth2.ts#L394>. While credentials don't seem to be passed to the attacker site, the user can be phished into clicking a legitimate directus site and be taken to a malicious site made to look like a an error message "Your password needs to be updated" to phish out the current password.

### PoC

Turn on any auth provider in Directus instance. Form a link to `directus-instance/auth/login/:provider_id?redirect=http://malicious-fishing-site.com`, login and get taken to malicious-site. Tested on the `ory` OAuth2 integration.

### Impact

Users who login via OAuth2 into Directus.

### Severity

Moderate

5.4

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N

### CVE ID

CVE-2024-28239

### Weaknesses

[CWE-601](/advisories?query=cwe%3A601)

### Credits

* [![@soulseekah](https://avatars.githubusercontent.com/u/685880?s=40&v=4)](/soulseekah)
  [soulseekah](/soulseekah)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.directus.io_cf6121a6_20250111_040113.html ===

 [Skip to content](#VPContent) [![](/logo-dark.svg)![](/logo-light.svg)](/)Search`K`Main Navigation[Website](https://directus.io/)[Cloud Dashboard](https://directus.cloud/)[Directus TV](https://directus.io/tv)[GitHub](https://github.com/directus/directus)[Twitter](https://twitter.com/directus)[Discord](https://directus.chat)

Appearance

[GitHub](https://github.com/directus/directus)[Twitter](https://twitter.com/directus)[Discord](https://directus.chat)MenuReturn to top Sidebar Navigation [Developers](/)[User Guide](/user-guide/overview/data-studio-app)
## Getting Started

[Introduction](/getting-started/introduction)[Quickstart Guide](/getting-started/quickstart)[Architecture](/getting-started/architecture)[Help & Support](/getting-started/support)[Resources](/getting-started/resources)[Developer Blog](/blog/)
## Data Studio App

[### Data Model](/app/data-model)[Collections](/app/data-model/collections)[#### Fields](/app/data-model/fields)[Text & Numbers](/app/data-model/fields/text-numbers)[Selection](/app/data-model/fields/selection)[Relational](/app/data-model/fields/relational)[Presentation](/app/data-model/fields/presentation)[Groups](/app/data-model/fields/groups)[Other](/app/data-model/fields/other)[Relationships](/app/data-model/relationships)[### Flows](/app/flows)[Triggers](/app/flows/triggers)[Operations](/app/flows/operations)
## API Reference

[Introduction](/reference/introduction)[Authentication](/reference/authentication)[Global Parameters](/reference/query)[Filter Rules](/reference/filter-rules)[Items](/reference/items)[Files](/reference/files)[Activity](/reference/system/activity)[Collections](/reference/system/collections)[Comments](/reference/system/comments)[Content Versions](/reference/system/versions)[Dashboards](/reference/system/dashboards)[Extensions](/reference/system/extensions)[Fields](/reference/system/fields)[Flows](/reference/system/flows)[Folders](/reference/system/folders)[Notifications](/reference/system/notifications)[Operations](/reference/system/operations)[Panels](/reference/system/panels)[Permissions](/reference/system/permissions)[Policies](/reference/system/policies)[Presets](/reference/system/presets)[Relations](/reference/system/relations)[Revisions](/reference/system/revisions)[Roles](/reference/system/roles)[Schema](/reference/system/schema)[Server](/reference/system/server)[Settings](/reference/system/settings)[Shares](/reference/system/shares)[Custom Translations](/reference/system/translations)[Users](/reference/system/users)[Utilities](/reference/system/utilities)
## Guides

[All Guides](/guides/)[SDK Guides](/guides/sdk)[Framework Guides](/guides/frameworks)[Use Case Guides](/guides/use-cases)[Realtime Guides](/guides/real-time)[Extensions Guides](/guides/extensions)[Administration Guides](/guides/administration)
## Use Cases

### Headless CMS

[Introduction](/use-cases/headless-cms/introduction)[Concepts](/use-cases/headless-cms/concepts)[Security Best Practices](/use-cases/headless-cms/security)
## Extensions

### Fundamentals

[Introduction](/extensions/introduction)[Installing Extensions](/extensions/installing-extensions)
### Developing Extensions

[Creating Extensions](/extensions/creating-extensions)
#### Extension Types

[Displays](/extensions/displays)[Endpoints](/extensions/endpoints)[Hooks](/extensions/hooks)[Interfaces](/extensions/interfaces)[Layouts](/extensions/layouts)[Modules](/extensions/modules)[Operations](/extensions/operations)[Panels](/extensions/panels)[Themes](/extensions/themes)[Bundles](/extensions/bundles)
#### Sandboxed Extensions

[Introduction](/extensions/sandbox/introduction)[Registering Extensions](/extensions/sandbox/register)[Sandbox SDK](/extensions/sandbox/sandbox-sdk)
#### Extension Services

[Introduction](/extensions/services/introduction)[Accessing Items](/extensions/services/accessing-items)[Configuring Collections, Fields, and Relations](/extensions/services/configuring-collections)[Accessing Files](/extensions/services/accessing-files)[Working with Users](/extensions/services/working-with-users)
### Resources

[Components](/extensions/using-ui-components)[Composables](/extensions/app-composables)[Packages](/contributing/codebase-overview#packages-packages)[Marketplace Beta](/extensions/marketplace/publishing)
## Contributing

[Introduction](/contributing/introduction)
### Code

[Request a Feature](/contributing/feature-request-process)[Pull Request Process](/contributing/pull-request-process)[Codebase Overview](/contributing/codebase-overview)[Running Dev Environment](/contributing/running-locally)[Tests](/contributing/tests)[Community](/contributing/community)[Sponsorship & Advocacy](/contributing/sponsor)
## Self-Hosted

[Quickstart](/self-hosted/quickstart)[Config Options](/self-hosted/config-options)[Docker Guide](/self-hosted/docker-guide)[CLI](/self-hosted/cli)[Migrations](/self-hosted/migrations)[Email Templates](/self-hosted/email-templates)
### Single Sign-On (SSO)

[Quickstart](/self-hosted/sso)[Examples](/self-hosted/sso-examples)[Upgrades & Migrations](/self-hosted/upgrades-migrations)
## Releases

[Release Notes](https://github.com/directus/directus/releases)[Breaking Changes](/releases/breaking-changes)On this page Table of Contents for current page

## Newsletter

Get insights, releases, and updates delivered directly to your inbox once a month.

## Directus Cloud

Everything you need to start building. Provisioned in 90 seconds. Starting at $15/month.

[Get Started](https://directus.cloud)
# Authentication [​](#authentication)

> All data within the platform is private by default. The [public role](/user-guide/user-management/users-roles-permissions#configure-permissions) can be configured to expose data without authentication, or you can pass an access token to the API to access private data.

## Access Tokens [​](#access-tokens)

There are three types of tokens that can be used to authenticate within Directus.

**Temporary Token (JWT)** are returned by the [login](#login) endpoint/mutation. These tokens have a relatively short expiration time, and are thus the most secure option to use. The tokens are returned with a refresh token that can be used to retrieve a new access token via the [refresh](#refresh) endpoint/mutation.

**Session Token (JWT)** can also be returned by the [login](#login) endpoint/mutation.
 Session tokens combine both a refresh token and access token in a single cookie. These tokens should not have a short expiration time like the Temporary Tokens as you cannot refresh these after they have expired.

**Static Tokens** can be set for each platform user, and never expire. They are less secure, but quite useful for server-to-server communication. They are saved as plain-text within `directus_users.token`. Static Tokens are created in user settings inside of the Directus Data Studio User Module, or by updating the user's `token` value via API.

Once you have your access token, there are three ways to pass it to the API: in the request's `Authorization` Header, as session cookie or via the `access_token` query parameter.

### Authorization Header [​](#authorization-header)

```
Authorization: Bearer <token>
```
```
Authorization: Bearer <token>
```
### Session Cookie [​](#session-cookie)

```
Cookie: directus_session_token=<token>
```
```
Cookie: directus_session_token=<token>
```
### Query Parameter [​](#query-parameter)

```
?access_token=<token>
```
```
?access_token=<token>
```

WARNING

The query parameter option is not recommended in production setups as the parameter can get logged by various systems.

## Register [​](#register)

Register a new user.

Disabled by Default

The user registration feature is disabled by default. To make use of it, it must first be enabled via Project Settings.

Register vs Create User

You can also use the [create user](/reference/system/users#create-a-user) endpoint, but this will require the correct permissions on the `directus_users` collection. The register endpoint is publicly available if enabled in your project.

### Request [​](#request)

RESTGraphQLSDK
#### Request Body [​](#request-body)

`email` **Required**
 Email address of the user.

`password` **Required**
 Password of the user.

`first_name`
 First name of the user.

`last_name`
 Last name of the user.

`verification_url`
 Provide a custom verification URL for the verification email. The verification token will be appended to this URL as a query parameter.
**Note**: Only URLs that are configured via the [`USER_REGISTER_URL_ALLOW_LIST` environment variable](/self-hosted/config-options#security) will be accepted.

### Example [​](#example)

RESTGraphQLSDK
## Verify a Registration [​](#verify-a-registration)

If enabled in project settings, registering a user sends a verification email with a link to this endpoint (or a custom URL) to allow the user to finish their registration.

### Request [​](#request-1)

RESTGraphQLSDK
#### Request Body [​](#request-body-1)

`token` **Required**
 Verification token, as provided in the verification email sent by the registration endpoint.

### Example [​](#example-1)

RESTGraphQLSDK
## Login [​](#login)

Authenticate as a user.

### Request [​](#request-2)

RESTGraphQLSDK
#### Request Body [​](#request-body-2)

`email` **Required**
 Email address of the user.

`password` **Required**
 Password of the user.

`otp`
 The user's one-time-password (if MFA is enabled).

`mode`
 Whether to retrieve the refresh token in the JSON response, or in a `httpOnly` cookie. One of `json`, `cookie` or `session`. Defaults to `json`.

### Response [​](#response)

`access_token` **string**
 Temporary access token to be used in follow-up requests. Note: if you used `session` as the mode in the request, the access token won't be returned in the JSON.

`expires` **integer**
 How long before the access token will expire. Value is in milliseconds.

`refresh_token` **string**
 The token that can be used to retrieve a new access token through [`/auth/refresh`](#refresh). Note: if you used `cookie` or `session` as the mode in the request, the refresh token won't be returned in the JSON.

Expiry time

The token's expiration time can be configured through [the `ACCESS_TOKEN_TTL` environment variable](/self-hosted/config-options#general).

### Example [​](#example-2)

RESTGraphQLSDK
## Refresh [​](#refresh)

Retrieve a new access token using a refresh token.

### Request [​](#request-3)

RESTGraphQLSDK
#### Request Body [​](#request-body-3)

`refresh_token`
 The refresh token to use. If you have the refresh token in a cookie through [`/auth/login`](#login), you don't have to submit it here.

`mode`
 Whether to submit and retrieve the refresh token in the JSON response, or in a `httpOnly` cookie. One of `json`, `cookie` or `session`.

### Response [​](#response-1)

`access_token` **string**
 Temporary access token to be used in follow-up requests. Note: if you used `session` as the mode in the request, the access token won't be returned in the JSON.

`expires` **integer**
 How long before the access token will expire. Value is in milliseconds.

`refresh_token` **string**
 The token that can be used to retrieve a new access token through [`/auth/refresh`](#refresh). Note: if you used `cookie` or `session` as the mode in the request, the refresh token won't be returned in the JSON.

### Example [​](#example-3)

RESTGraphQLSDK
## Logout [​](#logout)

Invalidate the refresh token thus destroying the user's session.

### Request [​](#request-4)

RESTGraphQLSDK
#### Request Body [​](#request-body-4)

`refresh_token`
 The refresh token to invalidate. If you have the refresh token in a cookie through [`/auth/login`](#login), you don't have to submit it here.

`mode`
 Whether the refresh token is submitted in the JSON response, or in a `httpOnly` cookie. One of `json`, `cookie` or `session`.

### Example [​](#example-4)

RESTGraphQLSDK
## Request Password Reset [​](#request-password-reset)

Request a password reset email to be sent to the given user.

### Request [​](#request-5)

RESTGraphQLSDK
#### Request Body [​](#request-body-5)

`email` **Required**
 Email address of the user you're requesting a password reset for.

`reset_url`
 Provide a custom reset url which the link in the email will lead to. The reset token will be passed as a parameter.
**Note**: You need to configure the [`PASSWORD_RESET_URL_ALLOW_LIST` environment variable](/self-hosted/config-options#security) to enable this feature.

### Example [​](#example-5)

RESTGraphQLSDK
## Reset a Password [​](#reset-a-password)

The request a password reset endpoint sends an email with a link to the Data Studio (or a custom route) which in turn uses this endpoint to allow the user to reset their password.

### Request [​](#request-6)

RESTGraphQLSDK
#### Request Body [​](#request-body-6)

`token` **Required**
 Password reset token, as provided in the email sent by the request endpoint.

`password` **Required**
 New password for the user.

### Example [​](#example-6)

RESTGraphQLSDK
## List Auth Providers [​](#list-auth-providers)

List all the configured auth providers.

Configuring auth providers

To learn more about setting up auth providers, see [Configuring auth providers](/self-hosted/config-options#authentication).

### Request [​](#request-7)

RESTSDK
### Response [​](#response-2)

json
```
{
	"data": [
		{
			"name": "GitHub",
			"driver": "oauth2",
			"icon": "github"
		},
		{
			"name": "Google",
			"driver": "openid",
			"icon": "google"
		},
		{
			"name": "Okta",
			"driver": "openid"
		}
	],
	"disableDefault": false
}
```
```
{
	"data": [
		{
			"name": "GitHub",
			"driver": "oauth2",
			"icon": "github"
		},
		{
			"name": "Google",
			"driver": "openid",
			"icon": "google"
		},
		{
			"name": "Okta",
			"driver": "openid"
		}
	],
	"disableDefault": false
}
```

`data` **Array**
 Array of configured auth providers.

`disableDefault` **boolean**
 Whether or not the default authentication provider is disabled.

### Example [​](#example-7)

RESTSDK
## Login Using SSO Providers [​](#login-using-sso-providers)

Will redirect to the configured SSO provider for the user to login.

### Request [​](#request-8)

RESTSDK

Tell us what is missing

How helpful was this article?

Worst Doc Ever 🗑️Not Helpful 😡Helpful 😃Super Helpful 🤩 [Edit this page](https://github.com/directus/directus/edit/main/docs/reference/authentication.md)

Last updated:

[Previous pageIntroduction](/reference/introduction)[Next pageGlobal Parameters](/reference/query)



=== Content from github.com_d106421d_20250111_040115.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2F5477d7d61babd7ffc2f835d399bf79611b15b203)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2F5477d7d61babd7ffc2f835d399bf79611b15b203)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=directus%2Fdirectus)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[directus](/directus)
/
**[directus](/directus/directus)**
Public

* [Notifications](/login?return_to=%2Fdirectus%2Fdirectus) You must be signed in to change notification settings
* [Fork
  4k](/login?return_to=%2Fdirectus%2Fdirectus)
* [Star
   28.7k](/login?return_to=%2Fdirectus%2Fdirectus)

* [Code](/directus/directus)
* [Issues
  536](/directus/directus/issues)
* [Pull requests
  24](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects
  0](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

Additional navigation options

* [Code](/directus/directus)
* [Issues](/directus/directus/issues)
* [Pull requests](/directus/directus/pulls)
* [Discussions](/directus/directus/discussions)
* [Actions](/directus/directus/actions)
* [Projects](/directus/directus/projects)
* [Security](/directus/directus/security)
* [Insights](/directus/directus/pulse)

## Commit

[Permalink](/directus/directus/commit/5477d7d61babd7ffc2f835d399bf79611b15b203)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix URL Redirection in OAuth2/OpenID/SAML ([#21238](https://github.com/directus/directus/pull/21238))

[Browse files](/directus/directus/tree/5477d7d61babd7ffc2f835d399bf79611b15b203)
Browse the repository at this point in the history

```
Co-authored-by: Pascal Jufer <pascal-jufer@bluewin.ch>
Co-authored-by: Azri Kahar <42867097+azrikahar@users.noreply.github.com>
```

* Loading branch information

[![@br41nslug](https://avatars.githubusercontent.com/u/9389634?s=40&v=4)](/br41nslug) [![@paescuj](https://avatars.githubusercontent.com/u/5363448?s=40&v=4)](/paescuj) [![@azrikahar](https://avatars.githubusercontent.com/u/42867097?s=40&v=4)](/azrikahar)

3 people

authored
Mar 4, 2024

1 parent
[068591d](/directus/directus/commit/068591def095b488d26e1ede539ade5f29fda56e)

commit 5477d7d

 Show file tree

 Hide file tree

Showing
**11 changed files**
with
**261 additions**
and
**66 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .changeset

  + .changeset/calm-tables-destroy.md
    [calm-tables-destroy.md](#diff-6bae446790112f0edf08dc644df2b3247f5bcf8c7b1021c67559493d6f0ad7df)
* api/src

  + auth/drivers

    - api/src/auth/drivers/oauth2.ts
      [oauth2.ts](#diff-249d6560e108f61fab7c1b235ece9adcf3880369803d990f7771a680888fb408)
    - api/src/auth/drivers/openid.ts
      [openid.ts](#diff-160e58a4a442b2dfcc47f5e9b61aae24dd3a9c83be5ec10b464a9d6ca00f524f)
    - api/src/auth/drivers/saml.ts
      [saml.ts](#diff-ac05b366a31e1597161ac32402232c19be26265841703d9e88bf144efd08da54)
  + utils

    - api/src/utils/is-login-redirect-allowed.test.ts
      [is-login-redirect-allowed.test.ts](#diff-e8383f845136cba31338f761b54502f8c39004ba39fb2735f373f5bd112a8194)
    - api/src/utils/is-login-redirect-allowed.ts
      [is-login-redirect-allowed.ts](#diff-deb282df03cd4c64d184999eb2426ff99777dece827d49097cbd1e60b08c25e7)
    - api/src/utils/is-url-allowed.test.ts
      [is-url-allowed.test.ts](#diff-144f0f05c7f8780d06121e652a95a5da1a0499376362b2249ffff664d5390422)
    - api/src/utils/is-url-allowed.ts
      [is-url-allowed.ts](#diff-6da9fb4562ef04b043adde74e20ea6684657a28c2d9f96554b9d7cc87da48815)
* docs

  + releases

    - docs/releases/breaking-changes.md
      [breaking-changes.md](#diff-f3af8314c65b051941d2edb128df5ea233ca136427e8aa2f2a6051ce52d66cb5)
  + self-hosted

    - docs/self-hosted/config-options.md
      [config-options.md](#diff-6c9021be04ae4fe86d0b910deddd60e24586d9813b0597aff9fe2842842d0085)
* packages/env/src/constants

  + packages/env/src/constants/directus-variables.ts
    [directus-variables.ts](#diff-52b614e66864a96c7dc079c1cc0fa9ad96958e93e52f3bbdf57c8d2e0a9a7980)

## There are no files selected for viewing

6 changes: 6 additions & 0 deletions

6
[.changeset/calm-tables-destroy.md](#diff-6bae446790112f0edf08dc644df2b3247f5bcf8c7b1021c67559493d6f0ad7df ".changeset/calm-tables-destroy.md")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/.changeset/calm-tables-destroy.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,6 @@ |
|  |  | --- |
|  |  | "@directus/api": patch |
|  |  | "@directus/env": patch |
|  |  | --- |
|  |  |  |
|  |  | Fixed potential Open Redirect vulnerability with OAuth2/OpenID/SAML SSO providers (via Directus redirect query parameter), by requiring redirect URLs to be enabled via allow list |

21 changes: 12 additions & 9 deletions

21
[api/src/auth/drivers/oauth2.ts](#diff-249d6560e108f61fab7c1b235ece9adcf3880369803d990f7771a680888fb408 "api/src/auth/drivers/oauth2.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/auth/drivers/oauth2.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ import { useEnv } from '@directus/env'; |
|  |  | import { |
|  |  | ErrorCode, |
|  |  | InvalidCredentialsError, |
|  |  | InvalidPayloadError, |
|  |  | InvalidProviderConfigError, |
|  |  | InvalidProviderError, |
|  |  | InvalidTokenError, |
| Expand All | | @@ -16,6 +17,7 @@ import jwt from 'jsonwebtoken'; |
|  |  | import type { Client } from 'openid-client'; |
|  |  | import { errors, generators, Issuer } from 'openid-client'; |
|  |  | import { getAuthProvider } from '../../auth.js'; |
|  |  | import { REFRESH\_COOKIE\_OPTIONS, SESSION\_COOKIE\_OPTIONS } from '../../constants.js'; |
|  |  | import getDatabase from '../../database/index.js'; |
|  |  | import emitter from '../../emitter.js'; |
|  |  | import { useLogger } from '../../logger.js'; |
| Expand All | | @@ -26,9 +28,9 @@ import type { AuthData, AuthDriverOptions, User } from '../../types/index.js'; |
|  |  | import asyncHandler from '../../utils/async-handler.js'; |
|  |  | import { getConfigFromEnv } from '../../utils/get-config-from-env.js'; |
|  |  | import { getIPFromReq } from '../../utils/get-ip-from-req.js'; |
|  |  | import { isLoginRedirectAllowed } from '../../utils/is-login-redirect-allowed.js'; |
|  |  | import { Url } from '../../utils/url.js'; |
|  |  | import { LocalAuthDriver } from './local.js'; |
|  |  | import { REFRESH\_COOKIE\_OPTIONS, SESSION\_COOKIE\_OPTIONS } from '../../constants.js'; |
|  |  |  |
|  |  | export class OAuth2AuthDriver extends LocalAuthDriver { |
|  |  | client: Client; |
| Expand Down  Expand Up | | @@ -298,15 +300,16 @@ export function createOAuth2AuthRouter(providerName: string): Router { |
|  |  | const provider = getAuthProvider(providerName) as OAuth2AuthDriver; |
|  |  | const codeVerifier = provider.generateCodeVerifier(); |
|  |  | const prompt = !!req.query['prompt']; |
|  |  | const redirect = req.query['redirect']; |
|  |  |  |
|  |  | const token = jwt.sign( |
|  |  | { verifier: codeVerifier, redirect: req.query['redirect'], prompt }, |
|  |  | env['SECRET'] as string, |
|  |  | { |
|  |  | expiresIn: '5m', |
|  |  | issuer: 'directus', |
|  |  | }, |
|  |  | ); |
|  |  | if (isLoginRedirectAllowed(redirect, providerName) === false) { |
|  |  | throw new InvalidPayloadError({ reason: `URL "${redirect}" can't be used to redirect after login` }); |
|  |  | } |
|  |  |  |
|  |  | const token = jwt.sign({ verifier: codeVerifier, redirect, prompt }, env['SECRET'] as string, { |
|  |  | expiresIn: '5m', |
|  |  | issuer: 'directus', |
|  |  | }); |
|  |  |  |
|  |  | res.cookie(`oauth2.${providerName}`, token, { |
|  |  | httpOnly: true, |
| Expand Down | |  |

22 changes: 12 additions & 10 deletions

22
[api/src/auth/drivers/openid.ts](#diff-160e58a4a442b2dfcc47f5e9b61aae24dd3a9c83be5ec10b464a9d6ca00f524f "api/src/auth/drivers/openid.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/auth/drivers/openid.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2,6 +2,7 @@ import { useEnv } from '@directus/env'; |
|  |  | import { |
|  |  | ErrorCode, |
|  |  | InvalidCredentialsError, |
|  |  | InvalidPayloadError, |
|  |  | InvalidProviderConfigError, |
|  |  | InvalidProviderError, |
|  |  | InvalidTokenError, |
| Expand All | | @@ -16,6 +17,7 @@ import jwt from 'jsonwebtoken'; |
|  |  | import type { Client } from 'openid-client'; |
|  |  | import { errors, generators, Issuer } from 'openid-client'; |
|  |  | import { getAuthProvider } from '../../auth.js'; |
|  |  | import { REFRESH\_COOKIE\_OPTIONS, SESSION\_COOKIE\_OPTIONS } from '../../constants.js'; |
|  |  | import getDatabase from '../../database/index.js'; |
|  |  | import emitter from '../../emitter.js'; |
|  |  | import { useLogger } from '../../logger.js'; |
| Expand All | | @@ -26,9 +28,9 @@ import type { AuthData, AuthDriverOptions, User } from '../../types/index.js'; |
|  |  | import asyncHandler from '../../utils/async-handler.js'; |
|  |  | import { getConfigFromEnv } from '../../utils/get-config-from-env.js'; |
|  |  | import { getIPFromReq } from '../../utils/get-ip-from-req.js'; |
|  |  | import { isLoginRedirectAllowed } from '../../utils/is-login-redirect-allowed.js'; |
|  |  | import { Url } from '../../utils/url.js'; |
|  |  | import { LocalAuthDriver } from './local.js'; |
|  |  | import { REFRESH\_COOKIE\_OPTIONS, SESSION\_COOKIE\_OPTIONS } from '../../constants.js'; |
|  |  |  |
|  |  | export class OpenIDAuthDriver extends LocalAuthDriver { |
|  |  | client: Promise<Client>; |
| Expand Down  Expand Up | | @@ -320,7 +322,6 @@ const handleError = (e: any) => { |
|  |  |  |
|  |  | export function createOpenIDAuthRouter(providerName: string): Router { |
|  |  | const env = useEnv(); |
|  |  |  |
|  |  | const router = Router(); |
|  |  |  |
|  |  | router.get( |
| Expand All | | @@ -329,15 +330,16 @@ export function createOpenIDAuthRouter(providerName: string): Router { |
|  |  | const provider = getAuthProvider(providerName) as OpenIDAuthDriver; |
|  |  | const codeVerifier = provider.generateCodeVerifier(); |
|  |  | const prompt = !!req.query['prompt']; |
|  |  | const redirect = req.query['redirect']; |
|  |  |  |
|  |  | const token = jwt.sign( |
|  |  | { verifier: codeVerifier, redirect: req.query['redirect'], prompt }, |
|  |  | env['SECRET'] as string, |
|  |  | { |
|  |  | expiresIn: '5m', |
|  |  | issuer: 'directus', |
|  |  | }, |
|  |  | ); |
|  |  | if (isLoginRedirectAllowed(redirect, providerName) === false) { |
|  |  | throw new InvalidPayloadError({ reason: `URL "${redirect}" can't be used to redirect after login` }); |
|  |  | } |
|  |  |  |
|  |  | const token = jwt.sign({ verifier: codeVerifier, redirect, prompt }, env['SECRET'] as string, { |
|  |  | expiresIn: '5m', |
|  |  | issuer: 'directus', |
|  |  | }); |
|  |  |  |
|  |  | res.cookie(`openid.${providerName}`, token, { |
|  |  | httpOnly: true, |
| Expand Down | |  |

17 changes: 15 additions & 2 deletions

17
[api/src/auth/drivers/saml.ts](#diff-ac05b366a31e1597161ac32402232c19be26265841703d9e88bf144efd08da54 "api/src/auth/drivers/saml.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/auth/drivers/saml.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,12 @@ |
|  |  | import \* as validator from '@authenio/samlify-node-xmllint'; |
|  |  | import { useEnv } from '@directus/env'; |
|  |  | import { ErrorCode, InvalidCredentialsError, InvalidProviderError, isDirectusError } from '@directus/errors'; |
|  |  | import { |
|  |  | ErrorCode, |
|  |  | InvalidCredentialsError, |
|  |  | InvalidPayloadError, |
|  |  | InvalidProviderError, |
|  |  | isDirectusError, |
|  |  | } from '@directus/errors'; |
|  |  | import express, { Router } from 'express'; |
|  |  | import \* as samlify from 'samlify'; |
|  |  | import { getAuthProvider } from '../../auth.js'; |
| Expand All | | @@ -15,6 +21,7 @@ import type { AuthDriverOptions, User } from '../../types/index.js'; |
|  |  | import asyncHandler from '../../utils/async-handler.js'; |
|  |  | import { getConfigFromEnv } from '../../utils/get-config-from-env.js'; |
|  |  | import { LocalAuthDriver } from './local.js'; |
|  |  | import { isLoginRedirectAllowed } from '../../utils/is-login-redirect-allowed.js'; |
|  |  |  |
|  |  | // Register the samlify schema validator |
|  |  | samlify.setSchemaValidator(validator); |
| Expand Down  Expand Up | | @@ -126,7 +133,13 @@ export function createSAMLAuthRouter(providerName: string) { |
|  |  | const parsedUrl = new URL(url); |
|  |  |  |
|  |  | if (req.query['redirect']) { |
|  |  | parsedUrl.searchParams.append('RelayState', req.query['redirect'] as string); |
|  |  | const redirect = req.query['redirect'] as string; |
|  |  |  |
|  |  | if (isLoginRedirectAllowed(redirect, providerName) === false) { |
|  |  | throw new InvalidPayloadError({ reason: `URL "${redirect}" can't be used to redirect after login` }); |
|  |  | } |
|  |  |  |
|  |  | parsedUrl.searchParams.append('RelayState', redirect); |
|  |  | } |
|  |  |  |
|  |  | return res.redirect(parsedUrl.toString()); |
| Expand Down | |  |

78 changes: 78 additions & 0 deletions

78
[api/src/utils/is-login-redirect-allowed.test.ts](#diff-e8383f845136cba31338f761b54502f8c39004ba39fb2735f373f5bd112a8194 "api/src/utils/is-login-redirect-allowed.test.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/utils/is-login-redirect-allowed.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,78 @@ |
|  |  | import { vi, expect, test, afterEach } from 'vitest'; |
|  |  | import { useEnv } from '@directus/env'; |
|  |  | import { isLoginRedirectAllowed } from './is-login-redirect-allowed.js'; |
|  |  |  |
|  |  | vi.mock('@directus/env'); |
|  |  |  |
|  |  | afterEach(() => { |
|  |  | vi.clearAllMocks(); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns true with no redirect', () => { |
|  |  | const redirect = undefined; |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed(redirect, provider)).toBe(true); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns false with invalid redirect', () => { |
|  |  | const redirect = 123456; |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed(redirect, provider)).toBe(false); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns true for allowed URL', () => { |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | vi.mocked(useEnv).mockReturnValue({ |
|  |  | [`AUTH\_${provider.toUpperCase()}\_REDIRECT\_ALLOW\_LIST`]: |
|  |  | 'http://external.example.com,https://external.example.com,http://external.example.com:8055/test', |
|  |  | PUBLIC\_URL: 'http://public.example.com', |
|  |  | }); |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed('http://public.example.com', provider)).toBe(true); |
|  |  | expect(isLoginRedirectAllowed('http://external.example.com', provider)).toBe(true); |
|  |  | expect(isLoginRedirectAllowed('https://external.example.com', provider)).toBe(true); |
|  |  | expect(isLoginRedirectAllowed('http://external.example.com:8055/test', provider)).toBe(true); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns false for denied URL', () => { |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | vi.mocked(useEnv).mockReturnValue({ |
|  |  | [`AUTH\_${provider.toUpperCase()}\_REDIRECT\_ALLOW\_LIST`]: 'http://external.example.com', |
|  |  | PUBLIC\_URL: 'http://public.example.com', |
|  |  | }); |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed('https://external.example.com', provider)).toBe(false); |
|  |  | expect(isLoginRedirectAllowed('http://external.example.com:8055', provider)).toBe(false); |
|  |  | expect(isLoginRedirectAllowed('http://external.example.com/test', provider)).toBe(false); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns true for relative paths', () => { |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | vi.mocked(useEnv).mockReturnValue({ |
|  |  | [`AUTH\_${provider.toUpperCase()}\_REDIRECT\_ALLOW\_LIST`]: 'http://external.example.com', |
|  |  | PUBLIC\_URL: 'http://public.example.com', |
|  |  | }); |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed('/admin/content', provider)).toBe(true); |
|  |  | expect(isLoginRedirectAllowed('../admin/content', provider)).toBe(true); |
|  |  | expect(isLoginRedirectAllowed('./admin/content', provider)).toBe(true); |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed('http://public.example.com/admin/content', provider)).toBe(true); |
|  |  | }); |
|  |  |  |
|  |  | test('isLoginRedirectAllowed returns false if missing protocol', () => { |
|  |  | const provider = 'local'; |
|  |  |  |
|  |  | vi.mocked(useEnv).mockReturnValue({ |
|  |  | [`AUTH\_${provider.toUpperCase()}\_REDIRECT\_ALLOW\_LIST`]: 'http://example.com', |
|  |  | PUBLIC\_URL: 'http://example.com', |
|  |  | }); |
|  |  |  |
|  |  | expect(isLoginRedirectAllowed('//example.com/admin/content', provider)).toBe(false); |
|  |  | expect(isLoginRedirectAllowed('//user@password:example.com/', provider)).toBe(false); |
|  |  | }); |

41 changes: 41 additions & 0 deletions

41
[api/src/utils/is-login-redirect-allowed.ts](#diff-deb282df03cd4c64d184999eb2426ff99777dece827d49097cbd1e60b08c25e7 "api/src/utils/is-login-redirect-allowed.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/utils/is-login-redirect-allowed.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,41 @@ |
|  |  | import { useEnv } from '@directus/env'; |
|  |  | import { toArray } from '@directus/utils'; |
|  |  | import isUrlAllowed from './is-url-allowed.js'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Checks if the defined redirect after successful SSO login is in the allow list |
|  |  | \*/ |
|  |  | export function isLoginRedirectAllowed(redirect: unknown, provider: string): boolean { |
|  |  | if (!redirect) return true; // empty redirect |
|  |  | if (typeof redirect !== 'string') return false; // invalid type |
|  |  |  |
|  |  | const env = useEnv(); |
|  |  | const publicUrl = env['PUBLIC\_URL'] as string; |
|  |  |  |
|  |  | if (URL.canParse(redirect) === false) { |
|  |  | if (redirect.startsWith('//') === false) { |
|  |  | // should be a relative path like `/admin/test` |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // domain without protocol `//example.com/test` |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | const { protocol: redirectProtocol, hostname: redirectDomain } = new URL(redirect); |
|  |  |  |
|  |  | const envKey = `AUTH\_${provider.toUpperCase()}\_REDIRECT\_ALLOW\_LIST`; |
|  |  |  |
|  |  | if (envKey in env) { |
|  |  | if (isUrlAllowed(redirect, [...toArray(env[envKey] as string), publicUrl])) return true; |
|  |  | } |
|  |  |  |
|  |  | if (URL.canParse(publicUrl) === false) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // allow redirects to the defined PUBLIC\_URL |
|  |  | const { protocol: publicProtocol, hostname: publicDomain } = new URL(publicUrl); |
|  |  |  |
|  |  | return `${redirectProtocol}//${redirectDomain}` === `${publicProtocol}//${publicDomain}`; |
|  |  | } |

37 changes: 37 additions & 0 deletions

37
[api/src/utils/is-url-allowed.test.ts](#diff-144f0f05c7f8780d06121e652a95a5da1a0499376362b2249ffff664d5390422 "api/src/utils/is-url-allowed.test.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/utils/is-url-allowed.test.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,37 @@ |
|  |  | import { expect, test } from 'vitest'; |
|  |  | import isUrlAllowed from './is-url-allowed.js'; |
|  |  |  |
|  |  | test('isUrlAllowed should allow matching domain', () => { |
|  |  | const checkUrl = 'https://directus.io'; |
|  |  | const allowedUrls = ['https://directus.io/']; |
|  |  |  |
|  |  | expect(isUrlAllowed(checkUrl, allowedUrls)).toBe(true); |
|  |  | }); |
|  |  |  |
|  |  | test('isUrlAllowed should allow matching path', () => { |
|  |  | const checkUrl = 'https://directus.io/tv'; |
|  |  | const allowedUrls = ['https://directus.io/tv']; |
|  |  |  |
|  |  | expect(isUrlAllowed(checkUrl, allowedUrls)).toBe(true); |
|  |  | }); |
|  |  |  |
|  |  | test('isUrlAllowed should block different paths', () => { |
|  |  | const checkUrl = 'http://example.com/test1'; |
|  |  | const allowedUrls = ['http://example.com/test2', 'http://example.com/test3', 'http://example.com/']; |
|  |  |  |
|  |  | expect(isUrlAllowed(checkUrl, allowedUrls)).toBe(false); |
|  |  | }); |
|  |  |  |
|  |  | test('isUrlAllowed should block different domains', () => { |
|  |  | const checkUrl = 'http://directus.io/'; |
|  |  | const allowedUrls = ['http://example.com/', 'http://directus.chat']; |
|  |  |  |
|  |  | expect(isUrlAllowed(checkUrl, allowedUrls)).toBe(false); |
|  |  | }); |
|  |  |  |
|  |  | test('isUrlAllowed blocks varying protocols', () => { |
|  |  | const checkUrl = 'http://example.com/'; |
|  |  | const allowedUrls = ['ftp://example.com/', 'https://example.com/']; |
|  |  |  |
|  |  | expect(isUrlAllowed(checkUrl, allowedUrls)).toBe(false); |
|  |  | }); |

10 changes: 5 additions & 5 deletions

10
[api/src/utils/is-url-allowed.ts](#diff-6da9fb4562ef04b043adde74e20ea6684657a28c2d9f96554b9d7cc87da48815 "api/src/utils/is-url-allowed.ts")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/api/src/utils/is-url-allowed.ts)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ import { URL } from 'url'; |
|  |  | import { useLogger } from '../logger.js'; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Check if url matches allow list either exactly or by domain+path |
|  |  | \* Check if URL matches allow list either exactly or by origin (protocol+domain+port) + pathname |
|  |  | \*/ |
|  |  | export default function isUrlAllowed(url: string, allowList: string | string[]): boolean { |
|  |  | const logger = useLogger(); |
| Expand All | | @@ -15,8 +15,8 @@ export default function isUrlAllowed(url: string, allowList: string | string[]): |
|  |  | const parsedWhitelist = urlAllowList |
|  |  | .map((allowedURL) => { |
|  |  | try { |
|  |  | const { hostname, pathname } = new URL(allowedURL); |
|  |  | return hostname + pathname; |
|  |  | const { origin, pathname } = new URL(allowedURL); |
|  |  | return origin + pathname; |
|  |  | } catch { |
|  |  | logger.warn(`Invalid URL used "${url}"`); |
|  |  | } |
| Expand All | | @@ -26,8 +26,8 @@ export default function isUrlAllowed(url: string, allowList: string | string[]): |
|  |  | .filter((f) => f) as string[]; |
|  |  |  |
|  |  | try { |
|  |  | const { hostname, pathname } = new URL(url); |
|  |  | return parsedWhitelist.includes(hostname + pathname); |
|  |  | const { origin, pathname } = new URL(url); |
|  |  | return parsedWhitelist.includes(origin + pathname); |
|  |  | } catch { |
|  |  | return false; |
|  |  | } |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[docs/releases/breaking-changes.md](#diff-f3af8314c65b051941d2edb128df5ea233ca136427e8aa2f2a6051ce52d66cb5 "docs/releases/breaking-changes.md")

Show comments

[View file](/directus/directus/blob/5477d7d61babd7ffc2f835d399bf79611b15b203/docs/releases/breaking-changes.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -134,6 +134,17 @@ AuthenticationService.login('email', 'password', { otp: 'otp-code', session: tru |
|  |  |  |
|  |  | ::: |
|  |  |  |
|  |  | ### Introduced Allow List for OAuth2/OpenID/SAML Redirects |
|  |  |  |
|  |  | Due to an Open Redirect vulnerability with the OAuth2, OpenID and SAML SSO providers, we have introduced an allow list |
|  |  | for these redirects. |
|  |  |  |
|  |  | If your current workflow depends on redirecting to an external domain after successful SSO login using the |
|  |  | `?redirect=http://example.com/login` query parameter, then you'll need to add this URL to the |
|  |  | `AUTH\_<PROVIDER>\_REDIRECT\_ALLOW\_LIST` config option. |
|  |  |  |
|  |  | `AUTH\_<PROVIDER>\_REDIRECT\_ALLOW\_LIST` accepts a comma-separated list of URLs (path is included in comparison). |
|  |  |  |
|  |  | ## Version 10.9.0 |
|  |  |  |
|  |  | ### Updated Exif Tags |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5477d7d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fdirectus%2Fdirectus%2Fcommit%2F5477d7d61babd7ffc2f835d399bf79611b15b203) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


