

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Takashi Iwai <tiwai@suse.de> | 2023-09-22 14:38:07 +0200 |
| --- | --- | --- |
| committer | Hans Verkuil <hverkuil-cisco@xs4all.nl> | 2023-10-07 10:55:48 +0200 |
| commit | [a1766a4fd83befa0b34d932d532e7ebb7fab1fa7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)) | |
| tree | [af1a821d7b2fb735b8dd2b63f01174ca700cddbf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7) | |
| parent | [462e108bac18419f17c6a34eb348b600a614aa4f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=462e108bac18419f17c6a34eb348b600a614aa4f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7&id2=462e108bac18419f17c6a34eb348b600a614aa4f)) | |
| download | [linux-a1766a4fd83befa0b34d932d532e7ebb7fab1fa7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a1766a4fd83befa0b34d932d532e7ebb7fab1fa7.tar.gz) | |

media: imon: fix access to invalid resource for the second interfaceimon driver probes two USB interfaces, and at the probe of the second
interface, the driver assumes blindly that the first interface got
bound with the same imon driver. It's usually true, but it's still
possible that the first interface is bound with another driver via a
malformed descriptor. Then it may lead to a memory corruption, as
spotted by syzkaller; imon driver accesses the data from drvdata as
struct imon\_context object although it's a completely different one
that was assigned by another driver.
This patch adds a sanity check -- whether the first interface is
really bound with the imon driver or not -- for avoiding the problem
above at the probe time.
Reported-by: syzbot+59875ffef5cb9c9b29e9@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/all/000000000000a838aa0603cc74d6@google.com/
Tested-by: Ricardo B. Marliere <ricardo@marliere.net>
Link: [https://lore.kernel.org/r/20230922005152.163640-1-ricardo@marliere.net](https://lore.kernel.org/r/20230922005152.163640-1-ricardo%40marliere.net)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sean Young <sean@mess.org>
Signed-off-by: Hans Verkuil <hverkuil-cisco@xs4all.nl>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)

| -rw-r--r-- | [drivers/media/rc/imon.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/media/rc/imon.c?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/drivers/media/rc/imon.c b/drivers/media/rc/imon.cindex 74546f7e34691e..5719dda6e0f0ef 100644--- a/[drivers/media/rc/imon.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/rc/imon.c?id=462e108bac18419f17c6a34eb348b600a614aa4f)+++ b/[drivers/media/rc/imon.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/media/rc/imon.c?id=a1766a4fd83befa0b34d932d532e7ebb7fab1fa7)@@ -2427,6 +2427,12 @@ static int imon\_probe(struct usb\_interface \*interface, goto fail; } + if (first\_if->dev.driver != interface->dev.driver) {+ dev\_err(&interface->dev, "inconsistent driver matching\n");+ ret = -EINVAL;+ goto fail;+ }+ if (ifnum == 0) { ictx = imon\_init\_intf0(interface, id); if (!ictx) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:15:31 +0000

