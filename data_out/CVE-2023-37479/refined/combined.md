=== Content from www.intel.com_53a7acba_20250110_221248.html ===

[Skip To Main Content](#primary-content)

[![Intel logo - Return to the home page](/content/dam/logos/intel-header-logo.svg)](/content/www/us/en/homepage.html)

Toggle Navigation

Sign In

My Intel

My Tools

* ?

Sign Out

English

## Select Your Language

* [Bahasa Indonesia](https://www.intel.co.id/content/www/id/id/homepage.html)
* [Deutsch](https://www.intel.de/content/www/de/de/homepage.html)
* [English](https://www.intel.com/content/www/us/en/homepage.html)
* [Español](https://www.intel.la/content/www/xl/es/homepage.html)
* [Français](https://www.intel.fr/content/www/fr/fr/homepage.html)
* [Português](https://www.intel.com.br/content/www/br/pt/homepage.html)

* [Tiếng Việt](https://www.intel.vn/content/www/vn/vi/homepage.html)
* [ไทย](https://www.thailand.intel.com/content/www/th/th/homepage.html)
* [한국어](https://www.intel.co.kr/content/www/kr/ko/homepage.html)
* [日本語](https://www.intel.co.jp/content/www/jp/ja/homepage.html)
* [简体中文](https://www.intel.cn/content/www/cn/zh/developer/articles/technical/software-security-guidance/best-practices/mxcsr-configuration-dependent-timing.html)
* [繁體中文](https://www.intel.com.tw/content/www/tw/zh/homepage.html)

Toggle Search

Search

<

Close Search Panel

Advanced Search

close

Sign In to access restricted content

### Using Intel.com Search

You can easily search the entire Intel.com site in several ways.

* Brand Name:
  **Core i9**
* Document Number:
  **123456**
* Code Name:
  **Emerald Rapids**
* Special Operators:
  **“Ice Lake”, Ice AND Lake, Ice OR Lake, Ice\***

### Quick Links

You can also try the quick links below to see results for most popular searches.

* [Product Information](https://www.intel.com/content/www/us/en/products/overview.html?wapkw=quicklink:products)
* [Support](https://www.intel.com/content/www/us/en/support.html?wapkw=quicklink:support)
* [Drivers & Software](https://downloadcenter.intel.com?wapkw=quicklink:download-center)

### Recent Searches

Sign In to access restricted content

### Advanced Search

All of these terms
Any of these terms
Exact term only

Find results with

All Results

Product Information

Support

Drivers & Software

Documentation & Resources

Partners

Communities

Corporate

Show results from

### Only search in

Title

Description
Content ID

Search

Sign in to access
restricted content.

The browser version you are using is not recommended for this site.
Please consider upgrading to the latest version of your browser by clicking one of the following links.

* [Safari](https://support.apple.com/downloads/safari)
* [Chrome](https://support.google.com/chrome/answer/95346?hl=en)
* [Edge](https://www.microsoft.com/en-us/edge)
* [Firefox](https://www.mozilla.org/en-US/firefox/new/)

####

# MXCSR Configuration Dependent Timing

![author-image]()

By

## Introduction

The [Data Operand Independent Timing Instruction Set Architecture](/content/www/us/en/developer/articles/technical/software-security-guidance/best-practices/data-operand-independent-timing-isa-guidance.html) (DOIT ISA) document describes a new feature  which in conjunction with our guidance on [Guidelines for Mitigating Timing Side Channels Against Cryptographic Implementations](/content/www/us/en/developer/articles/technical/software-security-guidance/secure-coding/mitigate-timing-side-channel-crypto-implementation.html) can be used for “constant time” execution for code specifically written to the guidelines. This mode allows constant time code to inform the processor that data operand independent timing is needed.

On certain processors, MXCSR may also need to be configured to avoid data-dependent behavior for the instructions listed in [Data Operand Independent Timing Instructions That May Exhibit MXCSR Configuration Dependent Timing Behavior](/content/www/us/en/developer/articles/technical/software-security-guidance/resources/mcdt-data-operand-independent-timing-instructions.html). This article describes that behavior and configuration.

## MXCSR Configuration Dependent Timing (MCDT)

On certain processors as listed in MCDT Enumeration, some data-independent timing vector instructions may have subtle data-dependent timing due to MXCSR configuration. Specifically, specific data values may delay instruction retirement by, at most, one cycle. This is a small enough delay that it may not be observable in common practice, but this small delay is still data-dependent timing. This data operand-dependent timing may impact software following Intel’s [Guidelines for Mitigating Timing Side Channels Against Cryptographic Implementations](/content/www/us/en/developer/articles/technical/software-security-guidance/secure-coding/mitigate-timing-side-channel-crypto-implementation.html).

### Hardware

Future processors are not expected to exhibit data operand dependent timing due to MXCSR configuration. This will be enumerated by CPUID.(EAX=7H,ECX=2):EDX[5]=1. Many current processors which are also not affected are listed in the Processors That Do Not Exhibit MCDT Behavior section.

### Software Mitigations

Some environments may conclude that this side channel is minor and does not need mitigation.

For systems that do not enumerate CPUID.(EAX=7H,ECX=2):EDX[5]=1, software that does need mitigation can mitigate the data-dependent timing by loading MXCSR with the value of 0x1FBF before using data operand independent timing instructions impacted by the MXCSR configuration. Software must use pre- and post-serialized LDMXCSR instructions before using impacted data operand independent timing instructions.

```

Prolog:
STMXCSR save_val
LDMXCSR value_0x1fbf
LFENCE
// Constant-time code using affected instructions
Epilog:
LFENCE
LDMXCSR save_val
```

For applications that do not otherwise depend on a specific value of MXCSR, the value of 0x1FBF can be established during the initialization of the application and mitigate the data dependent timing with minimal overhead.

### Instructions That May Exhibit MCDT Behavior

[This list](/content/www/us/en/developer/articles/technical/software-security-guidance/resources/mcdt-data-operand-independent-timing-instructions.html) is based on Intel's investigation and is current as of the date of publication. Intel will update this list if additional instructions with these characteristics are discovered.

* PMADDUBSW
* PMULUDQ
* VPMULHRSW
* PMADDWD
* VPLZCNTD
* VPMULHUW
* PMULDQ
* VPLZCNTQ
* VPMULHW
* PMULHRSW
* VPMADD52HUQ
* VPMULLD
* PMULHUW
* VPMADD52LUQ
* VPMULLQ
* PMULHW
* VPMADDUBSW
* VPMULLW
* PMULLD
* VPMADDWD
* VPMULUDQ
* PMULLW
* VPMULDQ

### Intel® Software Guard Extensions (Intel® SGX)

Although instructions inside enclave mode will act as if data operand independent timing mode is set, they may still exhibit MCDT behavior.

If the intended operation of an Intel SGX enclave, for the lifetime of the enclave, is achievable with MXCSR=0x1FBF, then any loads of MXCSR (via LDMXCSR, XRSTOR, etc.) should be of 0x1FBF. There should also be an LFENCE between any load of MXCSR (even of 0x1FBF) and subsequent use of any affected instruction.

If the enclave is compatible with MXCSR=0x1FBF and uses any of the affected instructions, then the beginning of each enclave ECALL should change MXCSR to 0x1FBF and then execute an LFENCE instruction. The Intel SGX SDK will be changed to do this.

The Intel-provided SGX architectural enclaves (AEs) fall into this compatible with MXCSR=0x1FBF category.

If the intended operation of an Intel SGX enclave is not achievable with MXCSR=0x1FBF, then the general sequence in the Software Mitigations section should be used instead.

## Enumeration and Architectural MSRs

### MCDT Enumeration

CPUID.(EAX=7H,ECX=2):EDX[5] enumerates MCDT\_NO. Processors that enumerate this bit as 1  do not exhibit MCDT behavior and do not need to be mitigated. Note that Intel Atom and pre-Skylake Intel Core processors may not enumerate MCDT\_NO but nevertheless do not exhibit MCDT behavior. Refer to the Processors That May Exhibit MCDT Behavior section and the Processors That Do Not Exhibit MCDT Behavior section for more infomation about these processors.

#### MCDT Enumeration Guidance for Cryptographic Software

CPUID leaf 7 subleaf 2 EDX bit 5 enumerates MCDT\_NO. Processors that enumerate this bit as 1 do not exhibit MXCSR Configuration Dependent Timing behavior and do not need to mitigate it. Intel Atom and Intel Core processors based on microarchitectures prior to Skylake may not exhibit MCDT behavior despite not enumerating MCDT\_NO. Refer to the Processors That Do Not Exhibit MCDT Behavior section for more information.

Cryptography developers who wish to apply MCDT mitigations should use the following steps to determine if MCDT mitigation should be applied:

The cryptography software should determine if MCDT\_NO is enumerated as 1. If it is, then no mitigation needs to be applied.

If MCDT\_NO is enumerated as 0, the cryptography software should determine if it is running in a virtualized environment by checking the value of CPUID leaf 1 ECX bit 31.

If CPUID leaf 1 ECX bit 31 is 0, then a hypervisor is not present, and the cryptography software should use CPUID family/model/stepping to determine if it is running on a processor documented as not exhibiting MCDT behavior.

If CPUID leaf 1 ECX bit 31 is 1, then a hypervisor is present and the cryptography software may be running on a processor that does not exhibit MCDT behavior, regardless of the family/ model/stepping that is enumerated due to virtualization of CPUID.

### VMM Guidance for Non-Migratable and Migratable VMs

For non-migratable VMs, VMM software should enumerate MCDT\_NO  as 1 to a guest only if the host physical machine either enumerates MCDT\_NO as 1 or a CPUID family/model/stepping that matches a processor documented to not exhibit MCDT behavior in the section Processors That Do Not Exhibit MCDT Behavior section.

For migratable VMs, VMM software should enumerate MCDT\_NO as 1 only if every host physical machine that the VM may potentially migrate to either enumerates MCDT\_NO as 1 or a CPUID family/model/stepping that matches a processor documented to not exhibit MCDT behavior in the Processors That Do Not Exhibit MCDT Behavior section.

## Processors That May Exhibit MCDT Behavior

All Intel Core processors based on microarchitecture code named Skylake and later exhibit this behavior for at least one instruction from the list in the Example Instructions That May Exhibit MCDT Behavior section.

Table 1: Processors That May Exhibit MCDT Behavior
| Processor | Stepping (All unless otherwise noted) | Code Name (s) / Microarchitecture (s) | Product Family |
| --- | --- | --- | --- |
| 06\_4EH | 3 | 1. Skylake Y 2. Skylake U 3. Skylake U23e | 6th Generation Intel® Core™ Processor Family |
| 06\_55H | 3, 4 | 1. Skylake Server 2. Skylake D, Bakerville 3. Skylake W 4. Skylake X | 1. Intel® Xeon® Scalable processor family 2. Intel® Xeon® D processor family 3. Intel® Xeon® W processor family 4. Intel® Core™ X-series Processors |
| 06\_55H | 6.7 | 1. Cascade Lake Server 2. Cascade Lake W 3. Cascade Lake X | 1. 2nd Generation Intel® Xeon® Scalable processor family 2. Intel® Xeon® W processor family 3. Intel® Core™ X-series Processor |
| 06\_55H | <=B | Cooper Lake | 3rd Generation Intel® Xeon® Scalable processor family |
| 06\_5EH | 3 | 1. Skylake Xeon E3 2. Skylake H 3. Skylake S | 1. Intel® Xeon® E processor family 2, 3. 6th Generation Intel® Core™ Processor Family |
| 06\_6AH | 4,5,6 | Ice Lake Xeon-SP | 3rd Gen Intel® Xeon® Scalable processor family |
| 06\_6CH | 1 | Ice Lake D | Intel® Xeon® D Processor |
| 06\_7EH | 5 | Ice Lake U,Y | 10th Generation Intel® Core™ Processor Family |
| 06\_8AH | 1 | Lakefield B-step | Intel® Core™ Processors with Intel® Hybrid Technology |
| 06\_8CH | 1,2 | Tiger Lake U Tiger Lake U Refresh   Tiger Lake H35 | 11th Generation Intel® Core™ Processor Family |
| 06\_8DH | 1 | Tiger Lake H | 11th Generation Intel® Core™ Processor Family Intel® Xeon® Processor Family |
| 06\_8EH | 9 | 1. Amber Lake-Y  2. Kaby Lake U 3. Kaby Lake U23e 4. Kaby Lake Y | 1. 8th Generation Intel® Core™ Processor Family 2,3,4. 7th Generation Intel® Core™ Processor Family |
| 06\_8EH | A | Coffee Lake U43e Kaby Lake Refresh U | 8th Generation Intel® Core™ Processor Family |
| 06\_8EH | B,C | 1. Whiskey Lake U 2,3,4. Comet Lake U42 5. Amber Lake Y | 1. 8th Generation Intel® Core™ Processors 2. 10th Generation Intel® Core™ Processor Family 3. Intel® Pentium® Gold Processor Series 4. Intel® Celeron® Processor 5000 Series 5. 10th Generation Intel® Core™ Processor Family |
| 06\_97H | 2, 5 | Alder Lake S | 12th Generation Intel® Core™ Processor Family |
| 06\_9AH | 3 | 1. Alder Lake H 2. Alder Lake P | 1. 12th Generation Intel® Core™ Processor Family 2. 12th Generation Intel® Core™ Processor Family |
| 06\_9AH | 4 | Alder Lake U | 12th Generation Intel® Core™ Processor Family Intel® Pentium® Gold Processor Family Intel® Celeron® Processor Family |
| 06\_9EH | 9 | 1. Kaby Lake S 2. Kaby Lake H 3. Kaby Lake G 4. Kaby Lake X 5. Kaby Lake Xeon E3 | 1. 7th Generation Intel® Core™ Processor Family 2. 7th Generation Intel® Core™ Processor Family 3. 8th Generation Intel® Core™ Processor Family Intel® Pentium® Processor Family 4. Intel® Core™ X-series Processors 5. Intel® Xeon® E processor family |
| 06\_9EH | A, B, C, D | 1.    Coffee Lake H 2.    Coffee Lake Xeon E 3. Coffee Lake S Xeon E 4. Coffee Lake S x/KBP 5. Coffee Lake S | 1. 8th Generation Intel® Core™ Processor Family 2. Intel® Xeon® E processor family 3. Intel® Xeon® E processor family 4. 8th Generation Intel® Core™ Processor Family 5. 8th Generation Intel® Core™ Processor Family |
| 06\_A5H | 2, 3, 5 | 1. Comet Lake H 2. Comet Lake-S | 1, 2. 10th Generation Intel® Core™ Processor Family 1, 2. Intel® Xeon® W processor family |
| 06\_A6H | <=1 | Comet Lake U62 | 10th Generation Intel® Core™ Processor Family Intel® Xeon® W processor family |
| 06\_A7H | 1 | Rocket Lake | 11th Generation Intel® Core™ Processor Family Intel® Xeon® E-2300 processor family |
| 06\_A8H | 1 | Rocket Lake | Intel® Xeon® W-1300 Processor Family |

* Note that a limited number of future processors which are not on the above list of affected processors, may also exhibit MCDT behavior. They will not enumerate MCDT\_NO.
* Processors that may exhibit MCDT behavior include those based on microarchitectures code named Skylake server, Cascade Lake, Cooper Lake, Ice Lake server, Skylake, Kaby Lake, Coffee Lake, Whiskey Lake, Comet Lake, Ice Lake client, Lakefield, Tiger Lake, Rocket Lake, and Alder Lake.
* Processors that do not exhibit MCDT behavior include Intel Atom processors and Intel Core processors based on microarchitectures before Skylake.

## Processors That Do Not Exhibit MCDT Behavior

Intel Core processors based on microarchitectures before Ice Lake and Intel Atom family processors based on microarchitectures before Gracemont do not exhibit MXCSR Dependent Timing behavior.

Table 4: Processors That Do Not Exhibit MCDT Behavior
| Processor | Stepping (All unless otherwise noted) | Code Name (s) / Microarchitecture(s) | Product Family |
| --- | --- | --- | --- |
| 06\_3FH | 2 | Haswell Server EP, EP4S | Intel® Xeon® E processor family |
| 06\_3FH | 4 | Elkhart Lake (Tremont) | Intel® Xeon® E processor family |
| 06\_4CH |  | Cherryview (Airmont) | Intel® Atom® Processor X Series |
| 06\_4FH |  | Broadwell Server E, EP, EP4S, EX | Intel® Xeon® E processor family |
| 06\_56H | 3 | Broadwell DE V2,V3 | Intel® Xeon®  D processor family |
| 06\_56H | 4 | Broadwell DE Y0 | Intel® Xeon®  D processor family |
| 06\_56H | 5 | Broadwell DE A1, Hewitt Lake (Broadwell DE) | Intel® Xeon®  D processor family |
| 06\_5AH |  | Anniedale (Airmont) | Intel® Atom® Processors |
| 06\_5CH | 9 | 1. Apollo Lake (Goldmont - no SGX) 2. Apollo Lake 3. Apollo Lake | 1. Intel® Pentium® Processor J Series Intel® Pentium® Processor N Series 2. Intel® Celeron® Processor J Series, Intel® Celeron® Processor N Series 3. Intel® Atom® Processor A Series |
| 06\_5CH | A | Apollo Lake | Intel® Atom® Processor E3900 Series |
| 06\_5FH | 1 | Denverton (Goldmont) | Intel® Atom® C processor family |
| 06\_65H |  | XMM7272  (Airmont) | Intel® Atom® Processors |
| 06\_6EH |  | Cougar Mountain (Airmont) | Intel® Puma™ 7 Family  Intel® Atom® Processors |
| 06\_75H |  | Butter (Airmont) | Intel® Atom® Processors |
| 06\_7AH | 1 | Gemini Lake | Intel® Pentium® Processor Silver Series Intel® Celeron® Processor J Series Intel® Celeron® Processor N Series |
| 06\_7AH | 8 | Gemini Lake | Intel® Celeron® Processor J Series Intel® Celeron® Processor N Series |
| 06\_86H | 4 | Snowridge (Tremont) | Intel® Atom® Processors |
| 06\_86H | 5 (B step) | Snowridge (Tremont) | Intel® Xeon® D processor family |
| 06\_86H | 7 (C step) | Snowridge (Tremont) | Intel® Xeon® D processor family |
| 06\_8AH | 1 | Lakefield B-step (Tremont) | Intel® Core™ Processors with Intel® Hybrid Technology |
| 06\_8AH | 1 | Lakefield B-step (Sunnycove) | Intel® Core™ Processors with Intel® Hybrid Technology |
| 06\_96H | 1 | Elkhart Lake (Tremont) | Intel® Atom® Processors |
| 06\_9CH | 0 | Jasper Lake (Tremont) | Intel® Atom® Processors |

1

* [Introduction](#articleparagraph)
* [MXCSR Configuration Dependent Timing (MCDT)](#articleparagraph_887449761)
* [Enumeration and Architectural MSRs](#articleparagraph_1951659715)
* [Processors That May Exhibit MCDT Behavior](#articleparagraph_1345095489)
* [Processors That Do Not Exhibit MCDT Behavior](#articleparagraph_1287929235)

#### Product and Performance Information

1

Performance varies by use, configuration and other factors. Learn more at [www.Intel.com/PerformanceIndex](http://www.intel.com/PerformanceIndex "Follow link").

Get Help

* [Company Overview](/content/www/us/en/company-overview/company-overview.html)
* [Contact Intel](/content/www/us/en/support/contact-us.html)
* [Newsroom](/content/www/us/en/newsroom/home.html)
* [Investors](https://www.intc.com/)
* [Careers](/content/www/us/en/jobs/life-at-intel.html)
* [Corporate Responsibility](/content/www/us/en/corporate-responsibility/corporate-responsibility.html)
* [Diversity & Inclusion](/content/www/us/en/diversity/diversity-at-intel.html)
* [Public Policy](/content/www/us/en/company-overview/public-policy.html)

* © Intel Corporation
* [Terms of Use](/content/www/us/en/legal/terms-of-use.html)
* [\*Trademarks](/content/www/us/en/legal/trademarks.html)
* [Cookies](/content/www/us/en/privacy/intel-cookie-notice.html)
* [Privacy](/content/www/us/en/privacy/intel-privacy-notice.html)
* [Supply Chain Transparency](/content/www/us/en/corporate-responsibility/statement-combating-modern-slavery.html)
* [Site Map](/content/www/us/en/siteindex.html)
* [Recycling](/content/www/us/en/support/articles/000098122/services.html)
* [Your Privacy Choices
  California Consumer Privacy Act (CCPA) Opt-Out Icon](/)
* [Notice at Collection](/content/www/us/en/privacy/privacy-residents-certain-states.html)

Intel technologies may require enabled hardware, software or service activation. // No product or component can be absolutely secure. // Your costs and results may vary. // Performance varies by use, configuration and other factors. // See our complete legal [Notices and Disclaimers](https://edc.intel.com/content/www/us/en/products/performance/benchmarks/overview/#GUID-26B0C71C-25E9-477D-9007-52FCA56EE18C). // Intel is committed to respecting human rights and avoiding causing or contributing to adverse impacts on human rights. See Intel’s [Global Human Rights Principles](/content/www/us/en/policy/policy-human-rights.html). Intel’s products and software are intended only to be used in applications that do not cause or contribute to adverse impacts on human rights.

[![Intel Footer Logo](/content/dam/logos/intel-footer-logo.svg "Intel Footer Logo")](/content/www/us/en/homepage.html "Intel Footer Logo")

![](https://www.intel.com/akam/13/pixel_76c5812e?a=dD0wZjE0MzM1MmIxZGVlMWM1ZDgxMWEyOTYwNTVhMWI2MDExY2E1Njg2JmpzPW9mZg==)

=== Content from github.com_0b433f56_20250110_221247.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenenclave%2Fopenenclave%2Fsecurity%2Fadvisories%2FGHSA-5gfr-m6mx-p5w4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenenclave%2Fopenenclave%2Fsecurity%2Fadvisories%2FGHSA-5gfr-m6mx-p5w4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=openenclave%2Fopenenclave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openenclave](/openenclave)
/
**[openenclave](/openenclave/openenclave)**
Public

* [Notifications](/login?return_to=%2Fopenenclave%2Fopenenclave) You must be signed in to change notification settings
* [Fork
  361](/login?return_to=%2Fopenenclave%2Fopenenclave)
* [Star
   1.1k](/login?return_to=%2Fopenenclave%2Fopenenclave)

* [Code](/openenclave/openenclave)
* [Issues
  412](/openenclave/openenclave/issues)
* [Pull requests
  21](/openenclave/openenclave/pulls)
* [Discussions](/openenclave/openenclave/discussions)
* [Actions](/openenclave/openenclave/actions)
* [Projects
  0](/openenclave/openenclave/projects)
* [Security](/openenclave/openenclave/security)
* [Insights](/openenclave/openenclave/pulse)

Additional navigation options

* [Code](/openenclave/openenclave)
* [Issues](/openenclave/openenclave/issues)
* [Pull requests](/openenclave/openenclave/pulls)
* [Discussions](/openenclave/openenclave/discussions)
* [Actions](/openenclave/openenclave/actions)
* [Projects](/openenclave/openenclave/projects)
* [Security](/openenclave/openenclave/security)
* [Insights](/openenclave/openenclave/pulse)

# Improper sanitization of MXCSR and RFLAGS

Moderate

[radhikaj](/radhikaj)
published
GHSA-5gfr-m6mx-p5w4
Jul 17, 2023

## Package

No package listed

## Affected versions

< 0.19.3

## Patched versions

0.19.3

## Description

### Impact

There are two CVEs that are mitigated in v0.19.3.

1. Open Enclave SDK does not properly sanitize the `MXCSR` register on enclave entry. This makes applications vulnerable to MXCSR

   Configuration Dependent Timing (MCDT) attacks, where incorrect `MXCSR` values can impact instruction retirement by at most one cycle, depending on the (secret) data operand value. Please find more details in this related [guidance from Intel](https://www.intel.com/content/www/us/en/developer/articles/technical/software-security-guidance/best-practices/mxcsr-configuration-dependent-timing.html).
2. Open Enclave SDK does not sanitize x86's alignment check flag `RFLAGS.AC` on enclave entry. This opens up the possibility for a side-channel attacker to be notified for every unaligned memory access performed by the enclave.

### Patches

The issue has been addressed in version 0.19.3 and the current master branch. Users will need to recompile their applications against the patched libraries to be protected from this vulnerability.

### Workarounds

No workarounds have been identified for this vulnerability.

### Acknowledgements

Jo Van Bulck (imec-DistriNet, KU Leuven)

Fritz Alder (imec-DistriNet, KU Leuven)

Lesly-Ann Daniel (imec-DistriNet, KU Leuven)

David Oswald (The University of Birmingham, UK)

Frank Piessens (imec-DistriNet, KU Leuven)

### For more information

If you have any questions or comments about this advisory:

* Open an [issue](https://github.com/openenclave/openenclave/issues) with the security and question labels.
* Email us at [oesdk@lists.confidentialcomputing.io](oesdk%40lists.confidentialcomputing.io)

### Severity

Moderate

### CVE ID

CVE-2023-37479

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5004bfa3_20250110_221246.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenenclave%2Fopenenclave%2Fcommit%2Fca54623333875b9beaad92c999a92b015c44b079)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenenclave%2Fopenenclave%2Fcommit%2Fca54623333875b9beaad92c999a92b015c44b079)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=openenclave%2Fopenenclave)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[openenclave](/openenclave)
/
**[openenclave](/openenclave/openenclave)**
Public

* [Notifications](/login?return_to=%2Fopenenclave%2Fopenenclave) You must be signed in to change notification settings
* [Fork
  361](/login?return_to=%2Fopenenclave%2Fopenenclave)
* [Star
   1.1k](/login?return_to=%2Fopenenclave%2Fopenenclave)

* [Code](/openenclave/openenclave)
* [Issues
  412](/openenclave/openenclave/issues)
* [Pull requests
  21](/openenclave/openenclave/pulls)
* [Discussions](/openenclave/openenclave/discussions)
* [Actions](/openenclave/openenclave/actions)
* [Projects
  0](/openenclave/openenclave/projects)
* [Security](/openenclave/openenclave/security)
* [Insights](/openenclave/openenclave/pulse)

Additional navigation options

* [Code](/openenclave/openenclave)
* [Issues](/openenclave/openenclave/issues)
* [Pull requests](/openenclave/openenclave/pulls)
* [Discussions](/openenclave/openenclave/discussions)
* [Actions](/openenclave/openenclave/actions)
* [Projects](/openenclave/openenclave/projects)
* [Security](/openenclave/openenclave/security)
* [Insights](/openenclave/openenclave/pulse)

## Commit

[Permalink](/openenclave/openenclave/commit/ca54623333875b9beaad92c999a92b015c44b079)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Security fix for AC flag poisoning and MCDT

[Browse files](/openenclave/openenclave/tree/ca54623333875b9beaad92c999a92b015c44b079)
Browse the repository at this point in the history

```
This PR does the following
- Ensuring the AC flag along with other system/control flags are always cleared upon enclave enter
- Update the inital MXCSR value to 0x1FBF and put lfence after MXCSR load (via LDMXCSR, XRSTOR, or FXRSTOR)
  for the MCDT mitigation

Signed-off-by: Ming-Wei Shih <mishih@microsoft.com>
```

* Loading branch information

[![@mingweishih](https://avatars.githubusercontent.com/u/58993167?s=40&v=4)](/mingweishih) [![@radhikaj](https://avatars.githubusercontent.com/u/6453577?s=40&v=4)](/radhikaj)

[mingweishih](/openenclave/openenclave/commits?author=mingweishih "View all commits by mingweishih")
authored and
[radhikaj](/openenclave/openenclave/commits?author=radhikaj "View all commits by radhikaj")
committed
Jul 17, 2023

1 parent
[31e65e9](/openenclave/openenclave/commit/31e65e97a2c332f4c3df17e8a129c5a398e4079b)

commit ca54623

 Show file tree

 Hide file tree

Showing
**9 changed files**
with
**109 additions**
and
**40 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* enclave/core/sgx

  + enclave/core/sgx/asmcommon.inc
    [asmcommon.inc](#diff-8c0335f182e3da9f0dae37f8a27b7086f124c8eee8da7fa98b1e275ed09dc25d)
  + enclave/core/sgx/asmdefs.c
    [asmdefs.c](#diff-739743069cff5c7f8d2f378370f0b56c99d3db766a5d2a18fb89ce5f3f233de4)
  + enclave/core/sgx/calls.c
    [calls.c](#diff-ca075fbde1bf2e0da2cddee75f302504d3f5d893764d262a75be8196f08422cc)
  + enclave/core/sgx/context.inc
    [context.inc](#diff-5e0978f71a4721c712ab4029c16f01df3935fd2eef34601191484bc2d5554ff1)
  + enclave/core/sgx/enter.S
    [enter.S](#diff-4e26a04147bb9572bee8ac81309772df7601bde30cc665139f0d5267a9d01de0)
* tests

  + abi

    - tests/abi/abi\_utils.h
      [abi\_utils.h](#diff-38b485040bcd1f11ec3dd0f4ca81cef8837f39e9508dd98b0b74953e666adb88)
    - enc

      * tests/abi/enc/enc.cpp
        [enc.cpp](#diff-371d27c4f64068040b96ebc8931c19201bb687a4b964148840d3890f7d5569db)
    - host

      * tests/abi/host/host.cpp
        [host.cpp](#diff-1d4826607053f751db7ce2077af7f992dc5e5e97ec4b37cda3c3204a9e35cdaa)
  + libc/enc

    - tests/libc/enc/enc.c
      [enc.c](#diff-b96853ffb440431a7e387ac9383c068344310890d075777318e38ff878c84556)

## There are no files selected for viewing

30 changes: 26 additions & 4 deletions

30
[enclave/core/sgx/asmcommon.inc](#diff-8c0335f182e3da9f0dae37f8a27b7086f124c8eee8da7fa98b1e275ed09dc25d "enclave/core/sgx/asmcommon.inc")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/enclave/core/sgx/asmcommon.inc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,7 +11,7 @@ |
|  |  | // |
|  |  | // - The legacy SSE state: |
|  |  | // - Initializes the FPU control word to ABI-specified value 0x037F |
|  |  | // - Initializes MXCSR to ABI-specified value 0x1F80 and MXCSR\_MASK to 0xFFFF |
|  |  | // - Initializes MXCSR to ABI-specified value 0x1FBF and MXCSR\_MASK to 0xFFFF |
|  |  | // - Clears FPU Status, Tag, OpCode, and FIP words |
|  |  | // - Clears all FDP bits |
|  |  | // - Clears all MMX/FPU registers |
| Expand Down  Expand Up | | @@ -46,6 +46,9 @@ |
|  |  | // Restore initial enclave legacy SSE state |
|  |  | fxrstor64 OE\_XSAVE\_INITIAL\_STATE(%rip) |
|  |  | 2: |
|  |  | // Put a lfence after changing MXCSR for MXCSR Configuration Dependent |
|  |  | // Timing (MCDT) mitigation |
|  |  | lfence |
|  |  | // Restore the registers |
|  |  | mov %r8, %rax |
|  |  | mov %r9, %rdx |
| Expand Down  Expand Up | | @@ -80,17 +83,36 @@ |
|  |  | xor %r14, %r14 |
|  |  | xor %r15, %r15 |
|  |  |  |
|  |  | // Zero out the RFLAGS except for system flags and |
|  |  | // reserved bits that are not writable by the enclave |
|  |  | // Zero out the status flags (CF, PF, AF, SF, OF) that could leak |
|  |  | // information about instructions executed by the enclave without using stack. |
|  |  | // Doing so avoiding using untrusted host stack when cleaning up registers |
|  |  | // during enclave enter and exit routines. |
|  |  | // To clear system and control flags, see oe\_cleanup\_flags\_on\_enclave\_stack |
|  |  | // for more detail. |
|  |  | mov %rax, %r8 |
|  |  | xor %rax, %rax |
|  |  | test %al, %al // Clear OF |
|  |  | cld // Clear DF |
|  |  | sahf // Clear SF, ZF AF, PF, and CF |
|  |  | mov %r8, %rax |
|  |  |  |
|  |  | // No need to clear r8, which equals to rax (return value to the host) |
|  |  |  |
|  |  | .endm |
|  |  |  |
|  |  | //============================================================================== |
|  |  | // |
|  |  | // This macro is used to clean up the enclave FLAGS register, including not only |
|  |  | // status but also system and control flags. |
|  |  | // |
|  |  | // The macro does not reserve r15 and require consuming stack. Please make sure |
|  |  | // using the macro within the enclave stack. Currently, the macro is only used |
|  |  | // during oe\_enter. |
|  |  | // |
|  |  | //============================================================================== |
|  |  | .macro oe\_cleanup\_flags\_on\_enclave\_stack |
|  |  | xor %r15, %r15 |
|  |  | pushq %r15 |
|  |  | popfq |
|  |  | .endm |
|  |  |  |
|  |  | #endif |

14 changes: 8 additions & 6 deletions

14
[enclave/core/sgx/asmdefs.c](#diff-739743069cff5c7f8d2f378370f0b56c99d3db766a5d2a18fb89ce5f3f233de4 "enclave/core/sgx/asmdefs.c")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/enclave/core/sgx/asmdefs.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,9 +16,9 @@ OE\_XSAVE\_INITIAL\_STATE[OE\_MINIMAL\_XSTATE\_AREA\_SIZE/sizeof(uint32\_t)] = { |
|  |  | \* clear Status, Tag, OpCode, FIP words \*/ |
|  |  | 0x037F, 0, 0, 0, |
|  |  |  |
|  |  | /\* Clear FDP bits, set MXCSR to ABI init value of 0x1F80 |
|  |  | /\* Clear FDP bits, set MXCSR to ABI init value of 0x1FBF |
|  |  | \* and MXCSR\_MASK to all bits (0XFFFF) \*/ |
|  |  | 0, 0, 0x1F80, 0xFFFF, |
|  |  | 0, 0, 0x1FBF, 0xFFFF, |
|  |  |  |
|  |  | /\* Clear ST/MM0-7 \*/ |
|  |  | 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, |
| Expand All | | @@ -35,10 +35,12 @@ OE\_XSAVE\_INITIAL\_STATE[OE\_MINIMAL\_XSTATE\_AREA\_SIZE/sizeof(uint32\_t)] = { |
|  |  | 0, 0, 0, 0, 0, 0, 0, 0, |
|  |  |  |
|  |  | /\* XSAVE Header \*/ |
|  |  | /\* Clear XSTATE\_BV. Note that this means we don't support |
|  |  | \* compaction mode (XCOMP\_BV[63]) to accommodate running |
|  |  | \* the same code in simulation mode on older CPUs. \*/ |
|  |  | 0, 0, 0, 0, |
|  |  | /\* Set XSTATE\_BV[1] to 1 (SSE state) \*/ |
|  |  | 2, 0, |
|  |  | /\* Set XCOMP\_BV[1] to 1 (SSE state), allowing non-default |
|  |  | \* MXCSR value to be restored. |
|  |  | \* Also, set XCOMP\_BV[63] to 1 for compaction mode \*/ |
|  |  | 2, 0x80000000, |
|  |  |  |
|  |  | /\* Reserved XSAVE header bits \*/ |
|  |  | 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, |
| Expand Down | |  |

20 changes: 11 additions & 9 deletions

20
[enclave/core/sgx/calls.c](#diff-ca075fbde1bf2e0da2cddee75f302504d3f5d893764d262a75be8196f08422cc "enclave/core/sgx/calls.c")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/enclave/core/sgx/calls.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -641,15 +641,17 @@ OE\_INLINE void \_handle\_oret( |
|  |  | td->oret\_arg = arg; |
|  |  |  |
|  |  | /\* Restore the FXSTATE and flags \*/ |
|  |  | asm volatile("pushq %[rflags] \n\t" // Restore flags. |
|  |  | "popfq \n\t" |
|  |  | "fldcw %[fcw] \n\t" // Restore x87 control word |
|  |  | "ldmxcsr %[mxcsr] \n\t" // Restore MXCSR |
|  |  | : [mxcsr] "=m"(callsite->mxcsr), |
|  |  | [fcw] "=m"(callsite->fcw), |
|  |  | [rflags] "=m"(callsite->rflags) |
|  |  | : |
|  |  | : "cc"); |
|  |  | asm volatile( |
|  |  | "pushq %[rflags] \n\t" // Restore flags. |
|  |  | "popfq \n\t" |
|  |  | "fldcw %[fcw] \n\t" // Restore x87 control word |
|  |  | "ldmxcsr %[mxcsr] \n\t" // Restore MXCSR |
|  |  | "lfence \n\t" // MXCSR Configuration Dependent Timing (MCDT) mitigation |
|  |  | : [mxcsr] "=m"(callsite->mxcsr), |
|  |  | [fcw] "=m"(callsite->fcw), |
|  |  | [rflags] "=m"(callsite->rflags) |
|  |  | : |
|  |  | : "cc"); |
|  |  |  |
|  |  | oe\_longjmp(&callsite->jmpbuf, 1); |
|  |  | } |
| Expand Down | |  |

3 changes: 3 additions & 0 deletions

3
[enclave/core/sgx/context.inc](#diff-5e0978f71a4721c712ab4029c16f01df3935fd2eef34601191484bc2d5554ff1 "enclave/core/sgx/context.inc")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/enclave/core/sgx/context.inc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -106,6 +106,9 @@ oe\_continue\_execution: |
|  |  | // oe\_snap\_current\_context. |
|  |  | ldmxcsr OE\_CONTEXT\_MXCSR(%rdi) |
|  |  |  |
|  |  | // For MXCSR Configuration Dependent Timing (MCDT) mitigation |
|  |  | lfence |
|  |  |  |
|  |  | // Restore general registers. |
|  |  | // Restore rax, rbx, rcx, rdx. |
|  |  | movq OE\_CONTEXT\_RAX(%rdi), %rax |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[enclave/core/sgx/enter.S](#diff-4e26a04147bb9572bee8ac81309772df7601bde30cc665139f0d5267a9d01de0 "enclave/core/sgx/enter.S")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/enclave/core/sgx/enter.S)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -314,6 +314,13 @@ oe\_enter: |
|  |  | xor %r11, %r11 |
|  |  | oe\_cleanup\_registers |
|  |  |  |
|  |  | // Clear the flags not covered by oe\_cleanup\_registers (i.e., control and system |
|  |  | // flags) that requires using (enclave) stack. Given that these flags are not |
|  |  | // affected instructions and persistent throughout the enclave lifetime, we only |
|  |  | // clear them once during the enter routine, which prevents poisoning attack from |
|  |  | // the host. |
|  |  | oe\_cleanup\_flags\_on\_enclave\_stack |
|  |  |  |
|  |  | // Call \_\_oe\_handle\_main(ARG1=RDI, ARG2=RSI, CSSA=RDX, TCS=RCX, OUTPUTARG1=R8, OUTPUTARG2=R9) |
|  |  | mov %rax, %rdx |
|  |  | mov %rbx, %rcx |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[tests/abi/abi\_utils.h](#diff-38b485040bcd1f11ec3dd0f4ca81cef8837f39e9508dd98b0b74953e666adb88 "tests/abi/abi_utils.h")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/tests/abi/abi_utils.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,8 +24,8 @@ OE\_EXTERNC\_END |
|  |  | // Set FTZ, Truncation RC and DAZ, clear all exception masks |
|  |  | #define TEST\_MXCSR 0xE040 |
|  |  |  |
|  |  | // Initial MXCSR value as defined by Linux/Window ABIs |
|  |  | #define INIT\_MXCSR 0x1F80 |
|  |  | // Default MXCSR value used by OE for MCDT mitigation |
|  |  | #define INIT\_MXCSR 0x1FBF |
|  |  |  |
|  |  | // Set RC to RNE, PC to SP, clear all exception masks (11 00 01 000000) |
|  |  | #define TEST\_FCW 0xC40 |
| Expand Down | |  |

20 changes: 18 additions & 2 deletions

20
[tests/abi/enc/enc.cpp](#diff-371d27c4f64068040b96ebc8931c19201bb687a4b964148840d3890f7d5569db "tests/abi/enc/enc.cpp")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/tests/abi/enc/enc.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -76,9 +76,25 @@ double enclave\_check\_abi() |
|  |  | .deepcopy\_out\_buffer\_size = 0, |
|  |  | .\_retval = 0}}; |
|  |  |  |
|  |  | flat\_ocall\_args\_t\* args = NULL; |
|  |  |  |
|  |  | /\* Get the FLAGS \*/ |
|  |  | uint64\_t flags = 0xffffffff; |
|  |  | asm volatile("pushfq\n\t" |
|  |  | "popq %0" |
|  |  | : "=r"(flags) |
|  |  | : |
|  |  | : "r8"); |
|  |  |  |
|  |  | /\* Validate bit 10 (DF) and 16 - 31 bits are cleared by the |
|  |  | \* oe\_enter routine. |
|  |  | \* Skip checks against other bits given that they could be impacted |
|  |  | \* by branch or memory access executed until this point \*/ |
|  |  | if (flags & 0xffff0400) |
|  |  | goto done; |
|  |  |  |
|  |  | /\* Alloc and initialize host\_check\_abi OCALL args buffer \*/ |
|  |  | flat\_ocall\_args\_t\* args = |
|  |  | (flat\_ocall\_args\_t\*)oe\_allocate\_ocall\_buffer(sizeof(args\_template)); |
|  |  | args = (flat\_ocall\_args\_t\*)oe\_allocate\_ocall\_buffer(sizeof(args\_template)); |
|  |  | if (!args) |
|  |  | goto done; |
|  |  |  |
| Expand Down | |  |

17 changes: 17 additions & 0 deletions

17
[tests/abi/host/host.cpp](#diff-1d4826607053f751db7ce2077af7f992dc5e5e97ec4b37cda3c3204a9e35cdaa "tests/abi/host/host.cpp")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/tests/abi/host/host.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -145,6 +145,23 @@ oe\_result\_t test\_abi\_roundtrip(oe\_enclave\_t\* enclave) |
|  |  | set\_test\_abi\_state(); |
|  |  | read\_abi\_state(&before\_ecall\_state); |
|  |  |  |
|  |  | #ifndef \_WIN32 |
|  |  | /\* Explicitly poison FLAGS bits 10 (DF) and 15-31 while reserving the |
|  |  | \* others |
|  |  | \*/ |
|  |  | uint64\_t flags = 0xffff0400; |
|  |  | #else |
|  |  | /\* Do not set DF on Windows, which will affect the behavior of |
|  |  | \* memset\_repmovs that is invoked in the critical path on the host \*/ |
|  |  | uint64\_t flags = 0xffff0000; |
|  |  | #endif |
|  |  | asm volatile("pushfq\n\t" |
|  |  | "or %0, (%%rsp)\n\t" |
|  |  | "popfq\n\t" |
|  |  | : |
|  |  | : "r"(flags) |
|  |  | : "r8"); |
|  |  |  |
|  |  | /\* Invoke oe\_enter directly to test the ocall transition ABI handling \*/ |
|  |  | oe\_enter(tcs, OE\_AEP\_ADDRESS, arg1, arg2, &arg3, &arg4, enclave); |
|  |  |  |
| Expand Down | |  |

34 changes: 17 additions & 17 deletions

34
[tests/libc/enc/enc.c](#diff-b96853ffb440431a7e387ac9383c068344310890d075777318e38ff878c84556 "tests/libc/enc/enc.c")

Show comments

[View file](/openenclave/openenclave/blob/ca54623333875b9beaad92c999a92b015c44b079/tests/libc/enc/enc.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,25 +32,25 @@ |
|  |  | void \_reset\_fxsave\_state() |
|  |  | { |
|  |  | /\* Initialize the FXSAVE state values to Linux x86-64 ABI defined values: |
|  |  | \* FCW = 0x037F, MXCSR = 0x1F80, MXCSR mask = 0xFFFF \*/ |
|  |  | \* FCW = 0x037F, MXCSR = 0x1FBF, MXCSR mask = 0xFFFF \*/ |
|  |  | static OE\_ALIGNED(OE\_FXSAVE\_ALIGNMENT) const uint64\_t |
|  |  | \_initial\_fxstate[OE\_FXSAVE\_AREA\_SIZE / sizeof(uint64\_t)] = { |
|  |  | 0x037F, 0, 0, 0xFFFF00001F80, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0, 0, 0, 0, |
|  |  | 0x037F, 0,  0, 0xFFFF00001FBF, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | 2, 0x80000002, 0, 0, |
|  |  | 0, 0,  0, 0, |
|  |  | }; |
|  |  |  |
|  |  | asm volatile("fxrstor %[fx\_state] \n\t" |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ca54623`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopenenclave%2Fopenenclave%2Fcommit%2Fca54623333875b9beaad92c999a92b015c44b079) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


