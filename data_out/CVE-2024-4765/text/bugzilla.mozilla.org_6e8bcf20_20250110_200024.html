

![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1871109)
* [XML](/show_bug.cgi?ctype=xml&id=1871109)

Closed
[Bug 1871109](/show_bug.cgi?id=1871109)
(CVE-2024-4765)

Opened 1 year ago
Closed 9 months ago

# generateHash in Manifest.sys.mjs should use sha256 or be removed

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

generateHash in Manifest.sys.mjs should use sha256 or be removed

## Categories

### (Core :: DOM: Core & HTML, defect)

[Product:](/describecomponents.cgi?product=Core)

Core
▾

Core
Shared components used by Firefox and other Mozilla software, including handling of Web content; Gecko, HTML, CSS, layout, DOM, scripts, images, networking, etc. Issues with web page layout probably go here, while Firefox user interface issues belong in the [Firefox](https://bugzilla.mozilla.org/describecomponents.cgi?product=Firefox) product. ([More info](https://wiki.mozilla.org/Modules/All#Core))
[See Open Bugs in This Product](/buglist.cgi?product=Core&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Core)
Watch This Product

[Component:](/describecomponents.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML#DOM%3A%20Core%20%26%20HTML)

DOM: Core & HTML
▾

Core :: DOM: Core & HTML
Issues in DOM tree [https://dom.spec.whatwg.org](https://dom.spec.whatwg.org/) & HTML [https://html.spec.whatwg.org](https://html.spec.whatwg.org/) that do not fit into any other DOM or HTML component or which span multiple DOM or HTML components.
[See Open Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Core&component=DOM%3A%20Core%20%26%20HTML)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

--

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

127 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Webcompat Priority | --- |
| --- | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix) |
| firefox125 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix) |
| firefox126 | [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed) |
| firefox127 | [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | --- | wontfix |
| firefox-esr128 | --- | --- |
| firefox125 |  | wontfix |
| firefox126 | + | fixed |
| firefox127 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: keeler, Assigned: linuohan.fred22)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/68e6768fa09169bf7d5f6baff176458f?d=mm&size=40)  [linuohan.fred22](/user_profile?user_id=741000)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](extensions/Gravatar/web/default.jpg)  [keeler](/user_profile?user_id=349244)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/331afc283e18d6d28cb7ebb11b2cf5bb?d=mm&size=40)  [hsinyi](/user_profile?user_id=434964)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

12 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-moderate, Whiteboard: [adv-main126+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-4765

[Keywords:](/describekeywords.cgi)

[sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main126+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a10740315_75935 "9 months ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a11021254_488993 "9 months ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (2 files)

| [Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck](/attachment.cgi?id=9391775)  [10 months ago](#c7)  [Nuohan Li](/user_profile?user_id=741000)   48 bytes, text/x-phabricator-request | dmeehan : [approval-mozilla-beta+](#c12 "9 months ago") | [Details](/attachment.cgi?id=9391775&action=edit) | [Review](/attachment.cgi?id=9391775) |
| --- | --- | --- |
| [advisory.txt](/attachment.cgi?id=9401121)  [8 months ago](#c14)  [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733)   374 bytes, text/plain |  | [Details](/attachment.cgi?id=9401121&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1871109#c0)• 1 year ago |
|  | |

It's unclear that Manifest.sys.mjs is still used, but if it is, then generateHash should be using a secure hash like sha256. If it isn't, then it should be removed.

|  | [Christoph Kerschbaumer [:ckerschb]](/user_profile?user_id=363267) |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1871109#c1)• 1 year ago |
|  | |

Hey Peter, we (the security engineering team) are working on removing deprecated hashes from the Firefox code base. I wanted to check in and ask if you could prioritize this bug? Could you maybe even provide a timeline?

We imagine the change shouldn't be too complicated. We could imagine that replacing md5 with e.g. sha256 could work, though we are happy to discuss options with you and the team. Thank you!

Flags: needinfo?(peterv)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1871109#c2)• 10 months ago |
|  | |

It turns out this is still used on mobile. Using a different hash for writing new files shouldn't be hard, but it seems we need to keep reading the existing files. That means being able to generate an MD5 hash based on a URL so we can find the existing files as fallback, if there is no file found based on the new hash.

I don't know who has time to work on that.

Flags: needinfo?(peterv) → needinfo?(htsai)

|  | [Hsin-Yi Tsai (she/her) [:hsinyi]](/user_profile?user_id=434964) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1871109#c3)• 10 months ago |
|  | |

Thanks Peter. I am currently exploring the solution with Christoph.

Flags: needinfo?(htsai)

|  | [Dana Keeler (she/her) (use needinfo) [:keeler]](/user_profile?user_id=349244)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1871109#c4)• 10 months ago |
|  | |

I should have filed this as a security bug originally. The issue here is that the data being hashed is controlled by the attacker, and as far as I can tell, that value is where we store the manifest file. If an attacker can get a user to add a manifest for a url where the md5 hash collides with the md5 hash of an existing manifest url, presumably the existing manifest file gets overwritten. The next time that manifest is read, it's all attacker-controlled data. I'm assuming that can lead to the attacker doing whatever they want in the context of that existing manifest (steal cookies? login credentials? private data?)

Group: dom-core-securityKeywords: [sec-moderate](/buglist.cgi?keywords=sec-moderate&resolution=---)

|  | [Nuohan Li](/user_profile?user_id=741000)  Assignee |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1871109#c5)• 10 months ago |
|  | |

Hey Peter, do you know where on mobile is this still used?

Assignee: nobody → nuliStatus: NEW → ASSIGNEDFlags: needinfo?(peterv)

|  | [Peter Van der Beken [:peterv]](/user_profile?user_id=24295) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1871109#c6)• 10 months ago |
|  | |

Here is how I would find out:

* Look for Manifest\*.sys.mjs references to figure out what code is using this: [https://searchfox.org/mozilla-central/search?q=%2FManifest.\*%5C.sys%5C.mjs&path=&case=false&regexp=true](https://searchfox.org/mozilla-central/search?q=%2FManifest.*%5C.sys%5C.mjs&path=&case=false&regexp=true). This shows usage in `mobile/android/actors/ContentDelegateChild.sys.mjs`: <https://searchfox.org/mozilla-central/rev/b60cb73160843adb5a5a3ec8058e75a69b46acf7/mobile/android/actors/ContentDelegateChild.sys.mjs#137-145>.
* Look for listeners for the `GeckoView:WebAppManifest` message that the code found above sends: <https://searchfox.org/mozilla-central/search?q=GeckoView%3AWebAppManifest&path=&case=false&regexp=false>. There's one listener: <https://searchfox.org/mozilla-central/rev/b60cb73160843adb5a5a3ec8058e75a69b46acf7/mobile/android/geckoview/src/main/java/org/mozilla/geckoview/GeckoSession.java#589-600>.
* The listener found above calls the `onWebAppManifest` API on GeckoView's `ContentDelegate`, so look for an implementation of that for example in Fenix code: <https://github.com/search?q=repo%3Amozilla-mobile%2Ffirefox-android%20onWebAppManifest&type=code> which leads to <https://github.com/mozilla-mobile/firefox-android/blob/1d7f591298d887b697811a0ae617b5ed6820ab90/android-components/components/browser/engine-gecko/src/main/java/mozilla/components/browser/engine/gecko/GeckoEngineSession.kt#L1589-L1594>
Flags: needinfo?(peterv)

|  | [Nuohan Li](/user_profile?user_id=741000)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1871109#c7)• 10 months ago |
|  | |

Attached file
[Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck](attachment.cgi?id=9391775)
— [Details](attachment.cgi?id=9391775&action=edit)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1871109#c8)• 9 months ago |
|  | |

Pushed by jschanck@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/d2adc352f591>
generateHash in Manifest.sys.mjs should use sha256 r=peterv

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1871109#c9)• 9 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/d2adc352f591>

Group: dom-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 9 months ago
[status-firefox127](/buglist.cgi?f1=cf_status_firefox127&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox127&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 127 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a10740315_75935)• 9 months ago |

[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=wontfix)
[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=wontfix)Flags: in-testsuite+

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1871109#c10)• 9 months ago |
|  | |

Nuohan could this get a beta uplift request?

Flags: needinfo?(nuli)

|  | [Nuohan Li](/user_profile?user_id=741000)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1871109#c11)• 9 months ago |
|  | |

Comment on [attachment 9391775](/attachment.cgi?id=9391775 "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck") [[details]](/attachment.cgi?id=9391775&action=edit "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck")

[Bug 1871109](/show_bug.cgi?id=1871109 "RESOLVED FIXED - generateHash in Manifest.sys.mjs should use sha256 or be removed") - generateHash in Manifest.sys.mjs should use sha256 r=jschanck

### Beta/Release Uplift Approval Request

* **User impact if declined**: Using MD5 for filenames in Firefox poses a risk as it's vulnerable to collision attacks. This could allow attackers to replace legitimate files with malicious ones. SHA-256 offers stronger collision resistance, therefore switching to SHA-256 reduces this risk.
* **Is this code covered by automated tests?**: Yes
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**: N/A
* **List of other uplifts needed**: N/A
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: This change is low-risk. It involves computing the SHA-256 hash for each manifest. If a file with the hash exists, we create a new file using SHA-256 and migrate the content. If not, we simply create a new file with SHA-256.
* **String changes made/needed**: No
* **Is Android affected?**: Yes
Flags: needinfo?(nuli)
[Attachment #9391775](/attachment.cgi?id=9391775&action=edit "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck") -
Flags: approval-mozilla-beta?

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1871109#c12)• 9 months ago |
|  | |

Comment on [attachment 9391775](/attachment.cgi?id=9391775 "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck") [[details]](/attachment.cgi?id=9391775&action=edit "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck")

[Bug 1871109](/show_bug.cgi?id=1871109 "RESOLVED FIXED - generateHash in Manifest.sys.mjs should use sha256 or be removed") - generateHash in Manifest.sys.mjs should use sha256 r=jschanck

Approved for 126.0b6

[Attachment #9391775](/attachment.cgi?id=9391775&action=edit "Bug 1871109 - generateHash in Manifest.sys.mjs should use sha256 r=jschanck") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1871109#c13)• 9 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/1ea0382b6606>

|  | [Donal Meehan [:dmeehan]](/user_profile?user_id=695136) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a10950650_695136)• 9 months ago |

[status-firefox126](/buglist.cgi?f1=cf_status_firefox126&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox126&o1=equals&v1=fixed)
[tracking-firefox126](/buglist.cgi?f1=cf_tracking_firefox126&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox126&o1=equals&v1=%2B)
[tracking-firefox127](/buglist.cgi?f1=cf_tracking_firefox127&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox127&o1=equals&v1=%2B)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a11021254_488993)• 9 months ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a12210263_486733)• 8 months ago |

Whiteboard: [adv-main126+]

|  | [Jesse Schwartzentruber (:truber)](/user_profile?user_id=486733) |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1871109#c14)• 8 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9401121)
— [Details](attachment.cgi?id=9401121&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a12264674_578488)• 8 months ago |

Alias: CVE-2024-4765

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a14263832_1689)• 7 months ago |

Type: task → defect

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1871109#a23615707_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1871109&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Nuohan Li](/user_profile?user_id=741000)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

