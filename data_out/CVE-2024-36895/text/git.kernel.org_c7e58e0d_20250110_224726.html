

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ivan Avdeev <me@provod.works> | 2024-04-13 11:01:24 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-17 12:02:28 +0200 |
| commit | [7a54e5052bde582fd0e7677334fe7a5be92e242c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)) | |
| tree | [1258aecf5ba92d3fa3c82a541ea26fcbb3023e26](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c) | |
| parent | [2f2886aedeec3a9838208f0945b3ce79dfa52166](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2f2886aedeec3a9838208f0945b3ce79dfa52166) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c&id2=2f2886aedeec3a9838208f0945b3ce79dfa52166)) | |
| download | [linux-7a54e5052bde582fd0e7677334fe7a5be92e242c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7a54e5052bde582fd0e7677334fe7a5be92e242c.tar.gz) | |

usb: gadget: uvc: use correct buffer size when parsing configfs listscommit 650ae71c80749fc7cb8858c8049f532eaec64410 upstream.
This commit fixes uvc gadget support on 32-bit platforms.
Commit 0df28607c5cb ("usb: gadget: uvc: Generalise helper functions for
reuse") introduced a helper function \_\_uvcg\_iter\_item\_entries() to aid
with parsing lists of items on configfs attributes stores. This function
is a generalization of another very similar function, which used a
stack-allocated temporary buffer of fixed size for each item in the list
and used the sizeof() operator to check for potential buffer overruns.
The new function was changed to allocate the now variably sized temp
buffer on heap, but wasn't properly updated to also check for max buffer
size using the computed size instead of sizeof() operator.
As a result, the maximum item size was 7 (plus null terminator) on
64-bit platforms, and 3 on 32-bit ones. While 7 is accidentally just
barely enough, 3 is definitely too small for some of UVC configfs
attributes. For example, dwFrameInteval, specified in 100ns units,
usually has 6-digit item values, e.g. 166666 for 60fps.
Cc: stable@vger.kernel.org
Fixes: 0df28607c5cb ("usb: gadget: uvc: Generalise helper functions for reuse")
Signed-off-by: Ivan Avdeev <me@provod.works>
Link: [https://lore.kernel.org/r/20240413150124.1062026-1-me@provod.works](https://lore.kernel.org/r/20240413150124.1062026-1-me%40provod.works)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)

| -rw-r--r-- | [drivers/usb/gadget/function/uvc\_configfs.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/gadget/function/uvc_configfs.c?id=7a54e5052bde582fd0e7677334fe7a5be92e242c) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/usb/gadget/function/uvc\_configfs.c b/drivers/usb/gadget/function/uvc\_configfs.cindex 9bf0e985acfab5..d16c04d2961b6d 100644--- a/[drivers/usb/gadget/function/uvc\_configfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/uvc_configfs.c?id=2f2886aedeec3a9838208f0945b3ce79dfa52166)+++ b/[drivers/usb/gadget/function/uvc\_configfs.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/gadget/function/uvc_configfs.c?id=7a54e5052bde582fd0e7677334fe7a5be92e242c)@@ -92,10 +92,10 @@ static int \_\_uvcg\_iter\_item\_entries(const char \*page, size\_t len,  while (pg - page < len) { i = 0;- while (i < sizeof(buf) && (pg - page < len) &&+ while (i < bufsize && (pg - page < len) && \*pg != '\0' && \*pg != '\n') buf[i++] = \*pg++;- if (i == sizeof(buf)) {+ if (i == bufsize) { ret = -EINVAL; goto out\_free\_buf; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:46:03 +0000

