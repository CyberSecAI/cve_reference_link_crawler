Based on the provided content, here's an analysis of the vulnerability:

**Root cause of vulnerability:**

The vulnerability stems from the fact that invited users could bypass the `must_approve_users` setting in Discourse under certain conditions, and also that invites by staff were automatically approved, ignoring the setting as well.

**Weaknesses/vulnerabilities present:**

- **Bypassing `must_approve_users` setting:** The system was not consistently enforcing the `must_approve_users` setting for invited users. Specifically, users logging in via SSO using an invite were not being subjected to the approval process.
- **Automatic approval of staff invites:** Invites generated by staff users were automatically approved, which also circumvented the `must_approve_users` setting.
- **Inconsistent handling of invites and user approvals:** The logic for handling user approvals when using invites was inconsistent and had unintentional cases where auto-approval occurred.

**Impact of exploitation:**

- **Bypassing user approval process:**  Malicious users could potentially gain unauthorized access to the platform without going through the required staff approval process.
- **Circumventing security policy:** The `must_approve_users` setting is intended to ensure that all new users are explicitly approved by staff, but this could be bypassed, potentially leading to the presence of unauthorized users on the platform.

**Attack vectors:**

- **SSO login with invite:** A malicious actor could exploit the vulnerability by using an invite to create an account with SSO and bypass the `must_approve_users` setting.
- **Staff invite abuse:** A malicious user that has staff access could bypass the user approval system by generating invites.

**Required attacker capabilities/position:**

- **Ability to generate or obtain an invite:** The attacker needs to have an invite to exploit the vulnerability.
- **SSO setup knowledge:**  For SSO bypass, the attacker needs to exploit the SSO login process via an invite.

**Additional details from the content:**
- The vulnerability affects sites that have `SiteSetting.must_approve_users` enabled.
- The fix for this vulnerability involves ensuring that all new users must be explicitly approved by a staff user, except for when the `auto_approve_email_domains` setting is used.
- The vulnerability was addressed in commit `7c4e2d33fa4b922354c177ffc880a2f2701a91f9` and a follow-up commit `0fa0094531efc82d9371f90a02aa804b176d59cf`.
- The fix was included in stable version >= 2.8.4, beta >= 2.9.0.beta5 and tests-passed >= 2.9.0.beta5.
- A workaround includes disabling invites, and increasing `min_trust_level_to_allow_invite` to reduce the attack surface to more trusted users.