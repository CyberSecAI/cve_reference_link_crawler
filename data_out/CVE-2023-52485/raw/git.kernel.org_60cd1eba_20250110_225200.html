<!DOCTYPE html>
<html lang='en'>
<head>
<title>drm/amd/display: Wake DMCUB before sending a command - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='303197775a97416b62d4da69280d0c120a20e009'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=303197775a97416b62d4da69280d0c120a20e009'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=303197775a97416b62d4da69280d0c120a20e009'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=303197775a97416b62d4da69280d0c120a20e009'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=303197775a97416b62d4da69280d0c120a20e009'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='303197775a97416b62d4da69280d0c120a20e009'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='303197775a97416b62d4da69280d0c120a20e009'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Nicholas Kazlauskas &lt;nicholas.kazlauskas@amd.com&gt;</td><td class='right'>2023-12-04 16:35:04 -0500</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-01-31 16:21:16 -0800</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=303197775a97416b62d4da69280d0c120a20e009'>303197775a97416b62d4da69280d0c120a20e009</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=303197775a97416b62d4da69280d0c120a20e009'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=303197775a97416b62d4da69280d0c120a20e009'>037d5a15aa4740d1da5ce10634753e002e43959d</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=820c3870c491946a78950cdf961bf40e28c1025f'>820c3870c491946a78950cdf961bf40e28c1025f</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=303197775a97416b62d4da69280d0c120a20e009&amp;id2=820c3870c491946a78950cdf961bf40e28c1025f'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-303197775a97416b62d4da69280d0c120a20e009.tar.gz'>linux-303197775a97416b62d4da69280d0c120a20e009.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>drm/amd/display: Wake DMCUB before sending a command</div><div class='commit-msg'>[ Upstream commit 8892780834ae294bc3697c7d0e056d7743900b39 ]

[Why]
We can hang in place trying to send commands when the DMCUB isn't
powered on.

[How]
For functions that execute within a DC context or DC lock we can
wrap the direct calls to dm_execute_dmub_cmd/list with code that
exits idle power optimizations and reallows once we're done with
the command submission on success.

For DM direct submissions the DM will need to manage the enter/exit
sequencing manually.

We cannot invoke a DMCUB command directly within the DM execution
helper or we can deadlock.

Cc: Mario Limonciello &lt;mario.limonciello@amd.com&gt;
Cc: Alex Deucher &lt;alexander.deucher@amd.com&gt;
Cc: stable@vger.kernel.org
Reviewed-by: Hansen Dsouza &lt;hansen.dsouza@amd.com&gt;
Acked-by: Wayne Lin &lt;wayne.lin@amd.com&gt;
Signed-off-by: Nicholas Kazlauskas &lt;nicholas.kazlauskas@amd.com&gt;
Tested-by: Daniel Wheeler &lt;daniel.wheeler@amd.com&gt;
Signed-off-by: Alex Deucher &lt;alexander.deucher@amd.com&gt;
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=303197775a97416b62d4da69280d0c120a20e009'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/bios/command_table2.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/bios/command_table2.c</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 11.3%;'/><td class='rem' style='width: 11.3%;'/><td class='none' style='width: 77.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/core/dc.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/core/dc.c</a></td><td class='right'>12</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 11.3%;'/><td class='rem' style='width: 11.3%;'/><td class='none' style='width: 77.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c</a></td><td class='right'>53</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 86.8%;'/><td class='rem' style='width: 13.2%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h</a></td><td class='right'>40</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 75.5%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 24.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dc_helper.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_helper.c</a></td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 5.7%;'/><td class='rem' style='width: 5.7%;'/><td class='none' style='width: 88.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c</a></td><td class='right'>14</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 13.2%;'/><td class='rem' style='width: 13.2%;'/><td class='none' style='width: 73.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c</a></td><td class='right'>14</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 13.2%;'/><td class='rem' style='width: 13.2%;'/><td class='none' style='width: 73.6%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 3.8%;'/><td class='rem' style='width: 3.8%;'/><td class='none' style='width: 92.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 3.8%;'/><td class='rem' style='width: 3.8%;'/><td class='none' style='width: 92.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 3.8%;'/><td class='rem' style='width: 3.8%;'/><td class='none' style='width: 92.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c</a></td><td class='right'>8</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 7.5%;'/><td class='rem' style='width: 7.5%;'/><td class='none' style='width: 84.9%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 3.8%;'/><td class='rem' style='width: 3.8%;'/><td class='none' style='width: 92.5%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c</a></td><td class='right'>6</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 5.7%;'/><td class='rem' style='width: 5.7%;'/><td class='none' style='width: 88.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 1.9%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 96.2%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c</a></td><td class='right'>3</td><td class='graph'><table summary='file diffstat' width='53%'><tr><td class='add' style='width: 3.8%;'/><td class='rem' style='width: 1.9%;'/><td class='none' style='width: 94.3%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>25 files changed, 143 insertions, 63 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c b/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c<br/>index 292335b7145c14..9dbbaeb8c6cf13 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/amdgpu_dm/amdgpu_dm.c</a></div><div class='hunk'>@@ -10620,7 +10620,7 @@ static bool dm_edid_parser_send_cea(struct amdgpu_display_manager *dm,</div><div class='ctx'> 	input-&gt;cea_total_length = total_length;</div><div class='ctx'> 	memcpy(input-&gt;payload, data, length);</div><div class='ctx'> </div><div class='del'>-	res = dm_execute_dmub_cmd(dm-&gt;dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY);</div><div class='add'>+	res = dc_wake_and_execute_dmub_cmd(dm-&gt;dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY);</div><div class='ctx'> 	if (!res) {</div><div class='ctx'> 		DRM_ERROR("EDID CEA parser failed\n");</div><div class='ctx'> 		return false;</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/bios/command_table2.c b/drivers/gpu/drm/amd/display/dc/bios/command_table2.c<br/>index ab0adabf9dd4c6..293a919d605d16 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/bios/command_table2.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/bios/command_table2.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/bios/command_table2.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/bios/command_table2.c</a></div><div class='hunk'>@@ -123,7 +123,7 @@ static void encoder_control_dmcub(</div><div class='ctx'> 		sizeof(cmd.digx_encoder_control.header);</div><div class='ctx'> 	cmd.digx_encoder_control.encoder_control.dig.stream_param = *dig;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result encoder_control_digx_v1_5(</div><div class='hunk'>@@ -259,7 +259,7 @@ static void transmitter_control_dmcub(</div><div class='ctx'> 		sizeof(cmd.dig1_transmitter_control.header);</div><div class='ctx'> 	cmd.dig1_transmitter_control.transmitter_control.dig = *dig;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result transmitter_control_v1_6(</div><div class='hunk'>@@ -321,7 +321,7 @@ static void transmitter_control_dmcub_v1_7(</div><div class='ctx'> 		sizeof(cmd.dig1_transmitter_control.header);</div><div class='ctx'> 	cmd.dig1_transmitter_control.transmitter_control.dig_v1_7 = *dig;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result transmitter_control_v1_7(</div><div class='hunk'>@@ -429,7 +429,7 @@ static void set_pixel_clock_dmcub(</div><div class='ctx'> 		sizeof(cmd.set_pixel_clock.header);</div><div class='ctx'> 	cmd.set_pixel_clock.pixel_clock.clk = *clk;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result set_pixel_clock_v7(</div><div class='hunk'>@@ -796,7 +796,7 @@ static void enable_disp_power_gating_dmcub(</div><div class='ctx'> 		sizeof(cmd.enable_disp_power_gating.header);</div><div class='ctx'> 	cmd.enable_disp_power_gating.power_gating.pwr = *pwr;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result enable_disp_power_gating_v2_1(</div><div class='hunk'>@@ -1006,7 +1006,7 @@ static void enable_lvtma_control_dmcub(</div><div class='ctx'> 			pwrseq_instance;</div><div class='ctx'> 	cmd.lvtma_control.data.bypass_panel_control_wait =</div><div class='ctx'> 			bypass_panel_control_wait;</div><div class='del'>-	dm_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmcub-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static enum bp_result enable_lvtma_control(</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c<br/>index 3db4ef564b997a..ce1386e22576ec 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn31/dcn31_clk_mgr.c</a></div><div class='hunk'>@@ -253,7 +253,7 @@ void dcn31_update_clocks(struct clk_mgr *clk_mgr_base,</div><div class='ctx'> 	cmd.notify_clocks.clocks.dispclk_khz = clk_mgr_base-&gt;clks.dispclk_khz;</div><div class='ctx'> 	cmd.notify_clocks.clocks.dppclk_khz = clk_mgr_base-&gt;clks.dppclk_khz;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static int get_vco_frequency_from_reg(struct clk_mgr_internal *clk_mgr)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c<br/>index 2618504e260e47..59c2a3545db34f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn314/dcn314_clk_mgr.c</a></div><div class='hunk'>@@ -281,7 +281,7 @@ void dcn314_update_clocks(struct clk_mgr *clk_mgr_base,</div><div class='ctx'> 	cmd.notify_clocks.clocks.dispclk_khz = clk_mgr_base-&gt;clks.dispclk_khz;</div><div class='ctx'> 	cmd.notify_clocks.clocks.dppclk_khz = clk_mgr_base-&gt;clks.dppclk_khz;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static int get_vco_frequency_from_reg(struct clk_mgr_internal *clk_mgr)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c<br/>index 8776055bbeaaea..644da463732093 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn315/dcn315_clk_mgr.c</a></div><div class='hunk'>@@ -232,7 +232,7 @@ static void dcn315_update_clocks(struct clk_mgr *clk_mgr_base,</div><div class='ctx'> 	cmd.notify_clocks.clocks.dispclk_khz = clk_mgr_base-&gt;clks.dispclk_khz;</div><div class='ctx'> 	cmd.notify_clocks.clocks.dppclk_khz = clk_mgr_base-&gt;clks.dppclk_khz;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static void dcn315_dump_clk_registers(struct clk_state_registers_and_bypass *regs_and_bypass,</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c<br/>index 09151cc56ce4f2..12f3e8aa46d8df 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn316/dcn316_clk_mgr.c</a></div><div class='hunk'>@@ -239,7 +239,7 @@ static void dcn316_update_clocks(struct clk_mgr *clk_mgr_base,</div><div class='ctx'> 	cmd.notify_clocks.clocks.dispclk_khz = clk_mgr_base-&gt;clks.dispclk_khz;</div><div class='ctx'> 	cmd.notify_clocks.clocks.dppclk_khz = clk_mgr_base-&gt;clks.dppclk_khz;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static void dcn316_dump_clk_registers(struct clk_state_registers_and_bypass *regs_and_bypass,</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c b/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c<br/>index d5fde7d23fbf8e..45ede6440a79f5 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/clk_mgr/dcn35/dcn35_clk_mgr.c</a></div><div class='hunk'>@@ -349,7 +349,7 @@ void dcn35_update_clocks(struct clk_mgr *clk_mgr_base,</div><div class='ctx'> 	cmd.notify_clocks.clocks.dispclk_khz = clk_mgr_base-&gt;clks.dispclk_khz;</div><div class='ctx'> 	cmd.notify_clocks.clocks.dppclk_khz = clk_mgr_base-&gt;clks.dppclk_khz;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static int get_vco_frequency_from_reg(struct clk_mgr_internal *clk_mgr)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/core/dc.c b/drivers/gpu/drm/amd/display/dc/core/dc.c<br/>index 5c118520664595..c535ddb45a36d9 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/core/dc.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/core/dc.c</a></div><div class='hunk'>@@ -519,7 +519,7 @@ dc_stream_forward_dmub_crc_window(struct dc_dmub_srv *dmub_srv,</div><div class='ctx'> 		cmd.secure_display.roi_info.y_end = rect-&gt;y + rect-&gt;height;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static inline void</div><div class='hunk'>@@ -3386,7 +3386,7 @@ void dc_dmub_update_dirty_rect(struct dc *dc,</div><div class='ctx'> </div><div class='ctx'> 			update_dirty_rect-&gt;panel_inst = panel_inst;</div><div class='ctx'> 			update_dirty_rect-&gt;pipe_idx = j;</div><div class='del'>-			dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+			dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> 		}</div><div class='ctx'> 	}</div><div class='ctx'> }</div><div class='hunk'>@@ -5213,7 +5213,7 @@ bool dc_process_dmub_aux_transfer_async(struct dc *dc,</div><div class='ctx'> 			);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -5267,7 +5267,7 @@ bool dc_process_dmub_set_config_async(struct dc *dc,</div><div class='ctx'> 	cmd.set_config_access.set_config_control.cmd_pkt.msg_type = payload-&gt;msg_type;</div><div class='ctx'> 	cmd.set_config_access.set_config_control.cmd_pkt.msg_data = payload-&gt;msg_data;</div><div class='ctx'> </div><div class='del'>-	if (!dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY)) {</div><div class='add'>+	if (!dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY)) {</div><div class='ctx'> 		/* command is not processed by dmub */</div><div class='ctx'> 		notify-&gt;sc_status = SET_CONFIG_UNKNOWN_ERROR;</div><div class='ctx'> 		return is_cmd_complete;</div><div class='hunk'>@@ -5310,7 +5310,7 @@ enum dc_status dc_process_dmub_set_mst_slots(const struct dc *dc,</div><div class='ctx'> 	cmd.set_mst_alloc_slots.mst_slots_control.instance = dc-&gt;links[link_index]-&gt;ddc_hw_inst;</div><div class='ctx'> 	cmd.set_mst_alloc_slots.mst_slots_control.mst_alloc_slots = mst_alloc_slots;</div><div class='ctx'> </div><div class='del'>-	if (!dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='add'>+	if (!dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='ctx'> 		/* command is not processed by dmub */</div><div class='ctx'> 		return DC_ERROR_UNEXPECTED;</div><div class='ctx'> </div><div class='hunk'>@@ -5348,7 +5348,7 @@ void dc_process_dmub_dpia_hpd_int_enable(const struct dc *dc,</div><div class='ctx'> 	cmd.dpia_hpd_int_enable.header.type = DMUB_CMD__DPIA_HPD_INT_ENABLE;</div><div class='ctx'> 	cmd.dpia_hpd_int_enable.enable = hpd_int_enable;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	DC_LOG_DEBUG("%s: hpd_int_enable(%d)\n", __func__, hpd_int_enable);</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c b/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c<br/>index fe07160932d696..fc18b9dc946f96 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/core/dc_hw_sequencer.c</a></div><div class='hunk'>@@ -724,7 +724,7 @@ void hwss_send_dmcub_cmd(union block_sequence_params *params)</div><div class='ctx'> 	union dmub_rb_cmd *cmd = params-&gt;send_dmcub_cmd_params.cmd;</div><div class='ctx'> 	enum dm_dmub_wait_type wait_type = params-&gt;send_dmcub_cmd_params.wait_type;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(ctx, cmd, wait_type);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(ctx, cmd, wait_type);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void hwss_program_manual_trigger(union block_sequence_params *params)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c b/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c<br/>index 9488f739737ee1..50f1e6d5321e4f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.c</a></div><div class='hunk'>@@ -341,7 +341,7 @@ void dc_dmub_srv_drr_update_cmd(struct dc *dc, uint32_t tg_inst, uint32_t vtotal</div><div class='ctx'> 	cmd.drr_update.header.payload_bytes = sizeof(cmd.drr_update) - sizeof(cmd.drr_update.header);</div><div class='ctx'> </div><div class='ctx'> 	// Send the command to the DMCUB.</div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dc_dmub_srv_set_drr_manual_trigger_cmd(struct dc *dc, uint32_t tg_inst)</div><div class='hunk'>@@ -355,7 +355,7 @@ void dc_dmub_srv_set_drr_manual_trigger_cmd(struct dc *dc, uint32_t tg_inst)</div><div class='ctx'> 	cmd.drr_update.header.payload_bytes = sizeof(cmd.drr_update) - sizeof(cmd.drr_update.header);</div><div class='ctx'> </div><div class='ctx'> 	// Send the command to the DMCUB.</div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static uint8_t dc_dmub_srv_get_pipes_for_stream(struct dc *dc, struct dc_stream_state *stream)</div><div class='hunk'>@@ -448,7 +448,7 @@ bool dc_dmub_srv_p_state_delegate(struct dc *dc, bool should_manage_pstate, stru</div><div class='ctx'> 		sizeof(cmd.fw_assisted_mclk_switch) - sizeof(cmd.fw_assisted_mclk_switch.header);</div><div class='ctx'> </div><div class='ctx'> 	// Send the command to the DMCUB.</div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -469,7 +469,7 @@ void dc_dmub_srv_query_caps_cmd(struct dc_dmub_srv *dc_dmub_srv)</div><div class='ctx'> 	cmd.query_feature_caps.header.payload_bytes = sizeof(struct dmub_cmd_query_feature_caps_data);</div><div class='ctx'> </div><div class='ctx'> 	/* If command was processed, copy feature caps to dmub srv */</div><div class='del'>-	if (dm_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='add'>+	if (dc_wake_and_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='ctx'> 	    cmd.query_feature_caps.header.ret_status == 0) {</div><div class='ctx'> 		memcpy(&amp;dc_dmub_srv-&gt;dmub-&gt;feature_caps,</div><div class='ctx'> 		       &amp;cmd.query_feature_caps.query_feature_caps_data,</div><div class='hunk'>@@ -494,7 +494,7 @@ void dc_dmub_srv_get_visual_confirm_color_cmd(struct dc *dc, struct pipe_ctx *pi</div><div class='ctx'> 	cmd.visual_confirm_color.visual_confirm_color_data.visual_confirm_color.panel_inst = panel_inst;</div><div class='ctx'> </div><div class='ctx'> 	// If command was processed, copy feature caps to dmub srv</div><div class='del'>-	if (dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='add'>+	if (dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='ctx'> 		cmd.visual_confirm_color.header.ret_status == 0) {</div><div class='ctx'> 		memcpy(&amp;dc-&gt;ctx-&gt;dmub_srv-&gt;dmub-&gt;visual_confirm_color,</div><div class='ctx'> 			&amp;cmd.visual_confirm_color.visual_confirm_color_data,</div><div class='hunk'>@@ -856,7 +856,7 @@ void dc_dmub_setup_subvp_dmub_command(struct dc *dc,</div><div class='ctx'> 		cmd.fw_assisted_mclk_switch_v2.config_data.watermark_a_cache = wm_val_refclk &lt; 0xFFFF ? wm_val_refclk : 0xFFFF;</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> bool dc_dmub_srv_get_diagnostic_data(struct dc_dmub_srv *dc_dmub_srv, struct dmub_diagnostic_data *diag_data)</div><div class='hunk'>@@ -1093,7 +1093,7 @@ void dc_send_update_cursor_info_to_dmu(</div><div class='ctx'> 				pipe_idx, pCtx-&gt;plane_res.hubp, pCtx-&gt;plane_res.dpp);</div><div class='ctx'> </div><div class='ctx'> 		/* Combine 2nd cmds update_curosr_info to DMU */</div><div class='del'>-		dm_execute_dmub_cmd_list(pCtx-&gt;stream-&gt;ctx, 2, cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+		dc_wake_and_execute_dmub_cmd_list(pCtx-&gt;stream-&gt;ctx, 2, cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> 	}</div><div class='ctx'> }</div><div class='ctx'> </div><div class='hunk'>@@ -1182,6 +1182,7 @@ static void dc_dmub_srv_notify_idle(const struct dc *dc, bool allow_idle)</div><div class='ctx'> 			dc-&gt;hwss.set_idle_state(dc, true);</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='add'>+	/* NOTE: This does not use the "wake" interface since this is part of the wake path. */</div><div class='ctx'> 	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='hunk'>@@ -1298,3 +1299,41 @@ void dc_dmub_srv_apply_idle_power_optimizations(const struct dc *dc, bool allow_</div><div class='ctx'> 	else</div><div class='ctx'> 		dc_dmub_srv_notify_idle(dc, allow_idle);</div><div class='ctx'> }</div><div class='add'>+</div><div class='add'>+bool dc_wake_and_execute_dmub_cmd(const struct dc_context *ctx, union dmub_rb_cmd *cmd,</div><div class='add'>+				  enum dm_dmub_wait_type wait_type)</div><div class='add'>+{</div><div class='add'>+	return dc_wake_and_execute_dmub_cmd_list(ctx, 1, cmd, wait_type);</div><div class='add'>+}</div><div class='add'>+</div><div class='add'>+bool dc_wake_and_execute_dmub_cmd_list(const struct dc_context *ctx, unsigned int count,</div><div class='add'>+				       union dmub_rb_cmd *cmd, enum dm_dmub_wait_type wait_type)</div><div class='add'>+{</div><div class='add'>+	struct dc_dmub_srv *dc_dmub_srv = ctx-&gt;dmub_srv;</div><div class='add'>+	bool result = false, reallow_idle = false;</div><div class='add'>+</div><div class='add'>+	if (!dc_dmub_srv || !dc_dmub_srv-&gt;dmub)</div><div class='add'>+		return false;</div><div class='add'>+</div><div class='add'>+	if (count == 0)</div><div class='add'>+		return true;</div><div class='add'>+</div><div class='add'>+	if (dc_dmub_srv-&gt;idle_allowed) {</div><div class='add'>+		dc_dmub_srv_apply_idle_power_optimizations(ctx-&gt;dc, false);</div><div class='add'>+		reallow_idle = true;</div><div class='add'>+	}</div><div class='add'>+</div><div class='add'>+	/*</div><div class='add'>+	 * These may have different implementations in DM, so ensure</div><div class='add'>+	 * that we guide it to the expected helper.</div><div class='add'>+	 */</div><div class='add'>+	if (count &gt; 1)</div><div class='add'>+		result = dm_execute_dmub_cmd_list(ctx, count, cmd, wait_type);</div><div class='add'>+	else</div><div class='add'>+		result = dm_execute_dmub_cmd(ctx, cmd, wait_type);</div><div class='add'>+</div><div class='add'>+	if (result &amp;&amp; reallow_idle)</div><div class='add'>+		dc_dmub_srv_apply_idle_power_optimizations(ctx-&gt;dc, true);</div><div class='add'>+</div><div class='add'>+	return result;</div><div class='add'>+}</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h b/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h<br/>index b63cba6235fc7a..784ca3e4441438 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_dmub_srv.h</a></div><div class='hunk'>@@ -106,4 +106,44 @@ bool dc_dmub_srv_is_hw_pwr_up(struct dc_dmub_srv *dc_dmub_srv, bool wait);</div><div class='ctx'> void dc_dmub_srv_apply_idle_power_optimizations(const struct dc *dc, bool allow_idle);</div><div class='ctx'> </div><div class='ctx'> void dc_dmub_srv_set_power_state(struct dc_dmub_srv *dc_dmub_srv, enum dc_acpi_cm_power_state powerState);</div><div class='add'>+</div><div class='add'>+/**</div><div class='add'>+ * dc_wake_and_execute_dmub_cmd() - Wrapper for DMUB command execution.</div><div class='add'>+ *</div><div class='add'>+ * Refer to dc_wake_and_execute_dmub_cmd_list() for usage and limitations,</div><div class='add'>+ * This function is a convenience wrapper for a single command execution.</div><div class='add'>+ *</div><div class='add'>+ * @ctx: DC context</div><div class='add'>+ * @cmd: The command to send/receive</div><div class='add'>+ * @wait_type: The wait behavior for the execution</div><div class='add'>+ *</div><div class='add'>+ * Return: true on command submission success, false otherwise</div><div class='add'>+ */</div><div class='add'>+bool dc_wake_and_execute_dmub_cmd(const struct dc_context *ctx, union dmub_rb_cmd *cmd,</div><div class='add'>+				  enum dm_dmub_wait_type wait_type);</div><div class='add'>+</div><div class='add'>+/**</div><div class='add'>+ * dc_wake_and_execute_dmub_cmd_list() - Wrapper for DMUB command list execution.</div><div class='add'>+ *</div><div class='add'>+ * If the DMCUB hardware was asleep then it wakes the DMUB before</div><div class='add'>+ * executing the command and attempts to re-enter if the command</div><div class='add'>+ * submission was successful.</div><div class='add'>+ *</div><div class='add'>+ * This should be the preferred command submission interface provided</div><div class='add'>+ * the DC lock is acquired.</div><div class='add'>+ *</div><div class='add'>+ * Entry/exit out of idle power optimizations would need to be</div><div class='add'>+ * manually performed otherwise through dc_allow_idle_optimizations().</div><div class='add'>+ *</div><div class='add'>+ * @ctx: DC context</div><div class='add'>+ * @count: Number of commands to send/receive</div><div class='add'>+ * @cmd: Array of commands to send</div><div class='add'>+ * @wait_type: The wait behavior for the execution</div><div class='add'>+ *</div><div class='add'>+ * Return: true on command submission success, false otherwise</div><div class='add'>+ */</div><div class='add'>+bool dc_wake_and_execute_dmub_cmd_list(const struct dc_context *ctx, unsigned int count,</div><div class='add'>+				       union dmub_rb_cmd *cmd, enum dm_dmub_wait_type wait_type);</div><div class='add'>+</div><div class='add'>+</div><div class='ctx'> #endif /* _DMUB_DC_SRV_H_ */</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dc_helper.c b/drivers/gpu/drm/amd/display/dc/dc_helper.c<br/>index cb6eaddab72056..8f9a678256150b 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_helper.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dc_helper.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dc_helper.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dc_helper.c</a></div><div class='hunk'>@@ -50,7 +50,7 @@ static inline void submit_dmub_read_modify_write(</div><div class='ctx'> 	cmd_buf-&gt;header.payload_bytes =</div><div class='ctx'> 			sizeof(struct dmub_cmd_read_modify_write_sequence) * offload-&gt;reg_seq_count;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	memset(cmd_buf, 0, sizeof(*cmd_buf));</div><div class='ctx'> </div><div class='hunk'>@@ -67,7 +67,7 @@ static inline void submit_dmub_burst_write(</div><div class='ctx'> 	cmd_buf-&gt;header.payload_bytes =</div><div class='ctx'> 			sizeof(uint32_t) * offload-&gt;reg_seq_count;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	memset(cmd_buf, 0, sizeof(*cmd_buf));</div><div class='ctx'> </div><div class='hunk'>@@ -80,7 +80,7 @@ static inline void submit_dmub_reg_wait(</div><div class='ctx'> {</div><div class='ctx'> 	struct dmub_rb_cmd_reg_wait *cmd_buf = &amp;offload-&gt;cmd_data.reg_wait;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(ctx, &amp;offload-&gt;cmd_data, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	memset(cmd_buf, 0, sizeof(*cmd_buf));</div><div class='ctx'> 	offload-&gt;reg_seq_count = 0;</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c b/drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c<br/>index 42c802afc4681b..4cff36351f40a3 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_abm_lcd.c</a></div><div class='hunk'>@@ -76,7 +76,7 @@ static void dmub_abm_enable_fractional_pwm(struct dc_context *dc)</div><div class='ctx'> 	cmd.abm_set_pwm_frac.abm_set_pwm_frac_data.panel_mask = panel_mask;</div><div class='ctx'> 	cmd.abm_set_pwm_frac.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_pwm_frac_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dmub_abm_init(struct abm *abm, uint32_t backlight)</div><div class='hunk'>@@ -155,7 +155,7 @@ bool dmub_abm_set_level(struct abm *abm, uint32_t level, uint8_t panel_mask)</div><div class='ctx'> 	cmd.abm_set_level.abm_set_level_data.panel_mask = panel_mask;</div><div class='ctx'> 	cmd.abm_set_level.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_level_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -186,7 +186,7 @@ void dmub_abm_init_config(struct abm *abm,</div><div class='ctx'> </div><div class='ctx'> 	cmd.abm_init_config.header.payload_bytes = sizeof(struct dmub_cmd_abm_init_config_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> }</div><div class='ctx'> </div><div class='hunk'>@@ -203,7 +203,7 @@ bool dmub_abm_set_pause(struct abm *abm, bool pause, unsigned int panel_inst, un</div><div class='ctx'> 	cmd.abm_pause.abm_pause_data.panel_mask = panel_mask;</div><div class='ctx'> 	cmd.abm_set_level.header.payload_bytes = sizeof(struct dmub_cmd_abm_pause_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -246,7 +246,7 @@ bool dmub_abm_save_restore(</div><div class='ctx'> </div><div class='ctx'> 	cmd.abm_save_restore.header.payload_bytes = sizeof(struct dmub_rb_cmd_abm_save_restore);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	// Copy iramtable data into local structure</div><div class='ctx'> 	memcpy((void *)pData, dc-&gt;dmub_srv-&gt;dmub-&gt;scratch_mem_fb.cpu_addr, bytes);</div><div class='hunk'>@@ -274,7 +274,7 @@ bool dmub_abm_set_pipe(struct abm *abm,</div><div class='ctx'> 	cmd.abm_set_pipe.abm_set_pipe_data.ramping_boundary = ramping_boundary;</div><div class='ctx'> 	cmd.abm_set_pipe.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_pipe_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -296,7 +296,7 @@ bool dmub_abm_set_backlight_level(struct abm *abm,</div><div class='ctx'> 	cmd.abm_set_backlight.abm_set_backlight_data.panel_mask = (0x01 &lt;&lt; panel_inst);</div><div class='ctx'> 	cmd.abm_set_backlight.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_backlight_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c b/drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c<br/>index 2aa0e01a6891b0..ba1fec3016d5ba 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_hw_lock_mgr.c</a></div><div class='hunk'>@@ -47,7 +47,7 @@ void dmub_hw_lock_mgr_cmd(struct dc_dmub_srv *dmub_srv,</div><div class='ctx'> 	if (!lock)</div><div class='ctx'> 		cmd.lock_hw.lock_hw_data.should_release = 1;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dmub_hw_lock_mgr_inbox0_cmd(struct dc_dmub_srv *dmub_srv,</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c b/drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c<br/>index d8009b2dc56a06..98a778996e1a91 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_outbox.c</a></div><div class='hunk'>@@ -48,5 +48,5 @@ void dmub_enable_outbox_notification(struct dc_dmub_srv *dmub_srv)</div><div class='ctx'> 		sizeof(cmd.outbox1_enable.header);</div><div class='ctx'> 	cmd.outbox1_enable.enable = true;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c b/drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c<br/>index 9d4170a356a207..3d7cef17f88181 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dce/dmub_psr.c</a></div><div class='hunk'>@@ -171,7 +171,7 @@ static bool dmub_psr_set_version(struct dmub_psr *dmub, struct dc_stream_state *</div><div class='ctx'> 	cmd.psr_set_version.psr_set_version_data.panel_inst = panel_inst;</div><div class='ctx'> 	cmd.psr_set_version.header.payload_bytes = sizeof(struct dmub_cmd_psr_set_version_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -199,7 +199,7 @@ static void dmub_psr_enable(struct dmub_psr *dmub, bool enable, bool wait, uint8</div><div class='ctx'> </div><div class='ctx'> 	cmd.psr_enable.header.payload_bytes = 0; // Send header only</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	/* Below loops 1000 x 500us = 500 ms.</div><div class='ctx'> 	 *  Exit PSR may need to wait 1-2 frames to power up. Timeout after at</div><div class='hunk'>@@ -248,7 +248,7 @@ static void dmub_psr_set_level(struct dmub_psr *dmub, uint16_t psr_level, uint8_</div><div class='ctx'> 	cmd.psr_set_level.psr_set_level_data.psr_level = psr_level;</div><div class='ctx'> 	cmd.psr_set_level.psr_set_level_data.cmd_version = DMUB_CMD_PSR_CONTROL_VERSION_1;</div><div class='ctx'> 	cmd.psr_set_level.psr_set_level_data.panel_inst = panel_inst;</div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /*</div><div class='hunk'>@@ -267,7 +267,7 @@ static void dmub_psr_set_sink_vtotal_in_psr_active(struct dmub_psr *dmub,</div><div class='ctx'> 	cmd.psr_set_vtotal.psr_set_vtotal_data.psr_vtotal_idle = psr_vtotal_idle;</div><div class='ctx'> 	cmd.psr_set_vtotal.psr_set_vtotal_data.psr_vtotal_su = psr_vtotal_su;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /*</div><div class='hunk'>@@ -286,7 +286,7 @@ static void dmub_psr_set_power_opt(struct dmub_psr *dmub, unsigned int power_opt</div><div class='ctx'> 	cmd.psr_set_power_opt.psr_set_power_opt_data.power_opt = power_opt;</div><div class='ctx'> 	cmd.psr_set_power_opt.psr_set_power_opt_data.panel_inst = panel_inst;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /*</div><div class='hunk'>@@ -423,7 +423,7 @@ static bool dmub_psr_copy_settings(struct dmub_psr *dmub,</div><div class='ctx'> 		copy_settings_data-&gt;relock_delay_frame_cnt = 2;</div><div class='ctx'> 	copy_settings_data-&gt;dsc_slice_height = psr_context-&gt;dsc_slice_height;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -444,7 +444,7 @@ static void dmub_psr_force_static(struct dmub_psr *dmub, uint8_t panel_inst)</div><div class='ctx'> 	cmd.psr_force_static.header.sub_type = DMUB_CMD__PSR_FORCE_STATIC;</div><div class='ctx'> 	cmd.psr_enable.header.payload_bytes = 0;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> /*</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c b/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c<br/>index 68cad55c72ab8c..e13d69a22c1c7f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn21/dcn21_hubp.c</a></div><div class='hunk'>@@ -691,7 +691,7 @@ static void dmcub_PLAT_54186_wa(struct hubp *hubp,</div><div class='ctx'> 	cmd.PLAT_54186_wa.flip.flip_params.vmid = flip_regs-&gt;vmid;</div><div class='ctx'> </div><div class='ctx'> 	PERF_TRACE();  // TODO: remove after performance is stable.</div><div class='del'>-	dm_execute_dmub_cmd(hubp-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(hubp-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> 	PERF_TRACE();  // TODO: remove after performance is stable.</div><div class='ctx'> }</div><div class='ctx'> </div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c<br/>index 4596f3bac1b4c7..26be5fee7411d9 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_dio_link_encoder.c</a></div><div class='hunk'>@@ -125,7 +125,7 @@ static bool query_dp_alt_from_dmub(struct link_encoder *enc,</div><div class='ctx'> 	cmd-&gt;query_dp_alt.header.payload_bytes = sizeof(cmd-&gt;query_dp_alt.data);</div><div class='ctx'> 	cmd-&gt;query_dp_alt.data.phy_id = phy_id_from_transmitter(enc10-&gt;base.transmitter);</div><div class='ctx'> </div><div class='del'>-	if (!dm_execute_dmub_cmd(enc-&gt;ctx, cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='add'>+	if (!dc_wake_and_execute_dmub_cmd(enc-&gt;ctx, cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='ctx'> 		return false;</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='hunk'>@@ -436,7 +436,7 @@ static bool link_dpia_control(struct dc_context *dc_ctx,</div><div class='ctx'> </div><div class='ctx'> 	cmd.dig1_dpia_control.dpia_control = *dpia_control;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc_ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc_ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c b/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c<br/>index d849b1eaa4a5c3..03248422d6ffde 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/dcn31/dcn31_panel_cntl.c</a></div><div class='hunk'>@@ -52,7 +52,7 @@ static bool dcn31_query_backlight_info(struct panel_cntl *panel_cntl, union dmub</div><div class='ctx'> 	cmd-&gt;panel_cntl.header.payload_bytes = sizeof(cmd-&gt;panel_cntl.data);</div><div class='ctx'> 	cmd-&gt;panel_cntl.data.pwrseq_inst = dcn31_panel_cntl-&gt;base.pwrseq_inst;</div><div class='ctx'> </div><div class='del'>-	return dm_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY);</div><div class='add'>+	return dc_wake_and_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> static uint32_t dcn31_get_16_bit_backlight_from_pwm(struct panel_cntl *panel_cntl)</div><div class='hunk'>@@ -85,7 +85,7 @@ static uint32_t dcn31_panel_cntl_hw_init(struct panel_cntl *panel_cntl)</div><div class='ctx'> 		panel_cntl-&gt;stored_backlight_registers.LVTMA_PWRSEQ_REF_DIV_BL_PWM_REF_DIV;</div><div class='ctx'> 	cmd.panel_cntl.data.bl_pwm_ref_div2 =</div><div class='ctx'> 		panel_cntl-&gt;stored_backlight_registers.PANEL_PWRSEQ_REF_DIV2;</div><div class='del'>-	if (!dm_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='add'>+	if (!dc_wake_and_execute_dmub_cmd(dc_dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY))</div><div class='ctx'> 		return 0;</div><div class='ctx'> </div><div class='ctx'> 	panel_cntl-&gt;stored_backlight_registers.BL_PWM_CNTL = cmd.panel_cntl.data.bl_pwm_cntl;</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c<br/>index 08783ad097d214..8e88dcaf88f5b2 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn21/dcn21_hwseq.c</a></div><div class='hunk'>@@ -154,7 +154,7 @@ static bool dmub_abm_set_pipe(struct abm *abm, uint32_t otg_inst,</div><div class='ctx'> 	cmd.abm_set_pipe.abm_set_pipe_data.ramping_boundary = ramping_boundary;</div><div class='ctx'> 	cmd.abm_set_pipe.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_pipe_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='hunk'>@@ -173,7 +173,7 @@ static void dmub_abm_set_backlight(struct dc_context *dc, uint32_t backlight_pwm</div><div class='ctx'> 	cmd.abm_set_backlight.abm_set_backlight_data.panel_mask = (0x01 &lt;&lt; panel_inst);</div><div class='ctx'> 	cmd.abm_set_backlight.header.payload_bytes = sizeof(struct dmub_cmd_abm_set_backlight_data);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dcn21_set_abm_immediate_disable(struct pipe_ctx *pipe_ctx)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c<br/>index d71faf2ecd413c..772dc0db916f7e 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn30/dcn30_hwseq.c</a></div><div class='hunk'>@@ -750,7 +750,7 @@ bool dcn30_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 				cmd.mall.header.sub_type = DMUB_CMD__MALL_ACTION_NO_DF_REQ;</div><div class='ctx'> 				cmd.mall.header.payload_bytes = sizeof(cmd.mall) - sizeof(cmd.mall.header);</div><div class='ctx'> </div><div class='del'>-				dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+				dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 				return true;</div><div class='ctx'> 			}</div><div class='hunk'>@@ -872,7 +872,7 @@ bool dcn30_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 					cmd.mall.cursor_height = cursor_attr.height;</div><div class='ctx'> 					cmd.mall.cursor_pitch = cursor_attr.pitch;</div><div class='ctx'> </div><div class='del'>-					dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+					dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 					/* Use copied cursor, and it's okay to not switch back */</div><div class='ctx'> 					cursor_attr.address.quad_part = cmd.mall.cursor_copy_dst.quad_part;</div><div class='hunk'>@@ -888,7 +888,7 @@ bool dcn30_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 				cmd.mall.tmr_scale = tmr_scale;</div><div class='ctx'> 				cmd.mall.debug_bits = dc-&gt;debug.mall_error_as_fatal;</div><div class='ctx'> </div><div class='del'>-				dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+				dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 				return true;</div><div class='ctx'> 			}</div><div class='hunk'>@@ -905,7 +905,7 @@ bool dcn30_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 	cmd.mall.header.payload_bytes =</div><div class='ctx'> 		sizeof(cmd.mall) - sizeof(cmd.mall.header);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c<br/>index 97798cee876e2e..52656691ae4849 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn31/dcn31_hwseq.c</a></div><div class='hunk'>@@ -415,7 +415,7 @@ void dcn31_z10_save_init(struct dc *dc)</div><div class='ctx'> 	cmd.dcn_restore.header.type = DMUB_CMD__IDLE_OPT;</div><div class='ctx'> 	cmd.dcn_restore.header.sub_type = DMUB_CMD__IDLE_OPT_DCN_SAVE_INIT;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dcn31_z10_restore(const struct dc *dc)</div><div class='hunk'>@@ -433,7 +433,7 @@ void dcn31_z10_restore(const struct dc *dc)</div><div class='ctx'> 	cmd.dcn_restore.header.type = DMUB_CMD__IDLE_OPT;</div><div class='ctx'> 	cmd.dcn_restore.header.sub_type = DMUB_CMD__IDLE_OPT_DCN_RESTORE;</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> }</div><div class='ctx'> </div><div class='ctx'> void dcn31_hubp_pg_control(struct dce_hwseq *hws, unsigned int hubp_inst, bool power_on)</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c b/drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c<br/>index c1a9b746c43fef..5bf9e7c1e052f6 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/hwss/dcn32/dcn32_hwseq.c</a></div><div class='hunk'>@@ -277,7 +277,7 @@ bool dcn32_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 				cmd.cab.header.sub_type = DMUB_CMD__CAB_NO_DCN_REQ;</div><div class='ctx'> 				cmd.cab.header.payload_bytes = sizeof(cmd.cab) - sizeof(cmd.cab.header);</div><div class='ctx'> </div><div class='del'>-				dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+				dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 				return true;</div><div class='ctx'> 			}</div><div class='hunk'>@@ -311,7 +311,7 @@ bool dcn32_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 				cmd.cab.header.payload_bytes = sizeof(cmd.cab) - sizeof(cmd.cab.header);</div><div class='ctx'> 				cmd.cab.cab_alloc_ways = (uint8_t)ways;</div><div class='ctx'> </div><div class='del'>-				dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='add'>+				dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_NO_WAIT);</div><div class='ctx'> </div><div class='ctx'> 				return true;</div><div class='ctx'> 			}</div><div class='hunk'>@@ -327,7 +327,7 @@ bool dcn32_apply_idle_power_optimizations(struct dc *dc, bool enable)</div><div class='ctx'> 	cmd.cab.header.payload_bytes =</div><div class='ctx'> 			sizeof(cmd.cab) - sizeof(cmd.cab.header);</div><div class='ctx'> </div><div class='del'>-	dm_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='add'>+	dc_wake_and_execute_dmub_cmd(dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT);</div><div class='ctx'> </div><div class='ctx'> 	return true;</div><div class='ctx'> }</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c b/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c<br/>index db87aa7b5c90f6..2f11eaabbe5f66 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_capability.c</a></div><div class='hunk'>@@ -1392,7 +1392,7 @@ static bool get_usbc_cable_id(struct dc_link *link, union dp_cable_id *cable_id)</div><div class='ctx'> 	cmd.cable_id.header.payload_bytes = sizeof(cmd.cable_id.data);</div><div class='ctx'> 	cmd.cable_id.data.input.phy_inst = resource_transmitter_to_phy_idx(</div><div class='ctx'> 			link-&gt;dc, link-&gt;link_enc-&gt;transmitter);</div><div class='del'>-	if (dm_execute_dmub_cmd(link-&gt;dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='add'>+	if (dc_wake_and_execute_dmub_cmd(link-&gt;dc-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='ctx'> 			cmd.cable_id.header.ret_status == 1) {</div><div class='ctx'> 		cable_id-&gt;raw = cmd.cable_id.data.output_raw;</div><div class='ctx'> 		DC_LOG_DC("usbc_cable_id = %d.\n", cable_id-&gt;raw);</div><div class='head'>diff --git a/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c b/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c<br/>index 0bb7491339098a..982eda3c46f568 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c?id=820c3870c491946a78950cdf961bf40e28c1025f'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c?id=303197775a97416b62d4da69280d0c120a20e009'>drivers/gpu/drm/amd/display/dc/link/protocols/link_dp_dpia.c</a></div><div class='hunk'>@@ -90,7 +90,8 @@ bool dpia_query_hpd_status(struct dc_link *link)</div><div class='ctx'> 	cmd.query_hpd.data.ch_type = AUX_CHANNEL_DPIA;</div><div class='ctx'> </div><div class='ctx'> 	/* Return HPD status reported by DMUB if query successfully executed. */</div><div class='del'>-	if (dm_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp; cmd.query_hpd.data.status == AUX_RET_SUCCESS)</div><div class='add'>+	if (dc_wake_and_execute_dmub_cmd(dmub_srv-&gt;ctx, &amp;cmd, DM_DMUB_WAIT_TYPE_WAIT_WITH_REPLY) &amp;&amp;</div><div class='add'>+	    cmd.query_hpd.data.status == AUX_RET_SUCCESS)</div><div class='ctx'> 		is_hpd_high = cmd.query_hpd.data.result;</div><div class='ctx'> </div><div class='ctx'> 	DC_LOG_DEBUG("%s: link(%d) dpia(%d) cmd_status(%d) result(%d)\n",</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 22:50:37 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
