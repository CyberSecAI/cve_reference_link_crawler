=== Content from github.com_6a9527c6_20250108_121657.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeosolutions-it%2Fjai-ext%2Fsecurity%2Fadvisories%2FGHSA-v92f-jx6p-73rx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeosolutions-it%2Fjai-ext%2Fsecurity%2Fadvisories%2FGHSA-v92f-jx6p-73rx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=geosolutions-it%2Fjai-ext)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[geosolutions-it](/geosolutions-it)
/
**[jai-ext](/geosolutions-it/jai-ext)**
Public

* [Notifications](/login?return_to=%2Fgeosolutions-it%2Fjai-ext) You must be signed in to change notification settings
* [Fork
  38](/login?return_to=%2Fgeosolutions-it%2Fjai-ext)
* [Star
   91](/login?return_to=%2Fgeosolutions-it%2Fjai-ext)

* [Code](/geosolutions-it/jai-ext)
* [Issues
  49](/geosolutions-it/jai-ext/issues)
* [Pull requests
  1](/geosolutions-it/jai-ext/pulls)
* [Actions](/geosolutions-it/jai-ext/actions)
* [Projects
  0](/geosolutions-it/jai-ext/projects)
* [Wiki](/geosolutions-it/jai-ext/wiki)
* [Security](/geosolutions-it/jai-ext/security)
* [Insights](/geosolutions-it/jai-ext/pulse)

Additional navigation options

* [Code](/geosolutions-it/jai-ext)
* [Issues](/geosolutions-it/jai-ext/issues)
* [Pull requests](/geosolutions-it/jai-ext/pulls)
* [Actions](/geosolutions-it/jai-ext/actions)
* [Projects](/geosolutions-it/jai-ext/projects)
* [Wiki](/geosolutions-it/jai-ext/wiki)
* [Security](/geosolutions-it/jai-ext/security)
* [Insights](/geosolutions-it/jai-ext/pulse)

# Improper Control of Generation of Code ('Code Injection') in jai-ext

Critical

[aaime](/aaime)
published
GHSA-v92f-jx6p-73rx
Apr 13, 2022

## Package

maven

jt-jiffle
([Maven](/advisories?query=ecosystem%3Amaven))

## Affected versions

< 1.1.22

## Patched versions

1.1.22

## Description

### Impact

Programs using jt-jiffle, and allowing Jiffle script to be provided via network request, are susceptible to a Remote Code Execution as the Jiffle script is compiled into Java code via Janino, and executed. In particular, this affects the downstream GeoServer project.

### Patches

Version 1.2.22 will contain a patch that disables the ability to inject malicious code into the resulting script.

### Workarounds

Negate the ability to compile Jiffle scripts from the final application, by removing janino-x.y.z.jar from the classpath.

### References

None.

### Severity

Critical

10.0

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2022-24816

### Weaknesses

[CWE-94](/advisories?query=cwe%3A94)

### Credits

* [![@sikeoka](https://avatars.githubusercontent.com/u/11542093?s=40&v=4)](/sikeoka)
  [sikeoka](/sikeoka)
  Analyst

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_fb6f5c5d_20250108_121657.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeosolutions-it%2Fjai-ext%2Fcommit%2Fcb1d6565d38954676b0a366da4f965fef38da1cb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeosolutions-it%2Fjai-ext%2Fcommit%2Fcb1d6565d38954676b0a366da4f965fef38da1cb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=geosolutions-it%2Fjai-ext)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[geosolutions-it](/geosolutions-it)
/
**[jai-ext](/geosolutions-it/jai-ext)**
Public

* [Notifications](/login?return_to=%2Fgeosolutions-it%2Fjai-ext) You must be signed in to change notification settings
* [Fork
  38](/login?return_to=%2Fgeosolutions-it%2Fjai-ext)
* [Star
   91](/login?return_to=%2Fgeosolutions-it%2Fjai-ext)

* [Code](/geosolutions-it/jai-ext)
* [Issues
  49](/geosolutions-it/jai-ext/issues)
* [Pull requests
  1](/geosolutions-it/jai-ext/pulls)
* [Actions](/geosolutions-it/jai-ext/actions)
* [Projects
  0](/geosolutions-it/jai-ext/projects)
* [Wiki](/geosolutions-it/jai-ext/wiki)
* [Security](/geosolutions-it/jai-ext/security)
* [Insights](/geosolutions-it/jai-ext/pulse)

Additional navigation options

* [Code](/geosolutions-it/jai-ext)
* [Issues](/geosolutions-it/jai-ext/issues)
* [Pull requests](/geosolutions-it/jai-ext/pulls)
* [Actions](/geosolutions-it/jai-ext/actions)
* [Projects](/geosolutions-it/jai-ext/projects)
* [Wiki](/geosolutions-it/jai-ext/wiki)
* [Security](/geosolutions-it/jai-ext/security)
* [Insights](/geosolutions-it/jai-ext/pulse)

## Commit

[Permalink](/geosolutions-it/jai-ext/commit/cb1d6565d38954676b0a366da4f965fef38da1cb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Validate Jiffle input variable names according to grammar, escape jav…

[Browse files](/geosolutions-it/jai-ext/tree/cb1d6565d38954676b0a366da4f965fef38da1cb)
Browse the repository at this point in the history

```
…adocs when including Jiffle sources in output
```

* Loading branch information

[![@aaime](https://avatars.githubusercontent.com/u/325433?s=40&v=4)](/aaime)

[aaime](/geosolutions-it/jai-ext/commits?author=aaime "View all commits by aaime")
committed
Apr 11, 2022

1 parent
[8d2ab59](/geosolutions-it/jai-ext/commit/8d2ab594dc3295c5c6eabb7da3568f734521bf2d)

commit cb1d656

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**188 additions**
and
**18 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* jt-jiffle/jt-jiffle-language/src

  + main/java/it/geosolutions/jaiext/jiffle

    - jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/Jiffle.java
      [Jiffle.java](#diff-5b9bb7cf5293e20dc427856654f09de8046808ae18e6cf7c0ca6c848a8247b3c)
    - parser/node

      * jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/parser/node/Script.java
        [Script.java](#diff-9d71157fb7eb907d8e3a2516bf4a668144d090cbdc19e80f1ef798f6531ff31d)
  + test/java/it/geosolutions/jaiext/jiffle/runtime

    - jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/JiffleRuntimeTest.java
      [JiffleRuntimeTest.java](#diff-fff41484387f1387114453cb7f443782ec4382199dab59235a4130a858a5185e)
    - jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/ScriptTest.java
      [ScriptTest.java](#diff-9e3d58db1117d1cbca4fb94d2a9277cc74d6d1004424374f9831b49cbf56d52b)

## There are no files selected for viewing

44 changes: 30 additions & 14 deletions

44
[jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/Jiffle.java](#diff-5b9bb7cf5293e20dc427856654f09de8046808ae18e6cf7c0ca6c848a8247b3c "jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/Jiffle.java")

Show comments

[View file](/geosolutions-it/jai-ext/blob/cb1d6565d38954676b0a366da4f965fef38da1cb/jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/Jiffle.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -128,7 +128,7 @@ public class Jiffle { |
|  |  |  |
|  |  | public static final Logger LOGGER = Logger.getLogger(Jiffle.class.getName()); |
|  |  |  |
|  |  | private static Pattern BLOCK\_COMMENT\_STRIPPER = Pattern.compile("(?:/\\\*(?:[^\*]|(?:\\\*+[^\*/]))\*\\\*+/)"); |
|  |  | boolean includeScript; |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Constants for runtime model. Jiffle supports two runtime models: |
| Expand Down  Expand Up | | @@ -272,7 +272,20 @@ public Jiffle(File scriptFile, Map<String, Jiffle.ImageRole> params) |
|  |  | setImageParams(params); |
|  |  | compile(); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Returns true if the script is to be included in the output |
|  |  | \* |
|  |  | \* @return |
|  |  | \*/ |
|  |  | public boolean isIncludeScript() { |
|  |  | return includeScript; |
|  |  | } |
|  |  |  |
|  |  | public void setIncludeScript(boolean includeScript) { |
|  |  | this.includeScript = includeScript; |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Sets the script. Calling this method will clear any previous script |
|  |  | \* and runtime objects. |
| Expand Down  Expand Up | | @@ -481,7 +494,7 @@ public JiffleDirectRuntime getRuntimeInstance() throws |
|  |  | \*/ |
|  |  | public JiffleRuntime getRuntimeInstance(Jiffle.RuntimeModel model) throws |
|  |  | it.geosolutions.jaiext.jiffle.JiffleException { |
|  |  | return createRuntimeInstance(model, getRuntimeBaseClass(model), false); |
|  |  | return createRuntimeInstance(model, getRuntimeBaseClass(model), includeScript); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -512,7 +525,7 @@ public <T extends JiffleRuntime> T getRuntimeInstance(Class<T> baseClass) throws |
|  |  | " does not implement a required Jiffle runtime interface"); |
|  |  | } |
|  |  |  |
|  |  | return (T) createRuntimeInstance(model, baseClass, false); |
|  |  | return (T) createRuntimeInstance(model, baseClass, includeScript); |
|  |  | } |
|  |  |  |
|  |  | private JiffleRuntime createRuntimeInstance(RuntimeModel model, Class<? extends JiffleRuntime> runtimeClass, boolean scriptInDocs) throws |
| Expand Down  Expand Up | | @@ -558,7 +571,14 @@ private JiffleRuntime createRuntimeInstance(RuntimeModel model, Class<? extends |
|  |  | return runtime; |
|  |  |  |
|  |  | } catch (Exception ex) { |
|  |  | throw new it.geosolutions.jaiext.jiffle.JiffleException("Runtime source error for source: " + runtimeSource, ex); |
|  |  | // do not display the source code in indirect runtime exception messages |
|  |  | if (model == RuntimeModel.INDIRECT) { |
|  |  | if (LOGGER.isLoggable(Level.FINE)) { |
|  |  | LOGGER.fine("Runtime source error for source: " + runtimeSource); |
|  |  | } |
|  |  | throw new JiffleException("Runtime source error", ex); |
|  |  | } |
|  |  | throw new JiffleException("Runtime source error for source: " + runtimeSource, ex); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -613,22 +633,17 @@ private Class<? extends JiffleRuntime> getRuntimeBaseClass(RuntimeModel model) { |
|  |  | return baseClass; |
|  |  | } |
|  |  |  |
|  |  | private String createRuntimeSource(RuntimeModel model, String baseClassName, boolean scriptInDocs) { |
|  |  | private String createRuntimeSource(RuntimeModel model, String baseClassName, |
|  |  | boolean scriptInDocs) { |
|  |  | SourceWriter writer = new SourceWriter(model); |
|  |  | if (scriptInDocs) { |
|  |  | throw new RuntimeException("Do no know how to clean the block comments yet"); |
|  |  | writer.setScript(theScript); |
|  |  | } |
|  |  |  |
|  |  | SourceWriter writer = new SourceWriter(model); |
|  |  | writer.setScript(stripComments(theScript)); |
|  |  | writer.setBaseClassName(baseClassName); |
|  |  | scriptModel.write(writer); |
|  |  | return writer.getSource(); |
|  |  | } |
|  |  |  |
|  |  | private String stripComments(String theScript) { |
|  |  | return BLOCK\_COMMENT\_STRIPPER.matcher(theScript).replaceAll(""); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Initializes this object's name and runtime base class. |
|  |  | \*/ |
| Expand All | | @@ -648,6 +663,7 @@ private void clearCompiledObjects() { |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Builds the parse tree from the script. |
|  |  | \* |
|  |  | \* @param script |
|  |  | \*/ |
|  |  | private static Jiffle.Result<ParseTree> parseScript(String script) { |
| Expand Down | |  |

28 changes: 24 additions & 4 deletions

28
[...le/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/parser/node/Script.java](#diff-9d71157fb7eb907d8e3a2516bf4a668144d090cbdc19e80f1ef798f6531ff31d "jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/parser/node/Script.java")

Show comments

[View file](/geosolutions-it/jai-ext/blob/cb1d6565d38954676b0a366da4f965fef38da1cb/jt-jiffle/jt-jiffle-language/src/main/java/it/geosolutions/jaiext/jiffle/parser/node/Script.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -52,13 +52,17 @@ |
|  |  | import it.geosolutions.jaiext.jiffle.parser.UndefinedOptionException; |
|  |  |  |
|  |  | import java.util.Collections; |
|  |  | import java.util.List; |
|  |  | import java.util.Map; |
|  |  | import java.util.Objects; |
|  |  | import java.util.Set; |
|  |  | import java.util.regex.Pattern; |
|  |  |  |
|  |  | /\*\* @author michael \*/ |
|  |  | public class Script implements Node { |
|  |  |  |
|  |  | /\*\* <pre>ID : (Letter) (Letter | UNDERSCORE | Digit | Dot)\*</pre> \*/ |
|  |  | private static final Pattern VALID\_IDENTIFIER = Pattern.compile("^[a-zA-Z][\_a-zA-Z0-9\\.]\*$"); |
|  |  |  |
|  |  | private final StatementList stmts; |
|  |  | private final RepeatedReadOptimizer readOptimizer; |
|  |  | private Map<String, String> options; |
| Expand All | | @@ -79,6 +83,20 @@ public Script( |
|  |  | this.globals = globals; |
|  |  | this.stmts = stmts; |
|  |  | this.readOptimizer = readOptimizer; |
|  |  | validate(); |
|  |  | } |
|  |  |  |
|  |  | private void validate() { |
|  |  | for (String name : sourceImages) { |
|  |  | if (!VALID\_IDENTIFIER.matcher(name).matches()) { |
|  |  | throw new JiffleParserException("Invalid source image name: " + name); |
|  |  | } |
|  |  | } |
|  |  | for (String name : destImages) { |
|  |  | if (!VALID\_IDENTIFIER.matcher(name).matches()) { |
|  |  | throw new JiffleParserException("Invalid dest image name: " + name); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | public void write(SourceWriter w) { |
| Expand All | | @@ -97,11 +115,13 @@ public void write(SourceWriter w) { |
|  |  | String[] lines = script.split("\n"); |
|  |  | w.line("/\*\*"); |
|  |  | w.line(" \* Java runtime class generated from the following Jiffle script: "); |
|  |  | w.line(" \*<code>"); |
|  |  | w.line(" \*<pre>"); |
|  |  | for (String line : lines) { |
|  |  | w.append(" \* ").append(line).newLine(); |
|  |  | // In case the script itself includes comments, they best to be escaped |
|  |  | String escaped = line.replace("\*/", "\*&#47;").replace("/\*", "&#47;\*"); |
|  |  | w.append(" \* ").append(escaped).newLine(); |
|  |  | } |
|  |  | w.line(" \*</code>"); |
|  |  | w.line(" \*</pre>"); |
|  |  | w.line(" \*/"); |
|  |  | } |
|  |  |  |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[...iffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/JiffleRuntimeTest.java](#diff-fff41484387f1387114453cb7f443782ec4382199dab59235a4130a858a5185e "jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/JiffleRuntimeTest.java")

Show comments

[View file](/geosolutions-it/jai-ext/blob/cb1d6565d38954676b0a366da4f965fef38da1cb/jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/JiffleRuntimeTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,61 @@ |
|  |  | /\* JAI-Ext - OpenSource Java Advanced Image Extensions Library |
|  |  | \* http://www.geo-solutions.it/ |
|  |  | \* Copyright 2018 GeoSolutions |
|  |  | \* |
|  |  | \* Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | \* you may not use this file except in compliance with the License. |
|  |  | \* You may obtain a copy of the License at |
|  |  | \* |
|  |  | \* http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | \* See the License for the specific language governing permissions and |
|  |  | \* limitations under the License. |
|  |  | \*/ |
|  |  | package it.geosolutions.jaiext.jiffle.runtime; |
|  |  |  |
|  |  | import it.geosolutions.jaiext.jiffle.Jiffle; |
|  |  | import it.geosolutions.jaiext.jiffle.JiffleException; |
|  |  | import org.junit.Test; |
|  |  |  |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import static org.junit.Assert.assertFalse; |
|  |  | import static org.junit.Assert.assertTrue; |
|  |  |  |
|  |  | public class JiffleRuntimeTest { |
|  |  |  |
|  |  | @Test |
|  |  | public void testSkipSource() throws Exception { |
|  |  | Jiffle jiffle = getJiffleWithComment(); |
|  |  | String source = jiffle.getRuntimeSource(false); |
|  |  |  |
|  |  | // by default, it does not contain the source |
|  |  | assertFalse(source.contains("This is a comment")); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void testEscapeSource() throws Exception { |
|  |  | Jiffle jiffle = getJiffleWithComment(); |
|  |  | String source = jiffle.getRuntimeSource(true); |
|  |  |  |
|  |  | // source is in the javadocs, and properly escaped |
|  |  | assertTrue(source.contains("\* &#47;\* This is a comment \*&#47;")); |
|  |  | assertTrue(source.contains("\* dest=10;")); |
|  |  | } |
|  |  |  |
|  |  | private Jiffle getJiffleWithComment() throws JiffleException { |
|  |  | String script = "/\* This is a comment \*/\ndest=10;"; |
|  |  | Jiffle jiffle = new Jiffle(); |
|  |  | jiffle.setScript(script); |
|  |  | Map<String, Jiffle.ImageRole> params = new HashMap<>(); |
|  |  | params.put("dest", Jiffle.ImageRole.DEST); |
|  |  | jiffle.setImageParams(params); |
|  |  |  |
|  |  | jiffle.compile(); |
|  |  | return jiffle; |
|  |  | } |
|  |  | } |

73 changes: 73 additions & 0 deletions

73
[...le/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/ScriptTest.java](#diff-9e3d58db1117d1cbca4fb94d2a9277cc74d6d1004424374f9831b49cbf56d52b "jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/ScriptTest.java")

Show comments

[View file](/geosolutions-it/jai-ext/blob/cb1d6565d38954676b0a366da4f965fef38da1cb/jt-jiffle/jt-jiffle-language/src/test/java/it/geosolutions/jaiext/jiffle/runtime/ScriptTest.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,73 @@ |
|  |  | /\* JAI-Ext - OpenSource Java Advanced Image Extensions Library |
|  |  | \* http://www.geo-solutions.it/ |
|  |  | \* Copyright 2018 GeoSolutions |
|  |  | \* |
|  |  | \* Licensed under the Apache License, Version 2.0 (the "License"); |
|  |  | \* you may not use this file except in compliance with the License. |
|  |  | \* You may obtain a copy of the License at |
|  |  | \* |
|  |  | \* http://www.apache.org/licenses/LICENSE-2.0 |
|  |  | \* |
|  |  | \* Unless required by applicable law or agreed to in writing, software |
|  |  | \* distributed under the License is distributed on an "AS IS" BASIS, |
|  |  | \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. |
|  |  | \* See the License for the specific language governing permissions and |
|  |  | \* limitations under the License. |
|  |  | \*/ |
|  |  | package it.geosolutions.jaiext.jiffle.runtime; |
|  |  |  |
|  |  | import it.geosolutions.jaiext.jiffle.Jiffle; |
|  |  | import it.geosolutions.jaiext.jiffle.JiffleException; |
|  |  | import it.geosolutions.jaiext.jiffle.parser.JiffleParserException; |
|  |  | import org.junit.Assert; |
|  |  | import org.junit.Test; |
|  |  |  |
|  |  | import java.util.HashMap; |
|  |  | import java.util.Map; |
|  |  |  |
|  |  | import static org.junit.Assert.assertEquals; |
|  |  |  |
|  |  | public class ScriptTest { |
|  |  |  |
|  |  | @Test |
|  |  | public void testValidateSourceImages() throws Exception { |
|  |  | checkInvalidSourceName("a b"); |
|  |  | checkInvalidSourceName("99a"); |
|  |  | checkInvalidSourceName("#abc"); |
|  |  | checkInvalidSourceName("/abc"); |
|  |  | checkInvalidSourceName("{abc"); |
|  |  | } |
|  |  |  |
|  |  | @Test |
|  |  | public void testValidateDestinationImages() throws Exception { |
|  |  | checkInvalidDestinationName("a b"); |
|  |  | checkInvalidDestinationName("99a"); |
|  |  | checkInvalidDestinationName("#abc"); |
|  |  | checkInvalidDestinationName("/abc"); |
|  |  | checkInvalidDestinationName("{abc"); |
|  |  | } |
|  |  |  |
|  |  | private void checkInvalidSourceName(String name) throws JiffleException { |
|  |  | Jiffle jiffle = new Jiffle(); |
|  |  | jiffle.setScript("dst=0;"); |
|  |  | Map<String, Jiffle.ImageRole> params = new HashMap<>(); |
|  |  | params.put(name, Jiffle.ImageRole.SOURCE); |
|  |  | jiffle.setImageParams(params); |
|  |  |  |
|  |  | JiffleParserException exception = |
|  |  | Assert.assertThrows(JiffleParserException.class, () -> jiffle.compile()); |
|  |  | assertEquals("Invalid source image name: " + name, exception.getMessage()); |
|  |  | } |
|  |  |  |
|  |  | private void checkInvalidDestinationName(String name) throws JiffleException { |
|  |  | Jiffle jiffle = new Jiffle(); |
|  |  | jiffle.setScript("dst=0;"); |
|  |  | Map<String, Jiffle.ImageRole> params = new HashMap<>(); |
|  |  | params.put(name, Jiffle.ImageRole.DEST); |
|  |  | jiffle.setImageParams(params); |
|  |  |  |
|  |  | JiffleParserException exception = |
|  |  | Assert.assertThrows(JiffleParserException.class, () -> jiffle.compile()); |
|  |  | assertEquals("Invalid dest image name: " + name, exception.getMessage()); |
|  |  | } |
|  |  | } |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `cb1d656`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fgeosolutions-it%2Fjai-ext%2Fcommit%2Fcb1d6565d38954676b0a366da4f965fef38da1cb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


