=== Content from git.kernel.org_039a328c_20250111_012535.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:28:29 +0200 |
| commit | [e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)) | |
| tree | [509127dcf86b6bd05c49dc14d971fa79bf2172b5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49) | |
| parent | [7bb11a75dd4d3612378b90e2a4aa49bdccea28ab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49&id2=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)) | |
| download | [linux-e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex 211360eee95a0f..a9cb04043f08ed 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=e1e5e8ea2731150d5ba7c707f9e02fafebcfeb49)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:12 +0000



=== Content from git.kernel.org_6cb7e3f2_20250111_012534.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-22 17:34:26 +0800 |
| commit | [ddfcfeba891064b88bb844208b43bef2ef970f0c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)) | |
| tree | [523c08ee901098976cdac1d310f628661e265a17](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c) | |
| parent | [72fca8371f205d654f95b09cd023a71fd5307041](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=72fca8371f205d654f95b09cd023a71fd5307041) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c&id2=72fca8371f205d654f95b09cd023a71fd5307041)) | |
| download | [linux-ddfcfeba891064b88bb844208b43bef2ef970f0c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ddfcfeba891064b88bb844208b43bef2ef970f0c.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathThe probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=ddfcfeba891064b88bb844208b43bef2ef970f0c) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex 211360eee95a0f..a9cb04043f08ed 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=72fca8371f205d654f95b09cd023a71fd5307041)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=ddfcfeba891064b88bb844208b43bef2ef970f0c)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:11 +0000



=== Content from git.kernel.org_822e95f7_20250111_012533.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:13:09 +0200 |
| commit | [b0979a885b9d4df2a25b88e9d444ccaa5f9f495c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)) | |
| tree | [148550fb2c244a702400fbf06cce5cb7bf6de736](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c) | |
| parent | [eca3f543f817da87c00d1a5697b473efb548204f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eca3f543f817da87c00d1a5697b473efb548204f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c&id2=eca3f543f817da87c00d1a5697b473efb548204f)) | |
| download | [linux-b0979a885b9d4df2a25b88e9d444ccaa5f9f495c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b0979a885b9d4df2a25b88e9d444ccaa5f9f495c.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex 16081383c401c9..6127505770cec1 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=eca3f543f817da87c00d1a5697b473efb548204f)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=b0979a885b9d4df2a25b88e9d444ccaa5f9f495c)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -296,8 +293,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:11 +0000



=== Content from git.kernel.org_b74c4a74_20250111_012532.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1de989668708ce5875efc9d669d227212aeb9a90)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1de989668708ce5875efc9d669d227212aeb9a90)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1de989668708ce5875efc9d669d227212aeb9a90)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1de989668708ce5875efc9d669d227212aeb9a90)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:30:14 +0200 |
| commit | [1de989668708ce5875efc9d669d227212aeb9a90](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1de989668708ce5875efc9d669d227212aeb9a90) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1de989668708ce5875efc9d669d227212aeb9a90)) | |
| tree | [0bc765b883691daeea7244e84fd41280cb5381d6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1de989668708ce5875efc9d669d227212aeb9a90) | |
| parent | [e23f6ad8d110bf632f7471482e10b43dc174fb72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1de989668708ce5875efc9d669d227212aeb9a90&id2=e23f6ad8d110bf632f7471482e10b43dc174fb72)) | |
| download | [linux-1de989668708ce5875efc9d669d227212aeb9a90.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1de989668708ce5875efc9d669d227212aeb9a90.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1de989668708ce5875efc9d669d227212aeb9a90)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=1de989668708ce5875efc9d669d227212aeb9a90) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex 211360eee95a0f..a9cb04043f08ed 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=1de989668708ce5875efc9d669d227212aeb9a90)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:09 +0000



=== Content from git.kernel.org_25fc9121_20250111_012532.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:25:03 +0200 |
| commit | [4c6735299540f3c82a5033d35be76a5c42e0fb18](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)) | |
| tree | [3b41c215d5a1b8fb714aea06dee14915afed2f2d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18) | |
| parent | [2189fd13c577d7881f94affc09c950a795064c4b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2189fd13c577d7881f94affc09c950a795064c4b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18&id2=2189fd13c577d7881f94affc09c950a795064c4b)) | |
| download | [linux-4c6735299540f3c82a5033d35be76a5c42e0fb18.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4c6735299540f3c82a5033d35be76a5c42e0fb18.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=4c6735299540f3c82a5033d35be76a5c42e0fb18) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex fea5290de83fb5..378a6ada015f3b 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=2189fd13c577d7881f94affc09c950a795064c4b)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=4c6735299540f3c82a5033d35be76a5c42e0fb18)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:09 +0000



=== Content from git.kernel.org_ba94b345_20250111_012535.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:15:04 +0200 |
| commit | [f3498650df0805c75b4e1c94d07423c46cbf4ce1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)) | |
| tree | [1f4b300f66a1bcb933a1e19a2431aeb9690c981d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1) | |
| parent | [d2afc2bffec77316b90d530b07695e3f534df914](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d2afc2bffec77316b90d530b07695e3f534df914) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1&id2=d2afc2bffec77316b90d530b07695e3f534df914)) | |
| download | [linux-f3498650df0805c75b4e1c94d07423c46cbf4ce1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f3498650df0805c75b4e1c94d07423c46cbf4ce1.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex c682420f25ca97..17b6d80babd060 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=d2afc2bffec77316b90d530b07695e3f534df914)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=f3498650df0805c75b4e1c94d07423c46cbf4ce1)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:12 +0000



=== Content from git.kernel.org_da8aa236_20250111_012531.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:23:41 +0200 |
| commit | [060f41243ad7f6f5249fa7290dda0c01f723d12d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)) | |
| tree | [42cb99f40d52d1178fb121764f25790ec997dcdb](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d) | |
| parent | [111277b881def3153335acfe0d1f43e6cd83ac93](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=111277b881def3153335acfe0d1f43e6cd83ac93) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d&id2=111277b881def3153335acfe0d1f43e6cd83ac93)) | |
| download | [linux-060f41243ad7f6f5249fa7290dda0c01f723d12d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-060f41243ad7f6f5249fa7290dda0c01f723d12d.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=060f41243ad7f6f5249fa7290dda0c01f723d12d) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex 166b5bde45cbc8..f1775ca5e3e816 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=111277b881def3153335acfe0d1f43e6cd83ac93)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=060f41243ad7f6f5249fa7290dda0c01f723d12d)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:08 +0000



=== Content from git.kernel.org_8e56eefe_20250111_012533.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org> | 2024-08-14 11:39:56 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:17:47 +0200 |
| commit | [6aee4c5635d81f4809c3b9f0c198a65adfbb2ada](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)) | |
| tree | [be534ecccbf3747bcdea75e44392ab4267c610c2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada) | |
| parent | [b72da4d89b97da71e056cc4d1429b2bc426a9c2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada&id2=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)) | |
| download | [linux-6aee4c5635d81f4809c3b9f0c198a65adfbb2ada.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6aee4c5635d81f4809c3b9f0c198a65adfbb2ada.tar.gz) | |

usb: dwc3: st: fix probed platform device ref count on probe error pathcommit ddfcfeba891064b88bb844208b43bef2ef970f0c upstream.
The probe function never performs any paltform device allocation, thus
error path "undo\_platform\_dev\_alloc" is entirely bogus. It drops the
reference count from the platform device being probed. If error path is
triggered, this will lead to unbalanced device reference counts and
premature release of device resources, thus possible use-after-free when
releasing remaining devm-managed resources.
Fixes: f83fca0707c6 ("usb: dwc3: add ST dwc3 glue layer to manage dwc3 HC")
Cc: stable@vger.kernel.org
Signed-off-by: Krzysztof Kozlowski <krzysztof.kozlowski@linaro.org>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Reviewed-by: Patrice Chotard <patrice.chotard@foss.st.com>
Link: [https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski@linaro.org](https://lore.kernel.org/r/20240814093957.37940-1-krzysztof.kozlowski%40linaro.org)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)

| -rw-r--r-- | [drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/dwc3-st.c?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 8 deletions

| diff --git a/drivers/usb/dwc3/dwc3-st.c b/drivers/usb/dwc3/dwc3-st.cindex e733be84054597..a150855b4b05e8 100644--- a/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)+++ b/[drivers/usb/dwc3/dwc3-st.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/dwc3-st.c?id=6aee4c5635d81f4809c3b9f0c198a65adfbb2ada)@@ -219,10 +219,8 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) dwc3\_data->regmap = regmap;  res = platform\_get\_resource\_byname(pdev, IORESOURCE\_MEM, "syscfg-reg");- if (!res) {- ret = -ENXIO;- goto undo\_platform\_dev\_alloc;- }+ if (!res)+ return -ENXIO;  dwc3\_data->syscfg\_reg\_off = res->start; @@ -233,8 +231,7 @@ static int st\_dwc3\_probe(struct platform\_device \*pdev) devm\_reset\_control\_get\_exclusive(dev, "powerdown"); if (IS\_ERR(dwc3\_data->rstc\_pwrdn)) { dev\_err(&pdev->dev, "could not get power controller\n");- ret = PTR\_ERR(dwc3\_data->rstc\_pwrdn);- goto undo\_platform\_dev\_alloc;+ return PTR\_ERR(dwc3\_data->rstc\_pwrdn); }  /\* Manage PowerDown \*/@@ -300,8 +297,6 @@ undo\_softreset: reset\_control\_assert(dwc3\_data->rstc\_rst); undo\_powerdown: reset\_control\_assert(dwc3\_data->rstc\_pwrdn);-undo\_platform\_dev\_alloc:- platform\_device\_put(pdev); return ret; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:24:10 +0000


