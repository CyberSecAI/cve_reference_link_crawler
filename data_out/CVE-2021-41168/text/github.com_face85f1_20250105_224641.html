
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Freddit%2Fsnudown%2Fsecurity%2Fadvisories%2FGHSA-6gvv-9q92-w5f6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Freddit%2Fsnudown%2Fsecurity%2Fadvisories%2FGHSA-6gvv-9q92-w5f6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=reddit%2Fsnudown)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[reddit](/reddit)
/
**[snudown](/reddit/snudown)**
Public

* [Notifications](/login?return_to=%2Freddit%2Fsnudown) You must be signed in to change notification settings
* [Fork
  80](/login?return_to=%2Freddit%2Fsnudown)
* [Star
   181](/login?return_to=%2Freddit%2Fsnudown)

* [Code](/reddit/snudown)
* [Issues
  9](/reddit/snudown/issues)
* [Pull requests
  13](/reddit/snudown/pulls)
* [Actions](/reddit/snudown/actions)
* [Security](/reddit/snudown/security)
* [Insights](/reddit/snudown/pulse)

Additional navigation options

* [Code](/reddit/snudown)
* [Issues](/reddit/snudown/issues)
* [Pull requests](/reddit/snudown/pulls)
* [Actions](/reddit/snudown/actions)
* [Security](/reddit/snudown/security)
* [Insights](/reddit/snudown/pulse)

# Hash-Collision Denial-of-Service Vulnerability in Reference Table

Moderate

[sp3nx0r](/sp3nx0r)
published
GHSA-6gvv-9q92-w5f6
Oct 21, 2021

## Package

pip

snudown
([pip](/advisories?query=ecosystem%3Apip))

## Affected versions

<1.7.0

## Patched versions

1.7.0

## Description

## Summary:

We have found three bugs in Reddit's [markdown parser](https://github.com/reddit/snudown). Two of these bugs are exploitable to launch an algorithmic complexity denial-of-service (DoS) attack. In this report we explain the bugs and exploits. We also show, in a non-disruptive way, that it appears to exist in the current version of Reddit.

## Context:

Reddit uses a markdown parser to convert markdown text into HTML text. Among the features that markdown text provides, is the ability to define and use named references. In markdown a reference is defined with the following syntax:

`[reference_name]: https://www.example.com`

A reference can be used with the following syntax:

`[reference_name]`

The resulting HTML text, will contain a link to `https://www.example.com` with the text `reference_name`:

`<a href="https://www.example.com/">reference_name</a>`

In the backend, this feature is implemented with a hash table data structure that maps the reference name (the key) to the associated URL (the value). When a reference is defined, a hash function is used to convert the reference name into an integer (the hash value), which is mapped to an index in an array, by taking the modulus with the array length. The reference is inserted in the array at this index ([code](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L188)). As there may be references with different names but identical hash values (known as collisions) a linked list is kept at each index in the array. Each collision is inserted at the start of the linked list at the index it maps to.

When a reference is used, the hash value and array index are calculated again. Then, the linked list is iterated until a reference with an identical hash value is found ([code](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L205)).

(Note: This behavior is faulty, see Bug 3).

## Bugs:

### Bug 1: The hash table uses a weak hash function

The hash function for the reference hash table is implemented in a function named [hash\_link\_ref](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L176). This is a case-insensitive version of the [SDBM hash function](https://github.com/davidar/sdbm/blob/29d5ed2b5297e51125ee45f6efc5541851aab0fb/hash.c#L19). This is a weak hash function, meaning that an attacker can reliably generate a large number of collisions for it. This makes the hash table vulnerable to a [hash-collision DoS attack](https://en.wikipedia.org/wiki/Collision_attack), a type of algorithmic complexity attack. In this attack, an attacker inserts a large number of collisions into the hash table. All these references will be put into the same linked list, increasing its length. Then, when a reference is used, a very large linked list needs to be iterated to find the correct entry. As a result, the time to retrieve a reference increases linearly with the number of colliding entries (O(N), where N is the number of colliding entries). This is considered an algorithmic complexity vulnerability, as the expected behavior of a hash table is to have constant time retrieval and insertion (O(1), i.e. the retrieval and insertion time are unaffected by the number of entries in the table). These vulnerabilities can be exploited in [DoS attacks](https://www.acunetix.com/vulnerabilities/web/php-hash-collision-denial-of-service-vulnerability/).

We show a proof-of-concept exploit for this vulnerability in the Proof-of-Concepts section.

### Bug 2: The hash table allows duplicate entries

Typically, a hash table only allows unique keys. While allowing duplicate keys improves the insertion time (to O(1)) ([code](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L188)), it leaves the hash table vulnerable to a different algorithmic complexity attack. This attack is similar to the attack on Bug 1, but is simpler to execute, because it does not require many colliding entries. Instead, an attacker can create a long linked list with duplicate entries and trigger long retrieval time by using the reference associated with the last entry in the linked list. (This will be the first defined reference, as each definition is inserted at the start of the linked list)

We show a proof-of-concept exploit for this vulnerability in the Proof-of-Concepts section.

### Bug 3: The hash table determines key equality on hash value alone

In the hash table implementation, when a reference name is used, an entry in the hash table is retrieved by searching for a reference with the same hash value ([code](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L213)). This behavior is incorrect. Since there are more possible distinct reference names than hash values, there are necessarily different reference names with the same hash value (by the pigeonhole principle). This means, an incorrect reference may be retrieved for a reference name. For example, with respect to the SDBM hash function, the input strings `37qpypz` and `uvhisfu` collide, as they both produce the hash value `7150400`. Therefore, defining and using two references with these names:

```
Link 1: [37qpypz]
Link 2: [uvhisfu]
[37qpypz]: http://www.url1.com
[uvhisfu]: http://www.url2.com
```

Will result in the second URL being retrieved for both references, which leads to the HTML text:

```
Link 1: <a href="https://www.url2.com/">37qpypz</a>
Link 2: <a href="https://www.url2.com/">uvhisfu</a>
```

This bug cannot be exploited to perform malicious actions (as far as we know), but it is useful to show that the current version of Reddit is still vulnerable to attacks on Bugs 1 and 2.

## Proof-of-Concepts:

To illustrate the vulnerabilities caused by Bugs 1 and 2, respectively, we will measure the time it takes for the markdown parser (running locally) to parse both random and malicious reference names in markdown text. The markdown text will be formatted as follows:

```
[s1]: /url
[s1]
[s2]: /url
[s1]
[s3]: /url
[s1]
...
[sN]: /url
[s1]
```

Each string `si` is a reference name generated either randomly or in a specific way to exploit either Bug 1 or 2. We will measure the parsing time while increasing `N` to show that it grows faster for the malicious input than for the random input. The reason for this is:

Each pair

```
[si]: /url
[s1]
```

contains both a reference definition and a use. Each definition will insert a new entry into the hash table and the use will retrieve the first defined reference from the table. For malicious input, every definition will insert a reference at the start of the same linked list as the first defined reference. This means, every time we use the first defined reference after a new definition, a longer linked list will need to be iterated to retrieve it.

Conversely, for random reference names, each definition will insert the reference into a random linked list in the hash table. If the randomly named reference is not inserted into the same linked list as the first defined reference, the time to retrieve the latter will be unaffected. Therefore, we expect to observe a much faster growth in parsing time for malicious input than for random input. Note, we will still observe an increase in retrieval time for randomly named references, due to randomly occurring collisions. We perform these experiments and plot the input size (x-axis) against the parsing time (y-axis). We show the graph below, which illustrates the expected behavior.

[![snudown_poc_plot](https://user-images.githubusercontent.com/2248306/137247978-03ad0b7a-963c-4960-8462-457fee9b15a2.jpg)](https://user-images.githubusercontent.com/2248306/137247978-03ad0b7a-963c-4960-8462-457fee9b15a2.jpg)

Next, we explain how we generate malicious input for both attacks on Bug 1 and Bug 2.

That is, how we generate `s1`, `s2`, ... , `sN`.

### Bug 1:

In the typical hash-collision DoS attack, one would simply generate a large number of collisions for the hash function. However, due to Bug 3, this will not work in this case, since the first item in the linked list will be returned (in time O(1)) as it has the same hash value.

Therefore, instead, we find many non-colliding strings, `s1`, `s2`, ..., `sN` such that:

`hash(si) != hash(sj)` when `i != j`, but `(hash(si) % T) == (hash(sj) % T)` for all `i` and `j`,

where `T` is the hash table size. In other words, each string has a unique hash value, but they are all still inserted into the same linked list, because they map to the same table index after taking the modulus with the table size.

### Bug 2:

Generating malicious input to exploit Bug 2 is significantly easier. We only find two strings `s’` and `s’’` such that

`hash(s’) != hash(s’’)` but `(hash(s’) % T) == (hash(s’’) % T)`

Then, let `s1 = s’` and `s2 = s’’`, `s3 = s’’`, ..., `sN = s’’`. Since the hash table does not prevent us from entering string `s’’` multiple times, we can increase the linked list length by reusing the same string.

## Steps to Reproduce:

Since DoS attacks are out of scope for Reddit's bug bounty program, we need a non-disruptive way to show that the bugs exist in the current version of Reddit. To this end, we use Bug 3. Since the hash table considers reference names with the same hash value to be equal, the first entry in the linked list with the correct hash value will be returned. We can confirm that SDBM hash is used by the current version, by using a small number of colliding reference names, each with a unique URL, and observing the generated HTML text. If SDBM hash is indeed used, the use of any of these references will incorrectly yield the final URL (as this is first in the linked list).

We show the setup and outcome of this experiment. In the first image, we show the markdown text we use in a private message. Note that each of the reference names point to a different URL. Each of the reference names we use collide with respect to the SDBM hash function.

[![snudown_bug3_msg_markdown](https://user-images.githubusercontent.com/2248306/137248455-e10acb31-4421-454b-9a7d-c7af49c2e37d.png)](https://user-images.githubusercontent.com/2248306/137248455-e10acb31-4421-454b-9a7d-c7af49c2e37d.png)

In the second image, we show the HTML text of the received private message, created from the markdown text. It is clear that the same URL (`https://www.example.com/10`) was retrieved, regardless of which reference name was requested. This is the incorrect behavior we expect if SDBM hash is used, which means Bug 1 exists in the current version of Reddit.

[![snudown_bug3_msg_html](https://user-images.githubusercontent.com/2248306/137248499-a58990a2-871f-44a1-9eae-cc6e49c6a6e5.png)](https://user-images.githubusercontent.com/2248306/137248499-a58990a2-871f-44a1-9eae-cc6e49c6a6e5.png)

### Patches

There are do not appear to be any official patches, but we will suggest a few fixes in this advisory.

### Suggested Fixes

#### Bug 1: The hash table uses a weak hash function

Bug 1 can be patched by replacing the SDBM hash function with a more secure, keyed hash function. A number of hash functions were created to mitigate hash-collision DoS vulnerabilities, such as [HighwayHash](https://github.com/google/highwayhash) and [SipHash](https://github.com/veorq/SipHash).

##### Requirements:

* The [current hash function](https://github.com/reddit/snudown/blob/b5ade1a697b48c7893fbbbde3d708ed9bb111f29/src/markdown.c#L176) converts reference labels to lower case while computing a hash value, to achieve case insensitivity. The replacement hash function should also compute case insensitive hash values.

#### Bug 2: The hash table allows duplicate entries

Bug 2 can be patched by updating the function that inserts references into the hash table. After retrieving the correct linked list to insert the new reference into, this linked list should first be iterated to ensure the same reference does not already exist therein.

##### Requirements:

* What the hash table considers to be the same reference should also be updated (see Suggested Fixes for Bug 3).

#### Bug 3: The hash table determines key equality on hash value alone

When iterating the linked list to determine if a reference exists in it, the reference labels should be compared, not only the hash values.

##### Requirements:

* Two reference labels should be compared in a case insensitive manner, to match the behavior of the hash function.

## Attachments:

We have some files that allow one to build the markdown parser and test proof-of-concept exploits for Bug 1 and 2 locally.

However, I can't seem to attach ZIP archives to this advisory

## Impact

If one, or more, attackers repeatedly force a server to parse maliciously crafted markdown text using Snudown, it may significantly impact the availability of the server and even lead to DoS.

### Severity

Moderate

### CVE ID

CVE-2021-41168

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20) [CWE-327](/advisories?query=cwe%3A327)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

