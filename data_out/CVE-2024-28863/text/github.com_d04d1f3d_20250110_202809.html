
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fisaacs%2Fnode-tar%2Fcommit%2Ffe8cd57da5686f8695415414bda49206a545f7f7)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fisaacs%2Fnode-tar%2Fcommit%2Ffe8cd57da5686f8695415414bda49206a545f7f7)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=isaacs%2Fnode-tar)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[isaacs](/isaacs)
/
**[node-tar](/isaacs/node-tar)**
Public

* [Notifications](/login?return_to=%2Fisaacs%2Fnode-tar) You must be signed in to change notification settings
* [Fork
  185](/login?return_to=%2Fisaacs%2Fnode-tar)
* [Star
   849](/login?return_to=%2Fisaacs%2Fnode-tar)

* [Code](/isaacs/node-tar)
* [Issues
  11](/isaacs/node-tar/issues)
* [Pull requests
  5](/isaacs/node-tar/pulls)
* [Actions](/isaacs/node-tar/actions)
* [Projects
  0](/isaacs/node-tar/projects)
* [Security](/isaacs/node-tar/security)
* [Insights](/isaacs/node-tar/pulse)

Additional navigation options

* [Code](/isaacs/node-tar)
* [Issues](/isaacs/node-tar/issues)
* [Pull requests](/isaacs/node-tar/pulls)
* [Actions](/isaacs/node-tar/actions)
* [Projects](/isaacs/node-tar/projects)
* [Security](/isaacs/node-tar/security)
* [Insights](/isaacs/node-tar/pulse)

## Commit

[Permalink](/isaacs/node-tar/commit/fe8cd57da5686f8695415414bda49206a545f7f7)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

prevent extraction in excessively deep subfolders

[Browse files](/isaacs/node-tar/tree/fe8cd57da5686f8695415414bda49206a545f7f7)
Browse the repository at this point in the history

```
This sets the limit at 1024 subfolders nesting by default, but that can
be dropped down, or set to Infinity to remove the limitation.
```

* Loading branch information

[![@isaacs](https://avatars.githubusercontent.com/u/9287?s=40&v=4)](/isaacs)

[isaacs](/isaacs/node-tar/commits?author=isaacs "View all commits by isaacs")
committed
Mar 21, 2024

1 parent
[fe7ebfd](/isaacs/node-tar/commit/fe7ebfdcede1f8a2e65db12e19ecc4b3a9934648)

commit fe8cd57

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**94 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* README.md
  [README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5)
* lib

  + lib/unpack.js
    [unpack.js](#diff-682ef7fe2161a23a989c424f393669bb693cfc26aecafcb25c96cf89ac62704a)
* test

  + fixtures

    - test/fixtures/excessively-deep.tar
      [excessively-deep.tar](#diff-d9454c24df019ee093cf08c8619db699b3b3802eb3eca807f49932fbec862229)
  + test/parse.js
    [parse.js](#diff-b266c4cbb2cefa3caf90e138f935e3cf489c6655e84c1ca9d0425bb0d9af9cc6)
  + test/unpack.js
    [unpack.js](#diff-40f53dc6ccb54435d4091df2f9075238030637302728d613eb65bb44121c97bc)

## There are no files selected for viewing

10 changes: 10 additions & 0 deletions

10
[README.md](#diff-b335630551682c19a781afebcf4d07bf978fb1f8ac04c6bf87428ed5106870f5 "README.md")

Show comments

[View file](/isaacs/node-tar/blob/fe8cd57da5686f8695415414bda49206a545f7f7/README.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -115,6 +115,8 @@ Handlers receive 3 arguments: |
|  |  | encountered an error which prevented it from being unpacked. This occurs |
|  |  | when: |
|  |  | - an unrecoverable fs error happens during unpacking, |
|  |  | - an entry is trying to extract into an excessively deep |
|  |  | location (by default, limited to 1024 subfolders), |
|  |  | - an entry has `..` in the path and `preservePaths` is not set, or |
|  |  | - an entry is extracting through a symbolic link, when `preservePaths` is |
|  |  | not set. |
| Expand Down  Expand Up | | @@ -427,6 +429,10 @@ The following options are supported: |
|  |  | `process.umask()` to determine the default umask value, since tar will |
|  |  | extract with whatever mode is provided, and let the process `umask` apply |
|  |  | normally. |
|  |  | - `maxDepth` The maximum depth of subfolders to extract into. This |
|  |  | defaults to 1024. Anything deeper than the limit will raise a |
|  |  | warning and skip the entry. Set to `Infinity` to remove the |
|  |  | limitation. |
|  |  |  |
|  |  | The following options are mostly internal, but can be modified in some |
|  |  | advanced use cases, such as re-using caches between runs. |
| Expand Down  Expand Up | | @@ -749,6 +755,10 @@ Most unpack errors will cause a `warn` event to be emitted. If the |
|  |  | `process.umask()` to determine the default umask value, since tar will |
|  |  | extract with whatever mode is provided, and let the process `umask` apply |
|  |  | normally. |
|  |  | - `maxDepth` The maximum depth of subfolders to extract into. This |
|  |  | defaults to 1024. Anything deeper than the limit will raise a |
|  |  | warning and skip the entry. Set to `Infinity` to remove the |
|  |  | limitation. |
|  |  |  |
|  |  | ### class tar.Unpack.Sync |
|  |  |  |
| Expand Down | |  |

27 changes: 22 additions & 5 deletions

27
[lib/unpack.js](#diff-682ef7fe2161a23a989c424f393669bb693cfc26aecafcb25c96cf89ac62704a "lib/unpack.js")

Show comments

[View file](/isaacs/node-tar/blob/fe8cd57da5686f8695415414bda49206a545f7f7/lib/unpack.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -48,6 +48,7 @@ const crypto = require('crypto') |
|  |  | const getFlag = require('./get-write-flag.js') |
|  |  | const platform = process.env.TESTING\_TAR\_FAKE\_PLATFORM || process.platform |
|  |  | const isWindows = platform === 'win32' |
|  |  | const DEFAULT\_MAX\_DEPTH = 1024 |
|  |  |  |
|  |  | // Unlinks on Windows are not atomic. |
|  |  | // |
| Expand Down  Expand Up | | @@ -181,6 +182,12 @@ class Unpack extends Parser { |
|  |  | this.processGid = (this.preserveOwner || this.setOwner) && process.getgid ? |
|  |  | process.getgid() : null |
|  |  |  |
|  |  | // prevent excessively deep nesting of subfolders |
|  |  | // set to `Infinity` to remove this restriction |
|  |  | this.maxDepth = typeof opt.maxDepth === 'number' |
|  |  | ? opt.maxDepth |
|  |  | : DEFAULT\_MAX\_DEPTH |
|  |  |  |
|  |  | // mostly just for testing, but useful in some cases. |
|  |  | // Forcibly trigger a chown on every entry, no matter what |
|  |  | this.forceChown = opt.forceChown === true |
| Expand Down  Expand Up | | @@ -238,13 +245,13 @@ class Unpack extends Parser { |
|  |  | } |
|  |  |  |
|  |  | [CHECKPATH] (entry) { |
|  |  | const p = normPath(entry.path) |
|  |  | const parts = p.split('/') |
|  |  |  |
|  |  | if (this.strip) { |
|  |  | const parts = normPath(entry.path).split('/') |
|  |  | if (parts.length < this.strip) { |
|  |  | return false |
|  |  | } |
|  |  | entry.path = parts.slice(this.strip).join('/') |
|  |  |  |
|  |  | if (entry.type === 'Link') { |
|  |  | const linkparts = normPath(entry.linkpath).split('/') |
|  |  | if (linkparts.length >= this.strip) { |
| Expand All | | @@ -253,11 +260,21 @@ class Unpack extends Parser { |
|  |  | return false |
|  |  | } |
|  |  | } |
|  |  | parts.splice(0, this.strip) |
|  |  | entry.path = parts.join('/') |
|  |  | } |
|  |  |  |
|  |  | if (isFinite(this.maxDepth) && parts.length > this.maxDepth) { |
|  |  | this.warn('TAR\_ENTRY\_ERROR', 'path excessively deep', { |
|  |  | entry, |
|  |  | path: p, |
|  |  | depth: parts.length, |
|  |  | maxDepth: this.maxDepth, |
|  |  | }) |
|  |  | return false |
|  |  | } |
|  |  |  |
|  |  | if (!this.preservePaths) { |
|  |  | const p = normPath(entry.path) |
|  |  | const parts = p.split('/') |
|  |  | if (parts.includes('..') || isWindows && /^[a-z]:\.\.$/i.test(parts[0])) { |
|  |  | this.warn('TAR\_ENTRY\_ERROR', `path contains '..'`, { |
|  |  | entry, |
| Expand Down | |  |

Binary file added
BIN
+440 KB

[test/fixtures/excessively-deep.tar](#diff-d9454c24df019ee093cf08c8619db699b3b3802eb3eca807f49932fbec862229 "test/fixtures/excessively-deep.tar")

Show comments

[View file](/isaacs/node-tar/blob/fe8cd57da5686f8695415414bda49206a545f7f7/test/fixtures/excessively-deep.tar)
Edit file

Delete file

Binary file not shown.

2 changes: 1 addition & 1 deletion

2
[test/parse.js](#diff-b266c4cbb2cefa3caf90e138f935e3cf489c6655e84c1ca9d0425bb0d9af9cc6 "test/parse.js")

Show comments

[View file](/isaacs/node-tar/blob/fe8cd57da5686f8695415414bda49206a545f7f7/test/parse.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -646,7 +646,7 @@ t.test('truncated gzip input', t => { |
|  |  | p.write(tgz.slice(split)) |
|  |  | p.end() |
|  |  | t.equal(aborted, true, 'aborted writing') |
|  |  | t.same(warnings, ['zlib: incorrect data check']) |
|  |  | t.match(warnings, [/^zlib: /]) |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
| Expand Down | |  |

61 changes: 61 additions & 0 deletions

61
[test/unpack.js](#diff-40f53dc6ccb54435d4091df2f9075238030637302728d613eb65bb44121c97bc "test/unpack.js")

Show comments

[View file](/isaacs/node-tar/blob/fe8cd57da5686f8695415414bda49206a545f7f7/test/unpack.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -22,6 +22,7 @@ const mkdirp = require('mkdirp') |
|  |  | const mutateFS = require('mutate-fs') |
|  |  | const eos = require('end-of-stream') |
|  |  | const normPath = require('../lib/normalize-windows-path.js') |
|  |  | const ReadEntry = require('../lib/read-entry.js') |
|  |  |  |
|  |  | // On Windows in particular, the "really deep folder path" file |
|  |  | // often tends to cause problems, which don't indicate a failure |
| Expand Down  Expand Up | | @@ -3235,3 +3236,63 @@ t.test('recognize C:.. as a dot path part', t => { |
|  |  |  |
|  |  | t.end() |
|  |  | }) |
|  |  |  |
|  |  | t.test('excessively deep subfolder nesting', async t => { |
|  |  | const tf = path.resolve(fixtures, 'excessively-deep.tar') |
|  |  | const data = fs.readFileSync(tf) |
|  |  | const warnings = [] |
|  |  | const onwarn = (c, w, { entry, path, depth, maxDepth }) => |
|  |  | warnings.push([c, w, { entry, path, depth, maxDepth }]) |
|  |  |  |
|  |  | const check = (t, maxDepth = 1024) => { |
|  |  | t.match(warnings, [ |
|  |  | ['TAR\_ENTRY\_ERROR', |
|  |  | 'path excessively deep', |
|  |  | { |
|  |  | entry: ReadEntry, |
|  |  | path: /^\.(\/a){1024,}\/foo.txt$/, |
|  |  | depth: 222372, |
|  |  | maxDepth, |
|  |  | } |
|  |  | ] |
|  |  | ]) |
|  |  | warnings.length = 0 |
|  |  | t.end() |
|  |  | } |
|  |  |  |
|  |  | t.test('async', t => { |
|  |  | const cwd = t.testdir() |
|  |  | new Unpack({ |
|  |  | cwd, |
|  |  | onwarn |
|  |  | }).on('end', () => check(t)).end(data) |
|  |  | }) |
|  |  |  |
|  |  | t.test('sync', t => { |
|  |  | const cwd = t.testdir() |
|  |  | new UnpackSync({ |
|  |  | cwd, |
|  |  | onwarn |
|  |  | }).end(data) |
|  |  | check(t) |
|  |  | }) |
|  |  |  |
|  |  | t.test('async set md', t => { |
|  |  | const cwd = t.testdir() |
|  |  | new Unpack({ |
|  |  | cwd, |
|  |  | onwarn, |
|  |  | maxDepth: 64, |
|  |  | }).on('end', () => check(t, 64)).end(data) |
|  |  | }) |
|  |  |  |
|  |  | t.test('sync set md', t => { |
|  |  | const cwd = t.testdir() |
|  |  | new UnpackSync({ |
|  |  | cwd, |
|  |  | onwarn, |
|  |  | maxDepth: 64, |
|  |  | }).end(data) |
|  |  | check(t, 64) |
|  |  | }) |
|  |  | }) |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `fe8cd57`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fisaacs%2Fnode-tar%2Fcommit%2Ffe8cd57da5686f8695415414bda49206a545f7f7) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

