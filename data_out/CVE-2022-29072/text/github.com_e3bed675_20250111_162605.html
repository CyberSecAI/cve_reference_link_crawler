
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkagancapar%2FCVE-2022-29072)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fkagancapar%2FCVE-2022-29072)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=kagancapar%2FCVE-2022-29072)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[kagancapar](/kagancapar)
/
**[CVE-2022-29072](/kagancapar/CVE-2022-29072)**
Public

* [Notifications](/login?return_to=%2Fkagancapar%2FCVE-2022-29072) You must be signed in to change notification settings
* [Fork
  105](/login?return_to=%2Fkagancapar%2FCVE-2022-29072)
* [Star
   686](/login?return_to=%2Fkagancapar%2FCVE-2022-29072)

7-Zip through 21.07 on Windows allows privilege escalation and command execution when a file with the .7z extension is dragged to the Help>Contents area.

### License

[GPL-3.0 license](/kagancapar/CVE-2022-29072/blob/main/LICENSE)

[686
stars](/kagancapar/CVE-2022-29072/stargazers) [105
forks](/kagancapar/CVE-2022-29072/forks) [Branches](/kagancapar/CVE-2022-29072/branches) [Tags](/kagancapar/CVE-2022-29072/tags) [Activity](/kagancapar/CVE-2022-29072/activity)
 [Star](/login?return_to=%2Fkagancapar%2FCVE-2022-29072)

 [Notifications](/login?return_to=%2Fkagancapar%2FCVE-2022-29072) You must be signed in to change notification settings

* [Code](/kagancapar/CVE-2022-29072)
* [Issues
  11](/kagancapar/CVE-2022-29072/issues)
* [Pull requests
  0](/kagancapar/CVE-2022-29072/pulls)
* [Actions](/kagancapar/CVE-2022-29072/actions)
* [Projects
  0](/kagancapar/CVE-2022-29072/projects)
* [Security](/kagancapar/CVE-2022-29072/security)
* [Insights](/kagancapar/CVE-2022-29072/pulse)

Additional navigation options

* [Code](/kagancapar/CVE-2022-29072)
* [Issues](/kagancapar/CVE-2022-29072/issues)
* [Pull requests](/kagancapar/CVE-2022-29072/pulls)
* [Actions](/kagancapar/CVE-2022-29072/actions)
* [Projects](/kagancapar/CVE-2022-29072/projects)
* [Security](/kagancapar/CVE-2022-29072/security)
* [Insights](/kagancapar/CVE-2022-29072/pulse)

# kagancapar/CVE-2022-29072

    main[Branches](/kagancapar/CVE-2022-29072/branches)[Tags](/kagancapar/CVE-2022-29072/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[21 Commits](/kagancapar/CVE-2022-29072/commits/main/) | | |
| [command-exec-basic-7zip](/kagancapar/CVE-2022-29072/tree/main/command-exec-basic-7zip "command-exec-basic-7zip") | | [command-exec-basic-7zip](/kagancapar/CVE-2022-29072/tree/main/command-exec-basic-7zip "command-exec-basic-7zip") |  |  |
| [privilege-escalation-7zip](/kagancapar/CVE-2022-29072/tree/main/privilege-escalation-7zip "privilege-escalation-7zip") | | [privilege-escalation-7zip](/kagancapar/CVE-2022-29072/tree/main/privilege-escalation-7zip "privilege-escalation-7zip") |  |  |
| [xxe-basic-7zip](/kagancapar/CVE-2022-29072/tree/main/xxe-basic-7zip "xxe-basic-7zip") | | [xxe-basic-7zip](/kagancapar/CVE-2022-29072/tree/main/xxe-basic-7zip "xxe-basic-7zip") |  |  |
| [7z\_CVE-2022-29072.yml](/kagancapar/CVE-2022-29072/blob/main/7z_CVE-2022-29072.yml "7z_CVE-2022-29072.yml") | | [7z\_CVE-2022-29072.yml](/kagancapar/CVE-2022-29072/blob/main/7z_CVE-2022-29072.yml "7z_CVE-2022-29072.yml") |  |  |
| [LICENSE](/kagancapar/CVE-2022-29072/blob/main/LICENSE "LICENSE") | | [LICENSE](/kagancapar/CVE-2022-29072/blob/main/LICENSE "LICENSE") |  |  |
| [README.md](/kagancapar/CVE-2022-29072/blob/main/README.md "README.md") | | [README.md](/kagancapar/CVE-2022-29072/blob/main/README.md "README.md") |  |  |
| View all files | | |

## Repository files navigation

* README
* GPL-3.0 license
# INFORMATION

I haven't posted any poc code anywhere for privilege escalation attack. The poc codes found have nothing to do with privilege escalation. For your information.

# 7-zip hakkında

7-Zip, özgür ve ücretsiz bir dosya arşivleyicisidir. 7-Zip’in Komut İstemi sürümü Unix benzeri sistemler içinde düşünülmüş hatta AmigaOS bu saydıklarımıza dahil. Aynı zamanda DOS için de uyumlu Dost Portu için veya HX-DOS genişletişicisi ile Windows komut İstemcisi'nde çalıştırılabilir.

# CVE-2022-29072

Türkçe yazacağım biraz da siz Türkçe öğrenin.

Öncelikle zafiyeti bulma hikayeme değinmek istiyorum. WinRAR üzerinde XXE zafiyetini gerçekleştiren bir payload gördüm. Aynı zamanda HTML Helper dosyasının kullanarak javascript üzerinden ActiveXObject ve WScript.Shell sayesinde komut çalıştırmaya imkan sağlıyordu. Bunun lolbinlerde kullanılan HTA'dan hiç bir farkı yoktu olayı nasıl lehime döüştürebileceğimi düşündüm.

(<https://www.exploit-db.com/exploits/47526>)

Aslında amacım 7z, zip, rar vb sıkıştırma teknolojilerinin uzantılarına çift tıkladıktan sonra hedef bilgisayar üzerinden reverse-shell alabilmekti bunun içinde HTML Helper dosyasını kullanabilir miyim diye düşünüyordum. WinAFL ile uzun fuzzing işlemleri sonrası FzGM.exe üzerinde heap-overflow olduğunu keşfettim fakat heap overflow sonrası yetkim yine aynı kullanıcı üzerinden olacağından bir anlamı da yoktu. Bu yüzden CreateRemoteThread kullanmadım çünkü API'i çağırmam gerekiyordu ve bu API'i tetikleyebilmek için bir chm dosyasına ihtiyacım vardı. Kaynak kodu incelediğimde özellikle iki yerde Windows API'ını çağırırken hatalı işlemler olduğunu farkettim ve bu direk yetkilendirme problemi yaratıyordu. Bu keşfetme noktam aşağıdaki resim de görüldüğü üzere FzGM.exe altında bir child process oluşturuyor. Normalde bu işlemin hh.exe üzerinde olmasını bekleriz.

[![7-zip-1](https://user-images.githubusercontent.com/33525376/163989986-8f222b00-0080-49fc-b65c-ac93e5877525.png)](https://user-images.githubusercontent.com/33525376/163989986-8f222b00-0080-49fc-b65c-ac93e5877525.png)

[![api](https://user-images.githubusercontent.com/33525376/163990001-5af6890a-78c0-402a-8f35-23622e798893.png)](https://user-images.githubusercontent.com/33525376/163990001-5af6890a-78c0-402a-8f35-23622e798893.png)

Eğer API'ı include etmeyip fonksiyon üzerinden doğru yapılandırma işlemi olsaydı hh.exe altında child process oluşturmasını beklerdim fakat 7-zip.chm dosyası bunu kendi üzerinden çağırmaktadır tipik bir örneği 7-zip.chm dosyasını editleyip komut çalıştırma işlemi uygularsanız o zamanda görebilirsiniz. Heap overflow sonrası çağırılan API'nin yetkilendirme sorunu sonra 7z.dll dosyası içerisinde bulunan hatalı yapılandırmadan faydalandım ki bunun için uzun bir süredir uğraşıyorum. CreateRemoteThread() yapmanın bir anlamı yok. Benim payload'ın içerisinde çalıştırmam ve çağırmam gereken şey HTML Helper API'ın bizzat kendisi değil 7-zip üzerinden bu API'ın hook edildiği nokta ve o noktayı execute edebilmem fakat bu payload sadece hh.exe entegrasyonu ile çalıştığı için bu yüzden sürükle bırak gibi fonksiyon ile çalışmaktadır. 7-zip.chm dosyasının, 7-zip üzerinden HELP butonu ile çağırılması ve buraya çağırılan adresin payload içerisinde yetkilendirme sorunu görülen "base pointer" yönlendirmem bizi bir üst kullanıcıya taşımaktadır. Buradan sonraki işlem ise payload'ın içerisinde psexec'in bulunması ve psexec -s cmd.exe komutuyla nt authority/system olarak system yetkisine yükselmesidir.

[![7-zip-2](https://user-images.githubusercontent.com/33525376/163995536-b16db2f8-9493-4962-b4af-c4dfd4ca3f96.png)](https://user-images.githubusercontent.com/33525376/163995536-b16db2f8-9493-4962-b4af-c4dfd4ca3f96.png)

poc video:

priv1.mp4

# ActiveXObject bypass hakkında

Soruların bir çoğu da ActiveX uyarısı üzerineydi bu problemin en temel şöyle giderebilirsiniz. Payload çalışmadan önce;

<'HKCU:\SOFTWARE\Microsoft\Windows\CurrentVersion\Internet Settings\Zones\0' -Name '1201' -Value '0' -PropertyType "DWord"> kontrol sağlamaktadır eğer bu değeri 1 ise popup ekrana gelmektedir şayet 0 olarak yeni bir değer atandıysa bypass edilmektedir. Fakat belirtmek gerekirse ki o an hangi user payload'ı çalıştırıyorsa onu etkilemektedir.

# Önemli not

Ben gereken noktaları geliştiriciye söyledim ve CVE tarafından da bu kabul edildi. İnsanların kendini otorite zannetmesi ve onlara exploit'i vermem gerektiği gibi bir algı oluşmasına anlam veremiyorum. Ben zaten güncelleme sonrası yayınlayacağımı belirttiğim halde henüz update olmadan yapılan bu saygısızlık sanıyorum kendini otorite görmekten geçmektedir. Ben yetki yükseltme saldırısının poc kodunu hiçbir zaman yayınlamak istemeyebilirim bu benim hür irademdir ve bunun doğruluğu sorgulamak noktasında kimin ne düşündüğü ile zerre ilgilenmiyorum.

# Alınabilecek önlem

Birinci yöntem: Eğer 7-zip güncelleme geçmezse 7-zip.chm dosyasının silinmesi gerçekleştirilebilir.
İkinci yöntem: Program içerisinde yer alan tüm kullanıcılar read ve execute yetkisi ile erişim sağlamalıdır.

# Sigma kuralı

İlgili sigma kuralı <https://github.com/kagancapar/CVE-2022-29072/blob/main/7z_CVE-2022-29072.yml>

## About

7-Zip through 21.07 on Windows allows privilege escalation and command execution when a file with the .7z extension is dragged to the Help>Contents area.

### Resources

[Readme](#readme-ov-file)
### License

[GPL-3.0 license](#GPL-3.0-1-ov-file)

[Activity](/kagancapar/CVE-2022-29072/activity)
### Stars

[**686**
stars](/kagancapar/CVE-2022-29072/stargazers)
### Watchers

[**26**
watching](/kagancapar/CVE-2022-29072/watchers)
### Forks

[**105**
forks](/kagancapar/CVE-2022-29072/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fkagancapar%2FCVE-2022-29072&report=kagancapar+%28user%29)

## [Releases](/kagancapar/CVE-2022-29072/releases)

No releases published

## [Packages 0](/users/kagancapar/packages?repo_name=CVE-2022-29072)

No packages published

## [Contributors 2](/kagancapar/CVE-2022-29072/graphs/contributors)

## Languages

* [HTML
  100.0%](/kagancapar/CVE-2022-29072/search?l=html)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

