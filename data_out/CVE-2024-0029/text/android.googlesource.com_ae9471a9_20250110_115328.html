
Commit Information:
------------------
Author: Rubin Xu  1698845791 +0000
Date: Android Build Coastguard Worker  1701902637 +0000
Bug ID: Bug: 305664128
Commit Message:
--------------
Handle screen capture disabled state for multiple usersBefore this fix, the framework use one single integer to track screencapture disabled policy across the device. This can be either a realuserId, or the symbolic USER\_ALL or USER\_NULL for all users or no user.This has the problem that it can't represent policies from more thanone admin (or policies from both the admin and its parent). In addition,due to the way DevicePolicyManagerService refreshes policies, when anon-managed user is started, its default policy state overrides anyexisting policy, causing screen capture to be no longer disabled.Fix this by properly tracking the policy for each user in an set.We still use USER\_ALL in the set to represent screen capture beingdisabled for all users.In Android 14, the screen capture logic is migrated to policy enginewhich already contains this fix.Bug: 305664128Test: ScreenCaptureDisabledTestTest: FrameworksServicesTests:DevicePolicyManagerTestTest: DevicePolicyManagerServiceMigrationTestTest: MixedDeviceOwnerTest#testScreenCaptureDisabled\_assist MixedProfileOwnerTest#testScreenCaptureDisabled\_assist MixedManagedProfileOwnerTest#testScreenCaptureDisabled\_assistTest: MixedManagedProfileOwnerTest#testScreenCaptureDisabled\_assist\_allowedPrimaryUserTest: MixedDeviceOwnerTest#testCreateAdminSupportIntent MixedProfileOwnerTest#testCreateAdminSupportIntent MixedManagedProfileOwnerTest#testCreateAdminSupportIntent(cherry picked from https://googleplex-android-review.googlesource.com/q/commit:5f3db5ae9b9cf69c8a4ea73b6ed49ce9d49ba223)Merged-In: Ib016b740927003f8bd81992f24c722c29ac723b5Change-Id: Ib016b740927003f8bd81992f24c722c29ac723b5
