=== Content from github.com_7845ede3_20250111_151134.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcanonical%2Fubuntu-advantage-desktop-daemon%2Fpull%2F24)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fcanonical%2Fubuntu-advantage-desktop-daemon%2Fpull%2F24)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=canonical%2Fubuntu-advantage-desktop-daemon)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[canonical](/canonical)
/
**[ubuntu-advantage-desktop-daemon](/canonical/ubuntu-advantage-desktop-daemon)**
Public

* [Notifications](/login?return_to=%2Fcanonical%2Fubuntu-advantage-desktop-daemon) You must be signed in to change notification settings
* [Fork
  5](/login?return_to=%2Fcanonical%2Fubuntu-advantage-desktop-daemon)
* [Star
   3](/login?return_to=%2Fcanonical%2Fubuntu-advantage-desktop-daemon)

* [Code](/canonical/ubuntu-advantage-desktop-daemon)
* [Issues
  3](/canonical/ubuntu-advantage-desktop-daemon/issues)
* [Pull requests
  1](/canonical/ubuntu-advantage-desktop-daemon/pulls)
* [Actions](/canonical/ubuntu-advantage-desktop-daemon/actions)
* [Projects
  0](/canonical/ubuntu-advantage-desktop-daemon/projects)
* [Security](/canonical/ubuntu-advantage-desktop-daemon/security)
* [Insights](/canonical/ubuntu-advantage-desktop-daemon/pulse)

Additional navigation options

* [Code](/canonical/ubuntu-advantage-desktop-daemon)
* [Issues](/canonical/ubuntu-advantage-desktop-daemon/issues)
* [Pull requests](/canonical/ubuntu-advantage-desktop-daemon/pulls)
* [Actions](/canonical/ubuntu-advantage-desktop-daemon/actions)
* [Projects](/canonical/ubuntu-advantage-desktop-daemon/projects)
* [Security](/canonical/ubuntu-advantage-desktop-daemon/security)
* [Insights](/canonical/ubuntu-advantage-desktop-daemon/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fcanonical%2Fubuntu-advantage-desktop-daemon%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fcanonical%2Fubuntu-advantage-desktop-daemon%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# ua-tool: Pass the token via a private temporary attach config file #24

 Merged

[3v1n0](/3v1n0)
merged 7 commits into
[canonical:main](/canonical/ubuntu-advantage-desktop-daemon/tree/main "canonical/ubuntu-advantage-desktop-daemon:main")
from
[3v1n0:use-attach-config-for-token](/3v1n0/ubuntu-advantage-desktop-daemon/tree/use-attach-config-for-token "3v1n0/ubuntu-advantage-desktop-daemon:use-attach-config-for-token")

Jun 13, 2024

 Merged

# [ua-tool: Pass the token via a private temporary attach config file](#top) #24

[3v1n0](/3v1n0)
merged 7 commits into
[canonical:main](/canonical/ubuntu-advantage-desktop-daemon/tree/main "canonical/ubuntu-advantage-desktop-daemon:main")
from
[3v1n0:use-attach-config-for-token](/3v1n0/ubuntu-advantage-desktop-daemon/tree/use-attach-config-for-token "3v1n0/ubuntu-advantage-desktop-daemon:use-attach-config-for-token")

Jun 13, 2024

[Conversation
9](/canonical/ubuntu-advantage-desktop-daemon/pull/24)
[Commits
7](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits)
[Checks
3](/canonical/ubuntu-advantage-desktop-daemon/pull/24/checks)
[Files changed](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![3v1n0](https://avatars.githubusercontent.com/u/345675?s=60&v=4)](/3v1n0)

Copy link

Contributor

### @3v1n0 **[3v1n0](/3v1n0)** commented [Jun 11, 2024](#issue-2347339972) • edited Loading

```
We're currently calling the pro client with attach parameter in plain
text, but this leads to leaking such private information to any user in
the system (via simple ps).

So use a temporary file instead. This is safe because it's created by
default with -rw------- only permissions, so it won't be readable by
anyone else.

We could use an extra layer of protection saving it in the runtime
directory, but this is already enough.

LP: #2068944

```

UDENG-3188

Sorry, something went wrong.

All reactions

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
added
the
[bug](/canonical/ubuntu-advantage-desktop-daemon/labels/bug)
Something isn't working
label
[Jun 11, 2024](#event-13122949553)

 [![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
requested review from
[robert-ancell](/robert-ancell) and
[seb128](/seb128)
[June 11, 2024 21:28](#event-13122949561)

 [![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
[force-pushed](/canonical/ubuntu-advantage-desktop-daemon/compare/59bd0eda761f541d84d93bba61cdcef011a2bea6..fe86c2ef09332616f20739c74c31a21cf2360923)
the
use-attach-config-for-token

branch
4 times, most recently
from
[`59bd0ed`](/canonical/ubuntu-advantage-desktop-daemon/commit/59bd0eda761f541d84d93bba61cdcef011a2bea6) to
[`fe86c2e`](/canonical/ubuntu-advantage-desktop-daemon/commit/fe86c2ef09332616f20739c74c31a21cf2360923)  [Compare](/canonical/ubuntu-advantage-desktop-daemon/compare/59bd0eda761f541d84d93bba61cdcef011a2bea6..fe86c2ef09332616f20739c74c31a21cf2360923)
[June 11, 2024 23:38](#event-13123785865)

 [3v1n0](/3v1n0)
added 3 commits
[June 12, 2024 02:07](#commits-pushed-3b0a249)

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[meson: Warn when using functions not available in the glib version we…](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/3b0a2499f27a576d09449a2449b89b75a29f0963 "meson: Warn when using functions not available in the glib version we target")`
 …

`[3b0a249](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/3b0a2499f27a576d09449a2449b89b75a29f0963)`

```
… target
```

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[meson: Make tests depending on both the daemon and the mock pro client](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/1a8260d48da5af7e788b0217ed43504e731ff0eb "meson: Make tests depending on both the daemon and the mock pro client

Otherwise we need to compile everything in order to make the tests to
properly run instead of having automatic dependencies")`
 …

`[1a8260d](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/1a8260d48da5af7e788b0217ed43504e731ff0eb)`

```
Otherwise we need to compile everything in order to make the tests to
properly run instead of having automatic dependencies
```

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[tests/tests-daemon: Do not leak the json root](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/7272842c9ae72096e718f4b560e8ec3becb7398e "tests/tests-daemon: Do not leak the json root")`

`[7272842](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/7272842c9ae72096e718f4b560e8ec3becb7398e)`

 [![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
[force-pushed](/canonical/ubuntu-advantage-desktop-daemon/compare/67cc6f42928d42b1a58678967f41f8cad2fc91bb..1bb24c8ad8682d3317fee5365a80533e9a6e7704)
the
use-attach-config-for-token

branch
2 times, most recently
from
[`67cc6f4`](/canonical/ubuntu-advantage-desktop-daemon/commit/67cc6f42928d42b1a58678967f41f8cad2fc91bb) to
[`1bb24c8`](/canonical/ubuntu-advantage-desktop-daemon/commit/1bb24c8ad8682d3317fee5365a80533e9a6e7704)  [Compare](/canonical/ubuntu-advantage-desktop-daemon/compare/67cc6f42928d42b1a58678967f41f8cad2fc91bb..1bb24c8ad8682d3317fee5365a80533e9a6e7704)
[June 12, 2024 00:10](#event-13124010022)

[![robert-ancell](https://avatars.githubusercontent.com/u/126560?s=60&v=4)](/robert-ancell)

**[robert-ancell](/robert-ancell)**
reviewed
[Jun 12, 2024](#pullrequestreview-2111807336)

 [View reviewed changes](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files)

[src/ua-daemon.c](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files#diff-4859cc130064b9ac212ba713302bff096c1011c32f9e198452b0b6ddc2a893a7)

|  |  | @@ -381,6 +381,7 @@ static void bus\_acquired\_cb(GDBusConnection \*connection, const gchar \*name, | |
| --- | --- | --- | --- |
|  |  | static void name\_lost\_cb(GDBusConnection \*connection, const gchar \*name, |
|  |  | gpointer user\_data) { |
|  |  | UaDaemon \*self = user\_data; |
|  |  | g\_message("Name '%s' lost", name); |

Copy link

Collaborator

### @robert-ancell **[robert-ancell](/robert-ancell)** [Jun 12, 2024](#discussion_r1635722221)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Should this still be here? g\_debug perhaps if so?

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @3v1n0 **[3v1n0](/3v1n0)** [Jun 12, 2024](#discussion_r1635968966)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Well, can be still somewhat informative to have it in journal in case something goes bad, but I'm fine with both.

Sorry, something went wrong.

All reactions

Copy link

Collaborator

### @robert-ancell **[robert-ancell](/robert-ancell)** [Jun 12, 2024](#discussion_r1637190684)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

It's fine if it's intentional, it just looked like it might have been a mistake.

Sorry, something went wrong.

All reactions

[![robert-ancell](https://avatars.githubusercontent.com/u/126560?s=60&v=4)](/robert-ancell)

**[robert-ancell](/robert-ancell)**
reviewed
[Jun 12, 2024](#pullrequestreview-2111812014)

 [View reviewed changes](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files)

[src/ua-tool.c](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files#diff-04fdf2e476df199e85b13b942599d0f0c8690b671cc0964199b8d2c8ca3143db)

Show resolved

Hide resolved

[![robert-ancell](https://avatars.githubusercontent.com/u/126560?s=60&v=4)](/robert-ancell)

**[robert-ancell](/robert-ancell)**
reviewed
[Jun 12, 2024](#pullrequestreview-2111813001)

 [View reviewed changes](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files)

[tests/mock-ua.c](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files#diff-1977fb84bce50d82cfb17ec8eae663e9db4f94f9f4c30a3b30ef8bd38a821d18)
Outdated

Show resolved

Hide resolved

[![robert-ancell](https://avatars.githubusercontent.com/u/126560?s=60&v=4)](/robert-ancell)

**[robert-ancell](/robert-ancell)**
approved these changes
[Jun 12, 2024](#pullrequestreview-2111813860)

 [View reviewed changes](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files)

Copy link

Collaborator

### @robert-ancell **[robert-ancell](/robert-ancell)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Made some suggestions but otherwise looks fine to me.

Sorry, something went wrong.

All reactions

 [3v1n0](/3v1n0)
added 4 commits
[June 12, 2024 09:53](#commits-pushed-55f84f8)

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[tests/mock-ua: Use options parser for attach with --attach-config sup…](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/55f84f87fa3f590314e7464a0b4b1e3f46d61bfe "tests/mock-ua: Use options parser for attach with --attach-config support

It will then needed to verify that the token is passed in this way")`
 …

`[55f84f8](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/55f84f87fa3f590314e7464a0b4b1e3f46d61bfe)`

```
…port

It will then needed to verify that the token is passed in this way
```

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[tests/test-attach: Ensure that there are no errors in the calling side](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/36c1eb0dd1ba75534c1321b4aff9484aca929d76 "tests/test-attach: Ensure that there are no errors in the calling side")`

`[36c1eb0](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/36c1eb0dd1ba75534c1321b4aff9484aca929d76)`

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[ua-daemon: Log on name lost](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/6493e9b268063f7177f7fe83f13c695edac151c2 "ua-daemon: Log on name lost")`

`[6493e9b](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/6493e9b268063f7177f7fe83f13c695edac151c2)`

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)

`[ua-tool: Pass the token via a private temporary attach config file](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82 "ua-tool: Pass the token via a private temporary attach config file

We're currently calling the pro client with attach parameter in plain
text, but this leads to leaking such private information to any user in
the system (via simple ps).

So use a temporary file instead. This is safe because it's created by
default with -rw------- only permissions, so it won't be readable by
anyone else.

We could use an extra layer of protection saving it in the runtime
directory, but this is already enough.

LP: #2068944")`
 …

`[c49eb4f](/canonical/ubuntu-advantage-desktop-daemon/pull/24/commits/c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82)`

```
We're currently calling the pro client with attach parameter in plain
text, but this leads to leaking such private information to any user in
the system (via simple ps).

So use a temporary file instead. This is safe because it's created by
default with -rw------- only permissions, so it won't be readable by
anyone else.

We could use an extra layer of protection saving it in the runtime
directory, but this is already enough.

LP: #2068944
```

 [![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
[force-pushed](/canonical/ubuntu-advantage-desktop-daemon/compare/1bb24c8ad8682d3317fee5365a80533e9a6e7704..c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82)
the
use-attach-config-for-token

branch
from
[`1bb24c8`](/canonical/ubuntu-advantage-desktop-daemon/commit/1bb24c8ad8682d3317fee5365a80533e9a6e7704) to
[`c49eb4f`](/canonical/ubuntu-advantage-desktop-daemon/commit/c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82)  [Compare](/canonical/ubuntu-advantage-desktop-daemon/compare/1bb24c8ad8682d3317fee5365a80533e9a6e7704..c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82)
[June 12, 2024 07:54](#event-13127571228)

[![robert-ancell](https://avatars.githubusercontent.com/u/126560?s=60&v=4)](/robert-ancell)

**[robert-ancell](/robert-ancell)**
approved these changes
[Jun 12, 2024](#pullrequestreview-2114335595)

 [View reviewed changes](/canonical/ubuntu-advantage-desktop-daemon/pull/24/files/c49eb4f2bf5da384c5ce4a17c28ba80bd9dcfd82)

 Hide details
View details

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=40&v=4)](/3v1n0)
[3v1n0](/3v1n0)
merged commit [`b971b79`](/canonical/ubuntu-advantage-desktop-daemon/commit/b971b790e759e89b5f3d78b45f1816961099db32)
into
canonical:main

[Jun 13, 2024](https://github.com/canonical/ubuntu-advantage-desktop-daemon/pull/24#event-13138738968)
3 checks passed

[![@eslerm](https://avatars.githubusercontent.com/u/16212934?s=80&u=010b081004465e0194f7df90161433e65ed19f7f&v=4)](/eslerm)

Copy link

Member

### **[eslerm](/eslerm)** commented [Jun 27, 2024](#issuecomment-2195052728)

| Please refer to this issue as [CVE-2024-6388](https://github.com/advisories/GHSA-qr25-x8m6-w7qj "CVE-2024-6388"). |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fcanonical%2Fubuntu-advantage-desktop-daemon%2Fpull%2F24)

Reviewers

[![@robert-ancell](https://avatars.githubusercontent.com/u/126560?s=40&v=4)](/robert-ancell) [robert-ancell](/robert-ancell)

robert-ancell approved these changes

[![@seb128](https://avatars.githubusercontent.com/u/10974330?s=40&v=4)](/seb128) [seb128](/seb128)

 Awaiting requested review from seb128

Assignees

No one assigned

Labels

[bug](/canonical/ubuntu-advantage-desktop-daemon/labels/bug)
Something isn't working

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

3 participants

[![@3v1n0](https://avatars.githubusercontent.com/u/345675?s=52&v=4)](/3v1n0) [![@eslerm](https://avatars.githubusercontent.com/u/16212934?s=52&v=4)](/eslerm) [![@robert-ancell](https://avatars.githubusercontent.com/u/126560?s=52&v=4)](/robert-ancell)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from bugs.launchpad.net_40b2c512_20250111_151133.html ===

[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[ubuntu-advantage-tools package](https://launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)

# ubuntu-advantage-desktop-daemon (pro client in general) may expose the pro token to other users

Bug #2068944 reported by
[Marco Trevisan (Treviño)](https://launchpad.net/~3v1n0)
on 2024-06-11

[266](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [ubuntu-advantage-desktop-daemon (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-desktop-daemon "Latest release: 1.12, uploaded to main on 2024-06-27 12:43:07.860681+00:00 by Sebastien Bacher (seb128), maintained by Robert Ancell (robert-ancell)") | Fix Released | High | [Marco Trevisan (Treviño)](https://launchpad.net/~3v1n0) |  |
|  | [ubuntu-advantage-tools (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools "Latest release: 34.1.2, uploaded to main on 2024-10-04 20:11:09.276071+00:00 by Andreas Hasenack (ahasenack), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Triaged | High | Unassigned |  |

### Bug Description

While attaching through a desktop application the u-a-desktop-daemon may call pro process via

/usr/bin/python3 /usr/bin/ua attach ZCAb12TN2..........

And the token is visible to any user able to `ps` the system, potentially causing this info to be leaked.

Just use

gdbus call --system --dest com.canonical.UbuntuAdvantage \

  --object-path /com/canonical/UbuntuAdvantage/Manager \

  --method com.canonical.UbuntuAdvantage.Manager.Attach "$TOKEN"

and pro client attaching with visible token will be in the result of `ps aux|grep attach`

To prevent this to happen, the attach should pass the token to the client via an environment variable or a not readable --attach-config file.

In fact this happen when even attaching manually, as suggested in the official ubuntu pro website, but I feel it's not what we should ever do since passing a private token via args, may cause it to be leaked.

While for the usage of the pro client itself, it should \*always\* go through getpass-like or if some other interactive way (if we want keep it readable).

---

One way for the pro client to avoid exposing this for long time as it does now, would be, at least, to just make it re-exec itself when the token is passed as argument. Passing it as an internal env variable instead (better than creating a temporary attach-config, since that would imply IO and so potential slowdown).

---

ProblemType: BugDistroRelease: Ubuntu 22.04

Package: ubuntu-advantage-desktop-daemon 1.10~22.04.1

ProcVersionSignature: Ubuntu 6.8.0-35.35-generic 6.8.4

Uname: Linux 6.8.0-35-generic x86\_64

ApportVersion: 2.20.11-0ubuntu82.5

Architecture: amd64

CasperMD5CheckResult: unknown

CurrentDesktop: ubuntu:GNOME

Date: Tue Jun 11 02:39:48 2024

InstallationDate: Installed on 2010-07-10 (5084 days ago)InstallationMedia: Ubuntu 10.04 LTS "Lucid Lynx" - Release amd64 (20100429)

RebootRequiredPkgs: Error: path contained symlinks.SourcePackage: ubuntu-advantage-desktop-daemon

UpgradeStatus: Upgraded to jammy on 2020-06-14 (1457 days ago)

See [original description](comments/0)

Tags:

[jammy](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=jammy)
[amd64](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=amd64)
[apport-bug](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=apport-bug)
[wayland-session](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=wayland-session)

## CVE References

* [2024-6388](/bugs/cve/2024-6388 "This CVE was automatically created fr...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#1](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101)
  (3.2 KiB,
  text/plain; charset="utf-8")
* [ProcCpuinfoMinimal.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102/%2Bfiles/ProcCpuinfoMinimal.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102)
  (1.8 KiB,
  text/plain; charset="utf-8")
* [ProcEnviron.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103/%2Bfiles/ProcEnviron.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103)
  (359 bytes,
  text/plain; charset="utf-8")

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **status**: | New → Triaged |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#2](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/2) |
| --- | --- | --- | --- |

Not sure if this also affects the API call `u.pro.attach.magic.wait.v1`, where the magic is passed, since in such case we should rely on further user interaction so it shouldn't be really a problem.

However, I guess also the `api` calls should support reading from a file other than stdin

Not sure if this also affects the API call `u.pro.attach.magic.wait.v1`, where the magic is passed, since in such case we should rely on further user interaction so it shouldn't be really a problem.
However, I guess also the `api` calls should support reading from a file other than stdin

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| Changed in ubuntu-advantage-desktop-daemon (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Marco Trevisan (Treviño) (3v1n0) |
| **status**: | Triaged → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#3](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/3) |
| --- | --- | --- | --- |

ubuntu advantage daemon is handled at

  <https://github.com/canonical/ubuntu-advantage-desktop-daemon/pull/24>

ubuntu advantage daemon is handled at
https://github.com/canonical/ubuntu-advantage-desktop-daemon/pull/24

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |
| **description**: | updated |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-06-27

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Sebastien Bacher (seb128) |
| **importance**: | Undecided → High |
| **status**: | Triaged → Fix Committed |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-06-27

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2024-06-27: |  |  | [#4](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/4) |
| --- | --- | --- | --- |

Please refer to this issue as CVE-2024-6388.

Please refer to this issue as CVE-2024-6388.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2024-06-28: |  |  | [#5](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/5) |
| --- | --- | --- | --- |

This bug was fixed in the package ubuntu-advantage-desktop-daemon - 1.12

---------------

ubuntu-advantage-desktop-daemon (1.12) oracular; urgency=medium

\* Pass the token via a private temporary attach config file (lp: [#2068944](/bugs/2068944))

-- Sebastien Bacher <email address hidden> Thu, 27 Jun 2024 14:31:53 +0200

This bug was fixed in the package ubuntu-advantage-desktop-daemon - 1.12
---------------
ubuntu-advantage-desktop-daemon (1.12) oracular; urgency=medium
\* Pass the token via a private temporary attach config file (lp: #2068944)
-- Sebastien Bacher <seb128@ubuntu.com> Thu, 27 Jun 2024 14:31:53 +0200

| Changed in ubuntu-advantage-desktop-daemon (Ubuntu): | |
| --- | --- |
| **status**: | In Progress → Fix Released |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-07-01

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **assignee**: | Sebastien Bacher (seb128) → nobody |
| **status**: | Fix Committed → Invalid |
| **status**: | Invalid → Triaged |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101 "Change attachment details")
* [ProcCpuinfoMinimal.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102/%2Bfiles/ProcCpuinfoMinimal.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102 "Change attachment details")
* [ProcEnviron.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103/%2Bfiles/ProcEnviron.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103 "Change attachment details")

* [Add attachment](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))


