
[Log in / Register](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Blogin)

[![](https://launchpadlibrarian.net/606381979/CoF%2064px.png)](https://launchpad.net/ubuntu)

## [Ubuntu](https://launchpad.net/ubuntu)[ubuntu-advantage-tools package](https://launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)

* [Overview](https://launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Code](https://code.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Bugs](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* Blueprints
* [Translations](https://translations.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)
* [Answers](https://answers.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools)

# ubuntu-advantage-desktop-daemon (pro client in general) may expose the pro token to other users

Bug #2068944 reported by
[Marco Trevisan (Treviño)](https://launchpad.net/~3v1n0)
on 2024-06-11

[266](/%2Bhelp-bugs/bug-heat.html)

This bug affects 1 person

| Affects | | Status | Importance | Assigned to | Milestone |
| --- | --- | --- | --- | --- | --- |
|  | [ubuntu-advantage-desktop-daemon (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-desktop-daemon "Latest release: 1.12, uploaded to main on 2024-06-27 12:43:07.860681+00:00 by Sebastien Bacher (seb128), maintained by Robert Ancell (robert-ancell)") | Fix Released | High | [Marco Trevisan (Treviño)](https://launchpad.net/~3v1n0) |  |
|  | [ubuntu-advantage-tools (Ubuntu)](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools "Latest release: 34.1.2, uploaded to main on 2024-10-04 20:11:09.276071+00:00 by Andreas Hasenack (ahasenack), maintained by Ubuntu Developers (ubuntu-devel-discuss-lists)") | Triaged | High | Unassigned |  |

### Bug Description

While attaching through a desktop application the u-a-desktop-daemon may call pro process via

/usr/bin/python3 /usr/bin/ua attach ZCAb12TN2..........

And the token is visible to any user able to `ps` the system, potentially causing this info to be leaked.

Just use

gdbus call --system --dest com.canonical.UbuntuAdvantage \

  --object-path /com/canonical/UbuntuAdvantage/Manager \

  --method com.canonical.UbuntuAdvantage.Manager.Attach "$TOKEN"

and pro client attaching with visible token will be in the result of `ps aux|grep attach`

To prevent this to happen, the attach should pass the token to the client via an environment variable or a not readable --attach-config file.

In fact this happen when even attaching manually, as suggested in the official ubuntu pro website, but I feel it's not what we should ever do since passing a private token via args, may cause it to be leaked.

While for the usage of the pro client itself, it should \*always\* go through getpass-like or if some other interactive way (if we want keep it readable).

---

One way for the pro client to avoid exposing this for long time as it does now, would be, at least, to just make it re-exec itself when the token is passed as argument. Passing it as an internal env variable instead (better than creating a temporary attach-config, since that would imply IO and so potential slowdown).

---

ProblemType: BugDistroRelease: Ubuntu 22.04

Package: ubuntu-advantage-desktop-daemon 1.10~22.04.1

ProcVersionSignature: Ubuntu 6.8.0-35.35-generic 6.8.4

Uname: Linux 6.8.0-35-generic x86\_64

ApportVersion: 2.20.11-0ubuntu82.5

Architecture: amd64

CasperMD5CheckResult: unknown

CurrentDesktop: ubuntu:GNOME

Date: Tue Jun 11 02:39:48 2024

InstallationDate: Installed on 2010-07-10 (5084 days ago)InstallationMedia: Ubuntu 10.04 LTS "Lucid Lynx" - Release amd64 (20100429)

RebootRequiredPkgs: Error: path contained symlinks.SourcePackage: ubuntu-advantage-desktop-daemon

UpgradeStatus: Upgraded to jammy on 2020-06-14 (1457 days ago)

See [original description](comments/0)

Tags:

[jammy](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=jammy)
[amd64](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=amd64)
[apport-bug](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=apport-bug)
[wayland-session](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbugs?field.tag=wayland-session)

## CVE References

* [2024-6388](/bugs/cve/2024-6388 "This CVE was automatically created fr...")

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#1](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/1) |
| --- | --- | --- | --- |

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101)
  (3.2 KiB,
  text/plain; charset="utf-8")
* [ProcCpuinfoMinimal.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102/%2Bfiles/ProcCpuinfoMinimal.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102)
  (1.8 KiB,
  text/plain; charset="utf-8")
* [ProcEnviron.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103/%2Bfiles/ProcEnviron.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103)
  (359 bytes,
  text/plain; charset="utf-8")

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **status**: | New → Triaged |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#2](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/2) |
| --- | --- | --- | --- |

Not sure if this also affects the API call `u.pro.attach.magic.wait.v1`, where the magic is passed, since in such case we should rely on further user interaction so it shouldn't be really a problem.

However, I guess also the `api` calls should support reading from a file other than stdin

Not sure if this also affects the API call `u.pro.attach.magic.wait.v1`, where the magic is passed, since in such case we should rely on further user interaction so it shouldn't be really a problem.
However, I guess also the `api` calls should support reading from a file other than stdin

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| Changed in ubuntu-advantage-desktop-daemon (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Marco Trevisan (Treviño) (3v1n0) |
| **status**: | Triaged → In Progress |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0) wrote on 2024-06-11: |  |  | [#3](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/3) |
| --- | --- | --- | --- |

ubuntu advantage daemon is handled at

  <https://github.com/canonical/ubuntu-advantage-desktop-daemon/pull/24>

ubuntu advantage daemon is handled at
https://github.com/canonical/ubuntu-advantage-desktop-daemon/pull/24

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |
| **description**: | updated |

[Marco Trevisan (Treviño) (3v1n0)](https://launchpad.net/~3v1n0)
on 2024-06-11

| **description**: | updated |
| --- | --- |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-06-27

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **assignee**: | nobody → Sebastien Bacher (seb128) |
| **importance**: | Undecided → High |
| **status**: | Triaged → Fix Committed |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-06-27

| **information type**: | Private Security → Public Security |
| --- | --- |

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Mark Esler (eslerm)](https://launchpad.net/~eslerm) wrote on 2024-06-27: |  |  | [#4](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/4) |
| --- | --- | --- | --- |

Please refer to this issue as CVE-2024-6388.

Please refer to this issue as CVE-2024-6388.

Revision history for this message
![](/+icing/build/overlay/assets/skins/sam/images/close.gif)

| [Launchpad Janitor (janitor)](https://launchpad.net/~janitor) wrote on 2024-06-28: |  |  | [#5](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/comments/5) |
| --- | --- | --- | --- |

This bug was fixed in the package ubuntu-advantage-desktop-daemon - 1.12

---------------

ubuntu-advantage-desktop-daemon (1.12) oracular; urgency=medium

\* Pass the token via a private temporary attach config file (lp: [#2068944](/bugs/2068944))

-- Sebastien Bacher <email address hidden> Thu, 27 Jun 2024 14:31:53 +0200

This bug was fixed in the package ubuntu-advantage-desktop-daemon - 1.12
---------------
ubuntu-advantage-desktop-daemon (1.12) oracular; urgency=medium
\* Pass the token via a private temporary attach config file (lp: #2068944)
-- Sebastien Bacher <seb128@ubuntu.com> Thu, 27 Jun 2024 14:31:53 +0200

| Changed in ubuntu-advantage-desktop-daemon (Ubuntu): | |
| --- | --- |
| **status**: | In Progress → Fix Released |

[Sebastien Bacher (seb128)](https://launchpad.net/~seb128)
on 2024-07-01

| Changed in ubuntu-advantage-tools (Ubuntu): | |
| --- | --- |
| **assignee**: | Sebastien Bacher (seb128) → nobody |
| **status**: | Fix Committed → Invalid |
| **status**: | Invalid → Triaged |

[See full activity log](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bactivity)

To post a comment you must [log in](%2Blogin?comments=all).

* [Report a bug](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bfilebug)

This report contains
**Public Security**
information

Everyone can see this security related information.

You are
[not directly subscribed to this bug's notifications.](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bsubscribe)

Subscribing...

* [Edit bug mail](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Bsubscriptions "View and change your subscriptions to this bug")

## Other bug subscribers

[Subscribe someone else](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Baddsubscriber "Launchpad will email that person whenever this bugs changes")

## Bug attachments

* [Dependencies.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101/%2Bfiles/Dependencies.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788101 "Change attachment details")
* [ProcCpuinfoMinimal.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102/%2Bfiles/ProcCpuinfoMinimal.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788102 "Change attachment details")
* [ProcEnviron.txt](https://bugs.launchpad.net/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103/%2Bfiles/ProcEnviron.txt)
  [Edit](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Battachment/5788103 "Change attachment details")

* [Add attachment](/ubuntu/%2Bsource/ubuntu-advantage-tools/%2Bbug/2068944/%2Baddcomment)

## Remote bug watches

Bug watches keep track of this bug in other bug trackers.

[![Launchpad](/@@/launchpad-footer-logo.svg)](https://launchpad.net/)
 •
[Take the tour](https://launchpad.net/%2Btour)
 •
[Read the guide](https://help.launchpad.net/)

© 2004
[Canonical Ltd.](http://canonical.com/)
 •
[Terms of use](https://launchpad.net/legal)
 •
[Data privacy](https://www.ubuntu.com/legal/dataprivacy)
 •
[Contact Launchpad Support](/feedback)
 •
[Blog](http://blog.launchpad.net/)
 •
[Careers](https://canonical.com/careers)
 •
[System status](https://ubuntu.social/%40launchpadstatus)
 •
6394e03
([Get the code!](https://dev.launchpad.net/))

