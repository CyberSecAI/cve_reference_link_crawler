

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8ea80ff5d8298356d28077bc30913ed37df65109)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ea80ff5d8298356d28077bc30913ed37df65109)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ea80ff5d8298356d28077bc30913ed37df65109)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ea80ff5d8298356d28077bc30913ed37df65109)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paolo Abeni <pabeni@redhat.com> | 2024-08-16 17:20:34 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-29 17:33:48 +0200 |
| commit | [8ea80ff5d8298356d28077bc30913ed37df65109](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ea80ff5d8298356d28077bc30913ed37df65109) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8ea80ff5d8298356d28077bc30913ed37df65109)) | |
| tree | [13f98e570d871c4c385111ed064d6e1633c487ce](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ea80ff5d8298356d28077bc30913ed37df65109) | |
| parent | [da7d3fddced71f50bb1b0c431e8f77dc28eeab13](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=da7d3fddced71f50bb1b0c431e8f77dc28eeab13) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ea80ff5d8298356d28077bc30913ed37df65109&id2=da7d3fddced71f50bb1b0c431e8f77dc28eeab13)) | |
| download | [linux-8ea80ff5d8298356d28077bc30913ed37df65109.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8ea80ff5d8298356d28077bc30913ed37df65109.tar.gz) | |

igb: cope with large MAX\_SKB\_FRAGS[ Upstream commit 8aba27c4a5020abdf60149239198297f88338a8d ]
Sabrina reports that the igb driver does not cope well with large
MAX\_SKB\_FRAG values: setting MAX\_SKB\_FRAG to 45 causes payload
corruption on TX.
An easy reproducer is to run ssh to connect to the machine. With
MAX\_SKB\_FRAGS=17 it works, with MAX\_SKB\_FRAGS=45 it fails. This has
been reported originally in
https://bugzilla.redhat.com/show\_bug.cgi?id=2265320
The root cause of the issue is that the driver does not take into
account properly the (possibly large) shared info size when selecting
the ring layout, and will try to fit two packets inside the same 4K
page even when the 1st fraglist will trump over the 2nd head.
Address the issue by checking if 2K buffers are insufficient.
Fixes: 3948b05950fd ("net: introduce a config option to tweak MAX\_SKB\_FRAGS")
Reported-by: Jan Tluka <jtluka@redhat.com>
Reported-by: Jirka Hladky <jhladky@redhat.com>
Reported-by: Sabrina Dubroca <sd@queasysnail.net>
Tested-by: Sabrina Dubroca <sd@queasysnail.net>
Tested-by: Corinna Vinschen <vinschen@redhat.com>
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Corinna Vinschen <vinschen@redhat.com>
Link: [https://patch.msgid.link/20240816152034.1453285-1-vinschen@redhat.com](https://patch.msgid.link/20240816152034.1453285-1-vinschen%40redhat.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ea80ff5d8298356d28077bc30913ed37df65109)

| -rw-r--r-- | [drivers/net/ethernet/intel/igb/igb\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/intel/igb/igb_main.c?id=8ea80ff5d8298356d28077bc30913ed37df65109) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/intel/igb/igb\_main.c b/drivers/net/ethernet/intel/igb/igb\_main.cindex 4431e7693d45fc..8c8894ef33886d 100644--- a/[drivers/net/ethernet/intel/igb/igb\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igb/igb_main.c?id=da7d3fddced71f50bb1b0c431e8f77dc28eeab13)+++ b/[drivers/net/ethernet/intel/igb/igb\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/intel/igb/igb_main.c?id=8ea80ff5d8298356d28077bc30913ed37df65109)@@ -4833,6 +4833,7 @@ static void igb\_set\_rx\_buffer\_len(struct igb\_adapter \*adapter,  #if (PAGE\_SIZE < 8192) if (adapter->max\_frame\_size > IGB\_MAX\_FRAME\_BUILD\_SKB ||+ IGB\_2K\_TOO\_SMALL\_WITH\_PADDING || rd32(E1000\_RCTL) & E1000\_RCTL\_SBP) set\_ring\_uses\_large\_buffer(rx\_ring); #endif |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 23:57:12 +0000

