=== Content from git.kernel.org_cc53124f_20250110_174729.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Stefan Haberland <sth@linux.ibm.com> | 2024-07-03 11:23:12 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-11 12:51:19 +0200 |
| commit | [c116475f7d6410b1e6d399207ac75de6cf9c3652](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)) | |
| tree | [5e83b8ed3731e69aa6bca209b37d22939ca31fa8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652) | |
| parent | [b9ea38e767459111a511ed4fb74abc37db95a59d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b9ea38e767459111a511ed4fb74abc37db95a59d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652&id2=b9ea38e767459111a511ed4fb74abc37db95a59d)) | |
| download | [linux-c116475f7d6410b1e6d399207ac75de6cf9c3652.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c116475f7d6410b1e6d399207ac75de6cf9c3652.tar.gz) | |

s390/dasd: Fix invalid dereferencing of indirect CCW data pointercommit b3a58f3b90f564f42a5c35778d8c5107b2c2150b upstream.
Fix invalid dereferencing of indirect CCW data pointer in
dasd\_eckd\_dump\_sense() that leads to a kernel panic in error cases.
When using indirect addressing for DASD CCWs (IDAW) the CCW CDA pointer
does not contain the data address itself but a pointer to the IDAL.
This needs to be translated from physical to virtual as well before
using it.
This dereferencing is also used for dasd\_page\_cache and also fixed
although it is very unlikely that this code path ever gets used.
Fixes: c0bd39601c13 ("s390/dasd: use new address translation helpers")
Cc: stable@vger.kernel.org
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Reviewed-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)

| -rw-r--r-- | [drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd_eckd.c?id=c116475f7d6410b1e6d399207ac75de6cf9c3652) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd_fba.c?id=c116475f7d6410b1e6d399207ac75de6cf9c3652) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 3 insertions, 3 deletions

| diff --git a/drivers/s390/block/dasd\_eckd.c b/drivers/s390/block/dasd\_eckd.cindex 180a008d38eaaf..4118b64781cb51 100644--- a/[drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_eckd.c?id=b9ea38e767459111a511ed4fb74abc37db95a59d)+++ b/[drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_eckd.c?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)@@ -4906,7 +4906,7 @@ dasd\_eckd\_free\_cp(struct dasd\_ccw\_req \*cqr, struct request \*req) ccw++; if (dst) { if (ccw->flags & CCW\_FLAG\_IDA)- cda = \*((char \*\*)dma32\_to\_virt(ccw->cda));+ cda = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(ccw->cda))); else cda = dma32\_to\_virt(ccw->cda); if (dst != cda) {@@ -5525,7 +5525,7 @@ dasd\_eckd\_dump\_ccw\_range(struct dasd\_device \*device, struct ccw1 \*from,  /\* get pointer to data (consider IDALs) \*/ if (from->flags & CCW\_FLAG\_IDA)- datap = (char \*)\*((addr\_t \*)dma32\_to\_virt(from->cda));+ datap = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(from->cda))); else datap = dma32\_to\_virt(from->cda); diff --git a/drivers/s390/block/dasd\_fba.c b/drivers/s390/block/dasd\_fba.cindex 361e9bd7525705..9f2023a077c202 100644--- a/[drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_fba.c?id=b9ea38e767459111a511ed4fb74abc37db95a59d)+++ b/[drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_fba.c?id=c116475f7d6410b1e6d399207ac75de6cf9c3652)@@ -585,7 +585,7 @@ dasd\_fba\_free\_cp(struct dasd\_ccw\_req \*cqr, struct request \*req) ccw++; if (dst) { if (ccw->flags & CCW\_FLAG\_IDA)- cda = \*((char \*\*)dma32\_to\_virt(ccw->cda));+ cda = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(ccw->cda))); else cda = dma32\_to\_virt(ccw->cda); if (dst != cda) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:06 +0000



=== Content from git.kernel.org_16361b07_20250110_174729.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Stefan Haberland <sth@linux.ibm.com> | 2024-07-03 11:23:12 +0200 |
| --- | --- | --- |
| committer | Heiko Carstens <hca@linux.ibm.com> | 2024-07-03 16:27:06 +0200 |
| commit | [b3a58f3b90f564f42a5c35778d8c5107b2c2150b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)) | |
| tree | [75d655b3b6cbc27df1fac36c661fd5297b9f1cd1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b) | |
| parent | [2ae157ec497d93c639a60e730e21ec9c66fa9a6e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2ae157ec497d93c639a60e730e21ec9c66fa9a6e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b&id2=2ae157ec497d93c639a60e730e21ec9c66fa9a6e)) | |
| download | [linux-b3a58f3b90f564f42a5c35778d8c5107b2c2150b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b3a58f3b90f564f42a5c35778d8c5107b2c2150b.tar.gz) | |

s390/dasd: Fix invalid dereferencing of indirect CCW data pointerFix invalid dereferencing of indirect CCW data pointer in
dasd\_eckd\_dump\_sense() that leads to a kernel panic in error cases.
When using indirect addressing for DASD CCWs (IDAW) the CCW CDA pointer
does not contain the data address itself but a pointer to the IDAL.
This needs to be translated from physical to virtual as well before
using it.
This dereferencing is also used for dasd\_page\_cache and also fixed
although it is very unlikely that this code path ever gets used.
Fixes: c0bd39601c13 ("s390/dasd: use new address translation helpers")
Cc: stable@vger.kernel.org
Signed-off-by: Stefan Haberland <sth@linux.ibm.com>
Reviewed-by: Heiko Carstens <hca@linux.ibm.com>
Signed-off-by: Heiko Carstens <hca@linux.ibm.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)

| -rw-r--r-- | [drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd_eckd.c?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/s390/block/dasd_fba.c?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 3 insertions, 3 deletions

| diff --git a/drivers/s390/block/dasd\_eckd.c b/drivers/s390/block/dasd\_eckd.cindex 2f16f543079b4f..a76c6af9ea6385 100644--- a/[drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_eckd.c?id=2ae157ec497d93c639a60e730e21ec9c66fa9a6e)+++ b/[drivers/s390/block/dasd\_eckd.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_eckd.c?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)@@ -4906,7 +4906,7 @@ dasd\_eckd\_free\_cp(struct dasd\_ccw\_req \*cqr, struct request \*req) ccw++; if (dst) { if (ccw->flags & CCW\_FLAG\_IDA)- cda = \*((char \*\*)dma32\_to\_virt(ccw->cda));+ cda = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(ccw->cda))); else cda = dma32\_to\_virt(ccw->cda); if (dst != cda) {@@ -5525,7 +5525,7 @@ dasd\_eckd\_dump\_ccw\_range(struct dasd\_device \*device, struct ccw1 \*from,  /\* get pointer to data (consider IDALs) \*/ if (from->flags & CCW\_FLAG\_IDA)- datap = (char \*)\*((addr\_t \*)dma32\_to\_virt(from->cda));+ datap = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(from->cda))); else datap = dma32\_to\_virt(from->cda); diff --git a/drivers/s390/block/dasd\_fba.c b/drivers/s390/block/dasd\_fba.cindex 361e9bd7525705..9f2023a077c202 100644--- a/[drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_fba.c?id=2ae157ec497d93c639a60e730e21ec9c66fa9a6e)+++ b/[drivers/s390/block/dasd\_fba.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/s390/block/dasd_fba.c?id=b3a58f3b90f564f42a5c35778d8c5107b2c2150b)@@ -585,7 +585,7 @@ dasd\_fba\_free\_cp(struct dasd\_ccw\_req \*cqr, struct request \*req) ccw++; if (dst) { if (ccw->flags & CCW\_FLAG\_IDA)- cda = \*((char \*\*)dma32\_to\_virt(ccw->cda));+ cda = dma64\_to\_virt(\*((dma64\_t \*)dma32\_to\_virt(ccw->cda))); else cda = dma32\_to\_virt(ccw->cda); if (dst != cda) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:06 +0000


