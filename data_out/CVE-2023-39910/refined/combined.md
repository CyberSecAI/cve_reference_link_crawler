=== Content from github.com_e017f19c_20250111_082756.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fblob%2F20eba4db9a8a3476949d6fd08a589abda7fde3e3%2Fsrc%2Fcommands%2Fseed.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fblob%2F20eba4db9a8a3476949d6fd08a589abda7fde3e3%2Fsrc%2Fcommands%2Fseed.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=libbitcoin%2Flibbitcoin-explorer)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libbitcoin](/libbitcoin)
/
**[libbitcoin-explorer](/libbitcoin/libbitcoin-explorer)**
Public

* [Notifications](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer) You must be signed in to change notification settings
* [Fork
  180](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)
* [Star
   604](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues
  20](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests
  0](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects
  0](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

Additional navigation options

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

## Files

 20eba4d
## Breadcrumbs

1. [libbitcoin-explorer](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3)
2. /[src](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src)
3. /[commands](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/commands)
/
# seed.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/libbitcoin/libbitcoin-explorer/commits/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/commands/seed.cpp)52 lines (45 loc) · 1.67 KB 20eba4d
## Breadcrumbs

1. [libbitcoin-explorer](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3)
2. /[src](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src)
3. /[commands](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/commands)
/
# seed.cpp

Top
## File metadata and controls

* Code
* Blame

52 lines (45 loc) · 1.67 KB[Raw](https://github.com/libbitcoin/libbitcoin-explorer/raw/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/commands/seed.cpp)12345678910111213141516171819202122232425262728293031323334353637383940414243444546474849505152/\*\* \* Copyright (c) 2011-2017 libbitcoin developers (see AUTHORS) \* \* This file is part of libbitcoin. \* \* This program is free software: you can redistribute it and/or modify \* it under the terms of the GNU Affero General Public License as published by \* the Free Software Foundation, either version 3 of the License, or \* (at your option) any later version. \* \* This program is distributed in the hope that it will be useful, \* but WITHOUT ANY WARRANTY; without even the implied warranty of \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \* GNU Affero General Public License for more details. \* \* You should have received a copy of the GNU Affero General Public License \* along with this program. If not, see <http://www.gnu.org/licenses/>. \*/#include <bitcoin/explorer/commands/seed.hpp>
#include <iostream>#include <bitcoin/system.hpp>#include <bitcoin/explorer/define.hpp>#include <bitcoin/explorer/utility.hpp>
namespace libbitcoin {namespace explorer {namespace commands {using namespace bc::config;
console\_result seed::invoke(std::ostream& output, std::ostream& error){ const auto bit\_length = get\_bit\_length\_option();
 // These are soft requirements for security and rationality. // We use bit vs. byte length input as the more familiar convention. if (bit\_length < minimum\_seed\_size \* byte\_bits || bit\_length % byte\_bits != 0) { error << BX\_SEED\_BIT\_LENGTH\_UNSUPPORTED << std::endl; return console\_result::failure; }
 const auto seed = new\_seed(bit\_length);
 output << base16(seed) << std::endl; return console\_result::okay;}
} //namespace commands} //namespace explorer} //namespace libbitcoin

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_39185aad_20250111_082758.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fwiki%2FCVE-2023-39910)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fwiki%2FCVE-2023-39910)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fwiki%2Fshow&source=header-repo&source_repo=libbitcoin%2Flibbitcoin-explorer)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libbitcoin](/libbitcoin)
/
**[libbitcoin-explorer](/libbitcoin/libbitcoin-explorer)**
Public

* [Notifications](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer) You must be signed in to change notification settings
* [Fork
  180](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)
* [Star
   604](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues
  20](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests
  0](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects
  0](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

Additional navigation options

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

# CVE 2023 39910

[Jump to bottom](#wiki-pages-box)

Eric Voskuil edited this page Oct 3, 2023
·
[4 revisions](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910/_history)

* [Background](#background)
  + [Libbitcoin](#libbitcoin)
  + [SubvertX (SX)](#subvertx-sx)
  + [Bitcoin Explorer (BX)](#bitcoin-explorer-bx)
  + [SX Seeding](#sx-seeding)
  + [BX Seeding](#bx-seeding)
  + [Versions](#versions)
  + [System 2.x](#system-2x)
  + [System 3.x](#system-3x)
* [Entropy](#entropy)
  + [C++11 Random](#c11-random)
  + [Platform Unsuitability](#platform-unsuitability)
  + [Best Practices](#best-practices)
  + [Security Guarantee](#security-guarantee)
* [Mastering Bitcoin](#mastering-bitcoin)
  + [Misleading Generalization](#misleading-generalization)
  + [Content Misattribution](#content-misattribution)
  + [Incompatibility](#incompatibility)
  + [Download Warning](#download-warning)
* [Documentation](#documentation)
  + [Easily Discoverable](#easily-discoverable)
  + [Warning in Context](#warning-in-context)
  + [Random Numbers Topic](#random-numbers-topic)
  + [Documentation not Redundant](#documentation-not-redundant)
  + [Consistency Seems Strange](#consistency-seems-strange)
* [Feature or Bug](#feature-or-bug)
* [Communication](#communication)
* [Exposure](#exposure)
* [Response](#response)

## Background

This document provides a detailed review of circumstances pertaining to [CVE-2023-39910](https://nvd.nist.gov/vuln/detail/CVE-2023-39910).

### Libbitcoin

Libbitcoin ("lib Bitcoin") is a Bitcoin software development toolkit [AGPLv3](https://www.gnu.org/licenses/agpl-3.0.en.html) community project, started in 2011 by Amir Taaki. The current release is [version 3.8.0](https://github.com/libbitcoin/libbitcoin-system/releases/tag/v3.8.0), with v4 work ongoing for several years. Libbitcoin produced the first Bitcoin node implementation independent of Satoshi’s bitcoind and has been continuously maintained to date.

The project consists of [ten C++ libraries](https://github.com/libbitcoin/) each within their own GitHub repository, spanning on the order of 500,000 lines of code. The libraries provide many functions that would typically be required in the development of Bitcoin applications in C++. Three libraries provide command line tools that demonstrate the use of these functions – specifically BN (Bitcoin Node), BS (Bitcoin Server) and BX (Bitcoin eXplorer). All libraries are designed in a manner that allows their functionality to be easily extended by developers without having to fork and maintain them.

### SubvertX (SX)

SX (sometimes referred to as Spesmilo eXpander) was an early set of ad-hoc tools initially developed for Libbitcoin maintainer use. There was never a versioned release. Among other capabilities, SX explored implementation of a command line wallet, which was discontinued with the release of BX ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/v2.0.0/model/generate.xml#L535-L537)).

```
<command symbol="wallet" category="WALLET" obsolete="true" description="Experimental command line wallet.">
  <define name="BX_WALLET_OBSOLETE" value="This experimental command is no longer supported." />
</command>
```

### Bitcoin Explorer (BX)

BX (Bitcoin eXplorer) is a thin command line interface around the [libbitcoin-explorer](https://github.com/libbitcoin/libbitcoin-explorer/tree/version3#readme) developer library. This serves the initial objective of maintainer tooling while also providing a demonstration of Libbitcoin functions tied to common scenarios. The initial release of BX was 2.0, reserving the 1.0 designation for SX. The 2.x releases focused on reduction of dependencies, code generation, comprehensive unit testing, continuous integration, Windows support, and rationalization of the command line interface.

Neither Libbitcoin nor BX is a wallet, however many primitive functions used in wallet development are provided. As the name implies, BX is intended for exploration of Bitcoin. Commands include elliptic curve math, hashing, base encoding, HD key derivation, BS query, etc. It has often been used to publicly demonstrate how Bitcoin works at lower levels than typically accessible in consumer-oriented applications. For example: [Wright Decoded](https://github.com/libbitcoin/libbitcoin-explorer/wiki/wright-decoded) and [Bitcoin Edge Dev++ 2018](https://www.youtube.com/watch?v=OVvue2dXkJo). It should be quite evident from these examples that BX is an advanced developer tool.

### SX Seeding

`sx hd-seed` was the initial seeding command. It accepted entropy via the command line and if not provided, defaulted to internal entropy generation ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/00819fb694ae1b521931443229a41724d9b24f90/src/hd-seed.cpp)).

```
data_chunk random_bytes(size_t size)
{
    std::random_device rd;
    std::default_random_engine engine(rd());
    std::uniform_int_distribution<uint8_t> uniform_dist(0, 255);

    data_chunk result;
    for (size_t i = 0; i < size; ++i)
        result.push_back(uniform_dist(engine));
    return result;
}

int main(int argc, char** argv)
{
    if (argc > 2)
    {
        std::cerr << "Usage: sx hd-seed [ENTROPY]" << std::endl;
        return -1;
    }
    data_chunk entropy;
    if (argc == 2)
        entropy = decode_hex(argv[1]);
    else
        entropy = random_bytes(32);
    hd_private_key hd_key(entropy);
    std::cout << hd_key.serialize() << std::endl;
    return 0;
}
```

Entropy was later incorporated into other commands, such as `sx stealth-newkey`. Note that this did not provide the command line option ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/d7cc8d408379e70fc01e57f4f5d53eda410a181f/src/stealth-newkey.cpp)).

```
int main()
{
    ec_secret scan_secret = generate_random_secret();
    ec_secret spend_secret = generate_random_secret();
    ec_point spend_pubkey = secret_to_public_key(spend_secret);

    stealth_address addr;
    addr.options |= stealth_address::reuse_key_option;
    addr.scan_pubkey = secret_to_public_key(scan_secret);
    addr.spend_pubkeys.push_back(spend_pubkey);
    addr.number_signatures = 1;

    std::cout << "Stealth address: " << addr.encoded() << std::endl;
    std::cout << "Scan secret: " << scan_secret << std::endl;
    std::cout << "Spend secret: " << spend_secret << std::endl;
    return 0;
}
```

The `sx newkey` command was added to provide generation of WIF keys. This also did not provide the command line option ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/8e5a88451b9f44d1cbcffb2933b1b78b80966a3c/src/newkey.cpp)).

```
int main()
{
    elliptic_curve_key key;
    key.new_keypair();
    secret_parameter secret = key.secret();
    std::cout << libwallet::secret_to_wif(secret) << std::endl;
    return 0;
}
```

The `sx hd-new` command was reworked and renamed to `sx newseed`, with the command line option removed ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/482255da51749300804bfb7d9998bf2604587d3b/newseed/main.cpp)).

```
int main()
{
    libwallet::deterministic_wallet wallet;
    wallet.new_seed();
    std::cout << wallet.seed() << std::endl;
    return 0;
}
```

Internal entropy generation was thus centralized in [util.hpp](https://github.com/libbitcoin/libbitcoin-explorer/blob/d7cc8d408379e70fc01e57f4f5d53eda410a181f/src/util.hpp).

```
ec_secret generate_random_secret()
{
    std::random_device random;
    std::default_random_engine engine(random());
    ec_secret secret;
    for (uint8_t& byte: secret)
        byte = engine() % std::numeric_limits<uint8_t>::max();
    return secret;
}
```

### BX Seeding

One of the many interface normalizations implemented by BX was the requirement that entropy *only* be provided via the command line, for commands that consume it, affecting `bx hd-new`, `bx ec-new`, `bx mnemonic-encode` and the stealth feature of `bx tx-encode`. The `sx newseed` command was renamed to `bx seed` which remained based on `std::random_device` ([link](https://github.com/libbitcoin/libbitcoin-explorer/blob/39dec494675b76c9983e2888087bc2da0f7d82aa/src/utility.cpp)).

```
// Not testable due to lack of random engine injection.
data_chunk new_seed(size_t bitlength)
{
    size_t fill_seed_size = bitlength / byte_bits;
    data_chunk seed(fill_seed_size);
    random_fill(seed);
    return seed;
}

...

// Not testable due to lack of random engine injection.
void random_fill(data_chunk& chunk)
{
    std::random_device random;
    std::default_random_engine engine(random());

    for (uint8_t& byte: chunk)
        byte = engine() % std::numeric_limits<uint8_t>::max();
}
```

This set of changes made it necessary for the user to provide entropy via the command line for all commands that consumed it, with length constraints. The option to obtain internally-generated entropy was thus retained, though it became explicit.

SX did not incorporate a consistent help system and did not offer help for the `sx newseed` command. In recognition of platform generated entropy limitations (see [below](#entropy)), the integrated help for `bx seed` was set to inform the user that the seed was not truly random. The `bx seed` documentation has always contained the following text and explicit warning ([link](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-seed/7644353f2ed45f116c595222640240fabc43e953)).

![bx-seed-doc](CVE-2023-39910/bx-seed-doc.png)

Before the [BX 2.1 release](https://github.com/libbitcoin/libbitcoin-explorer/releases/tag/v2.1.0), the `bx cert-new` command had been added (on [Feb 12, 2015](https://github.com/libbitcoin/libbitcoin-explorer/commit/8eb03593b34cd27420bcee454aa6e053bd12255a)). This command pertains to client-server communications security. This is a pass through to the external [ZeroMQ](https://zeromq.org/) library for generation of [CurveCP](http://curvecp.org/) certificates. This command has always been documented with the following explicit warning against platform entropy ([link](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-cert-new/082a4a9756ff2c54329e49b486479fc5abac1352)).

![bx-cert-new-doc](CVE-2023-39910/bx-cert-new-doc.png)

### Versions

As a software development toolkit, Libbitcoin endeavors to isolate all breaking changes to major version increments (e.g. 1.x, 2.x, 3.x). Cross-library dependencies are also restricted to the same major version. In other words, libbitcoin-explorer 3.x must depend on libbitcoin-system 3.x and cannot depend on 1.x or 2.x. Applying breaking changes is the purpose of the major increment. As such, BX version 3 depends upon libbitcoin-system version 3. Each major version is staged in the `master` branch and moved to a release branch (e.g. `version3`) when tagged for its initial release.

```
system/version1    10 May 2013
system/version2    05 Jun 2014
system/version3    09 Feb 2017

subvertx/version1  -----------
explorer/version2  13 Dec 2014
explorer/version3  08 Mar 2017

BX v2.0.0 took its initial system dependency upon system v2.7.0, both dated Dec 13, 2014.
BX v2.3.0 (the last update of BX version 2) was tagged for release on Feb 9, 2017.
BX v3.0.0 took its initial system dependency upon system v3.0.0, dated Feb/Mar 2017.

```

Despite being released at about the same time as BX v3.0.0, BX v2.3.0 continued to depend upon the system 2.x `pseudo_random_fill()` function which was based on `std::random_device`.

### System 2.x

Versions of BX 2.x depend upon [libbitcoin-system](https://github.com/libbitcoin/libbitcoin-system#readme) (formerly just `libbitcoin`) [v2.7.0](https://github.com/libbitcoin/libbitcoin-system/releases/tag/v2.7.0) through [v2.12.0](https://github.com/libbitcoin/libbitcoin-system/releases/tag/v2.12.0), the one library used by all others. System v2.7.0 did not provide random number generation. By the final 2.x releases the random number generation from BX had been moved into system, a consequence of pseudo-randomness being required by other libraries ([link](https://github.com/libbitcoin/libbitcoin-system/blob/v2.12.0/src/utility/random.cpp)).

```
using namespace boost::posix_time;

// DO NOT USE srand() and rand() on MSVC as srand must be called per thread.
// As a result it is difficult to use safely.

// Not fully testable due to lack of random engine injection.
// This may be truly random depending on the underlying device.
uint64_t pseudo_random()
{
    std::random_device device;
    std::uniform_int_distribution<uint64_t> distribution;
    return distribution(device);
}

// Not fully testable due to lack of random engine injection.
// This may be truly random depending on the underlying device.
void pseudo_random_fill(data_chunk& chunk)
{
    std::random_device device;
    std::uniform_int_distribution<uint16_t> distribution;
    for (uint8_t& byte: chunk)
    {
        // uniform_int_distribution is undefined for sizes < 16 bits,
        // so we generate a 16 bit value and reduce it to 8 bits.
        byte = distribution(device) % std::numeric_limits<uint8_t>::max();
    }
}

// Not fully testable due to lack of random engine injection.
// Randomly select a time duration in the range [expiration/ratio, expiration].
time_duration pseudo_randomize(const time_duration& expiration, uint8_t ratio)
{
    if (ratio == 0)
        return expiration;

    const auto max_expire = expiration.total_seconds();
    if (max_expire == 0)
        return expiration;

    const auto offset = max_expire / ratio;
    const auto random_offset = static_cast<int>(bc::pseudo_random() % offset);
    const auto expire = max_expire - random_offset;
    return seconds(expire);
}
```

Several observations on the above code and comments are in order.

* Comments show that true randomness is not expected.
* The fill function is based on `std::random_device` for all 2.x versions of BX.
* The formerly BX functions have been renamed from "random" to explicitly "pseudo\_random".
* New 64 bit and time duration functions have been added (unrelated to key seeding).
* Potential thread safety issues have been commented.

### System 3.x

System v3 incorporated an implementation change to the system v2 `pseudo_random` functions. This was precipitated by a [message](https://lists.dyne.org/lurker/message/20161021.150301.991e08a1.en.html) posted to the Libbitcoin mailing list. It was determined that the lack of thread safety of the `pseudo_random` functions was causing a failure in the p2p protocol networking stack for pending version 3. The network stack used the `pseudo_random()` function to select peer network addresses.

The [corresponding issue](https://github.com/libbitcoin/libbitcoin-network/issues/72) links the Stack Overflow topic [C++11 Thread safety of Random number generators](https://stackoverflow.com/questions/8813592/c11-thread-safety-of-random-number-generators).

> Just as containers need locks to make them safe to share, you would have to lock the PRNG object. This would make it slow and nondeterministic. One object per thread would be better.

Based on this recommendation, the `pseudo_random` functions were modified to [Make random number generation thread safe and optimal](https://github.com/libbitcoin/libbitcoin-system/pull/559/commits/6d5a06e283d81260165e0eab95175069bf03b408). The "thread safe and optimal" annotation is specifically a reference to:

* [std::chrono](https://en.cppreference.com/w/cpp/chrono/high_resolution_clock) calls to obtain current time are thread safe.
* [std::random\_device](https://en.cppreference.com/w/cpp/numeric/random/random_device) calls are not assured to be thread safe (avoided).
* [Deterministic engine](https://en.cppreference.com/w/cpp/numeric/random/mersenne_twister_engine) ensures there is no state shared across instances.
* Thread static engine instance avoids repeating initialization and high cost of explicit locking to protect state.
* Not all supported C++11 [compilers](https://stackoverflow.com/questions/8772733/c11-thread-local-keyword-support-in-visual-studio-11) fully implemented the [thread\_local](https://en.cppreference.com/w/cpp/language/storage_duration) keyword, hence the use of [boost::thread\_specific\_ptr](https://www.boost.org/doc/libs/1_83_0/doc/html/thread/thread_local_storage.html).

There was no objective to make the `pseudo_random` functions cryptographically secure, nor were they previously.

```
using namespace bc::asio;
using namespace std::chrono;

// DO NOT USE srand() and rand() on MSVC as srand must be called per thread.
// Values may be truly random depending on the underlying device.

static uint32_t get_clock_seed()
{
    const auto now = high_resolution_clock::now();
    return static_cast<uint32_t>(now.time_since_epoch().count());
}

static std::mt19937& get_twister()
{
    // Boost.thread will clean up the thread statics using this function.
    const auto deleter = [](std::mt19937* twister)
    {
        delete twister;
    };

    // Maintain thread static state space.
    static boost::thread_specific_ptr<std::mt19937> twister(deleter);

    // This is thread safe because the instance is static.
    if (twister.get() == nullptr)
    {
        // Seed with high resolution clock.
        twister.reset(new std::mt19937(get_clock_seed()));
    }

    return *twister;
}

uint64_t pseudo_random()
{
    return pseudo_random(0, max_uint64);
}

uint64_t pseudo_random(uint64_t begin, uint64_t end)
{
    std::uniform_int_distribution<uint64_t> distribution(begin, end);
    return distribution(get_twister());
}

void pseudo_random_fill(data_chunk& chunk)
{
    // uniform_int_distribution is undefined for sizes < 16 bits.
    std::uniform_int_distribution<uint16_t> distribution(0, max_uint8);

    for (auto& byte: chunk)
        byte = static_cast<uint8_t>(distribution(get_twister()));
}

// Randomly select a time duration in the range:
// [(expiration - expiration / ratio) .. expiration]
// Not fully testable due to lack of random engine injection.
asio::duration pseudo_randomize(const asio::duration& expiration,
    uint8_t ratio)
{
    if (ratio == 0)
        return expiration;

    // Uses milliseconds level resolution.
    const auto max_expire = duration_cast<milliseconds>(expiration).count();

    // [10 secs, 4] => 10000 / 4 => 2500
    const auto limit = max_expire / ratio;

    if (limit == 0)
        return expiration;

    // [0..2^64) % 2500 => [0..2500]
    const auto random_offset = static_cast<int>(pseudo_random(0, limit));

    // (10000 - [0..2500]) => [7500..10000]
    const auto expires = max_expire - random_offset;

    // [7.5..10] second duration.
    return milliseconds(expires);
}
```

Note that the following comment had evolved to become obsolete, but was not removed. Despite no longer being correct it continued to show (correctly) that true randomness cannot be relied upon.

> // Values may be truly random depending on the underlying device.

## Entropy

A pseudorandom number *generator* ([PRNG](https://en.wikipedia.org/wiki/Pseudorandom_number_generator)) can be cryptographically secure ([CSPRNG](https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator)) or not. However a CSPRNG is deterministic, it cannot produce a sequence of cryptographically secure numbers unless it has been seeded by a true random number generator ([TRNG](https://en.wikipedia.org/wiki/Random_number_generation#True_vs._pseudo-random_numbers)). No amount of sophistication in a CSPRNG can compensate for a seed that is not truly random.

### C++11 Random

> None of the random number engines provided by the standard library are cryptographically secure.

<https://en.cppreference.com/w/cpp/numeric/random>

> std::random\_device may be implemented in terms of an implementation-defined pseudo-random number engine if a non-deterministic source (e.g. a hardware device) is not available to the implementation. In this case each std::random\_device object may generate the same number sequence.

<https://en.cppreference.com/w/cpp/numeric/random/random_device>

`std::random_device` cannot be relied upon as a TRNG, and neither `std::default_random_engine` nor `std::uniform_int_distribution` are CSPRNGs. Quite clearly neither BX nor SX ever provided cryptographically secure entropy. This is why BX requires that entropy be provided via the command line, with no default. The `bx seed` command was retained as a "convenience" for the vast majority of BX use cases - where true randomness is not required. In documentation of some [other commands](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-hd-to-ec/cb2ccf9b8629bc51cb2a12150c3d697a3344f805), `bx seed` was sometimes presented as a stand-in for user-provided entropy, as that is one reason it existed.

So while [std::mt19937](https://en.cppreference.com/w/cpp/numeric/random/mersenne_twister_engine) is not a CSPRNG, [std::random\_device](https://en.cppreference.com/w/cpp/numeric/random/random_device) is not a TRNG. If one does not have a TRNG, there is no point in a CSPRNG and one might as well seed the sequence with the system clock.

### Platform Unsuitability

Even setting aside these considerations, there is the simple fact that no software application can assure that it is being provided true randomness from the operating system. Nor can the operating system offer any assurance that it is being provided true randomness from the underlying hardware/firmware platform. And finally, there is no effective way for a user to audit platform RNG output.

Below [nullc describes](https://news.ycombinator.com/item?id=37056541) how Bitcoin Core attempts to mitigate this well known weakness. Note that this mitigation is obscurity, not cryptographic security. It is described as a "hail mary so the user might have some chance to move their funds if they learn about vulnerabilities in their OS/hardware RNGs before an attacker can brute force out the weak sources."

![hail-mary](CVE-2023-39910/hail-mary.png)

Below [gmaxwell describes](https://bitcointalk.org/index.php?topic=5462674.msg62688548#msg62688548) how operating system secure seeding of an RNG "isn't guaranteed." Yet this is followed by, "Basically it seems they changed from code that had security problems in theory but usually not (and maybe never) in practice to code that was certainly broken all the time for everyone in both theory and practice."

![os-no-guarantee](CVE-2023-39910/os-no-guarantee.png)

Security problems "in theory", "usually not", "maybe never" seems to imply that trusting the platform is sufficient. Nearly a decade of history shows that Libbitcoin developers have not accepted this weak assumption. While the change to implementation for version 3.0 was initiated due to a thread safety bug in the pre-release code, the removal of the (possible) platform RNG dependency was also expected to demonstrate clearly in the code as well, that there was no expectation of true randomness.

It is also demonstrably false that platform seeding is rarely if ever insecure. The [MinGW](https://en.wikipedia.org/wiki/MinGW) platform, used by Bitcoin Core and other applications to produce Windows builds, implemented a wholly insecure `std::random_device`. In fact the internal implementation used the same `std::mt19937` engine later explicitly used in BX version 3, and seeded the engine with a *fixed value*. In other words, the platform implementation was actually *worse* than the *intentional* function in BX 3.

![mingw](CVE-2023-39910/mingw.png)

This behavior was [observed](https://stackoverflow.com/questions/18880654/why-do-i-get-the-same-sequence-for-every-run-with-stdrandom-device-with-mingw) at least as early as 2013, [reported in 2018, and finally patched in 2021](https://gcc.gnu.org/bugzilla/show_bug.cgi?id=85494).

Similarly, in 2013 the Bitcoin Foundation made the following [announcement](https://bitcoin.org/en/alert/2013-08-11-android).

![android-rng](CVE-2023-39910/android-rng.png)

> We recently learned that a component of Android responsible for generating secure random numbers contains critical weaknesses, that render all Android wallets generated to date vulnerable to theft.

Apart from implementation flaws and limitations, platform RNGs present an obvious [attack vector](https://en.wikipedia.org/wiki/Random_number_generator_attack), and are known to have been [exploited by state-level actors](https://archive.nytimes.com/bits.blogs.nytimes.com/2013/09/10/government-announces-steps-to-restore-confidence-on-encryption-standards/). Trust in the platform as a TRNG is not safe, not necessary, and not reasonably auditable. It is not possible for a user to know if their computer, even if entirely air-gapped, has a subverted RNG. The random output of two or more independent computers cannot be compared.

### Best Practices

There are well-documented [best practices](https://glacierprotocol.org/) for entropy generation, which can be as simple as dice rolls.

![glacier](CVE-2023-39910/glacier.png)

Libbitcoin leaves live wallet entropy generation to the developer, who may instruct their end user on such best practices. SX did not document the expected behavior of its various seeded commands, which hardwired insecure platform entropy generation. However from the first release of BX, all commands/functions that use entropy for wallet seeding require it be passed as an argument.

### Security Guarantee

Despite its focus on Mersenne Twister, the [Technical write-up](https://milksad.info/disclosure.html#suspected-rng-problems-in-older-bx-versions) does not claim that the above thread safety change for [System 3.x](#system-3x) turned a cryptographically secure implementation into an insecure one.

![ms-old-versions](CVE-2023-39910/ms-old-versions.png)

> Specifically, the `std::random_device` entropy source in combination with `std::default_random_engine` may not behave securely enough if the random engine uses insufficient seeding and acts as a non-CSPRNG similar to Mersenne Twister.

Actually, as explained [above](#entropy), limitations apply to *both* `std::random_device` and `std::default_random_engine`. The former provides a seed for the latter. This seed is not guaranteed to be truly random and the latter is explicitly not cryptographically secure. In fact the [MinGW implementation](https://en.cppreference.com/w/cpp/numeric/random/random_device) of `std::random_device` seeds `std::mt19937` with a *fixed value* and is consistent with the C++ specification ("A notable implementation where std::random\_device is deterministic.").

Furthermore, even if the `std::random_device` happens to provide true randomness for a given compiler, operating system, *and* hardware instance, none of the random number engines provided by the standard library are cryptographically secure. It cannot therefore be the case that there was a change to the security guarantee supposedly offered by the libbitcoin-system `pseudo_random` functions from version 2 to 3.

As this incident has shown, people reviewing sources may not be familiar with or consult C++ documentation. Some have *assumed* that version 2 utilized a TRNG *and* a CSPRNG. It is less likely for a developer to make this erroneous assumption given an explicitly clock-seeded Mersenne Twister.

## Mastering Bitcoin

### Misleading Generalization

It is stated in the [Disclosure](https://milksad.info/) that, "Popular documentation like '[Mastering Bitcoin](https://bitcoinbook.info/)' suggests the usage of bx seed for wallet generation." The example of such a supposed "suggestion" is contained within the included image (unrelated bullets removed).

![ms-mastering-examples](CVE-2023-39910/ms-mastering-examples.png)

It's not clear how the Disclosure authors consider "examples of using Bitcoin Explorer commands to experiment with keys and addresses" a suggestion to use `bx seed` for wallet generation. The statement explicitly describes *experimentation*, which is the primary use case for BX (Bitcoin *Explorer*).

### Content Misattribution

It is stated in the [Technical write-up](https://milksad.info/disclosure.html#libbitcoin-team-response-and-context) that, "A Libbitcoin team member [adds](https://github.com/bitcoinbook/bitcoinbook/commit/76c5ba8000d6de20b4adaf802329b501a5d5d1db) and updates `bx seed` usage suggestions to 'Mastering Bitcoin'" and "When adding bx seed related workflows to the 'Mastering Bitcoin' book appendix, Libbitcoin team members described it as follows" (unrelated context removed from image below).

![ms-mastering-author](CVE-2023-39910/ms-mastering-author.png)

The above link to the supposed addition of BX by a Libbitcoin team member shows addition of a [new page named 'appdx-bx-asciidoc'](https://github.com/bitcoinbook/bitcoinbook/commit/76c5ba8000d6de20b4adaf802329b501a5d5d1db#diff-7a291d80bf434822f6a737f3e564be6a67432e2f3f12669cf0469aedf56849bb). However this is actually a rename of the [pre-existing page 'appdx-sx-asciidoc'](https://github.com/bitcoinbook/bitcoinbook/commit/76c5ba8000d6de20b4adaf802329b501a5d5d1db#diff-acd96b9240c94871c904cd0d847f376148e3303fdc5f9e5080018d554a686abc). The [history of the preexisting SX page](https://github.com/bitcoinbook/bitcoinbook/commits/406a3303bb693961caa405c925ae6970285f8a9c/appdx-sx.asciidoc) shows addition by the author and no inputs from Libbitcoin team members. It's not clear why the technical write-up doesn't establish this clear connection and instead states that a Libbitcoin team member created the initial content, especially given the following reference in the write-up to SX.

> Libbitcoin Explorer predecessor tool [adds](https://github.com/BWallet/sx/commit/482255da51749300804bfb7d9998bf2604587d3b) a `newseed` command for entropy generation

The above link is to a repository called [BWallet](https://github.com/BWallet). This is not the SX origin repo and is not associated with any Libbitcoin team members. It is possible that the technical write-up authors did not understand that BX is the rebranded 2.0 version of SX (even sharing the same repo and history). Otherwise it may be that the authors are [hair-splitting](https://en.wiktionary.org/wiki/hairsplitting) by not considering the BX content an edit to the author's SX content, given the distinct names. In any case it is very clear from a [comparison](https://github.com/bitcoinbook/bitcoinbook/commit/76c5ba8000d6de20b4adaf802329b501a5d5d1db) of the book sources that the edits provided by the Libbitcoin team were made strictly from the standpoint of updating content from SX to the BX equivalent.

Mastering Bitcoin's authors initially incorporated the following statement:

> Generate a new private key with the operating system's random number generator by using the `newkey` command. We save the standard output into the file *private\_key*.

This was revised by a Libbitcoin maintainer to the following:

> Generate a random "seed" value using the `seed` command, which uses the operating system's random number generator. Pass the seed to the `ec-new` command to generate a new private key. We save the standard output into the file *private\_key*.

The two step process is a consequence of BX requiring entropy on the command line for `ec-new` as opposed to embedding it within the `newkey` command. This is strictly the equivalent of the original SX content. Furthermore the reference to the "operating system's random number generator" is correct in both instances, for SX and for *all versions* of BX 2.x (as shown above), to the extent that [std::random\_device](https://en.cppreference.com/w/cpp/numeric/random/random_device) passes to the OS. Finally, as has been shown above in relation to the `cert-new` command documentation, it is clear that the Libbitcoin team considered this reference a *warning* (from the book's author).

On [Apr 15, 2014](https://lists.dyne.org/lurker/message/20140415.194323.2f2ea585.en.html) the Libbitcoin team was notified that libbitcoin (system) and SX were to be included in a new Bitcoin book (Mastering Bitcoin).

```
Author: Amir Taaki
Date: 2014-04-15 13:43 -400
To: Libbitcoin
Subject: Re: [Libbitcoin] config file stuff @evoskuil

btw andreas wants to have a libbitcoin section + use the sx tools for
examples throughout the book about bitcoin.

if we can make a single binary it can be distributed with the cd.

http://shop.oreilly.com/product/0636920032281.do

```

In the interim SX was incorporated into Mastering Bitcoin by the book's author. Once BX was tagged for release (on Dec, 13 2014) the Libbitcoin team created a [pull request](https://github.com/bitcoinbook/bitcoinbook/pull/162/commits) that included the BX updates (dated Jan 19, 2015) and contacted the author, who merged the PR (on Feb 22, 2015). These updates were provided as a courtesy for the author, who had been in touch with the Libbitcoin team since deciding to incorporate SX. As far as we know there have been no contributions to Mastering Bitcoin by Libbitcoin maintainers since.

### Incompatibility

BX 3.0 was tagged for release on Mar 8, 2017, more than two years after the BX 2.0 updates were merged into Mastering Bitcoin. Libbitcoin system and BX 3.0 both implemented breaking interface changes, as well as the change to the `pseudo_random` implementation described in detail [above](#system-3x). The Libbitcoin documentation for the `bx seed` command did not change with the release of version 3.0, as the text and warning remained correct. However the comment regarding operating system sourcing of entropy, that originated with the author's description of `sx newkey`, was not accurate in relation to BX version 3 - at least to the extent it was previously accurate (see [above](#entropy)). However, Mastering Bitcoin has never been compatible with libbitcoin/bx version 3.

### Download Warning

In lieu of the aforementioned CD distribution, a [landing page](https://github.com/libbitcoin/libbitcoin-explorer/wiki/Download-BX/c73ac99fff07fe3d5e544698483ddda9fbea2929) with binary downloads for testnet and mainnet was created for the book. This included a substantial warning. BX is a large set of very powerful tools and exposing these to non-developers (such as those who may not even understand how to build the tools) carries risk.

![bx-download-page](CVE-2023-39910/bx-download-page.png)

## Documentation

### Easily Discoverable

A link to BX documentation is the first line of the [BX readme](https://github.com/libbitcoin/libbitcoin-explorer/blob/version3/README.md) (the home page for BX generally). There is one sidebar menu displayed for the documentation, including one entry for each command, linking to one simple page for the command. It has been suggested that the documentation is "buried" in a wiki. The fact that these pages are implemented in a GitHub wiki does not make them less relevant or harder to find, it makes them easier to maintain and provides a complete public change history. This is the documentation that the team maintains, which could only be missed in the case where one does not care to read it.

### Warning in Context

![ms-documentation](CVE-2023-39910/ms-documentation.png)

The above clip from the [Technical write-up](https://milksad.info/disclosure.html#libbitcoin-team-response-and-context) states:

> We're aware of a single warning note in the bx seed documentation page in the wiki...

There has always been one page per command, one `bx seed` command, and one warning on that page. BX is not a consumer wallet, it is a developer tool. It is in fact expected that developers read the relevant documentation, especially if they intend to put their own or others' coin at risk.

The write-up then shows the `bx seed` documentation warning, but does not present it in context. The full context is:

![bx-seed-warning](CVE-2023-39910/bx-seed-warning.png)

The command is documented to "Generate a pseudorandom seed" and directly follows with "WARNING: Pseudorandom seeding can introduce cryptographic weakness into your keys." There can be no doubt that *using the command* is what is being warned against.

The write-up then states:

> The wording "can introduce" is quite weak and a user may not be aware that this produces a seed that is completely insecure...

Whether it "can" (version 2.x) or "will" (version 3.x) is immaterial to the warning. The documentation is provided for all versions. The equivalent statement, "doing this can cause you to lose all of your coin" would not be "quite weak". Focus on the word "can" in this context is [nitpicking](https://en.wiktionary.org/wiki/nitpicking), and there is a [link](https://cwe.mitre.org/data/definitions/338.html) provided in case the developer does not understand the implications of "cryptographic weakness".

> ...and should not be used to store anything of value.

The documentation exists to describe how the commands work. As a matter of convention Libbitcoin avoids telling developers what they "should" do.

The addendum "provided as a convenience" admittedly lacks context, but does not soften the preceding warning.

Some have argued that the term "pseudorandom", as used in the `bx seed` warning above, implies the use of a "cryptographically secure pseudorandom number generator." This ignores the actual distinction between the definitions of PRNG and CSPRNG. A PRNG implies pseudorandomness, not cryptographically secure pseudorandomness. Rectangle does not imply square. The additional warning regarding "cryptographic insecurity" exists specifically to remove any doubt. While it is possible that upon reading this warning a developer might *still* choose to seed a live wallet with `bx seed`, this seems unlikely.

### Random Numbers Topic

Software CANNOT provide true randomness and CANNOT ensure that underlying hardware does so. From the first release of BX (there was no actual "release" of SX) there was a clear objective to make entropy generation the responsibility of the user. This is evident from the move of seeding in each SX command from hard-wired internal to command line arguments in BX, explicit warnings in both the `bx seed` and `bx cert-new` command documentation, source comments ("may be truly random...") which indicate that true randomness cannot be expected, and a documentation topic entitled [Random Numbers](https://github.com/libbitcoin/libbitcoin-explorer/wiki/Random-Numbers/086fb5b4a159858dc7045a91ad02f789573ed953).

![random-numbers](CVE-2023-39910/random-numbers.png)

This topic, in place since Dec 11, 2014, makes it abundantly clear that entropy was moved to the command line because, "a weak random number generator can introduce cryptographic weakness." It further explains that this move, "places the responsibility of ensuring random number strength on end-users and also helps them understand the potential for problems." It also cautions that `bx cert-new` does not allow user-provided entropy, and explains why. And finally, it states that "The 'seed' command is provided as a convenience." In this context it should be evident what was intended by "convenience", a phrase reproduced in the `bx seed` documentation.

### Documentation not Redundant

The write-up lists a number of examples where `bx seed` is used and no warning is provided. The `bx seed` documentation is on the `bx seed` documentation page, it is not repeated on documentation for *other commands*.

![ms-documentation-commands](CVE-2023-39910/ms-documentation-commands.png)

### Consistency Seems Strange

The write-up offers the idle speculation that the `bx seed` length constraint "seems strange" given that the command is not intended for live wallet seeding (yet does not speculate about why its documentation refers to *seed* and *length* as opposed to *entropy* and *strength*).

![ms-notable-characteristics](CVE-2023-39910/ms-notable-characteristics.png)

> It seems strange that the design explicitly prevents the user from creating a seed that is too short, but does not prevent him from creating a seed that has not enough randomness.

It is not clear what "seems strange" with a seeding command, in a suite of commands, requiring sufficient length to not cause error propagation to those other commands. All BX commands validate (and document) their parameters to the extent practical. It would only be strange if this one command did not.

## Feature or Bug

It seems certain, and the Libbitcoin team accepts, that the documentation was insufficient to prevent unintended use. However this is a far cry from "bad cryptography", which the Technical write-up asserts based *entirely* on observations that the documentation is *not redundant*.

![ms-disagreement](CVE-2023-39910/ms-disagreement.png)

> By our understanding, they consider bx seed a command that should never be used productively by any bx user since it is sufficiently documented as unsuited for safe wallet generation.

It is the case that the `bx seed` command is not intended to be used "productively". The Libbitcoin team does not consider this the case merely because "it is sufficiently documented" as unsuitable for productive use. It is the case because that is the intent, as expressed in documentation and associated code/comment history. Whether the documentation is "sufficient" is an independent and entirely subjective question.

This is the difference between "bad cryptography" and some combination of user error and poor documentation. The write-up authors chose to omit their knowledge that, "neither party consulted the wiki on bx seed before using it" - which certainly seems material given the focus on documentation quality. No warnings in the documentation for other commands, or refinements of the `bx seed` command documentation could have prevented such failures. Comments in the write-up about sufficiency are both subjective and speculative.

Given the ample evidence above, all of which was referenced in one way or another by the write-up authors, it is not clear why they have rejected that `bx seed` was never intended for "productive" seeding.

## Communication

![ms-contacts](CVE-2023-39910/ms-contacts.png)

On 7/22/2023 at 11:43 Phillip Mienk's wife gives premature birth to their first child. 13 minutes later he receives the first contact, addressed to him personally. On 7/26/2030 Eric Voskuil departs the Seattle area for the Boston area in full size U-Haul, unloaded on 8/5/2023.

The technical write-up states, "First Libbitcoin team response, indicating team is too busy for contact." Despite the extraordinary circumstances, Phillip actually responded, "I apologize, as unrelated circumstances may have both of us slow to respond in the immediate future. I'm happy to look into and relay any concerns." As the write-up mischaracterizes the communication, it is reproduced below.

> > > > > > On 7/22/23 11:56 Lance Vick wrote:
> > > > > >
> > > > > > I have a libbitcoin security issue I need to discuss to help understand the impact of.
> > > > > >
> > > > > > It seems you are one of the few recently active people. Are you the
> > > > > > right person to talk to or are there others I should loop in?
> > > > > >
> > > > > > Also reached out in the IRC room.
> > > > >
> > > > > On 7/25/23 01:43, Phillip Mienk wrote:
> > > > >
> > > > > Hi Lance,
> > > > >
> > > > > Myself and Eric Voskuil would be your best bets. I apologize, as unrelated circumstances may have both of us slow to respond in the immediate future. I'm happy to look into and relay any concerns.
> > > > >
> > > > > -- Phillip
> > > >
> > > > On 7/25/23 01:55, Lance Vick wrote:
> > > >
> > > > My team and I have been investigating a sweep of thousands of wallets recently, and in at least two cases so far the root cause was confirmed to be a flaw in libbitcoin, present in all 3x releases.
> > > >
> > > > We are currently investigating the scope of the impact and preparing a public disclosure strategy and as such we are hesitant to reveal the exact details of the vulnerability just yet as our adversaries are still actively sweeping wallets.
> > > >
> > > > At this stage we are seeking to identify victims and potential victims.
> > > >
> > > > If you or anyone on your team are aware of anyone that has used libbitcoin to build any wallet software or to generate private keys of any kind, even for cold wallets, we would like to get in touch.

The contact is "without vulnerability details" and requests only that team members identify Libbitcoin users. As the team does not track usage there is no such knowledge, and in this case no response is expected ("If you or anyone on your team are aware...").

The next response is that, "We haven't heard back from you, but have to move forward with the disclosure for reasons listed below." This is a bit confusing as it implies there was some other expectation than the request to identify Libbitcoin users. At this point, "technical vulnerability details and detailed disclosure context," are finally disclosed to the team.

> > > > On 8/3/2023 07:08, Lance Vick wrote:
> > > >
> > > > Hello again,
> > > >
> > > > We haven't heard back from you, but have to move forward with the disclosure for reasons listed below.
> > > >
> > > > In summary, the "bx seed" (now "bx entropy") wallet entropy generation in libbitcoin-explorer/libbitcoin-system has effectively the same fatal flaw as Trust Wallet. The use of 32 bit Mersenne Twister as the PRNG source for long-lived cryptographic key material is highly problematic, and the use of time for seeding is a secondary problem.
> > > >
> > > > Please see CVE-2023-31290 and <https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen/> for technical information.
> > > >
> > > > As a result of this flaw, all funds stored on these wallets are open to theft as the private keys can be recovered with moderate amounts of computation (a few days on a single server). Note that we were not involved in CVE-2023-31290 and have only learned of it recently as part of our own research.
> > > >
> > > > After the disclosure of CVE-2023-31290, malicious actors discovered that bx has a similar flaw, and have drained at least $0.8M worth of BTC plus other funds in June/July 2023 from wallets originally created with bx. We discovered this after being affected through more than one of these wallets, with funds lost on our end as well. We've comprehensively reproduced this issue over the last days to understand the attack that happened on us and other users.
> > > >
> > > > Unfortunately, no patch to the software will help the already impacted users. Considering the active exploitation, monetary loss and this patch context, we feel a rapid disclosure is needed. Our current public disclosure is planned for sometime next week, exact date to be determined. We're planning to file a CVE for the issue in bx this week.
> > > >
> > > > That said, if you or anyone on your side feels there is any strong reason to slow down our timeline, please do let us know as soon as possible so that we can take it into consideration.
> > > >
> > > > We strongly ask you to keep this advance notice confidential so that we can make a comprehensive public disclosure with all relevant details. Our goal is to hopefully avoid panic for the -majority- of cryptocurrency users that are not impacted.

Less than two hours later, while in transit, Eric responds with a link to the `bx seed` documentation page. Later, after arriving at his destination, he responds in greater detail that the issue is not a bug in Libbitcoin, again citing the warning against such use.

> > > On 8/3/23 08:51, Eric Voskuil wrote:
> > >
> > > <https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-seed>
> > >
> > > On 8/5/23 06:22, Eric Voskuil wrote:
> > >
> > > Hello,
> > >
> > > I’ve been traveling and moving across country, but sent you a quick note a couple days ago.
> > >
> > > I did not respond to your first query because you did not provide any indication of what the supposed issue was. We do not track Libbitcoin users.
> > >
> > > BX does not create a wallet and strongly warns against using its explicitly pseudorandom entropy generator for wallet entropy. The command is documented as a convenience tool only, and exists to demonstrate behavior.
> > >
> > > Libbitcoin (bx or otherwise) does not internally provide entropy to wallet generation. Entropy must be explicitly passed to key generating functions. Passage of the PRNG output is explicitly warned against, and any competent wallet producer would never consider doing this.
> > >
> > > This is not a bug in Libbitcoin, it is a bug in wallets. As a developer library Libbitcoin cannot prevent insecure use of its code in clear violation of its documentation. If you choose to submit a CVE report we will of course provide this information and publicly dispute the assertion that this is a Libbitcoin flaw.
> > >
> > > We thank you for bringing this to us first. Hopefully this helps.
> > >
> > > Best,
> > > Eric

The next day the authors respond without explanation that, "we do not fully agree with your assessment... we have already filed for a CVE."

> > On 8/6/2023 18:57, Lance Vick wrote:
> >
> > Hello Eric,
> >
> > Thank you for letting us know your thoughts.
> >
> > Given the circumstances, we do not fully agree with your assessment.
> >
> > We want to let you know that we have already filed for a CVE for the problems in bx 3.x, and are currently preparing a disclosure for publication in the next few days.
> >
> > Additionally, we would like to let you know that we became aware today of separate RNG related entropy problems in bx versions before 3.0.0., which affect the secure operation of `bx seed` in some system environments.
> > Given your stated view on the issue, and our current initial technical understanding of the comparable characteristics and implications, we see this as a variant of the previously explained vulnerability.
>
> On 8/6/23 16:42, Eric Voskuil wrote:
>
> Hi Lance,
>
> You have not explained how exactly you consider this a "vulnerability" given use against explicit warnings in documentation.
>
> Having filed without apparently having read the documented use seems a bit careless.
>
> Best,
> Eric

Note the earlier comment, "We discovered this after being affected through more than one of these wallets, with funds lost on our end as well." We were later informed that their loss constituted a substantial part of the whole and that they had not read the `bx seed` documentation. In other words, the authors failed to disclose that they were personally and materially affected, and faulted the *implementation* of Libbitcoin despite documentation to the contrary which they did not actually read.

This conflict of interest may explain why they were quick to dismiss the possibility of user error and/or poor documentation despite the evidence that the behavior was intended. Additionally several members of the write-up team are [advertising their commercial consulting services](https://milksad.info/faq.html) on the back of the disclosure.

![ms-faq-for-hire](CVE-2023-39910/ms-faq-for-hire.png)

Certain of these same experts failed to consult the only documentation for the only BX command they used to establish wallets, "because it seemed like a dead simple OS entropy sampling tool." They used these wallets for a substantial amount of coin, "for years." They concluded that, "After the disclosure of CVE-2023-31290, malicious actors discovered that bx has a similar flaw..." and proceeded to pin their lapses entirely on "bad cryptography". In doing so they then failed to publicly disclose both their conflict of interest and their failure to consult documentation. It's not known to us whether their customer coin was placed at risk, yet even if the loss was limited to their own there would presumably be reputational damage to their business(es) in accepting responsibility.

## Exposure

The [Technical write-up](https://milksad.info/disclosure.html#searching-for-wallets---implementation) authors "identified less than 50 wallets with more individual usage patterns that we associate with likely use by human wallet owners", an amount that they assume may be incomplete. They add the observation that, "A decent portion of the discovered individually used wallets did not have any BTC funds on them since before 2023, so no money could be moved away from them by the attackers."

![ms-usage](CVE-2023-39910/ms-usage.png)

In other words, over the more than five years since the release of BX 3.0, a "decent portion" less than some amount "less than 50" individually-used wallets are known to have been vulnerable in 2023. This includes an undisclosed number ("more than one") of the authors' own wallets. Unfortunately it is impossible to know how many people other than the write-up authors themselves used `bx seed` as a live wallet entropy source (and of those how many read its documentation). But by this current count, it does not appear to have been very common. This observation is of course not intended to minimize the loss of coin, by any party. However it does speak to the speculative nature of the write-up.

## Response

As there is no way to ensure that a seeding command would not be misused, and one cannot be made cryptographically secure in software, the command has been [removed](https://github.com/libbitcoin/libbitcoin-explorer/pull/729). The convenience of a command that provides a properly formatted seed for the most common scenarios is lost, but there is no longer opportunity for its misuse.

[Users](Home) |
[Developers](https://github.com/libbitcoin/libbitcoin-explorer/blob/master/README.md) |
[License](https://github.com/libbitcoin/libbitcoin-explorer/blob/master/COPYING) |
Copyright © 2011-2024 libbitcoin developers

### Toggle table of contents Pages 137

* Loading

  [Home](/libbitcoin/libbitcoin-explorer/wiki)
* Loading

  [Acronyms](/libbitcoin/libbitcoin-explorer/wiki/Acronyms)
* Loading

  [Background](/libbitcoin/libbitcoin-explorer/wiki/Background)
* Loading

  [Build](/libbitcoin/libbitcoin-explorer/wiki/Build)
* Loading

  [Build BX](/libbitcoin/libbitcoin-explorer/wiki/Build-BX)
* Loading

  [bx address decode](/libbitcoin/libbitcoin-explorer/wiki/bx-address-decode)
* Loading

  [bx address embed](/libbitcoin/libbitcoin-explorer/wiki/bx-address-embed)
* Loading

  [bx address encode](/libbitcoin/libbitcoin-explorer/wiki/bx-address-encode)
* Loading

  [bx address validate](/libbitcoin/libbitcoin-explorer/wiki/bx-address-validate)
* Loading

  [bx base16 decode](/libbitcoin/libbitcoin-explorer/wiki/bx-base16-decode)
* Loading

  [bx base16 encode](/libbitcoin/libbitcoin-explorer/wiki/bx-base16-encode)
* Loading

  [bx base58 decode](/libbitcoin/libbitcoin-explorer/wiki/bx-base58-decode)
* Loading

  [bx base58 encode](/libbitcoin/libbitcoin-explorer/wiki/bx-base58-encode)
* Loading

  [bx base58check decode](/libbitcoin/libbitcoin-explorer/wiki/bx-base58check-decode)
* Loading

  [bx base58check encode](/libbitcoin/libbitcoin-explorer/wiki/bx-base58check-encode)
* Loading

  [bx base64 decode](/libbitcoin/libbitcoin-explorer/wiki/bx-base64-decode)
* Loading

  [bx base64 encode](/libbitcoin/libbitcoin-explorer/wiki/bx-base64-encode)
* Loading

  [bx bitcoin160](/libbitcoin/libbitcoin-explorer/wiki/bx-bitcoin160)
* Loading

  [bx bitcoin256](/libbitcoin/libbitcoin-explorer/wiki/bx-bitcoin256)
* Loading

  [bx btc to satoshi](/libbitcoin/libbitcoin-explorer/wiki/bx-btc-to-satoshi)
* Loading

  [bx cert new](/libbitcoin/libbitcoin-explorer/wiki/bx-cert-new)
* Loading

  [bx cert public](/libbitcoin/libbitcoin-explorer/wiki/bx-cert-public)
* Loading

  [bx ec add](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-add)
* Loading

  [bx ec add secrets](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-add-secrets)
* Loading

  [bx ec multiply](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-multiply)
* Loading

  [bx ec multiply secrets](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-multiply-secrets)
* Loading

  [bx ec new](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-new)
* Loading

  [bx ec to address](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-to-address)
* Loading

  [bx ec to ek](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-to-ek)
* Loading

  [bx ec to public](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-to-public)
* Loading

  [bx ec to wif](/libbitcoin/libbitcoin-explorer/wiki/bx-ec-to-wif)
* Loading

  [bx ek address](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-address)
* Loading

  [bx ek new](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-new)
* Loading

  [bx ek public](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-public)
* Loading

  [bx ek public to address](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-public-to-address)
* Loading

  [bx ek public to ec](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-public-to-ec)
* Loading

  [bx ek to address](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-to-address)
* Loading

  [bx ek to ec](/libbitcoin/libbitcoin-explorer/wiki/bx-ek-to-ec)
* Loading

  [bx electrum new](/libbitcoin/libbitcoin-explorer/wiki/bx-electrum-new)
* Loading

  [bx electrum to seed](/libbitcoin/libbitcoin-explorer/wiki/bx-electrum-to-seed)
* Loading

  [bx fetch balance](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-balance)
* Loading

  [bx fetch block](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-block)
* Loading

  [bx fetch header](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-header)
* Loading

  [bx fetch height](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-height)
* Loading

  [bx fetch history](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-history)
* Loading

  [bx fetch public key](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-public-key)
* Loading

  [bx fetch stealth](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-stealth)
* Loading

  [bx fetch tx](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-tx)
* Loading

  [bx fetch tx index](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-tx-index)
* Loading

  [bx fetch utxo](/libbitcoin/libbitcoin-explorer/wiki/bx-fetch-utxo)
* Loading

  [bx hd new](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-new)
* Loading

  [bx hd private](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-private)
* Loading

  [bx hd public](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-public)
* Loading

  [bx hd to address](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-to-address)
* Loading

  [bx hd to ec](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-to-ec)
* Loading

  [bx hd to public](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-to-public)
* Loading

  [bx hd to wif](/libbitcoin/libbitcoin-explorer/wiki/bx-hd-to-wif)
* Loading

  [bx help](/libbitcoin/libbitcoin-explorer/wiki/bx-help)
* Loading

  [bx input set](/libbitcoin/libbitcoin-explorer/wiki/bx-input-set)
* Loading

  [bx input sign](/libbitcoin/libbitcoin-explorer/wiki/bx-input-sign)
* Loading

  [bx input validate](/libbitcoin/libbitcoin-explorer/wiki/bx-input-validate)
* Loading

  [bx message sign](/libbitcoin/libbitcoin-explorer/wiki/bx-message-sign)
* Loading

  [bx message validate](/libbitcoin/libbitcoin-explorer/wiki/bx-message-validate)
* Loading

  [bx mnemonic new](/libbitcoin/libbitcoin-explorer/wiki/bx-mnemonic-new)
* Loading

  [bx mnemonic to seed](/libbitcoin/libbitcoin-explorer/wiki/bx-mnemonic-to-seed)
* Loading

  [bx qrcode](/libbitcoin/libbitcoin-explorer/wiki/bx-qrcode)
* Loading

  [bx ripemd160](/libbitcoin/libbitcoin-explorer/wiki/bx-ripemd160)
* Loading

  [bx satoshi to btc](/libbitcoin/libbitcoin-explorer/wiki/bx-satoshi-to-btc)
* Loading

  [bx script decode](/libbitcoin/libbitcoin-explorer/wiki/bx-script-decode)
* Loading

  [bx script encode](/libbitcoin/libbitcoin-explorer/wiki/bx-script-encode)
* Loading

  [bx script to address](/libbitcoin/libbitcoin-explorer/wiki/bx-script-to-address)
* Loading

  [bx seed](/libbitcoin/libbitcoin-explorer/wiki/bx-seed)
* Loading

  [bx send tx](/libbitcoin/libbitcoin-explorer/wiki/bx-send-tx)
* Loading

  [bx send tx node](/libbitcoin/libbitcoin-explorer/wiki/bx-send-tx-node)
* Loading

  [bx send tx p2p](/libbitcoin/libbitcoin-explorer/wiki/bx-send-tx-p2p)
* Loading

  [bx settings](/libbitcoin/libbitcoin-explorer/wiki/bx-settings)
* Loading

  [bx sha160](/libbitcoin/libbitcoin-explorer/wiki/bx-sha160)
* Loading

  [bx sha256](/libbitcoin/libbitcoin-explorer/wiki/bx-sha256)
* Loading

  [bx sha512](/libbitcoin/libbitcoin-explorer/wiki/bx-sha512)
* Loading

  [bx stealth decode](/libbitcoin/libbitcoin-explorer/wiki/bx-stealth-decode)
* Loading

  [bx stealth encode](/libbitcoin/libbitcoin-explorer/wiki/bx-stealth-encode)
* Loading

  [bx stealth public](/libbitcoin/libbitcoin-explorer/wiki/bx-stealth-public)
* Loading

  [bx stealth secret](/libbitcoin/libbitcoin-explorer/wiki/bx-stealth-secret)
* Loading

  [bx stealth shared](/libbitcoin/libbitcoin-explorer/wiki/bx-stealth-shared)
* Loading

  [bx subscribe block](/libbitcoin/libbitcoin-explorer/wiki/bx-subscribe-block)
* Loading

  [bx subscribe tx](/libbitcoin/libbitcoin-explorer/wiki/bx-subscribe-tx)
* Loading

  [bx token new](/libbitcoin/libbitcoin-explorer/wiki/bx-token-new)
* Loading

  [bx tx decode](/libbitcoin/libbitcoin-explorer/wiki/bx-tx-decode)
* Loading

  [bx tx encode](/libbitcoin/libbitcoin-explorer/wiki/bx-tx-encode)
* Loading

  [bx tx sign](/libbitcoin/libbitcoin-explorer/wiki/bx-tx-sign)
* Loading

  [bx uri decode](/libbitcoin/libbitcoin-explorer/wiki/bx-uri-decode)
* Loading

  [bx uri encode](/libbitcoin/libbitcoin-explorer/wiki/bx-uri-encode)
* Loading

  [bx validate tx](/libbitcoin/libbitcoin-explorer/wiki/bx-validate-tx)
* Loading

  [bx watch address](/libbitcoin/libbitcoin-explorer/wiki/bx-watch-address)
* Loading

  [bx watch stealth](/libbitcoin/libbitcoin-explorer/wiki/bx-watch-stealth)
* Loading

  [bx watch tx](/libbitcoin/libbitcoin-explorer/wiki/bx-watch-tx)
* Loading

  [bx wif to ec](/libbitcoin/libbitcoin-explorer/wiki/bx-wif-to-ec)
* Loading

  [bx wif to public](/libbitcoin/libbitcoin-explorer/wiki/bx-wif-to-public)
* Loading

  [bx wrap decode](/libbitcoin/libbitcoin-explorer/wiki/bx-wrap-decode)
* Loading

  [bx wrap encode](/libbitcoin/libbitcoin-explorer/wiki/bx-wrap-encode)
* Loading

  [Command Equivalence](/libbitcoin/libbitcoin-explorer/wiki/Command-Equivalence)
* Loading

  [Commands](/libbitcoin/libbitcoin-explorer/wiki/Commands)
* Loading

  [Configuration Settings](/libbitcoin/libbitcoin-explorer/wiki/Configuration-Settings)
* Loading

  [CVE 2023 39910](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910)

  + [Background](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#background)
  + [Libbitcoin](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#libbitcoin)
  + [SubvertX (SX)](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#subvertx-sx)
  + [Bitcoin Explorer (BX)](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#bitcoin-explorer-bx)
  + [SX Seeding](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#sx-seeding)
  + [BX Seeding](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#bx-seeding)
  + [Versions](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#versions)
  + [System 2.x](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#system-2x)
  + [System 3.x](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#system-3x)
  + [Entropy](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#entropy)
  + [C++11 Random](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#c11-random)
  + [Platform Unsuitability](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#platform-unsuitability)
  + [Best Practices](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#best-practices)
  + [Security Guarantee](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#security-guarantee)
  + [Mastering Bitcoin](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#mastering-bitcoin)
  + [Misleading Generalization](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#misleading-generalization)
  + [Content Misattribution](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#content-misattribution)
  + [Incompatibility](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#incompatibility)
  + [Download Warning](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#download-warning)
  + [Documentation](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#documentation)
  + [Easily Discoverable](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#easily-discoverable)
  + [Warning in Context](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#warning-in-context)
  + [Random Numbers Topic](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#random-numbers-topic)
  + [Documentation not Redundant](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#documentation-not-redundant)
  + [Consistency Seems Strange](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#consistency-seems-strange)
  + [Feature or Bug](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#feature-or-bug)
  + [Communication](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#communication)
  + [Exposure](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#exposure)
  + [Response](/libbitcoin/libbitcoin-explorer/wiki/CVE-2023-39910#response)
* Loading

  [Design Overview](/libbitcoin/libbitcoin-explorer/wiki/Design-Overview)
* Loading

  [Download](/libbitcoin/libbitcoin-explorer/wiki/Download)
* Loading

  [Download BX](/libbitcoin/libbitcoin-explorer/wiki/Download-BX)
* Loading

  [Encoding Commands](/libbitcoin/libbitcoin-explorer/wiki/Encoding-Commands)
* Loading

  [Explorer Library](/libbitcoin/libbitcoin-explorer/wiki/Explorer-Library)
* Loading

  [Hash Commands](/libbitcoin/libbitcoin-explorer/wiki/Hash-Commands)
* Loading

  [Help Integration](/libbitcoin/libbitcoin-explorer/wiki/Help-Integration)
* Loading

  [How to Create a Multisig Address](/libbitcoin/libbitcoin-explorer/wiki/How-to-Create-a-Multisig-Address)
* Loading

  [How to Encrypt a Wallet Seed](/libbitcoin/libbitcoin-explorer/wiki/How-to-Encrypt-a-Wallet-Seed)
* Loading

  [How to Receive Bitcoin](/libbitcoin/libbitcoin-explorer/wiki/How-to-Receive-Bitcoin)
* Loading

  [How to Remember a Wallet Seed](/libbitcoin/libbitcoin-explorer/wiki/How-to-Remember-a-Wallet-Seed)
* Loading

  [How to Spend Bitcoin](/libbitcoin/libbitcoin-explorer/wiki/How-to-Spend-Bitcoin)
* Loading

  [How to Spend From a Multisig Address](/libbitcoin/libbitcoin-explorer/wiki/How-to-Spend-From-a-Multisig-Address)
* Loading

  [Input Processing](/libbitcoin/libbitcoin-explorer/wiki/Input-Processing)
* Loading

  [Key Encryption Commands](/libbitcoin/libbitcoin-explorer/wiki/Key-Encryption-Commands)
* Loading

  [Log Files](/libbitcoin/libbitcoin-explorer/wiki/Log-Files)
* Loading

  [Math Commands](/libbitcoin/libbitcoin-explorer/wiki/Math-Commands)
* Loading

  [Messaging Commands](/libbitcoin/libbitcoin-explorer/wiki/Messaging-Commands)
* Loading

  [Network Settings](/libbitcoin/libbitcoin-explorer/wiki/Network-Settings)
* Loading

  [Online Commands](/libbitcoin/libbitcoin-explorer/wiki/Online-Commands)
* Loading

  [Output Processing](/libbitcoin/libbitcoin-explorer/wiki/Output-Processing)
* Loading

  [Payment Address Deconstruction](/libbitcoin/libbitcoin-explorer/wiki/Payment-Address-Deconstruction)
* Loading

  [Primitive Types](/libbitcoin/libbitcoin-explorer/wiki/Primitive-Types)
* Loading

  [Random Numbers](/libbitcoin/libbitcoin-explorer/wiki/Random-Numbers)
* Loading

  [Server Settings](/libbitcoin/libbitcoin-explorer/wiki/Server-Settings)
* Loading

  [Stealth Commands](/libbitcoin/libbitcoin-explorer/wiki/Stealth-Commands)
* Loading

  [Test Methodology](/libbitcoin/libbitcoin-explorer/wiki/Test-Methodology)
* Loading

  [Testnet Support](/libbitcoin/libbitcoin-explorer/wiki/Testnet-Support)
* Loading

  [Transaction Commands](/libbitcoin/libbitcoin-explorer/wiki/Transaction-Commands)
* Loading

  [Version History](/libbitcoin/libbitcoin-explorer/wiki/Version-History)
* Loading

  [Wallet Commands](/libbitcoin/libbitcoin-explorer/wiki/Wallet-Commands)
* Loading

  [Wallet Settings](/libbitcoin/libbitcoin-explorer/wiki/Wallet-Settings)
* Loading

  [Wright Decoded](/libbitcoin/libbitcoin-explorer/wiki/Wright-Decoded)
* Show 122 more pages…

### BX Menu

* **<Home>**
* **[Build BX](Build-BX)**
* **General Information**
  + <Acronyms>
  + <Background>
  + [Log Files](Log-Files)
  + [Random Numbers](Random-Numbers)
  + [Testnet Support](Testnet-Support)
  + [Version History](Version-History)
  + <CVE-2023-39910>
* **Developer Information**
  + [Design Overview](Design-Overview)
  + [Explorer Library](Explorer-Library)
  + <Commands>
  + [Primitive Types](Primitive-Types)
  + [Input Processing](Input-Processing)
  + [Output Processing](Output-Processing)
  + [Help Integration](Help-Integration)
  + [Test Methodology](Test-Methodology)
* **[Configuration Settings](Configuration-Settings)**
  + [[wallet]](Wallet-Settings)
  + [[network]](Network-Settings)
  + [[server]](Server-Settings)
* **Tutorials**
  + [Payment Addresses](Payment-Address-Deconstruction)
  + [Command Equivalence](Command-Equivalence)
  + [Encrypting a Seed](How-to-Encrypt-a-Wallet-Seed)
  + [Remembering a Seed](How-to-Remember-a-Wallet-Seed)
  + [Receiving Bitcoin](How-to-Receive-Bitcoin)
  + [Spending Bitcoin](How-to-Spend-Bitcoin)
  + [Receiving Multisig](How-to-Create-a-Multisig-Address)
  + [Spending Multisig](How-to-Spend-From-a-Multisig-Address)
  + [Decoding Craig Wright](wright-decoded)
* **Meta Commands**
  + [help](bx-help)
  + [settings](bx-settings)
* **[Wallet Commands](Wallet-Commands)**
  + [ec-new](bx-ec-new)
  + [ec-to-address](bx-ec-to-address)
  + [ec-to-public](bx-ec-to-public)
  + [ec-to-wif](bx-ec-to-wif)
  + [electrum-new](bx-electrum-new)
  + [electrum-to-seed](bx-electrum-to-seed)
  + [hd-new](bx-hd-new)
  + [hd-private](bx-hd-private)
  + [hd-public](bx-hd-public)
  + [hd-to-ec](bx-hd-to-ec)
  + [hd-to-public](bx-hd-to-public)
  + [mnemonic-new](bx-mnemonic-new)
  + [mnemonic-to-seed](bx-mnemonic-to-seed)
  + [qrcode](bx-qrcode)
  + [uri-decode](bx-uri-decode)
  + [uri-encode](bx-uri-encode)
  + [wif-to-ec](bx-wif-to-ec)
  + [wif-to-public](bx-wif-to-public)
* **[Key Encryption Commands](Key-Encryption-Commands)**
  + [ec-to-ek](bx-ec-to-ek)
  + [ek-address](bx-ek-address)
  + [ek-new](bx-ek-new)
  + [ek-public](bx-ek-public)
  + [ek-public-to-address](bx-ek-public-to-address)
  + [ek-public-to-ec](bx-ek-public-to-ec)
  + [ek-to-address](bx-ek-to-address)
  + [ek-to-ec](bx-ek-to-ec)
  + [token-new](bx-token-new)
* **[Stealth Commands](Stealth-Commands)**
  + [stealth-decode](bx-stealth-decode)
  + [stealth-encode](bx-stealth-encode)
  + [stealth-public](bx-stealth-public)
  + [stealth-secret](bx-stealth-secret)
  + [stealth-shared](bx-stealth-shared)
* **[Messaging Commands](Messaging-Commands)**
  + [message-sign](bx-message-sign)
  + [message-validate](bx-message-validate)
* **[Transaction Commands](Transaction-Commands)**
  + [input-set](bx-input-set)
  + [input-sign](bx-input-sign)
  + [input-validate](bx-input-validate)
  + [script-decode](bx-script-decode)
  + [script-encode](bx-script-encode)
  + [script-to-address](bx-script-to-address)
  + [tx-decode](bx-tx-decode)
  + [tx-encode](bx-tx-encode)
  + [tx-sign](bx-tx-sign)
* **[Online Commands](Online-Commands)**
  + [fetch-balance](bx-fetch-balance)
  + [fetch-block](bx-fetch-block)
  + [fetch-header](bx-fetch-header)
  + [fetch-height](bx-fetch-height)
  + [fetch-history](bx-fetch-history)
  + [fetch-public-key](bx-fetch-public-key)
  + [fetch-stealth](bx-fetch-stealth)
  + [fetch-tx](bx-fetch-tx)
  + [fetch-tx-index](bx-fetch-tx-index)
  + [fetch-utxo](bx-fetch-utxo)
  + [send-tx](bx-send-tx)
  + [send-tx-node](bx-send-tx-node)
  + [send-tx-p2p](bx-send-tx-p2p)
  + [subscribe-block](bx-subscribe-block)
  + [subscribe-tx](bx-subscribe-tx)
  + [validate-tx](bx-validate-tx)
  + [watch-address](bx-watch-address)
  + [watch-stealth](bx-watch-stealth)
  + [watch-tx](bx-watch-tx)
* **[Encoding Commands](Encoding-Commands)**
  + [address-decode](bx-address-decode)
  + [address-embed](bx-address-embed)
  + [address-encode](bx-address-encode)
  + [base16-decode](bx-base16-decode)
  + [base16-encode](bx-base16-encode)
  + [base58-decode](bx-base58-decode)
  + [base58-encode](bx-base58-encode)
  + [base64-decode](bx-base64-decode)
  + [base64-encode](bx-base64-encode)
  + [base58check-decode](bx-base58check-decode)
  + [base58check-encode](bx-base58check-encode)
  + [wrap-decode](bx-wrap-decode)
  + [wrap-encode](bx-wrap-encode)
* **[Hash Commands](Hash-Commands)**
  + [bitcoin160](bx-bitcoin160)
  + [bitcoin256](bx-bitcoin256)
  + [ripemd160](bx-ripemd160)
  + [sha160](bx-sha160)
  + [sha256](bx-sha256)
  + [sha512](bx-sha512)
* **[Math Commands](Math-Commands)**
  + [btc-to-satoshi](bx-btc-to-satoshi)
  + [cert-new](bx-cert-new)
  + [cert-public](bx-cert-public)
  + [ec-add](bx-ec-add)
  + [ec-add-secrets](bx-ec-add-secrets)
  + [ec-multiply](bx-ec-multiply)
  + [ec-multiply-secrets](bx-ec-multiply-secrets)
  + [satoshi-to-btc](bx-satoshi-to-btc)

##### Clone this wiki locally

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d9b9fd60_20250111_082757.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fblob%2F20eba4db9a8a3476949d6fd08a589abda7fde3e3%2Fsrc%2Futility.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-explorer%2Fblob%2F20eba4db9a8a3476949d6fd08a589abda7fde3e3%2Fsrc%2Futility.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=libbitcoin%2Flibbitcoin-explorer)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libbitcoin](/libbitcoin)
/
**[libbitcoin-explorer](/libbitcoin/libbitcoin-explorer)**
Public

* [Notifications](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer) You must be signed in to change notification settings
* [Fork
  180](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)
* [Star
   604](/login?return_to=%2Flibbitcoin%2Flibbitcoin-explorer)

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues
  20](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests
  0](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects
  0](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

Additional navigation options

* [Code](/libbitcoin/libbitcoin-explorer)
* [Issues](/libbitcoin/libbitcoin-explorer/issues)
* [Pull requests](/libbitcoin/libbitcoin-explorer/pulls)
* [Actions](/libbitcoin/libbitcoin-explorer/actions)
* [Projects](/libbitcoin/libbitcoin-explorer/projects)
* [Wiki](/libbitcoin/libbitcoin-explorer/wiki)
* [Security](/libbitcoin/libbitcoin-explorer/security)
* [Insights](/libbitcoin/libbitcoin-explorer/pulse)

## Files

 20eba4d
## Breadcrumbs

1. [libbitcoin-explorer](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3)
2. /[src](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src)
/
# utility.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/libbitcoin/libbitcoin-explorer/commits/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/utility.cpp)174 lines (149 loc) · 4.97 KB 20eba4d
## Breadcrumbs

1. [libbitcoin-explorer](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3)
2. /[src](/libbitcoin/libbitcoin-explorer/tree/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src)
/
# utility.cpp

Top
## File metadata and controls

* Code
* Blame

174 lines (149 loc) · 4.97 KB[Raw](https://github.com/libbitcoin/libbitcoin-explorer/raw/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/utility.cpp)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174/\*\* \* Copyright (c) 2011-2017 libbitcoin developers (see AUTHORS) \* \* This file is part of libbitcoin. \* \* This program is free software: you can redistribute it and/or modify \* it under the terms of the GNU Affero General Public License as published by \* the Free Software Foundation, either version 3 of the License, or \* (at your option) any later version. \* \* This program is distributed in the hope that it will be useful, \* but WITHOUT ANY WARRANTY; without even the implied warranty of \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \* GNU Affero General Public License for more details. \* \* You should have received a copy of the GNU Affero General Public License \* along with this program. If not, see <http://www.gnu.org/licenses/>. \*/#include <bitcoin/explorer/utility.hpp>
#include <algorithm>#include <iomanip>#include <iostream>#include <random>#include <cstdint>#include <mutex>#include <string>#include <thread>#include <tuple>#include <vector>#include <boost/date\_time.hpp>#include <boost/filesystem.hpp>#include <boost/format.hpp>#include <boost/lexical\_cast.hpp>#include <boost/algorithm/string.hpp>#include <boost/property\_tree/ptree.hpp>#include <boost/property\_tree/info\_parser.hpp>#include <boost/property\_tree/json\_parser.hpp>#include <boost/property\_tree/xml\_parser.hpp>#include <bitcoin/client.hpp>#include <bitcoin/explorer/command.hpp>#include <bitcoin/explorer/define.hpp>
using namespace bc::client;using boost::filesystem::path;
namespace libbitcoin {namespace explorer {
connection\_type get\_connection(const command& command){ const auto public\_key = command.get\_server\_server\_public\_key\_setting(); const auto private\_key = command.get\_server\_client\_private\_key\_setting(); const auto timeout = command.get\_server\_connect\_timeout\_seconds\_setting();
 connection\_type connection; connection.retries = command.get\_server\_connect\_retries\_setting(); connection.timeout\_seconds = timeout; connection.server = command.get\_server\_url\_setting(); connection.socks = command.get\_server\_socks\_proxy\_setting(); connection.server\_public\_key = public\_key; connection.client\_private\_key = private\_key; return connection;}
// The key may be invalid, caller may test for null secret.ec\_secret new\_key(const data\_chunk& seed){ const wallet::hd\_private key(seed); return key.secret();}
// Not testable due to lack of random engine injection.data\_chunk new\_seed(size\_t bit\_length){ size\_t fill\_seed\_size = bit\_length / byte\_bits; data\_chunk seed(fill\_seed\_size); pseudo\_random\_fill(seed); return seed;}
string\_list numbers\_to\_strings(const chain::point::indexes& indexes){ string\_list list;
 for (const auto index: indexes) list.push\_back(std::to\_string(index));
 return list;}
// TODO: switch to binary for raw (primitive) reads in windows.std::string read\_stream(std::istream& stream){ std::istreambuf\_iterator<char> first(stream), last; std::string result(first, last); return result;}
name\_value\_pairs split\_pairs(const std::vector<std::string> tokens, const std::string delimiter){ name\_value\_pairs list;
 for (const auto& token: tokens) { const auto words = split(token, delimiter); const auto& left = words[0];
 std::string right; if (words.size() > 1u) right = words[1];
 list.push\_back(std::make\_pair(left, right)); }
 return list;}
bool starts\_with(const std::string& value, const std::string& prefix){ return bc::starts\_with(value.begin(), value.end(), prefix);}
// This verifies the checksum.bool unwrap(wallet::wrapped\_data& data, const data\_slice& wrapped){ if (!verify\_checksum(wrapped)) return false;
 data.version = wrapped.data()[0]; const auto payload\_begin = std::begin(wrapped) + 1; const auto checksum\_begin = std::end(wrapped) - checksum\_size; data.payload.resize(checksum\_begin - payload\_begin); std::copy(payload\_begin, checksum\_begin, data.payload.begin()); data.checksum = from\_little\_endian\_unsafe<uint32\_t>(checksum\_begin); return true;}
// This recalculates the checksum, ignoring what is in data.checksum.data\_chunk wrap(const wallet::wrapped\_data& data){ data\_chunk bytes{ data.version }; extend\_data(bytes, data.payload); append\_checksum(bytes); return bytes;}
// We aren't yet using a reader, although it is possible using ptree.std::ostream& write\_stream(std::ostream& output, const pt::ptree& tree, encoding\_engine engine){ switch (engine) { case encoding\_engine::json: pt::write\_json(output, tree); break; case encoding\_engine::xml: pt::write\_xml(output, tree);
 // property tree XML serialization doesn't terminate the string. output << std::endl;
 break; default: pt::write\_info(output, tree); break; }
 return output;}
} // namespace explorer} // namespace libbitcoin

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ac941593_20250111_082759.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-system%2Fblob%2Fa1b777fc51d9c04e0c7a1dec5cc746b82a6afe64%2Fsrc%2Fcrypto%2Fpseudo_random.cpp)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibbitcoin%2Flibbitcoin-system%2Fblob%2Fa1b777fc51d9c04e0c7a1dec5cc746b82a6afe64%2Fsrc%2Fcrypto%2Fpseudo_random.cpp)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=libbitcoin%2Flibbitcoin-system)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libbitcoin](/libbitcoin)
/
**[libbitcoin-system](/libbitcoin/libbitcoin-system)**
Public

* [Notifications](/login?return_to=%2Flibbitcoin%2Flibbitcoin-system) You must be signed in to change notification settings
* [Fork
  389](/login?return_to=%2Flibbitcoin%2Flibbitcoin-system)
* [Star
   1.3k](/login?return_to=%2Flibbitcoin%2Flibbitcoin-system)

* [Code](/libbitcoin/libbitcoin-system)
* [Issues
  12](/libbitcoin/libbitcoin-system/issues)
* [Pull requests
  0](/libbitcoin/libbitcoin-system/pulls)
* [Actions](/libbitcoin/libbitcoin-system/actions)
* [Projects
  0](/libbitcoin/libbitcoin-system/projects)
* [Wiki](/libbitcoin/libbitcoin-system/wiki)
* [Security](/libbitcoin/libbitcoin-system/security)
* [Insights](/libbitcoin/libbitcoin-system/pulse)

Additional navigation options

* [Code](/libbitcoin/libbitcoin-system)
* [Issues](/libbitcoin/libbitcoin-system/issues)
* [Pull requests](/libbitcoin/libbitcoin-system/pulls)
* [Actions](/libbitcoin/libbitcoin-system/actions)
* [Projects](/libbitcoin/libbitcoin-system/projects)
* [Wiki](/libbitcoin/libbitcoin-system/wiki)
* [Security](/libbitcoin/libbitcoin-system/security)
* [Insights](/libbitcoin/libbitcoin-system/pulse)

## Files

 a1b777f
## Breadcrumbs

1. [libbitcoin-system](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64)
2. /[src](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src)
3. /[crypto](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto)
/
# pseudo\_random.cpp

Copy path Blame  Blame
## Latest commit

## History

[History](/libbitcoin/libbitcoin-system/commits/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp)114 lines (94 loc) · 3.5 KB a1b777f
## Breadcrumbs

1. [libbitcoin-system](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64)
2. /[src](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src)
3. /[crypto](/libbitcoin/libbitcoin-system/tree/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto)
/
# pseudo\_random.cpp

Top
## File metadata and controls

* Code
* Blame

114 lines (94 loc) · 3.5 KB[Raw](https://github.com/libbitcoin/libbitcoin-system/raw/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114/\*\* \* Copyright (c) 2011-2022 libbitcoin developers (see AUTHORS) \* \* This file is part of libbitcoin. \* \* This program is free software: you can redistribute it and/or modify \* it under the terms of the GNU Affero General Public License as published by \* the Free Software Foundation, either version 3 of the License, or \* (at your option) any later version. \* \* This program is distributed in the hope that it will be useful, \* but WITHOUT ANY WARRANTY; without even the implied warranty of \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE. See the \* GNU Affero General Public License for more details. \* \* You should have received a copy of the GNU Affero General Public License \* along with this program. If not, see <http://www.gnu.org/licenses/>. \*/#include <bitcoin/system/crypto/pseudo\_random.hpp>
#include <chrono>#include <limits>#include <random>#include <bitcoin/system/data/data.hpp>#include <bitcoin/system/math/math.hpp>
namespace libbitcoin {namespace system {
using namespace std::chrono;
// DO NOT USE srand() and rand() on MSVC as srand must be called per thread.// Values may or may not be truly random depending on the underlying device.
void pseudo\_random::fill(data\_chunk& out) NOEXCEPT{ std::transform(out.begin(), out.end(), out.begin(), [](uint8\_t) NOEXCEPT { return next(); });}
uint8\_t pseudo\_random::next() NOEXCEPT{ return next(minimum<uint8\_t>, maximum<uint8\_t>);}
uint8\_t pseudo\_random::next(uint8\_t begin, uint8\_t end) NOEXCEPT{ std::uniform\_int\_distribution<uint16\_t> distribution(begin, end); return static\_cast<uint8\_t>(distribution(get\_twister()));}
std::mt19937& pseudo\_random::get\_twister() NOEXCEPT{ // Boost.thread will clean up the thread statics using this function. const auto deleter = [](std::mt19937\* twister) NOEXCEPT { delete twister; };
 // Maintain thread static state space. // This throws given insufficient resources. static boost::thread\_specific\_ptr<std::mt19937> twister(deleter);
 // Use the clock for seeding. const auto get\_clock\_seed = []() NOEXCEPT { const auto now = high\_resolution\_clock::now(); return static\_cast<uint32\_t>(now.time\_since\_epoch().count()); };
 // This is thread safe because the instance is thread static. if (twister.get() == nullptr) { // Seed with high resolution clock. twister.reset(new std::mt19937(get\_clock\_seed())); }
 // The instance remains in scope and is deleted by thread\_specific\_ptr // when the thread terminates, so dereferencing the instance is safe. return \*twister;}
// Randomly select a time duration in the range:// [(expiration - expiration / ratio) .. expiration]// Not fully testable due to lack of random engine injection.steady\_clock::duration pseudo\_random::duration( const steady\_clock::duration& expiration, uint8\_t ratio) NOEXCEPT{ if (is\_zero(ratio)) return expiration;
 // Uses milliseconds level resolution. const auto max\_expire = duration\_cast<milliseconds>(expiration).count();
 // [10 secs, 4] => 10000 / 4 => 2500 const auto limit = max\_expire / ratio;
 if (is\_zero(limit)) return expiration;
 // [0..2^64) % 2500 => [0..2500] const auto random\_offset = pseudo\_random::next<uint64\_t>(zero, limit);
 // (10000 - [0..2500]) => [7500..10000] const auto expires = max\_expire - random\_offset;
 // [7.5..10] second duration. return milliseconds(expires);}
} // namespace system} // namespace libbitcoin

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from milksad.info_febd0f12_20250111_082800.html ===


* [![](/assets/base/milksad_transparent.svg)
  Milk Sad](/)
* [/summary](/index.html)
* [/updates](/updates.html)
* [/full write-up](/disclosure.html)
* [/faq](/faq.html)

# Technical write-up

This is the story of a wallet theft enabled by bad cryptography. It covers our research on problems with `Libbitcoin Explorer` `3.x` (CVE-2023-39910), outlines how it is related to the `Trust Wallet` vulnerability (CVE-2023-31290), and shows some of the real-world impact that we were able to confirm. Additionally, it has some early research on problems with `bx` `2.x` that we became aware of late in the disclosure process.
If youâre looking for a less-technical summary, head over to the [summary](/) page and the [FAQs](/faq.html).

## Table of Contents

* [Part I - Tracing the Issue to the Source](#part-i---tracing-the-issue-to-the-source)
  + [Dude, Whereâs my Cryptocurrency?](#dude-wheres-my-cryptocurrency)
  + [Dude, Whereâs my Friendâs Cryptocurrency?](#dude-wheres-my-friends-cryptocurrency)
  + [Our Cryptocurrency is Gone, But How!?!?](#our-cryptocurrency-is-gone-but-how)
* [Part II - Context and Impact](#part-ii---context-and-impact)
  + [Codename âMilk Sadâ](#codename-milk-sad)
  + [Not the First Hack: Weak entropy in Cake Wallet](#not-the-first-hack-weak-entropy-in-cake-wallet)
  + [Not even the second Hack: Mersenne Twister use in Trust Wallet](#not-even-the-second-hack-mersenne-twister-use-in-trust-wallet)
  + [Ongoing On-Chain Thefts - Some Facts](#ongoing-on-chain-thefts---some-facts)
  + [Searching for Wallets - Motivation and Limits](#searching-for-wallets---motivation-and-limits)
  + [Searching for Wallets - Implementation](#searching-for-wallets---implementation)
  + [Other Confirmed Victims of this Theft](#other-confirmed-victims-of-this-theft)
  + [Basic Timeline of Thefts and Our Disclosure](#basic-timeline-of-thefts-and-our-disclosure)
  + [Libbitcoin Team Response and Context](#libbitcoin-team-response-and-context)
  + [Suspected RNG Problems in Older `bx` Versions](#suspected-rng-problems-in-older-bx-versions)
* [Part III - Summary and Outlook](#part-iii---summary-and-outlook)
  + [Basic Lessons Learned](#basic-lessons-learned)
  + [Summary](#summary)
  + [Future Work](#future-work)
  + [Additional References](#additional-references)
  + [Commercial Work](#commercial-work)
  + [Other Notes](#other-notes)
* [Credits](#credits)
## Part I - Tracing the Issue to the Source

Please note that throughout this article, minor details relating to the victims have been omitted or changed.

### Dude, Whereâs my Cryptocurrency?

Our story starts on Friday, 21 July 2023. Upon attempting to use a well-protected cryptocurrency wallet, the wallet owner realizes that all of their funds stored in their wallet are gone.
This was no accident â they were the victim of a sophisticated theft. The funds were sent to the attackerâs addresses on July 12th, at a time when the hardware wallet wasnât in use for several days. (Details below)

The generation and use of the affected wallet was unusually strict:

* Generated on an [air-gapped](https://en.wikipedia.org/wiki/Air_gap_%28networking%29) Linux laptop with self-compiled software
* Use of BIP39 24 mnemonic word phrase
* Mnemonic securely entered into Ledger & Trezor hardware wallets
* Good PIN and physical security on the hardware wallets
* Mnemonic seed phrase never touched a non-air-gapped computer
* Mnemonic seed backup well-protected

### Dude, Whereâs my Friendâs Cryptocurrency?

The victim reached out to their network of friends with similar key generation and management protocols, and a second victim was identified! The second victim also had the contents of their cryptocurrency wallet stolen during the same period of time â both victims Bitcoin (BTC) was stolen in the same *minute* on-chain. The victims realized this was no accident. They had fallen victim to a some type of hack.

The victims discovered their Bitcoin (BTC) holdings were not the only things stolen. The attackers had also taken Ethereum and other distinct cryptocurrency types from the same wallets. The victims realized this could only happen with an underlying leak of their main wallet private keys. Tricking their hardware wallets into authorizing incorrect transfers or breaking individual private keys of sub-accounts would manifest with a more limited impact.

A theft like this affecting two people at once despite their thorough precautions should be very unlikely. Even worse, the two victims werenât the only ones affected by this. The publicly visible Bitcoin transactions of the theft pull in funds from what looks like many different wallets, possibly by up to a thousand different wallet owners on Bitcoin alone.

So, what in the world is going on!? Had someone found a remotely exploitable hardware wallet vulnerability, used it on a wide scale, and waited for months before executing the on-chain sweeping transactions collectively? Even worse, could one of the underlying cryptographic primitives be broken? Could Quantum Computer magic be involved? ð±

Tensions were running high - thus began the search for the source of compromise.

### Our Cryptocurrency is Gone, But How!?!?

After coordination and communication, the two victims realized that their affected wallets were generated on a similar airgap laptop setup â although the individual victimsâ wallets were generated several years apart. At that point, the issue seemed hard to pin down and could have originated from many sources. Our victims decided to start at the beginning â their wallet generation steps, from the first commands used and working their way up from there.

An essential tool that was involved in the wallet creation in both cases was the [Libbitcoin Explorer](https://github.com/libbitcoin/libbitcoin-explorer/tree/version3) in a 3.x version, via its `bx` binary. The Libbitcoin project has been around for a very long time (2011 !), is Open Source, and `bx` brings everything needed for an offline wallet generation in one self-contained binary.

Despite being a specialized tool that most wallet users wonât have heard of, `bx` has some popularity and is dedicated an [appendix section](https://github.com/bitcoinbook/bitcoinbook/blob/97df56f77c06813b1e028b5b1f2dbc036f27b1fc/appdx-bx.asciidoc) in the âMastering Bitcoinâ book. In other words, it appeared to be a reasonable tool to use.

Brief example of the wallet generation workflow used in a Linux shell:

```
# generate 256 bits of entropy, turn it into BIP39 mnemonics
bx seed -b 256 | bx mnemonic-new
<output of secret BIP39 mnemonic words>

```

The above command produces a 24 word BIP39 mnemonic phrase comparable to those of the victimsâ wallet. This private key is the foundation of all wallet related security.

Could the `bx` binary command the victims used have something to do with the problem? The victims ensured that their `/dev/random` Random Number Generator (RNG) subsystem of the Linux laptops had sufficient entropy, but perhaps that wasnât sufficient after all ..? Was there a major system configuration issue or virus?

At this point in time, a handful of friends with Information Security backgrounds were called in to help review the situation and the relevant wallet generation code paths ðµï¸ââï¸.

As more eyes settle on the situation, the first signs of a major problem emerge.

#### Given Enough Eyes, All Bugs are Shallow?

The team decided that source code review of `bx` of the `bx seed` command is the logical place to start looking.

Running `bx seed` calls the `new_seed(size_t bit_length)` function in libbitcoin-explorer [src/utility.cpp](https://github.com/libbitcoin/libbitcoin-explorer/blob/20eba4db9a8a3476949d6fd08a589abda7fde3e3/src/utility.cpp#L78), which calls a `pseudo_random_fill(data_chunk& out)` function in the [libbitcoin-system](https://github.com/libbitcoin/libbitcoin-system/blob/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp#L35) library:

```
console_result seed::invoke(std::ostream& output, std::ostream& error)
{
    const auto bit_length = get_bit_length_option();

    // These are soft requirements for security and rationality.
    // We use bit vs. byte length input as the more familiar convention.
    if (bit_length < minimum_seed_size * byte_bits ||
        bit_length % byte_bits != 0)
    {
        error << BX_SEED_BIT_LENGTH_UNSUPPORTED << std::endl;
        return console_result::failure;
    }

    const auto seed = new_seed(bit_length);
    ...
}

```

```
data_chunk new_seed(size_t bit_length)
{
    size_t fill_seed_size = bit_length / byte_bits;
    data_chunk seed(fill_seed_size);
    pseudo_random_fill(seed);
    return seed;
}

```

Only *pseudo*-random? Alright, a pseudo-random number generator (PRNG) doesnât have to be bad if itâs a Cryptographically Secure Pseudo Random Number Generator ([CSPRNG](https://en.wikipedia.org/wiki/Cryptographically_secure_pseudorandom_number_generator)). Perhaps everything is fine, but letâs take a closer look.

We follow the call path:
`pseudo_random::fill(data_chunk& out)` -> `pseudo_random::next()` -> `pseudo_random::next(uint8_t begin, uint8_t end)` -> `std::mt19937& pseudo_random::get_twister()`

Wait a moment. `mt19937`, `twister` - this uses the [Mersenne Twister](https://en.wikipedia.org/wiki/Mersenne_Twister) PRNG? ð¤
At this point, the first alarm bells are going off. Mersenne Twister is not a CSPRNG, so it shouldnât be in any code path that generates secrets. One alarming property of the Mersenne Twister is that its internal state can be reversed by an attacker who knows a few hundred outputs, endangering the secrecy of the other outputs of the same stream that the attacker doesnât know (in simplified terms).

However, if the PRNG is re-seeded before every wallet generation, only one output is fetched, and the single result is kept secret, would the weak construction of MT19937 be fatal enough for a remote theft if everything else is done well?

The search within this the `pseudo_random.cpp` code file continues, and we donât have to go much further into the `pseudo_random::get_twister()` details to learn the actual problem.

```
// Use the clock for seeding.
const auto get_clock_seed = []() NOEXCEPT
{
    const auto now = high_resolution_clock::now();
    return static_cast<uint32_t>(now.time_since_epoch().count());
};

// This is thread safe because the instance is thread static.
if (twister.get() == nullptr)
{
    // Seed with high resolution clock.
    twister.reset(new std::mt19937(get_clock_seed()));
}

```

What the hell !? A bad PRNG algorithm, seeded with only *32 bit* of *system time*, used to generate long-lived wallet private keys that store cryptocurrency? ð§

The group of investigators had to perform a âdouble-takeâ here â surely `bx` couldnât use this to generate private keys.

The team investigating the compromise could not believe this to be the case, and setup a simple experiment to validate the hypothesis.
Like all good experiments, environmental variables were under the control of the experimenters, in this case â it was the variable `time` itself that was most relevant in studying the issue at hand.
Using the official `bx` version `3.2.0` release binary in combination with the `libfaketime` library to test our theory, and run separate executions under *exactly identical clock* conditions:

```
$ wget https://github.com/libbitcoin/libbitcoin-explorer/releases/download/v3.2.0/bx-linux-x64-qrcode -O ~/.local/bin/bx
$ chmod +x ~/.local/bin/bx
$ sudo apt install libfaketime
$ export LD_PRELOAD=/usr/lib/x86_64-linux-gnu/faketime/libfaketime.so.1 FAKETIME_FMT=%s FAKETIME=0

$ bx seed -b 256 | bx mnemonic-new
milk sad wage cup reward umbrella raven visa give list decorate bulb gold raise twenty fly manual stand float super gentle climb fold park

$ bx seed -b 256 | bx mnemonic-new
milk sad wage cup reward umbrella raven visa give list decorate bulb gold raise twenty fly manual stand float super gentle climb fold park

```

ð¥ Same time - same ârandomâ wallet! Unbelievable.

A secure and reliable utility would not derive the same mnemonic seed phrase under these circumstances. This was the first hard evidence that the `bx seed` secret generation code in an official release uses the broken time-based pseudorandom function for wallet entropy.

Digging deeper, the team confirmed that the code uses the standard MT19937 Mersenne Twister PRNG variant which only operates on 32 bits of initial seeding input by design, and not the MT19937-64 extended variant with 64 bits of seeding. So the PRNG can at most have 2^32 starting positions as an upper bound, regardless if itâs seeded by `/dev/random` or time.

To put this in different words: when running `bx seed -b 256` to request 256 bits of non-guessable entropy, the result is 32 bits of high-precision clock time that was put through a blender (or rather: twister ðªï¸) and expanded to 256 bit without adding new information. The number of possible key variations would grow exponentially with the size if this were *real* entropy data, so the difference from the safe expected result (256 bits) and the actual result (32 bits) is of astronomical proportions.

Anyone can re-compute and find a victimâs originally used entropy after a maximum of about 4.29 billion attempts if they have specific characteristics to look for to see if they successfully found a cryptocurrency wallet. In this case, by checking derived wallet addresses that were seen receiving funds on a public blockchain in the past. To put this number into perspective: brute-forcing this key space takes a few days of computation on the average gaming PC, at most. And unfortunately, anyone with sufficient programming skills could do it.

In terms of cryptocurrency wallet security, this is a pretty catastrophic situation.

Friday 21 July ends with a handful people who know that everything just got very complicated. Not only did some friends irrevocably lose complete control over their wallet private keys and funds - the ad-hoc group also has a serious disclosure problem on their hands.

Given that the theft was first identified in the US, early team members wanted to avoid failing to report a crime and get appropriate tax loss reporting for victims, and so an early disclosure of our findings to the FBI was made. We also saw this could be helpful in quickly limiting the fund movements of attackers on major exchanges, if that became necessary.

## Part II - Context and Impact

For this section, weâll switch to a non-chronological presentation for readability.

### Codename âMilk Sadâ

Faced with the unexpected task of handling an urgent disclosure, we were in need of a project name that was relevant yet told outsiders nothing about the technical issue. The suggestion was made to use the first two words of first BIP39 mnemonic secret generated by `bx` on time zero - `milk sad wage cup reward [...]` -> **Milk Sad**. We found our project name.
![](/assets/base/milksad_transparent.svg)

### Not the First Hack: Weak entropy in Cake Wallet

Very early in our evaluation of the possible flaws that could lead to an issue like this, one of our team members recalled a weak entropy situation in Cake Wallet.

While no CVE was filed for Cake Wallet as far as we can tell, in May 2021 the Cake wallet team [announced a weak entropy vulnerability in their wallets](https://old.reddit.com/r/Monero/comments/n9yypd/urgent_action_needed_for_bitcoin_wallets_cake/) requiring all users to rotate their mnemonic phrases.

Some [further investigation](https://old.reddit.com/r/RNG/comments/naljww/critical_rng_flaw_in_cake_walletcryptocurrency/) into this situation by Reddit user Pure-Cricket7485 revealed the glaring flaws in Cake Walletâs entropy sourcing strategy.

Notably: Cake Wallet [Used Dartâs non-secure Random() to generate wallet seeds](https://github.com/cake-tech/cake_wallet/blob/b67bb0664f7268c31c24bd9fb9cbd438c691f5e3/lib/bitcoin/bitcoin_mnemonic.dart#L11-L2):

```
Uint8List randomBytes(int length, {bool secure = false}) {
  assert(length > 0);
  final random = secure ? Random.secure() : Random();
  final ret = Uint8List(length);
  for (var i = 0; i < length; i++) {
    ret[i] = random.nextInt(256);
  }
  return ret;
}

```

This can be a real problem considering Dartâs Random() [can fall back to 0 or system time](https://github.com/dart-lang/sdk/blob/master/runtime/vm/random.cc#L17-L33)

```
Random::Random() {
  uint64_t seed = FLAG_random_seed;
  if (seed == 0) {
    Dart_EntropySource callback = Dart::entropy_source_callback();
    if (callback != nullptr) {
      if (!callback(reinterpret_cast<uint8_t*>(&seed), sizeof(seed))) {
        // Callback failed. Reset the seed to 0.
        seed = 0;
      }
    }
  }
  if (seed == 0) {
    // We did not get a seed so far. As a fallback we do use the current time.
    seed = OS::GetCurrentTimeMicros();
  }
  Initialize(seed);
}

```

One Reddit user compared this approach to Mersenne Twister, which got us considering if bx had a similar flaw.

### Not even the second Hack: Mersenne Twister use in Trust Wallet

A few days into our disclosure process, we learned of the [Trust Wallet vulnerability](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787) that Trust Wallet published in late April 2023. After reading Ledger Donjonâs [excellent write-up](https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen/) on the discovery and research of [CVE-2023-31290](https://nvd.nist.gov/vuln/detail/CVE-2023-31290), weâre somewhat shocked: this is *so* close to the vulnerability in `bx`. And the Trust Wallet publication confirms that attacks on their userâs wallets go back as far as December 2022. Why did it take until mid-2023 for money to disappear from `bx`-generated wallets?

Thereâs a lot to unpack here, so letâs start with the vulnerability details.

The vulnerable Trust Wallet version and `bx` share the same basic, fatal flaw of generating wallet entropy from the unsuited MT19937 Mersenne Twister algorithm. `bx` additionally uses some clock information to seed MT19937, but this doesnât make a big difference to practical offline brute-force attacks by remote attackers. Itâs still the same limited 32 bits of key space that attackers can comb through completely.

From what we know, Trust Wallet only creates 12 word BIP39 mnemonic based wallets, which fixes the entropy requirements (and therefore PRNG usage) to 128 bit. `bx` more is flexible and generates 128 bit, 192 bit, 256 bit outputs (and others). More variations means more search space, but do the wallets generated with `bx seed -b 128` overlap with the ones created by Trust wallet?

As it turns out, they do not - due to a nuance in the PRNG usage. The MT19937 Mersenne Twister algorithm used by Trust Wallet and `bx` is the same, but the output is consumed slightly differently.

When filling the entropy array with PRNG data, Trust Wallet consumes one MT19937 output of 32 bits, takes the least significant 8 bits of this output to fill the array, and throws away the other 24 bits via the `& 0x000000ff` bitwise-and in [wasm/src/Random.cpp](https://github.com/trustwallet/wallet-core/blob/69b2da9826dfdeb8116be1e5a3747b3e9418592d/wasm/src/Random.cpp#L21):

```
// Copyright Â© 2017-2022 Trust Wallet.
//

[...]

void random_buffer(uint8_t* buf, size_t len) {
    std::mt19937 rng(std::random_device{}());
    std::generate_n(buf, len, [&rng]() -> uint8_t { return rng() & 0x000000ff; });
    return;
}

```

Due to the C++ mechanisms used in `libbitcoin-system` for `pseudo_random::fill()`, its code performs the same 32 bits -> 8 bits truncation, but exactly the other way around - taking the 8 most-significant bits from the PRNG instead.

As a result, all generated `bx seed` outputs are - to our knowledge - in a completely different key space than what the Trust Wallet code would generate, which means the BIP39 mnemonics are also different.

To confirm this, hereâs a quick experiment. The Ledger Donjon write-up contains a specific example wallet that they describe as follows:

```
[...]
RNG seed: 0x8ec170a8
Mnemonic:
sorry slush already pass garden decade grid drip machine cradle call put
[...]

```

If we re-compute RNG seed `0x8ec170a8` with the `bx` code for a 12 word BIP39 mnemonic, it comes out as the following instead:

```
local chef load churn future essence type leave program weird ancient owner

```

This confirms that the the wallet generation process is indeed different.

In Ledger Donjonâs write-up, they close with the following line, which reads a lot like foreshadowing to us:

> During our investigations, we also noticed that a few addresses were vulnerable while they had been generated a long time before the Trust Wallet release. That probably means this vulnerability exists in some other wallet implementations which is concerningâ¦

However, we suspect the other wallets seen by Ledger Donjon werenât wallets generated by `bx` `3.x` versions, unless Ledger Donjon experimented a lot with the PRNG outputs and hit this other usage pattern. The presence of more affected wallets in the 12-word Trust Wallet range suggests there are yet other affected wallet generation tools out there which use MT19937, though. Due to time constraints, we did not investigate this further for the time being.

When comparing our disclosure task on `bx` with that of Ledger on Trust Wallet, itâs notable that their disclosure was to a single, commercial, evidently well-funded wallet vendor. Based on their publications, Trust Wallet had direct communication paths to individual users that they could leverage to selectively inform them of vulnerabilities related to their wallet. Additionally, their wallet was only vulnerable for a limited amount of time, and the issue was discovered relatively quickly, with many users still regularly using the app.

In their [post-mortem](https://community.trustwallet.com/t/browser-extension-wasm-vulnerability-postmortem/750787), the Trust Wallet team lists the total lost funds as $170,000 USD:

> Despite our best efforts, two exploits occurred, resulting in a total loss of approximately $170,000 USD at the time of the attack.

As we understand, Trust Wallet decided to financially incentivize users to move their funds to safety, as well as [reimbursing lost funds](https://community.trustwallet.com/t/reimbursement-process-for-lost-funds-due-to-hacks-from-browser-extension-wasm-vulnerability/750788) for users affected by the theft. Additionally, they paid a significant $100,000 USD bug bounty to Ledger Donjon for the coordinated disclosure.

In our case, unfortunately, most of these factors did not apply. Given the Libbitcoin projectâs noncommercial nature, lack of direct communication channels to end users, multiple years of affected wallets and likely widely imported/exported keys and BIP39 mnemonics, the situation was much more difficult on the security researcher side.

With the Trust Wallet & Ledger Donjon write-ups out there, all `bx seed` private keys compromised, and active on-chain exploitation for `bx` wallets ongoing, it was clear to us that a long coordinated disclosure was not beneficial. If we wanted to give affected `bx` wallet owners the *chance* to recover their funds, we would have to aim for a publication in days, not months. In this situation, time is on the side of the attackers rather than the victims.

Well-established security programs like Google Project Zero [have a similar policy](https://googleprojectzero.blogspot.com/p/vulnerability-disclosure-policy.html) for actively exploited vulnerabilities:

> [â¦] if Project Zero finds evidence that a vulnerability is being actively exploited against real users âin the wildâ, a 7-day disclosure policy replaces the 90-day policy. [â¦]

### Ongoing On-Chain Thefts - Some Facts

We decided to focus on Bitcoin as the main coin network for a limited analysis considering our time constraints. Due to the flexibility of `bx seed` output, funds on every BIP39 mnemonic (or even just BIP32 seed) compatible coin under the sun could be affected. With regular day jobs to take care of and limited time & compute resources, doing various steps 100x times wasnât an option. This overview is therefore narrowly focused on Bitcoin, and only presents a partial view of the overall theft actions.
Consider the presented figures a lower bound for the overall affected monetary value.

For Bitcoin, there are two main clusters of transactions that we think were malicious:

1.) The big 2023-07-12 theft:

| date | transaction | destination address | moved value | note |
| --- | --- | --- | --- | --- |
| 2023-07-12 10:41 | [593e11588a2529ed..](https://mempool.space/tx/593e11588a2529ed26b169e71d46c045eedb6037822641c5fba08c1c34a1c04a) | [3GMQRwh8Yz1WVftL..](https://mempool.space/address/3GMQRwh8Yz1WVftLPiFr9PoYdqrizHcA9R) | ~5.0538 | 14 inputs |
| 2023-07-12 10:41 | [81cfe97cc16a4939..](https://mempool.space/tx/81cfe97cc16a49398d6986032ec8f6970ea80df5aa0990dcf0164de87136f5bf) | [3LwDzjA1xH8amCHu..](https://mempool.space/address/3LwDzjA1xH8amCHuvU9YjWST6rsyfPmvmU) | ~9.744 BTC | > 300 inputs |
| 2023-07-12 10:41 | [a22b33a9a4ca0de2..](https://mempool.space/tx/a22b33a9a4ca0de2f56ef166298c186c5d71e56b944a255c2ecc52748f8f774b) | [3D2mKf28exn26v7B..](https://mempool.space/address/3D2mKf28exn26v7BCVe9AXrrg4BY7qvYcv) | ~14.847 BTC | > 1200 inputs |

We attribute these to one well-prepared actor, who stole around ~29.65 BTC worth upwards of $850,000 USD in Bitcoin alone (8/2023 exchange rate). We think itâs likely this actor also carried out theft of other coins in the same day. At the time of writing, these funds have not moved away from their new location.

2.) There is a second, earlier pattern of fund movements that we suspect are also thefts:

This behavior started May 3rd 2023 and consisted of multiple smaller wallet sweeps which continued until July 15th. In total, we think this sweeping sums up to about 0.33 BTC. The funds have been moved again to further addresses, which differentiates this actor pattern from the first we outlined.

We have not seen any reports of stolen funds for these addresses. Theoretically, this special actor may be legitimately moving his funds from many distinct wallets (see further analysis) or he is a malicious actor. The addresses reported below are linked by being spent in the same transaction, which indicates that this a single actor or group.

Suspected Attacker Addresses:

* [bc1qdmpx2th8h7l4j0z93sxnrlpuaxfvkkfxlv7n2c](https://mempool.space/address/bc1qdmpx2th8h7l4j0z93sxnrlpuaxfvkkfxlv7n2c) (0.1382 BTC)
* [bc1qpnq4q7dcgvpuz8z9dy3d3jp4vuumw0hte4d32n](https://mempool.space/address/bc1qpnq4q7dcgvpuz8z9dy3d3jp4vuumw0hte4d32n) (0.0700 BTC)
* [bc1qf9q85mt73sr0vzlqkvy75pyal3g5w2ca7zx3cv](https://mempool.space/address/bc1qf9q85mt73sr0vzlqkvy75pyal3g5w2ca7zx3cv) (0.0045 BTC)
* [bc1q5rcm7gcl3n50q93xcwwz5una7xy89unlqhy075](https://mempool.space/address/bc1q5rcm7gcl3n50q93xcwwz5una7xy89unlqhy075) (0.1147 BTC)

Hereâs a list with some known coins with confirmed thefts (before the publication of this disclosure):

* Bitcoin (BTC)
* Ethereum (ETH)
* Ripple (XRP)
* Dogecoin (DOGE)
* Solana (SOL)
* Litecoin (LTC)
* Bitcoin Cash (BCH)
* Zcash (ZEC)

There are likely many more coin types involved, as the additional cost to execute this attack on other coins for the affected wallets is limited to the R&D time required for identification and funds withdrawal. We hope that attackers have some increased risk of getting caught via coin-specific tracing of their identities and methods, but do not have anything to report there.

Overall, our estimation is that over **$900,000 USD** worth of cryptocurrency assets were moved as part of the overall theft actions (@exchange rate 8/2023), although some of the drained wallets may have been taken over via other vulnerabilities.

### Searching for Wallets - Motivation and Limits

The primary reason for rapidly searching for affected Bitcoin wallets was to assess the overall damage in terms of magnitude of stolen & remaining funds, as well as to provide technical confirmation that the vulnerability was real and the sole explanation for the initially analyzed theft. We had some hope that if we came across any substantial remaining funds, there would be a small but non-zero chance to somehow *inform* the rightful owner so that they could save their funds. In the planning phase, we were considering options to relay a warning message to the wallet owner via a centralized cryptocurrency exchange used for direct deposits, finding wallet owners with publicly listed addresses, or discovering some other back channels. At the very least, we could extend the disclosure time scheduled in that case while searching for options.

Ultimately **we did not identify** any substantial remaining funds above a threshold of $5000 on the Bitcoin network in the analyzed ranges related to wallets generated with `bx` `3.x` versions, as of the disclosure publication date. Itâs plausible that larger sums of funds remain on similarly affected wallets of one sort of another, with slightly different derivation paths, but we did not find them with our analysis steps so far. It is also possible that some wallet owners use additional BIP39 passphrases, which provide moderate to strong protections depending on passphrase strength and other factors and make discovery much harder.

We want to be very clear on the scope of our research-related actions:

1. The two originally described victims managed to recover a small portion of their own wallet contents that had not yet been stolen, using their regular wallet setup they had before the theft.
2. We did not move any funds on any of the unknown victim wallets, on any coin.
3. We do not know or are in any way associated with the attacker(s) that stole the funds.

**In summary, none of the group members moved any funds that they were not the legal owner of, or knows the identities of the thiefs.**

As far as weâre aware, even under ideal hypothetical circumstances, moving other peopleâs funds to avoid theft by bad actors can become a legal nightmare. Even in the most ideal scenario â where there is a single victim, clear ownership proofs, well-established identities on both sides, single jurisdiction and reliable private communication options - this carries a lot of risk.

In our situation, the circumstances were substantially worse than the ideal case in most ways we could think of. Therefore, we saw any scenario that involved us moving anything of any value, which we didnât own before the disclosure, as opening the floodgates of legal problems. (Remember that weâre not lawyers, and this is not legal advice; Weâre also not finance folks, so this is also NOT financial advice)

For the adventurous reader, who would consider going ahead anyway as a âwhite knightâ in this case, please consider the following dilemma: any attacker can recompute the ownerâs private keys, which nullifies the value of any cryptographic signatures with those keys. In any scenario that involves moving a wallet ownersâs funds away to a wallet you control, how do you know the person showing up in your inbox (or on your doorstep) asking to get back âtheirâ funds is the legal owner? Particularly if there is no centralized entity, such as a big cryptocurrency exchange, that backs the claim and can provide circumstantial evidence?

Thatâs a tough situation! And this dilemma doesnât even touch other problems such as complying with anti-money-laundering (AML) laws, tax declarations, and a host of other aspects.

In case you are one of the affected victims of the theft: **no, we definitely do not have your funds** or know of a way to get them back. Weâre sorry.

If itâs any consolation, weâve worked hard to give our affected friends and all other victims at least some explanation and closure on why any funds could be stolen in the first place, and help them to avoid getting burned again by the same vulnerability.

You may use the [lookup service](/lookup.html) to check if your wallet was impacted.

### Searching for Wallets - Implementation

Please note that weâre intentionally vague on some non-trivial technical details, since we need to make an ethical trade-off between sharing the technical details that are needed to shine a light on this problem, and giving bad actors an unnecessary technical advantage on day 1. Additionally, while we are big fans of Open Source, we will not release custom code we wrote for parts of the on-chain analysis at this time for similar reasons.

For our exploratory research, we focused on the BIP44, BIP49 and BIP84 standard address formats and derivation paths. Our primary focus was on finding both formerly used as well as currently used Bitcoin wallets generated by `bx seed | bx mnemonic-new` on `bx` `3.x` versions with common BIP39 mnemonic word phrase lengths and settings.

Specifically, this covers:

* 128 bits = 12 words, `bx seed -b 128`
* 192 bits = 18 words, `bx seed -b 192` (default)
* 256 bits = 24 words, `bx seed -b 256`

We used a publicly available list of all Bitcoin addresses historically seen by the Bitcoin network and constructed a bloom filter with a very low false positive rate on the data set. Using this filter, we were able to do quick address lookups to query and discard many unused wallet candidates, for which the relevant derived accounts were never seen by the network, without doing costly lookups to a Bitcoin full node.

We only consider wallets where the first address was used. The standard mandates to scan the first 20 addresses, but computing addresses is a bottle-neck in our search. We also only consider wallets using the standard derivation paths specified by BIP44, BIP49, and BIP84. In total, we discovered over **2600** distinct and actively used Bitcoin cryptocurrency wallets that are based on the bad `bx seed` entropy.

The majority of these wallets, a group of over **2550**, has an oddly similar usage pattern with small deposits around the same dates in 2018. We think this is the result of some automatic tool use of `bx`, and that these wallets may actually share the same owner. Weâre not sure what this experiment was about, but theyâre all in the 256 bit seed output range and have a BIP49 address type (â3â prefix), which helps distinguishing them a bit from other addresses.

Excluding this large number of special wallets, weâve identified less than **50** wallets with more individual usage patterns that we associate with likely use by human wallet owners. Those are distributed across the mentioned ranges and address types. We know this survey to be incomplete, as we have not discovered all wallets involved in the sweeps we observed on the blockchain.

Within this set of wallets, we were able to find and identify both of the initial victimâs wallets. This gives us confidence that our research into the the explanation for the theft is correct.

A decent portion of the discovered individually used wallets did not have any BTC funds on them since before 2023, so no money could be moved away from them by the attackers. However, we still consider them fully affected for two reasons:

1. Any new deposits to them are at risk of immediate, automated theft (as outlined in the Ledger Donjon article).
2. Access to the underlying wallet private keys allows reconstructing all derived addresses on all coins, linking the wallet ownerâs previous actions on all of them, a significant privacy impact.

### Other Confirmed Victims of this Theft

Within a few days after the large theft of July 12th 2023, a victim of the theft came forward on Reddit:

1. <https://www.reddit.com/r/Bitcoin/comments/158nyuo/mass_hacking_of_over_1000_bitcoin_accounts/>

The Reddit user [u/0n0t0le](https://www.reddit.com/user/0n0t0le/) provides an interesting data point, since he lost ~0.25BTC but was able to move away and recover over 1.05 BTC that the attackers didnât find or take at that point.

We were able to confirm for case 1) that the user had their funds in a vulnerable wallet in the `bx seed` ranges.

Please note that BIP39 mnemonic secrets as well as other wallet private keys typically do not contain any clear indication on the software used to generate them. As a format designed to be exportable and importable between different wallet software, it is therefore possible that users do not clearly or correctly recall where a given wallet was created. This can lead to a lot of confusing information on potentially affected other wallet software, and makes fact-finding harder.

In the interest of correctness, weâre currently not listing other open leads that weâre following up on, but may update this section at a later point in time.

### Basic Timeline of Thefts and Our Disclosure

| Date | Event |
| --- | --- |
| 2022-11-17 | Ledger Donjon discloses Trust Wallet vulnerability to Binance |
| 2022-11-21 | Trust Wallet code patch on GitHub publicly removes Mersenne Twister usage |
| 2022-11-21+ | Trust Wallet selectively notifies affected users of the vulnerability |
| 2022-12-? | Vulnerable Trust Wallet wallets exploited on-chain (according to vendor) |
| 2023-03-? | Vulnerable Trust Wallet wallets exploited on-chain again (according to vendor) |
| 2023-04-22 | Trust Wallet publicly discloses Trust Wallet vulnerability |
| 2023-04-25 | Ledger Donjon publishes their Trust Wallet vulnerability write-up |
| 2023-05-03 | First potential exploitation of `bx` `3.x` wallets |
| 2023-07-12 | Main exploitation of `bx` wallets |
| 2023-07-21 | We discover the `bx` vulnerability during incident response analysis |
| 2023-07-22 | We send initial email to establish communications with the Libbitcoin team |
| 2023-07-25 | First Libbitcoin team response, indicating team is too busy for contact |
| 2023-07-25 | We send context information without vulnerability details to the Libbitcoin team, asking for followup |
| 2023-08-03 | We send technical vulnerability details and detailed disclosure context to the Libbitcoin team |
| 2023-08-03 | Libbitcoin team response, indicating they do not feel this is a bug |
| 2023-08-04 | We request a CVE for the `bx seed` vulnerability in versions `3.x` from MITRE |
| 2023-08-05 | Libbitcoin team response, further detailing they do not feel this is a bug |
| 2023-08-07 | MITRE assigns CVE for the `bx` `3.x` issue |
| 2023-08-08 | Publication of this article |

Please note that this timeline focuses on the main events and is not exhaustive.

### Libbitcoin Team Response and Context

During our accelerated coordinated disclosure to the Libbitcoin team, the Libbitcoin team quickly disputed the relevancy of our findings and the CVE assignment. By our understanding, they consider `bx seed` a command that should never be used productively by any `bx` user since it is sufficiently documented as unsuited for safe wallet generation.

We do not agree with this assessment.

Please consider the following timeline and linked resources:

| Date | Information |
| --- | --- |
| 2013-07-21 | Libbitcoin Explorer predecessor tool [adds](https://github.com/BWallet/sx/commit/482255da51749300804bfb7d9998bf2604587d3b) a `newseed` command for entropy generation |
| 2014-10-16 | First Libbitcoin Explorer wiki [documentation page](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-seed/7644353f2ed45f116c595222640240fabc43e953) for `bx seed` |
| 2014-12-14 | First Libbitcoin Explorer (bx) release starting with version `2.0.0` |
| 2015-01-19 | A Libbitcoin team member [adds](https://github.com/bitcoinbook/bitcoinbook/commit/76c5ba8000d6de20b4adaf802329b501a5d5d1db) and updates `bx seed` usage suggestions to âMastering Bitcoinâ (described below) |
| 2015-12-21 | Libbitcoin Explorer (bx) release `2.2.0` |
| 2016-10-21 | The Libbitcoin team changes the seed generation to Mersenne Twister via [PR#559](https://github.com/libbitcoin/libbitcoin-system/pull/559), [commit](https://github.com/libbitcoin/libbitcoin-system/commit/6d5a06e283d81260165e0eab95175069bf03b408) |
| 2017-02-10 | Libbitcoin Explorer (bx) release `2.3.0` |
| 2017-03-08 | Libbitcoin Explorer (bx) [3.0.0](https://github.com/libbitcoin/libbitcoin-explorer/releases/tag/v3.0.0), includes [PR#559](https://github.com/libbitcoin/libbitcoin-system/pull/559) |
| 2019-08-29 | Libbitcoin Explorer (bx) [3.6.0](https://github.com/libbitcoin/libbitcoin-explorer/releases/tag/v3.0.0), currently latest official release |
| 2021-05-02 | `bx seed` command gets renamed to `bx entropy` on GitHub branch, still based on Mersenne Twister, [PR#628](https://github.com/libbitcoin/libbitcoin-explorer/issues/628), [1](https://github.com/libbitcoin/libbitcoin-explorer/commit/199b34ee359b25befe98317d4f180b7711e6d257#diff-a8950528178320085bc3c31b5920b1992a5c9dbc34e7c25c5029eb16276e2b72), [2](https://github.com/libbitcoin/libbitcoin-explorer/commit/a856bd68777ef8682ea303713618a5ca5bc91a42) |

Weâre aware of a single warning note in the `bx seed` documentation page in the wiki:

> WARNING: Pseudorandom seeding can introduce [cryptographic weakness](https://cwe.mitre.org/data/definitions/338.html) into your keys. This command is provided as a convenience.

The wording âcan introduceâ is quite weak and a user may not be aware that this produces a seed that is completely insecure and should not be used to store anything of value.

When adding `bx seed` related workflows to the âMastering Bitcoinâ book appendix, Libbitcoin team members described it as follows:

> Generate a random âseedâ value using the seed command, which uses the operating systemâs random number generator. Pass the seed to the `ec-new` command [â¦]
> `$ bx seed | bx ec-new > private_key`
> `[...]`

Similarly, in âMastering Bitcoinâ Chapter 4:

> You can also use the Bitcoin Explorer command-line tool (see [appdx\_bx]) to generate and display private keys with the commands `seed`, `ec-new`, and `ec-to-wif`:
> `$ bx seed | bx ec-new | bx ec-to-wif`
> `[...]`

Neither Chapter 4 nor the Appendix contain the warning that `bx seed` does not produce secure random numbers. The examples do not warn the user that wallets created like this are insecure.

We informed the authors of âMastering Bitcoinâ and they will revise the text.

The following Libbitcoin documentation includes `bx seed`:

| Page | Command Excerpt | Last changed |
| --- | --- | --- |
| [wiki landing page](https://github.com/libbitcoin/libbitcoin-explorer/wiki) | `bx seed | bx ec-new | bx ec-to-public | bx ec-to-address` | 7/2018 |
| [bx mnemonic-new documentation](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-mnemonic-new#example-3) | `bx seed -b 128 | bx mnemonic-new` | 4/2017 |
| [bx hd-new documentation](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-hd-new#example-4) | `bx seed | bx hd-new` | 4/2022 |
| [Random Numbers](https://github.com/libbitcoin/libbitcoin-explorer/wiki/Random-Numbers) | `bx seed -b 256` | 7/2018 |

All these examples do not contain any warning that the created wallets are insecure.

Other notable characteristics:

* The `bx seed` `-b` parameter cannot be configured to output less than 128 bits of binary output size. Related code comments on this limit include `The minimum safe length of a seed in bits` and `These are soft requirements for security and rationality.`. It seems strange that the design explicitly prevents the user from creating a seed that is too short, but does not prevent him from creating a seed that has not enough randomness.

General notes:

* Dates regarding releases and commits are taken from Git/GitHub timestamp information. This may deviate from the actual dates in some cases.

### Suspected RNG Problems in Older `bx` Versions

For the main part of our short and busy disclosure, we focused on the Mersenne Twister related issues in `bx` versions released after March 2017.

However, we recently observed some behavior on older `bx` versions before `3.0.0` that indicate other weak random number generator behavior of `bx seed`, in part depending on the system environment `bx` is executed on. Specifically, the `std::random_device` entropy source in combination with `std::default_random_engine` may not behave securely enough if the random engine uses insufficient seeding and acts as a non-CSPRNG similar to Mersenne Twister.

| Tool | Version | Release | Status | Details |
| --- | --- | --- | --- | --- |
| sx | 1.x ? | 2014 | ð likely affected (some systems) | `std::random_device` + `std::default_random_engine` |
| bx | 2.0.0 - 2.1.0 | 2014 - 2015 | ð likely affected (some systems) | `std::random_device` + `std::default_random_engine` |
| bx | 2.2.0 - 2.3.0 | 2015 - 2017 | â unclear, improved behavior | `std::random_device` + `std::uniform_int_distribution` |
| bx | 3.0.0 - 3.6.0 | 2017 - now | ð¥ confirmed exploitable | `get_clock_seed()` + `std::mt19937` Mersenne Twister |

Please regard this as preliminary indications of potential problems. It is possible that some of the public thefts exploit random number generator issues in versions before `bx 3.0.0`, but we have not confirmed this yet.

We plan to follow up on this with additional research.

## Part III - Summary and Outlook

### Basic Lessons Learned

* Use BIP39 passphrases for your wallets, ideally with a complex passphrase based on entropy from a separate source.
* Trust only heavily audited software to be in your wallet generation path.
* Document every wallet generation setup for your future self, this may be very important.

### Summary

In this article, we presented technical information of a weak entropy generation function in Libbitcoin Explorer, confirmed the practical use of the weak function for over 2600 cryptocurrency wallets on the Bitcoin Mainnet, and connected it to a recent large theft of cryptocurrency funds on multiple popular blockchains that amounts to an estimated $900k of damages. Additionally, we described the close similarities with another actively exploited vulnerability in Trust Wallet, and provided some background on the Libbitcoin Explorer context and overall timeline.

### Future Work

* We plan further security research into `bx` `2.x` RNG behavior.
* We may update this page in the next days as more information becomes available.

### Additional References

* [Security bug](https://github.com/intel/pailliercryptolib/issues/2) - Mersenne Twister MT19937 usage in Intel cryptography library

### Commercial Work

We have not received any reward for this research and are not accepting donations.

If you like our work, check out the following commercial services offered by different team members and organizations:

* [Distrust, LLC](https://distrust.co/contact.html)
  + Infosec firm focusing on high risk clients
  + Pentesting, threat modeling, hands-on security engineering
  + Full stack security evaluations and advisory retainer contracts
  + Covers: Shane Engelman, Anton Livaja, Ryan Heywood, and Lance Vick
* [Christian Reitter](https://blog.inhq.net/consulting/)
  + Freelance InfoSec Consultant
  + Pentesting, Code Audits, Security Research, Fuzzing
* [Heiko Schaefer](https://codeberg.org/heiko)
  + Focus on OpenPGP: OpenPGP CA, Sequoia PGP, OpenPGP on HSM devices (OpenPGP card, PKCS #11, PIV)

### Other Notes

* Included Libbitcoin code snippets are licensed [under AGPLv3](https://github.com/libbitcoin/libbitcoin-explorer/blob/20eba4db9a8a3476949d6fd08a589abda7fde3e3/COPYING).
* For other code snippets, see the included copyright notice.

## Credits

* Core Team
  + ![distrust icon](/assets/base/distrust-white.svg) Distrust
    - Anton Livaja - anton@distrust.co
    - Lance R. Vick - lance@distrust.co, <https://lance.dev>
    - Ryan Heywood - ryan@distrust.co, <https://ryansquared.pub>
    - Shane Engelman - shane@distrust.co
  + Independent
    - Christian Reitter - <https://inhq.net>
    - Daniel Grove - danny@dannygrove.com
    - Dustin Johnson - milksad@di0.io
    - Heiko Schaefer - heiko@schaefer.name
    - James Callahan - james@wavesquid.com
    - Jochen Hoenicke - <https://jhoenicke.de>
    - John Naulty - jnaulty@dendritictech.com
    - Matthew Brooks - \*@logicwax.com
* Special Thanks
  + Jack Kearney - [Turnkey](https://turnkey.com)
  + Several trusted advisors that wish to remain uncredited. You know who you are.

[RSS](https://milksad.info/feed.xml),
[Git](https://git.distrust.co/milksad),
[data](https://git.distrust.co/milksad/data),
[old lookup](https://milksad.info/lookup.html) ![Milk Sad logo as icon](/assets/base/milksad_bottle_transparent.svg)2023-2024



=== Content from news.ycombinator.com_1ec0cdc7_20250111_082802.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D37054862) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Milk Sad Disclosure](https://milksad.info/) ([milksad.info](from?site=milksad.info)) | | --- | --- | --- | |  | | 136 points by [dgrove](user?id=dgrove) [on Aug 8, 2023](item?id=37054862)  | [hide](hide?id=37054862&goto=item%3Fid%3D37054862) | [past](https://hn.algolia.com/?query=Milk%20Sad%20Disclosure&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=37054862&auth=49359c758cdf222ec499c8776beeecce09ecdafc) | [125 comments](item?id=37054862) |  | |  |  | [NelsonMinar](user?id=NelsonMinar) [on Aug 8, 2023](item?id=37055333)   | [next](#37055436) [–]  "On Libbitcoin Explorer 3.x versions, bx seed uses the Mersenne Twister pseudorandom number generator (PRNG) initialized with 32 bits of system time." That's a hell of an amateur mistake to make. 50/50 odds whether it was incompetence or deliberate fraud. Maybe 80/20; that flaw is so simple anyone can attack it. Which apparently is happening right now. It's much better if your crypto library generates keys only you can hack. | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [alyandon](user?id=alyandon) [on Aug 8, 2023](item?id=37055664)   | [parent](#37055333) | [next](#37056907) [–]  A non-cryptographic PRNG with a 32 bit seed and yet all the other maths/details are correct? I refuse to believe that that is anything but deliberate fraud. | | --- | --- | --- | | | |  |  | [astrange](user?id=astrange) [on Aug 8, 2023](item?id=37056907)   | [parent](#37055333) | [prev](#37055664) | [next](#37056203) [–]  Mersenne Twister is an attractive nuisance. It's complicated and insecure, but a CSPRNG can be done in a few lines of code. I think people pick it because it has a cool sounding name. | | --- | --- | --- | | | |  |  | [technion](user?id=technion) [on Aug 8, 2023](item?id=37056203)   | [parent](#37055333) | [prev](#37056907) | [next](#37055955) [–]  Seeing it declared a WONTFIX to me helps answer which of those it was. If it was fraud, you'd expect a fake apology and a fix at this point. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 8, 2023](item?id=37056533)   | [root](#37055333) | [parent](#37056203) | [next](#37055955) [–]  Why? The regress is infinite, it's zero information. A malicious party can anticipate any public-information rational for dismissing their actions and pretend to be whatever flavor of fool you might accept. "Now, a clever man would put the poison into his own goblet, because he would know that only a great fool would reach for what he was given. I am not a great fool, so I can clearly not choose the wine in front of you. But you must have known I was not a great fool, you would have counted on it, so I can clearly not choose the wine in front of me. ... Because iocane comes from Australia, as everyone knows, and Australia is entirely peopled with criminals, and criminals are used to having people not trust them, as you are not trusted by me, so I can clearly not choose the wine in front of you." | | --- | --- | --- | | | |  |  | [djbusby](user?id=djbusby) [on Aug 9, 2023](item?id=37057901)   | [root](#37055333) | [parent](#37056533) | [next](#37055955) [–]  This quote is from "The Princess Bride" movie. The actor who spoke this was also, IIRC, the Grand Nagus in ST:DS9. Brilliant in both roles. | | --- | --- | --- | | | |  |  | [Terr\_](user?id=Terr_) [on Aug 9, 2023](item?id=37057924)   | [root](#37055333) | [parent](#37057901) | [next](#37055955) [–]  Wallace Shawn also has some memorable voice roles, such as the T-Rex in Tony Story, and the insurance-company boss in The Incredibles, etc. | | --- | --- | --- | | | |  |  | [qingcharles](user?id=qingcharles) [on Aug 9, 2023](item?id=37057983)   | [root](#37055333) | [parent](#37057924) | [next](#37055955) [–]  Tony Story.. that movie got two thumbs up. "Tony Story" has you laughing straight out of the gate. Billed as an action-comedy, it's the ultimate clash of the titans between machismo and mirth. The film follows our hero, Tony, a middle-aged man who wakes up one morning to find himself inexplicably transformed into a small plastic action figure. The plot thickens as he learns he's the star of a beloved, but sadly discontinued, line of 90s toys. Tony is forced to navigate the wild world of suburban backyards, dodging ferocious pet chihuahuas and the sticky hands of sugar-fueled toddlers. His quest for a return to normality is as hilarious as it is heartwarming. The brilliant use of slapstick humor, a dash of existential dread, and a sprinkling of well-timed puns are skillfully mixed into a cocktail of laughs. The film's standout moment involves Tony, a malfunctioning Roomba, and a perplexed cat, in a scene that will leave you in stitches. The voice acting is second to none, with Tony's gruff, action-hero voice (think Clint Eastwood meets Optimus Prime) contrasting hilariously with his miniature plastic form. The supporting cast of misfit toys, including a neurotic yo-yo and a sassy Barbie doll, add to the hilarity. "Tony Story" is a wild roller coaster of laughter that reminds us all not to take life too seriously. As Tony himself puts it, "I may be small, but my problems sure aren't!" This film truly delivers a unique blend of comedy and action that will leave you chuckling long after the credits roll. | | --- | --- | --- | | | |  |  | [rebelchicken](user?id=rebelchicken) [on Aug 9, 2023](item?id=37058221)   | [root](#37055333) | [parent](#37057983) | [next](#37058759) [–]  I logged in for the first time in a decade to say that I am sad this movie isn't real. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058649)   | [root](#37055333) | [parent](#37058221) | [next](#37058759) [–]  I am replying to confess that I was wooshed and had sent a note to my partner that we should watch it. | | --- | --- | --- | | | |  |  | [qingcharles](user?id=qingcharles) [on Aug 10, 2023](item?id=37070757)   | [root](#37055333) | [parent](#37058649) | [next](#37058759) [–]  A year from now AI will make it real. Reschedule movie night. | | --- | --- | --- | | | |  |  | [Terr\_](user?id=Terr_) [on Aug 9, 2023](item?id=37058759)   | [root](#37055333) | [parent](#37057983) | [prev](#37058221) | [next](#37055955) [–]  Alas, my new phone doesn't transcribe/edit quite the same as the old one. Awl sew, thee spiel checquer frowned know tissues bee four eye clacked. | | --- | --- | --- | | | |  |  | [aidenn0](user?id=aidenn0) [on Aug 8, 2023](item?id=37055955)   | [parent](#37055333) | [prev](#37056203) | [next](#37074675) [–]  Would a CSPRNG be at all an improvement with only a 32 bit seed? Couldn't you still brute force it? | | --- | --- | --- | | | |  |  | [a-dub](user?id=a-dub) [on Aug 8, 2023](item?id=37056776)   | [root](#37055333) | [parent](#37055955) | [next](#37056028) [–]  i think the bigger problem is that the seed is easily guessed or found, so all the output can be regenerated. so it's not even 32 bits of entropy, it's some tiny fraction of that. (system times for a few years interval) | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 9, 2023](item?id=37057804)   | [root](#37055333) | [parent](#37056776) | [next](#37056028) [–]  As discussed elsethread, it used the lower bits of the time value, so while there is is a fraction of the 2^32 space due to precision loss in the OS time calculations, it is not as simple as "between when this software was released and now, in seconds". | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056028)   | [root](#37055333) | [parent](#37055955) | [prev](#37056776) | [next](#37074675) [–]  That is correct, you still have 2^32 permutations of possible values. | | --- | --- | --- | | | |  |  | [marginalia\_nu](user?id=marginalia_nu) [on Aug 8, 2023](item?id=37056511)   | [root](#37055333) | [parent](#37056028) | [next](#37074675) [–]  Given it's seeded with system time, depending on the resolution, that may in practice be as low as tens of thousands of possible values (as in time(2) ) | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056603)   | [root](#37055333) | [parent](#37056511) | [next](#37074675) [–]  2^32 is still incredibly small for crypto and is inexcusable. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 8, 2023](item?id=37056697)   | [root](#37055333) | [parent](#37056603) | [next](#37074675) [–]  A fact which was unambiguously well known to the authors prior to the report: [https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022...](https://lists.linuxfoundation.org/pipermail/bitcoin-dev/2022-July/020652.html) | | --- | --- | --- | | | |  |  | [Zenul\_Abidin](user?id=Zenul_Abidin) [on Aug 10, 2023](item?id=37074675)   | [parent](#37055333) | [prev](#37055955) | [next](#37055424) [–]  It was actually an intentional change but a very dumb one because they never warned enough that bx seed should not be used to store money with in the first place. | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 8, 2023](item?id=37055424)   | [parent](#37055333) | [prev](#37074675) | [next](#37055454) [–]  if it’s something only you can attack then there is no plausible deniability if you become accused as the code contributor | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37055456)   | [root](#37055333) | [parent](#37055424) | [next](#37055454) [–]  To verify, this is something *anyone* can attack, as was proven by our brute force lookup service: <https://lookup.milksad.info>. | | --- | --- | --- | | | |  |  | [comboy](user?id=comboy) [on Aug 8, 2023](item?id=37055454)   | [parent](#37055333) | [prev](#37055424) | [next](#37055436) [–]  Why is it a mistake? | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37055540)   | [root](#37055333) | [parent](#37055454) | [next](#37055516) [–]  The difference between 32 bits and 64 bits is the amount of people on Earth compared to (EDIT) the amount of grains of sand on Earth. 32 bits is *nothing* when it comes to entropy, and it can take a security researcher (like us) only $100 to rent a machine to completely brute force it. Nowadays, only values less than 128 or 256 bits (which are *exponentially* bigger) are seen as appropriate. | | --- | --- | --- | | | |  |  | [comboy](user?id=comboy) [on Aug 9, 2023](item?id=37057399)   | [root](#37055333) | [parent](#37055540) | [next](#37055516) [–]  You mean time is the only source of entropy there? I don't think number of bits would even matter for it to be bad in such case. | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 9, 2023](item?id=37061544)   | [root](#37055333) | [parent](#37057399) | [next](#37055516) [–]  That is correct, time is the only entropy for the command, and the function they use to generate random numbers is also flawed in that it can only produce 2^32 possible outputs. | | --- | --- | --- | | | |  |  | [wmf](user?id=wmf) [on Aug 8, 2023](item?id=37055516)   | [root](#37055333) | [parent](#37055454) | [prev](#37055540) | [next](#37055436) [–]  As the article explains, 32 bits of entropy isn't enough for any cryptographic secret because it can be easily brute-forced. | | --- | --- | --- | | | |  |  | [NelsonMinar](user?id=NelsonMinar) [on Aug 8, 2023](item?id=37055707)   | [root](#37055333) | [parent](#37055516) | [next](#37055436) [–]  Also if it's really the date it's nowhere near 32 bits of entropy. I'm guessing you can pretty easily guess to the day when a Bitcoin wallet was created, so that's about 16 bits of entropy. Less if you know the time, possibly 0. | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37055844)   | [root](#37055333) | [parent](#37055707) | [next](#37055436) [–]  It actually uses the most precise 32 bits of the date, so it's any, like, nanosecond between 0 and some other small amount of seconds. You can't brute force a wallet by knowing *approximately* when it was made, but you *can* brute force *every* mnemonic if you have the time or a bit of cash to throw at a server. EDIT: It loops around to 0 every 4.something seconds, so it's not like everything after 4 is the same key. It's just a more random distribution than what you may be thinking. | | --- | --- | --- | | | |  |  | [aidenn0](user?id=aidenn0) [on Aug 8, 2023](item?id=37055945)   | [root](#37055333) | [parent](#37055844) | [next](#37055436) [–]  There is often very low entropy in the lowest few bits of system time as well (due to the underlying clock having a different resolution than the system call). Given that every bit you lose halves the time for a brute-force, that's a problem. | | --- | --- | --- | | | |  |  | [lostmsu](user?id=lostmsu) [on Aug 8, 2023](item?id=37055436)   | [prev](#37055333) | [next](#37055433) [–]  Note: "Libbitcoin" here is a company name, and not a name of the core bitcoin library. Only their products and whoever used them as a 3rd party is affected. | | --- | --- | --- | | | |  |  | [WraithM](user?id=WraithM) [on Aug 9, 2023](item?id=37057954)   | [parent](#37055436) | [next](#37056541) [–]  libbitcoin isn't a company. It's an alternative C++ implementation (<https://github.com/libbitcoin>) to the Bitcoin Core (<https://github.com/bitcoin/bitcoin>) implementation. Bitcoin Core is the one originally from Satoshi. Libbitcoin came in like 2011 or so iirc and was led by Amir Taaki. Libbitcoin is a lot less popular than Bitcoin Core, as you can see on the github stats. | | --- | --- | --- | | | |  |  | [usr1106](user?id=usr1106) [on Aug 9, 2023](item?id=37059610)   | [root](#37055436) | [parent](#37057954) | [next](#37056541) [–]  Last release 2019, master branch marked as non-functional. Doesn't seem to be very active. Their homepage <https://libbitcoin.info/> looks polished, but no signs of recent life. This vulnerability seems unmentioned. Well, they claim it's not a vulnerability but a demo implementation that should not be used to store anything of value. But there is no prominent note about that and some users did exactly that. | | --- | --- | --- | | | |  |  | [drexlspivey](user?id=drexlspivey) [on Aug 8, 2023](item?id=37056541)   | [parent](#37055436) | [prev](#37057954) | [next](#37055579) [–]  Here's a thread on how bitcoin core generates entropy <https://twitter.com/raw_avocado/status/1445024873382809604> | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058068)   | [root](#37055436) | [parent](#37056541) | [next](#37055579) [–]  that thread is a little confused: Particularly, 'The Dynamic and Static events are mixed in(mostly) by using "<<" Left Shift Bits. Because it's a binary operation, every digit is a power of 2, so shifting the bit n positions ends up multiplying by 2^n. This adds further confusion when multiple numbers are used at once.' --- the tweet appears to be confusing C++ stream usage of "<<" with shifting (and as a result makes it sound like the code is doing something idiotic). Here is how it works: Lots of potential entropy sources including the essential good ones (as well as junk ones like timestamps and user/host info) are fed into a cryptographic hash then strengthened with iterated hashing. The junk sources are included as a hail mary so the user might have some chance to move their funds if they learn about vulnerabilities in their OS/hardware RNGs before an attacker can brute force out the weak sources. | | --- | --- | --- | | | |  |  | [alexwaltz](user?id=alexwaltz) [on Aug 9, 2023](item?id=37065377)   | [root](#37055436) | [parent](#37058068) | [next](#37055579) [–]  OMG, i'm a bit star struck seeing you reply to this. Been reading you posts on btctalk for years :D Sorry about that, my bad, I though i understand how that works, when I was exploring this topic i literally asked everyone i know and no one seemed to have any idea, and then when i felt i got a conclusion i was happy i found some explanation. Anyway that just an excuse at the end of the day. I have added to the thread a screenshoot of your reply and link to this conversation. <https://twitter.com/raw_avocado/status/1689317198626422784> Thanks for clarifying that. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 10, 2023](item?id=37070906)   | [root](#37055436) | [parent](#37065377) | [next](#37055579) [–]  No need for excuses. The fact that people didn't already get this stuff well enough to correct you on the spot suggests that there is a need for more explanation! | | --- | --- | --- | | | |  |  | [Modified3019](user?id=Modified3019) [on Aug 8, 2023](item?id=37055579)   | [parent](#37055436) | [prev](#37056541) | [next](#37055433) [–]  Exactly what I came here to find out, thank you. | | --- | --- | --- | | | |  |  | [kmeisthax](user?id=kmeisthax) [on Aug 8, 2023](item?id=37055433)   | [prev](#37055436) | [next](#37056329) [–]  Reminds me of attacks people were running on 'brainwallets' a while back - i.e. wallets whose initial key material was just a passphrase you'd remember. The idea was that you could keep the passphrase stored *nowhere* and not have to worry about it being stolen by... well, any of the 10,000 things out there looking for cryptocurrency keys. Of course, there is no way in hell you can actually make the human brain store enough entropy perfectly, and once people realized that these wallets were crackable, they all got drained pretty quick. Owning Bitcoin is like paying into an involuntary bug bounty program. Every time someone finds a bug, your life savings get wiped out. | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 8, 2023](item?id=37055481)   | [parent](#37055433) | [next](#37055749) [–]  Do you have a reference for large numbers of brain wallets being drained? I believe you are repeating a myth/FUD, but I might be wrong. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 8, 2023](item?id=37055873)   | [root](#37055433) | [parent](#37055481) | [next](#37058244) [–]  <https://www.cs.unm.edu/~vasek/papers/vasekfc16.pdf> Also, there was an ethereum wallet with over 40,000 ETH that got drained. | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 9, 2023](item?id=37057372)   | [root](#37055433) | [parent](#37055873) | [next](#37058244) [–]  From their conclusion: > By examining 300 billion candidate passwords, we found 884 brain wallets that were active at some point in time. Unfortunately, we also found that nearly all were drained – usually quickly. While our findings are necessarily incomplete, they certainly suggest that brain wallets are not a secure method for using bitcoin. Perhaps the most surprising result of our analysis is the relative scarcity of brain wallets in use today. This is actually quite encouraging, because it means that fewer users are at risk to these attacks than has previously been supposed. I don’t think that logic holds up. It’s pretty much an entire paper of FUD. And no, anyone with 400,000 ETH who claims they used a brain wallet, and oppsie .. someone stole it. Is having a boating accident, if you know what I mean. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 9, 2023](item?id=37059502)   | [root](#37055433) | [parent](#37057372) | [next](#37058244) [–]  Someone used the passphrase "how much wood could a woodchuck chuck if a woodchuck could chuck wood" to store 250 BTC. I personally drained it by mistake, then tracked down the owner, via the pool he'd mined it from. I'm a co-author of that paper, we later got funding to do a larger cracking run and found more wallets, and even some that still had balances. See slide 18: [https://rya.nc/files/measuring\_the\_use\_and\_abuse\_of\_brain\_wa...](https://rya.nc/files/measuring_the_use_and_abuse_of_brain_wallets.pdf) Feeding a massive corpus reddit comments and six years of IRC logs into the cracking tool was particularly interesting. > And no, anyone with 400,000 ETH who claims they used a brain wallet, and oppsie .. someone stole it. Is having a boating accident, if you know what I mean. It was about 40,000. The password was "guybrush", and I spoke to the guy who made it. He didn't understand how the tool worked when he made an address. Much later, the Ethereum foundation sent him the ETH. It was gone by the time he went to spend it. Dude put out a press release offering to let whoever did it keep half if they gave back the other half. The ETH hasn't moved since the day it was stolen, almost eight years ago. I assure you, the guy made a genuine fucky wucky. If I'd gone blackhat with this research, I could be retired to a volcano lair on a private island by now. WTF is your angle here? | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 10, 2023](item?id=37075261)   | [root](#37055433) | [parent](#37059502) | [next](#37058244) [–]  That sounds exactly like a well acted boating accident. My angle is that simple brain wallets that use a combination of a memorable phrase with some individual information, like the user’s name, birthdate, address and a 4 digit PIN, used as salt, are then extremely secure. And your paper and the original comment I responded to don’t emphasize that it’s the user’s use of such an systen that makes them vulnerable not the foundation of the technique of brainwallets. Basically you’re blaming the car for the drivers not understanding how to drive and immediately crashing. | | --- | --- | --- | | | |  |  | [kmeisthax](user?id=kmeisthax) [on Aug 11, 2023](item?id=37090580)   | [root](#37055433) | [parent](#37075261) | [next](#37082251) [–]  And you're blaming the victim for not understanding things that were never explained to them until after they were already pwned. The correct way to handle this would be for brainwallet software to generate and provide the user with a high-entropy passphrase rather than asking for the user to provide one. Failing that, it could at least reject very-low-entropy passwords (e.g. impose a minimum 20 character limit). But even then we're band-aiding the underlying problem, which is that decentralization[0] and finance go together about as well as twizzlers and guacamole. Transaction reversibility is a *feature*, not a bug, and there's no trustworthy way to implement that sort of thing in a decentralized finance system. Absent a way to dispute fraudulent transactions the only way to avoid your money becoming everyone's money is to overcompensate on preventative measures: i.e. insanely long passphrases stored on hardware keys in lockboxes buried under a garden birdbath. And sure, yes, we can point and laugh at the credit card industry for treating primary account numbers printed on the front of the card as secure tokens, taking decades to adopt EMV cards in the US, charging horrible swipe and chargeback fees to businesses, and so on. However, there is a reason why, a decade and a half in, people use credit cards and not Bitcoin. Credit cards actually function as a payment mechanism and you are less likely to be defrauded using them. [0] I additionally dispute the idea that any cryptocurrency system is actually decentralized. The need to agree on the validity and order of transactions necessarily requires one individual or institution actually decide the rules everyone else, *with unanimity*, agrees upon. Operation of the network is nominally decentralized but the need for security against transaction reordering in the face of no strong identity being available means that practically, it *is* centralized. We've seen this with the 'scaling wars' of Bitcoin. Two groups of shadowy puppetmasters - developers and miners - duked it out over absurdly stupid technical arguments regarding how to scale Bitcoin. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 10, 2023](item?id=37082251)   | [root](#37055433) | [parent](#37075261) | [prev](#37090580) | [next](#37058244) [–]  > don’t emphasize that it’s the user’s use of such an systen that makes them vulnerable not the foundation of the technique of brainwallets. That's because it *is* the foundation of the technique that makes them vulnerable. They are an "attractive nuisance". A system must be evaluated based on "typical use", not "perfect use". You come across as a social Darwinist who would be happy for all the warning labels to be removed from everything and all safety regulations repealed. The world you advocate for would be an awful dystopia. You have nothing to say I haven't heard before. | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 10, 2023](item?id=37082450)   | [root](#37055433) | [parent](#37082251) | [next](#37058244) [–]  > WTF is your angle here? I think this more applied to you. You actually invested time to write a paper about brainwallets because some people don’t understand or know how to use them properly. The paper is not logical, if it was then a small POC I know about is all of them, which obviously it isn’t, you can’t find serious people’s brainwallets, they would be salted in a way that it’s hopeless to crack. You claim brainwallets are fundamentally unsafe, which honestly is total nonsense if you understand them and how they work. I’m gonna guess you’re a ban Bitcoin type because it’s… wrong or whatever. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 11, 2023](item?id=37084431)   | [root](#37055433) | [parent](#37082450) | [next](#37058244) [–]  I'm going to go play chess with a pigeon, it seems like a better use of my time. | | --- | --- | --- | | | |  |  | [werrett](user?id=werrett) [on Aug 9, 2023](item?id=37058244)   | [root](#37055433) | [parent](#37055481) | [prev](#37055873) | [next](#37058046) [–]  It’s not not a myth. Not even really lost to time (or a simple Google search). E.g [https://www.reddit.com/r/Bitcoin/comments/1zti1p/17956\_hacke...](https://www.reddit.com/r/Bitcoin/comments/1zti1p/17956_hacked_brainwallet_passwords/) [https://www.wired.com/2015/07/brainflayer-password-cracker-s...](https://www.wired.com/2015/07/brainflayer-password-cracker-steals-bitcoins-brain/) | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 9, 2023](item?id=37058397)   | [root](#37055433) | [parent](#37058244) | [next](#37058046) [–]  FUD!! and you know it if you actually took time to read the post. > I could find the passwords for 17.956 of the addresses. \* Only 2 addresses of the hacked brainwallets are currently not empty, and the total money that I could actually steal is 0.00115215 BTC. > Somebody seems to have systematically flooded the blockchain with transaction to brainwallets. E.g. this transaction: [https://blockchain.info/tx/ba421da33e5f85669d9312b804e22fa4c...](https://blockchain.info/tx/ba421da33e5f85669d9312b804e22fa4cfd1392bb7bb51c7390c91d8598cd071) It seems that each target address is actually a brainwallet and alphabetically ordered. The passwords for the first 3 addresses are Hollister, hollowing, Nobody’s real brain wallets are being hacked! It’s just left over traces from someone running aome testing in early days of bitcoin. This one says 17K wallets … oppsie all empty and obviously programmatically generated! i.e not used for real. The other paper found 800!! supposedly… all empty. A well designed brainwallet is perfectly fine and safe, just don’t use a sequential phrase from known sources and modify the words you do. Obviously. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058584)   | [root](#37055433) | [parent](#37058397) | [next](#37058846) [–]  > Nobody’s real brain wallets are being hacked! It’s just left over traces from someone running aome testing in early days of bitcoin. I've talked to a LOT of real people who's real brainwallets were hacked. Certainly there is also some 'testing' but that doesn't change the fact that there have been real and substantial losses. Brainwallets are very dangerous. A brainwallet is the same thing as using a user provided password to secure a high value system that has an unsalted and *public* password hash database. This is a negligent practice. In the corporate world it wouldn't be shocking to learn that a security engineer was instantly fired for implementing such a practice. Good security advice results in practical security even if the user uses the system less than perfectly. Attacker-originated security "advice" provides security only under unrealistic perfect use. Telling people to use brainwallets is like recommending one-time-pad encryption. In practice the security will be fragile if not outright broken though in theory with it may go okay sometimes. Correct usage would require secure mechanically generated uniformly random seed phrases with a hundred plus bits of entropy. That isn't generally what people do in practice and the few who have often have issues with retention of the string being inevitably very poor, causing them to lose the funds by forgetting (esp after getting a fever). (Of course, if they're going to write it down and they didn't generate it themselves then it's not something anyone should be calling a brainwallet anymore.) | | --- | --- | --- | | | |  |  | [siwatanejo](user?id=siwatanejo) [on Aug 9, 2023](item?id=37058846)   | [root](#37055433) | [parent](#37058397) | [prev](#37058584) | [next](#37059407) [–]  > A well designed brainwallet is perfectly fine and safe Especially if the brainwallet adds a salt, which is maybe the problem that the previous poster was referring to. Brainwallets that don't add a salt are definitely a risk. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 9, 2023](item?id=37059407)   | [root](#37055433) | [parent](#37058397) | [prev](#37058846) | [next](#37058046) [–]  Did a brainwallet write this? | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 9, 2023](item?id=37058046)   | [root](#37055433) | [parent](#37055481) | [prev](#37058244) | [next](#37055749) [–]  What would change your view about that? This was one of the best uses of GPUs 10 years ago, people still have those instances running just in case people use “obscure” common phrases from books again instead of mnemonics Its more like anyone that thought they were clever got swept. There arent statistics, just threads on bitcointalk and reddit | | --- | --- | --- | | | |  |  | [alchemist1e9](user?id=alchemist1e9) [on Aug 9, 2023](item?id=37058409)   | [root](#37055433) | [parent](#37058046) | [next](#37055749) [–]  If you used common phrases from books you definitely aren’t clever and deserve to have your funds swept. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058593)   | [root](#37055433) | [parent](#37058409) | [next](#37055749) [–]  The person who originated the practice and created the first "brainwallet" site did exactly what you're doing: insisted that it was secure, and insisted that people who lost their funds deserved it. Are you also doing what he did? stealing the funds of the deserving victims yourself? Eventually taking the weak brainwallets he talked people into creating wasn't enough: He lost his bitcoin (I think via gambling but maybe an exchange hack), whined he was broke for a while, and whined that not many people were making hackable brainwallets, then added a more explicit vulnerability to the site. He vanished after it was caught. | | --- | --- | --- | | | |  |  | [tomjakubowski](user?id=tomjakubowski) [on Aug 8, 2023](item?id=37055749)   | [parent](#37055433) | [prev](#37055481) | [next](#37055480) [–]  You only need a phrase of twelve words from a 2048 word dictionary to have 128 bits of entropy. Twelve words is up to "Thy kingdom" in the Lord's Prayer, so certainly people are able to memorize twelve word phrases or even 24 word phrases without too much trouble. And English is a lot more than 2048 words - so you could probably use a shorter phrase and still be fine. | | --- | --- | --- | | | |  |  | [rcoveson](user?id=rcoveson) [on Aug 8, 2023](item?id=37055827)   | [root](#37055433) | [parent](#37055749) | [next](#37055879) [–]  The thing about the Lord's Prayer doesn't really follow. If you use a grammatically correct and semantically commonplace 12 word sequence like that, you surely don't have 128 bits of entropy. But the ease of memorization comes almost entirely from those attributes! To get 128 bits of entropy with words, you need to pick about thirteen out of a million words--which is on the order of *all* the words in the English language--and give all of them equal probability. The sequence needs to be fully random as well. What you end up with will surely be easier to memorize than a UUID, but substantially more difficult than the start of the Lord's Prayer. EDIT: Math is wrong, I was thinking 10 bits per million instead of 20. So 6-7 words out of a million (whole language) or 13 words out of a thousand (very limited subset of the language). Point about random selection still stands, but it's certainly easier than 13 very uncommon words. Still much harder than a realistic sentence of that length, though. | | --- | --- | --- | | | |  |  | [quonn](user?id=quonn) [on Aug 8, 2023](item?id=37055879)   | [root](#37055433) | [parent](#37055749) | [prev](#37055827) | [next](#37056861) [–]  But the phrases are random, so unlike poems or prayers they are difficult to memorize. | | --- | --- | --- | | | |  |  | [sparkie](user?id=sparkie) [on Aug 8, 2023](item?id=37056607)   | [root](#37055433) | [parent](#37055879) | [next](#37056861) [–]  Create your own haiku, never publish it. What are the odds of someone creating exactly the same haiku? | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37057693)   | [root](#37055433) | [parent](#37056607) | [next](#37056861) [–]  Probably much higher than you suspect. Making password haikus is an obvious idea which has been suggested many times before. I'm sure that even with a great statistical model of password haikus (say an LLM) yours would still be one in a billion which still seems unlikely, but a cracking cluster can try billions per second. In these cases it's very easy to have security that depends on the odds that a powerful attacker just hasn't gotten around to seriously trying the broad class of predictable generation schemes you've used. | | --- | --- | --- | | | |  |  | [MauranKilom](user?id=MauranKilom) [on Aug 8, 2023](item?id=37056861)   | [root](#37055433) | [parent](#37055749) | [prev](#37055879) | [next](#37056538) [–]  For reference, normal English writing has about 1 bit of entropy per character. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 8, 2023](item?id=37056538)   | [root](#37055433) | [parent](#37055749) | [prev](#37056861) | [next](#37055480) [–]  Unfortunately there is good reason to think that memorability and low entropy (against a sufficiently advanced sequence generator) are highly related. | | --- | --- | --- | | | |  |  | [ajross](user?id=ajross) [on Aug 8, 2023](item?id=37055480)   | [parent](#37055433) | [prev](#37055749) | [next](#37057735) [–]  > Of course, there is no way in hell you can actually make the human brain store enough entropy perfectly Sure there is. Have horse batteries taught us nothing? <https://xkcd.com/936/> Don't confuse key length with entropy. A properly-scaled PBKDF remains secure with as little as 48 bits or so. Needless to say, though, a 32 bit time value is hardly a properly designed key derivation input. | | --- | --- | --- | | | |  |  | [mkj](user?id=mkj) [on Aug 9, 2023](item?id=37064115)   | [root](#37055433) | [parent](#37055480) | [next](#37056301) [–]  Diceware has been round for ages to do this (2 decades+?) <https://theworld.com/~reinhold/diceware.html> I made a little android app using it to generate passphrases, each word gives 13 bits. So 6 words is plenty for a disk encryption password at boot. <https://github.com/mkj/dice> | | --- | --- | --- | | | |  |  | [codetrotter](user?id=codetrotter) [on Aug 8, 2023](item?id=37056301)   | [root](#37055433) | [parent](#37055480) | [prev](#37064115) | [next](#37057123) [–]  This xkcd comic has been instrumental to me. I wrote a command-line utility a couple of years ago that I use myself regularly to generate secure and memorable passwords <https://github.com/ctsrc/Pgen> With this tool you can also see how many bits of entropy the passphrase generation settings you are using will result in. For example, generating a 5 word passphrase using the long wordlist ```     pgen -l -n 5  ``` will yield a passphrase like: ```     joyous embolism outsider evasion mashed  ``` And when we ask the tool for the entropy with these settings ```     pgen -l -n 5 -e  ``` it will tell us: ```     Current settings will create passphrases with 64.62 bits of entropy.  ``` And hey, if you have reason to not trust the randomness capabilities of the program or your computer guess what :) My program supports the use of physical dice to generate your password. Have a look, try it out yourselves :D <https://github.com/ctsrc/Pgen> | | --- | --- | --- | | | |  |  | [avnigo](user?id=avnigo) [on Aug 8, 2023](item?id=37056812)   | [root](#37055433) | [parent](#37056301) | [next](#37056344) [–]  That’s excellent! I had the same idea I completed a few weeks ago in python trying to write it with the standard library and have it be easily auditable. You can check it out here if you want: <https://github.com/avnigo/nodice-cli> | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056344)   | [root](#37055433) | [parent](#37056301) | [prev](#37056812) | [next](#37057755) [–]  It looks neat, I'll pass this along to the team and take a deeper look at it later. | | --- | --- | --- | | | |  |  | [sowbug](user?id=sowbug) [on Aug 8, 2023](item?id=37056837)   | [root](#37055433) | [parent](#37056344) | [next](#37057755) [–]  Also generating a BIP39 seed from <https://iancoleman.io/bip39/> and using as many words from the output as you want for your purposes. | | --- | --- | --- | | | |  |  | [iraqmtpizza](user?id=iraqmtpizza) [on Aug 9, 2023](item?id=37057755)   | [root](#37055433) | [parent](#37056301) | [prev](#37056344) | [next](#37057123) [–]  dibs on joyous embolism outsider evasion mashed. this is my new password | | --- | --- | --- | | | |  |  | [bombcar](user?id=bombcar) [on Aug 9, 2023](item?id=37061142)   | [root](#37055433) | [parent](#37057755) | [next](#37057123) [–]  It’s better than your last one, hunter2 | | --- | --- | --- | | | |  |  | [kmeisthax](user?id=kmeisthax) [on Aug 9, 2023](item?id=37057123)   | [root](#37055433) | [parent](#37055480) | [prev](#37056301) | [next](#37057735) [–]  I use these passwords all the time. However, you should keep in mind the text in the comic: > (Plausible attack on a weak remote web service. Yes, cracking a stolen hash is faster, but it's not what the average user should worry about.) This is *almost* a sound assumption for most web services[1]. However, this is Bitcoin. The only thing the attacker has *is* your hash. And you're using a payments system which economically incentivizes the creation of ever-larger systems for brute-forcing hashes. The network's hash power as a whole is estimated to be around 331 exahashes per second, so 68 bits of entropy would take one second to crack. Correct horse battery staple would be cracked in fractions of a second by the full network. Eight common words would take 12 days. If we go further to 12 words, then we do get reasonable levels of security, but I'm assuming hashrates stay constant forever which is a bad assumption. And 12 word passphrases will already be about as much of a pain to remember as the 'password policy compliant' passwords xkcd was railing against. [1] The most likely attack is actually credential-stuffing, not brute-force. xkcd is assuming you already use separate passwords. Related: The password hashes for the xkcd forums actually did leak and it turned out most people's passwords were "correct horse battery staple". No, not four random words. I mean the literal text "correct horse battery staple". | | --- | --- | --- | | | |  |  | [ajross](user?id=ajross) [on Aug 9, 2023](item?id=37061699)   | [root](#37055433) | [parent](#37057123) | [next](#37057817) [–]  > However, this is Bitcoin. The only thing the attacker has is your hash. You're doing exactly the "confusing entropy with key length" thing I was mentioning above. That's not the situation at hand. The entropy in question is the private key generation, it's not related to any SHA256 hash in the protocol. But you're right, if you were trying to generate symmetric keys using a 48 bit password expanded using SHA256 as a PBKDF that would be a disaster. But no software is doing that[1]. All you need to do is pull a key derivation function off the shelf and use it with recommended parameters. Really these have been stable, even bcrypt is still very solid. Your question was essentially "can a human being remember enough entropy to secure a bitcoin wallet". And the answer is absolutely yes. [1] What it was doing was even worse, of course. | | --- | --- | --- | | | |  |  | [fbdab103](user?id=fbdab103) [on Aug 9, 2023](item?id=37057817)   | [root](#37055433) | [parent](#37057123) | [prev](#37061699) | [next](#37057735) [–]  >Related: The password hashes for the xkcd forums actually did leak and it turned out most people's passwords were "correct horse battery staple". Not sure I would read too much into that. I am sure many people value the community there, but it it ultimately, a web forum around a web comic. | | --- | --- | --- | | | |  |  | [iraqmtpizza](user?id=iraqmtpizza) [on Aug 9, 2023](item?id=37057735)   | [parent](#37055433) | [prev](#37055480) | [next](#37056169) [–]  Encrypting your hard drive is like paying into an involuntary bug bounty program. Every time someone finds a bug, your nudes get posted to the internet. | | --- | --- | --- | | | |  |  | [TravelTechGuy](user?id=TravelTechGuy) [on Aug 8, 2023](item?id=37056169)   | [parent](#37055433) | [prev](#37057735) | [next](#37056329) [–]  Your last sentence should be a t-shirt. | | --- | --- | --- | | | |  |  | [RustyRussell](user?id=RustyRussell) [on Aug 8, 2023](item?id=37056329)   | [prev](#37055433) | [next](#37057395) [–]  Worth noting: libbitcoin is an obscure project with an impressive name. In that it's not used by bitcoind or any wallets I know of: it's mainly of interest here because the book Mastering Bitcoin used it for examples. | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 8, 2023](item?id=37056591)   | [parent](#37056329) | [next](#37056714) [–]  It is also of interest because at least ~$1m of funds were stolen from thousands of wallets made by people that wanted a simple and seemingly reputable CLI tool to generate a mnemonic and derive addresses for various coins. | | --- | --- | --- | | | |  |  | [RustyRussell](user?id=RustyRussell) [on Aug 8, 2023](item?id=37056655)   | [root](#37056329) | [parent](#37056591) | [next](#37075354) [–]  Sigh. I did not know that, thanks :( | | --- | --- | --- | | | |  |  | [Zenul\_Abidin](user?id=Zenul_Abidin) [on Aug 10, 2023](item?id=37075354)   | [root](#37056329) | [parent](#37056591) | [prev](#37056655) | [next](#37056714) [–]  Now I'm busy making my own CLI for that, after this mess. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 8, 2023](item?id=37056714)   | [parent](#37056329) | [prev](#37056591) | [next](#37056966) [–]  It's far from the first time that people have sought to make themselves extra secure and as a result found themselves using obscure software which was inadequately reviewed and flawed or even outright backdoored and as a result received almost no security at all. | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 8, 2023](item?id=37056966)   | [parent](#37056329) | [prev](#37056714) | [next](#37057395) [–]  there are a couple crypto programming youtube videos like that, remix IDE put up a warning at one point its an interesting attack vector provide educational resources with compromised examples wait for dev or their users to deposit funds in the copy and pasted contract or dependency long game, been wondering how well that worked | | --- | --- | --- | | | |  |  | [TacticalCoder](user?id=TacticalCoder) [on Aug 9, 2023](item?id=37057395)   | [prev](#37056329) | [next](#37057434) [–]  > [https://blog.ledger.com/Funds-of-every-wallet-created-with-t...](https://blog.ledger.com/Funds-of-every-wallet-created-with-the-Trust-Wallet-browser-extension-could-have-been-stolen/) This "Milk Sad" was apparently discovered by the guys at Ledger (they make a hardware wallet but which can also be used as a U2F device for, say, SSH logins). These guys are good. Their CTO (or ex-CTO ?) was part of the original FIDO alliance that came up with the U2F spec. | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 10, 2023](item?id=37073808)   | [parent](#37057395) | [next](#37057434) [–]  We found the flaw in bx before ever knowing the Trustwallet flaw existed. We are not the Ledger team but their writeup on their very similar finding was fantastic so we reference it prominently. | | --- | --- | --- | | | |  |  | [comex](user?id=comex) [on Aug 9, 2023](item?id=37057434)   | [prev](#37057395) | [next](#37055117) [–]  The spiciest bit: > During our accelerated coordinated disclosure to the Libbitcoin team, the Libbitcoin team quickly disputed the relevancy of our findings and the CVE assignment. By our understanding, they consider bx seed a command that should never be used productively by any bx user since it is sufficiently documented as unsuited for safe wallet generation. > We do not agree with this assessment. [https://milksad.info/disclosure.html#libbitcoin-vendor-respo...](https://milksad.info/disclosure.html#libbitcoin-vendor-response) | | --- | --- | --- | | | |  |  | [lclc](user?id=lclc) [on Aug 9, 2023](item?id=37059181)   | [parent](#37057434) | [next](#37055117) [–]  Look at the big warning there: [https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-se...](https://github.com/libbitcoin/libbitcoin-explorer/wiki/bx-seed) He's right. | | --- | --- | --- | | | |  |  | [yodelshady](user?id=yodelshady) [on Aug 9, 2023](item?id=37061445)   | [root](#37057434) | [parent](#37059181) | [next](#37060335) [–]  No, he's not. Why have it? This isn't a general purpose programming language, a pile of ore from which you might conceivably construct a footgun. It's a toolkit specifically designed for financial applications with a "leak your financial details" tool built in. Sure, it's AGPL, they're not literally liable, but it's not great. | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 9, 2023](item?id=37060335)   | [root](#37057434) | [parent](#37059181) | [prev](#37061445) | [next](#37055117) [–]  I would call your attention to the several places it was demonstrated for use by libbitcoin team members -without- a warning, such as in their contributed examples in Mastering Bitcoin. We cover a few of such examples in the writeup. Also note that the tool bothers to refuse to use a flag to specify 32 bit seeds, due to their known risks, but then proceeds to give you only 32 bits of entropy anyway even if you ask for 256. | | --- | --- | --- | | | |  |  | [hashmush](user?id=hashmush) [on Aug 8, 2023](item?id=37055117)   | [prev](#37057434) | [next](#37058627) [–]  Seems a bit overkill with a brand + domain name for every new vulnerability. Don't get me wrong, it's a nice find and all, but I'm really distracted by all the fluff. | | --- | --- | --- | | | |  |  | [tptacek](user?id=tptacek) [on Aug 8, 2023](item?id=37055132)   | [parent](#37055117) | [next](#37055734) [–]  That's on you, though. The name doesn't cost anything, but it does make the vulnerability easier to talk about. | | --- | --- | --- | | | |  |  | [thomastjeffery](user?id=thomastjeffery) [on Aug 8, 2023](item?id=37055222)   | [root](#37055117) | [parent](#37055132) | [next](#37055734) [–]  I suspect the domain literally cost money... | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 8, 2023](item?id=37055240)   | [root](#37055117) | [parent](#37055222) | [next](#37055734) [–]  It cost me $4 to help get the word out on a bug that is being actively exploited right now, stealing valuable property. I am good with that. | | --- | --- | --- | | | |  |  | [lalopalota](user?id=lalopalota) [on Aug 8, 2023](item?id=37055760)   | [root](#37055117) | [parent](#37055240) | [next](#37055734) [–]  Where do you buy a $4 domain? | | --- | --- | --- | | | |  |  | [jnaulty](user?id=jnaulty) [on Aug 8, 2023](item?id=37055966)   | [root](#37055117) | [parent](#37055760) | [next](#37056576) [–]  based on the `whois milksad.info` Domain registrar is Namecheap :shrug: | | --- | --- | --- | | | |  |  | [topato](user?id=topato) [on Aug 8, 2023](item?id=37056576)   | [root](#37055117) | [parent](#37055760) | [prev](#37055966) | [next](#37055734) [–]  Porkbun? I buy under a dollar domains from them frequently | | --- | --- | --- | | | |  |  | [NelsonMinar](user?id=NelsonMinar) [on Aug 8, 2023](item?id=37055734)   | [parent](#37055117) | [prev](#37055132) | [next](#37058627) [–]  Eh, let the security consultants have their moment. Also it's a great name. "Running bx seed on 3.x versions with a system time of 0.0 always generates the following secret: milk sad wage cup reward..." | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37055868)   | [root](#37055117) | [parent](#37055734) | [next](#37061158) [–]  we had so much fun trying to figure out the icon! | | --- | --- | --- | | | |  |  | [bombcar](user?id=bombcar) [on Aug 9, 2023](item?id=37061158)   | [root](#37055117) | [parent](#37055734) | [prev](#37055868) | [next](#37058627) [–]  Milk sad is ok. “Wage cup reward” is almost poetry … | | --- | --- | --- | | | |  |  | [mkj](user?id=mkj) [on Aug 9, 2023](item?id=37058627)   | [prev](#37055117) | [next](#37056462) [–]  Was the code seeding by seconds since epoch, or nanoseconds since epoch truncated to 32 bits? Broken either way. [https://github.com/libbitcoin/libbitcoin-system/blob/a1b777f...](https://github.com/libbitcoin/libbitcoin-system/blob/a1b777fc51d9c04e0c7a1dec5cc746b82a6afe64/src/crypto/pseudo_random.cpp#L70) ```         const auto now = high_resolution_clock::now();         return static_cast<uint32_t>(now.time_since_epoch().count()); ``` | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 9, 2023](item?id=37061595)   | [parent](#37058627) | [next](#37056462) [–]  Nanoseconds since epoch, which means eventually it does loop around, so at the very least it's not possible to generate a *specific* wallet by knowing when it was first used. | | --- | --- | --- | | | |  |  | [infofarmer](user?id=infofarmer) [on Aug 9, 2023](item?id=37061783)   | [root](#37058627) | [parent](#37061595) | [next](#37056462) [–]  A quick search says it's actually ticks, which is OS and machine dependent (kernel tunable). Nanosecond resolution is not enough for a seed if it's a real datetime, so the 32-bit truncation is a separate problem. | | --- | --- | --- | | | |  |  | [tedunangst](user?id=tedunangst) [on Aug 8, 2023](item?id=37056462)   | [prev](#37058627) | [next](#37057601) [–]  Weird. I've been assured, repeatedly, that time seeded PRNGs are never used for crypto and it's not an issue worth addressing. | | --- | --- | --- | | | |  |  | [sowbug](user?id=sowbug) [on Aug 8, 2023](item?id=37056850)   | [parent](#37056462) | [next](#37056573) [–]  There is no single codebase for "crypto," so that would be an extraordinary assurance for someone to make. Even Bitcoin has many different compatible implementations of varying quality. | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056573)   | [parent](#37056462) | [prev](#37056850) | [next](#37057601) [–]  As long as people can write code, bugs will exist. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37057601)   | [prev](#37056462) | [next](#37055978) [–]  Some extra relevant links: <https://github.com/libbitcoin/libbitcoin-system/pull/559> The pull request adding the vulnerability, the lack of review or collaboration is worth noticing. The prior code was already dubious in that AFAIK std::random\_device library doesn't promise that the randomness is suitable for cryptography. I believe on common systems where this code was run the old code was not *likely* to be exploitable, but I wouldn't bet my money on it. <https://twitter.com/evoskuil/status/1688657656620167169> Developer commentary on this issue. I can't figure out what "long-documented intended usage" a seed command that mandates 128-bits of output but never has more than 32-bits of entropy would have. <https://archive.is/A7Jn6> The documentation the tweet references. I don't know how the 'Pseudorandom seeding' warning there would be distinguishable from warnings against CSPRNGs in favor of dice rolls or whatever, perhaps this is an example of the harm that chicken-little crying about CSPRNGS causes. Nor can I figure out for whose convenience this function would serve except attackers. In any case, this is the only place I found any kind of warning and the warning postdates the mastering bitcoin usage (as well as the change that made the command unconditionally unsafe). <https://archive.is/HDe8h> Current libbitcoin-explorer instructions telling users to use the seed command to generate private keys. <https://archive.is/fhm5J#selection-12915.2-12915.10> Current libbitcoin-explorer instructions telling users to use the seed command to generate BIP39 seeds (also private keys). <https://archive.is/PWLKJ> Current libbitcoin-explorer documentation on randomness noting that bx seed is the ONLY source of randomness available to users in the package, and that all other commands that need randomness require the user to provide it. It also notes that 'bx seed' will not function if less than 128-bits are requested. The private key and bip39 seed usage (above) sure appears to be the "intended usage" in their documentation, but the "bx seed" function as currently implemented (since 2016) is unambiguously not fit for those purpose. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058794)   | [parent](#37057601) | [next](#37057713) [–]  <https://twitter.com/evoskuil/status/1689128996120776704> No intent to change. The tweet confused about thinking this was some third party wallet using libbitcoin. Instead, from the writeup it appears that at least some of the users followed the above BIP39 seed generation instructions to generate a seed that they used with other assorted BIP39 compatible wallets such as typical hardware wallets. | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 10, 2023](item?id=37070910)   | [root](#37057601) | [parent](#37058794) | [next](#37057713) [–]  uhh... <https://twitter.com/utxoclub/status/1689323302408306688> | | --- | --- | --- | | | |  |  | [midmagico](user?id=midmagico) [on Aug 9, 2023](item?id=37057713)   | [parent](#37057601) | [prev](#37058794) | [next](#37058626) [–]  > Current libbitcoin-explorer instructions telling users to use the seed command to generate private keys. .. and receive bitcoin at them. Wow brutal. | | --- | --- | --- | | | |  |  | [jrockway](user?id=jrockway) [on Aug 9, 2023](item?id=37058626)   | [parent](#37057601) | [prev](#37057713) | [next](#37055978) [–]  I love how many references to Stack Overflow that PR added to the codebase. Always a good sign. | | --- | --- | --- | | | |  |  | [knocte](user?id=knocte) [on Aug 9, 2023](item?id=37058805)   | [root](#37057601) | [parent](#37058626) | [next](#37055978) [–]  LOL! The second S.O. link actually goes to show how broken C++ is: <https://stackoverflow.com/a/18298965/544947> | | --- | --- | --- | | | |  |  | [nullc](user?id=nullc) [on Aug 9, 2023](item?id=37058863)   | [root](#37057601) | [parent](#37058805) | [next](#37055978) [–]  That's really a C related comment and all it doing is subbing in implementation specific pre-standard versions for the benefit of compatibility with compilers prior to the introduction of the feature in the C11 standard. The standard calls it "\_Thread\_local", pre-standard MSVC/icc(win)/borland called it \_\_declspec(thread), and pre-standard GCC/icc(linux)/clang/sun called it \_\_thread. Code would also be free to just use \_Thread\_local and say that a C11 conforming compiler is required. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 8, 2023](item?id=37055978)   | [prev](#37057601) | [next](#37070112) [–]  I wonder whether they modified brainflayer for brute forcing this, or if they wrote something from scratch. | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056016)   | [parent](#37055978) | [next](#37070112) [–]  We used the broken algorithm from `bx` in a custom Rust program to brute force this. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 8, 2023](item?id=37056048)   | [root](#37055978) | [parent](#37056016) | [next](#37070112) [–]  What sort of rate did you get for computing the hashed public keys? | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056397)   | [root](#37055978) | [parent](#37056048) | [next](#37070112) [–]  I was not involved in that specific aspect, so I can't provide accurate information. We may release more information later in the future. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 8, 2023](item?id=37056426)   | [root](#37055978) | [parent](#37056397) | [next](#37070112) [–]  2^32 search space for each set? That seems to imply a little under 2,000 keys per second? | | --- | --- | --- | | | |  |  | [ryanatdistrust](user?id=ryanatdistrust) [on Aug 8, 2023](item?id=37056497)   | [root](#37055978) | [parent](#37056426) | [next](#37070112) [–]  My numbers are very rough estimates and not good enough to do work on. More accurate information may be made public later. | | --- | --- | --- | | | |  |  | [ryan-c](user?id=ryan-c) [on Aug 8, 2023](item?id=37056606)   | [root](#37055978) | [parent](#37056497) | [next](#37070112) [–]  I would be interested to see performance stats - I would expect an optimized attack (batch point inversion, large precomputed table to speed up multiplication, not bothering to try to be constant time) to run well over an order of magnitude faster than that. Not that it's particularly worth bothering if you have an 80 core machine and only 13 billion keys to check. | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 9, 2023](item?id=37057172)   | [root](#37055978) | [parent](#37056606) | [next](#37070112) [–]  And indeed, we did have an 80 core machine. <1 day after some code optimization passes. | | --- | --- | --- | | | |  |  | [efficax](user?id=efficax) [on Aug 10, 2023](item?id=37070112)   | [prev](#37055978) | [next](#37055184) [–]  lol just straight up not using a cryptographically secure source of randomness. that's literally the first thing you do when you want secure cryptography. idiots | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 8, 2023](item?id=37055184)   | [prev](#37070112) [–]  Are any of the following two things true: Multi signature addresses mitigate this attack vector? With the “taproot+schnoor” upgrade last year, it is impossible to tell if funds are stored in a single signature vs multi signature address? | | --- | --- | --- | | | |  |  | [lrvick](user?id=lrvick) [on Aug 8, 2023](item?id=37055223)   | [parent](#37055184) | [next](#37058848) [–]  If all the keys were generated with bad entropy, more of them is only buying you some obfuscation. | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 8, 2023](item?id=37055281)   | [root](#37055184) | [parent](#37055223) | [next](#37058848) [–]  Generate keys with different apps or methods, for more peace of mind That was one of the goals of initial multisignature technology in bitcoin, it was about if one of your devices got compromised you could have 2 factor and not approve the transaction. People werent thinking about if your private key generation was compromised, but it works here too | | --- | --- | --- | | | |  |  | [\_ugfj](user?id=_ugfj) [on Aug 9, 2023](item?id=37058848)   | [parent](#37055184) | [prev](#37055223) [3 more]  [flagged] | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 9, 2023](item?id=37059032)   | [root](#37055184) | [parent](#37058848) [–]  One perspective is that it mimics society more evenly: if you’re one step ahead you also get to steal everyone else’s. Being a perpetual bug bounty is utility. A more collaborative perspective is that the adaptable nature of the protocol adds to the confidence in it. Only new addresses created after an update of one program were affected. And now it is fixed already. Bitcoin use has pointed out flaws in other encryption methods before which quickly got fixed solely because there was a financial motive to fix it suddenly. The primary thing that you missed is that the upgrade last year was not “snakeoil to mitigate this problem”, its just also an additional way to mitigate this potential problem, its just happens to also provide an improvement on 10 year old multisignature technology But an overlapping analogy to your primary observation would be how insecure accepting credits over the internet was in 1995. That problem actually never went away, despite layers and layers of patches and payment processors and security standards, SSL, TLS, PCI Compliance v1 v2.. venture backed competitor payment processors with fraud detection and yet nobody threw their hands up and said “we’re going to stop trying now” | | --- | --- | --- | | | |  |  | [\_ugfj](user?id=_ugfj) [on Aug 9, 2023](item?id=37059626)   | [root](#37055184) | [parent](#37059032) [2 more]  [flagged] | | --- | --- | --- | | | |  |  | [yieldcrv](user?id=yieldcrv) [on Aug 9, 2023](item?id=37060853)   | [root](#37055184) | [parent](#37059626) [–]  That’s not what I wrote, I wrote there were some similarities and listed them, and you presented different differences and discredited those differences as an attempt to discredit me and the entire concept That is called a strawman argument, do better. | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |


