
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPandaXGO%2FPandaX%2Fissues%2F6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FPandaXGO%2FPandaX%2Fissues%2F6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=PandaXGO%2FPandaX)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[PandaXGO](/PandaXGO)
/
**[PandaX](/PandaXGO/PandaX)**
Public

* [Notifications](/login?return_to=%2FPandaXGO%2FPandaX) You must be signed in to change notification settings
* [Fork
  76](/login?return_to=%2FPandaXGO%2FPandaX)
* [Star
   327](/login?return_to=%2FPandaXGO%2FPandaX)

* [Code](/PandaXGO/PandaX)
* [Issues
  1](/PandaXGO/PandaX/issues)
* [Pull requests
  1](/PandaXGO/PandaX/pulls)
* [Actions](/PandaXGO/PandaX/actions)
* [Projects
  0](/PandaXGO/PandaX/projects)
* [Security](/PandaXGO/PandaX/security)
* [Insights](/PandaXGO/PandaX/pulse)

Additional navigation options

* [Code](/PandaXGO/PandaX)
* [Issues](/PandaXGO/PandaX/issues)
* [Pull requests](/PandaXGO/PandaX/pulls)
* [Actions](/PandaXGO/PandaX/actions)
* [Projects](/PandaXGO/PandaX/projects)
* [Security](/PandaXGO/PandaX/security)
* [Insights](/PandaXGO/PandaX/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FPandaXGO%2FPandaX%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FPandaXGO%2FPandaX%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# pandax excel 导出 任意文件覆盖 或 任意文件下载 #6

Closed

[L1nyz-tel](/L1nyz-tel) opened this issue
Mar 10, 2024
· 1 comment

Closed

# [pandax excel 导出 任意文件覆盖 或 任意文件下载](#top) #6

[L1nyz-tel](/L1nyz-tel) opened this issue
Mar 10, 2024
· 1 comment

## Comments

[![@L1nyz-tel](https://avatars.githubusercontent.com/u/92917284?s=80&u=97fd5f5c4a02784bae683e61bed2da7a397e9953&v=4)](/L1nyz-tel)

Copy link

### **[L1nyz-tel](/L1nyz-tel)** commented [Mar 10, 2024](#issue-2177505961)

| pandax excel 导出任意文件覆盖 或 任意文件下载    [PandaX/apps/system/router/user.go](https://github.com/PandaXGO/PandaX/blob/3d265207b631b30b0826c2b6051588a2ae076d7a/apps/system/router/user.go#L153-L161)  Lines 153 to 161 in [3d26520](/PandaXGO/PandaX/commit/3d265207b631b30b0826c2b6051588a2ae076d7a)   |  | ws.Route(ws.GET("/export").To(func(request \*restful.Request, response \*restful.Response) { | | --- | --- | |  | restfulx.NewReqCtx(request, response).WithLog("导出用户信息").Handle(s.ExportUser) | |  | }). | |  | Doc("导出用户信息"). | |  | Param(ws.QueryParameter("filename", "filename").DataType("string")). | |  | Param(ws.QueryParameter("status", "status").DataType("string")). | |  | Param(ws.QueryParameter("username", "username").DataType("string")). | |  | Param(ws.QueryParameter("phone", "phone").DataType("string")). | |  | Metadata(restfulspec.KeyOpenAPITags, tags)) |         [PandaX/apps/system/router/role.go](https://github.com/PandaXGO/PandaX/blob/3d265207b631b30b0826c2b6051588a2ae076d7a/apps/system/router/role.go#L84-L92)  Lines 84 to 92 in [3d26520](/PandaXGO/PandaX/commit/3d265207b631b30b0826c2b6051588a2ae076d7a)   |  | ws.Route(ws.GET("/export").To(func(request \*restful.Request, response \*restful.Response) { | | --- | --- | |  | restfulx.NewReqCtx(request, response).WithLog("导出角色信息").Handle(s.ExportRole) | |  | }). | |  | Doc("导出角色信息"). | |  | Param(ws.QueryParameter("filename", "filename").DataType("string")). | |  | Param(ws.QueryParameter("status", "status").DataType("string")). | |  | Param(ws.QueryParameter("roleName", "roleName").DataType("string")). | |  | Param(ws.QueryParameter("roleKey", "roleKey").DataType("string")). | |  | Metadata(restfulspec.KeyOpenAPITags, tags)) |         [PandaX/apps/system/router/dict.go](https://github.com/PandaXGO/PandaX/blob/3d265207b631b30b0826c2b6051588a2ae076d7a/apps/system/router/dict.go#L65-L73)  Lines 65 to 73 in [3d26520](/PandaXGO/PandaX/commit/3d265207b631b30b0826c2b6051588a2ae076d7a)   |  | ws.Route(ws.GET("/type/export").To(func(request \*restful.Request, response \*restful.Response) { | | --- | --- | |  | restfulx.NewReqCtx(request, response).WithLog("导出字典类型信息").Handle(s.ExportDictType) | |  | }). | |  | Doc("导出字典类型信息"). | |  | Param(ws.QueryParameter("filename", "filename").DataType("string")). | |  | Param(ws.QueryParameter("status", "status").DataType("string")). | |  | Param(ws.QueryParameter("dictName", "dictName").DataType("string")). | |  | Param(ws.QueryParameter("dictType", "dictType").DataType("string")). | |  | Metadata(restfulspec.KeyOpenAPITags, tags)) |      这三处路由，之后都会调用 `utils.InterfaceToExcel(*list, fileName)` 然后 `rc.Download(fileName)`  选其中一个来看  代码中没有对传入的 `filename` 做检查，使用 `../` 跨目录指定导出的 excel 文件名及目录位置，可以用来覆盖掉不应该覆盖的文件     [PandaX/apps/system/api/user.go](https://github.com/PandaXGO/PandaX/blob/3d265207b631b30b0826c2b6051588a2ae076d7a/apps/system/api/user.go#L326-L342)  Lines 326 to 342 in [3d26520](/PandaXGO/PandaX/commit/3d265207b631b30b0826c2b6051588a2ae076d7a)   |  | // ExportUser 导出用户 | | --- | --- | |  | func (u \*UserApi) ExportUser(rc \*restfulx.ReqCtx) { | |  | filename := restfulx.QueryParam(rc, "filename") | |  | status := restfulx.QueryParam(rc, "status") | |  | username := restfulx.QueryParam(rc, "username") | |  | phone := restfulx.QueryParam(rc, "phone") | |  |  | |  | var user entity.SysUser | |  | user.Status = status | |  | user.Username = username | |  | user.Phone = phone | |  |  | |  | list := u.UserApp.FindList(user) | |  | fileName := utils.GetFileName(global.Conf.Server.ExcelDir, filename) | |  | utils.InterfaceToExcel(\*list, fileName) | |  | rc.Download(fileName) | |  | } |      而且，如果该目标文件没有写权限的话，之后 `rc.Download(fileName)` 又会将这个文件下载下来，就变成了文件读取了  但是调用的是 `http.ServeFile`，只能用来读取项目目录下的文件，无法读取 `/etc/passwd` 等系统文件     [PandaX/kit/restfulx/restfulx.go](https://github.com/PandaXGO/PandaX/blob/3d265207b631b30b0826c2b6051588a2ae076d7a/kit/restfulx/restfulx.go#L84-L92)  Lines 84 to 92 in [3d26520](/PandaXGO/PandaX/commit/3d265207b631b30b0826c2b6051588a2ae076d7a)   |  | // 文件下载 | | --- | --- | |  | func Download(rc \*ReqCtx, filename string) { | |  | rc.Response.Header().Add("success", "true") | |  | rc.Response.Header().Set("Content-Length", "-1") | |  | rc.Response.Header().Set("Content-Disposition", "attachment; filename="+filename) | |  | http.ServeFile( | |  | rc.Response.ResponseWriter, | |  | rc.Request.Request, filename) | |  | } |      比如这样子去覆盖掉 template 文件 |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@PandaX-Go](https://avatars.githubusercontent.com/u/143163358?s=80&u=4768f718161773a31a99079362da7cfcc6026aca&v=4)](/PandaX-Go)

Copy link

Contributor

### **[PandaX-Go](/PandaX-Go)** commented [Mar 11, 2024](#issuecomment-1987545156)

| 【fix】对设置的的文件名进行验证 |
| --- |

All reactions

Sorry, something went wrong.

[![@PandaX-Go](https://avatars.githubusercontent.com/u/143163358?s=40&u=4768f718161773a31a99079362da7cfcc6026aca&v=4)](/PandaX-Go)
[PandaX-Go](/PandaX-Go)
closed this as [completed](/PandaXGO/PandaX/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Dec 4, 2024](#event-15522291929)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FPandaXGO%2FPandaX%2Fissues%2F6)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@L1nyz-tel](https://avatars.githubusercontent.com/u/92917284?s=52&v=4)](/L1nyz-tel) [![@PandaX-Go](https://avatars.githubusercontent.com/u/143163358?s=52&v=4)](/PandaX-Go)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

