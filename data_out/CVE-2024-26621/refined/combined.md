=== Content from zolutal.github.io_bf926488_20250111_150733.html ===


* [Skip to primary navigation](#site-nav)
* [Skip to content](#main)
* [Skip to footer](#footer)

[zolutal's blog](/)

* [about](/about)

Toggle menu

1. [Home](https://zolutal.github.io/)
/3. ASLRn't: How memory alignment broke library ASLR

### Justin Miller

systems hacking

Follow

* Arizona
* [Twitter](https://twitter.com/zolutal)
* [GitHub](https://github.com/zolutal)

# ASLRn’t: How memory alignment broke library ASLR

January 8, 2024

8 minute read

As it turns out, on recent Ubuntu, Arch, Fedora, and likely other distro’s releases, with kernel versions >=5.18, library ASLR is *literally* broken for 32-bit libraries of at least 2MB in size, on certain filesystems. Also, ASLR’s entropy on 64-bit libraries that are at least 2MB is significantly reduced, 28 bits -> 19 bits, on certain filesystems.

Then what are these “certain filesystems”? Those would be: ext4, ext2, btrfs, xfs, and fuse. So, some of the most widely used filesystems.

I’ve only actually verified ext4 and btrfs, though, according to the kernel source code the other filesystems [*should* be affected](https://elixir.bootlin.com/linux/v6.7/C/ident/thp_get_unmapped_area), but please let me know if I am wrong on any of these being affected. I’ve reproduced the 64-bit regression on Ubuntu w/ ext4, Arch w/ ext4, and Fedora w/ btrfs. I’ve also reproduced the 32-bit regression on those Ubuntu, Arch, and Fedora systems.

## being responsible

I contacted Ubuntu security about this (I initially assumed only they were affected) and they informed me that this regression is being tracked by them publicly here:

[https://bugs.launchpad.net/ubuntu-kernel-tests/+bug/1983357](https://bugs.launchpad.net/ubuntu-kernel-tests/%2Bbug/1983357)

Though I independently discovered that 64-bit library ASLR had regressed, the bug has been publicly tracked by Ubuntu for quite some time before I found it. The impact of this regression on 32-bit library ASLR was not found by me at all, I learned about it from the bug report above. Props to Ubuntu for having a regression test for this kind of thing!

But, despite this issue being public for over a year on Ubuntu’s bug tracker, it seems like it has gone mostly unnoticed? I have only found it referenced on that Ubuntu bug tracker and [here](https://groups.google.com/g/linux.debian.bugs.dist/c/t6RJSUQ6gp4) on the debian bugs newsgroup.

# The 64-bit regression

For the regression to occur, the prerequisites must be met: an affected filesystem, a recent-ish kernel (past ~year or so), and a library that is >=2MB (this size may need to be larger depending on how the loader is implemented)

In my case all of these were met by default on my Ubuntu 22.04 system which has an ext4 filesystem, a 6.2.0 kernel, and a 2.2MB libc.

With those requirements met, testing for the regression is pretty simple:

```
┌──(jmill@ubun)-[~]
└─$ cat /proc/self/maps | grep libc | head -n 1
7ff67dc00000-7ff67dc28000 r--p 00000000 103:02 13111263                  /usr/lib/x86_64-linux-gnu/libc.so.6

┌──(jmill@ubun)-[~]
└─$ cat /proc/self/maps | grep libc | head -n 1
7f0c33600000-7f0c33628000 r--p 00000000 103:02 13111263                  /usr/lib/x86_64-linux-gnu/libc.so.6

┌──(jmill@ubun)-[~]
└─$ cat /proc/self/maps | grep libc | head -n 1
7fc6ef800000-7fc6ef828000 r--p 00000000 103:02 13111263                  /usr/lib/x86_64-linux-gnu/libc.so.6

```

Boom! ASLR is messed up, see!?!?

Okay, but more seriously, lets break down what is going on there.

Here we have an address range representing the location of libc in the `cat` process’s address space:

```
7ff67dc00000-7ff67dc28000 r--p 00000000 103:02 13111263                  /usr/lib/x86_64-linux-gnu/libc.so.6

```

The first value on that line `7fcc68000000` is the ‘base address’ of libc for that run of `cat`. The base address is randomly chosen by the kernel when the library is mapped in, and everything in libc is a constant offset from that (code, globals, etc…). So for library ASLR to be regressed that would mean that that base address is less random than it should be.

I’ve claimed the regression affects ASLR of libraries >=2MB in size, so let’s compare this allegedly malfunctioning libc ASLR to the ASLR of some smaller library memory mapping.

Here is a little python snippet to run `cat /proc/self/maps` 1000 times and do a bitwise OR on the libc base addresses we receive. With this, if a bit in the base address is set in any of those 1000 runs we would see it in the result.

```
In [1]: from subprocess import check_output
   ...: result = 0x0
   ...: for _ in range(0,1000):
   ...:     out = check_output("cat /proc/self/maps | grep libc | head -n1", shell=True).decode()
   ...:     base_address = int(out.split('-')[0], 16)
   ...:     result |= base_address
   ...: hex(result)
Out[1]: '0x7fffffe00000'

```

Alright, so for 1000 OR’d libc base addresses `0x7fffffe00000` is the combined value we get, meaning the last five nibbles + 1 bit (21 bits) were zero on all of those 1000 runs. So those low 21 bits must not be part of the randomization on the mapping, since they aren’t changing.

Let’s run it again but instead of grepping for the base address of libc, let’s do it for `ld` which is signifcantly smaller than 2MB (236KB)

```
In [2]: from subprocess import check_output
   ...: result = 0x0
   ...: for _ in range(0,1000):
   ...:     out = check_output("cat /proc/self/maps | grep ld | head -n1", shell=True).decode()
   ...:     base_address = int(out.split('-')[0], 16)
   ...:     result |= base_address
   ...: hex(result)
Out[2]: '0x7ffffffff000'

```

Okay, so that is clearly different… libc’s base address had 21 bits of trailing zeros but ld’s base address has 12 bits of trailing zeros.

What we are observing here is that ld’s base address has 9 more bits of randomization than libc’s base address and this wasn’t the case in the past (both because libc was <2MB and because the change that causes this wasn’t implemented yet)

So libc lost 9 bits of its randomization, to… something? for being >=2MB?

# The 32-bit breakage

So I claimed 32-bit is straight up broken, let’s see it.

To observe the breakage you’ll of course need a 32-bit binary, I compiled this `cat` clone (credit: ChatGPT lol) as a 32-bit binary:

```
// gcc -m32 cat32.c -o cat32
#include <unistd.h>
#include <stdlib.h>
#include <stdio.h>

int main(int argc, char *argv[]) {
    FILE *file;
    int c;

    if (argc < 2) {
        fprintf(stderr, "Usage: %s <filename>\n", argv[0]);
        return EXIT_FAILURE;
    }

    file = fopen(argv[1], "r");
    if (file == NULL) {
        perror("Error opening file");
        return EXIT_FAILURE;
    }

    while ((c = fgetc(file)) != EOF) {
        putchar(c);
    }

    fclose(file);

    return EXIT_SUCCESS;
}

```

Okay so let’s do the same thing as we did for testing the 64-bit regression, just cat out `/proc/self/maps` but with our 32-bit cat:

```
┌──(jmill@ubun)-[~/snippets]
└─$ ./cat32 /proc/self/maps | grep libc | head -n1
f7c00000-f7c20000 r--p 00000000 103:02 13111313                          /usr/lib32/libc.so.6

┌──(jmill@ubun)-[~/snippets]
└─$ ./cat32 /proc/self/maps | grep libc | head -n1
f7c00000-f7c20000 r--p 00000000 103:02 13111313                          /usr/lib32/libc.so.6

┌──(jmill@ubun)-[~/snippets]
└─$ ./cat32 /proc/self/maps | grep libc | head -n1
f7c00000-f7c20000 r--p 00000000 103:02 13111313                          /usr/lib32/libc.so.6

```

And…. yeah….

It’s just completely broken, the base address of libc for this program is just always `f7c00000` on my machine.

Why is not being randomized at all on 32-bit? well let’s check how much randomization is applied to 32-bit mappings:

```
┌──(jmill@ubun)-[~]
└─$ sudo sysctl vm.mmap_rnd_compat_bits
vm.mmap_rnd_compat_bits = 8

```

We were losing 9 bits on 64-bit, but with only 8 bits of randomization on 32-bit losing that many bits means we just completely lose all randomization.

# Huge Page, Huge Problem

So wtf is going on, 9 bits of ASLR are missing on 64-bit libc and 32-bit libc is not being randomized at all???

When I found the 64-bit regression it was 3am and I was hacking at some awful CTF challenge idea (as one does) that involved a partial address overwrite, I was extremely confused as to why more than the last 12 bits were constant and decided I’d look into it in the morning. I went into the lab the next day and spent a while looking at but was still pretty lost as to what was going on. I asked kylebot since he was around if he had any ideas as to what was going on, eventually we came to the conclusion that because it was related to the mappings being >=2MB it must be something to do with Huge Pages.

If you aren’t aware of what Huge Pages are, you should read my blog post on paging :p

In short, on x86\_64 there are two variants of ‘Huge Pages’, one of the two is the 2MB Huge Page. Similar to how a normal 4KB Page must be 12 bit aligned, a 2MB Huge Page must be 21 bit aligned. That 9-bit difference in alignment from 12 to 21 is where this regression comes from.

A number of filesystems switched to using thp\_get\_unmapped\_area [a long time ago](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit?id=dbe6ec815641aa22b50775aaeb47fa3a8d04ccf1), and more recently (5.18) thp\_get\_unmapped\_area was changed [to make all mappings >=2MB have 2MB alignment](https://git.kernel.org/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=1854bc6e2420472676c5c90d3d6b15f6cd640e40) instead of just DAX mappings:

```
diff --git a/mm/huge_memory.c b/mm/huge_memory.c
index 38e233a7d9776..f85b04b31bd12 100644
--- a/mm/huge_memory.c
+++ b/mm/huge_memory.c
@@ -582,13 +582,10 @@ unsigned long thp_get_unmapped_area(struct file *filp, unsigned long addr,
 	unsigned long ret;
 	loff_t off = (loff_t)pgoff << PAGE_SHIFT;
-	if (!IS_DAX(filp->f_mapping->host) || !IS_ENABLED(CONFIG_FS_DAX_PMD))
-		goto out;
-
 	ret = __thp_get_unmapped_area(filp, addr, len, off, flags, PMD_SIZE);
 	if (ret)
 		return ret;
-out:
+
 	return current->mm->get_unmapped_area(filp, addr, len, pgoff, flags);
 }
 EXPORT_SYMBOL_GPL(thp_get_unmapped_area);

```

So, to summarize, major filesystems call thp\_get\_unmapped\_area, this patch makes it so regular file backed mappings that go through `thp_get_unmapped_area` can be backed by Huge Pages, and some libc’s have (somewhat recently) surpassed 2MB. This all converged such that on some distros libc is being fix-mapped for 32-bit applications and 9-bits of libc’s ASLR for 64-bit applications has been lost (again impact will vary across distros).

I’ve been stressing libc just because it’s used by so many applications and has all the ROP gadgets anyone needs anyways, but just to be clear it’s not just libc, any library >=2MB is potentially affected, and even anonymous mappings >=2MB are being 2MB aligned on my Ubuntu 22.04 system, though I’m still not sure what that’s about…

# Wrapping up

The impact of this on 32-bit applications is fairly obvious, ASLR is just broken, exploits can be deterministicly hijack pointers using large library addresses. For 64-bit applications, 19-bits of randomization is still a good amount but it does mean that partial address overwites on pointers to >=2MB libraries are stronger, e.g. the last 2-bytes of a library pointer can be overwritten deterministically (previously only 1-byte overwrites were deterministic).

I noticed the Ubuntu issue was updated recently to say they are [increasing the base mmap\_rnd\_bits](https://git.launchpad.net/~ubuntu-kernel/ubuntu/%2Bsource/linux/%2Bgit/noble/commit/?h=master-next&id=760c2b1fa1f5e95be1117bc7b80afb8441d4b002) to account for the lost randomization, which seems reasonable, 32-bit will get most of its randomization back. It won’t address partial overwites becoming more deterministic though, and it’s only been commited to the 24.04 tree so far from what I can tell.

Hopefully, more distros will look into mitigating this.

Thanks for reading!

 **Tags:**
[ASLR](/tags/#aslr),
[Linux](/tags/#linux),
[x86\_64](/tags/#x86-64)

 **Updated:** January 8, 2024

[Previous](/understanding-paging/ "Understanding x86_64 Paging
")
[Next](/corctf-trojan-turtles/ "corCTF 2024: trojan-turtles writeup
")

#### You may also enjoy

## [corCTF 2024: trojan-turtles writeup](/corctf-trojan-turtles/)

July 28, 2024

9 minute read

This year I played corCTF with Shellphish, and we did pretty well – placing 6th!
I worked on two challenges: ‘trojan-turtles’ and ‘its-just-a-dos-bug-bro’, i...

## [Understanding x86\_64 Paging](/understanding-paging/)

December 27, 2023

22 minute read

I’ve spent quite a lot of time messing with x86\_64 page tables, understanding address translation is not easy and when I started learning about it I felt lik...

## [corCTF 2023: sysruption writeup](/corctf-sysruption/)

July 30, 2023

25 minute read

I played corCTF this weekend and managed to solve two pretty tough challenges. This will be a writeup for the first of those two, sysruption, which I managed...

## [Understanding Memory Deduplication Attacks](/dedup-attacks/)

June 17, 2023

13 minute read

I recently came across a bunch of research describing attacks on memory deduplication, it has been used to fingerprint systems[1], crack (K)ASLR[2,3,4], leak...

* **Follow:**
* [Twitter](https://twitter.com/zolutal)
* [GitHub](https://github.com/zolutal)

© 2024 Justin Miller. Powered by [Jekyll](https://jekyllrb.com) & [Minimal Mistakes](https://mademistakes.com/work/minimal-mistakes-jekyll-theme/).



=== Content from www.openwall.com_641a2e82_20250111_150729.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2024/07/13/7) [[next>]](2) [[<thread-prev]](../../../2024/07/13/7) [[thread-next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <ZpRSEWkkG6hmNhNo@itl-email>
Date: Sun, 14 Jul 2024 18:32:33 -0400
From: Demi Marie Obenour <demi@...isiblethingslab.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On Sat, Jul 13, 2024 at 10:58:58PM +0200, Steffen Nurpmeso wrote:
> Jacob Bachmeyer wrote in
>  <6691E39C.8090600@...il.com>:
>  |Steffen Nurpmeso wrote:
>  |> [...]
>  |>
>  |> So if someone says "this  was a source of
>  |> denial‐of‐service attacks" then i need to wrap my head, and it is
>  |> not as if an in-between-the-lines reference to MAP_DENYWRITE ring
>  |> any bells except that i think the flag has been removed.
>  |
>  |The manpage indicates that, long ago, a mapping with MAP_DENYWRITE would
>  |effectively make the underlying file read-only, even to root, for as
>  |long as the mapping exists.
>
> Thank you.  I add a search result from Google Groups which still
> exists for doing so collected just now:
>
>   Linus Torvalds Oct 4, 2001, 7:38:12 AM
>
>   Rob Landley <lan...@...mmello.org> wrote:
>   >I.E. it seems like they go out of their way to ALLOW writing to the libaries.
>   > (I assume they KNOW the difference between MAP_DENYWRITE, MAP_COPY, and
>   >MAP_PRIVATE...?)
>
>   Note that the kernel will refuse to honour MAP_DENYWRITE from user
>   space, so I'm afraid that changing ld.so won't do a thing.
>
>   The reason the kernel refuses to honour it, is that MAP_DENYWRITE is an
>   excellent DoS-vehicle - you just mmap("/etc/passwd") with MAP_DENYWRITE,
>   and even root cannot write to it.. Vary nasty.
>
>   Which is why the kernel only allows it when the binary loader itself
>   sets the flag, because security-conscious application writers are
>   already aware of the "oh, a running binary may not be writable" issues.
>
>   So sorry..
>
>   Linus
>
>   Linus Torvalds Oct 4, 2001, 7:49:27 AM
>
>   On Thu, 4 Oct 2001, Alexander Viro wrote:
>   > <nit>
>   > I _really_ doubt that something does write() on /etc/passwd. Create a
>   > file and rename it over the thing - sure, but that's it.
>   > </nit>
>
>   Well, yeah, bad choice. Can you believe /var/run/utmp or similar?
>
>   And yes, we could add checks for the thing being executable before we
>   accept MAP_DENYWRITE instead of just ignoring the flag from user space.
>   Nobody has cared enough to make the effort.
>
>   Until now?
>
>   Linus
>
> Some findings:
>   . I note that the mentioned files are writable by only root (and
>   i would assume MAP_DENYWRITE to only work if i could do so
>   myself).
>   . Capabilities have become more fine-grained.
>   . I always whimper when i have to rm(1) a running executable before
>   placing an updated variant on Linux, on BSDs i simply over-cp(1)
>   (and i do not understand as long as one gets either the one or
>   the other when executing the path).
>   . Shouldn't mandatory file locking have the same effect.
> But it is ok to me, Linux is as it is, and they progress and
> iterate over the code at an unbelievable speed.  And some things
> are just the way they are.  (Or change.  Back.  And forth.  And
> back etc etc)

Executable files and shared libraries should _never_ be modified
in-place.  They should _always_ be renamed over.  Otherwise, a program
might be a mixture of the old and new version, with completely undefined
results when the program is run.

>  |>   And then
>  |> someone who seems to know uses it nonetheless in a small showcase
>  |> program, likely trying to say even more in-between-the-lines.
>  |
>  |That commit message seems to indicate that the program was using
>  |SHM_HUGETLB when it should have been using MAP_HUGETLB, those constants
>  |represent different bits, and passing SHM_HUGETLB to mmap(2) will be
>  |interpreted as MAP_DENYWRITE, and therefore ignored.  Presumably, there
>  |is some other syscall (likely shmat(2)) that uses that bit (represented
>  |under the constant SHM_HUGETLB) to request huge pages, and the test
>  |program in question was supposed to get huge pages from mmap(2) but was
>  |not actually asking for huge pages because it was using the wrong constant.
>  |
>  |In other words, MAP_DENYWRITE was not being intentionally used at all.
>  |Another constant, for a different set of flags, that happens to have the
>  |same value, was being used, causing a quiet bug.  (The test program
>  |would have still worked, but was not actually exercising huge pages as
>  |intended.)
>
> The Linux commit messages are tremendous books that often leave me
> stunning.  I *never* get together such things in my own work
> process.  So thanks for spending additional time reiterating this.
>
>  |-- Jacob
>
> Thank you very much.
>
>  --End of <6691E39C.8090600@...il.com>
>
> --steffen
> |
> |Der Kragenbaer,                The moon bear,
> |der holt sich munter           he cheerfully and one by one
> |einen nach dem anderen runter  wa.ks himself off
> |(By Robert Gernhardt)

--
Sincerely,
Demi Marie Obenour (she/her/hers)
Invisible Things Lab

Download attachment "[signature.asc](1/1)" of type "application/pgp-signature" (834 bytes)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_68f4c1e5_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](../../../2024/07/08/8) [[next>]](2) [[<thread-prev]](../../../2024/07/08/8) [[thread-next>]](../../../2024/07/10/5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <87jzhv2jth.fsf@oldenburg.str.redhat.com>
Date: Tue, 09 Jul 2024 07:52:42 +0200
From: Florian Weimer <fweimer@...hat.com>
To: "David A. Wheeler" <dwheeler@...eeler.com>
Cc: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

* David A. Wheeler:
>> The kernel should not apply hugepage optimizations to mappings created
>> with MAP_DENYWRITE.
>
> Shouldn't that be MAP_EXECUTABLE, not MAP_DENYWRITE?
> If you use MAP_DENYWRITE,
> a program that mmaps in a large non-code dataset won't have hugepage
> optimizations applied, which might be a significant performance regression.

It's just a bit that happens to be set by the glibc dynamic linker and
not much else.  The name doesn't matter at this point.

> Also, the mmap man page:
> <https://man7.org/linux/man-pages/man2/mmap.2.html> says that
> MAP_EXECUTABLE and MAP_DENYWRITE are ignored.  There's a risk that
> some programs are taking that to heart & not using those flags even
> when they should. If one of those flags *will* have an effect now,
> then it'd be a good idea to document that :-).

The effect of the flag is to get back the old behavior. 8-)  It only
makes backwards compatibility better.

Thanks,
Florian

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.kernel.org_60076b09_20250111_150731.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yang Shi <yang@os.amperecomputing.com> | 2024-01-18 10:05:05 -0800 |
| --- | --- | --- |
| committer | Andrew Morton <akpm@linux-foundation.org> | 2024-01-25 23:52:21 -0800 |
| commit | [4ef9ad19e17676b9ef071309bc62020e2373705d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4ef9ad19e17676b9ef071309bc62020e2373705d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)) | |
| tree | [c5fde4b74225e57287ea66ed25dbc88b6cc33b68](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4ef9ad19e17676b9ef071309bc62020e2373705d) | |
| parent | [67695f18d55924b2013534ef3bdc363bc9e14605](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=67695f18d55924b2013534ef3bdc363bc9e14605) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ef9ad19e17676b9ef071309bc62020e2373705d&id2=67695f18d55924b2013534ef3bdc363bc9e14605)) | |
| download | [linux-4ef9ad19e17676b9ef071309bc62020e2373705d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4ef9ad19e17676b9ef071309bc62020e2373705d.tar.gz) | |

mm: huge\_memory: don't force huge page alignment on 32 bitcommit efa7df3e3bb5 ("mm: align larger anonymous mappings on THP
boundaries") caused two issues [1] [2] reported on 32 bit system or compat
userspace.
It doesn't make too much sense to force huge page alignment on 32 bit
system due to the constrained virtual address space.
[1] https://lore.kernel.org/linux-mm/d0a136a0-4a31-46bc-adf4-2db109a61672@kernel.org/
[2] https://lore.kernel.org/linux-mm/CAJuCfpHXLdQy1a2B6xN2d7quTYwg2OoZseYPZTRpU0eHHKD-sQ@mail.gmail.com/
Link: [https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301@gmail.com](https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301%40gmail.com)
Fixes: efa7df3e3bb5 ("mm: align larger anonymous mappings on THP boundaries")
Signed-off-by: Yang Shi <yang@os.amperecomputing.com>
Reported-by: Jiri Slaby <jirislaby@kernel.org>
Reported-by: Suren Baghdasaryan <surenb@google.com>
Tested-by: Jiri Slaby <jirislaby@kernel.org>
Tested-by: Suren Baghdasaryan <surenb@google.com>
Reviewed-by: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Rik van Riel <riel@surriel.com>
Cc: Christopher Lameter <cl@linux.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4ef9ad19e17676b9ef071309bc62020e2373705d)

| -rw-r--r-- | [mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/huge_memory.c?id=4ef9ad19e17676b9ef071309bc62020e2373705d) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/mm/huge\_memory.c b/mm/huge\_memory.cindex 5f31e51f223560..172b85208276ea 100644--- a/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=67695f18d55924b2013534ef3bdc363bc9e14605)+++ b/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=4ef9ad19e17676b9ef071309bc62020e2373705d)@@ -37,6 +37,7 @@ #include <linux/page\_owner.h> #include <linux/sched/sysctl.h> #include <linux/memory-tiers.h>+#include <linux/compat.h>  #include <asm/tlb.h> #include <asm/pgalloc.h>@@ -811,6 +812,9 @@ static unsigned long \_\_thp\_get\_unmapped\_area(struct file \*filp, loff\_t off\_align = round\_up(off, size); unsigned long len\_pad, ret; + if (IS\_ENABLED(CONFIG\_32BIT) || in\_compat\_syscall())+ return 0;+ if (off\_end <= off\_align || (off\_end - off\_align) < size) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:06:08 +0000



=== Content from www.openwall.com_e00cf481_20250111_150730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](../../../2024/07/31/1) [[<thread-prev]](../../../2024/07/29/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <8f5ee6e1-d6cb-4279-883e-4b8959ea3c71@analygence.com>
Date: Tue, 30 Jul 2024 11:40:04 -0400
From: Will Dormann <will.dormann@...lygence.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On 7/29/24 3:02 AM, Yves-Alexis Perez wrote:>
d9592025000b3cf26c742f3505da7b83aedc26d5 was recently merged to Linus tree
> switching to !IS_ENABLED(CONFIG_64BIT) which should work on all architectures.
> So ASLRn't *should* be fixed on IA-32 kernels with 6.11.

I can confirm that in 6.11, ASLR is functioning as expected with 6.11

test@...ian:~$ python3 entropy.py
Linux debian 6.11.0-rc1 #1 SMP PREEMPT_DYNAMIC Mon Jul 29 17:01:55 EDT
2024 i686 GNU/Linux

Mapped item: /usr/bin/cat, Entropy: 8 bits, Mask: 000ff000
Mapped item: [heap], Entropy: 14 bits, Mask: 03fff000
Mapped item: /usr/lib/locale/locale-archive, Entropy: 9 bits, Mask: 001ff000
Mapped item: /usr/lib/i386-linux-gnu/libc.so.6, Entropy: 9 bits, Mask:
001ff000
Mapped item: [vvar], Entropy: 9 bits, Mask: 001ff000
Mapped item: /usr/lib/i386-linux-gnu/ld-linux.so.2, Entropy: 9 bits,
Mask: 001ff000
Mapped item: [stack], Entropy: 12 bits, Mask: 00fff000
test@...ian:~$

--
Will Dormann | Senior Vulnerability Analyst

ANALYGENCE, Inc.
8115 Maple Lawn Blvd., Suite 110, Fulton, MD 20759
t 412.818.3452 | f 301.812.4252
e will.dormann@...lygence.com | w analygence.com

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_81e77396_20250111_150726.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](5) [[<thread-prev]](3) [[thread-next>]](5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <87y16bdc9p.fsf@oldenburg.str.redhat.com>
Date: Mon, 08 Jul 2024 19:28:02 +0200
From: Florian Weimer <fweimer@...hat.com>
To: Will Dormann <will.dormann@...lygence.com>
Cc: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

* Will Dormann:

>  - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
>    the same address every time. (i.e. no practical ASLR -- "ASLRn't")

Please note that current glibc is not large enough to benefit from 2 MiB
hugepages because all load segments are smaller than 2 MiB, so it's just
not possible to use hugepages for libc.so.6.  This is with the default
-z separate-code in current binutils.  Even with -z noseparate-code, the
large readable-executable load segment is still a bit less than 2 MiB.
Unfortunately the kernel does not know this when we reserve the address
space for the entirety of libc.so.6.

The kernel should not apply hugepage optimizations to mappings created
with MAP_DENYWRITE.

Thanks,
Florian

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_1d75499b_20250111_150730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](1) [[thread-next>]](../../../2024/07/16/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <66946BDB.4070709@gmail.com>
Date: Sun, 14 Jul 2024 19:22:51 -0500
From: Jacob Bachmeyer <jcb62281@...il.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

Steffen Nurpmeso wrote:
> [...]
>
> Some findings:
>   . I note that the mentioned files are writable by only root (and
>   i would assume MAP_DENYWRITE to only work if i could do so
>   myself).
>

I believe that most executables are writable only by root, but available
to unprivileged users.  Since the purpose of MAP_DENYWRITE seems to have
been ensuring that executables cannot change out from underneath running
programs, it would need to work when unprivileged users map the file;
thus the DoS problem.

>   . Capabilities have become more fine-grained.
>   . I always whimper when i have to rm(1) a running executable before
>   placing an updated variant on Linux, on BSDs i simply over-cp(1)
>   (and i do not understand as long as one gets either the one or
>   the other when executing the path).
>
Simple solution:
    - write the new executable under a temporary name
    - use link(2) to create a new name for the existing executable
    - use rename(2) to atomically replace the existing executable
    - use unlink(2) to remove the old version after any needed checks

You can dispense with link(2) and unlink(2) if you do not want to
preserve a backup of the old executable.  Using this method will change
the executable's inode number (meaning that it really is a different
file) and that means that the old version can remain on disk for as long
as it remains in use, even after its last name has been removed.

-- Jacob

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_cab7058b_20250111_150729.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2024/07/12/3) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <6691E39C.8090600@gmail.com>
Date: Fri, 12 Jul 2024 21:17:00 -0500
From: Jacob Bachmeyer <jcb62281@...il.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

Steffen Nurpmeso wrote:
> [...]
>
> So if someone says "this  was a source of
> denial‐of‐service attacks" then i need to wrap my head, and it is
> not as if an in-between-the-lines reference to MAP_DENYWRITE ring
> any bells except that i think the flag has been removed.

The manpage indicates that, long ago, a mapping with MAP_DENYWRITE would
effectively make the underlying file read-only, even to root, for as
long as the mapping exists.

>   And then
> someone who seems to know uses it nonetheless in a small showcase
> program, likely trying to say even more in-between-the-lines.

That commit message seems to indicate that the program was using
SHM_HUGETLB when it should have been using MAP_HUGETLB, those constants
represent different bits, and passing SHM_HUGETLB to mmap(2) will be
interpreted as MAP_DENYWRITE, and therefore ignored.  Presumably, there
is some other syscall (likely shmat(2)) that uses that bit (represented
under the constant SHM_HUGETLB) to request huge pages, and the test
program in question was supposed to get huge pages from mmap(2) but was
not actually asking for huge pages because it was using the wrong constant.

In other words, MAP_DENYWRITE was not being intentionally used at all.
Another constant, for a different set of flags, that happens to have the
same value, was being used, causing a quiet bug.  (The test program
would have still worked, but was not actually exercising huge pages as
intended.)

-- Jacob

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_14379c91_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](../../../2024/07/09/1) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <6771f9536d49185fc8f1ea9905c13cf4dd8776d2.camel@debian.org>
Date: Wed, 10 Jul 2024 22:54:19 +0200
From: Yves-Alexis Perez <corsac@...ian.org>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

On Mon, 2024-07-08 at 12:37 -0400, Will Dormann wrote:
>  As reported in the Debian bug, running the program repeatedly with a
> 2MB file will report the same address every time on a vulnerable system,
> and will be randomized on a system that is behaving as expected.
>
> In testing some platforms that I had readily available, I've concluded:
>   - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
> the same address every time. (i.e. no practical ASLR -- "ASLRn't")
>   -  Modern (e.g. 6.x kernel and large-enough libc) x86_64 platforms
> running 32-bit code will load a large-enough library at the same address
> every time.
>   - Modern x86_64 systems with the CVE-2024-26621 patch will randomize
> the load address of large libraries loaded by 32-bit apps.
>   - Modern x86 systems with the CVE-2024-26621 patch will NOT ranzomize
> the load address of large libraries.  (i.e. is still vulnerable to
> "ASLRn't" despite the patch)

Hey,

I'm testing on my Debian sid laptop with Linux kernel 6.9.7-1. This is amd64
but running test-mmap built with -m32, and I get:

for i in {0..10}; do ./test-mmap < zeros; done
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df3000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d98000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d6f000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7de7000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df6000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7cfd000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d25000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d48000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7dad000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d7b000
mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df4000

So it *looks* to me like it's “properly” randomized (for a 32b process). I
don't have a 32b install handy so I can't test but I'd assume the -m32 to
exhibit the same behavior? This is with vm.mmap_rnd_compat_bits=8.

Or am I doing something wrong?
- --
Yves-Alexis
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCAAdFiEE8vi34Qgfo83x35gF3rYcyPpXRFsFAmaO9PsACgkQ3rYcyPpX
RFtwbAf/esGTSILYL1Seffq43QtauizeyRAth/3U2o39SbC/KD5Bpx2wwT3+3WX5
ag96yhhBWpf6ef3JgSlblYqCZeFLRFyVYbpLQm4GpfVHDOzvJI1qaF6wPlxyXetn
CFy/mQq/CWVNNQ9BH4FvU0SRwaKa7ijszvkDk/RsqS/8e5nR5ufGDyH0LlZU8HJ4
LTLQLLHUA1Xt9xXhBuuNm7iMh0HmesQKOQcPQM0/e6ea7I3enLJNm14gv3eYWUIO
RnG+TqwpbGW1E4NlcxZ7qo7sXabmn6tKTg5gQh5X9ADDgW0rvpeKEtYda1rO8M79
/od7a49ITS3XR7tjNswxNBdqelt8Tg==
=8zdL
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.kernel.org_b9fa3bd1_20250111_150732.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7432376c913381c5f24d373a87ff629bbde94b47)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7432376c913381c5f24d373a87ff629bbde94b47)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7432376c913381c5f24d373a87ff629bbde94b47)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7432376c913381c5f24d373a87ff629bbde94b47)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yang Shi <yang@os.amperecomputing.com> | 2024-01-18 10:05:05 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:51:21 +0100 |
| commit | [7432376c913381c5f24d373a87ff629bbde94b47](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7432376c913381c5f24d373a87ff629bbde94b47) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7432376c913381c5f24d373a87ff629bbde94b47)) | |
| tree | [48b90ee5012694daf76d84de1d060d39b0be51de](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7432376c913381c5f24d373a87ff629bbde94b47) | |
| parent | [11fc2cae166edd92a7bfa77f559c49150ec05f46](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11fc2cae166edd92a7bfa77f559c49150ec05f46) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7432376c913381c5f24d373a87ff629bbde94b47&id2=11fc2cae166edd92a7bfa77f559c49150ec05f46)) | |
| download | [linux-7432376c913381c5f24d373a87ff629bbde94b47.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7432376c913381c5f24d373a87ff629bbde94b47.tar.gz) | |

mm: huge\_memory: don't force huge page alignment on 32 bitcommit 4ef9ad19e17676b9ef071309bc62020e2373705d upstream.
commit efa7df3e3bb5 ("mm: align larger anonymous mappings on THP
boundaries") caused two issues [1] [2] reported on 32 bit system or compat
userspace.
It doesn't make too much sense to force huge page alignment on 32 bit
system due to the constrained virtual address space.
[1] https://lore.kernel.org/linux-mm/d0a136a0-4a31-46bc-adf4-2db109a61672@kernel.org/
[2] https://lore.kernel.org/linux-mm/CAJuCfpHXLdQy1a2B6xN2d7quTYwg2OoZseYPZTRpU0eHHKD-sQ@mail.gmail.com/
Link: [https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301@gmail.com](https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301%40gmail.com)
Fixes: efa7df3e3bb5 ("mm: align larger anonymous mappings on THP boundaries")
Signed-off-by: Yang Shi <yang@os.amperecomputing.com>
Reported-by: Jiri Slaby <jirislaby@kernel.org>
Reported-by: Suren Baghdasaryan <surenb@google.com>
Tested-by: Jiri Slaby <jirislaby@kernel.org>
Tested-by: Suren Baghdasaryan <surenb@google.com>
Reviewed-by: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Rik van Riel <riel@surriel.com>
Cc: Christopher Lameter <cl@linux.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7432376c913381c5f24d373a87ff629bbde94b47)

| -rw-r--r-- | [mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/huge_memory.c?id=7432376c913381c5f24d373a87ff629bbde94b47) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/mm/huge\_memory.c b/mm/huge\_memory.cindex 86ee29b5c39cc6..5c9f016fef4275 100644--- a/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=11fc2cae166edd92a7bfa77f559c49150ec05f46)+++ b/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=7432376c913381c5f24d373a87ff629bbde94b47)@@ -37,6 +37,7 @@ #include <linux/page\_owner.h> #include <linux/sched/sysctl.h> #include <linux/memory-tiers.h>+#include <linux/compat.h>  #include <asm/tlb.h> #include <asm/pgalloc.h>@@ -634,6 +635,9 @@ static unsigned long \_\_thp\_get\_unmapped\_area(struct file \*filp, loff\_t off\_align = round\_up(off, size); unsigned long len\_pad, ret; + if (IS\_ENABLED(CONFIG\_32BIT) || in\_compat\_syscall())+ return 0;+ if (off\_end <= off\_align || (off\_end - off\_align) < size) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:06:09 +0000



=== Content from www.openwall.com_d48a2ef0_20250111_150730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2024/07/15/4) [[next>]](2) [[<thread-prev]](../../../2024/07/15/2) [[thread-next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240715233232.pwHkh7Qt@steffen%sdaoden.eu>
Date: Tue, 16 Jul 2024 01:32:32 +0200
From: Steffen Nurpmeso <steffen@...oden.eu>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86
 kernels, despite CVE-2024-26621 patch

Demi Marie Obenour wrote in
 <ZpRSEWkkG6hmNhNo@...-email>:
 |On Sat, Jul 13, 2024 at 10:58:58PM +0200, Steffen Nurpmeso wrote:
 |> Jacob Bachmeyer wrote in
 |>  <6691E39C.8090600@...il.com>:
 |>|Steffen Nurpmeso wrote:
 |>|> [...]
 ...
 |> Some findings:
 ...
 |>   . I always whimper when i have to rm(1) a running executable before
 |>   placing an updated variant on Linux, on BSDs i simply over-cp(1)
 |>   (and i do not understand as long as one gets either the one or
 |>   the other when executing the path).
 ...
 |> But it is ok to me, Linux is as it is[.]
 |
 |Executable files and shared libraries should _never_ be modified
 |in-place.  They should _always_ be renamed over.  Otherwise, a program
 |might be a mixture of the old and new version, with completely undefined
 |results when the program is run.

So i am thankful i get this translucent impression of my Linux box
and henceforth always use cp -f there, and cp on BSDs.
Or is this a hint to GNU coreutils?
(I rather would prefer either the one or the other, but not
a messed up copy.  Is that what they are doing?)

--steffen
|
|Der Kragenbaer,                The moon bear,
|der holt sich munter           he cheerfully and one by one
|einen nach dem anderen runter  wa.ks himself off
|(By Robert Gernhardt)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_319f0e05_20250111_150727.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](5) [[next>]](7) [[<thread-prev]](5) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <Zow4aQrC2Q478N62@remnant.pseudorandom.co.uk>
Date: Mon, 8 Jul 2024 20:05:13 +0100
From: Simon McVittie <smcv@...ian.org>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On Mon, 08 Jul 2024 at 12:37:08 -0400, Will Dormann wrote:
>  - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at the
> same address every time. (i.e. no practical ASLR -- "ASLRn't")

To be more clear about this, when you said "x86" in that message, did you
mean a purely 32-bit x86 system (also known as IA32, i386 or similar),
with a 32-bit kernel and 32-bit user-space?

Or did you mean the whole 32- and 64-bit CPU family, including the purely
32-bit systems described above, but also x86_64?

Based on how you contrasted "x86 systems" vs. x86_64 kernels running
various user-space processes, I think (I hope!) you are using x86 to mean
the 32-bit architecture specifically, similar to how the Meson build
system uses the term; but some writers, projects and APIs say "x86" as
an umbrella term that includes both 32- and 64-bit flavours, the same
way you might talk about "ARM" and intend that to include 64-bit ARMv8.
So I think it would be useful to clarify which you meant.

    smcv

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_70692f91_20250111_150730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](../../../2024/07/16/2) [[thread-next>]](../../../2024/07/30/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <5e5fcc5b94cbcd6eb83fcfd3e73f0f08c0cba7e2.camel@debian.org>
Date: Mon, 29 Jul 2024 09:02:33 +0200
From: Yves-Alexis Perez <corsac@...ian.org>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

On Mon, 2024-07-08 at 12:37 -0400, Will Dormann wrote:
>   - Modern x86 systems with the CVE-2024-26621 patch will NOT ranzomize
> the load address of large libraries.  (i.e. is still vulnerable to
> "ASLRn't" despite the patch)

So it turns out this was because the patch addressing CVE-2024-26621
(4ef9ad19e17676b9ef071309bc62020e2373705d) did so using CONFIG_32BIT which is
(perhaps surprisingly) *not* defined on IA-32.

d9592025000b3cf26c742f3505da7b83aedc26d5 was recently merged to Linus tree
switching to !IS_ENABLED(CONFIG_64BIT) which should work on all architectures.
So ASLRn't *should* be fixed on IA-32 kernels with 6.11.

Regards,
- --
Yves-Alexis
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCAAdFiEE8vi34Qgfo83x35gF3rYcyPpXRFsFAmanPokACgkQ3rYcyPpX
RFvvbgf9FxMoxKSPfurTVA4wavVh2wQ397KBfPEz1QtKwHqrmZR4TfEJOlzsC2BM
h/6Vk+uJK70ByaKvR1j8fdYMUKniIM5GAAfNdpbPpsTgMLHGjHrj/89zG2R2YxIN
GwuY00rOyUXRF8hpfMCACnGatRJQqTcnr+Bdb6abYkxxTQLTu9vK/gj+A/eJOw2y
ayj/SOd4hnSl7725A8rTiiW53mdE3jDhxLNHnTU8Ucdwd2SFNk81bu3j0EWkcw6V
J5DFcGGhiIPIWb6e2ff3ucOLBFwXkuhxJqoocwaQEdwtBqq5Ui7MWHfM1fpdHgNH
k+JbdP0eXtrUgbSjLiQfzYwMPTeLVw==
=zO5O
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_d4898040_20250111_150727.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[<thread-prev]](6) [[thread-next>]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <5a422b6c-df18-4ec0-ab18-ce298babd7fa@analygence.com>
Date: Mon, 8 Jul 2024 15:39:15 -0400
From: Will Dormann <will.dormann@...lygence.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels, despite
 CVE-2024-26621 patch

On 7/8/24 12:37 PM, Will Dormann wrote:
>   - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
> the same address every time. (i.e. no practical ASLR -- "ASLRn't")
>   -  Modern (e.g. 6.x kernel and large-enough libc) x86_64 platforms
> running 32-bit code will load a large-enough library at the same address
> every time.
>   - Modern x86_64 systems with the CVE-2024-26621 patch will randomize
> the load address of large libraries loaded by 32-bit apps.
>   - Modern x86 systems with the CVE-2024-26621 patch will NOT ranzomize
> the load address of large libraries.  (i.e. is still vulnerable to
> "ASLRn't" despite the patch)
>   - Older Linux (5.x and earlier) randomize loaded libraries as expected.

And just to clarify on my use of terminology in the list above:

When I say "x86" {systems,platforms}, I mean a 32-bit Linux distribution
with an i386/i686 kernel and associated userland binaries.  This may be
virtualized on a x86_64 CPU, or emulated (in my case) on a 32-bit x86 CPU.

When I say "x86_64" {systems,platforms}, I'm referring to a common
x86_64 64-bit Linux distro.  And on such a distro, you can run 32-bit
code if you like.  In my case, I compiled test-mmap.c as a 32-bit app by
installing gcc-multilib and compiling with gcc -m32.

IOW, "x86" as I use it is 32-bit Linux.  "x86_64" is 64-bit Linux.

-WD

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_5cfd19a6_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](3) [[next>]](5) [[<thread-prev]](../../../2024/07/10/8) [[thread-next>]](5) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <3a3e9afa77884b05733a5cdfc3eaa65defa45fa4.camel@corsac.net>
Date: Thu, 11 Jul 2024 09:07:57 +0200
From: Yves-Alexis Perez <corsac@...sac.net>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On Wed, 2024-07-10 at 17:39 -0400, Will Dormann wrote:
> Linux 6.9.7 was released in June2024, and the patches for CVE-2024-26621
> went in months before that.  This behavior matches my 3rd bullet point
> above, so I think everything is as expected here.  ("... will randomize
> the load address of large libraries loaded by 32-bit apps.")

Right.
>
> If you want to see the lack of randomization, try the test with an x86
> kernel, not amd64.

I don't have one at hand unfortunately, but I'll try setting up a VM or
something just to be sure. Thanks.

I think there are not a lof of *modern* IA-32 installations, especially on
“generic” distributions, but there might still be some in network appliances
or something.

I guess setting vm.mmap_rnd_bits (or CONFIG_ARCH_MMAP_RND_BITS) to 16 at least
helps on those platforms (like they did on Ubuntu) but I wonder if a fix (or a
revert) in the kernel would be better (do we really need the alignment perfs
on IA-32 kernels?)

Regards,
--
Yves-Alexis

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_6f303ead_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](7) [[next>]](../../../2024/07/11/1) [[<thread-prev]](7) [[thread-next>]](../../../2024/07/11/4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240710214412.8IXhxf8b@steffen%sdaoden.eu>
Date: Wed, 10 Jul 2024 23:44:12 +0200
From: Steffen Nurpmeso <steffen@...oden.eu>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86
 kernels, despite CVE-2024-26621 patch

Yves-Alexis Perez wrote in
 <6771f9536d49185fc8f1ea9905c13cf4dd8776d2.camel@...ian.org>:
 ...
 |mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df\
 |3000

I thought on Linux MAP_DENYWRITE is actually an ignored flag.

--steffen
|
|Der Kragenbaer,                The moon bear,
|der holt sich munter           he cheerfully and one by one
|einen nach dem anderen runter  wa.ks himself off
|(By Robert Gernhardt)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_ec99a07d_20250111_150729.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](../../../2024/07/13/1) [[<thread-prev]](../../../2024/07/11/7) [[thread-next>]](../../../2024/07/13/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240712170603.XJ6iwd6q@steffen%sdaoden.eu>
Date: Fri, 12 Jul 2024 19:06:03 +0200
From: Steffen Nurpmeso <steffen@...oden.eu>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86
 kernels, despite CVE-2024-26621 patch

David A. Wheeler wrote in
 <83F0CF09-6257-4949-9332-E6990CFE14C7@...eeler.com>:
 |Yves-Alexis Perez wrote in
 |> <6771f9536d49185fc8f1ea9905c13cf4dd8776d2.camel@...ian.org>:
 |> ...
 |>|mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df\
 |>|3000
 |
 |On Jul 10, 2024, at 5:44 PM, Steffen Nurpmeso <steffen@...oden.eu> wrote:
 |> I thought on Linux MAP_DENYWRITE is actually an ignored flag.
 |
 |I believe you're correct, but I believe what Yves-Alexis Perez is showing \
 |is the
 |flags that are being *passed* to the kernel (whether or not they DO \
 |anything).
 |Which is why there's a proposal to *make* MAP_DENYWRITE do something \
 |in this case.
 |
 |My plea is that if this DOES start doing something, PLEASE document \
 |that ASAP
 |(including a note that it USED to be ignored). I fear that this security \
 |property
 |might, on some platforms, depend on a quiet undocumented change.

Well i mean, i do not know, i am a user space programmer.
And then the mmap(2) manual says

   MAP_DENYWRITE
          This  flag  is  ignored.  (Long ago—Linux 2.0 and earlier—it sig‐
          naled that attempts to write to the underlying file  should  fail
          with  ETXTBSY.   But  this  was a source of denial‐of‐service at‐
          tacks.)

which is nice (i think bitsavers.org does not have any info, and
we all know shall a future exist, this "cultural" epoch will be
a whiteout beside that).

But .. if you log the kernel you see for example
6e16f5133501440699dcca3c5aba367cf6f9c227 from 2023-07-24 saying

    selftests/mm: fix thuge-gen test bugs
    ...
    thuge-gen was also calling mmap with SHM_HUGETLB flag (bit 11 set), which
    is actually MAP_DENYWRITE in mmap context.  The man page says this flag is
    ignored in modern kernels.  I'm pretty sure from the context that the
    author intended to pass the MAP_HUGETLB flag so I've fixed that up too.

or 49624efa65ac9889f4e7c7b2452b2e6ce42ba37d from 2021-09-04

    Pull MAP_DENYWRITE removal from David Hildenbrand:
     "Remove all in-tree usage of MAP_DENYWRITE from the kernel and remove
      VM_DENYWRITE.

      There are some (minor) user-visible changes:
    ...

or 6128b3af2a5e42386aa7faf37609b57f39fb7d00 from 2021-04-23

    mm: ignore MAP_DENYWRITE in ksys_mmap_pgoff()

    Let's also remove masking off MAP_DENYWRITE from ksys_mmap_pgoff():
    the last in-tree occurrence of MAP_DENYWRITE is now in LEGACY_MAP_MASK,
    which accepts the flag e.g., for MAP_SHARED_VALIDATE; however, the flag
    is ignored throughout the kernel now.

    Add a comment to LEGACY_MAP_MASK stating that MAP_DENYWRITE is ignored.

so that is not too far in the past, and, sorry, but i am not so
deep in the kernel / memory system scene to get an immediate
notion, yet i think the topic is interesting for any (user space)
programmer of any programming language that supports mapping
memory directly.  So if someone says "this  was a source of
denial‐of‐service attacks" then i need to wrap my head, and it is
not as if an in-between-the-lines reference to MAP_DENYWRITE ring
any bells except that i think the flag has been removed.  And then
someone who seems to know uses it nonetheless in a small showcase
program, likely trying to say even more in-between-the-lines.  And
thus i live on the edge in between the Red Hot ChilliPeppers "if
you have to ask, you will never know", and the Sesame Street,
which at least in Germany was "sometimes you simply have to ask to
understand a matter".  Granted that "i think this flag was
removed" is not a question as such.

--steffen
|
|Der Kragenbaer,                The moon bear,
|der holt sich munter           he cheerfully and one by one
|einen nach dem anderen runter  wa.ks himself off
|(By Robert Gernhardt)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_f8dd3e11_20250111_150727.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](4) [[thread-next>]](6) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <a97223bb-e7db-48c8-8a94-4ca3c8b29803@analygence.com>
Date: Mon, 8 Jul 2024 14:09:59 -0400
From: Will Dormann <will.dormann@...lygence.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On 7/8/24 1:28 PM, Florian Weimer wrote:
> The kernel should not apply hugepage optimizations to mappings created
> with MAP_DENYWRITE.

FWIW, Grsecurity has published a blog post about this topic that covers
much more nuance than the original "ASLRn't" blog post:
<<https://grsecurity.net/toolchain_necromancy_past_mistakes_haunting_aslr>>

-WD

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_8da9b481_20250111_150729.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](../../../2024/07/12/1) [[<thread-prev]](5) [[thread-next>]](../../../2024/07/12/3) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <da14cfdfa8a410fd8589ad93f7e6a9eb271f52b1.camel@debian.org>
Date: Thu, 11 Jul 2024 21:06:40 +0200
From: Yves-Alexis Perez <corsac@...ian.org>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

On Thu, 2024-07-11 at 09:07 +0200, Yves-Alexis Perez wrote:
> > If you want to see the lack of randomization, try the test with an x86
> > kernel, not amd64.
>
> I don't have one at hand unfortunately, but I'll try setting up a VM or
> something just to be sure. Thanks.

So I did try with an x86 VM and it does confirm your finding. On an unstable
kernel the simple `cat /proc/self/maps |grep libc.so |head -n1` (with libc6 on
x86 beeing more than 2M) I get no randomness at all.

Regards,
- --
Yves-Alexis
-----BEGIN PGP SIGNATURE-----

iQEzBAEBCAAdFiEE8vi34Qgfo83x35gF3rYcyPpXRFsFAmaQLUAACgkQ3rYcyPpX
RFvWbAgAy9nuAhjaNtgT7zBs1/Th5E4/veuUQWdkh4CUbaRjpndmYI9fWGVxtyfh
p1xc10mkxVi0onVw5hwd3fb3GxvSCtZEDfFG/8qfAC5wIn05/ZvKyZvaBySYMqSm
au1tgM1A0CPrsbcf0wVJoE+hoQnGBl/d2fvd3cp9fDV3+ItYtbzH5XIgRugaGkfz
3kx+CK8kM5FbtWZ12ZkERXbvIUf8vqTuGbfqR3M6g3w8eqBqzkmi8TQcbhOP1X4N
G0aJe3K5omlz77wxrCxBfBCT37uhPT6ljfJYaRUWhGXzT3UACmqM9QXu30/XBgjd
rl9bGcbbvQJ+h5WZady6GLEQZg/Qsw==
=Mbeb
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_4464513f_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](4) [[next>]](6) [[<thread-prev]](4) [[thread-next>]](7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <83F0CF09-6257-4949-9332-E6990CFE14C7@dwheeler.com>
Date: Thu, 11 Jul 2024 12:55:41 -0400
From: "David A. Wheeler" <dwheeler@...eeler.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

Yves-Alexis Perez wrote in
> <6771f9536d49185fc8f1ea9905c13cf4dd8776d2.camel@...ian.org>:
> ...
> |mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df\
> |3000

On Jul 10, 2024, at 5:44 PM, Steffen Nurpmeso <steffen@...oden.eu> wrote:
> I thought on Linux MAP_DENYWRITE is actually an ignored flag.

I believe you're correct, but I believe what Yves-Alexis Perez is showing is the
flags that are being *passed* to the kernel (whether or not they DO anything).
Which is why there's a proposal to *make* MAP_DENYWRITE do something in this case.

My plea is that if this DOES start doing something, PLEASE document that ASAP
(including a note that it USED to be ignored). I fear that this security property
might, on some platforms, depend on a quiet undocumented change.

--- David A. Wheeler

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from git.kernel.org_9a3c9f77_20250111_150731.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6ea9aa8d97e6563676094cb35755884173269555)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ea9aa8d97e6563676094cb35755884173269555)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ea9aa8d97e6563676094cb35755884173269555)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea9aa8d97e6563676094cb35755884173269555)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yang Shi <yang@os.amperecomputing.com> | 2024-01-18 10:05:05 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-14 13:59:02 +0200 |
| commit | [6ea9aa8d97e6563676094cb35755884173269555](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6ea9aa8d97e6563676094cb35755884173269555) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6ea9aa8d97e6563676094cb35755884173269555)) | |
| tree | [3d0cac2471157836a8713cc90b8f34229022c095](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6ea9aa8d97e6563676094cb35755884173269555) | |
| parent | [94220b35aeba2b68da81deeefbb784d94eeb5c04](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94220b35aeba2b68da81deeefbb784d94eeb5c04) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea9aa8d97e6563676094cb35755884173269555&id2=94220b35aeba2b68da81deeefbb784d94eeb5c04)) | |
| download | [linux-6ea9aa8d97e6563676094cb35755884173269555.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6ea9aa8d97e6563676094cb35755884173269555.tar.gz) | |

mm: huge\_memory: don't force huge page alignment on 32 bitcommit 4ef9ad19e17676b9ef071309bc62020e2373705d upstream.
commit efa7df3e3bb5 ("mm: align larger anonymous mappings on THP
boundaries") caused two issues [1] [2] reported on 32 bit system or compat
userspace.
It doesn't make too much sense to force huge page alignment on 32 bit
system due to the constrained virtual address space.
[1] https://lore.kernel.org/linux-mm/d0a136a0-4a31-46bc-adf4-2db109a61672@kernel.org/
[2] https://lore.kernel.org/linux-mm/CAJuCfpHXLdQy1a2B6xN2d7quTYwg2OoZseYPZTRpU0eHHKD-sQ@mail.gmail.com/
Link: [https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301@gmail.com](https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301%40gmail.com)
Fixes: efa7df3e3bb5 ("mm: align larger anonymous mappings on THP boundaries")
Signed-off-by: Yang Shi <yang@os.amperecomputing.com>
Reported-by: Jiri Slaby <jirislaby@kernel.org>
Reported-by: Suren Baghdasaryan <surenb@google.com>
Tested-by: Jiri Slaby <jirislaby@kernel.org>
Tested-by: Suren Baghdasaryan <surenb@google.com>
Reviewed-by: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Rik van Riel <riel@surriel.com>
Cc: Christopher Lameter <cl@linux.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Cc: Ben Hutchings <ben@decadent.org.uk>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6ea9aa8d97e6563676094cb35755884173269555)

| -rw-r--r-- | [mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/huge_memory.c?id=6ea9aa8d97e6563676094cb35755884173269555) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/mm/huge\_memory.c b/mm/huge\_memory.cindex 79fbd6ddec49f5..a5cb7685b32d81 100644--- a/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=94220b35aeba2b68da81deeefbb784d94eeb5c04)+++ b/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=6ea9aa8d97e6563676094cb35755884173269555)@@ -37,6 +37,7 @@ #include <linux/page\_owner.h> #include <linux/sched/sysctl.h> #include <linux/memory-tiers.h>+#include <linux/compat.h>  #include <asm/tlb.h> #include <asm/pgalloc.h>@@ -601,6 +602,9 @@ static unsigned long \_\_thp\_get\_unmapped\_area(struct file \*filp, loff\_t off\_align = round\_up(off, size); unsigned long len\_pad, ret; + if (IS\_ENABLED(CONFIG\_32BIT) || in\_compat\_syscall())+ return 0;+ if (off\_end <= off\_align || (off\_end - off\_align) < size) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:06:09 +0000



=== Content from git.kernel.org_df511a73_20250111_150732.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Yang Shi <yang@os.amperecomputing.com> | 2024-01-18 10:05:05 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:45:06 +0000 |
| commit | [87632bc9ecff5ded93433bc0fca428019bdd1cfe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)) | |
| tree | [bbe287806e2dc1df51e87398e4096781989e512e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe) | |
| parent | [afbf1a5cef46427241e76704991cc83c9b1a463b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=afbf1a5cef46427241e76704991cc83c9b1a463b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe&id2=afbf1a5cef46427241e76704991cc83c9b1a463b)) | |
| download | [linux-87632bc9ecff5ded93433bc0fca428019bdd1cfe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-87632bc9ecff5ded93433bc0fca428019bdd1cfe.tar.gz) | |

mm: huge\_memory: don't force huge page alignment on 32 bitcommit 4ef9ad19e17676b9ef071309bc62020e2373705d upstream.
commit efa7df3e3bb5 ("mm: align larger anonymous mappings on THP
boundaries") caused two issues [1] [2] reported on 32 bit system or compat
userspace.
It doesn't make too much sense to force huge page alignment on 32 bit
system due to the constrained virtual address space.
[1] https://lore.kernel.org/linux-mm/d0a136a0-4a31-46bc-adf4-2db109a61672@kernel.org/
[2] https://lore.kernel.org/linux-mm/CAJuCfpHXLdQy1a2B6xN2d7quTYwg2OoZseYPZTRpU0eHHKD-sQ@mail.gmail.com/
Link: [https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301@gmail.com](https://lkml.kernel.org/r/20240118180505.2914778-1-shy828301%40gmail.com)
Fixes: efa7df3e3bb5 ("mm: align larger anonymous mappings on THP boundaries")
Signed-off-by: Yang Shi <yang@os.amperecomputing.com>
Reported-by: Jiri Slaby <jirislaby@kernel.org>
Reported-by: Suren Baghdasaryan <surenb@google.com>
Tested-by: Jiri Slaby <jirislaby@kernel.org>
Tested-by: Suren Baghdasaryan <surenb@google.com>
Reviewed-by: Matthew Wilcox (Oracle) <willy@infradead.org>
Cc: Rik van Riel <riel@surriel.com>
Cc: Christopher Lameter <cl@linux.com>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)

| -rw-r--r-- | [mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/mm/huge_memory.c?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/mm/huge\_memory.c b/mm/huge\_memory.cindex 59577946735b1f..9736e762184bdf 100644--- a/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=afbf1a5cef46427241e76704991cc83c9b1a463b)+++ b/[mm/huge\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/mm/huge_memory.c?id=87632bc9ecff5ded93433bc0fca428019bdd1cfe)@@ -37,6 +37,7 @@ #include <linux/page\_owner.h> #include <linux/sched/sysctl.h> #include <linux/memory-tiers.h>+#include <linux/compat.h>  #include <asm/tlb.h> #include <asm/pgalloc.h>@@ -607,6 +608,9 @@ static unsigned long \_\_thp\_get\_unmapped\_area(struct file \*filp, loff\_t off\_align = round\_up(off, size); unsigned long len\_pad, ret; + if (IS\_ENABLED(CONFIG\_32BIT) || in\_compat\_syscall())+ return 0;+ if (off\_end <= off\_align || (off\_end - off\_align) < size) return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 15:06:10 +0000



=== Content from www.openwall.com_f0d4ee13_20250111_150726.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](2) [[next>]](4) [[thread-next>]](4) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <30400489-6c59-4133-a3ce-fa0c16b63c02@analygence.com>
Date: Mon, 8 Jul 2024 12:37:08 -0400
From: Will Dormann <will.dormann@...lygence.com>
To: oss-security@...ts.openwall.com
Subject: ASLRn't is still alive and well on x86 kernels, despite
 CVE-2024-26621 patch

Hi folks,

Back in 2022, a Debian bug report was created that described weaknesses
in ASLR: <<https://bugs.debian.org/cgi-bin/bugreport.cgi?bug=1024149>>
As the result of this, x86_64 ASLR was weakened, and x86 ASLR was
practically disabled, as the result of libc libraries being larger than
2MB in modern platforms.

Later in early 2024, this issue was given the "ASLRn't" moniker and
published through other channels: <<https://zolutal.github.io/aslrnt/>>

Eventually CVE-2024-26621 was assigned to the vulnerability, and the
Debian ticket was eventually closed.

The problem with the fix for CVE-2024-26621 seems to be that it perhaps
only appears to have an effect on 32-bit x86 code running on a x86_64
Linux kernel. This was made obvious due to the recent Qualys writeup on
regreSSHion CVE-2024-6387
<<https://www.qualys.com/2024/07/01/cve-2024-6387/regresshion.txt>>
Qualys was able to successfully exploit CVE-2024-6387 in a "reasonable"
amount of time due to the lack of ASLR on an x86 platform.

To make testing this stuff easier, I've put together a toy python script
to easily see if the platform is vulnerable to ASLRn't or not:
<<https://gist.github.com/wdormann/544a9e89fe35a84135e58eb5c7b1721d>>
Specifically, if any app running on the platform might expose a
large-enough libc at a predictable address.  It will also report lack of
PIE in "cat", and also the apparent entropy/bitmask of randomizations
present. When testing platforms with a libc smaller than 2MB, this
python script won't suffice and you'll likely need a test app such as
what's listed in the Debian bug
<<https://bugs.debian.org/cgi-bin/bugreport.cgi?att=1;bug=1024149;filename=test-mmap.c;msg=8>>.
  As reported in the Debian bug, running the program repeatedly with a
2MB file will report the same address every time on a vulnerable system,
and will be randomized on a system that is behaving as expected.

In testing some platforms that I had readily available, I've concluded:
  - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
the same address every time. (i.e. no practical ASLR -- "ASLRn't")
  -  Modern (e.g. 6.x kernel and large-enough libc) x86_64 platforms
running 32-bit code will load a large-enough library at the same address
every time.
  - Modern x86_64 systems with the CVE-2024-26621 patch will randomize
the load address of large libraries loaded by 32-bit apps.
  - Modern x86 systems with the CVE-2024-26621 patch will NOT ranzomize
the load address of large libraries.  (i.e. is still vulnerable to
"ASLRn't" despite the patch)
  - Older Linux (5.x and earlier) randomize loaded libraries as expected.

It's unclear to me whether the inapplicability of the CVE-2024-26621 to
x86 kernels was intentional, or whether it was a compromise with known
side effects.  Granted, the availability of modern x86 Linux is somewhat
limited (e.g. Debian, Kali, OpenSUSE Tumbleweed), but IMO if Linux
kernel is to continue to support the platform, any regression of a
mitigation that has been around for years should probably warrant a
(new) CVE.

As for x86_64 kernels, the ASLR entropy of libc appears to drop from ~29
bits to ~20 bits with the change that introduced ASLRn't. Whether this
is CVE-worthy is beyond me, as the strength of the protections provided
by ASLR are indeed weakened by the change in where libraries are loaded.
  But arguably ~20 bits of ASLR may be considered "fine" and that the
benefits of the change in loading addresses outweighs the risk.

Brief testing on a 6.1.21 32-bit ARM platform shows that 2MB mapped
files are indeed randomized, so perhaps this all is an x86-specific
issue. Though I have not tested any platform other than ARM and x86.

-WD

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_5e2d5335_20250111_150727.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](7) [[next>]](../../../2024/07/09/1) [[<thread-prev]](7) [[thread-next>]](../../../2024/07/09/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-Id: <D52A947C-0AEC-4310-B2C5-519BBE46037C@dwheeler.com>
Date: Mon, 8 Jul 2024 16:14:40 -0400
From: "David A. Wheeler" <dwheeler@...eeler.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

> * Will Dormann:
> - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
>>   the same address every time. (i.e. no practical ASLR -- "ASLRn't")

For clarity, I'm going use the term "x86_32" to clarify that we're talking about
32-bit architectures & *excluding* the far-more-common 64-bit case.

> On Jul 8, 2024, at 1:28 PM, Florian Weimer <fweimer@...hat.com> wrote:
> Please note that current glibc is not large enough to benefit from 2 MiB
> hugepages because all load segments are smaller than 2 MiB, so it's just
> not possible to use hugepages for libc.so.6.  This is with the default
> -z separate-code in current binutils.  Even with -z noseparate-code, the
> large readable-executable load segment is still a bit less than 2 MiB.
> Unfortunately the kernel does not know this when we reserve the address
> space for the entirety of libc.so.6.

So clearly there needs to be a way to provide this information :-).

> The kernel should not apply hugepage optimizations to mappings created
> with MAP_DENYWRITE.

Shouldn't that be MAP_EXECUTABLE, not MAP_DENYWRITE?
If you use MAP_DENYWRITE,
a program that mmaps in a large non-code dataset won't have hugepage
optimizations applied, which might be a significant performance regression.

Also, the mmap man page:
<https://man7.org/linux/man-pages/man2/mmap.2.html>
says that  MAP_EXECUTABLE and MAP_DENYWRITE are ignored.
There's a risk that some programs are taking that to heart & not using those flags
even when they should. If one of those flags *will* have an effect now, then it'd be a good idea
to document that :-).

--- David A. Wheeler

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_eefa7705_20250111_150729.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](../../../2024/07/15/1) [[<thread-prev]](2) [[thread-next>]](../../../2024/07/15/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240713205858.LSnJJGoo@steffen%sdaoden.eu>
Date: Sat, 13 Jul 2024 22:58:58 +0200
From: Steffen Nurpmeso <steffen@...oden.eu>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86
 kernels, despite CVE-2024-26621 patch

Jacob Bachmeyer wrote in
 <6691E39C.8090600@...il.com>:
 |Steffen Nurpmeso wrote:
 |> [...]
 |>
 |> So if someone says "this  was a source of
 |> denial‐of‐service attacks" then i need to wrap my head, and it is
 |> not as if an in-between-the-lines reference to MAP_DENYWRITE ring
 |> any bells except that i think the flag has been removed.
 |
 |The manpage indicates that, long ago, a mapping with MAP_DENYWRITE would
 |effectively make the underlying file read-only, even to root, for as
 |long as the mapping exists.

Thank you.  I add a search result from Google Groups which still
exists for doing so collected just now:

  Linus Torvalds Oct 4, 2001, 7:38:12 AM

  Rob Landley <lan...@...mmello.org> wrote:
  >I.E. it seems like they go out of their way to ALLOW writing to the libaries.
  > (I assume they KNOW the difference between MAP_DENYWRITE, MAP_COPY, and
  >MAP_PRIVATE...?)

  Note that the kernel will refuse to honour MAP_DENYWRITE from user
  space, so I'm afraid that changing ld.so won't do a thing.

  The reason the kernel refuses to honour it, is that MAP_DENYWRITE is an
  excellent DoS-vehicle - you just mmap("/etc/passwd") with MAP_DENYWRITE,
  and even root cannot write to it.. Vary nasty.

  Which is why the kernel only allows it when the binary loader itself
  sets the flag, because security-conscious application writers are
  already aware of the "oh, a running binary may not be writable" issues.

  So sorry..

  Linus

  Linus Torvalds Oct 4, 2001, 7:49:27 AM

  On Thu, 4 Oct 2001, Alexander Viro wrote:
  > <nit>
  > I _really_ doubt that something does write() on /etc/passwd. Create a
  > file and rename it over the thing - sure, but that's it.
  > </nit>

  Well, yeah, bad choice. Can you believe /var/run/utmp or similar?

  And yes, we could add checks for the thing being executable before we
  accept MAP_DENYWRITE instead of just ignoring the flag from user space.
  Nobody has cared enough to make the effort.

  Until now?

  Linus

Some findings:
  . I note that the mentioned files are writable by only root (and
  i would assume MAP_DENYWRITE to only work if i could do so
  myself).
  . Capabilities have become more fine-grained.
  . I always whimper when i have to rm(1) a running executable before
  placing an updated variant on Linux, on BSDs i simply over-cp(1)
  (and i do not understand as long as one gets either the one or
  the other when executing the path).
  . Shouldn't mandatory file locking have the same effect.
But it is ok to me, Linux is as it is, and they progress and
iterate over the code at an unbelievable speed.  And some things
are just the way they are.  (Or change.  Back.  And forth.  And
back etc etc)

 |>   And then
 |> someone who seems to know uses it nonetheless in a small showcase
 |> program, likely trying to say even more in-between-the-lines.
 |
 |That commit message seems to indicate that the program was using
 |SHM_HUGETLB when it should have been using MAP_HUGETLB, those constants
 |represent different bits, and passing SHM_HUGETLB to mmap(2) will be
 |interpreted as MAP_DENYWRITE, and therefore ignored.  Presumably, there
 |is some other syscall (likely shmat(2)) that uses that bit (represented
 |under the constant SHM_HUGETLB) to request huge pages, and the test
 |program in question was supposed to get huge pages from mmap(2) but was
 |not actually asking for huge pages because it was using the wrong constant.
 |
 |In other words, MAP_DENYWRITE was not being intentionally used at all.
 |Another constant, for a different set of flags, that happens to have the
 |same value, was being used, causing a quiet bug.  (The test program
 |would have still worked, but was not actually exercising huge pages as
 |intended.)

The Linux commit messages are tremendous books that often leave me
stunning.  I *never* get together such things in my own work
process.  So thanks for spending additional time reiterating this.

 |-- Jacob

Thank you very much.

 --End of <6691E39C.8090600@...il.com>

--steffen
|
|Der Kragenbaer,                The moon bear,
|der holt sich munter           he cheerfully and one by one
|einen nach dem anderen runter  wa.ks himself off
|(By Robert Gernhardt)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_ec308667_20250111_150730.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[<thread-prev]](1) [[thread-next>]](../../../2024/07/29/2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240715234059.ThiJfcS3@steffen%sdaoden.eu>
Date: Tue, 16 Jul 2024 01:40:59 +0200
From: Steffen Nurpmeso <steffen@...oden.eu>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86
 kernels, despite CVE-2024-26621 patch

Jacob Bachmeyer wrote in
 <66946BDB.4070709@...il.com>:
 |Steffen Nurpmeso wrote:
 |> [...]
 |>
 |> Some findings:
 |>   . I note that the mentioned files are writable by only root (and
 |>   i would assume MAP_DENYWRITE to only work if i could do so
 |>   myself).
 |>
 |
 |I believe that most executables are writable only by root, but available
 |to unprivileged users.  Since the purpose of MAP_DENYWRITE seems to have
 |been ensuring that executables cannot change out from underneath running
 |programs, it would need to work when unprivileged users map the file;
 |thus the DoS problem.

I have to reread mandatory-locking.txt and locks.txt from Linux
src.  I just realized that lslocks(1) aka /proc/locks shows me
locks held by PID 1130 which "i" cannot see due to

  $ findmnt /proc
  TARGET SOURCE FSTYPE OPTIONS
  /proc  none   proc   rw,nosuid,nodev,noexec,relatime,gid=10,hidepid=invisible
  $ cat /proc/locks
  1: FLOCK  ADVISORY  WRITE 1130 00:15:354719 0 EOF
  2: FLOCK  ADVISORY  WRITE 1130 00:15:354609 0 EOF

I have the gut feeling in the end there will be nothing in /proc
nor /sys.

 |>   . Capabilities have become more fine-grained.
 |>   . I always whimper when i have to rm(1) a running executable before
 |>   placing an updated variant on Linux, on BSDs i simply over-cp(1)
 |>   (and i do not understand as long as one gets either the one or
 |>   the other when executing the path).
 |>
 |Simple solution:
 |    - write the new executable under a temporary name
 |    - use link(2) to create a new name for the existing executable
 |    - use rename(2) to atomically replace the existing executable
 |    - use unlink(2) to remove the old version after any needed checks
 |
 |You can dispense with link(2) and unlink(2) if you do not want to
 |preserve a backup of the old executable.  Using this method will change
 |the executable's inode number (meaning that it really is a different
 |file) and that means that the old version can remain on disk for as long
 |as it remains in use, even after its last name has been removed.

Thank you.  Whimpering is not that bad, The Cure boys were crying.

--steffen
|
|Der Kragenbaer,                The moon bear,
|der holt sich munter           he cheerfully and one by one
|einen nach dem anderen runter  wa.ks himself off
|(By Robert Gernhardt)

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from www.openwall.com_04079edd_20250111_150728.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](6) [[next>]](8) [[<thread-prev]](5) [[thread-next>]](8) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <bda1ece8-8302-4a04-9f16-c78b51b0dbb2@analygence.com>
Date: Wed, 10 Jul 2024 17:39:04 -0400
From: Will Dormann <will.dormann@...lygence.com>
To: oss-security@...ts.openwall.com
Subject: Re: ASLRn't is still alive and well on x86 kernels,
 despite CVE-2024-26621 patch

On 7/10/24 4:54 PM, Yves-Alexis Perez wrote:
> On Mon, 2024-07-08 at 12:37 -0400, Will Dormann wrote:
>>    - Modern (e.g. 6.x kernel) x86 platforms load a large-enough libc at
>> the same address every time. (i.e. no practical ASLR -- "ASLRn't")
>>    -  Modern (e.g. 6.x kernel and large-enough libc) x86_64 platforms
>> running 32-bit code will load a large-enough library at the same address
>> every time.
>>    - Modern x86_64 systems with the CVE-2024-26621 patch will randomize
>> the load address of large libraries loaded by 32-bit apps.
>>    - Modern x86 systems with the CVE-2024-26621 patch will NOT ranzomize
>> the load address of large libraries.  (i.e. is still vulnerable to
>> "ASLRn't" despite the patch)
>
> Hey,
>
> I'm testing on my Debian sid laptop with Linux kernel 6.9.7-1. This is amd64
> but running test-mmap built with -m32, and I get:
>
> for i in {0..10}; do ./test-mmap < zeros; done
> mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7df3000
> mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d98000
> mmap(NULL, 2097152, PROT_READ, MAP_PRIVATE|MAP_DENYWRITE, 0, 0) = 0xf7d6f000

Linux 6.9.7 was released in June2024, and the patches for CVE-2024-26621
went in months before that.  This behavior matches my 3rd bullet point
above, so I think everything is as expected here.  ("... will randomize
the load address of large libraries loaded by 32-bit apps.")

If you want to see the lack of randomization, try the test with an x86
kernel, not amd64.

-WD

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


