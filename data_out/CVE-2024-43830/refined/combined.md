=== Content from git.kernel.org_645c4cad_20250111_165551.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:59:59 +0200 |
| commit | [0788a6f3523d3686a9eed5ea1e6fcce6841277b2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)) | |
| tree | [fc87a86e4197a2567baee1386c66eec40baada55](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2) | |
| parent | [e6daf3bf851b43f6f683c7295b868e66ab255df2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e6daf3bf851b43f6f683c7295b868e66ab255df2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2&id2=e6daf3bf851b43f6f683c7295b868e66ab255df2)) | |
| download | [linux-0788a6f3523d3686a9eed5ea1e6fcce6841277b2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0788a6f3523d3686a9eed5ea1e6fcce6841277b2.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex b1b323b19301d2..19e4866b002982 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=e6daf3bf851b43f6f683c7295b868e66ab255df2)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=0788a6f3523d3686a9eed5ea1e6fcce6841277b2)@@ -179,9 +179,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig)  cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:28 +0000



=== Content from git.kernel.org_ddc30aab_20250111_165553.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:49:13 +0200 |
| commit | [734ba6437e80dfc780e9ee9d95f912392d12b5ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)) | |
| tree | [0e171775af45a9b8fc2ea65073503cbf6dda2970](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea) | |
| parent | [38a00b3ab6d264ad243c2ad614b0156fce8fefdf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38a00b3ab6d264ad243c2ad614b0156fce8fefdf) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea&id2=38a00b3ab6d264ad243c2ad614b0156fce8fefdf)) | |
| download | [linux-734ba6437e80dfc780e9ee9d95f912392d12b5ea.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-734ba6437e80dfc780e9ee9d95f912392d12b5ea.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 072491d3e17b01..024b73f84ce0c7 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=38a00b3ab6d264ad243c2ad614b0156fce8fefdf)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=734ba6437e80dfc780e9ee9d95f912392d12b5ea)@@ -179,9 +179,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig)  cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:30 +0000



=== Content from git.kernel.org_92d2e717_20250111_165552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:45:01 +0200 |
| commit | [3fb6a9d67cfd812a547ac73ec02e1077c26c640d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)) | |
| tree | [fc3af8fe5fcda1e7694ecb40cd56e9d04555e85e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d) | |
| parent | [a3d41048e51b9a14dd8daa5419aa24b9ceee7228](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a3d41048e51b9a14dd8daa5419aa24b9ceee7228) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d&id2=a3d41048e51b9a14dd8daa5419aa24b9ceee7228)) | |
| download | [linux-3fb6a9d67cfd812a547ac73ec02e1077c26c640d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3fb6a9d67cfd812a547ac73ec02e1077c26c640d.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 4e7b78a84149be..cbe70f38cb5723 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=a3d41048e51b9a14dd8daa5419aa24b9ceee7228)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=3fb6a9d67cfd812a547ac73ec02e1077c26c640d)@@ -177,9 +177,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig) flags); cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:30 +0000



=== Content from git.kernel.org_06e2966c_20250111_165554.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:53:51 +0200 |
| commit | [cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)) | |
| tree | [d5088aca5fc22305edef8c9b50f11415d90f0570](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) | |
| parent | [be50a293ebc619195e6499c9583933233cba251d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be50a293ebc619195e6499c9583933233cba251d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374&id2=be50a293ebc619195e6499c9583933233cba251d)) | |
| download | [linux-cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 6a5e1f41f9a452..4f5829b726a752 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=be50a293ebc619195e6499c9583933233cba251d)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)@@ -179,9 +179,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig)  cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:31 +0000



=== Content from git.kernel.org_56209a36_20250111_165555.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d1415125b701ef13370e2761f691ec632a5eb93a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1415125b701ef13370e2761f691ec632a5eb93a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1415125b701ef13370e2761f691ec632a5eb93a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1415125b701ef13370e2761f691ec632a5eb93a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:33:31 +0200 |
| commit | [d1415125b701ef13370e2761f691ec632a5eb93a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1415125b701ef13370e2761f691ec632a5eb93a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d1415125b701ef13370e2761f691ec632a5eb93a)) | |
| tree | [fce4559786f8aed15c20a43c8f4ce473d9008b15](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1415125b701ef13370e2761f691ec632a5eb93a) | |
| parent | [3a2a9cc47d5d8b210bba9e56e83d9f66225f030e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3a2a9cc47d5d8b210bba9e56e83d9f66225f030e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1415125b701ef13370e2761f691ec632a5eb93a&id2=3a2a9cc47d5d8b210bba9e56e83d9f66225f030e)) | |
| download | [linux-d1415125b701ef13370e2761f691ec632a5eb93a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d1415125b701ef13370e2761f691ec632a5eb93a.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1415125b701ef13370e2761f691ec632a5eb93a)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=d1415125b701ef13370e2761f691ec632a5eb93a) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 0d59763e40de14..3ec9629a1b0028 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=3a2a9cc47d5d8b210bba9e56e83d9f66225f030e)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=d1415125b701ef13370e2761f691ec632a5eb93a)@@ -121,9 +121,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig) flags); cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:32 +0000



=== Content from git.kernel.org_e3762d10_20250111_165553.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Lee Jones <lee@kernel.org> | 2024-06-21 11:57:09 +0100 |
| commit | [c0dc9adf9474ecb7106e60e5472577375aedaed3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)) | |
| tree | [d05b94d3768a7d2cd7933e4315ef07a9603398e2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3) | |
| parent | [4a598907ef1f812ec3fecac5c181c0b7b2d21913](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a598907ef1f812ec3fecac5c181c0b7b2d21913) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3&id2=4a598907ef1f812ec3fecac5c181c0b7b2d21913)) | |
| download | [linux-c0dc9adf9474ecb7106e60e5472577375aedaed3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c0dc9adf9474ecb7106e60e5472577375aedaed3.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=c0dc9adf9474ecb7106e60e5472577375aedaed3) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 638aa6591092b8..4d1a506a772c5e 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=4a598907ef1f812ec3fecac5c181c0b7b2d21913)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=c0dc9adf9474ecb7106e60e5472577375aedaed3)@@ -179,9 +179,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig)  cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:31 +0000



=== Content from git.kernel.org_8dd9c83e_20250111_165554.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c3b7a650c8717aa89df318364609c86cbc040156)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3b7a650c8717aa89df318364609c86cbc040156)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3b7a650c8717aa89df318364609c86cbc040156)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b7a650c8717aa89df318364609c86cbc040156)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:31:59 +0200 |
| commit | [c3b7a650c8717aa89df318364609c86cbc040156](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3b7a650c8717aa89df318364609c86cbc040156) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c3b7a650c8717aa89df318364609c86cbc040156)) | |
| tree | [7b917923a0af74a37ff98bf18158b04b725cbaf9](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c3b7a650c8717aa89df318364609c86cbc040156) | |
| parent | [ae16866626ecae26a7317e0372224d5480211ff7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ae16866626ecae26a7317e0372224d5480211ff7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b7a650c8717aa89df318364609c86cbc040156&id2=ae16866626ecae26a7317e0372224d5480211ff7)) | |
| download | [linux-c3b7a650c8717aa89df318364609c86cbc040156.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c3b7a650c8717aa89df318364609c86cbc040156.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c3b7a650c8717aa89df318364609c86cbc040156)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=c3b7a650c8717aa89df318364609c86cbc040156) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex ec4c957c36b6c4..8738fc01523fd6 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=ae16866626ecae26a7317e0372224d5480211ff7)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=c3b7a650c8717aa89df318364609c86cbc040156)@@ -125,9 +125,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig) flags); cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:31 +0000



=== Content from git.kernel.org_296c269f_20250111_165552.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:40:49 +0200 |
| commit | [09c1583f0e10c918855d6e7540a79461a353e5d6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09c1583f0e10c918855d6e7540a79461a353e5d6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)) | |
| tree | [a15b59cec7ba63ee4d78b3ebb18088511a991b94](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=09c1583f0e10c918855d6e7540a79461a353e5d6) | |
| parent | [3c9071a8710574dcdf2908c1fece65d0ac5fa182](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3c9071a8710574dcdf2908c1fece65d0ac5fa182) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09c1583f0e10c918855d6e7540a79461a353e5d6&id2=3c9071a8710574dcdf2908c1fece65d0ac5fa182)) | |
| download | [linux-09c1583f0e10c918855d6e7540a79461a353e5d6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-09c1583f0e10c918855d6e7540a79461a353e5d6.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=09c1583f0e10c918855d6e7540a79461a353e5d6)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=09c1583f0e10c918855d6e7540a79461a353e5d6) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 4e7b78a84149be..cbe70f38cb5723 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=3c9071a8710574dcdf2908c1fece65d0ac5fa182)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=09c1583f0e10c918855d6e7540a79461a353e5d6)@@ -177,9 +177,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig) flags); cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:29 +0000


