

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Hans de Goede <hdegoede@redhat.com> | 2024-05-04 18:25:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:53:51 +0200 |
| commit | [cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)) | |
| tree | [d5088aca5fc22305edef8c9b50f11415d90f0570](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) | |
| parent | [be50a293ebc619195e6499c9583933233cba251d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be50a293ebc619195e6499c9583933233cba251d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374&id2=be50a293ebc619195e6499c9583933233cba251d)) | |
| download | [linux-cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374.tar.gz) | |

leds: trigger: Unregister sysfs attributes before calling deactivate()[ Upstream commit c0dc9adf9474ecb7106e60e5472577375aedaed3 ]
Triggers which have trigger specific sysfs attributes typically store
related data in trigger-data allocated by the activate() callback and
freed by the deactivate() callback.
Calling device\_remove\_groups() after calling deactivate() leaves a window
where the sysfs attributes show/store functions could be called after
deactivation and then operate on the just freed trigger-data.
Move the device\_remove\_groups() call to before deactivate() to close
this race window.
This also makes the deactivation path properly do things in reverse order
of the activation path which calls the activate() callback before calling
device\_add\_groups().
Fixes: a7e7a3156300 ("leds: triggers: add device attribute support")
Cc: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
Acked-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Link: [https://lore.kernel.org/r/20240504162533.76780-1-hdegoede@redhat.com](https://lore.kernel.org/r/20240504162533.76780-1-hdegoede%40redhat.com)
Signed-off-by: Lee Jones <lee@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)

| -rw-r--r-- | [drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/leds/led-triggers.c?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/leds/led-triggers.c b/drivers/leds/led-triggers.cindex 6a5e1f41f9a452..4f5829b726a752 100644--- a/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=be50a293ebc619195e6499c9583933233cba251d)+++ b/[drivers/leds/led-triggers.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/leds/led-triggers.c?id=cb8aa9d2a4c8a15d6a43ccf901ef3d094aa60374)@@ -179,9 +179,9 @@ int led\_trigger\_set(struct led\_classdev \*led\_cdev, struct led\_trigger \*trig)  cancel\_work\_sync(&led\_cdev->set\_brightness\_work); led\_stop\_software\_blink(led\_cdev);+ device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); if (led\_cdev->trigger->deactivate) led\_cdev->trigger->deactivate(led\_cdev);- device\_remove\_groups(led\_cdev->dev, led\_cdev->trigger->groups); led\_cdev->trigger = NULL; led\_cdev->trigger\_data = NULL; led\_cdev->activated = false; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 16:54:31 +0000

