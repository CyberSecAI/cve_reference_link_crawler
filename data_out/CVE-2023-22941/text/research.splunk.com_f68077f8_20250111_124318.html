
[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Improperly Formatted Parameter Crashes splunkd

**EXPERIMENTAL DETECTION**

This detection status is set to experimental. The Splunk Threat Research team has not yet fully tested, simulated, or built comprehensive datasets for this detection. As such, this analytic is not officially supported. If you have any questions or concerns, please reach out to us at research@splunk.com.

Updated Date: 2024-10-17
ID: 08978eca-caff-44c1-84dc-53f17def4e14
Author: Chase Franklin, Rod Soto, Splunk
[Type: TTP](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic detects the execution of improperly formatted INGEST\_EVAL parameters in Splunk Enterprise, which can crash the splunkd service. It leverages the Splunk\_Audit.Search\_Activity datamodel to identify ad-hoc searches containing specific keywords. This activity is significant because it can disrupt Splunk operations, leading to potential data loss and service downtime. If confirmed malicious, an attacker could exploit this to cause a denial of service, impacting the availability and reliability of the Splunk environment.

### Search

```
 1
 2| tstats `security_content_summariesonly` count min(_time) as firstTime max(_time)
 3as lastTime from datamodel=Splunk_Audit.Search_Activity where (Search_Activity.search="*makeresults*"AND
 4Search_Activity.search="*ingestpreview*transforms*") Search_Activity.search_type=adhoc
 5Search_Activity.search!="*splunk_improperly_formatted_parameter_crashes_splunkd_filter*"
 6Search_Activity.user!=splunk-system-user by Search_Activity.search, Search_Activity.info,
 7Search_Activity.total_run_time, Search_Activity.user, Search_Activity.search_type
 8
 9| `drop_dm_object_name(Search_Activity)`
10
11| `security_content_ctime(firstTime)`
12
13| `security_content_ctime(lastTime)`
14
15| `splunk_improperly_formatted_parameter_crashes_splunkd_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [security\_content\_ctime](https://github.com/splunk/security_content/blob/develop/macros/security_content_ctime.yml) | `convert timeformat="%Y-%m-%dT%H:%M:%S" ctime($field$)` |
| splunk\_improperly\_formatted\_parameter\_crashes\_splunkd\_filter | `search *` |

`splunk_improperly_formatted_parameter_crashes_splunkd_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1499](https://attack.mitre.org/techniques/T1499/) | Endpoint Denial of Service | Impact |

KillChainPhase.ACTIONS\_ON\_OBJECTIVES

NistCategory.DE\_CM

Cis18Value.CIS\_10

Sandworm Team

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Notable | Yes |
| Rule Title | `%name%` |
| Rule Description | `%description%` |
| Notable Event Fields | user, dest |
| Creates Risk Event | True |

This configuration file applies to all detections of type TTP. These detections will use Risk Based Alerting and generate Notable Events.
### Implementation

Requires access to audittrail and use of Splunk\_Audit.Search\_Activity datamodel.

### Known False Positives

This is a hunting search it should be focused on affected products, otherwise it is likely to produce false positives.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| An attempt to exploit ingest eval parameter was detected from $user$ | 100 | 100 | 100 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://advisory.splunk.com/advisories/SVD-2023-0211>
* <https://advisory.splunk.com/advisories/SVD-2024-1006>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | Not Applicable | N/A | N/A | N/A |
| Unit | â Failing | N/A | `N/A` | `N/A` |
| Integration | â Failing | N/A | `N/A` | `N/A` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_improperly_formatted_parameter_crashes_splunkd.yml) |
Version: **4**

[Detection: Splunk Image File Disclosure via PDF Export in Classic Dashboard](https://research.splunk.com/application/7464e2dc-98a5-4af9-87a1-fa6d5a256fa6/ "Detection: Splunk Image File Disclosure via PDF Export in Classic Dashboard")

[Detection: Splunk Information Disclosure in Splunk Add-on Builder](https://research.splunk.com/application/b7b82980-4a3e-412e-8661-4531d8758735/ "Detection: Splunk Information Disclosure in Splunk Add-on Builder")

Â© 2005 - 2024 Splunk LLC All rights reserved.

