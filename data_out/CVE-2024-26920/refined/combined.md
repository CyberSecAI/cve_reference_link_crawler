=== Content from git.kernel.org_16b3873b_20250111_025423.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=26ebeffff238488466fa578be3b35b8a46e69906)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26ebeffff238488466fa578be3b35b8a46e69906)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26ebeffff238488466fa578be3b35b8a46e69906)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26ebeffff238488466fa578be3b35b8a46e69906)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Siddh Raman Pant <siddh.raman.pant@oracle.com> | 2024-04-18 18:58:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:23:36 +0200 |
| commit | [26ebeffff238488466fa578be3b35b8a46e69906](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26ebeffff238488466fa578be3b35b8a46e69906) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=26ebeffff238488466fa578be3b35b8a46e69906)) | |
| tree | [af457235a2a49ea88c06f8024ffb6bb03108601e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26ebeffff238488466fa578be3b35b8a46e69906) | |
| parent | [5062d1f4f07facbdade0f402d9a04a788f52e26d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5062d1f4f07facbdade0f402d9a04a788f52e26d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26ebeffff238488466fa578be3b35b8a46e69906&id2=5062d1f4f07facbdade0f402d9a04a788f52e26d)) | |
| download | [linux-26ebeffff238488466fa578be3b35b8a46e69906.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-26ebeffff238488466fa578be3b35b8a46e69906.tar.gz) | |

Revert "tracing/trigger: Fix to return error if failed to alloc snapshot"This reverts commit 56cfbe60710772916a5ba092c99542332b48e870 which is
commit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
The change has an incorrect assumption about the return value because
in the current stable trees for versions 5.15 and before, the following
commit responsible for making 0 a success value is not present:
b8cc44a4d3c1 ("tracing: Remove logic for registering multiple event triggers at a time")
The return value should be 0 on failure in the current tree, because in
the functions event\_trigger\_callback() and event\_enable\_trigger\_func(),
we have:
ret = cmd\_ops->reg(glob, trigger\_ops, trigger\_data, file);
/\*
\* The above returns on success the # of functions enabled,
\* but if it didn't find any functions it returns zero.
\* Consider no functions a failure too.
\*/
if (!ret) {
ret = -ENOENT;
Cc: stable@kernel.org # 5.15, 5.10, 5.4, 4.19
Signed-off-by: Siddh Raman Pant <siddh.raman.pant@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26ebeffff238488466fa578be3b35b8a46e69906)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=26ebeffff238488466fa578be3b35b8a46e69906) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 4 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex e4340958da2dfa..4bc90965abb25f 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=5062d1f4f07facbdade0f402d9a04a788f52e26d)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=26ebeffff238488466fa578be3b35b8a46e69906)@@ -1140,10 +1140,8 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- int ret = tracing\_alloc\_snapshot\_instance(file->tr);-- if (ret < 0)- return ret;+ if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)+ return 0;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:00 +0000



=== Content from git.kernel.org_cefaca71_20250111_025426.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=56cfbe60710772916a5ba092c99542332b48e870)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56cfbe60710772916a5ba092c99542332b48e870)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56cfbe60710772916a5ba092c99542332b48e870)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56cfbe60710772916a5ba092c99542332b48e870)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:42:24 +0100 |
| commit | [56cfbe60710772916a5ba092c99542332b48e870](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=56cfbe60710772916a5ba092c99542332b48e870) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=56cfbe60710772916a5ba092c99542332b48e870)) | |
| tree | [50c33b55f9501a4ab1ee87bcbf1520d764b9c7ae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=56cfbe60710772916a5ba092c99542332b48e870) | |
| parent | [6d05659b60ac3887e372497904ab216ec949cbd9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6d05659b60ac3887e372497904ab216ec949cbd9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56cfbe60710772916a5ba092c99542332b48e870&id2=6d05659b60ac3887e372497904ab216ec949cbd9)) | |
| download | [linux-56cfbe60710772916a5ba092c99542332b48e870.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-56cfbe60710772916a5ba092c99542332b48e870.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=56cfbe60710772916a5ba092c99542332b48e870)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=56cfbe60710772916a5ba092c99542332b48e870) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 4bc90965abb25f..e4340958da2dfa 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=6d05659b60ac3887e372497904ab216ec949cbd9)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=56cfbe60710772916a5ba092c99542332b48e870)@@ -1140,8 +1140,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:03 +0000



=== Content from git.kernel.org_51321ec8_20250111_025427.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:24:54 +0100 |
| commit | [6022c065c9ec465d84cebff8f480db083e4ee06b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6022c065c9ec465d84cebff8f480db083e4ee06b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)) | |
| tree | [94641002aa0e576401624b6f632ed3a3dab47ada](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6022c065c9ec465d84cebff8f480db083e4ee06b) | |
| parent | [8b5a4fe3427911b8aad400d53a9b99e751e4972e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8b5a4fe3427911b8aad400d53a9b99e751e4972e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6022c065c9ec465d84cebff8f480db083e4ee06b&id2=8b5a4fe3427911b8aad400d53a9b99e751e4972e)) | |
| download | [linux-6022c065c9ec465d84cebff8f480db083e4ee06b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6022c065c9ec465d84cebff8f480db083e4ee06b.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6022c065c9ec465d84cebff8f480db083e4ee06b)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=6022c065c9ec465d84cebff8f480db083e4ee06b) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 46439e3bcec4d2..b33c3861fbbbf3 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=8b5a4fe3427911b8aad400d53a9b99e751e4972e)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=6022c065c9ec465d84cebff8f480db083e4ee06b)@@ -1470,8 +1470,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:04 +0000



=== Content from git.kernel.org_47ba4887_20250111_025423.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2a3073d58382157ab396734ed4e421ba9e969db1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2a3073d58382157ab396734ed4e421ba9e969db1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2a3073d58382157ab396734ed4e421ba9e969db1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2a3073d58382157ab396734ed4e421ba9e969db1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Siddh Raman Pant <siddh.raman.pant@oracle.com> | 2024-04-18 18:58:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-27 17:05:23 +0200 |
| commit | [2a3073d58382157ab396734ed4e421ba9e969db1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2a3073d58382157ab396734ed4e421ba9e969db1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2a3073d58382157ab396734ed4e421ba9e969db1)) | |
| tree | [07e542f9142a64e5aa65613e566666fd34fe0496](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2a3073d58382157ab396734ed4e421ba9e969db1) | |
| parent | [2df2dd27066cdba8041e46a64362325626bdfb2e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2df2dd27066cdba8041e46a64362325626bdfb2e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2a3073d58382157ab396734ed4e421ba9e969db1&id2=2df2dd27066cdba8041e46a64362325626bdfb2e)) | |
| download | [linux-2a3073d58382157ab396734ed4e421ba9e969db1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2a3073d58382157ab396734ed4e421ba9e969db1.tar.gz) | |

Revert "tracing/trigger: Fix to return error if failed to alloc snapshot"This reverts commit b5085b5ac1d96ea2a8a6240f869655176ce44197 which is
commit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
The change has an incorrect assumption about the return value because
in the current stable trees for versions 5.15 and before, the following
commit responsible for making 0 a success value is not present:
b8cc44a4d3c1 ("tracing: Remove logic for registering multiple event triggers at a time")
The return value should be 0 on failure in the current tree, because in
the functions event\_trigger\_callback() and event\_enable\_trigger\_func(),
we have:
ret = cmd\_ops->reg(glob, trigger\_ops, trigger\_data, file);
/\*
\* The above returns on success the # of functions enabled,
\* but if it didn't find any functions it returns zero.
\* Consider no functions a failure too.
\*/
if (!ret) {
ret = -ENOENT;
Cc: stable@kernel.org # 5.15, 5.10, 5.4, 4.19
Signed-off-by: Siddh Raman Pant <siddh.raman.pant@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2a3073d58382157ab396734ed4e421ba9e969db1)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=2a3073d58382157ab396734ed4e421ba9e969db1) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 4 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex dfdbcf1da216eb..106f9813841a15 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=2df2dd27066cdba8041e46a64362325626bdfb2e)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=2a3073d58382157ab396734ed4e421ba9e969db1)@@ -1161,10 +1161,8 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- int ret = tracing\_alloc\_snapshot\_instance(file->tr);-- if (ret < 0)- return ret;+ if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)+ return 0;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:00 +0000



=== Content from git.kernel.org_1e9b445a_20250111_025429.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:55:03 +0100 |
| commit | [b5085b5ac1d96ea2a8a6240f869655176ce44197](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)) | |
| tree | [eb9a55f59715f018a7e0786b21a4b640f09de84c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197) | |
| parent | [cd459beede7b5d1168d664c2d921aa15a4531666](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cd459beede7b5d1168d664c2d921aa15a4531666) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197&id2=cd459beede7b5d1168d664c2d921aa15a4531666)) | |
| download | [linux-b5085b5ac1d96ea2a8a6240f869655176ce44197.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b5085b5ac1d96ea2a8a6240f869655176ce44197.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=b5085b5ac1d96ea2a8a6240f869655176ce44197) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 106f9813841a15..dfdbcf1da216eb 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=cd459beede7b5d1168d664c2d921aa15a4531666)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=b5085b5ac1d96ea2a8a6240f869655176ce44197)@@ -1161,8 +1161,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:06 +0000



=== Content from git.kernel.org_456fde08_20250111_025425.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:12:32 +0100 |
| commit | [36be97e9eb535fe3008a5cb040b1e56f29f2e398](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)) | |
| tree | [152e59b5763ab9b89f865a5111df05269a892567](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398) | |
| parent | [76a42074d0b8b342f4c1abb0553a64271c5d2bb2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=76a42074d0b8b342f4c1abb0553a64271c5d2bb2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398&id2=76a42074d0b8b342f4c1abb0553a64271c5d2bb2)) | |
| download | [linux-36be97e9eb535fe3008a5cb040b1e56f29f2e398.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-36be97e9eb535fe3008a5cb040b1e56f29f2e398.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 918730d7493251..f941ce01ee351e 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=76a42074d0b8b342f4c1abb0553a64271c5d2bb2)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=36be97e9eb535fe3008a5cb040b1e56f29f2e398)@@ -1455,8 +1455,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:02 +0000



=== Content from git.kernel.org_a335ee10_20250111_025428.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:25:09 +0100 |
| commit | [8ffd5590f4d6ef5460acbeac7fbdff7025f9b419](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)) | |
| tree | [58f845cdc7061fa0766024004b0cd4c10d8f51c0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419) | |
| parent | [a67f1f83f315dc3fe8da491fa04aa4429b52540c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a67f1f83f315dc3fe8da491fa04aa4429b52540c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419&id2=a67f1f83f315dc3fe8da491fa04aa4429b52540c)) | |
| download | [linux-8ffd5590f4d6ef5460acbeac7fbdff7025f9b419.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8ffd5590f4d6ef5460acbeac7fbdff7025f9b419.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 82580f7ffad952..634d120eab2b16 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=a67f1f83f315dc3fe8da491fa04aa4429b52540c)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=8ffd5590f4d6ef5460acbeac7fbdff7025f9b419)@@ -1140,8 +1140,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:05 +0000



=== Content from git.kernel.org_a78abf33_20250111_025425.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:51:29 +0100 |
| commit | [4b001ef14baab16b553a002cb9979e31b8fc0c6b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)) | |
| tree | [894d1c5a8dc70b202ff861ee22546216ca03213d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b) | |
| parent | [204eda8c14a7c29f47f117ed01363432163184aa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=204eda8c14a7c29f47f117ed01363432163184aa) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b&id2=204eda8c14a7c29f47f117ed01363432163184aa)) | |
| download | [linux-4b001ef14baab16b553a002cb9979e31b8fc0c6b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4b001ef14baab16b553a002cb9979e31b8fc0c6b.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 46439e3bcec4d2..b33c3861fbbbf3 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=204eda8c14a7c29f47f117ed01363432163184aa)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=4b001ef14baab16b553a002cb9979e31b8fc0c6b)@@ -1470,8 +1470,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:03 +0000



=== Content from git.kernel.org_26de344f_20250111_025421.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Steven Rostedt (Google) <rostedt@goodmis.org> | 2024-01-26 15:10:24 -0500 |
| commit | [0958b33ef5a04ed91f61cef4760ac412080c4e08](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)) | |
| tree | [ead93b6229779d5ef7035a93c8cfd729b677822c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08) | |
| parent | [834bf76add3e6168038150f162cbccf1fd492a67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=834bf76add3e6168038150f162cbccf1fd492a67) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08&id2=834bf76add3e6168038150f162cbccf1fd492a67)) | |
| download | [linux-0958b33ef5a04ed91f61cef4760ac412080c4e08.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0958b33ef5a04ed91f61cef4760ac412080c4e08.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotFix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=0958b33ef5a04ed91f61cef4760ac412080c4e08) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 46439e3bcec4d2..b33c3861fbbbf3 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=834bf76add3e6168038150f162cbccf1fd492a67)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=0958b33ef5a04ed91f61cef4760ac412080c4e08)@@ -1470,8 +1470,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:52:59 +0000



=== Content from git.kernel.org_39c0cdf8_20250111_025424.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Siddh Raman Pant <siddh.raman.pant@oracle.com> | 2024-04-18 18:58:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:17:09 +0200 |
| commit | [34925d01baf3ee62ab21c21efd9e2c44c24c004a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)) | |
| tree | [18ddfb7a35b42a9f922d268f3200f339f73688ae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a) | |
| parent | [b5808d40093403334d939e2c3c417144d12a6f33](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5808d40093403334d939e2c3c417144d12a6f33) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a&id2=b5808d40093403334d939e2c3c417144d12a6f33)) | |
| download | [linux-34925d01baf3ee62ab21c21efd9e2c44c24c004a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-34925d01baf3ee62ab21c21efd9e2c44c24c004a.tar.gz) | |

Revert "tracing/trigger: Fix to return error if failed to alloc snapshot"This reverts commit bcf4a115a5068f3331fafb8c176c1af0da3d8b19 which is
commit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
The change has an incorrect assumption about the return value because
in the current stable trees for versions 5.15 and before, the following
commit responsible for making 0 a success value is not present:
b8cc44a4d3c1 ("tracing: Remove logic for registering multiple event triggers at a time")
The return value should be 0 on failure in the current tree, because in
the functions event\_trigger\_callback() and event\_enable\_trigger\_func(),
we have:
ret = cmd\_ops->reg(glob, trigger\_ops, trigger\_data, file);
/\*
\* The above returns on success the # of functions enabled,
\* but if it didn't find any functions it returns zero.
\* Consider no functions a failure too.
\*/
if (!ret) {
ret = -ENOENT;
Cc: stable@kernel.org # 5.15, 5.10, 5.4, 4.19
Signed-off-by: Siddh Raman Pant <siddh.raman.pant@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 4 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 8cb4ddb88601b1..4b0bde304ad79c 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=b5808d40093403334d939e2c3c417144d12a6f33)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=34925d01baf3ee62ab21c21efd9e2c44c24c004a)@@ -1133,10 +1133,8 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- int ret = tracing\_alloc\_snapshot\_instance(file->tr);-- if (ret < 0)- return ret;+ if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)+ return 0;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:01 +0000



=== Content from git.kernel.org_6d3d3066_20250111_025422.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Siddh Raman Pant <siddh.raman.pant@oracle.com> | 2024-04-18 18:58:06 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:18:30 +0200 |
| commit | [2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)) | |
| tree | [517b65f0682628eb81f6c2fa95bf6d3ad2686722](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f) | |
| parent | [93eb31e7c3399e326259f2caa17be1e821f5a412](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=93eb31e7c3399e326259f2caa17be1e821f5a412) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f&id2=93eb31e7c3399e326259f2caa17be1e821f5a412)) | |
| download | [linux-2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f.tar.gz) | |

Revert "tracing/trigger: Fix to return error if failed to alloc snapshot"This reverts commit 8ffd5590f4d6ef5460acbeac7fbdff7025f9b419 which is
commit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
The change has an incorrect assumption about the return value because
in the current stable trees for versions 5.15 and before, the following
commit responsible for making 0 a success value is not present:
b8cc44a4d3c1 ("tracing: Remove logic for registering multiple event triggers at a time")
The return value should be 0 on failure in the current tree, because in
the functions event\_trigger\_callback() and event\_enable\_trigger\_func(),
we have:
ret = cmd\_ops->reg(glob, trigger\_ops, trigger\_data, file);
/\*
\* The above returns on success the # of functions enabled,
\* but if it didn't find any functions it returns zero.
\* Consider no functions a failure too.
\*/
if (!ret) {
ret = -ENOENT;
Cc: stable@kernel.org # 5.15, 5.10, 5.4, 4.19
Signed-off-by: Siddh Raman Pant <siddh.raman.pant@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 4 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 634d120eab2b16..82580f7ffad952 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=93eb31e7c3399e326259f2caa17be1e821f5a412)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=2450a69d2ee75d1f0112d509ac82ef98f5ad6b5f)@@ -1140,10 +1140,8 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- int ret = tracing\_alloc\_snapshot\_instance(file->tr);-- if (ret < 0)- return ret;+ if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)+ return 0;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:52:59 +0000



=== Content from git.kernel.org_b3bd8ea4_20250111_025429.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Masami Hiramatsu (Google) <mhiramat@kernel.org> | 2024-01-26 09:42:58 +0900 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 08:12:56 +0100 |
| commit | [bcf4a115a5068f3331fafb8c176c1af0da3d8b19](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)) | |
| tree | [c188c59d664ad0c6dca93a431685830b7f9c54f8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19) | |
| parent | [04b9c13dc116af8ad88b98d6a96765e0fa4a2b23](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=04b9c13dc116af8ad88b98d6a96765e0fa4a2b23) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19&id2=04b9c13dc116af8ad88b98d6a96765e0fa4a2b23)) | |
| download | [linux-bcf4a115a5068f3331fafb8c176c1af0da3d8b19.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bcf4a115a5068f3331fafb8c176c1af0da3d8b19.tar.gz) | |

tracing/trigger: Fix to return error if failed to alloc snapshotcommit 0958b33ef5a04ed91f61cef4760ac412080c4e08 upstream.
Fix register\_snapshot\_trigger() to return error code if it failed to
allocate a snapshot instead of 0 (success). Unless that, it will register
snapshot trigger without an error.
Link: [https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit@devnote2](https://lore.kernel.org/linux-trace-kernel/170622977792.270660.2789298642759362200.stgit%40devnote2)
Fixes: 0bbe7f719985 ("tracing: Fix the race between registering 'snapshot' event trigger and triggering 'snapshot' operation")
Cc: stable@vger.kernel.org
Cc: Vincent Donnefort <vdonnefort@google.com>
Signed-off-by: Masami Hiramatsu (Google) <mhiramat@kernel.org>
Signed-off-by: Steven Rostedt (Google) <rostedt@goodmis.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)

| -rw-r--r-- | [kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/trace/trace_events_trigger.c?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/kernel/trace/trace\_events\_trigger.c b/kernel/trace/trace\_events\_trigger.cindex 4b0bde304ad79c..8cb4ddb88601b1 100644--- a/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=04b9c13dc116af8ad88b98d6a96765e0fa4a2b23)+++ b/[kernel/trace/trace\_events\_trigger.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/trace/trace_events_trigger.c?id=bcf4a115a5068f3331fafb8c176c1af0da3d8b19)@@ -1133,8 +1133,10 @@ register\_snapshot\_trigger(char \*glob, struct event\_trigger\_ops \*ops, struct event\_trigger\_data \*data, struct trace\_event\_file \*file) {- if (tracing\_alloc\_snapshot\_instance(file->tr) != 0)- return 0;+ int ret = tracing\_alloc\_snapshot\_instance(file->tr);++ if (ret < 0)+ return ret;  return register\_trigger(glob, ops, data, file); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 02:53:06 +0000


