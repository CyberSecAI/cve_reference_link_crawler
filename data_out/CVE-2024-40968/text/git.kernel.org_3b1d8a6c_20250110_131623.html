

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Songyang Li <leesongyang@outlook.com> | 2024-03-20 23:22:00 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:00:27 +0200 |
| commit | [6bff05aaa32c2f7e1f6e68e890876642159db419](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6bff05aaa32c2f7e1f6e68e890876642159db419) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)) | |
| tree | [bbfca3ea78029bf4492ed7fc7d524b971f7c4285](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6bff05aaa32c2f7e1f6e68e890876642159db419) | |
| parent | [864a1e64802c2de46fe22b52ca87c5b409042803](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=864a1e64802c2de46fe22b52ca87c5b409042803) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bff05aaa32c2f7e1f6e68e890876642159db419&id2=864a1e64802c2de46fe22b52ca87c5b409042803)) | |
| download | [linux-6bff05aaa32c2f7e1f6e68e890876642159db419.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6bff05aaa32c2f7e1f6e68e890876642159db419.tar.gz) | |

MIPS: Octeon: Add PCIe link status check[ Upstream commit 29b83a64df3b42c88c0338696feb6fdcd7f1f3b7 ]
The standard PCIe configuration read-write interface is used to
access the configuration space of the peripheral PCIe devices
of the mips processor after the PCIe link surprise down, it can
generate kernel panic caused by "Data bus error". So it is
necessary to add PCIe link status check for system protection.
When the PCIe link is down or in training, assigning a value
of 0 to the configuration address can prevent read-write behavior
to the configuration space of peripheral PCIe devices, thereby
preventing kernel panic.
Signed-off-by: Songyang Li <leesongyang@outlook.com>
Signed-off-by: Thomas Bogendoerfer <tsbogend@alpha.franken.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6bff05aaa32c2f7e1f6e68e890876642159db419)

| -rwxr-xr-x[-rw-r--r--] | [arch/mips/pci/pcie-octeon.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/mips/pci/pcie-octeon.c?id=6bff05aaa32c2f7e1f6e68e890876642159db419) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/arch/mips/pci/pcie-octeon.c b/arch/mips/pci/pcie-octeon.cindex d919a0d813a17a..38de2a9c3cf1a0 100644..100755--- a/[arch/mips/pci/pcie-octeon.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/mips/pci/pcie-octeon.c?id=864a1e64802c2de46fe22b52ca87c5b409042803)+++ b/[arch/mips/pci/pcie-octeon.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/mips/pci/pcie-octeon.c?id=6bff05aaa32c2f7e1f6e68e890876642159db419)@@ -230,12 +230,18 @@ static inline uint64\_t \_\_cvmx\_pcie\_build\_config\_addr(int pcie\_port, int bus, { union cvmx\_pcie\_address pcie\_addr; union cvmx\_pciercx\_cfg006 pciercx\_cfg006;+ union cvmx\_pciercx\_cfg032 pciercx\_cfg032;  pciercx\_cfg006.u32 = cvmx\_pcie\_cfgx\_read(pcie\_port, CVMX\_PCIERCX\_CFG006(pcie\_port)); if ((bus <= pciercx\_cfg006.s.pbnum) && (dev != 0)) return 0; + pciercx\_cfg032.u32 =+ cvmx\_pcie\_cfgx\_read(pcie\_port, CVMX\_PCIERCX\_CFG032(pcie\_port));+ if ((pciercx\_cfg032.s.dlla == 0) || (pciercx\_cfg032.s.lt == 1))+ return 0;+ pcie\_addr.u64 = 0; pcie\_addr.config.upper = 2; pcie\_addr.config.io = 1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:15:00 +0000

