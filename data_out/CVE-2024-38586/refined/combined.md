=== Content from git.kernel.org_0c0cb252_20250110_224438.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-05 09:12:44 +0200 |
| commit | [61c1c98e2607120ce9c3fa1bf75e6da909712b27](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)) | |
| tree | [0a874ead11185e2c705dd417fd6b8d3616f247fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27) | |
| parent | [5c88f4f6341cfc7cc65e08d8e6e38b3df8004f4c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5c88f4f6341cfc7cc65e08d8e6e38b3df8004f4c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27&id2=5c88f4f6341cfc7cc65e08d8e6e38b3df8004f4c)) | |
| download | [linux-61c1c98e2607120ce9c3fa1bf75e6da909712b27.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-61c1c98e2607120ce9c3fa1bf75e6da909712b27.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.[ Upstream commit c71e3a5cffd5309d7f84444df03d5b72600cc417 ]
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex dd4404efdb8d61..d24eb5ee152a57 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=5c88f4f6341cfc7cc65e08d8e6e38b3df8004f4c)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=61c1c98e2607120ce9c3fa1bf75e6da909712b27)@@ -4278,11 +4278,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4305,6 +4305,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:16 +0000



=== Content from git.kernel.org_6228ec54_20250110_224439.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:11:19 +0200 |
| commit | [68222d7b4b72aa321135cd453dac37f00ec41fd1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)) | |
| tree | [370e35fffa8f25c445db43ace39b87c627e941a0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1) | |
| parent | [766e3bacc7f970c6d3c4dd7ebf739df40fdc08c2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=766e3bacc7f970c6d3c4dd7ebf739df40fdc08c2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1&id2=766e3bacc7f970c6d3c4dd7ebf739df40fdc08c2)) | |
| download | [linux-68222d7b4b72aa321135cd453dac37f00ec41fd1.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-68222d7b4b72aa321135cd453dac37f00ec41fd1.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.commit c71e3a5cffd5309d7f84444df03d5b72600cc417 upstream.
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=68222d7b4b72aa321135cd453dac37f00ec41fd1) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex c43a8a6792ede8..d759f3373b1754 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=766e3bacc7f970c6d3c4dd7ebf739df40fdc08c2)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=68222d7b4b72aa321135cd453dac37f00ec41fd1)@@ -4246,11 +4246,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4273,6 +4273,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:16 +0000



=== Content from git.kernel.org_0457b3ae_20250110_224437.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0c48185a95309556725f818b82120bb74e9c627d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0c48185a95309556725f818b82120bb74e9c627d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c48185a95309556725f818b82120bb74e9c627d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c48185a95309556725f818b82120bb74e9c627d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-12 11:02:56 +0200 |
| commit | [0c48185a95309556725f818b82120bb74e9c627d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0c48185a95309556725f818b82120bb74e9c627d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0c48185a95309556725f818b82120bb74e9c627d)) | |
| tree | [b75f45cb68116624a0451fb191b661da1fa57368](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0c48185a95309556725f818b82120bb74e9c627d) | |
| parent | [69ed8fc12bf9e1d0595f22eafb4ed81db1cdd98d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69ed8fc12bf9e1d0595f22eafb4ed81db1cdd98d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c48185a95309556725f818b82120bb74e9c627d&id2=69ed8fc12bf9e1d0595f22eafb4ed81db1cdd98d)) | |
| download | [linux-0c48185a95309556725f818b82120bb74e9c627d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0c48185a95309556725f818b82120bb74e9c627d.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.commit c71e3a5cffd5309d7f84444df03d5b72600cc417 upstream.
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0c48185a95309556725f818b82120bb74e9c627d)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=0c48185a95309556725f818b82120bb74e9c627d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex 2ce4bffa373fbc..f83bd15f9e994e 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=69ed8fc12bf9e1d0595f22eafb4ed81db1cdd98d)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=0c48185a95309556725f818b82120bb74e9c627d)@@ -4263,11 +4263,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4290,6 +4290,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:14 +0000



=== Content from git.kernel.org_880be260_20250110_224438.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:44:00 +0200 |
| commit | [54e7a0d111240c92c0f02ceba6eb8f26bf6d6479](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)) | |
| tree | [7eeaca6b4271e71735a681a46edd08cdff2ed781](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479) | |
| parent | [00f31813567db6016c5d6bb89deeb05aa2cee2a9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00f31813567db6016c5d6bb89deeb05aa2cee2a9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479&id2=00f31813567db6016c5d6bb89deeb05aa2cee2a9)) | |
| download | [linux-54e7a0d111240c92c0f02ceba6eb8f26bf6d6479.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-54e7a0d111240c92c0f02ceba6eb8f26bf6d6479.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.commit c71e3a5cffd5309d7f84444df03d5b72600cc417 upstream.
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex 69606c8081a33b..7df2017c9a8d6c 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=00f31813567db6016c5d6bb89deeb05aa2cee2a9)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=54e7a0d111240c92c0f02ceba6eb8f26bf6d6479)@@ -4335,11 +4335,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4362,6 +4362,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:15 +0000



=== Content from git.kernel.org_7d340ea4_20250110_224440.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:39:12 +0200 |
| commit | [b6d21cf40de103d63ae78551098a7c06af8c98dd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)) | |
| tree | [1aaa1df44e990d6219654e527d4499afba127cbf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd) | |
| parent | [528a620c1397a6fa329e9d62ee0d49898e31b4f6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=528a620c1397a6fa329e9d62ee0d49898e31b4f6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd&id2=528a620c1397a6fa329e9d62ee0d49898e31b4f6)) | |
| download | [linux-b6d21cf40de103d63ae78551098a7c06af8c98dd.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b6d21cf40de103d63ae78551098a7c06af8c98dd.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.commit c71e3a5cffd5309d7f84444df03d5b72600cc417 upstream.
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=b6d21cf40de103d63ae78551098a7c06af8c98dd) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex ea13412db64543..76d820c4e6eef4 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=528a620c1397a6fa329e9d62ee0d49898e31b4f6)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=b6d21cf40de103d63ae78551098a7c06af8c98dd)@@ -4273,11 +4273,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4300,6 +4300,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:17 +0000



=== Content from git.kernel.org_68e480bc_20250110_224436.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-30 09:48:42 +0200 |
| commit | [078d5b7500d70af2de6b38e226b03f0b932026a6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=078d5b7500d70af2de6b38e226b03f0b932026a6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)) | |
| tree | [04a60cc2587d0a06144796b8ab969cd1c513c725](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=078d5b7500d70af2de6b38e226b03f0b932026a6) | |
| parent | [962b0326ea63e76349185a5e9768dcb0a5f77365](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=962b0326ea63e76349185a5e9768dcb0a5f77365) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=078d5b7500d70af2de6b38e226b03f0b932026a6&id2=962b0326ea63e76349185a5e9768dcb0a5f77365)) | |
| download | [linux-078d5b7500d70af2de6b38e226b03f0b932026a6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-078d5b7500d70af2de6b38e226b03f0b932026a6.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.commit c71e3a5cffd5309d7f84444df03d5b72600cc417 upstream.
An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=078d5b7500d70af2de6b38e226b03f0b932026a6)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=078d5b7500d70af2de6b38e226b03f0b932026a6) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex 97b1fe71905f03..70d0b32395cdea 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=962b0326ea63e76349185a5e9768dcb0a5f77365)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=078d5b7500d70af2de6b38e226b03f0b932026a6)@@ -4221,11 +4221,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4248,6 +4248,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:14 +0000



=== Content from git.kernel.org_3e8ba8de_20250110_224440.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-05-23 15:45:32 +0200 |
| commit | [c71e3a5cffd5309d7f84444df03d5b72600cc417](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)) | |
| tree | [db28cb32550f6e6f436ebb215cc495079400ff48](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) | |
| parent | [3d8597d8d7d9b3faffe0f2361032123ee6c09c02](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d8597d8d7d9b3faffe0f2361032123ee6c09c02) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417&id2=3d8597d8d7d9b3faffe0f2361032123ee6c09c02)) | |
| download | [linux-c71e3a5cffd5309d7f84444df03d5b72600cc417.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c71e3a5cffd5309d7f84444df03d5b72600cc417.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex 86a6d4225bc20e..9b0ef00b99d62c 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=3d8597d8d7d9b3faffe0f2361032123ee6c09c02)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)@@ -4337,11 +4337,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4364,6 +4364,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:18 +0000


