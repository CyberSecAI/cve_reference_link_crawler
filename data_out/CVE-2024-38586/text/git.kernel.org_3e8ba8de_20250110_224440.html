

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ken Milmore <ken.milmore@gmail.com> | 2024-05-21 23:45:50 +0100 |
| --- | --- | --- |
| committer | Paolo Abeni <pabeni@redhat.com> | 2024-05-23 15:45:32 +0200 |
| commit | [c71e3a5cffd5309d7f84444df03d5b72600cc417](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)) | |
| tree | [db28cb32550f6e6f436ebb215cc495079400ff48](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) | |
| parent | [3d8597d8d7d9b3faffe0f2361032123ee6c09c02](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3d8597d8d7d9b3faffe0f2361032123ee6c09c02) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417&id2=3d8597d8d7d9b3faffe0f2361032123ee6c09c02)) | |
| download | [linux-c71e3a5cffd5309d7f84444df03d5b72600cc417.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c71e3a5cffd5309d7f84444df03d5b72600cc417.tar.gz) | |

r8169: Fix possible ring buffer corruption on fragmented Tx packets.An issue was found on the RTL8125b when transmitting small fragmented
packets, whereby invalid entries were inserted into the transmit ring
buffer, subsequently leading to calls to dma\_unmap\_single() with a null
address.
This was caused by rtl8169\_start\_xmit() not noticing changes to nr\_frags
which may occur when small packets are padded (to work around hardware
quirks) in rtl8169\_tso\_csum\_v2().
To fix this, postpone inspecting nr\_frags until after any padding has been
applied.
Fixes: 9020845fb5d6 ("r8169: improve rtl8169\_start\_xmit")
Cc: stable@vger.kernel.org
Signed-off-by: Ken Milmore <ken.milmore@gmail.com>
Reviewed-by: Heiner Kallweit <hkallweit1@gmail.com>
Link: [https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95@gmail.com](https://lore.kernel.org/r/27ead18b-c23d-4f49-a020-1fc482c5ac95%40gmail.com)
Signed-off-by: Paolo Abeni <pabeni@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)

| -rw-r--r-- | [drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/realtek/r8169_main.c?id=c71e3a5cffd5309d7f84444df03d5b72600cc417) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 1 deletions

| diff --git a/drivers/net/ethernet/realtek/r8169\_main.c b/drivers/net/ethernet/realtek/r8169\_main.cindex 86a6d4225bc20e..9b0ef00b99d62c 100644--- a/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=3d8597d8d7d9b3faffe0f2361032123ee6c09c02)+++ b/[drivers/net/ethernet/realtek/r8169\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/realtek/r8169_main.c?id=c71e3a5cffd5309d7f84444df03d5b72600cc417)@@ -4337,11 +4337,11 @@ static void rtl8169\_doorbell(struct rtl8169\_private \*tp) static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb, struct net\_device \*dev) {- unsigned int frags = skb\_shinfo(skb)->nr\_frags; struct rtl8169\_private \*tp = netdev\_priv(dev); unsigned int entry = tp->cur\_tx % NUM\_TX\_DESC; struct TxDesc \*txd\_first, \*txd\_last; bool stop\_queue, door\_bell;+ unsigned int frags; u32 opts[2];  if (unlikely(!rtl\_tx\_slots\_avail(tp))) {@@ -4364,6 +4364,7 @@ static netdev\_tx\_t rtl8169\_start\_xmit(struct sk\_buff \*skb,  txd\_first = tp->TxDescArray + entry; + frags = skb\_shinfo(skb)->nr\_frags; if (frags) { if (rtl8169\_xmit\_frags(tp, skb, opts, entry)) goto err\_dma\_1; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:43:18 +0000

