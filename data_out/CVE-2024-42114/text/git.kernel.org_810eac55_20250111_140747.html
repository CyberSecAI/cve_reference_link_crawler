

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Eric Dumazet <edumazet@google.com> | 2024-06-15 16:08:00 +0000 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-06-26 10:23:30 +0200 |
| commit | [d1cba2ea8121e7fdbe1328cea782876b1dd80993](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)) | |
| tree | [5c81beaa1a55c565dbbf12652bd2a9d8f56deaa4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993) | |
| parent | [14f89946b6b383e617657a1e81fe6bf520ce86d5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14f89946b6b383e617657a1e81fe6bf520ce86d5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993&id2=14f89946b6b383e617657a1e81fe6bf520ce86d5)) | |
| download | [linux-d1cba2ea8121e7fdbe1328cea782876b1dd80993.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d1cba2ea8121e7fdbe1328cea782876b1dd80993.tar.gz) | |

wifi: cfg80211: restrict NL80211\_ATTR\_TXQ\_QUANTUM valuessyzbot is able to trigger softlockups, setting NL80211\_ATTR\_TXQ\_QUANTUM
to 2^31.
We had a similar issue in sch\_fq, fixed with commit
d9e15a273306 ("pkt\_sched: fq: do not accept silly TCA\_FQ\_QUANTUM")
watchdog: BUG: soft lockup - CPU#1 stuck for 26s! [kworker/1:0:24]
Modules linked in:
irq event stamp: 131135
hardirqs last enabled at (131134): [<ffff80008ae8778c>] \_\_exit\_to\_kernel\_mode arch/arm64/kernel/entry-common.c:85 [inline]
hardirqs last enabled at (131134): [<ffff80008ae8778c>] exit\_to\_kernel\_mode+0xdc/0x10c arch/arm64/kernel/entry-common.c:95
hardirqs last disabled at (131135): [<ffff80008ae85378>] \_\_el1\_irq arch/arm64/kernel/entry-common.c:533 [inline]
hardirqs last disabled at (131135): [<ffff80008ae85378>] el1\_interrupt+0x24/0x68 arch/arm64/kernel/entry-common.c:551
softirqs last enabled at (125892): [<ffff80008907e82c>] neigh\_hh\_init net/core/neighbour.c:1538 [inline]
softirqs last enabled at (125892): [<ffff80008907e82c>] neigh\_resolve\_output+0x268/0x658 net/core/neighbour.c:1553
softirqs last disabled at (125896): [<ffff80008904166c>] local\_bh\_disable+0x10/0x34 include/linux/bottom\_half.h:19
CPU: 1 PID: 24 Comm: kworker/1:0 Not tainted 6.9.0-rc7-syzkaller-gfda5695d692c #0
Hardware name: Google Google Compute Engine/Google Compute Engine, BIOS Google 03/27/2024
Workqueue: mld mld\_ifc\_work
pstate: 80400005 (Nzcv daif +PAN -UAO -TCO -DIT -SSBS BTYPE=--)
pc : \_\_list\_del include/linux/list.h:195 [inline]
pc : \_\_list\_del\_entry include/linux/list.h:218 [inline]
pc : list\_move\_tail include/linux/list.h:310 [inline]
pc : fq\_tin\_dequeue include/net/fq\_impl.h:112 [inline]
pc : ieee80211\_tx\_dequeue+0x6b8/0x3b4c net/mac80211/tx.c:3854
lr : \_\_list\_del\_entry include/linux/list.h:218 [inline]
lr : list\_move\_tail include/linux/list.h:310 [inline]
lr : fq\_tin\_dequeue include/net/fq\_impl.h:112 [inline]
lr : ieee80211\_tx\_dequeue+0x67c/0x3b4c net/mac80211/tx.c:3854
sp : ffff800093d36700
x29: ffff800093d36a60 x28: ffff800093d36960 x27: dfff800000000000
x26: ffff0000d800ad50 x25: ffff0000d800abe0 x24: ffff0000d800abf0
x23: ffff0000e0032468 x22: ffff0000e00324d4 x21: ffff0000d800abf0
x20: ffff0000d800abf8 x19: ffff0000d800abf0 x18: ffff800093d363c0
x17: 000000000000d476 x16: ffff8000805519dc x15: ffff7000127a6cc8
x14: 1ffff000127a6cc8 x13: 0000000000000004 x12: ffffffffffffffff
x11: ffff7000127a6cc8 x10: 0000000000ff0100 x9 : 0000000000000000
x8 : 0000000000000000 x7 : 0000000000000000 x6 : 0000000000000000
x5 : ffff80009287aa08 x4 : 0000000000000008 x3 : ffff80008034c7fc
x2 : ffff0000e0032468 x1 : 00000000da0e46b8 x0 : ffff0000e0032470
Call trace:
\_\_list\_del include/linux/list.h:195 [inline]
\_\_list\_del\_entry include/linux/list.h:218 [inline]
list\_move\_tail include/linux/list.h:310 [inline]
fq\_tin\_dequeue include/net/fq\_impl.h:112 [inline]
ieee80211\_tx\_dequeue+0x6b8/0x3b4c net/mac80211/tx.c:3854
wake\_tx\_push\_queue net/mac80211/util.c:294 [inline]
ieee80211\_handle\_wake\_tx\_queue+0x118/0x274 net/mac80211/util.c:315
drv\_wake\_tx\_queue net/mac80211/driver-ops.h:1350 [inline]
schedule\_and\_wake\_txq net/mac80211/driver-ops.h:1357 [inline]
ieee80211\_queue\_skb+0x18e8/0x2244 net/mac80211/tx.c:1664
ieee80211\_tx+0x260/0x400 net/mac80211/tx.c:1966
ieee80211\_xmit+0x278/0x354 net/mac80211/tx.c:2062
\_\_ieee80211\_subif\_start\_xmit+0xab8/0x122c net/mac80211/tx.c:4338
ieee80211\_subif\_start\_xmit+0xe0/0x438 net/mac80211/tx.c:4532
\_\_netdev\_start\_xmit include/linux/netdevice.h:4903 [inline]
netdev\_start\_xmit include/linux/netdevice.h:4917 [inline]
xmit\_one net/core/dev.c:3531 [inline]
dev\_hard\_start\_xmit+0x27c/0x938 net/core/dev.c:3547
\_\_dev\_queue\_xmit+0x1678/0x33fc net/core/dev.c:4341
dev\_queue\_xmit include/linux/netdevice.h:3091 [inline]
neigh\_resolve\_output+0x558/0x658 net/core/neighbour.c:1563
neigh\_output include/net/neighbour.h:542 [inline]
ip6\_finish\_output2+0x104c/0x1ee8 net/ipv6/ip6\_output.c:137
ip6\_finish\_output+0x428/0x7a0 net/ipv6/ip6\_output.c:222
NF\_HOOK\_COND include/linux/netfilter.h:303 [inline]
ip6\_output+0x270/0x594 net/ipv6/ip6\_output.c:243
dst\_output include/net/dst.h:450 [inline]
NF\_HOOK+0x160/0x4f0 include/linux/netfilter.h:314
mld\_sendpack+0x7b4/0x10f4 net/ipv6/mcast.c:1818
mld\_send\_cr net/ipv6/mcast.c:2119 [inline]
mld\_ifc\_work+0x840/0xd0c net/ipv6/mcast.c:2650
process\_one\_work+0x7b8/0x15d4 kernel/workqueue.c:3267
process\_scheduled\_works kernel/workqueue.c:3348 [inline]
worker\_thread+0x938/0xef4 kernel/workqueue.c:3429
kthread+0x288/0x310 kernel/kthread.c:388
ret\_from\_fork+0x10/0x20 arch/arm64/kernel/entry.S:860
Fixes: 52539ca89f36 ("cfg80211: Expose TXQ stats and parameters to userspace")
Signed-off-by: Eric Dumazet <edumazet@google.com>
Link: [https://patch.msgid.link/20240615160800.250667-1-edumazet@google.com](https://patch.msgid.link/20240615160800.250667-1-edumazet%40google.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)

| -rw-r--r-- | [net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/wireless/nl80211.c?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/net/wireless/nl80211.c b/net/wireless/nl80211.cindex 3c0bca4238d357..72c7bf55858166 100644--- a/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=14f89946b6b383e617657a1e81fe6bf520ce86d5)+++ b/[net/wireless/nl80211.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/wireless/nl80211.c?id=d1cba2ea8121e7fdbe1328cea782876b1dd80993)@@ -468,6 +468,10 @@ static const struct netlink\_range\_validation nl80211\_punct\_bitmap\_range = { .max = 0xffff, }; +static const struct netlink\_range\_validation q\_range = {+ .max = INT\_MAX,+};+ static const struct nla\_policy nl80211\_policy[NUM\_NL80211\_ATTR] = { [0] = { .strict\_start\_type = NL80211\_ATTR\_HE\_OBSS\_PD }, [NL80211\_ATTR\_WIPHY] = { .type = NLA\_U32 },@@ -754,7 +758,7 @@ static const struct nla\_policy nl80211\_policy[NUM\_NL80211\_ATTR] = {  [NL80211\_ATTR\_TXQ\_LIMIT] = { .type = NLA\_U32 }, [NL80211\_ATTR\_TXQ\_MEMORY\_LIMIT] = { .type = NLA\_U32 },- [NL80211\_ATTR\_TXQ\_QUANTUM] = { .type = NLA\_U32 },+ [NL80211\_ATTR\_TXQ\_QUANTUM] = NLA\_POLICY\_FULL\_RANGE(NLA\_U32, &q\_range), [NL80211\_ATTR\_HE\_CAPABILITY] = NLA\_POLICY\_VALIDATE\_FN(NLA\_BINARY, validate\_he\_capa, NL80211\_HE\_MAX\_CAPABILITY\_LEN), |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 14:06:24 +0000

