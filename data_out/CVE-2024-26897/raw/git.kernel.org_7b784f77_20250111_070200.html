<!DOCTYPE html>
<html lang='en'>
<head>
<title>wifi: ath9k: delay all of ath9k_wmi_event_tasklet() until init is complete - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='f8ff4b4df71e87f609be0cc37d92e918107f9b90'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='f8ff4b4df71e87f609be0cc37d92e918107f9b90'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='f8ff4b4df71e87f609be0cc37d92e918107f9b90'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Toke Høiland-Jørgensen &lt;toke@redhat.com&gt;</td><td class='right'>2024-01-26 15:02:17 +0100</td></tr>
<tr><th>committer</th><td>Sasha Levin &lt;sashal@kernel.org&gt;</td><td class='right'>2024-03-26 18:21:17 -0400</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>f8ff4b4df71e87f609be0cc37d92e918107f9b90</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>d5cd2190115b2506c9c3ad8fd4aafe78a6c2cfc1</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4287534cb520435d6a4920d6597d2f5ec3dcc650'>4287534cb520435d6a4920d6597d2f5ec3dcc650</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90&amp;id2=4287534cb520435d6a4920d6597d2f5ec3dcc650'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f8ff4b4df71e87f609be0cc37d92e918107f9b90.tar.gz'>linux-f8ff4b4df71e87f609be0cc37d92e918107f9b90.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>wifi: ath9k: delay all of ath9k_wmi_event_tasklet() until init is complete</div><div class='commit-msg'>[ Upstream commit 24355fcb0d4cbcb6ddda262596558e8cfba70f11 ]

The ath9k_wmi_event_tasklet() used in ath9k_htc assumes that all the data
structures have been fully initialised by the time it runs. However, because of
the order in which things are initialised, this is not guaranteed to be the
case, because the device is exposed to the USB subsystem before the ath9k driver
initialisation is completed.

We already committed a partial fix for this in commit:
8b3046abc99e ("ath9k_htc: fix NULL pointer dereference at ath9k_htc_tx_get_packet()")

However, that commit only aborted the WMI_TXSTATUS_EVENTID command in the event
tasklet, pairing it with an "initialisation complete" bit in the TX struct. It
seems syzbot managed to trigger the race for one of the other commands as well,
so let's just move the existing synchronisation bit to cover the whole
tasklet (setting it at the end of ath9k_htc_probe_device() instead of inside
ath9k_tx_init()).

Link: <a href="https://lore.kernel.org/r/ed1d2c66-1193-4c81-9542-d514c29ba8b8.bugreport@ubisectech.com">https://lore.kernel.org/r/ed1d2c66-1193-4c81-9542-d514c29ba8b8.bugreport@ubisectech.com</a>
Fixes: 8b3046abc99e ("ath9k_htc: fix NULL pointer dereference at ath9k_htc_tx_get_packet()")
Reported-by: Ubisectech Sirius &lt;bugreport@ubisectech.com&gt;
Signed-off-by: Toke Høiland-Jørgensen &lt;toke@redhat.com&gt;
Signed-off-by: Kalle Valo &lt;quic_kvalo@quicinc.com&gt;
Link: <a href="https://msgid.link/20240126140218.1033443-1-toke@toke.dk">https://msgid.link/20240126140218.1033443-1-toke@toke.dk</a>
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath9k/htc.h?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc.h</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='10%'><tr><td class='add' style='width: 10.0%;'/><td class='rem' style='width: 10.0%;'/><td class='none' style='width: 80.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath9k/htc_drv_init.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc_drv_init.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='10%'><tr><td class='add' style='width: 40.0%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 60.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath9k/htc_drv_txrx.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc_drv_txrx.c</a></td><td class='right'>4</td><td class='graph'><table summary='file diffstat' width='10%'><tr><td class='add' style='width: 0.0%;'/><td class='rem' style='width: 40.0%;'/><td class='none' style='width: 60.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/ath/ath9k/wmi.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/wmi.c</a></td><td class='right'>10</td><td class='graph'><table summary='file diffstat' width='10%'><tr><td class='add' style='width: 60.0%;'/><td class='rem' style='width: 40.0%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>4 files changed, 11 insertions, 9 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/wireless/ath/ath9k/htc.h b/drivers/net/wireless/ath/ath9k/htc.h<br/>index 237f4ec2cffd7b..6c33e898b30006 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc.h?id=4287534cb520435d6a4920d6597d2f5ec3dcc650'>drivers/net/wireless/ath/ath9k/htc.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc.h?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc.h</a></div><div class='hunk'>@@ -306,7 +306,6 @@ struct ath9k_htc_tx {</div><div class='ctx'> 	DECLARE_BITMAP(tx_slot, MAX_TX_BUF_NUM);</div><div class='ctx'> 	struct timer_list cleanup_timer;</div><div class='ctx'> 	spinlock_t tx_lock;</div><div class='del'>-	bool initialized;</div><div class='ctx'> };</div><div class='ctx'> </div><div class='ctx'> struct ath9k_htc_tx_ctl {</div><div class='hunk'>@@ -515,6 +514,7 @@ struct ath9k_htc_priv {</div><div class='ctx'> 	unsigned long ps_usecount;</div><div class='ctx'> 	bool ps_enabled;</div><div class='ctx'> 	bool ps_idle;</div><div class='add'>+	bool initialized;</div><div class='ctx'> </div><div class='ctx'> #ifdef CONFIG_MAC80211_LEDS</div><div class='ctx'> 	enum led_brightness brightness;</div><div class='head'>diff --git a/drivers/net/wireless/ath/ath9k/htc_drv_init.c b/drivers/net/wireless/ath/ath9k/htc_drv_init.c<br/>index 96a3185a96d750..b014185373f340 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc_drv_init.c?id=4287534cb520435d6a4920d6597d2f5ec3dcc650'>drivers/net/wireless/ath/ath9k/htc_drv_init.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc_drv_init.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc_drv_init.c</a></div><div class='hunk'>@@ -966,6 +966,10 @@ int ath9k_htc_probe_device(struct htc_target *htc_handle, struct device *dev,</div><div class='ctx'> </div><div class='ctx'> 	htc_handle-&gt;drv_priv = priv;</div><div class='ctx'> </div><div class='add'>+	/* Allow ath9k_wmi_event_tasklet() to operate. */</div><div class='add'>+	smp_wmb();</div><div class='add'>+	priv-&gt;initialized = true;</div><div class='add'>+</div><div class='ctx'> 	return 0;</div><div class='ctx'> </div><div class='ctx'> err_init:</div><div class='head'>diff --git a/drivers/net/wireless/ath/ath9k/htc_drv_txrx.c b/drivers/net/wireless/ath/ath9k/htc_drv_txrx.c<br/>index d6a3f001dacb98..2fdd27885f5437 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc_drv_txrx.c?id=4287534cb520435d6a4920d6597d2f5ec3dcc650'>drivers/net/wireless/ath/ath9k/htc_drv_txrx.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/htc_drv_txrx.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/htc_drv_txrx.c</a></div><div class='hunk'>@@ -815,10 +815,6 @@ int ath9k_tx_init(struct ath9k_htc_priv *priv)</div><div class='ctx'> 	skb_queue_head_init(&amp;priv-&gt;tx.data_vo_queue);</div><div class='ctx'> 	skb_queue_head_init(&amp;priv-&gt;tx.tx_failed);</div><div class='ctx'> </div><div class='del'>-	/* Allow ath9k_wmi_event_tasklet(WMI_TXSTATUS_EVENTID) to operate. */</div><div class='del'>-	smp_wmb();</div><div class='del'>-	priv-&gt;tx.initialized = true;</div><div class='del'>-</div><div class='ctx'> 	return 0;</div><div class='ctx'> }</div><div class='ctx'> </div><div class='head'>diff --git a/drivers/net/wireless/ath/ath9k/wmi.c b/drivers/net/wireless/ath/ath9k/wmi.c<br/>index 1476b42b52a915..805ad31edba2ba 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/wmi.c?id=4287534cb520435d6a4920d6597d2f5ec3dcc650'>drivers/net/wireless/ath/ath9k/wmi.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/ath/ath9k/wmi.c?id=f8ff4b4df71e87f609be0cc37d92e918107f9b90'>drivers/net/wireless/ath/ath9k/wmi.c</a></div><div class='hunk'>@@ -155,6 +155,12 @@ void ath9k_wmi_event_tasklet(struct tasklet_struct *t)</div><div class='ctx'> 		}</div><div class='ctx'> 		spin_unlock_irqrestore(&amp;wmi-&gt;wmi_lock, flags);</div><div class='ctx'> </div><div class='add'>+		/* Check if ath9k_htc_probe_device() completed. */</div><div class='add'>+		if (!data_race(priv-&gt;initialized)) {</div><div class='add'>+			kfree_skb(skb);</div><div class='add'>+			continue;</div><div class='add'>+		}</div><div class='add'>+</div><div class='ctx'> 		hdr = (struct wmi_cmd_hdr *) skb-&gt;data;</div><div class='ctx'> 		cmd_id = be16_to_cpu(hdr-&gt;command_id);</div><div class='ctx'> 		wmi_event = skb_pull(skb, sizeof(struct wmi_cmd_hdr));</div><div class='hunk'>@@ -169,10 +175,6 @@ void ath9k_wmi_event_tasklet(struct tasklet_struct *t)</div><div class='ctx'> 					     &amp;wmi-&gt;drv_priv-&gt;fatal_work);</div><div class='ctx'> 			break;</div><div class='ctx'> 		case WMI_TXSTATUS_EVENTID:</div><div class='del'>-			/* Check if ath9k_tx_init() completed. */</div><div class='del'>-			if (!data_race(priv-&gt;tx.initialized))</div><div class='del'>-				break;</div><div class='del'>-</div><div class='ctx'> 			spin_lock_bh(&amp;priv-&gt;tx.tx_lock);</div><div class='ctx'> 			if (priv-&gt;tx.flags &amp; ATH9K_HTC_OP_TX_DRAIN) {</div><div class='ctx'> 				spin_unlock_bh(&amp;priv-&gt;tx.tx_lock);</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 07:00:37 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
