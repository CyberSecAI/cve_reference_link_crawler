
Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview.php%3Fid%3D34432)
[Signup for a new account](/bugs/signup_page.php)

#### View Issue Details

[Wiki](wiki.php?id=34432)[Related Changesets](#changesets)[Jump to Notes](#bugnotes)

|  | | | | | |
| --- | --- | --- | --- | --- | --- |
| ID | Project | Category | View Status | Date Submitted | Last Update |
| --- | --- | --- | --- | --- | --- |
| 0034432 | mantisbt | security | public | 2024-05-04 10:44 | 2024-05-12 15:39 |
|  | | | | | |
|
| Reporter | [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928) | Assigned To | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) |  | |
| Priority | normal | Severity | major | Reproducibility | always |
| Status | closed | Resolution | fixed |  | |
| Product Version | 2.26.1 |  | | | |
| Target Version | 2.26.2 | Fixed in Version | 2.26.2 |  | |
|  | | | | | |
|
| Summary | 0034432: CVE-2024-34081: Unsanitised custom field names printed | | | | |
| Description | Improper escaping of a custom field's name allows an attacker to inject HTML and, if CSP settings permit, achieve execution of arbitrary JavaScript when:   * resolving or closing issues (bug\_change\_status\_page.php) belonging to a project linking said custom field * viewing issues (view\_all\_bug\_page.php) when the custom field is displayed as a column * printing issues (print\_all\_bug\_page.php) when the custom field is displayed as a column   <https://github.com/mantisbt/mantisbt/security/advisories/GHSA-wgx7-jp56-65mq> | | | | |
| Steps To Reproduce | Create a custom field with some html in its name. Create an issue with this custom field. View the issue (view.php). In the status list, choose resolved or closed and click on the "Change Status To:" button. The html in the custom field name is rendered (bug\_change\_status\_page.php) | | | | |
| Additional Information | To fix:  bug\_change\_status\_page.php line 306:  ``` <?php echo lang_get_defaulted( $t_def['name'] ) ?> ```  change to:  ``` <?php echo string_attribute( lang_get_defaulted( $t_def['name'] ) ) ?> ```  similar to [0027304](/bugs/view.php?id=27304 "[closed] CVE-2020-25830: HTML Injection in bug_actiongroup_page.php") | | | | |
| Tags | No tags attached. | | | | |
|  | | | | | |
|

#### Relationships

[Relationship Graph](bug_relationship_graph.php?bug_id=34432&graph=relation)[Dependency Graph](bug_relationship_graph.php?bug_id=34432&graph=dependency)

| related to | [0027304](view.php?id=27304) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | CVE-2020-25830: HTML Injection in bug\_actiongroup\_page.php |
| --- | --- | --- | --- | --- |
| related to | [0034441](view.php?id=34441) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Excel error when opening exported issues with custom field with special characters |
| related to | [0034442](view.php?id=34442) | closed | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) | Wrong display of some column titles on "View Issues" page |

#### Activities

| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-05-04 13:49  developer    [~0068884](view.php?id=34432#c68884 "Direct link to note")  Last edited: 2024-05-04 14:33 | I started some tests with such kind of custom fields. "View Issues" and "Print Reports" pages are also affected. |
| --- | --- |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 06:20  developer    [~0068896](view.php?id=34432#c68896 "Direct link to note") | [@unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928) Thanks for the report.   * Please confirm that your Github username is <https://github.com/unboundeduniverse> and if not tell us what it is. * Would you like to be credited for the finding ? If so, please tell us how.   [@atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111) Where do you stand on this issue ? Is your testing completed ? Are you working on a patch or should I do it ?  For now I have opened Advisory [GHSA-wgx7-jp56-65mq](https://github.com/mantisbt/mantisbt/security/advisories/GHSA-wgx7-jp56-65mq) and requested a CVE ID. |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-05-06 11:12  developer    [~0068904](view.php?id=34432#c68904 "Direct link to note")  Last edited: 2024-05-06 11:17 | [@dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) my testing is completed.  I had also a short look at the code, and found that we don't use only `string_attribute` for custom field names, but also `string_display line`. This should be harmonized to use always `string_attribute` as we don't want valid html tags to be interpreted. e. g. with standard settings of `$g_html_valid_tags_single_line`, `<i>custom field name` will be italic on "View Issue Details" and some other pages. We can treat this as a separate issue, or fix it as part of this issue.  Please create a temporary private fork for the security advisory you created. After that, I could start working on a patch and create a PR.  If you want to have a very quick fix to get out 2.26.2 ASAP in combination with other security related fixes, it would be better if you start working on it. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 12:17  developer    [~0068905](view.php?id=34432#c68905 "Direct link to note") | OK I will create the private fork.  I also don't mind patching the security issue so we can release a hotfix ASAP if you have no time. I was just asking first, to avoid both of us making the same changes simultaneously.  Just making sure I have not missed anything you may have found in your tests, here is what I have identified:   * [bug\_change\_status\_page.php](https://github.com/mantisbt/mantisbt/blob/60f1bf1d49d8b8a43ef6009ad2de9fa97fcb0cf3/bug_change_status_page.php#L306) * [view\_all\_bug\_page.php & print\_all\_bug\_page.php](https://github.com/mantisbt/mantisbt/blob/60f1bf1d49d8b8a43ef6009ad2de9fa97fcb0cf3/core/print_api.php#L1347)   we don't use only string\_attribute for custom field names, but also string\_display line. This should be harmonized to use always string\_attribute as we don't want valid html tags to be interpreted.  Right.  ``` $ git grep "string_display_line.*def.*name" bug_report_page.php:655:                                        <?php echo string_display_line( lang_get_defaulted( $t_def['name'] ) ) ?> bug_report_page.php:657:                        <?php } else { echo string_display_line( lang_get_defaulted( $t_def['name'] ) ); } ?> bug_update_page.php:718:                echo '<span>', string_display_line( lang_get_defaulted( $t_def['name'] ) ), '</span>'; bug_view_inc.php:653:           echo '<th class="bug-custom-field category">', string_display_line( lang_get_defaulted( $t_def['name'] ) ), '</th>'; core/filter_form_api.php:2085:                          $t_field_name = string_display_line( lang_get_defaulted( column_get_custom_field_name( $t_sort ) ) ); core/filter_form_api.php:2119:                  $t_field_name = string_display_line( lang_get_defaulted( column_get_custom_field_name( $t_column ) ) ); core/filter_form_api.php:2831:                          $t_header = $get_field_header( 'custom_field_' . $t_cfdef['id'] . '_filter', string_display_line( lang_get_defaulted( $t_cfdef['name'] ) ) ); print_all_bug_page_word.php:396:                <?php echo string_display_line( sprintf( lang_get( 'label' ), lang_get_defaulted( $t_def['name'] ) ) ) ?> ```  Any others ? |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-05-06 12:44  developer    [~0068906](view.php?id=34432#c68906 "Direct link to note") | Concerning  view\_all\_bug\_page.php & print\_all\_bug\_page.php  Wouldn't it be better to fix it on a lower level where the values are finally printed? I thought about a change in `print_link` Something like attached i34432.patch   [i34432.patch](file_download.php?file_id=12602&type=bug) (1,990 bytes)    ``` From b7abf7a490019cbf6767eb79145a5fa2a4c1a138 Mon Sep 17 00:00:00 2001 From: Roland Becker <roland@atrol.de> Date: Mon, 6 May 2024 17:36:50 +0200 Subject: [PATCH] Sanitize custom field names before printing  Fixes #34432 ---  bug_change_status_page.php | 2 +-  core/print_api.php         | 9 +++++----  2 files changed, 6 insertions(+), 5 deletions(-)  diff --git a/bug_change_status_page.php b/bug_change_status_page.php index 427850389..a771f2d6c 100644 --- a/bug_change_status_page.php +++ b/bug_change_status_page.php @@ -303,7 +303,7 @@ layout_page_begin();  	<tr>  		<th class="category">  			<?php if( $t_require && $t_has_write_access ) {?><span class="required">*</span><?php } ?> -			<?php echo lang_get_defaulted( $t_def['name'] ) ?> +			<?php echo string_attribute( lang_get_defaulted( $t_def['name'] ) ) ?>  		</th>  		<td>  <?php diff --git a/core/print_api.php b/core/print_api.php index c52bc3bf8..d7ec8947b 100644 --- a/core/print_api.php +++ b/core/print_api.php @@ -1492,17 +1492,18 @@ function print_bracket_link_prepared( $p_link ) {   * @return void   */  function print_link( $p_link, $p_url_text, $p_new_window = false, $p_class = '' ) { +	$t_url_text = string_attribute( $p_url_text );  	if( is_blank( $p_link ) ) { -		echo $p_url_text; +		echo $t_url_text;  	} else {  		$t_link = htmlspecialchars( $p_link );  		if( $p_new_window === true ) { -			echo '<a class="new-window ' . $p_class . '" href="' . $t_link . '" target="_blank">' . $p_url_text . '</a>'; +			echo '<a class="new-window ' . $p_class . '" href="' . $t_link . '" target="_blank">' . $t_url_text . '</a>';  		} else {  			if( $p_class !== '' ) { -				echo '<a class="' . $p_class . '" href="' . $t_link . '">' . $p_url_text . '</a>'; +				echo '<a class="' . $p_class . '" href="' . $t_link . '">' . $t_url_text . '</a>';  			} else { -				echo '<a href="' . $t_link . '">' . $p_url_text . '</a>'; +				echo '<a href="' . $t_link . '">' . $t_url_text . '</a>';  			}  		}  	} --  2.39.1.windows.1   ```   [i34432.patch](file_download.php?file_id=12602&type=bug) (1,990 bytes) |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 13:00  developer    [~0068907](view.php?id=34432#c68907 "Direct link to note") | Wouldn't it be better to fix it on a lower level where the values are finally printed?  You're probably right.  I was concerned about those usages where print\_link() is already given an escaped string, in which case we would get double encoding, e.g. `&amp;lt;script&amp;gt;` instead of `&lt;script&gt;` for `<script>`.  But there are only 11 occurrences of print\_link() calls so it should be quick to find and fix them if needed. |
|  | |
| [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)   [atrol](https://mantisbt.org/bugs/view_user_page.php?id=11111)  2024-05-06 13:17  developer    [~0068908](view.php?id=34432#c68908 "Direct link to note") | I also don't mind patching the security issue so we can release a hotfix ASAP if you have no time.  Would be good if you could patch. I am on travel starting tomorrow very early in the morning. If needed, I could review / test not earlier than Wednesday evening. |
|  | |
| [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)   [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)  2024-05-06 14:57  reporter    [~0068909](view.php?id=34432#c68909 "Direct link to note") | Yes that is my Github username. No need for credit. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 17:50  developer    [~0068910](view.php?id=34432#c68910 "Direct link to note") | Thanks for the feedback [@unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928). I have added you to the draft Advisory, so you can access the private repository with the fix. |
|  | |
| [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)   [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)  2024-05-07 10:33  reporter    [~0068917](view.php?id=34432#c68917 "Direct link to note") | Just to add a bit of info: if the custom field is set to be required on update then it will appear for all status options when changing status, not just resolved and closed. This doesn't change the fix - it looks ok. |
|  | |
| [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)   [unboundeduniverse](https://mantisbt.org/bugs/view_user_page.php?id=80928)  2024-05-10 07:15  reporter    [~0068923](view.php?id=34432#c68923 "Direct link to note") | They also should be sanitised in the excel export. Name a custom field as Custom <Field 1 Do an excel export which includes it in the columns. Excel can't open the file because of errors.  excel\_api.php line 102: return '<Cell><Data ss:Type="String">' . $p\_column\_title . '</Data></Cell>';  change it to: return excel\_prepare\_string( $p\_column\_title ); |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-10 08:39  developer    [~0068924](view.php?id=34432#c68924 "Direct link to note")  Last edited: 2024-05-12 07:00 | Right, good point. I didn't bother testing Excel export as I was focused on HTML injection which is not applicable in this context. Will fix.  Follow-up in [0034441](/bugs/view.php?id=34441 "[closed] Excel error when opening exported issues with custom field with special characters") |
|  | |

#### Related Changesets

| MantisBT: master-2.26 447a521a  2024-05-06 13:04  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) [Details](/bugs/plugin.php?page=Source/view&id=27070) [Diff](https://github.com/mantisbt/mantisbt/commit/447a521aae0f82f791b8116a14a20e276df739be) | Proper escaping of Custom Field name for display | | Affected Issues[0034432](/bugs/view.php?id=34432 "[closed] CVE-2024-34081: Unsanitised custom field names printed"), [0034442](/bugs/view.php?id=34442 "[closed] Wrong display of some column titles on \"View Issues\" page") |
| --- | --- | --- | --- |
| mod - bug\_change\_status\_page.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/447a521aae0f82f791b8116a14a20e276df739be) [File](https://github.com/mantisbt/mantisbt/blob/447a521aae0f82f791b8116a14a20e276df739be/bug_change_status_page.php) |
| mod - core/print\_api.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/447a521aae0f82f791b8116a14a20e276df739be) [File](https://github.com/mantisbt/mantisbt/blob/447a521aae0f82f791b8116a14a20e276df739be/core/print_api.php) |

**Powered by [MantisBT 2.28.0-dev-master-a94bae75d](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.1691 seconds

