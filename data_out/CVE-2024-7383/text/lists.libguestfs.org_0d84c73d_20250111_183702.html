

[Libguestfs List Archives](/archives/)

* [Sign In](/accounts/login/?next=/archives/list/guestfs%40lists.libguestfs.org/message/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/)
* [Sign Up](/accounts/signup/?next=/archives/list/guestfs%40lists.libguestfs.org/message/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/)

* [Sign In](/accounts/login/?next=/archives/list/guestfs%40lists.libguestfs.org/message/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/)
* [Sign Up](/accounts/signup/?next=/archives/list/guestfs%40lists.libguestfs.org/message/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/)

* [Manage this list](/admin/lists/guestfs.lists.libguestfs.org/)

### [2025](#collapse0)

* [January](/archives/list/guestfs%40lists.libguestfs.org/2025/1/)

### [2024](#collapse1)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2024/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2024/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2024/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2024/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2024/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2024/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2024/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2024/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2024/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2024/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2024/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2024/1/)

### [2023](#collapse2)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2023/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2023/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2023/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2023/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2023/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2023/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2023/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2023/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2023/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2023/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2023/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2023/1/)

### [2022](#collapse3)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2022/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2022/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2022/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2022/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2022/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2022/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2022/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2022/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2022/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2022/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2022/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2022/1/)

### [2021](#collapse4)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2021/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2021/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2021/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2021/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2021/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2021/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2021/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2021/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2021/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2021/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2021/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2021/1/)

### [2020](#collapse5)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2020/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2020/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2020/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2020/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2020/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2020/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2020/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2020/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2020/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2020/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2020/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2020/1/)

### [2019](#collapse6)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2019/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2019/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2019/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2019/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2019/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2019/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2019/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2019/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2019/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2019/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2019/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2019/1/)

### [2018](#collapse7)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2018/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2018/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2018/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2018/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2018/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2018/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2018/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2018/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2018/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2018/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2018/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2018/1/)

### [2017](#collapse8)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2017/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2017/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2017/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2017/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2017/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2017/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2017/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2017/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2017/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2017/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2017/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2017/1/)

### [2016](#collapse9)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2016/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2016/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2016/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2016/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2016/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2016/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2016/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2016/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2016/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2016/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2016/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2016/1/)

### [2015](#collapse10)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2015/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2015/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2015/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2015/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2015/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2015/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2015/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2015/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2015/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2015/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2015/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2015/1/)

### [2014](#collapse11)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2014/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2014/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2014/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2014/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2014/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2014/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2014/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2014/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2014/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2014/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2014/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2014/1/)

### [2013](#collapse12)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2013/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2013/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2013/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2013/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2013/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2013/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2013/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2013/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2013/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2013/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2013/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2013/1/)

### [2012](#collapse13)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2012/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2012/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2012/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2012/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2012/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2012/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2012/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2012/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2012/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2012/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2012/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2012/1/)

### [2011](#collapse14)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2011/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2011/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2011/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2011/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2011/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2011/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2011/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2011/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2011/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2011/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2011/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2011/1/)

### [2010](#collapse15)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2010/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2010/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2010/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2010/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2010/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2010/7/)
* [June](/archives/list/guestfs%40lists.libguestfs.org/2010/6/)
* [May](/archives/list/guestfs%40lists.libguestfs.org/2010/5/)
* [April](/archives/list/guestfs%40lists.libguestfs.org/2010/4/)
* [March](/archives/list/guestfs%40lists.libguestfs.org/2010/3/)
* [February](/archives/list/guestfs%40lists.libguestfs.org/2010/2/)
* [January](/archives/list/guestfs%40lists.libguestfs.org/2010/1/)

### [2009](#collapse16)

* [December](/archives/list/guestfs%40lists.libguestfs.org/2009/12/)
* [November](/archives/list/guestfs%40lists.libguestfs.org/2009/11/)
* [October](/archives/list/guestfs%40lists.libguestfs.org/2009/10/)
* [September](/archives/list/guestfs%40lists.libguestfs.org/2009/9/)
* [August](/archives/list/guestfs%40lists.libguestfs.org/2009/8/)
* [July](/archives/list/guestfs%40lists.libguestfs.org/2009/7/)

[List overview](/archives/list/guestfs%40lists.libguestfs.org/)

[Download](/archives/list/guestfs%40lists.libguestfs.org/export/guestfs%40lists.libguestfs.org-LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2.mbox.gz?message=LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2 "This message in gzipped mbox format")

[thread](/archives/list/guestfs%40lists.libguestfs.org/thread/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/#LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2)

# [Libguestfs] libnbd security: multiple flaws in TLS server certificate checking

![](https://seccdn.libravatar.org/avatar/99139fc25c1786999b46d7147da2239c.jpg?s=120&r=g&d=retro)

[Richard W.M. Jones](/archives/users/205115991903935591871292069893681333704/ "See the profile for Richard W.M. Jones")

Tuesday, 25 June
2024

Tue, 25 Jun
'24

11:52 a.m.

Jon Szymaniak contacted us to tell us that libnbd client did not
always correctly verify the NBD server's certificate when using TLS to
connect to an NBD server. This would allow a man-in-the-middle attack
on NBD traffic. After investigation we found several separate problems:
(1) If you don't specify a certificates directory (eg. with
nbd\_set\_tls\_certificates or the URI ?tls-certificates=DIR parameter)
then libnbd will use the system's Certificate Authority (CA). However
because of a logic flaw this would cause server certificate checking
to be skipped.
Resolution:
[https://gitlab.com/nbdkit/libnbd/-/commit/87ef41b69929d5d293390ec36b1c10a...](https://gitlab.com/nbdkit/libnbd/-/commit/87ef41b69929d5d293390ec36b1c10aba2c9a57a)
(2) If libnbd doesn't know the server's hostname (eg. because you are
connecting over a Unix domain socket, or directly to a pre-opened
socket), then all certificate checking was skipped. In this case it
should still be possible to check that the CA was correct, but the CA
information was ignored.
Resolution:
[https://gitlab.com/nbdkit/libnbd/-/commit/6ed47a27d14f6f11946bb096d94e5bf...](https://gitlab.com/nbdkit/libnbd/-/commit/6ed47a27d14f6f11946bb096d94e5bf21d97083d)
(3) There was a lack of testing of this.
Resolution:
Tests have been added upstream and in CI.
While investigating Daniel P. Berrange pointed out these additional flaws:
(4) On very old platforms (eg. RHEL 7) GnuTLS lacks the
gnutls\_session\_set\_verify\_cert API that we use to check peer
certificates, and we silently skipped the check entirely. We feel it
is safer to disable TLS entirely for these platforms. Attempts to use
TLS will give an error.
Resolution:
[https://gitlab.com/nbdkit/libnbd/-/commit/5ff09cdbbd19226dd2d5015d76134f8...](https://gitlab.com/nbdkit/libnbd/-/commit/5ff09cdbbd19226dd2d5015d76134f88dee9321e)
(5) There is no way to set the TLS hostname of the server separate
from the name of the server that we are connecting to. If we are
connecting to the ultimate server through a proxy then this means that
we cannot verify the name of the server in the certificate presented
by the server. Also if using a pre-opened socket this allows the
server hostname to be supplied by some out of band means.
Resolution:
Add new nbd\_set\_tls\_hostname and nbd\_get\_tls\_hostname APIs:
[https://gitlab.com/nbdkit/libnbd/-/commit/7a45b5db68c59cc620ba328f0ebec1e...](https://gitlab.com/nbdkit/libnbd/-/commit/7a45b5db68c59cc620ba328f0ebec1e7058cd95a)
Allow ?tls-hostname=HOSTNAME parameter to be added to NBD URIs:
[https://gitlab.com/nbdkit/libnbd/-/commit/e62185645c4d1a833d40aa79f3fee4e...](https://gitlab.com/nbdkit/libnbd/-/commit/e62185645c4d1a833d40aa79f3fee4ed477827c2)
Fixes will be available in these versions of libnbd:
- 1.21.1 (development)
- 1.20.2 (stable)
- 1.18.5 (stable)
Rich.
--
Richard Jones, Virtualization Group, Red Hat <http://people.redhat.com/~rjones>
Read my programming and virtualization blog: <http://rwmj.wordpress.com>
virt-builder quickly builds VMs from scratch
<http://libguestfs.org/virt-builder.1.html>

[0](#like "You must be logged-in to vote.") /
[0](#dislike "You must be logged-in to vote.")

Reply

[Back to the thread](/archives/list/guestfs%40lists.libguestfs.org/thread/LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2/#LHR3BW6RJ7K4BJBQIYV3GTZLSY27VZO2)

[Back to the list](/archives/list/guestfs%40lists.libguestfs.org/)

Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.1.5.

