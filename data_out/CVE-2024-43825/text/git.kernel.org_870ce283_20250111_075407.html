

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=31ff8464ef540785344994986a010031410f9ff3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31ff8464ef540785344994986a010031410f9ff3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31ff8464ef540785344994986a010031410f9ff3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31ff8464ef540785344994986a010031410f9ff3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chenyuan Yang <chenyuan0y@gmail.com> | 2024-04-30 15:44:53 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:53:55 +0200 |
| commit | [31ff8464ef540785344994986a010031410f9ff3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=31ff8464ef540785344994986a010031410f9ff3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=31ff8464ef540785344994986a010031410f9ff3)) | |
| tree | [939a43c00d99ccd0982a81a4ead2f49ae122fa21](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=31ff8464ef540785344994986a010031410f9ff3) | |
| parent | [0cd55c6e6d90c28c2fa6e7302bf583515daa21e8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0cd55c6e6d90c28c2fa6e7302bf583515daa21e8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31ff8464ef540785344994986a010031410f9ff3&id2=0cd55c6e6d90c28c2fa6e7302bf583515daa21e8)) | |
| download | [linux-31ff8464ef540785344994986a010031410f9ff3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-31ff8464ef540785344994986a010031410f9ff3.tar.gz) | |

iio: Fix the sorting functionality in iio\_gts\_build\_avail\_time\_table[ Upstream commit 5acc3f971a01be48d5ff4252d8f9cdb87998cdfb ]
The sorting in iio\_gts\_build\_avail\_time\_table is not working as intended.
It could result in an out-of-bounds access when the time is zero.
Here are more details:
1. When the gts->itime\_table[i].time\_us is zero, e.g., the time
sequence is `3, 0, 1`, the inner for-loop will not terminate and do
out-of-bound writes. This is because once `times[j] > new`, the value
`new` will be added in the current position and the `times[j]` will be
moved to `j+1` position, which makes the if-condition always hold.
Meanwhile, idx will be added one, making the loop keep running without
termination and out-of-bound write.
2. If none of the gts->itime\_table[i].time\_us is zero, the elements
will just be copied without being sorted as described in the comment
"Sort times from all tables to one and remove duplicates".
For more details, please refer to
https://lore.kernel.org/all/6dd0d822-046c-4dd2-9532-79d7ab96ec05@gmail.com.
Reported-by: Chenyuan Yang <chenyuan0y@gmail.com>
Suggested-by: Matti Vaittinen <mazziesaccount@gmail.com>
Fixes: 38416c28e168 ("iio: light: Add gain-time-scale helpers")
Signed-off-by: Chenyuan Yang <chenyuan0y@gmail.com>
Co-developed-by: Matti Vaittinen <mazziesaccount@gmail.com>
Signed-off-by: Matti Vaittinen <mazziesaccount@gmail.com>
Link: [https://lore.kernel.org/r/d501ade8c1f7b202d34c6404eda423489cab1df5.1714480171.git.mazziesaccount@gmail.com](https://lore.kernel.org/r/d501ade8c1f7b202d34c6404eda423489cab1df5.1714480171.git.mazziesaccount%40gmail.com)
Signed-off-by: Jonathan Cameron <Jonathan.Cameron@huawei.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=31ff8464ef540785344994986a010031410f9ff3)

| -rw-r--r-- | [drivers/iio/industrialio-gts-helper.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/iio/industrialio-gts-helper.c?id=31ff8464ef540785344994986a010031410f9ff3) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 2 deletions

| diff --git a/drivers/iio/industrialio-gts-helper.c b/drivers/iio/industrialio-gts-helper.cindex b51eb6cb766f3f..59d7615c0f565c 100644--- a/[drivers/iio/industrialio-gts-helper.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/industrialio-gts-helper.c?id=0cd55c6e6d90c28c2fa6e7302bf583515daa21e8)+++ b/[drivers/iio/industrialio-gts-helper.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/iio/industrialio-gts-helper.c?id=31ff8464ef540785344994986a010031410f9ff3)@@ -362,17 +362,20 @@ static int iio\_gts\_build\_avail\_time\_table(struct iio\_gts \*gts) for (i = gts->num\_itime - 1; i >= 0; i--) { int new = gts->itime\_table[i].time\_us; - if (times[idx] < new) {+ if (idx == 0 || times[idx - 1] < new) { times[idx++] = new; continue; } - for (j = 0; j <= idx; j++) {+ for (j = 0; j < idx; j++) {+ if (times[j] == new)+ break; if (times[j] > new) { memmove(&times[j + 1], &times[j], (idx - j) \* sizeof(int)); times[j] = new; idx++;+ break; } } } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 07:52:45 +0000

