=== Content from github.com_e41efe46_20250110_134402.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fsecurity%2Fadvisories%2FGHSA-jfww-q346-r2r8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fsecurity%2Fadvisories%2FGHSA-jfww-q346-r2r8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=bareos%2Fbareos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bareos](/bareos)
/
**[bareos](/bareos/bareos)**
Public

* [Notifications](/login?return_to=%2Fbareos%2Fbareos) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fbareos%2Fbareos)
* [Star
   1k](/login?return_to=%2Fbareos%2Fbareos)

* [Code](/bareos/bareos)
* [Issues
  46](/bareos/bareos/issues)
* [Pull requests
  29](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects
  0](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

Additional navigation options

* [Code](/bareos/bareos)
* [Issues](/bareos/bareos/issues)
* [Pull requests](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

# Negative command ACLs can be circumvented by abbreviating commands

High

[pstorz](/pstorz)
published
GHSA-jfww-q346-r2r8
Sep 10, 2024

## Package

bareos-director

## Affected versions

>= 23.0.0, < 23.0.4
>= 22.0.0, < 22.1.6
< 21.1.11

## Patched versions

23.0.4
22.1.6
21.1.11

## Description

### Impact

When a command ACL is in place and a user executes a command in bconsole using an abbreviation (i.e. "w" for "whoami") the ACL check did not apply to the full form (i.e. "whoami") but to the abbreviated form (i.e. "w"). If the command ACL is configured with negative ACL that should forbid using the "whoami" command, you could still use "w" or "who" as a command successfully.

Users of Bareos that use command ACLs with Bareos version 23 prior to 23.0.4, version 22 prior to 22.1.6, version 21 prior to 21.1.11 and any older version may be affected if command ACLs are used.

### Patches

Fixes for the problem are shipped in Bareos versions 23.0.4, 22.1.6 and 21.1.11.

### Workarounds

If only positive command ACLs are used without any negation, the problem does not occur.

### References

[WebUI Profile Resource Configuration](https://docs.bareos.org/IntroductionAndTutorial/BareosWebui.html#configuration-of-profile-resources)

[Command ACL documentation](https://docs.bareos.org/Configuration/Director.html#config-Dir_Profile_CommandAcl)

[Pull request containing the fix](https://github.com/bareos/bareos/pull/1875)

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-45044

### Weaknesses

[CWE-20](/advisories?query=cwe%3A20)

### Credits

* [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
  [joergsteffens](/joergsteffens)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_231c24c6_20250110_134402.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fpull%2F1875)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fpull%2F1875)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=bareos%2Fbareos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bareos](/bareos)
/
**[bareos](/bareos/bareos)**
Public

* [Notifications](/login?return_to=%2Fbareos%2Fbareos) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fbareos%2Fbareos)
* [Star
   1k](/login?return_to=%2Fbareos%2Fbareos)

* [Code](/bareos/bareos)
* [Issues
  46](/bareos/bareos/issues)
* [Pull requests
  29](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects
  0](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

Additional navigation options

* [Code](/bareos/bareos)
* [Issues](/bareos/bareos/issues)
* [Pull requests](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fbareos%2Fbareos%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fbareos%2Fbareos%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix multiple ACL handling bugs #1875

 Merged

[BareosBot](/BareosBot)
merged 23 commits into
[bareos:master](/bareos/bareos/tree/master "bareos/bareos:master")
from
[joergsteffens:dev/joergs/master/acl-fix](/joergsteffens/bareos/tree/dev/joergs/master/acl-fix "joergsteffens/bareos:dev/joergs/master/acl-fix")

Jul 12, 2024

 Merged

# [Fix multiple ACL handling bugs](#top) #1875

[BareosBot](/BareosBot)
merged 23 commits into
[bareos:master](/bareos/bareos/tree/master "bareos/bareos:master")
from
[joergsteffens:dev/joergs/master/acl-fix](/joergsteffens/bareos/tree/dev/joergs/master/acl-fix "joergsteffens/bareos:dev/joergs/master/acl-fix")

Jul 12, 2024

[Conversation
23](/bareos/bareos/pull/1875)
[Commits
23](/bareos/bareos/pull/1875/commits)
[Checks
0](/bareos/bareos/pull/1875/checks)
[Files changed](/bareos/bareos/pull/1875/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=60&v=4)](/joergsteffens)

Copy link

Member

### @joergsteffens **[joergsteffens](/joergsteffens)** commented [Jul 1, 2024](#issue-2384509874) • edited Loading

ACL handling for commands have been wrong.

The UA detect a command, if all typed chars matches the start of a

command string. E.g. "w" => "whoami", ".cons" => ".consoles", ...

The ACL check also only used the typed part of the command,

so if your ACL denies the command ".consoles",

you could execute it with ".cons" (or ".co").

Now we check with the full command string against the ACL.

Fix handling ACL profiles

When using negative ACLs (ACLs starting with '!')

profiles could have overwritten this entries,

as the code did not distringuish between negative ACL and not found.

Now the ACL checking can have three states:

positive match found,

negative match found,

no match found.

Also unifies the ACL checking

and adding the ACL directive `!*all*`

to deny all (before a regex must be used (`!.*`).

#### Please check

* Short description and the purpose of this PR is present *above this paragraph*
* Your name is present in the AUTHORS file (optional)

If you have any questions or problems, please give a comment in the PR.

### Helpful documentation and best practices

* [Git Workflow](https://docs.bareos.org/DeveloperGuide/gitworkflow.html)
* [Automatic Sourcecode Formatting](https://docs.bareos.org/DeveloperGuide/generaldevel.html#automatic-sourcecode-formatting)
* [Check your commit messages](https://docs.bareos.org/DeveloperGuide/gitworkflow.html#commits)
* [Boy Scout Rule](https://docs.bareos.org/DeveloperGuide/generaldevel.html#boy-scout-rule)

### Checklist for the *reviewer* of the PR (will be processed by the Bareos team)

Make sure you check/merge the PR using `devtools/pr-tool` to have some simple automated checks run and a proper changelog record added.

##### General

* Is the PR title usable as CHANGELOG entry?
* Purpose of the PR is understood
* Commit descriptions are understandable and well formatted
* Required backport PRs have been created
* Correct milestone is set

##### Source code quality

* Source code changes are understandable
* Variable and function names are meaningful
* Code comments are correct (logically and spelling)
* Required documentation changes are present and part of the PR

##### Tests

* Decision taken that a test is required (if not, then remove this paragraph)
* The choice of the type of test (unit test or systemtest) is reasonable
* Testname matches exactly what is being tested
* On a fail, output of the test leads quickly to the origin of the fault

Sorry, something went wrong.

All reactions

[![@arogge](https://avatars.githubusercontent.com/u/22479968?s=40&v=4)](/arogge)
[arogge](/arogge)
assigned [joergsteffens](/joergsteffens)
[Jul 2, 2024](#event-13363678755)

[![@arogge](https://avatars.githubusercontent.com/u/22479968?s=40&v=4)](/arogge)
[arogge](/arogge)
added
the
[bugfix](/bareos/bareos/labels/bugfix)
label
[Jul 2, 2024](#event-13363724971)

 [![@arogge](https://avatars.githubusercontent.com/u/22479968?s=40&v=4)](/arogge)
[arogge](/arogge)
requested a review
from [sebsura](/sebsura)
[July 2, 2024 10:30](#event-13363745195)

[![@arogge](https://avatars.githubusercontent.com/u/22479968?s=40&v=4)](/arogge)
[arogge](/arogge)
added
[requires backport to 21](/bareos/bareos/labels/requires%20backport%20to%2021)
[requires backport to 22](/bareos/bareos/labels/requires%20backport%20to%2022)
[requires backport to 23](/bareos/bareos/labels/requires%20backport%20to%2023)
labels
[Jul 2, 2024](#event-13363779084)

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
[force-pushed](/bareos/bareos/compare/8500660eb1e436ccff7bcff9cd9155333ad15f79..587c4c07fb20dfaba3c30fa012457b82890a1f99)
the
dev/joergs/master/acl-fix

branch
from
[`8500660`](/bareos/bareos/commit/8500660eb1e436ccff7bcff9cd9155333ad15f79) to
[`587c4c0`](/bareos/bareos/commit/587c4c07fb20dfaba3c30fa012457b82890a1f99)  [Compare](/bareos/bareos/compare/8500660eb1e436ccff7bcff9cd9155333ad15f79..587c4c07fb20dfaba3c30fa012457b82890a1f99)
[July 2, 2024 13:26](#event-13366171708)

[![sebsura](https://avatars.githubusercontent.com/u/124262655?s=60&v=4)](/sebsura)

**[sebsura](/sebsura)**
requested changes
[Jul 8, 2024](#pullrequestreview-2153945641)

 [View reviewed changes](/bareos/bareos/pull/1875/files)

Copy link

Contributor

### @sebsura **[sebsura](/sebsura)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Nice changes! I found some issues that i would like to see fixed.

Sorry, something went wrong.

All reactions

[core/src/dird/ua\_acl.cc](/bareos/bareos/pull/1875/files#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_acl.cc](/bareos/bareos/pull/1875/files#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_acl.cc](/bareos/bareos/pull/1875/files#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_acl.cc](/bareos/bareos/pull/1875/files#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_cmds.cc](/bareos/bareos/pull/1875/files#diff-8fe96011cf6f2e7490e42e829d974cfb7d8519160ffc34607fc20b6606392e5a)
Outdated

Show resolved

Hide resolved

[systemtests/tests/python-bareos/test\_acl.py](/bareos/bareos/pull/1875/files#diff-49c3a685ec77fa81330d09b1c9e5c4ff4e8abd7403981ddfbc87a942335d7fa4)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_acl.cc](/bareos/bareos/pull/1875/files#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
Outdated

Show resolved

Hide resolved

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
[force-pushed](/bareos/bareos/compare/b37a33dc6af8831483c2af8be9e865449fc89452..07b29354bab45cb76f606c4f03bc3b1a369bcf94)
the
dev/joergs/master/acl-fix

branch
from
[`b37a33d`](/bareos/bareos/commit/b37a33dc6af8831483c2af8be9e865449fc89452) to
[`07b2935`](/bareos/bareos/commit/07b29354bab45cb76f606c4f03bc3b1a369bcf94)  [Compare](/bareos/bareos/compare/b37a33dc6af8831483c2af8be9e865449fc89452..07b29354bab45cb76f606c4f03bc3b1a369bcf94)
[July 9, 2024 15:52](#event-13442644415)

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
requested a review
from [sebsura](/sebsura)
[July 9, 2024 15:53](#event-13442654664)

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
mentioned this pull request
[Jul 10, 2024](#ref-pullrequest-2380858202)

[Update ReaR documentation
#1871](/bareos/bareos/pull/1871)
 Merged

11 tasks

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=80&v=4)](/joergsteffens)

Copy link

Member

Author

### **[joergsteffens](/joergsteffens)** commented [Jul 10, 2024](#issuecomment-2221555814)

| The test `config-syntax-crash` will now fail, as the Director will now produce a proper config error on invalid ACLs, instead of just ignoring them as before. The test have been introduced because of <https://bugs.bareos.org/view.php?id=1175>, leading to [#410](https://github.com/bareos/bareos/pull/410). [@arogge](https://github.com/arogge) do you remember, if there is anything more to this test? Otherwise I replaced the test with a small extra python-bareos test. |
| --- |

All reactions

Sorry, something went wrong.

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
[force-pushed](/bareos/bareos/compare/78f3e2ff9db53e19bdc2c39303b73c46bef19c45..ba910ad077585dba969c271ea77e3284660d0e6e)
the
dev/joergs/master/acl-fix

branch
4 times, most recently
from
[`78f3e2f`](/bareos/bareos/commit/78f3e2ff9db53e19bdc2c39303b73c46bef19c45) to
[`ba910ad`](/bareos/bareos/commit/ba910ad077585dba969c271ea77e3284660d0e6e)  [Compare](/bareos/bareos/compare/78f3e2ff9db53e19bdc2c39303b73c46bef19c45..ba910ad077585dba969c271ea77e3284660d0e6e)
[July 11, 2024 07:38](#event-13467451543)

[![sebsura](https://avatars.githubusercontent.com/u/124262655?s=60&v=4)](/sebsura)

**[sebsura](/sebsura)**
requested changes
[Jul 11, 2024](#pullrequestreview-2171777775)

 [View reviewed changes](/bareos/bareos/pull/1875/files)

Copy link

Contributor

### @sebsura **[sebsura](/sebsura)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I have not checked everything yet but these are things i noticed

Sorry, something went wrong.

All reactions

[systemtests/python-modules/bareos\_unittest/json.py](/bareos/bareos/pull/1875/files#diff-747088d65d9aaa89eed73cb58ae617f446af137e05698f30e87b94fe1ca9b900)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_cmds.cc](/bareos/bareos/pull/1875/files#diff-8fe96011cf6f2e7490e42e829d974cfb7d8519160ffc34607fc20b6606392e5a)
Outdated

Show resolved

Hide resolved

[core/src/dird/ua\_run.cc](/bareos/bareos/pull/1875/files#diff-d3488d8c66150524f490d47e95c35d69283b91f7302fa679f478514156de45af)

Show resolved

Hide resolved

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
[force-pushed](/bareos/bareos/compare/71c9a0c0ffdf5765169836417915c59099de9342..5631ca19f3925716b802f8dd925598b949bdac54)
the
dev/joergs/master/acl-fix

branch
from
[`71c9a0c`](/bareos/bareos/commit/71c9a0c0ffdf5765169836417915c59099de9342) to
[`5631ca1`](/bareos/bareos/commit/5631ca19f3925716b802f8dd925598b949bdac54)  [Compare](/bareos/bareos/compare/71c9a0c0ffdf5765169836417915c59099de9342..5631ca19f3925716b802f8dd925598b949bdac54)
[July 11, 2024 15:27](#event-13473635312)

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
requested a review
from [sebsura](/sebsura)
[July 11, 2024 15:29](#event-13473671171)

[![sebsura](https://avatars.githubusercontent.com/u/124262655?s=60&v=4)](/sebsura)

**[sebsura](/sebsura)**
approved these changes
[Jul 12, 2024](#pullrequestreview-2173862968)

 [View reviewed changes](/bareos/bareos/pull/1875/files)

Copy link

Contributor

### @sebsura **[sebsura](/sebsura)** left a comment

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Thanks for your work!

Sorry, something went wrong.

All reactions

[![@sebsura](https://avatars.githubusercontent.com/u/124262655?s=40&v=4)](/sebsura)
[sebsura](/sebsura)
added this to the [24.0.0](/bareos/bareos/milestone/1) milestone
[Jul 12, 2024](#event-13481737241)

This was referenced Jul 12, 2024

[Fix multiple ACL handling bugs
#1890](/bareos/bareos/pull/1890)
 Merged

[Fix multiple ACL handling bugs
#1891](/bareos/bareos/pull/1891)
 Merged

[Fix multiple ACL handling bugs
#1892](/bareos/bareos/pull/1892)
 Merged

 [joergsteffens](/joergsteffens)
and others
added 6 commits
[July 12, 2024 14:41](#commits-pushed-45c7445)

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[acl: fix command ACL handling](/bareos/bareos/pull/1875/commits/45c74452d4059ebd819b8a52a976ba016239f89a "acl: fix command ACL handling

ACL handling for commands have been wrong.
The UA detect a command, if all typed chars matches the start of a
command string. E.g. \"w\" => \"whoami\", \".cons\" => \".consoles\", ...
The ACL check also only used the typed part of the command,
so if your ACL denies the command \".consoles\",
you could execute it with \".cons\" (or \".co\").
Now we check with the full command string against the ACL.")`
 …

`[45c7445](/bareos/bareos/pull/1875/commits/45c74452d4059ebd819b8a52a976ba016239f89a)`

```
ACL handling for commands have been wrong.
The UA detect a command, if all typed chars matches the start of a
command string. E.g. "w" => "whoami", ".cons" => ".consoles", ...
The ACL check also only used the typed part of the command,
so if your ACL denies the command ".consoles",
you could execute it with ".cons" (or ".co").
Now we check with the full command string against the ACL.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[acl: fix handling profiles](/bareos/bareos/pull/1875/commits/c609dd1834cfd24af597ade94bf5a200129a73ac "acl: fix handling profiles

When using negative ACLs (ACLs starting with '!')
profiles could have overwritten this entries,
as the code did not distringuish between negative ACL and not found.

Now the ACL checking can have three states:
positive match found,
negative match found,
no match found.

Also unifies the ACL checking
and adding the ACL directive \"!*all*\"
to deny all (before a regex must be used (\"!.*\").")`
 …

`[c609dd1](/bareos/bareos/pull/1875/commits/c609dd1834cfd24af597ade94bf5a200129a73ac)`

```
When using negative ACLs (ACLs starting with '!')
profiles could have overwritten this entries,
as the code did not distringuish between negative ACL and not found.

Now the ACL checking can have three states:
positive match found,
negative match found,
no match found.

Also unifies the ACL checking
and adding the ACL directive "!*all*"
to deny all (before a regex must be used ("!.*").
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[gitignore: ignore __pycache__ everywhere](/bareos/bareos/pull/1875/commits/26b86b70b48a6fe7901bf96bc52241d89b98451a "gitignore: ignore __pycache__ everywhere")`

`[26b86b7](/bareos/bareos/pull/1875/commits/26b86b70b48a6fe7901bf96bc52241d89b98451a)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests python-bareos: adapt list_unittests.py](/bareos/bareos/pull/1875/commits/f96a56c385e8ab60ecc41bf4690107871b10e47e "systemtests python-bareos: adapt list_unittests.py

Make it work again with current python versions")`
 …

`[f96a56c](/bareos/bareos/pull/1875/commits/f96a56c385e8ab60ecc41bf4690107871b10e47e)`

```
Make it work again with current python versions
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests: adding more ACL tests](/bareos/bareos/pull/1875/commits/2af8a4ed4e74239304f5c5025f63c8445e721750 "systemtests: adding more ACL tests")`

`[2af8a4e](/bareos/bareos/pull/1875/commits/2af8a4ed4e74239304f5c5025f63c8445e721750)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@sebsura](https://avatars.githubusercontent.com/u/124262655?s=40&v=4)](/sebsura) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[Apply suggestions from code review](/bareos/bareos/pull/1875/commits/982c4cfb398719bb1fa5d59b05ffb750f7d1080c "Apply suggestions from code review

Co-authored-by: Sebastian Sura <124262655+sebsura@users.noreply.github.com>")`
 …

`[982c4cf](/bareos/bareos/pull/1875/commits/982c4cfb398719bb1fa5d59b05ffb750f7d1080c)`

```
Co-authored-by: Sebastian Sura <124262655+sebsura@users.noreply.github.com>
```

 [joergsteffens](/joergsteffens)
and others
added 17 commits
[July 12, 2024 14:41](#commits-pushed-1aa8fe2)

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests python-bareos: extend ACL test](/bareos/bareos/pull/1875/commits/1aa8fe29f0c78dd513655094c5dda37516b38c05 "systemtests python-bareos: extend ACL test")`

`[1aa8fe2](/bareos/bareos/pull/1875/commits/1aa8fe29f0c78dd513655094c5dda37516b38c05)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[fix output format](/bareos/bareos/pull/1875/commits/942311fb6690dc192a7cb95918d2d9776b0625c7 "fix output format")`

`[942311f](/bareos/bareos/pull/1875/commits/942311fb6690dc192a7cb95918d2d9776b0625c7)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: remove manual format chars in cmd usage](/bareos/bareos/pull/1875/commits/0d983a9abdcc29a7e74e8942d4954ddccec01e8e "core: remove manual format chars in cmd usage

The usage strings are rewarped anyway,
so manual formating chars (\"\n\", \"\t\") are only misleading.")`
 …

`[0d983a9](/bareos/bareos/pull/1875/commits/0d983a9abdcc29a7e74e8942d4954ddccec01e8e)`

```
The usage strings are rewarped anyway,
so manual formating chars ("\n", "\t") are only misleading.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: fix ACL parsing error handling](/bareos/bareos/pull/1875/commits/a14322cda1c443730aba803e260dabe30507b1f5 "core: fix ACL parsing error handling

Before an invalid ACL emits and error but has than be igorned.
Now parsing stops at an error and mark the whole configuration as
invalid.")`
 …

`[a14322c](/bareos/bareos/pull/1875/commits/a14322cda1c443730aba803e260dabe30507b1f5)`

```
Before an invalid ACL emits and error but has than be igorned.
Now parsing stops at an error and mark the whole configuration as
invalid.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: WhereACL: adding missing check when modify job](/bareos/bareos/pull/1875/commits/65a5502d4d17e12ed727e2d23f229377b6bc815a "core: WhereACL: adding missing check when modify job")`

`[65a5502](/bareos/bareos/pull/1875/commits/65a5502d4d17e12ed727e2d23f229377b6bc815a)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: cleanup](/bareos/bareos/pull/1875/commits/ea241197f5ac660c37e910b094ce5099162b6149 "core: cleanup")`

`[ea24119](/bareos/bareos/pull/1875/commits/ea241197f5ac660c37e910b094ce5099162b6149)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: empty Where_ACL allows restoring everywhere](/bareos/bareos/pull/1875/commits/57ab8b254cbd5b44dc50ed2a312b7195c790ba00 "core: empty Where_ACL allows restoring everywhere

This is now implemented like it has been documented.")`
 …

`[57ab8b2](/bareos/bareos/pull/1875/commits/57ab8b254cbd5b44dc50ed2a312b7195c790ba00)`

```
This is now implemented like it has been documented.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: handle WhereACL like all other ACLs](/bareos/bareos/pull/1875/commits/a74c18fe6aaee843f3231c1dd2a34239e742fba3 "core: handle WhereACL like all other ACLs

The documenation and code comments have described that
an empty WhereACL would accept all input, like \"*all*\".
In fact, that has never (?) been implemented in that way,
therefore we removed this special case
and handle the WhereACL like all other ACLs.")`
 …

`[a74c18f](/bareos/bareos/pull/1875/commits/a74c18fe6aaee843f3231c1dd2a34239e742fba3)`

```
The documenation and code comments have described that
an empty WhereACL would accept all input, like "*all*".
In fact, that has never (?) been implemented in that way,
therefore we removed this special case
and handle the WhereACL like all other ACLs.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[docs: regenerate autogenerated files](/bareos/bareos/pull/1875/commits/3e59d0e4d1db7596117e11feb6d829fd231155a0 "docs: regenerate autogenerated files")`

`[3e59d0e](/bareos/bareos/pull/1875/commits/3e59d0e4d1db7596117e11feb6d829fd231155a0)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests python-bareos: reuse operator profile](/bareos/bareos/pull/1875/commits/1dcc26236eae737b1beb1104d35a615648a234c7 "systemtests python-bareos: reuse operator profile")`

`[1dcc262](/bareos/bareos/pull/1875/commits/1dcc26236eae737b1beb1104d35a615648a234c7)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests python-bareos: check WhereACL](/bareos/bareos/pull/1875/commits/d3eaeb352b7a6b81adff5a8bc2ec1d0933139b52 "systemtests python-bareos: check WhereACL")`

`[d3eaeb3](/bareos/bareos/pull/1875/commits/d3eaeb352b7a6b81adff5a8bc2ec1d0933139b52)`

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests: prevent problems with WhereACL path](/bareos/bareos/pull/1875/commits/faa34dbeadef51f1defe45bb879c9ebab776bd97 "systemtests: prevent problems with WhereACL path

In some automated systemtests, the path did contain the \"~\",
which is considerd invalid in a WhereACL.
Changed the WhereACL to circumvent that.")`
 …

`[faa34db](/bareos/bareos/pull/1875/commits/faa34dbeadef51f1defe45bb879c9ebab776bd97)`

```
In some automated systemtests, the path did contain the "~",
which is considerd invalid in a WhereACL.
Changed the WhereACL to circumvent that.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[systemtests: replace config-syntax-crash test](/bareos/bareos/pull/1875/commits/16e2fbf8167a6f572f61b50629057926848dcee2 "systemtests: replace config-syntax-crash test

Invalid chars in WhereAcls are now properly marked as configuration
errors. Therefore in the original test config-syntax-crash, the Bareos
Director refuses to start (with a proper error message), instead of just
ignoring the invalid entry.
Instead of adapting the config-syntax-crash, the test for invalid chars
is now added to the python-bareos tests and the config-syntax-crash
removed.")`
 …

`[16e2fbf](/bareos/bareos/pull/1875/commits/16e2fbf8167a6f572f61b50629057926848dcee2)`

```
Invalid chars in WhereAcls are now properly marked as configuration
errors. Therefore in the original test config-syntax-crash, the Bareos
Director refuses to start (with a proper error message), instead of just
ignoring the invalid entry.
Instead of adapting the config-syntax-crash, the test for invalid chars
is now added to the python-bareos tests and the config-syntax-crash
removed.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@sebsura](https://avatars.githubusercontent.com/u/124262655?s=40&v=4)](/sebsura) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[Update systemtests/python-modules/bareos_unittest/json.py](/bareos/bareos/pull/1875/commits/fc4a8a2fc02a3154045b2ff47f6b9cf17a2f1a1d "Update systemtests/python-modules/bareos_unittest/json.py

Co-authored-by: Sebastian Sura <124262655+sebsura@users.noreply.github.com>")`
 …

`[fc4a8a2](/bareos/bareos/pull/1875/commits/fc4a8a2fc02a3154045b2ff47f6b9cf17a2f1a1d)`

```
Co-authored-by: Sebastian Sura <124262655+sebsura@users.noreply.github.com>
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: always allow 'exit' cmd](/bareos/bareos/pull/1875/commits/84dbca4f63682bd5f7042a9dc8b88d051e69a670 "core: always allow 'exit' cmd

exit is an alias to quit,
so handle exit identical as quit.")`
 …

`[84dbca4](/bareos/bareos/pull/1875/commits/84dbca4f63682bd5f7042a9dc8b88d051e69a670)`

```
exit is an alias to quit,
so handle exit identical as quit.
```

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[core: handle PluginOptionsACL and regexwhere](/bareos/bareos/pull/1875/commits/c38a9ac2b8faf7cb39d45df75d1facb519d6ef43 "core: handle PluginOptionsACL and regexwhere

On ModifyJobParameters,
check PluginOptionsACL
and the WhereACL also for regexwhere.")`
 …

`[c38a9ac](/bareos/bareos/pull/1875/commits/c38a9ac2b8faf7cb39d45df75d1facb519d6ef43)`

```
On ModifyJobParameters,
check PluginOptionsACL
and the WhereACL also for regexwhere.
```

[![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[Update CHANGELOG.md](/bareos/bareos/pull/1875/commits/af86d445fb389917d2410f1eaca4ff2af62debb1 "Update CHANGELOG.md")`

`[af86d44](/bareos/bareos/pull/1875/commits/af86d445fb389917d2410f1eaca4ff2af62debb1)`

 [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&u=c0379adb38ce0547fac3a9ed872306dba203baa5&v=4)](/BareosBot)
[BareosBot](/BareosBot)
[force-pushed](/bareos/bareos/compare/4fd5ecc745e18102b26a80ef77c8c3f375fa4564..af86d445fb389917d2410f1eaca4ff2af62debb1)
the
dev/joergs/master/acl-fix

branch
from
[`4fd5ecc`](/bareos/bareos/commit/4fd5ecc745e18102b26a80ef77c8c3f375fa4564) to
[`af86d44`](/bareos/bareos/commit/af86d445fb389917d2410f1eaca4ff2af62debb1)  [Compare](/bareos/bareos/compare/4fd5ecc745e18102b26a80ef77c8c3f375fa4564..af86d445fb389917d2410f1eaca4ff2af62debb1)
[July 12, 2024 14:41](#event-13488404427)

[![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&u=c0379adb38ce0547fac3a9ed872306dba203baa5&v=4)](/BareosBot)
[BareosBot](/BareosBot)
merged commit [`2a02669`](/bareos/bareos/commit/2a026698b87d13bd1c6275726b5e826702f81dd5)
into
bareos:master

[Jul 12, 2024](https://github.com/bareos/bareos/pull/1875#event-13488405578)

[joergsteffens](/joergsteffens)
added a commit
to joergsteffens/bareos
that referenced
this pull request
[Jul 12, 2024](#ref-commit-6971823)
[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)

`[docs rear: use rear profile](/joergsteffens/bareos/commit/6971823ec69bf19d48523e4a8c42c888a7bda8ca "docs rear: use rear profile

As https://github.com/bareos/bareos/pull/1875 and its backports (down
to bareos-21) have been merged, we could simply the ReaR configuration
by using a standard Profile.")`
…

`[6971823](/joergsteffens/bareos/commit/6971823ec69bf19d48523e4a8c42c888a7bda8ca)`

```
As [bareos#1875](https://github.com/bareos/bareos/pull/1875) and its backports (down
to bareos-21) have been merged, we could simply the ReaR configuration
by using a standard Profile.
```

[joergsteffens](/joergsteffens)
added a commit
to joergsteffens/bareos
that referenced
this pull request
[Jul 12, 2024](#ref-commit-7dcd940)
[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)

`[docs rear: use rear profile](/joergsteffens/bareos/commit/7dcd9405f7d3f1c222bfdc6b51e677986e0a804a "docs rear: use rear profile

As https://github.com/bareos/bareos/pull/1875 and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.")`
…

`[7dcd940](/joergsteffens/bareos/commit/7dcd9405f7d3f1c222bfdc6b51e677986e0a804a)`

```
As [bareos#1875](https://github.com/bareos/bareos/pull/1875) and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.
```

[joergsteffens](/joergsteffens)
added a commit
to joergsteffens/bareos
that referenced
this pull request
[Jul 12, 2024](#ref-commit-a90071a)
[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)

`[docs rear: use rear profile](/joergsteffens/bareos/commit/a90071a451987e67e2d08e619e7e1a33f1b63cfb "docs rear: use rear profile

As https://github.com/bareos/bareos/pull/1875 and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.")`
…

`[a90071a](/joergsteffens/bareos/commit/a90071a451987e67e2d08e619e7e1a33f1b63cfb)`

```
As [bareos#1875](https://github.com/bareos/bareos/pull/1875) and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.
```

[BareosBot](/BareosBot)
pushed a commit
to joergsteffens/bareos
that referenced
this pull request
[Jul 12, 2024](#ref-commit-986be40)
[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

`[docs rear: use rear profile](/joergsteffens/bareos/commit/986be40b34a7b4341679da46b4f7d7c35c138dcf "docs rear: use rear profile

As https://github.com/bareos/bareos/pull/1875 and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.")`
…

`[986be40](/joergsteffens/bareos/commit/986be40b34a7b4341679da46b4f7d7c35c138dcf)`

```
As [bareos#1875](https://github.com/bareos/bareos/pull/1875) and its backports (down
to bareos-21) have been merged, we could simplify the ReaR configuration
by using a standard Profile.
```

 [![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens)
[joergsteffens](/joergsteffens)
deleted the
dev/joergs/master/acl-fix

branch
[September 25, 2024 15:49](#event-14401565275)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fpull%2F1875)

Reviewers

[![@sebsura](https://avatars.githubusercontent.com/u/124262655?s=40&v=4)](/sebsura) [sebsura](/sebsura)

sebsura approved these changes

Assignees

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=40&v=4)](/joergsteffens) [joergsteffens](/joergsteffens)

Labels

[bugfix](/bareos/bareos/labels/bugfix)
[requires backport to 21](/bareos/bareos/labels/requires%20backport%20to%2021)
[requires backport to 22](/bareos/bareos/labels/requires%20backport%20to%2022)
[requires backport to 23](/bareos/bareos/labels/requires%20backport%20to%2023)

Projects

None yet

Milestone

 [**24.0.0**](/bareos/bareos/milestone/1 "24.0.0")

Development

Successfully merging this pull request may close these issues.

4 participants

[![@joergsteffens](https://avatars.githubusercontent.com/u/2428180?s=52&v=4)](/joergsteffens) [![@sebsura](https://avatars.githubusercontent.com/u/124262655?s=52&v=4)](/sebsura) [![@arogge](https://avatars.githubusercontent.com/u/22479968?s=52&v=4)](/arogge) [![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=52&v=4)](/BareosBot)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_183f9ec2_20250110_134400.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fcommit%2F2a026698b87d13bd1c6275726b5e826702f81dd5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fcommit%2F2a026698b87d13bd1c6275726b5e826702f81dd5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=bareos%2Fbareos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bareos](/bareos)
/
**[bareos](/bareos/bareos)**
Public

* [Notifications](/login?return_to=%2Fbareos%2Fbareos) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fbareos%2Fbareos)
* [Star
   1k](/login?return_to=%2Fbareos%2Fbareos)

* [Code](/bareos/bareos)
* [Issues
  46](/bareos/bareos/issues)
* [Pull requests
  29](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects
  0](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

Additional navigation options

* [Code](/bareos/bareos)
* [Issues](/bareos/bareos/issues)
* [Pull requests](/bareos/bareos/pulls)
* [Discussions](/bareos/bareos/discussions)
* [Actions](/bareos/bareos/actions)
* [Projects](/bareos/bareos/projects)
* [Security](/bareos/bareos/security)
* [Insights](/bareos/bareos/pulse)

## Commit

[Permalink](/bareos/bareos/commit/2a026698b87d13bd1c6275726b5e826702f81dd5)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#1875](https://github.com/bareos/bareos/pull/1875)

[Browse files](/bareos/bareos/tree/2a026698b87d13bd1c6275726b5e826702f81dd5)
Browse the repository at this point in the history

```
Fix multiple ACL handling bugs
```

* Loading branch information

[![@BareosBot](https://avatars.githubusercontent.com/u/102356597?s=40&v=4)](/BareosBot)

[BareosBot](/bareos/bareos/commits?author=BareosBot "View all commits by BareosBot")
authored
Jul 12, 2024

2 parents
[afbdb63](/bareos/bareos/commit/afbdb636689d8b531597bf1a4c2dfa61affa037d)
+
[af86d44](/bareos/bareos/commit/af86d445fb389917d2410f1eaca4ff2af62debb1)

commit 2a02669

 Show file tree

 Hide file tree

Showing
**42 changed files**
with
**516 additions**
and
**650 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* .gitignore
  [.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947)
* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* core/src/dird

  + core/src/dird/dird\_conf.cc
    [dird\_conf.cc](#diff-296313a01a18601f0daabfdb55601b8447ce86b4af3494edccdb8d734ea068fc)
  + core/src/dird/ua\_acl.cc
    [ua\_acl.cc](#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5)
  + core/src/dird/ua\_cmds.cc
    [ua\_cmds.cc](#diff-8fe96011cf6f2e7490e42e829d974cfb7d8519160ffc34607fc20b6606392e5a)
  + core/src/dird/ua\_run.cc
    [ua\_run.cc](#diff-d3488d8c66150524f490d47e95c35d69283b91f7302fa679f478514156de45af)
* docs/manuals/source

  + include/autogenerated

    - docs/manuals/source/include/autogenerated/bareos-dir-config-schema.json
      [bareos-dir-config-schema.json](#diff-9ee19d650d94299cc363bc249c62d5733be3ab44a4a8f3d297a3e17fe8c2583d)
  + manually\_added\_config\_directive\_descriptions

    - docs/manuals/source/manually\_added\_config\_directive\_descriptions/dir-console-WhereAcl.rst.inc
      [dir-console-WhereAcl.rst.inc](#diff-cd614b930dd47ece22e8f62231b1802d9d9ef660721f5b7bcc570c67bdc6ca3a)
* python-bareos

  + python-bareos/.gitignore
    [.gitignore](#diff-ec61fe1a51685e5c2c354bd102ebdc39a2422405d2f9382445a2d0ffefa9d3bc)
* systemtests

  + python-modules/bareos\_unittest

    - systemtests/python-modules/bareos\_unittest/json.py
      [json.py](#diff-747088d65d9aaa89eed73cb58ae617f446af137e05698f30e87b94fe1ca9b900)
  + tests

    - systemtests/tests/CMakeLists.txt
      [CMakeLists.txt](#diff-2db3686f782b512de3dcdc63561a0b8d33d617c8f35ad8fd254072dab34a3b8f)
    - config-syntax-crash

      * systemtests/tests/config-syntax-crash/CMakeLists.txt
        [CMakeLists.txt](#diff-e7d6dd4b2237c1da412f32a929660a81acb8060f60c44606877c8584ab4cc022)
      * etc/bareos

        + bareos-dir.d

          - catalog

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/catalog/MyCatalog.conf.in
              [MyCatalog.conf.in](#diff-bd459f0032c90889266f2db2e94fa26c9af1d22056c7434a02b6c19fe94f1345)
          - client

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/client/bareos-fd.conf.in
              [bareos-fd.conf.in](#diff-08fde11aa587054c6ac811b14e352e7392fb2df9e0f3cede65e722a82211e201)
          - director

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/director/bareos-dir.conf.in
              [bareos-dir.conf.in](#diff-bb10a43dfb88130ecc50eca3980358c3a152968778c99ff1db3ddaefbea95801)
          - fileset

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/fileset/Catalog.conf.in
              [Catalog.conf.in](#diff-a498ef6544761ad5372c5b41d2bc1fa63856e8fcc5e67fc5690fa4c25e1371d9)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/fileset/SelfTest.conf.in
              [SelfTest.conf.in](#diff-99d82c6fb273c7ea639a3ce18bfd461ad1b9a0b936e00be03cc053c90786e0fb)
          - job

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/job/RestoreFiles.conf.in
              [RestoreFiles.conf.in](#diff-84a9afbbf525b6bf975ee7a302a0f98f0e381400ef3f453eeef6a925a25ad3b8)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/job/backup-bareos-fd.conf
              [backup-bareos-fd.conf](#diff-b44b930d75a579fbe61c4bfb0ac9b68d33d4ef3017c5197a293afd98b25383f8)
          - jobdefs

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/jobdefs/DefaultJob.conf.in
              [DefaultJob.conf.in](#diff-252978f7accd12b6c3e9c96ce222cf148085e7d85953b2c091919aa0491d1a70)
          - messages

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/messages/Daemon.conf.in
              [Daemon.conf.in](#diff-574e065612687f06a3c8f2ee3fc2260b3bdcbc68692ef410d51c6e98d450a563)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/messages/Standard.conf.in
              [Standard.conf.in](#diff-ff713d6882300731fbb5e02580f092570367d6e6b7ec6df0e3ff3e7662ce0ec8)
          - pool

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Differential.conf
              [Differential.conf](#diff-0f48fa3d1ccdf7a7fb5205dfa3519a5d605be5ada03a6977ba45b8fdba7b1408)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Full.conf
              [Full.conf](#diff-3979ecf184fda495b10a67f51e32152fca8e47fc8d479e48a60463f5d3a00f1c)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Incremental.conf
              [Incremental.conf](#diff-59414f02519d4c811dbe5006d7fb87b2b3fd3f85b7d015d74d12c2eff6a80e2e)
            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/pool/Scratch.conf
              [Scratch.conf](#diff-42ecfa3afbcd27b761e924ffd80cfddfa1ea9230fcac2eb6f1a1ca76ae472450)
          - profile

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/profile/operator.conf
              [operator.conf](#diff-bae63644833396c1090836080fcdd1da994d9fbb82af8dad379a96147b56848f)
          - storage

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-dir.d/storage/File.conf.in
              [File.conf.in](#diff-6b53a346cc24c77acea5828337a463c8b00693177dfba3da9a0af95bfc160b0b)
        + bareos-fd.d

          - client

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/client/myself.conf.in
              [myself.conf.in](#diff-4dbc7aee50c0bff3c6232e9892178524c449c5ae3eb53033d869d4e2c6fee67c)
          - director

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/director/bareos-dir.conf.in
              [bareos-dir.conf.in](#diff-f1a7f8f7ca249c0d769fe0bc1f6181c54ee9823b0f52b200f9b5337ae7778947)
          - messages

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-fd.d/messages/Standard.conf
              [Standard.conf](#diff-4816416fc416e5b92ccda0b855715f304911f01afe6a1d94b93794c4a93eddb7)
        + bareos-sd.d

          - device

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/device/FileStorage.conf
              [FileStorage.conf](#diff-4f1890a2916986c8fb1314e9e5d542bb6d688662515c470d1fa389f047d92c09)
          - director

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/director/bareos-dir.conf.in
              [bareos-dir.conf.in](#diff-19f1c9e910f2e86ca584c26ff685bd9124ebdf86e889a22b10235f42cb244eb8)
          - messages

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/messages/Standard.conf
              [Standard.conf](#diff-5b858faba0d7c45aebdabd2a60f52af655986ea8617ae96829a740c2383e86b9)
          - storage

            * systemtests/tests/config-syntax-crash/etc/bareos/bareos-sd.d/storage/bareos-sd.conf.in
              [bareos-sd.conf.in](#diff-4426e465fdcf4a86231023740e26a729aeb33a5213d92449abb9ce590f06e9e5)
      * systemtests/tests/config-syntax-crash/testrunner
        [testrunner](#diff-87375443d490b1cd28e30118bcec917cc3435dbbea1452ee3f01a12aeb48beed)
    - python-bareos

      * etc/bareos

        + bareos-dir.d/console

          - systemtests/tests/python-bareos/etc/bareos/bareos-dir.d/console/client-bareos-fd.conf
            [client-bareos-fd.conf](#diff-ab630e4e7c7dd603da97b1dfe36241502009f279e2ab28101718838ea51b55f5)
          - systemtests/tests/python-bareos/etc/bareos/bareos-dir.d/console/limited-operator.conf
            [limited-operator.conf](#diff-a60f1f950eab3195fcfed1dc2636840dc9504b1ab85aeb0647c865a34fb0b53a)
        + systemtests/tests/python-bareos/etc/bareos/bconsole-limited-operator.conf.in
          [bconsole-limited-operator.conf.in](#diff-0084b83e24e6be77c912751afcaa4a5f08310ed095998e7fd9ea0f3c648db92b)
      * systemtests/tests/python-bareos/list\_unittests.py
        [list\_unittests.py](#diff-f2f874bcc93808b13a7c253a6fcc72d2c41a73e06050fa778d9d0d09d125e637)
      * systemtests/tests/python-bareos/test\_acl.py
        [test\_acl.py](#diff-49c3a685ec77fa81330d09b1c9e5c4ff4e8abd7403981ddfbc87a942335d7fa4)
      * systemtests/tests/python-bareos/test\_json\_config.py
        [test\_json\_config.py](#diff-3916ce0b6846401a4a1f9079eae833cd76cc49830120c43951ff135a7f5993f9)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[.gitignore](#diff-bc37d034bad564583790a46f19d807abfe519c5671395fd494d8cce506c42947 ".gitignore")

Show comments

[View file](/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/.gitignore)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -1,6 +1,9 @@ |
|  |  | # generated version files |
|  |  | cmake/BareosVersion.cmake |
|  |  |  |
|  |  | # python |
|  |  | \_\_pycache\_\_ |
|  |  |  |
|  |  | # docs |
|  |  | docs/manuals/source/include/autogenerated/\*.rst.inc |
|  |  | docs/manuals/source/include/autogenerated/autosummary/ |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -112,6 +112,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0 |
|  |  | - fix warnings on FreeBSD 13.3 compiler [PR #1881] |
|  |  | - dir: fix crash on purge with job without client [PR #1857] |
|  |  | - fix runtime status [PR #1872] |
|  |  | - Fix multiple ACL handling bugs [PR #1875] |
|  |  |  |
|  |  | [PR #1538]: https://github.com/bareos/bareos/pull/1538 |
|  |  | [PR #1581]: https://github.com/bareos/bareos/pull/1581 |
| Expand Down  Expand Up | | @@ -208,6 +209,7 @@ and this project adheres to [Semantic Versioning](https://semver.org/spec/v2.0.0 |
|  |  | [PR #1865]: https://github.com/bareos/bareos/pull/1865 |
|  |  | [PR #1868]: https://github.com/bareos/bareos/pull/1868 |
|  |  | [PR #1872]: https://github.com/bareos/bareos/pull/1872 |
|  |  | [PR #1875]: https://github.com/bareos/bareos/pull/1875 |
|  |  | [PR #1878]: https://github.com/bareos/bareos/pull/1878 |
|  |  | [PR #1881]: https://github.com/bareos/bareos/pull/1881 |
|  |  | [PR #1883]: https://github.com/bareos/bareos/pull/1883 |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[core/src/dird/dird\_conf.cc](#diff-296313a01a18601f0daabfdb55601b8447ce86b4af3494edccdb8d734ea068fc "core/src/dird/dird_conf.cc")

Show comments

[View file](/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core/src/dird/dird_conf.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -174,7 +174,7 @@ static ResourceItem dir\_items[] = { |
|  |  | { "CatalogAcl", CFG\_TYPE\_ACL, ITEM(resource, ACL\_lists), Catalog\_ACL, 0, NULL, NULL,\ |
|  |  | "Lists the Catalog resources, this resource has access to. The special keyword \*all\* allows access to all Catalog resources." },\ |
|  |  | { "WhereAcl", CFG\_TYPE\_ACL, ITEM(resource, ACL\_lists), Where\_ACL, 0, NULL, NULL,\ |
|  |  | "Specifies the base directories, where files could be restored. An empty string allows restores to all directories." },\ |
|  |  | "Specifies the base directories, where files could be restored." },\ |
|  |  | { "PluginOptionsAcl", CFG\_TYPE\_ACL, ITEM(resource, ACL\_lists), PluginOptions\_ACL, 0, NULL, NULL,\ |
|  |  | "Specifies the allowed plugin options. An empty strings allows all Plugin Options." } |
|  |  |  |
| Expand Down  Expand Up | | @@ -2790,7 +2790,7 @@ static void StoreAcl(LEX\* lc, ResourceItem\* item, int index, int pass) |
|  |  | LexGetToken(lc, BCT\_STRING); |
|  |  | if (pass == 1) { |
|  |  | if (!IsAclEntryValid(lc->str, msg)) { |
|  |  | Emsg1(M\_ERROR, 0, T\_("Cannot store Acl: %s\n"), msg.data()); |
|  |  | scan\_err1(lc, T\_("Cannot store Acl: %s"), msg.data()); |
|  |  | return; |
|  |  | } |
|  |  | list->append(strdup(lc->str)); |
| Expand Down | |  |

223 changes: 92 additions & 131 deletions

223
[core/src/dird/ua\_acl.cc](#diff-d0ee5c2530a094fd2e715f1137bdeeac8485a31cf87243e3cf6b01e87c08acc5 "core/src/dird/ua_acl.cc")

Show comments

[View file](/bareos/bareos/blob/2a026698b87d13bd1c6275726b5e826702f81dd5/core/src/dird/ua_acl.cc)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3,7 +3,7 @@ |
|  |  |  |
|  |  | Copyright (C) 2004-2008 Free Software Foundation Europe e.V. |
|  |  | Copyright (C) 2014-2016 Planets Communications B.V. |
|  |  | Copyright (C) 2014-2022 Bareos GmbH & Co. KG |
|  |  | Copyright (C) 2014-2024 Bareos GmbH & Co. KG |
|  |  |  |
|  |  | This program is Free Software; you can redistribute it and/or |
|  |  | modify it under the terms of version three of the GNU Affero General Public |
| Expand Down  Expand Up | | @@ -47,141 +47,104 @@ bool UaContext::AclAccessOk(int acl, const char\* item, bool audit\_event) |
|  |  | \* A regexp uses the following chars: |
|  |  | \* ., (, ), [, ], |, ^, $, +, ?, \* |
|  |  | \*/ |
|  |  | static bool is\_regex(std::string string\_to\_check) |
|  |  | constexpr bool is\_regex(std::string\_view string\_to\_check) |
|  |  | { |
|  |  | return std::string::npos != string\_to\_check.find\_first\_of(".()[]|^$+?\*"); |
|  |  | return string\_to\_check.npos != string\_to\_check.find\_first\_of(".()[]|^$+?\*"); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Loop over the items in the alist and verify if they match the given item |
|  |  | \* that access was requested for. |
|  |  | \* acl\_list\_value: value of the ACL definition. |
|  |  | \* acl\_list\_compare\_value: value ot compare against. This is identical to |
|  |  | \* acl\_list\_value or a modified acl\_list\_value to compare against. |
|  |  | \*/ |
|  |  | static inline bool FindInAclList(alist<const char\*>\* list, |
|  |  | int acl, |
|  |  | const char\* item, |
|  |  | int len) |
|  |  | static inline bool CompareAclListValueWithItem( |
|  |  | int acl, |
|  |  | const char\* acl\_list\_value, |
|  |  | const char\* acl\_list\_compare\_value, |
|  |  | const char\* item, |
|  |  | int item\_length) |
|  |  | { |
|  |  | int rc; |
|  |  | regex\_t preg{}; |
|  |  | int nmatch = 1; |
|  |  | bool retval = false; |
|  |  | regmatch\_t pmatch[1]{}; |
|  |  | const char\* list\_value; |
|  |  | // gives full access |
|  |  | if (Bstrcasecmp("\*all\*", acl\_list\_compare\_value)) { |
|  |  | Dmsg2(1400, "Global ACL found in %d %s\n", acl, acl\_list\_value); |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // See if we have an empty list. |
|  |  | if (!list) { |
|  |  | /\* |
|  |  | \* Empty list for Where => empty where accept anything. |
|  |  | \* For any other list, reject everything. |
|  |  | \*/ |
|  |  | if (len == 0 && acl == Where\_ACL) { |
|  |  | Dmsg0(1400, "Empty Where\_ACL allowing restore anywhere\n"); |
|  |  | retval = true; |
|  |  | } |
|  |  | goto bail\_out; |
|  |  | if (Bstrcasecmp(item, acl\_list\_compare\_value)) { |
|  |  | // Explicit match. |
|  |  | Dmsg3(1400, "ACL found %s in %d %s\n", item, acl, acl\_list\_value); |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // Search list for item |
|  |  | for (int i = 0; i < list->size(); i++) { |
|  |  | list\_value = (char\*)list->get(i); |
|  |  | /\* If we didn't get an exact match see if we can use the pattern as a |
|  |  | \* regex. \*/ |
|  |  | if (is\_regex(acl\_list\_compare\_value)) { |
|  |  | regex\_t preg{}; |
|  |  | int rc = regcomp(&preg, acl\_list\_compare\_value, REG\_EXTENDED | REG\_ICASE); |
|  |  | if (rc != 0) { |
|  |  | // Not a valid regular expression so skip it. |
|  |  | Dmsg1(1400, "Not a valid regex %s, ignoring for regex compare\n", |
|  |  | acl\_list\_value); |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // See if this is a deny acl. |
|  |  | if (\*list\_value == '!') { |
|  |  | if (Bstrcasecmp(item, list\_value + 1)) { |
|  |  | // Explicit deny. |
|  |  | Dmsg3(1400, "Deny ACL found %s in %d %s\n", item, acl, list\_value); |
|  |  | goto bail\_out; |
|  |  | int nmatch = 1; |
|  |  | regmatch\_t pmatch[1]{}; |
|  |  | if (regexec(&preg, item, nmatch, pmatch, 0) == 0) { |
|  |  | // Make sure its not a partial match but a full match. |
|  |  | Dmsg2(1400, "Found match start offset %d end offset %d\n", |
|  |  | pmatch[0].rm\_so, pmatch[0].rm\_eo); |
|  |  | if ((pmatch[0].rm\_eo - pmatch[0].rm\_so) >= item\_length) { |
|  |  | Dmsg3(1400, "ACL found %s in %d using regex %s\n", item, acl, |
|  |  | acl\_list\_value); |
|  |  | regfree(&preg); |
|  |  | return true; |
|  |  | } |
|  |  | } |
|  |  | regfree(&preg); |
|  |  | } |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* If we didn't get an exact match see if we can use the pattern as a |
|  |  | \* regex. |
|  |  | \*/ |
|  |  | if (is\_regex(list\_value + 1)) { |
|  |  | int match\_length; |
|  |  |  |
|  |  | match\_length = strlen(item); |
|  |  | rc = regcomp(&preg, list\_value + 1, REG\_EXTENDED | REG\_ICASE); |
|  |  | if (rc != 0) { |
|  |  | // Not a valid regular expression so skip it. |
|  |  | Dmsg1(1400, "Not a valid regex %s, ignoring for regex compare\n", |
|  |  | list\_value); |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | if (regexec(&preg, item, nmatch, pmatch, 0) == 0) { |
|  |  | // Make sure its not a partial match but a full match. |
|  |  | Dmsg2(1400, "Found match start offset %d end offset %d\n", |
|  |  | pmatch[0].rm\_so, pmatch[0].rm\_eo); |
|  |  | if ((pmatch[0].rm\_eo - pmatch[0].rm\_so) >= match\_length) { |
|  |  | Dmsg3(1400, "ACL found %s in %d using regex %s\n", item, acl, |
|  |  | list\_value); |
|  |  | regfree(&preg); |
|  |  | goto bail\_out; |
|  |  | } |
|  |  | } |
|  |  | /\*\* |
|  |  | \* Loop over the items in the alist and verify if they match the given item |
|  |  | \* that access was requested for. |
|  |  | \*/ |
|  |  | static inline std::optional<bool> FindInAclList(alist<const char\*>\* list, |
|  |  | int acl, |
|  |  | const char\* item, |
|  |  | int item\_length) |
|  |  | { |
|  |  | // See if we have an empty list. |
|  |  | if (!list || list->empty()) { return std::nullopt; } |
|  |  |  |
|  |  | regfree(&preg); |
|  |  | // Search list for item |
|  |  | const char\* list\_value = nullptr; |
|  |  | foreach\_alist (list\_value, list) { |
|  |  | // See if this is a deny acl. |
|  |  | if (\*list\_value == '!') { |
|  |  | if (CompareAclListValueWithItem(acl, list\_value, list\_value + 1, item, |
|  |  | item\_length)) { |
|  |  | return false; |
|  |  | } |
|  |  | } else { |
|  |  | // gives full access |
|  |  | if (Bstrcasecmp("\*all\*", list\_value)) { |
|  |  | Dmsg2(1400, "Global ACL found in %d %s\n", acl, list\_value); |
|  |  | retval = true; |
|  |  | goto bail\_out; |
|  |  | } |
|  |  |  |
|  |  | if (Bstrcasecmp(item, list\_value)) { |
|  |  | Dmsg3(1400, "ACL found %s in %d %s\n", item, acl, list\_value); |
|  |  | retval = true; |
|  |  | goto bail\_out; |
|  |  | } |
|  |  |  |
|  |  | /\* |
|  |  | \* If we didn't get an exact match see if we can use the pattern as a |
|  |  | \* regex. |
|  |  | \*/ |
|  |  | if (is\_regex(list\_value)) { |
|  |  | int match\_length; |
|  |  |  |
|  |  | match\_length = strlen(item); |
|  |  | rc = regcomp(&preg, list\_value, REG\_EXTENDED | REG\_ICASE); |
|  |  | if (rc != 0) { |
|  |  | // Not a valid regular expression so skip it. |
|  |  | Dmsg1(1400, "Not a valid regex %s, ignoring for regex compare\n", |
|  |  | list\_value); |
|  |  | continue; |
|  |  | } |
|  |  |  |
|  |  | if (regexec(&preg, item, nmatch, pmatch, 0) == 0) { |
|  |  | // Make sure its not a partial match but a full match. |
|  |  | Dmsg2(1400, "Found match start offset %d end offset %d\n", |
|  |  | pmatch[0].rm\_so, pmatch[0].rm\_eo); |
|  |  | if ((pmatch[0].rm\_eo - pmatch[0].rm\_so) >= match\_length) { |
|  |  | Dmsg3(1400, "ACL found %s in %d using regex %s\n", item, acl, |
|  |  | list\_value); |
|  |  | retval = true; |
|  |  | regfree(&preg); |
|  |  | goto bail\_out; |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | regfree(&preg); |
|  |  | if (CompareAclListValueWithItem(acl, list\_value, list\_value, item, |
|  |  | item\_length)) { |
|  |  | return true; |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | bail\_out: |
|  |  | return retval; |
|  |  | return std::nullopt; |
|  |  | } |
|  |  |  |
|  |  | // This version expects the length of the item which we must check. |
|  |  | bool UaContext::AclAccessOk(int acl, |
|  |  | const char\* item, |
|  |  | int len, |
|  |  | int item\_length, |
|  |  | bool audit\_event) |
|  |  | { |
|  |  | bool retval = false; |
|  |  | std::optional<bool> retval; |
|  |  |  |
|  |  | // The resource name contains nasty characters |
|  |  | switch (acl) { |
| Expand All | | @@ -203,27 +166,29 @@ bool UaContext::AclAccessOk(int acl, |
|  |  | goto bail\_out; |
|  |  | } |
|  |  |  |
|  |  | retval = FindInAclList(user\_acl->ACL\_lists[acl], acl, item, len); |
|  |  | retval = FindInAclList(user\_acl->ACL\_lists[acl], acl, item, item\_length); |
|  |  |  |
|  |  | /\* |
|  |  | \* If we didn't find a matching ACL try to use the profiles this console is |
|  |  | \* connected to. |
|  |  | \*/ |
|  |  | if (!retval && user\_acl->profiles && user\_acl->profiles->size()) { |
|  |  | ProfileResource\* profile = nullptr; |
|  |  | /\* If we didn't find a matching ACL try to use the profiles this console is |
|  |  | \* connected to. \*/ |
|  |  | if (!retval.has\_value()) { |
|  |  | if (user\_acl->profiles && user\_acl->profiles->size()) { |
|  |  | ProfileResource\* profile = nullptr; |
|  |  |  |
|  |  | foreach\_alist (profile, user\_acl->profiles) { |
|  |  | retval = FindInAclList(profile->ACL\_lists[acl], acl, item, len); |
|  |  | foreach\_alist (profile, user\_acl->profiles) { |
|  |  | retval = FindInAclList(profile->ACL\_lists[acl], acl, item, item\_length); |
|  |  |  |
|  |  | // If we found a match break the loop. |
|  |  | if (retval) { break; } |
|  |  | // If we found a match break the loop. |
|  |  | if (retval.has\_value()) { break; } |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | bail\_out: |
|  |  | if (audit\_event && !retval) { LogAuditEventAclFailure(acl, item); } |
|  |  | if (audit\_event && !retval.value\_or(false)) { |
|  |  | LogAuditEventAclFailure(acl, item); |
|  |  | } |
|  |  |  |
|  |  | return retval; |
|  |  | return retval.value\_or(false); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
| Expand Down  Expand Up | | @@ -306,11 +271,9 @@ bool UaContext::IsResAllowed(BareosResource\* res) |
|  |  |  |
|  |  | acl = RcodeToAcltype(res->rcode\_); |
|  |  | if (acl == -1) { |
|  |  | /\* |
|  |  | \* For all resources for which we don't know an explicit mapping |
|  |  | /\* For all resources for which we don't know an explicit mapping |
|  |  | \* to the right ACL we check if the Command ACL has access to the |
|  |  | \* configure command just as we do for suppressing sensitive data. |
|  |  | \*/ |
|  |  | \* configure command just as we do for suppressing sensitive data. \*/ |
|  |  | return AclAccessOk(Command\_ACL, "configure", false); |
|  |  | } |
|  |  |  |
| Expand All | | @@ -330,11 +293,9 @@ BareosResource\* UaContext::GetResWithName(int rcode, |
|  |  |  |
|  |  | acl = RcodeToAcltype(rcode); |
|  |  | if (acl == -1) { |
|  |  | /\* |
|  |  | \* For all resources for which we don't know an explicit mapping |
|  |  | /\* For all resources for which we don't know an explicit mapping |
|  |  | \* to the right ACL we check if the Command ACL has access to the |
|  |  | \* configure command just as we do for suppressing sensitive data. |
|  |  | \*/ |
|  |  | \* configure command just as we do for suppressing sensitive data. \*/ |
|  |  | if (!AclAccessOk(Command\_ACL, "configure", false)) { goto bail\_out; } |
|  |  | } else { |
|  |  | if (!AclAccessOk(acl, name, audit\_event)) { goto bail\_out; } |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `2a02669`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbareos%2Fbareos%2Fcommit%2F2a026698b87d13bd1c6275726b5e826702f81dd5) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


