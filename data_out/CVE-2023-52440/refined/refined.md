The provided content relates to CVE-2023-52440.

**Root cause of vulnerability:**
- The vulnerability is caused by a missing check on the length of the session key received during NTLM authentication in the ksmbd server. Specifically, the `authblob->SessionKey.Length` is not validated against the maximum allowed key size (`CIFS_KEY_SIZE`) before being used in the `cifs_arc4_crypt` function.

**Weaknesses/vulnerabilities present:**
- **SLUB Overflow:** If the `SessionKey.Length` exceeds `CIFS_KEY_SIZE`, a heap-based buffer overflow can occur when copying the session key data using `cifs_arc4_crypt`. This overflow is located in the slub allocator.

**Impact of exploitation:**
- A successful exploit could lead to arbitrary code execution by corrupting kernel memory.

**Attack vectors:**
- An attacker can exploit this vulnerability by crafting a malicious NTLM authentication request that contains a `SessionKey` with a length greater than `CIFS_KEY_SIZE`.

**Required attacker capabilities/position:**
- The attacker needs to be able to communicate with the ksmbd server and initiate an NTLM authentication handshake.

**Additional Notes:**
- The fix implemented in the provided patches adds a check to ensure `sess_key_len` is not greater than `CIFS_KEY_SIZE` in the `ksmbd_decode_ntlmssp_auth_blob` function. If the check fails the function will return an error `-EINVAL`.
- The vulnerability is located in `fs/smb/server/auth.c` (older kernels) or `fs/ksmbd/auth.c` (newer kernels)
- The `CIFS_KEY_SIZE` constant is 16 bytes (defined in include/net/cifs/cifsi.h).