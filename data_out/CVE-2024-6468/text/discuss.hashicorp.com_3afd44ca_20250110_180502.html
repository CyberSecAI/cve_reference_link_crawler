

[HashiCorp Discuss](/)

# [HCSEC-2024-14 - Vault Vulnerable to Denial of Service When Setting a Proxy Protocol Behavior](/t/hcsec-2024-14-vault-vulnerable-to-denial-of-service-when-setting-a-proxy-protocol-behavior/68518)

[Security](/c/security/52)

[security-vault](https://discuss.hashicorp.com/tag/security-vault)

[mickael](https://discuss.hashicorp.com/u/mickael)

July 11, 2024, 7:29pm

1

**Bulletin ID:** HCSEC-2024-14

**Affected Products / Versions:** Vault and Vault Enterprise, versions 1.10.0 through 1.15.11; fixed in 1.17.2, 1.16.6, and 1.15.12.

**Publication Date:** July 11, 2024

**Summary**

Vault and Vault Enterprise did not properly handle requests originating from unauthorized IP addresses when the TCP listener option, proxy\_protocol\_behavior, was set to deny\_unauthorized. When receiving a request from a source IP address that was not listed in proxy\_protocol\_authorized\_addrs, the Vault API server would shut down and no longer respond to any HTTP requests, potentially resulting in denial of service.

While this bug also affected versions of Vault up to 1.17.1 and 1.16.5, a separate regression in those release series did not allow Vault operators to configure the deny\_unauthorized option, thus not allowing the conditions for the denial of service to occur.

This vulnerability, CVE-2024-6468, was fixed in Vault and Vault Enterprise 1.17.2, 1.16.6, and 1.15.12.

**Background**

The proxy\_protocol\_behavior option in the TCP listener stanza , when specified, enables a PROXY protocol behavior for the listener. When proxy\_protocol\_behavior is set to allow\_authorized or deny\_authorized, the proxy\_protocol\_authorized\_addrs option needs to be set to more than one IP address.

More information on the TCP listener options can be found at [TCP - Listeners - Configuration | Vault | HashiCorp Developer](https://developer.hashicorp.com/vault/docs/configuration/listener/tcp#proxy_protocol_behavior)

**Details**

A bug existed in how the Vault API handled requests from unauthorized IP addresses when proxy\_protocol\_behavior was set to deny\_unauthorized , which blocks requests from reaching the Vault API. Instead of dropping the denied request and continuing on to serve other requests, the Vault API would return an unhandled error, causing the Vault API service to quit and no longer respond to requests.

**Remediation**

Customers using the proxy\_protocol\_behavior with the deny\_unauthorized option in the TCP listener should evaluate the risk associated with this issue and consider upgrading to Vault 1.17.2, 1.16.6, 1.15.12 or to consider not using the proxy\_protocol\_behavior entirely. Please refer to [Upgrading Vault](https://learn.hashicorp.com/tutorials/vault/sop-upgrade?in=vault/standard-procedures) for general guidance and version-specific upgrade notes.

**Acknowledgement**

This issue was identified by the Vault engineering team.

*We deeply appreciate any effort to coordinate disclosure of security vulnerabilities. For information about security at HashiCorp and the reporting of security vulnerabilities, please see <https://hashicorp.com/security>.*

### Related topics

| Topic |  | Replies | Views | Activity |
| --- | --- | --- | --- | --- |
| [HCSEC-2021-02 - Vault API Endpoint Exposed Internal IP Address Without Authentication](https://discuss.hashicorp.com/t/hcsec-2021-02-vault-api-endpoint-exposed-internal-ip-address-without-authentication/20334)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 7977 | January 29, 2021 |
| [HCSEC-2023-34 - Vault Vulnerable to Denial of Service Through Memory Exhaustion When Handling Large HTTP Requests](https://discuss.hashicorp.com/t/hcsec-2023-34-vault-vulnerable-to-denial-of-service-through-memory-exhaustion-when-handling-large-http-requests/60741)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 9287 | December 8, 2023 |
| [HCSEC-2020-13 - Vault Proxy Environment Variable Was Logged to STDOUT](https://discuss.hashicorp.com/t/hcsec-2020-13-vault-proxy-environment-variable-was-logged-to-stdout/18096)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 4128 | November 25, 2020 |
| [HCSEC-2021-34 - Vault, Consul, Boundary, and Waypoint Affected By Denial of Service in Golang’s net/http (CVE-2021-44716)](https://discuss.hashicorp.com/t/hcsec-2021-34-vault-consul-boundary-and-waypoint-affected-by-denial-of-service-in-golang-s-net-http-cve-2021-44716/33527)  [Security](/c/security/52) [security-consul](https://discuss.hashicorp.com/tag/security-consul) ,  [security-vault](https://discuss.hashicorp.com/tag/security-vault) ,  [security-boundary](https://discuss.hashicorp.com/tag/security-boundary) ,  [security-waypoint](https://discuss.hashicorp.com/tag/security-waypoint) | 0 | 5087 | December 22, 2021 |
| [HCSEC-2024-10 - Vault Enterprise Leaks Sensitive HTTP Request Headers in Audit Log When Deployed With a Performance Standby Node](https://discuss.hashicorp.com/t/hcsec-2024-10-vault-enterprise-leaks-sensitive-http-request-headers-in-audit-log-when-deployed-with-a-performance-standby-node/66553)  [Security](/c/security/52) [security-vault](https://discuss.hashicorp.com/tag/security-vault) | 0 | 3773 | April 30, 2024 |

* [Home](/)
* [Categories](/categories)
* [Guidelines](/guidelines)
* [Terms of Service](/tos)
* [Privacy Policy](https://meta.discourse.org/privacy)

Powered by [Discourse](https://www.discourse.org), best viewed with JavaScript enabled

