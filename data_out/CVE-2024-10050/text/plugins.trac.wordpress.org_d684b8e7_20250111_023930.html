

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3173344%2Fheader-footer-elementor%2Ftrunk%2Finc%2Fclass-header-footer-elementor.php%3Fcontextall%3D1)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3139582/header-footer-elementor/trunk/inc/class-header-footer-elementor.php "Changeset 3139582 for header-footer-elementor/trunk/inc/class-header-footer-elementor.php")
* [Next Change](/changeset/3177331/header-footer-elementor/trunk/inc/class-header-footer-elementor.php "Changeset 3177331 for header-footer-elementor/trunk/inc/class-header-footer-elementor.php") →

---

# Changeset [3173344](/changeset/3173344 "Show full changeset") for [header-footer-elementor/trunk/inc/class-header-footer-elementor.php](/browser/header-footer-elementor/trunk/inc/class-header-footer-elementor.php?rev=3173344 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/22/2024 06:26:00 AM
([3 months](/timeline?from=2024-10-22T06%3A26%3A00Z&precision=second "See timeline at 10/22/2024 06:26:00 AM") ago)

Author:
Nikschavan
Message:

Update to version 1.6.44 from GitHub

File:

1 edited

* [header-footer-elementor/trunk/inc/class-header-footer-elementor.php](/browser/header-footer-elementor/trunk/inc/class-header-footer-elementor.php?rev=3173344 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [header-footer-elementor/trunk/inc/class-header-footer-elementor.php](/changeset/3173344/header-footer-elementor/trunk/inc/class-header-footer-elementor.php "Show the changeset 3173344 restricted to header-footer-elementor/trunk/inc/class-header-footer-elementor.php")

  | [r3139582](/browser/header-footer-elementor/trunk/inc/class-header-footer-elementor.php?rev=3139582#L1 "Show revision 3139582 of this file in browser") | [r3173344](/browser/header-footer-elementor/trunk/inc/class-header-footer-elementor.php?rev=3173344#L1 "Show revision 3173344 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\*\* |
  | 3 | 3 | \* Entry point for the plugin. Checks if Elementor is installed and activated and loads it's own files and actions. |
  | 4 | 4 | \* |
  | 5 | 5 | \* @package header-footer-elementor |
  | 6 | 6 | \*/ |
  | 7 | 7 |  |
  | 8 | 8 | use HFE\Lib\Astra\_Target\_Rules\_Fields; |
  | 9 | 9 |  |
  | 10 | 10 | /\*\* |
  | 11 | 11 | \* Class Header\_Footer\_Elementor |
  | 12 | 12 | \*/ |
  | 13 | 13 | class Header\_Footer\_Elementor { |
  | 14 | 14 |  |
  | 15 | 15 | /\*\* |
  | 16 | 16 | \* Current theme template |
  | 17 | 17 | \* |
  | 18 | 18 | \* @var string |
  | 19 | 19 | \*/ |
  | 20 | 20 | public $template; |
  | 21 | 21 |  |
  | 22 | 22 | /\*\* |
  | 23 | 23 | \* Instance of Elemenntor Frontend class. |
  | 24 | 24 | \* |
  | 25 | 25 | \* @var object \Elementor\Frontend() |
  | 26 | 26 | \*/ |
  | 27 | 27 | private static $elementor\_instance; |
  | 28 | 28 |  |
  | 29 | 29 | /\*\* |
  | 30 | 30 | \* Instance of HFE\_Admin |
  | 31 | 31 | \* |
  | 32 | 32 | \* @var Header\_Footer\_Elementor |
  | 33 | 33 | \*/ |
  | 34 | 34 | private static $\_instance = null; |
  | 35 | 35 |  |
  | 36 | 36 | /\*\* |
  | 37 | 37 | \* Instance of Header\_Footer\_Elementor |
  | 38 | 38 | \* |
  | 39 | 39 | \* @return Header\_Footer\_Elementor Instance of Header\_Footer\_Elementor |
  | 40 | 40 | \*/ |
  | 41 | 41 | public static function instance() { |
  | 42 | 42 | if ( ! isset( self::$\_instance ) ) { |
  | 43 | 43 | self::$\_instance = new self(); |
  | 44 | 44 | } |
  | 45 | 45 |  |
  | 46 | 46 | return self::$\_instance; |
  | 47 | 47 | } |
  | 48 | 48 | /\*\* |
  | 49 | 49 | \* Constructor |
  | 50 | 50 | \*/ |
  | 51 | 51 | public function \_\_construct() { |
  | 52 | 52 | $this->template = get\_template(); |
  | 53 | 53 |  |
  | 54 | 54 | $is\_elementor\_callable = ( defined( 'ELEMENTOR\_VERSION' ) && is\_callable( 'Elementor\Plugin::instance' ) ) ? true : false; |
  | 55 | 55 |  |
  | 56 | 56 | $required\_elementor\_version = '3.5.0'; |
  | 57 | 57 |  |
  | 58 | 58 | $is\_elementor\_outdated = ( $is\_elementor\_callable && ( ! version\_compare( ELEMENTOR\_VERSION, $required\_elementor\_version, '>=' ) ) ) ? true : false; |
  | 59 | 59 |  |
  | 60 | 60 | if ( ( ! $is\_elementor\_callable ) || $is\_elementor\_outdated ) { |
  | 61 | 61 | $this->elementor\_not\_available( $is\_elementor\_callable, $is\_elementor\_outdated ); |
  | 62 | 62 | } |
  | 63 | 63 |  |
  | 64 | 64 | if ( $is\_elementor\_callable ) { |
  | 65 | 65 | self::$elementor\_instance = Elementor\Plugin::instance(); |
  | 66 | 66 |  |
  | 67 | 67 | $this->includes(); |
  | 68 | 68 | $this->load\_textdomain(); |
  | 69 | 69 |  |
  | 70 | 70 | add\_action( 'init', [ $this, 'setup\_settings\_page' ] ); |
  | 71 | 71 |  |
  | 72 | 72 | if ( 'genesis' == $this->template ) { |
  | 73 | 73 | require HFE\_DIR . 'themes/genesis/class-hfe-genesis-compat.php'; |
  | 74 | 74 | } elseif ( 'astra' == $this->template ) { |
  | 75 | 75 | require HFE\_DIR . 'themes/astra/class-hfe-astra-compat.php'; |
  | 76 | 76 | } elseif ( 'bb-theme' == $this->template || 'beaver-builder-theme' == $this->template ) { |
  | 77 | 77 | $this->template = 'beaver-builder-theme'; |
  | 78 | 78 | require HFE\_DIR . 'themes/bb-theme/class-hfe-bb-theme-compat.php'; |
  | 79 | 79 | } elseif ( 'generatepress' == $this->template ) { |
  | 80 | 80 | require HFE\_DIR . 'themes/generatepress/class-hfe-generatepress-compat.php'; |
  | 81 | 81 | } elseif ( 'oceanwp' == $this->template ) { |
  | 82 | 82 | require HFE\_DIR . 'themes/oceanwp/class-hfe-oceanwp-compat.php'; |
  | 83 | 83 | } elseif ( 'storefront' == $this->template ) { |
  | 84 | 84 | require HFE\_DIR . 'themes/storefront/class-hfe-storefront-compat.php'; |
  | 85 | 85 | } elseif ( 'hello-elementor' == $this->template ) { |
  | 86 | 86 | require HFE\_DIR . 'themes/hello-elementor/class-hfe-hello-elementor-compat.php'; |
  | 87 | 87 | } else { |
  | 88 | 88 | add\_filter( 'hfe\_settings\_tabs', [ $this, 'setup\_unsupported\_theme' ] ); |
  | 89 | 89 | add\_action( 'init', [ $this, 'setup\_fallback\_support' ] ); |
  | 90 | 90 | } |
  | 91 | 91 |  |
  | 92 | 92 | if ( 'yes' === get\_option( 'hfe\_plugin\_is\_activated' ) ) { |
  | 93 | 93 | add\_action( 'admin\_init', [ $this, 'show\_setup\_wizard' ] ); |
  | 94 | 94 | } |
  | 95 | 95 |  |
  | 96 | 96 | // Scripts and styles. |
  | 97 | 97 | add\_action( 'wp\_enqueue\_scripts', [ $this, 'enqueue\_scripts' ] ); |
  | 98 | 98 |  |
  | 99 | 99 | add\_action( 'admin\_enqueue\_scripts', [ $this, 'enqueue\_admin\_scripts' ] ); |
  | 100 | 100 |  |
  | 101 | 101 | add\_filter( 'body\_class', [ $this, 'body\_class' ] ); |
  | 102 | 102 | add\_action( 'switch\_theme', [ $this, 'reset\_unsupported\_theme\_notice' ] ); |
  | 103 | 103 |  |
  | 104 | 104 | add\_shortcode( 'hfe\_template', [ $this, 'render\_template' ] ); |
  | 105 | 105 |  |
  | 106 | 106 | add\_action( 'astra\_notice\_before\_markup\_header-footer-elementor-rating', [ $this, 'rating\_notice\_css' ] ); |
  | 107 | 107 | add\_action( 'admin\_init', [ $this, 'register\_notices' ] ); |
  | 108 | 108 |  |
  | 109 | 109 | // BSF Analytics Tracker. |
  | 110 | 110 | if ( ! class\_exists( 'BSF\_Analytics\_Loader' ) ) { |
  | 111 | 111 | require\_once HFE\_DIR . 'admin/bsf-analytics/class-bsf-analytics-loader.php'; |
  | 112 | 112 | } |
  | 113 | 113 |  |
  | 114 | 114 | $bsf\_analytics = BSF\_Analytics\_Loader::get\_instance(); |
  | 115 | 115 |  |
  | 116 | 116 | $bsf\_analytics->set\_entity( |
  | 117 | 117 | [ |
  | 118 | 118 | 'bsf' => [ |
  | 119 | 119 | 'product\_name'    => 'Elementor Header & Footer builder', |
  | 120 | 120 | 'path'            => HFE\_DIR . 'admin/bsf-analytics', |
  | 121 | 121 | 'author'          => 'Brainstorm Force', |
  | 122 | 122 | 'time\_to\_display' => '+24 hours', |
  | 123 | 123 | ], |
  | 124 | 124 | ] |
  | 125 | 125 | ); |
  | 126 | 126 |  |
  | 127 | 127 | } |
  | 128 | 128 | } |
  | 129 | 129 |  |
  | 130 | 130 | /\*\* |
  | 131 | 131 | \* Reset the Unsupported theme nnotice after a theme is switched. |
  | 132 | 132 | \* |
  | 133 | 133 | \* @since 1.0.16 |
  | 134 | 134 | \* |
  | 135 | 135 | \* @return void |
  | 136 | 136 | \*/ |
  | 137 | 137 | public function reset\_unsupported\_theme\_notice() { |
  | 138 | 138 | delete\_user\_meta( get\_current\_user\_id(), 'unsupported-theme' ); |
  | 139 | 139 | } |
  | 140 | 140 |  |
  | 141 | 141 | /\*\* |
  | 142 | 142 | \* Register Astra Notices. |
  | 143 | 143 | \* |
  | 144 | 144 | \* @since 1.2.0 |
  | 145 | 145 | \* |
  | 146 | 146 | \* @return void |
  | 147 | 147 | \*/ |
  | 148 | 148 | public function register\_notices() { |
  | 149 | 149 | $image\_path = HFE\_URL . 'assets/images/header-footer-elementor-icon.svg'; |
  | 150 | 150 |  |
  | 151 | 151 | Astra\_Notices::add\_notice( |
  | 152 | 152 | [ |
  | 153 | 153 | 'id'                         => 'header-footer-elementor-rating', |
  | 154 | 154 | 'type'                       => '', |
  | 155 | 155 | 'message'                    => sprintf( |
  | 156 | 156 | '<div class="notice-image"> |
  | 157 | 157 | <img src="%1$s" class="custom-logo" alt="Sidebar Manager" itemprop="logo"></div> |
  | 158 | 158 | <div class="notice-content"> |
  | 159 | 159 | <div class="notice-heading"> |
  | 160 | 160 | %2$s |
  | 161 | 161 | </div> |
  | 162 | 162 | %3$s<br /> |
  | 163 | 163 | <div class="astra-review-notice-container"> |
  | 164 | 164 | <a href="%4$s" class="astra-notice-close astra-review-notice button-primary" target="\_blank"> |
  | 165 | 165 | %5$s |
  | 166 | 166 | </a> |
  | 167 | 167 | <span class="dashicons dashicons-calendar"></span> |
  | 168 | 168 | <a href="#" data-repeat-notice-after="%6$s" class="astra-notice-close astra-review-notice"> |
  | 169 | 169 | %7$s |
  | 170 | 170 | </a> |
  | 171 | 171 | <span class="dashicons dashicons-smiley"></span> |
  | 172 | 172 | <a href="#" class="astra-notice-close astra-review-notice"> |
  | 173 | 173 | %8$s |
  | 174 | 174 | </a> |
  | 175 | 175 | </div> |
  | 176 | 176 | </div>', |
  | 177 | 177 | $image\_path, |
  | 178 | 178 | \_\_( 'Hello! Seems like you have used Elementor Header & Footer Builder to build this website — Thanks a ton!', 'header-footer-elementor' ), |
  | 179 | 179 | \_\_( 'Could you please do us a BIG favor and give it a 5-star rating on WordPress? This would boost our motivation and help other users make a comfortable decision while choosing the Elementor Header & Footer Builder.', 'header-footer-elementor' ), |
  | 180 | 180 | 'https://wordpress.org/support/plugin/header-footer-elementor/reviews/?filter=5#new-post', |
  | 181 | 181 | \_\_( 'Ok, you deserve it', 'header-footer-elementor' ), |
  | 182 | 182 | MONTH\_IN\_SECONDS, |
  | 183 | 183 | \_\_( 'Nope, maybe later', 'header-footer-elementor' ), |
  | 184 | 184 | \_\_( 'I already did', 'header-footer-elementor' ) |
  | 185 | 185 | ), |
  | 186 | 186 | 'show\_if'                    => ( hfe\_header\_enabled() || hfe\_footer\_enabled() || hfe\_is\_before\_footer\_enabled() ) ? true : false, |
  | 187 | 187 | 'repeat-notice-after'        => MONTH\_IN\_SECONDS, |
  | 188 | 188 | 'display-notice-after'       => 1296000, // Display notice after 15 days. |
  | 189 | 189 | 'priority'                   => 18, |
  | 190 | 190 | 'display-with-other-notices' => false, |
  | 191 | 191 | ] |
  | 192 | 192 | ); |
  | 193 | 193 | } |
  | 194 | 194 |  |
  | 195 | 195 | /\*\* |
  | 196 | 196 | \* Enqueue CSS for the Rating Notice. |
  | 197 | 197 | \* |
  | 198 | 198 | \* @since 1.2.0 |
  | 199 | 199 | \* @return void |
  | 200 | 200 | \*/ |
  | 201 | 201 | public function rating\_notice\_css() { |
  | 202 | 202 | wp\_enqueue\_style( 'hfe-admin-style', HFE\_URL . 'assets/css/admin-header-footer-elementor.css', [], HFE\_VER ); |
  | 203 | 203 | } |
  | 204 | 204 |  |
  | 205 | 205 | /\*\* |
  | 206 | 206 | \* Prints the admin notics when Elementor is not installed or activated or version outdated. |
  | 207 | 207 | \* |
  | 208 | 208 | \* @since 1.5.9 |
  | 209 | 209 | \* @param  boolean $is\_elementor\_callable specifies if elementor is available. |
  | 210 | 210 | \* @param  boolean $is\_elementor\_outdated specifies if elementor version is old. |
  | 211 | 211 | \* @return void |
  | 212 | 212 | \*/ |
  | 213 | 213 | public function elementor\_not\_available( $is\_elementor\_callable, $is\_elementor\_outdated ) { |
  | 214 | 214 |  |
  | 215 | 215 | if ( ( ! did\_action( 'elementor/loaded' ) ) || ( ! $is\_elementor\_callable ) ) { |
  | 216 | 216 | add\_action( 'admin\_notices', [ $this, 'elementor\_not\_installed\_activated' ] ); |
  | 217 | 217 | add\_action( 'network\_admin\_notices', [ $this, 'elementor\_not\_installed\_activated' ] ); |
  | 218 | 218 | return; |
  | 219 | 219 | } |
  | 220 | 220 |  |
  | 221 | 221 | if ( $is\_elementor\_outdated ) { |
  | 222 | 222 | add\_action( 'admin\_notices', [ $this, 'elementor\_outdated' ] ); |
  | 223 | 223 | add\_action( 'network\_admin\_notices', [ $this, 'elementor\_outdated' ] ); |
  | 224 | 224 | return; |
  | 225 | 225 | } |
  | 226 | 226 | } |
  | 227 | 227 |  |
  | 228 | 228 | /\*\* |
  | 229 | 229 | \* Prints the admin notics when Elementor is not installed or activated. |
  | 230 | 230 | \* |
  | 231 | 231 | \* @return void |
  | 232 | 232 | \*/ |
  | 233 | 233 | public function elementor\_not\_installed\_activated() { |
  | 234 | 234 |  |
  | 235 | 235 | $screen = get\_current\_screen(); |
  | 236 | 236 | if ( isset( $screen->parent\_file ) && 'plugins.php' === $screen->parent\_file && 'update' === $screen->id ) { |
  | 237 | 237 | return; |
  | 238 | 238 | } |
  | 239 | 239 |  |
  | 240 | 240 | if ( ! did\_action( 'elementor/loaded' ) ) { |
  | 241 | 241 | // Check user capability. |
  | 242 | 242 | if ( ! ( current\_user\_can( 'activate\_plugins' ) && current\_user\_can( 'install\_plugins' ) ) ) { |
  | 243 | 243 | return; |
  | 244 | 244 | } |
  | 245 | 245 |  |
  | 246 | 246 | /\* TO DO \*/ |
  | 247 | 247 | $class = 'notice notice-error'; |
  | 248 | 248 | /\* translators: %s: html tags \*/ |
  | 249 | 249 | $message = sprintf( \_\_( 'The %1$sElementor Header & Footer Builder%2$s plugin requires %1$sElementor%2$s plugin installed & activated.', 'header-footer-elementor' ), '<strong>', '</strong>' ); |
  | 250 | 250 |  |
  | 251 | 251 | $plugin = 'elementor/elementor.php'; |
  | 252 | 252 |  |
  | 253 | 253 | if ( \_is\_elementor\_installed() ) { |
  | 254 | 254 |  |
  | 255 | 255 | $action\_url   = wp\_nonce\_url( 'plugins.php?action=activate&amp;plugin=' . $plugin . '&amp;plugin\_status=all&amp;paged=1&amp;s', 'activate-plugin\_' . $plugin ); |
  | 256 | 256 | $button\_label = \_\_( 'Activate Elementor', 'header-footer-elementor' ); |
  | 257 | 257 |  |
  | 258 | 258 | } else { |
  | 259 | 259 |  |
  | 260 | 260 | $action\_url   = wp\_nonce\_url( self\_admin\_url( 'update.php?action=install-plugin&plugin=elementor' ), 'install-plugin\_elementor' ); |
  | 261 | 261 | $button\_label = \_\_( 'Install Elementor', 'header-footer-elementor' ); |
  | 262 | 262 | } |
  | 263 | 263 |  |
  | 264 | 264 | $button = '<p><a href="' . esc\_url( $action\_url ) . '" class="button-primary">' . esc\_html( $button\_label ) . '</a></p><p></p>'; |
  | 265 | 265 |  |
  | 266 | 266 | printf( '<div class="%1$s"><p>%2$s</p>%3$s</div>', esc\_attr( $class ), wp\_kses\_post( $message ), wp\_kses\_post( $button ) ); |
  | 267 | 267 | } |
  | 268 | 268 | } |
  | 269 | 269 |  |
  | 270 | 270 | /\*\* |
  | 271 | 271 | \* Prints the admin notics when Elementor version is outdated. |
  | 272 | 272 | \* |
  | 273 | 273 | \* @return void |
  | 274 | 274 | \*/ |
  | 275 | 275 | public function elementor\_outdated() { |
  | 276 | 276 |  |
  | 277 | 277 | // Check user capability. |
  | 278 | 278 | if ( ! ( current\_user\_can( 'activate\_plugins' ) && current\_user\_can( 'install\_plugins' ) ) ) { |
  | 279 | 279 | return; |
  | 280 | 280 | } |
  | 281 | 281 |  |
  | 282 | 282 | /\* TO DO \*/ |
  | 283 | 283 | $class = 'notice notice-error'; |
  | 284 | 284 | /\* translators: %s: html tags \*/ |
  | 285 | 285 | $message = sprintf( \_\_( 'The %1$sElementor Header & Footer Builder%2$s plugin has stopped working because you are using an older version of %1$sElementor%2$s plugin.', 'header-footer-elementor' ), '<strong>', '</strong>' ); |
  | 286 | 286 |  |
  | 287 | 287 | $plugin = 'elementor/elementor.php'; |
  | 288 | 288 |  |
  | 289 | 289 | if ( file\_exists( WP\_PLUGIN\_DIR . '/elementor/elementor.php' ) ) { |
  | 290 | 290 |  |
  | 291 | 291 | $action\_url   = wp\_nonce\_url( self\_admin\_url( 'update.php?action=upgrade-plugin&amp;plugin=' ) . $plugin . '&amp;', 'upgrade-plugin\_' . $plugin ); |
  | 292 | 292 | $button\_label = \_\_( 'Update Elementor', 'header-footer-elementor' ); |
  | 293 | 293 |  |
  | 294 | 294 | } else { |
  | 295 | 295 |  |
  | 296 | 296 | $action\_url   = wp\_nonce\_url( self\_admin\_url( 'update.php?action=install-plugin&plugin=elementor' ), 'install-plugin\_elementor' ); |
  | 297 | 297 | $button\_label = \_\_( 'Install Elementor', 'header-footer-elementor' ); |
  | 298 | 298 | } |
  | 299 | 299 |  |
  | 300 | 300 | $button = '<p><a href="' . esc\_url( $action\_url ) . '" class="button-primary">' . esc\_html( $button\_label ) . '</a></p><p></p>'; |
  | 301 | 301 |  |
  | 302 | 302 | printf( '<div class="%1$s"><p>%2$s</p>%3$s</div>', esc\_attr( $class ), wp\_kses\_post( $message ), wp\_kses\_post( $button ) ); |
  | 303 | 303 | } |
  | 304 | 304 |  |
  | 305 | 305 | /\*\* |
  | 306 | 306 | \* Prints the admin notics when Elementor is not installed or activated. |
  | 307 | 307 | \* |
  | 308 | 308 | \* @return void |
  | 309 | 309 | \*/ |
  | 310 | 310 | public function show\_setup\_wizard() { |
  | 311 | 311 |  |
  | 312 | 312 | $screen    = get\_current\_screen(); |
  | 313 | 313 | $screen\_id = $screen ? $screen->id : ''; |
  | 314 | 314 |  |
  | 315 | 315 | if ( 'plugins' !== $screen\_id ) { |
  | 316 | 316 | return; |
  | 317 | 317 | } |
  | 318 | 318 |  |
  | 319 | 319 | /\* TO DO \*/ |
  | 320 | 320 | $class       = 'notice notice-info is-dismissible'; |
  | 321 | 321 | $setting\_url = admin\_url( 'edit.php?post\_type=elementor-hf' ); |
  | 322 | 322 | $image\_path  = HFE\_URL . 'assets/images/header-footer-elementor-icon.svg'; |
  | 323 | 323 |  |
  | 324 | 324 | /\* translators: %s: html tags \*/ |
  | 325 | 325 | $notice\_message = sprintf( \_\_( 'Thank you for installing %1$s Elementor Header & Footer Builder %2$s Plugin! Click here to %3$sget started. %4$s', 'header-footer-elementor' ), '<strong>', '</strong>', '<a href="' . $setting\_url . '">', '</a>' ); |
  | 326 | 326 |  |
  | 327 | 327 | Astra\_Notices::add\_notice( |
  | 328 | 328 | [ |
  | 329 | 329 | 'id'                         => 'header-footer-install-notice', |
  | 330 | 330 | 'type'                       => 'info', |
  | 331 | 331 | /\* translators: %s: html tags \*/ |
  | 332 | 332 | 'message'                    => sprintf( |
  | 333 | 333 | '<img src="%1$s" class="custom-logo" alt="HFE" itemprop="logo"> |
  | 334 | 334 | <div class="notice-content"> |
  | 335 | 335 | <p>%2$s</p> |
  | 336 | 336 | </div>', |
  | 337 | 337 | $image\_path, |
  | 338 | 338 | $notice\_message |
  | 339 | 339 | ), |
  | 340 | 340 | 'repeat-notice-after'        => false, |
  | 341 | 341 | 'priority'                   => 18, |
  | 342 | 342 | 'display-with-other-notices' => false, |
  | 343 | 343 | ] |
  | 344 | 344 | ); |
  | 345 | 345 | } |
  | 346 | 346 |  |
  | 347 | 347 | /\*\* |
  | 348 | 348 | \* Loads the globally required files for the plugin. |
  | 349 | 349 | \* |
  | 350 | 350 | \* @return void |
  | 351 | 351 | \*/ |
  | 352 | 352 | public function includes() { |
  | 353 | 353 | require\_once HFE\_DIR . 'admin/class-hfe-admin.php'; |
  | 354 | 354 |  |
  | 355 | 355 | require\_once HFE\_DIR . 'inc/hfe-functions.php'; |
  | 356 | 356 |  |
  | 357 | 357 | // Load Elementor Canvas Compatibility. |
  | 358 | 358 | require\_once HFE\_DIR . 'inc/class-hfe-elementor-canvas-compat.php'; |
  | 359 | 359 |  |
  | 360 | 360 | // Load WPML & Polylang Compatibility if WPML is installed and activated. |
  | 361 | 361 | if ( defined( 'ICL\_SITEPRESS\_VERSION' ) || defined( 'POLYLANG\_BASENAME' ) ) { |
  | 362 | 362 | require\_once HFE\_DIR . 'inc/compatibility/class-hfe-wpml-compatibility.php'; |
  | 363 | 363 | } |
  | 364 | 364 |  |
  | 365 | 365 | // Load the Admin Notice Class. |
  | 366 | 366 | require\_once HFE\_DIR . 'inc/lib/astra-notices/class-astra-notices.php'; |
  | 367 | 367 |  |
  | 368 | 368 | // Load Target rules. |
  | 369 | 369 | require\_once HFE\_DIR . 'inc/lib/target-rule/class-astra-target-rules-fields.php'; |
  | 370 | 370 | // Setup upgrade routines. |
  | 371 | 371 | require\_once HFE\_DIR . 'inc/class-hfe-update.php'; |
  | 372 | 372 |  |
  | 373 | 373 | // Load the widgets. |
  | 374 | 374 | require HFE\_DIR . 'inc/widgets-manager/class-widgets-loader.php'; |
  | 375 | 375 | } |
  | 376 | 376 |  |
  | 377 | 377 | /\*\* |
  | 378 | 378 | \* Loads textdomain for the plugin. |
  | 379 | 379 | \* |
  | 380 | 380 | \* @return void |
  | 381 | 381 | \*/ |
  | 382 | 382 | public function load\_textdomain() { |
  | 383 | 383 | load\_plugin\_textdomain( 'header-footer-elementor' ); |
  | 384 | 384 | } |
  | 385 | 385 |  |
  | 386 | 386 | /\*\* |
  | 387 | 387 | \* Enqueue styles and scripts. |
  | 388 | 388 | \* |
  | 389 | 389 | \* @return void |
  | 390 | 390 | \*/ |
  | 391 | 391 | public function enqueue\_scripts() { |
  | 392 | 392 | wp\_enqueue\_style( 'hfe-style', HFE\_URL . 'assets/css/header-footer-elementor.css', [], HFE\_VER ); |
  | 393 | 393 |  |
  | 394 | 394 | if ( class\_exists( '\Elementor\Plugin' ) ) { |
  | 395 | 395 | $elementor = \Elementor\Plugin::instance(); |
  | 396 | 396 | $elementor->frontend->enqueue\_styles(); |
  | 397 | 397 | } |
  | 398 | 398 |  |
  | 399 | 399 | if ( class\_exists( '\ElementorPro\Plugin' ) ) { |
  | 400 | 400 | $elementor\_pro = \ElementorPro\Plugin::instance(); |
  | 401 | 401 | $elementor\_pro->enqueue\_styles(); |
  | 402 | 402 | } |
  | 403 | 403 |  |
  | 404 | 404 | if ( hfe\_header\_enabled() ) { |
  | 405 | 405 | if ( class\_exists( '\Elementor\Core\Files\CSS\Post' ) ) { |
  | 406 | 406 | $css\_file = new \Elementor\Core\Files\CSS\Post( get\_hfe\_header\_id() ); |
  | 407 | 407 | } elseif ( class\_exists( '\Elementor\Post\_CSS\_File' ) ) { |
  | 408 | 408 | $css\_file = new \Elementor\Post\_CSS\_File( get\_hfe\_header\_id() ); |
  | 409 | 409 | } |
  | 410 | 410 |  |
  | 411 | 411 | $css\_file->enqueue(); |
  | 412 | 412 | } |
  | 413 | 413 |  |
  | 414 | 414 | if ( hfe\_footer\_enabled() ) { |
  | 415 | 415 | if ( class\_exists( '\Elementor\Core\Files\CSS\Post' ) ) { |
  | 416 | 416 | $css\_file = new \Elementor\Core\Files\CSS\Post( get\_hfe\_footer\_id() ); |
  | 417 | 417 | } elseif ( class\_exists( '\Elementor\Post\_CSS\_File' ) ) { |
  | 418 | 418 | $css\_file = new \Elementor\Post\_CSS\_File( get\_hfe\_footer\_id() ); |
  | 419 | 419 | } |
  | 420 | 420 |  |
  | 421 | 421 | $css\_file->enqueue(); |
  | 422 | 422 | } |
  | 423 | 423 |  |
  | 424 | 424 | if ( hfe\_is\_before\_footer\_enabled() ) { |
  | 425 | 425 | if ( class\_exists( '\Elementor\Core\Files\CSS\Post' ) ) { |
  | 426 | 426 | $css\_file = new \Elementor\Core\Files\CSS\Post( hfe\_get\_before\_footer\_id() ); |
  | 427 | 427 | } elseif ( class\_exists( '\Elementor\Post\_CSS\_File' ) ) { |
  | 428 | 428 | $css\_file = new \Elementor\Post\_CSS\_File( hfe\_get\_before\_footer\_id() ); |
  | 429 | 429 | } |
  | 430 | 430 | $css\_file->enqueue(); |
  | 431 | 431 | } |
  | 432 | 432 | } |
  | 433 | 433 |  |
  | 434 | 434 | /\*\* |
  | 435 | 435 | \* Load admin styles on header footer elementor edit screen. |
  | 436 | 436 | \* |
  | 437 | 437 | \* @return void |
  | 438 | 438 | \*/ |
  | 439 | 439 | public function enqueue\_admin\_scripts() { |
  | 440 | 440 | global $pagenow; |
  | 441 | 441 | $screen = get\_current\_screen(); |
  | 442 | 442 |  |
  | 443 | 443 | if ( ( 'elementor-hf' == $screen->id && ( 'post.php' == $pagenow || 'post-new.php' == $pagenow ) ) || ( 'edit.php' == $pagenow && 'edit-elementor-hf' == $screen->id ) ) { |
  | 444 | 444 |  |
  | 445 | 445 | wp\_enqueue\_style( 'hfe-admin-style', HFE\_URL . 'admin/assets/css/ehf-admin.css', [], HFE\_VER ); |
  | 446 | 446 | wp\_enqueue\_script( 'hfe-admin-script', HFE\_URL . 'admin/assets/js/ehf-admin.js', [ 'jquery', 'updates' ], HFE\_VER, true ); |
  | 447 | 447 |  |
  | 448 | 448 | } |
  | 449 | 449 | } |
  | 450 | 450 |  |
  | 451 | 451 | /\*\* |
  | 452 | 452 | \* Adds classes to the body tag conditionally. |
  | 453 | 453 | \* |
  | 454 | 454 | \* @param  array $classes array with class names for the body tag. |
  | 455 | 455 | \* |
  | 456 | 456 | \* @return array          array with class names for the body tag. |
  | 457 | 457 | \*/ |
  | 458 | 458 | public function body\_class( $classes ) { |
  | 459 | 459 | if ( hfe\_header\_enabled() ) { |
  | 460 | 460 | $classes[] = 'ehf-header'; |
  | 461 | 461 | } |
  | 462 | 462 |  |
  | 463 | 463 | if ( hfe\_footer\_enabled() ) { |
  | 464 | 464 | $classes[] = 'ehf-footer'; |
  | 465 | 465 | } |
  | 466 | 466 |  |
  | 467 | 467 | $classes[] = 'ehf-template-' . $this->template; |
  | 468 | 468 | $classes[] = 'ehf-stylesheet-' . get\_stylesheet(); |
  | 469 | 469 |  |
  | 470 | 470 | return $classes; |
  | 471 | 471 | } |
  | 472 | 472 |  |
  | 473 | 473 | /\*\* |
  | 474 | 474 | \* Display Settings Page options |
  | 475 | 475 | \* |
  | 476 | 476 | \* @since 1.6.0 |
  | 477 | 477 | \* @return void |
  | 478 | 478 | \*/ |
  | 479 | 479 | public function setup\_settings\_page() { |
  | 480 | 480 |  |
  | 481 | 481 | require\_once HFE\_DIR . 'inc/class-hfe-settings-page.php'; |
  | 482 | 482 | } |
  | 483 | 483 |  |
  | 484 | 484 | /\*\* |
  | 485 | 485 | \* Display Unsupported theme notice if the current theme does add support for 'header-footer-elementor' |
  | 486 | 486 | \* |
  | 487 | 487 | \* @param array $hfe\_settings\_tabs settings array tabs. |
  | 488 | 488 | \* @since 1.0.3 |
  | 489 | 489 | \* @return array |
  | 490 | 490 | \*/ |
  | 491 | 491 | public function setup\_unsupported\_theme( $hfe\_settings\_tabs = [] ) { |
  | 492 | 492 | if ( ! current\_theme\_supports( 'header-footer-elementor' ) ) { |
  | 493 | 493 | $hfe\_settings\_tabs['hfe\_settings'] = [ |
  | 494 | 494 | 'name' => \_\_( 'Theme Support', 'header-footer-elementor' ), |
  | 495 | 495 | 'url'  => admin\_url( 'themes.php?page=hfe-settings' ), |
  | 496 | 496 | ]; |
  | 497 | 497 | } |
  | 498 | 498 | return $hfe\_settings\_tabs; |
  | 499 | 499 | } |
  | 500 | 500 |  |
  | 501 | 501 | /\*\* |
  | 502 | 502 | \* Add support for theme if the current theme does add support for 'header-footer-elementor' |
  | 503 | 503 | \* |
  | 504 | 504 | \* @since  1.6.1 |
  | 505 | 505 | \* @return void |
  | 506 | 506 | \*/ |
  | 507 | 507 | public function setup\_fallback\_support() { |
  | 508 | 508 |  |
  | 509 | 509 | if ( ! current\_theme\_supports( 'header-footer-elementor' ) ) { |
  | 510 | 510 | $hfe\_compatibility\_option = get\_option( 'hfe\_compatibility\_option', '1' ); |
  | 511 | 511 |  |
  | 512 | 512 | if ( '1' === $hfe\_compatibility\_option ) { |
  | 513 | 513 | if ( ! class\_exists( 'HFE\_Default\_Compat' ) ) { |
  | 514 | 514 | require\_once HFE\_DIR . 'themes/default/class-hfe-default-compat.php'; |
  | 515 | 515 | } |
  | 516 | 516 | } elseif ( '2' === $hfe\_compatibility\_option ) { |
  | 517 | 517 | require HFE\_DIR . 'themes/default/class-global-theme-compatibility.php'; |
  | 518 | 518 | } |
  | 519 | 519 | } |
  | 520 | 520 | } |
  | 521 | 521 |  |
  | 522 | 522 | /\*\* |
  | 523 | 523 | \* Prints the Header content. |
  | 524 | 524 | \* |
  | 525 | 525 | \* @return void |
  | 526 | 526 | \*/ |
  | 527 | 527 | public static function get\_header\_content() { |
  | 528 | 528 | $header\_content = self::$elementor\_instance->frontend->get\_builder\_content\_for\_display( get\_hfe\_header\_id() ); |
  | 529 | 529 | echo $header\_content; // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 530 | 530 | } |
  | 531 | 531 |  |
  | 532 | 532 | /\*\* |
  | 533 | 533 | \* Prints the Footer content. |
  | 534 | 534 | \* |
  | 535 | 535 | \* @return void |
  | 536 | 536 | \*/ |
  | 537 | 537 | public static function get\_footer\_content() { |
  | 538 | 538 | echo "<div class='footer-width-fixer'>"; |
  | 539 | 539 | echo self::$elementor\_instance->frontend->get\_builder\_content\_for\_display( get\_hfe\_footer\_id() ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 540 | 540 | echo '</div>'; |
  | 541 | 541 | } |
  | 542 | 542 |  |
  | 543 | 543 | /\*\* |
  | 544 | 544 | \* Prints the Before Footer content. |
  | 545 | 545 | \* |
  | 546 | 546 | \* @return void |
  | 547 | 547 | \*/ |
  | 548 | 548 | public static function get\_before\_footer\_content() { |
  | 549 | 549 | echo "<div class='footer-width-fixer'>"; |
  | 550 | 550 | echo self::$elementor\_instance->frontend->get\_builder\_content\_for\_display( hfe\_get\_before\_footer\_id() ); // phpcs:ignore WordPress.Security.EscapeOutput.OutputNotEscaped |
  | 551 | 551 | echo '</div>'; |
  | 552 | 552 | } |
  | 553 | 553 |  |
  | 554 | 554 | /\*\* |
  | 555 | 555 | \* Get option for the plugin settings |
  | 556 | 556 | \* |
  | 557 | 557 | \* @param  string $setting Option name. |
  | 558 | 558 | \* @param  string $default Default value to be received if the option value is not stored in the option. |
  | 559 | 559 | \* |
  | 560 | 560 | \* @return mixed | string |
  | 561 | 561 | \*/ |
  | 562 | 562 | public static function get\_settings( $setting = '', $default = '' ) { |
  | 563 | 563 | if ( 'type\_header' == $setting || 'type\_footer' == $setting || 'type\_before\_footer' == $setting ) { |
  | 564 | 564 | $templates = self::get\_template\_id( $setting ); |
  | 565 | 565 |  |
  | 566 | 566 | $template = ! is\_array( $templates ) ? $templates : $templates[0]; |
  | 567 | 567 |  |
  | 568 | 568 | $template = apply\_filters( "hfe\_get\_settings\_{$setting}", $template ); |
  | 569 | 569 |  |
  | 570 | 570 | return $template; |
  | 571 | 571 | } |
  | 572 | 572 | } |
  | 573 | 573 |  |
  | 574 | 574 | /\*\* |
  | 575 | 575 | \* Get header or footer template id based on the meta query. |
  | 576 | 576 | \* |
  | 577 | 577 | \* @param  String $type Type of the template header/footer. |
  | 578 | 578 | \* |
  | 579 | 579 | \* @return Mixed       Returns the header or footer template id if found, else returns string ''. |
  | 580 | 580 | \*/ |
  | 581 | 581 | public static function get\_template\_id( $type ) { |
  | 582 | 582 | $option = [ |
  | 583 | 583 | 'location'  => 'ehf\_target\_include\_locations', |
  | 584 | 584 | 'exclusion' => 'ehf\_target\_exclude\_locations', |
  | 585 | 585 | 'users'     => 'ehf\_target\_user\_roles', |
  | 586 | 586 | ]; |
  | 587 | 587 |  |
  | 588 | 588 | $hfe\_templates = Astra\_Target\_Rules\_Fields::get\_instance()->get\_posts\_by\_conditions( 'elementor-hf', $option ); |
  | 589 | 589 |  |
  | 590 | 590 | foreach ( $hfe\_templates as $template ) { |
  | 591 | 591 | if ( get\_post\_meta( absint( $template['id'] ), 'ehf\_template\_type', true ) === $type ) { |
  | 592 | 592 | if ( function\_exists( 'pll\_current\_language' ) ) { |
  | 593 | 593 | if ( pll\_current\_language( 'slug' ) == pll\_get\_post\_language( $template['id'], 'slug' ) ) { |
  | 594 | 594 | return $template['id']; |
  | 595 | 595 | } |
  | 596 | 596 | } else { |
  | 597 | 597 | return $template['id']; |
  | 598 | 598 | } |
  | 599 | 599 | } |
  | 600 | 600 | } |
  | 601 | 601 |  |
  | 602 | 602 | return ''; |
  | 603 | 603 | } |
  | 604 | 604 |  |
  | 605 | 605 | /\*\* |
  | 606 | 606 | \* Callback to shortcode. |
  | 607 | 607 | \* |
  | 608 | 608 | \* @param array $atts attributes for shortcode. |
  | 609 | 609 | \* @return string |
  | 610 | 610 | \*/ |
  | 611 | 611 | public function render\_template( $atts ) { |
  | 612 | 612 | $atts = shortcode\_atts( |
  | 613 | 613 | [ |
  | 614 | 614 | 'id' => '', |
  | 615 | 615 | ], |
  | 616 | 616 | $atts, |
  | 617 | 617 | 'hfe\_template' |
  | 618 | 618 | ); |
  | 619 | 619 |  |
  | 620 | 620 | $id = ! empty( $atts['id'] ) ? apply\_filters( 'hfe\_render\_template\_id', intval( $atts['id'] ) ) : ''; |
  | 621 | 621 |  |
  | 622 | 622 | if ( empty( $id ) ) { |
  | 623 | 623 | return ''; |
  | 624 | 624 | } |
  | 625 | 625 |  |
  |  | 626 | // Check if the current user has permission to edit posts. |
  |  | 627 | if ( ! current\_user\_can( 'edit\_post', $id ) ) { |
  |  | 628 | $post\_status = get\_post\_status( $id ); |
  |  | 629 | // Prevent access to drafts, private, pending, and password-protected posts for unauthorized users. |
  |  | 630 | if ( in\_array( $post\_status, [ 'draft', 'private', 'pending' ], true ) || post\_password\_required( $id ) ) { |
  |  | 631 | return ''; // Prevent access to restricted posts. |
  |  | 632 | } |
  |  | 633 | } |
  |  | 634 |  |
  | 626 | 635 | if ( class\_exists( '\Elementor\Core\Files\CSS\Post' ) ) { |
  | 627 | 636 | $css\_file = new \Elementor\Core\Files\CSS\Post( $id ); |
  | 628 | 637 | } elseif ( class\_exists( '\Elementor\Post\_CSS\_File' ) ) { |
  | 629 | 638 | // Load elementor styles. |
  | 630 | 639 | $css\_file = new \Elementor\Post\_CSS\_File( $id ); |
  | 631 | 640 | } |
  | 632 | 641 | $css\_file->enqueue(); |
  | 633 | 642 |  |
  | 634 | 643 | return self::$elementor\_instance->frontend->get\_builder\_content\_for\_display( $id ); |
  | 635 | 644 | } |
  | 636 | 645 | } |
  | 637 | 646 | /\*\* |
  | 638 | 647 | \* Is elementor plugin installed. |
  | 639 | 648 | \*/ |
  | 640 | 649 | if ( ! function\_exists( '\_is\_elementor\_installed' ) ) { |
  | 641 | 650 |  |
  | 642 | 651 | /\*\* |
  | 643 | 652 | \* Check if Elementor is installed |
  | 644 | 653 | \* |
  | 645 | 654 | \* @since 1.6.0 |
  | 646 | 655 | \* |
  | 647 | 656 | \* @access public |
  | 648 | 657 | \* @return bool |
  | 649 | 658 | \*/ |
  | 650 | 659 | function \_is\_elementor\_installed() { |
  | 651 | 660 | return ( file\_exists( WP\_PLUGIN\_DIR . '/elementor/elementor.php' ) ) ? true : false; |
  | 652 | 661 | } |
  | 653 | 662 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3173344)
* [Zip Archive](?format=zip&new=3173344)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

