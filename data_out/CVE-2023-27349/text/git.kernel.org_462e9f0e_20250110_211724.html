

| [cgit logo](/) | [index](/) : [bluez.git](/pub/scm/bluetooth/bluez.git/) | master |
| --- | --- | --- |
| Bluetooth protocol stack for Linux | Marcel Holtmann |

| [about](/pub/scm/bluetooth/bluez.git/about/)[summary](/pub/scm/bluetooth/bluez.git/)[refs](/pub/scm/bluetooth/bluez.git/refs/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)[log](/pub/scm/bluetooth/bluez.git/log/)[tree](/pub/scm/bluetooth/bluez.git/tree/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)[commit](/pub/scm/bluetooth/bluez.git/commit/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)[diff](/pub/scm/bluetooth/bluez.git/diff/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)[stats](/pub/scm/bluetooth/bluez.git/stats/)[homepage](http://www.bluez.org) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-03-22 11:34:24 -0700 |
| --- | --- | --- |
| committer | Luiz Augusto von Dentz <luiz.von.dentz@intel.com> | 2023-03-30 16:44:46 -0700 |
| commit | [f54299a850676d92c3dafd83e9174fcfe420ccc9](/pub/scm/bluetooth/bluez.git/commit/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9) ([patch](/pub/scm/bluetooth/bluez.git/patch/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)) | |
| tree | [ffc78bb31559add7c2197915c7e02f1eea3b77a9](/pub/scm/bluetooth/bluez.git/tree/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9) | |
| parent | [5106fe8c868d5ec69af70f299eeedad42b900f69](/pub/scm/bluetooth/bluez.git/commit/?id=5106fe8c868d5ec69af70f299eeedad42b900f69) ([diff](/pub/scm/bluetooth/bluez.git/diff/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9&id2=5106fe8c868d5ec69af70f299eeedad42b900f69)) | |

avrcp: Fix crash while handling unsupported eventsThe following crash can be observed if the remote peer send and
unsupported event:
ERROR: AddressSanitizer: heap-use-after-free on address 0x60b000148f11
at pc 0x559644552088 bp 0x7ffe28b3c7b0 sp 0x7ffe28b3c7a0
WRITE of size 1 at 0x60b000148f11 thread T0
#0 0x559644552087 in avrcp\_handle\_event profiles/audio/avrcp.c:3907
#1 0x559644536c22 in control\_response profiles/audio/avctp.c:939
#2 0x5596445379ab in session\_cb profiles/audio/avctp.c:1108
#3 0x7fbcb3e51c43 in g\_main\_context\_dispatch (/lib/x86\_64-linux-gnu/libglib-2.0.so.0+0x55c43)
#4 0x7fbcb3ea66c7 (/lib/x86\_64-linux-gnu/libglib-2.0.so.0+0xaa6c7)
#5 0x7fbcb3e512b2 in g\_main\_loop\_run (/lib/x86\_64-linux-gnu/libglib-2.0.so.0+0x552b2)
#6 0x559644754ab6 in mainloop\_run src/shared/mainloop-glib.c:66
#7 0x559644755606 in mainloop\_run\_with\_signal src/shared/mainloop-notify.c:188
#8 0x5596445bb963 in main src/main.c:1289
#9 0x7fbcb3bafd8f in \_\_libc\_start\_call\_main ../sysdeps/nptl/libc\_start\_call\_main.h:58
#10 0x7fbcb3bafe3f in \_\_libc\_start\_main\_impl ../csu/libc-start.c:392
#11 0x5596444e8224 in \_start (/usr/local/libexec/bluetooth/bluetoothd+0xf0224)
[Diffstat](/pub/scm/bluetooth/bluez.git/diff/?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)

| -rw-r--r-- | [profiles/audio/avrcp.c](/pub/scm/bluetooth/bluez.git/diff/profiles/audio/avrcp.c?id=f54299a850676d92c3dafd83e9174fcfe420ccc9) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/profiles/audio/avrcp.c b/profiles/audio/avrcp.cindex 80f34c7a77..dda9a303fb 100644--- a/[profiles/audio/avrcp.c](/pub/scm/bluetooth/bluez.git/tree/profiles/audio/avrcp.c?id=5106fe8c868d5ec69af70f299eeedad42b900f69)+++ b/[profiles/audio/avrcp.c](/pub/scm/bluetooth/bluez.git/tree/profiles/audio/avrcp.c?id=f54299a850676d92c3dafd83e9174fcfe420ccc9)@@ -3901,6 +3901,12 @@ static gboolean avrcp\_handle\_event(struct avctp \*conn, uint8\_t code, case AVRCP\_EVENT\_UIDS\_CHANGED: avrcp\_uids\_changed(session, pdu); break;+ default:+ if (event > AVRCP\_EVENT\_LAST) {+ warn("Unsupported event: %u", event);+ return FALSE;+ }+ break; }  session->registered\_events |= (1 << event); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 21:16:02 +0000

