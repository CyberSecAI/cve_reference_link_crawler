

| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [mupdf.git](/cgi-bin/cgit.cgi/mupdf.git/ "mupdf.git") | 1.18.x 1.19.x 1.20.x 1.21.x 1.22.x 1.23.x 1.24.x 1.25.x android-muso android-muso-signing android-openjpeg-2.3.1 css fontconfig java-empty-store lcms lcms2 line\_art\_filter master muso muso-3.9-release muso-temporary-hack objc-openjpeg-2.3.1 release-1.10a release\_1.8 so so-tess2 stext-flags win-openjpeg-2.3.1 winRT winphone |
| --- | --- | --- |
| MuPDF library | Chris Liddell |

| [summary](/cgi-bin/cgit.cgi/mupdf.git/)[refs](/cgi-bin/cgit.cgi/mupdf.git/refs/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)[log](/cgi-bin/cgit.cgi/mupdf.git/log/)[tree](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)[commit](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)[diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tor Andersson <tor.andersson@artifex.com> | 2020-06-03 18:10:43 +0200 |
| --- | --- | --- |
| committer | Tor Andersson <tor.andersson@artifex.com> | 2020-06-05 20:05:08 +0200 |
| commit | [8719e07834d6a72b6b4131539e49ed1e8e2ff79e](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e) ([patch](/cgi-bin/cgit.cgi/mupdf.git/patch/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)) | |
| tree | [5e5bca642ceb8df266bc6e47d2093de55d9fdb1a](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e) | |
| parent | [541d82ca29365e0225ed0bb7e1cb7b2c0b82225e](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=541d82ca29365e0225ed0bb7e1cb7b2c0b82225e) ([diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e&id2=541d82ca29365e0225ed0bb7e1cb7b2c0b82225e)) | |

Bug 701295: Fix use of stale pointer after realloc.fz\_run\_t3\_glyph may cause recursion, which means that
svg\_dev\_text\_span\_as\_path\_defs needs to be re-entrant at that point.
Recalculate the 'fnt' pointer from the sdev->fonts array after calling
a function that may trigger an array realloc.
[Diffstat](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)

| -rw-r--r-- | [source/fitz/svg-device.c](/cgi-bin/cgit.cgi/mupdf.git/diff/source/fitz/svg-device.c?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/source/fitz/svg-device.c b/source/fitz/svg-device.cindex 88f8cfbd4..0130cadc9 100644--- a/[source/fitz/svg-device.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/fitz/svg-device.c?id=541d82ca29365e0225ed0bb7e1cb7b2c0b82225e)+++ b/[source/fitz/svg-device.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/fitz/svg-device.c?id=8719e07834d6a72b6b4131539e49ed1e8e2ff79e)@@ -494,6 +494,7 @@ svg\_dev\_text\_span\_as\_paths\_defs(fz\_context \*ctx, fz\_device \*dev, fz\_text\_span \*s shift.e = -rect.x0; shift.f = -rect.y0; fz\_run\_t3\_glyph(ctx, span->font, gid, shift, dev);+ fnt = &sdev->fonts[font\_idx]; /\* recursion may realloc the font array! \*/ } fz\_write\_printf(ctx, out, "</symbol>\n"); out = end\_def(ctx, sdev); |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 09:33:59 +0000

