

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21626)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21626)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-21626](/browse/XWIKI-21626)

# XSS through conflict resolution

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21626 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.10.8](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.10.8 "15.10.8 "), [16.3.0-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+16.3.0-rc-1 "16.3.0-rc-1 ")
* **Affects Version/s:**
  11.8-rc-1
* **Component/s:**
  [Web - Templates & Resources](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Web+-+Templates+%26+Resources%22 "Web - Templates & Resources ")
* **Labels:**
  + [attack\_xss](/issues/?jql=labels+%3D+attack_xss "attack_xss")
  + [attacker\_edit](/issues/?jql=labels+%3D+attacker_edit "attacker_edit")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. As admin, edit a document. Perform some changes but do not save yet.
2. As a user without script right in another browser context, edit the same document, dismissing the conflict warning. Add <script>alert('XSS')</script> in the content and cause a conflict, e.g., by deleting everything else. Save the document.
3. As admin, save the document.
4. In the conflict popup, select "Fix each conflict individually"

**Expected result:**

The conflict is displayed but no alert.

**Actual result:**

An alert with content "XSS" is displayed.

I suspect this is a result of missing escaping in <https://github.com/xwiki/xwiki-platform/blob/b6080ac1552e6c1c19a709d07df1bf94414200d5/xwiki-platform-core/xwiki-platform-web/xwiki-platform-web-templates/src/main/resources/templates/diff_macros.vm#L85>. This may also allow XWiki syntax injection if the conflict is displayed in a context with XWiki syntax support. This code has been introduced in [~~XWIKI-16464~~](https://jira.xwiki.org/browse/XWIKI-16464 "Merge conflict: allow choice by chunks and custom fixes"), thus the affects version of 11.8.

The following screenshot shows the attack in action. Here, I added alerts in both versions but it is sufficient to have one of them, the example triggers two alerts, the shown alert is from the other save:

[![](https://jira.xwiki.org/secure/thumbnail/42059/_thumb_42059.png)](/secure/attachment/42059/42059_screenshot-1.png "screenshot-1.png")

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-21626?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-21626?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-21626?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-21626?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-21626?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-21626?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/72645.zip "Download all attachments as a ZIP file")

1. [![screenshot-1.png](https://jira.xwiki.org/secure/thumbnail/42059/_thumb_42059.png)](/secure/attachment/42059/screenshot-1.png "screenshot-1.png - Latest 28/Nov/23 13:25 - Michael Hamann")[screenshot-1.png](/secure/attachment/42059/screenshot-1.png "screenshot-1.png - Latest 28/Nov/23 13:25 - Michael Hamann")285 kB28/Nov/23 13:25
#### Issue Links

is caused by

![Improvement - An improvement or enhancement to an existing feature or task.](/secure/viewavatar?size=xsmall&avatarId=13510&avatarType=issuetype "Improvement - An improvement or enhancement to an existing feature or task.")
[XWIKI-16464](/browse/XWIKI-16464)
Merge conflict: allow choice by chunks and custom fixes

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Security Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-692v-783f-mg8x)

#### Activity

#### People

Assignee:

![pjeanjean](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Pierre Jeanjean

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

28/Nov/23 12:01

Updated:

31/Jul/24 11:23

Resolved:

21/Mar/24 16:10

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

