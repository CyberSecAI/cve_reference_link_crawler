

| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D41475975) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [DEF Con 32 – AMD Sinkclose Universal Ring-2 Privilege Escalation (Not Redacted) [pdf]](https://media.defcon.org/DEF%20CON%2032/DEF%20CON%2032%20presentations/DEF%20CON%2032%20-%20Enrique%20Nissim%20Krzysztof%20Okupski%20-%20AMD%20Sinkclose%20Universal%20Ring-2%20Privilege%20Escalation.pdf) ([defcon.org](from?site=defcon.org)) | | --- | --- | --- | |  | | 195 points by [ruik](user?id=ruik) [4 months ago](item?id=41475975)  | [hide](hide?id=41475975&goto=item%3Fid%3D41475975) | [past](https://hn.algolia.com/?query=DEF%20Con%2032%20%E2%80%93%20AMD%20Sinkclose%20Universal%20Ring-2%20Privilege%20Escalation%20%28Not%20Redacted%29&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=41475975&auth=4309ae813dfd18218d56b1c38afeefb97393d054) | [30 comments](item?id=41475975) |  | |  |  | [tux3](user?id=tux3) [4 months ago](item?id=41518847)   | [next](#41518946) [–]  I was confused by the title, by "Ring-2" it means "Ring -2" (minus two), which is "traditionally" SMM (System Management Mode), a horrible relic that lets your BIOS/UEFI silently steal the CPU from the OS to implement janky drivers or workarounds directly in the firmware (occasionally causing all sorts of mayhem). (Actual Ring 2 is very rarely seen, so perhaps I should have known!) | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [kaoD](user?id=kaoD) [4 months ago](item?id=41521768)   | [parent](#41518847) | [next](#41518946) [–]  Wait, there are negative rings!? I'd like to learn more about this but it's not a very easy to search term. Any pointers? | | --- | --- | --- | | | |  |  | [ngneer](user?id=ngneer) [4 months ago](item?id=41522569)   | [root](#41518847) | [parent](#41521768) | [next](#41522015) [–]  Just terminology. Whenever a new higher-privileged entity is created, it is sometimes described as a negative ring. There was a time when people thought if we could put the secure code in a lower ring, then with it we could protect the rest of the system. With virtualization, the hypervisor is in ring -1, which is technically not a ring, but rather a mode called VMX root operation, post-VMXON. This enables things like the blue pill attack, where the hypervisor is itself presented with a false image of the underlying physical hardware, by a malicious layer. You can find the same pattern in ARM TrustZone, where the secure code is repeatedly broken. "if only we had ring -N" | | --- | --- | --- | | | |  |  | [dwoldrich](user?id=dwoldrich) [4 months ago](item?id=41526838)   | [root](#41518847) | [parent](#41522569) | [next](#41522015) [–]  Crazy complexity. Mind blown! | | --- | --- | --- | | | |  |  | [Dalewyn](user?id=Dalewyn) [4 months ago](item?id=41527097)   | [root](#41518847) | [parent](#41526838) | [next](#41537118) [–]  It's the same reason that the nominal thrust level on the Space Shuttle Main Engines is 104.5%[1]. No, not 100% (it was originally), 104.5%. Why? Because you don't go back and change all your rules and documentation following subsequent developments in the field, that causes unnecessary confusion and errors down the road. [1]: <https://en.wikipedia.org/wiki/RS-25#Engine_throttle/output> | | --- | --- | --- | | | |  |  | [ngneer](user?id=ngneer) [3 months ago](item?id=41537118)   | [root](#41518847) | [parent](#41526838) | [prev](#41527097) | [next](#41522015) [–]  Likewise. Engineers do not idle well. | | --- | --- | --- | | | |  |  | [hypeatei](user?id=hypeatei) [4 months ago](item?id=41522015)   | [root](#41518847) | [parent](#41521768) | [prev](#41522569) | [next](#41522282) [–]  Good article on negative rings: [https://medium.com/swlh/negative-rings-in-intel-architecture...](https://medium.com/swlh/negative-rings-in-intel-architecture-the-security-threats-youve-probably-never-heard-of-d725a4b6f831) | | --- | --- | --- | | | |  |  | [dooglius](user?id=dooglius) [4 months ago](item?id=41522282)   | [root](#41518847) | [parent](#41521768) | [prev](#41522015) | [next](#41521863) [–]  I don't think there actually are, in the sense that there isn't a register somewhere with these values that gets compared against, the way there is with rings 0-3. I've only heard this in the context of reverse engineers describing the layers of access that undocumented parts of a modern CPU system have, I think it's just a made-up analogy. There is presumably some proprietary documentation out there with more official names. | | --- | --- | --- | | | |  |  | [BearOso](user?id=BearOso) [4 months ago](item?id=41521863)   | [root](#41518847) | [parent](#41521768) | [prev](#41522282) | [next](#41521854) [–]  I can't imagine it's a standard thing. On X86 we have ring 0 and 3, with 1 and 2 never used and removed in newer CPUs. ARM has 3 or 4 privilege layers, but they're named differently. They probably just called it ring -2 because it's a couple layers below ring 0. | | --- | --- | --- | | | |  |  | [adrian\_b](user?id=adrian_b) [4 months ago](item?id=41522457)   | [root](#41518847) | [parent](#41521863) | [next](#41521951) [–]  Arm (Aarch64) Exception Level 0 corresponds to Ring 3 of x86. Arm (Aarch64) Exception Level 1 corresponds to Ring 0 of x86. Arm (Aarch64) Exception Level 2 corresponds to the Hypervisor level a.k.a. Ring -1 of x86. Arm (Aarch64) Exception Level 3 corresponds to the System Management Mode a.k.a. Ring -2 of x86. Fortunately, in Arm EL3 the same instruction set is used as in any other level, unlike in x86, where SMM uses the obsolete 16-bit 8086 ISA, so for compiling programs that will be executed in SMM you have to use a special tool set. Unfortunately, both the Arm EL3 and the x86 SMM allow the manufacturers of computing devices to do things that are either stupid or in direct contradiction with the interests of the owners of the devices and the owners may not be able to do anything to correct this, unless they can exploit vulnerabilities like the one that has now been patched by AMD. There are no valid arguments for the existence of SMM and EL3 and the fact that they are not forbidden by law is a disgrace for the computing industry. Arm EL3 has been created as an imitation of the Intel SMM. The Intel SMM has been created because Microsoft was too lazy to introduce the required power management functions in the Windows and MS-DOS operating systems, so they passed the task to the motherboard or laptop manufacturers, for which Intel has provided SMM, to enable this. | | --- | --- | --- | | | |  |  | [okanat](user?id=okanat) [4 months ago](item?id=41521951)   | [root](#41518847) | [parent](#41521863) | [prev](#41522457) | [next](#41524815) [–]  Ring -1 is the host system / virtual machine manager when the ring 0 OS is running as a VM. Ring -2 is more privileged than that since it can interrupt Ring -1 and can affect the execution of VM instructions. | | --- | --- | --- | | | |  |  | [colejohnson66](user?id=colejohnson66) [4 months ago](item?id=41524815)   | [root](#41518847) | [parent](#41521863) | [prev](#41521951) | [next](#41524729) [–]  Rings 1 and 2 are still very much present in your desktop x86 machine; Your OS just doesn't use them. *X86-S* will remove them, but no CPUs implement that reduced architecture, and Intel has made no public announcements about future generations that will. | | --- | --- | --- | | | |  |  | [numpad0](user?id=numpad0) [4 months ago](item?id=41524729)   | [root](#41518847) | [parent](#41521863) | [prev](#41524815) | [next](#41521854) [–]  Existing *super*visors use 0, so when x86 virtualization was invented they added -1 for *hyper*visors. and so... are the monitors running on ring -2 *ultra*visors? | | --- | --- | --- | | | |  |  | [veltas](user?id=veltas) [4 months ago](item?id=41521854)   | [root](#41518847) | [parent](#41521768) | [prev](#41521863) | [next](#41518946) [–]  It's called System Management Mode, it's in official Intel documentation for x86. | | --- | --- | --- | | | |  |  | [pella](user?id=pella) [4 months ago](item?id=41518946)   | [prev](#41518847) | [next](#41526612) [–]  AMD fix status: [https://www.amd.com/en/resources/product-security/bulletin/a...](https://www.amd.com/en/resources/product-security/bulletin/amd-sb-7014.html) <https://ubuntu.com/security/CVE-2023-31315> | | --- | --- | --- | | | |  |  | [edelbitter](user?id=edelbitter) [4 months ago](item?id=41524499)   | [parent](#41518946) | [next](#41526612) [–]  > Please refer to your OEM for the BIOS update specific to your product. Unless running hardware also used by powerful hosting providers (some of which care for security), these mitigation will not reach many systems. Checked a few "client" samples, seems like MSI has provided updated binary blobs, ASRock has provided some, Gigabyte has provided broken ones first and then backdated the new ones, ASUS (ROG/RUF/CSM) and Biostar customers are still waiting. | | --- | --- | --- | | | |  |  | [aftbit](user?id=aftbit) [4 months ago](item?id=41526562)   | [root](#41518946) | [parent](#41524499) | [next](#41526612) [–]  So wait, is this fixed in BIOS or microcode? [https://git.kernel.org/pub/scm/linux/kernel/git/firmware/lin...](https://git.kernel.org/pub/scm/linux/kernel/git/firmware/linux-firmware.git/commit?id=091bd5adf19c7ab01214c64689952acb4833b21d) | | --- | --- | --- | | | |  |  | [yencabulator](user?id=yencabulator) [4 months ago](item?id=41526976)   | [root](#41518946) | [parent](#41526562) | [next](#41526612) [–]  Based on my reading of [https://www.amd.com/en/resources/product-security/bulletin/a...](https://www.amd.com/en/resources/product-security/bulletin/amd-sb-7014.html) there's a microcode fix for EPYC generations 1-4 that requires no downtime, everything else needs a firmware update. | | --- | --- | --- | | | |  |  | [Taniwha](user?id=Taniwha) [4 months ago](item?id=41526612)   | [prev](#41518946) | [next](#41521704) [–]  The paper asks "why does this feature exist?" - probably they haven't gone far enough back in history (note I've worked on x86 clones I understand this stuff in far too great a detail) Originally on x86 systems memory was in VERY short supply - SMM mode memory was the DRAM that the VGA window in low memory (0xa0000) overlaid - normal code couldn't access it because the video card claimed memory accesses to that range of addresses - so the north bridge when the CPU was in SMM mode switched data and instruction accesses to that range to go to DRAM rather than the VGA card .... that's great except remember that SMM mode was used for special setup stuff for laptops .... sometimes they need to be able to display on the screen .... that's what this special mode was originally for: so that SMM mode code can display on the screen (it's also likely why SMM mode graphics were so primitive, you're switching in and out of this mode for every pixel you write) | | --- | --- | --- | | | |  |  | [jandrese](user?id=jandrese) [4 months ago](item?id=41521704)   | [prev](#41526612) | [next](#41523758) [–]  Sometimes it's nice to see SMP causing headaches for the "bad" guys for a change. They did eventually work around it, but half of this paper is working around problems where the second core gets out of sync and crashes as soon as they tried to exploit the system. | | --- | --- | --- | | | |  |  | [cesarb](user?id=cesarb) [4 months ago](item?id=41524122)   | [parent](#41521704) | [next](#41524673) [–]  The most interesting part, to me, was that entering SMM pauses all cores at once, instead of doing the work in a single core like normal interrupts. That sounds like a performance killer, and I hope entering SMM is really rare in modern systems. | | --- | --- | --- | | | |  |  | [jandrese](user?id=jandrese) [4 months ago](item?id=41524309)   | [root](#41521704) | [parent](#41524122) | [next](#41524673) [–]  My information is pretty out of date, but when TPMs first arrived on the scene there was a fair bit of talk about using them as secure enclaves where you could do honest to god "trusted computing" with a fully verified stack on ordinary PC hardware. This largely didn't work out because TPMs were slow and every time you tried to do it you basically stalled out the rest of the machine, so once execution came back to the CPU everything was out of sync and all of the attached hardware like network cards and video cards crashed or froze. TPMs ended up only being useful as a place to store keys and occasionally cryptographically sign small amounts of data. That said, the SMM can probably be a little less intrusive if it needs to be. Like it doesn't have to freeze the cores if all it is doing is reading your bitcoin addresses and passphrase out of memory, just stalling the memory bus for a moment or two. | | --- | --- | --- | | | |  |  | [ein0p](user?id=ein0p) [4 months ago](item?id=41524673)   | [parent](#41521704) | [prev](#41524122) | [next](#41523758) [–]  These aren’t the “bad” guys. The “bad” guys are the people who put that backdoor in, deliberately or through lack of oversight. | | --- | --- | --- | | | |  |  | [transpute](user?id=transpute) [4 months ago](item?id=41523758)   | [prev](#41521704) | [next](#41519631) [–]  Android pKVM hypervisor tries to constrain vendor-specific Arm EL3 TrustZone (~x86 SMM Ring-2) on Pixel 7/8/9, <https://lkml.org/lkml/2022/11/16/1241> ```   pKVM's primary goal is to protect guest pages from a compromised host by enforcing access control restrictions using stage-2 page-tables. Sadly, this cannot prevent TrustZone from accessing non-secure memory, and a compromised host could, for example, perform a 'confused deputy' attack by asking TrustZone to use pages that have been donated to protected guests. This would effectively allow the host to have TrustZone exfiltrate guest secrets on its behalf, hence breaking the isolation that pKVM intends to provide..    FF-A provides (among other things) a set of memory management APIs allowing the Normal World to share, donate or lend pages with Secure. By monitoring these SMCs, pKVM can ensure that the pages that are shared, lent or donated to Secure by the host kernel are only pages that it owns.. the robustness of this approach relies on having all Secure Software on the device use the FF-A protocol for memory management transactions with the normal world, and not use vendor-specific SMCs that pKVM is unable to parse.  ``` On x86, SMM attestation was introduced by Intel (PPAM / Hardware Shield, 11+ gen) and AMD, [https://www.microsoft.com/en-us/security/blog/2020/11/12/sys...](https://www.microsoft.com/en-us/security/blog/2020/11/12/system-management-mode-deep-dive-how-smm-isolation-hardens-the-platform/) *> Because of its traditionally unfettered access to memory and device resources, SMM is a known vector of attack for gaining access to the OS and hardware.. One could have perfect code in SMM and still be affected by behavior like trampolining into secure kernel code.. Isolating SMM is implemented in three parts: OEMs implement a policy that states what they require access to; the chip vendor enforces this policy on SMIs; and the chip vendor reports compliance to this policy to the OS.* | | --- | --- | --- | | | |  |  | [HowardStark](user?id=HowardStark) [4 months ago](item?id=41519631)   | [prev](#41523758) | [next](#41523272) [–]  Is the recorded session available anywhere? Generally prefer the slides with the presenter walking us through them. | | --- | --- | --- | | | |  |  | [RockRobotRock](user?id=RockRobotRock) [4 months ago](item?id=41524426)   | [parent](#41519631) | [next](#41519820) [–]  magnet:?xt=urn:btih:6b0c446541294d6b4ac0cfd6cdedf48e20034ad4&dn=defcon-talks&tr=udp%3A%2F%2Ftracker.opentrackr.org%3A1337%2Fannounce&tr=udp%3A%2F%2Fopen.tracker.cl%3A1337%2Fannounce&tr=udp%3A%2F%2Fopen.demonii.com%3A1337%2Fannounce&tr=udp%3A%2F%2Fopen.stealth.si%3A80%2Fannounce&tr=udp%3A%2F%2Ftracker.torrent.eu.org%3A451%2Fannounce&tr=udp%3A%2F%2Fexplodie.org%3A6969%2Fannounce | | --- | --- | --- | | | |  |  | [colejohnson66](user?id=colejohnson66) [4 months ago](item?id=41519820)   | [parent](#41519631) | [prev](#41524426) | [next](#41526985) [–]  DEF CON recordings tend to take a while to appear. This one was supposedly recorded,[0] but I can't find it. [0]: <https://info.defcon.org/event/?id=54863> | | --- | --- | --- | | | |  |  | [yencabulator](user?id=yencabulator) [4 months ago](item?id=41526985)   | [parent](#41519631) | [prev](#41519820) | [next](#41523272) [–]  It *was* available live for a while. Defcon's video publishing kinda sucks. | | --- | --- | --- | | | |  |  | [paulmd](user?id=paulmd) [4 months ago](item?id=41523272)   | [prev](#41519631) [–]  it's funny that they have to debunk the "root is root, why would AMD patch this" that goes around every time there's a serious issue that allows guest-root escape from virtualized containers. the same thing happened with the ryzenfall/masterkey exploit, where people were just in utter denial there was an actual exploit there, because root is root! People literally spent more time talking about who released it and their background image than the actual exploit. AMD obvious cannot have exploits, that's only an intel thing. /s *"alleged" flaws" (rolls eyes) [https://old.reddit.com/r/Amd/comments/845w8e/alleged\_amd\_zen...](https://old.reddit.com/r/Amd/comments/845w8e/alleged_amd_zen_security_flaws_megathread/)* assassination attempt\* [https://old.reddit.com/r/hardware/comments/849paz/assassinat...](https://old.reddit.com/r/hardware/comments/849paz/assassination_attempt_on_amd_by_viceroy_research/) doxxing the researchers: [https://old.reddit.com/r/hardware/comments/845xks/some\_backg...](https://old.reddit.com/r/hardware/comments/845xks/some_background_information_on_the_new_amd/) [https://old.reddit.com/r/Amd/comments/84tftt/clarification\_a...](https://old.reddit.com/r/Amd/comments/84tftt/clarification_about_the_recent_vulnerabilities/) [https://old.reddit.com/r/Amd/comments/8589t2/cts\_labs\_clarif...](https://old.reddit.com/r/Amd/comments/8589t2/cts_labs_clarifications_on_ryzenfall_masterkey/) HN discussions were not much better, although tpacek is cool. <https://news.ycombinator.com/item?id=16576342> <https://news.ycombinator.com/item?id=16576516> <https://news.ycombinator.com/item?id=16597626> | | --- | --- | --- | | | |  |  | [paulmd](user?id=paulmd) [4 months ago](item?id=41527144)   | [parent](#41523272) [–]  PS: they did release technical details once the mitigations had been released etc. And these were released to tech researchers earlier, and proof of concepts were shown etc. <https://youtu.be/QuqefIZrRWc?t=1005> And, like, the fact that AMD released an urgent patch for it should kind of speak to the severity of the issue in the first place. AMD doesn't patch "sudo lets you do root things", obviously, so it *necessarily* must have been more than that, and this was obvious even at the time. But we have to go through this dance with literally every single AMD exploit. AMD has a *unpatched* exploit in all Zen3 and below processors that leaks data from kernel at a faster rate than meltdown did. It was discovered by the same researchers that discovered meltdown. AMD has chosen to leave that unpatched, and put out a weaselly deflection about "it doesn't cross address boundaries" but they also still refuse to turn KPTI on by default because it would hurt their benchmarks. And without KPTI there is no address boundary to cross, that's the weaselly part. AMD very craftily made it *sound* like they're saying there's not an issue, but in fact they are fully confirming the finding from the researcher, including the suggested mitigation (enabling KPTI), they just don't recommend that you do it. The statement is deliberately short to avoid inclusion of too many details that might dispel these misleading impressions. <https://www.usenix.org/system/files/sec22summer_lipp.pdf> [https://www.amd.com/en/resources/product-security/bulletin/a...](https://www.amd.com/en/resources/product-security/bulletin/amd-sb-1017.html) proof of concept: [https://github.com/amdprefetch/amd-prefetch-attacks/blob/mas...](https://github.com/amdprefetch/amd-prefetch-attacks/blob/master/case-studies/kaslr-break/main.c) tested a few months ago and it's still working: <https://news.ycombinator.com/item?id=40850526> This follows that same researcher (who previously discovered meltdown) uncovering a prior series of vulnerabilities in the cache ways predictor that *also* nullify KASLR... which AMD refused to patch because it "didn't leak actual data, only metadata"... the metadata being the page-table layouts. That one is still unpatched too - as the researchers note, AMD never actually mitigated this either, just more weasel words. [https://www.tomshardware.com/news/new-amd-side-channel-attac...](https://www.tomshardware.com/news/new-amd-side-channel-attacks-discovered-impacts-zen-architecture) <https://mlq.me/download/takeaway.pdf> (this one literally doesn't even seem to have a security bulletin page for itself so I guess they have fully shoved this one down the memory hole now, but here's the news item from wayback) [http://web.archive.org/web/20200325045817/https://www.amd.co...](http://web.archive.org/web/20200325045817/https%3A//www.amd.com/en/corporate/product-security) After 6+ years of watching the community defend this behavior, downplay exploits from their *favorite megacorporation*, etc, it just gets old. Not liking how CTS labs did it or whatever is fine. It doesn't mean there's not a serious exploit, and *so often* that is where people end up with these AMD exploits, they like AMD so much that they argue against the existence or significance of the exploit, attack the researchers or whine about research grants, etc. "Does this really deserve this CVE score" is a constant refrain in AMD vuln threads and it just gets so old. As tptacek noted... intel ME vulns are frontpage news and have people asking where they can buy a processor without ME in it. Literally nobody cares that AMD has had these vulnerabilities left open and unmitigated for years and years even though they're actually worse (as judged by the researcher who found *both* these issues and meltdown). People would have *flipped the fuck out* if Intel left meltdown unpatched and released misleading statements implying that it wasn't an issue etc. It is *wild* just how much AMD is playing on story-mode difficulty with the average enthusiast, and honestly most people don't even realize they're doing it. And that drives me nuts - just decide if security issues are a problem or not, and if the answer is "not" then let's just turn all the mitigations off and see how long they remain un-exploited. If we want to have the security version of the drug-assisted olympics then fine, there is value in having dragsters that just do the thing as quickly as possible, right? But the double-standard people apply to anything AMD is *crazy*. Talk about your "tyranny of low expectations". | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |

