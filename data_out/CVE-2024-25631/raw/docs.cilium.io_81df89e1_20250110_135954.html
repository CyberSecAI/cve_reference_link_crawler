<!DOCTYPE html>
<html class="writer-html5" lang="en">
<head>
  <meta charset="utf-8" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <!-- Google tag (gtag.js) -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-V9SYWYG92Y"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag(){dataLayer.push(arguments);}
        gtag('js', new Date());
        gtag('config', 'G-V9SYWYG92Y');
    </script>
    
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Installation with external etcd &mdash; Cilium 1.16.5 documentation</title>
  <link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
    <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
    <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=ef282081" />
    <link rel="stylesheet" type="text/css" href="../../_static/parsed-literal.css?v=519ac8c2" />
    <link rel="stylesheet" type="text/css" href="../../_static/copybutton.css?v=378031d3" />
    <link rel="stylesheet" type="text/css" href="../../_static/editbutton.css?v=d53c7333" />
    <link rel="stylesheet" type="text/css" href="../../_static/helm-reference.css?v=2d9e6831" />
    <link rel="stylesheet" type="text/css" href="../../_static/wrapped-table.css?v=bc1f8164" />
    <link rel="stylesheet" type="text/css" href="../../_static/tabs.css?v=a5c4661c" />
  <link rel="stylesheet" href="../../_static/css/docsearch.min.css" type="text/css" />
    <link rel="canonical" href="https://docs.cilium.io/en/stable/installation/k8s-install-external-etcd.html" />
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script data-url_root="../../" id="documentation_options" src="../../_static/documentation_options.js?v=51a8e20f"></script>
        <script src="../../_static/doctools.js?v=888ff710"></script>
        <script src="../../_static/sphinx_highlight.js?v=4825356b"></script>
        <script src="../../_static/js/versionwarning.js?v=d4224a34"></script>
        <script src="../../_static/clipboardjs.min.js?v=bf393c17"></script>
        <script src="../../_static/copybutton.js?v=7c37f673"></script>
        <script src="../../_static/tabs.js?v=3030b3cb"></script>
    <script src="../../_static/js/theme.js"></script>

    <link rel="stylesheet" href="../../_static/css/github-button.css" type="text/css" />
    <script type="text/javascript" src="../../_static/js/github-button.js"></script>
    <script type="text/javascript" src="../../_static/js/docsearch.min.js"></script>
    <link rel="index" title="Index" href="../../genindex/" />
    <link rel="search" title="Search" href="../../search/" />
    <link rel="next" title="Installation on OpenShift OKD" href="../k8s-install-openshift-okd/" />
    <link rel="prev" title="Installation with K8s distributions" href="../k8s-toc/" /> 

  <meta name="twitter:card" content="summary"/>
  <meta name="twitter:site" content="@ciliumproject"/>
  <meta name="twitter:title" content="Installation with external etcd &mdash; Cilium 1.16.5 documentation"/>
  <meta name="twitter:image" content="../../_static/../../_static/logo.svg"/>
<script async type="text/javascript" src="/_/static/javascript/readthedocs-addons.js"></script><meta name="readthedocs-project-slug" content="cilium" /><meta name="readthedocs-version-slug" content="stable" /><meta name="readthedocs-resolver-filename" content="/installation/k8s-install-external-etcd/" /><meta name="readthedocs-http-status" content="200" /></head>

<body class="wy-body-for-nav">
  <header class="wy-header">
      <div class="wy-header-left">
          
          
          <a href="https://www.cilium.io" class="wy-header-logo-wrapper">
            
              <img src="../../_static/logo.svg" class="logo" alt="Logo"/>
          </a><span class="wy-github-stars">
            <span class="github-btn github-stargazers github-btn-large">
              <a
                class="gh-btn"
                href="https://github.com/cilium/cilium"
                rel="noopener noreferrer"
                target="_blank"
              >
                <span class="gh-ico" aria-hidden="true"></span>
                <span class="gh-text">GitHub Stars</span>
              </a>
              <a
                class="gh-count"
                href="https://github.com/cilium/cilium/stargazers"
                rel="noopener noreferrer"
                target="_blank"
                aria-label={`${this.state.stars} stargazers on GitHub`}
                style="margin-left: 0px;"
              >
              </a>

              <a
                class="gh-btn"
                href="https://cilium.herokuapp.com/"
                rel="noopener noreferrer"
                target="_blank"
                style="margin-left: 15px;"
              >
                <img style="height: 1em;" src="../../_static/icons/slack.inline.svg" alt="slack_icon">
                <span class="gh-text">Join Slack</span>
            </a>
            </span>
        </span>
    </div>

    <nav class="wy-main-nav">
      <input name="wy-main-nav-checkbox" id="wy-main-nav-checkbox" class="wy-main-nav-checkbox" type="checkbox">
      <label for="wy-main-nav-checkbox" class="wy-main-nav-toggle">Menu</label>
      <ul id="#wy-main-nav-menu" class="wy-main-nav-menu">
        <li><a class="w3-hover-text-blue" href="https://cilium.io/enterprise/">Enterprise</a></li>
        <li>
          <div style="background-color: white; font-size: 16px; font-weight: 600; margin-left: 40px" class="w3-dropdown-hover">
            <button class="w3-button w3-white w3-hover-white w3-hover-text-blue">Learn <span class="triangle">▾</span></button>
            <div class="w3-dropdown-content w3-bar-block w3-card-4">
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/labs/categories/getting-started" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/labs.inline.svg" alt="labs-icon">
                Labs
              </a>
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/get-started" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/get-started.inline.svg" alt="get-started-icon">
                Get Started
              </a>
              <a style = "margin-left: 0px; display: inline-flex; padding-right: 10px;" href="https://cilium.io/get-involved" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/get-involved.inline.svg" alt="get-involved-icon">
                Get Involved
              </a>
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/get-help" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/get-help.inline.svg" alt="get-help-icon">
                Get Help
              </a>
            </div>
          </div>

        </li>
        <li>
          <div style="background-color: white; font-size: 16px;font-weight: 600; margin-left: 40px" class="w3-dropdown-hover">
            <button class="w3-button w3-white w3-hover-white w3-hover-text-blue">News and media <span class="triangle">▾</span></i></button>
            <div class="w3-dropdown-content w3-bar-block w3-card-4">
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/adopters" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/adopters.inline.svg" alt="adopters-icon">
                Adopters
              </a>
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/blog" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/blog.inline.svg" alt="blog-icon">
                Blog
              </a>
              <a style = "margin-left: 0px; display: inline-flex;" href="https://github.com/cncf/artwork/blob/master/examples/incubating.md#cilium-logos" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/branding.inline.svg" alt="branding-icon">
                Branding
              </a>
              <a style = "margin-left: 0px; display: inline-flex;" href="https://cilium.io/newsletter" class="w3-bar-item w3-button w3-hover-white w3-hover-text-blue">
                <img style="height: 1.5em; margin-right: .5em" src="../../_static/icons/newsletter.inline.svg" alt="newsletter-icon">
                Newsletter
              </a>
            </div>
          </div>

        </li>
        <li><a class="w3-hover-text-blue" href="https://docs.cilium.io/en/stable/">Documentation</a></li>
      </ul>
    </nav>
  </header> 
  <div class="wy-grid-for-nav">
    <div class="wy-nav-wrapper" data-toggle="wy-nav-shift" >
        <div class="wy-side-nav-search" >
            <!-- -->
<div role="search">
  <div id="rtd-search-form" class="wy-form">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </div>
</div>
        </div>

      <nav class="wy-nav-side">
      <div class="wy-side-scroll"><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Overview</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../overview/intro/">Introduction to Cilium &amp; Hubble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../overview/component-overview/">Component Overview</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Getting Started</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/k8s-install-default/">Cilium Quick Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/demo/">Getting Started with the Star Wars Demo</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/terminology/">Terminology</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted/gettinghelp/">Getting Help</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Advanced Installation</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="../taints/">Considerations on Node Pool Taints and Unmanaged Pods</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s-install-helm/">Installation using Helm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../k8s-install-migration/">Migrating a cluster to Cilium</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="../k8s-toc/">Installation with K8s distributions</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Installation with external etcd</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#when-do-i-need-to-use-a-kvstore">When do I need to use a kvstore?</a></li>
<li class="toctree-l3"><a class="reference internal" href="#requirements">Requirements</a></li>
<li class="toctree-l3"><a class="reference internal" href="#kvstore-and-cilium-dependency">Kvstore and Cilium dependency</a></li>
<li class="toctree-l3"><a class="reference internal" href="#configure-cilium">Configure Cilium</a><ul>
<li class="toctree-l4"><a class="reference internal" href="#optional-configure-the-ssl-certificates">Optional: Configure the SSL certificates</a></li>
</ul>
</li>
<li class="toctree-l3"><a class="reference internal" href="#validate-the-installation">Validate the Installation</a></li>
<li class="toctree-l3"><a class="reference internal" href="#next-steps">Next Steps</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="../k8s-install-openshift-okd/">Installation on OpenShift OKD</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k3s/">Installation Using K3s</a></li>
<li class="toctree-l2"><a class="reference internal" href="../k0s/">Installation k0s Using k0sctl</a></li>
<li class="toctree-l2"><a class="reference internal" href="../kind/">Installation Using Kind</a></li>
<li class="toctree-l2"><a class="reference internal" href="../cni-chaining/">CNI Chaining</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="../external-toc/">External Installers</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Networking</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../network/concepts/">Networking Concepts</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/kubernetes/">Kubernetes Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/bgp-toc/">BGP</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/ebpf/">eBPF Datapath</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/clustermesh/">Multi-cluster Networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/external-toc/">External networking</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/egress-gateway-toc/">Egress Gateway</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/servicemesh/">Service Mesh</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/vtep/">VXLAN Tunnel Endpoint (VTEP) Integration (beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/l2-announcements/">L2 Announcements / L2 Aware LB (Beta)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/node-ipam/">Node IPAM LB</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/pod-mac-address/">Use a Specific MAC Address for a Pod</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../network/multicast/">Multicast Support in Cilium (Beta)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Security</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../security/">Securing Networks with Cilium</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/network/">Overview of Network Security</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/policy/">Overview of Network Policy</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/restrict-pod-access/">Restricting privileged Cilium pod access</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../security/threat-model/">Threat Model</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Observability</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../observability/hubble/">Network Observability with Hubble</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../observability/grafana/">Running Prometheus &amp; Grafana</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../observability/metrics/">Monitoring &amp; Metrics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../observability/visibility/">Layer 7 Protocol Visibility</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Operations</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../operations/system_requirements/">System Requirements</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/upgrade/">Upgrade Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../configuration/">Configuration</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/performance/">Performance &amp; Scalability</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../operations/troubleshooting/">Troubleshooting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Community</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../community/governance/">Governance</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community/">Community Meetings</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community/#slack">Slack</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/community/#special-interest-groups">Special Interest Groups</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../community/roadmap/">Roadmap</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Contributor Guide</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/development/">Development</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/release/">Release Management</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/testing/">Testing</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../contributing/docs/">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../api/">API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../grpcapi/">gRPC API Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../internals/">Internals</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../cheatsheet/">Command Cheatsheet</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../cmdref/">Command Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../helm-reference/">Helm Reference</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../kvstore/">Key-Value Store</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../further_reading/">Further Reading</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../glossary/">Glossary</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Reference Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../reference-guides/bpf/">BPF and XDP Reference Guide</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../reference-guides/xfrm/">XFRM Reference Guide</a></li>
</ul>

        </div>
      </div>
      </nav>
    </div>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../">Cilium</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../k8s-toc/">Installation with K8s distributions</a></li>
      <li class="breadcrumb-item active">Installation with external etcd</li>

  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <section id="installation-with-external-etcd">
<span id="k8s-install-etcd"></span><span id="admin-install-daemonset"></span><h1>Installation with external etcd<a class="headerlink" href="#installation-with-external-etcd" title="Permalink to this heading"></a></h1>
<p>This guide walks you through the steps required to set up Cilium on Kubernetes
using an external etcd. Use of an external etcd provides better performance and
is suitable for larger environments.</p>
<p>Should you encounter any issues during the installation, please refer to the
<a class="reference internal" href="../../network/kubernetes/troubleshooting/#troubleshooting-k8s"><span class="std std-ref">Troubleshooting</span></a> section and/or seek help on <a class="reference external" href="https://slack.cilium.io">Cilium Slack</a>.</p>
<section id="when-do-i-need-to-use-a-kvstore">
<h2>When do I need to use a kvstore?<a class="headerlink" href="#when-do-i-need-to-use-a-kvstore" title="Permalink to this heading"></a></h2>
<p>Unlike the section <a class="reference internal" href="../../gettingstarted/k8s-install-default/#k8s-quick-install"><span class="std std-ref">Cilium Quick Installation</span></a>, this guide explains how to
configure Cilium to use an external kvstore such as etcd. If you are unsure
whether you need to use a kvstore at all, the following is a list of reasons
when to use a kvstore:</p>
<blockquote>
<div><ul class="simple">
<li><p>If you are running in an environment where you observe a high overhead in
state propagation caused by Kubernetes events.</p></li>
<li><p>If you do not want Cilium to store state in Kubernetes custom resources
(CRDs).</p></li>
<li><p>If you run a cluster with more pods and more nodes than the ones tested
in the <a class="reference internal" href="../../operations/performance/scalability/report/#scalability-guide"><span class="std std-ref">Scalability report</span></a>.</p></li>
</ul>
</div></blockquote>
</section>
<section id="requirements">
<span id="ds-deploy"></span><h2>Requirements<a class="headerlink" href="#requirements" title="Permalink to this heading"></a></h2>
<p>Make sure your Kubernetes environment is meeting the requirements:</p>
<ul class="simple">
<li><p>Kubernetes &gt;= 1.16</p></li>
<li><p>Linux kernel &gt;= 5.4 or equivalent</p></li>
<li><p>Kubernetes in CNI mode</p></li>
<li><p>Mounted eBPF filesystem mounted on all worker nodes</p></li>
<li><p>Recommended: Enable PodCIDR allocation (<code class="docutils literal notranslate"><span class="pre">--allocate-node-cidrs</span></code>) in the <code class="docutils literal notranslate"><span class="pre">kube-controller-manager</span></code> (recommended)</p></li>
</ul>
<p>Refer to the section <a class="reference internal" href="../../network/kubernetes/requirements/#k8s-requirements"><span class="std std-ref">Requirements</span></a> for detailed instruction on how to
prepare your Kubernetes environment.</p>
<p>You will also need an external etcd version 3.4.0 or higher.</p>
</section>
<section id="kvstore-and-cilium-dependency">
<h2>Kvstore and Cilium dependency<a class="headerlink" href="#kvstore-and-cilium-dependency" title="Permalink to this heading"></a></h2>
<p>When using an external kvstore, it’s important to break the circular dependency between Cilium and kvstore.
If kvstore pods are running within the same cluster and are using a pod network then kvstore relies on Cilium.
However, Cilium also relies on the kvstore, which creates a circular dependency.
There are two recommended ways of breaking this dependency:</p>
<blockquote>
<div><ul class="simple">
<li><p>Deploy kvstore outside of cluster or on separately managed cluster.</p></li>
<li><p>Deploy kvstore pods with a host network, by specifying <code class="docutils literal notranslate"><span class="pre">hostNetwork:</span> <span class="pre">true</span></code> in the pod spec.</p></li>
</ul>
</div></blockquote>
</section>
<section id="configure-cilium">
<h2>Configure Cilium<a class="headerlink" href="#configure-cilium" title="Permalink to this heading"></a></h2>
<p>When using an external kvstore, the address of the external kvstore needs to be
configured in the ConfigMap. Download the base YAML and configure it with
<a class="reference internal" href="../../glossary/#term-Helm"><span class="xref std std-term">Helm</span></a>:</p>
<p>Setup Helm repository:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">helm repo add cilium https://helm.cilium.io/</span>
</pre></div>
</div>
<p>Deploy Cilium release via Helm:</p>
<pre class="literal-block">helm install cilium cilium/cilium --version 1.16.5 \
  --namespace kube-system \
  --set etcd.enabled=true \
  --set &quot;etcd.endpoints[0]=http://etcd-endpoint1:2379&quot; \
  --set &quot;etcd.endpoints[1]=http://etcd-endpoint2:2379&quot; \
  --set &quot;etcd.endpoints[2]=http://etcd-endpoint3:2379&quot;</pre>
<p>If you do not want Cilium to store state in Kubernetes custom resources (CRDs),
consider setting <code class="docutils literal notranslate"><span class="pre">identityAllocationMode</span></code>:</p>
<div class="highlight-none notranslate"><div class="highlight"><pre><span></span>--set identityAllocationMode=kvstore
</pre></div>
</div>
<section id="optional-configure-the-ssl-certificates">
<h3>Optional: Configure the SSL certificates<a class="headerlink" href="#optional-configure-the-ssl-certificates" title="Permalink to this heading"></a></h3>
<p>Create a Kubernetes secret with the root certificate authority, and client-side
key and certificate of etcd:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl create secret generic -n kube-system cilium-etcd-secrets \</span>
<span class="go">    --from-file=etcd-client-ca.crt=ca.crt \</span>
<span class="go">    --from-file=etcd-client.key=client.key \</span>
<span class="go">    --from-file=etcd-client.crt=client.crt</span>
</pre></div>
</div>
<p>Adjust the helm template generation to enable SSL for etcd and use https instead
of http for the etcd endpoint URLs:</p>
<pre class="literal-block">helm install cilium cilium/cilium --version 1.16.5 \
  --namespace kube-system \
  --set etcd.enabled=true \
  --set etcd.ssl=true \
  --set &quot;etcd.endpoints[0]=https://etcd-endpoint1:2379&quot; \
  --set &quot;etcd.endpoints[1]=https://etcd-endpoint2:2379&quot; \
  --set &quot;etcd.endpoints[2]=https://etcd-endpoint3:2379&quot;</pre>
</section>
</section>
<section id="validate-the-installation">
<h2>Validate the Installation<a class="headerlink" href="#validate-the-installation" title="Permalink to this heading"></a></h2>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-0-0-0" aria-selected="true" class="sphinx-tabs-tab" id="tab-0-0-0" name="0-0" role="tab" tabindex="0">Cilium CLI</button><button aria-controls="panel-0-0-1" aria-selected="false" class="sphinx-tabs-tab" id="tab-0-0-1" name="0-1" role="tab" tabindex="-1">Manually</button></div><div aria-labelledby="tab-0-0-0" class="sphinx-tabs-panel" id="panel-0-0-0" name="0-0" role="tabpanel" tabindex="0"><div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>Make sure you install <a class="reference external" href="https://github.com/cilium/cilium-cli/releases/tag/v0.15.0">cilium-cli v0.15.0</a>
or later. The rest of instructions do not work with older versions of
cilium-cli. To confirm the cilium-cli version that’s installed in your system,
run:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">cilium version --client</span>
</pre></div>
</div>
<p>See <a class="reference internal" href="../../operations/upgrade/#upgrade-cilium-cli-helm-mode"><span class="std std-ref">Cilium CLI upgrade notes</span></a> for more details.</p>
</div>
<p>Install the latest version of the Cilium CLI. The Cilium CLI can be used to
install Cilium, inspect the state of a Cilium installation, and enable/disable
various features (e.g. clustermesh, Hubble).</p>
<div class="sphinx-tabs docutils container">
<div aria-label="Tabbed content" class="closeable" role="tablist"><button aria-controls="panel-1-TGludXg=" aria-selected="true" class="sphinx-tabs-tab group-tab" id="tab-1-TGludXg=" name="TGludXg=" role="tab" tabindex="0">Linux</button><button aria-controls="panel-1-bWFjT1M=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-bWFjT1M=" name="bWFjT1M=" role="tab" tabindex="-1">macOS</button><button aria-controls="panel-1-T3RoZXI=" aria-selected="false" class="sphinx-tabs-tab group-tab" id="tab-1-T3RoZXI=" name="T3RoZXI=" role="tab" tabindex="-1">Other</button></div><div aria-labelledby="tab-1-TGludXg=" class="sphinx-tabs-panel group-tab" id="panel-1-TGludXg=" name="TGludXg=" role="tabpanel" tabindex="0"><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)</span>
<span class="go">CLI_ARCH=amd64</span>
<span class="go">if [ &quot;$(uname -m)&quot; = &quot;aarch64&quot; ]; then CLI_ARCH=arm64; fi</span>
<span class="go">curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}</span>
<span class="go">sha256sum --check cilium-linux-${CLI_ARCH}.tar.gz.sha256sum</span>
<span class="go">sudo tar xzvfC cilium-linux-${CLI_ARCH}.tar.gz /usr/local/bin</span>
<span class="go">rm cilium-linux-${CLI_ARCH}.tar.gz{,.sha256sum}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-bWFjT1M=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-bWFjT1M=" name="bWFjT1M=" role="tabpanel" tabindex="0"><div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">CILIUM_CLI_VERSION=$(curl -s https://raw.githubusercontent.com/cilium/cilium-cli/main/stable.txt)</span>
<span class="go">CLI_ARCH=amd64</span>
<span class="go">if [ &quot;$(uname -m)&quot; = &quot;arm64&quot; ]; then CLI_ARCH=arm64; fi</span>
<span class="go">curl -L --fail --remote-name-all https://github.com/cilium/cilium-cli/releases/download/${CILIUM_CLI_VERSION}/cilium-darwin-${CLI_ARCH}.tar.gz{,.sha256sum}</span>
<span class="go">shasum -a 256 -c cilium-darwin-${CLI_ARCH}.tar.gz.sha256sum</span>
<span class="go">sudo tar xzvfC cilium-darwin-${CLI_ARCH}.tar.gz /usr/local/bin</span>
<span class="go">rm cilium-darwin-${CLI_ARCH}.tar.gz{,.sha256sum}</span>
</pre></div>
</div>
</div><div aria-labelledby="tab-1-T3RoZXI=" class="sphinx-tabs-panel group-tab" hidden="true" id="panel-1-T3RoZXI=" name="T3RoZXI=" role="tabpanel" tabindex="0"><p>See the full page of <a class="reference external" href="https://github.com/cilium/cilium-cli/releases/latest">releases</a>.</p>
</div></div>
<p>To validate that Cilium has been properly installed, you can run</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cilium<span class="w"> </span>status<span class="w"> </span>--wait
<span class="go">   /¯¯\</span>
<span class="go">/¯¯\__/¯¯\    Cilium:         OK</span>
<span class="go">\__/¯¯\__/    Operator:       OK</span>
<span class="go">/¯¯\__/¯¯\    Hubble:         disabled</span>
<span class="go">\__/¯¯\__/    ClusterMesh:    disabled</span>
<span class="go">   \__/</span>

<span class="go">DaemonSet         cilium             Desired: 2, Ready: 2/2, Available: 2/2</span>
<span class="go">Deployment        cilium-operator    Desired: 2, Ready: 2/2, Available: 2/2</span>
<span class="go">Containers:       cilium-operator    Running: 2</span>
<span class="go">                  cilium             Running: 2</span>
<span class="go">Image versions    cilium             quay.io/cilium/cilium:v1.9.5: 2</span>
<span class="go">                  cilium-operator    quay.io/cilium/operator-generic:v1.9.5: 2</span>
</pre></div>
</div>
<p>Run the following command to validate that your cluster has proper network
connectivity:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>cilium<span class="w"> </span>connectivity<span class="w"> </span><span class="nb">test</span>
<span class="go">ℹ️  Monitor aggregation detected, will skip some flow validation steps</span>
<span class="go">✨ [k8s-cluster] Creating namespace for connectivity check...</span>
<span class="gp gp-VirtualEnv">(...)</span>
<span class="go">---------------------------------------------------------------------------------------------------------------------</span>
<span class="go">📋 Test Report</span>
<span class="go">---------------------------------------------------------------------------------------------------------------------</span>
<span class="go">✅ 69/69 tests successful (0 warnings)</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The connectivity test may fail to deploy due to too many open files in one
or more of the pods. If you notice this error, you can increase the
<code class="docutils literal notranslate"><span class="pre">inotify</span></code> resource limits on your host machine (see
<a class="reference external" href="https://kind.sigs.k8s.io/docs/user/known-issues/#pod-errors-due-to-too-many-open-files">Pod errors due to “too many open files”</a>).</p>
</div>
<p>Congratulations! You have a fully functional Kubernetes cluster with Cilium. 🎉</p>
</div><div aria-labelledby="tab-0-0-1" class="sphinx-tabs-panel" hidden="true" id="panel-0-0-1" name="0-1" role="tabpanel" tabindex="0"><p>You can monitor as Cilium and all required components are being installed:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl<span class="w"> </span>-n<span class="w"> </span>kube-system<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>--watch
<span class="go">NAME                                    READY   STATUS              RESTARTS   AGE</span>
<span class="go">cilium-operator-cb4578bc5-q52qk         0/1     Pending             0          8s</span>
<span class="go">cilium-s8w5m                            0/1     PodInitializing     0          7s</span>
<span class="go">coredns-86c58d9df4-4g7dd                0/1     ContainerCreating   0          8m57s</span>
<span class="go">coredns-86c58d9df4-4l6b2                0/1     ContainerCreating   0          8m57s</span>
</pre></div>
</div>
<p>It may take a couple of minutes for all components to come up:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">cilium-operator-cb4578bc5-q52qk         1/1     Running   0          4m13s</span>
<span class="go">cilium-s8w5m                            1/1     Running   0          4m12s</span>
<span class="go">coredns-86c58d9df4-4g7dd                1/1     Running   0          13m</span>
<span class="go">coredns-86c58d9df4-4l6b2                1/1     Running   0          13m</span>
</pre></div>
</div>
<p>You can deploy the “connectivity-check” to test connectivity between pods. It is
recommended to create a separate namespace for this.</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl create ns cilium-test</span>
</pre></div>
</div>
<p>Deploy the check with:</p>
<pre class="literal-block">kubectl apply -n cilium-test -f https://raw.githubusercontent.com/cilium/cilium/1.16.5/examples/kubernetes/connectivity-check/connectivity-check.yaml</pre>
<p>It will deploy a series of deployments which will use various connectivity
paths to connect to each other. Connectivity paths include with and without
service load-balancing and various network policy combinations. The pod name
indicates the connectivity variant and the readiness and liveness gate
indicates success or failure of the test:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="gp">$ </span>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>cilium-test
<span class="go">NAME                                                     READY   STATUS    RESTARTS   AGE</span>
<span class="go">echo-a-76c5d9bd76-q8d99                                  1/1     Running   0          66s</span>
<span class="go">echo-b-795c4b4f76-9wrrx                                  1/1     Running   0          66s</span>
<span class="go">echo-b-host-6b7fc94b7c-xtsff                             1/1     Running   0          66s</span>
<span class="go">host-to-b-multi-node-clusterip-85476cd779-bpg4b          1/1     Running   0          66s</span>
<span class="go">host-to-b-multi-node-headless-dc6c44cb5-8jdz8            1/1     Running   0          65s</span>
<span class="go">pod-to-a-79546bc469-rl2qq                                1/1     Running   0          66s</span>
<span class="go">pod-to-a-allowed-cnp-58b7f7fb8f-lkq7p                    1/1     Running   0          66s</span>
<span class="go">pod-to-a-denied-cnp-6967cb6f7f-7h9fn                     1/1     Running   0          66s</span>
<span class="go">pod-to-b-intra-node-nodeport-9b487cf89-6ptrt             1/1     Running   0          65s</span>
<span class="go">pod-to-b-multi-node-clusterip-7db5dfdcf7-jkjpw           1/1     Running   0          66s</span>
<span class="go">pod-to-b-multi-node-headless-7d44b85d69-mtscc            1/1     Running   0          66s</span>
<span class="go">pod-to-b-multi-node-nodeport-7ffc76db7c-rrw82            1/1     Running   0          65s</span>
<span class="go">pod-to-external-1111-d56f47579-d79dz                     1/1     Running   0          66s</span>
<span class="go">pod-to-external-fqdn-allow-google-cnp-78986f4bcf-btjn7   1/1     Running   0          66s</span>
</pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you deploy the connectivity check to a single node cluster, pods that check multi-node
functionalities will remain in the <code class="docutils literal notranslate"><span class="pre">Pending</span></code> state. This is expected since these pods
need at least 2 nodes to be scheduled successfully.</p>
</div>
<p>Once done with the test, remove the <code class="docutils literal notranslate"><span class="pre">cilium-test</span></code> namespace:</p>
<div class="highlight-shell-session notranslate"><div class="highlight"><pre><span></span><span class="go">kubectl delete ns cilium-test</span>
</pre></div>
</div>
</div></div>
</section>
<section id="next-steps">
<h2>Next Steps<a class="headerlink" href="#next-steps" title="Permalink to this heading"></a></h2>
<blockquote>
<div><ul class="simple">
<li><p><a class="reference internal" href="../../observability/hubble/setup/#hubble-setup"><span class="std std-ref">Setting up Hubble Observability</span></a></p></li>
<li><p><a class="reference internal" href="../../observability/hubble/hubble-cli/#hubble-cli"><span class="std std-ref">Inspecting Network Flows with the CLI</span></a></p></li>
<li><p><a class="reference internal" href="../../observability/hubble/hubble-ui/#hubble-ui"><span class="std std-ref">Service Map &amp; Hubble UI</span></a></p></li>
<li><p><a class="reference internal" href="../../security/http/#gs-http"><span class="std std-ref">Identity-Aware and HTTP-Aware Policy Enforcement</span></a></p></li>
<li><p><a class="reference internal" href="../../network/clustermesh/clustermesh/#clustermesh"><span class="std std-ref">Setting up Cluster Mesh</span></a></p></li>
</ul>
</div></blockquote>
</section>
</section>


           </div>
          </div>
          <footer><div class="rst-footer-buttons" role="navigation" aria-label="Footer">
        <a href="../k8s-toc/" class="btn btn-neutral float-left" title="Installation with K8s distributions" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left" aria-hidden="true"></span> Previous</a>
        <a href="../k8s-install-openshift-okd/" class="btn btn-neutral float-right" title="Installation on OpenShift OKD" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right" aria-hidden="true"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright Cilium Authors.
      <span class="lastupdated">Last updated on Dec 17, 2024.
      </span></p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  

  
<script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

  <script>
    setTimeout(() => {
      docsearch({
        indexName: 'cilium_docs',
        apiKey: 'ebd279472edfb5246bababfd1f324a98',
        appId: 'NR0TQZZ2NG', 
        inputSelector: '#rtd-search-form input, #flyout-search-form input',
        debug: false,
        algoliaOptions: {
          'facetFilters': ['version:']
        }
      });
    }, 0);
  </script>

</body>
</html>