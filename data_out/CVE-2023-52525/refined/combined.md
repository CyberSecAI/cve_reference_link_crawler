=== Content from git.kernel.org_9eeabd3b_20250110_174635.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:00:40 +0200 |
| commit | [6b706286473db4fd54b5f869faa67f4a8cb18e99](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)) | |
| tree | [1f2ab164b9e743b780e539e15cb4d33a98b4c313](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99) | |
| parent | [42970d32fe1e5a68f7dd0e487ef3881c1cc95882](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=42970d32fe1e5a68f7dd0e487ef3881c1cc95882) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99&id2=42970d32fe1e5a68f7dd0e487ef3881c1cc95882)) | |
| download | [linux-6b706286473db4fd54b5f869faa67f4a8cb18e99.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6b706286473db4fd54b5f869faa67f4a8cb18e99.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=6b706286473db4fd54b5f869faa67f4a8cb18e99) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex 65420ad6741679..257737137cd70f 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=42970d32fe1e5a68f7dd0e487ef3881c1cc95882)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=6b706286473db4fd54b5f869faa67f4a8cb18e99)@@ -86,7 +86,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -95,12 +96,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:12 +0000



=== Content from git.kernel.org_05585ef8_20250110_174637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:46:43 +0200 |
| commit | [b8e260654a29de872e7cb85387d8ab8974694e8e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b8e260654a29de872e7cb85387d8ab8974694e8e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)) | |
| tree | [851ffddf3407e1426c6c026278b16e78804342a2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b8e260654a29de872e7cb85387d8ab8974694e8e) | |
| parent | [1b67be400a96ba68ce28b32b97c789473c65796a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1b67be400a96ba68ce28b32b97c789473c65796a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8e260654a29de872e7cb85387d8ab8974694e8e&id2=1b67be400a96ba68ce28b32b97c789473c65796a)) | |
| download | [linux-b8e260654a29de872e7cb85387d8ab8974694e8e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b8e260654a29de872e7cb85387d8ab8974694e8e.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b8e260654a29de872e7cb85387d8ab8974694e8e)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=b8e260654a29de872e7cb85387d8ab8974694e8e) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex a42b8ff33b23fb..98157fd245f7f2 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=1b67be400a96ba68ce28b32b97c789473c65796a)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=b8e260654a29de872e7cb85387d8ab8974694e8e)@@ -98,7 +98,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -107,12 +108,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:15 +0000



=== Content from git.kernel.org_adba3fae_20250110_174634.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:45:01 +0200 |
| commit | [16cc18b9080892d1a0200a38e36ae52e464bc555](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16cc18b9080892d1a0200a38e36ae52e464bc555) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)) | |
| tree | [3c87a14b924b874bbffdd0f9c564423e58c3a6ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=16cc18b9080892d1a0200a38e36ae52e464bc555) | |
| parent | [a0d71e9e61da8a85a46774c67549739e28fda795](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a0d71e9e61da8a85a46774c67549739e28fda795) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16cc18b9080892d1a0200a38e36ae52e464bc555&id2=a0d71e9e61da8a85a46774c67549739e28fda795)) | |
| download | [linux-16cc18b9080892d1a0200a38e36ae52e464bc555.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-16cc18b9080892d1a0200a38e36ae52e464bc555.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=16cc18b9080892d1a0200a38e36ae52e464bc555)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=16cc18b9080892d1a0200a38e36ae52e464bc555) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex f3c6daeba1b852..346e91b9f2ad7b 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=a0d71e9e61da8a85a46774c67549739e28fda795)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=16cc18b9080892d1a0200a38e36ae52e464bc555)@@ -98,7 +98,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -107,12 +108,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:11 +0000



=== Content from git.kernel.org_a987bc5f_20250110_174633.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:53:37 +0200 |
| commit | [10a18c8bac7f60d32b7af22da03b66f350beee38](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=10a18c8bac7f60d32b7af22da03b66f350beee38) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)) | |
| tree | [5ff71a344798069b4eb99a75ff82a56d6cfc9222](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=10a18c8bac7f60d32b7af22da03b66f350beee38) | |
| parent | [8c15c1bcc5b543c5fd673d8f1f1d40bd7c81c135](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8c15c1bcc5b543c5fd673d8f1f1d40bd7c81c135) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10a18c8bac7f60d32b7af22da03b66f350beee38&id2=8c15c1bcc5b543c5fd673d8f1f1d40bd7c81c135)) | |
| download | [linux-10a18c8bac7f60d32b7af22da03b66f350beee38.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-10a18c8bac7f60d32b7af22da03b66f350beee38.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=10a18c8bac7f60d32b7af22da03b66f350beee38)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=10a18c8bac7f60d32b7af22da03b66f350beee38) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex 3c555946cb2cc6..5b16e330014acd 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=8c15c1bcc5b543c5fd673d8f1f1d40bd7c81c135)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=10a18c8bac7f60d32b7af22da03b66f350beee38)@@ -98,7 +98,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -107,12 +108,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:10 +0000



=== Content from git.kernel.org_296816be_20250110_174637.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Kalle Valo <kvalo@kernel.org> | 2023-09-18 16:19:25 +0300 |
| commit | [aef7a0300047e7b4707ea0411dc9597cba108fc8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)) | |
| tree | [5e59499a3c9be73147b347877d84a7473086e3a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8) | |
| parent | [2e1b3ae3e1f2cf5a3c9c05d5f961d7d4257b489f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2e1b3ae3e1f2cf5a3c9c05d5f961d7d4257b489f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8&id2=2e1b3ae3e1f2cf5a3c9c05d5f961d7d4257b489f)) | |
| download | [linux-aef7a0300047e7b4707ea0411dc9597cba108fc8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aef7a0300047e7b4707ea0411dc9597cba108fc8.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packetOnly skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=aef7a0300047e7b4707ea0411dc9597cba108fc8) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex 65420ad6741679..257737137cd70f 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=2e1b3ae3e1f2cf5a3c9c05d5f961d7d4257b489f)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=aef7a0300047e7b4707ea0411dc9597cba108fc8)@@ -86,7 +86,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -95,12 +96,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:14 +0000



=== Content from git.kernel.org_db92221b_20250110_174638.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 22:02:59 +0200 |
| commit | [be2ff39b1504c5359f4a083c1cfcad21d666e216](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)) | |
| tree | [9c4c718da115d5ff735b3ad0b8e1b97136596084](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216) | |
| parent | [1e2c796fd9929104c318fe233a9a7b9d5970b419](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e2c796fd9929104c318fe233a9a7b9d5970b419) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216&id2=1e2c796fd9929104c318fe233a9a7b9d5970b419)) | |
| download | [linux-be2ff39b1504c5359f4a083c1cfcad21d666e216.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-be2ff39b1504c5359f4a083c1cfcad21d666e216.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=be2ff39b1504c5359f4a083c1cfcad21d666e216) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex 65420ad6741679..257737137cd70f 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=1e2c796fd9929104c318fe233a9a7b9d5970b419)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=be2ff39b1504c5359f4a083c1cfcad21d666e216)@@ -86,7 +86,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -95,12 +96,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:15 +0000



=== Content from git.kernel.org_c524065b_20250110_174636.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:43:41 +0200 |
| commit | [71b1d2b57f145c8469aa9346f0fd57bf59b2b89c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)) | |
| tree | [cca972402e8cb357c4741cf25234922d18654216](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c) | |
| parent | [ef7a4c97a85ab1bff7abc98f885678bd33bb4881](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ef7a4c97a85ab1bff7abc98f885678bd33bb4881) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c&id2=ef7a4c97a85ab1bff7abc98f885678bd33bb4881)) | |
| download | [linux-71b1d2b57f145c8469aa9346f0fd57bf59b2b89c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-71b1d2b57f145c8469aa9346f0fd57bf59b2b89c.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex f3c6daeba1b852..346e91b9f2ad7b 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=ef7a4c97a85ab1bff7abc98f885678bd33bb4881)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=71b1d2b57f145c8469aa9346f0fd57bf59b2b89c)@@ -98,7 +98,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -107,12 +108,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:13 +0000



=== Content from git.kernel.org_15fec2a6_20250110_174634.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pin-yen Lin <treapking@chromium.org> | 2023-09-08 18:41:12 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2023-10-10 21:59:06 +0200 |
| commit | [5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)) | |
| tree | [3ac24ab1852c2d02942ec2fc8cb7a03d463a9d7c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6) | |
| parent | [7c8faa31080342aec4903c9acb20caf82fcca1ef](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7c8faa31080342aec4903c9acb20caf82fcca1ef) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6&id2=7c8faa31080342aec4903c9acb20caf82fcca1ef)) | |
| download | [linux-5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6.tar.gz) | |

wifi: mwifiex: Fix oob check condition in mwifiex\_process\_rx\_packet[ Upstream commit aef7a0300047e7b4707ea0411dc9597cba108fc8 ]
Only skip the code path trying to access the rfc1042 headers when the
buffer is too small, so the driver can still process packets without
rfc1042 headers.
Fixes: 119585281617 ("wifi: mwifiex: Fix OOB and integer underflow when rx packets")
Signed-off-by: Pin-yen Lin <treapking@chromium.org>
Acked-by: Brian Norris <briannorris@chromium.org>
Reviewed-by: Matthew Wang <matthewmwang@chromium.org>
Signed-off-by: Kalle Valo <kvalo@kernel.org>
Link: [https://lore.kernel.org/r/20230908104308.1546501-1-treapking@chromium.org](https://lore.kernel.org/r/20230908104308.1546501-1-treapking%40chromium.org)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)

| -rw-r--r-- | [drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/net/wireless/marvell/mwifiex/sta\_rx.c b/drivers/net/wireless/marvell/mwifiex/sta\_rx.cindex 3c555946cb2cc6..5b16e330014acd 100644--- a/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=7c8faa31080342aec4903c9acb20caf82fcca1ef)+++ b/[drivers/net/wireless/marvell/mwifiex/sta\_rx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/marvell/mwifiex/sta_rx.c?id=5afb996349cb6d1f14d6ba9aaa7aed3bd82534f6)@@ -98,7 +98,8 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, rx\_pkt\_len = le16\_to\_cpu(local\_rx\_pd->rx\_pkt\_length); rx\_pkt\_hdr = (void \*)local\_rx\_pd + rx\_pkt\_off; - if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off > skb->len) {+ if (sizeof(rx\_pkt\_hdr->eth803\_hdr) + sizeof(rfc1042\_header) ++ rx\_pkt\_off > skb->len) { mwifiex\_dbg(priv->adapter, ERROR, "wrong rx packet offset: len=%d, rx\_pkt\_off=%d\n", skb->len, rx\_pkt\_off);@@ -107,12 +108,13 @@ int mwifiex\_process\_rx\_packet(struct mwifiex\_private \*priv, return -1; } - if ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,- sizeof(bridge\_tunnel\_header))) ||- (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,- sizeof(rfc1042\_header)) &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&- ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX)) {+ if (sizeof(\*rx\_pkt\_hdr) + rx\_pkt\_off <= skb->len &&+ ((!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, bridge\_tunnel\_header,+ sizeof(bridge\_tunnel\_header))) ||+ (!memcmp(&rx\_pkt\_hdr->rfc1042\_hdr, rfc1042\_header,+ sizeof(rfc1042\_header)) &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_AARP &&+ ntohs(rx\_pkt\_hdr->rfc1042\_hdr.snap\_type) != ETH\_P\_IPX))) { /\* \* Replace the 803 header and rfc1042 header (llc/snap) with an \* EthernetII header, keep the src/dst and snap\_type |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:12 +0000


