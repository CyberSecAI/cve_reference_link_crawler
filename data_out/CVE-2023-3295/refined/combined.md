=== Content from plugins.trac.wordpress.org_7dc10486_20250111_023958.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Funlimited-elements-for-elementor%2Ftrunk%2Finc_php%2Funitecreator_assets.class.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php?rev=3212472 "Revision 3212472")
* Next Revision →
* [Blame](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php)

---

# [source:](/browser?order=name "Go to repository root") [unlimited-elements-for-elementor](/browser/unlimited-elements-for-elementor?order=name "View unlimited-elements-for-elementor")/[trunk](/browser/unlimited-elements-for-elementor/trunk?order=name "View trunk")/[inc\_php](/browser/unlimited-elements-for-elementor/trunk/inc_php?order=name "View inc_php")/[unitecreator\_assets.class.php](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php?order=name "View unitecreator_assets.class.php")

View diff against:

View revision:

| [Last change](/changeset/3214436/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php "View differences") on this file was [3214436](/changeset/3214436/ "View changeset 3214436"), checked in by unitecms, [13 days ago](/timeline?from=2024-12-29T13%3A00%3A29Z&precision=second "See timeline at 12/29/2024 01:00:29 PM") |
| --- |
| update version to 1.5.135 |
| **File size:** 39.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* @package Unlimited Elements |
| [4](#L4) | \* @author unlimited-elements.com |
| [5](#L5) | \* @copyright (C) 2021 Unlimited Elements, All Rights Reserved. |
| [6](#L6) | \* @license GNU/GPLv3 http://www.gnu.org/licenses/gpl-3.0.html |
| [7](#L7) | \* \*/ |
| [8](#L8) | defined('UNLIMITED\_ELEMENTS\_INC') or die('Restricted access'); |
| [9](#L9) |  |
| [10](#L10) | class UniteCreatorAssets{ |
| [11](#L11) |  |
| [12](#L12) | const OPTION\_WRAPPER\_STYLE = "wrapper\_style"; |
| [13](#L13) | const OPTION\_ID = "id"; |
| [14](#L14) | const OPTION\_CHECKBOX\_ON\_TYPES = "checkboxes\_on\_types";         //put checkbox only on certain types |
| [15](#L15) | const OPTION\_SHOW\_ONLY\_TYPES = "show\_only\_types"; |
| [16](#L16) | const OPTION\_FILTER\_FOLDER\_NAMES = "filter\_folder\_names";                                       //filter some folder names, don't show them |
| [17](#L17) | const OPTION\_DISABLE\_CHECKBOXES = "disable\_checkboxes"; |
| [18](#L18) | const OPTION\_PUT\_ACTIVEPATH = "put\_activepath"; |
| [19](#L19) | const OPTION\_FOLDERS\_ONLY = "folders\_only"; |
| [20](#L20) | const OPTION\_SINGLE\_ITEM\_SELECT = "single\_item\_select"; |
| [21](#L21) | const OPTION\_THUMBS\_VIEW = "is\_thumbs\_view";            //list or thumb view |
| [22](#L22) | const OPTION\_SHOW\_FILE\_EXTENTIONS = "show\_file\_extensions"; |
| [23](#L23) |  |
| [24](#L24) |  |
| [25](#L25) | const FILETYPE\_ALLOWED = "allowed"; |
| [26](#L26) | const FILETYPE\_DEFAULT = "default"; |
| [27](#L27) | const FILETYPE\_IMAGE = "image"; |
| [28](#L28) | const FILETYPE\_AUDIO = "audio"; |
| [29](#L29) | const FILETYPE\_CSS = "css"; |
| [30](#L30) | const FILETYPE\_PHP = "php"; |
| [31](#L31) | const FILETYPE\_JS = "js"; |
| [32](#L32) | const FILETYPE\_HTML = "html"; |
| [33](#L33) | const FILETYPE\_DOCUMENT = "document"; |
| [34](#L34) | const FILETYPE\_VIDEO = "video"; |
| [35](#L35) | const FILETYPE\_ZIP = "zip"; |
| [36](#L36) | const FILETYPE\_XML = "xml"; |
| [37](#L37) |  |
| [38](#L38) |  |
| [39](#L39) | protected $options = array(); |
| [40](#L40) | private static $serial = 0; |
| [41](#L41) | private $startPath = ""; |
| [42](#L42) | private $customStartPath = null; |
| [43](#L43) | protected $pathKey; |
| [44](#L44) | protected $arrCheckedUrls = array(); |
| [45](#L45) | protected $isBrowerMode = false; |
| [46](#L46) | protected $flagPutOnce = false; |
| [47](#L47) | protected $objAddon = null; |
| [48](#L48) |  |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* construct |
| [52](#L52) | \*/ |
| [53](#L53) | public function \_\_construct(){ |
| [54](#L54) | self::$serial++; |
| [55](#L55) | } |
| [56](#L56) |  |
| [57](#L57) |  |
| [58](#L58) | /\*\* |
| [59](#L59) | \* set browser mode |
| [60](#L60) | \*/ |
| [61](#L61) | protected function setBrowserMode(){ |
| [62](#L62) | $this->isBrowerMode = true; |
| [63](#L63) | } |
| [64](#L64) |  |
| [65](#L65) |  |
| [66](#L66) | /\*\* |
| [67](#L67) | \* set default options |
| [68](#L68) | \*/ |
| [69](#L69) | protected function setDefaultOptions(){ |
| [70](#L70) |  |
| [71](#L71) | $defaults = array(); |
| [72](#L72) | $defaults[self::OPTION\_PUT\_ACTIVEPATH] = true; |
| [73](#L73) | $defaults[self::OPTION\_FOLDERS\_ONLY] = false; |
| [74](#L74) | $defaults[self::OPTION\_DISABLE\_CHECKBOXES] = false; |
| [75](#L75) | $defaults[self::OPTION\_SINGLE\_ITEM\_SELECT] = false; |
| [76](#L76) | $defaults[self::OPTION\_THUMBS\_VIEW] = false; |
| [77](#L77) | $defaults[self::OPTION\_SHOW\_FILE\_EXTENTIONS] = true; |
| [78](#L78) |  |
| [79](#L79) | $this->options = $defaults; |
| [80](#L80) | } |
| [81](#L81) |  |
| [82](#L82) |  |
| [83](#L83) |  |
| [84](#L84) |  |
| [85](#L85) | /\*\* |
| [86](#L86) | \* set array of checked urls |
| [87](#L87) | \*/ |
| [88](#L88) | protected function setCheckedUrls($arrUrls){ |
| [89](#L89) | $this->arrCheckedUrls = $arrUrls; |
| [90](#L90) | } |
| [91](#L91) |  |
| [92](#L92) | /\*\* |
| [93](#L93) | \* set checked files |
| [94](#L94) | \*/ |
| [95](#L95) | protected function setCheckedFiles($path, $arrFiles){ |
| [96](#L96) | if(empty($arrFiles)) |
| [97](#L97) | return(false); |
| [98](#L98) |  |
| [99](#L99) | //support single file |
| [100](#L100) | if(is\_array($arrFiles) == false) |
| [101](#L101) | $arrFiles = array($arrFiles); |
| [102](#L102) |  |
| [103](#L103) | $this->sanitizePath($path); |
| [104](#L104) |  |
| [105](#L105) | //convert files array to urls array |
| [106](#L106) | $urlDir = $this->getUrlDir($path); |
| [107](#L107) |  |
| [108](#L108) | $arrUrls = array(); |
| [109](#L109) |  |
| [110](#L110) | foreach($arrFiles as $file){ |
| [111](#L111) | $url = $urlDir.$file; |
| [112](#L112) | $arrUrls[] = $url; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) | $this->setCheckedUrls($arrUrls); |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) | /\*\* |
| [120](#L120) | \* set start path |
| [121](#L121) | \*/ |
| [122](#L122) | protected function setStartPath($startPath){ |
| [123](#L123) |  |
| [124](#L124) | $startPath = UniteFunctionsUC::pathToUnix($startPath); |
| [125](#L125) | $this->startPath = $startPath; |
| [126](#L126) | } |
| [127](#L127) |  |
| [128](#L128) |  |
| [129](#L129) |  |
| [130](#L130) | private function a\_\_\_\_\_VALIDATIONS\_\_\_\_\_\_(){} |
| [131](#L131) |  |
| [132](#L132) |  |
| [133](#L133) | /\*\* |
| [134](#L134) | \* validate inited |
| [135](#L135) | \*/ |
| [136](#L136) | protected function validateInited(){ |
| [137](#L137) | if(empty($this->pathKey)) |
| [138](#L138) | UniteFunctionsUC::throwError("assets not inited"); |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) |  |
| [142](#L142) | /\*\* |
| [143](#L143) | \* validate that path exists |
| [144](#L144) | \*/ |
| [145](#L145) | private function validateStartPath(){ |
| [146](#L146) |  |
| [147](#L147) | if(empty($this->startPath)) |
| [148](#L148) | UniteFunctionsUC::throwError("Path not inited"); |
| [149](#L149) |  |
| [150](#L150) | } |
| [151](#L151) |  |
| [152](#L152) |  |
| [153](#L153) | /\*\* |
| [154](#L154) | \* validate that the path is under assets path |
| [155](#L155) | \*/ |
| [156](#L156) | private function validatePathUnderStartPath($path){ |
| [157](#L157) |  |
| [158](#L158) | $this->validateStartPath(); |
| [159](#L159) |  |
| [160](#L160) | $path = realpath($path); |
| [161](#L161) | $realStartPath = realpath($this->startPath); |
| [162](#L162) |  |
| [163](#L163) | $searchPos = strpos($path, $realStartPath); |
| [164](#L164) | if($searchPos !== 0) |
| [165](#L165) | UniteFunctionsUC::throwError("Wrong path, should be under start path only"); |
| [166](#L166) |  |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) |  |
| [170](#L170) | /\*\* |
| [171](#L171) | \* validate folder name |
| [172](#L172) | \*/ |
| [173](#L173) | private function validateFolderName($folderName){ |
| [174](#L174) |  |
| [175](#L175) | if(strpbrk($folderName, "\\/?%\*:|\"<>") !== FALSE) |
| [176](#L176) | UniteFunctionsUC::throwError("The folder name: $folderName is not valid"); |
| [177](#L177) |  |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) |  |
| [181](#L181) | /\*\* |
| [182](#L182) | \* validate that the filename is valid |
| [183](#L183) | \*/ |
| [184](#L184) | private function validateFilename($filename){ |
| [185](#L185) |  |
| [186](#L186) | if(strpbrk($filename, "\\/?%\*:|\"<>") !== FALSE) |
| [187](#L187) | UniteFunctionsUC::throwError("The file name: $filename is not valid"); |
| [188](#L188) |  |
| [189](#L189) | } |
| [190](#L190) |  |
| [191](#L191) | /\*\* |
| [192](#L192) | \* check if the filename allowed |
| [193](#L193) | \*/ |
| [194](#L194) | private function isFilenameAllowed($filename){ |
| [195](#L195) |  |
| [196](#L196) | $ext = pathinfo($filename, PATHINFO\_EXTENSION); |
| [197](#L197) | $fileType = $this->getFileType($filename); |
| [198](#L198) |  |
| [199](#L199) | if(empty($ext)) |
| [200](#L200) | UniteFunctionsUC::throwError("Files without extension of: $filename don't allowed in assets"); |
| [201](#L201) |  |
| [202](#L202) | switch($fileType){ |
| [203](#L203) | case self::FILETYPE\_PHP: |
| [204](#L204) | case self::FILETYPE\_DEFAULT: |
| [205](#L205) | case "htaccess": |
| [206](#L206) | return(false); |
| [207](#L207) | break; |
| [208](#L208) | } |
| [209](#L209) |  |
| [210](#L210) | return(true); |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) |  |
| [214](#L214) | /\*\* |
| [215](#L215) | \* validate allowed filetype |
| [216](#L216) | \*/ |
| [217](#L217) | private function validateAllowedFiletype($filename){ |
| [218](#L218) |  |
| [219](#L219) | $isAllowed = $this->isFilenameAllowed($filename); |
| [220](#L220) |  |
| [221](#L221) | if($isAllowed == false) |
| [222](#L222) | UniteFunctionsUC::throwError("File $filename not allowed in assets"); |
| [223](#L223) | } |
| [224](#L224) |  |
| [225](#L225) | /\*\* |
| [226](#L226) | \* delete some files in extracted |
| [227](#L227) | \*/ |
| [228](#L228) | public function deleteFilesInExtracted($path){ |
| [229](#L229) |  |
| [230](#L230) | $arrDirs = UniteFunctionsUC::getDirList($path); |
| [231](#L231) |  |
| [232](#L232) | $arrDelete = array(); |
| [233](#L233) |  |
| [234](#L234) | foreach($arrDirs as $dirName){ |
| [235](#L235) |  |
| [236](#L236) | switch($dirName){ |
| [237](#L237) | case "\_\_MACOSX": |
| [238](#L238) | $arrDelete[] = $dirName; |
| [239](#L239) | break; |
| [240](#L240) | } |
| [241](#L241) |  |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | if(empty($arrDelete)) |
| [245](#L245) | return(false); |
| [246](#L246) |  |
| [247](#L247) |  |
| [248](#L248) | foreach($arrDelete as $dir){ |
| [249](#L249) |  |
| [250](#L250) | $pathDir = $path.$dir; |
| [251](#L251) |  |
| [252](#L252) | if(is\_dir($pathDir) == false) |
| [253](#L253) | return(false); |
| [254](#L254) |  |
| [255](#L255) | UniteFunctionsUC::deleteDir($pathDir); |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) |  |
| [261](#L261) | /\*\* |
| [262](#L262) | \* validate extracted files for unwanted files like php, and if not, delete the directory |
| [263](#L263) | \*/ |
| [264](#L264) | public function validateAllowedFilesInExtracted($path, $isDelete = true){ |
| [265](#L265) |  |
| [266](#L266) | if(is\_dir($path) == false) |
| [267](#L267) | return(false); |
| [268](#L268) |  |
| [269](#L269) | $arrFiles = UniteFunctionsUC::getFileListTree($path); |
| [270](#L270) |  |
| [271](#L271) | if(empty($arrFiles)) |
| [272](#L272) | return(false); |
| [273](#L273) |  |
| [274](#L274) | foreach($arrFiles as $pathFile){ |
| [275](#L275) |  |
| [276](#L276) | $info = pathinfo($pathFile); |
| [277](#L277) |  |
| [278](#L278) | $filename = UniteFunctionsUC::getVal($info, "basename"); |
| [279](#L279) |  |
| [280](#L280) | try{ |
| [281](#L281) |  |
| [282](#L282) | $this->validateAllowedFiletype($filename); |
| [283](#L283) |  |
| [284](#L284) | }catch(Exception $e){ |
| [285](#L285) |  |
| [286](#L286) | if($isDelete == true) |
| [287](#L287) | UniteFunctionsUC::deleteDir($path, false); |
| [288](#L288) |  |
| [289](#L289) | throw($e); |
| [290](#L290) | } |
| [291](#L291) | } |
| [292](#L292) |  |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) |  |
| [296](#L296) | /\*\* |
| [297](#L297) | \* check and delete php files from the zipped |
| [298](#L298) | \*/ |
| [299](#L299) | private function checkDeleteNotAllowedFiles($path){ |
| [300](#L300) |  |
| [301](#L301) | $arrFiles = UniteFunctionsUC::getFileListTree($path); |
| [302](#L302) |  |
| [303](#L303) | if(empty($arrFiles)) |
| [304](#L304) | return(false); |
| [305](#L305) |  |
| [306](#L306) | $isFound = false; |
| [307](#L307) | $fileExample = null; |
| [308](#L308) | $arrFilesToDelete = array(); |
| [309](#L309) |  |
| [310](#L310) |  |
| [311](#L311) | foreach($arrFiles as $pathFile){ |
| [312](#L312) |  |
| [313](#L313) | $info = pathinfo($pathFile); |
| [314](#L314) |  |
| [315](#L315) | $filename = UniteFunctionsUC::getVal($info, "basename"); |
| [316](#L316) |  |
| [317](#L317) | $isAllowed = $this->isFilenameAllowed($filename); |
| [318](#L318) |  |
| [319](#L319) | if($isAllowed == false){ |
| [320](#L320) |  |
| [321](#L321) | $isFound = true; |
| [322](#L322) | if(empty($fileExample)) |
| [323](#L323) | $fileExample = $filename; |
| [324](#L324) |  |
| [325](#L325) | $arrFilesToDelete[] = $pathFile; |
| [326](#L326) |  |
| [327](#L327) | } |
| [328](#L328) |  |
| [329](#L329) | } |
| [330](#L330) |  |
| [331](#L331) | if($isFound == false) |
| [332](#L332) | return(false); |
| [333](#L333) |  |
| [334](#L334) | UniteFunctionsUC::deleteListOfFiles($arrFilesToDelete); |
| [335](#L335) |  |
| [336](#L336) | UniteFunctionsUC::throwError("Found some not allowed files in the zip like: $fileExample , please check this file."); |
| [337](#L337) |  |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) |  |
| [341](#L341) |  |
| [342](#L342) | /\*\* |
| [343](#L343) | \* validate that the file is allowed for edit by type |
| [344](#L344) | \*/ |
| [345](#L345) | private function validateFileAllowedForEdit($filename){ |
| [346](#L346) |  |
| [347](#L347) | $fileType = $this->getFileType($filename); |
| [348](#L348) | $ext = pathinfo($filename, PATHINFO\_EXTENSION); |
| [349](#L349) |  |
| [350](#L350) | if(empty($ext)) |
| [351](#L351) | UniteFunctionsUC::throwError("Can't edit files without extension"); |
| [352](#L352) |  |
| [353](#L353) | switch($fileType){ |
| [354](#L354) | case self::FILETYPE\_DOCUMENT: |
| [355](#L355) | case self::FILETYPE\_HTML: |
| [356](#L356) | case self::FILETYPE\_XML: |
| [357](#L357) | case self::FILETYPE\_JS: |
| [358](#L358) | case self::FILETYPE\_CSS: |
| [359](#L359) | break; |
| [360](#L360) | default: |
| [361](#L361) | UniteFunctionsUC::throwError("File <b>$filename</b> type not allowed in to edit"); |
| [362](#L362) | break; |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | } |
| [366](#L366) |  |
| [367](#L367) | /\*\* |
| [368](#L368) | \* validate edit file data |
| [369](#L369) | \*/ |
| [370](#L370) | protected function validateEditFileData($path, $filename){ |
| [371](#L371) | $path = $this->sanitizePath($path); |
| [372](#L372) | $this->validateFilename($filename); |
| [373](#L373) | $this->validateFileAllowedForEdit($filename); |
| [374](#L374) |  |
| [375](#L375) | $filepath = $path.$filename; |
| [376](#L376) |  |
| [377](#L377) | if(file\_exists($filepath) == false) |
| [378](#L378) | UniteFunctionsUC::throwError("The file: $filename not exists."); |
| [379](#L379) |  |
| [380](#L380) | return($filepath); |
| [381](#L381) | } |
| [382](#L382) |  |
| [383](#L383) |  |
| [384](#L384) |  |
| [385](#L385) |  |
| [386](#L386) | /\*\* |
| [387](#L387) | \* sanitize filename |
| [388](#L388) | \*/ |
| [389](#L389) | private function isFilenameValidForDelete($filename){ |
| [390](#L390) |  |
| [391](#L391) | if(strpos($filename, "..") !== false) |
| [392](#L392) | return(false); |
| [393](#L393) |  |
| [394](#L394) | if(strpos($filename, "/") !== false) |
| [395](#L395) | return(false); |
| [396](#L396) |  |
| [397](#L397) | if(strpos($filename, "\\") !== false) |
| [398](#L398) | return(false); |
| [399](#L399) |  |
| [400](#L400) | return(true); |
| [401](#L401) | } |
| [402](#L402) |  |
| [403](#L403) |  |
| [404](#L404) | /\*\* |
| [405](#L405) | \* validate new file creation |
| [406](#L406) | \*/ |
| [407](#L407) | private function validateCreateNewFileFolder($path, $filename, $isFile = true){ |
| [408](#L408) |  |
| [409](#L409) | $path = $this->sanitizePath($path); |
| [410](#L410) |  |
| [411](#L411) | //validate if allowed |
| [412](#L412) | if($isFile == true){ |
| [413](#L413) | $this->validateFilename($filename); |
| [414](#L414) | $this->validateAllowedFiletype($filename); |
| [415](#L415) | }else{ |
| [416](#L416) | $this->validateFolderName($filename); |
| [417](#L417) | } |
| [418](#L418) |  |
| [419](#L419) | $filepath = $path.$filename; |
| [420](#L420) |  |
| [421](#L421) | //validate if already exists |
| [422](#L422) | if(is\_file($filepath) == true) |
| [423](#L423) | UniteFunctionsUC::throwError("file with name <b>$filename</b> already exists"); |
| [424](#L424) |  |
| [425](#L425) | if(is\_dir($filepath) == true) |
| [426](#L426) | UniteFunctionsUC::throwError("folder <b>$filename</b> already exists"); |
| [427](#L427) |  |
| [428](#L428) | return($filepath); |
| [429](#L429) | } |
| [430](#L430) |  |
| [431](#L431) |  |
| [432](#L432) |  |
| [433](#L433) | private function a\_\_\_\_\_\_\_GETTERS\_\_\_\_\_\_(){} |
| [434](#L434) |  |
| [435](#L435) |  |
| [436](#L436) | /\*\* |
| [437](#L437) | \* get option by name |
| [438](#L438) | \*/ |
| [439](#L439) | private function getOption($name, $default = null){ |
| [440](#L440) |  |
| [441](#L441) | if(array\_key\_exists($name, $this->options) == false) |
| [442](#L442) | return($default); |
| [443](#L443) |  |
| [444](#L444) | $option = $this->options[$name]; |
| [445](#L445) |  |
| [446](#L446) | return($option); |
| [447](#L447) | } |
| [448](#L448) |  |
| [449](#L449) |  |
| [450](#L450) | /\*\* |
| [451](#L451) | \* get options for client |
| [452](#L452) | \*/ |
| [453](#L453) | protected function getArrOptionsForClient(){ |
| [454](#L454) |  |
| [455](#L455) | $arrOptionNames = array( |
| [456](#L456) | self::OPTION\_SINGLE\_ITEM\_SELECT |
| [457](#L457) | ); |
| [458](#L458) |  |
| [459](#L459) | $arrOptions = array(); |
| [460](#L460) | foreach($arrOptionNames as $option) |
| [461](#L461) | $arrOptions[$option] = $this->getOption($option); |
| [462](#L462) |  |
| [463](#L463) | return($arrOptions); |
| [464](#L464) | } |
| [465](#L465) |  |
| [466](#L466) |  |
| [467](#L467) | /\*\* |
| [468](#L468) | \* get some file mime type |
| [469](#L469) | \*/ |
| [470](#L470) | private function getFileType($filename){ |
| [471](#L471) |  |
| [472](#L472) | $ext = strtolower(pathinfo($filename, PATHINFO\_EXTENSION)); |
| [473](#L473) |  |
| [474](#L474) | switch($ext){ |
| [475](#L475) | case "php": |
| [476](#L476) | return self::FILETYPE\_PHP; |
| [477](#L477) | break; |
| [478](#L478) | case "jpg": |
| [479](#L479) | case "png": |
| [480](#L480) | case "jpeg": |
| [481](#L481) | case "gif": |
| [482](#L482) | case "apng": |
| [483](#L483) | case "tiff": |
| [484](#L484) | case "avif": |
| [485](#L485) | case "webp": |
| [486](#L486) | return self::FILETYPE\_IMAGE; |
| [487](#L487) | break; |
| [488](#L488) | case "svg": |
| [489](#L489) | case "txt": |
| [490](#L490) | case "doc": |
| [491](#L491) | case "ini": |
| [492](#L492) | case "md": |
| [493](#L493) | return self::FILETYPE\_DOCUMENT; |
| [494](#L494) | break; |
| [495](#L495) | case "html": |
| [496](#L496) | case "htm": |
| [497](#L497) | return self::FILETYPE\_HTML; |
| [498](#L498) | break; |
| [499](#L499) | case "css": |
| [500](#L500) | return self::FILETYPE\_CSS; |
| [501](#L501) | break; |
| [502](#L502) | case "js": |
| [503](#L503) | return(self::FILETYPE\_JS); |
| [504](#L504) | break; |
| [505](#L505) | case "avi": |
| [506](#L506) | case "mp4": |
| [507](#L507) | case "ogv": |
| [508](#L508) | case "webm": |
| [509](#L509) | return(self::FILETYPE\_VIDEO); |
| [510](#L510) | break; |
| [511](#L511) | case "mp3": |
| [512](#L512) | case "wav": |
| [513](#L513) | case "flac": |
| [514](#L514) | case "ogg": |
| [515](#L515) | case "webm": |
| [516](#L516) | case "swf": |
| [517](#L517) | return(self::FILETYPE\_AUDIO); |
| [518](#L518) | break; |
| [519](#L519) | case "zip": |
| [520](#L520) | return(self::FILETYPE\_ZIP); |
| [521](#L521) | break; |
| [522](#L522) | case "json":            //add allowed filetypes |
| [523](#L523) | case "tpl": |
| [524](#L524) | case "ds\_store": |
| [525](#L525) | return(self::FILETYPE\_ALLOWED); |
| [526](#L526) | break; |
| [527](#L527) | case "xml": |
| [528](#L528) | return(self::FILETYPE\_XML); |
| [529](#L529) | break; |
| [530](#L530) | case "htaccess": |
| [531](#L531) | return("htaccess"); |
| [532](#L532) | break; |
| [533](#L533) | default: |
| [534](#L534) | return(self::FILETYPE\_DEFAULT); |
| [535](#L535) | break; |
| [536](#L536) | } |
| [537](#L537) |  |
| [538](#L538) | } |
| [539](#L539) |  |
| [540](#L540) |  |
| [541](#L541) | /\*\* |
| [542](#L542) | \* get assets active path |
| [543](#L543) | \*/ |
| [544](#L544) | private function getActivePath($inputPath = ""){ |
| [545](#L545) |  |
| [546](#L546) | if($inputPath){ |
| [547](#L547) | $path = $inputPath; |
| [548](#L548) | if(is\_dir($path) == false) |
| [549](#L549) | $path = $this->startPath; |
| [550](#L550) | } |
| [551](#L551) | else |
| [552](#L552) | $path = $this->startPath; |
| [553](#L553) |  |
| [554](#L554) | $path = HelperUC::pathToRelative($path, false); |
| [555](#L555) |  |
| [556](#L556) | return($path); |
| [557](#L557) | } |
| [558](#L558) |  |
| [559](#L559) |  |
| [560](#L560) | /\*\* |
| [561](#L561) | \* get relative startpath |
| [562](#L562) | \*/ |
| [563](#L563) | private function getStartPathRelative(){ |
| [564](#L564) | return HelperUC::pathToRelative($this->startPath, false); |
| [565](#L565) | } |
| [566](#L566) |  |
| [567](#L567) |  |
| [568](#L568) | /\*\* |
| [569](#L569) | \* check if path is assets path |
| [570](#L570) | \*/ |
| [571](#L571) | private function isStartPath($path){ |
| [572](#L572) |  |
| [573](#L573) | if(realpath($path) == realpath($this->startPath)) |
| [574](#L574) | return(true); |
| [575](#L575) |  |
| [576](#L576) | return(false); |
| [577](#L577) | } |
| [578](#L578) |  |
| [579](#L579) |  |
| [580](#L580) | /\*\* |
| [581](#L581) | \* check if path is assets path |
| [582](#L582) | \*/ |
| [583](#L583) | private function isCustomStartPath($path){ |
| [584](#L584) |  |
| [585](#L585) | if(empty($this->customStartPath)) |
| [586](#L586) | return(false); |
| [587](#L587) |  |
| [588](#L588) | if(realpath($path) == realpath($this->customStartPath)) |
| [589](#L589) | return(true); |
| [590](#L590) |  |
| [591](#L591) | return(false); |
| [592](#L592) | } |
| [593](#L593) |  |
| [594](#L594) |  |
| [595](#L595) | /\*\* |
| [596](#L596) | \* convert path dir 8to url |
| [597](#L597) | \*/ |
| [598](#L598) | protected function getUrlDir($pathDir){ |
| [599](#L599) | $urlDir = HelperUC::pathToRelativeUrl($pathDir); |
| [600](#L600) | $urlDir = rtrim($urlDir, "/")."/";      //make sure that there is always / |
| [601](#L601) | return($urlDir); |
| [602](#L602) | } |
| [603](#L603) |  |
| [604](#L604) | /\*\* |
| [605](#L605) | \* decide if need to put checkbox on file in htmldir |
| [606](#L606) | \*/ |
| [607](#L607) | private function isCheckboxOnFile($file, $isDir){ |
| [608](#L608) |  |
| [609](#L609) | if($file == "..") |
| [610](#L610) | return(false); |
| [611](#L611) |  |
| [612](#L612) | $arrExt = $this->getOption(self::OPTION\_CHECKBOX\_ON\_TYPES); |
| [613](#L613) | if(empty($arrExt)) |
| [614](#L614) | return(true); |
| [615](#L615) |  |
| [616](#L616) | //in case of filtering |
| [617](#L617) | if($isDir == true) |
| [618](#L618) | return(false); |
| [619](#L619) |  |
| [620](#L620) | $info = pathinfo($file); |
| [621](#L621) | $ext = UniteFunctionsUC::getVal($info, "extension"); |
| [622](#L622) | $ext = strtolower($ext); |
| [623](#L623) |  |
| [624](#L624) | if(array\_search($ext, $arrExt) === false) |
| [625](#L625) | return(false); |
| [626](#L626) |  |
| [627](#L627) | return(true); |
| [628](#L628) | } |
| [629](#L629) |  |
| [630](#L630) |  |
| [631](#L631) |  |
| [632](#L632) |  |
| [633](#L633) | /\*\* |
| [634](#L634) | \* check if the file needs to show |
| [635](#L635) | \*/ |
| [636](#L636) | private function isFileToShow($filetype){ |
| [637](#L637) |  |
| [638](#L638) | $arrTypes = $this->getOption(self::OPTION\_SHOW\_ONLY\_TYPES); |
| [639](#L639) |  |
| [640](#L640) | if(empty($arrTypes)) |
| [641](#L641) | return(true); |
| [642](#L642) |  |
| [643](#L643) | if(array\_search($filetype, $arrTypes) !== false) |
| [644](#L644) | return(true); |
| [645](#L645) |  |
| [646](#L646) | return(false); |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) |  |
| [650](#L650) | /\*\* |
| [651](#L651) | \* check if directory need to show |
| [652](#L652) | \*/ |
| [653](#L653) | private function isDirToShow($dir){ |
| [654](#L654) |  |
| [655](#L655) | $arrExcludeDirs = $this->getOption(self::OPTION\_FILTER\_FOLDER\_NAMES); |
| [656](#L656) | if(empty($arrExcludeDirs)) |
| [657](#L657) | return(true); |
| [658](#L658) |  |
| [659](#L659) | if(array\_search($dir, $arrExcludeDirs) !== false) |
| [660](#L660) | return(false); |
| [661](#L661) |  |
| [662](#L662) |  |
| [663](#L663) | return(true); |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) |  |
| [667](#L667) | /\*\* |
| [668](#L668) | \* get filelist class |
| [669](#L669) | \*/ |
| [670](#L670) | protected function getFilelistClass(){ |
| [671](#L671) |  |
| [672](#L672) | $isThumbs = $this->getOption(self::OPTION\_THUMBS\_VIEW); |
| [673](#L673) | if($isThumbs == true) |
| [674](#L674) | $extraClass = " uc-view-thumbs"; |
| [675](#L675) | else |
| [676](#L676) | $extraClass = " uc-view-list"; |
| [677](#L677) |  |
| [678](#L678) | $class = "uc-filelist".$extraClass; |
| [679](#L679) |  |
| [680](#L680) | return($class); |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) |  |
| [684](#L684) | /\*\* |
| [685](#L685) | \* get empty list |
| [686](#L686) | \*/ |
| [687](#L687) | protected function getEmptyHtmlDirList(){ |
| [688](#L688) | $class = $this->getFilelistClass(); |
| [689](#L689) |  |
| [690](#L690) | $html = "<div class=\"{$class}\" ></div>"; |
| [691](#L691) |  |
| [692](#L692) | return($html); |
| [693](#L693) | } |
| [694](#L694) |  |
| [695](#L695) |  |
| [696](#L696) |  |
| [697](#L697) | /\*\* |
| [698](#L698) | \* put folder content html |
| [699](#L699) | \* path - relative path from assets folder |
| [700](#L700) | \*/ |
| [701](#L701) | protected function getHtmlDir($pathDir = null, $addWrapper = false){ |
| [702](#L702) |  |
| [703](#L703) | if(empty($pathDir)) |
| [704](#L704) | $pathDir = $this->startPath; |
| [705](#L705) |  |
| [706](#L706) | try{ |
| [707](#L707) |  |
| [708](#L708) | $pathDir = $this->sanitizePath($pathDir); |
| [709](#L709) |  |
| [710](#L710) | }catch(Exception $e){ |
| [711](#L711) | $pathDir = $this->startPath; |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) |  |
| [715](#L715) | $isThumbsView = $this->getOption(self::OPTION\_THUMBS\_VIEW); |
| [716](#L716) |  |
| [717](#L717) | $urlDir = $this->getUrlDir($pathDir); |
| [718](#L718) |  |
| [719](#L719) | $isStartPath = $this->isStartPath($pathDir); |
| [720](#L720) |  |
| [721](#L721) | if($isStartPath == false) |
| [722](#L722) | $isStartPath = $this->isCustomStartPath($pathDir); |
| [723](#L723) |  |
| [724](#L724) | $isFoldersOnly = $this->getOption(self::OPTION\_FOLDERS\_ONLY); |
| [725](#L725) |  |
| [726](#L726) | $arrFiles = scandir($pathDir); |
| [727](#L727) |  |
| [728](#L728) | $isDisableCheckboxes = $this->getOption(self::OPTION\_DISABLE\_CHECKBOXES); |
| [729](#L729) | $isDisableCheckboxes = UniteFunctionsUC::strToBool($isDisableCheckboxes); |
| [730](#L730) |  |
| [731](#L731) | $html = ""; |
| [732](#L732) | $classFilelist = $this->getFilelistClass(); |
| [733](#L733) |  |
| [734](#L734) | if($addWrapper == true) |
| [735](#L735) | $html = "<div class=\"{$classFilelist}\" >"; |
| [736](#L736) |  |
| [737](#L737) | $isNoFiles = (count($arrFiles) == 2); |
| [738](#L738) |  |
| [739](#L739) | foreach($arrFiles as $file){ |
| [740](#L740) | if($file == ".") |
| [741](#L741) | continue; |
| [742](#L742) |  |
| [743](#L743) | //don't show back link on assets path |
| [744](#L744) | if($file == ".." && $isStartPath == true){ |
| [745](#L745) | if($isNoFiles == true){ |
| [746](#L746) | $emptyText = esc\_html\_\_("empty folder", "unlimited-elements-for-elementor"); |
| [747](#L747) | $html .= "<div class='uc-filelist-emptytext'>{$emptyText}</div>"; |
| [748](#L748) | } |
| [749](#L749) |  |
| [750](#L750) | continue; |
| [751](#L751) | } |
| [752](#L752) |  |
| [753](#L753) |  |
| [754](#L754) | $filepath = $pathDir.$file; |
| [755](#L755) | $fileUrl = $urlDir.$file; |
| [756](#L756) | $isDir = is\_dir($filepath); |
| [757](#L757) |  |
| [758](#L758) | if($isFoldersOnly && $isDir == false) |
| [759](#L759) | continue; |
| [760](#L760) |  |
| [761](#L761) | if($isDir == true) |
| [762](#L762) | $filetype = "dir"; |
| [763](#L763) | else |
| [764](#L764) | $filetype = $this->getFileType($file); |
| [765](#L765) |  |
| [766](#L766) | //filter files by type |
| [767](#L767) | if($isDir == false){ |
| [768](#L768) | $toShowFile = $this->isFileToShow($filetype); |
| [769](#L769) | if($toShowFile == false) |
| [770](#L770) | continue; |
| [771](#L771) | }else { |
| [772](#L772) | $toShowDir = $this->isDirToShow($file); |
| [773](#L773) | if($toShowDir == false) |
| [774](#L774) | continue; |
| [775](#L775) | } |
| [776](#L776) |  |
| [777](#L777) | //check if should be checkbox |
| [778](#L778) | $isSelectable = $this->isCheckboxOnFile($file, $isDir); |
| [779](#L779) | $isCheckbox = $isSelectable; |
| [780](#L780) |  |
| [781](#L781) | if($isDisableCheckboxes == true) |
| [782](#L782) | $isCheckbox = false; |
| [783](#L783) |  |
| [784](#L784) |  |
| [785](#L785) | $htmlChecked = ""; |
| [786](#L786) | $addClass = ""; |
| [787](#L787) | if(!empty($this->arrCheckedUrls) && array\_search($fileUrl, $this->arrCheckedUrls) !== false ){ |
| [788](#L788) | $htmlChecked = " checked data-initchecked='true'"; |
| [789](#L789) | $addClass = " uc-filelist-item-selected"; |
| [790](#L790) | } |
| [791](#L791) |  |
| [792](#L792) |  |
| [793](#L793) | if($isDir == true && $file == ".."){ |
| [794](#L794) | $addClass .= " uc-dir-back"; |
| [795](#L795) | $isSelectable = false; |
| [796](#L796) | } |
| [797](#L797) |  |
| [798](#L798) | if($isSelectable == true) |
| [799](#L799) | $addClass .= " uc-filelist-selectable"; |
| [800](#L800) |  |
| [801](#L801) | $strFile = htmlspecialchars($file); |
| [802](#L802) | $showFile = $file; |
| [803](#L803) |  |
| [804](#L804) | //check maybe not show extensions |
| [805](#L805) | if($isDir == false){ |
| [806](#L806) | $showExtensions = $this->getOption(self::OPTION\_SHOW\_FILE\_EXTENTIONS); |
| [807](#L807) | if($showExtensions === false){ |
| [808](#L808) | $arrInfo = pathinfo($file); |
| [809](#L809) | $showFile = $arrInfo["filename"]; |
| [810](#L810) | } |
| [811](#L811) | } |
| [812](#L812) |  |
| [813](#L813) | $html .= "<a class='uc-filelist-item uc-type-{$filetype} {$addClass}' data-type='{$filetype}' data-file='{$strFile}' data-url='{$fileUrl}' >"; |
| [814](#L814) |  |
| [815](#L815) | if($isDisableCheckboxes == false){ |
| [816](#L816) | $html .= "<div class='uc-filelist-checkbox-wrapper'>"; |
| [817](#L817) |  |
| [818](#L818) | if($isCheckbox == true) |
| [819](#L819) | $html .= "<input type='checkbox' class='uc-filelist-checkbox' {$htmlChecked} data-file='{$strFile}' onfocus='this.blur()'>"; |
| [820](#L820) |  |
| [821](#L821) | $html .= "</div>"; |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | //add image path to icon if needed |
| [825](#L825) | $iconAddHtml = ""; |
| [826](#L826) | if($isThumbsView == true && $filetype == self::FILETYPE\_IMAGE){ |
| [827](#L827) | $urlThumb = HelperUC::$operations->createThumbs($fileUrl); |
| [828](#L828) | $urlThumb = HelperUC::URLtoFull($urlThumb); |
| [829](#L829) | $urlThumb = htmlspecialchars($urlThumb); |
| [830](#L830) |  |
| [831](#L831) | $iconAddHtml = " style=\"background-image:url('{$urlThumb}');\""; |
| [832](#L832) | } |
| [833](#L833) |  |
| [834](#L834) | $html .= "<div class='uc-filelist-icon uc-icon-{$filetype}'{$iconAddHtml}></div>"; |
| [835](#L835) | $html .= "<div class='uc-filelist-filename'>{$showFile}</div>"; |
| [836](#L836) | $html .= "<div class='unite-clear'></div>"; |
| [837](#L837) | $html .= "</a>"; |
| [838](#L838) | } |
| [839](#L839) |  |
| [840](#L840) | if($addWrapper == true) |
| [841](#L841) | $html .= "</div>"; |
| [842](#L842) |  |
| [843](#L843) | return($html); |
| [844](#L844) | } |
| [845](#L845) |  |
| [846](#L846) |  |
| [847](#L847) | /\*\* |
| [848](#L848) | \* get arr exists files in current folder |
| [849](#L849) | \*/ |
| [850](#L850) | private function getArrExistsFiles($path, $arrFiles){ |
| [851](#L851) |  |
| [852](#L852) | $path = $this->sanitizePath($path); |
| [853](#L853) |  |
| [854](#L854) | if(!is\_array($arrFiles)) |
| [855](#L855) | UniteFunctionsUC::throwError("getArrExistsFiles error - arrFiles should be array"); |
| [856](#L856) |  |
| [857](#L857) | $arrExists = array(); |
| [858](#L858) | foreach($arrFiles as $file){ |
| [859](#L859) | $filepath = $path.$file; |
| [860](#L860) | if(file\_exists($filepath)) |
| [861](#L861) | $arrExists[] = $file; |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) | return($arrExists); |
| [865](#L865) | } |
| [866](#L866) |  |
| [867](#L867) | private function a\_\_\_\_\_\_SETTERS\_\_\_\_\_\_\_\_(){} |
| [868](#L868) |  |
| [869](#L869) | /\*\* |
| [870](#L870) | \* get real upload path from path |
| [871](#L871) | \* @param unknown\_type $path |
| [872](#L872) | \*/ |
| [873](#L873) | public function sanitizePath($path){ |
| [874](#L874) |  |
| [875](#L875) | if(is\_dir($path) == false){ |
| [876](#L876) | $path = HelperUC::pathToAbsolute($path); |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | $path = UniteFunctionsUC::realpath($path); |
| [880](#L880) |  |
| [881](#L881) | if(empty($path) || !is\_dir($path)) |
| [882](#L882) | UniteFunctionsUC::throwError("Wrong path given"); |
| [883](#L883) |  |
| [884](#L884) | //validate path |
| [885](#L885) | $this->validatePathUnderStartPath($path); |
| [886](#L886) |  |
| [887](#L887) | $path = UniteFunctionsUC::addPathEndingSlash($path); |
| [888](#L888) |  |
| [889](#L889) | return($path); |
| [890](#L890) | } |
| [891](#L891) |  |
| [892](#L892) |  |
| [893](#L893) | /\*\* |
| [894](#L894) | \* set option |
| [895](#L895) | \*/ |
| [896](#L896) | public function setOption($option, $value){ |
| [897](#L897) | $this->options[$option] = $value; |
| [898](#L898) | } |
| [899](#L899) |  |
| [900](#L900) |  |
| [901](#L901) | /\*\* |
| [902](#L902) | \* set custom start path |
| [903](#L903) | \*/ |
| [904](#L904) | protected function setCustomStartPath($path){ |
| [905](#L905) |  |
| [906](#L906) | if(empty($path)) |
| [907](#L907) | return(false); |
| [908](#L908) |  |
| [909](#L909) | $path = $this->sanitizePath($path); |
| [910](#L910) |  |
| [911](#L911) | $path = UniteFunctionsUC::pathToUnix($path); |
| [912](#L912) |  |
| [913](#L913) | $this->customStartPath = $path; |
| [914](#L914) | } |
| [915](#L915) |  |
| [916](#L916) |  |
| [917](#L917) | private function a\_\_\_\_\_\_ACTIONS\_\_\_\_\_\_(){} |
| [918](#L918) |  |
| [919](#L919) |  |
| [920](#L920) | /\*\* |
| [921](#L921) | \* delete files by array from some path |
| [922](#L922) | \*/ |
| [923](#L923) | protected function deleteFiles($path, $arrFiles){ |
| [924](#L924) |  |
| [925](#L925) | $path = $this->sanitizePath($path); |
| [926](#L926) |  |
| [927](#L927) | //delete files |
| [928](#L928) | foreach($arrFiles as $filename){ |
| [929](#L929) | $isValid = $this->isFilenameValidForDelete($filename); |
| [930](#L930) | if($isValid == false) |
| [931](#L931) | continue; |
| [932](#L932) |  |
| [933](#L933) | $filepath = $path.$filename; |
| [934](#L934) |  |
| [935](#L935) | if(file\_exists($filepath) == false) |
| [936](#L936) | continue; |
| [937](#L937) |  |
| [938](#L938) | if(is\_dir($filepath)) |
| [939](#L939) | UniteFunctionsUC::deleteDir($filepath); |
| [940](#L940) | else |
| [941](#L941) | unlink($filepath); |
| [942](#L942) |  |
| [943](#L943) | } |
| [944](#L944) |  |
| [945](#L945) |  |
| [946](#L946) | } |
| [947](#L947) |  |
| [948](#L948) |  |
| [949](#L949) | /\*\* |
| [950](#L950) | \* create folder |
| [951](#L951) | \*/ |
| [952](#L952) | protected function createFolder($path, $folderName){ |
| [953](#L953) |  |
| [954](#L954) | $folderName = trim($folderName); |
| [955](#L955) |  |
| [956](#L956) | $pathCreate = $this->validateCreateNewFileFolder($path, $folderName, false); |
| [957](#L957) |  |
| [958](#L958) | @mkdir($pathCreate); |
| [959](#L959) |  |
| [960](#L960) | if(is\_dir($pathCreate) == false) |
| [961](#L961) | UniteFunctionsUC::throwError("Can't create folder <b>{$folderName}</b>, please check parent folder permissions"); |
| [962](#L962) |  |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) |  |
| [966](#L966) | /\*\* |
| [967](#L967) | \* create file |
| [968](#L968) | \*/ |
| [969](#L969) | protected function createFile($path, $filename){ |
| [970](#L970) |  |
| [971](#L971) | $filepath = $this->validateCreateNewFileFolder($path, $filename); |
| [972](#L972) |  |
| [973](#L973) | UniteFunctionsUC::writeFile("", $filepath); |
| [974](#L974) |  |
| [975](#L975) | if(is\_file($filepath) == false) |
| [976](#L976) | UniteFunctionsUC::throwError("file <b>$filename</b> didn't created. Please check folder permissions"); |
| [977](#L977) |  |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) |  |
| [981](#L981) | /\*\* |
| [982](#L982) | \* rename file to new name |
| [983](#L983) | \*/ |
| [984](#L984) | protected function renameFile($path, $filename, $newFilename){ |
| [985](#L985) |  |
| [986](#L986) | $newFilename = trim($newFilename); |
| [987](#L987) |  |
| [988](#L988) | $path = $this->sanitizePath($path); |
| [989](#L989) |  |
| [990](#L990) | $filepathCurrent = $path.$filename; |
| [991](#L991) |  |
| [992](#L992) | $this->validateFilename($filename); |
| [993](#L993) |  |
| [994](#L994) | if(file\_exists($filepathCurrent) == false) |
| [995](#L995) | UniteFunctionsUC::throwError("The file: $filename not exists"); |
| [996](#L996) |  |
| [997](#L997) | $isFile = !is\_dir($filepathCurrent); |
| [998](#L998) |  |
| [999](#L999) | $filepathNew = $this->validateCreateNewFileFolder($path, $newFilename, $isFile); |
| [1000](#L1000) |  |
| [1001](#L1001) | $success = @rename($filepathCurrent, $filepathNew); |
| [1002](#L1002) |  |
| [1003](#L1003) | if($success == false) |
| [1004](#L1004) | UniteFunctionsUC::throwError("The file didn't renamed"); |
| [1005](#L1005) |  |
| [1006](#L1006) | } |
| [1007](#L1007) |  |
| [1008](#L1008) |  |
| [1009](#L1009) | /\*\* |
| [1010](#L1010) | \* get file content |
| [1011](#L1011) | \*/ |
| [1012](#L1012) | protected function getFileContent($path, $filename){ |
| [1013](#L1013) |  |
| [1014](#L1014) | $filepath = $this->validateEditFileData($path, $filename); |
| [1015](#L1015) |  |
| [1016](#L1016) | $content = file\_get\_contents($filepath); |
| [1017](#L1017) |  |
| [1018](#L1018) | return($content); |
| [1019](#L1019) | } |
| [1020](#L1020) |  |
| [1021](#L1021) |  |
| [1022](#L1022) | /\*\* |
| [1023](#L1023) | \* save file content |
| [1024](#L1024) | \*/ |
| [1025](#L1025) | protected function saveFileContent($path, $filename, $content){ |
| [1026](#L1026) | $filepath = $this->validateEditFileData($path, $filename); |
| [1027](#L1027) | UniteFunctionsUC::writeFile($content, $filepath); |
| [1028](#L1028) | } |
| [1029](#L1029) |  |
| [1030](#L1030) |  |
| [1031](#L1031) | /\*\* |
| [1032](#L1032) | \* move files to path |
| [1033](#L1033) | \* $actionOnExists - skip,overwrite,message |
| [1034](#L1034) | \*/ |
| [1035](#L1035) | protected function moveFiles($pathSource, $arrFiles, $pathTarget, $actionOnExists){ |
| [1036](#L1036) |  |
| [1037](#L1037) | if(empty($actionOnExists)) |
| [1038](#L1038) | $actionOnExists = "message"; |
| [1039](#L1039) |  |
| [1040](#L1040) | $pathSource = $this->sanitizePath($pathSource); |
| [1041](#L1041) | $pathTarget = $this->sanitizePath($pathTarget); |
| [1042](#L1042) |  |
| [1043](#L1043) | if(empty($arrFiles)) |
| [1044](#L1044) | UniteFunctionsUC::throwError("No files to move"); |
| [1045](#L1045) |  |
| [1046](#L1046) | if(!is\_array($arrFiles)) |
| [1047](#L1047) | UniteFunctionsUC::throwError("arrFiles should be array"); |
| [1048](#L1048) |  |
| [1049](#L1049) | //show message if some files exists |
| [1050](#L1050) | $arrExists = $this->getArrExistsFiles($pathTarget, $arrFiles); |
| [1051](#L1051) | if(!empty($arrExists) && $actionOnExists == "message"){ |
| [1052](#L1052) |  |
| [1053](#L1053) | $numFiles = count($arrExists); |
| [1054](#L1054) | if($numFiles == 1){ |
| [1055](#L1055) | $file = $arrFiles[0]; |
| [1056](#L1056) | $message = "The file <b> {$file} </b> exists in target folder."; |
| [1057](#L1057) | }else{ |
| [1058](#L1058) | $message = "{$numFiles} already exists in target folder."; |
| [1059](#L1059) | } |
| [1060](#L1060) |  |
| [1061](#L1061) | return($message); |
| [1062](#L1062) | } |
| [1063](#L1063) |  |
| [1064](#L1064) |  |
| [1065](#L1065) | //actualy move files |
| [1066](#L1066) | foreach($arrFiles as $file){ |
| [1067](#L1067) | $filepathSource = $pathSource.$file; |
| [1068](#L1068) | $filepathTarget = $pathTarget.$file; |
| [1069](#L1069) |  |
| [1070](#L1070) | $isTargetExists = file\_exists($filepathTarget); |
| [1071](#L1071) |  |
| [1072](#L1072) | if($isTargetExists == true){ |
| [1073](#L1073) |  |
| [1074](#L1074) | switch($actionOnExists){ |
| [1075](#L1075) | case "overwrite": |
| [1076](#L1076) | $success = @rename($filepathSource, $filepathTarget); |
| [1077](#L1077) | break; |
| [1078](#L1078) | case "skip": |
| [1079](#L1079) | $success = true; |
| [1080](#L1080) | break; |
| [1081](#L1081) | default: |
| [1082](#L1082) | UniteFunctionsUC::throwError("Action on file exists not given"); |
| [1083](#L1083) | break; |
| [1084](#L1084) | } |
| [1085](#L1085) |  |
| [1086](#L1086) | }else{          //if file not exists, just move it |
| [1087](#L1087) | $success = @rename($filepathSource, $filepathTarget); |
| [1088](#L1088) | } |
| [1089](#L1089) |  |
| [1090](#L1090) | if($success == false){ |
| [1091](#L1091) | if(is\_dir($filepathSource) == true) |
| [1092](#L1092) | UniteFunctionsUC::throwError("Can't move directory: <b> {$file} </b>"); |
| [1093](#L1093) | else |
| [1094](#L1094) | UniteFunctionsUC::throwError("Can't move file <b> {$file} </b>"); |
| [1095](#L1095) | } |
| [1096](#L1096) | } |
| [1097](#L1097) |  |
| [1098](#L1098) | return(false); |
| [1099](#L1099) | } |
| [1100](#L1100) |  |
| [1101](#L1101) |  |
| [1102](#L1102) |  |
| [1103](#L1103) | /\*\* |
| [1104](#L1104) | \* unzip file |
| [1105](#L1105) | \*/ |
| [1106](#L1106) | protected function unzipFile($path, $filename){ |
| [1107](#L1107) |  |
| [1108](#L1108) | $path = $this->sanitizePath($path); |
| [1109](#L1109) | $this->validateFilename($filename); |
| [1110](#L1110) | $filepath = $path.$filename; |
| [1111](#L1111) |  |
| [1112](#L1112) | UniteFunctionsUC::validateFilepath($filepath); |
| [1113](#L1113) |  |
| [1114](#L1114) | $zip = new UniteZipUC(); |
| [1115](#L1115) | $zip->extract($filepath, $path); |
| [1116](#L1116) |  |
| [1117](#L1117) | $this->checkDeleteNotAllowedFiles($path); |
| [1118](#L1118) |  |
| [1119](#L1119) | } |
| [1120](#L1120) |  |
| [1121](#L1121) |  |
| [1122](#L1122) | private function a\_\_\_\_\_\_OUTPUT\_\_\_\_\_(){} |
| [1123](#L1123) |  |
| [1124](#L1124) |  |
| [1125](#L1125) | /\*\* |
| [1126](#L1126) | \* handle upload files |
| [1127](#L1127) | \*/ |
| [1128](#L1128) | protected function handleUploadFile($uploadPath, $arrFile){ |
| [1129](#L1129) |  |
| [1130](#L1130) | try{ |
| [1131](#L1131) |  |
| [1132](#L1132) | $this->validateStartPath(); |
| [1133](#L1133) |  |
| [1134](#L1134) | $filename = UniteFunctionsUC::getVal($arrFile, "name"); |
| [1135](#L1135) |  |
| [1136](#L1136) | $this->validateAllowedFiletype($filename); |
| [1137](#L1137) |  |
| [1138](#L1138) | $tempFilepath = UniteFunctionsUC::getVal($arrFile, "tmp\_name"); |
| [1139](#L1139) |  |
| [1140](#L1140) | $destFilepath = $uploadPath."/".$filename; |
| [1141](#L1141) |  |
| [1142](#L1142) | if(is\_file($tempFilepath) == false) |
| [1143](#L1143) | UniteFunctionsUC::throwError("wrong upload filepath!"); |
| [1144](#L1144) |  |
| [1145](#L1145) | $success = move\_uploaded\_file($tempFilepath, $destFilepath); |
| [1146](#L1146) |  |
| [1147](#L1147) | if($success == false) |
| [1148](#L1148) | UniteFunctionsUC::throwError("Upload Failed to: $destFilepath"); |
| [1149](#L1149) |  |
| [1150](#L1150) | }catch(Exception $e){ |
| [1151](#L1151) | http\_response\_code(406); |
| [1152](#L1152) |  |
| [1153](#L1153) | echo esc\_html($e->getMessage()); |
| [1154](#L1154) |  |
| [1155](#L1155) | if(GlobalsUC::$SHOW\_TRACE == true) |
| [1156](#L1156) | echo($e->getTraceAsString()); |
| [1157](#L1157) | } |
| [1158](#L1158) |  |
| [1159](#L1159) | exit(); |
| [1160](#L1160) | } |
| [1161](#L1161) |  |
| [1162](#L1162) |  |
| [1163](#L1163) | /\*\* |
| [1164](#L1164) | \* put file uploader |
| [1165](#L1165) | \*/ |
| [1166](#L1166) | private function putUploadFileDialog(){ |
| [1167](#L1167) |  |
| [1168](#L1168) | $nonce = ""; |
| [1169](#L1169) | if(method\_exists("UniteProviderFunctionsUC", "getNonce")) |
| [1170](#L1170) | $nonce = UniteProviderFunctionsUC::getNonce(); |
| [1171](#L1171) |  |
| [1172](#L1172) | $addonID = null; |
| [1173](#L1173) | if(!empty($this->objAddon)) |
| [1174](#L1174) | $addonID = $this->objAddon->getID(); |
| [1175](#L1175) |  |
| [1176](#L1176) | if($this->flagPutOnce == true) |
| [1177](#L1177) | return(false); |
| [1178](#L1178) |  |
| [1179](#L1179) | ?> |
| [1180](#L1180) | <div id="uc\_dialog\_upload\_files" title="<?php esc\_html\_e("Upload Files", "unlimited-elements-for-elementor")?>" style="display:none"> |
| [1181](#L1181) |  |
| [1182](#L1182) | <div class="uc-dialog-upload-inner"> |
| [1183](#L1183) |  |
| [1184](#L1184) | <div class="uc-assets-activepath"> |
| [1185](#L1185) | <?php esc\_html\_e("Upload to folder: ", "unlimited-elements-for-elementor") ?> |
| [1186](#L1186) | <b> |
| [1187](#L1187) | <span id="uc\_dialogupload\_activepath">some path</span> |
| [1188](#L1188) | </b> |
| [1189](#L1189) | </div> |
| [1190](#L1190) |  |
| [1191](#L1191) | <form id="uc\_form\_dropzone" action="<?php echo esc\_url(GlobalsUC::$url\_ajax)?>" class="dropzone"> |
| [1192](#L1192) | <input type="hidden" name="action" value="<?php echo esc\_html(GlobalsUC::PLUGIN\_NAME)?>\_ajax\_action"> |
| [1193](#L1193) | <input type="hidden" id="uc\_input\_upload\_path" name="upload\_path" value=""> |
| [1194](#L1194) | <input type="hidden" id="uc\_input\_pathkey" name="pathkey" value=""> |
| [1195](#L1195) | <input type="hidden" name="client\_action" value="assets\_upload\_files"> |
| [1196](#L1196) |  |
| [1197](#L1197) | <?php if(!empty($addonID)):?> |
| [1198](#L1198) | <input type="hidden" name="addonID" value="<?php echo esc\_attr($addonID)?>"> |
| [1199](#L1199) | <?php endif?> |
| [1200](#L1200) |  |
| [1201](#L1201) | <?php if(!empty($nonce)):?> |
| [1202](#L1202) | <input type="hidden" name="nonce" value="<?php echo esc\_attr($nonce)?>"> |
| [1203](#L1203) | <?php endif?> |
| [1204](#L1204) | </form> |
| [1205](#L1205) | <script type="text/javascript"> |
| [1206](#L1206) | if(typeof Dropzone != "undefined") |
| [1207](#L1207) | Dropzone.autoDiscover = false; |
| [1208](#L1208) | </script> |
| [1209](#L1209) |  |
| [1210](#L1210) | </div> |
| [1211](#L1211) |  |
| [1212](#L1212) | <br><br> |
| [1213](#L1213) |  |
| [1214](#L1214) | </div> |
| [1215](#L1215) |  |
| [1216](#L1216) | <?php |
| [1217](#L1217) | } |
| [1218](#L1218) |  |
| [1219](#L1219) |  |
| [1220](#L1220) | /\*\* |
| [1221](#L1221) | \* put create folder dialog |
| [1222](#L1222) | \*/ |
| [1223](#L1223) | private function putDialogCreateFolder(){ |
| [1224](#L1224) |  |
| [1225](#L1225) | ?> |
| [1226](#L1226) |  |
| [1227](#L1227) | <div id="uc\_dialog\_create\_folder" title="<?php esc\_html\_e("Create Folder", "unlimited-elements-for-elementor")?>" style="display:none" class="unite-inputs"> |
| [1228](#L1228) |  |
| [1229](#L1229) | <div class="unite-dialog-top"></div> |
| [1230](#L1230) | <div class="unite-inputs-label"><?php esc\_html\_e("Folder Name", "unlimited-elements-for-elementor")?></div> |
| [1231](#L1231) |  |
| [1232](#L1232) | <input id="uc\_dialog\_create\_folder\_name" type="text" class="unite-input-regular" value=""> |
| [1233](#L1233) |  |
| [1234](#L1234) | <?php |
| [1235](#L1235) | $prefix = "uc\_dialog\_create\_folder"; |
| [1236](#L1236) | $buttonTitle = esc\_html\_\_("Create Folder", "unlimited-elements-for-elementor"); |
| [1237](#L1237) | $loaderTitle = esc\_html\_\_("Creating Folder...", "unlimited-elements-for-elementor"); |
| [1238](#L1238) | $successTitle = esc\_html\_\_("Folder Created", "unlimited-elements-for-elementor"); |
| [1239](#L1239) | HelperHtmlUC::putDialogActions($prefix, $buttonTitle, $loaderTitle, $successTitle); |
| [1240](#L1240) | ?> |
| [1241](#L1241) |  |
| [1242](#L1242) | </div> |
| [1243](#L1243) |  |
| [1244](#L1244) | <?php |
| [1245](#L1245) | } |
| [1246](#L1246) |  |
| [1247](#L1247) |  |
| [1248](#L1248) | /\*\* |
| [1249](#L1249) | \* put create file dialog |
| [1250](#L1250) | \*/ |
| [1251](#L1251) | private function putDialogCreateFile(){ |
| [1252](#L1252) |  |
| [1253](#L1253) | ?> |
| [1254](#L1254) |  |
| [1255](#L1255) | <div id="uc\_dialog\_create\_file" title="<?php esc\_html\_e("Create File", "unlimited-elements-for-elementor")?>" style="display:none" class="unite-inputs"> |
| [1256](#L1256) |  |
| [1257](#L1257) | <div class="unite-dialog-top"></div> |
| [1258](#L1258) | <div class="unite-inputs-label"><?php esc\_html\_e("File Name", "unlimited-elements-for-elementor")?></div> |
| [1259](#L1259) |  |
| [1260](#L1260) | <input id="uc\_dialog\_create\_file\_name" type="text" class="unite-input-regular" value=""> |
| [1261](#L1261) |  |
| [1262](#L1262) | <?php |
| [1263](#L1263) | $prefix = "uc\_dialog\_create\_file"; |
| [1264](#L1264) | $buttonTitle = esc\_html\_\_("Create File", "unlimited-elements-for-elementor"); |
| [1265](#L1265) | $loaderTitle = esc\_html\_\_("Creating File...", "unlimited-elements-for-elementor"); |
| [1266](#L1266) | $successTitle = esc\_html\_\_("File Created", "unlimited-elements-for-elementor"); |
| [1267](#L1267) | HelperHtmlUC::putDialogActions($prefix, $buttonTitle, $loaderTitle, $successTitle); |
| [1268](#L1268) | ?> |
| [1269](#L1269) |  |
| [1270](#L1270) | </div> |
| [1271](#L1271) |  |
| [1272](#L1272) | <?php |
| [1273](#L1273) | } |
| [1274](#L1274) |  |
| [1275](#L1275) | /\*\* |
| [1276](#L1276) | \* put rename fiels dialog |
| [1277](#L1277) | \*/ |
| [1278](#L1278) | private function putDialogRenameFile(){ |
| [1279](#L1279) | ?> |
| [1280](#L1280) |  |
| [1281](#L1281) | <div id="uc\_dialog\_rename\_file" title="<?php esc\_html\_e("Rename File / Folder", "unlimited-elements-for-elementor")?>" style="display:none" class="unite-inputs uc-dialog-rename-file"> |
| [1282](#L1282) | <div class="unite-dialog-top"></div> |
| [1283](#L1283) | <div class="unite-inputs-label"><?php esc\_html\_e("Rename this file/folder to", "unlimited-elements-for-elementor")?>:</div> |
| [1284](#L1284) | <input id="uc\_dialog\_rename\_file\_input" type="text" class="unite-input-regular"> |
| [1285](#L1285) |  |
| [1286](#L1286) | <?php |
| [1287](#L1287) | $prefix = "uc\_dialog\_rename\_file"; |
| [1288](#L1288) | $buttonTitle = esc\_html\_\_("Rename", "unlimited-elements-for-elementor"); |
| [1289](#L1289) | $loaderTitle = esc\_html\_\_("Renaming...", "unlimited-elements-for-elementor"); |
| [1290](#L1290) | $successTitle = esc\_html\_\_("File/Dir Renamed", "unlimited-elements-for-elementor"); |
| [1291](#L1291) | HelperHtmlUC::putDialogActions($prefix, $buttonTitle, $loaderTitle, $successTitle); |
| [1292](#L1292) | ?> |
| [1293](#L1293) |  |
| [1294](#L1294) | </div> |
| [1295](#L1295) | <?php |
| [1296](#L1296) | } |
| [1297](#L1297) |  |
| [1298](#L1298) |  |
| [1299](#L1299) | /\*\* |
| [1300](#L1300) | \* put editor dialog |
| [1301](#L1301) | \*/ |
| [1302](#L1302) | private function putDialogEditFile(){ |
| [1303](#L1303) | ?> |
| [1304](#L1304) | <div id="uc\_dialog\_edit\_file" title="<?php esc\_html\_e("Edit File", "unlimited-elements-for-elementor")?>" style="display:none" class="unite-inputs uc-dialog-edit-file"> |
| [1305](#L1305) |  |
| [1306](#L1306) | <div class="uc-dialog-inner"> |
| [1307](#L1307) | <div id="uc\_dialog\_edit\_file\_loader" class="uc-loader-wrapper"> |
| [1308](#L1308) | <span class="loader\_text"><?php esc\_html\_e("Loading...", "unlimited-elements-for-elementor")?></span> |
| [1309](#L1309) | </div> |
| [1310](#L1310) |  |
| [1311](#L1311) | <textarea id="uc\_dialog\_edit\_file\_textarea" style="display:none"></textarea> |
| [1312](#L1312) |  |
| [1313](#L1313) | <div id="uc\_dialog\_edit\_file\_loadersaving" class="unite-dialog-loader" style="display:none"><?php esc\_html\_e("Saving File...", "unlimited-elements-for-elementor")?></div> |
| [1314](#L1314) | <div id="uc\_dialog\_edit\_file\_success" class="unite-dialog-success" style="display:none"><?php esc\_html\_e("File Saved...", "unlimited-elements-for-elementor")?></div> |
| [1315](#L1315) | <div id="uc\_dialog\_edit\_file\_error" class="unite-dialog-error"></div> |
| [1316](#L1316) |  |
| [1317](#L1317) | </div> |
| [1318](#L1318) |  |
| [1319](#L1319) | </div> |
| [1320](#L1320) | <?php |
| [1321](#L1321) | } |
| [1322](#L1322) |  |
| [1323](#L1323) |  |
| [1324](#L1324) | /\*\* |
| [1325](#L1325) | \* put move files dialog |
| [1326](#L1326) | \*/ |
| [1327](#L1327) | private function putDialogMoveFiles(){ |
| [1328](#L1328) |  |
| [1329](#L1329) | $objAssets = new UniteCreatorAssetsWork(); |
| [1330](#L1330) | $objAssets->initByKey("folder\_browser", $this->objAddon); |
| [1331](#L1331) | $objAssets->setOption(UniteCreatorAssets::OPTION\_ID, "uc\_movefile\_browser"); |
| [1332](#L1332) |  |
| [1333](#L1333) | ?> |
| [1334](#L1334) | <div id="uc\_dialog\_move\_files" title="<?php esc\_html\_e("Move Files", "unlimited-elements-for-elementor")?>" style="display:none" class="unite-inputs uc-dialog-move-file"> |
| [1335](#L1335) |  |
| [1336](#L1336) | <div class="unite-dialog-top"></div> |
| [1337](#L1337) |  |
| [1338](#L1338) | <div id="uc\_dialog\_move\_label" class="unite-inputs-label" data-text="<?php esc\_html\_e("Move %1 files to", "unlimited-elements-for-elementor")?>">:</div> |
| [1339](#L1339) |  |
| [1340](#L1340) | <div id="uc\_dialog\_move\_files\_url" class="unite-dialog-text-bold mtop\_5 mbottom\_5"></div> |
| [1341](#L1341) |  |
| [1342](#L1342) | <div class="uc-browser-wrapper"> |
| [1343](#L1343) |  |
| [1344](#L1344) | <?php $objAssets->putHTML();?> |
| [1345](#L1345) |  |
| [1346](#L1346) | </div> |
| [1347](#L1347) |  |
| [1348](#L1348) | <?php |
| [1349](#L1349) | $prefix = "uc\_dialog\_move\_files"; |
| [1350](#L1350) | $buttonTitle = esc\_html\_\_("Move Files", "unlimited-elements-for-elementor"); |
| [1351](#L1351) | $loaderTitle = esc\_html\_\_("Moving Files...", "unlimited-elements-for-elementor"); |
| [1352](#L1352) | $successTitle = esc\_html\_\_("Files Moved", "unlimited-elements-for-elementor"); |
| [1353](#L1353) | HelperHtmlUC::putDialogActions($prefix, $buttonTitle, $loaderTitle, $successTitle); |
| [1354](#L1354) | ?> |
| [1355](#L1355) |  |
| [1356](#L1356) | <div id="uc\_dialog\_move\_message" class="uc-dialog-move-message" style="display:none"> |
| [1357](#L1357) |  |
| [1358](#L1358) | <div id="uc\_dialog\_move\_message\_text" class="uc-dialog-move-message-text"></div> |
| [1359](#L1359) |  |
| [1360](#L1360) | <div class="vert\_top5"></div> |
| [1361](#L1361) |  |
| [1362](#L1362) | <a href="javascript:void(0)" class="unite-button-secondary" data-action="overwrite"><?php esc\_html\_e("Overwrite", "unlimited-elements-for-elementor")?></a> |
| [1363](#L1363) | <a href="javascript:void(0)" class="unite-button-secondary" data-action="skip"><?php esc\_html\_e("Skip", "unlimited-elements-for-elementor")?></a> |
| [1364](#L1364) | <a href="javascript:void(0)" class="unite-button-secondary" data-action="cancel"><?php esc\_html\_e("Cancel", "unlimited-elements-for-elementor")?></a> |
| [1365](#L1365) |  |
| [1366](#L1366) | </div> |
| [1367](#L1367) |  |
| [1368](#L1368) | </div> |
| [1369](#L1369) | <?php |
| [1370](#L1370) |  |
| [1371](#L1371) | } |
| [1372](#L1372) |  |
| [1373](#L1373) |  |
| [1374](#L1374) | /\*\* |
| [1375](#L1375) | \* put actions dialogs |
| [1376](#L1376) | \*/ |
| [1377](#L1377) | private function putActionsDialogs(){ |
| [1378](#L1378) |  |
| [1379](#L1379) | if($this->flagPutOnce == true) |
| [1380](#L1380) | return(false); |
| [1381](#L1381) |  |
| [1382](#L1382) | $this->putDialogCreateFolder(); |
| [1383](#L1383) | $this->putDialogCreateFile(); |
| [1384](#L1384) | $this->putDialogEditFile(); |
| [1385](#L1385) | $this->putDialogRenameFile(); |
| [1386](#L1386) | $this->putDialogMoveFiles(); |
| [1387](#L1387) | } |
| [1388](#L1388) |  |
| [1389](#L1389) |  |
| [1390](#L1390) | /\*\* |
| [1391](#L1391) | \* put actions panel |
| [1392](#L1392) | \*/ |
| [1393](#L1393) | private function putActionsPanel(){ |
| [1394](#L1394) | ?> |
| [1395](#L1395) | <div class="uc-assets-buttons-panel"> |
| [1396](#L1396) | <a class="uc-button-upload-file uc-panel-button unite-button-secondary" data-action="upload" href="javascript:void(0)" ><?php esc\_html\_e("Upload", "unlimited-elements-for-elementor")?></a> |
| [1397](#L1397) | <a class="uc-button-select-all uc-panel-button unite-button-secondary button-disabled" data-action="select\_all" href="javascript:void(0)"  data-textselect="<?php esc\_html\_e("Select All", "unlimited-elements-for-elementor")?>" data-textunselect="<?php esc\_html\_e("Unselect All", "unlimited-elements-for-elementor")?>" ><?php esc\_html\_e("Select All", "unlimited-elements-for-elementor")?></a> |
| [1398](#L1398) | <a class="uc-button-create-folder uc-panel-button unite-button-secondary" data-action="create\_folder" href="javascript:void(0)"><?php esc\_html\_e("Create Folder", "unlimited-elements-for-elementor")?></a> |
| [1399](#L1399) | <a class="uc-button-create-file uc-panel-button unite-button-secondary" data-action="create\_file" href="javascript:void(0)"><?php esc\_html\_e("Create File", "unlimited-elements-for-elementor")?></a> |
| [1400](#L1400) |  |
| [1401](#L1401) | <a class="uc-panel-button unite-button-secondary button-disabled uc-relate-multiple" data-action="delete" href="javascript:void(0)"><?php esc\_html\_e("Delete", "unlimited-elements-for-elementor")?></a> |
| [1402](#L1402) | <span class="uc-preloader-deleting loader\_text mleft\_5" style="display:none"><?php esc\_html\_e("deleting...", "unlimited-elements-for-elementor")?></span> |
| [1403](#L1403) |  |
| [1404](#L1404) | <a class="uc-panel-button unite-button-secondary button-disabled uc-relate-single uc-relate-file" data-action="edit" href="javascript:void(0)"><?php esc\_html\_e("Edit", "unlimited-elements-for-elementor")?></a> |
| [1405](#L1405) |  |
| [1406](#L1406) | <a class="uc-panel-button unite-button-secondary button-disabled uc-relate-single" data-action="rename" href="javascript:void(0)"><?php esc\_html\_e("Rename", "unlimited-elements-for-elementor")?></a> |
| [1407](#L1407) |  |
| [1408](#L1408) | <a class="uc-panel-button unite-button-secondary uc-relate-multiple button-disabled" data-action="move" href="javascript:void(0)"><?php esc\_html\_e("Move", "unlimited-elements-for-elementor")?></a> |
| [1409](#L1409) |  |
| [1410](#L1410) | <a class="uc-panel-button unite-button-secondary button-disabled uc-relate-special uc-relate-type-zip" data-action="unzip" href="javascript:void(0)"><?php esc\_html\_e("Unzip", "unlimited-elements-for-elementor")?></a> |
| [1411](#L1411) | <span class="uc-preloader-unzip loader\_round mleft\_5" style="display:none"><?php esc\_html\_e("unzipping...", "unlimited-elements-for-elementor")?></span> |
| [1412](#L1412) |  |
| [1413](#L1413) | <a class="uc-panel-button unite-button-secondary button-disabled uc-relate-single" data-action="view" href="javascript:void(0)"><?php esc\_html\_e("View", "unlimited-elements-for-elementor")?></a> |
| [1414](#L1414) |  |
| [1415](#L1415) | </div> |
| [1416](#L1416) | <?php |
| [1417](#L1417) | } |
| [1418](#L1418) |  |
| [1419](#L1419) |  |
| [1420](#L1420) | /\*\* |
| [1421](#L1421) | \* put activepath bar |
| [1422](#L1422) | \*/ |
| [1423](#L1423) | private function putActivePathBar($path){ |
| [1424](#L1424) |  |
| [1425](#L1425) | $activePath = $this->getActivePath($path); |
| [1426](#L1426) |  |
| [1427](#L1427) | ?> |
| [1428](#L1428) | <div class="uc-assets-activepath"> |
| [1429](#L1429) |  |
| [1430](#L1430) | <span class="uc-assets-activepath-inner"> |
| [1431](#L1431) | <?php esc\_html\_e("Active Path", "unlimited-elements-for-elementor")?>: |
| [1432](#L1432) | <span class="uc-pathname">../<?php echo esc\_html($activePath)?></span> |
| [1433](#L1433) | </span> |
| [1434](#L1434) |  |
| [1435](#L1435) | <span class="uc-preloader-refreshpath loader\_round mleft\_5" style="display:none"></span> |
| [1436](#L1436) | </div> |
| [1437](#L1437) |  |
| [1438](#L1438) | <?php |
| [1439](#L1439) | } |
| [1440](#L1440) |  |
| [1441](#L1441) |  |
| [1442](#L1442) |  |
| [1443](#L1443) | /\*\* |
| [1444](#L1444) | \* put html assets |
| [1445](#L1445) | \*/ |
| [1446](#L1446) | public function putHTML($path = null, $wrapperOnly = false){ |
| [1447](#L1447) |  |
| [1448](#L1448) | try{ |
| [1449](#L1449) |  |
| [1450](#L1450) | $this->validateStartPath(); |
| [1451](#L1451) |  |
| [1452](#L1452) | $activePath = $this->getActivePath($path); |
| [1453](#L1453) |  |
| [1454](#L1454) | $activePathData = htmlspecialchars($activePath); |
| [1455](#L1455) |  |
| [1456](#L1456) | $startPath = $this->getStartPathRelative(); |
| [1457](#L1457) | $startPathData = htmlspecialchars($startPath); |
| [1458](#L1458) |  |
| [1459](#L1459) | $wrapperStyle = $this->getOption(self::OPTION\_WRAPPER\_STYLE, ""); |
| [1460](#L1460) |  |
| [1461](#L1461) | if(!empty($wrapperStyle)) |
| [1462](#L1462) | $wrapperStyle = "style='{$wrapperStyle}'"; |
| [1463](#L1463) |  |
| [1464](#L1464) | $id = $this->getOption(self::OPTION\_ID, ""); |
| [1465](#L1465) | $id = esc\_attr($id); |
| [1466](#L1466) | if(!empty($id)) |
| [1467](#L1467) | $id = "id='{$id}' "; |
| [1468](#L1468) |  |
| [1469](#L1469) | $putActivepath = $this->getOption(self::OPTION\_PUT\_ACTIVEPATH); |
| [1470](#L1470) |  |
| [1471](#L1471) | $arrOptionsForClient = $this->getArrOptionsForClient(); |
| [1472](#L1472) |  |
| [1473](#L1473) | $jsonOptions = json\_encode($arrOptionsForClient); |
| [1474](#L1474) | $jsonOptions = htmlspecialchars($jsonOptions); |
| [1475](#L1475) |  |
| [1476](#L1476) | }catch(Exception $e){ |
| [1477](#L1477) | $message = $e->getMessage(); |
| [1478](#L1478) | $trace = ""; |
| [1479](#L1479) | if(GlobalsUC::$SHOW\_TRACE == true) |
| [1480](#L1480) | $trace = $e->getTraceAsString(); |
| [1481](#L1481) |  |
| [1482](#L1482) | $htmlError = HelperUC::getHtmlErrorMessage($message,$trace, "Assets Manager Error: "); |
| [1483](#L1483) | ?> |
| [1484](#L1484) | <div <?php echo UniteProviderFunctionsUC::escAddParam($id)?> data-pathkey="<?php echo esc\_attr($this->pathKey)?>" class="uc-assets-wrapper" <?php echo UniteProviderFunctionsUC::escAddParam($wrapperStyle)?> data-isbrowser="<?php echo esc\_attr($this->isBrowerMode)?>" data-path="<?php echo esc\_attr($activePathData)?>" data-startpath="<?php echo esc\_attr($startPathData)?>" data-options="<?php echo esc\_attr($jsonOptions)?>"> |
| [1485](#L1485) | <div class='uc-assets-startup-error'> |
| [1486](#L1486) | <?php |
| [1487](#L1487) | echo esc\_html($htmlError); |
| [1488](#L1488) | ?> |
| [1489](#L1489) | </div> |
| [1490](#L1490) | </div> |
| [1491](#L1491) | <?php |
| [1492](#L1492) | return(false); |
| [1493](#L1493) | } |
| [1494](#L1494) |  |
| [1495](#L1495) |  |
| [1496](#L1496) | ?> |
| [1497](#L1497) | <div <?php echo UniteProviderFunctionsUC::escAddParam($id)?>data-pathkey="<?php echo esc\_attr($this->pathKey)?>" class="uc-assets-wrapper" <?php echo UniteProviderFunctionsUC::escAddParam($wrapperStyle)?> data-isbrowser="<?php echo esc\_attr($this->isBrowerMode)?>" data-path="<?php echo esc\_attr($activePathData)?>" data-startpath="<?php echo esc\_attr($startPathData)?>" data-options="<?php echo esc\_attr($jsonOptions)?>"> |
| [1498](#L1498) |  |
| [1499](#L1499) | <?php |
| [1500](#L1500) | try{ |
| [1501](#L1501) |  |
| [1502](#L1502) | if($putActivepath === true) |
| [1503](#L1503) | $this->putActivePathBar($path); |
| [1504](#L1504) | ?> |
| [1505](#L1505) |  |
| [1506](#L1506) | <?php |
| [1507](#L1507) | if($this->isBrowerMode == false) |
| [1508](#L1508) | $this->putActionsPanel() |
| [1509](#L1509) | ?> |
| [1510](#L1510) |  |
| [1511](#L1511) | <div class="uc-preloader-filelist loader\_text mtop\_25" style="display:none"> |
| [1512](#L1512) |  |
| [1513](#L1513) | <?php esc\_html\_e("Loading File list...", "unlimited-elements-for-elementor")?> |
| [1514](#L1514) |  |
| [1515](#L1515) | </div> |
| [1516](#L1516) |  |
| [1517](#L1517) | <div class="uc-filelist-error unite-color-red mtop\_10"></div> |
| [1518](#L1518) |  |
| [1519](#L1519) | <?php |
| [1520](#L1520) | if($wrapperOnly == false) |
| [1521](#L1521) | echo UniteProviderFunctionsUC::escCombinedHtml($this->getHtmlDir($path, true)); |
| [1522](#L1522) | else |
| [1523](#L1523) | echo UniteProviderFunctionsUC::escCombinedHtml($this->getEmptyHtmlDirList()); |
| [1524](#L1524) |  |
| [1525](#L1525) | ?> |
| [1526](#L1526) |  |
| [1527](#L1527) | <?php |
| [1528](#L1528) |  |
| [1529](#L1529) | if($this->isBrowerMode == false){ |
| [1530](#L1530) |  |
| [1531](#L1531) | $this->putUploadFileDialog(); |
| [1532](#L1532) | $this->putActionsDialogs(); |
| [1533](#L1533) | } |
| [1534](#L1534) |  |
| [1535](#L1535) | $this->flagPutOnce == true; |
| [1536](#L1536) |  |
| [1537](#L1537) | }catch(Exception $e){ |
| [1538](#L1538) | $message = $e->getMessage(); |
| [1539](#L1539) | $trace = ""; |
| [1540](#L1540) | if(GlobalsUC::$SHOW\_TRACE == true) |
| [1541](#L1541) | $trace = $e->getTraceAsString(); |
| [1542](#L1542) |  |
| [1543](#L1543) | $htmlError = HelperUC::getHtmlErrorMessage($message,$trace, "Assets Manager Error: "); |
| [1544](#L1544) | ?> |
| [1545](#L1545) | <div class='uc-assets-startup-error'> |
| [1546](#L1546) | <?php |
| [1547](#L1547) | echo esc\_html($htmlError); |
| [1548](#L1548) | ?> |
| [1549](#L1549) | </div> |
| [1550](#L1550) | <?php |
| [1551](#L1551) | } |
| [1552](#L1552) | ?> |
| [1553](#L1553) | <div class="unite-clear"></div> |
| [1554](#L1554) | </div> |
| [1555](#L1555) |  |
| [1556](#L1556) | <?php |
| [1557](#L1557) | } |
| [1558](#L1558) |  |
| [1559](#L1559) | } |
| [1560](#L1560) |  |
| [1561](#L1561) | ?> |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php?format=txt)
* [Original Format](/export/3220510/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_b14247d0_20250111_023959.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Unlimited Elements For Elementor (Free Widgets, Addons, Templates) <= 1.5.66 - Authenticated (Contributor+) Arbitrary File Upload

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Unlimited Elements For Elementor (Free Widgets, Addons, Templates) <= 1.5.66 - Authenticated (Contributor+) Arbitrary File Upload

8.8

**Unrestricted Upload of File with Dangerous Type**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:H)

| CVE | [CVE-2023-3295](https://www.cve.org/CVERecord?id=CVE-2023-3295) |
| --- | --- |
| CVSS | 8.8 (High) |
| Publicly Published | June 16, 2023 |
| Last Updated | January 22, 2024 |
| Researchers | [Chloe Chamberland - Wordfence](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/chloe-chamberland)  [Rafie Muhammad - Patchstack](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/rafie-muhammad) |

### Description

The Unlimited Elements For Elementor (Free Widgets, Addons, Templates) for WordPress is vulnerable to arbitrary file uploads due to missing file type validation of files in the file manager functionality in versions up to, and including, 1.5.66 . This makes it possible for authenticated attackers, with contributor-level permissions and above, to upload arbitrary files on the affected site's server which may make remote code execution possible. The issue was partially patched in version 1.5.66 and fully patched in 1.5.67. CVE-2023-31231 appears to be a duplicate of this issue.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/unlimited-elements-for-elementor/trunk/inc_php/unitecreator_assets.class.php#L1005)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-1566-authenticated-contributor-arbitrary-file-upload&t=Unlimited%20Elements%20For%20Elementor%20%28Free%20Widgets%2C%20Addons%2C%20Templates%29%20%3C%3D%201.5.66%20-%20Authenticated%20%28Contributor%2B%29%20Arbitrary%20File%20Upload "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-1566-authenticated-contributor-arbitrary-file-upload&text=Unlimited%20Elements%20For%20Elementor%20%28Free%20Widgets%2C%20Addons%2C%20Templates%29%20%3C%3D%201.5.66%20-%20Authenticated%20%28Contributor%2B%29%20Arbitrary%20File%20Upload "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Funlimited-elements-for-elementor%2Funlimited-elements-for-elementor-free-widgets-addons-templates-1566-authenticated-contributor-arbitrary-file-upload "LinkedIn")
Email

## Vulnerability Details for Unlimited Elements For Elementor

#### [Unlimited Elements For Elementor](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/unlimited-elements-for-elementor)

| Software Type | Plugin |
| --- | --- |
| Software Slug | unlimited-elements-for-elementor [(view on wordpress.org)](https://wordpress.org/plugins/unlimited-elements-for-elementor) |
| Patched? | Yes |
| Remediation | Update to version 1.5.67, or a newer patched version |
| Affected Version | * <= 1.5.66 |
| Patched Version | * 1.5.67 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


