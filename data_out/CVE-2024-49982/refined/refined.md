```
{
  "vulnerability": {
    "root_cause": "The fix for CVE-2023-6270 moved the `dev_put()` call to the `tx()` function. However, several other functions in the AoE driver, such as `revalidate()`, `aoecmd_ata_rw()`, `resend()`, `probe()`, and `aoecmd_cfg_rsp()`, also use `aoenet_xmit()` to send packets. These functions did not have corresponding `dev_hold()` calls, leading to a potential use-after-free vulnerability, and a potential negative refcount.",
    "weaknesses": [
      "Use-after-free",
       "Incorrect reference counting"
    ],
    "impact": "A use-after-free vulnerability can lead to arbitrary code execution or a denial of service if triggered.",
    "attack_vectors": "The vulnerability is triggered through the AoE network interface when functions such as `revalidate()`, `aoecmd_ata_rw()`, `resend()`, `probe()`, and `aoecmd_cfg_rsp()` are called. The attack vector involves sending network packets via the aoe network interface that trigger the execution of the vulnerable code.",
    "required_capabilities": "An attacker would need the capability to send network packets to a system running a vulnerable kernel with the AoE driver enabled."
  },
  "patch": {
    "description": "The patch addresses the use-after-free by adding `dev_hold()` calls before setting `skb->dev` in the vulnerable functions, ensuring the device reference count is properly maintained.  It also adds `dev_put()` calls when `skb_clone` fails to avoid leaking a reference.",
    "changes": [
      "Added `dev_hold(t->ifp->nd)` before `skb->dev = t->ifp->nd` in `ata_rw_frameinit()`, `resend()`, `probe()`, and `aoecmd_ata_id()`.",
      "Added `dev_put(f->t->ifp->nd)` when `skb_clone()` fails in `aoecmd_ata_rw()`, `resend()` , `probe()`, and `aoecmd_ata_id()`."
    ]
  },
  "CVE": "CVE-2024-49982",
  "related_cve": "CVE-2023-6270"
}
```