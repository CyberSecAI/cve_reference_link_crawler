=== Content from www.wordfence.com_daf0a508_20250110_143520.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Page Restriction WordPress (WP) – Protect WP Pages/Post <= 1.3.4 - Protection Mechanism Bypass

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Page Restriction WordPress (WP) – Protect WP Pages/Post <= 1.3.4 - Protection Mechanism Bypass

5.3

**Protection Mechanism Failure**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:N/A:N)

| CVE | [CVE-2024-0681](https://www.cve.org/CVERecord?id=CVE-2024-0681) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | February 27, 2024 |
| Last Updated | March 13, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The Page Restriction WordPress (WP) – Protect WP Pages/Post plugin for WordPress is vulnerable to information disclosure in all versions up to, and including, 1.3.4. This is due to the plugin not properly restricting access to pages via the REST API when a page has been made private. This makes it possible for unauthenticated attackers to view protected pages. The vendor has decided that they will not implement REST API protection on posts and pages and the restrictions will only apply to the front-end of the site. The vendors solution was to add notices throughout the dashboard and recommends installing the WordPress REST API Authentication plugin for REST API coverage.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset?sfp_email=&sfph_mail=&reponame=&old=3034414%40page-and-post-restriction&new=3034414%40page-and-post-restriction&sfp_email=&sfph_mail=)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-and-post-restriction%2Fpage-restriction-wordpress-wp-protect-wp-pagespost-134-protection-mechanism-bypass&t=Page%20Restriction%20WordPress%20%28WP%29%20%E2%80%93%20Protect%20WP%20Pages%2FPost%20%3C%3D%201.3.4%20-%20Protection%20Mechanism%20Bypass "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-and-post-restriction%2Fpage-restriction-wordpress-wp-protect-wp-pagespost-134-protection-mechanism-bypass&text=Page%20Restriction%20WordPress%20%28WP%29%20%E2%80%93%20Protect%20WP%20Pages%2FPost%20%3C%3D%201.3.4%20-%20Protection%20Mechanism%20Bypass "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-and-post-restriction%2Fpage-restriction-wordpress-wp-protect-wp-pagespost-134-protection-mechanism-bypass "LinkedIn")
Email

## Vulnerability Details for Page and Post Restriction

#### [Page and Post Restriction](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/page-and-post-restriction)

| Software Type | Plugin |
| --- | --- |
| Software Slug | page-and-post-restriction [(view on wordpress.org)](https://wordpress.org/plugins/page-and-post-restriction) |
| Patched? | Yes |
| Remediation | Update to version 1.3.5, or a newer patched version |
| Affected Version | * <= 1.3.4 |
| Patched Version | * 1.3.5 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_6531bf5c_20250110_143519.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3034414%2540page-and-post-restriction%26old%3D3034414%2540page-and-post-restriction)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2866879/page-and-post-restriction "Changeset 2866879 for page-and-post-restriction")
* [Next Change](/changeset/3069110/page-and-post-restriction "Changeset 3069110 for page-and-post-restriction") →

---

# Changeset [3034414](/changeset/3034414 "Show full changeset") for [page-and-post-restriction](/browser/page-and-post-restriction?rev=3034414 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/12/2024 08:44:10 AM
([11 months](/timeline?from=2024-02-12T08%3A44%3A10Z&precision=second "See timeline at 02/12/2024 08:44:10 AM") ago)

Author:
anukasha
Message:

Release 1.3.5

* Added notice for REST API Authentication
* Code Improvements

Location:
[page-and-post-restriction](/browser/page-and-post-restriction?rev=3034414)
Files:

46 added
18 edited

* [tags/1.3.5](/browser/page-and-post-restriction/tags/1.3.5?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/feedback-form.php](/browser/page-and-post-restriction/tags/1.3.5/feedback-form.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes](/browser/page-and-post-restriction/tags/1.3.5/includes?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css](/browser/page-and-post-restriction/tags/1.3.5/includes/css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/bootstrap](/browser/page-and-post-restriction/tags/1.3.5/includes/css/bootstrap?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/bootstrap/bootstrap.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/bootstrap/bootstrap.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/bootstrap/bootstrap.min.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/bootstrap/bootstrap.min.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/papr\_feedback\_style.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/papr_feedback_style.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/papr\_feedback\_style.min.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/papr_feedback_style.min.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/papr\_settings\_style.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/papr_settings_style.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/papr\_settings\_style.min.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/papr_settings_style.min.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/phone.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/phone.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/css/phone.min.css](/browser/page-and-post-restriction/tags/1.3.5/includes/css/phone.min.css?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images](/browser/page-and-post-restriction/tags/1.3.5/includes/images?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/collapse.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/collapse.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/collapse1.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/collapse1.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/flags16.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/flags16.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/lock.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/lock.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/miniorange-logo.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/miniorange-logo.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/miniorange.png](/browser/page-and-post-restriction/tags/1.3.5/includes/images/miniorange.png?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/images/prem-lock.svg](/browser/page-and-post-restriction/tags/1.3.5/includes/images/prem-lock.svg?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js](/browser/page-and-post-restriction/tags/1.3.5/includes/js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/bootstrap](/browser/page-and-post-restriction/tags/1.3.5/includes/js/bootstrap?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/bootstrap/bootstrap.min.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/bootstrap/bootstrap.min.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/bootstrap/popper.min.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/bootstrap/popper.min.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/page-restriction-quick-edit.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/page-restriction-quick-edit.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/papr-custom-role.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/papr-custom-role.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/papr\_role\_assigned.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/papr_role_assigned.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/papr\_role\_dropdown.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/papr_role_dropdown.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/papr\_settings.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/papr_settings.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/includes/js/phone.js](/browser/page-and-post-restriction/tags/1.3.5/includes/js/phone.js?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-and-post-restriction.php](/browser/page-and-post-restriction/tags/1.3.5/page-and-post-restriction.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-category-access.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-category-access.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-class-customer.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-class-customer.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-custom-roles-constants.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-custom-roles-constants.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-custom-roles-sub-menu.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-custom-roles-sub-menu.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-custom-roles.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-custom-roles.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-menu-settings.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-menu-settings.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-page-access.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-page-access.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-post-access.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-post-access.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-premium-plan.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-premium-plan.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-save.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-save.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-tag-access.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-tag-access.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/page-restriction-utility.php](/browser/page-and-post-restriction/tags/1.3.5/page-restriction-utility.php?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/readme.txt](/browser/page-and-post-restriction/tags/1.3.5/readme.txt?rev=3034414 "Show entry in browser")
  (added)
* [tags/1.3.5/uninstall.php](/browser/page-and-post-restriction/tags/1.3.5/uninstall.php?rev=3034414 "Show entry in browser")
  (added)
* [trunk/feedback-form.php](/browser/page-and-post-restriction/trunk/feedback-form.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file46 "Show differences"))
* [trunk/includes/css/papr\_settings\_style.css](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.css?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file47 "Show differences"))
* [trunk/includes/css/papr\_settings\_style.min.css](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.min.css?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file48 "Show differences"))
* [trunk/page-and-post-restriction.php](/browser/page-and-post-restriction/trunk/page-and-post-restriction.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file49 "Show differences"))
* [trunk/page-restriction-category-access.php](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=3034414 "Show entry in browser")
  (modified)
  ([4 diffs](#file50 "Show differences"))
* [trunk/page-restriction-class-customer.php](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=3034414 "Show entry in browser")
  (modified)
  ([4 diffs](#file51 "Show differences"))
* [trunk/page-restriction-custom-roles-constants.php](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file52 "Show differences"))
* [trunk/page-restriction-custom-roles-sub-menu.php](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file53 "Show differences"))
* [trunk/page-restriction-custom-roles.php](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file54 "Show differences"))
* [trunk/page-restriction-menu-settings.php](/browser/page-and-post-restriction/trunk/page-restriction-menu-settings.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file55 "Show differences"))
* [trunk/page-restriction-page-access.php](/browser/page-and-post-restriction/trunk/page-restriction-page-access.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file56 "Show differences"))
* [trunk/page-restriction-post-access.php](/browser/page-and-post-restriction/trunk/page-restriction-post-access.php?rev=3034414 "Show entry in browser")
  (modified)
  ([2 diffs](#file57 "Show differences"))
* [trunk/page-restriction-premium-plan.php](/browser/page-and-post-restriction/trunk/page-restriction-premium-plan.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file58 "Show differences"))
* [trunk/page-restriction-save.php](/browser/page-and-post-restriction/trunk/page-restriction-save.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file59 "Show differences"))
* [trunk/page-restriction-tag-access.php](/browser/page-and-post-restriction/trunk/page-restriction-tag-access.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file60 "Show differences"))
* [trunk/page-restriction-utility.php](/browser/page-and-post-restriction/trunk/page-restriction-utility.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file61 "Show differences"))
* [trunk/readme.txt](/browser/page-and-post-restriction/trunk/readme.txt?rev=3034414 "Show entry in browser")
  (modified)
  ([4 diffs](#file62 "Show differences"))
* [trunk/uninstall.php](/browser/page-and-post-restriction/trunk/uninstall.php?rev=3034414 "Show entry in browser")
  (modified)
  ([1 diff](#file63 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [page-and-post-restriction/trunk/feedback-form.php](/changeset/3034414/page-and-post-restriction/trunk/feedback-form.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/feedback-form.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/feedback-form.php?rev=2829798#L5 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/feedback-form.php?rev=3034414#L5 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | return; |
  | 6 | 6 | } |
  | 7 |  | wp\_enqueue\_style( 'papr\_admin\_plugin\_feedback\_style', plugins\_url( '/includes/css/papr\_feedback\_style.min.css', \_\_FILE\_\_ ) ); |
  |  | 7 | wp\_enqueue\_style( 'papr\_admin\_plugin\_feedback\_style', plugins\_url( '/includes/css/papr\_feedback\_style.min.css', \_\_FILE\_\_ ) ); |
  | 8 | 8 | ?> |
  | 9 | 9 |  |
  | 10 |  | <div id="papr\_feedback\_modal" class="mo\_papr\_modal"> |
  |  | 10 | <div id="papr\_feedback\_modal" class="mo\_papr\_modal"> |
  | 11 | 11 |  |
  | 12 |  | <div class="mo\_papr\_feedback\_content"> |
  | 13 |  | <h3 style="margin: 2%; text-align:center;"> |
  | 14 |  | <b>Your feedback</b> |
  | 15 |  | <span class="papr\_close">&times;</span> |
  | 16 |  | </h3> |
  | 17 |  | <hr class="mo\_papr\_feedback\_hr"> |
  |  | 12 | <div class="mo\_papr\_feedback\_content"> |
  |  | 13 | <h3 style="margin: 2%; text-align:center;"> |
  |  | 14 | <b>Your feedback</b> |
  |  | 15 | <span class="papr\_close">&times;</span> |
  |  | 16 | </h3> |
  |  | 17 | <hr class="mo\_papr\_feedback\_hr"> |
  | 18 | 18 |  |
  | 19 |  | <form name="f" method="post" id="papr\_feedback"> |
  | 20 |  | <?php wp\_nonce\_field(~~"papr\_feedback");~~?> |
  | 21 |  | <input type="hidden" name="option" value="papr\_feedback"/> |
  | 22 |  | <div> |
  | 23 |  | <h4 style="margin: 2%;">Please tell us what went wrong.<br></h4> |
  |  | 19 | <form name="f" method="post" id="papr\_feedback"> |
  |  | 20 | <?php wp\_nonce\_field( 'papr\_feedback' ); ?> |
  |  | 21 | <input type="hidden" name="option" value="papr\_feedback"/> |
  |  | 22 | <div> |
  |  | 23 | <h4 style="margin: 2%;">Please tell us what went wrong.<br></h4> |
  | 24 | 24 |  |
  | 25 |  | <div style="text-align: left;padding:2% 10%;"> |
  | 26 |  | <input type="radio" name="papr\_reason" value="Missing Features" id="papr\_feature"/> |
  | 27 |  | <label for="papr\_feature" class="mo\_papr\_feedback\_option" > Does not have the features I'm looking for</label> |
  | 28 |  | <br> |
  |  | 25 | <div style="text-align: left;padding:2% 10%;"> |
  |  | 26 | <input type="radio" name="papr\_reason" value="Missing Features" id="papr\_feature"/> |
  |  | 27 | <label for="papr\_feature" class="mo\_papr\_feedback\_option" > Does not have the features I'm looking for</label> |
  |  | 28 | <br> |
  | 29 | 29 |  |
  | 30 |  | <input type="radio" name="papr\_reason" value="Costly" id="papr\_costly" class="mo\_papr\_feedback\_radio" /> |
  | 31 |  | <label for="papr\_costly" class="mo\_papr\_feedback\_option">Do not want to upgrade - Too costly</label> |
  | 32 |  | <br> |
  |  | 30 | <input type="radio" name="papr\_reason" value="Costly" id="papr\_costly" class="mo\_papr\_feedback\_radio" /> |
  |  | 31 | <label for="papr\_costly" class="mo\_papr\_feedback\_option">Do not want to upgrade - Too costly</label> |
  |  | 32 | <br> |
  | 33 | 33 |  |
  | 34 |  | <input type="radio" name="papr\_reason" value="Confusing" id="papr\_confusing" class="mo\_papr\_feedback\_radio"/> |
  | 35 |  | <label for="papr\_confusing" class="mo\_papr\_feedback\_option">Confusing Interface</label> |
  | 36 |  | <br> |
  |  | 34 | <input type="radio" name="papr\_reason" value="Confusing" id="papr\_confusing" class="mo\_papr\_feedback\_radio"/> |
  |  | 35 | <label for="papr\_confusing" class="mo\_papr\_feedback\_option">Confusing Interface</label> |
  |  | 36 | <br> |
  | 37 | 37 |  |
  | 38 |  | <input type="radio" name="papr\_reason" value="Bugs" id="papr\_bugs" class="mo\_papr\_feedback\_radio"/> |
  | 39 |  | <label for="papr\_bugs" class="mo\_papr\_feedback\_option">Bugs in the plugin</label> |
  | 40 |  | <br> |
  |  | 38 | <input type="radio" name="papr\_reason" value="Bugs" id="papr\_bugs" class="mo\_papr\_feedback\_radio"/> |
  |  | 39 | <label for="papr\_bugs" class="mo\_papr\_feedback\_option">Bugs in the plugin</label> |
  |  | 40 | <br> |
  | 41 | 41 |  |
  | 42 |  | <input type="radio" name="papr\_reason" value="other" id="papr\_other" class="mo\_papr\_feedback\_radio"/> |
  | 43 |  | <label for="papr\_other" class="mo\_papr\_feedback\_option">Other Reasons</label> |
  | 44 |  | <br><br> |
  |  | 42 | <input type="radio" name="papr\_reason" value="other" id="papr\_other" class="mo\_papr\_feedback\_radio"/> |
  |  | 43 | <label for="papr\_other" class="mo\_papr\_feedback\_option">Other Reasons</label> |
  |  | 44 | <br><br> |
  | 45 | 45 |  |
  | 46 |  | <textarea id="papr\_query\_feedback" name="papr\_query\_feedback" rows="4" style="width: 100%" |
  | 47 |  | placeholder="Tell us what happened!"></textarea> |
  | 48 |  | </div> |
  |  | 46 | <textarea id="papr\_query\_feedback" name="papr\_query\_feedback" rows="4" style="width: 100%" |
  |  | 47 | placeholder="Tell us what happened!"></textarea> |
  |  | 48 | </div> |
  | 49 | 49 |  |
  | 50 |  | <hr class="mo\_papr\_feedback\_hr"> |
  |  | 50 | <hr class="mo\_papr\_feedback\_hr"> |
  | 51 | 51 |  |
  | 52 |  | <div>Thank you for your valuable time</div> |
  | 53 |  | <br> |
  |  | 52 | <div>Thank you for your valuable time</div> |
  |  | 53 | <br> |
  | 54 | 54 |  |
  | 55 |  | <div class="mo\_papr\_feedback\_footer"> |
  | 56 |  | <input type="submit" name="miniorange\_feedback\_submit" |
  | 57 |  | class="papr-btn-cstm rounded" value="Send"/> |
  | 58 |  | <input type="button" name="miniorange\_skip\_feedback" |
  | 59 |  | class="papr-btn-cstm rounded" value="Skip" onclick="document.getElementById('papr\_feedback\_form\_close').submit();"/> |
  | 60 |  | </div> |
  | 61 |  | </div> |
  | 62 |  | </form> |
  |  | 55 | <div class="mo\_papr\_feedback\_footer"> |
  |  | 56 | <input type="submit" name="miniorange\_feedback\_submit" |
  |  | 57 | class="papr-btn-cstm rounded" value="Send"/> |
  |  | 58 | <input type="button" name="miniorange\_skip\_feedback" |
  |  | 59 | class="papr-btn-cstm rounded" value="Skip" onclick="document.getElementById('papr\_feedback\_form\_close').submit();"/> |
  |  | 60 | </div> |
  |  | 61 | </div> |
  |  | 62 | </form> |
  | 63 | 63 |  |
  | 64 |  | <form name="f" method="post" action="" id="papr\_feedback\_form\_close"> |
  | 65 |  | <?php wp\_nonce\_field(~~"papr\_skip\_feedback");~~?> |
  | 66 |  | <input type="hidden" name="option" value="papr\_skip\_feedback"/> |
  | 67 |  | </form> |
  | 68 |  | </div> |
  | 69 |  | </div> |
  |  | 64 | <form name="f" method="post" action="" id="papr\_feedback\_form\_close"> |
  |  | 65 | <?php wp\_nonce\_field( 'papr\_skip\_feedback' ); ?> |
  |  | 66 | <input type="hidden" name="option" value="papr\_skip\_feedback"/> |
  |  | 67 | </form> |
  |  | 68 | </div> |
  |  | 69 | </div> |
  | 70 | 70 |  |
  | 71 |  | <script> |
  | 72 |  | jQuery('a[aria-label="Deactivate Page Restriction WordPress (WP) - Protect WP Pages/Post"]').click(function () { |
  |  | 71 | <script> |
  |  | 72 | jQuery('a[aria-label="Deactivate Page Restriction WordPress (WP) - Protect WP Pages/Post"]').click(function () { |
  | 73 | 73 |  |
  | 74 |  | var mo\_modal = document.getElementById('papr\_feedback\_modal'); |
  |  | 74 | var mo\_modal = document.getElementById('papr\_feedback\_modal'); |
  | 75 | 75 |  |
  | 76 |  | var span = document.getElementsByClassName("papr\_close")[0]; |
  |  | 76 | var span = document.getElementsByClassName("papr\_close")[0]; |
  | 77 | 77 |  |
  | 78 |  | mo\_modal.style.display = "block"; |
  | 79 |  | document.querySelector("#papr\_query\_feedback").focus(); |
  | 80 |  | span.onclick = function () { |
  | 81 |  | mo\_modal.style.display = "none"; |
  | 82 |  | jQuery('#papr\_feedback\_form\_close').submit(); |
  | 83 |  | }; |
  |  | 78 | mo\_modal.style.display = "block"; |
  |  | 79 | document.querySelector("#papr\_query\_feedback").focus(); |
  |  | 80 | span.onclick = function () { |
  |  | 81 | mo\_modal.style.display = "none"; |
  |  | 82 | jQuery('#papr\_feedback\_form\_close').submit(); |
  |  | 83 | }; |
  | 84 | 84 |  |
  | 85 |  | window.onclick = function (event) { |
  | 86 |  | if (event.target === mo\_modal) { |
  | 87 |  | mo\_modal.style.display = "none"; |
  | 88 |  | } |
  | 89 |  | }; |
  | 90 |  | return false; |
  |  | 85 | window.onclick = function (event) { |
  |  | 86 | if (event.target === mo\_modal) { |
  |  | 87 | mo\_modal.style.display = "none"; |
  |  | 88 | } |
  |  | 89 | }; |
  |  | 90 | return false; |
  | 91 | 91 |  |
  | 92 |  | }); |
  | 93 |  | </script> |
  | 94 |  | <?php |
  |  | 92 | }); |
  |  | 93 | </script> |
  |  | 94 | <?php |
  | 95 | 95 | } |
  | 96 | 96 |  |
* ## [page-and-post-restriction/trunk/includes/css/papr\_settings\_style.css](/changeset/3034414/page-and-post-restriction/trunk/includes/css/papr_settings_style.css "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/includes/css/papr_settings_style.css")

  | [r2829798](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.css?rev=2829798#L1 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.css?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | html { |
  | 2 | 2 | scroll-behavior: smooth; |
  |  | 3 | } |
  |  | 4 |  |
  |  | 5 | .notice.custom-notice { |
  |  | 6 | border-left-color: #ffA500; |
  |  | 7 | position:absolute; |
  |  | 8 | } |
  |  | 9 |  |
  |  | 10 | .wp-core-ui .notice.is-dismissible{ |
  |  | 11 | padding-right: 38px; |
  |  | 12 | position: absolute; |
  |  | 13 | width: 100%; |
  |  | 14 | margin: 1rem 10rem 0 0; |
  |  | 15 | top: 5rem; |
  |  | 16 | } |
  |  | 17 |  |
  |  | 18 | .notice.custom-notice .notice-dismiss { |
  |  | 19 | display: none; |
  |  | 20 | } |
  |  | 21 |  |
  |  | 22 | .papr-margin-add { |
  |  | 23 | margin-top:3rem; |
  | 3 | 24 | } |
  | 4 | 25 |  |
* ## [page-and-post-restriction/trunk/includes/css/papr\_settings\_style.min.css](/changeset/3034414/page-and-post-restriction/trunk/includes/css/papr_settings_style.min.css "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/includes/css/papr_settings_style.min.css")

  | [r2829798](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.min.css?rev=2829798#L1 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/includes/css/papr_settings_style.min.css?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 |  | ~~html{scroll-behavior:smooth}.papr\_table\_col{vertical-align:top;width:75%}.papr\_support\_col{vertical-align:top}.papr\_restrict\_option{float:left;width:50%}.papr\_container{display:block;margin-top:1px;background-color:rgba(255,255,255,255);padding:0 10px;border:solid 1px #ccc}.switch{position:relative;display:inline-block;width:40px;height:24px}.switch input{opacity:0;width:0;height:0}.slider{cursor:pointer;margin-top:-1.5rem;text-indent:-9999px;width:56px;height:30px;background:#bfbdbd;display:block;border-radius:100px;position:relative}.slider:before{content:'';position:absolute;top:5px;left:5px;width:20px;height:20px;background:#fff;border-radius:90px;transition:.3s}input:checked+.slider{background-color:#173f7b}input:focus+.slider{box-shadow:0 0 1px #0085ba}input:checked+.slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(26px);transform:translateX(26px)}input:disabled+.slider{background-color:#ebebeb;cursor:default}.flex-container{display:flex;justify-content:center;align-items:baseline}.flex-container>div{background-color:#f1f1f1;border-radius:5px;margin:10px;padding:0;font-size:15px}.close{cursor:pointer;position:absolute;top:50%;right:0;left:45%;padding:12px 16px;transform:translate(0,-50%)}.close:hover{background:#eee;top:50%;right:0;left:45%}.papr-bg-main{background:#f4f4f4}.papr-margin-left{margin-left:-20px}.papr-p-text{font-size:1rem}.papr-bg-cstm{background:#f1f6ff}.papr-form-head:after{content:'';display:block;height:5px;background:#1f3668;margin-top:9px;border-radius:30px}.papr-form-head-bar:after{width:50px}.papr-shadow{box-shadow:0 2px 5px rgb(0 0 0 / 12%)}.papr-btn-cstm{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%)!important;border:none;margin-right:10px;font-size:1.1rem;padding:.3rem 1.5rem;color:#fff!important;text-decoration:none;cursor:pointer}.papr-btn-cstm-role-create{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%)!important;border:none;margin-right:10px;font-size:1.1rem;padding:.3rem 1.5rem;color:#fff!important;cursor:pointer}.papr-btn-cstm-role-create[disabled]{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%);color:#fff!important;opacity:.65;cursor:not-allowed}.papr-pagination-btn{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%);color:#fff;display:inline-block;vertical-align:baseline;min-width:30px;min-height:30px;margin:0;padding:0 4px;font-size:16px;line-height:1.625;text-align:center}.papr-pagination-btn[disabled]{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%);color:#fff!important;opacity:.65;cursor:not-allowed}.papr-btn-cstm:hover,.papr-pagination-btn:hover{text-decoration:none;opacity:.9;color:#fff}.papr-prem-info{padding:1rem;background:#f4f4f4;border:4px solid #d5e2ff;border-radius:5px}.papr-nav-tab{background:0 0;color:#1d2238;font-size:1rem;font-weight:500;padding:.9rem 1rem;cursor:pointer;transition:.3s cubic-bezier(.4,0,.2,1);border:none}.papr-nav-tab:hover{text-decoration:none;background-color:#e5e7e9}.papr-nav-tab:focus{box-shadow:none;outline:0}.nav-tab-active{border-bottom:3px solid #384e7e!important}.papr-lic-head{background:#133664!important;color:#fff}.papr-license-plan tr:nth-child(odd){background-color:#e9f0ff}.papr-price{font-weight:400}.papr-prem-icn{position:absolute;z-index:10;display:inline-flex;left:30%}.papr-prem-icn-log{left:66%}.papr-prem-cat-icn{position:absolute;justify-content:right;display:flex;left:66%}.papr-prem-info-text{display:none;width:388px;background-color:#000000d4;color:#fff!important;font-size:1.1rem;text-align:center;border-radius:6px;padding:.6em .5em;left:-22em;bottom:-2.5em;position:absolute;z-index:1}.papr-prem-info-text::after{content:" ";position:absolute;top:77%;right:100%;margin-top:-28px;border-width:5px;border-style:solid;border-color:transparent transparent transparent #000000fa;left:100%}.papr-prem-icn:hover .papr-prem-info-text{display:block}.papr-prem-btn{line-height:7px;box-shadow:inset 2px 2px 2px 0 rgb(255 255 255 / 50%),7px 7px 20px 0 rgb(0 0 0 / 10%),4px 4px 5px 0 rgb(0 0 0 / 10%);border-radius:80px;color:#fff;text-decoration:none;background-color:orange}.papr-prem-btn:hover{text-decoration:none;opacity:.8}.papr-info-global{position:absolute;z-index:10;display:inline-flex}.papr-info-text-global{display:none;width:400px;background-color:#f4f4f4;color:#2f4f4f;font-size:14px;text-align:center;border-radius:6px;padding:.6em .5em;left:1.6em;bottom:-2.5em;position:absolute;z-index:1;box-shadow:0 0 1px #0085ba}.papr-info-text-global::after{content:" ";position:absolute;margin-top:-3px;border-width:5px;border-style:solid;border-color:transparent #dcdcde transparent transparent;left:-10.7px}.papr-info-global:hover .papr-info-text-global{display:block}.papr-info-global:hover{cursor:pointer}.papr-editor-block{width:100%;align-content:center;height:8em}.roles\_buttons{text-decoration:none;color:#000}.roles\_buttons:hover{cursor:pointer!important;color:#000}.div\_button:hover{background-color:#f1f6ff!important}.flex-container-custom-role{display:flex;margin-left:-30px}.flex-container-custom-role>div{margin:0}.display\_custom\_role\_nav{font-size:18px;width:200px;padding-left:0}.display\_custom\_role\_table\_edit{font-size:17px;background-color:#f1f6ff;padding-left:10px;min-height:450px}ul.role\_usability{display:table;width:auto;text-align:center}ul.role\_usability>li{display:table-cell;padding-right:5px}.form-head{position:relative}.form-head:after{content:'';display:block;height:5px;background:#1f3668;margin-top:9px;border-radius:30px~~}.text-end{text-align:right!important}.role\_table\_width{width:750px!important}@media screen and (width:1396.36px){.role\_table\_width{width:655px!important}}@media screen and (width:1228.80px){.role\_table\_width{width:535px!important}}@media screen and (width:1706.67px){.role\_table\_width{width:880px!important}}@media screen and (width:1920px){.role\_table\_width{width:1030px!important}} |
  |  | 1 | .papr\_support\_col,.papr\_table\_col{vertical-align:top}.slider,.switch{position:relative}.close,.slider{cursor:pointer}.papr-btn-cstm,.papr-nav-tab:hover,.papr-prem-btn,.papr-prem-btn:hover,.roles\_buttons{text-decoration:none}html{scroll-behavior:smooth}.notice.custom-notice{border-left-color:orange;position:absolute}.wp-core-ui .notice.is-dismissible{padding-right:38px;position:absolute;width:100%;margin:1rem 10rem 0 0;top:5rem}.notice.custom-notice .notice-dismiss{display:none}.papr-margin-add{margin-top:3rem}.papr\_table\_col{width:75%}.papr\_restrict\_option{float:left;width:50%}.papr\_container{display:block;margin-top:1px;background-color:#fff;padding:0 10px;border:1px solid #ccc}.switch{display:inline-block;width:40px;height:24px}.papr-info-global:hover .papr-info-text-global,.papr-prem-icn:hover .papr-prem-info-text,.slider{display:block}.switch input{opacity:0;width:0;height:0}.slider{margin-top:-1.5rem;text-indent:-9999px;width:56px;height:30px;background:#bfbdbd;border-radius:100px}.slider:before{content:'';position:absolute;top:5px;left:5px;width:20px;height:20px;background:#fff;border-radius:90px;transition:.3s}.close,.close:hover{top:50%;right:0;left:45%}input:checked+.slider{background-color:#173f7b}input:focus+.slider{box-shadow:0 0 1px #0085ba}input:checked+.slider:before{-webkit-transform:translateX(26px);-ms-transform:translateX(26px);transform:translateX(26px)}input:disabled+.slider{background-color:#ebebeb;cursor:default}.flex-container{display:flex;justify-content:center;align-items:baseline}.flex-container>div{background-color:#f1f1f1;border-radius:5px;margin:10px;padding:0;font-size:15px}.close{position:absolute;padding:12px 16px;transform:translate(0,-50%)}.close:hover{background:#eee}.papr-bg-main{background:#f4f4f4}.papr-margin-left{margin-left:-20px}.papr-p-text{font-size:1rem}.papr-bg-cstm{background:#f1f6ff}.form-head:after,.papr-form-head:after{content:'';display:block;height:5px;background:#1f3668;margin-top:9px;border-radius:30px}.papr-btn-cstm,.papr-btn-cstm-role-create{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%)!important;border:none;margin-right:10px;font-size:1.1rem;padding:.3rem 1.5rem;cursor:pointer;color:#fff!important}.papr-form-head-bar:after{width:50px}.papr-shadow{box-shadow:0 2px 5px rgb(0 0 0 / 12%)}.papr-btn-cstm-role-create[disabled],.papr-pagination-btn[disabled]{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%);color:#fff!important;opacity:.65;cursor:not-allowed}.papr-info-global:hover,.papr-nav-tab{cursor:pointer}.papr-pagination-btn{background:linear-gradient(0deg,rgb(14 42 71) 0,rgb(26 69 138) 100%);color:#fff;display:inline-block;vertical-align:baseline;min-width:30px;min-height:30px;margin:0;padding:0 4px;font-size:16px;line-height:1.625;text-align:center}.papr-btn-cstm:hover,.papr-pagination-btn:hover{text-decoration:none;opacity:.9;color:#fff}.papr-prem-info{padding:1rem;background:#f4f4f4;border:4px solid #d5e2ff;border-radius:5px}.papr-nav-tab{background:0 0;color:#1d2238;font-size:1rem;font-weight:500;padding:.9rem 1rem;transition:.3s cubic-bezier(.4, 0, .2, 1);border:none}.papr-info-text-global,.papr-prem-info-text{padding:.6em .5em;bottom:-2.5em;text-align:center}.papr-nav-tab:hover{background-color:#e5e7e9}.papr-nav-tab:focus{box-shadow:none;outline:0}.nav-tab-active{border-bottom:3px solid #384e7e!important}.papr-info-text-global::after,.papr-prem-info-text::after{content:" ";position:absolute;border-width:5px;border-style:solid}.papr-lic-head{background:#133664!important;color:#fff}.papr-license-plan tr:nth-child(odd){background-color:#e9f0ff}.papr-price{font-weight:400}.papr-prem-icn{position:absolute;z-index:10;display:inline-flex;left:30%}.papr-prem-icn-log{left:66%}.papr-prem-cat-icn{position:absolute;justify-content:right;display:flex;left:66%}.papr-prem-info-text{display:none;width:388px;background-color:#000000d4;color:#fff!important;font-size:1.1rem;border-radius:6px;left:-22em;position:absolute;z-index:1}.papr-prem-info-text::after{top:77%;right:100%;margin-top:-28px;border-color:transparent transparent transparent #000000fa;left:100%}.papr-prem-btn{line-height:7px;box-shadow:inset 2px 2px 2px 0 rgb(255 255 255 / 50%),7px 7px 20px 0 rgb(0 0 0 / 10%),4px 4px 5px 0 rgb(0 0 0 / 10%);border-radius:80px;color:#fff;background-color:orange}.papr-prem-btn:hover{opacity:.8}.papr-info-global{position:absolute;z-index:10;display:inline-flex}.papr-info-text-global{display:none;width:400px;background-color:#f4f4f4;color:#2f4f4f;font-size:14px;border-radius:6px;left:1.6em;position:absolute;z-index:1;box-shadow:0 0 1px #0085ba}.papr-info-text-global::after{margin-top:-3px;border-color:transparent #dcdcde transparent transparent;left:-10.7px}.papr-editor-block{width:100%;align-content:center;height:8em}.roles\_buttons{color:#000}.roles\_buttons:hover{cursor:pointer!important;color:#000}.div\_button:hover{background-color:#f1f6ff!important}.flex-container-custom-role{display:flex;margin-left:-30px}.flex-container-custom-role>div{margin:0}.display\_custom\_role\_nav{font-size:18px;width:200px;padding-left:0}.display\_custom\_role\_table\_edit{font-size:17px;background-color:#f1f6ff;padding-left:10px;min-height:450px}ul.role\_usability{display:table;width:auto;text-align:center}ul.role\_usability>li{display:table-cell;padding-right:5px}.form-head{position:relative}.text-end{text-align:right!important}.role\_table\_width{width:750px!important}@media screen and (width:1396.36px){.role\_table\_width{width:655px!important}}@media screen and (width:1228.80px){.role\_table\_width{width:535px!important}}@media screen and (width:1706.67px){.role\_table\_width{width:880px!important}}@media screen and (width:1920px){.role\_table\_width{width:1030px!important}} |
* ## [page-and-post-restriction/trunk/page-and-post-restriction.php](/changeset/3034414/page-and-post-restriction/trunk/page-and-post-restriction.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-and-post-restriction.php")

  | [r2866879](/browser/page-and-post-restriction/trunk/page-and-post-restriction.php?rev=2866879#L1 "Show revision 2866879 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-and-post-restriction.php?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 | /\*\* |
  | 3 |  | \* Plugin Name: Page Restriction WordPress (WP) - Protect WP Pages/Post |
  | 4 |  | \* Description: This plugin allows restriction over users based on their roles and whether they are logged in or not. |
  | 5 |  | \* Version: 1.3.4 |
  | 6 |  | \* Author: miniOrange |
  | 7 |  | \* Author URI: https://miniorange.com |
  | 8 |  | \* License: MIT/Expat |
  | 9 |  | \* License URI: https://docs.miniorange.com/mit-license |
  | 10 |  | \*/ |
  | 11 |  |  |
  | 12 |  | require\_once~~('page-restriction-save.php')~~; |
  | 13 |  | require\_once~~('feedback-form.php')~~; |
  | 14 |  | require\_once~~('page-restriction-menu-settings.php')~~; |
  | 15 |  | ~~includ~~e\_once 'page-restriction-utility.php'; |
  | 16 |  | require\_once~~('page-restriction-custom-roles-sub-menu.php')~~; |
  |  | 3 | \* Plugin Name: Page Restriction WordPress (WP) - Protect WP Pages/Post |
  |  | 4 | \* Description: This plugin allows restriction over users based on their roles and whether they are logged in or not. |
  |  | 5 | \* Version: 1.3.5 |
  |  | 6 | \* Author: miniOrange |
  |  | 7 | \* Author URI: https://miniorange.com |
  |  | 8 | \* License: MIT/Expat |
  |  | 9 | \* License URI: https://docs.miniorange.com/mit-license |
  |  | 10 | \*/ |
  |  | 11 |  |
  |  | 12 | require\_once 'page-restriction-save.php'; |
  |  | 13 | require\_once 'feedback-form.php'; |
  |  | 14 | require\_once 'page-restriction-menu-settings.php'; |
  |  | 15 | require\_once 'page-restriction-utility.php'; |
  |  | 16 | require\_once 'page-restriction-custom-roles-sub-menu.php'; |
  | 17 | 17 |  |
  | 18 | 18 | class page\_and\_post\_restriction\_add\_on { |
  | 19 | 19 |  |
  | 20 |  | function \_\_construct(){ |
  | 21 |  | update\_option('papr\_host\_name','https://login.xecurify.com'); |
  | 22 |  | add\_action( 'admin\_menu', array( $this, 'papr\_menu'),11 ); |
  | 23 |  | add\_action( 'admin\_init', 'papr\_save\_setting', 1, 0 ); |
  | 24 |  | add\_action( 'admin\_enqueue\_scripts', array( $this, 'papr\_plugin\_settings\_script') ); |
  | 25 |  | register\_deactivation\_hook(\_\_FILE\_\_, array( $this, 'papr\_deactivate')); |
  | 26 |  | add\_action( 'save\_post', array($this, 'papr\_save\_meta\_box\_info'),10,3); |
  | 27 |  | add\_action('wp',array($this, 'papr\_initialize\_page\_restrict'),0); |
  | 28 |  | add\_action('add\_meta\_boxes',array($this, 'papr\_add\_custom\_meta\_box')); |
  | 29 |  | add\_action('admin\_footer', array( $this, 'papr\_feedback\_request' ) ); |
  | 30 |  | add\_filter('manage\_page\_posts\_columns', array( $this, 'papr\_page\_add\_column') ); |
  | 31 |  | add\_filter('manage\_post\_posts\_columns', array( $this, 'papr\_post\_add\_column') ); |
  | 32 |  | add\_action('manage\_page\_posts\_custom\_column', array( $this, 'papr\_page\_custom\_columns'), 10, 2); |
  | 33 |  | add\_action('manage\_post\_posts\_custom\_column', array( $this, 'papr\_post\_custom\_columns'), 10, 2); |
  | 34 |  | add\_action('quick\_edit\_custom\_box', array( $this, 'papr\_display\_custom\_quickedit\_fields'),10,2); |
  | 35 |  | add\_shortcode('restrict\_content', array($this, 'papr\_restrict\_content')); |
  | 36 |  | add\_action('plugin\_action\_links\_'.plugin\_basename(\_\_FILE\_\_), array($this,'papr\_add\_plugin\_settings')); |
  | 37 |  | } |
  | 38 |  |  |
  | 39 |  | function papr\_menu() { |
  | 40 |  | add\_menu\_page('Page and Post Restriction','Page Restriction', 'administrator', 'page\_restriction','papr\_page\_restriction',plugin\_dir\_url(\_\_FILE\_\_) . 'includes/images/miniorange.png'); |
  | 41 |  | add\_submenu\_page( 'page\_restriction', 'Custom Roles', 'Roles and Capabilities','administrator','papr\_custom\_roles\_sub\_menu', 'papr\_custom\_roles\_sub\_menu'); |
  | 42 |  | } |
  | 43 |  |  |
  | 44 |  | function papr\_add\_plugin\_settings($links) { |
  | 45 |  | $links = array\_merge( array( |
  | 46 |  | '<a href="' . esc\_url( admin\_url( 'admin.php?page=page\_restriction' ) ) . '">' . \_\_( 'Settings' ) . '</a>' |
  | 47 |  | ), $links ); |
  | 48 |  | return $links; |
  | 49 |  | } |
  | 50 |  |  |
  | 51 |  | function papr\_feedback\_request() { |
  | 52 |  | papr\_display\_feedback\_form(); |
  | 53 |  | } |
  | 54 |  |  |
  | 55 |  | function papr\_deactivate() { |
  | 56 |  | wp\_redirect('plugins.php'); |
  | 57 |  | delete\_option('papr\_admin\_email'); |
  | 58 |  | delete\_option('papr\_admin\_customer\_key'); |
  | 59 |  | delete\_option('papr\_host\_name'); |
  | 60 |  | delete\_option('papr\_new\_registration'); |
  | 61 |  | delete\_option('papr\_admin\_phone'); |
  | 62 |  | delete\_option('papr\_admin\_password'); |
  | 63 |  | delete\_option('papr\_admin\_customer\_key'); |
  | 64 |  | delete\_option('papr\_admin\_api\_key'); |
  | 65 |  | delete\_option('papr\_customer\_token'); |
  | 66 |  | delete\_option('papr\_message'); |
  | 67 |  | delete\_option('papr\_allowed\_roles\_for\_pages'); |
  | 68 |  | delete\_option('papr\_restricted\_pages'); |
  | 69 |  | delete\_option('papr\_allowed\_roles\_for\_posts'); |
  | 70 |  | delete\_option('papr\_restricted\_posts'); |
  | 71 |  | delete\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 72 |  | delete\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 73 |  | delete\_option('papr\_login\_unrestricted\_pages'); |
  | 74 |  | delete\_option('papr\_default\_role\_parent'); |
  | 75 |  | delete\_option('papr\_login\_unrestricted\_posts'); |
  | 76 |  | delete\_option('papr\_page\_search\_value'); |
  | 77 |  | delete\_option('papr\_post\_search\_value'); |
  | 78 |  | delete\_option('papr\_post\_type'); |
  | 79 |  | delete\_option('papr\_default\_role\_parent\_page\_toggle'); |
  | 80 |  | delete\_option('papr\_access\_for\_only\_loggedin'); |
  | 81 |  | delete\_option('papr\_access\_for\_only\_loggedin\_posts'); |
  | 82 |  | delete\_option('papr\_results\_per\_page'); |
  | 83 |  | delete\_option('papr\_post\_per\_page'); |
  | 84 |  | delete\_option('papr\_category\_per\_page'); |
  | 85 |  | delete\_option('papr\_guest\_enabled'); |
  | 86 |  | delete\_option('papr\_roles\_per\_page'); |
  | 87 |  | } |
  | 88 |  |  |
  | 89 |  | static function papr\_plugin\_settings\_script($page) { |
  | 90 |  | if($page == 'toplevel\_page\_page\_restriction' || $page == 'page-restriction\_page\_papr\_custom\_roles\_sub\_menu'){ |
  | 91 |  | wp\_enqueue\_script('jquery'); |
  | 92 |  | wp\_enqueue\_script('jquery-ui-autocomplete'); |
  | 93 |  | wp\_enqueue\_script('papr\_admin\_settings\_phone\_script', plugins\_url('includes/js/phone.js', \_\_FILE\_\_)); |
  | 94 |  | wp\_enqueue\_style('papr\_admin\_bootstrap\_settings\_script', plugins\_url('includes/js/bootstrap/bootstrap.min.js', \_\_FILE\_\_)); |
  | 95 |  | wp\_enqueue\_style('papr\_admin\_bootstrap\_settings\_script', plugins\_url('includes/js/bootstrap/popper.min.js', \_\_FILE\_\_)); |
  | 96 |  | wp\_enqueue\_style('papr\_admin\_settings\_phone\_style', plugins\_url('includes/css/phone.min.css', \_\_FILE\_\_)); |
  | 97 |  | wp\_enqueue\_style('papr\_admin\_bootstrap\_settings\_style', plugins\_url('includes/css/bootstrap/bootstrap.min.css', \_\_FILE\_\_)); |
  | 98 |  | wp\_enqueue\_style('papr\_admin\_settings\_style', plugins\_url('includes/css/papr\_settings\_style.min.css', \_\_FILE\_\_), array(), '1.3.4', 'all'); |
  | 99 |  | wp\_enqueue\_script('papr\_auto\_assign\_private\_script', plugins\_url('includes/js/papr\_role\_assigned.js', \_\_FILE\_\_)); |
  | 100 |  | wp\_enqueue\_script('papr\_roles\_show\_dropdown\_script', plugins\_url('includes/js/papr\_role\_dropdown.js', \_\_FILE\_\_)); |
  | 101 |  | wp\_enqueue\_style('papr\_roles\_show\_dropdown\_style', 'https://cdn.jsdelivr.net/gh/harvesthq/chosen@gh-pages/chosen.min.css'); |
  | 102 |  | } |
  | 103 |  |  |
  | 104 |  | else if($page == 'edit.php'){ |
  | 105 |  | wp\_enqueue\_script( 'populatequickedit', plugins\_url('includes/js/page-restriction-quick-edit.js', \_\_FILE\_\_), array( 'jquery' ) ); |
  | 106 |  | } |
  | 107 |  |  |
  | 108 |  | else { |
  | 109 |  | return; |
  | 110 |  | } |
  | 111 |  | } |
  | 112 |  |  |
  | 113 |  | function papr\_restrict\_content($attr, $content = '') { |
  | 114 |  | if(!is\_user\_logged\_in()) |
  | 115 |  | return ''; |
  | 116 |  | return '<p>'.$content.'</p>'; |
  | 117 |  | } |
  | 118 |  |  |
  | 119 |  | function papr\_page\_add\_column( $column\_array ) { |
  | 120 |  | $column\_array['Allowed\_Roles'] = 'Roles who have view access'; |
  | 121 |  | $column\_array['Private'] = 'Page restrcited from non-logged in users'; |
  | 122 |  | return $column\_array; |
  | 123 |  | } |
  | 124 |  |  |
  | 125 |  | function papr\_post\_add\_column( $column\_array ) { |
  | 126 |  | $column\_array['Allowed\_Roles'] = 'Roles who have view access'; |
  | 127 |  | $column\_array['Private'] = 'Post restrcited from non-logged in users'; |
  | 128 |  | return $column\_array; |
  | 129 |  | } |
  | 130 |  |  |
  | 131 |  | function papr\_page\_custom\_columns($column, $post\_id){ |
  | 132 |  | $allowed\_roles         = get\_option('papr\_allowed\_roles\_for\_pages'); |
  | 133 |  | $allowed\_roles         = $allowed\_roles != '' ? $allowed\_roles : array(); |
  | 134 |  |  |
  | 135 |  | $allowed\_redirect\_pages = get\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 136 |  | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  | 137 |  |  |
  | 138 |  | switch ($column) { |
  | 139 |  | case 'Allowed\_Roles': |
  | 140 |  | if(isset($allowed\_roles[$post\_id])){ |
  | 141 |  | $len=0; |
  | 142 |  | if(is\_countable($allowed\_roles[$post\_id])) |
  | 143 |  | $len = count($allowed\_roles[$post\_id]); |
  | 144 |  | foreach($allowed\_roles[$post\_id] as $keys => $allowed\_role){ |
  | 145 |  | echo esc\_html\_\_($allowed\_role); |
  | 146 |  | if($keys!=$len-1){ |
  | 147 |  | echo ';'; |
  | 148 |  | } |
  | 149 |  | } |
  | 150 |  | } |
  | 151 |  | break; |
  | 152 |  | case 'Private': |
  | 153 |  | if(isset($allowed\_redirect\_pages[$post\_id])){ |
  | 154 |  | echo esc\_html\_\_("Yes"); |
  | 155 |  | } else { |
  | 156 |  | echo esc\_html\_\_("No"); |
  | 157 |  | } |
  | 158 |  | default: |
  | 159 |  | break; |
  | 160 |  | } |
  | 161 |  | } |
  | 162 |  |  |
  | 163 |  | function papr\_post\_custom\_columns($column, $post\_id){ |
  | 164 |  | $allowed\_roles         = get\_option('papr\_allowed\_roles\_for\_posts'); |
  | 165 |  | $allowed\_roles         = $allowed\_roles != '' ? $allowed\_roles : array(); |
  | 166 |  |  |
  | 167 |  | $allowed\_redirect\_post = get\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 168 |  | $allowed\_redirect\_post = $allowed\_redirect\_post != '' ? $allowed\_redirect\_post : array(); |
  | 169 |  |  |
  | 170 |  | switch ($column) { |
  | 171 |  | case 'Allowed\_Roles': |
  | 172 |  | if(isset($allowed\_roles[$post\_id])){ |
  | 173 |  | $len=0; |
  | 174 |  | if(is\_countable($allowed\_roles[$post\_id])) |
  | 175 |  | $len = count($allowed\_roles[$post\_id]); |
  | 176 |  | foreach($allowed\_roles[$post\_id] as $keys => $allowed\_role){ |
  | 177 |  | echo esc\_html\_\_($allowed\_role); |
  | 178 |  | if($keys!=$len-1){ |
  | 179 |  | echo ';'; |
  | 180 |  | } |
  | 181 |  | } |
  | 182 |  | } |
  | 183 |  | break; |
  | 184 |  | case 'Private': |
  | 185 |  | if(isset($allowed\_redirect\_post[$post\_id])){ |
  | 186 |  | echo esc\_html\_\_("Yes"); |
  | 187 |  | } else { |
  | 188 |  | echo esc\_html\_\_("No"); |
  | 189 |  | } |
  | 190 |  | break; |
  | 191 |  | default: |
  | 192 |  | break; |
  | 193 |  | } |
  | 194 |  | } |
  | 195 |  |  |
  | 196 |  | function papr\_display\_custom\_quickedit\_fields( $column\_name, $post\_type ) { |
  | 197 |  |  |
  | 198 |  | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'book\_edit\_nonce' ); |
  | 199 |  |  |
  | 200 |  | if($column\_name == 'Allowed\_Roles'){ |
  | 201 |  | ?> |
  | 202 |  | <fieldset class="inline-edit-col-right inline-edit-book"> |
  | 203 |  | <h3>miniOrange Page and Post Restriction Configuration</h3> |
  | 204 |  | <?php |
  | 205 |  | } |
  | 206 |  | ?> |
  | 207 |  | <div class="inline-edit-col column-<?php echo esc\_attr($column\_name); ?>"> |
  | 208 |  | <label class="inline-edit-group"> |
  | 209 |  | <?php |
  | 210 |  | switch ( $column\_name ) { |
  | 211 |  | case 'Private': |
  | 212 |  | ?><label class="title">Private</label><input name="Private" type="checkbox" /><?php |
  | 213 |  | break; |
  | 214 |  |  |
  | 215 |  | case 'Allowed\_Roles': |
  | 216 |  | ?><label class="title">Allowed Roles</label><input name="Allowed\_Roles" type="text"/><?php |
  | 217 |  | break; |
  | 218 |  | } |
  | 219 |  | ?> |
  | 220 |  | </label> |
  | 221 |  | </div> |
  | 222 |  | <?php |
  | 223 |  | if($column\_name == 'Private'){ |
  | 224 |  | ?> |
  | 225 |  | </fieldset> |
  | 226 |  | <?php |
  | 227 |  | } |
  | 228 |  | } |
  | 229 |  |  |
  | 230 |  | function papr\_add\_custom\_meta\_box($post\_type) { |
  | 231 |  |  |
  | 232 |  | global $pagenow; |
  | 233 |  | $papr\_metabox\_allowed\_roles = get\_option('papr\_allowed\_metabox\_roles'); |
  | 234 |  | if(empty($papr\_metabox\_allowed\_roles)) |
  | 235 |  | $papr\_metabox\_allowed\_roles = 'Editor; Author;'; |
  | 236 |  | if($papr\_metabox\_allowed\_roles == 'papr\_no\_roles') |
  | 237 |  | $papr\_metabox\_allowed\_roles = ''; |
  | 238 |  | $metabox\_roles\_array = explode(';', $papr\_metabox\_allowed\_roles); |
  | 239 |  | $current\_user = wp\_get\_current\_user(); |
  | 240 |  | $user\_roles = $current\_user->roles; |
  | 241 |  |  |
  | 242 |  | if(in\_array( $pagenow, array('post-new.php') )){ |
  | 243 |  | if($post\_type == 'page' && get\_option('papr\_select\_all\_pages') == 'checked'){ |
  | 244 |  |  |
  | 245 |  | $pages\_for\_loggedin\_users = get\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 246 |  | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users!='' ? $pages\_for\_loggedin\_users : array(); |
  | 247 |  |  |
  | 248 |  | $pages\_for\_loggedin\_users[get\_the\_ID()]=true; |
  | 249 |  | update\_option('papr\_allowed\_redirect\_for\_pages',$pages\_for\_loggedin\_users); |
  | 250 |  |  |
  | 251 |  | } else if(get\_option('papr\_select\_all\_posts') == 'checked'){ |
  | 252 |  |  |
  | 253 |  | $pages\_for\_loggedin\_users = get\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 254 |  | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users!='' ? $pages\_for\_loggedin\_users : array(); |
  | 255 |  |  |
  | 256 |  | $pages\_for\_loggedin\_users[get\_the\_ID()]=true; |
  | 257 |  | update\_option('papr\_allowed\_redirect\_for\_posts',$pages\_for\_loggedin\_users); |
  | 258 |  | } |
  | 259 |  | } |
  | 260 |  |  |
  | 261 |  | if(is\_array($user\_roles)) |
  | 262 |  | if(empty(array\_intersect($metabox\_roles\_array, $user\_roles)) && (!papr\_in\_array('administrator', $user\_roles))) |
  | 263 |  | return; |
  | 264 |  |  |
  | 265 |  | $type = get\_post\_type\_object( $post\_type ); |
  | 266 |  | add\_meta\_box("demo-meta-box", "Page Restrict Access", array($this, "papr\_meta\_box"), $post\_type, "side", "high", null); |
  | 267 |  | } |
  | 268 |  |  |
  | 269 |  | /\*If the user is not logged in then it checks if the page or post are retricted to logged in user only or not. \*/ |
  | 270 |  | function papr\_restrict\_logged\_in\_users($page\_post\_id){ |
  | 271 |  | $restricted\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  | 272 |  | $restricted\_posts = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  | 273 |  |  |
  | 274 |  | $default\_login\_toggle = get\_option('papr\_access\_for\_only\_loggedin'); |
  | 275 |  | $unrestricted\_pages   = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  | 276 |  |  |
  | 277 |  | $default\_login\_toggle\_posts = get\_option('papr\_access\_for\_only\_loggedin\_posts'); |
  | 278 |  | $unrestricted\_posts         = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  | 279 |  |  |
  | 280 |  |  |
  | 281 |  | $restricted\_pages           = $restricted\_pages!='' ? $restricted\_pages : array(); |
  | 282 |  | $restricted\_posts           = $restricted\_posts!='' ? $restricted\_posts : array(); |
  | 283 |  |  |
  | 284 |  | $default\_login\_toggle       = $default\_login\_toggle!='' ? $default\_login\_toggle : ""; |
  | 285 |  | $unrestricted\_pages         = $unrestricted\_pages!='' ? $unrestricted\_pages : array(); |
  | 286 |  |  |
  | 287 |  | $default\_login\_toggle\_posts = $default\_login\_toggle\_posts!='' ? $default\_login\_toggle\_posts : ""; |
  | 288 |  | $unrestricted\_posts         = $unrestricted\_posts!='' ? $unrestricted\_posts : array(); |
  | 289 |  |  |
  | 290 |  | //Settings when global toggle is all and fe pages/posts has unticked checkbox |
  | 291 |  | if( is\_page() && ($default\_login\_toggle==1) && empty($unrestricted\_pages[$page\_post\_id]) ) { |
  | 292 |  | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  | 293 |  | wp\_die( $papr\_message\_text ); |
  | 294 |  | } |
  | 295 |  |  |
  | 296 |  | if( is\_single() && ($default\_login\_toggle\_posts==1) && empty( $unrestricted\_posts[$page\_post\_id]) ) { |
  | 297 |  | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  | 298 |  | wp\_die( $papr\_message\_text ); |
  | 299 |  | } |
  | 300 |  |  |
  | 301 |  | //Added condition for front page restriction |
  | 302 |  | if ( (is\_page() && !empty($restricted\_pages[$page\_post\_id])) || (is\_front\_page() && !empty($restricted\_pages[get\_option('page\_on\_front')])) || (is\_single() && !empty( $restricted\_posts[$page\_post\_id])) ) { |
  | 303 |  | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  | 304 |  | wp\_die( $papr\_message\_text ); |
  | 305 |  | } |
  | 306 |  | } |
  | 307 |  |  |
  | 308 |  | /\*If user is logged in then this function checks if the user is restricted to access any page or post\*/ |
  | 309 |  | function papr\_restrict\_by\_role($page\_post\_id){ |
  | 310 |  | $allowed\_roles\_for\_posts = get\_option("papr\_allowed\_roles\_for\_posts"); |
  | 311 |  | $allowed\_roles\_for\_pages = get\_option("papr\_allowed\_roles\_for\_pages"); |
  | 312 |  | $restricted\_pages = get\_option('papr\_restricted\_pages'); |
  | 313 |  | $restricted\_posts = get\_option('papr\_restricted\_posts'); |
  | 314 |  |  |
  | 315 |  | $allowed\_roles\_for\_posts = $allowed\_roles\_for\_posts!='' ? $allowed\_roles\_for\_posts : array(); |
  | 316 |  | $allowed\_roles\_for\_pages = $allowed\_roles\_for\_pages!='' ? $allowed\_roles\_for\_pages : array(); |
  | 317 |  | $restricted\_pages = $restricted\_pages!='' ? $restricted\_pages : array(); |
  | 318 |  | $restricted\_posts = $restricted\_posts!='' ? $restricted\_posts : array(); |
  | 319 |  |  |
  | 320 |  | if(is\_page($page\_post\_id)){ |
  | 321 |  | $allowed\_roles\_for\_types = $allowed\_roles\_for\_pages; |
  | 322 |  | } |
  | 323 |  | else{ |
  | 324 |  | $allowed\_roles\_for\_types = $allowed\_roles\_for\_posts; |
  | 325 |  | } |
  | 326 |  |  |
  | 327 |  | if(!is\_front\_page() && empty($allowed\_roles\_for\_pages['mo\_page\_0'])) { |
  | 328 |  | if (is\_page($page\_post\_id)) { |
  | 329 |  | if (is\_array($restricted\_pages)) { |
  | 330 |  | if (!papr\_in\_array($page\_post\_id, $restricted\_pages)) { |
  | 331 |  | if ($page\_post\_id !== 1) |
  | 332 |  | return; |
  | 333 |  | } |
  | 334 |  | } |
  | 335 |  | } else { |
  | 336 |  | if (is\_array($restricted\_posts)) { |
  | 337 |  | if (!papr\_in\_array($page\_post\_id, $restricted\_posts)) { |
  | 338 |  | return; |
  | 339 |  | } |
  | 340 |  | } |
  | 341 |  | } |
  | 342 |  | } |
  | 343 |  |  |
  | 344 |  | $current\_user = wp\_get\_current\_user(); |
  | 345 |  | $user\_roles = $current\_user->roles; |
  | 346 |  |  |
  | 347 |  | foreach ($user\_roles as $key => $user\_role) { |
  | 348 |  | if(is\_front\_page()&&!empty($allowed\_roles\_for\_pages['mo\_page\_0'])){ |
  | 349 |  | foreach($allowed\_roles\_for\_pages['mo\_page\_0'] as $keys => $allowed\_roles\_for\_page){ |
  | 350 |  | if( strripos($allowed\_roles\_for\_page,$user\_role) !== FALSE) |
  | 351 |  | return; |
  | 352 |  | } |
  | 353 |  | } |
  | 354 |  | else if( !empty($allowed\_roles\_for\_types[$page\_post\_id])){ |
  | 355 |  | if(is\_array($allowed\_roles\_for\_types) ){ |
  | 356 |  | if(!empty( $allowed\_roles\_for\_types[$page\_post\_id] )){ |
  | 357 |  | foreach($allowed\_roles\_for\_types[$page\_post\_id] as $keys => $allowed\_roles\_for\_type){ |
  | 358 |  | if( strripos($allowed\_roles\_for\_type,$user\_role) !== FALSE) |
  | 359 |  | return; |
  | 360 |  | } |
  | 361 |  | } |
  | 362 |  | } |
  | 363 |  | } |
  | 364 |  | } |
  | 365 |  |  |
  | 366 |  | //default access to all users |
  | 367 |  | if(is\_array($allowed\_roles\_for\_pages) || is\_array($allowed\_roles\_for\_posts)) { |
  | 368 |  | if(is\_page()&& !empty( $allowed\_roles\_for\_pages[$page\_post\_id])&&(count($allowed\_roles\_for\_pages[$page\_post\_id])==0)) |
  | 369 |  | return; |
  | 370 |  | elseif( (is\_single()&& !empty($allowed\_roles\_for\_posts[$page\_post\_id])) || (is\_front\_page() && !empty($allowed\_roles\_for\_pages['mo\_page\_0'])) || (is\_page() && !empty($allowed\_roles\_for\_pages[$page\_post\_id])) ){ |
  | 371 |  | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  | 372 |  | wp\_die( $papr\_message\_text ); |
  | 373 |  | } |
  | 374 |  | } |
  | 375 |  | } |
  | 376 |  |  |
  | 377 |  | function papr\_initialize\_page\_restrict(){ |
  | 378 |  | $page\_post\_id = get\_the\_ID()?get\_the\_ID():0; |
  | 379 |  | $guest\_user\_logged\_in = false; |
  | 380 |  |  |
  | 381 |  | $type=get\_post\_type($page\_post\_id); |
  | 382 |  |  |
  | 383 |  | if($type != 'page' && $type != 'post') { |
  | 384 |  | return; |
  | 385 |  | } |
  | 386 |  |  |
  | 387 |  | if(!is\_user\_logged\_in() and !$guest\_user\_logged\_in) |
  | 388 |  | $this->papr\_restrict\_logged\_in\_users($page\_post\_id); |
  | 389 |  | else |
  | 390 |  | $this->papr\_restrict\_by\_role($page\_post\_id); |
  | 391 |  | } |
  | 392 |  |  |
  | 393 |  | public static function papr\_meta\_box($post ) { |
  | 394 |  | $type = ''; |
  | 395 |  | if(is\_object($post) && property\_exists($post, 'post\_type')){ |
  | 396 |  | $type=$post->post\_type; |
  | 397 |  | } |
  | 398 |  |  |
  | 399 |  | if($type == 'page' || $type == 'post') { |
  | 400 |  | wp\_nonce\_field('my\_meta\_box\_nonce','meta\_box\_nonce'); |
  | 401 |  | } |
  | 402 |  |  |
  | 403 |  | global $wp\_roles; |
  | 404 |  | $wp\_name\_roles=($wp\_roles->role\_names); |
  | 405 |  | asort($wp\_name\_roles); |
  | 406 |  | if($type == 'page'){ |
  | 407 |  | $role = maybe\_unserialize(get\_option('papr\_allowed\_roles\_for\_pages')); |
  | 408 |  | $role = $role!='' ? $role : array(); |
  | 409 |  |  |
  | 410 |  | $default\_login\_toggle = maybe\_unserialize(get\_option('papr\_access\_for\_only\_loggedin')); |
  | 411 |  | $default\_login\_toggle = $default\_login\_toggle!='' ? $default\_login\_toggle : ""; |
  | 412 |  | } else if($type == 'post') { |
  | 413 |  | $role = maybe\_unserialize(get\_option('papr\_allowed\_roles\_for\_posts')); |
  | 414 |  | $role = $role!='' ? $role : array(); |
  | 415 |  |  |
  | 416 |  | $default\_login\_toggle = maybe\_unserialize(get\_option('papr\_access\_for\_only\_loggedin\_posts')); |
  | 417 |  | $default\_login\_toggle = $default\_login\_toggle!='' ? $default\_login\_toggle : ""; |
  | 418 |  | } |
  | 419 |  | else { |
  | 420 |  | $role = array(); |
  | 421 |  | $default\_login\_toggle = ''; |
  | 422 |  | } |
  | 423 |  |  |
  | 424 |  | $roles=array(); |
  | 425 |  | if(!empty($role[$post->ID])){ |
  | 426 |  | $roles=$role[$post->ID]; |
  | 427 |  | } |
  | 428 |  |  |
  | 429 |  | $is\_page\_restrcited\_for\_loggedin\_users = 'false'; |
  | 430 |  |  |
  | 431 |  | $disabled = ''; |
  | 432 |  |  |
  | 433 |  | if($type == 'page'){ |
  | 434 |  | $pages\_for\_loggedin\_users = maybe\_unserialize(get\_option('papr\_allowed\_redirect\_for\_pages')); |
  | 435 |  | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users!='' ? $pages\_for\_loggedin\_users : array(); |
  | 436 |  | } |
  | 437 |  | else if($type == 'post'){ |
  | 438 |  | $pages\_for\_loggedin\_users = maybe\_unserialize(get\_option('papr\_allowed\_redirect\_for\_posts')); |
  | 439 |  | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users!='' ? $pages\_for\_loggedin\_users : array(); |
  | 440 |  | } |
  | 441 |  | else{ |
  | 442 |  | $disabled = 'disabled'; |
  | 443 |  | $pages\_for\_loggedin\_users=array(); |
  | 444 |  | } |
  | 445 |  |  |
  | 446 |  | if(!empty($pages\_for\_loggedin\_users)){ |
  | 447 |  | if(!empty( $pages\_for\_loggedin\_users[$post->ID]) && $pages\_for\_loggedin\_users[$post->ID]=='true'){ |
  | 448 |  | $is\_page\_restrcited\_for\_loggedin\_users = 'true'; |
  | 449 |  | } |
  | 450 |  | } |
  | 451 |  | ?> |
  | 452 |  | <div class="row"> |
  | 453 |  | <img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/miniorange-logo.png" alt="miniOrange Page and Post Restriction" width="35px"> |
  | 454 |  | <h4 style="position:absolute;top:-0.6rem;left:4.2rem;">Page and Post Restriction</h4> |
  | 455 |  | </div> |
  | 456 |  |  |
  | 457 |  | <p> |
  | 458 |  | <?php |
  | 459 |  | if($type != 'page' && $type != 'post') { |
  | 460 |  | ?> |
  | 461 |  | <p><b> |
  | 462 |  | This feature is available for Custom Post in Premium version of the Page and Post Restriction plugin. |
  | 463 |  | </b></p> |
  | 464 |  | <a href="admin.php?page=page\_restriction&tab=premium\_plan" target="\_blank">Premium Plans</a> |
  | 465 |  | <?php |
  | 466 |  | echo '</br></br>'; |
  | 467 |  | } |
  | 468 |  | esc\_html\_e( "Limit access to Logged in users.", 'mo-wpum' ); |
  | 469 |  | ?> |
  | 470 |  | </p> |
  | 471 |  | <div class="page-restrict-loggedin-user-div"> |
  | 472 |  | <input type="hidden" name="papr\_metabox" value="true"> |
  | 473 |  | <ul class="page-restrict-loggedin-user"> |
  | 474 |  | <?php |
  | 475 |  | if($is\_page\_restrcited\_for\_loggedin\_users=='true'){ |
  | 476 |  | $require\_login = 'checked'; |
  | 477 |  | } else { |
  | 478 |  | $require\_login = ''; |
  | 479 |  | } |
  | 480 |  | global $pagenow; |
  | 481 |  | if(in\_array( $pagenow, array('post-new.php') )){ |
  | 482 |  | if($default\_login\_toggle==1){ |
  | 483 |  | $require\_login = 'checked'; |
  | 484 |  | } |
  | 485 |  | } |
  | 486 |  | ?> |
  | 487 |  | <input type="checkbox" name="restrict\_page\_access\_loggedin\_user" <?php echo esc\_attr($require\_login);?> value="true" <?php echo ($disabled); ?> /> |
  | 488 |  | Require Login |
  | 489 |  | </ul> |
  | 490 |  | </div> |
  | 491 |  |  |
  | 492 |  | <hr> |
  | 493 |  | <p> |
  | 494 |  | <?php esc\_html\_e( "Limit access to this post's content to users of the selected roles.", 'mo-wpum' );  ?> |
  | 495 |  | </p> |
  | 496 |  |  |
  | 497 |  | <div class="role-list-wrap"> |
  | 498 |  |  |
  | 499 |  | <ul class="role-list"> |
  | 500 |  |  |
  | 501 |  | <?php foreach ( $wp\_name\_roles as $role => $name ) : ?> |
  | 502 |  | <li> |
  | 503 |  | <label> |
  | 504 |  | <input type="checkbox" name="papr\_access\_role[]" <?php checked(papr\_in\_array( $role, $roles )  || papr\_in\_array($name, $roles)); ?> value="<?php echo esc\_attr( $role ); ?>" <?php echo esc\_attr($disabled); ?> /> |
  | 505 |  | <?php echo esc\_html( translate\_user\_role( $name ) ); ?> |
  | 506 |  | </label> |
  | 507 |  | </li> |
  | 508 |  | <?php endforeach; ?> |
  | 509 |  |  |
  | 510 |  | </ul> |
  | 511 |  | </div> |
  | 512 |  | <?php |
  | 513 |  | } |
  | 514 |  |  |
  | 515 |  | /\* Function to save the meta box details during creation/editing \*/ |
  | 516 |  | static function papr\_save\_meta\_box\_info($post\_id , $post, $update) { |
  | 517 |  | if(!isset($\_POST['papr\_metabox']) && !isset($\_POST['book\_edit\_nonce'])) return; |
  | 518 |  |  |
  | 519 |  | $type = get\_post\_type($post); |
  | 520 |  |  |
  | 521 |  | if( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) return; |
  | 522 |  |  |
  | 523 |  | $default\_role\_parent     = get\_option('papr\_default\_role\_parent'); |
  | 524 |  | $default\_role\_parent     = $default\_role\_parent!='' ? $default\_role\_parent : array(); |
  | 525 |  | if($type=='page'){ |
  | 526 |  | $allowed\_roles          = maybe\_unserialize(get\_option('papr\_allowed\_roles\_for\_pages')); |
  | 527 |  | $restrictedposts        = get\_option('papr\_restricted\_pages'); |
  | 528 |  | $allowed\_redirect\_pages = get\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 529 |  | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  | 530 |  |  |
  | 531 |  | $allowed\_roles          = $allowed\_roles!='' ? $allowed\_roles : array(); |
  | 532 |  | $restrictedposts        = $restrictedposts!='' ? $restrictedposts : array(); |
  | 533 |  | $allowed\_redirect\_pages = $allowed\_redirect\_pages!='' ? $allowed\_redirect\_pages : array(); |
  | 534 |  | $unrestricted\_pages     = $unrestricted\_pages!='' ? $unrestricted\_pages : array(); |
  | 535 |  |  |
  | 536 |  | } else if($type=='post') { |
  | 537 |  | $allowed\_roles          = maybe\_unserialize(get\_option('papr\_allowed\_roles\_for\_posts')); |
  | 538 |  | $restrictedposts        = get\_option('papr\_restricted\_posts'); |
  | 539 |  | $allowed\_redirect\_pages = get\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 540 |  | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  | 541 |  |  |
  | 542 |  | $allowed\_roles          = $allowed\_roles!='' ? $allowed\_roles : array(); |
  | 543 |  | $restrictedposts        = $restrictedposts!='' ? $restrictedposts : array(); |
  | 544 |  | $allowed\_redirect\_pages = $allowed\_redirect\_pages!='' ? $allowed\_redirect\_pages : array(); |
  | 545 |  | $unrestricted\_pages     = $unrestricted\_pages!='' ? $unrestricted\_pages : array(); |
  | 546 |  | } else { |
  | 547 |  | return; |
  | 548 |  | } |
  | 549 |  |  |
  | 550 |  | if(isset( $\_POST['papr\_access\_role'] )){ |
  | 551 |  | array\_push($restrictedposts, $post\_id); |
  | 552 |  | $new\_roles=$\_POST['papr\_access\_role']; |
  | 553 |  | foreach ($new\_roles as $value) { |
  | 554 |  | $value = sanitize\_text\_field( $value ); |
  | 555 |  | } |
  | 556 |  | $allowed\_roles[$post\_id] = $new\_roles; |
  | 557 |  | } else if (isset( $\_POST['Allowed\_Roles'] )) { |
  | 558 |  | array\_push($restrictedposts, $post\_id); |
  | 559 |  | $new\_roles = sanitize\_text\_field($\_POST['Allowed\_Roles']); |
  | 560 |  | $allowed\_roles[$post\_id] = explode(";",$new\_roles); |
  | 561 |  | } else { |
  | 562 |  | $restrictedpostsarray = $restrictedposts; |
  | 563 |  | if(is\_array($restrictedpostsarray)){ |
  | 564 |  | while(($i = array\_search($post\_id, $restrictedpostsarray)) !== false) { |
  | 565 |  | unset($restrictedpostsarray[$i]); |
  | 566 |  | unset($allowed\_roles[$post\_id]); |
  | 567 |  | } |
  | 568 |  | } |
  | 569 |  | $restrictedposts = $restrictedpostsarray; |
  | 570 |  | } |
  | 571 |  | if( isset($\_POST['restrict\_page\_access\_loggedin\_user']) || isset($\_POST['Private']) ) { |
  | 572 |  | $allowed\_redirect\_pages[$post\_id]=true; |
  | 573 |  | unset($unrestricted\_pages[$post\_id]); |
  | 574 |  | } else{ |
  | 575 |  | unset($allowed\_redirect\_pages[$post\_id]); |
  | 576 |  | $unrestricted\_pages[$post\_id] = true; |
  | 577 |  | } |
  | 578 |  |  |
  | 579 |  | $parent\_id = wp\_get\_post\_parent\_id($post\_id); |
  | 580 |  | if($type=='page' && $parent\_id){ |
  | 581 |  | if(!empty($default\_role\_parent[$parent\_id]) && $default\_role\_parent[$parent\_id]==true){ |
  | 582 |  | $restrictedposts = get\_option('papr\_restricted\_pages'); |
  | 583 |  | $restrictedposts = $restrictedposts!='' ? $restrictedposts : array(); |
  | 584 |  |  |
  | 585 |  | if(papr\_in\_array($parent\_id, $restrictedposts)){ |
  | 586 |  | array\_push($restrictedposts, $post\_id); |
  | 587 |  | $allowed\_roles = get\_option('papr\_allowed\_roles\_for\_pages'); |
  | 588 |  | $allowed\_roles = $allowed\_roles!='' ? $allowed\_roles : array(); |
  | 589 |  | $role\_string = $allowed\_roles[$parent\_id]; |
  | 590 |  | $parent\_allowed\_roles = $role\_string; |
  | 591 |  | $allowed\_roles[$post\_id] = $parent\_allowed\_roles; |
  | 592 |  | if($allowed\_roles[$post\_id] != ''){ |
  | 593 |  | if(!papr\_in\_array($post\_id,$restrictedposts)){ |
  | 594 |  | array\_push($restrictedposts, $post\_id); |
  | 595 |  | } |
  | 596 |  | } else { |
  | 597 |  | unset($restrictedposts[$post\_id]); |
  | 598 |  | } |
  | 599 |  | } |
  | 600 |  | if(papr\_in\_array($parent\_id, $allowed\_redirect\_pages)){ |
  | 601 |  | $allowed\_redirect\_pages[$post\_id]=true; |
  | 602 |  | unset($unrestricted\_pages[$post\_id]); |
  | 603 |  | } else{ |
  | 604 |  | unset($allowed\_redirect\_pages[$post\_id]); |
  | 605 |  | $unrestricted\_pages[$post\_id] = true; |
  | 606 |  | } |
  | 607 |  | } |
  | 608 |  | } |
  | 609 |  |  |
  | 610 |  | if($type=='page'){ |
  | 611 |  | $default\_role\_toggle = get\_option('papr\_default\_role\_parent\_page\_toggle'); |
  | 612 |  | $default\_role\_toggle = $default\_role\_toggle!='' ? $default\_role\_toggle : ""; |
  | 613 |  |  |
  | 614 |  | if(!empty( $default\_role\_parent[$post\_id]) || $default\_role\_toggle==1) { |
  | 615 |  | if($post\_id != 0){ |
  | 616 |  | $default\_role\_parent[$post\_id]=true; |
  | 617 |  |  |
  | 618 |  | $children = get\_pages( array( 'child\_of' => $post\_id ) ); |
  | 619 |  |  |
  | 620 |  | if(count($children)>0) { |
  | 621 |  |  |
  | 622 |  | foreach($children as $child) { |
  | 623 |  | $child\_id = $child->ID; |
  | 624 |  |  |
  | 625 |  | $allowed\_roles[$child->ID] = $allowed\_roles[$post\_id]; |
  | 626 |  |  |
  | 627 |  | if($allowed\_roles[$child->ID] != ''){ |
  | 628 |  | if(!papr\_in\_array($child->ID,$restrictedposts)){ |
  | 629 |  | array\_push($restrictedposts, $child->ID); |
  | 630 |  | } |
  | 631 |  | } else { |
  | 632 |  | unset($restrictedposts[$child->ID]); |
  | 633 |  | } |
  | 634 |  |  |
  | 635 |  | if(!empty( $allowed\_redirect\_pages[$post\_id])) { |
  | 636 |  | if($allowed\_redirect\_pages[$post\_id]==1 || $allowed\_redirect\_pages[$post\_id]=='on' || $allowed\_redirect\_pages[$post\_id]=='true'){ |
  | 637 |  | $allowed\_redirect\_pages[$child->ID]=true; |
  | 638 |  | unset($unrestricted\_pages[$child->ID]); |
  | 639 |  | } |
  | 640 |  | } |
  | 641 |  | else { |
  | 642 |  | unset($allowed\_redirect\_pages[$child->ID]); |
  | 643 |  | $unrestricted\_pages[$child->ID] = true; |
  | 644 |  | } |
  | 645 |  |  |
  | 646 |  | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  | 647 |  |  |
  | 648 |  | if(count($children\_of\_children)>0){ |
  | 649 |  | $default\_role\_parent[$child->ID]=true; |
  | 650 |  | } |
  | 651 |  | } |
  | 652 |  | } |
  | 653 |  | } |
  | 654 |  | } |
  | 655 |  | } |
  | 656 |  |  |
  | 657 |  | if($type=='page'){ |
  | 658 |  | update\_option('papr\_default\_role\_parent', $default\_role\_parent); |
  | 659 |  | update\_option('papr\_login\_unrestricted\_pages',$unrestricted\_pages); |
  | 660 |  | update\_option('papr\_restricted\_pages', $restrictedposts); |
  | 661 |  | update\_option('papr\_allowed\_roles\_for\_pages', $allowed\_roles); |
  | 662 |  | update\_option('papr\_allowed\_redirect\_for\_pages',$allowed\_redirect\_pages); |
  | 663 |  | } |
  | 664 |  | else { |
  | 665 |  | update\_option('papr\_restricted\_posts', $restrictedposts); |
  | 666 |  | update\_option('papr\_allowed\_roles\_for\_posts', $allowed\_roles); |
  | 667 |  | update\_option('papr\_allowed\_redirect\_for\_posts',$allowed\_redirect\_pages); |
  | 668 |  | update\_option('papr\_login\_unrestricted\_posts',$unrestricted\_pages); |
  | 669 |  | } |
  | 670 |  | } |
  |  | 20 | function \_\_construct() { |
  |  | 21 | update\_option( 'papr\_host\_name', 'https://login.xecurify.com' ); |
  |  | 22 | add\_action( 'admin\_menu', array( $this, 'papr\_menu' ), 11 ); |
  |  | 23 | add\_action( 'admin\_notices', array( $this, 'papr\_rest\_api\_plugin\_admin\_notice' ) ); |
  |  | 24 | add\_action( 'admin\_init', 'papr\_save\_setting', 1, 0 ); |
  |  | 25 | add\_action( 'admin\_enqueue\_scripts', array( $this, 'papr\_plugin\_settings\_script' ) ); |
  |  | 26 | register\_deactivation\_hook( \_\_FILE\_\_, array( $this, 'papr\_deactivate' ) ); |
  |  | 27 | add\_action( 'save\_post', array( $this, 'papr\_save\_meta\_box\_info' ), 10, 3 ); |
  |  | 28 | add\_action( 'wp', array( $this, 'papr\_initialize\_page\_restrict' ), 0 ); |
  |  | 29 | add\_action( 'add\_meta\_boxes', array( $this, 'papr\_add\_custom\_meta\_box' ) ); |
  |  | 30 | add\_action( 'admin\_footer', array( $this, 'papr\_feedback\_request' ) ); |
  |  | 31 | add\_filter( 'manage\_page\_posts\_columns', array( $this, 'papr\_page\_add\_column' ) ); |
  |  | 32 | add\_filter( 'manage\_post\_posts\_columns', array( $this, 'papr\_post\_add\_column' ) ); |
  |  | 33 | add\_action( 'manage\_page\_posts\_custom\_column', array( $this, 'papr\_page\_custom\_columns' ), 10, 2 ); |
  |  | 34 | add\_action( 'manage\_post\_posts\_custom\_column', array( $this, 'papr\_post\_custom\_columns' ), 10, 2 ); |
  |  | 35 | add\_action( 'quick\_edit\_custom\_box', array( $this, 'papr\_display\_custom\_quickedit\_fields' ), 10, 2 ); |
  |  | 36 | add\_shortcode( 'restrict\_content', array( $this, 'papr\_restrict\_content' ) ); |
  |  | 37 | add\_action( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'papr\_add\_plugin\_settings' ) ); |
  |  | 38 | } |
  |  | 39 |  |
  |  | 40 | function papr\_menu() { |
  |  | 41 | add\_menu\_page( 'Page and Post Restriction', 'Page Restriction', 'administrator', 'page\_restriction', 'papr\_page\_restriction', plugin\_dir\_url( \_\_FILE\_\_ ) . 'includes/images/miniorange.png' ); |
  |  | 42 | add\_submenu\_page( 'page\_restriction', 'Custom Roles', 'Roles and Capabilities', 'administrator', 'papr\_custom\_roles\_sub\_menu', 'papr\_custom\_roles\_sub\_menu' ); |
  |  | 43 | } |
  |  | 44 | function papr\_rest\_api\_plugin\_admin\_notice() { |
  |  | 45 | if ( isset( $\_GET['page'] ) && 'page\_restriction' === $\_GET['page'] ) { |
  |  | 46 | ?> |
  |  | 47 | <div class="notice notice-info is-dismissible custom-notice"> |
  |  | 48 | <p><?php \_e( 'Your REST API endpoints are not secured. Secure your endpoints using our <a href="https://wordpress.org/plugins/wp-rest-api-authentication/" target="\_blank">Rest API Authentication Plugin</a>.' ); ?></p> |
  |  | 49 | </div> |
  |  | 50 | <?php |
  |  | 51 | } |
  |  | 52 | } |
  |  | 53 | function papr\_add\_plugin\_settings( $links ) { |
  |  | 54 | $links = array\_merge( |
  |  | 55 | array( |
  |  | 56 | '<a href="' . esc\_url( admin\_url( 'admin.php?page=page\_restriction' ) ) . '">' . \_\_( 'Settings' ) . '</a>', |
  |  | 57 | ), |
  |  | 58 | $links |
  |  | 59 | ); |
  |  | 60 | return $links; |
  |  | 61 | } |
  |  | 62 |  |
  |  | 63 | function papr\_feedback\_request() { |
  |  | 64 | papr\_display\_feedback\_form(); |
  |  | 65 | } |
  |  | 66 |  |
  |  | 67 | function papr\_deactivate() { |
  |  | 68 | wp\_redirect( 'plugins.php' ); |
  |  | 69 | delete\_option( 'papr\_admin\_email' ); |
  |  | 70 | delete\_option( 'papr\_admin\_customer\_key' ); |
  |  | 71 | delete\_option( 'papr\_host\_name' ); |
  |  | 72 | delete\_option( 'papr\_new\_registration' ); |
  |  | 73 | delete\_option( 'papr\_admin\_phone' ); |
  |  | 74 | delete\_option( 'papr\_admin\_password' ); |
  |  | 75 | delete\_option( 'papr\_admin\_customer\_key' ); |
  |  | 76 | delete\_option( 'papr\_admin\_api\_key' ); |
  |  | 77 | delete\_option( 'papr\_customer\_token' ); |
  |  | 78 | delete\_option( 'papr\_message' ); |
  |  | 79 | delete\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 80 | delete\_option( 'papr\_restricted\_pages' ); |
  |  | 81 | delete\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 82 | delete\_option( 'papr\_restricted\_posts' ); |
  |  | 83 | delete\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 84 | delete\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 85 | delete\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 86 | delete\_option( 'papr\_default\_role\_parent' ); |
  |  | 87 | delete\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 88 | delete\_option( 'papr\_page\_search\_value' ); |
  |  | 89 | delete\_option( 'papr\_post\_search\_value' ); |
  |  | 90 | delete\_option( 'papr\_post\_type' ); |
  |  | 91 | delete\_option( 'papr\_default\_role\_parent\_page\_toggle' ); |
  |  | 92 | delete\_option( 'papr\_access\_for\_only\_loggedin' ); |
  |  | 93 | delete\_option( 'papr\_access\_for\_only\_loggedin\_posts' ); |
  |  | 94 | delete\_option( 'papr\_results\_per\_page' ); |
  |  | 95 | delete\_option( 'papr\_post\_per\_page' ); |
  |  | 96 | delete\_option( 'papr\_category\_per\_page' ); |
  |  | 97 | delete\_option( 'papr\_guest\_enabled' ); |
  |  | 98 | delete\_option( 'papr\_roles\_per\_page' ); |
  |  | 99 | } |
  |  | 100 |  |
  |  | 101 | static function papr\_plugin\_settings\_script( $page ) { |
  |  | 102 | if ( $page == 'toplevel\_page\_page\_restriction' || $page == 'page-restriction\_page\_papr\_custom\_roles\_sub\_menu' ) { |
  |  | 103 | wp\_enqueue\_script( 'jquery' ); |
  |  | 104 | wp\_enqueue\_script( 'jquery-ui-autocomplete' ); |
  |  | 105 | wp\_enqueue\_script( 'papr\_admin\_settings\_phone\_script', plugins\_url( 'includes/js/phone.js', \_\_FILE\_\_ ) ); |
  |  | 106 | wp\_enqueue\_style( 'papr\_admin\_bootstrap\_settings\_script', plugins\_url( 'includes/js/bootstrap/bootstrap.min.js', \_\_FILE\_\_ ) ); |
  |  | 107 | wp\_enqueue\_style( 'papr\_admin\_bootstrap\_settings\_script', plugins\_url( 'includes/js/bootstrap/popper.min.js', \_\_FILE\_\_ ) ); |
  |  | 108 | wp\_enqueue\_style( 'papr\_admin\_settings\_phone\_style', plugins\_url( 'includes/css/phone.min.css', \_\_FILE\_\_ ) ); |
  |  | 109 | wp\_enqueue\_style( 'papr\_admin\_bootstrap\_settings\_style', plugins\_url( 'includes/css/bootstrap/bootstrap.min.css', \_\_FILE\_\_ ) ); |
  |  | 110 | wp\_enqueue\_style( 'papr\_admin\_settings\_style', plugins\_url( 'includes/css/papr\_settings\_style.min.css', \_\_FILE\_\_ ), array(), '1.3.5', 'all' ); |
  |  | 111 | wp\_enqueue\_script( 'papr\_auto\_assign\_private\_script', plugins\_url( 'includes/js/papr\_role\_assigned.js', \_\_FILE\_\_ ) ); |
  |  | 112 | wp\_enqueue\_script( 'papr\_roles\_show\_dropdown\_script', plugins\_url( 'includes/js/papr\_role\_dropdown.js', \_\_FILE\_\_ ) ); |
  |  | 113 | wp\_enqueue\_style( 'papr\_roles\_show\_dropdown\_style', 'https://cdn.jsdelivr.net/gh/harvesthq/chosen@gh-pages/chosen.min.css' ); |
  |  | 114 | } elseif ( $page == 'edit.php' ) { |
  |  | 115 | wp\_enqueue\_script( 'populatequickedit', plugins\_url( 'includes/js/page-restriction-quick-edit.js', \_\_FILE\_\_ ), array( 'jquery' ) ); |
  |  | 116 | } else { |
  |  | 117 | return; |
  |  | 118 | } |
  |  | 119 | } |
  |  | 120 |  |
  |  | 121 | function papr\_restrict\_content( $attr, $content = '' ) { |
  |  | 122 | if ( ! is\_user\_logged\_in() ) { |
  |  | 123 | return ''; |
  |  | 124 | } |
  |  | 125 | return '<p>' . $content . '</p>'; |
  |  | 126 | } |
  |  | 127 |  |
  |  | 128 | function papr\_page\_add\_column( $column\_array ) { |
  |  | 129 | $column\_array['Allowed\_Roles'] = 'Roles who have view access'; |
  |  | 130 | $column\_array['Private']       = 'Page restrcited from non-logged in users'; |
  |  | 131 | return $column\_array; |
  |  | 132 | } |
  |  | 133 |  |
  |  | 134 | function papr\_post\_add\_column( $column\_array ) { |
  |  | 135 | $column\_array['Allowed\_Roles'] = 'Roles who have view access'; |
  |  | 136 | $column\_array['Private']       = 'Post restrcited from non-logged in users'; |
  |  | 137 | return $column\_array; |
  |  | 138 | } |
  |  | 139 |  |
  |  | 140 | function papr\_page\_custom\_columns( $column, $post\_id ) { |
  |  | 141 | $allowed\_roles = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 142 | $allowed\_roles = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 143 |  |
  |  | 144 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 145 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 146 |  |
  |  | 147 | switch ( $column ) { |
  |  | 148 | case 'Allowed\_Roles': |
  |  | 149 | if ( isset( $allowed\_roles[ $post\_id ] ) ) { |
  |  | 150 | $len = 0; |
  |  | 151 | if ( is\_countable( $allowed\_roles[ $post\_id ] ) ) { |
  |  | 152 | $len = count( $allowed\_roles[ $post\_id ] ); |
  |  | 153 | } |
  |  | 154 | foreach ( $allowed\_roles[ $post\_id ] as $keys => $allowed\_role ) { |
  |  | 155 | echo esc\_html\_\_( $allowed\_role ); |
  |  | 156 | if ( $keys != $len - 1 ) { |
  |  | 157 | echo ';'; |
  |  | 158 | } |
  |  | 159 | } |
  |  | 160 | } |
  |  | 161 | break; |
  |  | 162 | case 'Private': |
  |  | 163 | if ( isset( $allowed\_redirect\_pages[ $post\_id ] ) ) { |
  |  | 164 | echo esc\_html\_\_( 'Yes' ); |
  |  | 165 | } else { |
  |  | 166 | echo esc\_html\_\_( 'No' ); |
  |  | 167 | } |
  |  | 168 | default: |
  |  | 169 | break; |
  |  | 170 | } |
  |  | 171 | } |
  |  | 172 |  |
  |  | 173 | function papr\_post\_custom\_columns( $column, $post\_id ) { |
  |  | 174 | $allowed\_roles = get\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 175 | $allowed\_roles = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 176 |  |
  |  | 177 | $allowed\_redirect\_post = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 178 | $allowed\_redirect\_post = $allowed\_redirect\_post != '' ? $allowed\_redirect\_post : array(); |
  |  | 179 |  |
  |  | 180 | switch ( $column ) { |
  |  | 181 | case 'Allowed\_Roles': |
  |  | 182 | if ( isset( $allowed\_roles[ $post\_id ] ) ) { |
  |  | 183 | $len = 0; |
  |  | 184 | if ( is\_countable( $allowed\_roles[ $post\_id ] ) ) { |
  |  | 185 | $len = count( $allowed\_roles[ $post\_id ] ); |
  |  | 186 | } |
  |  | 187 | foreach ( $allowed\_roles[ $post\_id ] as $keys => $allowed\_role ) { |
  |  | 188 | echo esc\_html\_\_( $allowed\_role ); |
  |  | 189 | if ( $keys != $len - 1 ) { |
  |  | 190 | echo ';'; |
  |  | 191 | } |
  |  | 192 | } |
  |  | 193 | } |
  |  | 194 | break; |
  |  | 195 | case 'Private': |
  |  | 196 | if ( isset( $allowed\_redirect\_post[ $post\_id ] ) ) { |
  |  | 197 | echo esc\_html\_\_( 'Yes' ); |
  |  | 198 | } else { |
  |  | 199 | echo esc\_html\_\_( 'No' ); |
  |  | 200 | } |
  |  | 201 | break; |
  |  | 202 | default: |
  |  | 203 | break; |
  |  | 204 | } |
  |  | 205 | } |
  |  | 206 |  |
  |  | 207 | function papr\_display\_custom\_quickedit\_fields( $column\_name, $post\_type ) { |
  |  | 208 |  |
  |  | 209 | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'book\_edit\_nonce' ); |
  |  | 210 |  |
  |  | 211 | if ( $column\_name == 'Allowed\_Roles' ) { |
  |  | 212 | ?> |
  |  | 213 | <fieldset class="inline-edit-col-right inline-edit-book"> |
  |  | 214 | <h3>miniOrange Page and Post Restriction Configuration</h3> |
  |  | 215 | <?php |
  |  | 216 | } |
  |  | 217 | ?> |
  |  | 218 |  |
  |  | 219 | <div class="inline-edit-col column-<?php echo esc\_attr( $column\_name ); ?>"> |
  |  | 220 | <label class="inline-edit-group"> |
  |  | 221 | <?php |
  |  | 222 | switch ( $column\_name ) { |
  |  | 223 | case 'Private': |
  |  | 224 | ?> |
  |  | 225 | <label class="title">Private</label><input name="Private" type="checkbox" /> |
  |  | 226 | <?php |
  |  | 227 | break; |
  |  | 228 |  |
  |  | 229 | case 'Allowed\_Roles': |
  |  | 230 | ?> |
  |  | 231 | <label class="title">Allowed Roles</label><input name="Allowed\_Roles" type="text"/> |
  |  | 232 | <?php |
  |  | 233 | break; |
  |  | 234 | } |
  |  | 235 | ?> |
  |  | 236 | </label> |
  |  | 237 | </div> |
  |  | 238 | <?php |
  |  | 239 | if ( $column\_name == 'Private' ) { |
  |  | 240 | ?> |
  |  | 241 | </fieldset> |
  |  | 242 | <?php |
  |  | 243 | } |
  |  | 244 | } |
  |  | 245 |  |
  |  | 246 | function papr\_add\_custom\_meta\_box( $post\_type ) { |
  |  | 247 |  |
  |  | 248 | global $pagenow; |
  |  | 249 | $papr\_metabox\_allowed\_roles = get\_option( 'papr\_allowed\_metabox\_roles' ); |
  |  | 250 | if ( empty( $papr\_metabox\_allowed\_roles ) ) { |
  |  | 251 | $papr\_metabox\_allowed\_roles = 'Editor; Author;'; |
  |  | 252 | } |
  |  | 253 | if ( $papr\_metabox\_allowed\_roles == 'papr\_no\_roles' ) { |
  |  | 254 | $papr\_metabox\_allowed\_roles = ''; |
  |  | 255 | } |
  |  | 256 | $metabox\_roles\_array = explode( ';', $papr\_metabox\_allowed\_roles ); |
  |  | 257 | $current\_user        = wp\_get\_current\_user(); |
  |  | 258 | $user\_roles          = $current\_user->roles; |
  |  | 259 |  |
  |  | 260 | if ( in\_array( $pagenow, array( 'post-new.php' ) ) ) { |
  |  | 261 | if ( $post\_type == 'page' && get\_option( 'papr\_select\_all\_pages' ) == 'checked' ) { |
  |  | 262 |  |
  |  | 263 | $pages\_for\_loggedin\_users = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 264 | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users != '' ? $pages\_for\_loggedin\_users : array(); |
  |  | 265 |  |
  |  | 266 | $pages\_for\_loggedin\_users[ get\_the\_ID() ] = true; |
  |  | 267 | update\_option( 'papr\_allowed\_redirect\_for\_pages', $pages\_for\_loggedin\_users ); |
  |  | 268 |  |
  |  | 269 | } elseif ( get\_option( 'papr\_select\_all\_posts' ) == 'checked' ) { |
  |  | 270 |  |
  |  | 271 | $pages\_for\_loggedin\_users = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 272 | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users != '' ? $pages\_for\_loggedin\_users : array(); |
  |  | 273 |  |
  |  | 274 | $pages\_for\_loggedin\_users[ get\_the\_ID() ] = true; |
  |  | 275 | update\_option( 'papr\_allowed\_redirect\_for\_posts', $pages\_for\_loggedin\_users ); |
  |  | 276 | } |
  |  | 277 | } |
  |  | 278 |  |
  |  | 279 | if ( is\_array( $user\_roles ) ) { |
  |  | 280 | if ( empty( array\_intersect( $metabox\_roles\_array, $user\_roles ) ) && ( ! papr\_in\_array( 'administrator', $user\_roles ) ) ) { |
  |  | 281 | return; |
  |  | 282 | } |
  |  | 283 | } |
  |  | 284 |  |
  |  | 285 | $type = get\_post\_type\_object( $post\_type ); |
  |  | 286 | add\_meta\_box( 'demo-meta-box', 'Page Restrict Access', array( $this, 'papr\_meta\_box' ), $post\_type, 'side', 'high', null ); |
  |  | 287 | } |
  |  | 288 |  |
  |  | 289 | /\*If the user is not logged in then it checks if the page or post are retricted to logged in user only or not. \*/ |
  |  | 290 | function papr\_restrict\_logged\_in\_users( $page\_post\_id ) { |
  |  | 291 | $restricted\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 292 | $restricted\_posts = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 293 |  |
  |  | 294 | $default\_login\_toggle = get\_option( 'papr\_access\_for\_only\_loggedin' ); |
  |  | 295 | $unrestricted\_pages   = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 296 |  |
  |  | 297 | $default\_login\_toggle\_posts = get\_option( 'papr\_access\_for\_only\_loggedin\_posts' ); |
  |  | 298 | $unrestricted\_posts         = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 299 |  |
  |  | 300 | $restricted\_pages = $restricted\_pages != '' ? $restricted\_pages : array(); |
  |  | 301 | $restricted\_posts = $restricted\_posts != '' ? $restricted\_posts : array(); |
  |  | 302 |  |
  |  | 303 | $default\_login\_toggle = $default\_login\_toggle != '' ? $default\_login\_toggle : ''; |
  |  | 304 | $unrestricted\_pages   = $unrestricted\_pages != '' ? $unrestricted\_pages : array(); |
  |  | 305 |  |
  |  | 306 | $default\_login\_toggle\_posts = $default\_login\_toggle\_posts != '' ? $default\_login\_toggle\_posts : ''; |
  |  | 307 | $unrestricted\_posts         = $unrestricted\_posts != '' ? $unrestricted\_posts : array(); |
  |  | 308 |  |
  |  | 309 | // Settings when global toggle is all and fe pages/posts has unticked checkbox |
  |  | 310 | if ( is\_page() && ( $default\_login\_toggle == 1 ) && empty( $unrestricted\_pages[ $page\_post\_id ] ) ) { |
  |  | 311 | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  |  | 312 | wp\_die( $papr\_message\_text ); |
  |  | 313 | } |
  |  | 314 |  |
  |  | 315 | if ( is\_single() && ( $default\_login\_toggle\_posts == 1 ) && empty( $unrestricted\_posts[ $page\_post\_id ] ) ) { |
  |  | 316 | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  |  | 317 | wp\_die( $papr\_message\_text ); |
  |  | 318 | } |
  |  | 319 |  |
  |  | 320 | // Added condition for front page restriction |
  |  | 321 | if ( ( is\_page() && ! empty( $restricted\_pages[ $page\_post\_id ] ) ) || ( is\_front\_page() && ! empty( $restricted\_pages[ get\_option( 'page\_on\_front' ) ] ) ) || ( is\_single() && ! empty( $restricted\_posts[ $page\_post\_id ] ) ) ) { |
  |  | 322 | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  |  | 323 | wp\_die( $papr\_message\_text ); |
  |  | 324 | } |
  |  | 325 | } |
  |  | 326 |  |
  |  | 327 | /\*If user is logged in then this function checks if the user is restricted to access any page or post\*/ |
  |  | 328 | function papr\_restrict\_by\_role( $page\_post\_id ) { |
  |  | 329 | $allowed\_roles\_for\_posts = get\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 330 | $allowed\_roles\_for\_pages = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 331 | $restricted\_pages        = get\_option( 'papr\_restricted\_pages' ); |
  |  | 332 | $restricted\_posts        = get\_option( 'papr\_restricted\_posts' ); |
  |  | 333 |  |
  |  | 334 | $allowed\_roles\_for\_posts = $allowed\_roles\_for\_posts != '' ? $allowed\_roles\_for\_posts : array(); |
  |  | 335 | $allowed\_roles\_for\_pages = $allowed\_roles\_for\_pages != '' ? $allowed\_roles\_for\_pages : array(); |
  |  | 336 | $restricted\_pages        = $restricted\_pages != '' ? $restricted\_pages : array(); |
  |  | 337 | $restricted\_posts        = $restricted\_posts != '' ? $restricted\_posts : array(); |
  |  | 338 |  |
  |  | 339 | if ( is\_page( $page\_post\_id ) ) { |
  |  | 340 | $allowed\_roles\_for\_types = $allowed\_roles\_for\_pages; |
  |  | 341 | } else { |
  |  | 342 | $allowed\_roles\_for\_types = $allowed\_roles\_for\_posts; |
  |  | 343 | } |
  |  | 344 |  |
  |  | 345 | if ( ! is\_front\_page() && empty( $allowed\_roles\_for\_pages['mo\_page\_0'] ) ) { |
  |  | 346 | if ( is\_page( $page\_post\_id ) ) { |
  |  | 347 | if ( is\_array( $restricted\_pages ) ) { |
  |  | 348 | if ( ! papr\_in\_array( $page\_post\_id, $restricted\_pages ) ) { |
  |  | 349 | if ( $page\_post\_id !== 1 ) { |
  |  | 350 | return; |
  |  | 351 | } |
  |  | 352 | } |
  |  | 353 | } |
  |  | 354 | } else { |
  |  | 355 | if ( is\_array( $restricted\_posts ) ) { |
  |  | 356 | if ( ! papr\_in\_array( $page\_post\_id, $restricted\_posts ) ) { |
  |  | 357 | return; |
  |  | 358 | } |
  |  | 359 | } |
  |  | 360 | } |
  |  | 361 | } |
  |  | 362 |  |
  |  | 363 | $current\_user = wp\_get\_current\_user(); |
  |  | 364 | $user\_roles   = $current\_user->roles; |
  |  | 365 |  |
  |  | 366 | foreach ( $user\_roles as $key => $user\_role ) { |
  |  | 367 | if ( is\_front\_page() && ! empty( $allowed\_roles\_for\_pages['mo\_page\_0'] ) ) { |
  |  | 368 | foreach ( $allowed\_roles\_for\_pages['mo\_page\_0'] as $keys => $allowed\_roles\_for\_page ) { |
  |  | 369 | if ( strripos( $allowed\_roles\_for\_page, $user\_role ) !== false ) { |
  |  | 370 | return; |
  |  | 371 | } |
  |  | 372 | } |
  |  | 373 | } elseif ( ! empty( $allowed\_roles\_for\_types[ $page\_post\_id ] ) ) { |
  |  | 374 | if ( is\_array( $allowed\_roles\_for\_types ) ) { |
  |  | 375 | if ( ! empty( $allowed\_roles\_for\_types[ $page\_post\_id ] ) ) { |
  |  | 376 | foreach ( $allowed\_roles\_for\_types[ $page\_post\_id ] as $keys => $allowed\_roles\_for\_type ) { |
  |  | 377 | if ( strripos( $allowed\_roles\_for\_type, $user\_role ) !== false ) { |
  |  | 378 | return; |
  |  | 379 | } |
  |  | 380 | } |
  |  | 381 | } |
  |  | 382 | } |
  |  | 383 | } |
  |  | 384 | } |
  |  | 385 |  |
  |  | 386 | // default access to all users |
  |  | 387 | if ( is\_array( $allowed\_roles\_for\_pages ) || is\_array( $allowed\_roles\_for\_posts ) ) { |
  |  | 388 | if ( is\_page() && ! empty( $allowed\_roles\_for\_pages[ $page\_post\_id ] ) && ( count( $allowed\_roles\_for\_pages[ $page\_post\_id ] ) == 0 ) ) { |
  |  | 389 | return; |
  |  | 390 | } elseif ( ( is\_single() && ! empty( $allowed\_roles\_for\_posts[ $page\_post\_id ] ) ) || ( is\_front\_page() && ! empty( $allowed\_roles\_for\_pages['mo\_page\_0'] ) ) || ( is\_page() && ! empty( $allowed\_roles\_for\_pages[ $page\_post\_id ] ) ) ) { |
  |  | 391 | $papr\_message\_text = 'Oops! You are not authorized to access this'; |
  |  | 392 | wp\_die( $papr\_message\_text ); |
  |  | 393 | } |
  |  | 394 | } |
  |  | 395 | } |
  |  | 396 |  |
  |  | 397 | function papr\_initialize\_page\_restrict() { |
  |  | 398 | $page\_post\_id         = get\_the\_ID() ? get\_the\_ID() : 0; |
  |  | 399 | $guest\_user\_logged\_in = false; |
  |  | 400 |  |
  |  | 401 | $type = get\_post\_type( $page\_post\_id ); |
  |  | 402 |  |
  |  | 403 | if ( $type != 'page' && $type != 'post' ) { |
  |  | 404 | return; |
  |  | 405 | } |
  |  | 406 |  |
  |  | 407 | if ( ! is\_user\_logged\_in() and ! $guest\_user\_logged\_in ) { |
  |  | 408 | $this->papr\_restrict\_logged\_in\_users( $page\_post\_id ); |
  |  | 409 | } else { |
  |  | 410 | $this->papr\_restrict\_by\_role( $page\_post\_id ); |
  |  | 411 | } |
  |  | 412 | } |
  |  | 413 |  |
  |  | 414 | public static function papr\_meta\_box( $post ) { |
  |  | 415 | $type = ''; |
  |  | 416 | if ( is\_object( $post ) && property\_exists( $post, 'post\_type' ) ) { |
  |  | 417 | $type = $post->post\_type; |
  |  | 418 | } |
  |  | 419 |  |
  |  | 420 | if ( $type == 'page' || $type == 'post' ) { |
  |  | 421 | wp\_nonce\_field( 'my\_meta\_box\_nonce', 'meta\_box\_nonce' ); |
  |  | 422 | } |
  |  | 423 |  |
  |  | 424 | global $wp\_roles; |
  |  | 425 | $wp\_name\_roles = ( $wp\_roles->role\_names ); |
  |  | 426 | asort( $wp\_name\_roles ); |
  |  | 427 | if ( $type == 'page' ) { |
  |  | 428 | $role = maybe\_unserialize( get\_option( 'papr\_allowed\_roles\_for\_pages' ) ); |
  |  | 429 | $role = $role != '' ? $role : array(); |
  |  | 430 |  |
  |  | 431 | $default\_login\_toggle = maybe\_unserialize( get\_option( 'papr\_access\_for\_only\_loggedin' ) ); |
  |  | 432 | $default\_login\_toggle = $default\_login\_toggle != '' ? $default\_login\_toggle : ''; |
  |  | 433 | } elseif ( $type == 'post' ) { |
  |  | 434 | $role = maybe\_unserialize( get\_option( 'papr\_allowed\_roles\_for\_posts' ) ); |
  |  | 435 | $role = $role != '' ? $role : array(); |
  |  | 436 |  |
  |  | 437 | $default\_login\_toggle = maybe\_unserialize( get\_option( 'papr\_access\_for\_only\_loggedin\_posts' ) ); |
  |  | 438 | $default\_login\_toggle = $default\_login\_toggle != '' ? $default\_login\_toggle : ''; |
  |  | 439 | } else { |
  |  | 440 | $role                 = array(); |
  |  | 441 | $default\_login\_toggle = ''; |
  |  | 442 | } |
  |  | 443 |  |
  |  | 444 | $roles = array(); |
  |  | 445 | if ( ! empty( $role[ $post->ID ] ) ) { |
  |  | 446 | $roles = $role[ $post->ID ]; |
  |  | 447 | } |
  |  | 448 |  |
  |  | 449 | $is\_page\_restrcited\_for\_loggedin\_users = 'false'; |
  |  | 450 |  |
  |  | 451 | $disabled = ''; |
  |  | 452 |  |
  |  | 453 | if ( $type == 'page' ) { |
  |  | 454 | $pages\_for\_loggedin\_users = maybe\_unserialize( get\_option( 'papr\_allowed\_redirect\_for\_pages' ) ); |
  |  | 455 | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users != '' ? $pages\_for\_loggedin\_users : array(); |
  |  | 456 | } elseif ( $type == 'post' ) { |
  |  | 457 | $pages\_for\_loggedin\_users = maybe\_unserialize( get\_option( 'papr\_allowed\_redirect\_for\_posts' ) ); |
  |  | 458 | $pages\_for\_loggedin\_users = $pages\_for\_loggedin\_users != '' ? $pages\_for\_loggedin\_users : array(); |
  |  | 459 | } else { |
  |  | 460 | $disabled                 = 'disabled'; |
  |  | 461 | $pages\_for\_loggedin\_users = array(); |
  |  | 462 | } |
  |  | 463 |  |
  |  | 464 | if ( ! empty( $pages\_for\_loggedin\_users ) ) { |
  |  | 465 | if ( ! empty( $pages\_for\_loggedin\_users[ $post->ID ] ) && $pages\_for\_loggedin\_users[ $post->ID ] == 'true' ) { |
  |  | 466 | $is\_page\_restrcited\_for\_loggedin\_users = 'true'; |
  |  | 467 | } |
  |  | 468 | } |
  |  | 469 | ?> |
  |  | 470 | <div class="row"> |
  |  | 471 | <img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/miniorange-logo.png" alt="miniOrange Page and Post Restriction" width="35px"> |
  |  | 472 | <h4 style="position:absolute;top:-0.6rem;left:4.2rem;">Page and Post Restriction</h4> |
  |  | 473 | </div> |
  |  | 474 |  |
  |  | 475 | <p> |
  |  | 476 | <?php |
  |  | 477 | if ( $type != 'page' && $type != 'post' ) { |
  |  | 478 | ?> |
  |  | 479 | <p><b> |
  |  | 480 | This feature is available for Custom Post in Premium version of the Page and Post Restriction plugin. |
  |  | 481 | </b></p> |
  |  | 482 | <a href="admin.php?page=page\_restriction&tab=premium\_plan" target="\_blank">Premium Plans</a> |
  |  | 483 | <?php |
  |  | 484 | echo '</br></br>'; |
  |  | 485 | } |
  |  | 486 | esc\_html\_e( 'Limit access to Logged in users.', 'mo-wpum' ); |
  |  | 487 | ?> |
  |  | 488 | </p> |
  |  | 489 | <div class="page-restrict-loggedin-user-div"> |
  |  | 490 | <input type="hidden" name="papr\_metabox" value="true"> |
  |  | 491 | <ul class="page-restrict-loggedin-user"> |
  |  | 492 | <?php |
  |  | 493 | if ( $is\_page\_restrcited\_for\_loggedin\_users == 'true' ) { |
  |  | 494 | $require\_login = 'checked'; |
  |  | 495 | } else { |
  |  | 496 | $require\_login = ''; |
  |  | 497 | } |
  |  | 498 | global $pagenow; |
  |  | 499 | if ( in\_array( $pagenow, array( 'post-new.php' ) ) ) { |
  |  | 500 | if ( $default\_login\_toggle == 1 ) { |
  |  | 501 | $require\_login = 'checked'; |
  |  | 502 | } |
  |  | 503 | } |
  |  | 504 | ?> |
  |  | 505 | <input type="checkbox" name="restrict\_page\_access\_loggedin\_user" <?php echo esc\_attr( $require\_login ); ?> value="true" <?php echo ( $disabled ); ?> /> |
  |  | 506 | Require Login |
  |  | 507 | </ul> |
  |  | 508 | </div> |
  |  | 509 |  |
  |  | 510 | <hr> |
  |  | 511 | <p> |
  |  | 512 | <?php esc\_html\_e( "Limit access to this post's content to users of the selected roles.", 'mo-wpum' ); ?> |
  |  | 513 | </p> |
  |  | 514 |  |
  |  | 515 | <div class="role-list-wrap"> |
  |  | 516 |  |
  |  | 517 | <ul class="role-list"> |
  |  | 518 |  |
  |  | 519 | <?php foreach ( $wp\_name\_roles as $role => $name ) : ?> |
  |  | 520 | <li> |
  |  | 521 | <label> |
  |  | 522 | <input type="checkbox" name="papr\_access\_role[]" <?php checked( papr\_in\_array( $role, $roles ) || papr\_in\_array( $name, $roles ) ); ?> value="<?php echo esc\_attr( $role ); ?>" <?php echo esc\_attr( $disabled ); ?> /> |
  |  | 523 | <?php echo esc\_html( translate\_user\_role( $name ) ); ?> |
  |  | 524 | </label> |
  |  | 525 | </li> |
  |  | 526 | <?php endforeach; ?> |
  |  | 527 |  |
  |  | 528 | </ul> |
  |  | 529 | </div> |
  |  | 530 | <?php |
  |  | 531 | } |
  |  | 532 |  |
  |  | 533 | /\* Function to save the meta box details during creation/editing \*/ |
  |  | 534 | static function papr\_save\_meta\_box\_info( $post\_id, $post, $update ) { |
  |  | 535 | if ( ! isset( $\_POST['papr\_metabox'] ) && ! isset( $\_POST['book\_edit\_nonce'] ) ) { |
  |  | 536 | return; |
  |  | 537 | } |
  |  | 538 |  |
  |  | 539 | $type = get\_post\_type( $post ); |
  |  | 540 |  |
  |  | 541 | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) { |
  |  | 542 | return; |
  |  | 543 | } |
  |  | 544 |  |
  |  | 545 | $default\_role\_parent = get\_option( 'papr\_default\_role\_parent' ); |
  |  | 546 | $default\_role\_parent = $default\_role\_parent != '' ? $default\_role\_parent : array(); |
  |  | 547 | if ( $type == 'page' ) { |
  |  | 548 | $allowed\_roles          = maybe\_unserialize( get\_option( 'papr\_allowed\_roles\_for\_pages' ) ); |
  |  | 549 | $restrictedposts        = get\_option( 'papr\_restricted\_pages' ); |
  |  | 550 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 551 | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 552 |  |
  |  | 553 | $allowed\_roles          = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 554 | $restrictedposts        = $restrictedposts != '' ? $restrictedposts : array(); |
  |  | 555 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 556 | $unrestricted\_pages     = $unrestricted\_pages != '' ? $unrestricted\_pages : array(); |
  |  | 557 |  |
  |  | 558 | } elseif ( $type == 'post' ) { |
  |  | 559 | $allowed\_roles          = maybe\_unserialize( get\_option( 'papr\_allowed\_roles\_for\_posts' ) ); |
  |  | 560 | $restrictedposts        = get\_option( 'papr\_restricted\_posts' ); |
  |  | 561 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 562 | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 563 |  |
  |  | 564 | $allowed\_roles          = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 565 | $restrictedposts        = $restrictedposts != '' ? $restrictedposts : array(); |
  |  | 566 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 567 | $unrestricted\_pages     = $unrestricted\_pages != '' ? $unrestricted\_pages : array(); |
  |  | 568 | } else { |
  |  | 569 | return; |
  |  | 570 | } |
  |  | 571 |  |
  |  | 572 | if ( isset( $\_POST['papr\_access\_role'] ) ) { |
  |  | 573 | array\_push( $restrictedposts, $post\_id ); |
  |  | 574 | $new\_roles = $\_POST['papr\_access\_role']; |
  |  | 575 | foreach ( $new\_roles as $value ) { |
  |  | 576 | $value = sanitize\_text\_field( $value ); |
  |  | 577 | } |
  |  | 578 | $allowed\_roles[ $post\_id ] = $new\_roles; |
  |  | 579 | } elseif ( isset( $\_POST['Allowed\_Roles'] ) ) { |
  |  | 580 | array\_push( $restrictedposts, $post\_id ); |
  |  | 581 | $new\_roles                 = sanitize\_text\_field( $\_POST['Allowed\_Roles'] ); |
  |  | 582 | $allowed\_roles[ $post\_id ] = explode( ';', $new\_roles ); |
  |  | 583 | } else { |
  |  | 584 | $restrictedpostsarray = $restrictedposts; |
  |  | 585 | if ( is\_array( $restrictedpostsarray ) ) { |
  |  | 586 | while ( ( $i = array\_search( $post\_id, $restrictedpostsarray ) ) !== false ) { |
  |  | 587 | unset( $restrictedpostsarray[ $i ] ); |
  |  | 588 | unset( $allowed\_roles[ $post\_id ] ); |
  |  | 589 | } |
  |  | 590 | } |
  |  | 591 | $restrictedposts = $restrictedpostsarray; |
  |  | 592 | } |
  |  | 593 | if ( isset( $\_POST['restrict\_page\_access\_loggedin\_user'] ) || isset( $\_POST['Private'] ) ) { |
  |  | 594 | $allowed\_redirect\_pages[ $post\_id ] = true; |
  |  | 595 | unset( $unrestricted\_pages[ $post\_id ] ); |
  |  | 596 | } else { |
  |  | 597 | unset( $allowed\_redirect\_pages[ $post\_id ] ); |
  |  | 598 | $unrestricted\_pages[ $post\_id ] = true; |
  |  | 599 | } |
  |  | 600 |  |
  |  | 601 | $parent\_id = wp\_get\_post\_parent\_id( $post\_id ); |
  |  | 602 | if ( $type == 'page' && $parent\_id ) { |
  |  | 603 | if ( ! empty( $default\_role\_parent[ $parent\_id ] ) && $default\_role\_parent[ $parent\_id ] == true ) { |
  |  | 604 | $restrictedposts = get\_option( 'papr\_restricted\_pages' ); |
  |  | 605 | $restrictedposts = $restrictedposts != '' ? $restrictedposts : array(); |
  |  | 606 |  |
  |  | 607 | if ( papr\_in\_array( $parent\_id, $restrictedposts ) ) { |
  |  | 608 | array\_push( $restrictedposts, $post\_id ); |
  |  | 609 | $allowed\_roles             = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 610 | $allowed\_roles             = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 611 | $role\_string               = $allowed\_roles[ $parent\_id ]; |
  |  | 612 | $parent\_allowed\_roles      = $role\_string; |
  |  | 613 | $allowed\_roles[ $post\_id ] = $parent\_allowed\_roles; |
  |  | 614 | if ( $allowed\_roles[ $post\_id ] != '' ) { |
  |  | 615 | if ( ! papr\_in\_array( $post\_id, $restrictedposts ) ) { |
  |  | 616 | array\_push( $restrictedposts, $post\_id ); |
  |  | 617 | } |
  |  | 618 | } else { |
  |  | 619 | unset( $restrictedposts[ $post\_id ] ); |
  |  | 620 | } |
  |  | 621 | } |
  |  | 622 | if ( papr\_in\_array( $parent\_id, $allowed\_redirect\_pages ) ) { |
  |  | 623 | $allowed\_redirect\_pages[ $post\_id ] = true; |
  |  | 624 | unset( $unrestricted\_pages[ $post\_id ] ); |
  |  | 625 | } else { |
  |  | 626 | unset( $allowed\_redirect\_pages[ $post\_id ] ); |
  |  | 627 | $unrestricted\_pages[ $post\_id ] = true; |
  |  | 628 | } |
  |  | 629 | } |
  |  | 630 | } |
  |  | 631 |  |
  |  | 632 | if ( $type == 'page' ) { |
  |  | 633 | $default\_role\_toggle = get\_option( 'papr\_default\_role\_parent\_page\_toggle' ); |
  |  | 634 | $default\_role\_toggle = $default\_role\_toggle != '' ? $default\_role\_toggle : ''; |
  |  | 635 |  |
  |  | 636 | if ( ! empty( $default\_role\_parent[ $post\_id ] ) || $default\_role\_toggle == 1 ) { |
  |  | 637 | if ( $post\_id != 0 ) { |
  |  | 638 | $default\_role\_parent[ $post\_id ] = true; |
  |  | 639 |  |
  |  | 640 | $children = get\_pages( array( 'child\_of' => $post\_id ) ); |
  |  | 641 |  |
  |  | 642 | if ( count( $children ) > 0 ) { |
  |  | 643 |  |
  |  | 644 | foreach ( $children as $child ) { |
  |  | 645 | $child\_id = $child->ID; |
  |  | 646 |  |
  |  | 647 | $allowed\_roles[ $child->ID ] = $allowed\_roles[ $post\_id ]; |
  |  | 648 |  |
  |  | 649 | if ( $allowed\_roles[ $child->ID ] != '' ) { |
  |  | 650 | if ( ! papr\_in\_array( $child->ID, $restrictedposts ) ) { |
  |  | 651 | array\_push( $restrictedposts, $child->ID ); |
  |  | 652 | } |
  |  | 653 | } else { |
  |  | 654 | unset( $restrictedposts[ $child->ID ] ); |
  |  | 655 | } |
  |  | 656 |  |
  |  | 657 | if ( ! empty( $allowed\_redirect\_pages[ $post\_id ] ) ) { |
  |  | 658 | if ( $allowed\_redirect\_pages[ $post\_id ] == 1 || $allowed\_redirect\_pages[ $post\_id ] == 'on' || $allowed\_redirect\_pages[ $post\_id ] == 'true' ) { |
  |  | 659 | $allowed\_redirect\_pages[ $child->ID ] = true; |
  |  | 660 | unset( $unrestricted\_pages[ $child->ID ] ); |
  |  | 661 | } |
  |  | 662 | } else { |
  |  | 663 | unset( $allowed\_redirect\_pages[ $child->ID ] ); |
  |  | 664 | $unrestricted\_pages[ $child->ID ] = true; |
  |  | 665 | } |
  |  | 666 |  |
  |  | 667 | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  |  | 668 |  |
  |  | 669 | if ( count( $children\_of\_children ) > 0 ) { |
  |  | 670 | $default\_role\_parent[ $child->ID ] = true; |
  |  | 671 | } |
  |  | 672 | } |
  |  | 673 | } |
  |  | 674 | } |
  |  | 675 | } |
  |  | 676 | } |
  |  | 677 |  |
  |  | 678 | if ( $type == 'page' ) { |
  |  | 679 | update\_option( 'papr\_default\_role\_parent', $default\_role\_parent ); |
  |  | 680 | update\_option( 'papr\_login\_unrestricted\_pages', $unrestricted\_pages ); |
  |  | 681 | update\_option( 'papr\_restricted\_pages', $restrictedposts ); |
  |  | 682 | update\_option( 'papr\_allowed\_roles\_for\_pages', $allowed\_roles ); |
  |  | 683 | update\_option( 'papr\_allowed\_redirect\_for\_pages', $allowed\_redirect\_pages ); |
  |  | 684 | } else { |
  |  | 685 | update\_option( 'papr\_restricted\_posts', $restrictedposts ); |
  |  | 686 | update\_option( 'papr\_allowed\_roles\_for\_posts', $allowed\_roles ); |
  |  | 687 | update\_option( 'papr\_allowed\_redirect\_for\_posts', $allowed\_redirect\_pages ); |
  |  | 688 | update\_option( 'papr\_login\_unrestricted\_posts', $unrestricted\_pages ); |
  |  | 689 | } |
  |  | 690 | } |
  | 671 | 691 | } |
  | 672 |  | new page\_and\_post\_restriction\_add\_on; |
  |  | 692 | new page\_and\_post\_restriction\_add\_on(); |
  | 673 | 693 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-category-access.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-category-access.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-category-access.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=2829798#L4 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=3034414#L4 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | require\_once 'page-restriction-page-access.php'; |
  | 5 | 5 |  |
  | 6 |  | function papr\_category\_access() |
  | 7 |  | { |
  | 8 |  | $results\_per\_page = get\_option('papr\_category\_per\_page'); |
  |  | 6 | function papr\_category\_access() { |
  |  | 7 | $results\_per\_page = get\_option( 'papr\_category\_per\_page' ); |
  | 9 | 8 |  |
  | 10 | 9 | $results\_per\_page = $results\_per\_page != '' ? $results\_per\_page : 10; |
  | 11 |  |  |
  |  | 10 |  |
  | 12 | 11 | ?> |
  | 13 | 12 | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4"> |
  | 14 | 13 |  |
  | 15 |  | <h4 class="papr-form-head">Give Access to Category based on Roles and Login Status</h4> |
  |  | 14 | <h4 class="papr-form-head">Give Access to Category based on Roles and Login Status</h4> |
  | 16 | 15 |  |
  | 17 |  | <div class="papr-prem-info"> |
  | 18 |  | <div class="papr-prem-icn papr-prem-cat-icn"><img src="https://img.icons8.com/color/48/000000/lock--v2.png" width="35px"> |
  | 19 |  | ~~<p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan'))~~ ?>" class="text-warning">Click here to upgrade</a></p> |
  | 20 |  | </div> |
  | 21 |  | <h5 class="papr-form-head papr-form-head-bar mt-2 mb-4">Category Restrictions |
  |  | 16 | <div class="papr-prem-info"> |
  |  | 17 | <div class="papr-prem-icn papr-prem-cat-icn"><img src="https://img.icons8.com/color/48/000000/lock--v2.png" width="35px"> |
  |  | 18 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?>" class="text-warning">Click here to upgrade</a></p> |
  |  | 19 | </div> |
  |  | 20 | <h5 class="papr-form-head papr-form-head-bar mt-2 mb-4">Category Restrictions |
  | 22 | 21 | <div class="papr-info-global ms-2"> |
  | 23 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 24 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 25 |  | </svg> |
  | 26 |  | <p class="papr-info-text-global"> |
  | 27 |  | Specify which post categories would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the post categories in the table below. |
  | 28 |  | </p> |
  | 29 |  | </div> |
  | 30 |  | </h5> |
  | 31 |  | <div class="mb-4"> <b>Note:</b> All the posts of a restricted category would also be restricted.</div> |
  | 32 |  | <?php papr\_dropdown(~~$results\_per\_page, 'category'~~); ?> |
  |  | 22 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 23 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 24 | </svg> |
  |  | 25 | <p class="papr-info-text-global"> |
  |  | 26 | Specify which post categories would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the post categories in the table below. |
  |  | 27 | </p> |
  |  | 28 | </div> |
  |  | 29 | </h5> |
  |  | 30 | <div class="mb-4"> <b>Note:</b> All the posts of a restricted category would also be restricted.</div> |
  |  | 31 | <?php papr\_dropdown( $results\_per\_page, 'category' ); ?> |
  | 33 | 32 |  |
  | 34 | 33 | <div class="tablenav top mt-4"> |
  | 35 | 34 | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" disabled> |
  | 36 | 35 | <?php |
  | 37 |  | $categories ~~= get\_categories(array("hide\_empty" => 0)~~); |
  | 38 |  | $total\_category ~~= count($categories~~); |
  | 39 |  | $number\_of\_pages\_in\_pagination = ceil(~~$total\_category / $results\_per\_page~~); |
  |  | 36 | $categories                    = get\_categories( array( 'hide\_empty' => 0 ) ); |
  |  | 37 | $total\_category                = count( $categories ); |
  |  | 38 | $number\_of\_pages\_in\_pagination = ceil( $total\_category / $results\_per\_page ); |
  | 40 | 39 |  |
  | 41 |  | $current\_page = papr\_get\_current\_page(~~$number\_of\_pages\_in\_pagination~~); |
  |  | 40 | $current\_page = papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ); |
  | 42 | 41 |  |
  | 43 |  | $offset = ($results\_per\_page \* $current\_page) - $results\_per\_page; |
  | 44 |  | $categories = get\_categories(array( |
  | 45 |  | "hide\_empty" => 0, |
  | 46 |  | "type"      => "post", |
  | 47 |  | "orderby"   => "name", |
  | 48 |  | "order"     => "ASC", |
  | 49 |  | 'number' => $results\_per\_page, |
  | 50 |  | 'offset' => $offset |
  | 51 |  | )); |
  |  | 42 | $offset     = ( $results\_per\_page \* $current\_page ) - $results\_per\_page; |
  |  | 43 | $categories = get\_categories( |
  |  | 44 | array( |
  |  | 45 | 'hide\_empty' => 0, |
  |  | 46 | 'type'       => 'post', |
  |  | 47 | 'orderby'    => 'name', |
  |  | 48 | 'order'      => 'ASC', |
  |  | 49 | 'number'     => $results\_per\_page, |
  |  | 50 | 'offset'     => $offset, |
  |  | 51 | ) |
  |  | 52 | ); |
  | 52 | 53 |  |
  | 53 | 54 | $link = 'admin.php?page=page\_restriction&tab=category\_access&curr='; |
  | 54 |  | papr\_pagination\_button(~~$number\_of\_pages\_in\_pagination, $total\_category, $current\_page, $link, 'top'~~); |
  |  | 55 | papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_category, $current\_page, $link, 'top' ); |
  | 55 | 56 | ?> |
  | 56 | 57 | </div> |
  | 57 | 58 |  |
  | 58 | 59 | <table id="reports\_table" class="wp-list-table widefat fixed striped table-view-list pages"> |
  | 59 |  | <thead><?php papr\_display\_head\_foot\_of\_table(~~'Category'~~); ?><thead> |
  |  | 60 | <thead><?php papr\_display\_head\_foot\_of\_table( 'Category' ); ?><thead> |
  | 60 | 61 | <tbody class="w-100"> |
  | 61 | 62 | <?php |
  | 62 |  | foreach ($categories as $category) { |
  | 63 |  | papr\_category\_display\_pages($category); |
  | 64 |  | } ?> |
  |  | 63 | foreach ( $categories as $category ) { |
  |  | 64 | papr\_category\_display\_pages( $category ); |
  |  | 65 | } |
  |  | 66 | ?> |
  | 65 | 67 | </tbody> |
  | 66 | 68 | <tfoot> |
  | 67 |  | <?php papr\_display\_head\_foot\_of\_table(~~'Category'~~); ?> |
  |  | 69 | <?php papr\_display\_head\_foot\_of\_table( 'Category' ); ?> |
  | 68 | 70 | </tfoot> |
  | 69 | 71 | </table> |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=2829798#L71) | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=3034414#L73) |  |
  | 71 | 73 | <div class="tablenav bottom mt-4"> |
  | 72 | 74 | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform" disabled> |
  | 73 |  | <?php papr\_pagination\_button(~~$number\_of\_pages\_in\_pagination, $total\_category, $current\_page, $link, 'bottom'~~); ?> |
  |  | 75 | <?php papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_category, $current\_page, $link, 'bottom' ); ?> |
  | 74 | 76 | </div> |
  | 75 | 77 | </div> |
  | 76 | 78 | </div> |
  | 77 | 79 | <script> |
  | 78 |  | var category\_selector\_up = document.getElementById("current-page-selector"); |
  | 79 |  | var category\_selector\_down = document.getElementById("current-page-selector-1"); |
  | 80 |  | var link = 'admin.php?page=page\_restriction&tab=category\_access&curr='; |
  |  | 80 | var category\_selector\_up = document.getElementById("current-page-selector"); |
  |  | 81 | var category\_selector\_down = document.getElementById("current-page-selector-1"); |
  |  | 82 | var link = 'admin.php?page=page\_restriction&tab=category\_access&curr='; |
  | 81 | 83 |  |
  | 82 |  | category\_selector\_up.addEventListener("keyup", function(event) { |
  | 83 |  | if (event.keyCode === 13) { |
  | 84 |  | category\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  | 85 |  | var page\_link = link.concat(category\_selector\_up\_value); |
  | 86 |  | window.open(page\_link, "\_self"); |
  | 87 |  | } |
  | 88 |  | }); |
  |  | 84 | category\_selector\_up.addEventListener("keyup", function(event) { |
  |  | 85 | if (event.keyCode === 13) { |
  |  | 86 | category\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  |  | 87 | var page\_link = link.concat(category\_selector\_up\_value); |
  |  | 88 | window.open(page\_link, "\_self"); |
  |  | 89 | } |
  |  | 90 | }); |
  | 89 | 91 |  |
  | 90 |  | category\_selector\_down.addEventListener("keyup", function(event) { |
  | 91 |  | if (event.keyCode === 13) { |
  | 92 |  | category\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  | 93 |  | var page\_link = link.concat(category\_selector\_down\_value); |
  | 94 |  | window.open(page\_link, "\_self"); |
  | 95 |  | } |
  | 96 |  | }); |
  |  | 92 | category\_selector\_down.addEventListener("keyup", function(event) { |
  |  | 93 | if (event.keyCode === 13) { |
  |  | 94 | category\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  |  | 95 | var page\_link = link.concat(category\_selector\_down\_value); |
  |  | 96 | window.open(page\_link, "\_self"); |
  |  | 97 | } |
  |  | 98 | }); |
  | 97 | 99 | </script> |
  | 98 | 100 | <?php |
  | 99 | 101 | } |
  | 100 | 102 |  |
  | 101 |  | function papr\_category\_display\_pages($category) |
  | 102 |  | { |
  | 103 |  | ?> |
  | 104 |  | <tr id="<?php echo esc\_url(get\_category\_link($category)) ?>"> |
  |  | 103 | function papr\_category\_display\_pages( $category ) { |
  |  | 104 | ?> |
  |  | 105 | <tr id="<?php echo esc\_url( get\_category\_link( $category ) ); ?>"> |
  | 105 | 106 | <td> |
  | 106 |  | <a href="<?php echo esc\_url(~~get\_category\_link($category)) ?>" target="\_blank"><?php echo esc\_html($category->name)~~ ?> &nbsp; |
  | 107 |  | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 107 | <a href="<?php echo esc\_url( get\_category\_link( $category ) ); ?>" target="\_blank"><?php echo esc\_html( $category->name ); ?> &nbsp; |
  |  | 108 | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 108 | 109 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 109 | 110 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=2829798#L112) | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=3034414#L113) |  |
  | 112 | 113 | <td> |
  | 113 | 114 | <input class="w-75" type="text" name="mo\_category\_roles" id="mo\_category\_roles" placeholder="Enter (;) separated Roles" autocomplete="off" disabled> |
  | 114 |  | </td> |
  |  | 115 | </td> |
  | 115 | 116 |  |
  | 116 | 117 | <th scope="row" class="check-column"> |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=2829798#L125) | […](/browser/page-and-post-restriction/trunk/page-restriction-category-access.php?rev=3034414#L126) |  |
  | 125 | 126 | </th> |
  | 126 | 127 | </tr> |
  | 127 |  | <?php |
  |  | 128 | <?php |
  | 128 | 129 | } |
  | 129 | 130 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-class-customer.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-class-customer.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-class-customer.php")

  | [r2751531](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=2751531#L15 "Show revision 2751531 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=3034414#L15 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 15 | 15 | You should have received a copy of the GNU General Public License |
  | 16 | 16 | along with this program.  If not, see <http://www.gnu.org/licenses/> |
  |  | 17 | \* |
  | 17 | 18 | \* @package         miniOrange Page Restriction |
  | 18 | 19 | \* @license        http://www.gnu.org/copyleft/gpl.html GNU/GPL, see LICENSE.php |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=2751531#L24) | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=3034414#L25) |  |
  | 24 | 25 | \*/ |
  | 25 | 26 |  |
  | 26 |  | ~~includ~~e\_once 'page-restriction-utility.php'; |
  | 27 |  |  |
  | 28 |  | class Customer\_page\_restriction |
  | 29 |  | { |
  | 30 |  | public $email; |
  | 31 |  | public $phone; |
  | 32 |  |  |
  | 33 |  | /\* |
  |  | 27 | require\_once 'page-restriction-utility.php'; |
  |  | 28 |  |
  |  | 29 | class Customer\_page\_restriction { |
  |  | 30 |  |
  |  | 31 | public $email; |
  |  | 32 | public $phone; |
  |  | 33 |  |
  |  | 34 | /\* |
  | 34 | 35 | \* \* Initial values are hardcoded to support the miniOrange framework to generate OTP for email. |
  | 35 | 36 | \* \* We need the default value for creating the first time, |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=2751531#L37) | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=3034414#L38) |  |
  | 37 | 38 | \* \* This default values are only required for sending an One Time Passcode at the user provided email address. |
  | 38 | 39 | \*/ |
  | 39 |  | private $defaultCustomerKey = "16555"; |
  | 40 |  | private $defaultApiKey = "fFd2XcvTGDemZvbw1bcUesNJWEqKbbUq"; |
  | 41 |  |  |
  | 42 |  |  |
  | 43 |  | function papr\_get\_customer\_key() |
  | 44 |  | { |
  | 45 |  | $url = get\_option('papr\_host\_name') . "/moas/rest/customer/key"; |
  | 46 |  | $ch = curl\_init($url); |
  | 47 |  | $email = get\_option("papr\_admin\_email"); |
  | 48 |  |  |
  | 49 |  | $password = get\_option("papr\_admin\_password"); |
  | 50 |  |  |
  | 51 |  | $fields = array ( |
  | 52 |  | 'email' => $email, |
  | 53 |  | 'password' => $password |
  | 54 |  | ); |
  | 55 |  | $field\_string = json\_encode($fields); |
  | 56 |  | $headers = array("Content-Type"=>"application/json","charset"=>"UTF-8","Authorization"=>"Basic"); |
  | 57 |  | $args = array( |
  | 58 |  | 'method' => 'POST', |
  | 59 |  | 'body' => $field\_string, |
  | 60 |  | 'timeout' => '5', |
  | 61 |  | 'redirection' => '5', |
  | 62 |  | 'httpversion' => '1.0', |
  | 63 |  | 'blocking' => true, |
  | 64 |  | 'headers' => $headers |
  | 65 |  | ); |
  | 66 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 67 |  | return $response; |
  | 68 |  | } |
  | 69 |  |  |
  | 70 |  | function papr\_create\_customer() { |
  | 71 |  | $url = get\_option('papr\_host\_name') . '/moas/rest/customer/add'; |
  | 72 |  |  |
  | 73 |  | $current\_user = wp\_get\_current\_user(); |
  | 74 |  | $this->email = get\_option ( 'papr\_admin\_email' ); |
  | 75 |  | $password = get\_option ( 'papr\_admin\_password' ); |
  | 76 |  |  |
  | 77 |  | $fields = array ( |
  | 78 |  | 'areaOfInterest' => 'WP miniOrange Page Restriction Plugin', |
  | 79 |  | 'email' => $this->email, |
  | 80 |  | 'password' => $password |
  | 81 |  | ); |
  | 82 |  | $field\_string = json\_encode ( $fields ); |
  | 83 |  |  |
  | 84 |  | $headers = array("Content-Type"=>"application/json","charset"=>"UTF-8","Authorization"=>"Basic"); |
  | 85 |  | $args = array( |
  | 86 |  | 'method' => 'POST', |
  | 87 |  | 'body' => $field\_string, |
  | 88 |  | 'timeout' => '5', |
  | 89 |  | 'redirection' => '5', |
  | 90 |  | 'httpversion' => '1.0', |
  | 91 |  | 'blocking' => true, |
  | 92 |  | 'headers' => $headers |
  | 93 |  | ); |
  | 94 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 95 |  | return $response; |
  | 96 |  |  |
  | 97 |  | } |
  | 98 |  |  |
  | 99 |  | function papr\_check\_customer() { |
  | 100 |  | $url = get\_option('papr\_host\_name') . "/moas/rest/customer/check-if-exists"; |
  | 101 |  | $email = get\_option ( "papr\_admin\_email" ); |
  | 102 |  |  |
  | 103 |  | $fields = array ( |
  | 104 |  | 'email' => $email |
  | 105 |  | ); |
  | 106 |  | $field\_string = json\_encode ( $fields ); |
  | 107 |  |  |
  | 108 |  | $headers = array("Content-Type"=>"application/json","charset"=>"UTF-8","Authorization"=>"Basic"); |
  | 109 |  | $args = array( |
  | 110 |  | 'method' => 'POST', |
  | 111 |  | 'body' => $field\_string, |
  | 112 |  | 'timeout' => '5', |
  | 113 |  | 'redirection' => '5', |
  | 114 |  | 'httpversion' => '1.0', |
  | 115 |  | 'blocking' => true, |
  | 116 |  | 'headers' => $headers |
  | 117 |  | ); |
  | 118 |  |  |
  | 119 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 120 |  | return $response; |
  | 121 |  | } |
  | 122 |  |  |
  | 123 |  | function papr\_submit\_contact\_us($email, $phone, $query) |
  | 124 |  | { |
  | 125 |  | $url = get\_option('papr\_host\_name'). '/moas/rest/customer/contact-us'; |
  | 126 |  | $current\_user = wp\_get\_current\_user(); |
  | 127 |  | $query = '[WP Page Restriction Free Plugin] ' . $query; |
  | 128 |  | $fields = array ( |
  | 129 |  | 'firstName' => $current\_user->user\_firstname, |
  | 130 |  | 'lastName' => $current\_user->user\_lastname, |
  | 131 |  | 'company' => sanitize\_text\_field($\_SERVER ['SERVER\_NAME']), |
  | 132 |  | 'email' => $email, |
  | 133 |  | 'ccEmail'=>'samlsupport@xecurify.com', |
  | 134 |  | 'phone' => $phone, |
  | 135 |  | 'query' => $query |
  | 136 |  | ); |
  | 137 |  | $field\_string = json\_encode ( $fields ); |
  | 138 |  |  |
  | 139 |  | $headers = array("Content-Type"=>"application/json","charset"=>"UTF-8","Authorization"=>"Basic"); |
  | 140 |  | $args = array( |
  | 141 |  | 'method' => 'POST', |
  | 142 |  | 'body' => $field\_string, |
  | 143 |  | 'timeout' => '10', |
  | 144 |  | 'redirection' => '5', |
  | 145 |  | 'httpversion' => '1.0', |
  | 146 |  | 'blocking' => true, |
  | 147 |  | 'headers' => $headers |
  | 148 |  | ); |
  | 149 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 150 |  | return $response; |
  | 151 |  | } |
  | 152 |  |  |
  | 153 |  | function papr\_forgot\_password($email) |
  | 154 |  | { |
  | 155 |  | $url = get\_option('papr\_host\_name') . '/moas/rest/customer/password-reset'; |
  | 156 |  | $customerKey = get\_option ( 'papr\_admin\_customer\_key' ); |
  | 157 |  | $apiKey = get\_option ( 'papr\_admin\_api\_key' ); |
  | 158 |  | $currentTimeInMillis = round ( microtime ( true ) \* 1000 ); |
  | 159 |  | $stringToHash = $customerKey . number\_format ( $currentTimeInMillis, 0, '', '' ) . $apiKey; |
  | 160 |  | $hashValue = hash ( "sha512", $stringToHash ); |
  | 161 |  |  |
  | 162 |  | $fields = ''; |
  | 163 |  | $fields = array ( |
  | 164 |  | 'email' => $email |
  | 165 |  | ); |
  | 166 |  |  |
  | 167 |  | $field\_string = json\_encode ( $fields ); |
  | 168 |  | $headers = array( |
  | 169 |  | "Content-Type" => "application/json", |
  | 170 |  | "Customer-Key" => $customerKey, |
  | 171 |  | "Timestamp" => $currentTimeInMillis, |
  | 172 |  | "Authorization" => $hashValue |
  | 173 |  | ); |
  | 174 |  | $args = array( |
  | 175 |  | 'method' => 'POST', |
  | 176 |  | 'body' => $field\_string, |
  | 177 |  | 'timeout' => '5', |
  | 178 |  | 'redirection' => '5', |
  | 179 |  | 'httpversion' => '1.0', |
  | 180 |  | 'blocking' => true, |
  | 181 |  | 'headers' => $headers |
  | 182 |  | ); |
  | 183 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 184 |  | return $response; |
  | 185 |  | } |
  | 186 |  |  |
  | 187 |  |  |
  | 188 |  | function papr\_send\_email\_alert($email,$phone,$message){ |
  | 189 |  |  |
  | 190 |  | $url = get\_option('papr\_host\_name') .'/moas/api/notify/send'; |
  | 191 |  |  |
  | 192 |  | $customerKey = $this->defaultCustomerKey; |
  | 193 |  | $apiKey = $this->defaultApiKey; |
  | 194 |  |  |
  | 195 |  | $currentTimeInMillis = round ( microtime ( true ) \* 1000 ); |
  | 196 |  | $currentTimeInMillis = number\_format ( $currentTimeInMillis, 0, '', '' ); |
  | 197 |  | $stringToHash       = $customerKey .  $currentTimeInMillis . $apiKey; |
  | 198 |  | $hashValue          = hash("sha512", $stringToHash); |
  | 199 |  | $fromEmail          = 'no-reply@xecurify.com'; |
  | 200 |  | $subject            = "Feedback: WP Page Restriction Free Plugin"; |
  | 201 |  | $site\_url=site\_url(); |
  | 202 |  |  |
  | 203 |  | global $user; |
  | 204 |  | $user         = wp\_get\_current\_user(); |
  | 205 |  |  |
  | 206 |  | $query        = '[WP Page Restriction Free Plugin]: ' . $message; |
  | 207 |  |  |
  | 208 |  |  |
  | 209 |  | $content='<div >Hello, <br><br>First Name :'.$user->user\_firstname.'<br><br>Last  Name :'.$user->user\_lastname.'   <br><br>Company :<a href="'.esc\_attr($\_SERVER['SERVER\_NAME']).'" target="\_blank" >'.esc\_attr($\_SERVER['SERVER\_NAME']).'</a><br><br>Phone Number :'.$phone.'<br><br>Email :<a href="mailto:'.$email.'" target="\_blank">'.$email.'</a><br><br>Query :'.$query.'</div>'; |
  | 210 |  |  |
  | 211 |  | $fields = array( |
  | 212 |  | 'customerKey'   => $customerKey, |
  | 213 |  | 'sendEmail'     => true, |
  | 214 |  | 'email'         => array( |
  | 215 |  | 'customerKey'   => $customerKey, |
  | 216 |  | 'fromEmail'     => $fromEmail, |
  | 217 |  | 'fromName'      => 'Xecurify', |
  | 218 |  | 'toEmail'       => 'info@xecurify.com', |
  | 219 |  | 'toName'        => 'samlsupport@xecurify.com', |
  | 220 |  | 'bccEmail'      => 'samlsupport@xecurify.com', |
  | 221 |  | 'subject'       => $subject, |
  | 222 |  | 'content'       => $content |
  | 223 |  | ), |
  | 224 |  | ); |
  | 225 |  | $field\_string = json\_encode($fields); |
  | 226 |  |  |
  | 227 |  | $headers = array( |
  | 228 |  | "Content-Type" => "application/json", |
  | 229 |  | "Customer-Key" => $customerKey, |
  | 230 |  | "Timestamp" => $currentTimeInMillis, |
  | 231 |  | "Authorization" => $hashValue |
  | 232 |  | ); |
  | 233 |  | $args = array( |
  | 234 |  | 'method' => 'POST', |
  | 235 |  | 'body' => $field\_string, |
  | 236 |  | 'timeout' => '5', |
  | 237 |  | 'redirection' => '5', |
  | 238 |  | 'httpversion' => '1.0', |
  | 239 |  | 'blocking' => true, |
  | 240 |  | 'headers' => $headers |
  | 241 |  | ); |
  | 242 |  | $response = $this->papr\_wp\_remote\_post($url, $args); |
  | 243 |  | return $response; |
  | 244 |  | } |
  | 245 |  |  |
  | 246 |  | public static function papr\_wp\_remote\_post($url, $args = array()){ |
  | 247 |  | $response = wp\_remote\_post($url, $args); |
  | 248 |  | if(!is\_wp\_error($response)){ |
  |  | 40 | private $defaultCustomerKey = '16555'; |
  |  | 41 | private $defaultApiKey      = 'fFd2XcvTGDemZvbw1bcUesNJWEqKbbUq'; |
  |  | 42 |  |
  |  | 43 |  |
  |  | 44 | function papr\_get\_customer\_key() { |
  |  | 45 | $url   = get\_option( 'papr\_host\_name' ) . '/moas/rest/customer/key'; |
  |  | 46 | $ch    = curl\_init( $url ); |
  |  | 47 | $email = get\_option( 'papr\_admin\_email' ); |
  |  | 48 |  |
  |  | 49 | $password = get\_option( 'papr\_admin\_password' ); |
  |  | 50 |  |
  |  | 51 | $fields       = array( |
  |  | 52 | 'email'    => $email, |
  |  | 53 | 'password' => $password, |
  |  | 54 | ); |
  |  | 55 | $field\_string = json\_encode( $fields ); |
  |  | 56 | $headers      = array( |
  |  | 57 | 'Content-Type'  => 'application/json', |
  |  | 58 | 'charset'       => 'UTF-8', |
  |  | 59 | 'Authorization' => 'Basic', |
  |  | 60 | ); |
  |  | 61 | $args         = array( |
  |  | 62 | 'method'      => 'POST', |
  |  | 63 | 'body'        => $field\_string, |
  |  | 64 | 'timeout'     => '5', |
  |  | 65 | 'redirection' => '5', |
  |  | 66 | 'httpversion' => '1.0', |
  |  | 67 | 'blocking'    => true, |
  |  | 68 | 'headers'     => $headers, |
  |  | 69 | ); |
  |  | 70 | $response     = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 71 | return $response; |
  |  | 72 | } |
  |  | 73 |  |
  |  | 74 | function papr\_create\_customer() { |
  |  | 75 | $url = get\_option( 'papr\_host\_name' ) . '/moas/rest/customer/add'; |
  |  | 76 |  |
  |  | 77 | $current\_user = wp\_get\_current\_user(); |
  |  | 78 | $this->email  = get\_option( 'papr\_admin\_email' ); |
  |  | 79 | $password     = get\_option( 'papr\_admin\_password' ); |
  |  | 80 |  |
  |  | 81 | $fields       = array( |
  |  | 82 | 'areaOfInterest' => 'WP miniOrange Page Restriction Plugin', |
  |  | 83 | 'email'          => $this->email, |
  |  | 84 | 'password'       => $password, |
  |  | 85 | ); |
  |  | 86 | $field\_string = json\_encode( $fields ); |
  |  | 87 |  |
  |  | 88 | $headers  = array( |
  |  | 89 | 'Content-Type'  => 'application/json', |
  |  | 90 | 'charset'       => 'UTF-8', |
  |  | 91 | 'Authorization' => 'Basic', |
  |  | 92 | ); |
  |  | 93 | $args     = array( |
  |  | 94 | 'method'      => 'POST', |
  |  | 95 | 'body'        => $field\_string, |
  |  | 96 | 'timeout'     => '5', |
  |  | 97 | 'redirection' => '5', |
  |  | 98 | 'httpversion' => '1.0', |
  |  | 99 | 'blocking'    => true, |
  |  | 100 | 'headers'     => $headers, |
  |  | 101 | ); |
  |  | 102 | $response = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 103 | return $response; |
  |  | 104 |  |
  |  | 105 | } |
  |  | 106 |  |
  |  | 107 | function papr\_check\_customer() { |
  |  | 108 | $url   = get\_option( 'papr\_host\_name' ) . '/moas/rest/customer/check-if-exists'; |
  |  | 109 | $email = get\_option( 'papr\_admin\_email' ); |
  |  | 110 |  |
  |  | 111 | $fields       = array( |
  |  | 112 | 'email' => $email, |
  |  | 113 | ); |
  |  | 114 | $field\_string = json\_encode( $fields ); |
  |  | 115 |  |
  |  | 116 | $headers = array( |
  |  | 117 | 'Content-Type'  => 'application/json', |
  |  | 118 | 'charset'       => 'UTF-8', |
  |  | 119 | 'Authorization' => 'Basic', |
  |  | 120 | ); |
  |  | 121 | $args    = array( |
  |  | 122 | 'method'      => 'POST', |
  |  | 123 | 'body'        => $field\_string, |
  |  | 124 | 'timeout'     => '5', |
  |  | 125 | 'redirection' => '5', |
  |  | 126 | 'httpversion' => '1.0', |
  |  | 127 | 'blocking'    => true, |
  |  | 128 | 'headers'     => $headers, |
  |  | 129 | ); |
  |  | 130 |  |
  |  | 131 | $response = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 132 | return $response; |
  |  | 133 | } |
  |  | 134 |  |
  |  | 135 | function papr\_submit\_contact\_us( $email, $phone, $query ) { |
  |  | 136 | $url          = get\_option( 'papr\_host\_name' ) . '/moas/rest/customer/contact-us'; |
  |  | 137 | $current\_user = wp\_get\_current\_user(); |
  |  | 138 | $query        = '[WP Page Restriction Free Plugin] ' . $query; |
  |  | 139 | $fields       = array( |
  |  | 140 | 'firstName' => $current\_user->user\_firstname, |
  |  | 141 | 'lastName'  => $current\_user->user\_lastname, |
  |  | 142 | 'company'   => sanitize\_text\_field( $\_SERVER ['SERVER\_NAME'] ), |
  |  | 143 | 'email'     => $email, |
  |  | 144 | 'ccEmail'   => 'samlsupport@xecurify.com', |
  |  | 145 | 'phone'     => $phone, |
  |  | 146 | 'query'     => $query, |
  |  | 147 | ); |
  |  | 148 | $field\_string = json\_encode( $fields ); |
  |  | 149 |  |
  |  | 150 | $headers  = array( |
  |  | 151 | 'Content-Type'  => 'application/json', |
  |  | 152 | 'charset'       => 'UTF-8', |
  |  | 153 | 'Authorization' => 'Basic', |
  |  | 154 | ); |
  |  | 155 | $args     = array( |
  |  | 156 | 'method'      => 'POST', |
  |  | 157 | 'body'        => $field\_string, |
  |  | 158 | 'timeout'     => '10', |
  |  | 159 | 'redirection' => '5', |
  |  | 160 | 'httpversion' => '1.0', |
  |  | 161 | 'blocking'    => true, |
  |  | 162 | 'headers'     => $headers, |
  |  | 163 | ); |
  |  | 164 | $response = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 165 | return $response; |
  |  | 166 | } |
  |  | 167 |  |
  |  | 168 | function papr\_forgot\_password( $email ) { |
  |  | 169 | $url                 = get\_option( 'papr\_host\_name' ) . '/moas/rest/customer/password-reset'; |
  |  | 170 | $customerKey         = get\_option( 'papr\_admin\_customer\_key' ); |
  |  | 171 | $apiKey              = get\_option( 'papr\_admin\_api\_key' ); |
  |  | 172 | $currentTimeInMillis = round( microtime( true ) \* 1000 ); |
  |  | 173 | $stringToHash        = $customerKey . number\_format( $currentTimeInMillis, 0, '', '' ) . $apiKey; |
  |  | 174 | $hashValue           = hash( 'sha512', $stringToHash ); |
  |  | 175 |  |
  |  | 176 | $fields = ''; |
  |  | 177 | $fields = array( |
  |  | 178 | 'email' => $email, |
  |  | 179 | ); |
  |  | 180 |  |
  |  | 181 | $field\_string = json\_encode( $fields ); |
  |  | 182 | $headers      = array( |
  |  | 183 | 'Content-Type'  => 'application/json', |
  |  | 184 | 'Customer-Key'  => $customerKey, |
  |  | 185 | 'Timestamp'     => $currentTimeInMillis, |
  |  | 186 | 'Authorization' => $hashValue, |
  |  | 187 | ); |
  |  | 188 | $args         = array( |
  |  | 189 | 'method'      => 'POST', |
  |  | 190 | 'body'        => $field\_string, |
  |  | 191 | 'timeout'     => '5', |
  |  | 192 | 'redirection' => '5', |
  |  | 193 | 'httpversion' => '1.0', |
  |  | 194 | 'blocking'    => true, |
  |  | 195 | 'headers'     => $headers, |
  |  | 196 | ); |
  |  | 197 | $response     = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 198 | return $response; |
  |  | 199 | } |
  |  | 200 |  |
  |  | 201 |  |
  |  | 202 | function papr\_send\_email\_alert( $email, $phone, $message ) { |
  |  | 203 |  |
  |  | 204 | $url = get\_option( 'papr\_host\_name' ) . '/moas/api/notify/send'; |
  |  | 205 |  |
  |  | 206 | $customerKey = $this->defaultCustomerKey; |
  |  | 207 | $apiKey      = $this->defaultApiKey; |
  |  | 208 |  |
  |  | 209 | $currentTimeInMillis = round( microtime( true ) \* 1000 ); |
  |  | 210 | $currentTimeInMillis = number\_format( $currentTimeInMillis, 0, '', '' ); |
  |  | 211 | $stringToHash        = $customerKey . $currentTimeInMillis . $apiKey; |
  |  | 212 | $hashValue           = hash( 'sha512', $stringToHash ); |
  |  | 213 | $fromEmail           = 'no-reply@xecurify.com'; |
  |  | 214 | $subject             = 'Feedback: WP Page Restriction Free Plugin'; |
  |  | 215 | $site\_url            = site\_url(); |
  |  | 216 |  |
  |  | 217 | global $user; |
  |  | 218 | $user = wp\_get\_current\_user(); |
  |  | 219 |  |
  |  | 220 | $query = '[WP Page Restriction Free Plugin]: ' . $message; |
  |  | 221 |  |
  |  | 222 | $content = '<div >Hello, <br><br>First Name :' . $user->user\_firstname . '<br><br>Last  Name :' . $user->user\_lastname . '   <br><br>Company :<a href="' . esc\_attr( $\_SERVER['SERVER\_NAME'] ) . '" target="\_blank" >' . esc\_attr( $\_SERVER['SERVER\_NAME'] ) . '</a><br><br>Phone Number :' . $phone . '<br><br>Email :<a href="mailto:' . $email . '" target="\_blank">' . $email . '</a><br><br>Query :' . $query . '</div>'; |
  |  | 223 |  |
  |  | 224 | $fields       = array( |
  |  | 225 | 'customerKey' => $customerKey, |
  |  | 226 | 'sendEmail'   => true, |
  |  | 227 | 'email'       => array( |
  |  | 228 | 'customerKey' => $customerKey, |
  |  | 229 | 'fromEmail'   => $fromEmail, |
  |  | 230 | 'fromName'    => 'Xecurify', |
  |  | 231 | 'toEmail'     => 'info@xecurify.com', |
  |  | 232 | 'toName'      => 'samlsupport@xecurify.com', |
  |  | 233 | 'bccEmail'    => 'samlsupport@xecurify.com', |
  |  | 234 | 'subject'     => $subject, |
  |  | 235 | 'content'     => $content, |
  |  | 236 | ), |
  |  | 237 | ); |
  |  | 238 | $field\_string = json\_encode( $fields ); |
  |  | 239 |  |
  |  | 240 | $headers  = array( |
  |  | 241 | 'Content-Type'  => 'application/json', |
  |  | 242 | 'Customer-Key'  => $customerKey, |
  |  | 243 | 'Timestamp'     => $currentTimeInMillis, |
  |  | 244 | 'Authorization' => $hashValue, |
  |  | 245 | ); |
  |  | 246 | $args     = array( |
  |  | 247 | 'method'      => 'POST', |
  |  | 248 | 'body'        => $field\_string, |
  |  | 249 | 'timeout'     => '5', |
  |  | 250 | 'redirection' => '5', |
  |  | 251 | 'httpversion' => '1.0', |
  |  | 252 | 'blocking'    => true, |
  |  | 253 | 'headers'     => $headers, |
  |  | 254 | ); |
  |  | 255 | $response = $this->papr\_wp\_remote\_post( $url, $args ); |
  |  | 256 | return $response; |
  |  | 257 | } |
  |  | 258 |  |
  |  | 259 | public static function papr\_wp\_remote\_post( $url, $args = array() ) { |
  |  | 260 | $response = wp\_remote\_post( $url, $args ); |
  |  | 261 | if ( ! is\_wp\_error( $response ) ) { |
  | 249 | 262 | return $response['body']; |
  | 250 | 263 | } else { |
  | 251 |  | update\_option(~~'papr\_message', 'Unable to connect to the Internet. Please try again.'~~); |
  | 252 |  | update\_option(~~'papr\_message\_success\_fail','error'~~); |
  |  | 264 | update\_option( 'papr\_message', 'Unable to connect to the Internet. Please try again.' ); |
  |  | 265 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  | 253 | 266 | return null; |
  | 254 | 267 | } |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=2751531#L256) | […](/browser/page-and-post-restriction/trunk/page-restriction-class-customer.php?rev=3034414#L269) |  |
  | 256 | 269 |  |
  | 257 | 270 | } |
  | 258 |  | ~~?>~~ |
* ## [page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php")

  | [r2866879](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php?rev=2866879#L2 "Show revision 2866879 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-constants.php?rev=3034414#L2 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 2 | 2 |  |
  | 3 | 3 | class papr\_custom\_roles\_constants { |
  | 4 |  | public static function papr\_custom\_roles\_constants\_names() { |
  |  | 4 | public static function papr\_custom\_roles\_constants\_names() { |
  | 5 | 5 |  |
  | 6 |  | $papr\_capabilites\_category = array(); |
  |  | 6 | $papr\_capabilites\_category = array(); |
  | 7 | 7 |  |
  | 8 |  | ~~$papr\_capabilites\_category['general']           =~~  'dashicons dashicons-wordpress'; |
  | 9 |  | ~~$papr\_capabilites\_category['post']              =~~  'dashicons dashicons-admin-post'; |
  | 10 |  | ~~$papr\_capabilites\_category['page']              =~~  'dashicons dashicons-admin-page'; |
  | 11 |  | ~~$papr\_capabilites\_category['media']             =~~  'dashicons dashicons-admin-media'; |
  | 12 |  | ~~$papr\_capabilites\_category['taxonomies']        =~~  'dashicons dashicons-tag'; |
  | 13 |  | ~~$papr\_capabilites\_category['appearance']        =~~  'dashicons dashicons-admin-appearance'; |
  | 14 |  | ~~$papr\_capabilites\_category['plugins']           =~~  'dashicons dashicons-admin-plugins'; |
  | 15 |  | ~~$papr\_capabilites\_category['users']             =~~  'dashicons dashicons-admin-users'; |
  | 16 |  | ~~$papr\_capabilites\_category['custom']            =~~  'dashicons dashicons-admin-generic'; |
  | 17 |  | ~~$papr\_capabilites\_category['all']               =~~  'dashicons dashicons-plus'; |
  |  | 8 | $papr\_capabilites\_category['general']    = 'dashicons dashicons-wordpress'; |
  |  | 9 | $papr\_capabilites\_category['post']       = 'dashicons dashicons-admin-post'; |
  |  | 10 | $papr\_capabilites\_category['page']       = 'dashicons dashicons-admin-page'; |
  |  | 11 | $papr\_capabilites\_category['media']      = 'dashicons dashicons-admin-media'; |
  |  | 12 | $papr\_capabilites\_category['taxonomies'] = 'dashicons dashicons-tag'; |
  |  | 13 | $papr\_capabilites\_category['appearance'] = 'dashicons dashicons-admin-appearance'; |
  |  | 14 | $papr\_capabilites\_category['plugins']    = 'dashicons dashicons-admin-plugins'; |
  |  | 15 | $papr\_capabilites\_category['users']      = 'dashicons dashicons-admin-users'; |
  |  | 16 | $papr\_capabilites\_category['custom']     = 'dashicons dashicons-admin-generic'; |
  |  | 17 | $papr\_capabilites\_category['all']        = 'dashicons dashicons-plus'; |
  | 18 | 18 |  |
  | 19 |  | return $papr\_capabilites\_category; |
  | 20 |  | } |
  |  | 19 | return $papr\_capabilites\_category; |
  |  | 20 | } |
  | 21 | 21 |  |
  | 22 |  | public static function papr\_custom\_roles\_capabilities\_constants() { |
  |  | 22 | public static function papr\_custom\_roles\_capabilities\_constants() { |
  | 23 | 23 |  |
  | 24 |  | $papr\_capabilites\_category\_array = array(); |
  |  | 24 | $papr\_capabilites\_category\_array = array(); |
  | 25 | 25 |  |
  | 26 |  | $papr\_capabilites\_category\_array['general'] = array('edit\_dashboard','edit\_files', |
  | 27 |  | 'export','import','manage\_links','manage\_options','moderate\_comments','read', |
  | 28 |  | 'unfiltered\_html','update\_core'); |
  | 29 |  |  |
  | 30 |  | $papr\_capabilites\_category\_array['post'] = array('delete\_others\_posts','delete\_posts', |
  | 31 |  | 'delete\_private\_posts','delete\_published\_posts','edit\_others\_posts','edit\_posts', |
  | 32 |  | 'edit\_private\_posts','edit\_published\_posts','publish\_posts','read\_private\_posts'); |
  | 33 |  |  |
  | 34 |  | $papr\_capabilites\_category\_array['page'] = array('delete\_others\_pages','delete\_pages', |
  | 35 |  | 'delete\_private\_pages','delete\_published\_pages','edit\_others\_pages','edit\_pages', |
  | 36 |  | 'edit\_private\_pages','edit\_published\_pages','publish\_pages','read\_private\_pages'); |
  |  | 26 | $papr\_capabilites\_category\_array['general'] = array( |
  |  | 27 | 'edit\_dashboard', |
  |  | 28 | 'edit\_files', |
  |  | 29 | 'export', |
  |  | 30 | 'import', |
  |  | 31 | 'manage\_links', |
  |  | 32 | 'manage\_options', |
  |  | 33 | 'moderate\_comments', |
  |  | 34 | 'read', |
  |  | 35 | 'unfiltered\_html', |
  |  | 36 | 'update\_core', |
  |  | 37 | ); |
  | 37 | 38 |  |
  | 38 |  | $papr\_capabilites\_category\_array['media'] = array('upload\_files','unfiltered\_upload'); |
  |  | 39 | $papr\_capabilites\_category\_array['post'] = array( |
  |  | 40 | 'delete\_others\_posts', |
  |  | 41 | 'delete\_posts', |
  |  | 42 | 'delete\_private\_posts', |
  |  | 43 | 'delete\_published\_posts', |
  |  | 44 | 'edit\_others\_posts', |
  |  | 45 | 'edit\_posts', |
  |  | 46 | 'edit\_private\_posts', |
  |  | 47 | 'edit\_published\_posts', |
  |  | 48 | 'publish\_posts', |
  |  | 49 | 'read\_private\_posts', |
  |  | 50 | ); |
  | 39 | 51 |  |
  | 40 |  | $papr\_capabilites\_category\_array['taxonomies'] = array('manage\_categories'); |
  |  | 52 | $papr\_capabilites\_category\_array['page'] = array( |
  |  | 53 | 'delete\_others\_pages', |
  |  | 54 | 'delete\_pages', |
  |  | 55 | 'delete\_private\_pages', |
  |  | 56 | 'delete\_published\_pages', |
  |  | 57 | 'edit\_others\_pages', |
  |  | 58 | 'edit\_pages', |
  |  | 59 | 'edit\_private\_pages', |
  |  | 60 | 'edit\_published\_pages', |
  |  | 61 | 'publish\_pages', |
  |  | 62 | 'read\_private\_pages', |
  |  | 63 | ); |
  | 41 | 64 |  |
  | 42 |  | $papr\_capabilites\_category\_array['appearance'] = array('delete\_themes', |
  | 43 |  | 'edit\_theme\_options','edit\_themes','install\_themes','switch\_themes','update\_themes'); |
  |  | 65 | $papr\_capabilites\_category\_array['media'] = array( 'upload\_files', 'unfiltered\_upload' ); |
  | 44 | 66 |  |
  | 45 |  | $papr\_capabilites\_category\_array['plugins'] = array('activate\_plugins','delete\_plugins', |
  | 46 |  | 'edit\_plugins','install\_plugins','update\_plugins'); |
  |  | 67 | $papr\_capabilites\_category\_array['taxonomies'] = array( 'manage\_categories' ); |
  | 47 | 68 |  |
  | 48 |  | $papr\_capabilites\_category\_array['users'] = array('create\_roles','create\_users', |
  | 49 |  | 'delete\_roles','delete\_users','edit\_roles','edit\_users','list\_roles','list\_users', |
  | 50 |  | 'promote\_users','remove\_users'); |
  |  | 69 | $papr\_capabilites\_category\_array['appearance'] = array( |
  |  | 70 | 'delete\_themes', |
  |  | 71 | 'edit\_theme\_options', |
  |  | 72 | 'edit\_themes', |
  |  | 73 | 'install\_themes', |
  |  | 74 | 'switch\_themes', |
  |  | 75 | 'update\_themes', |
  |  | 76 | ); |
  | 51 | 77 |  |
  | 52 |  | $papr\_capabilites\_category\_array['custom'] = array('restrict\_content'); |
  |  | 78 | $papr\_capabilites\_category\_array['plugins'] = array( |
  |  | 79 | 'activate\_plugins', |
  |  | 80 | 'delete\_plugins', |
  |  | 81 | 'edit\_plugins', |
  |  | 82 | 'install\_plugins', |
  |  | 83 | 'update\_plugins', |
  |  | 84 | ); |
  | 53 | 85 |  |
  | 54 |  | return $papr\_capabilites\_category\_array; |
  | 55 |  | } |
  |  | 86 | $papr\_capabilites\_category\_array['users'] = array( |
  |  | 87 | 'create\_roles', |
  |  | 88 | 'create\_users', |
  |  | 89 | 'delete\_roles', |
  |  | 90 | 'delete\_users', |
  |  | 91 | 'edit\_roles', |
  |  | 92 | 'edit\_users', |
  |  | 93 | 'list\_roles', |
  |  | 94 | 'list\_users', |
  |  | 95 | 'promote\_users', |
  |  | 96 | 'remove\_users', |
  |  | 97 | ); |
  |  | 98 |  |
  |  | 99 | $papr\_capabilites\_category\_array['custom'] = array( 'restrict\_content' ); |
  |  | 100 |  |
  |  | 101 | return $papr\_capabilites\_category\_array; |
  |  | 102 | } |
  | 56 | 103 | } |
  | 57 |  | ?> |
  |  | 104 |  |
* ## [page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php?rev=2829798#L1 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles-sub-menu.php?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | require\_once~~('page-restriction-menu-settings.php')~~; |
  | 4 |  | ~~includ~~e\_once 'page-restriction-utility.php'; |
  |  | 3 | require\_once 'page-restriction-menu-settings.php'; |
  |  | 4 | require\_once 'page-restriction-utility.php'; |
  | 5 | 5 |  |
  | 6 |  | function papr\_custom\_roles\_sub\_menu() |
  | 7 |  | { |
  | 8 |  | global $wp\_roles; |
  | 9 |  | $papr\_custom\_roles = $wp\_roles->roles; |
  |  | 6 | function papr\_custom\_roles\_sub\_menu() { |
  |  | 7 | global $wp\_roles; |
  |  | 8 | $papr\_custom\_roles = $wp\_roles->roles; |
  | 10 | 9 |  |
  | 11 |  | ~~$current\_tab = ""~~; |
  | 12 |  | ~~if (array\_key\_exists('tab', $\_GET)~~) { |
  | 13 |  | ~~$current\_tab = sanitize\_text\_field( $\_GET['tab']~~); |
  | 14 |  | } ?> |
  | 15 |  | ~~<?php papr\_custom\_roles\_nav\_tab($current\_tab~~); ?> |
  | 16 |  | <div class="papr-bg-main papr-margin-left"> |
  | 17 |  | <div class="d-flex"> |
  | 18 |  | <div class="col-md-9"> |
  | 19 |  | <?php |
  | 20 |  | papr\_message\_success\_fail(); |
  | 21 |  | ~~switch ($current\_tab~~) { |
  | 22 |  | case 'create\_role': |
  | 23 |  | ~~if(array\_key\_exists('clone', $\_GET))~~{ |
  | 24 |  | ~~$current\_edit\_role = sanitize\_text\_field($\_GET['clone']~~); |
  | 25 |  | ~~papr\_custom\_roles::create\_clone\_roles($current\_edit\_role,$papr\_custom\_roles~~); |
  | 26 |  | } else { |
  | 27 |  | ~~papr\_custom\_roles::create\_edit\_roles('',$papr\_custom\_roles~~); |
  | 28 |  | } |
  | 29 |  | break; |
  |  | 10 | $current\_tab = ''; |
  |  | 11 | if ( array\_key\_exists( 'tab', $\_GET ) ) { |
  |  | 12 | $current\_tab = sanitize\_text\_field( $\_GET['tab'] ); |
  |  | 13 | } ?> |
  |  | 14 | <?php papr\_custom\_roles\_nav\_tab( $current\_tab ); ?> |
  |  | 15 | <div class="papr-bg-main papr-margin-left"> |
  |  | 16 | <div class="d-flex"> |
  |  | 17 | <div class="col-md-9"> |
  |  | 18 | <?php |
  |  | 19 | papr\_message\_success\_fail(); |
  |  | 20 | switch ( $current\_tab ) { |
  |  | 21 | case 'create\_role': |
  |  | 22 | if ( array\_key\_exists( 'clone', $\_GET ) ) { |
  |  | 23 | $current\_edit\_role = sanitize\_text\_field( $\_GET['clone'] ); |
  |  | 24 | papr\_custom\_roles::create\_clone\_roles( $current\_edit\_role, $papr\_custom\_roles ); |
  |  | 25 | } else { |
  |  | 26 | papr\_custom\_roles::create\_edit\_roles( '', $papr\_custom\_roles ); |
  |  | 27 | } |
  |  | 28 | break; |
  | 30 | 29 |  |
  | 31 |  | default: |
  | 32 |  | if (array\_key\_exists('current\_edit\_role', $\_GET)) { |
  | 33 |  | $current\_edit\_role = sanitize\_text\_field($\_GET['current\_edit\_role']); |
  | 34 |  | if(empty($papr\_custom\_roles[$current\_edit\_role])){ |
  | 35 |  | papr\_custom\_roles::edit\_delete\_roles(); |
  | 36 |  | } else { |
  | 37 |  | papr\_custom\_roles::create\_edit\_roles($current\_edit\_role,$papr\_custom\_roles); |
  | 38 |  | } |
  | 39 |  | } |
  | 40 |  | else { |
  | 41 |  | papr\_custom\_roles::edit\_delete\_roles(); |
  | 42 |  | } |
  | 43 |  | break; |
  | 44 |  | } |
  | 45 |  | ?> |
  | 46 |  | </div> |
  | 47 |  | <div class="col-md-3 papr\_support\_col ps-0 pe-0"> |
  | 48 |  | <?php papr\_support\_page\_restriction(); ?> |
  | 49 |  | </div> |
  | 50 |  | </div> |
  |  | 30 | default: |
  |  | 31 | if ( array\_key\_exists( 'current\_edit\_role', $\_GET ) ) { |
  |  | 32 | $current\_edit\_role = sanitize\_text\_field( $\_GET['current\_edit\_role'] ); |
  |  | 33 | if ( empty( $papr\_custom\_roles[ $current\_edit\_role ] ) ) { |
  |  | 34 | papr\_custom\_roles::edit\_delete\_roles(); |
  |  | 35 | } else { |
  |  | 36 | papr\_custom\_roles::create\_edit\_roles( $current\_edit\_role, $papr\_custom\_roles ); |
  |  | 37 | } |
  |  | 38 | } else { |
  |  | 39 | papr\_custom\_roles::edit\_delete\_roles(); |
  |  | 40 | } |
  |  | 41 | break; |
  |  | 42 | } |
  |  | 43 | ?> |
  |  | 44 | </div> |
  |  | 45 | <div class="col-md-3 papr\_support\_col ps-0 pe-0"> |
  |  | 46 | <?php papr\_support\_page\_restriction(); ?> |
  |  | 47 | </div> |
  |  | 48 | </div> |
  | 51 | 49 |  |
  | 52 |  | <div class="row"> |
  | 53 |  | </div> |
  | 54 |  | </div> |
  | 55 |  | <?php |
  |  | 50 | <div class="row"> |
  |  | 51 | </div> |
  |  | 52 | </div> |
  |  | 53 | <?php |
  | 56 | 54 | } |
  | 57 | 55 |  |
  | 58 |  | function papr\_custom\_roles\_nav\_tab($current\_tab) |
  | 59 |  | { |
  | 60 |  | ?> |
  | 61 |  | <div class="papr-bg-main papr-margin-left"> |
  | 62 |  | <div class="wrap shadow-cstm p-3 me-0 mt-0 mo-saml-margin-left bg-white" id="nav-market"> |
  | 63 |  | <div class="row align-items-center"> |
  | 64 |  | <div class="col-md-5 h3 ps-3 d-flex align-items-center"> |
  | 65 |  | <img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/miniorange-logo.png" alt="" width="50px" class="me-2"> |
  | 66 |  | <span>Page and Post Restriction</span> |
  | 67 |  | </div> |
  | 68 |  | <div class="col-md-3 text-center"> |
  | 69 |  | <a id="license\_upgrade" class="text-white ps-4 pe-4 pt-2 pb-2 papr-prem-btn" href="admin.php?page=page\_restriction&tab=premium\_plan">Premium Plans | Upgrade Now</a> |
  | 70 |  | </div> |
  | 71 |  | <div class="col-md-4 d-flex align-items-center justify-content-end"> |
  | 72 |  | <a class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://faq.miniorange.com/kb/saml-single-sign-on/">FAQs</a> |
  | 73 |  | <a class="text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://plugins.miniorange.com/wordpress-page-restriction">Know More</a> |
  | 74 |  | </div> |
  | 75 |  | </div> |
  | 76 |  | </div> |
  | 77 |  | <div class="nav-tab-wrapper papr-bg-main" id="nav-role"> |
  | 78 |  | <a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, '')); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu">Roles |
  | 79 |  | </a> |
  | 80 |  | <a class="nav-tab papr-nav-tab ms-3 <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'create\_role')); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role"> Add New Role |
  | 81 |  | </a> |
  | 82 |  | </div> |
  | 83 |  | </div> |
  | 84 |  | <?php |
  |  | 56 | function papr\_custom\_roles\_nav\_tab( $current\_tab ) { |
  |  | 57 | ?> |
  |  | 58 | <div class="papr-bg-main papr-margin-left"> |
  |  | 59 | <div class="wrap shadow-cstm p-3 me-0 mt-0 mo-saml-margin-left bg-white" id="nav-market"> |
  |  | 60 | <div class="row align-items-center"> |
  |  | 61 | <div class="col-md-5 h3 ps-3 d-flex align-items-center"> |
  |  | 62 | <img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/miniorange-logo.png" alt="" width="50px" class="me-2"> |
  |  | 63 | <span>Page and Post Restriction</span> |
  |  | 64 | </div> |
  |  | 65 | <div class="col-md-3 text-center"> |
  |  | 66 | <a id="license\_upgrade" class="text-white ps-4 pe-4 pt-2 pb-2 papr-prem-btn" href="admin.php?page=page\_restriction&tab=premium\_plan">Premium Plans | Upgrade Now</a> |
  |  | 67 | </div> |
  |  | 68 | <div class="col-md-4 d-flex align-items-center justify-content-end"> |
  |  | 69 | <a class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://faq.miniorange.com/kb/saml-single-sign-on/">FAQs</a> |
  |  | 70 | <a class="text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://plugins.miniorange.com/wordpress-page-restriction">Know More</a> |
  |  | 71 | </div> |
  |  | 72 | </div> |
  |  | 73 | </div> |
  |  | 74 | <div class="nav-tab-wrapper papr-bg-main" id="nav-role"> |
  |  | 75 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, '' ) ); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu">Roles |
  |  | 76 | </a> |
  |  | 77 | <a class="nav-tab papr-nav-tab ms-3 <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'create\_role' ) ); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role"> Add New Role |
  |  | 78 | </a> |
  |  | 79 | </div> |
  |  | 80 | </div> |
  |  | 81 | <?php |
  | 85 | 82 | } |
  | 86 | 83 |  |
* ## [page-and-post-restriction/trunk/page-restriction-custom-roles.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-custom-roles.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-custom-roles.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles.php?rev=2829798#L4 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-custom-roles.php?rev=3034414#L4 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | require\_once 'page-restriction-save.php'; |
  | 5 | 5 | require\_once 'page-restriction-custom-roles-constants.php'; |
  | 6 |  | ~~includ~~e\_once 'page-restriction-utility.php'; |
  | 7 |  |  |
  | 8 |  | class papr\_custom\_roles { |
  | 9 |  |  |
  | 10 |  | ~~public static function create\_edit\_roles($current\_edit\_role,$papr\_custom\_roles~~) { |
  | 11 |  | $papr\_current\_role\_capabilty = array(); |
  | 12 |  | ~~$disabled~~ = ''; |
  | 13 |  |  |
  | 14 |  | ~~if(!empty($papr\_custom\_roles[$current\_edit\_role]))~~{ |
  | 15 |  | ~~$papr\_current\_role\_capabilty = $papr\_custom\_roles[$current\_edit\_role~~]['capabilities']; |
  | 16 |  | ~~$disabled~~ = 'readonly'; |
  | 17 |  | } |
  | 18 |  |  |
  | 19 |  | ~~papr\_custom\_roles::roles\_form($current\_edit\_role, $papr\_current\_role\_capabilty, $disabled~~); |
  | 20 |  | } |
  | 21 |  |  |
  | 22 |  | ~~public static function create\_clone\_roles($current\_edit\_role,$papr\_custom\_roles~~) { |
  | 23 |  | $papr\_current\_role\_capabilty = array(); |
  | 24 |  | ~~$disabled~~ = ''; |
  | 25 |  |  |
  | 26 |  | ~~if ($current\_edit\_role!=''~~) { |
  | 27 |  | ~~if(substr($current\_edit\_role, -6)=='\_clone')~~{ |
  | 28 |  | ~~$current\_edit\_role\_pre\_clone = substr($current\_edit\_role, 0, -6~~); |
  | 29 |  | ~~if(!empty($papr\_custom\_roles[$current\_edit\_role\_pre\_clone]))~~{ |
  | 30 |  | ~~$papr\_current\_role\_capabilty = $papr\_custom\_roles[$current\_edit\_role\_pre\_clone~~]['capabilities']; |
  | 31 |  | } |
  | 32 |  | } |
  | 33 |  | } |
  | 34 |  |  |
  | 35 |  | ~~papr\_custom\_roles::roles\_form($current\_edit\_role, $papr\_current\_role\_capabilty, $disabled~~); |
  | 36 |  | } |
  | 37 |  |  |
  | 38 |  | ~~public static function roles\_form($current\_edit\_role, $papr\_current\_role\_capabilty, $disabled)~~{ |
  | 39 |  | ?> |
  | 40 |  | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  | 41 |  | <div class="row"> |
  | 42 |  | <div class="col-md-12"> |
  | 43 |  | <h4> |
  | 44 |  | <?php |
  | 45 |  | ~~if($disabled == '')~~{ |
  | 46 |  | echo 'Add new role and define it\'s capabilities'; |
  | 47 |  | } else { |
  | 48 |  | echo 'Edit role and it\'s capabilities'; |
  | 49 |  | } |
  | 50 |  | ?> |
  | 51 |  | </h4> |
  | 52 |  | </div> |
  | 53 |  | </div> |
  | 54 |  | <div class="form-head"></div> |
  | 55 |  | <?php |
  | 56 |  | ~~papr\_custom\_roles~~::clone\_roles\_form(); |
  | 57 |  | ?> |
  | 58 |  | <h5 class="papr-form-head papr-form-head-bar mt-5"> |
  | 59 |  |  |
  | 60 |  | <?php |
  | 61 |  | ~~if($disabled == '')~~{ |
  | 62 |  | echo 'Add New Roles'; |
  | 63 |  | } else { |
  | 64 |  | ~~echo 'Edit Roles : <b style="color:#00008B;">'.$current\_edit\_role.~~'</b>'; |
  | 65 |  | } |
  | 66 |  |  |
  | 67 |  | ~~if($disabled == '')~~{ |
  | 68 |  | ?> |
  | 69 |  | <div class="papr-info-global ms-2"> |
  | 70 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 71 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 72 |  | </svg> |
  | 73 |  | <p class="papr-info-text-global"> |
  | 74 |  | Just turn on check boxes of capabilities you wish to add to the new role you are creating and then click <b style="color:red">Save Configuration</b> button to save your changes. |
  | 75 |  | </p> |
  | 76 |  | </div> |
  | 77 |  | <?php |
  | 78 |  | } |
  | 79 |  | ?> |
  | 80 |  | </h5> |
  | 81 |  | <?php |
  | 82 |  | ~~if($disabled == '')~~{ |
  | 83 |  | ~~$form\_name = "papr\_custom\_create\_roles"~~; |
  | 84 |  | } else { |
  | 85 |  | ~~$form\_name = "papr\_custom\_edit\_roles"~~; |
  | 86 |  | } |
  | 87 |  | $button\_value = 'Save Configuration'; |
  | 88 |  | global $wp\_roles; |
  | 89 |  | ~~$roles~~ = $wp\_roles->roles; |
  | 90 |  | $roles\_with\_name = array(); |
  | 91 |  | ~~foreach($roles as $key=>$value)~~{ |
  | 92 |  | ~~array\_push($roles\_with\_name, $key~~); |
  | 93 |  | } |
  | 94 |  | ~~$parsed\_roles = json\_encode($roles\_with\_name~~); |
  | 95 |  | ?> |
  | 96 |  | ~~<input type="hidden" name="option" id="roles\_valid\_hidden\_input" value='<?php echo esc\_attr($parsed\_roles~~); ?>'> |
  | 97 |  | ~~<form id="<?php echo esc\_attr($form\_name); ?>" name="<?php echo esc\_attr($form\_name~~); ?>" method="post" action=""> |
  | 98 |  | ~~<input type="hidden" name="option" value="<?php echo esc\_attr($form\_name~~); ?>"> |
  | 99 |  | <?php |
  | 100 |  | ~~wp\_nonce\_field($form\_name~~); |
  | 101 |  | ~~$role\_button\_disable = ""~~; |
  | 102 |  | ~~if($disabled == ''~~) { |
  | 103 |  | ?> |
  | 104 |  | ~~<input required type="text" name="custom\_role\_name" id="custom\_role\_name" value="<?php echo esc\_attr($current\_edit\_role);~~?>" |
  | 105 |  | onkeyup="validate\_role\_name();" |
  | 106 |  | style="width: 270px; margin-bottom:5px;" placeholder="Enter Role Name"> |
  | 107 |  | <?php |
  | 108 |  |  |
  | 109 |  | ~~if(!empty($roles[$current\_edit\_role])~~) { |
  | 110 |  | ?> |
  | 111 |  | <p id="role\_name\_error" style="color:red">This role name already exist</p> |
  | 112 |  | <?php |
  | 113 |  | ~~$role\_button\_disable = "disabled"~~; |
  | 114 |  | } else { |
  | 115 |  | ?> |
  | 116 |  | <p id="role\_name\_error" style="color:red"></p> |
  | 117 |  | <?php |
  | 118 |  | } |
  | 119 |  | } else { |
  | 120 |  | ?> |
  | 121 |  | ~~<input type="hidden" name="custom\_role\_name" id="custom\_role\_name" value="<?php echo esc\_attr($current\_edit\_role);~~?>"> |
  | 122 |  | <?php |
  | 123 |  | } |
  | 124 |  | ?> |
  | 125 |  | <br> |
  | 126 |  | <b>Note : </b>Please Select the Capabilites you want to assign to the Role before you Save and add/edit the role. |
  | 127 |  | </br></br> |
  | 128 |  | ~~<input type='submit' value="<?php echo esc\_attr($button\_value); ?>" class="papr-btn-cstm-role-create role\_submit\_button" style="border-radius: 2.25rem;" <?php echo esc\_attr($role\_button\_disable~~); ?>> |
  | 129 |  | <div> |
  | 130 |  | </br></br> |
  | 131 |  | <div class="flex-container-custom-role"> |
  | 132 |  | <div class="display\_custom\_role\_nav"> |
  | 133 |  | <?php |
  | 134 |  | ~~papr\_custom\_roles~~::display\_custom\_role\_nav(); |
  | 135 |  | ?> |
  | 136 |  | </div> |
  | 137 |  |  |
  | 138 |  | <div id="capability-table" class="display\_custom\_role\_table\_edit"> |
  | 139 |  | <?php |
  | 140 |  | ~~papr\_custom\_roles::display\_custom\_role\_table\_edit($papr\_current\_role\_capabilty,$current\_edit\_role~~); |
  | 141 |  | ?> |
  | 142 |  | </div> |
  | 143 |  | </div> |
  | 144 |  | </br> |
  | 145 |  | </div> |
  | 146 |  | ~~<input type='submit' value="<?php echo esc\_attr($button\_value); ?>" class="papr-btn-cstm-role-create role\_submit\_button" style="border-radius: 2.25rem;" <?php echo esc\_attr($role\_button\_disable~~); ?>> |
  | 147 |  | </form> |
  | 148 |  | </div> |
  | 149 |  | </br> |
  | 150 |  | <script> |
  | 151 |  | var roles\_array = document.getElementById('roles\_valid\_hidden\_input').value; |
  | 152 |  | text = roles\_array.slice(1, -1); |
  | 153 |  | var roles\_array = text.split(","); |
  | 154 |  | for (var i = 0; i < roles\_array.length; i++) { |
  | 155 |  | roles\_array[i] = roles\_array[i].slice(1, -1); |
  | 156 |  | } |
  | 157 |  |  |
  | 158 |  | function validate\_role\_name(){ |
  | 159 |  | var format = /[!@#$%^&\*()+\-=\[\]{};':"\\|,.<>\/?]+/; |
  | 160 |  | var role\_name = document.getElementById('custom\_role\_name').value; |
  | 161 |  | let index = roles\_array.indexOf(role\_name); |
  | 162 |  | if(index != -1) { |
  | 163 |  | document.getElementById("role\_name\_error").innerHTML = "This role name already exist"; |
  | 164 |  | document.getElementsByClassName("role\_submit\_button")[0].disabled = true; |
  | 165 |  | document.getElementsByClassName("role\_submit\_button")[1].disabled = true; |
  | 166 |  | } else if(format.test(role\_name)){ |
  | 167 |  | document.getElementById("role\_name\_error").innerHTML = "Special characters in the role name not allowed."; |
  | 168 |  | document.getElementsByClassName("role\_submit\_button")[0].disabled = true; |
  | 169 |  | document.getElementsByClassName("role\_submit\_button")[1].disabled = true; |
  | 170 |  | } else { |
  | 171 |  | document.getElementById("role\_name\_error").innerHTML = " "; |
  | 172 |  | document.getElementsByClassName("role\_submit\_button")[0].disabled = false; |
  | 173 |  | document.getElementsByClassName("role\_submit\_button")[1].disabled = false; |
  | 174 |  | } |
  | 175 |  | } |
  | 176 |  | </script> |
  | 177 |  | <?php |
  | 178 |  | } |
  | 179 |  |  |
  | 180 |  | ~~public static function display\_custom\_role\_nav()~~{ |
  | 181 |  | ?> |
  | 182 |  |  |
  | 183 |  | <ul class="papr-tab-nav"> |
  | 184 |  | <?php |
  | 185 |  | $papr\_capabilites\_category = papr\_custom\_roles\_constants::papr\_custom\_roles\_constants\_names(); |
  | 186 |  | ~~foreach($papr\_capabilites\_category as $key=>$value)~~{ |
  | 187 |  | ?> |
  | 188 |  | <li class="papr-tab-title"> |
  | 189 |  | <?php |
  | 190 |  | ~~$key\_js\_function  = "papr-tab-".~~$key; |
  | 191 |  | ~~$key\_up = str\_replace('\_', ' ', $key~~); |
  | 192 |  | ~~$key\_up = ucwords($key\_up~~); |
  | 193 |  |  |
  | 194 |  | ~~if($key != 'all'~~) { |
  | 195 |  | $background\_color = '#fff'; |
  | 196 |  | ~~if($key=='general'~~) { |
  | 197 |  | $background\_color = '#f1f6ff'; |
  | 198 |  | } |
  | 199 |  | ?> |
  | 200 |  | ~~<a onclick="hide\_function('<?php echo esc\_js($key\_js\_function~~); ?>');" class="roles\_buttons"> |
  | 201 |  | ~~<div class="div\_button" id="<?php echo esc\_attr($key\_js\_function~~); ?>\_button" style="width:170px;height:40px; padding-left:10px; padding-top:5px; background-color:<?php echo $background\_color; ?>;"> |
  | 202 |  | ~~<i style="vertical-align:middle !important;" class="<?php echo esc\_attr($value~~); ?>"></i> |
  | 203 |  | ~~<span class="label"><?php echo esc\_html($key\_up~~); ?></span> |
  | 204 |  | </div> |
  | 205 |  | </a> |
  | 206 |  | <?php |
  | 207 |  | } else { |
  | 208 |  | ?> |
  | 209 |  | <a onclick="show\_all\_function();" class="roles\_buttons" > |
  | 210 |  | ~~<div class="div\_button" id="<?php echo esc\_attr($key\_js\_function~~); ?>\_button" style="width:170px;height:40px; padding-left:10px; padding-top:5px; background-color:#fff;"> |
  | 211 |  | ~~<i style="vertical-align:middle !important;" class="<?php echo esc\_attr($value~~); ?>"></i> |
  | 212 |  | ~~<span class="label"><?php echo esc\_html($key\_up~~); ?></span> |
  | 213 |  | </div> |
  | 214 |  | </a> |
  | 215 |  | <?php |
  | 216 |  | } |
  | 217 |  | ?> |
  | 218 |  | </li> |
  | 219 |  | <?php |
  | 220 |  | } |
  | 221 |  | ?> |
  | 222 |  | </ul> |
  | 223 |  | <script> |
  | 224 |  | function hide\_function(id) { |
  | 225 |  | var divs = document.getElementsByClassName('hide-category-div'); |
  | 226 |  | var i; |
  | 227 |  | for (i = 0; i < divs.length; i++) { |
  | 228 |  | divs[i].style.display = 'none'; |
  | 229 |  | } |
  | 230 |  |  |
  | 231 |  | var divid = document.getElementsByClassName(id); |
  | 232 |  | var i; |
  | 233 |  | for (i = 0; i < divid.length; i++) { |
  | 234 |  | divid[i].style.display = ''; |
  | 235 |  | } |
  | 236 |  |  |
  | 237 |  | var div\_button = document.getElementsByClassName('div\_button'); |
  | 238 |  | var i; |
  | 239 |  | for (i = 0; i < div\_button.length; i++) { |
  | 240 |  | div\_button[i].style.backgroundColor = '#fff'; |
  | 241 |  | } |
  | 242 |  |  |
  | 243 |  | var id\_button = id + '\_button'; |
  | 244 |  | document.getElementById(id\_button).style.backgroundColor = '#f1f6ff'; |
  | 245 |  | } |
  | 246 |  |  |
  | 247 |  | function show\_all\_function() { |
  | 248 |  | var divs = document.getElementsByClassName('hide-category-div'); |
  | 249 |  | var i; |
  | 250 |  | for (i = 0; i < divs.length; i++) { |
  | 251 |  | divs[i].style.display = ''; |
  | 252 |  | } |
  | 253 |  |  |
  | 254 |  | var div\_button = document.getElementsByClassName('div\_button'); |
  | 255 |  | var i; |
  | 256 |  | for (i = 0; i < div\_button.length; i++) { |
  | 257 |  | div\_button[i].style.backgroundColor = '#fff'; |
  | 258 |  | } |
  | 259 |  |  |
  | 260 |  | var id\_button = 'papr-tab-all\_button'; |
  | 261 |  | document.getElementById(id\_button).style.backgroundColor = "#f1f6ff"; |
  | 262 |  | } |
  | 263 |  | </script> |
  | 264 |  | <?php |
  | 265 |  | } |
  | 266 |  |  |
  | 267 |  | ~~public static function display\_custom\_role\_table\_edit($papr\_current\_role\_capabilty,$current\_edit\_role)~~{ |
  | 268 |  | ?> |
  | 269 |  | <table class="role\_table\_width"> |
  | 270 |  | <tr style="display:; border-bottom:1px solid lightblue; height:40px;"> |
  | 271 |  | <td style="width:30rem !important;"><b>Capability</b></td> |
  | 272 |  | <td style="width:5rem !important; text-align:center;"><b>Grant</b></td> |
  | 273 |  | </tr> |
  | 274 |  |  |
  | 275 |  | <?php |
  | 276 |  | $papr\_capabilites\_category\_array = papr\_custom\_roles\_constants::papr\_custom\_roles\_capabilities\_constants(); |
  | 277 |  |  |
  | 278 |  | ~~foreach($papr\_capabilites\_category\_array as $group\_name=>$capability)~~{ |
  | 279 |  | ~~if($group\_name=='general')~~{ |
  | 280 |  | $display = 'display:;'; |
  | 281 |  | } else { |
  | 282 |  | $display = 'display:none;'; |
  | 283 |  | } |
  | 284 |  | ~~$papr\_capabilites\_category\_array\_name = $papr\_capabilites\_category\_array[$group\_name~~]; |
  | 285 |  | ~~foreach($papr\_capabilites\_category\_array\_name as $key)~~{ |
  | 286 |  | ~~$capability\_name = str\_replace('\_', ' ', $key~~); |
  | 287 |  | ~~$grant\_checked~~ = ''; |
  | 288 |  | ~~if(!empty($papr\_current\_role\_capabilty[$key]))~~{ |
  | 289 |  | ~~if($papr\_current\_role\_capabilty[$key]==1)~~{ |
  | 290 |  | $grant\_checked = 'checked'; |
  | 291 |  | } |
  | 292 |  | } |
  | 293 |  |  |
  | 294 |  | ~~if($key=='read' && $current\_edit\_role=='')~~{ |
  | 295 |  | $grant\_checked = 'checked'; |
  | 296 |  | } |
  | 297 |  |  |
  | 298 |  | ?> |
  | 299 |  | ~~<tr class="hide-category-div papr-tab-<?php echo esc\_attr($group\_name); ?>" style="<?php echo esc\_attr($display~~); ?> border-bottom:0.01rem solid lightblue; height:40px;"> |
  | 300 |  | ~~<td style="width:30rem !important;"><?php echo esc\_html(ucwords($capability\_name)~~); ?></td> |
  | 301 |  | ~~<td style="width:5rem !important; text-align:center;"><input type="checkbox" name="<?php echo esc\_attr($key)?>" id="<?php echo esc\_attr($key)?>" <?php echo esc\_attr($grant\_checked);~~?>/></td> |
  | 302 |  | </tr> |
  | 303 |  | <?php |
  | 304 |  | } |
  | 305 |  | } |
  | 306 |  | ?> |
  | 307 |  |  |
  | 308 |  | <tr style="height:40px;"> |
  | 309 |  | <td style="width:30rem !important;"><b>Capability</b></td> |
  | 310 |  | <td style="width:5rem !important; text-align:center;"><b>Grant</b></td> |
  | 311 |  | </tr> |
  | 312 |  |  |
  | 313 |  | </table> |
  | 314 |  | <?php |
  | 315 |  | } |
  | 316 |  |  |
  | 317 |  | public static function edit\_delete\_roles() { |
  | 318 |  | global $wp\_roles; |
  | 319 |  | ~~$roles~~ = $wp\_roles->roles; |
  | 320 |  | ~~$total\_roles = count($roles~~); |
  | 321 |  | ~~$roles\_per\_page = get\_option('papr\_roles\_per\_page'~~); |
  | 322 |  | ~~$roles\_per\_page~~ = $roles\_per\_page != '' ? $roles\_per\_page : 10; |
  | 323 |  | ~~$number\_of\_pages\_in\_pagination = ceil($total\_roles / $roles\_per\_page);~~; |
  | 324 |  |  |
  | 325 |  | ~~$current\_page = papr\_get\_current\_page($number\_of\_pages\_in\_pagination~~); |
  | 326 |  | ~~$link = get\_admin\_url().~~'admin.php?page=papr\_custom\_roles\_sub\_menu&curr='; |
  | 327 |  | ~~$offset = ($current\_page - 1~~) \* $roles\_per\_page; |
  | 328 |  | ~~$paginated\_roles = array\_slice($roles, $offset, $roles\_per\_page~~); |
  | 329 |  | ?> |
  | 330 |  |  |
  | 331 |  | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  | 332 |  | <div class="row"> |
  | 333 |  | <div class="col-md-6"> |
  | 334 |  | <h4>Edit or Delete Custom Roles</h4> |
  | 335 |  | </div> |
  | 336 |  | <div class="col-md-6 text-end"> |
  | 337 |  | <a href="admin.php?page=page\_restriction" class="papr-btn-cstm rounded"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16"> |
  | 338 |  | <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z" /> |
  | 339 |  | </svg>&nbsp; Back to Restriction Settings |
  | 340 |  | </a> |
  | 341 |  | </div> |
  | 342 |  | </div> |
  | 343 |  | <div class="form-head"></div> |
  | 344 |  | </br> |
  | 345 |  | <div class=""> |
  | 346 |  | <?php |
  | 347 |  | ~~papr\_custom\_roles::roles\_result\_per\_page($roles\_per\_page~~); |
  | 348 |  | ?> |
  | 349 |  | <div style="text-align: right;"> |
  | 350 |  | ~~<?php papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_roles, $current\_page, $link, 'top'~~); ?> |
  | 351 |  | </div> |
  | 352 |  | </div> |
  | 353 |  | </br> |
  | 354 |  |  |
  | 355 |  | <form id="papr\_delete\_custom\_roles" name="papr\_delete\_custom\_roles" method="post" action=""> |
  | 356 |  | <input type="hidden" name="option" value="papr\_delete\_custom\_roles"> |
  | 357 |  | <input type="hidden" name="role\_delete" id="role\_delete" value=""> |
  | 358 |  | ~~<?php wp\_nonce\_field("papr\_delete\_custom\_roles"~~); ?> |
  | 359 |  | </form> |
  | 360 |  | <table class="wp-list-table widefat fixed table-view-list pages"> |
  | 361 |  | <thead> |
  | 362 |  | <tr> |
  | 363 |  | <th style="width:500px;">Role</th> |
  | 364 |  | <th style="text-align:center;">Edit Role</th> |
  | 365 |  | <th style="text-align:center;">Number of Users</th> |
  | 366 |  | </tr> |
  | 367 |  | </thead> |
  | 368 |  | <tbody> |
  | 369 |  | <?php |
  | 370 |  |  |
  | 371 |  | ~~if(count($roles)!=0)~~{ |
  | 372 |  | ~~papr\_custom\_roles::display\_paginated\_roles($paginated\_roles~~); |
  | 373 |  | } else { |
  | 374 |  | $color = 'f1f6ff'; |
  | 375 |  | ?> |
  | 376 |  | ~~<tr style="background-color:#<?php echo esc\_attr($color~~); ?>;"> |
  | 377 |  | <td><b>No Roles added so far.</b></td> |
  | 378 |  | <td></td> |
  | 379 |  | <td></td> |
  | 380 |  | </tr> |
  | 381 |  | <?php |
  | 382 |  | } |
  | 383 |  | ?> |
  | 384 |  | </tbody> |
  | 385 |  | <tfoot> |
  | 386 |  | <tr> |
  | 387 |  | <td style="width:500px;">Role</td> |
  | 388 |  | <td style="text-align:center;">Edit Role</td> |
  | 389 |  | <td style="text-align:center;">Number of Users</td> |
  | 390 |  | </tr> |
  | 391 |  | </tfoot> |
  | 392 |  | </table> |
  | 393 |  | <div style="text-align: right;"> |
  | 394 |  | ~~<?php papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_roles, $current\_page, $link, 'bottom'~~); ?> |
  | 395 |  | </div> |
  | 396 |  | </div> |
  | 397 |  | </br> |
  | 398 |  | <script> |
  | 399 |  | var page\_selector\_up = document.getElementById("current-page-selector"); |
  | 400 |  | var page\_selector\_down = document.getElementById("current-page-selector-1"); |
  | 401 |  | var link = 'admin.php?page=papr\_custom\_roles\_sub\_menu&curr='; |
  | 402 |  |  |
  | 403 |  | page\_selector\_up.addEventListener("keyup", function(event) { |
  | 404 |  | if (event.keyCode === 13) { |
  | 405 |  | page\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  | 406 |  | var page\_link = link.concat(page\_selector\_up\_value); |
  | 407 |  | window.open(page\_link, "\_self"); |
  | 408 |  | } |
  | 409 |  | }); |
  | 410 |  |  |
  | 411 |  | page\_selector\_down.addEventListener("keyup", function(event) { |
  | 412 |  | if (event.keyCode === 13) { |
  | 413 |  | page\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  | 414 |  | var page\_link = link.concat(page\_selector\_down\_value); |
  | 415 |  | window.open(page\_link, "\_self"); |
  | 416 |  | } |
  | 417 |  | }); |
  | 418 |  | </script> |
  | 419 |  | <?php |
  | 420 |  | ~~papr\_custom\_roles~~::delete\_role\_modal(); |
  | 421 |  | } |
  | 422 |  |  |
  | 423 |  | ~~public static function delete\_role\_modal()~~{ |
  | 424 |  | wp\_enqueue\_style( 'papr\_admin\_plugin\_feedback\_style', plugins\_url( '/includes/css/papr\_feedback\_style.min.css', \_\_FILE\_\_ ) ); |
  | 425 |  | ?> |
  | 426 |  | <div id="papr\_delete\_role\_modal" class="mo\_papr\_modal\_role"> |
  | 427 |  | <div class="mo\_papr\_delete\_role\_content"> |
  | 428 |  | <h6 style="margin: 2%; word-break:break-word;">Are you sure you want to delete <span  id="delete\_role\_warning" style="color:red"></span> Role ?</h6> |
  | 429 |  | <li>If the user who is part of only this role would have his role as none once you delete this role.</li> |
  | 430 |  | <li>If you create new role by same name afterwards that user would get back this role again.</li> |
  | 431 |  | </br> |
  | 432 |  | <div class="mo\_papr\_feedback\_footer"> |
  | 433 |  | <input type="button" class="papr-btn-cstm rounded" value="Delete Role" onclick="delete\_role();"/> |
  | 434 |  | <input type="button" class="papr-btn-cstm rounded" value="Cancel" onclick="role\_modal\_close();"/> |
  | 435 |  | </div> |
  | 436 |  | </div> |
  | 437 |  | </div> |
  | 438 |  | <script> |
  | 439 |  | function delete\_role(){ |
  | 440 |  | document.getElementById('papr\_delete\_custom\_roles').submit(); |
  | 441 |  | role\_modal\_close(); |
  | 442 |  | } |
  | 443 |  |  |
  | 444 |  | function role\_modal\_close(){ |
  | 445 |  | var mo\_modal = document.getElementById('papr\_delete\_role\_modal'); |
  | 446 |  | var span = document.getElementsByClassName("papr\_close")[0]; |
  | 447 |  | mo\_modal.style.display = "none"; |
  | 448 |  | } |
  | 449 |  | </script> |
  | 450 |  | <?php |
  | 451 |  | } |
  | 452 |  |  |
  | 453 |  | ~~public static function display\_paginated\_roles($paginated\_roles)~~{ |
  | 454 |  | ~~$row\_no~~ = 1; |
  | 455 |  | ~~$user~~ = wp\_get\_current\_user(); |
  | 456 |  | $current\_user\_roles = $user->roles; |
  | 457 |  | ~~$current\_user\_roles=array\_flip($current\_user\_roles~~); |
  | 458 |  | ~~foreach($paginated\_roles as $key=>$value)~~{ |
  | 459 |  | ~~$edit\_link = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&current\_edit\_role='.~~$key ); |
  | 460 |  | ~~$clone\_link = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role&clone='.$key.~~'\_clone' ); |
  | 461 |  | ~~$users\_link = admin\_url( 'users.php?role='.~~$key ); |
  | 462 |  | ~~$color~~ = 'f1f6ff'; |
  | 463 |  | ~~if($row\_no%2==0)~~{ |
  | 464 |  | $color = 'fff'; |
  | 465 |  | } |
  | 466 |  | $row\_no++; |
  | 467 |  | ?> |
  | 468 |  | ~~<tr style="background-color:#<?php echo esc\_attr($color~~); ?>;"> |
  | 469 |  | <td> |
  | 470 |  | ~~<b><?php echo esc\_html($key);~~?></b> |
  | 471 |  | <?php |
  | 472 |  | ~~if(!empty($current\_user\_roles[$key]))~~{ |
  | 473 |  | ?> |
  | 474 |  | - Your Role |
  | 475 |  | <?php |
  | 476 |  | ~~if(get\_option('default\_role')==$key)~~{ |
  | 477 |  | ?> |
  | 478 |  | , Default Role |
  | 479 |  | <?php |
  | 480 |  | } |
  | 481 |  | } else { |
  | 482 |  | ~~if(get\_option('default\_role')==$key)~~{ |
  | 483 |  | ?> |
  | 484 |  | - Default Role |
  | 485 |  | <?php |
  | 486 |  | } |
  | 487 |  | } |
  | 488 |  | ?> |
  | 489 |  | <div style="margin-top:5px;"> |
  | 490 |  | <ul class="role\_usability"> |
  | 491 |  | ~~<li><a href="<?php echo esc\_url($clone\_link);~~?>">Clone </a></li> |
  | 492 |  | <li>| </li> |
  | 493 |  | ~~<li><a href="<?php echo esc\_url($users\_link);~~?>">Users </a></li> |
  | 494 |  | <?php |
  | 495 |  | ~~if(get\_option('default\_role')==$key)~~{ |
  | 496 |  | $change\_default = admin\_url( '/options-general.php#default\_role' ); |
  | 497 |  | ?> |
  | 498 |  | <li>| </li> |
  | 499 |  | ~~<li><a href="<?php echo esc\_url($change\_default);~~?>">Change Default</a></li> |
  | 500 |  | <?php |
  | 501 |  | ~~} else if(empty($current\_user\_roles[$key]))~~{ |
  | 502 |  | ?> |
  | 503 |  | <li>| </li> |
  | 504 |  | ~~<li style="color:red;" id="delete\_<?php echo esc\_attr($key);?>"><a onclick="papr\_delete\_role('<?php echo esc\_js($key); ?>');" onmouseover = "document.getElementById('delete\_<?php echo esc\_js($key);~~?>').style.cursor='pointer';" |
  | 505 |  | >Delete</a></li> |
  | 506 |  | <?php |
  | 507 |  | } |
  | 508 |  | ?> |
  | 509 |  | </ul> |
  | 510 |  | </div> |
  | 511 |  | </td> |
  | 512 |  | <td style="text-align:center;"> |
  | 513 |  | ~~<a href="<?php echo esc\_url($edit\_link);~~?>"><button class="papr-btn-cstm">Edit </button></a> |
  | 514 |  | </td> |
  | 515 |  | <td style="text-align:center;"> |
  | 516 |  | <?php |
  | 517 |  | ~~$users\_args~~ = array( |
  | 518 |  | 'role' => $key, |
  | 519 |  | ); |
  | 520 |  | ~~$users\_with\_role = get\_users($users\_args~~); |
  | 521 |  | ~~echo esc\_html(count($users\_with\_role)~~); |
  | 522 |  | ?> |
  | 523 |  | </td> |
  | 524 |  | </tr> |
  | 525 |  | <?php |
  | 526 |  | } |
  | 527 |  | ?> |
  | 528 |  | <script> |
  | 529 |  | function papr\_delete\_role(role){ |
  | 530 |  | document.getElementById("delete\_role\_warning").textContent = role; |
  | 531 |  | var mo\_modal = document.getElementById('papr\_delete\_role\_modal'); |
  | 532 |  | mo\_modal.style.display = "block"; |
  | 533 |  | document.getElementById('role\_delete').value = role; |
  | 534 |  | } |
  | 535 |  | </script> |
  | 536 |  | <?php |
  | 537 |  | } |
  | 538 |  |  |
  | 539 |  | ~~public static function roles\_result\_per\_page($roles\_per\_page)~~{ |
  | 540 |  | ?> |
  | 541 |  | <form id="roles\_per\_page" name="roles\_per\_page" method="post" action=""> |
  | 542 |  | <input type="hidden" name="option" value="roles\_per\_page"> |
  | 543 |  | ~~<?php wp\_nonce\_field('roles\_per\_page'~~); ?> |
  | 544 |  | <div class="row align-items-center"> |
  | 545 |  | <h6 style="margin-right:10px; padding-left:15px;">Number of items per page:</h6> |
  | 546 |  | <div> |
  | 547 |  | <select name="roles\_per\_page" onChange="document.getElementById('roles\_per\_page').submit()" style="width:60px;"> |
  | 548 |  | <?php |
  | 549 |  | ~~for ($i = 1; $i <= 5; $i++~~) { |
  | 550 |  | $value = $i \* 10; |
  | 551 |  | ~~echo '<option value="' . esc\_attr($value~~) . '"'; |
  | 552 |  | ~~if ($roles\_per\_page == $value~~) { |
  | 553 |  | echo ' selected '; |
  | 554 |  | } |
  | 555 |  | ~~echo '>' . esc\_html($value~~) . '</option>'; |
  | 556 |  | } |
  | 557 |  | ?> |
  | 558 |  | </select> |
  | 559 |  | </div> |
  | 560 |  | </div> |
  | 561 |  | </form> |
  | 562 |  | <?php |
  | 563 |  | } |
  | 564 |  |  |
  | 565 |  | ~~public static function clone\_roles\_form()~~{ |
  | 566 |  | ~~if(!array\_key\_exists('clone', $\_GET) && isset($\_GET['tab']))~~{ |
  | 567 |  | echo '</br>'; |
  | 568 |  | global $wp\_roles; |
  | 569 |  | $papr\_custom\_roles = $wp\_roles->roles; |
  | 570 |  | ~~$clone\_link = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role&clone='~~); |
  | 571 |  |  |
  | 572 |  | $papr\_custom\_roles\_first\_key = $papr\_custom\_roles; |
  | 573 |  | ~~reset($papr\_custom\_roles\_first\_key~~); |
  | 574 |  | ~~$first\_key = key($papr\_custom\_roles\_first\_key~~); |
  | 575 |  | ~~$clone\_link\_admin = $clone\_link.$first\_key.~~'\_clone'; |
  | 576 |  |  |
  | 577 |  | ?> |
  | 578 |  | If you want to clone a role please select the role you want to clone from dropdown and click on Clone. |
  | 579 |  | <br><br> |
  | 580 |  | Clone From : &nbsp&nbsp&nbsp |
  | 581 |  |  |
  | 582 |  | ~~<select onchange="cloneThisRole(this.value,'<?php echo esc\_js($clone\_link~~); ?>')" style="height:25px;"> |
  | 583 |  | <?php |
  | 584 |  | ~~foreach($papr\_custom\_roles as $key=>$value)~~{ |
  | 585 |  | ?> |
  | 586 |  | ~~<option value="<?php echo esc\_attr($key);?>"><?php echo esc\_attr($key);~~?></option> |
  | 587 |  | <?php |
  | 588 |  | } |
  | 589 |  | ?> |
  | 590 |  | </select> |
  | 591 |  | &nbsp&nbsp |
  | 592 |  | ~~<a href="<?php echo esc\_url($clone\_link\_admin~~); ?>" id="clone\_role\_link"> |
  | 593 |  | <button class="papr-btn-cstm rounded"> |
  | 594 |  | Clone |
  | 595 |  | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 596 |  | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 597 |  | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | 598 |  | </svg> |
  | 599 |  | </button> |
  | 600 |  | </a> |
  | 601 |  | </br> |
  | 602 |  | <script> |
  | 603 |  | function cloneThisRole(role\_id,clone\_link) { |
  | 604 |  | var link = clone\_link + role\_id + '\_clone'; |
  | 605 |  | document.getElementById('clone\_role\_link').href = link; |
  | 606 |  | } |
  | 607 |  | </script> |
  | 608 |  | <?php |
  | 609 |  | } |
  | 610 |  | } |
  |  | 6 | require\_once 'page-restriction-utility.php'; |
  |  | 7 |  |
  |  | 8 | class papr\_custom\_roles { |
  |  | 9 |  |
  |  | 10 | public static function create\_edit\_roles( $current\_edit\_role, $papr\_custom\_roles ) { |
  |  | 11 | $papr\_current\_role\_capabilty = array(); |
  |  | 12 | $disabled                    = ''; |
  |  | 13 |  |
  |  | 14 | if ( ! empty( $papr\_custom\_roles[ $current\_edit\_role ] ) ) { |
  |  | 15 | $papr\_current\_role\_capabilty = $papr\_custom\_roles[ $current\_edit\_role ]['capabilities']; |
  |  | 16 | $disabled                    = 'readonly'; |
  |  | 17 | } |
  |  | 18 |  |
  |  | 19 | self::roles\_form( $current\_edit\_role, $papr\_current\_role\_capabilty, $disabled ); |
  |  | 20 | } |
  |  | 21 |  |
  |  | 22 | public static function create\_clone\_roles( $current\_edit\_role, $papr\_custom\_roles ) { |
  |  | 23 | $papr\_current\_role\_capabilty = array(); |
  |  | 24 | $disabled                    = ''; |
  |  | 25 |  |
  |  | 26 | if ( $current\_edit\_role != '' ) { |
  |  | 27 | if ( substr( $current\_edit\_role, -6 ) == '\_clone' ) { |
  |  | 28 | $current\_edit\_role\_pre\_clone = substr( $current\_edit\_role, 0, -6 ); |
  |  | 29 | if ( ! empty( $papr\_custom\_roles[ $current\_edit\_role\_pre\_clone ] ) ) { |
  |  | 30 | $papr\_current\_role\_capabilty = $papr\_custom\_roles[ $current\_edit\_role\_pre\_clone ]['capabilities']; |
  |  | 31 | } |
  |  | 32 | } |
  |  | 33 | } |
  |  | 34 |  |
  |  | 35 | self::roles\_form( $current\_edit\_role, $papr\_current\_role\_capabilty, $disabled ); |
  |  | 36 | } |
  |  | 37 |  |
  |  | 38 | public static function roles\_form( $current\_edit\_role, $papr\_current\_role\_capabilty, $disabled ) { |
  |  | 39 | ?> |
  |  | 40 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 41 | <div class="row"> |
  |  | 42 | <div class="col-md-12"> |
  |  | 43 | <h4> |
  |  | 44 | <?php |
  |  | 45 | if ( $disabled == '' ) { |
  |  | 46 | echo 'Add new role and define it\'s capabilities'; |
  |  | 47 | } else { |
  |  | 48 | echo 'Edit role and it\'s capabilities'; |
  |  | 49 | } |
  |  | 50 | ?> |
  |  | 51 | </h4> |
  |  | 52 | </div> |
  |  | 53 | </div> |
  |  | 54 | <div class="form-head"></div> |
  |  | 55 | <?php |
  |  | 56 | self::clone\_roles\_form(); |
  |  | 57 | ?> |
  |  | 58 | <h5 class="papr-form-head papr-form-head-bar mt-5"> |
  |  | 59 |  |
  |  | 60 | <?php |
  |  | 61 | if ( $disabled == '' ) { |
  |  | 62 | echo 'Add New Roles'; |
  |  | 63 | } else { |
  |  | 64 | echo 'Edit Roles : <b style="color:#00008B;">' . $current\_edit\_role . '</b>'; |
  |  | 65 | } |
  |  | 66 |  |
  |  | 67 | if ( $disabled == '' ) { |
  |  | 68 | ?> |
  |  | 69 | <div class="papr-info-global ms-2"> |
  |  | 70 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 71 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 72 | </svg> |
  |  | 73 | <p class="papr-info-text-global"> |
  |  | 74 | Just turn on check boxes of capabilities you wish to add to the new role you are creating and then click <b style="color:red">Save Configuration</b> button to save your changes. |
  |  | 75 | </p> |
  |  | 76 | </div> |
  |  | 77 | <?php |
  |  | 78 | } |
  |  | 79 | ?> |
  |  | 80 | </h5> |
  |  | 81 | <?php |
  |  | 82 | if ( $disabled == '' ) { |
  |  | 83 | $form\_name = 'papr\_custom\_create\_roles'; |
  |  | 84 | } else { |
  |  | 85 | $form\_name = 'papr\_custom\_edit\_roles'; |
  |  | 86 | } |
  |  | 87 | $button\_value = 'Save Configuration'; |
  |  | 88 | global $wp\_roles; |
  |  | 89 | $roles           = $wp\_roles->roles; |
  |  | 90 | $roles\_with\_name = array(); |
  |  | 91 | foreach ( $roles as $key => $value ) { |
  |  | 92 | array\_push( $roles\_with\_name, $key ); |
  |  | 93 | } |
  |  | 94 | $parsed\_roles = json\_encode( $roles\_with\_name ); |
  |  | 95 | ?> |
  |  | 96 | <input type="hidden" name="option" id="roles\_valid\_hidden\_input" value='<?php echo esc\_attr( $parsed\_roles ); ?>'> |
  |  | 97 | <form id="<?php echo esc\_attr( $form\_name ); ?>" name="<?php echo esc\_attr( $form\_name ); ?>" method="post" action=""> |
  |  | 98 | <input type="hidden" name="option" value="<?php echo esc\_attr( $form\_name ); ?>"> |
  |  | 99 | <?php |
  |  | 100 | wp\_nonce\_field( $form\_name ); |
  |  | 101 | $role\_button\_disable = ''; |
  |  | 102 | if ( $disabled == '' ) { |
  |  | 103 | ?> |
  |  | 104 | <input required type="text" name="custom\_role\_name" id="custom\_role\_name" value="<?php echo esc\_attr( $current\_edit\_role ); ?>" |
  |  | 105 | onkeyup="validate\_role\_name();" |
  |  | 106 | style="width: 270px; margin-bottom:5px;" placeholder="Enter Role Name"> |
  |  | 107 | <?php |
  |  | 108 |  |
  |  | 109 | if ( ! empty( $roles[ $current\_edit\_role ] ) ) { |
  |  | 110 | ?> |
  |  | 111 | <p id="role\_name\_error" style="color:red">This role name already exist</p> |
  |  | 112 | <?php |
  |  | 113 | $role\_button\_disable = 'disabled'; |
  |  | 114 | } else { |
  |  | 115 | ?> |
  |  | 116 | <p id="role\_name\_error" style="color:red"></p> |
  |  | 117 | <?php |
  |  | 118 | } |
  |  | 119 | } else { |
  |  | 120 | ?> |
  |  | 121 | <input type="hidden" name="custom\_role\_name" id="custom\_role\_name" value="<?php echo esc\_attr( $current\_edit\_role ); ?>"> |
  |  | 122 | <?php |
  |  | 123 | } |
  |  | 124 | ?> |
  |  | 125 | <br> |
  |  | 126 | <b>Note : </b>Please Select the Capabilites you want to assign to the Role before you Save and add/edit the role. |
  |  | 127 | </br></br> |
  |  | 128 | <input type='submit' value="<?php echo esc\_attr( $button\_value ); ?>" class="papr-btn-cstm-role-create role\_submit\_button" style="border-radius: 2.25rem;" <?php echo esc\_attr( $role\_button\_disable ); ?>> |
  |  | 129 | <div> |
  |  | 130 | </br></br> |
  |  | 131 | <div class="flex-container-custom-role"> |
  |  | 132 | <div class="display\_custom\_role\_nav"> |
  |  | 133 | <?php |
  |  | 134 | self::display\_custom\_role\_nav(); |
  |  | 135 | ?> |
  |  | 136 | </div> |
  |  | 137 |  |
  |  | 138 | <div id="capability-table" class="display\_custom\_role\_table\_edit"> |
  |  | 139 | <?php |
  |  | 140 | self::display\_custom\_role\_table\_edit( $papr\_current\_role\_capabilty, $current\_edit\_role ); |
  |  | 141 | ?> |
  |  | 142 | </div> |
  |  | 143 | </div> |
  |  | 144 | </br> |
  |  | 145 | </div> |
  |  | 146 | <input type='submit' value="<?php echo esc\_attr( $button\_value ); ?>" class="papr-btn-cstm-role-create role\_submit\_button" style="border-radius: 2.25rem;" <?php echo esc\_attr( $role\_button\_disable ); ?>> |
  |  | 147 | </form> |
  |  | 148 | </div> |
  |  | 149 | </br> |
  |  | 150 | <script> |
  |  | 151 | var roles\_array = document.getElementById('roles\_valid\_hidden\_input').value; |
  |  | 152 | text = roles\_array.slice(1, -1); |
  |  | 153 | var roles\_array = text.split(","); |
  |  | 154 | for (var i = 0; i < roles\_array.length; i++) { |
  |  | 155 | roles\_array[i] = roles\_array[i].slice(1, -1); |
  |  | 156 | } |
  |  | 157 |  |
  |  | 158 | function validate\_role\_name(){ |
  |  | 159 | var format = /[!@#$%^&\*()+\-=\[\]{};':"\\|,.<>\/?]+/; |
  |  | 160 | var role\_name = document.getElementById('custom\_role\_name').value; |
  |  | 161 | let index = roles\_array.indexOf(role\_name); |
  |  | 162 | if(index != -1) { |
  |  | 163 | document.getElementById("role\_name\_error").innerHTML = "This role name already exist"; |
  |  | 164 | document.getElementsByClassName("role\_submit\_button")[0].disabled = true; |
  |  | 165 | document.getElementsByClassName("role\_submit\_button")[1].disabled = true; |
  |  | 166 | } else if(format.test(role\_name)){ |
  |  | 167 | document.getElementById("role\_name\_error").innerHTML = "Special characters in the role name not allowed."; |
  |  | 168 | document.getElementsByClassName("role\_submit\_button")[0].disabled = true; |
  |  | 169 | document.getElementsByClassName("role\_submit\_button")[1].disabled = true; |
  |  | 170 | } else { |
  |  | 171 | document.getElementById("role\_name\_error").innerHTML = " "; |
  |  | 172 | document.getElementsByClassName("role\_submit\_button")[0].disabled = false; |
  |  | 173 | document.getElementsByClassName("role\_submit\_button")[1].disabled = false; |
  |  | 174 | } |
  |  | 175 | } |
  |  | 176 | </script> |
  |  | 177 | <?php |
  |  | 178 | } |
  |  | 179 |  |
  |  | 180 | public static function display\_custom\_role\_nav() { |
  |  | 181 | ?> |
  |  | 182 |  |
  |  | 183 | <ul class="papr-tab-nav"> |
  |  | 184 | <?php |
  |  | 185 | $papr\_capabilites\_category = papr\_custom\_roles\_constants::papr\_custom\_roles\_constants\_names(); |
  |  | 186 | foreach ( $papr\_capabilites\_category as $key => $value ) { |
  |  | 187 | ?> |
  |  | 188 | <li class="papr-tab-title"> |
  |  | 189 | <?php |
  |  | 190 | $key\_js\_function = 'papr-tab-' . $key; |
  |  | 191 | $key\_up          = str\_replace( '\_', ' ', $key ); |
  |  | 192 | $key\_up          = ucwords( $key\_up ); |
  |  | 193 |  |
  |  | 194 | if ( $key != 'all' ) { |
  |  | 195 | $background\_color = '#fff'; |
  |  | 196 | if ( $key == 'general' ) { |
  |  | 197 | $background\_color = '#f1f6ff'; |
  |  | 198 | } |
  |  | 199 | ?> |
  |  | 200 | <a onclick="hide\_function('<?php echo esc\_js( $key\_js\_function ); ?>');" class="roles\_buttons"> |
  |  | 201 | <div class="div\_button" id="<?php echo esc\_attr( $key\_js\_function ); ?>\_button" style="width:170px;height:40px; padding-left:10px; padding-top:5px; background-color:<?php echo $background\_color; ?>;"> |
  |  | 202 | <i style="vertical-align:middle !important;" class="<?php echo esc\_attr( $value ); ?>"></i> |
  |  | 203 | <span class="label"><?php echo esc\_html( $key\_up ); ?></span> |
  |  | 204 | </div> |
  |  | 205 | </a> |
  |  | 206 | <?php |
  |  | 207 | } else { |
  |  | 208 | ?> |
  |  | 209 | <a onclick="show\_all\_function();" class="roles\_buttons" > |
  |  | 210 | <div class="div\_button" id="<?php echo esc\_attr( $key\_js\_function ); ?>\_button" style="width:170px;height:40px; padding-left:10px; padding-top:5px; background-color:#fff;"> |
  |  | 211 | <i style="vertical-align:middle !important;" class="<?php echo esc\_attr( $value ); ?>"></i> |
  |  | 212 | <span class="label"><?php echo esc\_html( $key\_up ); ?></span> |
  |  | 213 | </div> |
  |  | 214 | </a> |
  |  | 215 | <?php |
  |  | 216 | } |
  |  | 217 | ?> |
  |  | 218 | </li> |
  |  | 219 | <?php |
  |  | 220 | } |
  |  | 221 | ?> |
  |  | 222 | </ul> |
  |  | 223 | <script> |
  |  | 224 | function hide\_function(id) { |
  |  | 225 | var divs = document.getElementsByClassName('hide-category-div'); |
  |  | 226 | var i; |
  |  | 227 | for (i = 0; i < divs.length; i++) { |
  |  | 228 | divs[i].style.display = 'none'; |
  |  | 229 | } |
  |  | 230 |  |
  |  | 231 | var divid = document.getElementsByClassName(id); |
  |  | 232 | var i; |
  |  | 233 | for (i = 0; i < divid.length; i++) { |
  |  | 234 | divid[i].style.display = ''; |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | var div\_button = document.getElementsByClassName('div\_button'); |
  |  | 238 | var i; |
  |  | 239 | for (i = 0; i < div\_button.length; i++) { |
  |  | 240 | div\_button[i].style.backgroundColor = '#fff'; |
  |  | 241 | } |
  |  | 242 |  |
  |  | 243 | var id\_button = id + '\_button'; |
  |  | 244 | document.getElementById(id\_button).style.backgroundColor = '#f1f6ff'; |
  |  | 245 | } |
  |  | 246 |  |
  |  | 247 | function show\_all\_function() { |
  |  | 248 | var divs = document.getElementsByClassName('hide-category-div'); |
  |  | 249 | var i; |
  |  | 250 | for (i = 0; i < divs.length; i++) { |
  |  | 251 | divs[i].style.display = ''; |
  |  | 252 | } |
  |  | 253 |  |
  |  | 254 | var div\_button = document.getElementsByClassName('div\_button'); |
  |  | 255 | var i; |
  |  | 256 | for (i = 0; i < div\_button.length; i++) { |
  |  | 257 | div\_button[i].style.backgroundColor = '#fff'; |
  |  | 258 | } |
  |  | 259 |  |
  |  | 260 | var id\_button = 'papr-tab-all\_button'; |
  |  | 261 | document.getElementById(id\_button).style.backgroundColor = "#f1f6ff"; |
  |  | 262 | } |
  |  | 263 | </script> |
  |  | 264 | <?php |
  |  | 265 | } |
  |  | 266 |  |
  |  | 267 | public static function display\_custom\_role\_table\_edit( $papr\_current\_role\_capabilty, $current\_edit\_role ) { |
  |  | 268 | ?> |
  |  | 269 | <table class="role\_table\_width"> |
  |  | 270 | <tr style="display:; border-bottom:1px solid lightblue; height:40px;"> |
  |  | 271 | <td style="width:30rem !important;"><b>Capability</b></td> |
  |  | 272 | <td style="width:5rem !important; text-align:center;"><b>Grant</b></td> |
  |  | 273 | </tr> |
  |  | 274 |  |
  |  | 275 | <?php |
  |  | 276 | $papr\_capabilites\_category\_array = papr\_custom\_roles\_constants::papr\_custom\_roles\_capabilities\_constants(); |
  |  | 277 |  |
  |  | 278 | foreach ( $papr\_capabilites\_category\_array as $group\_name => $capability ) { |
  |  | 279 | if ( $group\_name == 'general' ) { |
  |  | 280 | $display = 'display:;'; |
  |  | 281 | } else { |
  |  | 282 | $display = 'display:none;'; |
  |  | 283 | } |
  |  | 284 | $papr\_capabilites\_category\_array\_name = $papr\_capabilites\_category\_array[ $group\_name ]; |
  |  | 285 | foreach ( $papr\_capabilites\_category\_array\_name as $key ) { |
  |  | 286 | $capability\_name = str\_replace( '\_', ' ', $key ); |
  |  | 287 | $grant\_checked   = ''; |
  |  | 288 | if ( ! empty( $papr\_current\_role\_capabilty[ $key ] ) ) { |
  |  | 289 | if ( $papr\_current\_role\_capabilty[ $key ] == 1 ) { |
  |  | 290 | $grant\_checked = 'checked'; |
  |  | 291 | } |
  |  | 292 | } |
  |  | 293 |  |
  |  | 294 | if ( $key == 'read' && $current\_edit\_role == '' ) { |
  |  | 295 | $grant\_checked = 'checked'; |
  |  | 296 | } |
  |  | 297 |  |
  |  | 298 | ?> |
  |  | 299 | <tr class="hide-category-div papr-tab-<?php echo esc\_attr( $group\_name ); ?>" style="<?php echo esc\_attr( $display ); ?> border-bottom:0.01rem solid lightblue; height:40px;"> |
  |  | 300 | <td style="width:30rem !important;"><?php echo esc\_html( ucwords( $capability\_name ) ); ?></td> |
  |  | 301 | <td style="width:5rem !important; text-align:center;"><input type="checkbox" name="<?php echo esc\_attr( $key ); ?>" id="<?php echo esc\_attr( $key ); ?>" <?php echo esc\_attr( $grant\_checked ); ?>/></td> |
  |  | 302 | </tr> |
  |  | 303 | <?php |
  |  | 304 | } |
  |  | 305 | } |
  |  | 306 | ?> |
  |  | 307 |  |
  |  | 308 | <tr style="height:40px;"> |
  |  | 309 | <td style="width:30rem !important;"><b>Capability</b></td> |
  |  | 310 | <td style="width:5rem !important; text-align:center;"><b>Grant</b></td> |
  |  | 311 | </tr> |
  |  | 312 |  |
  |  | 313 | </table> |
  |  | 314 | <?php |
  |  | 315 | } |
  |  | 316 |  |
  |  | 317 | public static function edit\_delete\_roles() { |
  |  | 318 | global $wp\_roles; |
  |  | 319 | $roles                         = $wp\_roles->roles; |
  |  | 320 | $total\_roles                   = count( $roles ); |
  |  | 321 | $roles\_per\_page                = get\_option( 'papr\_roles\_per\_page' ); |
  |  | 322 | $roles\_per\_page                = $roles\_per\_page != '' ? $roles\_per\_page : 10; |
  |  | 323 | $number\_of\_pages\_in\_pagination = ceil( $total\_roles / $roles\_per\_page ); |
  |  | 324 |  |
  |  | 325 | $current\_page    = papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ); |
  |  | 326 | $link            = get\_admin\_url() . 'admin.php?page=papr\_custom\_roles\_sub\_menu&curr='; |
  |  | 327 | $offset          = ( $current\_page - 1 ) \* $roles\_per\_page; |
  |  | 328 | $paginated\_roles = array\_slice( $roles, $offset, $roles\_per\_page ); |
  |  | 329 | ?> |
  |  | 330 |  |
  |  | 331 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 332 | <div class="row"> |
  |  | 333 | <div class="col-md-6"> |
  |  | 334 | <h4>Edit or Delete Custom Roles</h4> |
  |  | 335 | </div> |
  |  | 336 | <div class="col-md-6 text-end"> |
  |  | 337 | <a href="admin.php?page=page\_restriction" class="papr-btn-cstm rounded"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-arrow-left" viewBox="0 0 16 16"> |
  |  | 338 | <path fill-rule="evenodd" d="M15 8a.5.5 0 0 0-.5-.5H2.707l3.147-3.146a.5.5 0 1 0-.708-.708l-4 4a.5.5 0 0 0 0 .708l4 4a.5.5 0 0 0 .708-.708L2.707 8.5H14.5A.5.5 0 0 0 15 8z" /> |
  |  | 339 | </svg>&nbsp; Back to Restriction Settings |
  |  | 340 | </a> |
  |  | 341 | </div> |
  |  | 342 | </div> |
  |  | 343 | <div class="form-head"></div> |
  |  | 344 | </br> |
  |  | 345 | <div class=""> |
  |  | 346 | <?php |
  |  | 347 | self::roles\_result\_per\_page( $roles\_per\_page ); |
  |  | 348 | ?> |
  |  | 349 | <div style="text-align: right;"> |
  |  | 350 | <?php papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_roles, $current\_page, $link, 'top' ); ?> |
  |  | 351 | </div> |
  |  | 352 | </div> |
  |  | 353 | </br> |
  |  | 354 |  |
  |  | 355 | <form id="papr\_delete\_custom\_roles" name="papr\_delete\_custom\_roles" method="post" action=""> |
  |  | 356 | <input type="hidden" name="option" value="papr\_delete\_custom\_roles"> |
  |  | 357 | <input type="hidden" name="role\_delete" id="role\_delete" value=""> |
  |  | 358 | <?php wp\_nonce\_field( 'papr\_delete\_custom\_roles' ); ?> |
  |  | 359 | </form> |
  |  | 360 | <table class="wp-list-table widefat fixed table-view-list pages"> |
  |  | 361 | <thead> |
  |  | 362 | <tr> |
  |  | 363 | <th style="width:500px;">Role</th> |
  |  | 364 | <th style="text-align:center;">Edit Role</th> |
  |  | 365 | <th style="text-align:center;">Number of Users</th> |
  |  | 366 | </tr> |
  |  | 367 | </thead> |
  |  | 368 | <tbody> |
  |  | 369 | <?php |
  |  | 370 |  |
  |  | 371 | if ( count( $roles ) != 0 ) { |
  |  | 372 | self::display\_paginated\_roles( $paginated\_roles ); |
  |  | 373 | } else { |
  |  | 374 | $color = 'f1f6ff'; |
  |  | 375 | ?> |
  |  | 376 | <tr style="background-color:#<?php echo esc\_attr( $color ); ?>;"> |
  |  | 377 | <td><b>No Roles added so far.</b></td> |
  |  | 378 | <td></td> |
  |  | 379 | <td></td> |
  |  | 380 | </tr> |
  |  | 381 | <?php |
  |  | 382 | } |
  |  | 383 | ?> |
  |  | 384 | </tbody> |
  |  | 385 | <tfoot> |
  |  | 386 | <tr> |
  |  | 387 | <td style="width:500px;">Role</td> |
  |  | 388 | <td style="text-align:center;">Edit Role</td> |
  |  | 389 | <td style="text-align:center;">Number of Users</td> |
  |  | 390 | </tr> |
  |  | 391 | </tfoot> |
  |  | 392 | </table> |
  |  | 393 | <div style="text-align: right;"> |
  |  | 394 | <?php papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_roles, $current\_page, $link, 'bottom' ); ?> |
  |  | 395 | </div> |
  |  | 396 | </div> |
  |  | 397 | </br> |
  |  | 398 | <script> |
  |  | 399 | var page\_selector\_up = document.getElementById("current-page-selector"); |
  |  | 400 | var page\_selector\_down = document.getElementById("current-page-selector-1"); |
  |  | 401 | var link = 'admin.php?page=papr\_custom\_roles\_sub\_menu&curr='; |
  |  | 402 |  |
  |  | 403 | page\_selector\_up.addEventListener("keyup", function(event) { |
  |  | 404 | if (event.keyCode === 13) { |
  |  | 405 | page\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  |  | 406 | var page\_link = link.concat(page\_selector\_up\_value); |
  |  | 407 | window.open(page\_link, "\_self"); |
  |  | 408 | } |
  |  | 409 | }); |
  |  | 410 |  |
  |  | 411 | page\_selector\_down.addEventListener("keyup", function(event) { |
  |  | 412 | if (event.keyCode === 13) { |
  |  | 413 | page\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  |  | 414 | var page\_link = link.concat(page\_selector\_down\_value); |
  |  | 415 | window.open(page\_link, "\_self"); |
  |  | 416 | } |
  |  | 417 | }); |
  |  | 418 | </script> |
  |  | 419 | <?php |
  |  | 420 | self::delete\_role\_modal(); |
  |  | 421 | } |
  |  | 422 |  |
  |  | 423 | public static function delete\_role\_modal() { |
  |  | 424 | wp\_enqueue\_style( 'papr\_admin\_plugin\_feedback\_style', plugins\_url( '/includes/css/papr\_feedback\_style.min.css', \_\_FILE\_\_ ) ); |
  |  | 425 | ?> |
  |  | 426 | <div id="papr\_delete\_role\_modal" class="mo\_papr\_modal\_role"> |
  |  | 427 | <div class="mo\_papr\_delete\_role\_content"> |
  |  | 428 | <h6 style="margin: 2%; word-break:break-word;">Are you sure you want to delete <span  id="delete\_role\_warning" style="color:red"></span> Role ?</h6> |
  |  | 429 | <li>If the user who is part of only this role would have his role as none once you delete this role.</li> |
  |  | 430 | <li>If you create new role by same name afterwards that user would get back this role again.</li> |
  |  | 431 | </br> |
  |  | 432 | <div class="mo\_papr\_feedback\_footer"> |
  |  | 433 | <input type="button" class="papr-btn-cstm rounded" value="Delete Role" onclick="delete\_role();"/> |
  |  | 434 | <input type="button" class="papr-btn-cstm rounded" value="Cancel" onclick="role\_modal\_close();"/> |
  |  | 435 | </div> |
  |  | 436 | </div> |
  |  | 437 | </div> |
  |  | 438 | <script> |
  |  | 439 | function delete\_role(){ |
  |  | 440 | document.getElementById('papr\_delete\_custom\_roles').submit(); |
  |  | 441 | role\_modal\_close(); |
  |  | 442 | } |
  |  | 443 |  |
  |  | 444 | function role\_modal\_close(){ |
  |  | 445 | var mo\_modal = document.getElementById('papr\_delete\_role\_modal'); |
  |  | 446 | var span = document.getElementsByClassName("papr\_close")[0]; |
  |  | 447 | mo\_modal.style.display = "none"; |
  |  | 448 | } |
  |  | 449 | </script> |
  |  | 450 | <?php |
  |  | 451 | } |
  |  | 452 |  |
  |  | 453 | public static function display\_paginated\_roles( $paginated\_roles ) { |
  |  | 454 | $row\_no             = 1; |
  |  | 455 | $user               = wp\_get\_current\_user(); |
  |  | 456 | $current\_user\_roles = $user->roles; |
  |  | 457 | $current\_user\_roles = array\_flip( $current\_user\_roles ); |
  |  | 458 | foreach ( $paginated\_roles as $key => $value ) { |
  |  | 459 | $edit\_link  = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&current\_edit\_role=' . $key ); |
  |  | 460 | $clone\_link = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role&clone=' . $key . '\_clone' ); |
  |  | 461 | $users\_link = admin\_url( 'users.php?role=' . $key ); |
  |  | 462 | $color      = 'f1f6ff'; |
  |  | 463 | if ( $row\_no % 2 == 0 ) { |
  |  | 464 | $color = 'fff'; |
  |  | 465 | } |
  |  | 466 | $row\_no++; |
  |  | 467 | ?> |
  |  | 468 | <tr style="background-color:#<?php echo esc\_attr( $color ); ?>;"> |
  |  | 469 | <td> |
  |  | 470 | <b><?php echo esc\_html( $key ); ?></b> |
  |  | 471 | <?php |
  |  | 472 | if ( ! empty( $current\_user\_roles[ $key ] ) ) { |
  |  | 473 | ?> |
  |  | 474 | - Your Role |
  |  | 475 | <?php |
  |  | 476 | if ( get\_option( 'default\_role' ) == $key ) { |
  |  | 477 | ?> |
  |  | 478 | , Default Role |
  |  | 479 | <?php |
  |  | 480 | } |
  |  | 481 | } else { |
  |  | 482 | if ( get\_option( 'default\_role' ) == $key ) { |
  |  | 483 | ?> |
  |  | 484 | - Default Role |
  |  | 485 | <?php |
  |  | 486 | } |
  |  | 487 | } |
  |  | 488 | ?> |
  |  | 489 | <div style="margin-top:5px;"> |
  |  | 490 | <ul class="role\_usability"> |
  |  | 491 | <li><a href="<?php echo esc\_url( $clone\_link ); ?>">Clone </a></li> |
  |  | 492 | <li>| </li> |
  |  | 493 | <li><a href="<?php echo esc\_url( $users\_link ); ?>">Users </a></li> |
  |  | 494 | <?php |
  |  | 495 | if ( get\_option( 'default\_role' ) == $key ) { |
  |  | 496 | $change\_default = admin\_url( '/options-general.php#default\_role' ); |
  |  | 497 | ?> |
  |  | 498 | <li>| </li> |
  |  | 499 | <li><a href="<?php echo esc\_url( $change\_default ); ?>">Change Default</a></li> |
  |  | 500 | <?php |
  |  | 501 | } elseif ( empty( $current\_user\_roles[ $key ] ) ) { |
  |  | 502 | ?> |
  |  | 503 | <li>| </li> |
  |  | 504 | <li style="color:red;" id="delete\_<?php echo esc\_attr( $key ); ?>"><a onclick="papr\_delete\_role('<?php echo esc\_js( $key ); ?>');" onmouseover = "document.getElementById('delete\_<?php echo esc\_js( $key ); ?>').style.cursor='pointer';" |
  |  | 505 | >Delete</a></li> |
  |  | 506 | <?php |
  |  | 507 | } |
  |  | 508 | ?> |
  |  | 509 | </ul> |
  |  | 510 | </div> |
  |  | 511 | </td> |
  |  | 512 | <td style="text-align:center;"> |
  |  | 513 | <a href="<?php echo esc\_url( $edit\_link ); ?>"><button class="papr-btn-cstm">Edit </button></a> |
  |  | 514 | </td> |
  |  | 515 | <td style="text-align:center;"> |
  |  | 516 | <?php |
  |  | 517 | $users\_args      = array( |
  |  | 518 | 'role' => $key, |
  |  | 519 | ); |
  |  | 520 | $users\_with\_role = get\_users( $users\_args ); |
  |  | 521 | echo esc\_html( count( $users\_with\_role ) ); |
  |  | 522 | ?> |
  |  | 523 | </td> |
  |  | 524 | </tr> |
  |  | 525 | <?php |
  |  | 526 | } |
  |  | 527 | ?> |
  |  | 528 | <script> |
  |  | 529 | function papr\_delete\_role(role){ |
  |  | 530 | document.getElementById("delete\_role\_warning").textContent = role; |
  |  | 531 | var mo\_modal = document.getElementById('papr\_delete\_role\_modal'); |
  |  | 532 | mo\_modal.style.display = "block"; |
  |  | 533 | document.getElementById('role\_delete').value = role; |
  |  | 534 | } |
  |  | 535 | </script> |
  |  | 536 | <?php |
  |  | 537 | } |
  |  | 538 |  |
  |  | 539 | public static function roles\_result\_per\_page( $roles\_per\_page ) { |
  |  | 540 | ?> |
  |  | 541 | <form id="roles\_per\_page" name="roles\_per\_page" method="post" action=""> |
  |  | 542 | <input type="hidden" name="option" value="roles\_per\_page"> |
  |  | 543 | <?php wp\_nonce\_field( 'roles\_per\_page' ); ?> |
  |  | 544 | <div class="row align-items-center"> |
  |  | 545 | <h6 style="margin-right:10px; padding-left:15px;">Number of items per page:</h6> |
  |  | 546 | <div> |
  |  | 547 | <select name="roles\_per\_page" onChange="document.getElementById('roles\_per\_page').submit()" style="width:60px;"> |
  |  | 548 | <?php |
  |  | 549 | for ( $i = 1; $i <= 5; $i++ ) { |
  |  | 550 | $value = $i \* 10; |
  |  | 551 | echo '<option value="' . esc\_attr( $value ) . '"'; |
  |  | 552 | if ( $roles\_per\_page == $value ) { |
  |  | 553 | echo ' selected '; |
  |  | 554 | } |
  |  | 555 | echo '>' . esc\_html( $value ) . '</option>'; |
  |  | 556 | } |
  |  | 557 | ?> |
  |  | 558 | </select> |
  |  | 559 | </div> |
  |  | 560 | </div> |
  |  | 561 | </form> |
  |  | 562 | <?php |
  |  | 563 | } |
  |  | 564 |  |
  |  | 565 | public static function clone\_roles\_form() { |
  |  | 566 | if ( ! array\_key\_exists( 'clone', $\_GET ) && isset( $\_GET['tab'] ) ) { |
  |  | 567 | echo '</br>'; |
  |  | 568 | global $wp\_roles; |
  |  | 569 | $papr\_custom\_roles = $wp\_roles->roles; |
  |  | 570 | $clone\_link        = admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu&tab=create\_role&clone=' ); |
  |  | 571 |  |
  |  | 572 | $papr\_custom\_roles\_first\_key = $papr\_custom\_roles; |
  |  | 573 | reset( $papr\_custom\_roles\_first\_key ); |
  |  | 574 | $first\_key        = key( $papr\_custom\_roles\_first\_key ); |
  |  | 575 | $clone\_link\_admin = $clone\_link . $first\_key . '\_clone'; |
  |  | 576 |  |
  |  | 577 | ?> |
  |  | 578 | If you want to clone a role please select the role you want to clone from dropdown and click on Clone. |
  |  | 579 | <br><br> |
  |  | 580 | Clone From : &nbsp&nbsp&nbsp |
  |  | 581 |  |
  |  | 582 | <select onchange="cloneThisRole(this.value,'<?php echo esc\_js( $clone\_link ); ?>')" style="height:25px;"> |
  |  | 583 | <?php |
  |  | 584 | foreach ( $papr\_custom\_roles as $key => $value ) { |
  |  | 585 | ?> |
  |  | 586 | <option value="<?php echo esc\_attr( $key ); ?>"><?php echo esc\_attr( $key ); ?></option> |
  |  | 587 | <?php |
  |  | 588 | } |
  |  | 589 | ?> |
  |  | 590 | </select> |
  |  | 591 | &nbsp&nbsp |
  |  | 592 | <a href="<?php echo esc\_url( $clone\_link\_admin ); ?>" id="clone\_role\_link"> |
  |  | 593 | <button class="papr-btn-cstm rounded"> |
  |  | 594 | Clone |
  |  | 595 | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 596 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  |  | 597 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  |  | 598 | </svg> |
  |  | 599 | </button> |
  |  | 600 | </a> |
  |  | 601 | </br> |
  |  | 602 | <script> |
  |  | 603 | function cloneThisRole(role\_id,clone\_link) { |
  |  | 604 | var link = clone\_link + role\_id + '\_clone'; |
  |  | 605 | document.getElementById('clone\_role\_link').href = link; |
  |  | 606 | } |
  |  | 607 | </script> |
  |  | 608 | <?php |
  |  | 609 | } |
  |  | 610 | } |
  | 611 | 611 | } |
  | 612 | 612 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-menu-settings.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-menu-settings.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-menu-settings.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-menu-settings.php?rev=2829798#L1 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-menu-settings.php?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | include\_once 'page-restriction-premium-plan.php'; |
  | 4 |  | include\_once 'page-restriction-page-access.php'; |
  | 5 |  | include\_once 'page-restriction-post-access.php'; |
  | 6 |  | include\_once 'page-restriction-custom-roles.php'; |
  | 7 |  | include\_once 'page-restriction-tag-access.php'; |
  | 8 |  | include\_once 'page-restriction-category-access.php'; |
  | 9 |  | include\_once 'page-restriction-utility.php'; |
  | 10 |  |  |
  | 11 |  | /\* Main Page Restriction Function which is called on addition of Menu and Submenu pages. |
  |  | 3 | require\_once 'page-restriction-premium-plan.php'; |
  |  | 4 | require\_once 'page-restriction-page-access.php'; |
  |  | 5 | require\_once 'page-restriction-post-access.php'; |
  |  | 6 | require\_once 'page-restriction-custom-roles.php'; |
  |  | 7 | require\_once 'page-restriction-tag-access.php'; |
  |  | 8 | require\_once 'page-restriction-category-access.php'; |
  |  | 9 | require\_once 'page-restriction-utility.php'; |
  |  | 10 |  |
  |  | 11 | /\* |
  |  | 12 | Main Page Restriction Function which is called on addition of Menu and Submenu pages. |
  | 12 | 13 | Function to display the correct page content based on the active tab. \*/ |
  | 13 |  | function papr\_page\_restriction() |
  | 14 |  | { |
  | 15 |  | $current\_tab = ""; |
  | 16 |  | if (array\_key\_exists('tab', $\_GET)) { |
  | 17 |  | $current\_tab = sanitize\_text\_field($\_GET['tab']); |
  | 18 |  | } ?> |
  | 19 |  |  |
  | 20 |  | <div class="papr-bg-main papr-margin-left"> |
  | 21 |  | <?php papr\_nav\_tab($current\_tab); ?> |
  | 22 |  | <div class="d-flex"> |
  | 23 |  | <div class="col-md-9"> |
  | 24 |  | <?php |
  | 25 |  | papr\_message\_success\_fail(); |
  | 26 |  | switch ($current\_tab) { |
  | 27 |  | case 'custom\_restriction': |
  | 28 |  | papr\_custom\_restrict(); |
  | 29 |  | break; |
  | 30 |  | case 'account\_setup': |
  | 31 |  | papr\_show\_customer\_page(); |
  | 32 |  | break; |
  | 33 |  | case 'premium\_plan': |
  | 34 |  | papr\_show\_premium\_plans(); |
  | 35 |  | break; |
  | 36 |  | case 'post\_access': |
  | 37 |  | papr\_post\_access(); |
  | 38 |  | break; |
  | 39 |  | case 'category\_access': |
  | 40 |  | papr\_category\_access(); |
  | 41 |  | break; |
  | 42 |  | case 'tag\_access': |
  | 43 |  | papr\_tag\_access(); |
  | 44 |  | break; |
  | 45 |  | default: |
  | 46 |  | papr\_page\_access(); |
  | 47 |  | break; |
  | 48 |  | } |
  | 49 |  | ?> |
  | 50 |  | <?php |
  | 51 |  | if ($current\_tab == '' || $current\_tab == 'post\_access' || $current\_tab == 'category\_access' || $current\_tab == 'tag\_access' ) { ?> |
  | 52 |  | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4 mb-4" id="restricted\_behaviour"> |
  | 53 |  | <h4 class="papr-form-head">Restricted Content Behaviour |
  | 54 |  | <div class="papr-info-global ms-2"> |
  | 55 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 56 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 57 |  | </svg> |
  | 58 |  | <p class="papr-info-text-global"> |
  | 59 |  | Choose what visitors will see if they don't have permission to view the restricted content.<a href="https://plugins.miniorange.com/guide-to-restrict-content-by-user-roles-in-wordpress#stepf" target="\_blank" >Click here to know more</a> |
  | 60 |  | </p> |
  | 61 |  | </div> |
  | 62 |  | </h4> |
  | 63 |  | <div class="papr-bg-cstm p-3 rounded mt-4"> |
  | 64 |  | <b><u> Note:</u> </b>In the free version of the plugin, the users would be shown a default error message |
  | 65 |  | <b>"Oops! You are not authorized to access this" </b> |
  | 66 |  | </div> |
  | 67 |  | <div class="d-flex mt-4"> |
  | 68 |  | <div class="papr-prem-info col-md-6 me-3"> |
  | 69 |  | <div class="papr-prem-icn" style="margin-left:20px;"><img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/lock.png" width="35px" /> |
  | 70 |  | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href=<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan')); ?> class="text-warning">Click here to upgrade</a></p> |
  | 71 |  | </div><?php papr\_display\_options\_log(); ?> |
  | 72 |  | </div> |
  | 73 |  | <div class="papr-prem-info col-md-6 "> |
  | 74 |  | <div class="papr-prem-icn papr-prem-icn-log" style="margin-left:20px;"><img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/lock.png" width="35px" /> |
  | 75 |  | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href=<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan')); ?> class="text-warning">Click here to upgrade</a></p> |
  | 76 |  | </div> <?php papr\_display\_options\_page(); ?> |
  | 77 |  | </div> |
  | 78 |  | </div> |
  | 79 |  | </div> |
  | 80 |  | <div class="col-md-3"></div> |
  | 81 |  | <?php |
  | 82 |  | } |
  | 83 |  | ?> |
  | 84 |  | </div> |
  | 85 |  |  |
  | 86 |  | <div class="col-md-3 papr\_support\_col ps-0 pe-0"> |
  | 87 |  | <?php papr\_support\_page\_restriction(); ?> |
  | 88 |  | </div> |
  | 89 |  | </div> |
  | 90 |  |  |
  | 91 |  | <div class="row"> |
  | 92 |  |  |
  | 93 |  | </div> |
  | 94 |  | </div> |
  | 95 |  | <?php |
  | 96 |  | } |
  | 97 |  |  |
  | 98 |  | function papr\_set\_active\_tab($current\_tab, $tab\_name) |
  | 99 |  | { |
  | 100 |  | if ($current\_tab == $tab\_name) { |
  | 101 |  | return 'nav-tab-active'; |
  | 102 |  | } |
  | 103 |  | return; |
  | 104 |  | } |
  | 105 |  |  |
  | 106 |  | function papr\_nav\_tab($current\_tab) |
  | 107 |  | { |
  |  | 14 | function papr\_page\_restriction() { |
  |  | 15 | $current\_tab = ''; |
  |  | 16 | if ( array\_key\_exists( 'tab', $\_GET ) ) { |
  |  | 17 | $current\_tab = sanitize\_text\_field( $\_GET['tab'] ); |
  |  | 18 | } ?> |
  |  | 19 |  |
  |  | 20 | <div class="papr-bg-main papr-margin-left"> |
  |  | 21 | <?php papr\_nav\_tab( $current\_tab ); ?> |
  |  | 22 | <div class="d-flex"> |
  |  | 23 | <div class="col-md-9"> |
  |  | 24 | <?php |
  |  | 25 | papr\_message\_success\_fail(); |
  |  | 26 | switch ( $current\_tab ) { |
  |  | 27 | case 'custom\_restriction': |
  |  | 28 | papr\_custom\_restrict(); |
  |  | 29 | break; |
  |  | 30 | case 'account\_setup': |
  |  | 31 | papr\_show\_customer\_page(); |
  |  | 32 | break; |
  |  | 33 | case 'premium\_plan': |
  |  | 34 | papr\_show\_premium\_plans(); |
  |  | 35 | break; |
  |  | 36 | case 'post\_access': |
  |  | 37 | papr\_post\_access(); |
  |  | 38 | break; |
  |  | 39 | case 'category\_access': |
  |  | 40 | papr\_category\_access(); |
  |  | 41 | break; |
  |  | 42 | case 'tag\_access': |
  |  | 43 | papr\_tag\_access(); |
  |  | 44 | break; |
  |  | 45 | default: |
  |  | 46 | papr\_page\_access(); |
  |  | 47 | break; |
  |  | 48 | } |
  |  | 49 | ?> |
  |  | 50 | <?php |
  |  | 51 | if ( $current\_tab == '' || $current\_tab == 'post\_access' || $current\_tab == 'category\_access' || $current\_tab == 'tag\_access' ) { |
  |  | 52 | ?> |
  |  | 53 | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4 mb-4" id="restricted\_behaviour"> |
  |  | 54 | <h4 class="papr-form-head">Restricted Content Behaviour |
  |  | 55 | <div class="papr-info-global ms-2"> |
  |  | 56 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 57 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 58 | </svg> |
  |  | 59 | <p class="papr-info-text-global"> |
  |  | 60 | Choose what visitors will see if they don't have permission to view the restricted content.<a href="https://plugins.miniorange.com/guide-to-restrict-content-by-user-roles-in-wordpress#stepf" target="\_blank" >Click here to know more</a> |
  |  | 61 | </p> |
  |  | 62 | </div> |
  |  | 63 | </h4> |
  |  | 64 | <div class="papr-bg-cstm p-3 rounded mt-4"> |
  |  | 65 | <b><u> Note:</u> </b>In the free version of the plugin, the users would be shown a default error message |
  |  | 66 | <b>"Oops! You are not authorized to access this" </b> |
  |  | 67 | </div> |
  |  | 68 | <div class="d-flex mt-4"> |
  |  | 69 | <div class="papr-prem-info col-md-6 me-3"> |
  |  | 70 | <div class="papr-prem-icn" style="margin-left:20px;"><img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/lock.png" width="35px" /> |
  |  | 71 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href=<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?> class="text-warning">Click here to upgrade</a></p> |
  |  | 72 | </div><?php papr\_display\_options\_log(); ?> |
  |  | 73 | </div> |
  |  | 74 | <div class="papr-prem-info col-md-6 "> |
  |  | 75 | <div class="papr-prem-icn papr-prem-icn-log" style="margin-left:20px;"><img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/lock.png" width="35px" /> |
  |  | 76 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href=<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?> class="text-warning">Click here to upgrade</a></p> |
  |  | 77 | </div> <?php papr\_display\_options\_page(); ?> |
  |  | 78 | </div> |
  |  | 79 | </div> |
  |  | 80 | </div> |
  |  | 81 | <div class="col-md-3"></div> |
  |  | 82 | <?php |
  |  | 83 | } |
  |  | 84 | ?> |
  |  | 85 | </div> |
  |  | 86 |  |
  |  | 87 | <div class="col-md-3 papr\_support\_col ps-0 pe-0"> |
  |  | 88 | <?php papr\_support\_page\_restriction(); ?> |
  |  | 89 | </div> |
  |  | 90 | </div> |
  |  | 91 |  |
  |  | 92 | <div class="row"> |
  |  | 93 |  |
  |  | 94 | </div> |
  |  | 95 | </div> |
  |  | 96 | <?php |
  |  | 97 | } |
  |  | 98 |  |
  |  | 99 | function papr\_set\_active\_tab( $current\_tab, $tab\_name ) { |
  |  | 100 | if ( $current\_tab == $tab\_name ) { |
  |  | 101 | return 'nav-tab-active'; |
  |  | 102 | } |
  |  | 103 | return; |
  |  | 104 | } |
  |  | 105 |  |
  |  | 106 | function papr\_nav\_tab( $current\_tab ) { |
  |  | 107 | ?> |
  |  | 108 | <div class="wrap shadow-cstm p-3 me-0 mt-0 mo-saml-margin-left bg-white"> |
  |  | 109 | <div class="row align-items-center"> |
  |  | 110 | <div class="col-md-5 h3 ps-3 d-flex align-items-center"> |
  |  | 111 | <img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/miniorange-logo.png" alt="" width="50px" class="me-2"> |
  |  | 112 | <span>Page and Post Restriction</span> |
  |  | 113 | </div> |
  |  | 114 | <div class="col-md-7 d-flex align-items-center justify-content-end"> |
  |  | 115 | <a id="license\_upgrade" class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" href="admin.php?page=page\_restriction&tab=premium\_plan">Premium Plans</a> |
  |  | 116 | <a class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://plugins.miniorange.com/wordpress-page-restriction-by-user-roles/">Setup Guidelines</a> |
  |  | 117 | <a class="text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://blog.miniorange.com/wordpress-page-post-restriction-addon/">Know More</a> |
  |  | 118 | </div> |
  |  | 119 | </div> |
  |  | 120 | </div> |
  |  | 121 | <div class="nav-tab-wrapper papr-bg-main papr-margin-add"> |
  |  | 122 | <a class="nav-tab papr-nav-tab ms-3 <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, '' ) ); ?>" href="admin.php?page=page\_restriction"> Page Access |
  |  | 123 | </a> |
  |  | 124 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'post\_access' ) ); ?>" href="admin.php?page=page\_restriction&tab=post\_access"> Post Access |
  |  | 125 | </a> |
  |  | 126 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'custom\_restriction' ) ); ?>" href="admin.php?page=page\_restriction&tab=custom\_restriction"> Block Access |
  |  | 127 | </a> |
  |  | 128 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'tag\_access' ) ); ?>" href="admin.php?page=page\_restriction&tab=tag\_access"> Tag Access |
  |  | 129 | </a> |
  |  | 130 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'category\_access' ) ); ?>" href="admin.php?page=page\_restriction&tab=category\_access"> Category Access |
  |  | 131 | </a> |
  |  | 132 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'custom\_role' ) ); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu"> Roles and Capabilities |
  |  | 133 | </a> |
  |  | 134 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'account\_setup' ) ); ?>" href="admin.php?page=page\_restriction&tab=account\_setup"> Account Setup |
  |  | 135 | </a> |
  |  | 136 | <a class="nav-tab papr-nav-tab <?php echo esc\_attr( papr\_set\_active\_tab( $current\_tab, 'premium\_plan' ) ); ?>" href="admin.php?page=page\_restriction&tab=premium\_plan"> Licensing Plans |
  |  | 137 | </a> |
  |  | 138 | </div> |
  |  | 139 | <?php |
  |  | 140 | } |
  |  | 141 |  |
  |  | 142 | function papr\_custom\_restrict() { |
  |  | 143 | ?> |
  |  | 144 | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4"> |
  |  | 145 | <h4 class="papr-form-head">Give Access to Blocks in a page to only Logged in Users</h4> |
  |  | 146 | <div class="papr-bg-cstm p-3 rounded mt-4"> |
  |  | 147 | <h5>Use the shortcode [restrict\_content] [/restrict\_content] to restrict any content between it.</h5> |
  |  | 148 | <p class="mt-3"> |
  |  | 149 | If you want to <b>allow only logged in users to view specific content on a page</b>, then you can use the shortcode [restrict\_content] to do so.<br> |
  |  | 150 | Content between the opening tag [restrict\_content] and closing tag [restrict\_content] will not be visible to users who are not logged in. Users can view such content only after the user is logged in. |
  |  | 151 | </p> |
  |  | 152 | </div> |
  |  | 153 | <br> |
  |  | 154 |  |
  |  | 155 | <div class="row"> |
  |  | 156 | <div class="col-md-6"> |
  |  | 157 | <h6>Page Content</h6> |
  |  | 158 | <textarea id="papr-block-textarea" placeholder="Enter your content here to see how the shortcode would work.." |
  |  | 159 | class="papr-editor-block"><?php echo "Hi there, sentence 1 is not restricted. \r\n[restrict\_content] Hi, this sentence is restricted. [/restrict\_content] \r\nLast sentence is also not restricted."; ?> |
  |  | 160 | </textarea> |
  |  | 161 | </div> |
  |  | 162 | <div class="col-md-6"> |
  |  | 163 | <h6>Content shown to a user who is not logged-in</h6> |
  |  | 164 | <textarea id="papr-block-preview" class="papr-editor-block" readonly><?php echo 'Hi there, sentence 1 is not restricted. Last sentence is also not restricted.'; ?> |
  |  | 165 | </textarea> |
  |  | 166 | </div> |
  |  | 167 | </div> |
  |  | 168 |  |
  |  | 169 | <div style="text-align: center"><button class="papr-btn-cstm rounded mt-3" onclick="papr\_block\_preview()">Preview</button></div> |
  |  | 170 | <br> |
  |  | 171 | <div class="papr-prem-info"> |
  |  | 172 | <div class="papr-prem-icn" style="margin-left:31em;"><img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/lock.png" width="35px" /> |
  |  | 173 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?>">Click here to upgrade</a></p> |
  |  | 174 | </div> |
  |  | 175 | <div class="row"> |
  |  | 176 | <div class="col-md-4"><h6>Enter Custom Error message: </h6></div> |
  |  | 177 | <div class="col-md-8"><input style="width:90%" type="text" placeholder="Eg: You are not allowed to view this content!" disabled></div> |
  |  | 178 | </div> |
  |  | 179 | <div class="row"> |
  |  | 180 | <div class="col-md-4"></div> |
  |  | 181 | <div class="col-md-8"><p><b>Note:</b> This error message would be shown to logged out users in place of the restricted content.</p></div> |
  |  | 182 | </div> |
  |  | 183 | </div> |
  |  | 184 | </div> |
  |  | 185 |  |
  |  | 186 | <script> |
  |  | 187 | function papr\_block\_preview() { |
  |  | 188 | let text = document.getElementById("papr-block-textarea").value; |
  |  | 189 |  |
  |  | 190 | if(text.includes("[restrict\_content]") && text.includes("[/restrict\_content]")) { |
  |  | 191 |  |
  |  | 192 | const start\_shortcode = text.indexOf('[restrict\_content]'); |
  |  | 193 | const end\_shortcode = text.indexOf('[/restrict\_content]') + 19; |
  |  | 194 |  |
  |  | 195 | const before\_restriction = text.substring(0, start\_shortcode); |
  |  | 196 | const after\_restriction = text.substring(end\_shortcode); |
  |  | 197 | document.getElementById("papr-block-preview").innerText = before\_restriction + after\_restriction; |
  |  | 198 | } |
  |  | 199 | else { |
  |  | 200 | document.getElementById("papr-block-preview").innerText = text; |
  |  | 201 | } |
  |  | 202 |  |
  |  | 203 | } |
  |  | 204 | </script> |
  |  | 205 | <?php |
  |  | 206 | } |
  |  | 207 |  |
  |  | 208 | function papr\_support\_page\_restriction() { |
  |  | 209 | $admin\_email = get\_option( 'papr\_admin\_email' ); |
  |  | 210 | $admin\_email = $admin\_email != '' ? $admin\_email : ''; |
  |  | 211 |  |
  |  | 212 | ?> |
  |  | 213 | <div class="rounded bg-white papr-shadow p-4 ms-3 mb-4 me-3 mt-4"> |
  |  | 214 | <div> |
  |  | 215 | <h4>Support/Contact Us</h4> |
  |  | 216 | <hr> |
  |  | 217 | <p>Need any help? We can help you with configuring your Page Restriction Plugin. Just send us a query and we will get back to you soon.</p> |
  |  | 218 | <form method="post" action=""> |
  |  | 219 | <?php wp\_nonce\_field( 'papr\_contact\_us\_query\_option' ); ?> |
  |  | 220 | <input type="hidden" name="option" value="papr\_contact\_us\_query\_option"> |
  |  | 221 | <table style="width:100%"> |
  |  | 222 | <tr> |
  |  | 223 | <td> |
  |  | 224 | <input class="w-100" type="email" required name="papr\_contact\_us\_email" value="<?php echo esc\_attr( $admin\_email ); ?>" placeholder="Enter your email"> |
  |  | 225 | </td> |
  |  | 226 | </tr> |
  |  | 227 | <tr> |
  |  | 228 | <td> |
  |  | 229 | <input type="tel" class="w-100 mt-4" id="contact\_us\_phone" pattern="[\+]\d{11,14}|[\+]\d{1,4}[\s]\d{9,10}" name="papr\_contact\_us\_phone" value="<?php echo esc\_attr( get\_option( 'papr\_admin\_phone' ) ); ?>" placeholder="Enter your phone"> |
  |  | 230 | </td> |
  |  | 231 | </tr> |
  |  | 232 | <tr> |
  |  | 233 | <td> |
  |  | 234 | <textarea class="w-100 mt-4" placeholder="Write your query here" onkeypress="papr\_valid\_query(this)" onkeyup="papr\_valid\_query(this)" onblur="papr\_valid\_query(this)" required name="papr\_contact\_us\_query" rows="4" style="resize: vertical;"></textarea> |
  |  | 235 | </td> |
  |  | 236 | </tr> |
  |  | 237 | </table> |
  |  | 238 | <div style="text-align:center;"> |
  |  | 239 | <input type="submit" name="submit" class="papr-btn-cstm rounded mt-3" /> |
  |  | 240 | </div> |
  |  | 241 | </form> |
  |  | 242 | <br> |
  |  | 243 | </div> |
  |  | 244 | </div> |
  |  | 245 | <script> |
  |  | 246 | jQuery("#contact\_us\_phone").intlTelInput(); |
  |  | 247 | jQuery("#phone\_contact").intlTelInput(); |
  |  | 248 |  |
  |  | 249 | function papr\_valid\_query(f) { |
  |  | 250 | !(/^[a-zA-Z?,.\(\)\/@ 0-9]\*$/).test(f.value) ? f.value = f.value.replace( |
  |  | 251 | /[^a-zA-Z?,.\(\)\/@ 0-9]/, '') : null; |
  |  | 252 | } |
  |  | 253 | </script> |
  |  | 254 | <?php |
  |  | 255 | } |
  |  | 256 |  |
  |  | 257 | function papr\_show\_customer\_page() { |
  |  | 258 | if ( papr\_is\_customer\_registered() ) { |
  |  | 259 | papr\_show\_customer\_details(); |
  |  | 260 | } else { |
  |  | 261 | if ( get\_option( 'papr\_verify\_customer' ) == 'true' ) { |
  |  | 262 | papr\_show\_verify\_password\_page(); |
  |  | 263 | } else { |
  |  | 264 | papr\_show\_new\_registration\_page(); |
  |  | 265 | } |
  |  | 266 | } |
  |  | 267 | } |
  |  | 268 |  |
  |  | 269 | // Display options for the customer to choose from when user is restricted |
  |  | 270 | function papr\_display\_options\_page() { |
  |  | 271 | ?> |
  |  | 272 | <h4 class="papr-form-head">Restrict Options before Login |
  |  | 273 |  |
  |  | 274 | </h4> |
  |  | 275 | <div class="pt-3"> |
  |  | 276 | <table> |
  |  | 277 | <tr style="margin-bottom:7%;"> |
  |  | 278 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" disabled> |
  |  | 279 | <b>Redirect to Login Page</b> |
  |  | 280 | <br><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to WP Login Page. </p> |
  |  | 281 | </tr> |
  |  | 282 | <tr> |
  |  | 283 | <td width="60%" style="padding-bottom:6px;"> |
  |  | 284 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_page" disabled> |
  |  | 285 | <b>Redirect to Page Link</b> |
  |  | 286 | </td> |
  |  | 287 | </tr> |
  |  | 288 | <tr> |
  |  | 289 | <td colsapn="2"> |
  |  | 290 | <input type="url" style="width:90%;cursor: not-allowed;" name="mo\_display\_page\_url" id="mo\_page\_url" disabled placeholder="Enter URL of the page"> |
  |  | 291 | <td> |
  |  | 292 | <button style="cursor: not-allowed; width: 180px;" class="btn papr-btn-cstm rounded" disabled value = "" placeholder = " Enter URL of the page"> |
  |  | 293 | Save & Test URL |
  |  | 294 | </button> |
  |  | 295 | </td> |
  |  | 296 | </td> |
  |  | 297 | </tr> |
  |  | 298 | <tr class="mt-3"> |
  |  | 299 | <td colspan="3"> |
  |  | 300 | <p class="papr-bg-cstm p-3 h6 mt-3"><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to the given page URL.<br> |
  |  | 301 | <font color="#8b008b">Please provide a valid URL and make sure that the given page is not Restricted</font> |
  |  | 302 | </p> |
  |  | 303 | </td> |
  |  | 304 | </tr> |
  |  | 305 |  |
  |  | 306 | <tr> |
  |  | 307 | <td style="padding-bottom:6px;" width="70%"> |
  |  | 308 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_message" disabled> |
  |  | 309 | <b>Message on display</b><br> |
  |  | 310 | </td> |
  |  | 311 | </tr> |
  |  | 312 | <tr> |
  |  | 313 | <td> |
  |  | 314 | <input type="text" style="width:90%;cursor:not-allowed;" name="mo\_display\_message\_text" disabled="" value="" placeholder="Oops! You are not authorized to access this." /> |
  |  | 315 | <td> |
  |  | 316 | <button style="cursor: not-allowed;" class="btn papr-btn-cstm rounded" disabled> Save & Preview</button> |
  |  | 317 | </td> |
  |  | 318 | </td> |
  |  | 319 | </tr> |
  |  | 320 | <tr> |
  |  | 321 | <td colspan="2"> |
  |  | 322 | <b>Note </b>: Enabling this option will display the configured message to the restricted users. |
  |  | 323 | </td> |
  |  | 324 | </tr> |
  |  | 325 | <tr style="margin-bottom:7%;"> |
  |  | 326 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" disabled> |
  |  | 327 | <b>Single Sign On </b> |
  |  | 328 | <br> |
  |  | 329 | <b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to IDP login page.</p> |
  |  | 330 |  |
  |  | 331 | </tr> |
  |  | 332 | </table> |
  |  | 333 | <br><br> |
  |  | 334 | </div> |
  |  | 335 |  |
  |  | 336 | <?php |
  |  | 337 | } |
  |  | 338 |  |
  |  | 339 | function papr\_display\_options\_log() { |
  |  | 340 | ?> |
  |  | 341 |  |
  |  | 342 | <h4 class="papr-form-head">Restrict Options after Login</h4> |
  |  | 343 | <div class="pt-3"> |
  |  | 344 | <input type="hidden" style="cursor: not-allowed;" name="option" value="mo\_display\_option\_login\_log"> |
  |  | 345 | <table> |
  |  | 346 | <tr> |
  |  | 347 | <td colspan="2" style="padding-bottom:6px"> |
  |  | 348 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_page\_log" disabled> |
  |  | 349 | <b>Redirect to Page Link</b> |
  |  | 350 | </td> |
  |  | 351 | </tr> |
  |  | 352 | <tr> |
  |  | 353 | <td width="80%" colspan="2"> |
  |  | 354 | <input type="url" name="mo\_display\_page\_url\_log" style="width:90%;cursor:not-allowed;" id="mo\_page\_url" disabled placeholder="Enter URL of the page" /> |
  |  | 355 | <td><b> |
  |  | 356 | <button style="cursor: not-allowed;width:180px;" class="btn papr-btn-cstm rounded" disabled>Save & Test URL</button> |
  |  | 357 | </td> |
  |  | 358 | </td> |
  |  | 359 | </tr> |
  |  | 360 |  |
  |  | 361 | <tr> |
  |  | 362 | <td colspan="3"> |
  |  | 363 | <br><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to the given page URL. |
  |  | 364 | <br> |
  |  | 365 | <font color="#8b008b">Please provide a valid URL and make sure that the given page is not Restricted</font> |
  |  | 366 | </td> |
  |  | 367 | </tr> |
  |  | 368 | <tr> |
  |  | 369 | <td> |
  |  | 370 | <br> |
  |  | 371 | </td> |
  |  | 372 | </tr> |
  |  | 373 | <tr> |
  |  | 374 | <td style="padding-bottom:6px"> |
  |  | 375 | <input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_message\_log" disabled> |
  |  | 376 | <b>Message on display</b> |
  |  | 377 | </td> |
  |  | 378 | </tr> |
  |  | 379 | <tr> |
  |  | 380 | <td colspan="2"> |
  |  | 381 | <input type="text" name="mo\_display\_message\_text\_log" style="width:90%; cursor:not-allowed;" disabled value="" placeholder="Oops! You are not authorized to access this."> |
  |  | 382 | <td> |
  |  | 383 | <button style="cursor: not-allowed;" class="btn papr-btn-cstm rounded" disabled>Save & Preview</button> |
  |  | 384 | </td> |
  |  | 385 | </td> |
  |  | 386 | </tr> |
  |  | 387 | <tr> |
  |  | 388 | <td colspan="3"> |
  |  | 389 | <br> |
  |  | 390 | <b>Note </b>: Enabling this option will display the configured message to the restricted users. |
  |  | 391 | </td> |
  |  | 392 | </tr> |
  |  | 393 | </table> |
  |  | 394 | <br><br> |
  |  | 395 | </div> |
  |  | 396 |  |
  |  | 397 | <?php |
  |  | 398 | } |
  |  | 399 |  |
  |  | 400 | function papr\_is\_customer\_registered() { |
  |  | 401 |  |
  |  | 402 | $email       = get\_option( 'papr\_admin\_email' ); |
  |  | 403 | $customerKey = get\_option( 'papr\_admin\_customer\_key' ); |
  |  | 404 | if ( ! $email || ! $customerKey || ! is\_numeric( trim( $customerKey ) ) ) { |
  |  | 405 | return 0; |
  |  | 406 | } |
  |  | 407 | return 1; |
  |  | 408 | } |
  |  | 409 |  |
  |  | 410 | function papr\_show\_customer\_details() { |
  |  | 411 | ?> |
  |  | 412 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 413 | <h2>Thank you for registering with miniOrange.</h2> |
  |  | 414 | <div style="padding: 10px;"> |
  |  | 415 | <table border="1" style="background-color:#FFFFFF; border:1px solid #CCCCCC; border-collapse: collapse; margin-bottom:15px; width:85%"> |
  |  | 416 | <tr> |
  |  | 417 | <td style="width:45%; padding: 10px;">miniOrange Account Email</td> |
  |  | 418 | <td style="width:55%; padding: 10px;"><?php echo esc\_attr( get\_option( 'papr\_admin\_email' ) ); ?></td> |
  |  | 419 | </tr> |
  |  | 420 | <tr> |
  |  | 421 | <td style="width:45%; padding: 10px;">Customer ID</td> |
  |  | 422 | <td style="width:55%; padding: 10px;"><?php echo esc\_attr( get\_option( 'papr\_admin\_customer\_key' ) ); ?></td> |
  |  | 423 | </tr> |
  |  | 424 | </table> |
  |  | 425 |  |
  |  | 426 | <table> |
  |  | 427 | <tr> |
  |  | 428 | <td> |
  |  | 429 | <form name="f1" method="post" action="" id="papr\_goto\_login\_form"> |
  |  | 430 | <?php wp\_nonce\_field( 'papr\_change\_miniorange' ); ?> |
  |  | 431 | <input type="hidden" value="papr\_change\_miniorange" name="option" /> |
  |  | 432 | <input type="submit" value="Change Email Address" class="btn papr-btn-cstm rounded" /> |
  |  | 433 | </form> |
  |  | 434 | </td> |
  |  | 435 | <td> |
  |  | 436 | <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?>"><input type="button" class="btn papr-btn-cstm rounded" value="Check Premium Plans" /></a> |
  |  | 437 | </td> |
  |  | 438 | </tr> |
  |  | 439 | </table> |
  |  | 440 | </div> |
  |  | 441 | <br> |
  |  | 442 | </div> |
  |  | 443 |  |
  |  | 444 | <?php |
  |  | 445 | } |
  |  | 446 |  |
  |  | 447 | function papr\_show\_new\_registration\_page() { |
  |  | 448 | update\_option( 'papr\_new\_registration', 'true' ); |
  |  | 449 | ?> |
  |  | 450 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 451 | <form name="f" method="post" action=""> |
  |  | 452 | <?php wp\_nonce\_field( 'papr\_register\_customer' ); ?> |
  |  | 453 | <input type="hidden" name="option" value="papr\_register\_customer"> |
  |  | 454 | <h4 class="papr-form-head">Register with miniOrange</h4> |
  |  | 455 |  |
  |  | 456 | <div id="help\_register\_desc" class="papr-bg-cstm p-3 rounded mt-4 text-center"> |
  |  | 457 | <h5>Why should I register?</h5> |
  |  | 458 | <p class="papr-p-text">You should register so that in case you need help, we can help you with step by step instructions. <b>You will also need a miniOrange account to upgrade to the premium version of the plugin.</b> We do not store any information except the email that you will use to register with us.</p> |
  |  | 459 | </div> |
  |  | 460 | <div class="row mt-4"> |
  |  | 461 | <div class="col-md-3"> |
  |  | 462 | <h6>Email :</h6> |
  |  | 463 | </div> |
  |  | 464 | <div class="col-md-6"> |
  |  | 465 | <input class="mo\_saml\_table\_textbox" style="width:100%" type="email" name="email" required placeholder="person@example.com" value="<?php echo ( get\_option( 'papr\_admin\_email' ) == '' ) ? esc\_attr( get\_option( 'admin\_email' ) ) : esc\_attr( get\_option( 'papr\_admin\_email' ) ); ?>" /> |
  |  | 466 | </div> |
  |  | 467 | </div> |
  |  | 468 | <div class="row mt-4"> |
  |  | 469 | <div class="col-md-3"> |
  |  | 470 | <h6>Password :</h6> |
  |  | 471 | </div> |
  |  | 472 | <div class="col-md-6"> |
  |  | 473 | <input class="mo\_saml\_table\_textbox" style="width:100%" required type="password" name="password" placeholder="Choose your password (Min. length 6)" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present." /> |
  |  | 474 | </div> |
  |  | 475 | </div> |
  |  | 476 | <div class="row mt-4"> |
  |  | 477 | <div class="col-md-3"> |
  |  | 478 | <h6>Confirm Password :</h6> |
  |  | 479 | </div> |
  |  | 480 | <div class="col-md-6"> |
  |  | 481 | <input class="mo\_saml\_table\_textbox" style="width:100%" required type="password" name="confirmPassword" placeholder="Confirm your password" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present."> |
  |  | 482 | </div> |
  |  | 483 | </div> |
  |  | 484 | <div class="row mt-4"> |
  |  | 485 | <div class="col-md-3"></div> |
  |  | 486 | <div class="col-md-9"> |
  |  | 487 | <input type="submit" name="submit" value="Register" class="btn papr-btn-cstm rounded" /> |
  |  | 488 | <input type="button" name="papr\_goto\_login" id="papr\_goto\_login" value="Already have an account?" class="btn papr-btn-cstm rounded" /> |
  |  | 489 | </div> |
  |  | 490 | </div> |
  |  | 491 | </form> |
  |  | 492 | </div> |
  |  | 493 | <form name="f1" method="post" action="" id="papr\_goto\_login\_form"> |
  |  | 494 | <?php wp\_nonce\_field( 'papr\_goto\_login' ); ?> |
  |  | 495 | <input type="hidden" name="option" value="papr\_goto\_login" /> |
  |  | 496 | </form> |
  |  | 497 |  |
  |  | 498 | <script> |
  |  | 499 | jQuery('#papr\_goto\_login').click(function() { |
  |  | 500 | jQuery('#papr\_goto\_login\_form').submit(); |
  |  | 501 | }); |
  |  | 502 | </script> |
  |  | 503 | <?php |
  |  | 504 | } |
  |  | 505 |  |
  |  | 506 | function papr\_show\_verify\_password\_page() { |
  |  | 507 | ?> |
  |  | 508 | <form name="f" method="post" action=""> |
  |  | 509 | <?php wp\_nonce\_field( 'papr\_verify\_customer' ); ?> |
  |  | 510 | <input type="hidden" name="option" value="papr\_verify\_customer"> |
  |  | 511 | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4"> |
  |  | 512 | <h4 class="papr-form-head">Login with miniOrange</h4> |
  |  | 513 |  |
  |  | 514 | <div class="papr-bg-cstm p-3 rounded mt-4 text-center"> |
  |  | 515 | <p class="papr-p-text"> |
  |  | 516 | <b>It seems you already have an account with miniOrange. Please enter your miniOrange email and password. |
  |  | 517 | <br><a target="\_blank" href="https://login.xecurify.com/moas/idp/resetpassword">Click here if you forgot your password?</a> |
  |  | 518 | </b> |
  |  | 519 | </p> |
  |  | 520 | </div> |
  |  | 521 | <div class="row mt-4"> |
  |  | 522 | <div class="col-md-3"> |
  |  | 523 | <h6>Email :</h6> |
  |  | 524 | </div> |
  |  | 525 | <div class="col-md-6"> |
  |  | 526 | <input class="mo\_saml\_table\_textbox w-75" type="email" name="email" required placeholder="person@example.com" value="<?php echo esc\_attr( get\_option( 'papr\_admin\_email' ) ); ?>" /> |
  |  | 527 | </div> |
  |  | 528 | </div> |
  |  | 529 | <div class="row mt-4"> |
  |  | 530 | <div class="col-md-3"> |
  |  | 531 | <h6>Password :</h6> |
  |  | 532 | </div> |
  |  | 533 | <div class="col-md-6"> |
  |  | 534 | <input class="mo\_saml\_table\_textbox w-75" required type="password" name="password" placeholder="Enter your password" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present."> |
  |  | 535 | </div> |
  |  | 536 | </div> |
  |  | 537 | <div class="row mt-4"> |
  |  | 538 | <div class="col-md-3"></div> |
  |  | 539 | <div class="col-md-9"> |
  |  | 540 | <input type="submit" name="submit" value="Login" class="btn papr-btn-cstm rounded" /> |
  |  | 541 | <input type="button" name="papr\_goback" id="papr\_goback" value="Sign Up" class="btn papr-btn-cstm rounded" /> |
  |  | 542 | </div> |
  |  | 543 | </div> |
  |  | 544 |  |
  |  | 545 | </div> |
  |  | 546 | </form> |
  |  | 547 |  |
  |  | 548 | <form name="f" method="post" action="" id="papr\_goback\_form"> |
  |  | 549 | <?php wp\_nonce\_field( 'papr\_go\_back' ); ?> |
  |  | 550 | <input type="hidden" name="option" value="papr\_go\_back" /> |
  |  | 551 | </form> |
  |  | 552 | <form name="f" method="post" action="" id="papr\_forgotpassword\_form"> |
  |  | 553 | <?php wp\_nonce\_field( 'papr\_forgot\_password\_form\_option' ); ?> |
  |  | 554 | <input type="hidden" name="option" value="papr\_forgot\_password\_form\_option" /> |
  |  | 555 | </form> |
  |  | 556 | <script> |
  |  | 557 | jQuery('#papr\_goback').click(function() { |
  |  | 558 | jQuery('#papr\_goback\_form').submit(); |
  |  | 559 | }); |
  |  | 560 | jQuery("a[href=\"#papr\_forgot\_password\_link\"]").click(function() { |
  |  | 561 | jQuery('#papr\_forgotpassword\_form').submit(); |
  |  | 562 | }); |
  |  | 563 | </script> |
  |  | 564 | <?php |
  |  | 565 | } |
  |  | 566 |  |
  |  | 567 | function papr\_in\_array( $var, $arr ) { |
  |  | 568 | return is\_array( $arr ) && in\_array( $var, $arr ); |
  |  | 569 | } |
  |  | 570 |  |
  | 108 | 571 | ?> |
  | 109 |  | ~~<div class="wrap shadow-cstm p-3 me-0 mt-0 mo-saml-margin-left bg-white">~~ |
  | 110 |  | ~~<div class="row align-items-center">~~ |
  | 111 |  | ~~<div class="col-md-5 h3 ps-3 d-flex align-items-center">~~ |
  | 112 |  | ~~<img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/miniorange-logo.png" alt="" width="50px" class="me-2">~~ |
  | 113 |  | ~~<span>Page and Post Restriction</span>~~ |
  | 114 |  | ~~</div>~~ |
  | 115 |  | ~~<div class="col-md-7 d-flex align-items-center justify-content-end">~~ |
  | 116 |  | ~~<a id="license\_upgrade" class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" href="admin.php?page=page\_restriction&tab=premium\_plan">Premium Plans</a>~~ |
  | 117 |  | ~~<a class="me-3 text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://plugins.miniorange.com/wordpress-page-restriction-by-user-roles/">Setup Guidelines</a>~~ |
  | 118 |  | ~~<a class="text-white ps-5 pe-5 pt-3 pb-3 papr-prem-btn" target="\_blank" href="https://blog.miniorange.com/wordpress-page-post-restriction-addon/">Know More</a>~~ |
  | 119 |  | ~~</div>~~ |
  | 120 |  | ~~</div>~~ |
  | 121 |  | ~~</div>~~ |
  | 122 |  | ~~<div class="nav-tab-wrapper papr-bg-main">~~ |
  | 123 |  | ~~<a class="nav-tab papr-nav-tab ms-3 <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, '')); ?>" href="admin.php?page=page\_restriction"> Page Access~~ |
  | 124 |  | ~~</a>~~ |
  | 125 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'post\_access')); ?>" href="admin.php?page=page\_restriction&tab=post\_access"> Post Access~~ |
  | 126 |  | ~~</a>~~ |
  | 127 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'custom\_restriction')); ?>" href="admin.php?page=page\_restriction&tab=custom\_restriction"> Block Access~~ |
  | 128 |  | ~~</a>~~ |
  | 129 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'tag\_access')); ?>" href="admin.php?page=page\_restriction&tab=tag\_access"> Tag Access~~ |
  | 130 |  | ~~</a>~~ |
  | 131 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'category\_access')); ?>" href="admin.php?page=page\_restriction&tab=category\_access"> Category Access~~ |
  | 132 |  | ~~</a>~~ |
  | 133 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'custom\_role')); ?>" href="admin.php?page=papr\_custom\_roles\_sub\_menu"> Roles and Capabilities~~ |
  | 134 |  | ~~</a>~~ |
  | 135 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'account\_setup')); ?>" href="admin.php?page=page\_restriction&tab=account\_setup"> Account Setup~~ |
  | 136 |  | ~~</a>~~ |
  | 137 |  | ~~<a class="nav-tab papr-nav-tab <?php echo esc\_attr(papr\_set\_active\_tab($current\_tab, 'premium\_plan')); ?>" href="admin.php?page=page\_restriction&tab=premium\_plan"> Licensing Plans~~ |
  | 138 |  | ~~</a>~~ |
  | 139 |  | ~~</div>~~ |
  | 140 |  | ~~<?php~~ |
  | 141 |  | ~~}~~ |
  | 142 |  |  |
  | 143 |  | ~~function papr\_custom\_restrict()~~ |
  | 144 |  | ~~{~~ |
  | 145 |  | ~~?>~~ |
  | 146 |  | ~~<div class="rounded bg-white papr-shadow p-4 mt-4 ms-4">~~ |
  | 147 |  | ~~<h4 class="papr-form-head">Give Access to Blocks in a page to only Logged in Users</h4>~~ |
  | 148 |  | ~~<div class="papr-bg-cstm p-3 rounded mt-4">~~ |
  | 149 |  | ~~<h5>Use the shortcode [restrict\_content] [/restrict\_content] to restrict any content between it.</h5>~~ |
  | 150 |  | ~~<p class="mt-3">~~ |
  | 151 |  | ~~If you want to <b>allow only logged in users to view specific content on a page</b>, then you can use the shortcode [restrict\_content] to do so.<br>~~ |
  | 152 |  | ~~Content between the opening tag [restrict\_content] and closing tag [restrict\_content] will not be visible to users who are not logged in. Users can view such content only after the user is logged in.~~ |
  | 153 |  | ~~</p>~~ |
  | 154 |  | ~~</div>~~ |
  | 155 |  | ~~<br>~~ |
  | 156 |  |  |
  | 157 |  | ~~<div class="row">~~ |
  | 158 |  | ~~<div class="col-md-6">~~ |
  | 159 |  | ~~<h6>Page Content</h6>~~ |
  | 160 |  | ~~<textarea id="papr-block-textarea" placeholder="Enter your content here to see how the shortcode would work.."~~ |
  | 161 |  | ~~class="papr-editor-block"><?php echo "Hi there, sentence 1 is not restricted. \r\n[restrict\_content] Hi, this sentence is restricted. [/restrict\_content] \r\nLast sentence is also not restricted." ?>~~ |
  | 162 |  | ~~</textarea>~~ |
  | 163 |  | ~~</div>~~ |
  | 164 |  | ~~<div class="col-md-6">~~ |
  | 165 |  | ~~<h6>Content shown to a user who is not logged-in</h6>~~ |
  | 166 |  | ~~<textarea id="papr-block-preview" class="papr-editor-block" readonly><?php echo "Hi there, sentence 1 is not restricted. Last sentence is also not restricted." ?>~~ |
  | 167 |  | ~~</textarea>~~ |
  | 168 |  | ~~</div>~~ |
  | 169 |  | ~~</div>~~ |
  | 170 |  |  |
  | 171 |  | ~~<div style="text-align: center"><button class="papr-btn-cstm rounded mt-3" onclick="papr\_block\_preview()">Preview</button></div>~~ |
  | 172 |  | ~~<br>~~ |
  | 173 |  | ~~<div class="papr-prem-info">~~ |
  | 174 |  | ~~<div class="papr-prem-icn" style="margin-left:31em;"><img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/lock.png" width="35px" />~~ |
  | 175 |  | ~~<p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan')); ?>">Click here to upgrade</a></p>~~ |
  | 176 |  | ~~</div>~~ |
  | 177 |  | ~~<div class="row">~~ |
  | 178 |  | ~~<div class="col-md-4"><h6>Enter Custom Error message: </h6></div>~~ |
  | 179 |  | ~~<div class="col-md-8"><input style="width:90%" type="text" placeholder="Eg: You are not allowed to view this content!" disabled></div>~~ |
  | 180 |  | ~~</div>~~ |
  | 181 |  | ~~<div class="row">~~ |
  | 182 |  | ~~<div class="col-md-4"></div>~~ |
  | 183 |  | ~~<div class="col-md-8"><p><b>Note:</b> This error message would be shown to logged out users in place of the restricted content.</p></div>~~ |
  | 184 |  | ~~</div>~~ |
  | 185 |  | ~~</div>~~ |
  | 186 |  | ~~</div>~~ |
  | 187 |  |  |
  | 188 |  | ~~<script>~~ |
  | 189 |  | ~~function papr\_block\_preview() {~~ |
  | 190 |  | ~~let text = document.getElementById("papr-block-textarea").value;~~ |
  | 191 |  |  |
  | 192 |  | ~~if(text.includes("[restrict\_content]") && text.includes("[/restrict\_content]")) {~~ |
  | 193 |  |  |
  | 194 |  | ~~const start\_shortcode = text.indexOf('[restrict\_content]');~~ |
  | 195 |  | ~~const end\_shortcode = text.indexOf('[/restrict\_content]') + 19;~~ |
  | 196 |  |  |
  | 197 |  | ~~const before\_restriction = text.substring(0, start\_shortcode);~~ |
  | 198 |  | ~~const after\_restriction = text.substring(end\_shortcode);~~ |
  | 199 |  | ~~document.getElementById("papr-block-preview").innerText = before\_restriction + after\_restriction;~~ |
  | 200 |  | ~~}~~ |
  | 201 |  | ~~else {~~ |
  | 202 |  | ~~document.getElementById("papr-block-preview").innerText = text;~~ |
  | 203 |  | ~~}~~ |
  | 204 |  |  |
  | 205 |  | ~~}~~ |
  | 206 |  | ~~</script>~~ |
  | 207 |  | ~~<?php~~ |
  | 208 |  | ~~}~~ |
  | 209 |  |  |
  | 210 |  | ~~function papr\_support\_page\_restriction()~~ |
  | 211 |  | ~~{~~ |
  | 212 |  | ~~$admin\_email = get\_option("papr\_admin\_email");~~ |
  | 213 |  | ~~$admin\_email = $admin\_email!=""? $admin\_email: "";~~ |
  | 214 |  |  |
  | 215 |  | ~~?>~~ |
  | 216 |  | ~~<div class="rounded bg-white papr-shadow p-4 ms-3 mb-4 me-3 mt-4">~~ |
  | 217 |  | ~~<div>~~ |
  | 218 |  | ~~<h4>Support/Contact Us</h4>~~ |
  | 219 |  | ~~<hr>~~ |
  | 220 |  | ~~<p>Need any help? We can help you with configuring your Page Restriction Plugin. Just send us a query and we will get back to you soon.</p>~~ |
  | 221 |  | ~~<form method="post" action="">~~ |
  | 222 |  | ~~<?php wp\_nonce\_field("papr\_contact\_us\_query\_option"); ?>~~ |
  | 223 |  | ~~<input type="hidden" name="option" value="papr\_contact\_us\_query\_option">~~ |
  | 224 |  | ~~<table style="width:100%">~~ |
  | 225 |  | ~~<tr>~~ |
  | 226 |  | ~~<td>~~ |
  | 227 |  | ~~<input class="w-100" type="email" required name="papr\_contact\_us\_email" value="<?php echo esc\_attr($admin\_email) ?>" placeholder="Enter your email">~~ |
  | 228 |  | ~~</td>~~ |
  | 229 |  | ~~</tr>~~ |
  | 230 |  | ~~<tr>~~ |
  | 231 |  | ~~<td>~~ |
  | 232 |  | ~~<input type="tel" class="w-100 mt-4" id="contact\_us\_phone" pattern="[\+]\d{11,14}|[\+]\d{1,4}[\s]\d{9,10}" name="papr\_contact\_us\_phone" value="<?php echo esc\_attr(get\_option('papr\_admin\_phone')); ?>" placeholder="Enter your phone">~~ |
  | 233 |  | ~~</td>~~ |
  | 234 |  | ~~</tr>~~ |
  | 235 |  | ~~<tr>~~ |
  | 236 |  | ~~<td>~~ |
  | 237 |  | ~~<textarea class="w-100 mt-4" placeholder="Write your query here" onkeypress="papr\_valid\_query(this)" onkeyup="papr\_valid\_query(this)" onblur="papr\_valid\_query(this)" required name="papr\_contact\_us\_query" rows="4" style="resize: vertical;"></textarea>~~ |
  | 238 |  | ~~</td>~~ |
  | 239 |  | ~~</tr>~~ |
  | 240 |  | ~~</table>~~ |
  | 241 |  | ~~<div style="text-align:center;">~~ |
  | 242 |  | ~~<input type="submit" name="submit" class="papr-btn-cstm rounded mt-3" />~~ |
  | 243 |  | ~~</div>~~ |
  | 244 |  | ~~</form>~~ |
  | 245 |  | ~~<br>~~ |
  | 246 |  | ~~</div>~~ |
  | 247 |  | ~~</div>~~ |
  | 248 |  | ~~<script>~~ |
  | 249 |  | ~~jQuery("#contact\_us\_phone").intlTelInput();~~ |
  | 250 |  | ~~jQuery("#phone\_contact").intlTelInput();~~ |
  | 251 |  |  |
  | 252 |  | ~~function papr\_valid\_query(f) {~~ |
  | 253 |  | ~~!(/^[a-zA-Z?,.\(\)\/@ 0-9]\*$/).test(f.value) ? f.value = f.value.replace(~~ |
  | 254 |  | ~~/[^a-zA-Z?,.\(\)\/@ 0-9]/, '') : null;~~ |
  | 255 |  | ~~}~~ |
  | 256 |  | ~~</script>~~ |
  | 257 |  | ~~<?php~~ |
  | 258 |  | ~~}~~ |
  | 259 |  |  |
  | 260 |  | ~~function papr\_show\_customer\_page()~~ |
  | 261 |  | ~~{~~ |
  | 262 |  | ~~if (papr\_is\_customer\_registered()) {~~ |
  | 263 |  | ~~papr\_show\_customer\_details();~~ |
  | 264 |  | ~~} else {~~ |
  | 265 |  | ~~if (get\_option('papr\_verify\_customer') == 'true') {~~ |
  | 266 |  | ~~papr\_show\_verify\_password\_page();~~ |
  | 267 |  | ~~} else {~~ |
  | 268 |  | ~~papr\_show\_new\_registration\_page();~~ |
  | 269 |  | ~~}~~ |
  | 270 |  | ~~}~~ |
  | 271 |  | ~~}~~ |
  | 272 |  |  |
  | 273 |  | ~~//Display options for the customer to choose from when user is restricted~~ |
  | 274 |  | ~~function papr\_display\_options\_page()~~ |
  | 275 |  | ~~{~~ |
  | 276 |  | ~~?>~~ |
  | 277 |  | ~~<h4 class="papr-form-head">Restrict Options before Login~~ |
  | 278 |  |  |
  | 279 |  | ~~</h4>~~ |
  | 280 |  | ~~<div class="pt-3">~~ |
  | 281 |  | ~~<table>~~ |
  | 282 |  | ~~<tr style="margin-bottom:7%;">~~ |
  | 283 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" disabled>~~ |
  | 284 |  | ~~<b>Redirect to Login Page</b>~~ |
  | 285 |  | ~~<br><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to WP Login Page. </p>~~ |
  | 286 |  | ~~</tr>~~ |
  | 287 |  | ~~<tr>~~ |
  | 288 |  | ~~<td width="60%" style="padding-bottom:6px;">~~ |
  | 289 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_page" disabled>~~ |
  | 290 |  | ~~<b>Redirect to Page Link</b>~~ |
  | 291 |  | ~~</td>~~ |
  | 292 |  | ~~</tr>~~ |
  | 293 |  | ~~<tr>~~ |
  | 294 |  | ~~<td colsapn="2">~~ |
  | 295 |  | ~~<input type="url" style="width:90%;cursor: not-allowed;" name="mo\_display\_page\_url" id="mo\_page\_url" disabled placeholder="Enter URL of the page">~~ |
  | 296 |  | ~~<td>~~ |
  | 297 |  | ~~<button style="cursor: not-allowed; width: 180px;" class="btn papr-btn-cstm rounded" disabled value = "" placeholder = " Enter URL of the page">~~ |
  | 298 |  | ~~Save & Test URL~~ |
  | 299 |  | ~~</button>~~ |
  | 300 |  | ~~</td>~~ |
  | 301 |  | ~~</td>~~ |
  | 302 |  | ~~</tr>~~ |
  | 303 |  | ~~<tr class="mt-3">~~ |
  | 304 |  | ~~<td colspan="3">~~ |
  | 305 |  | ~~<p class="papr-bg-cstm p-3 h6 mt-3"><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to the given page URL.<br>~~ |
  | 306 |  | ~~<font color="#8b008b">Please provide a valid URL and make sure that the given page is not Restricted</font>~~ |
  | 307 |  | ~~</p>~~ |
  | 308 |  | ~~</td>~~ |
  | 309 |  | ~~</tr>~~ |
  | 310 |  |  |
  | 311 |  | ~~<tr>~~ |
  | 312 |  | ~~<td style="padding-bottom:6px;" width="70%">~~ |
  | 313 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_message" disabled>~~ |
  | 314 |  | ~~<b>Message on display</b><br>~~ |
  | 315 |  | ~~</td>~~ |
  | 316 |  | ~~</tr>~~ |
  | 317 |  | ~~<tr>~~ |
  | 318 |  | ~~<td>~~ |
  | 319 |  | ~~<input type="text" style="width:90%;cursor:not-allowed;" name="mo\_display\_message\_text" disabled="" value="" placeholder="Oops! You are not authorized to access this." />~~ |
  | 320 |  | ~~<td>~~ |
  | 321 |  | ~~<button style="cursor: not-allowed;" class="btn papr-btn-cstm rounded" disabled> Save & Preview</button>~~ |
  | 322 |  | ~~</td>~~ |
  | 323 |  | ~~</td>~~ |
  | 324 |  | ~~</tr>~~ |
  | 325 |  | ~~<tr>~~ |
  | 326 |  | ~~<td colspan="2">~~ |
  | 327 |  | ~~<b>Note </b>: Enabling this option will display the configured message to the restricted users.~~ |
  | 328 |  | ~~</td>~~ |
  | 329 |  | ~~</tr>~~ |
  | 330 |  | ~~<tr style="margin-bottom:7%;">~~ |
  | 331 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" disabled>~~ |
  | 332 |  | ~~<b>Single Sign On </b>~~ |
  | 333 |  | ~~<br>~~ |
  | 334 |  | ~~<b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to IDP login page.</p>~~ |
  | 335 |  |  |
  | 336 |  | ~~</tr>~~ |
  | 337 |  | ~~</table>~~ |
  | 338 |  | ~~<br><br>~~ |
  | 339 |  | ~~</div>~~ |
  | 340 |  |  |
  | 341 |  | ~~<?php~~ |
  | 342 |  | ~~}~~ |
  | 343 |  |  |
  | 344 |  | ~~function papr\_display\_options\_log()~~ |
  | 345 |  | ~~{~~ |
  | 346 |  | ~~?>~~ |
  | 347 |  |  |
  | 348 |  | ~~<h4 class="papr-form-head">Restrict Options after Login</h4>~~ |
  | 349 |  | ~~<div class="pt-3">~~ |
  | 350 |  | ~~<input type="hidden" style="cursor: not-allowed;" name="option" value="mo\_display\_option\_login\_log">~~ |
  | 351 |  | ~~<table>~~ |
  | 352 |  | ~~<tr>~~ |
  | 353 |  | ~~<td colspan="2" style="padding-bottom:6px">~~ |
  | 354 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_page\_log" disabled>~~ |
  | 355 |  | ~~<b>Redirect to Page Link</b>~~ |
  | 356 |  | ~~</td>~~ |
  | 357 |  | ~~</tr>~~ |
  | 358 |  | ~~<tr>~~ |
  | 359 |  | ~~<td width="80%" colspan="2">~~ |
  | 360 |  | ~~<input type="url" name="mo\_display\_page\_url\_log" style="width:90%;cursor:not-allowed;" id="mo\_page\_url" disabled placeholder="Enter URL of the page" />~~ |
  | 361 |  | ~~<td><b>~~ |
  | 362 |  | ~~<button style="cursor: not-allowed;width:180px;" class="btn papr-btn-cstm rounded" disabled>Save & Test URL</button>~~ |
  | 363 |  | ~~</td>~~ |
  | 364 |  | ~~</td>~~ |
  | 365 |  | ~~</tr>~~ |
  | 366 |  |  |
  | 367 |  | ~~<tr>~~ |
  | 368 |  | ~~<td colspan="3">~~ |
  | 369 |  | ~~<br><b>Note </b>: Enabling this option will <i><b>Redirect</b></i> the restricted users to the given page URL.~~ |
  | 370 |  | ~~<br>~~ |
  | 371 |  | ~~<font color="#8b008b">Please provide a valid URL and make sure that the given page is not Restricted</font>~~ |
  | 372 |  | ~~</td>~~ |
  | 373 |  | ~~</tr>~~ |
  | 374 |  | ~~<tr>~~ |
  | 375 |  | ~~<td>~~ |
  | 376 |  | ~~<br>~~ |
  | 377 |  | ~~</td>~~ |
  | 378 |  | ~~</tr>~~ |
  | 379 |  | ~~<tr>~~ |
  | 380 |  | ~~<td style="padding-bottom:6px">~~ |
  | 381 |  | ~~<input style="cursor: not-allowed;" type="radio" name="mo\_display" value="mo\_display\_message\_log" disabled>~~ |
  | 382 |  | ~~<b>Message on display</b>~~ |
  | 383 |  | ~~</td>~~ |
  | 384 |  | ~~</tr>~~ |
  | 385 |  | ~~<tr>~~ |
  | 386 |  | ~~<td colspan="2">~~ |
  | 387 |  | ~~<input type="text" name="mo\_display\_message\_text\_log" style="width:90%; cursor:not-allowed;" disabled value="" placeholder="Oops! You are not authorized to access this.">~~ |
  | 388 |  | ~~<td>~~ |
  | 389 |  | ~~<button style="cursor: not-allowed;" class="btn papr-btn-cstm rounded" disabled>Save & Preview</button>~~ |
  | 390 |  | ~~</td>~~ |
  | 391 |  | ~~</td>~~ |
  | 392 |  | ~~</tr>~~ |
  | 393 |  | ~~<tr>~~ |
  | 394 |  | ~~<td colspan="3">~~ |
  | 395 |  | ~~<br>~~ |
  | 396 |  | ~~<b>Note </b>: Enabling this option will display the configured message to the restricted users.~~ |
  | 397 |  | ~~</td>~~ |
  | 398 |  | ~~</tr>~~ |
  | 399 |  | ~~</table>~~ |
  | 400 |  | ~~<br><br>~~ |
  | 401 |  | ~~</div>~~ |
  | 402 |  |  |
  | 403 |  | ~~<?php~~ |
  | 404 |  | ~~}~~ |
  | 405 |  |  |
  | 406 |  | ~~function papr\_is\_customer\_registered() {~~ |
  | 407 |  |  |
  | 408 |  | ~~$email       = get\_option('papr\_admin\_email');~~ |
  | 409 |  | ~~$customerKey = get\_option('papr\_admin\_customer\_key');~~ |
  | 410 |  | ~~if (!$email || !$customerKey || !is\_numeric(trim($customerKey)))~~ |
  | 411 |  | ~~return 0;~~ |
  | 412 |  | ~~return 1;~~ |
  | 413 |  | ~~}~~ |
  | 414 |  |  |
  | 415 |  | ~~function papr\_show\_customer\_details()~~ |
  | 416 |  | ~~{~~ |
  | 417 |  | ~~?>~~ |
  | 418 |  | ~~<div class="rounded bg-white papr-shadow p-4 ms-4 mt-4">~~ |
  | 419 |  | ~~<h2>Thank you for registering with miniOrange.</h2>~~ |
  | 420 |  | ~~<div style="padding: 10px;">~~ |
  | 421 |  | ~~<table border="1" style="background-color:#FFFFFF; border:1px solid #CCCCCC; border-collapse: collapse; margin-bottom:15px; width:85%">~~ |
  | 422 |  | ~~<tr>~~ |
  | 423 |  | ~~<td style="width:45%; padding: 10px;">miniOrange Account Email</td>~~ |
  | 424 |  | ~~<td style="width:55%; padding: 10px;"><?php echo esc\_attr(get\_option('papr\_admin\_email')); ?></td>~~ |
  | 425 |  | ~~</tr>~~ |
  | 426 |  | ~~<tr>~~ |
  | 427 |  | ~~<td style="width:45%; padding: 10px;">Customer ID</td>~~ |
  | 428 |  | ~~<td style="width:55%; padding: 10px;"><?php echo esc\_attr(get\_option('papr\_admin\_customer\_key')) ?></td>~~ |
  | 429 |  | ~~</tr>~~ |
  | 430 |  | ~~</table>~~ |
  | 431 |  |  |
  | 432 |  | ~~<table>~~ |
  | 433 |  | ~~<tr>~~ |
  | 434 |  | ~~<td>~~ |
  | 435 |  | ~~<form name="f1" method="post" action="" id="papr\_goto\_login\_form">~~ |
  | 436 |  | ~~<?php wp\_nonce\_field("papr\_change\_miniorange"); ?>~~ |
  | 437 |  | ~~<input type="hidden" value="papr\_change\_miniorange" name="option" />~~ |
  | 438 |  | ~~<input type="submit" value="Change Email Address" class="btn papr-btn-cstm rounded" />~~ |
  | 439 |  | ~~</form>~~ |
  | 440 |  | ~~</td>~~ |
  | 441 |  | ~~<td>~~ |
  | 442 |  | ~~<a href="<?php echo esc\_url(admin\_url("admin.php?page=page\_restriction&tab=premium\_plan")); ?>"><input type="button" class="btn papr-btn-cstm rounded" value="Check Premium Plans" /></a>~~ |
  | 443 |  | ~~</td>~~ |
  | 444 |  | ~~</tr>~~ |
  | 445 |  | ~~</table>~~ |
  | 446 |  | ~~</div>~~ |
  | 447 |  | ~~<br>~~ |
  | 448 |  | ~~</div>~~ |
  | 449 |  |  |
  | 450 |  | ~~<?php~~ |
  | 451 |  | ~~}~~ |
  | 452 |  |  |
  | 453 |  | ~~function papr\_show\_new\_registration\_page()~~ |
  | 454 |  | ~~{~~ |
  | 455 |  | ~~update\_option('papr\_new\_registration', 'true');~~ |
  | 456 |  | ~~?>~~ |
  | 457 |  | ~~<div class="rounded bg-white papr-shadow p-4 ms-4 mt-4">~~ |
  | 458 |  | ~~<form name="f" method="post" action="">~~ |
  | 459 |  | ~~<?php wp\_nonce\_field("papr\_register\_customer"); ?>~~ |
  | 460 |  | ~~<input type="hidden" name="option" value="papr\_register\_customer">~~ |
  | 461 |  | ~~<h4 class="papr-form-head">Register with miniOrange</h4>~~ |
  | 462 |  |  |
  | 463 |  | ~~<div id="help\_register\_desc" class="papr-bg-cstm p-3 rounded mt-4 text-center">~~ |
  | 464 |  | ~~<h5>Why should I register?</h5>~~ |
  | 465 |  | ~~<p class="papr-p-text">You should register so that in case you need help, we can help you with step by step instructions. <b>You will also need a miniOrange account to upgrade to the premium version of the plugin.</b> We do not store any information except the email that you will use to register with us.</p>~~ |
  | 466 |  | ~~</div>~~ |
  | 467 |  | ~~<div class="row mt-4">~~ |
  | 468 |  | ~~<div class="col-md-3">~~ |
  | 469 |  | ~~<h6>Email :</h6>~~ |
  | 470 |  | ~~</div>~~ |
  | 471 |  | ~~<div class="col-md-6">~~ |
  | 472 |  | ~~<input class="mo\_saml\_table\_textbox" style="width:100%" type="email" name="email" required placeholder="person@example.com" value="<?php echo (get\_option('papr\_admin\_email') == '') ? esc\_attr(get\_option('admin\_email')) : esc\_attr(get\_option('papr\_admin\_email')); ?>" />~~ |
  | 473 |  | ~~</div>~~ |
  | 474 |  | ~~</div>~~ |
  | 475 |  | ~~<div class="row mt-4">~~ |
  | 476 |  | ~~<div class="col-md-3">~~ |
  | 477 |  | ~~<h6>Password :</h6>~~ |
  | 478 |  | ~~</div>~~ |
  | 479 |  | ~~<div class="col-md-6">~~ |
  | 480 |  | ~~<input class="mo\_saml\_table\_textbox" style="width:100%" required type="password" name="password" placeholder="Choose your password (Min. length 6)" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present." />~~ |
  | 481 |  | ~~</div>~~ |
  | 482 |  | ~~</div>~~ |
  | 483 |  | ~~<div class="row mt-4">~~ |
  | 484 |  | ~~<div class="col-md-3">~~ |
  | 485 |  | ~~<h6>Confirm Password :</h6>~~ |
  | 486 |  | ~~</div>~~ |
  | 487 |  | ~~<div class="col-md-6">~~ |
  | 488 |  | ~~<input class="mo\_saml\_table\_textbox" style="width:100%" required type="password" name="confirmPassword" placeholder="Confirm your password" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present.">~~ |
  | 489 |  | ~~</div>~~ |
  | 490 |  | ~~</div>~~ |
  | 491 |  | ~~<div class="row mt-4">~~ |
  | 492 |  | ~~<div class="col-md-3"></div>~~ |
  | 493 |  | ~~<div class="col-md-9">~~ |
  | 494 |  | ~~<input type="submit" name="submit" value="Register" class="btn papr-btn-cstm rounded" />~~ |
  | 495 |  | ~~<input type="button" name="papr\_goto\_login" id="papr\_goto\_login" value="Already have an account?" class="btn papr-btn-cstm rounded" />~~ |
  | 496 |  | ~~</div>~~ |
  | 497 |  | ~~</div>~~ |
  | 498 |  | ~~</form>~~ |
  | 499 |  | ~~</div>~~ |
  | 500 |  | ~~<form name="f1" method="post" action="" id="papr\_goto\_login\_form">~~ |
  | 501 |  | ~~<?php wp\_nonce\_field("papr\_goto\_login"); ?>~~ |
  | 502 |  | ~~<input type="hidden" name="option" value="papr\_goto\_login" />~~ |
  | 503 |  | ~~</form>~~ |
  | 504 |  |  |
  | 505 |  | ~~<script>~~ |
  | 506 |  | ~~jQuery('#papr\_goto\_login').click(function() {~~ |
  | 507 |  | ~~jQuery('#papr\_goto\_login\_form').submit();~~ |
  | 508 |  | ~~});~~ |
  | 509 |  | ~~</script>~~ |
  | 510 |  | ~~<?php~~ |
  | 511 |  | ~~}~~ |
  | 512 |  |  |
  | 513 |  | ~~function papr\_show\_verify\_password\_page()~~ |
  | 514 |  | ~~{~~ |
  | 515 |  | ~~?>~~ |
  | 516 |  | ~~<form name="f" method="post" action="">~~ |
  | 517 |  | ~~<?php wp\_nonce\_field("papr\_verify\_customer"); ?>~~ |
  | 518 |  | ~~<input type="hidden" name="option" value="papr\_verify\_customer">~~ |
  | 519 |  | ~~<div class="rounded bg-white papr-shadow p-4 mt-4 ms-4">~~ |
  | 520 |  | ~~<h4 class="papr-form-head">Login with miniOrange</h4>~~ |
  | 521 |  |  |
  | 522 |  | ~~<div class="papr-bg-cstm p-3 rounded mt-4 text-center">~~ |
  | 523 |  | ~~<p class="papr-p-text">~~ |
  | 524 |  | ~~<b>It seems you already have an account with miniOrange. Please enter your miniOrange email and password.~~ |
  | 525 |  | ~~<br><a target="\_blank" href="https://login.xecurify.com/moas/idp/resetpassword">Click here if you forgot your password?</a>~~ |
  | 526 |  | ~~</b>~~ |
  | 527 |  | ~~</p>~~ |
  | 528 |  | ~~</div>~~ |
  | 529 |  | ~~<div class="row mt-4">~~ |
  | 530 |  | ~~<div class="col-md-3">~~ |
  | 531 |  | ~~<h6>Email :</h6>~~ |
  | 532 |  | ~~</div>~~ |
  | 533 |  | ~~<div class="col-md-6">~~ |
  | 534 |  | ~~<input class="mo\_saml\_table\_textbox w-75" type="email" name="email" required placeholder="person@example.com" value="<?php echo esc\_attr(get\_option('papr\_admin\_email')); ?>" />~~ |
  | 535 |  | ~~</div>~~ |
  | 536 |  | ~~</div>~~ |
  | 537 |  | ~~<div class="row mt-4">~~ |
  | 538 |  | ~~<div class="col-md-3">~~ |
  | 539 |  | ~~<h6>Password :</h6>~~ |
  | 540 |  | ~~</div>~~ |
  | 541 |  | ~~<div class="col-md-6">~~ |
  | 542 |  | ~~<input class="mo\_saml\_table\_textbox w-75" required type="password" name="password" placeholder="Enter your password" minlength="6" pattern="^[(\w)\*(!@#$.%^&\*-\_)\*]+$" title="Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*) should be present.">~~ |
  | 543 |  | ~~</div>~~ |
  | 544 |  | ~~</div>~~ |
  | 545 |  | ~~<div class="row mt-4">~~ |
  | 546 |  | ~~<div class="col-md-3"></div>~~ |
  | 547 |  | ~~<div class="col-md-9">~~ |
  | 548 |  | ~~<input type="submit" name="submit" value="Login" class="btn papr-btn-cstm rounded" />~~ |
  | 549 |  | ~~<input type="button" name="papr\_goback" id="papr\_goback" value="Sign Up" class="btn papr-btn-cstm rounded" />~~ |
  | 550 |  | ~~</div>~~ |
  | 551 |  | ~~</div>~~ |
  | 552 |  |  |
  | 553 |  | ~~</div>~~ |
  | 554 |  | ~~</form>~~ |
  | 555 |  |  |
  | 556 |  | ~~<form name="f" method="post" action="" id="papr\_goback\_form">~~ |
  | 557 |  | ~~<?php wp\_nonce\_field("papr\_go\_back") ?>~~ |
  | 558 |  | ~~<input type="hidden" name="option" value="papr\_go\_back" />~~ |
  | 559 |  | ~~</form>~~ |
  | 560 |  | ~~<form name="f" method="post" action="" id="papr\_forgotpassword\_form">~~ |
  | 561 |  | ~~<?php wp\_nonce\_field("papr\_forgot\_password\_form\_option"); ?>~~ |
  | 562 |  | ~~<input type="hidden" name="option" value="papr\_forgot\_password\_form\_option" />~~ |
  | 563 |  | ~~</form>~~ |
  | 564 |  | ~~<script>~~ |
  | 565 |  | ~~jQuery('#papr\_goback').click(function() {~~ |
  | 566 |  | ~~jQuery('#papr\_goback\_form').submit();~~ |
  | 567 |  | ~~});~~ |
  | 568 |  | ~~jQuery("a[href=\"#papr\_forgot\_password\_link\"]").click(function() {~~ |
  | 569 |  | ~~jQuery('#papr\_forgotpassword\_form').submit();~~ |
  | 570 |  | ~~});~~ |
  | 571 |  | ~~</script>~~ |
  | 572 |  | ~~<?php~~ |
  | 573 |  | ~~}~~ |
  | 574 |  |  |
  | 575 |  | ~~function papr\_in\_array($var,$arr){~~ |
  | 576 |  | ~~return is\_array($arr) && in\_array($var,$arr);~~ |
  | 577 |  | ~~}~~ |
  | 578 |  |  |
  | 579 |  | ~~?>~~ |
* ## [page-and-post-restriction/trunk/page-restriction-page-access.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-page-access.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-page-access.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-page-access.php?rev=2829798#L7 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-page-access.php?rev=3034414#L7 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 7 | 7 | function papr\_page\_access() { |
  | 8 | 8 |  |
  | 9 |  | ~~$results\_per\_page         =     get\_option('papr\_results\_per\_page'~~); |
  | 10 |  | ~~$allowed\_roles            =     get\_option('papr\_allowed\_roles\_for\_pages'~~); |
  | 11 |  | ~~$allowed\_redirect\_pages   =     get\_option('papr\_allowed\_redirect\_for\_pages'~~); |
  | 12 |  | ~~$default\_role\_parent      =     get\_option('papr\_default\_role\_parent'~~); |
  | 13 |  | ~~$unrestricted\_pages       =     get\_option('papr\_login\_unrestricted\_pages'~~); |
  | 14 |  | ~~$default\_login\_toggle     =     get\_option('papr\_access\_for\_only\_loggedin'~~); |
  | 15 |  |  |
  | 16 |  | ~~$results\_per\_page         =~~  $results\_per\_page != '' ? $results\_per\_page : 10; |
  | 17 |  | ~~$allowed\_roles            =~~  $allowed\_roles != '' ? $allowed\_roles : array(); |
  | 18 |  | ~~$allowed\_redirect\_pages   =~~  $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  | 19 |  | ~~$default\_role\_parent      =~~  $default\_role\_parent != '' ? $default\_role\_parent : array(); |
  | 20 |  | ~~$unrestricted\_pages       =~~  $unrestricted\_pages ? $unrestricted\_pages : array(); |
  | 21 |  | ~~$default\_login\_toggle     =     $default\_login\_toggle != '' ? $default\_login\_toggle : ""~~; |
  | 22 |  |  |
  | 23 |  | ~~$mo\_page\_search\_value = ""~~; |
  | 24 |  | ~~if (array\_key\_exists('search', $\_GET)~~) { |
  | 25 |  | ~~$mo\_page\_search\_value = sanitize\_text\_field($\_GET['search']~~); |
  | 26 |  | } |
  | 27 |  |  |
  | 28 |  | ?> |
  | 29 |  |  |
  | 30 |  |  |
  | 31 |  | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  | 32 |  | <h4 class="papr-form-head">Give Access to Pages based on Roles and Login Status</h4> |
  | 33 |  |  |
  | 34 |  | <?php papr\_toggle\_all\_pages(); ?> |
  | 35 |  | <?php papr\_restriction\_behaviour\_pages(); ?> |
  | 36 |  | <hr class="mt-4"/> |
  | 37 |  |  |
  | 38 |  | <h5 class="papr-form-head papr-form-head-bar mt-5">Page Restrictions |
  | 39 |  | <div class="papr-info-global ms-2"> |
  | 40 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 41 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 42 |  | </svg> |
  | 43 |  | <p class="papr-info-text-global"> |
  | 44 |  | Specify which pages would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the page in the table below. |
  | 45 |  | </p> |
  | 46 |  | </div> |
  | 47 |  | </h5> |
  | 48 |  |  |
  | 49 |  | <div class="tablenav top mt-4"> |
  | 50 |  | ~~<?php papr\_dropdown($results\_per\_page, 'page'~~); ?> |
  | 51 |  | ~~<?php papr\_search\_box('page',$mo\_page\_search\_value~~); ?> |
  | 52 |  | <form name="f" method="post" action="" id="blockedpagesform" class="mt-4"> |
  | 53 |  | ~~<?php wp\_nonce\_field("papr\_restrict\_pages\_roles\_login"~~); ?> |
  | 54 |  | <input type="hidden" name="option" value="papr\_restrict\_pages\_roles\_login" form="blockedpagesform" /> |
  | 55 |  | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  | 56 |  | <?php |
  | 57 |  |  |
  | 58 |  | ~~$total\_pages = papr\_get\_page\_post\_count($mo\_page\_search\_value,'page'~~); |
  | 59 |  | ~~$number\_of\_pages\_in\_pagination = ceil($total\_pages / $results\_per\_page~~); |
  | 60 |  | ~~$current\_page = papr\_get\_current\_page($number\_of\_pages\_in\_pagination~~); |
  | 61 |  | ~~$pagination = papr\_get\_paginated\_pages\_post($mo\_page\_search\_value, $results\_per\_page, $current\_page,'page'~~); |
  | 62 |  |  |
  | 63 |  | $link = 'admin.php?page=page\_restriction&curr='; |
  | 64 |  | ~~if($mo\_page\_search\_value!='')~~{ |
  | 65 |  | ~~$link = 'admin.php?page=page\_restriction&search='.$mo\_page\_search\_value.~~'&curr='; |
  | 66 |  | } |
  | 67 |  | ~~papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, 'top'~~); |
  | 68 |  | ?> |
  | 69 |  | </div> |
  | 70 |  |  |
  | 71 |  | <table id="reports\_table" class="wp-list-table widefat fixed table-view-list pages"> |
  | 72 |  | ~~<thead> <?php papr\_display\_head\_foot\_of\_table('Page'~~); ?></thead> |
  | 73 |  | <tbody> |
  | 74 |  | <?php |
  | 75 |  | ~~if(count($pagination)==0 && $mo\_page\_search\_value !='')~~{ |
  | 76 |  | echo '<tr><td><b>No Results</b></td><td></td><td></td><td></td></tr>'; |
  | 77 |  | } else { |
  | 78 |  | ~~papr\_display\_filtered\_pages($mo\_page\_search\_value, $pagination, $current\_page, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle~~); |
  | 79 |  | } |
  | 80 |  | ?> |
  | 81 |  | </tbody> |
  | 82 |  | ~~<tfoot> <?php papr\_display\_head\_foot\_of\_table('Page'~~); ?> </tfoot> |
  | 83 |  | </table> |
  | 84 |  |  |
  | 85 |  | <div class="tablenav bottom mt-3 pb-5"> |
  | 86 |  | <input type="submit" class="papr-btn-cstm rounded mt-2" value="Save Configuration" form="blockedpagesform"> |
  | 87 |  | ~~<?php papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, 'bottom'~~); ?> |
  | 88 |  | </div> |
  | 89 |  | </form> |
  | 90 |  |  |
  | 91 |  | <?php |
  | 92 |  | $mo\_roles = array(); |
  | 93 |  | global $wp\_roles; |
  | 94 |  | $roles = $wp\_roles->roles; |
  | 95 |  | ~~foreach ($roles as $key => $val)~~{ |
  | 96 |  | $mo\_roles[] = $key; |
  | 97 |  | } |
  | 98 |  | ?> |
  | 99 |  | <script> |
  | 100 |  | var closebtns = document.getElementsByClassName("close"); |
  | 101 |  | var i; |
  | 102 |  |  |
  | 103 |  | for (var i = 0; i < closebtns.length; i++) { |
  | 104 |  | closebtns[i].addEventListener("click", function() { |
  | 105 |  | this.parentElement.style.display = 'none'; |
  | 106 |  | }); |
  | 107 |  | } |
  | 108 |  |  |
  | 109 |  | function hide\_show\_child(x) { |
  | 110 |  | var valid = "child\_list\_" + x; |
  | 111 |  | var value = document.getElementById(valid).value; |
  | 112 |  |  |
  | 113 |  | var valid1 = "child\_list\_toggle\_" + x; |
  | 114 |  | var value1 = document.getElementById(valid1).value; |
  | 115 |  |  |
  | 116 |  |  |
  | 117 |  | text = value.slice(1, -1); |
  | 118 |  | var myArray = text.split(","); |
  | 119 |  | for (var i = 0; i < myArray.length; i++) { |
  | 120 |  |  |
  | 121 |  | child\_img\_id = "toggle\_image\_" + myArray[i]; |
  | 122 |  | var myElement = document.getElementById(child\_img\_id); |
  | 123 |  |  |
  | 124 |  | if (value1 == 'show') { |
  | 125 |  | document.getElementById(myArray[i]).style.display = 'none'; |
  | 126 |  | if (myElement) { |
  | 127 |  | myElement.style.transform = 'rotate(-90deg)'; |
  | 128 |  | } |
  | 129 |  | } else { |
  | 130 |  | document.getElementById(myArray[i]).style.display = ''; |
  | 131 |  | if (myElement) { |
  | 132 |  | myElement.style.transform = 'rotate(0deg)'; |
  | 133 |  | } |
  | 134 |  | } |
  | 135 |  | } |
  | 136 |  |  |
  | 137 |  | img\_id = "toggle\_image\_" + x; |
  | 138 |  | var img = document.getElementById(img\_id); |
  | 139 |  |  |
  | 140 |  | if (value1 == 'show') { |
  | 141 |  | document.getElementById(valid1).value = "hide"; |
  | 142 |  | img.style.transform = 'rotate(-90deg)'; |
  | 143 |  | } else { |
  | 144 |  | document.getElementById(valid1).value = "show"; |
  | 145 |  | img.style.transform = 'rotate(0deg)'; |
  | 146 |  | } |
  | 147 |  | } |
  | 148 |  |  |
  | 149 |  | function disable\_enable\_child(x) { |
  | 150 |  | var valid = "child\_list\_" + x; |
  | 151 |  | var value = document.getElementById(valid).value; |
  | 152 |  |  |
  | 153 |  | var hidden\_child\_id =  "child\_list\_hidden\_" + x; |
  | 154 |  | var hidden\_child\_id\_value = document.getElementById(hidden\_child\_id).value; |
  | 155 |  |  |
  | 156 |  | var parent\_id = "mo\_page\_roles\_" + x; |
  | 157 |  | var parent\_id\_role\_value = document.getElementById(parent\_id).value; |
  | 158 |  |  |
  | 159 |  | var parent\_id\_private = "mo\_page\_login\_valid\_" + x; |
  | 160 |  |  |
  | 161 |  | if(document.getElementsByClassName(parent\_id\_private)[0].checked == true){ |
  | 162 |  | var parent\_id\_private\_value = 1; |
  | 163 |  | } else { |
  | 164 |  | var parent\_id\_private\_value = 2; |
  | 165 |  | } |
  | 166 |  |  |
  | 167 |  | text = value.slice(1, -1); |
  | 168 |  | var myArray = text.split(","); |
  | 169 |  |  |
  | 170 |  | for (var i = 0; i < myArray.length; i++) { |
  | 171 |  | var child\_id = "mo\_page\_roles\_" + myArray[i]; |
  | 172 |  | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  | 173 |  | var child\_id\_default\_role\_valid = "mo\_page\_default\_role\_valid\_" + myArray[i]; |
  | 174 |  |  |
  | 175 |  | if(hidden\_child\_id\_value==1){ |
  | 176 |  | document.getElementById(child\_id).disabled = false; |
  | 177 |  | document.getElementsByClassName(child\_id\_private)[0].disabled = false; |
  | 178 |  |  |
  | 179 |  | if( jQuery('#'+child\_id\_default\_role\_valid).length ) { |
  | 180 |  | document.getElementById(child\_id\_default\_role\_valid).disabled = false; |
  | 181 |  | } |
  | 182 |  | } |
  | 183 |  |  |
  | 184 |  | else{ |
  | 185 |  | document.getElementById(child\_id).disabled = true; |
  | 186 |  | document.getElementById(child\_id).value = parent\_id\_role\_value; |
  | 187 |  |  |
  | 188 |  | if(parent\_id\_private\_value==1){ |
  | 189 |  | document.getElementsByClassName(child\_id\_private)[0].checked = true; |
  | 190 |  | } else { |
  | 191 |  | document.getElementsByClassName(child\_id\_private)[0].checked = false; |
  | 192 |  | } |
  | 193 |  |  |
  | 194 |  | document.getElementsByClassName(child\_id\_private)[0].disabled = true; |
  | 195 |  |  |
  | 196 |  | if( jQuery('#'+child\_id\_default\_role\_valid).length ) { |
  | 197 |  | document.getElementById(child\_id\_default\_role\_valid).disabled = true; |
  | 198 |  | } |
  | 199 |  | } |
  | 200 |  | } |
  | 201 |  |  |
  | 202 |  | if(hidden\_child\_id\_value==1){ |
  | 203 |  | document.getElementById(hidden\_child\_id).value = 2; |
  | 204 |  | } else { |
  | 205 |  | document.getElementById(hidden\_child\_id).value = 1; |
  | 206 |  | } |
  | 207 |  | } |
  | 208 |  |  |
  | 209 |  | function apply\_to\_child(x){ |
  | 210 |  | var default\_role = 'mo\_page\_default\_role\_valid\_' + x; |
  | 211 |  | var elementExists = document.getElementById(default\_role); |
  | 212 |  |  |
  | 213 |  | if(elementExists){ |
  | 214 |  | if(document.getElementById(default\_role).checked){ |
  | 215 |  | var valid = "child\_list\_" + x; |
  | 216 |  | var value = document.getElementById(valid).value; |
  | 217 |  |  |
  | 218 |  | var parent\_id\_private = "mo\_page\_login\_valid\_" + x; |
  | 219 |  |  |
  | 220 |  | if(document.getElementsByClassName(parent\_id\_private)[0].checked == true){ |
  | 221 |  | var parent\_id\_private\_value = 1; |
  | 222 |  | } else { |
  | 223 |  | var parent\_id\_private\_value = 2; |
  | 224 |  | } |
  | 225 |  |  |
  | 226 |  | text = value.slice(1, -1); |
  | 227 |  | var myArray = text.split(","); |
  | 228 |  |  |
  | 229 |  | if(parent\_id\_private\_value==1){ |
  | 230 |  | for (var i = 0; i < myArray.length; i++) { |
  | 231 |  | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  | 232 |  | document.getElementsByClassName(child\_id\_private)[0].checked = true; |
  | 233 |  | } |
  | 234 |  | } |
  | 235 |  |  |
  | 236 |  | if(parent\_id\_private\_value==2){ |
  | 237 |  | for (var i = 0; i < myArray.length; i++) { |
  | 238 |  | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  | 239 |  | document.getElementsByClassName(child\_id\_private)[0].checked = false; |
  | 240 |  | } |
  | 241 |  | } |
  | 242 |  | } |
  | 243 |  | } |
  | 244 |  | } |
  | 245 |  |  |
  | 246 |  | function apply\_roles\_to\_child(event, x){ |
  | 247 |  | // if(event.key==='Enter'){ |
  | 248 |  | //     event.preventDefault(); |
  | 249 |  | //     return false; |
  | 250 |  | // } |
  | 251 |  |  |
  | 252 |  | var default\_role = 'mo\_page\_default\_role\_valid\_' + x; |
  | 253 |  | var elementExists = document.getElementById(default\_role); |
  | 254 |  |  |
  | 255 |  | if(elementExists){ |
  | 256 |  | if(document.getElementById(default\_role).checked){ |
  | 257 |  | var valid = "child\_list\_" + x; |
  | 258 |  | var value = document.getElementById(valid).value; |
  | 259 |  |  |
  | 260 |  | var parent\_id\_roles = "mo\_page\_roles\_" + x; |
  | 261 |  | var parent\_id\_role\_value = document.getElementById(parent\_id\_roles).value; |
  | 262 |  |  |
  | 263 |  | text = value.slice(1, -1); |
  | 264 |  | var myArray = text.split(","); |
  | 265 |  |  |
  | 266 |  | for (var i = 0; i < myArray.length; i++) { |
  | 267 |  | var child\_id\_role = "mo\_page\_roles\_" + myArray[i]; |
  | 268 |  | document.getElementById(child\_id\_role).value = parent\_id\_role\_value; |
  | 269 |  | } |
  | 270 |  | } |
  | 271 |  | } |
  | 272 |  | //auto assign the checkbox of make private pages checked while entering a role |
  | 273 |  | auto\_private\_when\_roles\_assigned(x,'page'); |
  | 274 |  | } |
  | 275 |  |  |
  | 276 |  | jQuery(".roles\_multi").chosen({no\_results\_text: "Oops, nothing found!"}); |
  | 277 |  |  |
  | 278 |  | jQuery(function() { |
  | 279 |  |  |
  | 280 |  | function split(val) { |
  | 281 |  | return val.split(/;\s\*/); |
  | 282 |  | } |
  | 283 |  |  |
  | 284 |  | function extractLast(term) { |
  | 285 |  | return split(term).pop(); |
  | 286 |  | } |
  | 287 |  |  |
  | 288 |  | ~~var mo\_roles = <?php echo json\_encode($mo\_roles~~); ?>; |
  | 289 |  |  |
  | 290 |  | jQuery(".mo\_roles\_suggest") |
  | 291 |  | .on("keydown", function(event) { |
  | 292 |  | if (event.keyCode === jQuery.ui.keyCode.TAB && jQuery(this).autocomplete("instance").menu.active) { |
  | 293 |  | event.preventDefault(); |
  | 294 |  | } |
  | 295 |  | }) |
  | 296 |  | .autocomplete({ |
  | 297 |  | minLength: 0, |
  | 298 |  | source: function(request, response) { |
  | 299 |  | response(jQuery.ui.autocomplete.filter(mo\_roles, extractLast(request.term))); |
  | 300 |  | }, |
  | 301 |  | focus: function() { |
  | 302 |  | return false; |
  | 303 |  | }, |
  | 304 |  | select: function(event, ui) { |
  | 305 |  | var terms = split(this.value); |
  | 306 |  | terms.pop(); |
  | 307 |  | terms.push(ui.item.value); |
  | 308 |  | terms.push(""); |
  | 309 |  | this.value = terms.join(";"); |
  | 310 |  | return false; |
  | 311 |  | } |
  | 312 |  | }); |
  | 313 |  | }); |
  | 314 |  |  |
  | 315 |  | var page\_selector\_up = document.getElementById("current-page-selector"); |
  | 316 |  | var page\_selector\_down = document.getElementById("current-page-selector-1"); |
  | 317 |  | var page\_search\_link = document.getElementById("mo\_page\_search"); |
  | 318 |  | var link = 'admin.php?page=page\_restriction&curr='; |
  | 319 |  |  |
  | 320 |  | page\_selector\_up.addEventListener("keyup", function(event) { |
  | 321 |  | if (event.keyCode === 13) { |
  | 322 |  | page\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  | 323 |  | var page\_link = link.concat(page\_selector\_up\_value); |
  | 324 |  | window.open(page\_link, "\_self"); |
  | 325 |  | } |
  | 326 |  | }); |
  | 327 |  |  |
  | 328 |  | page\_selector\_down.addEventListener("keyup", function(event) { |
  | 329 |  | if (event.keyCode === 13) { |
  | 330 |  | page\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  | 331 |  | var page\_link = link.concat(page\_selector\_down\_value); |
  | 332 |  | window.open(page\_link, "\_self"); |
  | 333 |  | } |
  | 334 |  | }); |
  | 335 |  |  |
  | 336 |  | page\_search\_link.addEventListener("keyup", function(event) { |
  | 337 |  | if (event.keyCode === 13) { |
  | 338 |  | page\_search\_link\_value = document.getElementById("mo\_page\_search").value; |
  | 339 |  | var search\_link = 'admin.php?page=page\_restriction&search='; |
  | 340 |  | var page\_link = search\_link.concat(page\_search\_link\_value); |
  | 341 |  | window.open(page\_link, "\_self"); |
  | 342 |  | } |
  | 343 |  | }); |
  | 344 |  | </script> |
  | 345 |  | </div> |
  | 346 |  | <?php |
  |  | 9 | $results\_per\_page       = get\_option( 'papr\_results\_per\_page' ); |
  |  | 10 | $allowed\_roles          = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 11 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 12 | $default\_role\_parent    = get\_option( 'papr\_default\_role\_parent' ); |
  |  | 13 | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 14 | $default\_login\_toggle   = get\_option( 'papr\_access\_for\_only\_loggedin' ); |
  |  | 15 |  |
  |  | 16 | $results\_per\_page       = $results\_per\_page != '' ? $results\_per\_page : 10; |
  |  | 17 | $allowed\_roles          = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 18 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 19 | $default\_role\_parent    = $default\_role\_parent != '' ? $default\_role\_parent : array(); |
  |  | 20 | $unrestricted\_pages     = $unrestricted\_pages ? $unrestricted\_pages : array(); |
  |  | 21 | $default\_login\_toggle   = $default\_login\_toggle != '' ? $default\_login\_toggle : ''; |
  |  | 22 |  |
  |  | 23 | $mo\_page\_search\_value = ''; |
  |  | 24 | if ( array\_key\_exists( 'search', $\_GET ) ) { |
  |  | 25 | $mo\_page\_search\_value = sanitize\_text\_field( $\_GET['search'] ); |
  |  | 26 | } |
  |  | 27 |  |
  |  | 28 | ?> |
  |  | 29 |  |
  |  | 30 |  |
  |  | 31 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 32 | <h4 class="papr-form-head">Give Access to Pages based on Roles and Login Status</h4> |
  |  | 33 |  |
  |  | 34 | <?php papr\_toggle\_all\_pages(); ?> |
  |  | 35 | <?php papr\_restriction\_behaviour\_pages(); ?> |
  |  | 36 | <hr class="mt-4"/> |
  |  | 37 |  |
  |  | 38 | <h5 class="papr-form-head papr-form-head-bar mt-5">Page Restrictions |
  |  | 39 | <div class="papr-info-global ms-2"> |
  |  | 40 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 41 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 42 | </svg> |
  |  | 43 | <p class="papr-info-text-global"> |
  |  | 44 | Specify which pages would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the page in the table below. |
  |  | 45 | </p> |
  |  | 46 | </div> |
  |  | 47 | </h5> |
  |  | 48 |  |
  |  | 49 | <div class="tablenav top mt-4"> |
  |  | 50 | <?php papr\_dropdown( $results\_per\_page, 'page' ); ?> |
  |  | 51 | <?php papr\_search\_box( 'page', $mo\_page\_search\_value ); ?> |
  |  | 52 | <form name="f" method="post" action="" id="blockedpagesform" class="mt-4"> |
  |  | 53 | <?php wp\_nonce\_field( 'papr\_restrict\_pages\_roles\_login' ); ?> |
  |  | 54 | <input type="hidden" name="option" value="papr\_restrict\_pages\_roles\_login" form="blockedpagesform" /> |
  |  | 55 | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  |  | 56 | <?php |
  |  | 57 |  |
  |  | 58 | $total\_pages                   = papr\_get\_page\_post\_count( $mo\_page\_search\_value, 'page' ); |
  |  | 59 | $number\_of\_pages\_in\_pagination = ceil( $total\_pages / $results\_per\_page ); |
  |  | 60 | $current\_page                  = papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ); |
  |  | 61 | $pagination                    = papr\_get\_paginated\_pages\_post( $mo\_page\_search\_value, $results\_per\_page, $current\_page, 'page' ); |
  |  | 62 |  |
  |  | 63 | $link = 'admin.php?page=page\_restriction&curr='; |
  |  | 64 | if ( $mo\_page\_search\_value != '' ) { |
  |  | 65 | $link = 'admin.php?page=page\_restriction&search=' . $mo\_page\_search\_value . '&curr='; |
  |  | 66 | } |
  |  | 67 | papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, 'top' ); |
  |  | 68 | ?> |
  |  | 69 | </div> |
  |  | 70 |  |
  |  | 71 | <table id="reports\_table" class="wp-list-table widefat fixed table-view-list pages"> |
  |  | 72 | <thead> <?php papr\_display\_head\_foot\_of\_table( 'Page' ); ?></thead> |
  |  | 73 | <tbody> |
  |  | 74 | <?php |
  |  | 75 | if ( count( $pagination ) == 0 && $mo\_page\_search\_value != '' ) { |
  |  | 76 | echo '<tr><td><b>No Results</b></td><td></td><td></td><td></td></tr>'; |
  |  | 77 | } else { |
  |  | 78 | papr\_display\_filtered\_pages( $mo\_page\_search\_value, $pagination, $current\_page, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ); |
  |  | 79 | } |
  |  | 80 | ?> |
  |  | 81 | </tbody> |
  |  | 82 | <tfoot> <?php papr\_display\_head\_foot\_of\_table( 'Page' ); ?> </tfoot> |
  |  | 83 | </table> |
  |  | 84 |  |
  |  | 85 | <div class="tablenav bottom mt-3 pb-5"> |
  |  | 86 | <input type="submit" class="papr-btn-cstm rounded mt-2" value="Save Configuration" form="blockedpagesform"> |
  |  | 87 | <?php papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, 'bottom' ); ?> |
  |  | 88 | </div> |
  |  | 89 | </form> |
  |  | 90 |  |
  |  | 91 | <?php |
  |  | 92 | $mo\_roles = array(); |
  |  | 93 | global $wp\_roles; |
  |  | 94 | $roles = $wp\_roles->roles; |
  |  | 95 | foreach ( $roles as $key => $val ) { |
  |  | 96 | $mo\_roles[] = $key; |
  |  | 97 | } |
  |  | 98 | ?> |
  |  | 99 | <script> |
  |  | 100 | var closebtns = document.getElementsByClassName("close"); |
  |  | 101 | var i; |
  |  | 102 |  |
  |  | 103 | for (var i = 0; i < closebtns.length; i++) { |
  |  | 104 | closebtns[i].addEventListener("click", function() { |
  |  | 105 | this.parentElement.style.display = 'none'; |
  |  | 106 | }); |
  |  | 107 | } |
  |  | 108 |  |
  |  | 109 | function hide\_show\_child(x) { |
  |  | 110 | var valid = "child\_list\_" + x; |
  |  | 111 | var value = document.getElementById(valid).value; |
  |  | 112 |  |
  |  | 113 | var valid1 = "child\_list\_toggle\_" + x; |
  |  | 114 | var value1 = document.getElementById(valid1).value; |
  |  | 115 |  |
  |  | 116 |  |
  |  | 117 | text = value.slice(1, -1); |
  |  | 118 | var myArray = text.split(","); |
  |  | 119 | for (var i = 0; i < myArray.length; i++) { |
  |  | 120 |  |
  |  | 121 | child\_img\_id = "toggle\_image\_" + myArray[i]; |
  |  | 122 | var myElement = document.getElementById(child\_img\_id); |
  |  | 123 |  |
  |  | 124 | if (value1 == 'show') { |
  |  | 125 | document.getElementById(myArray[i]).style.display = 'none'; |
  |  | 126 | if (myElement) { |
  |  | 127 | myElement.style.transform = 'rotate(-90deg)'; |
  |  | 128 | } |
  |  | 129 | } else { |
  |  | 130 | document.getElementById(myArray[i]).style.display = ''; |
  |  | 131 | if (myElement) { |
  |  | 132 | myElement.style.transform = 'rotate(0deg)'; |
  |  | 133 | } |
  |  | 134 | } |
  |  | 135 | } |
  |  | 136 |  |
  |  | 137 | img\_id = "toggle\_image\_" + x; |
  |  | 138 | var img = document.getElementById(img\_id); |
  |  | 139 |  |
  |  | 140 | if (value1 == 'show') { |
  |  | 141 | document.getElementById(valid1).value = "hide"; |
  |  | 142 | img.style.transform = 'rotate(-90deg)'; |
  |  | 143 | } else { |
  |  | 144 | document.getElementById(valid1).value = "show"; |
  |  | 145 | img.style.transform = 'rotate(0deg)'; |
  |  | 146 | } |
  |  | 147 | } |
  |  | 148 |  |
  |  | 149 | function disable\_enable\_child(x) { |
  |  | 150 | var valid = "child\_list\_" + x; |
  |  | 151 | var value = document.getElementById(valid).value; |
  |  | 152 |  |
  |  | 153 | var hidden\_child\_id =  "child\_list\_hidden\_" + x; |
  |  | 154 | var hidden\_child\_id\_value = document.getElementById(hidden\_child\_id).value; |
  |  | 155 |  |
  |  | 156 | var parent\_id = "mo\_page\_roles\_" + x; |
  |  | 157 | var parent\_id\_role\_value = document.getElementById(parent\_id).value; |
  |  | 158 |  |
  |  | 159 | var parent\_id\_private = "mo\_page\_login\_valid\_" + x; |
  |  | 160 |  |
  |  | 161 | if(document.getElementsByClassName(parent\_id\_private)[0].checked == true){ |
  |  | 162 | var parent\_id\_private\_value = 1; |
  |  | 163 | } else { |
  |  | 164 | var parent\_id\_private\_value = 2; |
  |  | 165 | } |
  |  | 166 |  |
  |  | 167 | text = value.slice(1, -1); |
  |  | 168 | var myArray = text.split(","); |
  |  | 169 |  |
  |  | 170 | for (var i = 0; i < myArray.length; i++) { |
  |  | 171 | var child\_id = "mo\_page\_roles\_" + myArray[i]; |
  |  | 172 | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  |  | 173 | var child\_id\_default\_role\_valid = "mo\_page\_default\_role\_valid\_" + myArray[i]; |
  |  | 174 |  |
  |  | 175 | if(hidden\_child\_id\_value==1){ |
  |  | 176 | document.getElementById(child\_id).disabled = false; |
  |  | 177 | document.getElementsByClassName(child\_id\_private)[0].disabled = false; |
  |  | 178 |  |
  |  | 179 | if( jQuery('#'+child\_id\_default\_role\_valid).length ) { |
  |  | 180 | document.getElementById(child\_id\_default\_role\_valid).disabled = false; |
  |  | 181 | } |
  |  | 182 | } |
  |  | 183 |  |
  |  | 184 | else{ |
  |  | 185 | document.getElementById(child\_id).disabled = true; |
  |  | 186 | document.getElementById(child\_id).value = parent\_id\_role\_value; |
  |  | 187 |  |
  |  | 188 | if(parent\_id\_private\_value==1){ |
  |  | 189 | document.getElementsByClassName(child\_id\_private)[0].checked = true; |
  |  | 190 | } else { |
  |  | 191 | document.getElementsByClassName(child\_id\_private)[0].checked = false; |
  |  | 192 | } |
  |  | 193 |  |
  |  | 194 | document.getElementsByClassName(child\_id\_private)[0].disabled = true; |
  |  | 195 |  |
  |  | 196 | if( jQuery('#'+child\_id\_default\_role\_valid).length ) { |
  |  | 197 | document.getElementById(child\_id\_default\_role\_valid).disabled = true; |
  |  | 198 | } |
  |  | 199 | } |
  |  | 200 | } |
  |  | 201 |  |
  |  | 202 | if(hidden\_child\_id\_value==1){ |
  |  | 203 | document.getElementById(hidden\_child\_id).value = 2; |
  |  | 204 | } else { |
  |  | 205 | document.getElementById(hidden\_child\_id).value = 1; |
  |  | 206 | } |
  |  | 207 | } |
  |  | 208 |  |
  |  | 209 | function apply\_to\_child(x){ |
  |  | 210 | var default\_role = 'mo\_page\_default\_role\_valid\_' + x; |
  |  | 211 | var elementExists = document.getElementById(default\_role); |
  |  | 212 |  |
  |  | 213 | if(elementExists){ |
  |  | 214 | if(document.getElementById(default\_role).checked){ |
  |  | 215 | var valid = "child\_list\_" + x; |
  |  | 216 | var value = document.getElementById(valid).value; |
  |  | 217 |  |
  |  | 218 | var parent\_id\_private = "mo\_page\_login\_valid\_" + x; |
  |  | 219 |  |
  |  | 220 | if(document.getElementsByClassName(parent\_id\_private)[0].checked == true){ |
  |  | 221 | var parent\_id\_private\_value = 1; |
  |  | 222 | } else { |
  |  | 223 | var parent\_id\_private\_value = 2; |
  |  | 224 | } |
  |  | 225 |  |
  |  | 226 | text = value.slice(1, -1); |
  |  | 227 | var myArray = text.split(","); |
  |  | 228 |  |
  |  | 229 | if(parent\_id\_private\_value==1){ |
  |  | 230 | for (var i = 0; i < myArray.length; i++) { |
  |  | 231 | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  |  | 232 | document.getElementsByClassName(child\_id\_private)[0].checked = true; |
  |  | 233 | } |
  |  | 234 | } |
  |  | 235 |  |
  |  | 236 | if(parent\_id\_private\_value==2){ |
  |  | 237 | for (var i = 0; i < myArray.length; i++) { |
  |  | 238 | var child\_id\_private = "mo\_page\_login\_valid\_" + myArray[i]; |
  |  | 239 | document.getElementsByClassName(child\_id\_private)[0].checked = false; |
  |  | 240 | } |
  |  | 241 | } |
  |  | 242 | } |
  |  | 243 | } |
  |  | 244 | } |
  |  | 245 |  |
  |  | 246 | function apply\_roles\_to\_child(event, x){ |
  |  | 247 | // if(event.key==='Enter'){ |
  |  | 248 | //     event.preventDefault(); |
  |  | 249 | //     return false; |
  |  | 250 | // } |
  |  | 251 |  |
  |  | 252 | var default\_role = 'mo\_page\_default\_role\_valid\_' + x; |
  |  | 253 | var elementExists = document.getElementById(default\_role); |
  |  | 254 |  |
  |  | 255 | if(elementExists){ |
  |  | 256 | if(document.getElementById(default\_role).checked){ |
  |  | 257 | var valid = "child\_list\_" + x; |
  |  | 258 | var value = document.getElementById(valid).value; |
  |  | 259 |  |
  |  | 260 | var parent\_id\_roles = "mo\_page\_roles\_" + x; |
  |  | 261 | var parent\_id\_role\_value = document.getElementById(parent\_id\_roles).value; |
  |  | 262 |  |
  |  | 263 | text = value.slice(1, -1); |
  |  | 264 | var myArray = text.split(","); |
  |  | 265 |  |
  |  | 266 | for (var i = 0; i < myArray.length; i++) { |
  |  | 267 | var child\_id\_role = "mo\_page\_roles\_" + myArray[i]; |
  |  | 268 | document.getElementById(child\_id\_role).value = parent\_id\_role\_value; |
  |  | 269 | } |
  |  | 270 | } |
  |  | 271 | } |
  |  | 272 | //auto assign the checkbox of make private pages checked while entering a role |
  |  | 273 | auto\_private\_when\_roles\_assigned(x,'page'); |
  |  | 274 | } |
  |  | 275 |  |
  |  | 276 | jQuery(".roles\_multi").chosen({no\_results\_text: "Oops, nothing found!"}); |
  |  | 277 |  |
  |  | 278 | jQuery(function() { |
  |  | 279 |  |
  |  | 280 | function split(val) { |
  |  | 281 | return val.split(/;\s\*/); |
  |  | 282 | } |
  |  | 283 |  |
  |  | 284 | function extractLast(term) { |
  |  | 285 | return split(term).pop(); |
  |  | 286 | } |
  |  | 287 |  |
  |  | 288 | var mo\_roles = <?php echo json\_encode( $mo\_roles ); ?>; |
  |  | 289 |  |
  |  | 290 | jQuery(".mo\_roles\_suggest") |
  |  | 291 | .on("keydown", function(event) { |
  |  | 292 | if (event.keyCode === jQuery.ui.keyCode.TAB && jQuery(this).autocomplete("instance").menu.active) { |
  |  | 293 | event.preventDefault(); |
  |  | 294 | } |
  |  | 295 | }) |
  |  | 296 | .autocomplete({ |
  |  | 297 | minLength: 0, |
  |  | 298 | source: function(request, response) { |
  |  | 299 | response(jQuery.ui.autocomplete.filter(mo\_roles, extractLast(request.term))); |
  |  | 300 | }, |
  |  | 301 | focus: function() { |
  |  | 302 | return false; |
  |  | 303 | }, |
  |  | 304 | select: function(event, ui) { |
  |  | 305 | var terms = split(this.value); |
  |  | 306 | terms.pop(); |
  |  | 307 | terms.push(ui.item.value); |
  |  | 308 | terms.push(""); |
  |  | 309 | this.value = terms.join(";"); |
  |  | 310 | return false; |
  |  | 311 | } |
  |  | 312 | }); |
  |  | 313 | }); |
  |  | 314 |  |
  |  | 315 | var page\_selector\_up = document.getElementById("current-page-selector"); |
  |  | 316 | var page\_selector\_down = document.getElementById("current-page-selector-1"); |
  |  | 317 | var page\_search\_link = document.getElementById("mo\_page\_search"); |
  |  | 318 | var link = 'admin.php?page=page\_restriction&curr='; |
  |  | 319 |  |
  |  | 320 | page\_selector\_up.addEventListener("keyup", function(event) { |
  |  | 321 | if (event.keyCode === 13) { |
  |  | 322 | page\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  |  | 323 | var page\_link = link.concat(page\_selector\_up\_value); |
  |  | 324 | window.open(page\_link, "\_self"); |
  |  | 325 | } |
  |  | 326 | }); |
  |  | 327 |  |
  |  | 328 | page\_selector\_down.addEventListener("keyup", function(event) { |
  |  | 329 | if (event.keyCode === 13) { |
  |  | 330 | page\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  |  | 331 | var page\_link = link.concat(page\_selector\_down\_value); |
  |  | 332 | window.open(page\_link, "\_self"); |
  |  | 333 | } |
  |  | 334 | }); |
  |  | 335 |  |
  |  | 336 | page\_search\_link.addEventListener("keyup", function(event) { |
  |  | 337 | if (event.keyCode === 13) { |
  |  | 338 | page\_search\_link\_value = document.getElementById("mo\_page\_search").value; |
  |  | 339 | var search\_link = 'admin.php?page=page\_restriction&search='; |
  |  | 340 | var page\_link = search\_link.concat(page\_search\_link\_value); |
  |  | 341 | window.open(page\_link, "\_self"); |
  |  | 342 | } |
  |  | 343 | }); |
  |  | 344 | </script> |
  |  | 345 | </div> |
  |  | 346 | <?php |
  | 347 | 347 | } |
  | 348 | 348 |  |
  | 349 |  | function papr\_display\_filtered\_pages($mo\_page\_search\_value,$pagination, $current\_page,$allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle) { |
  | 350 |  | $row\_no = 1; |
  | 351 |  |  |
  | 352 |  | if ($current\_page == 1 && $mo\_page\_search\_value=='') { |
  | 353 |  | $color = '#f1f6ff'; |
  | 354 |  | papr\_display\_pages($mo\_page\_search\_value, 0, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle); |
  | 355 |  | $row\_no = 2; |
  | 356 |  | } |
  | 357 |  |  |
  | 358 |  | foreach ($pagination as $page) { |
  | 359 |  | $color = '#f1f6ff'; |
  | 360 |  | if ($row\_no % 2 == 0) |
  | 361 |  | $color = '#fff'; |
  | 362 |  |  |
  | 363 |  | papr\_display\_pages($mo\_page\_search\_value, $page, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle); |
  | 364 |  |  |
  | 365 |  | if ($mo\_page\_search\_value=='') { |
  | 366 |  | $children = get\_pages(array('child\_of' => $page->ID)); |
  | 367 |  | if (count($children) > 0) { |
  | 368 |  | foreach ($children as $child) { |
  | 369 |  | papr\_display\_pages($mo\_page\_search\_value, $child, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle); |
  | 370 |  | } |
  | 371 |  | } |
  | 372 |  | } |
  | 373 |  |  |
  | 374 |  | $row\_no++; |
  | 375 |  | } |
  |  | 349 | function papr\_display\_filtered\_pages( $mo\_page\_search\_value, $pagination, $current\_page, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ) { |
  |  | 350 | $row\_no = 1; |
  |  | 351 |  |
  |  | 352 | if ( $current\_page == 1 && $mo\_page\_search\_value == '' ) { |
  |  | 353 | $color = '#f1f6ff'; |
  |  | 354 | papr\_display\_pages( $mo\_page\_search\_value, 0, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ); |
  |  | 355 | $row\_no = 2; |
  |  | 356 | } |
  |  | 357 |  |
  |  | 358 | foreach ( $pagination as $page ) { |
  |  | 359 | $color = '#f1f6ff'; |
  |  | 360 | if ( $row\_no % 2 == 0 ) { |
  |  | 361 | $color = '#fff'; |
  |  | 362 | } |
  |  | 363 |  |
  |  | 364 | papr\_display\_pages( $mo\_page\_search\_value, $page, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ); |
  |  | 365 |  |
  |  | 366 | if ( $mo\_page\_search\_value == '' ) { |
  |  | 367 | $children = get\_pages( array( 'child\_of' => $page->ID ) ); |
  |  | 368 | if ( count( $children ) > 0 ) { |
  |  | 369 | foreach ( $children as $child ) { |
  |  | 370 | papr\_display\_pages( $mo\_page\_search\_value, $child, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ); |
  |  | 371 | } |
  |  | 372 | } |
  |  | 373 | } |
  |  | 374 |  |
  |  | 375 | $row\_no++; |
  |  | 376 | } |
  | 376 | 377 | } |
  | 377 | 378 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-post-access.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-post-access.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-post-access.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-post-access.php?rev=2829798#L6 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-post-access.php?rev=3034414#L6 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 6 | 6 |  |
  | 7 | 7 | function papr\_post\_access() { |
  | 8 |  |  |
  | 9 |  | ~~$results\_per\_page               =  get\_option('papr\_post\_per\_page'~~); |
  | 10 |  | ~~$allowed\_roles                  =  get\_option('papr\_allowed\_roles\_for\_posts'~~); |
  | 11 |  | ~~$allowed\_redirect\_post          =  get\_option('papr\_allowed\_redirect\_for\_posts'~~); |
  | 12 |  | ~~$access\_for\_only\_loggedin\_post  =  get\_option('papr\_access\_for\_only\_loggedin\_posts'~~); |
  | 13 |  | ~~$unrestricted\_posts             =  get\_option('papr\_login\_unrestricted\_posts'~~); |
  | 14 |  | ~~$post\_type                      =  get\_option('papr\_post\_type'~~); |
  | 15 |  |  |
  | 16 |  | ~~$results\_per\_page               =~~  $results\_per\_page != '' ? $results\_per\_page : 10; |
  | 17 |  | ~~$allowed\_roles                  =~~  $allowed\_roles != '' ? $allowed\_roles : array(); |
  | 18 |  | ~~$allowed\_redirect\_post          =~~  $allowed\_redirect\_post != '' ? $allowed\_redirect\_post : array(); |
  | 19 |  | ~~$access\_for\_only\_loggedin\_post  =  $access\_for\_only\_loggedin\_post != '' ? $access\_for\_only\_loggedin\_post : ""~~; |
  | 20 |  | ~~$unrestricted\_posts             =~~  $unrestricted\_posts ? $unrestricted\_posts : array(); |
  | 21 |  | ~~$post\_type                      =~~  $post\_type != '' ? $post\_type : 'post'; |
  | 22 |  |  |
  | 23 |  | ~~$mo\_post\_search\_value = ""~~; |
  | 24 |  | ~~if (array\_key\_exists('search', $\_GET)~~) { |
  | 25 |  | ~~$mo\_post\_search\_value = sanitize\_text\_field($\_GET['search']~~); |
  | 26 |  | } |
  | 27 |  |  |
  | 28 |  | $post\_array\_type = get\_post\_types(); |
  | 29 |  |  |
  | 30 |  | ~~if(empty($post\_array\_type[$post\_type]))~~{ |
  | 31 |  | $post\_type = 'post'; |
  | 32 |  | ~~update\_option('papr\_post\_type',$post\_type~~); |
  | 33 |  | } |
  | 34 |  |  |
  | 35 |  | ?> |
  | 36 |  |  |
  | 37 |  | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  | 38 |  | <h4 class="papr-form-head">Give Access to Posts based on Roles and Login Status</h4> |
  | 39 |  | <?php papr\_post\_toggle\_all\_pages(); ?> |
  | 40 |  | <?php papr\_restriction\_behaviour\_pages(); ?> |
  | 41 |  | <hr class="mt-4"/> |
  | 42 |  | <h5 class="papr-form-head papr-form-head-bar mt-5">Post Restrictions |
  | 43 |  | <div class="papr-info-global ms-2"> |
  | 44 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 45 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 46 |  | </svg> |
  | 47 |  | <p class="papr-info-text-global"> |
  | 48 |  | Specify which pages would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the page in the table below. |
  | 49 |  | </p> |
  | 50 |  | </div> |
  | 51 |  | </h5> |
  | 52 |  | <div class="tablenav top mt-4"> |
  | 53 |  | ~~<?php papr\_dropdown($results\_per\_page, 'post', $post\_type~~); ?> |
  | 54 |  | ~~<?php papr\_search\_box('post',$mo\_post\_search\_value~~); ?> |
  | 55 |  |  |
  | 56 |  | <form name="f" method="post" action="" id="blockedpagesform"> |
  | 57 |  | ~~<?php wp\_nonce\_field("papr\_restrict\_post\_roles\_login"~~); ?> |
  | 58 |  | <input type="hidden" name="option" value="papr\_restrict\_post\_roles\_login" form="blockedpagesform" /> |
  | 59 |  | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  | 60 |  |  |
  | 61 |  | <?php |
  | 62 |  |  |
  | 63 |  | ~~$total\_post = papr\_get\_page\_post\_count($mo\_post\_search\_value, $post\_type~~); |
  | 64 |  | ~~$number\_of\_pages\_in\_pagination = ceil($total\_post / $results\_per\_page~~); |
  | 65 |  | ~~$current\_page = papr\_get\_current\_page($number\_of\_pages\_in\_pagination~~); |
  | 66 |  | ~~$pagination = papr\_get\_paginated\_pages\_post($mo\_post\_search\_value, $results\_per\_page, $current\_page, $post\_type~~); |
  | 67 |  |  |
  | 68 |  | $link = 'admin.php?page=page\_restriction&tab=post\_access&curr='; |
  | 69 |  | ~~if($mo\_post\_search\_value!='')~~{ |
  | 70 |  | ~~$link = 'admin.php?page=page\_restriction&tab=post\_access&search='.$mo\_post\_search\_value.~~'&curr='; |
  | 71 |  | } |
  | 72 |  |  |
  | 73 |  | ~~papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_post, $current\_page, $link, 'top'~~); |
  | 74 |  | ?> |
  | 75 |  | </div> |
  | 76 |  |  |
  | 77 |  | <table id="reports\_table" class="wp-list-table widefat fixed striped table-view-list pages" style="width:99%;"> |
  | 78 |  | ~~<thead><?php papr\_display\_head\_foot\_of\_table('Post'~~); ?></thead> |
  | 79 |  | <tbody style="width:100%;"> |
  | 80 |  | <?php |
  | 81 |  | ~~if(count($pagination)==0)~~{ |
  | 82 |  | echo '<tr><td><b>No Results</b></td><td></td><td></td></tr>'; |
  | 83 |  | } |
  | 84 |  | ~~else~~ { |
  | 85 |  | foreach ($pagination as $post) { |
  | 86 |  | papr\_post\_display\_pages($post, $allowed\_roles, $allowed\_redirect\_post, $unrestricted\_posts, $access\_for\_only\_loggedin\_post,$post\_type); |
  | 87 |  | } |
  | 88 |  | ~~}~~ ?> |
  | 89 |  | </tbody> |
  | 90 |  | ~~<thead><?php papr\_display\_head\_foot\_of\_table('Post'~~); ?></thead> |
  | 91 |  | </table> |
  | 92 |  |  |
  | 93 |  | <div class="tablenav bottom"> |
  | 94 |  | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  | 95 |  | <?php |
  | 96 |  | ~~papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_post, $current\_page, $link, 'bottom'~~); |
  | 97 |  | $mo\_roles = array(); |
  | 98 |  | global $wp\_roles; |
  | 99 |  | $roles = $wp\_roles->roles; |
  | 100 |  | ~~foreach ($roles as $key => $val)~~{ |
  | 101 |  | $mo\_roles[] = $key; |
  | 102 |  | } |
  | 103 |  | ?> |
  | 104 |  |  |
  | 105 |  | <script> |
  | 106 |  | jQuery(".roles\_multi").chosen({no\_results\_text: "Oops, nothing found!"}); |
  | 107 |  |  |
  | 108 |  | var post\_selector\_up = document.getElementById("current-page-selector"); |
  | 109 |  | var post\_selector\_down = document.getElementById("current-page-selector-1"); |
  | 110 |  | var post\_search\_link = document.getElementById("mo\_post\_search"); |
  | 111 |  | var link = 'admin.php?page=page\_restriction&tab=post\_access&curr='; |
  | 112 |  |  |
  | 113 |  | post\_selector\_up.addEventListener("keyup", function(event) { |
  | 114 |  | if (event.keyCode === 13) { |
  | 115 |  | post\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  | 116 |  | var page\_link = link.concat(post\_selector\_up\_value); |
  | 117 |  | window.open(page\_link, "\_self"); |
  | 118 |  | } |
  | 119 |  | }); |
  | 120 |  |  |
  | 121 |  | post\_selector\_down.addEventListener("keyup", function(event) { |
  | 122 |  | if (event.keyCode === 13) { |
  | 123 |  | post\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  | 124 |  | var page\_link = link.concat(post\_selector\_down\_value); |
  | 125 |  | window.open(page\_link, "\_self"); |
  | 126 |  | } |
  | 127 |  | }); |
  | 128 |  |  |
  | 129 |  | post\_search\_link.addEventListener("keyup", function(event) { |
  | 130 |  | if (event.keyCode === 13) { |
  | 131 |  | post\_search\_link\_value = document.getElementById("mo\_post\_search").value; |
  | 132 |  | var search\_link = 'admin.php?page=page\_restriction&tab=post\_access&search='; |
  | 133 |  | var post\_link = search\_link.concat(post\_search\_link\_value); |
  | 134 |  | window.open(post\_link, "\_self"); |
  | 135 |  | } |
  | 136 |  | }); |
  | 137 |  |  |
  | 138 |  | var closebtns = document.getElementsByClassName("close"); |
  | 139 |  | var i; |
  | 140 |  |  |
  | 141 |  | for (i = 0; i < closebtns.length; i++) { |
  | 142 |  | closebtns[i].addEventListener("click", function() { |
  | 143 |  | this.parentElement.style.display = 'none'; |
  | 144 |  | }); |
  | 145 |  | } |
  | 146 |  |  |
  | 147 |  | jQuery(function() { |
  | 148 |  |  |
  | 149 |  | function split(val) { |
  | 150 |  | return val.split(/;\s\*/); |
  | 151 |  | } |
  | 152 |  |  |
  | 153 |  | function extractLast(term) { |
  | 154 |  | return split(term).pop(); |
  | 155 |  | } |
  | 156 |  |  |
  | 157 |  | ~~var mo\_roles = <?php echo json\_encode($mo\_roles~~); ?>; |
  | 158 |  |  |
  | 159 |  | jQuery(".mo\_roles\_suggest") |
  | 160 |  | .on("keydown", function(event) { |
  | 161 |  | if (event.keyCode === jQuery.ui.keyCode.TAB && jQuery(this).autocomplete("instance").menu.active) { |
  | 162 |  | event.preventDefault(); |
  | 163 |  | } |
  | 164 |  | }) |
  | 165 |  | .autocomplete({ |
  | 166 |  | minLength: 0, |
  | 167 |  | source: function(request, response) { |
  | 168 |  | response(jQuery.ui.autocomplete.filter(mo\_roles, extractLast(request.term))); |
  | 169 |  | }, |
  | 170 |  | focus: function() { |
  | 171 |  | return false; |
  | 172 |  | }, |
  | 173 |  | select: function(event, ui) { |
  | 174 |  | var terms = split(this.value); |
  | 175 |  | terms.pop(); |
  | 176 |  | terms.push(ui.item.value); |
  | 177 |  | terms.push(""); |
  | 178 |  | this.value = terms.join(";"); |
  | 179 |  | return false; |
  | 180 |  | } |
  | 181 |  | }); |
  | 182 |  | }); |
  | 183 |  | </script> |
  | 184 |  | </div> |
  | 185 |  | </form> |
  | 186 |  | <br><br> |
  | 187 |  | </div> |
  | 188 |  | <?php |
  |  | 8 |  |
  |  | 9 | $results\_per\_page              = get\_option( 'papr\_post\_per\_page' ); |
  |  | 10 | $allowed\_roles                 = get\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 11 | $allowed\_redirect\_post         = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 12 | $access\_for\_only\_loggedin\_post = get\_option( 'papr\_access\_for\_only\_loggedin\_posts' ); |
  |  | 13 | $unrestricted\_posts            = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 14 | $post\_type                     = get\_option( 'papr\_post\_type' ); |
  |  | 15 |  |
  |  | 16 | $results\_per\_page              = $results\_per\_page != '' ? $results\_per\_page : 10; |
  |  | 17 | $allowed\_roles                 = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 18 | $allowed\_redirect\_post         = $allowed\_redirect\_post != '' ? $allowed\_redirect\_post : array(); |
  |  | 19 | $access\_for\_only\_loggedin\_post = $access\_for\_only\_loggedin\_post != '' ? $access\_for\_only\_loggedin\_post : ''; |
  |  | 20 | $unrestricted\_posts            = $unrestricted\_posts ? $unrestricted\_posts : array(); |
  |  | 21 | $post\_type                     = $post\_type != '' ? $post\_type : 'post'; |
  |  | 22 |  |
  |  | 23 | $mo\_post\_search\_value = ''; |
  |  | 24 | if ( array\_key\_exists( 'search', $\_GET ) ) { |
  |  | 25 | $mo\_post\_search\_value = sanitize\_text\_field( $\_GET['search'] ); |
  |  | 26 | } |
  |  | 27 |  |
  |  | 28 | $post\_array\_type = get\_post\_types(); |
  |  | 29 |  |
  |  | 30 | if ( empty( $post\_array\_type[ $post\_type ] ) ) { |
  |  | 31 | $post\_type = 'post'; |
  |  | 32 | update\_option( 'papr\_post\_type', $post\_type ); |
  |  | 33 | } |
  |  | 34 |  |
  |  | 35 | ?> |
  |  | 36 |  |
  |  | 37 | <div class="rounded bg-white papr-shadow p-4 ms-4 mt-4"> |
  |  | 38 | <h4 class="papr-form-head">Give Access to Posts based on Roles and Login Status</h4> |
  |  | 39 | <?php papr\_post\_toggle\_all\_pages(); ?> |
  |  | 40 | <?php papr\_restriction\_behaviour\_pages(); ?> |
  |  | 41 | <hr class="mt-4"/> |
  |  | 42 | <h5 class="papr-form-head papr-form-head-bar mt-5">Post Restrictions |
  |  | 43 | <div class="papr-info-global ms-2"> |
  |  | 44 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 45 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 46 | </svg> |
  |  | 47 | <p class="papr-info-text-global"> |
  |  | 48 | Specify which pages would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the page in the table below. |
  |  | 49 | </p> |
  |  | 50 | </div> |
  |  | 51 | </h5> |
  |  | 52 | <div class="tablenav top mt-4"> |
  |  | 53 | <?php papr\_dropdown( $results\_per\_page, 'post', $post\_type ); ?> |
  |  | 54 | <?php papr\_search\_box( 'post', $mo\_post\_search\_value ); ?> |
  |  | 55 |  |
  |  | 56 | <form name="f" method="post" action="" id="blockedpagesform"> |
  |  | 57 | <?php wp\_nonce\_field( 'papr\_restrict\_post\_roles\_login' ); ?> |
  |  | 58 | <input type="hidden" name="option" value="papr\_restrict\_post\_roles\_login" form="blockedpagesform" /> |
  |  | 59 | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  |  | 60 |  |
  |  | 61 | <?php |
  |  | 62 |  |
  |  | 63 | $total\_post                    = papr\_get\_page\_post\_count( $mo\_post\_search\_value, $post\_type ); |
  |  | 64 | $number\_of\_pages\_in\_pagination = ceil( $total\_post / $results\_per\_page ); |
  |  | 65 | $current\_page                  = papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ); |
  |  | 66 | $pagination                    = papr\_get\_paginated\_pages\_post( $mo\_post\_search\_value, $results\_per\_page, $current\_page, $post\_type ); |
  |  | 67 |  |
  |  | 68 | $link = 'admin.php?page=page\_restriction&tab=post\_access&curr='; |
  |  | 69 | if ( $mo\_post\_search\_value != '' ) { |
  |  | 70 | $link = 'admin.php?page=page\_restriction&tab=post\_access&search=' . $mo\_post\_search\_value . '&curr='; |
  |  | 71 | } |
  |  | 72 |  |
  |  | 73 | papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_post, $current\_page, $link, 'top' ); |
  |  | 74 | ?> |
  |  | 75 | </div> |
  |  | 76 |  |
  |  | 77 | <table id="reports\_table" class="wp-list-table widefat fixed striped table-view-list pages" style="width:99%;"> |
  |  | 78 | <thead><?php papr\_display\_head\_foot\_of\_table( 'Post' ); ?></thead> |
  |  | 79 | <tbody style="width:100%;"> |
  |  | 80 | <?php |
  |  | 81 | if ( count( $pagination ) == 0 ) { |
  |  | 82 | echo '<tr><td><b>No Results</b></td><td></td><td></td></tr>'; |
  |  | 83 | } else { |
  |  | 84 | foreach ( $pagination as $post ) { |
  |  | 85 | papr\_post\_display\_pages( $post, $allowed\_roles, $allowed\_redirect\_post, $unrestricted\_posts, $access\_for\_only\_loggedin\_post, $post\_type ); |
  |  | 86 | } |
  |  | 87 | } |
  |  | 88 | ?> |
  |  | 89 | </tbody> |
  |  | 90 | <thead><?php papr\_display\_head\_foot\_of\_table( 'Post' ); ?></thead> |
  |  | 91 | </table> |
  |  | 92 |  |
  |  | 93 | <div class="tablenav bottom"> |
  |  | 94 | <input type="submit" class="papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform"> |
  |  | 95 | <?php |
  |  | 96 | papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_post, $current\_page, $link, 'bottom' ); |
  |  | 97 | $mo\_roles = array(); |
  |  | 98 | global $wp\_roles; |
  |  | 99 | $roles = $wp\_roles->roles; |
  |  | 100 | foreach ( $roles as $key => $val ) { |
  |  | 101 | $mo\_roles[] = $key; |
  |  | 102 | } |
  |  | 103 | ?> |
  |  | 104 |  |
  |  | 105 | <script> |
  |  | 106 | jQuery(".roles\_multi").chosen({no\_results\_text: "Oops, nothing found!"}); |
  |  | 107 |  |
  |  | 108 | var post\_selector\_up = document.getElementById("current-page-selector"); |
  |  | 109 | var post\_selector\_down = document.getElementById("current-page-selector-1"); |
  |  | 110 | var post\_search\_link = document.getElementById("mo\_post\_search"); |
  |  | 111 | var link = 'admin.php?page=page\_restriction&tab=post\_access&curr='; |
  |  | 112 |  |
  |  | 113 | post\_selector\_up.addEventListener("keyup", function(event) { |
  |  | 114 | if (event.keyCode === 13) { |
  |  | 115 | post\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  |  | 116 | var page\_link = link.concat(post\_selector\_up\_value); |
  |  | 117 | window.open(page\_link, "\_self"); |
  |  | 118 | } |
  |  | 119 | }); |
  |  | 120 |  |
  |  | 121 | post\_selector\_down.addEventListener("keyup", function(event) { |
  |  | 122 | if (event.keyCode === 13) { |
  |  | 123 | post\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  |  | 124 | var page\_link = link.concat(post\_selector\_down\_value); |
  |  | 125 | window.open(page\_link, "\_self"); |
  |  | 126 | } |
  |  | 127 | }); |
  |  | 128 |  |
  |  | 129 | post\_search\_link.addEventListener("keyup", function(event) { |
  |  | 130 | if (event.keyCode === 13) { |
  |  | 131 | post\_search\_link\_value = document.getElementById("mo\_post\_search").value; |
  |  | 132 | var search\_link = 'admin.php?page=page\_restriction&tab=post\_access&search='; |
  |  | 133 | var post\_link = search\_link.concat(post\_search\_link\_value); |
  |  | 134 | window.open(post\_link, "\_self"); |
  |  | 135 | } |
  |  | 136 | }); |
  |  | 137 |  |
  |  | 138 | var closebtns = document.getElementsByClassName("close"); |
  |  | 139 | var i; |
  |  | 140 |  |
  |  | 141 | for (i = 0; i < closebtns.length; i++) { |
  |  | 142 | closebtns[i].addEventListener("click", function() { |
  |  | 143 | this.parentElement.style.display = 'none'; |
  |  | 144 | }); |
  |  | 145 | } |
  |  | 146 |  |
  |  | 147 | jQuery(function() { |
  |  | 148 |  |
  |  | 149 | function split(val) { |
  |  | 150 | return val.split(/;\s\*/); |
  |  | 151 | } |
  |  | 152 |  |
  |  | 153 | function extractLast(term) { |
  |  | 154 | return split(term).pop(); |
  |  | 155 | } |
  |  | 156 |  |
  |  | 157 | var mo\_roles = <?php echo json\_encode( $mo\_roles ); ?>; |
  |  | 158 |  |
  |  | 159 | jQuery(".mo\_roles\_suggest") |
  |  | 160 | .on("keydown", function(event) { |
  |  | 161 | if (event.keyCode === jQuery.ui.keyCode.TAB && jQuery(this).autocomplete("instance").menu.active) { |
  |  | 162 | event.preventDefault(); |
  |  | 163 | } |
  |  | 164 | }) |
  |  | 165 | .autocomplete({ |
  |  | 166 | minLength: 0, |
  |  | 167 | source: function(request, response) { |
  |  | 168 | response(jQuery.ui.autocomplete.filter(mo\_roles, extractLast(request.term))); |
  |  | 169 | }, |
  |  | 170 | focus: function() { |
  |  | 171 | return false; |
  |  | 172 | }, |
  |  | 173 | select: function(event, ui) { |
  |  | 174 | var terms = split(this.value); |
  |  | 175 | terms.pop(); |
  |  | 176 | terms.push(ui.item.value); |
  |  | 177 | terms.push(""); |
  |  | 178 | this.value = terms.join(";"); |
  |  | 179 | return false; |
  |  | 180 | } |
  |  | 181 | }); |
  |  | 182 | }); |
  |  | 183 | </script> |
  |  | 184 | </div> |
  |  | 185 | </form> |
  |  | 186 | <br><br> |
  |  | 187 | </div> |
  |  | 188 | <?php |
  | 189 | 189 | } |
  | 190 | 190 |  |
  | 191 |  | function papr\_post\_display\_pages($post, $allowed\_roles, $allowed\_redirect\_post, $unrestricted\_posts, $access\_for\_only\_loggedin\_post,$post\_type) { |
  | 192 |  | $disabled = ''; |
  | 193 |  | if($post\_type != 'post') |
  | 194 |  | $disabled = 'disabled'; |
  | 195 |  |  |
  | 196 |  | $postid = $post->ID; |
  | 197 |  | ?> |
  | 198 |  | <tr id="<?php echo esc\_attr($post->ID) ?>" <?php |
  | 199 |  | if($post\_type != 'post'){ echo ' class="papr-prem-info"'; } ?> > |
  | 200 |  | <td> |
  | 201 |  | <a href="<?php echo esc\_url($post->guid) ?>" target="\_blank"> <?php echo esc\_html($post->post\_title) ?>&nbsp; |
  | 202 |  | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 203 |  | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 204 |  | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | 205 |  | </svg> |
  | 206 |  | </a> |
  | 207 |  | </td> |
  | 208 |  | <?php |
  | 209 |  | $mo\_post\_roles\_value = array(); |
  | 210 |  | if (!empty($allowed\_roles[$post->ID])) { |
  | 211 |  | $mo\_post\_roles\_value = $allowed\_roles[$post->ID]; |
  | 212 |  | } |
  | 213 |  | $mo\_post\_val=implode(";",$mo\_post\_roles\_value); |
  | 214 |  | ?> |
  | 215 |  | <td> |
  | 216 |  | <input type="hidden" name="mo\_hidden\_post\_roles\_<?php echo esc\_attr($postid) ?>[]" id="mo\_hidden\_post\_roles\_<?php echo esc\_attr($postid) ?>" value="<?php echo esc\_attr($mo\_post\_val) ?>"> |
  | 217 |  | <select multiple class="roles\_multi w-75" name="mo\_post\_roles\_<?php echo esc\_attr($postid) ?>[]" id="mo\_post\_roles\_<?php echo esc\_attr($postid) ?>" value="<?php echo esc\_attr($mo\_post\_val) ?>" onchange="auto\_private\_when\_roles\_assigned(<?php echo esc\_js($postid); ?>,'post')"> |
  | 218 |  | <?php |
  | 219 |  | papr\_display\_roles($mo\_post\_roles\_value); |
  | 220 |  | ?> |
  | 221 |  | </select> |
  | 222 |  | </td> |
  | 223 |  |  |
  | 224 |  | <?php |
  | 225 |  | $mo\_post\_login\_check = ""; |
  | 226 |  | $mo\_post\_login\_check\_value = ""; |
  | 227 |  |  |
  | 228 |  | if (!empty($allowed\_redirect\_post[$post->ID])) { |
  | 229 |  | $mo\_post\_login\_check\_value = $allowed\_redirect\_post[$post->ID]; |
  | 230 |  | } |
  | 231 |  |  |
  | 232 |  | if ($mo\_post\_login\_check\_value == 1 || $mo\_post\_login\_check\_value == 'on' || $mo\_post\_login\_check\_value == 'true' || $access\_for\_only\_loggedin\_post == 1) { |
  | 233 |  | if($post\_type == 'post') |
  | 234 |  | $mo\_post\_login\_check = 'checked'; |
  | 235 |  | } |
  | 236 |  |  |
  | 237 |  | if ($access\_for\_only\_loggedin\_post == 1 && !empty($unrestricted\_posts[$postid])) { |
  | 238 |  | $mo\_post\_login\_check = ''; |
  | 239 |  | } |
  | 240 |  |  |
  | 241 |  | ?> |
  |  | 191 | function papr\_post\_display\_pages( $post, $allowed\_roles, $allowed\_redirect\_post, $unrestricted\_posts, $access\_for\_only\_loggedin\_post, $post\_type ) { |
  |  | 192 | $disabled = ''; |
  |  | 193 | if ( $post\_type != 'post' ) { |
  |  | 194 | $disabled = 'disabled'; |
  |  | 195 | } |
  |  | 196 |  |
  |  | 197 | $postid = $post->ID; |
  |  | 198 | ?> |
  |  | 199 | <tr id="<?php echo esc\_attr( $post->ID ); ?>" |
  |  | 200 | <?php |
  |  | 201 | if ( $post\_type != 'post' ) { |
  |  | 202 | echo ' class="papr-prem-info"'; } |
  |  | 203 | ?> |
  |  | 204 | > |
  |  | 205 | <td> |
  |  | 206 | <a href="<?php echo esc\_url( $post->guid ); ?>" target="\_blank"> <?php echo esc\_html( $post->post\_title ); ?>&nbsp; |
  |  | 207 | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 208 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  |  | 209 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  |  | 210 | </svg> |
  |  | 211 | </a> |
  |  | 212 | </td> |
  |  | 213 | <?php |
  |  | 214 | $mo\_post\_roles\_value = array(); |
  |  | 215 | if ( ! empty( $allowed\_roles[ $post->ID ] ) ) { |
  |  | 216 | $mo\_post\_roles\_value = $allowed\_roles[ $post->ID ]; |
  |  | 217 | } |
  |  | 218 | $mo\_post\_val = implode( ';', $mo\_post\_roles\_value ); |
  |  | 219 | ?> |
  |  | 220 | <td> |
  |  | 221 | <input type="hidden" name="mo\_hidden\_post\_roles\_<?php echo esc\_attr( $postid ); ?>[]" id="mo\_hidden\_post\_roles\_<?php echo esc\_attr( $postid ); ?>" value="<?php echo esc\_attr( $mo\_post\_val ); ?>"> |
  |  | 222 | <select multiple class="roles\_multi w-75" name="mo\_post\_roles\_<?php echo esc\_attr( $postid ); ?>[]" id="mo\_post\_roles\_<?php echo esc\_attr( $postid ); ?>" value="<?php echo esc\_attr( $mo\_post\_val ); ?>" onchange="auto\_private\_when\_roles\_assigned(<?php echo esc\_js( $postid ); ?>,'post')"> |
  |  | 223 | <?php |
  |  | 224 | papr\_display\_roles( $mo\_post\_roles\_value ); |
  |  | 225 | ?> |
  |  | 226 | </select> |
  |  | 227 | </td> |
  |  | 228 |  |
  |  | 229 | <?php |
  |  | 230 | $mo\_post\_login\_check       = ''; |
  |  | 231 | $mo\_post\_login\_check\_value = ''; |
  |  | 232 |  |
  |  | 233 | if ( ! empty( $allowed\_redirect\_post[ $post->ID ] ) ) { |
  |  | 234 | $mo\_post\_login\_check\_value = $allowed\_redirect\_post[ $post->ID ]; |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | if ( $mo\_post\_login\_check\_value == 1 || $mo\_post\_login\_check\_value == 'on' || $mo\_post\_login\_check\_value == 'true' || $access\_for\_only\_loggedin\_post == 1 ) { |
  |  | 238 | if ( $post\_type == 'post' ) { |
  |  | 239 | $mo\_post\_login\_check = 'checked'; |
  |  | 240 | } |
  |  | 241 | } |
  |  | 242 |  |
  |  | 243 | if ( $access\_for\_only\_loggedin\_post == 1 && ! empty( $unrestricted\_posts[ $postid ] ) ) { |
  |  | 244 | $mo\_post\_login\_check = ''; |
  |  | 245 | } |
  |  | 246 |  |
  |  | 247 | ?> |
  | 242 | 248 | <th scope="row" class="check-column"> |
  | 243 | 249 | <label class="screen-reader-text" for="cb-select-3"></label> |
  | 244 |  | <input style="text-align:center; margin-left: 88px;" id="cb-select-3" name="mo\_post\_login\_<?php echo esc\_attr($post->ID) ?>" class="mo\_post\_login\_valid\_<?php echo esc\_attr($post->ID) ?>" <?php echo esc\_attr($disabled) ?> type="checkbox" <?php echo esc\_attr($mo\_post\_login\_check) ?> > |
  | 245 |  | <?php |
  | 246 |  | if($post\_type != 'post') { ?> |
  | 247 |  | <div class="papr-prem-icn papr-prem-icn-log" style="margin-left:130px;"><img src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>includes/images/lock.png" width="35px" /> |
  | 248 |  | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan')) ?>" class="text-warning">Click here to upgrade</a></p> |
  | 249 |  | </div> |
  | 250 |  | <?php |
  | 251 |  | } |
  | 252 |  | ?> |
  |  | 250 | <input style="text-align:center; margin-left: 88px;" id="cb-select-3" name="mo\_post\_login\_<?php echo esc\_attr( $post->ID ); ?>" class="mo\_post\_login\_valid\_<?php echo esc\_attr( $post->ID ); ?>" <?php echo esc\_attr( $disabled ); ?> type="checkbox" <?php echo esc\_attr( $mo\_post\_login\_check ); ?> > |
  |  | 251 | <?php |
  |  | 252 | if ( $post\_type != 'post' ) { |
  |  | 253 | ?> |
  |  | 254 | <div class="papr-prem-icn papr-prem-icn-log" style="margin-left:130px;"><img src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>includes/images/lock.png" width="35px" /> |
  |  | 255 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?>" class="text-warning">Click here to upgrade</a></p> |
  |  | 256 | </div> |
  |  | 257 | <?php |
  |  | 258 | } |
  |  | 259 | ?> |
  | 253 | 260 | <div class="locked-indicator"> |
  | 254 | 261 | <span class="locked-indicator-icon" aria-hidden="true"></span> |
  | 255 | 262 | <span class="screen-reader-text"></span> |
  | 256 | 263 | </div> |
  | 257 |  | </th> |
  | 258 |  | </tr> |
  | 259 |  | <?php |
  |  | 264 | </th> |
  |  | 265 | </tr> |
  |  | 266 | <?php |
  | 260 | 267 | } |
  | 261 | 268 |  |
  | 262 | 269 | function papr\_post\_toggle\_all\_pages() { |
  | 263 |  | ?> |
  | 264 |  | <div class="mt-5"> |
  | 265 |  | <h5 class="papr-form-head papr-form-head-bar">Global Settings for all Posts |
  | 266 |  | <div class="ms-2 papr-info-global"> |
  | 267 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 268 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 269 |  | </svg> |
  | 270 |  | <p class="papr-info-text-global">These settings would be <b>applied to all posts</b> on this WordPress site.</p> |
  | 271 |  | </div> |
  | 272 |  | </h5> |
  | 273 |  | <form id="papr\_access\_for\_only\_loggedin\_posts" name="papr\_access\_for\_only\_loggedin\_posts" method="post" action="" class="mt-4"> |
  | 274 |  | <?php wp\_nonce\_field('papr\_access\_for\_only\_loggedin\_posts'); ?> |
  | 275 |  | <div class="row"> |
  | 276 |  | <div class="col-md-6"> |
  | 277 |  | <h6>Make all Posts accessible to only Logged In users |
  | 278 |  | <div class="ms-2 papr-info-global"> |
  | 279 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 280 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 281 |  | </svg> |
  | 282 |  | <p class="papr-info-text-global">Enable this toggle to <b>allow only logged in users</b> to access the default posts of this WordPress site.</p> |
  | 283 |  | </div> |
  | 284 |  | </h6> |
  | 285 |  | </div> |
  | 286 |  | <div class="col-md-6"> |
  | 287 |  | <label class="switch"> |
  | 288 |  | <input type="checkbox" id="logged\_in\_post" name="papr\_access\_for\_only\_loggedin\_posts" onChange="document.getElementById('papr\_access\_for\_only\_loggedin\_posts').submit()" |
  | 289 |  | <?php |
  | 290 |  | if (get\_site\_option('papr\_access\_for\_only\_loggedin\_posts') == 1) |
  | 291 |  | echo ' checked '; |
  | 292 |  | ?>/> |
  | 293 |  | <span class="slider round"></span> |
  | 294 |  | </label> |
  | 295 |  | </div> |
  | 296 |  | </div> |
  | 297 |  | <input type="hidden" name="option" value="papr\_access\_for\_only\_loggedin\_posts"> |
  | 298 |  | </form> |
  | 299 |  | </div> |
  | 300 |  | <?php |
  |  | 270 | ?> |
  |  | 271 | <div class="mt-5"> |
  |  | 272 | <h5 class="papr-form-head papr-form-head-bar">Global Settings for all Posts |
  |  | 273 | <div class="ms-2 papr-info-global"> |
  |  | 274 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 275 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 276 | </svg> |
  |  | 277 | <p class="papr-info-text-global">These settings would be <b>applied to all posts</b> on this WordPress site.</p> |
  |  | 278 | </div> |
  |  | 279 | </h5> |
  |  | 280 | <form id="papr\_access\_for\_only\_loggedin\_posts" name="papr\_access\_for\_only\_loggedin\_posts" method="post" action="" class="mt-4"> |
  |  | 281 | <?php wp\_nonce\_field( 'papr\_access\_for\_only\_loggedin\_posts' ); ?> |
  |  | 282 | <div class="row"> |
  |  | 283 | <div class="col-md-6"> |
  |  | 284 | <h6>Make all Posts accessible to only Logged In users |
  |  | 285 | <div class="ms-2 papr-info-global"> |
  |  | 286 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 287 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 288 | </svg> |
  |  | 289 | <p class="papr-info-text-global">Enable this toggle to <b>allow only logged in users</b> to access the default posts of this WordPress site.</p> |
  |  | 290 | </div> |
  |  | 291 | </h6> |
  |  | 292 | </div> |
  |  | 293 | <div class="col-md-6"> |
  |  | 294 | <label class="switch"> |
  |  | 295 | <input type="checkbox" id="logged\_in\_post" name="papr\_access\_for\_only\_loggedin\_posts" onChange="document.getElementById('papr\_access\_for\_only\_loggedin\_posts').submit()" |
  |  | 296 | <?php |
  |  | 297 | if ( get\_site\_option( 'papr\_access\_for\_only\_loggedin\_posts' ) == 1 ) { |
  |  | 298 | echo ' checked '; |
  |  | 299 | } |
  |  | 300 | ?> |
  |  | 301 | /> |
  |  | 302 | <span class="slider round"></span> |
  |  | 303 | </label> |
  |  | 304 | </div> |
  |  | 305 | </div> |
  |  | 306 | <input type="hidden" name="option" value="papr\_access\_for\_only\_loggedin\_posts"> |
  |  | 307 | </form> |
  |  | 308 | </div> |
  |  | 309 | <?php |
  | 301 | 310 | } |
  | 302 | 311 |  |
  | […](/browser/page-and-post-restriction/trunk/page-restriction-post-access.php?rev=2829798#L304) | […](/browser/page-and-post-restriction/trunk/page-restriction-post-access.php?rev=3034414#L313) |  |
  | 304 | 313 | $args = array( |
  | 305 | 314 | 'public'   => true, |
  | 306 |  | '\_builtin' => false |
  |  | 315 | '\_builtin' => false, |
  | 307 | 316 | ); |
  | 308 |  |  |
  | 309 |  | $output = 'names'; // names or objects, note names is the default |
  |  | 317 |  |
  |  | 318 | $output   = 'names'; // names or objects, note names is the default |
  | 310 | 319 | $operator = 'and'; // 'and' or 'or' |
  | 311 |  |  |
  | 312 |  | $post\_types = get\_post\_types( $args, $output, $operator ); |
  |  | 320 |  |
  |  | 321 | $post\_types = get\_post\_types( $args, $output, $operator ); |
  | 313 | 322 | return $post\_types; |
  | 314 | 323 | } |
* ## [page-and-post-restriction/trunk/page-restriction-premium-plan.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-premium-plan.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-premium-plan.php")

  | [r2866879](/browser/page-and-post-restriction/trunk/page-restriction-premium-plan.php?rev=2866879#L3 "Show revision 2866879 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-premium-plan.php?rev=3034414#L3 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | require\_once 'page-restriction-menu-settings.php'; |
  | 4 | 4 |  |
  | 5 |  | function papr\_show\_premium\_plans() |
  | 6 |  | { |
  | 7 |  | ?> |
  | 8 |  | <div class="bg-white mt-4 ms-4 ps-0 mb-4 ps-3 rounded"> |
  | 9 |  | <h2 class="text-center pt-4">Page and Post Restriction</h2> |
  | 10 |  | <h5 class="text-danger text-center">You are currently on the Free version of the plugin</h5> |
  | 11 |  |  |
  | 12 |  | <input type="hidden" value="<?php echo esc\_attr(papr\_is\_customer\_registered()); ?>" id="papr\_customer\_registered"> |
  | 13 |  |  |
  | 14 |  | <div class="me-3"> |
  | 15 |  | <table class="w-100 text-center mt-4 papr-license-plan"> |
  | 16 |  | <tr class="papr-lic-head rounded"> |
  | 17 |  | <th class="h2 p-3">Choose Your Plan</th> |
  | 18 |  | <th class="h2 p-3">Premium</th> |
  | 19 |  | <th class="h2 p-3">Enterprise</th> |
  | 20 |  | </tr> |
  | 21 |  | <tr class="bg-white"> |
  | 22 |  | <td class="p-2"></td> |
  | 23 |  | <td class="p-2 h2 papr-price">$149 <sup>\*</sup></td> |
  | 24 |  | <td class="p-2 h2 papr-price">$249 <sup>\*</sup></td> |
  | 25 |  | </tr> |
  | 26 |  | <tr> |
  | 27 |  | <td class="p-2">Restrict specific Pages/Posts</td> |
  | 28 |  | <td class="p-2"> |
  | 29 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 30 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 31 |  | </svg> |
  | 32 |  | </td> |
  | 33 |  | <td class="p-2"> |
  | 34 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 35 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 36 |  | </svg> |
  | 37 |  | </td> |
  | 38 |  | </tr> |
  | 39 |  | <tr> |
  | 40 |  | <td class="p-2">Restrict Complete Site</td> |
  | 41 |  | <td class="p-2"> |
  | 42 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 43 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 44 |  | </svg> |
  | 45 |  | </td> |
  | 46 |  | <td class="p-2"> |
  | 47 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 48 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 49 |  | </svg> |
  | 50 |  | </td> |
  | 51 |  | </tr> |
  | 52 |  | <tr> |
  | 53 |  | <td class="p-2">Restrict based on User's Login Status</td> |
  | 54 |  | <td class="p-2"> |
  | 55 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 56 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 57 |  | </svg> |
  | 58 |  | </td> |
  | 59 |  | <td class="p-2"> |
  | 60 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 61 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 62 |  | </svg> |
  | 63 |  | </td> |
  | 64 |  | </tr> |
  | 65 |  | <tr> |
  | 66 |  | <td class="p-2">Number of Restricted Pages/Posts</td> |
  | 67 |  | <td class="p-2"> |
  | 68 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 69 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 70 |  | </svg> |
  | 71 |  | </td> |
  | 72 |  | <td class="p-2"> |
  | 73 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 74 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 75 |  | </svg> |
  | 76 |  | </td> |
  | 77 |  | </tr> |
  | 78 |  | <tr> |
  | 79 |  | <td class="p-2">Error Message to Restricted User</td> |
  | 80 |  | <td class="p-2"> |
  | 81 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 82 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 83 |  | </svg> |
  | 84 |  | </td> |
  | 85 |  | <td class="p-2"> |
  | 86 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 87 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 88 |  | </svg> |
  | 89 |  | </td> |
  | 90 |  | </tr> |
  | 91 |  | <tr> |
  | 92 |  | <td class="p-2">Restrict Pages/Posts while Creating (Meta Box)</td> |
  | 93 |  | <td class="p-2"> |
  | 94 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 95 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 96 |  | </svg> |
  | 97 |  | </td> |
  | 98 |  | <td class="p-2"> |
  | 99 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 100 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 101 |  | </svg> |
  | 102 |  | </td> |
  | 103 |  | </tr> |
  | 104 |  | <tr> |
  | 105 |  | <td class="p-2">Restrict Category Page</td> |
  | 106 |  | <td class="p-2"> |
  | 107 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 108 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 109 |  | </svg> |
  | 110 |  | </td> |
  | 111 |  | <td class="p-2"> |
  | 112 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 113 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 114 |  | </svg> |
  | 115 |  | </td> |
  | 116 |  | </tr> |
  | 117 |  | <tr> |
  | 118 |  | <td class="p-2">Restrict posts of a particular Category</td> |
  | 119 |  | <td class="p-2"> |
  | 120 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 121 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 122 |  | </svg> |
  | 123 |  | </td> |
  | 124 |  | <td class="p-2"> |
  | 125 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 126 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 127 |  | </svg> |
  | 128 |  | </td> |
  | 129 |  | </tr> |
  | 130 |  | <tr> |
  | 131 |  | <td class="p-2">Restrict Category based on User Roles</td> |
  | 132 |  | <td class="p-2"> |
  | 133 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 134 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 135 |  | </svg> |
  | 136 |  | </td> |
  | 137 |  | <td class="p-2"> |
  | 138 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 139 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 140 |  | </svg> |
  | 141 |  | </td> |
  | 142 |  | </tr> |
  | 143 |  | <tr> |
  | 144 |  | <td class="p-2">Redirect Restricted User to a URL</td> |
  | 145 |  | <td class="p-2"> |
  | 146 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 147 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 148 |  | </svg> |
  | 149 |  | </td> |
  | 150 |  | <td class="p-2"> |
  | 151 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 152 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 153 |  | </svg> |
  | 154 |  | </td> |
  | 155 |  | </tr> |
  | 156 |  | <tr> |
  | 157 |  | <td class="p-2">Redirect Restricted User to WordPress Login Page</td> |
  | 158 |  | <td class="p-2"> |
  | 159 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 160 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 161 |  | </svg> |
  | 162 |  | </td> |
  | 163 |  | <td class="p-2"> |
  | 164 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 165 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 166 |  | </svg> |
  | 167 |  | </td> |
  | 168 |  | </tr> |
  | 169 |  | <tr> |
  | 170 |  | <td class="p-2">Restrict Entire Custom Post type</td> |
  | 171 |  | <td class="p-2"> |
  | 172 |  | <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-x text-danger" viewBox="0 0 14 14"> |
  | 173 |  | <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  | 174 |  | </svg> |
  | 175 |  | </td> |
  | 176 |  | <td class="p-2"> |
  | 177 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 178 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 179 |  | </svg> |
  | 180 |  | </td> |
  | 181 |  | </tr> |
  | 182 |  | <tr> |
  | 183 |  | <td class="p-2">Integration with SAML/OAuth SSO</td> |
  | 184 |  | <td class="p-2"> |
  | 185 |  | <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-x text-danger" viewBox="0 0 14 14"> |
  | 186 |  | <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  | 187 |  | </svg> |
  | 188 |  | </td> |
  | 189 |  | <td class="p-2"> |
  | 190 |  | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  | 191 |  | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  | 192 |  | </svg> |
  | 193 |  | </td> |
  | 194 |  | </tr> |
  | 195 |  | <tr> |
  | 196 |  | <td class="p-2 pt-3"> <a href="https://www.miniorange.com/contact" class="btn papr-btn-cstm">Contact Us</a> </td> |
  | 197 |  | <td class="p-2 pt-3"> <a onclick="papr\_select\_plan('wp\_page\_restriction\_premium\_plan')" class="btn papr-btn-cstm">Purchase Now</a> </td> |
  | 198 |  | <td class="p-2 pt-3"> <a onclick="papr\_select\_plan('wp\_page\_restriction\_enterprise\_plan')" class="btn papr-btn-cstm">Purchase Now</a> </td> |
  | 199 |  | </tr> |
  | 200 |  |  |
  | 201 |  | </table> |
  | 202 |  | </div> |
  | 203 |  | </div> |
  | 204 |  | <div class="bg-white mt-4 ms-4 ps-0 mb-4 ps-3 rounded"> |
  | 205 |  | <h3 class="text-center pt-4">Customer Policy</h3> |
  | 206 |  | </br> |
  | 207 |  | <div class="ms-3"> |
  | 208 |  | <p><b>Cost applicable for one instance only.</b></p> |
  | 209 |  | </div> |
  | 210 |  | <br> |
  | 211 |  | <div class="ms-3"> |
  | 212 |  | <h6><u>Steps to Upgrade to Paid Plugin</u></h6> |
  | 213 |  | <ol style="font-size:13px;"> |
  | 214 |  | <li> |
  | 215 |  | Click on 'Purchase now' button of the required Licensing Plan. You will be redirected to Account Setup tab of the plugin. |
  | 216 |  | Login or Signup with miniOrange to move forward with the purchase. |
  | 217 |  | </li> |
  | 218 |  | <li> |
  | 219 |  | Once you are logged in, you can click on the 'Purchase Now' button again in the Licensing Plans tab of the plugin. |
  | 220 |  | You will be redirected to miniOrange Login Console, where you need to enter your password for the miniOrange account. |
  | 221 |  | </li> |
  | 222 |  | <li> |
  | 223 |  | You will be then redirected to the payment page. Enter you card details and complete the payment. |
  | 224 |  | On successful payment completion, you will see the link to download the plugin. |
  | 225 |  | </li> |
  | 226 |  | <li> |
  | 227 |  | Now navigate to 'Plugins > Installed Plugins' on the WordPress Dashboard. Click on "Add New" and upload the downloaded paid plugin zip. |
  | 228 |  | </li> |
  | 229 |  | <li> |
  | 230 |  | From this point on, please do not update the paid plugin from the WordPress marketplace. |
  | 231 |  | </li> |
  | 232 |  | </ol> |
  | 233 |  | </div> |
  | 234 |  | <br> |
  | 235 |  | <div class="ms-3"> |
  | 236 |  | <h6><u>10 Days Return Policy</u></h6> |
  | 237 |  | <p>At miniOrange, we want to ensure you are 100% happy with your purchase. If the paid plugin you purchased is not working as |
  | 238 |  | advertised and you've attempted to resolve any issues with our support team which couldn't get resolved, we will refund the whole |
  | 239 |  | amount within 10 days of the purchase. <b>Please email us at samlsupport@xecurify.com for any queries</b> regarding the return policy.</p> |
  | 240 |  | </div> |
  | 241 |  | </br> |
  | 242 |  | </div> |
  | 243 |  | <form style="display:none;" id="paprloginform" action="https://login.xecurify.com/moas/login" target="\_blank" method="post"> |
  | 244 |  | <input type="email" name="username" value="<?php echo esc\_attr(get\_option('papr\_admin\_email')); ?>" /> |
  | 245 |  | <input type="text" name="redirectUrl" value="https://login.xecurify.com/moas/initializepayment" /> |
  | 246 |  | <input type="text" name="requestOrigin" id="requestOrigin" /> |
  | 247 |  | </form> |
  | 248 |  | <a id="paprbacktoaccountsetup" style="display:none;" href="<?php echo esc\_attr(papr\_add\_query\_arg(htmlentities($\_SERVER['REQUEST\_URI']))); ?>"></a> |
  | 249 |  | <script> |
  | 250 |  | function papr\_select\_plan(planType) { |
  | 251 |  | jQuery('#requestOrigin').val(planType); |
  | 252 |  | if (jQuery('#papr\_customer\_registered').val() == 1) { |
  | 253 |  | jQuery('#paprloginform').submit(); |
  | 254 |  | } |
  | 255 |  | else { |
  | 256 |  | location.href = jQuery('#paprbacktoaccountsetup').attr('href'); |
  | 257 |  | } |
  | 258 |  | } |
  | 259 |  | </script> |
  | 260 |  | <?php |
  |  | 5 | function papr\_show\_premium\_plans() {    ?> |
  |  | 6 | <div class="bg-white mt-4 ms-4 ps-0 mb-4 ps-3 rounded"> |
  |  | 7 | <h2 class="text-center pt-4">Page and Post Restriction</h2> |
  |  | 8 | <h5 class="text-danger text-center">You are currently on the Free version of the plugin</h5> |
  |  | 9 |  |
  |  | 10 | <input type="hidden" value="<?php echo esc\_attr( papr\_is\_customer\_registered() ); ?>" id="papr\_customer\_registered"> |
  |  | 11 |  |
  |  | 12 | <div class="me-3"> |
  |  | 13 | <table class="w-100 text-center mt-4 papr-license-plan"> |
  |  | 14 | <tr class="papr-lic-head rounded"> |
  |  | 15 | <th class="h2 p-3">Choose Your Plan</th> |
  |  | 16 | <th class="h2 p-3">Premium</th> |
  |  | 17 | <th class="h2 p-3">Enterprise</th> |
  |  | 18 | </tr> |
  |  | 19 | <tr class="bg-white"> |
  |  | 20 | <td class="p-2"></td> |
  |  | 21 | <td class="p-2 h2 papr-price">$149 <sup>\*</sup></td> |
  |  | 22 | <td class="p-2 h2 papr-price">$249 <sup>\*</sup></td> |
  |  | 23 | </tr> |
  |  | 24 | <tr> |
  |  | 25 | <td class="p-2">Restrict specific Pages/Posts</td> |
  |  | 26 | <td class="p-2"> |
  |  | 27 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 28 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 29 | </svg> |
  |  | 30 | </td> |
  |  | 31 | <td class="p-2"> |
  |  | 32 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 33 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 34 | </svg> |
  |  | 35 | </td> |
  |  | 36 | </tr> |
  |  | 37 | <tr> |
  |  | 38 | <td class="p-2">Restrict Complete Site</td> |
  |  | 39 | <td class="p-2"> |
  |  | 40 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 41 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 42 | </svg> |
  |  | 43 | </td> |
  |  | 44 | <td class="p-2"> |
  |  | 45 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 46 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 47 | </svg> |
  |  | 48 | </td> |
  |  | 49 | </tr> |
  |  | 50 | <tr> |
  |  | 51 | <td class="p-2">Restrict based on User's Login Status</td> |
  |  | 52 | <td class="p-2"> |
  |  | 53 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 54 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 55 | </svg> |
  |  | 56 | </td> |
  |  | 57 | <td class="p-2"> |
  |  | 58 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 59 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 60 | </svg> |
  |  | 61 | </td> |
  |  | 62 | </tr> |
  |  | 63 | <tr> |
  |  | 64 | <td class="p-2">Number of Restricted Pages/Posts</td> |
  |  | 65 | <td class="p-2"> |
  |  | 66 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 67 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 68 | </svg> |
  |  | 69 | </td> |
  |  | 70 | <td class="p-2"> |
  |  | 71 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 72 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 73 | </svg> |
  |  | 74 | </td> |
  |  | 75 | </tr> |
  |  | 76 | <tr> |
  |  | 77 | <td class="p-2">Error Message to Restricted User</td> |
  |  | 78 | <td class="p-2"> |
  |  | 79 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 80 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 81 | </svg> |
  |  | 82 | </td> |
  |  | 83 | <td class="p-2"> |
  |  | 84 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 85 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 86 | </svg> |
  |  | 87 | </td> |
  |  | 88 | </tr> |
  |  | 89 | <tr> |
  |  | 90 | <td class="p-2">Restrict Pages/Posts while Creating (Meta Box)</td> |
  |  | 91 | <td class="p-2"> |
  |  | 92 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 93 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 94 | </svg> |
  |  | 95 | </td> |
  |  | 96 | <td class="p-2"> |
  |  | 97 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 98 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 99 | </svg> |
  |  | 100 | </td> |
  |  | 101 | </tr> |
  |  | 102 | <tr> |
  |  | 103 | <td class="p-2">Restrict Category Page</td> |
  |  | 104 | <td class="p-2"> |
  |  | 105 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 106 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 107 | </svg> |
  |  | 108 | </td> |
  |  | 109 | <td class="p-2"> |
  |  | 110 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 111 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 112 | </svg> |
  |  | 113 | </td> |
  |  | 114 | </tr> |
  |  | 115 | <tr> |
  |  | 116 | <td class="p-2">Restrict posts of a particular Category</td> |
  |  | 117 | <td class="p-2"> |
  |  | 118 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 119 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 120 | </svg> |
  |  | 121 | </td> |
  |  | 122 | <td class="p-2"> |
  |  | 123 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 124 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 125 | </svg> |
  |  | 126 | </td> |
  |  | 127 | </tr> |
  |  | 128 | <tr> |
  |  | 129 | <td class="p-2">Restrict Category based on User Roles</td> |
  |  | 130 | <td class="p-2"> |
  |  | 131 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 132 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 133 | </svg> |
  |  | 134 | </td> |
  |  | 135 | <td class="p-2"> |
  |  | 136 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 137 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 138 | </svg> |
  |  | 139 | </td> |
  |  | 140 | </tr> |
  |  | 141 | <tr> |
  |  | 142 | <td class="p-2">Redirect Restricted User to a URL</td> |
  |  | 143 | <td class="p-2"> |
  |  | 144 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 145 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 146 | </svg> |
  |  | 147 | </td> |
  |  | 148 | <td class="p-2"> |
  |  | 149 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 150 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 151 | </svg> |
  |  | 152 | </td> |
  |  | 153 | </tr> |
  |  | 154 | <tr> |
  |  | 155 | <td class="p-2">Redirect Restricted User to WordPress Login Page</td> |
  |  | 156 | <td class="p-2"> |
  |  | 157 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 158 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 159 | </svg> |
  |  | 160 | </td> |
  |  | 161 | <td class="p-2"> |
  |  | 162 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 163 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 164 | </svg> |
  |  | 165 | </td> |
  |  | 166 | </tr> |
  |  | 167 | <tr> |
  |  | 168 | <td class="p-2">Restrict Entire Custom Post type</td> |
  |  | 169 | <td class="p-2"> |
  |  | 170 | <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-x text-danger" viewBox="0 0 14 14"> |
  |  | 171 | <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  |  | 172 | </svg> |
  |  | 173 | </td> |
  |  | 174 | <td class="p-2"> |
  |  | 175 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 176 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 177 | </svg> |
  |  | 178 | </td> |
  |  | 179 | </tr> |
  |  | 180 | <tr> |
  |  | 181 | <td class="p-2">Integration with SAML/OAuth SSO</td> |
  |  | 182 | <td class="p-2"> |
  |  | 183 | <svg xmlns="http://www.w3.org/2000/svg" width="32" height="32" fill="currentColor" class="bi bi-x text-danger" viewBox="0 0 14 14"> |
  |  | 184 | <path d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  |  | 185 | </svg> |
  |  | 186 | </td> |
  |  | 187 | <td class="p-2"> |
  |  | 188 | <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" fill="currentColor" class="align-middle text-success" viewBox="0 0 14 14"> |
  |  | 189 | <path d="M13.854 3.646a.5.5 0 0 1 0 .708l-7 7a.5.5 0 0 1-.708 0l-3.5-3.5a.5.5 0 1 1 .708-.708L6.5 10.293l6.646-6.647a.5.5 0 0 1 .708 0z" /> |
  |  | 190 | </svg> |
  |  | 191 | </td> |
  |  | 192 | </tr> |
  |  | 193 | <tr> |
  |  | 194 | <td class="p-2 pt-3"> <a href="https://www.miniorange.com/contact" class="btn papr-btn-cstm">Contact Us</a> </td> |
  |  | 195 | <td class="p-2 pt-3"> <a onclick="papr\_select\_plan('wp\_page\_restriction\_premium\_plan')" class="btn papr-btn-cstm">Purchase Now</a> </td> |
  |  | 196 | <td class="p-2 pt-3"> <a onclick="papr\_select\_plan('wp\_page\_restriction\_enterprise\_plan')" class="btn papr-btn-cstm">Purchase Now</a> </td> |
  |  | 197 | </tr> |
  |  | 198 |  |
  |  | 199 | </table> |
  |  | 200 | </div> |
  |  | 201 | </div> |
  |  | 202 | <div class="bg-white mt-4 ms-4 ps-0 mb-4 ps-3 rounded"> |
  |  | 203 | <h3 class="text-center pt-4">Customer Policy</h3> |
  |  | 204 | </br> |
  |  | 205 | <div class="ms-3"> |
  |  | 206 | <p><b>Cost applicable for one instance only.</b></p> |
  |  | 207 | </div> |
  |  | 208 | <br> |
  |  | 209 | <div class="ms-3"> |
  |  | 210 | <h6><u>Steps to Upgrade to Paid Plugin</u></h6> |
  |  | 211 | <ol style="font-size:13px;"> |
  |  | 212 | <li> |
  |  | 213 | Click on 'Purchase now' button of the required Licensing Plan. You will be redirected to Account Setup tab of the plugin. |
  |  | 214 | Login or Signup with miniOrange to move forward with the purchase. |
  |  | 215 | </li> |
  |  | 216 | <li> |
  |  | 217 | Once you are logged in, you can click on the 'Purchase Now' button again in the Licensing Plans tab of the plugin. |
  |  | 218 | You will be redirected to miniOrange Login Console, where you need to enter your password for the miniOrange account. |
  |  | 219 | </li> |
  |  | 220 | <li> |
  |  | 221 | You will be then redirected to the payment page. Enter you card details and complete the payment. |
  |  | 222 | On successful payment completion, you will see the link to download the plugin. |
  |  | 223 | </li> |
  |  | 224 | <li> |
  |  | 225 | Now navigate to 'Plugins > Installed Plugins' on the WordPress Dashboard. Click on "Add New" and upload the downloaded paid plugin zip. |
  |  | 226 | </li> |
  |  | 227 | <li> |
  |  | 228 | From this point on, please do not update the paid plugin from the WordPress marketplace. |
  |  | 229 | </li> |
  |  | 230 | </ol> |
  |  | 231 | </div> |
  |  | 232 | <br> |
  |  | 233 | <div class="ms-3"> |
  |  | 234 | <h6><u>10 Days Return Policy</u></h6> |
  |  | 235 | <p>At miniOrange, we want to ensure you are 100% happy with your purchase. If the paid plugin you purchased is not working as |
  |  | 236 | advertised and you've attempted to resolve any issues with our support team which couldn't get resolved, we will refund the whole |
  |  | 237 | amount within 10 days of the purchase. <b>Please email us at samlsupport@xecurify.com for any queries</b> regarding the return policy.</p> |
  |  | 238 | </div> |
  |  | 239 | </br> |
  |  | 240 | </div> |
  |  | 241 | <form style="display:none;" id="paprloginform" action="https://login.xecurify.com/moas/login" target="\_blank" method="post"> |
  |  | 242 | <input type="email" name="username" value="<?php echo esc\_attr( get\_option( 'papr\_admin\_email' ) ); ?>" /> |
  |  | 243 | <input type="text" name="redirectUrl" value="https://login.xecurify.com/moas/initializepayment" /> |
  |  | 244 | <input type="text" name="requestOrigin" id="requestOrigin" /> |
  |  | 245 | </form> |
  |  | 246 | <a id="paprbacktoaccountsetup" style="display:none;" href="<?php echo esc\_attr( papr\_add\_query\_arg( htmlentities( $\_SERVER['REQUEST\_URI'] ) ) ); ?>"></a> |
  |  | 247 | <script> |
  |  | 248 | function papr\_select\_plan(planType) { |
  |  | 249 | jQuery('#requestOrigin').val(planType); |
  |  | 250 | if (jQuery('#papr\_customer\_registered').val() == 1) { |
  |  | 251 | jQuery('#paprloginform').submit(); |
  |  | 252 | } |
  |  | 253 | else { |
  |  | 254 | location.href = jQuery('#paprbacktoaccountsetup').attr('href'); |
  |  | 255 | } |
  |  | 256 | } |
  |  | 257 | </script> |
  |  | 258 | <?php |
  | 261 | 259 | } |
  | 262 | 260 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-save.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-save.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-save.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-save.php?rev=2829798#L1 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-save.php?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 |  | require( 'page-restriction-class-customer.php' ); |
  | 3 |  | require\_once('page-and-post-restriction.php'); |
  | 4 |  | include\_once 'page-restriction-utility.php'; |
  | 5 |  |  |
  | 6 |  | function papr\_save\_setting(){ |
  | 7 |  |  |
  | 8 |  | if( papr\_check\_option\_admin\_referer("papr\_custom\_create\_roles") ){ |
  | 9 |  | unset($\_POST['\_wpnonce']); |
  | 10 |  | unset($\_POST['\_wp\_http\_referer']); |
  | 11 |  | unset($\_POST['option']); |
  | 12 |  | $custom\_role\_name = stripslashes(sanitize\_text\_field($\_POST['custom\_role\_name'])); |
  | 13 |  | $custom\_role\_display\_name = $custom\_role\_name; |
  | 14 |  | $custom\_role\_name = strtolower(str\_replace(" ","\_",$custom\_role\_name)); |
  | 15 |  | unset($\_POST['custom\_role\_name']); |
  | 16 |  |  |
  | 17 |  | global $wp\_roles; |
  | 18 |  | $roles = $wp\_roles->roles; |
  | 19 |  |  |
  | 20 |  | if(!empty($roles[$custom\_role\_name])){ |
  | 21 |  | update\_option( 'papr\_message', 'Role you trying to create already exist. Please Navigate to Edit Role tab to Edit it.'); |
  | 22 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 23 |  | return; |
  | 24 |  | } |
  | 25 |  |  |
  | 26 |  | $role\_capability = array(); |
  | 27 |  | foreach($\_POST as $key=>$value){ |
  | 28 |  | $role\_capability[$key] = 1; |
  | 29 |  | } |
  | 30 |  |  |
  | 31 |  | add\_role( $custom\_role\_name, $custom\_role\_display\_name, $role\_capability ); |
  | 32 |  |  |
  | 33 |  | update\_option( 'papr\_message', 'New Role '.$custom\_role\_name.' Added Successfully'); |
  | 34 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 35 |  | wp\_redirect( admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu')); |
  | 36 |  | return; |
  | 37 |  | } |
  | 38 |  |  |
  | 39 |  | if( papr\_check\_option\_admin\_referer("papr\_custom\_edit\_roles") ){ |
  | 40 |  | unset($\_POST['\_wpnonce']); |
  | 41 |  | unset($\_POST['\_wp\_http\_referer']); |
  | 42 |  | unset($\_POST['option']); |
  | 43 |  | $custom\_role\_name = stripslashes(sanitize\_text\_field($\_POST['custom\_role\_name'])); |
  | 44 |  | $custom\_role\_display\_name = $custom\_role\_name; |
  | 45 |  | $custom\_role\_name = strtolower(str\_replace(" ","\_",$custom\_role\_name)); |
  | 46 |  | unset($\_POST['custom\_role\_name']); |
  | 47 |  |  |
  | 48 |  | $role\_capability = array(); |
  | 49 |  | foreach($\_POST as $key=>$value){ |
  | 50 |  | $role\_capability[$key] = 1; |
  | 51 |  | } |
  | 52 |  |  |
  | 53 |  | global $wp\_roles; |
  | 54 |  | $roles = $wp\_roles->roles; |
  | 55 |  |  |
  | 56 |  | if(!empty($roles[$custom\_role\_name])){ |
  | 57 |  | remove\_role( $custom\_role\_name ); |
  | 58 |  | } |
  | 59 |  |  |
  | 60 |  | if(isset($custom\_role\_name) && $custom\_role\_name!=''){ |
  | 61 |  | add\_role( $custom\_role\_name, $custom\_role\_display\_name, $role\_capability ); |
  | 62 |  | } else{ |
  | 63 |  | return; |
  | 64 |  | } |
  | 65 |  |  |
  | 66 |  | update\_option( 'papr\_message', $custom\_role\_name.' Role Edited Successfully'); |
  | 67 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 68 |  | wp\_redirect( admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu')); |
  | 69 |  | return; |
  | 70 |  | } |
  | 71 |  |  |
  | 72 |  | if( papr\_check\_option\_admin\_referer("papr\_delete\_custom\_roles") ){ |
  | 73 |  | $role\_delete = sanitize\_text\_field($\_POST['role\_delete']); |
  | 74 |  | remove\_role( $role\_delete ); |
  | 75 |  | update\_option( 'papr\_message', $role\_delete.' Role Deleted Successfully'); |
  | 76 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 77 |  | return; |
  | 78 |  | } |
  | 79 |  |  |
  | 80 |  | if( papr\_check\_option\_admin\_referer("roles\_per\_page") ){ |
  | 81 |  | $roles\_per\_page = sanitize\_text\_field($\_POST['roles\_per\_page']); |
  | 82 |  | update\_option('papr\_roles\_per\_page',$roles\_per\_page); |
  | 83 |  | return; |
  | 84 |  | } |
  | 85 |  |  |
  | 86 |  | if( papr\_check\_option\_admin\_referer("papr\_restrict\_pages\_roles\_login") ){ |
  | 87 |  | unset($\_POST['\_wpnonce']); |
  | 88 |  | unset($\_POST['\_wp\_http\_referer']); |
  | 89 |  | unset($\_POST['option']); |
  | 90 |  |  |
  | 91 |  | $allowed\_roles          = get\_option('papr\_allowed\_roles\_for\_pages'); |
  | 92 |  | $restrictedpages        = get\_option('papr\_restricted\_pages'); |
  | 93 |  | $allowed\_redirect\_pages = get\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 94 |  | $default\_role\_parent    = get\_option('papr\_default\_role\_parent'); |
  | 95 |  | $default\_role\_toggle    = get\_option('papr\_default\_role\_parent\_page\_toggle'); |
  | 96 |  | $default\_login\_toggle   = get\_option('papr\_access\_for\_only\_loggedin'); |
  | 97 |  | $unrestricted\_pages     = get\_option('papr\_login\_unrestricted\_pages'); |
  | 98 |  |  |
  | 99 |  | $allowed\_roles          = $allowed\_roles!='' ? $allowed\_roles : array(); |
  | 100 |  | $restrictedpages        = $restrictedpages!='' ? $restrictedpages : array(); |
  | 101 |  | $allowed\_redirect\_pages = $allowed\_redirect\_pages!='' ? $allowed\_redirect\_pages : array(); |
  | 102 |  | $default\_role\_parent    = $default\_role\_parent!='' ? $default\_role\_parent : array(); |
  | 103 |  | $default\_role\_toggle    = $default\_role\_toggle!='' ? $default\_role\_toggle : ""; |
  | 104 |  | $default\_login\_toggle   = $default\_login\_toggle!='' ? $default\_login\_toggle : ""; |
  | 105 |  | $unrestricted\_pages     = $unrestricted\_pages ? $unrestricted\_pages : array(); |
  | 106 |  |  |
  | 107 |  | $pages=array(); |
  | 108 |  | foreach($\_POST as $key=>$value) { |
  | 109 |  | $pageid = (int) filter\_var($key,FILTER\_SANITIZE\_NUMBER\_INT); |
  | 110 |  | if(!papr\_in\_array($pageid,$pages)){ |
  | 111 |  | array\_push($pages,$pageid); |
  | 112 |  | } |
  | 113 |  | } |
  | 114 |  |  |
  | 115 |  | for($i=0;$i<sizeof($pages);$i++){ |
  | 116 |  | $pageid = $pages[$i]; |
  | 117 |  | if($pageid==0 ){ |
  | 118 |  | unset($allowed\_roles['mo\_page\_0']); |
  | 119 |  | } |
  | 120 |  | else{ |
  | 121 |  | unset($allowed\_roles[$pageid]); |
  | 122 |  | } |
  | 123 |  | } |
  | 124 |  |  |
  | 125 |  | for($i=0;$i<sizeof($pages);$i++) { |
  | 126 |  |  |
  | 127 |  | $pageid = $pages[$i]; |
  | 128 |  |  |
  | 129 |  | $roles = 'mo\_page\_roles\_' . $pageid; |
  | 130 |  | $login = 'mo\_page\_login\_' . $pageid; |
  | 131 |  | $default = 'mo\_page\_default\_role\_'.$pageid; |
  | 132 |  |  |
  | 133 |  | if(array\_key\_exists($roles, $\_POST)) { |
  | 134 |  | if($pageid==0){ |
  | 135 |  | $selected\_roles\_array = array(); |
  | 136 |  | foreach($\_POST[$roles] as $key=>$value){ |
  | 137 |  | array\_push($selected\_roles\_array,sanitize\_text\_field($value)); |
  |  | 2 | require 'page-restriction-class-customer.php'; |
  |  | 3 | require\_once 'page-and-post-restriction.php'; |
  |  | 4 | require\_once 'page-restriction-utility.php'; |
  |  | 5 |  |
  |  | 6 | function papr\_save\_setting() { |
  |  | 7 |  |
  |  | 8 | if ( papr\_check\_option\_admin\_referer( 'papr\_custom\_create\_roles' ) ) { |
  |  | 9 | unset( $\_POST['\_wpnonce'] ); |
  |  | 10 | unset( $\_POST['\_wp\_http\_referer'] ); |
  |  | 11 | unset( $\_POST['option'] ); |
  |  | 12 | $custom\_role\_name         = stripslashes( sanitize\_text\_field( $\_POST['custom\_role\_name'] ) ); |
  |  | 13 | $custom\_role\_display\_name = $custom\_role\_name; |
  |  | 14 | $custom\_role\_name         = strtolower( str\_replace( ' ', '\_', $custom\_role\_name ) ); |
  |  | 15 | unset( $\_POST['custom\_role\_name'] ); |
  |  | 16 |  |
  |  | 17 | global $wp\_roles; |
  |  | 18 | $roles = $wp\_roles->roles; |
  |  | 19 |  |
  |  | 20 | if ( ! empty( $roles[ $custom\_role\_name ] ) ) { |
  |  | 21 | update\_option( 'papr\_message', 'Role you trying to create already exist. Please Navigate to Edit Role tab to Edit it.' ); |
  |  | 22 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 23 | return; |
  |  | 24 | } |
  |  | 25 |  |
  |  | 26 | $role\_capability = array(); |
  |  | 27 | foreach ( $\_POST as $key => $value ) { |
  |  | 28 | $role\_capability[ $key ] = 1; |
  |  | 29 | } |
  |  | 30 |  |
  |  | 31 | add\_role( $custom\_role\_name, $custom\_role\_display\_name, $role\_capability ); |
  |  | 32 |  |
  |  | 33 | update\_option( 'papr\_message', 'New Role ' . $custom\_role\_name . ' Added Successfully' ); |
  |  | 34 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 35 | wp\_redirect( admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu' ) ); |
  |  | 36 | return; |
  |  | 37 | } |
  |  | 38 |  |
  |  | 39 | if ( papr\_check\_option\_admin\_referer( 'papr\_custom\_edit\_roles' ) ) { |
  |  | 40 | unset( $\_POST['\_wpnonce'] ); |
  |  | 41 | unset( $\_POST['\_wp\_http\_referer'] ); |
  |  | 42 | unset( $\_POST['option'] ); |
  |  | 43 | $custom\_role\_name         = stripslashes( sanitize\_text\_field( $\_POST['custom\_role\_name'] ) ); |
  |  | 44 | $custom\_role\_display\_name = $custom\_role\_name; |
  |  | 45 | $custom\_role\_name         = strtolower( str\_replace( ' ', '\_', $custom\_role\_name ) ); |
  |  | 46 | unset( $\_POST['custom\_role\_name'] ); |
  |  | 47 |  |
  |  | 48 | $role\_capability = array(); |
  |  | 49 | foreach ( $\_POST as $key => $value ) { |
  |  | 50 | $role\_capability[ $key ] = 1; |
  |  | 51 | } |
  |  | 52 |  |
  |  | 53 | global $wp\_roles; |
  |  | 54 | $roles = $wp\_roles->roles; |
  |  | 55 |  |
  |  | 56 | if ( ! empty( $roles[ $custom\_role\_name ] ) ) { |
  |  | 57 | remove\_role( $custom\_role\_name ); |
  |  | 58 | } |
  |  | 59 |  |
  |  | 60 | if ( isset( $custom\_role\_name ) && $custom\_role\_name != '' ) { |
  |  | 61 | add\_role( $custom\_role\_name, $custom\_role\_display\_name, $role\_capability ); |
  |  | 62 | } else { |
  |  | 63 | return; |
  |  | 64 | } |
  |  | 65 |  |
  |  | 66 | update\_option( 'papr\_message', $custom\_role\_name . ' Role Edited Successfully' ); |
  |  | 67 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 68 | wp\_redirect( admin\_url( '/admin.php?page=papr\_custom\_roles\_sub\_menu' ) ); |
  |  | 69 | return; |
  |  | 70 | } |
  |  | 71 |  |
  |  | 72 | if ( papr\_check\_option\_admin\_referer( 'papr\_delete\_custom\_roles' ) ) { |
  |  | 73 | $role\_delete = sanitize\_text\_field( $\_POST['role\_delete'] ); |
  |  | 74 | remove\_role( $role\_delete ); |
  |  | 75 | update\_option( 'papr\_message', $role\_delete . ' Role Deleted Successfully' ); |
  |  | 76 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 77 | return; |
  |  | 78 | } |
  |  | 79 |  |
  |  | 80 | if ( papr\_check\_option\_admin\_referer( 'roles\_per\_page' ) ) { |
  |  | 81 | $roles\_per\_page = sanitize\_text\_field( $\_POST['roles\_per\_page'] ); |
  |  | 82 | update\_option( 'papr\_roles\_per\_page', $roles\_per\_page ); |
  |  | 83 | return; |
  |  | 84 | } |
  |  | 85 |  |
  |  | 86 | if ( papr\_check\_option\_admin\_referer( 'papr\_restrict\_pages\_roles\_login' ) ) { |
  |  | 87 | unset( $\_POST['\_wpnonce'] ); |
  |  | 88 | unset( $\_POST['\_wp\_http\_referer'] ); |
  |  | 89 | unset( $\_POST['option'] ); |
  |  | 90 |  |
  |  | 91 | $allowed\_roles          = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 92 | $restrictedpages        = get\_option( 'papr\_restricted\_pages' ); |
  |  | 93 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 94 | $default\_role\_parent    = get\_option( 'papr\_default\_role\_parent' ); |
  |  | 95 | $default\_role\_toggle    = get\_option( 'papr\_default\_role\_parent\_page\_toggle' ); |
  |  | 96 | $default\_login\_toggle   = get\_option( 'papr\_access\_for\_only\_loggedin' ); |
  |  | 97 | $unrestricted\_pages     = get\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 98 |  |
  |  | 99 | $allowed\_roles          = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 100 | $restrictedpages        = $restrictedpages != '' ? $restrictedpages : array(); |
  |  | 101 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 102 | $default\_role\_parent    = $default\_role\_parent != '' ? $default\_role\_parent : array(); |
  |  | 103 | $default\_role\_toggle    = $default\_role\_toggle != '' ? $default\_role\_toggle : ''; |
  |  | 104 | $default\_login\_toggle   = $default\_login\_toggle != '' ? $default\_login\_toggle : ''; |
  |  | 105 | $unrestricted\_pages     = $unrestricted\_pages ? $unrestricted\_pages : array(); |
  |  | 106 |  |
  |  | 107 | $pages = array(); |
  |  | 108 | foreach ( $\_POST as $key => $value ) { |
  |  | 109 | $pageid = (int) filter\_var( $key, FILTER\_SANITIZE\_NUMBER\_INT ); |
  |  | 110 | if ( ! papr\_in\_array( $pageid, $pages ) ) { |
  |  | 111 | array\_push( $pages, $pageid ); |
  |  | 112 | } |
  |  | 113 | } |
  |  | 114 |  |
  |  | 115 | for ( $i = 0;$i < sizeof( $pages );$i++ ) { |
  |  | 116 | $pageid = $pages[ $i ]; |
  |  | 117 | if ( $pageid == 0 ) { |
  |  | 118 | unset( $allowed\_roles['mo\_page\_0'] ); |
  |  | 119 | } else { |
  |  | 120 | unset( $allowed\_roles[ $pageid ] ); |
  |  | 121 | } |
  |  | 122 | } |
  |  | 123 |  |
  |  | 124 | for ( $i = 0;$i < sizeof( $pages );$i++ ) { |
  |  | 125 |  |
  |  | 126 | $pageid = $pages[ $i ]; |
  |  | 127 |  |
  |  | 128 | $roles   = 'mo\_page\_roles\_' . $pageid; |
  |  | 129 | $login   = 'mo\_page\_login\_' . $pageid; |
  |  | 130 | $default = 'mo\_page\_default\_role\_' . $pageid; |
  |  | 131 |  |
  |  | 132 | if ( array\_key\_exists( $roles, $\_POST ) ) { |
  |  | 133 | if ( $pageid == 0 ) { |
  |  | 134 | $selected\_roles\_array = array(); |
  |  | 135 | foreach ( $\_POST[ $roles ] as $key => $value ) { |
  |  | 136 | array\_push( $selected\_roles\_array, sanitize\_text\_field( $value ) ); |
  | 138 | 137 | } |
  | 139 |  | ~~$allowed\_roles['mo\_page\_0']=~~$selected\_roles\_array; |
  | 140 |  | } else { |
  | 141 |  | $selected\_roles\_array = array(); |
  | 142 |  | foreach~~($\_POST[$roles] as $key=>$value)~~{ |
  | 143 |  | array\_push(~~$selected\_roles\_array,sanitize\_text\_field($value)~~); |
  |  | 138 | $allowed\_roles['mo\_page\_0'] = $selected\_roles\_array; |
  |  | 139 | } else { |
  |  | 140 | $selected\_roles\_array = array(); |
  |  | 141 | foreach ( $\_POST[ $roles ] as $key => $value ) { |
  |  | 142 | array\_push( $selected\_roles\_array, sanitize\_text\_field( $value ) ); |
  | 144 | 143 | } |
  | 145 |  | $allowed\_roles[$pageid]=$selected\_roles\_array; |
  | 146 |  | } |
  | 147 |  | } |
  | 148 |  |  |
  | 149 |  | if(array\_key\_exists($roles, $\_POST)) { |
  | 150 |  | if($\_POST[$roles] != ''){ |
  | 151 |  | if(!papr\_in\_array($pageid,$restrictedpages)){ |
  | 152 |  | array\_push($restrictedpages, $pageid); |
  | 153 |  | } |
  | 154 |  | $\_POST[$login]='on'; //Make page private click even if user dis-selected it should get selected after save configuration |
  | 155 |  |  |
  | 156 |  | } else { |
  | 157 |  | unset($restrictedpages[$pageid]); |
  | 158 |  | } |
  | 159 |  | } |
  | 160 |  |  |
  | 161 |  | if(array\_key\_exists($login, $\_POST)) { |
  | 162 |  | if($\_POST[$login]==1 || $\_POST[$login]=='on' || $\_POST[$login]=='true'){ |
  | 163 |  | $allowed\_redirect\_pages[$pageid]=true; |
  | 164 |  | unset($unrestricted\_pages[$pageid]); |
  | 165 |  | } |
  | 166 |  | } |
  | 167 |  | else if ( $default\_login\_toggle==1 && !array\_key\_exists($login, $\_POST) ) { |
  | 168 |  | unset($allowed\_redirect\_pages[$pageid]); |
  | 169 |  | $unrestricted\_pages[$pageid] = true; |
  | 170 |  | } |
  | 171 |  | else { |
  | 172 |  | unset($allowed\_redirect\_pages[$pageid]); |
  | 173 |  | $unrestricted\_pages[$pageid] = true; |
  | 174 |  | } |
  | 175 |  |  |
  | 176 |  | if(array\_key\_exists($default, $\_POST)) { |
  | 177 |  | if($\_POST[$default]==1 || $\_POST[$default]=='on' || $\_POST[$default]=='true'){ |
  | 178 |  | $default\_role\_parent[$pageid]=true; |
  | 179 |  | } |
  | 180 |  | } else{ |
  | 181 |  | unset($default\_role\_parent[$pageid]); |
  | 182 |  | } |
  | 183 |  |  |
  | 184 |  | if(!empty($default\_role\_parent[$pageid]) || $default\_role\_toggle==1) { |
  | 185 |  | if($pageid != 0){ |
  | 186 |  | $default\_role\_parent[$pageid]=true; |
  | 187 |  |  |
  | 188 |  | $children = get\_pages( array( 'child\_of' => $pageid ) ); |
  | 189 |  |  |
  | 190 |  | if(count($children)>0) { |
  | 191 |  |  |
  | 192 |  | foreach($children as $child) { |
  | 193 |  | $child\_id = $child->ID; |
  | 194 |  | $login\_child = 'mo\_page\_login\_' . $child->ID; |
  | 195 |  | $roles\_child = 'mo\_page\_roles\_' . $child->ID; |
  | 196 |  | $default\_child = 'mo\_page\_default\_role\_'.$child->ID; |
  | 197 |  |  |
  | 198 |  | unset($\_POST[$roles\_child]); |
  | 199 |  |  |
  | 200 |  | if(array\_key\_exists($login,$\_POST)){ |
  | 201 |  | $\_POST[$login\_child] = sanitize\_text\_field($\_POST[$login]); |
  | 202 |  | } else { |
  | 203 |  | unset($\_POST[$login\_child]); |
  | 204 |  | } |
  | 205 |  |  |
  | 206 |  | if(!empty($allowed\_roles[$pageid])) |
  | 207 |  | $allowed\_roles[$child->ID] = $allowed\_roles[$pageid]; |
  | 208 |  |  |
  | 209 |  | if(!empty($allowed\_roles[$child->ID]) && $allowed\_roles[$child->ID] != ''){ |
  | 210 |  | if(!papr\_in\_array($child->ID,$restrictedpages)){ |
  | 211 |  | array\_push($restrictedpages, $child->ID); |
  | 212 |  | } |
  | 213 |  | } else { |
  | 214 |  | unset($restrictedpages[$child->ID]); |
  | 215 |  | } |
  | 216 |  |  |
  | 217 |  | if(!empty($allowed\_redirect\_pages[$pageid])) { |
  | 218 |  | if($allowed\_redirect\_pages[$pageid]==1 || $allowed\_redirect\_pages[$pageid]=='on' || $allowed\_redirect\_pages[$pageid]=='true'){ |
  | 219 |  | $allowed\_redirect\_pages[$child->ID]=true; |
  | 220 |  | unset($unrestricted\_pages[$child->ID]); |
  | 221 |  | } |
  | 222 |  | } |
  | 223 |  | else { |
  | 224 |  | unset($allowed\_redirect\_pages[$child->ID]); |
  | 225 |  | $unrestricted\_pages[$child->ID] = true; |
  | 226 |  | } |
  | 227 |  |  |
  | 228 |  | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  | 229 |  |  |
  | 230 |  | if(count($children\_of\_children)>0){ |
  | 231 |  | $default\_role\_parent[$child->ID]=true; |
  | 232 |  | $\_POST[$default\_child] = 'on'; |
  | 233 |  | } |
  | 234 |  | } |
  | 235 |  | } |
  | 236 |  | } |
  | 237 |  | } |
  | 238 |  | } |
  | 239 |  |  |
  | 240 |  | update\_option('papr\_allowed\_roles\_for\_pages', $allowed\_roles); |
  | 241 |  | update\_option('papr\_restricted\_pages', $restrictedpages); |
  | 242 |  | update\_option('papr\_allowed\_redirect\_for\_pages',$allowed\_redirect\_pages); |
  | 243 |  | update\_option('papr\_login\_unrestricted\_pages',$unrestricted\_pages); |
  | 244 |  | update\_option( 'papr\_default\_role\_parent', $default\_role\_parent); |
  | 245 |  |  |
  | 246 |  | update\_option( 'papr\_message', 'Selected pages have been restricted successfully.'); |
  | 247 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 248 |  | return; |
  | 249 |  | } |
  | 250 |  |  |
  | 251 |  | if( papr\_check\_option\_admin\_referer("papr\_restrict\_post\_roles\_login") ){ |
  | 252 |  |  |
  | 253 |  | $allowed\_roles                 = get\_option('papr\_allowed\_roles\_for\_posts'); |
  | 254 |  | $restrictedpost                = get\_option('papr\_restricted\_posts'); |
  | 255 |  | $allowed\_redirect\_post         = get\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 256 |  | $access\_for\_only\_loggedin\_post = get\_option('papr\_access\_for\_only\_loggedin\_posts'); |
  | 257 |  | $unrestricted\_posts            = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  | 258 |  |  |
  | 259 |  | $allowed\_roles                 = $allowed\_roles!='' ? $allowed\_roles : array(); |
  | 260 |  | $restrictedpost                = $restrictedpost!='' ? $restrictedpost : array(); |
  | 261 |  | $allowed\_redirect\_post         = $allowed\_redirect\_post!='' ? $allowed\_redirect\_post : array(); |
  | 262 |  | $access\_for\_only\_loggedin\_post = $access\_for\_only\_loggedin\_post!='' ? $access\_for\_only\_loggedin\_post : ""; |
  | 263 |  | $unrestricted\_posts            = $unrestricted\_posts ? $unrestricted\_posts : array(); |
  | 264 |  |  |
  | 265 |  | unset($\_POST['\_wpnonce']); |
  | 266 |  | unset($\_POST['\_wp\_http\_referer']); |
  | 267 |  | unset($\_POST['option']); |
  | 268 |  |  |
  | 269 |  | $post=array(); |
  | 270 |  | foreach($\_POST as $key=>$value) |
  | 271 |  | { |
  | 272 |  | $postid = (int) filter\_var($key,FILTER\_SANITIZE\_NUMBER\_INT); |
  | 273 |  | if(!papr\_in\_array($postid,$post)){ |
  | 274 |  | array\_push($post,$postid); |
  | 275 |  | } |
  | 276 |  | } |
  | 277 |  |  |
  | 278 |  | for($i=0;$i<sizeof($post);$i++) { |
  | 279 |  |  |
  | 280 |  | $postid = $post[$i]; |
  | 281 |  |  |
  | 282 |  | $roles = 'mo\_post\_roles\_' . $postid; |
  | 283 |  | $login = 'mo\_post\_login\_' . $postid; |
  | 284 |  |  |
  | 285 |  | unset($allowed\_roles[$postid]); |
  | 286 |  |  |
  | 287 |  | if(array\_key\_exists($roles, $\_POST)) { |
  | 288 |  | $selected\_roles\_array = array(); |
  | 289 |  | foreach($\_POST[$roles] as $key=>$value){ |
  | 290 |  | array\_push($selected\_roles\_array,sanitize\_text\_field($value)); |
  | 291 |  | } |
  | 292 |  | $allowed\_roles[$postid]=$selected\_roles\_array; |
  | 293 |  |  |
  | 294 |  | if($\_POST[$roles] != ''){ |
  | 295 |  | if(!papr\_in\_array($postid,$restrictedpost)){ |
  | 296 |  | array\_push($restrictedpost, $postid); |
  | 297 |  | } |
  | 298 |  | $\_POST[$login]='on'; //Make page private click even if user dis-selected it should get selected after save configuration |
  | 299 |  |  |
  | 300 |  | } else { |
  | 301 |  | unset($restrictedpost[$postid]); |
  | 302 |  | } |
  | 303 |  | } |
  | 304 |  |  |
  | 305 |  | if(array\_key\_exists($login, $\_POST)) { |
  | 306 |  | if($\_POST[$login]==1 || $\_POST[$login]=='on' || $\_POST[$login]=='true'){ |
  | 307 |  | $allowed\_redirect\_post[$postid]=true; |
  | 308 |  | unset($unrestricted\_posts[$postid]); |
  | 309 |  | } |
  | 310 |  | } |
  | 311 |  | else if ( $access\_for\_only\_loggedin\_post==1 && !array\_key\_exists($login, $\_POST) ) { |
  | 312 |  | unset($allowed\_redirect\_post[$postid]); |
  | 313 |  | $unrestricted\_posts[$postid] = true; |
  | 314 |  | } |
  | 315 |  | else { |
  | 316 |  | unset($allowed\_redirect\_post[$postid]); |
  | 317 |  | $unrestricted\_posts[$postid] = true; |
  | 318 |  | } |
  | 319 |  | } |
  | 320 |  |  |
  | 321 |  | update\_option('papr\_allowed\_roles\_for\_posts',$allowed\_roles); |
  | 322 |  | update\_option('papr\_restricted\_posts',$restrictedpost); |
  | 323 |  | update\_option('papr\_allowed\_redirect\_for\_posts',$allowed\_redirect\_post); |
  | 324 |  | update\_option('papr\_login\_unrestricted\_posts',$unrestricted\_posts); |
  | 325 |  | update\_option( 'papr\_message', 'Selected post have been restricted successfully.'); |
  | 326 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 327 |  | return; |
  | 328 |  | } |
  | 329 |  |  |
  | 330 |  | if( papr\_check\_option\_admin\_referer("papr\_results\_per\_page") ){ |
  | 331 |  | $results\_per\_page = sanitize\_text\_field($\_POST['papr\_results\_per\_page']); |
  | 332 |  | update\_option('papr\_results\_per\_page',$results\_per\_page); |
  | 333 |  | return; |
  | 334 |  | } |
  | 335 |  |  |
  | 336 |  | if( papr\_check\_option\_admin\_referer("papr\_search\_page") ){ |
  | 337 |  | $mo\_page\_search\_value = stripslashes(sanitize\_text\_field($\_POST['mo\_page\_search'])); |
  | 338 |  | update\_option('papr\_page\_search\_value',$mo\_page\_search\_value); |
  | 339 |  | return; |
  | 340 |  | } |
  | 341 |  |  |
  | 342 |  | if( papr\_check\_option\_admin\_referer("papr\_search\_post") ){ |
  | 343 |  | $mo\_post\_search\_value = stripslashes(sanitize\_text\_field($\_POST['mo\_post\_search'])); |
  | 344 |  | update\_option('papr\_post\_search\_value',$mo\_post\_search\_value); |
  | 345 |  | return; |
  | 346 |  | } |
  | 347 |  |  |
  | 348 |  | if( papr\_check\_option\_admin\_referer("papr\_post\_type") ){ |
  | 349 |  | $mo\_post\_type = sanitize\_text\_field($\_POST['papr\_post\_type']); |
  | 350 |  | update\_option('papr\_post\_type',$mo\_post\_type); |
  | 351 |  | return; |
  | 352 |  | } |
  | 353 |  |  |
  | 354 |  | if( papr\_check\_option\_admin\_referer("papr\_default\_role\_parent\_page\_toggle") ){ |
  | 355 |  | if ( isset( $\_POST["papr\_default\_role\_parent\_page\_toggle"])){ |
  | 356 |  |  |
  | 357 |  | $allowed\_roles          = get\_option('papr\_allowed\_roles\_for\_pages'); |
  | 358 |  | $restrictedpages        = get\_option('papr\_restricted\_pages'); |
  | 359 |  | $allowed\_redirect\_pages = get\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 360 |  | $default\_role\_parent    = get\_option('papr\_default\_role\_parent'); |
  | 361 |  |  |
  | 362 |  | $allowed\_roles          = $allowed\_roles!='' ? $allowed\_roles: array(); |
  | 363 |  | $restrictedpages        = $restrictedpages!='' ? $restrictedpages : array(); |
  | 364 |  | $allowed\_redirect\_pages = $allowed\_redirect\_pages!='' ? $allowed\_redirect\_pages : array(); |
  | 365 |  | $default\_role\_parent    = $default\_role\_parent!='' ? $default\_role\_parent : array(); |
  | 366 |  |  |
  | 367 |  | $all\_parent\_pages = array( |
  | 368 |  | 'post\_parent' => 0, |
  | 369 |  | 'numberposts' => -1, |
  | 370 |  | 'post\_type' => 'page' |
  | 371 |  | ); |
  | 372 |  |  |
  | 373 |  | $total\_parent\_pages = get\_posts( $all\_parent\_pages ); |
  | 374 |  |  |
  | 375 |  | foreach($total\_parent\_pages as $page ){ |
  | 376 |  | $pageid = $page->ID; |
  | 377 |  | $default\_role\_parent[$page->ID]=true; |
  | 378 |  |  |
  | 379 |  | $children = get\_pages( array( 'child\_of' => $page->ID ) ); |
  | 380 |  |  |
  | 381 |  | if(count( $children ) > 0){ |
  | 382 |  | foreach($children as $child){ |
  | 383 |  |  |
  | 384 |  | if(!empty($allowed\_roles[$page->ID])) |
  | 385 |  | $allowed\_roles[$child->ID] = $allowed\_roles[$page->ID]; |
  | 386 |  |  |
  | 387 |  | if($allowed\_roles[$child->ID] != ''){ |
  | 388 |  | if(!papr\_in\_array($child->ID,$restrictedpages)){ |
  | 389 |  | array\_push($restrictedpages, $child->ID); |
  | 390 |  | } |
  | 391 |  | } else { |
  | 392 |  | unset($restrictedpages[$child->ID]); |
  | 393 |  | } |
  | 394 |  |  |
  | 395 |  | if(!empty($allowed\_redirect\_pages[$pageid])) { |
  | 396 |  | if($allowed\_redirect\_pages[$pageid]==1 || $allowed\_redirect\_pages[$pageid]=='on' || $allowed\_redirect\_pages[$pageid]=='true'){ |
  | 397 |  | $allowed\_redirect\_pages[$child->ID]=true; |
  | 398 |  | } |
  | 399 |  | } else { |
  | 400 |  | unset($allowed\_redirect\_pages[$child->ID]); |
  | 401 |  | } |
  | 402 |  |  |
  | 403 |  | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  | 404 |  |  |
  | 405 |  | if(count($children\_of\_children)>0) { |
  | 406 |  | $default\_role\_parent[$child->ID]=true; |
  | 407 |  | } |
  | 408 |  | } |
  | 409 |  | } |
  | 410 |  | } |
  | 411 |  |  |
  | 412 |  | update\_option('papr\_allowed\_roles\_for\_pages', $allowed\_roles); |
  | 413 |  | update\_option('papr\_restricted\_pages', $restrictedpages); |
  | 414 |  | update\_option('papr\_allowed\_redirect\_for\_pages',$allowed\_redirect\_pages); |
  | 415 |  | update\_option('papr\_default\_role\_parent',$default\_role\_parent); |
  | 416 |  | update\_option('papr\_default\_role\_parent\_page\_toggle',1); |
  | 417 |  | update\_option('papr\_select\_all\_pages','checked'); |
  | 418 |  | } |
  | 419 |  |  |
  | 420 |  | else{ |
  | 421 |  | $default\_role\_parent = array(); |
  | 422 |  | update\_option('papr\_default\_role\_parent\_page\_toggle',0); |
  | 423 |  | update\_option('papr\_select\_all\_pages','unchecked'); |
  | 424 |  | update\_option('papr\_default\_role\_parent',$default\_role\_parent); |
  | 425 |  | } |
  | 426 |  | update\_option( 'papr\_message', 'Configuration saved Successfully'); |
  | 427 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 428 |  | return; |
  | 429 |  | } |
  | 430 |  |  |
  | 431 |  | if( papr\_check\_option\_admin\_referer("papr\_access\_for\_only\_loggedin") ){ |
  | 432 |  | if ( isset( $\_POST["papr\_access\_for\_only\_loggedin"])){ |
  | 433 |  | $unrestricted\_pages = array(); |
  | 434 |  | update\_option('papr\_login\_unrestricted\_pages',$unrestricted\_pages); |
  | 435 |  | update\_option('papr\_access\_for\_only\_loggedin',1); |
  | 436 |  | } else{ |
  | 437 |  | $allowed\_redirect\_pages = array(); |
  | 438 |  | update\_option('papr\_allowed\_redirect\_for\_pages',$allowed\_redirect\_pages); |
  | 439 |  | update\_option('papr\_access\_for\_only\_loggedin',0); |
  | 440 |  | } |
  | 441 |  | update\_option( 'papr\_message', 'Configuration saved Successfully'); |
  | 442 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 443 |  | return; |
  | 444 |  | } |
  | 445 |  |  |
  | 446 |  | if( papr\_check\_option\_admin\_referer("papr\_access\_for\_only\_loggedin\_posts") ){ |
  | 447 |  | if ( isset( $\_POST["papr\_access\_for\_only\_loggedin\_posts"])){ |
  | 448 |  | $unrestricted\_post = array(); |
  | 449 |  | update\_option('papr\_login\_unrestricted\_posts',$unrestricted\_post); |
  | 450 |  | update\_option('papr\_access\_for\_only\_loggedin\_posts',1); |
  | 451 |  | } else{ |
  | 452 |  | $allowed\_redirect\_post = array(); |
  | 453 |  | update\_option('papr\_allowed\_redirect\_for\_posts',$allowed\_redirect\_post); |
  | 454 |  | update\_option('papr\_access\_for\_only\_loggedin\_posts',0); |
  | 455 |  | } |
  | 456 |  | update\_option( 'papr\_message', 'Configuration saved Successfully'); |
  | 457 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 458 |  | return; |
  | 459 |  | } |
  | 460 |  |  |
  | 461 |  | if( papr\_check\_option\_admin\_referer("papr\_post\_per\_page") ){ |
  | 462 |  | $results\_per\_page = sanitize\_text\_field($\_POST['papr\_post\_per\_page']); |
  | 463 |  | update\_option('papr\_post\_per\_page',$results\_per\_page); |
  | 464 |  |  |
  | 465 |  | return; |
  | 466 |  | } |
  | 467 |  |  |
  | 468 |  | if( papr\_check\_option\_admin\_referer("papr\_category\_per\_page") ){ |
  | 469 |  | $results\_per\_page = sanitize\_text\_field($\_POST['papr\_category\_per\_page']); |
  | 470 |  | update\_option('papr\_category\_per\_page',$results\_per\_page); |
  | 471 |  |  |
  | 472 |  | return; |
  | 473 |  | } |
  | 474 |  |  |
  | 475 |  | if( papr\_check\_option\_admin\_referer("papr\_tag\_per\_page") ){ |
  | 476 |  | $results\_per\_page = sanitize\_text\_field($\_POST['papr\_tag\_per\_page']); |
  | 477 |  | update\_option('papr\_tag\_per\_page',$results\_per\_page); |
  | 478 |  |  |
  | 479 |  | return; |
  | 480 |  | } |
  | 481 |  |  |
  | 482 |  | else if(papr\_check\_option\_admin\_referer('papr\_contact\_us\_query\_option')){ |
  | 483 |  |  |
  | 484 |  | if ( ! papr\_is\_curl\_installed() ) { |
  | 485 |  | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Query submit failed.' ); |
  | 486 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 487 |  | return; |
  | 488 |  | } |
  | 489 |  |  |
  | 490 |  | // Contact Us query |
  | 491 |  | $email    = sanitize\_email($\_POST['papr\_contact\_us\_email']); |
  | 492 |  | $phone    = htmlspecialchars($\_POST['papr\_contact\_us\_phone']); |
  | 493 |  | $query    = htmlspecialchars($\_POST['papr\_contact\_us\_query']); |
  | 494 |  |  |
  | 495 |  | $customer = new Customer\_page\_restriction(); |
  | 496 |  | if ( papr\_check\_empty\_or\_null( $email ) || papr\_check\_empty\_or\_null( $query ) ) { |
  | 497 |  | update\_option( 'papr\_message', 'Please fill up Email and Query fields to submit your query.' ); |
  | 498 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 499 |  | } |
  | 500 |  | else if (!filter\_var($email, FILTER\_VALIDATE\_EMAIL)) { |
  | 501 |  | update\_option( 'papr\_message', 'Please enter a valid email address.' ); |
  | 502 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 503 |  | } |
  | 504 |  | else { |
  | 505 |  | $submited = $customer->papr\_submit\_contact\_us( $email, $phone, $query ); |
  | 506 |  | if(!is\_null($submited)){ |
  | 507 |  | if ( $submited == false ) { |
  | 508 |  | update\_option( 'papr\_message', 'Your query could not be submitted. Please try again.' ); |
  | 509 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 510 |  | } else { |
  | 511 |  | update\_option( 'papr\_message', 'Thanks for getting in touch! We shall get back to you shortly.' ); |
  | 512 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 513 |  | } |
  | 514 |  | } |
  | 515 |  | } |
  | 516 |  | } |
  | 517 |  |  |
  | 518 |  | else if (papr\_check\_option\_admin\_referer('papr\_change\_miniorange')){ |
  | 519 |  | papr\_remove\_account(); |
  | 520 |  | update\_option('papr\_guest\_enabled',true); |
  | 521 |  | return; |
  | 522 |  | } |
  | 523 |  |  |
  | 524 |  | else if ( papr\_check\_option\_admin\_referer("papr\_go\_back") ) { |
  | 525 |  | update\_option( 'papr\_registration\_status', '' ); |
  | 526 |  | update\_option( 'papr\_verify\_customer', '' ); |
  | 527 |  | delete\_option( 'papr\_new\_registration' ); |
  | 528 |  | delete\_option( 'papr\_admin\_email' ); |
  | 529 |  | delete\_option( 'papr\_admin\_phone' ); |
  | 530 |  | } |
  | 531 |  |  |
  | 532 |  | else if ( papr\_check\_option\_admin\_referer("papr\_goto\_login") ) { |
  | 533 |  | delete\_option( 'papr\_new\_registration' ); |
  | 534 |  | update\_option( 'papr\_verify\_customer', 'true' ); |
  | 535 |  | } |
  | 536 |  |  |
  | 537 |  | else if ( papr\_check\_option\_admin\_referer("papr\_forgot\_password\_form\_option") ) { |
  | 538 |  | if ( ! papr\_is\_curl\_installed() ) { |
  | 539 |  | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Resend OTP failed.' ); |
  | 540 |  | papr\_show\_error\_message(); |
  | 541 |  | return; |
  | 542 |  | } |
  | 543 |  |  |
  | 544 |  | $email = get\_option( 'papr\_admin\_email' ); |
  | 545 |  | $customer = new Customer\_page\_restriction(); |
  | 546 |  | $content  = json\_decode( $customer->papr\_forgot\_password( $email ), true ); |
  | 547 |  | if(!is\_null($content)){ |
  | 548 |  | if ( strcasecmp( $content['status'], 'SUCCESS' ) == 0 ) { |
  | 549 |  | update\_option( 'papr\_message', 'Your password has been reset successfully. Please enter the new password sent to ' . $email . '.' ); |
  | 550 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 551 |  | } else { |
  | 552 |  | update\_option( 'papr\_message', 'An error occured while processing your request. Please Try again.' ); |
  | 553 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 554 |  | } |
  | 555 |  | } |
  | 556 |  | } |
  | 557 |  |  |
  | 558 |  | else if( papr\_check\_option\_admin\_referer("papr\_verify\_customer") ) {    //register the admin to miniOrange |
  | 559 |  | if ( ! papr\_is\_curl\_installed() ) { |
  | 560 |  | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Login failed.' ); |
  | 561 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 562 |  | return; |
  | 563 |  | } |
  | 564 |  |  |
  | 565 |  | $email    = ''; |
  | 566 |  | $password = ''; |
  | 567 |  | if ( papr\_check\_empty\_or\_null( $\_POST['email'] ) || papr\_check\_empty\_or\_null( $\_POST['password'] ) ) { |
  | 568 |  | update\_option( 'papr\_message', 'All the fields are required. Please enter valid entries.' ); |
  | 569 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 570 |  | return; |
  | 571 |  | } else if(papr\_check\_password\_pattern(htmlspecialchars($\_POST['password']))){ |
  | 572 |  | update\_option( 'papr\_message', 'Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*-\_) should be present.' ); |
  | 573 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 574 |  | return; |
  | 575 |  | }else { |
  | 576 |  | $email    = sanitize\_email( $\_POST['email'] ); |
  | 577 |  | $password = stripslashes( htmlspecialchars($\_POST['password'] )); |
  | 578 |  | } |
  | 579 |  |  |
  | 580 |  | update\_option( 'papr\_admin\_email', $email ); |
  | 581 |  | update\_option( 'papr\_admin\_password', $password ); |
  | 582 |  | $customer    = new Customer\_page\_restriction(); |
  | 583 |  | $content     = $customer->papr\_get\_customer\_key(); |
  | 584 |  |  |
  | 585 |  | if(!is\_null($content)){ |
  | 586 |  | $customerKey = json\_decode( $content, true ); |
  | 587 |  | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  | 588 |  | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  | 589 |  | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  | 590 |  | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  | 591 |  | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  | 592 |  | update\_option( 'papr\_admin\_password', '' ); |
  | 593 |  | update\_option( 'papr\_message', 'Customer retrieved successfully' ); |
  | 594 |  | update\_option( 'papr\_registration\_status', 'Existing User' ); |
  | 595 |  | delete\_option( 'papr\_verify\_customer' ); |
  | 596 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 597 |  | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  | 598 |  | exit; |
  | 599 |  | } |
  | 600 |  | else { |
  | 601 |  | update\_option( 'papr\_message', 'Invalid username or password. Please try again.' ); |
  | 602 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 603 |  | } |
  | 604 |  | update\_option( 'papr\_admin\_password', '' ); |
  | 605 |  | } |
  | 606 |  | } |
  | 607 |  |  |
  | 608 |  | else if ( papr\_check\_option\_admin\_referer("papr\_register\_customer")) { |
  | 609 |  | $user = wp\_get\_current\_user(); |
  | 610 |  | if ( ! papr\_is\_curl\_installed() ) { |
  | 611 |  | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Registration failed.' ); |
  | 612 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 613 |  | return; |
  | 614 |  | } |
  | 615 |  |  |
  | 616 |  | $email           = ''; |
  | 617 |  | $password        = ''; |
  | 618 |  | $confirmPassword = ''; |
  | 619 |  |  |
  | 620 |  | if ( papr\_check\_empty\_or\_null( $\_POST['email'] ) || papr\_check\_empty\_or\_null( $\_POST['password'] ) || papr\_check\_empty\_or\_null( $\_POST['confirmPassword'] ) ) { |
  | 621 |  | update\_option( 'papr\_message', 'Please enter the required fields.' ); |
  | 622 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 623 |  | return; |
  | 624 |  | } |
  | 625 |  | else if (!filter\_var($\_POST['email'], FILTER\_VALIDATE\_EMAIL)) { |
  | 626 |  | update\_option( 'papr\_message', 'Please enter a valid email address.' ); |
  | 627 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 628 |  | return; |
  | 629 |  | } |
  | 630 |  | else if(papr\_check\_password\_pattern(htmlspecialchars($\_POST['password']))){ |
  | 631 |  | update\_option( 'papr\_message', 'Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*-\_) should be present.' ); |
  | 632 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 633 |  | return; |
  | 634 |  | } |
  | 635 |  | else { |
  | 636 |  | $email           = sanitize\_email( $\_POST['email'] ); |
  | 637 |  | $password        = stripslashes( htmlspecialchars($\_POST['password'] )); |
  | 638 |  | $confirmPassword = stripslashes( htmlspecialchars($\_POST['confirmPassword'] )); |
  | 639 |  | } |
  | 640 |  | update\_option( 'papr\_admin\_email', $email ); |
  | 641 |  |  |
  | 642 |  | if ( strcmp( $password, $confirmPassword ) == 0 ) { |
  | 643 |  | update\_option( 'papr\_admin\_password', $password ); |
  | 644 |  | $email    = get\_option( 'papr\_admin\_email' ); |
  | 645 |  | $customer = new Customer\_page\_restriction(); |
  | 646 |  | $content  = json\_decode( $customer->papr\_check\_customer(), true ); |
  | 647 |  | if(!is\_null($content)){ |
  | 648 |  | if ( strcasecmp( $content['status'], 'CUSTOMER\_NOT\_FOUND' ) == 0 ) { |
  | 649 |  | $response = papr\_create\_customer(); |
  | 650 |  | if(is\_array($response) && !empty($response['status']) && $response['status'] == 'success'){ |
  | 651 |  | update\_option( 'papr\_message', 'Customer created successfully.' ); |
  | 652 |  | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  | 653 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 654 |  | exit; |
  | 655 |  | } |
  | 656 |  | else{ |
  | 657 |  | update\_option( 'papr\_message', 'This is not a valid email. Please enter a valid email.' ); |
  | 658 |  | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  | 659 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 660 |  | exit; |
  | 661 |  | } |
  | 662 |  | } |
  | 663 |  | else if(strcasecmp($content['status'], 'INVALID\_EMAIL') == 0){ |
  | 664 |  | update\_option( 'papr\_message', 'This is not a valid email. Please enter a valid email.' ); |
  | 665 |  | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  | 666 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 667 |  | exit; |
  | 668 |  | } |
  | 669 |  | else { |
  | 670 |  | $response = papr\_get\_current\_customer(); |
  | 671 |  | if(is\_array($response) && !empty($response['status']) && $response['status'] == 'success'){ |
  | 672 |  | update\_option( 'papr\_message', 'Customer Retrieved Successfully.' ); |
  | 673 |  | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  | 674 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 675 |  | exit; |
  | 676 |  | } |
  | 677 |  | } |
  | 678 |  | } |
  | 679 |  | } |
  | 680 |  | else { |
  | 681 |  | update\_option( 'papr\_message', 'Passwords do not match.' ); |
  | 682 |  | delete\_option( 'papr\_verify\_customer' ); |
  | 683 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 684 |  | } |
  | 685 |  | return; |
  | 686 |  | } |
  | 687 |  |  |
  | 688 |  | else if ( papr\_check\_option\_admin\_referer("papr\_skip\_feedback") ) { |
  | 689 |  | update\_option( 'papr\_message', 'Plugin deactivated successfully' ); |
  | 690 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 691 |  | deactivate\_plugins('page-and-post-restriction\page-and-post-restriction.php'); |
  | 692 |  | wp\_redirect('plugins.php'); |
  | 693 |  | } |
  | 694 |  |  |
  | 695 |  | if ( papr\_check\_option\_admin\_referer("papr\_feedback") ) { |
  | 696 |  | $user = wp\_get\_current\_user(); |
  | 697 |  | $message = 'Plugin Deactivated'; |
  | 698 |  | $deactivate\_reason\_message = array\_key\_exists( 'papr\_query\_feedback', $\_POST ) ? htmlspecialchars($\_POST['papr\_query\_feedback']) : false; |
  | 699 |  | $message.= ', Feedback : '.$deactivate\_reason\_message.''; |
  | 700 |  | $reason=''; |
  | 701 |  | if (isset($\_POST['papr\_reason'])) |
  | 702 |  | $reason = htmlspecialchars($\_POST['papr\_reason']); |
  | 703 |  |  |
  | 704 |  | $email = ''; |
  | 705 |  | $message.= ', [Reason :'.$reason.']'; |
  | 706 |  | if(isset($\_POST['papr\_query\_mail'])){ |
  | 707 |  | $email = sanitize\_email($\_POST['papr\_query\_mail']); |
  | 708 |  | } |
  | 709 |  | if(!filter\_var($email, FILTER\_VALIDATE\_EMAIL)){ |
  | 710 |  | $email = get\_option('papr\_admin\_email'); |
  | 711 |  | if(empty($email)) |
  | 712 |  | $email = $user->user\_email; |
  | 713 |  | } |
  | 714 |  | $phone = get\_option( 'papr\_admin\_phone' ); |
  | 715 |  | $feedback\_reasons = new Customer\_page\_restriction(); |
  | 716 |  | if(!is\_null($feedback\_reasons)){ |
  | 717 |  | if(!papr\_is\_curl\_installed()){ |
  | 718 |  | deactivate\_plugins( 'page-and-post-restriction\page-and-post-restriction.php' ); |
  | 719 |  | wp\_redirect('plugins.php'); |
  | 720 |  | } else { |
  | 721 |  | $submited = json\_decode( $feedback\_reasons->papr\_send\_email\_alert( $email, $phone, $message ), true ); |
  | 722 |  |  |
  | 723 |  | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  | 724 |  | if ( is\_array( $submited ) && !empty($submited['status'] ) && $submited['status'] == 'ERROR' ) { |
  | 725 |  | update\_option( 'papr\_message', $submited['message'] ); |
  | 726 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 727 |  | } |
  | 728 |  | else { |
  | 729 |  | if ( $submited == false ) { |
  | 730 |  | update\_option( 'papr\_message', 'Error while submitting the query.' ); |
  | 731 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 732 |  | } |
  | 733 |  | } |
  | 734 |  | } |
  | 735 |  |  |
  | 736 |  | deactivate\_plugins( 'page-and-post-restriction\page-and-post-restriction.php' ); |
  | 737 |  | wp\_redirect('plugins.php'); |
  | 738 |  | update\_option( 'papr\_message', 'Thank you for the feedback.' ); |
  | 739 |  | update\_option('papr\_message\_success\_fail','success'); |
  | 740 |  | } |
  | 741 |  | } |
  | 742 |  | } |
  |  | 144 | $allowed\_roles[ $pageid ] = $selected\_roles\_array; |
  |  | 145 | } |
  |  | 146 | } |
  |  | 147 |  |
  |  | 148 | if ( array\_key\_exists( $roles, $\_POST ) ) { |
  |  | 149 | if ( $\_POST[ $roles ] != '' ) { |
  |  | 150 | if ( ! papr\_in\_array( $pageid, $restrictedpages ) ) { |
  |  | 151 | array\_push( $restrictedpages, $pageid ); |
  |  | 152 | } |
  |  | 153 | $\_POST[ $login ] = 'on'; // Make page private click even if user dis-selected it should get selected after save configuration |
  |  | 154 |  |
  |  | 155 | } else { |
  |  | 156 | unset( $restrictedpages[ $pageid ] ); |
  |  | 157 | } |
  |  | 158 | } |
  |  | 159 |  |
  |  | 160 | if ( array\_key\_exists( $login, $\_POST ) ) { |
  |  | 161 | if ( $\_POST[ $login ] == 1 || $\_POST[ $login ] == 'on' || $\_POST[ $login ] == 'true' ) { |
  |  | 162 | $allowed\_redirect\_pages[ $pageid ] = true; |
  |  | 163 | unset( $unrestricted\_pages[ $pageid ] ); |
  |  | 164 | } |
  |  | 165 | } elseif ( $default\_login\_toggle == 1 && ! array\_key\_exists( $login, $\_POST ) ) { |
  |  | 166 | unset( $allowed\_redirect\_pages[ $pageid ] ); |
  |  | 167 | $unrestricted\_pages[ $pageid ] = true; |
  |  | 168 | } else { |
  |  | 169 | unset( $allowed\_redirect\_pages[ $pageid ] ); |
  |  | 170 | $unrestricted\_pages[ $pageid ] = true; |
  |  | 171 | } |
  |  | 172 |  |
  |  | 173 | if ( array\_key\_exists( $default, $\_POST ) ) { |
  |  | 174 | if ( $\_POST[ $default ] == 1 || $\_POST[ $default ] == 'on' || $\_POST[ $default ] == 'true' ) { |
  |  | 175 | $default\_role\_parent[ $pageid ] = true; |
  |  | 176 | } |
  |  | 177 | } else { |
  |  | 178 | unset( $default\_role\_parent[ $pageid ] ); |
  |  | 179 | } |
  |  | 180 |  |
  |  | 181 | if ( ! empty( $default\_role\_parent[ $pageid ] ) || $default\_role\_toggle == 1 ) { |
  |  | 182 | if ( $pageid != 0 ) { |
  |  | 183 | $default\_role\_parent[ $pageid ] = true; |
  |  | 184 |  |
  |  | 185 | $children = get\_pages( array( 'child\_of' => $pageid ) ); |
  |  | 186 |  |
  |  | 187 | if ( count( $children ) > 0 ) { |
  |  | 188 |  |
  |  | 189 | foreach ( $children as $child ) { |
  |  | 190 | $child\_id      = $child->ID; |
  |  | 191 | $login\_child   = 'mo\_page\_login\_' . $child->ID; |
  |  | 192 | $roles\_child   = 'mo\_page\_roles\_' . $child->ID; |
  |  | 193 | $default\_child = 'mo\_page\_default\_role\_' . $child->ID; |
  |  | 194 |  |
  |  | 195 | unset( $\_POST[ $roles\_child ] ); |
  |  | 196 |  |
  |  | 197 | if ( array\_key\_exists( $login, $\_POST ) ) { |
  |  | 198 | $\_POST[ $login\_child ] = sanitize\_text\_field( $\_POST[ $login ] ); |
  |  | 199 | } else { |
  |  | 200 | unset( $\_POST[ $login\_child ] ); |
  |  | 201 | } |
  |  | 202 |  |
  |  | 203 | if ( ! empty( $allowed\_roles[ $pageid ] ) ) { |
  |  | 204 | $allowed\_roles[ $child->ID ] = $allowed\_roles[ $pageid ]; |
  |  | 205 | } |
  |  | 206 |  |
  |  | 207 | if ( ! empty( $allowed\_roles[ $child->ID ] ) && $allowed\_roles[ $child->ID ] != '' ) { |
  |  | 208 | if ( ! papr\_in\_array( $child->ID, $restrictedpages ) ) { |
  |  | 209 | array\_push( $restrictedpages, $child->ID ); |
  |  | 210 | } |
  |  | 211 | } else { |
  |  | 212 | unset( $restrictedpages[ $child->ID ] ); |
  |  | 213 | } |
  |  | 214 |  |
  |  | 215 | if ( ! empty( $allowed\_redirect\_pages[ $pageid ] ) ) { |
  |  | 216 | if ( $allowed\_redirect\_pages[ $pageid ] == 1 || $allowed\_redirect\_pages[ $pageid ] == 'on' || $allowed\_redirect\_pages[ $pageid ] == 'true' ) { |
  |  | 217 | $allowed\_redirect\_pages[ $child->ID ] = true; |
  |  | 218 | unset( $unrestricted\_pages[ $child->ID ] ); |
  |  | 219 | } |
  |  | 220 | } else { |
  |  | 221 | unset( $allowed\_redirect\_pages[ $child->ID ] ); |
  |  | 222 | $unrestricted\_pages[ $child->ID ] = true; |
  |  | 223 | } |
  |  | 224 |  |
  |  | 225 | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  |  | 226 |  |
  |  | 227 | if ( count( $children\_of\_children ) > 0 ) { |
  |  | 228 | $default\_role\_parent[ $child->ID ] = true; |
  |  | 229 | $\_POST[ $default\_child ]           = 'on'; |
  |  | 230 | } |
  |  | 231 | } |
  |  | 232 | } |
  |  | 233 | } |
  |  | 234 | } |
  |  | 235 | } |
  |  | 236 |  |
  |  | 237 | update\_option( 'papr\_allowed\_roles\_for\_pages', $allowed\_roles ); |
  |  | 238 | update\_option( 'papr\_restricted\_pages', $restrictedpages ); |
  |  | 239 | update\_option( 'papr\_allowed\_redirect\_for\_pages', $allowed\_redirect\_pages ); |
  |  | 240 | update\_option( 'papr\_login\_unrestricted\_pages', $unrestricted\_pages ); |
  |  | 241 | update\_option( 'papr\_default\_role\_parent', $default\_role\_parent ); |
  |  | 242 |  |
  |  | 243 | update\_option( 'papr\_message', 'Selected pages have been restricted successfully.' ); |
  |  | 244 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 245 | return; |
  |  | 246 | } |
  |  | 247 |  |
  |  | 248 | if ( papr\_check\_option\_admin\_referer( 'papr\_restrict\_post\_roles\_login' ) ) { |
  |  | 249 |  |
  |  | 250 | $allowed\_roles                 = get\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 251 | $restrictedpost                = get\_option( 'papr\_restricted\_posts' ); |
  |  | 252 | $allowed\_redirect\_post         = get\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 253 | $access\_for\_only\_loggedin\_post = get\_option( 'papr\_access\_for\_only\_loggedin\_posts' ); |
  |  | 254 | $unrestricted\_posts            = get\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 255 |  |
  |  | 256 | $allowed\_roles                 = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 257 | $restrictedpost                = $restrictedpost != '' ? $restrictedpost : array(); |
  |  | 258 | $allowed\_redirect\_post         = $allowed\_redirect\_post != '' ? $allowed\_redirect\_post : array(); |
  |  | 259 | $access\_for\_only\_loggedin\_post = $access\_for\_only\_loggedin\_post != '' ? $access\_for\_only\_loggedin\_post : ''; |
  |  | 260 | $unrestricted\_posts            = $unrestricted\_posts ? $unrestricted\_posts : array(); |
  |  | 261 |  |
  |  | 262 | unset( $\_POST['\_wpnonce'] ); |
  |  | 263 | unset( $\_POST['\_wp\_http\_referer'] ); |
  |  | 264 | unset( $\_POST['option'] ); |
  |  | 265 |  |
  |  | 266 | $post = array(); |
  |  | 267 | foreach ( $\_POST as $key => $value ) { |
  |  | 268 | $postid = (int) filter\_var( $key, FILTER\_SANITIZE\_NUMBER\_INT ); |
  |  | 269 | if ( ! papr\_in\_array( $postid, $post ) ) { |
  |  | 270 | array\_push( $post, $postid ); |
  |  | 271 | } |
  |  | 272 | } |
  |  | 273 |  |
  |  | 274 | for ( $i = 0;$i < sizeof( $post );$i++ ) { |
  |  | 275 |  |
  |  | 276 | $postid = $post[ $i ]; |
  |  | 277 |  |
  |  | 278 | $roles = 'mo\_post\_roles\_' . $postid; |
  |  | 279 | $login = 'mo\_post\_login\_' . $postid; |
  |  | 280 |  |
  |  | 281 | unset( $allowed\_roles[ $postid ] ); |
  |  | 282 |  |
  |  | 283 | if ( array\_key\_exists( $roles, $\_POST ) ) { |
  |  | 284 | $selected\_roles\_array = array(); |
  |  | 285 | foreach ( $\_POST[ $roles ] as $key => $value ) { |
  |  | 286 | array\_push( $selected\_roles\_array, sanitize\_text\_field( $value ) ); |
  |  | 287 | } |
  |  | 288 | $allowed\_roles[ $postid ] = $selected\_roles\_array; |
  |  | 289 |  |
  |  | 290 | if ( $\_POST[ $roles ] != '' ) { |
  |  | 291 | if ( ! papr\_in\_array( $postid, $restrictedpost ) ) { |
  |  | 292 | array\_push( $restrictedpost, $postid ); |
  |  | 293 | } |
  |  | 294 | $\_POST[ $login ] = 'on'; // Make page private click even if user dis-selected it should get selected after save configuration |
  |  | 295 |  |
  |  | 296 | } else { |
  |  | 297 | unset( $restrictedpost[ $postid ] ); |
  |  | 298 | } |
  |  | 299 | } |
  |  | 300 |  |
  |  | 301 | if ( array\_key\_exists( $login, $\_POST ) ) { |
  |  | 302 | if ( $\_POST[ $login ] == 1 || $\_POST[ $login ] == 'on' || $\_POST[ $login ] == 'true' ) { |
  |  | 303 | $allowed\_redirect\_post[ $postid ] = true; |
  |  | 304 | unset( $unrestricted\_posts[ $postid ] ); |
  |  | 305 | } |
  |  | 306 | } elseif ( $access\_for\_only\_loggedin\_post == 1 && ! array\_key\_exists( $login, $\_POST ) ) { |
  |  | 307 | unset( $allowed\_redirect\_post[ $postid ] ); |
  |  | 308 | $unrestricted\_posts[ $postid ] = true; |
  |  | 309 | } else { |
  |  | 310 | unset( $allowed\_redirect\_post[ $postid ] ); |
  |  | 311 | $unrestricted\_posts[ $postid ] = true; |
  |  | 312 | } |
  |  | 313 | } |
  |  | 314 |  |
  |  | 315 | update\_option( 'papr\_allowed\_roles\_for\_posts', $allowed\_roles ); |
  |  | 316 | update\_option( 'papr\_restricted\_posts', $restrictedpost ); |
  |  | 317 | update\_option( 'papr\_allowed\_redirect\_for\_posts', $allowed\_redirect\_post ); |
  |  | 318 | update\_option( 'papr\_login\_unrestricted\_posts', $unrestricted\_posts ); |
  |  | 319 | update\_option( 'papr\_message', 'Selected post have been restricted successfully.' ); |
  |  | 320 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 321 | return; |
  |  | 322 | } |
  |  | 323 |  |
  |  | 324 | if ( papr\_check\_option\_admin\_referer( 'papr\_results\_per\_page' ) ) { |
  |  | 325 | $results\_per\_page = sanitize\_text\_field( $\_POST['papr\_results\_per\_page'] ); |
  |  | 326 | update\_option( 'papr\_results\_per\_page', $results\_per\_page ); |
  |  | 327 | return; |
  |  | 328 | } |
  |  | 329 |  |
  |  | 330 | if ( papr\_check\_option\_admin\_referer( 'papr\_search\_page' ) ) { |
  |  | 331 | $mo\_page\_search\_value = stripslashes( sanitize\_text\_field( $\_POST['mo\_page\_search'] ) ); |
  |  | 332 | update\_option( 'papr\_page\_search\_value', $mo\_page\_search\_value ); |
  |  | 333 | return; |
  |  | 334 | } |
  |  | 335 |  |
  |  | 336 | if ( papr\_check\_option\_admin\_referer( 'papr\_search\_post' ) ) { |
  |  | 337 | $mo\_post\_search\_value = stripslashes( sanitize\_text\_field( $\_POST['mo\_post\_search'] ) ); |
  |  | 338 | update\_option( 'papr\_post\_search\_value', $mo\_post\_search\_value ); |
  |  | 339 | return; |
  |  | 340 | } |
  |  | 341 |  |
  |  | 342 | if ( papr\_check\_option\_admin\_referer( 'papr\_post\_type' ) ) { |
  |  | 343 | $mo\_post\_type = sanitize\_text\_field( $\_POST['papr\_post\_type'] ); |
  |  | 344 | update\_option( 'papr\_post\_type', $mo\_post\_type ); |
  |  | 345 | return; |
  |  | 346 | } |
  |  | 347 |  |
  |  | 348 | if ( papr\_check\_option\_admin\_referer( 'papr\_default\_role\_parent\_page\_toggle' ) ) { |
  |  | 349 | if ( isset( $\_POST['papr\_default\_role\_parent\_page\_toggle'] ) ) { |
  |  | 350 |  |
  |  | 351 | $allowed\_roles          = get\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 352 | $restrictedpages        = get\_option( 'papr\_restricted\_pages' ); |
  |  | 353 | $allowed\_redirect\_pages = get\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 354 | $default\_role\_parent    = get\_option( 'papr\_default\_role\_parent' ); |
  |  | 355 |  |
  |  | 356 | $allowed\_roles          = $allowed\_roles != '' ? $allowed\_roles : array(); |
  |  | 357 | $restrictedpages        = $restrictedpages != '' ? $restrictedpages : array(); |
  |  | 358 | $allowed\_redirect\_pages = $allowed\_redirect\_pages != '' ? $allowed\_redirect\_pages : array(); |
  |  | 359 | $default\_role\_parent    = $default\_role\_parent != '' ? $default\_role\_parent : array(); |
  |  | 360 |  |
  |  | 361 | $all\_parent\_pages = array( |
  |  | 362 | 'post\_parent' => 0, |
  |  | 363 | 'numberposts' => -1, |
  |  | 364 | 'post\_type'   => 'page', |
  |  | 365 | ); |
  |  | 366 |  |
  |  | 367 | $total\_parent\_pages = get\_posts( $all\_parent\_pages ); |
  |  | 368 |  |
  |  | 369 | foreach ( $total\_parent\_pages as $page ) { |
  |  | 370 | $pageid                           = $page->ID; |
  |  | 371 | $default\_role\_parent[ $page->ID ] = true; |
  |  | 372 |  |
  |  | 373 | $children = get\_pages( array( 'child\_of' => $page->ID ) ); |
  |  | 374 |  |
  |  | 375 | if ( count( $children ) > 0 ) { |
  |  | 376 | foreach ( $children as $child ) { |
  |  | 377 |  |
  |  | 378 | if ( ! empty( $allowed\_roles[ $page->ID ] ) ) { |
  |  | 379 | $allowed\_roles[ $child->ID ] = $allowed\_roles[ $page->ID ]; |
  |  | 380 | } |
  |  | 381 |  |
  |  | 382 | if ( $allowed\_roles[ $child->ID ] != '' ) { |
  |  | 383 | if ( ! papr\_in\_array( $child->ID, $restrictedpages ) ) { |
  |  | 384 | array\_push( $restrictedpages, $child->ID ); |
  |  | 385 | } |
  |  | 386 | } else { |
  |  | 387 | unset( $restrictedpages[ $child->ID ] ); |
  |  | 388 | } |
  |  | 389 |  |
  |  | 390 | if ( ! empty( $allowed\_redirect\_pages[ $pageid ] ) ) { |
  |  | 391 | if ( $allowed\_redirect\_pages[ $pageid ] == 1 || $allowed\_redirect\_pages[ $pageid ] == 'on' || $allowed\_redirect\_pages[ $pageid ] == 'true' ) { |
  |  | 392 | $allowed\_redirect\_pages[ $child->ID ] = true; |
  |  | 393 | } |
  |  | 394 | } else { |
  |  | 395 | unset( $allowed\_redirect\_pages[ $child->ID ] ); |
  |  | 396 | } |
  |  | 397 |  |
  |  | 398 | $children\_of\_children = get\_pages( array( 'child\_of' => $child->ID ) ); |
  |  | 399 |  |
  |  | 400 | if ( count( $children\_of\_children ) > 0 ) { |
  |  | 401 | $default\_role\_parent[ $child->ID ] = true; |
  |  | 402 | } |
  |  | 403 | } |
  |  | 404 | } |
  |  | 405 | } |
  |  | 406 |  |
  |  | 407 | update\_option( 'papr\_allowed\_roles\_for\_pages', $allowed\_roles ); |
  |  | 408 | update\_option( 'papr\_restricted\_pages', $restrictedpages ); |
  |  | 409 | update\_option( 'papr\_allowed\_redirect\_for\_pages', $allowed\_redirect\_pages ); |
  |  | 410 | update\_option( 'papr\_default\_role\_parent', $default\_role\_parent ); |
  |  | 411 | update\_option( 'papr\_default\_role\_parent\_page\_toggle', 1 ); |
  |  | 412 | update\_option( 'papr\_select\_all\_pages', 'checked' ); |
  |  | 413 | } else { |
  |  | 414 | $default\_role\_parent = array(); |
  |  | 415 | update\_option( 'papr\_default\_role\_parent\_page\_toggle', 0 ); |
  |  | 416 | update\_option( 'papr\_select\_all\_pages', 'unchecked' ); |
  |  | 417 | update\_option( 'papr\_default\_role\_parent', $default\_role\_parent ); |
  |  | 418 | } |
  |  | 419 | update\_option( 'papr\_message', 'Configuration saved Successfully' ); |
  |  | 420 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 421 | return; |
  |  | 422 | } |
  |  | 423 |  |
  |  | 424 | if ( papr\_check\_option\_admin\_referer( 'papr\_access\_for\_only\_loggedin' ) ) { |
  |  | 425 | if ( isset( $\_POST['papr\_access\_for\_only\_loggedin'] ) ) { |
  |  | 426 | $unrestricted\_pages = array(); |
  |  | 427 | update\_option( 'papr\_login\_unrestricted\_pages', $unrestricted\_pages ); |
  |  | 428 | update\_option( 'papr\_access\_for\_only\_loggedin', 1 ); |
  |  | 429 | } else { |
  |  | 430 | $allowed\_redirect\_pages = array(); |
  |  | 431 | update\_option( 'papr\_allowed\_redirect\_for\_pages', $allowed\_redirect\_pages ); |
  |  | 432 | update\_option( 'papr\_access\_for\_only\_loggedin', 0 ); |
  |  | 433 | } |
  |  | 434 | update\_option( 'papr\_message', 'Configuration saved Successfully' ); |
  |  | 435 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 436 | return; |
  |  | 437 | } |
  |  | 438 |  |
  |  | 439 | if ( papr\_check\_option\_admin\_referer( 'papr\_access\_for\_only\_loggedin\_posts' ) ) { |
  |  | 440 | if ( isset( $\_POST['papr\_access\_for\_only\_loggedin\_posts'] ) ) { |
  |  | 441 | $unrestricted\_post = array(); |
  |  | 442 | update\_option( 'papr\_login\_unrestricted\_posts', $unrestricted\_post ); |
  |  | 443 | update\_option( 'papr\_access\_for\_only\_loggedin\_posts', 1 ); |
  |  | 444 | } else { |
  |  | 445 | $allowed\_redirect\_post = array(); |
  |  | 446 | update\_option( 'papr\_allowed\_redirect\_for\_posts', $allowed\_redirect\_post ); |
  |  | 447 | update\_option( 'papr\_access\_for\_only\_loggedin\_posts', 0 ); |
  |  | 448 | } |
  |  | 449 | update\_option( 'papr\_message', 'Configuration saved Successfully' ); |
  |  | 450 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 451 | return; |
  |  | 452 | } |
  |  | 453 |  |
  |  | 454 | if ( papr\_check\_option\_admin\_referer( 'papr\_post\_per\_page' ) ) { |
  |  | 455 | $results\_per\_page = sanitize\_text\_field( $\_POST['papr\_post\_per\_page'] ); |
  |  | 456 | update\_option( 'papr\_post\_per\_page', $results\_per\_page ); |
  |  | 457 |  |
  |  | 458 | return; |
  |  | 459 | } |
  |  | 460 |  |
  |  | 461 | if ( papr\_check\_option\_admin\_referer( 'papr\_category\_per\_page' ) ) { |
  |  | 462 | $results\_per\_page = sanitize\_text\_field( $\_POST['papr\_category\_per\_page'] ); |
  |  | 463 | update\_option( 'papr\_category\_per\_page', $results\_per\_page ); |
  |  | 464 |  |
  |  | 465 | return; |
  |  | 466 | } |
  |  | 467 |  |
  |  | 468 | if ( papr\_check\_option\_admin\_referer( 'papr\_tag\_per\_page' ) ) { |
  |  | 469 | $results\_per\_page = sanitize\_text\_field( $\_POST['papr\_tag\_per\_page'] ); |
  |  | 470 | update\_option( 'papr\_tag\_per\_page', $results\_per\_page ); |
  |  | 471 |  |
  |  | 472 | return; |
  |  | 473 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_contact\_us\_query\_option' ) ) { |
  |  | 474 |  |
  |  | 475 | if ( ! papr\_is\_curl\_installed() ) { |
  |  | 476 | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Query submit failed.' ); |
  |  | 477 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 478 | return; |
  |  | 479 | } |
  |  | 480 |  |
  |  | 481 | // Contact Us query |
  |  | 482 | $email = sanitize\_email( $\_POST['papr\_contact\_us\_email'] ); |
  |  | 483 | $phone = htmlspecialchars( $\_POST['papr\_contact\_us\_phone'] ); |
  |  | 484 | $query = htmlspecialchars( $\_POST['papr\_contact\_us\_query'] ); |
  |  | 485 |  |
  |  | 486 | $customer = new Customer\_page\_restriction(); |
  |  | 487 | if ( papr\_check\_empty\_or\_null( $email ) || papr\_check\_empty\_or\_null( $query ) ) { |
  |  | 488 | update\_option( 'papr\_message', 'Please fill up Email and Query fields to submit your query.' ); |
  |  | 489 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 490 | } elseif ( ! filter\_var( $email, FILTER\_VALIDATE\_EMAIL ) ) { |
  |  | 491 | update\_option( 'papr\_message', 'Please enter a valid email address.' ); |
  |  | 492 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 493 | } else { |
  |  | 494 | $submited = $customer->papr\_submit\_contact\_us( $email, $phone, $query ); |
  |  | 495 | if ( ! is\_null( $submited ) ) { |
  |  | 496 | if ( $submited == false ) { |
  |  | 497 | update\_option( 'papr\_message', 'Your query could not be submitted. Please try again.' ); |
  |  | 498 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 499 | } else { |
  |  | 500 | update\_option( 'papr\_message', 'Thanks for getting in touch! We shall get back to you shortly.' ); |
  |  | 501 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 502 | } |
  |  | 503 | } |
  |  | 504 | } |
  |  | 505 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_change\_miniorange' ) ) { |
  |  | 506 | papr\_remove\_account(); |
  |  | 507 | update\_option( 'papr\_guest\_enabled', true ); |
  |  | 508 | return; |
  |  | 509 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_go\_back' ) ) { |
  |  | 510 | update\_option( 'papr\_registration\_status', '' ); |
  |  | 511 | update\_option( 'papr\_verify\_customer', '' ); |
  |  | 512 | delete\_option( 'papr\_new\_registration' ); |
  |  | 513 | delete\_option( 'papr\_admin\_email' ); |
  |  | 514 | delete\_option( 'papr\_admin\_phone' ); |
  |  | 515 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_goto\_login' ) ) { |
  |  | 516 | delete\_option( 'papr\_new\_registration' ); |
  |  | 517 | update\_option( 'papr\_verify\_customer', 'true' ); |
  |  | 518 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_forgot\_password\_form\_option' ) ) { |
  |  | 519 | if ( ! papr\_is\_curl\_installed() ) { |
  |  | 520 | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Resend OTP failed.' ); |
  |  | 521 | papr\_show\_error\_message(); |
  |  | 522 | return; |
  |  | 523 | } |
  |  | 524 |  |
  |  | 525 | $email    = get\_option( 'papr\_admin\_email' ); |
  |  | 526 | $customer = new Customer\_page\_restriction(); |
  |  | 527 | $content  = json\_decode( $customer->papr\_forgot\_password( $email ), true ); |
  |  | 528 | if ( ! is\_null( $content ) ) { |
  |  | 529 | if ( strcasecmp( $content['status'], 'SUCCESS' ) == 0 ) { |
  |  | 530 | update\_option( 'papr\_message', 'Your password has been reset successfully. Please enter the new password sent to ' . $email . '.' ); |
  |  | 531 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 532 | } else { |
  |  | 533 | update\_option( 'papr\_message', 'An error occured while processing your request. Please Try again.' ); |
  |  | 534 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 535 | } |
  |  | 536 | } |
  |  | 537 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_verify\_customer' ) ) {    // register the admin to miniOrange |
  |  | 538 | if ( ! papr\_is\_curl\_installed() ) { |
  |  | 539 | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Login failed.' ); |
  |  | 540 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 541 | return; |
  |  | 542 | } |
  |  | 543 |  |
  |  | 544 | $email    = ''; |
  |  | 545 | $password = ''; |
  |  | 546 | if ( papr\_check\_empty\_or\_null( $\_POST['email'] ) || papr\_check\_empty\_or\_null( $\_POST['password'] ) ) { |
  |  | 547 | update\_option( 'papr\_message', 'All the fields are required. Please enter valid entries.' ); |
  |  | 548 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 549 | return; |
  |  | 550 | } elseif ( papr\_check\_password\_pattern( htmlspecialchars( $\_POST['password'] ) ) ) { |
  |  | 551 | update\_option( 'papr\_message', 'Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*-\_) should be present.' ); |
  |  | 552 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 553 | return; |
  |  | 554 | } else { |
  |  | 555 | $email    = sanitize\_email( $\_POST['email'] ); |
  |  | 556 | $password = stripslashes( htmlspecialchars( $\_POST['password'] ) ); |
  |  | 557 | } |
  |  | 558 |  |
  |  | 559 | update\_option( 'papr\_admin\_email', $email ); |
  |  | 560 | update\_option( 'papr\_admin\_password', $password ); |
  |  | 561 | $customer = new Customer\_page\_restriction(); |
  |  | 562 | $content  = $customer->papr\_get\_customer\_key(); |
  |  | 563 |  |
  |  | 564 | if ( ! is\_null( $content ) ) { |
  |  | 565 | $customerKey = json\_decode( $content, true ); |
  |  | 566 | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  |  | 567 | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  |  | 568 | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  |  | 569 | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  |  | 570 | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  |  | 571 | update\_option( 'papr\_admin\_password', '' ); |
  |  | 572 | update\_option( 'papr\_message', 'Customer retrieved successfully' ); |
  |  | 573 | update\_option( 'papr\_registration\_status', 'Existing User' ); |
  |  | 574 | delete\_option( 'papr\_verify\_customer' ); |
  |  | 575 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 576 | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  |  | 577 | exit; |
  |  | 578 | } else { |
  |  | 579 | update\_option( 'papr\_message', 'Invalid username or password. Please try again.' ); |
  |  | 580 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 581 | } |
  |  | 582 | update\_option( 'papr\_admin\_password', '' ); |
  |  | 583 | } |
  |  | 584 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_register\_customer' ) ) { |
  |  | 585 | $user = wp\_get\_current\_user(); |
  |  | 586 | if ( ! papr\_is\_curl\_installed() ) { |
  |  | 587 | update\_option( 'papr\_message', 'ERROR: <a href="http://php.net/manual/en/curl.installation.php" target="\_blank">PHP cURL extension</a> is not installed or disabled. Registration failed.' ); |
  |  | 588 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 589 | return; |
  |  | 590 | } |
  |  | 591 |  |
  |  | 592 | $email           = ''; |
  |  | 593 | $password        = ''; |
  |  | 594 | $confirmPassword = ''; |
  |  | 595 |  |
  |  | 596 | if ( papr\_check\_empty\_or\_null( $\_POST['email'] ) || papr\_check\_empty\_or\_null( $\_POST['password'] ) || papr\_check\_empty\_or\_null( $\_POST['confirmPassword'] ) ) { |
  |  | 597 | update\_option( 'papr\_message', 'Please enter the required fields.' ); |
  |  | 598 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 599 | return; |
  |  | 600 | } elseif ( ! filter\_var( $\_POST['email'], FILTER\_VALIDATE\_EMAIL ) ) { |
  |  | 601 | update\_option( 'papr\_message', 'Please enter a valid email address.' ); |
  |  | 602 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 603 | return; |
  |  | 604 | } elseif ( papr\_check\_password\_pattern( htmlspecialchars( $\_POST['password'] ) ) ) { |
  |  | 605 | update\_option( 'papr\_message', 'Minimum 6 characters should be present. Maximum 15 characters should be present. Only following symbols (!@#.$%^&\*-\_) should be present.' ); |
  |  | 606 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 607 | return; |
  |  | 608 | } else { |
  |  | 609 | $email           = sanitize\_email( $\_POST['email'] ); |
  |  | 610 | $password        = stripslashes( htmlspecialchars( $\_POST['password'] ) ); |
  |  | 611 | $confirmPassword = stripslashes( htmlspecialchars( $\_POST['confirmPassword'] ) ); |
  |  | 612 | } |
  |  | 613 | update\_option( 'papr\_admin\_email', $email ); |
  |  | 614 |  |
  |  | 615 | if ( strcmp( $password, $confirmPassword ) == 0 ) { |
  |  | 616 | update\_option( 'papr\_admin\_password', $password ); |
  |  | 617 | $email    = get\_option( 'papr\_admin\_email' ); |
  |  | 618 | $customer = new Customer\_page\_restriction(); |
  |  | 619 | $content  = json\_decode( $customer->papr\_check\_customer(), true ); |
  |  | 620 | if ( ! is\_null( $content ) ) { |
  |  | 621 | if ( strcasecmp( $content['status'], 'CUSTOMER\_NOT\_FOUND' ) == 0 ) { |
  |  | 622 | $response = papr\_create\_customer(); |
  |  | 623 | if ( is\_array( $response ) && ! empty( $response['status'] ) && $response['status'] == 'success' ) { |
  |  | 624 | update\_option( 'papr\_message', 'Customer created successfully.' ); |
  |  | 625 | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  |  | 626 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 627 | exit; |
  |  | 628 | } else { |
  |  | 629 | update\_option( 'papr\_message', 'This is not a valid email. Please enter a valid email.' ); |
  |  | 630 | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  |  | 631 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 632 | exit; |
  |  | 633 | } |
  |  | 634 | } elseif ( strcasecmp( $content['status'], 'INVALID\_EMAIL' ) == 0 ) { |
  |  | 635 | update\_option( 'papr\_message', 'This is not a valid email. Please enter a valid email.' ); |
  |  | 636 | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  |  | 637 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 638 | exit; |
  |  | 639 | } else { |
  |  | 640 | $response = papr\_get\_current\_customer(); |
  |  | 641 | if ( is\_array( $response ) && ! empty( $response['status'] ) && $response['status'] == 'success' ) { |
  |  | 642 | update\_option( 'papr\_message', 'Customer Retrieved Successfully.' ); |
  |  | 643 | wp\_redirect( admin\_url( '/admin.php?page=page\_restriction&tab=account\_setup' ), 301 ); |
  |  | 644 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 645 | exit; |
  |  | 646 | } |
  |  | 647 | } |
  |  | 648 | } |
  |  | 649 | } else { |
  |  | 650 | update\_option( 'papr\_message', 'Passwords do not match.' ); |
  |  | 651 | delete\_option( 'papr\_verify\_customer' ); |
  |  | 652 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 653 | } |
  |  | 654 | return; |
  |  | 655 | } elseif ( papr\_check\_option\_admin\_referer( 'papr\_skip\_feedback' ) ) { |
  |  | 656 | update\_option( 'papr\_message', 'Plugin deactivated successfully' ); |
  |  | 657 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 658 | deactivate\_plugins( 'page-and-post-restriction\page-and-post-restriction.php' ); |
  |  | 659 | wp\_redirect( 'plugins.php' ); |
  |  | 660 | } |
  |  | 661 |  |
  |  | 662 | if ( papr\_check\_option\_admin\_referer( 'papr\_feedback' ) ) { |
  |  | 663 | $user                      = wp\_get\_current\_user(); |
  |  | 664 | $message                   = 'Plugin Deactivated'; |
  |  | 665 | $deactivate\_reason\_message = array\_key\_exists( 'papr\_query\_feedback', $\_POST ) ? htmlspecialchars( $\_POST['papr\_query\_feedback'] ) : false; |
  |  | 666 | $message                  .= ', Feedback : ' . $deactivate\_reason\_message . ''; |
  |  | 667 | $reason                    = ''; |
  |  | 668 | if ( isset( $\_POST['papr\_reason'] ) ) { |
  |  | 669 | $reason = htmlspecialchars( $\_POST['papr\_reason'] ); |
  |  | 670 | } |
  |  | 671 |  |
  |  | 672 | $email    = ''; |
  |  | 673 | $message .= ', [Reason :' . $reason . ']'; |
  |  | 674 | if ( isset( $\_POST['papr\_query\_mail'] ) ) { |
  |  | 675 | $email = sanitize\_email( $\_POST['papr\_query\_mail'] ); |
  |  | 676 | } |
  |  | 677 | if ( ! filter\_var( $email, FILTER\_VALIDATE\_EMAIL ) ) { |
  |  | 678 | $email = get\_option( 'papr\_admin\_email' ); |
  |  | 679 | if ( empty( $email ) ) { |
  |  | 680 | $email = $user->user\_email; |
  |  | 681 | } |
  |  | 682 | } |
  |  | 683 | $phone            = get\_option( 'papr\_admin\_phone' ); |
  |  | 684 | $feedback\_reasons = new Customer\_page\_restriction(); |
  |  | 685 | if ( ! is\_null( $feedback\_reasons ) ) { |
  |  | 686 | if ( ! papr\_is\_curl\_installed() ) { |
  |  | 687 | deactivate\_plugins( 'page-and-post-restriction\page-and-post-restriction.php' ); |
  |  | 688 | wp\_redirect( 'plugins.php' ); |
  |  | 689 | } else { |
  |  | 690 | $submited = json\_decode( $feedback\_reasons->papr\_send\_email\_alert( $email, $phone, $message ), true ); |
  |  | 691 |  |
  |  | 692 | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  |  | 693 | if ( is\_array( $submited ) && ! empty( $submited['status'] ) && $submited['status'] == 'ERROR' ) { |
  |  | 694 | update\_option( 'papr\_message', $submited['message'] ); |
  |  | 695 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 696 | } else { |
  |  | 697 | if ( $submited == false ) { |
  |  | 698 | update\_option( 'papr\_message', 'Error while submitting the query.' ); |
  |  | 699 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 700 | } |
  |  | 701 | } |
  |  | 702 | } |
  |  | 703 |  |
  |  | 704 | deactivate\_plugins( 'page-and-post-restriction\page-and-post-restriction.php' ); |
  |  | 705 | wp\_redirect( 'plugins.php' ); |
  |  | 706 | update\_option( 'papr\_message', 'Thank you for the feedback.' ); |
  |  | 707 | update\_option( 'papr\_message\_success\_fail', 'success' ); |
  |  | 708 | } |
  |  | 709 | } |
  |  | 710 | } |
  | 743 | 711 | } |
  | 744 | 712 |  |
  | 745 | 713 | function papr\_check\_empty\_or\_null( $value ) { |
  | 746 |  | if ( ! isset( $value ) || empty( $value ) ) { |
  | 747 |  | return true; |
  | 748 |  | } |
  | 749 |  | return false; |
  |  | 714 | if ( ! isset( $value ) || empty( $value ) ) { |
  |  | 715 | return true; |
  |  | 716 | } |
  |  | 717 | return false; |
  | 750 | 718 | } |
  | 751 | 719 |  |
  | 752 |  | function papr\_is\_curl\_installed() { |
  | 753 |  | if ( papr\_in\_array( 'curl', get\_loaded\_extensions() ) ) { |
  | 754 |  | return 1; |
  | 755 |  | } |
  | 756 |  | else { |
  | 757 |  | return 0; |
  | 758 |  | } |
  |  | 720 | function papr\_is\_curl\_installed() { |
  |  | 721 | if ( papr\_in\_array( 'curl', get\_loaded\_extensions() ) ) { |
  |  | 722 | return 1; |
  |  | 723 | } else { |
  |  | 724 | return 0; |
  |  | 725 | } |
  | 759 | 726 | } |
  | 760 | 727 |  |
  | 761 | 728 | function papr\_remove\_account() { |
  | 762 |  | ~~//~~delete all customer related key-value pairs |
  | 763 |  | ~~delete\_option('papr\_host\_name'~~); |
  | 764 |  | ~~delete\_option('papr\_new\_registration'~~); |
  | 765 |  | ~~delete\_option('papr\_admin\_phone'~~); |
  | 766 |  | ~~delete\_option('papr\_admin\_password'~~); |
  | 767 |  | ~~delete\_option('papr\_verify\_customer'~~); |
  | 768 |  | ~~delete\_option('papr\_admin\_customer\_key'~~); |
  | 769 |  | ~~delete\_option('papr\_admin\_api\_key'~~); |
  | 770 |  | ~~delete\_option('papr\_customer\_token'~~); |
  | 771 |  | ~~delete\_option('papr\_admin\_email'~~); |
  | 772 |  | ~~delete\_option('papr\_message'~~); |
  | 773 |  | ~~delete\_option('papr\_registration\_status'~~); |
  | 774 |  | ~~delete\_option('papr\_proxy\_host'~~); |
  | 775 |  | ~~delete\_option('papr\_proxy\_username'~~); |
  | 776 |  | ~~delete\_option('papr\_proxy\_port'~~); |
  | 777 |  | ~~delete\_option('papr\_proxy\_password'~~); |
  |  | 729 | // delete all customer related key-value pairs |
  |  | 730 | delete\_option( 'papr\_host\_name' ); |
  |  | 731 | delete\_option( 'papr\_new\_registration' ); |
  |  | 732 | delete\_option( 'papr\_admin\_phone' ); |
  |  | 733 | delete\_option( 'papr\_admin\_password' ); |
  |  | 734 | delete\_option( 'papr\_verify\_customer' ); |
  |  | 735 | delete\_option( 'papr\_admin\_customer\_key' ); |
  |  | 736 | delete\_option( 'papr\_admin\_api\_key' ); |
  |  | 737 | delete\_option( 'papr\_customer\_token' ); |
  |  | 738 | delete\_option( 'papr\_admin\_email' ); |
  |  | 739 | delete\_option( 'papr\_message' ); |
  |  | 740 | delete\_option( 'papr\_registration\_status' ); |
  |  | 741 | delete\_option( 'papr\_proxy\_host' ); |
  |  | 742 | delete\_option( 'papr\_proxy\_username' ); |
  |  | 743 | delete\_option( 'papr\_proxy\_port' ); |
  |  | 744 | delete\_option( 'papr\_proxy\_password' ); |
  | 778 | 745 | } |
  | 779 | 746 |  |
  | 780 |  | function papr\_check\_password\_pattern(~~$password)~~{ |
  | 781 |  | $pattern = '/^[(\w)\*(\!\@\#\$\%\^\&\\*\.\-\\_)\*]+$/'; |
  | 782 |  | ~~return !preg\_match($pattern,$password~~); |
  |  | 747 | function papr\_check\_password\_pattern( $password ) { |
  |  | 748 | $pattern = '/^[(\w)\*(\!\@\#\$\%\^\&\\*\.\-\\_)\*]+$/'; |
  |  | 749 | return ! preg\_match( $pattern, $password ); |
  | 783 | 750 | } |
  | 784 | 751 |  |
  | 785 | 752 | function papr\_get\_current\_customer() { |
  | 786 |  | $customer    = new Customer\_page\_restriction(); |
  | 787 |  | $content     = $customer->papr\_get\_customer\_key(); |
  | 788 |  | if(!is\_null($content)){ |
  | 789 |  | $customerKey = json\_decode( $content, true ); |
  | 790 |  | $response = array(); |
  | 791 |  | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  | 792 |  | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  | 793 |  | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  | 794 |  | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  | 795 |  | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  | 796 |  | update\_option( 'papr\_admin\_password', '' ); |
  | 797 |  | delete\_option( 'papr\_verify\_customer' ); |
  | 798 |  | delete\_option( 'papr\_new\_registration' ); |
  | 799 |  | $response['status'] = "success"; |
  | 800 |  | return $response; |
  | 801 |  | } |
  | 802 |  | else { |
  | 803 |  | update\_option( 'papr\_message', 'You already have an account with miniOrange. Please enter a valid password.' ); |
  | 804 |  | update\_option('papr\_message\_success\_fail','error'); |
  | 805 |  | $response['status'] = "error"; |
  | 806 |  | return $response; |
  | 807 |  | } |
  | 808 |  | } |
  |  | 753 | $customer = new Customer\_page\_restriction(); |
  |  | 754 | $content  = $customer->papr\_get\_customer\_key(); |
  |  | 755 | if ( ! is\_null( $content ) ) { |
  |  | 756 | $customerKey = json\_decode( $content, true ); |
  |  | 757 | $response    = array(); |
  |  | 758 | if ( json\_last\_error() == JSON\_ERROR\_NONE ) { |
  |  | 759 | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  |  | 760 | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  |  | 761 | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  |  | 762 | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  |  | 763 | update\_option( 'papr\_admin\_password', '' ); |
  |  | 764 | delete\_option( 'papr\_verify\_customer' ); |
  |  | 765 | delete\_option( 'papr\_new\_registration' ); |
  |  | 766 | $response['status'] = 'success'; |
  |  | 767 | return $response; |
  |  | 768 | } else { |
  |  | 769 | update\_option( 'papr\_message', 'You already have an account with miniOrange. Please enter a valid password.' ); |
  |  | 770 | update\_option( 'papr\_message\_success\_fail', 'error' ); |
  |  | 771 | $response['status'] = 'error'; |
  |  | 772 | return $response; |
  |  | 773 | } |
  |  | 774 | } |
  | 809 | 775 | } |
  | 810 | 776 |  |
  | 811 | 777 | function papr\_create\_customer() { |
  | 812 |  | $customer    = new Customer\_page\_restriction(); |
  | 813 |  | $customerKey = json\_decode( $customer->papr\_create\_customer(), true ); |
  | 814 |  | if(!is\_null($customerKey)){ |
  | 815 |  | $response = array(); |
  | 816 |  | if ( strcasecmp( $customerKey['status'], 'CUSTOMER\_USERNAME\_ALREADY\_EXISTS' ) == 0 ) { |
  | 817 |  | $api\_response = papr\_get\_current\_customer(); |
  | 818 |  | if($api\_response){ |
  | 819 |  | $response['status'] = "success"; |
  | 820 |  | } |
  | 821 |  | else |
  | 822 |  | $response['status'] = "error"; |
  | 823 |  | } |
  | 824 |  | else if ( strcasecmp( $customerKey['status'], 'SUCCESS' ) == 0 ) { |
  | 825 |  | if(isset($customerKey['id'])){ |
  | 826 |  | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  | 827 |  | } |
  | 828 |  | if(isset($customerKey['apiKey'])){ |
  | 829 |  | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  | 830 |  | } |
  | 831 |  | if(isset($customerKey['token'])){ |
  | 832 |  | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  | 833 |  | } |
  | 834 |  | if(isset($customerKey['phone'])){ |
  | 835 |  | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  | 836 |  | } |
  | 837 |  | update\_option( 'papr\_admin\_password', '' ); |
  | 838 |  | update\_option( 'papr\_message', 'Thank you for registering with miniOrange.' ); |
  | 839 |  | update\_option( 'papr\_registration\_status', '' ); |
  | 840 |  | delete\_option( 'papr\_verify\_customer' ); |
  | 841 |  | delete\_option( 'papr\_new\_registration' ); |
  | 842 |  | $response['status']="success"; |
  | 843 |  | return $response; |
  | 844 |  | } |
  | 845 |  | update\_option( 'papr\_admin\_password', '' ); |
  | 846 |  | return $response; |
  | 847 |  | } |
  |  | 778 | $customer    = new Customer\_page\_restriction(); |
  |  | 779 | $customerKey = json\_decode( $customer->papr\_create\_customer(), true ); |
  |  | 780 | if ( ! is\_null( $customerKey ) ) { |
  |  | 781 | $response = array(); |
  |  | 782 | if ( strcasecmp( $customerKey['status'], 'CUSTOMER\_USERNAME\_ALREADY\_EXISTS' ) == 0 ) { |
  |  | 783 | $api\_response = papr\_get\_current\_customer(); |
  |  | 784 | if ( $api\_response ) { |
  |  | 785 | $response['status'] = 'success'; |
  |  | 786 | } else { |
  |  | 787 | $response['status'] = 'error'; |
  |  | 788 | } |
  |  | 789 | } elseif ( strcasecmp( $customerKey['status'], 'SUCCESS' ) == 0 ) { |
  |  | 790 | if ( isset( $customerKey['id'] ) ) { |
  |  | 791 | update\_option( 'papr\_admin\_customer\_key', $customerKey['id'] ); |
  |  | 792 | } |
  |  | 793 | if ( isset( $customerKey['apiKey'] ) ) { |
  |  | 794 | update\_option( 'papr\_admin\_api\_key', $customerKey['apiKey'] ); |
  |  | 795 | } |
  |  | 796 | if ( isset( $customerKey['token'] ) ) { |
  |  | 797 | update\_option( 'papr\_customer\_token', $customerKey['token'] ); |
  |  | 798 | } |
  |  | 799 | if ( isset( $customerKey['phone'] ) ) { |
  |  | 800 | update\_option( 'papr\_admin\_phone', $customerKey['phone'] ); |
  |  | 801 | } |
  |  | 802 | update\_option( 'papr\_admin\_password', '' ); |
  |  | 803 | update\_option( 'papr\_message', 'Thank you for registering with miniOrange.' ); |
  |  | 804 | update\_option( 'papr\_registration\_status', '' ); |
  |  | 805 | delete\_option( 'papr\_verify\_customer' ); |
  |  | 806 | delete\_option( 'papr\_new\_registration' ); |
  |  | 807 | $response['status'] = 'success'; |
  |  | 808 | return $response; |
  |  | 809 | } |
  |  | 810 | update\_option( 'papr\_admin\_password', '' ); |
  |  | 811 | return $response; |
  |  | 812 | } |
  | 848 | 813 | } |
  | 849 |  | ~~?>~~ |
* ## [page-and-post-restriction/trunk/page-restriction-tag-access.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-tag-access.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-tag-access.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-tag-access.php?rev=2829798#L4 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-tag-access.php?rev=3034414#L4 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | require\_once 'page-restriction-page-access.php'; |
  | 5 | 5 |  |
  | 6 |  | function papr\_tag\_access() |
  | 7 |  | { |
  | 8 |  | $results\_per\_page = get\_option('papr\_tag\_per\_page'); |
  |  | 6 | function papr\_tag\_access() { |
  |  | 7 | $results\_per\_page = get\_option( 'papr\_tag\_per\_page' ); |
  | 9 | 8 |  |
  | 10 | 9 | $results\_per\_page = $results\_per\_page != '' ? $results\_per\_page : 10; |
  | 11 |  |  |
  | 12 |  | ?> |
  |  | 10 |  |
  |  | 11 | ?> |
  | 13 | 12 | <div class="rounded bg-white papr-shadow p-4 mt-4 ms-4"> |
  | 14 | 13 | <div> |
  | 15 | 14 | <h4 class="papr-form-head">Give Access to Tags based on Roles and Login Status</h4> |
  | 16 |  | <div class="papr-prem-info"> |
  | 17 |  | <div class="papr-prem-icn papr-prem-cat-icn"><img src="https://img.icons8.com/color/48/000000/lock--v2.png" width="35px"> |
  | 18 |  | ~~<p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url(admin\_url('admin.php?page=page\_restriction&tab=premium\_plan'))~~ ?>" class="text-warning">Click here to upgrade</a></p> |
  | 19 |  | </div> |
  | 20 |  | <h5 class="papr-form-head papr-form-head-bar mt-2 mb-4">Tag Restrictions |
  | 21 |  | <div class="papr-info-global ms-2"> |
  | 22 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 23 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 24 |  | </svg> |
  | 25 |  | <p class="papr-info-text-global"> |
  | 26 |  | Specify which tags would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the tag in the table below. |
  | 27 |  | </p> |
  | 28 |  | </div> |
  | 29 |  | </h5> |
  | 30 |  | <div class="mb-4"> <b>Note:</b> All the posts under a restricted tag would also be restricted.</div> |
  |  | 15 | <div class="papr-prem-info"> |
  |  | 16 | <div class="papr-prem-icn papr-prem-cat-icn"><img src="https://img.icons8.com/color/48/000000/lock--v2.png" width="35px"> |
  |  | 17 | <p class="papr-prem-info-text">Available in <b>Paid</b> versions of the plugin. <a href="<?php echo esc\_url( admin\_url( 'admin.php?page=page\_restriction&tab=premium\_plan' ) ); ?>" class="text-warning">Click here to upgrade</a></p> |
  |  | 18 | </div> |
  |  | 19 | <h5 class="papr-form-head papr-form-head-bar mt-2 mb-4">Tag Restrictions |
  |  | 20 | <div class="papr-info-global ms-2"> |
  |  | 21 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 22 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 23 | </svg> |
  |  | 24 | <p class="papr-info-text-global"> |
  |  | 25 | Specify which tags would be <b>accessible to only Logged In users</b> OR which <b>user roles should be able to access</b> the tag in the table below. |
  |  | 26 | </p> |
  |  | 27 | </div> |
  |  | 28 | </h5> |
  |  | 29 | <div class="mb-4"> <b>Note:</b> All the posts under a restricted tag would also be restricted.</div> |
  | 31 | 30 |  |
  | 32 |  | ~~<?php papr\_dropdown($results\_per\_page, 'tag'~~); ?> |
  |  | 31 | <?php papr\_dropdown( $results\_per\_page, 'tag' ); ?> |
  | 33 | 32 |  |
  | 34 |  | <div class="tablenav top mt-3"> |
  | 35 |  | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" disabled> |
  | 36 |  | <?php |
  | 37 |  | ~~$tags = get\_tags(array("hide\_empty" => 0)~~); |
  | 38 |  | ~~$total\_tag = count($tags~~); |
  | 39 |  | ~~$number\_of\_pages\_in\_pagination = ceil($total\_tag / $results\_per\_page~~); |
  |  | 33 | <div class="tablenav top mt-3"> |
  |  | 34 | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" disabled> |
  |  | 35 | <?php |
  |  | 36 | $tags                          = get\_tags( array( 'hide\_empty' => 0 ) ); |
  |  | 37 | $total\_tag                     = count( $tags ); |
  |  | 38 | $number\_of\_pages\_in\_pagination = ceil( $total\_tag / $results\_per\_page ); |
  | 40 | 39 |  |
  | 41 |  | ~~$current\_page = papr\_get\_current\_page($number\_of\_pages\_in\_pagination~~); |
  |  | 40 | $current\_page = papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ); |
  | 42 | 41 |  |
  | 43 |  | $offset = ($results\_per\_page \* $current\_page) - $results\_per\_page; |
  | 44 |  | $tags = get\_tags(array( |
  | 45 |  | "hide\_empty" => 0, |
  | 46 |  | "type"      => "post", |
  | 47 |  | "orderby"   => "name", |
  | 48 |  | "order"     => "ASC", |
  | 49 |  | 'number' => $results\_per\_page, |
  | 50 |  | 'offset' => $offset |
  | 51 |  | )); |
  |  | 42 | $offset = ( $results\_per\_page \* $current\_page ) - $results\_per\_page; |
  |  | 43 | $tags   = get\_tags( |
  |  | 44 | array( |
  |  | 45 | 'hide\_empty' => 0, |
  |  | 46 | 'type'       => 'post', |
  |  | 47 | 'orderby'    => 'name', |
  |  | 48 | 'order'      => 'ASC', |
  |  | 49 | 'number'     => $results\_per\_page, |
  |  | 50 | 'offset'     => $offset, |
  |  | 51 | ) |
  |  | 52 | ); |
  | 52 | 53 |  |
  | 53 |  | $link = 'admin.php?page=page\_restriction&tab=tag\_access&curr='; |
  | 54 |  | ~~papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_tag, $current\_page, $link, 'top'~~); |
  | 55 |  | ?> |
  | 56 |  | </div> |
  |  | 54 | $link = 'admin.php?page=page\_restriction&tab=tag\_access&curr='; |
  |  | 55 | papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_tag, $current\_page, $link, 'top' ); |
  |  | 56 | ?> |
  |  | 57 | </div> |
  | 57 | 58 |  |
  | 58 |  | <table id="reports\_table" class="wp-list-table widefat fixed striped table-view-list pages"> |
  | 59 |  | <thead><?php papr\_display\_head\_foot\_of\_table('tag'); ?><thead> |
  | 60 |  | <tbody class="w-100"> |
  | 61 |  | <?php |
  | 62 |  | foreach ($tags as $tag) { |
  | 63 |  | papr\_tag\_display\_pages($tag); |
  | 64 |  | } ?> |
  | 65 |  | </tbody> |
  | 66 |  | <tfoot> |
  | 67 |  | <?php papr\_display\_head\_foot\_of\_table('tag'); ?> |
  | 68 |  | </tfoot> |
  | 69 |  | </table> |
  | 70 |  | <div class="tablenav bottom mt-4"> |
  | 71 |  | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform" disabled> |
  | 72 |  | <?php papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_tag, $current\_page, $link, 'bottom'); ?> |
  | 73 |  | </div> |
  | 74 |  | </div> |
  |  | 59 | <table id="reports\_table" class="wp-list-table widefat fixed striped table-view-list pages"> |
  |  | 60 | <thead><?php papr\_display\_head\_foot\_of\_table( 'tag' ); ?><thead> |
  |  | 61 | <tbody class="w-100"> |
  |  | 62 | <?php |
  |  | 63 | foreach ( $tags as $tag ) { |
  |  | 64 | papr\_tag\_display\_pages( $tag ); |
  |  | 65 | } |
  |  | 66 | ?> |
  |  | 67 | </tbody> |
  |  | 68 | <tfoot> |
  |  | 69 | <?php papr\_display\_head\_foot\_of\_table( 'tag' ); ?> |
  |  | 70 | </tfoot> |
  |  | 71 | </table> |
  |  | 72 | <div class="tablenav bottom mt-4"> |
  |  | 73 | <input type="submit" class="btn papr-btn-cstm rounded" value="Save Configuration" form="blockedpagesform" disabled> |
  |  | 74 | <?php papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_tag, $current\_page, $link, 'bottom' ); ?> |
  |  | 75 | </div> |
  |  | 76 | </div> |
  | 75 | 77 | </div> |
  | 76 | 78 | </div> |
  | 77 |  | <script> |
  | 78 |  | var tag\_selector\_up = document.getElementById("current-page-selector"); |
  | 79 |  | var tag\_selector\_down = document.getElementById("current-page-selector-1"); |
  | 80 |  | var link = 'admin.php?page=page\_restriction&tab=tag\_access&curr='; |
  |  | 79 | <script> |
  |  | 80 | var tag\_selector\_up = document.getElementById("current-page-selector"); |
  |  | 81 | var tag\_selector\_down = document.getElementById("current-page-selector-1"); |
  |  | 82 | var link = 'admin.php?page=page\_restriction&tab=tag\_access&curr='; |
  | 81 | 83 |  |
  | 82 |  | tag\_selector\_up.addEventListener("keyup", function(event) { |
  | 83 |  | if (event.keyCode === 13) { |
  | 84 |  | tag\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  | 85 |  | var page\_link = link.concat(tag\_selector\_up\_value); |
  | 86 |  | window.open(page\_link, "\_self"); |
  | 87 |  | } |
  | 88 |  | }); |
  |  | 84 | tag\_selector\_up.addEventListener("keyup", function(event) { |
  |  | 85 | if (event.keyCode === 13) { |
  |  | 86 | tag\_selector\_up\_value = document.getElementById("current-page-selector").value; |
  |  | 87 | var page\_link = link.concat(tag\_selector\_up\_value); |
  |  | 88 | window.open(page\_link, "\_self"); |
  |  | 89 | } |
  |  | 90 | }); |
  | 89 | 91 |  |
  | 90 |  | tag\_selector\_down.addEventListener("keyup", function(event) { |
  | 91 |  | if (event.keyCode === 13) { |
  | 92 |  | tag\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  | 93 |  | var page\_link = link.concat(tag\_selector\_down\_value); |
  | 94 |  | window.open(page\_link, "\_self"); |
  | 95 |  | } |
  | 96 |  | }); |
  | 97 |  | </script> |
  | 98 |  | <?php |
  |  | 92 | tag\_selector\_down.addEventListener("keyup", function(event) { |
  |  | 93 | if (event.keyCode === 13) { |
  |  | 94 | tag\_selector\_down\_value = document.getElementById("current-page-selector-1").value; |
  |  | 95 | var page\_link = link.concat(tag\_selector\_down\_value); |
  |  | 96 | window.open(page\_link, "\_self"); |
  |  | 97 | } |
  |  | 98 | }); |
  |  | 99 | </script> |
  |  | 100 | <?php |
  | 99 | 101 | } |
  | 100 | 102 |  |
  | 101 |  | function papr\_tag\_display\_pages(~~$tag~~) { |
  | 102 |  | ?> |
  | 103 |  | <tr id="<?php echo esc\_attr(~~$tag->term\_id)~~ ?>"> |
  |  | 103 | function papr\_tag\_display\_pages( $tag ) { |
  |  | 104 | ?> |
  |  | 105 | <tr id="<?php echo esc\_attr( $tag->term\_id ); ?>"> |
  | 104 | 106 | <td> |
  | 105 |  | <a href="<?php echo esc\_url(~~get\_tag\_link($tag))~~ ?>" target="\_blank"> |
  | 106 |  | ~~<?php echo esc\_html($tag->name)~~ ?> |
  | 107 |  | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 107 | <a href="<?php echo esc\_url( get\_tag\_link( $tag ) ); ?>" target="\_blank"> |
  |  | 108 | <?php echo esc\_html( $tag->name ); ?> |
  |  | 109 | <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 108 | 110 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 109 | 111 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | 110 | 112 | </svg> |
  | 111 |  | </a> |
  |  | 113 | </a> |
  | 112 | 114 | </td> |
  | 113 |  | <td> |
  | 114 |  | <input class="w-75" type="text" name="mo\_tag\_roles" id="mo\_tag\_roles" placeholder="Enter (;) separated Roles" autocomplete="off" disabled> |
  |  | 115 | <td> |
  |  | 116 | <input class="w-75" type="text" name="mo\_tag\_roles" id="mo\_tag\_roles" placeholder="Enter (;) separated Roles" autocomplete="off" disabled> |
  | 115 | 117 | </td> |
  | 116 |  | <th scope="row" class="check-column"> |
  |  | 118 | <th scope="row" class="check-column"> |
  | 117 | 119 | <label class="screen-reader-text" for="cb-select-3"></label> |
  | 118 | 120 | <input style="margin-left: 105px;" id="cb-select-3" name="mo\_tag\_login" class="log\_check" type="checkbox" disabled> |
  | 119 |  | </th> |
  | 120 |  | </tr> |
  | 121 |  | <?php |
  |  | 121 | </th> |
  |  | 122 | </tr> |
  |  | 123 | <?php |
  | 122 | 124 | } |
  | 123 | 125 | ?> |
* ## [page-and-post-restriction/trunk/page-restriction-utility.php](/changeset/3034414/page-and-post-restriction/trunk/page-restriction-utility.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/page-restriction-utility.php")

  | [r2829798](/browser/page-and-post-restriction/trunk/page-restriction-utility.php?rev=2829798#L3 "Show revision 2829798 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/page-restriction-utility.php?rev=3034414#L3 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | require\_once 'page-restriction-menu-settings.php'; |
  | 4 | 4 |  |
  | 5 |  | function papr\_dropdown($results\_per\_page, $type, $post\_type = '') |
  | 6 |  | { |
  | 7 |  | $dropdown\_type = 'papr\_'.$type.'\_per\_page'; |
  | 8 |  | if($type == 'page') { |
  | 9 |  | $dropdown\_type = 'papr\_results\_per\_page'; |
  | 10 |  | } |
  | 11 |  | ?> |
  | 12 |  |  |
  | 13 |  | <form id="<?php esc\_attr\_e($dropdown\_type); ?>" name="<?php esc\_attr\_e($dropdown\_type); ?>" method="post" action=""> |
  | 14 |  | <input type="hidden" name="option" value="<?php echo esc\_attr($dropdown\_type); ?>"> |
  | 15 |  | <?php wp\_nonce\_field($dropdown\_type); ?> |
  | 16 |  | <div class="row align-items-center"> |
  | 17 |  | <div class="col-md-3"> |
  | 18 |  | <h6>Number of items per page:</h6> |
  | 19 |  | </div> |
  | 20 |  | <div class="col-md-3"> |
  | 21 |  | <select name="<?php echo esc\_attr($dropdown\_type); ?>" id="results\_per\_page" onChange="document.getElementById('<?php echo esc\_js($dropdown\_type); ?>').submit()" style="width:60px;"> |
  | 22 |  | <?php |
  | 23 |  | for ($i = 1; $i <= 5; $i++) { |
  | 24 |  | $value = $i \* 10; |
  | 25 |  | echo '<option value="' . esc\_attr($value) . '"'; |
  | 26 |  | if ($results\_per\_page == $value) { |
  | 27 |  | echo ' selected '; |
  | 28 |  | } |
  | 29 |  | echo '>' . esc\_html($value) . '</option>'; |
  | 30 |  | } |
  | 31 |  | ?> |
  | 32 |  | </select> |
  | 33 |  | </div> |
  | 34 |  | </form> |
  | 35 |  | <?php if ( $type == 'post') { ?> |
  | 36 |  | <div class="col-md-3"> |
  | 37 |  | <h6> Please Select type of post:</h6> |
  | 38 |  | </div> |
  | 39 |  | <div class="col-md-3"> <?php papr\_post\_type\_dropdown( $post\_type ); ?> </div> |
  | 40 |  | <?php |
  | 41 |  | } ?> |
  | 42 |  | </div> |
  | 43 |  | <br> |
  | 44 |  | <?php |
  | 45 |  | } |
  | 46 |  |  |
  | 47 |  | function papr\_post\_type\_dropdown ($post\_type) { |
  | 48 |  | ?> |
  | 49 |  | <form id="papr\_post\_type" name="papr\_post\_type" method="post" action=""> |
  | 50 |  | <input type="hidden" name="option" value="papr\_post\_type"> |
  | 51 |  | <?php wp\_nonce\_field('papr\_post\_type'); ?> |
  | 52 |  | <select name="papr\_post\_type" id ="post\_type" onChange="document.getElementById('papr\_post\_type').submit()" style="width:150px;"> |
  | 53 |  | <?php |
  | 54 |  | $default = "post"; |
  | 55 |  | echo '<option value="'.esc\_attr($default).'"'; |
  | 56 |  | echo '>Default Post</option>'; |
  | 57 |  |  |
  | 58 |  | $custom\_post\_types = papr\_get\_custom\_post\_types(); |
  | 59 |  | foreach ( $custom\_post\_types as $post\_key ) { |
  | 60 |  | $post\_type\_obj = get\_post\_type\_object( $post\_key ); |
  | 61 |  | $post\_label = $post\_type\_obj->labels->name; |
  | 62 |  | echo '<option value="'.esc\_attr($post\_key).'"'; |
  | 63 |  | if($post\_type === $post\_key) |
  | 64 |  | {echo ' selected ';} |
  | 65 |  | echo '>'.esc\_html($post\_label).'</option>'; |
  | 66 |  | } |
  | 67 |  | ?> |
  | 68 |  | </select> |
  | 69 |  | </form> |
  | 70 |  | <?php |
  | 71 |  | } |
  | 72 |  |  |
  | 73 |  | function papr\_search\_box($type,$mo\_search\_value) |
  | 74 |  | { |
  | 75 |  | $temp = 'papr\_search\_'.$type; |
  | 76 |  | ?> |
  | 77 |  |  |
  | 78 |  | <form id="<?php echo esc\_attr($temp); ?>" name="<?php echo esc\_attr($temp); ?>" method="post" action=""> |
  | 79 |  | <input type="hidden" name="option" value="<?php echo esc\_attr($temp); ?>"> |
  | 80 |  | <?php wp\_nonce\_field($temp); |
  | 81 |  | $textbox\_id = 'mo\_'.$type.'\_search'; |
  | 82 |  | ?> |
  | 83 |  | <div id="search\_page\_post"> |
  | 84 |  | <h6>Search <?php echo esc\_html(ucfirst(strtolower($type))); ?>:</h6> |
  | 85 |  | <div style="display:flex;align-items:center;"> |
  | 86 |  | <div id="search" style="display:flex;align-items-center;" onmouseover = "document.getElementById('cross-img-<?php echo esc\_js($type);?>').style.display='block'; document.getElementById('cross-img-<?php echo esc\_js($type);?>').style.cursor='pointer';" onmouseout = "document.getElementById('cross-img-<?php echo esc\_js($type);?>').style.display = 'none'"> |
  | 87 |  | <div id="text"> |
  | 88 |  | <input type="text" name="<?php echo esc\_attr($textbox\_id); ?>" id="<?php echo esc\_attr($textbox\_id); ?>" style="width: 270px; margin-bottom:5px; padding-right:33px;" |
  | 89 |  | value="<?php echo esc\_attr($mo\_search\_value) ?>" placeholder="Search"> |
  | 90 |  |  |
  | 91 |  | <div id="image"> |
  | 92 |  | <svg id ="cross-img-<?php echo esc\_attr($type);?>" style="margin-top:-2.15rem;position:absolute;left:17rem;display:none;" xmlns="http://www.w3.org/2000/svg" |
  | 93 |  |  |
  | 94 |  | width="24" height="24" fill="currentColor" class="align-middle text-danger rotate-45" viewBox="0 0 14 14"> |
  | 95 |  | <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  | 96 |  | </svg> |
  | 97 |  | </div> |
  | 98 |  | </div> |
  | 99 |  | </div> |
  | 100 |  | </form> |
  | 101 |  | <div style="margin-left:1rem;margin-bottom:0.4rem"> |
  | 102 |  | <button type="button" id = "<?php echo esc\_attr($temp); ?>\_button" class="papr-btn-cstm rounded"  style="padding:0.17rem 1.5rem !important" |
  | 103 |  | >Search |
  | 104 |  | </button> |
  | 105 |  | </div> |
  | 106 |  | </div> |
  | 107 |  | </div> |
  | 108 |  | </br> |
  | 109 |  |  |
  | 110 |  | <script> |
  | 111 |  | jQuery(document).ready(function() { |
  | 112 |  | var page\_ele = document.getElementById("mo\_page\_search"); |
  | 113 |  | if(page\_ele){ |
  | 114 |  | var search\_page = document.getElementById('mo\_page\_search').value; |
  | 115 |  | if(search\_page!=''){ |
  | 116 |  | jQuery('html, body').animate({ |
  | 117 |  | scrollTop: jQuery("#mo\_page\_search").offset().top |
  | 118 |  | }, 0); |
  | 119 |  | } |
  | 120 |  | } |
  | 121 |  |  |
  | 122 |  | var post\_ele = document.getElementById("mo\_post\_search"); |
  | 123 |  | if(post\_ele){ |
  | 124 |  | var search\_post = document.getElementById('mo\_post\_search').value; |
  | 125 |  | if(search\_post!=''){ |
  | 126 |  | jQuery('html, body').animate({ |
  | 127 |  | scrollTop: jQuery("#mo\_post\_search").offset().top |
  | 128 |  | }, 0); |
  | 129 |  | } |
  | 130 |  | } |
  | 131 |  | }); |
  | 132 |  |  |
  | 133 |  | jQuery('#cross-img-page').click(function(e) { |
  | 134 |  | link = 'admin.php?page=page\_restriction'; |
  | 135 |  | window.open(link, "\_self"); |
  | 136 |  | }); |
  | 137 |  |  |
  | 138 |  | jQuery('#cross-img-post').click(function(e) { |
  | 139 |  | link = 'admin.php?page=page\_restriction&tab=post\_access'; |
  | 140 |  | window.open(link, "\_self"); |
  | 141 |  | }); |
  | 142 |  |  |
  | 143 |  | jQuery('#papr\_search\_page\_button').click(function(e) { |
  | 144 |  | var search = document.getElementById('mo\_page\_search').value; |
  | 145 |  | link = 'admin.php?page=page\_restriction'; |
  | 146 |  | if(search != ''){ |
  | 147 |  | link = 'admin.php?page=page\_restriction&search='.concat(search); |
  | 148 |  | } |
  | 149 |  | window.open(link, "\_self"); |
  | 150 |  | }); |
  | 151 |  |  |
  | 152 |  | jQuery('#papr\_search\_post\_button').click(function(e) { |
  | 153 |  | var search = document.getElementById('mo\_post\_search').value; |
  | 154 |  | link = 'admin.php?page=page\_restriction&tab=post\_access'; |
  | 155 |  | if(search != ''){ |
  | 156 |  | link = 'admin.php?page=page\_restriction&tab=post\_access&search='.concat(search); |
  | 157 |  | } |
  | 158 |  | window.open(link, "\_self"); |
  | 159 |  | }); |
  | 160 |  | </script> |
  | 161 |  | <?php |
  | 162 |  | } |
  | 163 |  |  |
  | 164 |  | function papr\_pagination\_button($number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, $page\_button) |
  | 165 |  | { |
  | 166 |  | $current\_page\_next = $current\_page + 1; |
  | 167 |  | $current\_page\_prev = $current\_page - 1; |
  | 168 |  |  |
  | 169 |  | $next\_page = $link . $current\_page\_next; |
  | 170 |  | $prev\_page = $link . $current\_page\_prev; |
  | 171 |  | $last\_page = $link . $number\_of\_pages\_in\_pagination; |
  | 172 |  | $first\_page = $link . '1'; |
  | 173 |  |  |
  | 174 |  | if (!array\_key\_exists('tab', $\_GET)) { |
  | 175 |  | if(array\_key\_exists('page', $\_GET)!='papr\_custom\_roles\_sub\_menu'){ |
  | 176 |  | $total\_pages = $total\_pages + 1;            //for home page |
  | 177 |  | } |
  | 178 |  | } |
  | 179 |  | ?> |
  | 180 |  |  |
  | 181 |  | <div class="tablenav-pages mt-2"> |
  | 182 |  | <span class="displaying-num"><?php echo esc\_html($total\_pages) ?> items</span> |
  | 183 |  | <span class="pagination-links"> |
  | 184 |  |  |
  | 185 |  | <?php |
  | 186 |  | if ($current\_page == 1) { |
  | 187 |  | $first\_page\_link = 'disabled'; |
  | 188 |  | $prev\_page\_link = 'disabled'; |
  | 189 |  | } else { |
  | 190 |  | $first\_page\_link = 'href="' . esc\_url($first\_page) . '"'; |
  | 191 |  | $prev\_page\_link = 'href="' . esc\_url($prev\_page) . '"'; |
  | 192 |  | } |
  | 193 |  | ?> |
  | 194 |  |  |
  | 195 |  | <a class="first-page rounded papr-pagination-btn" <?php echo $first\_page\_link; ?>> |
  | 196 |  | <span class="screen-reader-text">First page</span> |
  | 197 |  | <span aria-hidden="true">«</span> |
  | 198 |  | </a> |
  | 199 |  | <a class="prev-page rounded papr-pagination-btn" <?php echo $prev\_page\_link; ?>> |
  | 200 |  | <span class="screen-reader-text">Previous page</span> |
  | 201 |  | <span aria-hidden="true">‹</span> |
  | 202 |  | </a> |
  | 203 |  |  |
  | 204 |  | <span class="paging-input"> |
  | 205 |  | <label for="current-page-selector" class="screen-reader-text">Current Page</label> |
  | 206 |  |  |
  | 207 |  | <?php |
  | 208 |  | if ($page\_button == 'top') |
  | 209 |  | $current\_page\_selector = 'current-page-selector'; |
  | 210 |  | else |
  | 211 |  | $current\_page\_selector = 'current-page-selector-1'; |
  | 212 |  | ?> |
  | 213 |  |  |
  | 214 |  | <input class="current-page" id="<?php echo esc\_attr($current\_page\_selector); ?>" type="text" name="paged" value="<?php echo esc\_attr($current\_page) ?>" size="1" aria-describedby="table-paging" form="papr\_current\_page"> |
  | 215 |  | <span class="tablenav-paging-text"> of |
  | 216 |  | <span class="total-pages"><?php echo esc\_html($number\_of\_pages\_in\_pagination) ?></span> |
  | 217 |  | </span> |
  | 218 |  | </span> |
  | 219 |  |  |
  | 220 |  | <?php |
  | 221 |  | if ($current\_page == $number\_of\_pages\_in\_pagination) { |
  | 222 |  | $next\_page\_link = 'disabled'; |
  | 223 |  | $last\_page\_link = 'disabled'; |
  | 224 |  | } else { |
  | 225 |  | $next\_page\_link = 'href="' . esc\_url($next\_page) . '"'; |
  | 226 |  | $last\_page\_link = 'href="' . esc\_url($last\_page) . '"'; |
  | 227 |  | } |
  | 228 |  | ?> |
  | 229 |  |  |
  | 230 |  | <a class="next-page rounded papr-pagination-btn" <?php echo $next\_page\_link; ?>> |
  | 231 |  | <span class="screen-reader-text">Next page</span> |
  | 232 |  | <span aria-hidden="true">›</span> |
  | 233 |  | </a> |
  | 234 |  | <a class="last-page rounded papr-pagination-btn" <?php echo $last\_page\_link; ?>> |
  | 235 |  | <span class="screen-reader-text">Last page</span> |
  | 236 |  | <span aria-hidden="true">»</span> |
  | 237 |  | </a> |
  | 238 |  | </span> |
  | 239 |  | </div> |
  | 240 |  | <?php |
  | 241 |  | } |
  | 242 |  |  |
  | 243 |  | function papr\_get\_page\_post\_count($mo\_page\_post\_search\_value,$type) { |
  | 244 |  | if($mo\_page\_post\_search\_value==''){ |
  | 245 |  | if($type=='page'){ |
  | 246 |  | $all\_parent\_pages = array( |
  | 247 |  | 'post\_parent' => 0, |
  | 248 |  | 'numberposts' => -1, |
  | 249 |  | 'post\_type' => $type |
  | 250 |  | ); |
  | 251 |  | $total\_pages\_post = get\_posts($all\_parent\_pages); |
  | 252 |  | } |
  | 253 |  |  |
  | 254 |  | else { |
  | 255 |  | $total\_pages\_post\_count = wp\_count\_posts($type)->publish; // @TODO: Find an alternative |
  | 256 |  | return $total\_pages\_post\_count; |
  | 257 |  | } |
  | 258 |  | } |
  | 259 |  |  |
  | 260 |  | else { |
  | 261 |  | global $wpdb; |
  | 262 |  | $total\_pages\_post = $wpdb->get\_results("SELECT \* FROM wp\_posts WHERE (post\_title LIKE '%{$mo\_page\_post\_search\_value}%') AND post\_type='$type'"); |
  | 263 |  | } |
  | 264 |  |  |
  | 265 |  | $total\_pages\_post\_count = count($total\_pages\_post); |
  | 266 |  | return $total\_pages\_post\_count; |
  | 267 |  | } |
  | 268 |  |  |
  | 269 |  | function papr\_get\_paginated\_pages\_post($mo\_page\_post\_search\_value, $results\_per\_page, $current\_page,$type) { |
  | 270 |  | if ($mo\_page\_post\_search\_value == '') { |
  |  | 5 | function papr\_dropdown( $results\_per\_page, $type, $post\_type = '' ) { |
  |  | 6 | $dropdown\_type = 'papr\_' . $type . '\_per\_page'; |
  |  | 7 | if ( $type == 'page' ) { |
  |  | 8 | $dropdown\_type = 'papr\_results\_per\_page'; |
  |  | 9 | } |
  |  | 10 | ?> |
  |  | 11 |  |
  |  | 12 | <form id="<?php esc\_attr\_e( $dropdown\_type ); ?>" name="<?php esc\_attr\_e( $dropdown\_type ); ?>" method="post" action=""> |
  |  | 13 | <input type="hidden" name="option" value="<?php echo esc\_attr( $dropdown\_type ); ?>"> |
  |  | 14 | <?php wp\_nonce\_field( $dropdown\_type ); ?> |
  |  | 15 | <div class="row align-items-center"> |
  |  | 16 | <div class="col-md-3"> |
  |  | 17 | <h6>Number of items per page:</h6> |
  |  | 18 | </div> |
  |  | 19 | <div class="col-md-3"> |
  |  | 20 | <select name="<?php echo esc\_attr( $dropdown\_type ); ?>" id="results\_per\_page" onChange="document.getElementById('<?php echo esc\_js( $dropdown\_type ); ?>').submit()" style="width:60px;"> |
  |  | 21 | <?php |
  |  | 22 | for ( $i = 1; $i <= 5; $i++ ) { |
  |  | 23 | $value = $i \* 10; |
  |  | 24 | echo '<option value="' . esc\_attr( $value ) . '"'; |
  |  | 25 | if ( $results\_per\_page == $value ) { |
  |  | 26 | echo ' selected '; |
  |  | 27 | } |
  |  | 28 | echo '>' . esc\_html( $value ) . '</option>'; |
  |  | 29 | } |
  |  | 30 | ?> |
  |  | 31 | </select> |
  |  | 32 | </div> |
  |  | 33 | </form> |
  |  | 34 | <?php if ( $type == 'post' ) { ?> |
  |  | 35 | <div class="col-md-3"> |
  |  | 36 | <h6> Please Select type of post:</h6> |
  |  | 37 | </div> |
  |  | 38 | <div class="col-md-3"> <?php papr\_post\_type\_dropdown( $post\_type ); ?> </div> |
  |  | 39 | <?php |
  |  | 40 | } |
  |  | 41 | ?> |
  |  | 42 | </div> |
  |  | 43 | <br> |
  |  | 44 | <?php |
  |  | 45 | } |
  |  | 46 |  |
  |  | 47 | function papr\_post\_type\_dropdown( $post\_type ) { |
  |  | 48 | ?> |
  |  | 49 | <form id="papr\_post\_type" name="papr\_post\_type" method="post" action=""> |
  |  | 50 | <input type="hidden" name="option" value="papr\_post\_type"> |
  |  | 51 | <?php wp\_nonce\_field( 'papr\_post\_type' ); ?> |
  |  | 52 | <select name="papr\_post\_type" id ="post\_type" onChange="document.getElementById('papr\_post\_type').submit()" style="width:150px;"> |
  |  | 53 | <?php |
  |  | 54 | $default = 'post'; |
  |  | 55 | echo '<option value="' . esc\_attr( $default ) . '"'; |
  |  | 56 | echo '>Default Post</option>'; |
  |  | 57 |  |
  |  | 58 | $custom\_post\_types = papr\_get\_custom\_post\_types(); |
  |  | 59 | foreach ( $custom\_post\_types as $post\_key ) { |
  |  | 60 | $post\_type\_obj = get\_post\_type\_object( $post\_key ); |
  |  | 61 | $post\_label    = $post\_type\_obj->labels->name; |
  |  | 62 | echo '<option value="' . esc\_attr( $post\_key ) . '"'; |
  |  | 63 | if ( $post\_type === $post\_key ) { |
  |  | 64 | echo ' selected ';} |
  |  | 65 | echo '>' . esc\_html( $post\_label ) . '</option>'; |
  |  | 66 | } |
  |  | 67 | ?> |
  |  | 68 | </select> |
  |  | 69 | </form> |
  |  | 70 | <?php |
  |  | 71 | } |
  |  | 72 |  |
  |  | 73 | function papr\_search\_box( $type, $mo\_search\_value ) { |
  |  | 74 | $temp = 'papr\_search\_' . $type; |
  |  | 75 | ?> |
  |  | 76 |  |
  |  | 77 | <form id="<?php echo esc\_attr( $temp ); ?>" name="<?php echo esc\_attr( $temp ); ?>" method="post" action=""> |
  |  | 78 | <input type="hidden" name="option" value="<?php echo esc\_attr( $temp ); ?>"> |
  |  | 79 | <?php |
  |  | 80 | wp\_nonce\_field( $temp ); |
  |  | 81 | $textbox\_id = 'mo\_' . $type . '\_search'; |
  |  | 82 | ?> |
  |  | 83 | <div id="search\_page\_post"> |
  |  | 84 | <h6>Search <?php echo esc\_html( ucfirst( strtolower( $type ) ) ); ?>:</h6> |
  |  | 85 | <div style="display:flex;align-items:center;"> |
  |  | 86 | <div id="search" style="display:flex;align-items-center;" onmouseover = "document.getElementById('cross-img-<?php echo esc\_js( $type ); ?>').style.display='block'; document.getElementById('cross-img-<?php echo esc\_js( $type ); ?>').style.cursor='pointer';" onmouseout = "document.getElementById('cross-img-<?php echo esc\_js( $type ); ?>').style.display = 'none'"> |
  |  | 87 | <div id="text"> |
  |  | 88 | <input type="text" name="<?php echo esc\_attr( $textbox\_id ); ?>" id="<?php echo esc\_attr( $textbox\_id ); ?>" style="width: 270px; margin-bottom:5px; padding-right:33px;" |
  |  | 89 | value="<?php echo esc\_attr( $mo\_search\_value ); ?>" placeholder="Search"> |
  |  | 90 |  |
  |  | 91 | <div id="image"> |
  |  | 92 | <svg id ="cross-img-<?php echo esc\_attr( $type ); ?>" style="margin-top:-2.15rem;position:absolute;left:17rem;display:none;" xmlns="http://www.w3.org/2000/svg" |
  |  | 93 |  |
  |  | 94 | width="24" height="24" fill="currentColor" class="align-middle text-danger rotate-45" viewBox="0 0 14 14"> |
  |  | 95 | <path fill-rule="evenodd" d="M4.646 4.646a.5.5 0 0 1 .708 0L8 7.293l2.646-2.647a.5.5 0 0 1 .708.708L8.707 8l2.647 2.646a.5.5 0 0 1-.708.708L8 8.707l-2.646 2.647a.5.5 0 0 1-.708-.708L7.293 8 4.646 5.354a.5.5 0 0 1 0-.708z"/> |
  |  | 96 | </svg> |
  |  | 97 | </div> |
  |  | 98 | </div> |
  |  | 99 | </div> |
  |  | 100 | </form> |
  |  | 101 | <div style="margin-left:1rem;margin-bottom:0.4rem"> |
  |  | 102 | <button type="button" id = "<?php echo esc\_attr( $temp ); ?>\_button" class="papr-btn-cstm rounded"  style="padding:0.17rem 1.5rem !important" |
  |  | 103 | >Search |
  |  | 104 | </button> |
  |  | 105 | </div> |
  |  | 106 | </div> |
  |  | 107 | </div> |
  |  | 108 | </br> |
  |  | 109 |  |
  |  | 110 | <script> |
  |  | 111 | jQuery(document).ready(function() { |
  |  | 112 | var page\_ele = document.getElementById("mo\_page\_search"); |
  |  | 113 | if(page\_ele){ |
  |  | 114 | var search\_page = document.getElementById('mo\_page\_search').value; |
  |  | 115 | if(search\_page!=''){ |
  |  | 116 | jQuery('html, body').animate({ |
  |  | 117 | scrollTop: jQuery("#mo\_page\_search").offset().top |
  |  | 118 | }, 0); |
  |  | 119 | } |
  |  | 120 | } |
  |  | 121 |  |
  |  | 122 | var post\_ele = document.getElementById("mo\_post\_search"); |
  |  | 123 | if(post\_ele){ |
  |  | 124 | var search\_post = document.getElementById('mo\_post\_search').value; |
  |  | 125 | if(search\_post!=''){ |
  |  | 126 | jQuery('html, body').animate({ |
  |  | 127 | scrollTop: jQuery("#mo\_post\_search").offset().top |
  |  | 128 | }, 0); |
  |  | 129 | } |
  |  | 130 | } |
  |  | 131 | }); |
  |  | 132 |  |
  |  | 133 | jQuery('#cross-img-page').click(function(e) { |
  |  | 134 | link = 'admin.php?page=page\_restriction'; |
  |  | 135 | window.open(link, "\_self"); |
  |  | 136 | }); |
  |  | 137 |  |
  |  | 138 | jQuery('#cross-img-post').click(function(e) { |
  |  | 139 | link = 'admin.php?page=page\_restriction&tab=post\_access'; |
  |  | 140 | window.open(link, "\_self"); |
  |  | 141 | }); |
  |  | 142 |  |
  |  | 143 | jQuery('#papr\_search\_page\_button').click(function(e) { |
  |  | 144 | var search = document.getElementById('mo\_page\_search').value; |
  |  | 145 | link = 'admin.php?page=page\_restriction'; |
  |  | 146 | if(search != ''){ |
  |  | 147 | link = 'admin.php?page=page\_restriction&search='.concat(search); |
  |  | 148 | } |
  |  | 149 | window.open(link, "\_self"); |
  |  | 150 | }); |
  |  | 151 |  |
  |  | 152 | jQuery('#papr\_search\_post\_button').click(function(e) { |
  |  | 153 | var search = document.getElementById('mo\_post\_search').value; |
  |  | 154 | link = 'admin.php?page=page\_restriction&tab=post\_access'; |
  |  | 155 | if(search != ''){ |
  |  | 156 | link = 'admin.php?page=page\_restriction&tab=post\_access&search='.concat(search); |
  |  | 157 | } |
  |  | 158 | window.open(link, "\_self"); |
  |  | 159 | }); |
  |  | 160 | </script> |
  |  | 161 | <?php |
  |  | 162 | } |
  |  | 163 |  |
  |  | 164 | function papr\_pagination\_button( $number\_of\_pages\_in\_pagination, $total\_pages, $current\_page, $link, $page\_button ) { |
  |  | 165 | $current\_page\_next = $current\_page + 1; |
  |  | 166 | $current\_page\_prev = $current\_page - 1; |
  |  | 167 |  |
  |  | 168 | $next\_page  = $link . $current\_page\_next; |
  |  | 169 | $prev\_page  = $link . $current\_page\_prev; |
  |  | 170 | $last\_page  = $link . $number\_of\_pages\_in\_pagination; |
  |  | 171 | $first\_page = $link . '1'; |
  |  | 172 |  |
  |  | 173 | if ( ! array\_key\_exists( 'tab', $\_GET ) ) { |
  |  | 174 | if ( array\_key\_exists( 'page', $\_GET ) != 'papr\_custom\_roles\_sub\_menu' ) { |
  |  | 175 | $total\_pages = $total\_pages + 1;            // for home page |
  |  | 176 | } |
  |  | 177 | } |
  |  | 178 | ?> |
  |  | 179 |  |
  |  | 180 | <div class="tablenav-pages mt-2"> |
  |  | 181 | <span class="displaying-num"><?php echo esc\_html( $total\_pages ); ?> items</span> |
  |  | 182 | <span class="pagination-links"> |
  |  | 183 |  |
  |  | 184 | <?php |
  |  | 185 | if ( $current\_page == 1 ) { |
  |  | 186 | $first\_page\_link = 'disabled'; |
  |  | 187 | $prev\_page\_link  = 'disabled'; |
  |  | 188 | } else { |
  |  | 189 | $first\_page\_link = 'href="' . esc\_url( $first\_page ) . '"'; |
  |  | 190 | $prev\_page\_link  = 'href="' . esc\_url( $prev\_page ) . '"'; |
  |  | 191 | } |
  |  | 192 | ?> |
  |  | 193 |  |
  |  | 194 | <a class="first-page rounded papr-pagination-btn" <?php echo $first\_page\_link; ?>> |
  |  | 195 | <span class="screen-reader-text">First page</span> |
  |  | 196 | <span aria-hidden="true">«</span> |
  |  | 197 | </a> |
  |  | 198 | <a class="prev-page rounded papr-pagination-btn" <?php echo $prev\_page\_link; ?>> |
  |  | 199 | <span class="screen-reader-text">Previous page</span> |
  |  | 200 | <span aria-hidden="true">‹</span> |
  |  | 201 | </a> |
  |  | 202 |  |
  |  | 203 | <span class="paging-input"> |
  |  | 204 | <label for="current-page-selector" class="screen-reader-text">Current Page</label> |
  |  | 205 |  |
  |  | 206 | <?php |
  |  | 207 | if ( $page\_button == 'top' ) { |
  |  | 208 | $current\_page\_selector = 'current-page-selector'; |
  |  | 209 | } else { |
  |  | 210 | $current\_page\_selector = 'current-page-selector-1'; |
  |  | 211 | } |
  |  | 212 | ?> |
  |  | 213 |  |
  |  | 214 | <input class="current-page" id="<?php echo esc\_attr( $current\_page\_selector ); ?>" type="text" name="paged" value="<?php echo esc\_attr( $current\_page ); ?>" size="1" aria-describedby="table-paging" form="papr\_current\_page"> |
  |  | 215 | <span class="tablenav-paging-text"> of |
  |  | 216 | <span class="total-pages"><?php echo esc\_html( $number\_of\_pages\_in\_pagination ); ?></span> |
  |  | 217 | </span> |
  |  | 218 | </span> |
  |  | 219 |  |
  |  | 220 | <?php |
  |  | 221 | if ( $current\_page == $number\_of\_pages\_in\_pagination ) { |
  |  | 222 | $next\_page\_link = 'disabled'; |
  |  | 223 | $last\_page\_link = 'disabled'; |
  |  | 224 | } else { |
  |  | 225 | $next\_page\_link = 'href="' . esc\_url( $next\_page ) . '"'; |
  |  | 226 | $last\_page\_link = 'href="' . esc\_url( $last\_page ) . '"'; |
  |  | 227 | } |
  |  | 228 | ?> |
  |  | 229 |  |
  |  | 230 | <a class="next-page rounded papr-pagination-btn" <?php echo $next\_page\_link; ?>> |
  |  | 231 | <span class="screen-reader-text">Next page</span> |
  |  | 232 | <span aria-hidden="true">›</span> |
  |  | 233 | </a> |
  |  | 234 | <a class="last-page rounded papr-pagination-btn" <?php echo $last\_page\_link; ?>> |
  |  | 235 | <span class="screen-reader-text">Last page</span> |
  |  | 236 | <span aria-hidden="true">»</span> |
  |  | 237 | </a> |
  |  | 238 | </span> |
  |  | 239 | </div> |
  |  | 240 | <?php |
  |  | 241 | } |
  |  | 242 |  |
  |  | 243 | function papr\_get\_page\_post\_count( $mo\_page\_post\_search\_value, $type ) { |
  |  | 244 | if ( $mo\_page\_post\_search\_value == '' ) { |
  |  | 245 | if ( $type == 'page' ) { |
  |  | 246 | $all\_parent\_pages = array( |
  |  | 247 | 'post\_parent' => 0, |
  |  | 248 | 'numberposts' => -1, |
  |  | 249 | 'post\_type'   => $type, |
  |  | 250 | ); |
  |  | 251 | $total\_pages\_post = get\_posts( $all\_parent\_pages ); |
  |  | 252 | } else { |
  |  | 253 | $total\_pages\_post\_count = wp\_count\_posts( $type )->publish; // @TODO: Find an alternative |
  |  | 254 | return $total\_pages\_post\_count; |
  |  | 255 | } |
  |  | 256 | } else { |
  |  | 257 | global $wpdb; |
  |  | 258 | $total\_pages\_post = $wpdb->get\_results( "SELECT \* FROM wp\_posts WHERE (post\_title LIKE '%{$mo\_page\_post\_search\_value}%') AND post\_type='$type'" ); |
  |  | 259 | } |
  |  | 260 |  |
  |  | 261 | $total\_pages\_post\_count = count( $total\_pages\_post ); |
  |  | 262 | return $total\_pages\_post\_count; |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | function papr\_get\_paginated\_pages\_post( $mo\_page\_post\_search\_value, $results\_per\_page, $current\_page, $type ) { |
  |  | 266 | if ( $mo\_page\_post\_search\_value == '' ) { |
  | 271 | 267 | $required\_pages\_post = array( |
  | 272 |  | 'post\_parent' => 0, |
  |  | 268 | 'post\_parent'    => 0, |
  | 273 | 269 | 'posts\_per\_page' => $results\_per\_page, |
  | 274 |  | 'post\_type' => $type, |
  | 275 |  | 'paged' => $current\_page, |
  | 276 |  | 'orderby' => 'publish\_date', |
  | 277 |  | 'order' => 'ASC', |
  |  | 270 | 'post\_type'      => $type, |
  |  | 271 | 'paged'          => $current\_page, |
  |  | 272 | 'orderby'        => 'publish\_date', |
  |  | 273 | 'order'          => 'ASC', |
  | 278 | 274 | ); |
  | 279 |  | $pagination ~~= get\_posts($required\_pages\_post~~); |
  | 280 |  | } |
  | 281 |  | ~~else {~~ |
  | 282 |  | ~~global $wpdb~~; |
  | 283 |  | $~~skip = ($current\_page-1)\*$results\_per\_page;~~ |
  | 284 |  | ~~$pagination = $wpdb->get\_results(~~" SELECT \* FROM wp\_posts |
  |  | 275 | $pagination          = get\_posts( $required\_pages\_post ); |
  |  | 276 | } else { |
  |  | 277 | global $wpdb; |
  |  | 278 | $skip       = ( $current\_page - 1 ) \* $results\_per\_page; |
  |  | 279 | $pagination = $wpdb->get\_results( |
  |  | 280 | " SELECT \* FROM wp\_posts |
  | 285 | 281 | WHERE post\_title LIKE '%$mo\_page\_post\_search\_value%' AND post\_type='$type' AND post\_status='publish' |
  | 286 | 282 | ORDER BY post\_title |
  | 287 |  | limit $results\_per\_page OFFSET $skip "); |
  | 288 |  | } |
  |  | 283 | limit $results\_per\_page OFFSET $skip " |
  |  | 284 | ); |
  |  | 285 | } |
  | 289 | 286 | return $pagination; |
  | 290 | 287 | } |
  | 291 | 288 |  |
  | 292 |  | function papr\_display\_head\_foot\_of\_table($type) |
  | 293 |  | { |
  | 294 |  | ?> |
  | 295 |  | <tr> |
  | 296 |  | <td style="width:200px;padding-left:50px;" id="cb" class="manage-column column-cb"><?php echo esc\_html($type) ?></td> |
  | 297 |  |  |
  | 298 |  | <td style="width:250px;">Enter Roles who can view this <?php echo esc\_html($type) ?> |
  | 299 |  | <div class="papr-info-global ms-2"> |
  | 300 |  | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  | 301 |  | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  | 302 |  | </svg> |
  | 303 |  | <p class="papr-info-text-global"> |
  | 304 |  | Only the roles that are entered in the input box will have access to the <?php echo esc\_html($type) ?> <b>(By default all <?php echo esc\_html($type) ?> are accessible to all users irrespective of their roles)</b>. |
  | 305 |  | </p> |
  | 306 |  | </div> |
  | 307 |  | </td> |
  | 308 |  | <?php |
  | 309 |  | if ($type == 'Page') { ?> |
  | 310 |  | <td style="width:170px;text-align:center;">Auto-assign Parent Configuration to Child Pages</td> |
  | 311 |  | <?php |
  | 312 |  | } ?> |
  | 313 |  | <td style="width:120px;text-align:center;" id="cb" class="manage-column column-cb check-column">Make <?php echo esc\_html($type) ?> Private |
  | 314 |  | <br> |
  | 315 |  | <label class="screen-reader-text" for="cb-select-all-1">Select All</label> |
  | 316 |  | <input id="cb-select-all-1" type="checkbox" style="margin:5px 0;"> |
  | 317 |  | </td> |
  | 318 |  | </tr> |
  | 319 |  | <?php |
  | 320 |  | } |
  | 321 |  |  |
  | 322 |  | function papr\_get\_current\_page($number\_of\_pages\_in\_pagination) |
  | 323 |  | { |
  | 324 |  | $current\_page = 1; |
  | 325 |  | if (isset($\_REQUEST['curr']) && ($\_REQUEST['curr'] > 1)) { |
  | 326 |  | $current\_page = $\_REQUEST['curr']; |
  | 327 |  | if ($current\_page > $number\_of\_pages\_in\_pagination) |
  | 328 |  | $current\_page = $number\_of\_pages\_in\_pagination; |
  | 329 |  | } |
  | 330 |  |  |
  | 331 |  | return $current\_page; |
  | 332 |  | } |
  | 333 |  |  |
  | 334 |  | function papr\_display\_pages($mo\_page\_search\_value, $page, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle) |
  | 335 |  | { |
  | 336 |  | $children = array(); |
  | 337 |  | if (!is\_object($page)) { |
  | 338 |  | if ($page == 0) |
  | 339 |  | $pageid = 0; |
  | 340 |  | } else { |
  | 341 |  | $pageid = $page->ID; |
  | 342 |  | $children = get\_pages(array('child\_of' => $pageid)); |
  | 343 |  | } |
  | 344 |  | ?> |
  | 345 |  | <tr id="<?php echo esc\_attr($pageid) ?>" style="background-color:<?php echo esc\_attr($color) ?>"> |
  | 346 |  |  |
  | 347 |  | <td class="d-inline-flex"> |
  | 348 |  | <?php |
  | 349 |  | if ($pageid == 0) { ?> |
  | 350 |  | <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><a href="<?php echo esc\_url(get\_home\_url()) ?>" target="\_blank" class="d-flex align-items-center">Home Page&nbsp; <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 351 |  | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 352 |  | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | 353 |  | </svg></a> |
  | 354 |  | <?php |
  | 355 |  | } else { |
  | 356 |  | if($mo\_page\_search\_value=='') { |
  | 357 |  | $ancestor\_array = get\_post\_ancestors($pageid); |
  | 358 |  | $total\_ancestor = count($ancestor\_array); |
  | 359 |  | for ($i = 0; $i < $total\_ancestor; $i++) |
  | 360 |  | echo '&nbsp&nbsp&nbsp&nbsp'; |
  | 361 |  |  |
  | 362 |  | if (count($children) > 0) { |
  | 363 |  | $child\_with\_id = array(); |
  | 364 |  | foreach ($children as $child) |
  | 365 |  | array\_push($child\_with\_id, $child->ID); |
  | 366 |  | $parsed\_child = json\_encode($child\_with\_id); |
  | 367 |  | ?> |
  | 368 |  | <a class="me-2" onclick="hide\_show\_child(<?php echo esc\_js($pageid) ?>)"> |
  | 369 |  | <img id="toggle\_image\_<?php echo esc\_attr($pageid) ?>" src="<?php echo esc\_url(plugin\_dir\_url(\_\_FILE\_\_)) ?>.'/includes/images/collapse.png'"> |
  | 370 |  | </a> |
  | 371 |  | <input type=hidden id="child\_list\_<?php echo esc\_attr($pageid) ?>" value="<?php echo esc\_attr($parsed\_child) ?>"> |
  | 372 |  | <input type=hidden id="child\_list\_toggle\_<?php echo esc\_attr($pageid) ?>" value="show"> |
  | 373 |  | <?php |
  | 374 |  | } |
  | 375 |  | else { ?> |
  | 376 |  | <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> |
  | 377 |  | <?php } |
  | 378 |  | echo " "; |
  | 379 |  | } |
  | 380 |  | $page\_link = get\_site\_url() . '/' . $page->post\_title . '/'; |
  | 381 |  | ?> |
  | 382 |  | <a href="<?php echo esc\_url($page->guid) ?>" target="\_blank" class="d-flex align-items-center"><?php echo esc\_html($page->post\_title) ?> &nbsp; <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  | 383 |  | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  | 384 |  | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  | 385 |  | </svg></a> |
  | 386 |  | <?php |
  | 387 |  | } |
  | 388 |  | ?> |
  | 389 |  | </td> |
  | 390 |  |  |
  | 391 |  | <?php |
  | 392 |  | $mo\_page\_roles\_value = array(); |
  | 393 |  | if ($pageid == 0) { |
  | 394 |  | if (!empty($allowed\_roles['mo\_page\_0'])) { |
  | 395 |  | $mo\_page\_roles\_value = $allowed\_roles['mo\_page\_0']; |
  | 396 |  | } |
  | 397 |  | } else { |
  | 398 |  | if (!empty($allowed\_roles[$pageid])) |
  | 399 |  | $mo\_page\_roles\_value = $allowed\_roles[$pageid]; |
  | 400 |  | } |
  | 401 |  | $page\_role\_login\_disable = ''; |
  | 402 |  | $page\_role\_login\_disable\_check = ''; |
  | 403 |  | $parent\_id = (int)wp\_get\_post\_parent\_id( $pageid ); |
  | 404 |  |  |
  | 405 |  | if (!empty($default\_role\_parent[$parent\_id]) && $parent\_id != 0) |
  | 406 |  | $page\_role\_login\_disable\_check = $default\_role\_parent[$parent\_id]; |
  | 407 |  |  |
  | 408 |  | if ($page\_role\_login\_disable\_check == 1 || $page\_role\_login\_disable\_check == 'on' || $page\_role\_login\_disable\_check == 'true') |
  | 409 |  | $page\_role\_login\_disable = 'disabled'; |
  | 410 |  | $mo\_page\_val=implode(";",$mo\_page\_roles\_value); |
  | 411 |  | ?> |
  | 412 |  | <td> |
  | 413 |  | <input type="hidden" name="mo\_hidden\_page\_roles\_<?php echo esc\_attr($pageid) ?>[]" id="mo\_hidden\_page\_roles\_<?php echo esc\_attr($pageid) ?>" value="<?php echo esc\_attr($mo\_page\_val) ?>"> |
  | 414 |  | <select multiple class="roles\_multi w-100" name="mo\_page\_roles\_<?php echo esc\_attr($pageid) ?>[]" id="mo\_page\_roles\_<?php echo esc\_attr($pageid) ?>" value="<?php echo esc\_attr($mo\_page\_val) ?>" <?php echo esc\_attr($page\_role\_login\_disable); ?> onChange ="apply\_roles\_to\_child(event, <?php echo esc\_js($pageid); ?>)"> |
  | 415 |  | <?php |
  | 416 |  | papr\_display\_roles($mo\_page\_roles\_value); |
  | 417 |  | ?> |
  | 418 |  | </select> |
  | 419 |  | </td> |
  | 420 |  | <?php |
  | 421 |  | if($mo\_page\_search\_value==''){ |
  | 422 |  | ?> |
  | 423 |  | <td style="border-right-style: none;text-align:center;" scope="row" class="check-column-1"> |
  | 424 |  | <?php |
  | 425 |  | if (count($children) > 0) { |
  | 426 |  | $mo\_page\_default\_check = ""; |
  | 427 |  | $mo\_page\_default\_check\_value = ""; |
  | 428 |  | $hidden\_value = 2; |
  | 429 |  |  |
  | 430 |  | if (!empty($default\_role\_parent[$pageid])) |
  | 431 |  | $mo\_page\_default\_check\_value = $default\_role\_parent[$pageid]; |
  | 432 |  |  |
  | 433 |  | if ($mo\_page\_default\_check\_value == 1 || $mo\_page\_default\_check\_value == 'on' || $mo\_page\_default\_check\_value == 'true') { |
  | 434 |  | $mo\_page\_default\_check = 'checked'; |
  | 435 |  | $hidden\_value = 1; |
  | 436 |  | } |
  | 437 |  | $page\_role\_login\_disable = ''; |
  | 438 |  | $page\_role\_login\_disable\_check = ''; |
  | 439 |  | $parent\_id = (int)wp\_get\_post\_parent\_id( $pageid ); |
  | 440 |  |  |
  | 441 |  | if (!empty($default\_role\_parent[$parent\_id]) && $parent\_id != 0) |
  | 442 |  | $page\_role\_login\_disable\_check = $default\_role\_parent[$parent\_id]; |
  | 443 |  |  |
  | 444 |  | if ($page\_role\_login\_disable\_check == 1 || $page\_role\_login\_disable\_check == 'on' || $page\_role\_login\_disable\_check == 'true') |
  | 445 |  | $page\_role\_login\_disable = 'disabled'; |
  | 446 |  | ?> |
  | 447 |  | <input type=hidden id="child\_list\_hidden\_<?php echo esc\_attr($pageid) ?>" value="<?php echo esc\_attr($hidden\_value) ?>"> |
  | 448 |  | <input id="mo\_page\_default\_role\_valid\_<?Php echo esc\_attr($pageid) ?>" name="mo\_page\_default\_role\_<?Php echo esc\_attr($pageid) ?>" type="checkbox" <?php echo esc\_attr($mo\_page\_default\_check) ?> <?php echo esc\_attr($page\_role\_login\_disable) ?> onChange="disable\_enable\_child(<?php echo esc\_js($pageid); ?>)" > |
  | 449 |  | <?php |
  | 450 |  | } ?> |
  | 451 |  | </td> |
  | 452 |  | <?php |
  | 453 |  | } else{ |
  | 454 |  | echo '<td></td>'; |
  | 455 |  | } |
  | 456 |  | $mo\_page\_login\_check\_value = ""; |
  | 457 |  | $mo\_page\_login\_check = ""; |
  | 458 |  |  |
  | 459 |  | if (!empty($allowed\_redirect\_pages[$pageid])) |
  | 460 |  | $mo\_page\_login\_check\_value = $allowed\_redirect\_pages[$pageid]; |
  | 461 |  |  |
  | 462 |  | if ($mo\_page\_login\_check\_value == 1 || $mo\_page\_login\_check\_value == 'on' || $mo\_page\_login\_check\_value == 'true' || $default\_login\_toggle == 1) |
  | 463 |  | $mo\_page\_login\_check = 'checked'; |
  | 464 |  |  |
  | 465 |  | if ($default\_login\_toggle == 1 && !empty($unrestricted\_pages[$pageid])) |
  | 466 |  | $mo\_page\_login\_check = ''; |
  | 467 |  | ?> |
  | 468 |  |  |
  | 469 |  | <td style="width:200px; text-align:center; padding-left:8px;" scope="row" class="check-column"> |
  | 470 |  | <label class="screen-reader-text" for="cb-select-3"></label> |
  | 471 |  | <input id="cb-select-3" class ="mo\_page\_login\_valid\_<?php echo esc\_attr($pageid) ?>" name="mo\_page\_login\_<?php echo esc\_attr($pageid) ?>" type="checkbox" <?php echo esc\_attr($mo\_page\_login\_check) ?> <?php echo esc\_attr($page\_role\_login\_disable); ?> |
  | 472 |  | onChange="apply\_to\_child(<?php echo esc\_js($pageid); ?>)"> |
  | 473 |  |  |
  | 474 |  | <div class="locked-indicator"> |
  | 475 |  | <span class="locked-indicator-icon" aria-hidden="true"></span> |
  | 476 |  | <span class="screen-reader-text"></span> |
  | 477 |  | </div> |
  | 478 |  | </td> |
  | 479 |  | </tr> |
  | 480 |  | <?php |
  |  | 289 | function papr\_display\_head\_foot\_of\_table( $type ) { |
  |  | 290 | ?> |
  |  | 291 | <tr> |
  |  | 292 | <td style="width:200px;padding-left:50px;" id="cb" class="manage-column column-cb"><?php echo esc\_html( $type ); ?></td> |
  |  | 293 |  |
  |  | 294 | <td style="width:250px;">Enter Roles who can view this <?php echo esc\_html( $type ); ?> |
  |  | 295 | <div class="papr-info-global ms-2"> |
  |  | 296 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 297 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 298 | </svg> |
  |  | 299 | <p class="papr-info-text-global"> |
  |  | 300 | Only the roles that are entered in the input box will have access to the <?php echo esc\_html( $type ); ?> <b>(By default all <?php echo esc\_html( $type ); ?> are accessible to all users irrespective of their roles)</b>. |
  |  | 301 | </p> |
  |  | 302 | </div> |
  |  | 303 | </td> |
  |  | 304 | <?php |
  |  | 305 | if ( $type == 'Page' ) { |
  |  | 306 | ?> |
  |  | 307 | <td style="width:170px;text-align:center;">Auto-assign Parent Configuration to Child Pages</td> |
  |  | 308 | <?php |
  |  | 309 | } |
  |  | 310 | ?> |
  |  | 311 | <td style="width:120px;text-align:center;" id="cb" class="manage-column column-cb check-column">Make <?php echo esc\_html( $type ); ?> Private |
  |  | 312 | <br> |
  |  | 313 | <label class="screen-reader-text" for="cb-select-all-1">Select All</label> |
  |  | 314 | <input id="cb-select-all-1" type="checkbox" style="margin:5px 0;"> |
  |  | 315 | </td> |
  |  | 316 | </tr> |
  |  | 317 | <?php |
  |  | 318 | } |
  |  | 319 |  |
  |  | 320 | function papr\_get\_current\_page( $number\_of\_pages\_in\_pagination ) { |
  |  | 321 | $current\_page = 1; |
  |  | 322 | if ( isset( $\_REQUEST['curr'] ) && ( $\_REQUEST['curr'] > 1 ) ) { |
  |  | 323 | $current\_page = $\_REQUEST['curr']; |
  |  | 324 | if ( $current\_page > $number\_of\_pages\_in\_pagination ) { |
  |  | 325 | $current\_page = $number\_of\_pages\_in\_pagination; |
  |  | 326 | } |
  |  | 327 | } |
  |  | 328 |  |
  |  | 329 | return $current\_page; |
  |  | 330 | } |
  |  | 331 |  |
  |  | 332 | function papr\_display\_pages( $mo\_page\_search\_value, $page, $color, $allowed\_roles, $allowed\_redirect\_pages, $default\_role\_parent, $unrestricted\_pages, $default\_login\_toggle ) { |
  |  | 333 | $children = array(); |
  |  | 334 | if ( ! is\_object( $page ) ) { |
  |  | 335 | if ( $page == 0 ) { |
  |  | 336 | $pageid = 0; |
  |  | 337 | } |
  |  | 338 | } else { |
  |  | 339 | $pageid   = $page->ID; |
  |  | 340 | $children = get\_pages( array( 'child\_of' => $pageid ) ); |
  |  | 341 | } |
  |  | 342 | ?> |
  |  | 343 | <tr id="<?php echo esc\_attr( $pageid ); ?>" style="background-color:<?php echo esc\_attr( $color ); ?>"> |
  |  | 344 |  |
  |  | 345 | <td class="d-inline-flex"> |
  |  | 346 | <?php |
  |  | 347 | if ( $pageid == 0 ) { |
  |  | 348 | ?> |
  |  | 349 | <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p><a href="<?php echo esc\_url( get\_home\_url() ); ?>" target="\_blank" class="d-flex align-items-center">Home Page&nbsp; <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 350 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  |  | 351 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  |  | 352 | </svg></a> |
  |  | 353 | <?php |
  |  | 354 | } else { |
  |  | 355 | if ( $mo\_page\_search\_value == '' ) { |
  |  | 356 | $ancestor\_array = get\_post\_ancestors( $pageid ); |
  |  | 357 | $total\_ancestor = count( $ancestor\_array ); |
  |  | 358 | for ( $i = 0; $i < $total\_ancestor; $i++ ) { |
  |  | 359 | echo '&nbsp&nbsp&nbsp&nbsp'; |
  |  | 360 | } |
  |  | 361 |  |
  |  | 362 | if ( count( $children ) > 0 ) { |
  |  | 363 | $child\_with\_id = array(); |
  |  | 364 | foreach ( $children as $child ) { |
  |  | 365 | array\_push( $child\_with\_id, $child->ID ); |
  |  | 366 | } |
  |  | 367 | $parsed\_child = json\_encode( $child\_with\_id ); |
  |  | 368 | ?> |
  |  | 369 | <a class="me-2" onclick="hide\_show\_child(<?php echo esc\_js( $pageid ); ?>)"> |
  |  | 370 | <img id="toggle\_image\_<?php echo esc\_attr( $pageid ); ?>" src="<?php echo esc\_url( plugin\_dir\_url( \_\_FILE\_\_ ) ); ?>.'/includes/images/collapse.png'"> |
  |  | 371 | </a> |
  |  | 372 | <input type=hidden id="child\_list\_<?php echo esc\_attr( $pageid ); ?>" value="<?php echo esc\_attr( $parsed\_child ); ?>"> |
  |  | 373 | <input type=hidden id="child\_list\_toggle\_<?php echo esc\_attr( $pageid ); ?>" value="show"> |
  |  | 374 | <?php |
  |  | 375 | } else { |
  |  | 376 | ?> |
  |  | 377 | <p>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;</p> |
  |  | 378 | <?php |
  |  | 379 | } |
  |  | 380 | echo ' '; |
  |  | 381 | } |
  |  | 382 | $page\_link = get\_site\_url() . '/' . $page->post\_title . '/'; |
  |  | 383 | ?> |
  |  | 384 | <a href="<?php echo esc\_url( $page->guid ); ?>" target="\_blank" class="d-flex align-items-center"><?php echo esc\_html( $page->post\_title ); ?> &nbsp; <svg xmlns="http://www.w3.org/2000/svg" width="14" height="14" fill="currentColor" viewBox="0 0 16 16"> |
  |  | 385 | <path fill-rule="evenodd" d="M8.636 3.5a.5.5 0 0 0-.5-.5H1.5A1.5 1.5 0 0 0 0 4.5v10A1.5 1.5 0 0 0 1.5 16h10a1.5 1.5 0 0 0 1.5-1.5V7.864a.5.5 0 0 0-1 0V14.5a.5.5 0 0 1-.5.5h-10a.5.5 0 0 1-.5-.5v-10a.5.5 0 0 1 .5-.5h6.636a.5.5 0 0 0 .5-.5z"></path> |
  |  | 386 | <path fill-rule="evenodd" d="M16 .5a.5.5 0 0 0-.5-.5h-5a.5.5 0 0 0 0 1h3.793L6.146 9.146a.5.5 0 1 0 .708.708L15 1.707V5.5a.5.5 0 0 0 1 0v-5z"></path> |
  |  | 387 | </svg></a> |
  |  | 388 | <?php |
  |  | 389 | } |
  |  | 390 | ?> |
  |  | 391 | </td> |
  |  | 392 |  |
  |  | 393 | <?php |
  |  | 394 | $mo\_page\_roles\_value = array(); |
  |  | 395 | if ( $pageid == 0 ) { |
  |  | 396 | if ( ! empty( $allowed\_roles['mo\_page\_0'] ) ) { |
  |  | 397 | $mo\_page\_roles\_value = $allowed\_roles['mo\_page\_0']; |
  |  | 398 | } |
  |  | 399 | } else { |
  |  | 400 | if ( ! empty( $allowed\_roles[ $pageid ] ) ) { |
  |  | 401 | $mo\_page\_roles\_value = $allowed\_roles[ $pageid ]; |
  |  | 402 | } |
  |  | 403 | } |
  |  | 404 | $page\_role\_login\_disable       = ''; |
  |  | 405 | $page\_role\_login\_disable\_check = ''; |
  |  | 406 | $parent\_id                     = (int) wp\_get\_post\_parent\_id( $pageid ); |
  |  | 407 |  |
  |  | 408 | if ( ! empty( $default\_role\_parent[ $parent\_id ] ) && $parent\_id != 0 ) { |
  |  | 409 | $page\_role\_login\_disable\_check = $default\_role\_parent[ $parent\_id ]; |
  |  | 410 | } |
  |  | 411 |  |
  |  | 412 | if ( $page\_role\_login\_disable\_check == 1 || $page\_role\_login\_disable\_check == 'on' || $page\_role\_login\_disable\_check == 'true' ) { |
  |  | 413 | $page\_role\_login\_disable = 'disabled'; |
  |  | 414 | } |
  |  | 415 | $mo\_page\_val = implode( ';', $mo\_page\_roles\_value ); |
  |  | 416 | ?> |
  |  | 417 | <td> |
  |  | 418 | <input type="hidden" name="mo\_hidden\_page\_roles\_<?php echo esc\_attr( $pageid ); ?>[]" id="mo\_hidden\_page\_roles\_<?php echo esc\_attr( $pageid ); ?>" value="<?php echo esc\_attr( $mo\_page\_val ); ?>"> |
  |  | 419 | <select multiple class="roles\_multi w-100" name="mo\_page\_roles\_<?php echo esc\_attr( $pageid ); ?>[]" id="mo\_page\_roles\_<?php echo esc\_attr( $pageid ); ?>" value="<?php echo esc\_attr( $mo\_page\_val ); ?>" <?php echo esc\_attr( $page\_role\_login\_disable ); ?> onChange ="apply\_roles\_to\_child(event, <?php echo esc\_js( $pageid ); ?>)"> |
  |  | 420 | <?php |
  |  | 421 | papr\_display\_roles( $mo\_page\_roles\_value ); |
  |  | 422 | ?> |
  |  | 423 | </select> |
  |  | 424 | </td> |
  |  | 425 | <?php |
  |  | 426 | if ( $mo\_page\_search\_value == '' ) { |
  |  | 427 | ?> |
  |  | 428 | <td style="border-right-style: none;text-align:center;" scope="row" class="check-column-1"> |
  |  | 429 | <?php |
  |  | 430 | if ( count( $children ) > 0 ) { |
  |  | 431 | $mo\_page\_default\_check       = ''; |
  |  | 432 | $mo\_page\_default\_check\_value = ''; |
  |  | 433 | $hidden\_value                = 2; |
  |  | 434 |  |
  |  | 435 | if ( ! empty( $default\_role\_parent[ $pageid ] ) ) { |
  |  | 436 | $mo\_page\_default\_check\_value = $default\_role\_parent[ $pageid ]; |
  |  | 437 | } |
  |  | 438 |  |
  |  | 439 | if ( $mo\_page\_default\_check\_value == 1 || $mo\_page\_default\_check\_value == 'on' || $mo\_page\_default\_check\_value == 'true' ) { |
  |  | 440 | $mo\_page\_default\_check = 'checked'; |
  |  | 441 | $hidden\_value          = 1; |
  |  | 442 | } |
  |  | 443 | $page\_role\_login\_disable       = ''; |
  |  | 444 | $page\_role\_login\_disable\_check = ''; |
  |  | 445 | $parent\_id                     = (int) wp\_get\_post\_parent\_id( $pageid ); |
  |  | 446 |  |
  |  | 447 | if ( ! empty( $default\_role\_parent[ $parent\_id ] ) && $parent\_id != 0 ) { |
  |  | 448 | $page\_role\_login\_disable\_check = $default\_role\_parent[ $parent\_id ]; |
  |  | 449 | } |
  |  | 450 |  |
  |  | 451 | if ( $page\_role\_login\_disable\_check == 1 || $page\_role\_login\_disable\_check == 'on' || $page\_role\_login\_disable\_check == 'true' ) { |
  |  | 452 | $page\_role\_login\_disable = 'disabled'; |
  |  | 453 | } |
  |  | 454 | ?> |
  |  | 455 | <input type=hidden id="child\_list\_hidden\_<?php echo esc\_attr( $pageid ); ?>" value="<?php echo esc\_attr( $hidden\_value ); ?>"> |
  |  | 456 | <input id="mo\_page\_default\_role\_valid\_<?Php echo esc\_attr( $pageid ); ?>" name="mo\_page\_default\_role\_<?Php echo esc\_attr( $pageid ); ?>" type="checkbox" <?php echo esc\_attr( $mo\_page\_default\_check ); ?> <?php echo esc\_attr( $page\_role\_login\_disable ); ?> onChange="disable\_enable\_child(<?php echo esc\_js( $pageid ); ?>)" > |
  |  | 457 | <?php |
  |  | 458 | } |
  |  | 459 | ?> |
  |  | 460 | </td> |
  |  | 461 | <?php |
  |  | 462 | } else { |
  |  | 463 | echo '<td></td>'; |
  |  | 464 | } |
  |  | 465 | $mo\_page\_login\_check\_value = ''; |
  |  | 466 | $mo\_page\_login\_check       = ''; |
  |  | 467 |  |
  |  | 468 | if ( ! empty( $allowed\_redirect\_pages[ $pageid ] ) ) { |
  |  | 469 | $mo\_page\_login\_check\_value = $allowed\_redirect\_pages[ $pageid ]; |
  |  | 470 | } |
  |  | 471 |  |
  |  | 472 | if ( $mo\_page\_login\_check\_value == 1 || $mo\_page\_login\_check\_value == 'on' || $mo\_page\_login\_check\_value == 'true' || $default\_login\_toggle == 1 ) { |
  |  | 473 | $mo\_page\_login\_check = 'checked'; |
  |  | 474 | } |
  |  | 475 |  |
  |  | 476 | if ( $default\_login\_toggle == 1 && ! empty( $unrestricted\_pages[ $pageid ] ) ) { |
  |  | 477 | $mo\_page\_login\_check = ''; |
  |  | 478 | } |
  |  | 479 | ?> |
  |  | 480 |  |
  |  | 481 | <td style="width:200px; text-align:center; padding-left:8px;" scope="row" class="check-column"> |
  |  | 482 | <label class="screen-reader-text" for="cb-select-3"></label> |
  |  | 483 | <input id="cb-select-3" class ="mo\_page\_login\_valid\_<?php echo esc\_attr( $pageid ); ?>" name="mo\_page\_login\_<?php echo esc\_attr( $pageid ); ?>" type="checkbox" <?php echo esc\_attr( $mo\_page\_login\_check ); ?> <?php echo esc\_attr( $page\_role\_login\_disable ); ?> |
  |  | 484 | onChange="apply\_to\_child(<?php echo esc\_js( $pageid ); ?>)"> |
  |  | 485 |  |
  |  | 486 | <div class="locked-indicator"> |
  |  | 487 | <span class="locked-indicator-icon" aria-hidden="true"></span> |
  |  | 488 | <span class="screen-reader-text"></span> |
  |  | 489 | </div> |
  |  | 490 | </td> |
  |  | 491 | </tr> |
  |  | 492 | <?php |
  | 481 | 493 | } |
  | 482 | 494 |  |
  | 483 | 495 | function papr\_toggle\_all\_pages() { |
  |  | 496 | ?> |
  |  | 497 | <div class="mt-5"> |
  |  | 498 | <h5 class="papr-form-head papr-form-head-bar">Global Settings for all Pages |
  |  | 499 | <div class="papr-info-global ms-2"> |
  |  | 500 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 501 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 502 | </svg> |
  |  | 503 | <p class="papr-info-text-global"> These settings would be <b>applied to all pages</b> on this WordPress site.</p> |
  |  | 504 | </div> |
  |  | 505 | </h5> |
  |  | 506 | <form id="papr\_access\_for\_only\_loggedin" name="papr\_access\_for\_only\_loggedin" method="post" class="mt-4"> |
  |  | 507 | <?php wp\_nonce\_field( 'papr\_access\_for\_only\_loggedin' ); ?> |
  |  | 508 | <div class="row"> |
  |  | 509 | <div class="col-md-6"> |
  |  | 510 | <h6>Make all Pages Private |
  |  | 511 | <div class="papr-info-global ms-2"> |
  |  | 512 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 513 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 514 | </svg> |
  |  | 515 | <p class="papr-info-text-global"> |
  |  | 516 | Enable this toggle to <b>allow only logged in users</b> to access the pages of this WordPress site. |
  |  | 517 | </p> |
  |  | 518 | </div> |
  |  | 519 | </h6> |
  |  | 520 | </div> |
  |  | 521 | <div class="col-md-4"> |
  |  | 522 | <input type="hidden" name="option" value="papr\_access\_for\_only\_loggedin"> |
  |  | 523 | <label class="switch"> |
  |  | 524 | <input type="checkbox" id="logged\_in" name="papr\_access\_for\_only\_loggedin" |
  |  | 525 | <?php |
  |  | 526 | if ( get\_site\_option( 'papr\_access\_for\_only\_loggedin' ) == 1 ) { |
  |  | 527 | echo ' checked '; |
  |  | 528 | } |
  |  | 529 | ?> |
  |  | 530 | onChange="document.getElementById('papr\_access\_for\_only\_loggedin').submit()"> |
  |  | 531 | <span class="slider round"></span> |
  |  | 532 | </label> |
  |  | 533 | </div> |
  |  | 534 | </div> |
  |  | 535 | </form> |
  |  | 536 | <form id="papr\_default\_role\_parent\_page\_toggle" name="papr\_default\_role\_parent\_page\_toggle" method="post" class="mt-4"> |
  |  | 537 | <?php wp\_nonce\_field( 'papr\_default\_role\_parent\_page\_toggle' ); ?> |
  |  | 538 | <div class="row"> |
  |  | 539 | <div class="col-md-6"> |
  |  | 540 | <h6>Auto-assign Parent Configurations to all Child Pages |
  |  | 541 | <div class="papr-info-global ms-2"> |
  |  | 542 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 543 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 544 | </svg> |
  |  | 545 | <p class="papr-info-text-global"> |
  |  | 546 | Enable this toggle to apply the restrictions of the parent pages to their respective child pages. |
  |  | 547 | </p> |
  |  | 548 | </div> |
  |  | 549 | </h6> |
  |  | 550 | </div> |
  |  | 551 | <div class="col-md-4"> |
  |  | 552 | <input type="hidden" name="option" value="papr\_default\_role\_parent\_page\_toggle"> |
  |  | 553 | <label class="switch"> |
  |  | 554 | <input type="checkbox" id="default\_role\_toggle" name="papr\_default\_role\_parent\_page\_toggle" |
  |  | 555 | <?php |
  |  | 556 | if ( get\_site\_option( 'papr\_default\_role\_parent\_page\_toggle' ) == 1 ) { |
  |  | 557 | echo 'checked '; |
  |  | 558 | } |
  |  | 559 | ?> |
  |  | 560 | onChange = "document.getElementById('papr\_default\_role\_parent\_page\_toggle').submit()"> |
  |  | 561 | <span class="slider round"></span> |
  |  | 562 | </label> |
  |  | 563 | </div> |
  |  | 564 | </div> |
  |  | 565 | </form> |
  |  | 566 | </div> |
  |  | 567 | <?php |
  |  | 568 | } |
  |  | 569 |  |
  |  | 570 | function papr\_restriction\_behaviour\_pages() { |
  |  | 571 | ?> |
  |  | 572 | </br> |
  |  | 573 | <div class="row"> |
  |  | 574 | <div class="col-md-6"> |
  |  | 575 | <h6>Configure the Restriction Behavior |
  |  | 576 | <div class="papr-info-global ms-2"> |
  |  | 577 | <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16"> |
  |  | 578 | <path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/> |
  |  | 579 | </svg> |
  |  | 580 | <p class="papr-info-text-global"> |
  |  | 581 | Configure what the restricted users should be shown when a restricted page/post is accessed. |
  |  | 582 | </p> |
  |  | 583 | </div> |
  |  | 584 | </h6> |
  |  | 585 | </div> |
  |  | 586 | <div class="col-md-4"> |
  |  | 587 | <a href="#restricted\_behaviour" style="color:#fff; text-decoration:none;"><button class="papr-btn-cstm" style="border-radius: 2.25rem;">Click here!</button></a> |
  |  | 588 | </div> |
  |  | 589 | </div> |
  |  | 590 | <?php |
  |  | 591 | } |
  |  | 592 |  |
  |  | 593 | function papr\_display\_roles( $mo\_type\_roles\_value ) { |
  |  | 594 | global $wp\_roles; |
  |  | 595 | $roles = $wp\_roles->roles; |
  |  | 596 | foreach ( $roles as $key => $val ) { |
  |  | 597 | $role\_exist = -1; |
  |  | 598 | if ( is\_array( $mo\_type\_roles\_value ) ) { |
  |  | 599 | $role\_exist = array\_search( $key, $mo\_type\_roles\_value ); |
  |  | 600 | $role\_exist++; // to make work in php7.4 |
  |  | 601 | } |
  |  | 602 | echo '<option value="' . esc\_attr( $key ) . '"'; |
  |  | 603 | if ( $role\_exist >= 0 && $role\_exist != '' ) { |
  |  | 604 | echo ' selected '; |
  |  | 605 | } |
  |  | 606 | echo '>' . esc\_html( $key ) . '</option>'; |
  |  | 607 | } |
  |  | 608 | } |
  |  | 609 |  |
  |  | 610 | function papr\_add\_query\_arg( $url ) { |
  |  | 611 | if ( strpos( $url, 'premium\_plan' ) !== false ) { |
  |  | 612 | $url = str\_replace( 'premium\_plan', 'account\_setup', $url ); |
  |  | 613 | } |
  |  | 614 | return $url; |
  |  | 615 | } |
  |  | 616 |  |
  |  | 617 | function papr\_check\_option\_admin\_referer( $option\_name ) { |
  |  | 618 | return ( isset( $\_POST['option'] ) and $\_POST['option'] == $option\_name and check\_admin\_referer( $option\_name ) ); |
  |  | 619 | } |
  |  | 620 |  |
  |  | 621 | function papr\_message\_success\_fail() { |
  |  | 622 | $papr\_message\_success\_fail = get\_option( 'papr\_message\_success\_fail' ); |
  |  | 623 | $style                     = ''; |
  |  | 624 | if ( $papr\_message\_success\_fail == 'success' ) { |
  |  | 625 | $style = 'border-left-color: green ; background-color:#90ee9096 !important; overflow:auto;'; |
  |  | 626 | } elseif ( $papr\_message\_success\_fail == 'error' ) { |
  |  | 627 | $style = 'border-left-color: red ; background-color:#ff7f7f63 !important; overflow:auto;'; |
  |  | 628 | } |
  |  | 629 |  |
  |  | 630 | $papr\_message = get\_option( 'papr\_message' ); |
  |  | 631 | if ( $papr\_message != '' ) { |
  |  | 632 | echo ' |
  |  | 633 | <div class="rounded bg-white papr-shadow p-2 pt-1 mt-4 ms-4" style="border-left-style: solid;' . $style . '"> |
  |  | 634 | ' . $papr\_message . ' |
  |  | 635 | </div>'; |
  |  | 636 | } |
  |  | 637 | delete\_option( 'papr\_message' ); |
  |  | 638 | delete\_option( 'papr\_message\_success\_fail' ); |
  |  | 639 | } |
  |  | 640 |  |
  | 484 | 641 | ?> |
  | 485 |  | ~~<div class="mt-5">~~ |
  | 486 |  | ~~<h5 class="papr-form-head papr-form-head-bar">Global Settings for all Pages~~ |
  | 487 |  | ~~<div class="papr-info-global ms-2">~~ |
  | 488 |  | ~~<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">~~ |
  | 489 |  | ~~<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>~~ |
  | 490 |  | ~~</svg>~~ |
  | 491 |  | ~~<p class="papr-info-text-global"> These settings would be <b>applied to all pages</b> on this WordPress site.</p>~~ |
  | 492 |  | ~~</div>~~ |
  | 493 |  | ~~</h5>~~ |
  | 494 |  | ~~<form id="papr\_access\_for\_only\_loggedin" name="papr\_access\_for\_only\_loggedin" method="post" class="mt-4">~~ |
  | 495 |  | ~~<?php wp\_nonce\_field('papr\_access\_for\_only\_loggedin'); ?>~~ |
  | 496 |  | ~~<div class="row">~~ |
  | 497 |  | ~~<div class="col-md-6">~~ |
  | 498 |  | ~~<h6>Make all Pages Private~~ |
  | 499 |  | ~~<div class="papr-info-global ms-2">~~ |
  | 500 |  | ~~<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">~~ |
  | 501 |  | ~~<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>~~ |
  | 502 |  | ~~</svg>~~ |
  | 503 |  | ~~<p class="papr-info-text-global">~~ |
  | 504 |  | ~~Enable this toggle to <b>allow only logged in users</b> to access the pages of this WordPress site.~~ |
  | 505 |  | ~~</p>~~ |
  | 506 |  | ~~</div>~~ |
  | 507 |  | ~~</h6>~~ |
  | 508 |  | ~~</div>~~ |
  | 509 |  | ~~<div class="col-md-4">~~ |
  | 510 |  | ~~<input type="hidden" name="option" value="papr\_access\_for\_only\_loggedin">~~ |
  | 511 |  | ~~<label class="switch">~~ |
  | 512 |  | ~~<input type="checkbox" id="logged\_in" name="papr\_access\_for\_only\_loggedin"~~ |
  | 513 |  | ~~<?php~~ |
  | 514 |  | ~~if (get\_site\_option('papr\_access\_for\_only\_loggedin') == 1)~~ |
  | 515 |  | ~~echo ' checked ';~~ |
  | 516 |  | ~~?>~~ |
  | 517 |  | ~~onChange="document.getElementById('papr\_access\_for\_only\_loggedin').submit()">~~ |
  | 518 |  | ~~<span class="slider round"></span>~~ |
  | 519 |  | ~~</label>~~ |
  | 520 |  | ~~</div>~~ |
  | 521 |  | ~~</div>~~ |
  | 522 |  | ~~</form>~~ |
  | 523 |  | ~~<form id="papr\_default\_role\_parent\_page\_toggle" name="papr\_default\_role\_parent\_page\_toggle" method="post" class="mt-4">~~ |
  | 524 |  | ~~<?php wp\_nonce\_field('papr\_default\_role\_parent\_page\_toggle'); ?>~~ |
  | 525 |  | ~~<div class="row">~~ |
  | 526 |  | ~~<div class="col-md-6">~~ |
  | 527 |  | ~~<h6>Auto-assign Parent Configurations to all Child Pages~~ |
  | 528 |  | ~~<div class="papr-info-global ms-2">~~ |
  | 529 |  | ~~<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">~~ |
  | 530 |  | ~~<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>~~ |
  | 531 |  | ~~</svg>~~ |
  | 532 |  | ~~<p class="papr-info-text-global">~~ |
  | 533 |  | ~~Enable this toggle to apply the restrictions of the parent pages to their respective child pages.~~ |
  | 534 |  | ~~</p>~~ |
  | 535 |  | ~~</div>~~ |
  | 536 |  | ~~</h6>~~ |
  | 537 |  | ~~</div>~~ |
  | 538 |  | ~~<div class="col-md-4">~~ |
  | 539 |  | ~~<input type="hidden" name="option" value="papr\_default\_role\_parent\_page\_toggle">~~ |
  | 540 |  | ~~<label class="switch">~~ |
  | 541 |  | ~~<input type="checkbox" id="default\_role\_toggle" name="papr\_default\_role\_parent\_page\_toggle"~~ |
  | 542 |  | ~~<?php~~ |
  | 543 |  | ~~if (get\_site\_option('papr\_default\_role\_parent\_page\_toggle') == 1)~~ |
  | 544 |  | ~~echo 'checked ';~~ |
  | 545 |  | ~~?>~~ |
  | 546 |  | ~~onChange = "document.getElementById('papr\_default\_role\_parent\_page\_toggle').submit()">~~ |
  | 547 |  | ~~<span class="slider round"></span>~~ |
  | 548 |  | ~~</label>~~ |
  | 549 |  | ~~</div>~~ |
  | 550 |  | ~~</div>~~ |
  | 551 |  | ~~</form>~~ |
  | 552 |  | ~~</div>~~ |
  | 553 |  | ~~<?php~~ |
  | 554 |  | ~~}~~ |
  | 555 |  |  |
  | 556 |  | ~~function papr\_restriction\_behaviour\_pages(){~~ |
  | 557 |  | ~~?>~~ |
  | 558 |  | ~~</br>~~ |
  | 559 |  | ~~<div class="row">~~ |
  | 560 |  | ~~<div class="col-md-6">~~ |
  | 561 |  | ~~<h6>Configure the Restriction Behavior~~ |
  | 562 |  | ~~<div class="papr-info-global ms-2">~~ |
  | 563 |  | ~~<svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" class="bi bi-info-circle-fill" viewBox="0 0 16 16">~~ |
  | 564 |  | ~~<path d="M8 16A8 8 0 1 0 8 0a8 8 0 0 0 0 16zm.93-9.412-1 4.705c-.07.34.029.533.304.533.194 0 .487-.07.686-.246l-.088.416c-.287.346-.92.598-1.465.598-.703 0-1.002-.422-.808-1.319l.738-3.468c.064-.293.006-.399-.287-.47l-.451-.081.082-.381 2.29-.287zM8 5.5a1 1 0 1 1 0-2 1 1 0 0 1 0 2z"/>~~ |
  | 565 |  | ~~</svg>~~ |
  | 566 |  | ~~<p class="papr-info-text-global">~~ |
  | 567 |  | ~~Configure what the restricted users should be shown when a restricted page/post is accessed.~~ |
  | 568 |  | ~~</p>~~ |
  | 569 |  | ~~</div>~~ |
  | 570 |  | ~~</h6>~~ |
  | 571 |  | ~~</div>~~ |
  | 572 |  | ~~<div class="col-md-4">~~ |
  | 573 |  | ~~<a href="#restricted\_behaviour" style="color:#fff; text-decoration:none;"><button class="papr-btn-cstm" style="border-radius: 2.25rem;">Click here!</button></a>~~ |
  | 574 |  | ~~</div>~~ |
  | 575 |  | ~~</div>~~ |
  | 576 |  | ~~<?php~~ |
  | 577 |  | ~~}~~ |
  | 578 |  |  |
  | 579 |  | ~~function papr\_display\_roles($mo\_type\_roles\_value){~~ |
  | 580 |  | ~~global $wp\_roles;~~ |
  | 581 |  | ~~$roles = $wp\_roles->roles;~~ |
  | 582 |  | ~~foreach ($roles as $key => $val) {~~ |
  | 583 |  | ~~$role\_exist = -1;~~ |
  | 584 |  | ~~if(is\_array($mo\_type\_roles\_value)){~~ |
  | 585 |  | ~~$role\_exist = array\_search($key, $mo\_type\_roles\_value);~~ |
  | 586 |  | ~~$role\_exist++; // to make work in php7.4~~ |
  | 587 |  | ~~}~~ |
  | 588 |  | ~~echo '<option value="' . esc\_attr($key) . '"';~~ |
  | 589 |  | ~~if ($role\_exist>=0 && $role\_exist!='') {~~ |
  | 590 |  | ~~echo ' selected ';~~ |
  | 591 |  | ~~}~~ |
  | 592 |  | ~~echo '>' . esc\_html($key) . '</option>';~~ |
  | 593 |  | ~~}~~ |
  | 594 |  | ~~}~~ |
  | 595 |  |  |
  | 596 |  | ~~function papr\_add\_query\_arg($url){~~ |
  | 597 |  | ~~if(strpos($url, 'premium\_plan') !== false){~~ |
  | 598 |  | ~~$url = str\_replace('premium\_plan', 'account\_setup', $url);~~ |
  | 599 |  | ~~}~~ |
  | 600 |  | ~~return $url;~~ |
  | 601 |  | ~~}~~ |
  | 602 |  |  |
  | 603 |  | ~~function papr\_check\_option\_admin\_referer($option\_name){~~ |
  | 604 |  | ~~return (isset($\_POST['option']) and $\_POST['option']==$option\_name and check\_admin\_referer($option\_name));~~ |
  | 605 |  | ~~}~~ |
  | 606 |  |  |
  | 607 |  | ~~function papr\_message\_success\_fail(){~~ |
  | 608 |  | ~~$papr\_message\_success\_fail = get\_option('papr\_message\_success\_fail');~~ |
  | 609 |  | ~~$style = '';~~ |
  | 610 |  | ~~if($papr\_message\_success\_fail == 'success'){~~ |
  | 611 |  | ~~$style = 'border-left-color: green ; background-color:#90ee9096 !important; overflow:auto;';~~ |
  | 612 |  | ~~} else if($papr\_message\_success\_fail == 'error') {~~ |
  | 613 |  | ~~$style = 'border-left-color: red ; background-color:#ff7f7f63 !important; overflow:auto;';~~ |
  | 614 |  | ~~}~~ |
  | 615 |  |  |
  | 616 |  | ~~$papr\_message = get\_option('papr\_message');~~ |
  | 617 |  | ~~if($papr\_message != ''){~~ |
  | 618 |  | ~~echo '~~ |
  | 619 |  | ~~<div class="rounded bg-white papr-shadow p-2 pt-1 mt-4 ms-4" style="border-left-style: solid;'.$style.'">~~ |
  | 620 |  | ~~'.$papr\_message.'~~ |
  | 621 |  | ~~</div>';~~ |
  | 622 |  | ~~}~~ |
  | 623 |  | ~~delete\_option('papr\_message');~~ |
  | 624 |  | ~~delete\_option('papr\_message\_success\_fail');~~ |
  | 625 |  | ~~}~~ |
  | 626 |  |  |
  | 627 |  | ~~?>~~ |
* ## [page-and-post-restriction/trunk/readme.txt](/changeset/3034414/page-and-post-restriction/trunk/readme.txt "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/readme.txt")

  | [r2866879](/browser/page-and-post-restriction/trunk/readme.txt?rev=2866879#L3 "Show revision 2866879 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/readme.txt?rev=3034414#L3 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | Donate link: https://miniorange.com |
  | 4 | 4 | Tags: Content Restriction, Page Restriction, Restrict content, Post restriction, Restrict access, Logged-in, Restrict pages, Restrict posts, content access, restrict user, content control, protect content |
  | 5 |  | Tested up to: 6.~~1~~ |
  |  | 5 | Tested up to: 6.4 |
  | 6 | 6 | Requires PHP: 5.4 |
  | 7 | 7 | Requires at least: 3.7 |
  | 8 |  | Stable tag: 1.3.~~4~~ |
  |  | 8 | Stable tag: 1.3.5 |
  | 9 | 9 | License: MIT/Expat |
  | 10 | 10 | License URI: https://docs.miniorange.com/mit-license |
  | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=2866879#L17) | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=3034414#L17) |  |
  | 17 | 17 | Content Restriction provide control of the entire content of your WordPress sites. This includes Page Restriction and Post Restriction i.e. Content restriction according to User Roles. You can Protect content by setting consent for single-entity users on WordPress sites based on their roles. Here a user role has permission to access a page; the authorization enables access to that user. By default, all roles will have access to the content of the page. |
  | 18 | 18 | Page Restriction provides page protection by allowing content access to only Logged In Users to specific or all pages. Restrict access of your pages to logged-out users by showing them an error message letting them know they do not have permission to look into the content on the particular page. |
  |  | 19 | \*\*Please note this plugin doesnot protect REST API Endpoints. You can protect your REST APIs using our REST API Authentication Plugin.\*\* |
  |  | 20 |  |
  | 19 | 21 |  |
  | 20 | 22 | Besides Page Restrictions, we also provide Post Restrictions (Content restriction) feature which helps to Protect content by Restricting access for posts on logged-in/out status to users or specific user roles. Our WordPress Post restrictions feature also helps you to Restrict access in categories to logged-in/out users or specific user roles. We Display a custom message to users who do not have permission to view the content or redirect them to a specified URL. In our Page restriction, Post restriction Plugin our Individual Posts feature will enable protection for default posts as well as custom post types. |
  | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=2866879#L116) | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=3034414#L118) |  |
  | 116 | 118 | == Changelog == |
  | 117 | 119 |  |
  |  | 120 | = 1.3.5 = |
  |  | 121 | \* Adding a note for REST API Authentication |
  |  | 122 | \* Other code Improvements |
  |  | 123 |  |
  | 118 | 124 | = 1.3.4 = |
  | 119 | 125 | \* Minor Bug fixes |
  | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=2866879#L199) | […](/browser/page-and-post-restriction/trunk/readme.txt?rev=3034414#L205) |  |
  | 199 | 205 | == Upgrade Notice == |
  | 200 | 206 |  |
  |  | 207 | = 1.3.5 = |
  |  | 208 | \* Adding a note for REST API Authentication |
  |  | 209 | \* Other code Improvements |
  |  | 210 |  |
  | 201 | 211 | = 1.3.4 = |
  | 202 | 212 | \* Minor Bug fixes |
* ## [page-and-post-restriction/trunk/uninstall.php](/changeset/3034414/page-and-post-restriction/trunk/uninstall.php "Show the changeset 3034414 restricted to page-and-post-restriction/trunk/uninstall.php")

  | [r2751531](/browser/page-and-post-restriction/trunk/uninstall.php?rev=2751531#L1 "Show revision 2751531 of this file in browser") | [r3034414](/browser/page-and-post-restriction/trunk/uninstall.php?rev=3034414#L1 "Show revision 3034414 of this file in browser") |  |
  | --- | --- | --- |
  | 1 | 1 | <?php |
  | 2 | 2 |  |
  | 3 |  | if ( !~~defined( 'WP\_UNINSTALL\_PLUGIN' ) )~~ |
  |  | 3 | if ( ! defined( 'WP\_UNINSTALL\_PLUGIN' ) ) { |
  | 4 | 4 | exit(); |
  |  | 5 | } |
  | 5 | 6 |  |
  | 6 |  | delete\_option('papr\_admin\_email'); |
  | 7 |  | delete\_option('papr\_admin\_customer\_key'); |
  | 8 |  | delete\_option('papr\_host\_name'); |
  | 9 |  | delete\_option('papr\_new\_registration'); |
  | 10 |  | delete\_option('papr\_admin\_phone'); |
  | 11 |  | delete\_option('papr\_admin\_password'); |
  | 12 |  | delete\_option('papr\_admin\_customer\_key'); |
  | 13 |  | delete\_option('papr\_admin\_api\_key'); |
  | 14 |  | delete\_option('papr\_customer\_token'); |
  | 15 |  | delete\_option('papr\_message'); |
  | 16 |  | delete\_option('papr\_allowed\_roles\_for\_pages'); |
  | 17 |  | delete\_option('papr\_restricted\_pages'); |
  | 18 |  | delete\_option('papr\_allowed\_roles\_for\_posts'); |
  | 19 |  | delete\_option('papr\_restricted\_posts'); |
  | 20 |  | delete\_option('papr\_allowed\_redirect\_for\_pages'); |
  | 21 |  | delete\_option('papr\_allowed\_redirect\_for\_posts'); |
  | 22 |  | delete\_option('papr\_login\_unrestricted\_pages'); |
  | 23 |  | delete\_option('papr\_default\_role\_parent'); |
  | 24 |  | delete\_option('papr\_login\_unrestricted\_posts'); |
  | 25 |  | delete\_option('papr\_page\_search\_value'); |
  | 26 |  | delete\_option('papr\_post\_search\_value'); |
  | 27 |  | delete\_option('papr\_post\_type'); |
  | 28 |  | delete\_option('papr\_default\_role\_parent\_page\_toggle'); |
  | 29 |  | delete\_option('papr\_access\_for\_only\_loggedin'); |
  | 30 |  | delete\_option('papr\_access\_for\_only\_loggedin\_posts'); |
  | 31 |  | delete\_option('papr\_results\_per\_page'); |
  | 32 |  | delete\_option('papr\_post\_per\_page'); |
  | 33 |  | delete\_option('papr\_category\_per\_page'); |
  | 34 |  | delete\_option('papr\_guest\_enabled'); |
  | 35 |  |  |
  | 36 |  | ?> |
  |  | 7 | delete\_option( 'papr\_admin\_email' ); |
  |  | 8 | delete\_option( 'papr\_admin\_customer\_key' ); |
  |  | 9 | delete\_option( 'papr\_host\_name' ); |
  |  | 10 | delete\_option( 'papr\_new\_registration' ); |
  |  | 11 | delete\_option( 'papr\_admin\_phone' ); |
  |  | 12 | delete\_option( 'papr\_admin\_password' ); |
  |  | 13 | delete\_option( 'papr\_admin\_customer\_key' ); |
  |  | 14 | delete\_option( 'papr\_admin\_api\_key' ); |
  |  | 15 | delete\_option( 'papr\_customer\_token' ); |
  |  | 16 | delete\_option( 'papr\_message' ); |
  |  | 17 | delete\_option( 'papr\_allowed\_roles\_for\_pages' ); |
  |  | 18 | delete\_option( 'papr\_restricted\_pages' ); |
  |  | 19 | delete\_option( 'papr\_allowed\_roles\_for\_posts' ); |
  |  | 20 | delete\_option( 'papr\_restricted\_posts' ); |
  |  | 21 | delete\_option( 'papr\_allowed\_redirect\_for\_pages' ); |
  |  | 22 | delete\_option( 'papr\_allowed\_redirect\_for\_posts' ); |
  |  | 23 | delete\_option( 'papr\_login\_unrestricted\_pages' ); |
  |  | 24 | delete\_option( 'papr\_default\_role\_parent' ); |
  |  | 25 | delete\_option( 'papr\_login\_unrestricted\_posts' ); |
  |  | 26 | delete\_option( 'papr\_page\_search\_value' ); |
  |  | 27 | delete\_option( 'papr\_post\_search\_value' ); |
  |  | 28 | delete\_option( 'papr\_post\_type' ); |
  |  | 29 | delete\_option( 'papr\_default\_role\_parent\_page\_toggle' ); |
  |  | 30 | delete\_option( 'papr\_access\_for\_only\_loggedin' ); |
  |  | 31 | delete\_option( 'papr\_access\_for\_only\_loggedin\_posts' ); |
  |  | 32 | delete\_option( 'papr\_results\_per\_page' ); |
  |  | 33 | delete\_option( 'papr\_post\_per\_page' ); |
  |  | 34 | delete\_option( 'papr\_category\_per\_page' ); |
  |  | 35 | delete\_option( 'papr\_guest\_enabled' ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3034414)
* [Zip Archive](?format=zip&new=3034414)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


