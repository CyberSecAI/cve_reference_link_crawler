

[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Maintainer can leak sentry token by changing the configured URL (fix bypass)

⚠ **Please read [the process](https://gitlab.com/gitlab-org/release/docs/-/blob/master/general/security/developer.md) on how to fix security issues before starting to work on the issue. Vulnerabilities must be fixed in a security mirror.**

**[HackerOne report #2104591](https://hackerone.com/reports/2104591)** by `70rpedo` on 2023-08-09, assigned to [@nmalcolm](/nmalcolm "Nick Malcolm"):

[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)

## Report

##### Summary

I was just reading a disclosed issue and found a bypass to leak sentry token.

Note: This is a bypass of the patch made to this [ISSUE](https://gitlab.com/gitlab-org/gitlab/-/issues/385193 "Maintainer can leak sentry token by changing the configured URL")

The patch is simply checking if the url is changed by the following in app/services/error\_tracking/list\_projects\_service.rb:

```
url_changed = !setting.api_url&.start_with?(params[:api_host])
```

There is a security flaw in the above. Suppose for example, If a user host sentry server on example.com and attacker can obtain the example.co domain then he can easily leak the sentry token. This works because example.com starts with example.co

I have tested this using a burp collaborator link like the bellow

<https://j5pruznnwl0raw6uptejk2wksby3ms.oastify.computer> --> <https://j5pruznnwl0raw6uptejk2wksby3ms.oastify.com>

##### Steps to reproduce

Requirements: we need to create two user account on gitlab.com like for example User A and UserB

1. Log in to Gitlab.com as UserA.
2. Create a project.
3. Go to <https://gitlab.com/GROUPNAME/PROJECTNAME/-/settings/operations>
4. Expand ´Error tracking and click Sentry
5. Configure with the server `https://yourburpcolaburl.computer` (this is a fake server that will let you add it with any token)
6. Add a random token and click on save.
7. invite UserB as maintainer of the project.
8. Now login as UserB in gitlab.com
9. Click on the project and change the sentry server url to  `https://yourburpcolaburl.com`
10. Now click connect (do not click save)
11. Check your server and you should see a request containing the token.

[![step.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/b127d34ee41e39e28ac345750d32a536d4f70826/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63396133346533362d366166302d343537352d623566372d3265633131373364393236642f737465702e706e67)

[![Burp_Collaborator_client_001.png](data:image/gif;base64...)](https://user-content.gitlab-static.net/5fc9da64af8bb73f9475d90253b6147c002ad6d9/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f37623538313861662d346439372d343634312d386261332d3662366339366133663331622f427572705f436f6c6c61626f7261746f725f636c69656e745f3030312e706e67)

##### CVSS

I think sentry token leak is enough to give the impact of confidentiality High and Integrity Low as the token will have both read and write access. As well as scope changed. The fact that the user needs to be a maintainer makes access required High. Feel free to modify this score if needed.

##### What is the current *bug* behavior?

The old token is sent with a connect request even if the URL has changed

##### What is the expected *correct* behavior?

Changing the URL should require adding a new token even for connect requests

##### Relevant logs and/or screenshots

[Burp\_Collaborator\_client\_001.png](https://h1.sec.gitlab.net/a/7b5818af-4d97-4641-8ba3-6b6c96a3f31b/Burp_Collaborator_client_001.png)

[step.png](https://h1.sec.gitlab.net/a/c9a34e36-6af0-4575-b5f7-2ec1173d926d/step.png)

#### Impact

Other users can leak the configured Sentry token, getting access to the sentry server. The token gives read and write access to the Sentry instance

## Attachments

**Warning:** Attachments received through HackerOne, please exercise caution!

* [Burp\_Collaborator\_client\_001.png](https://h1.sec.gitlab.net/a/7b5818af-4d97-4641-8ba3-6b6c96a3f31b/Burp_Collaborator_client_001.png)
* [step.png](https://h1.sec.gitlab.net/a/c9a34e36-6af0-4575-b5f7-2ec1173d926d/step.png)

## How To Reproduce

Please add [reproducibility information](https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues) to this section:

Edited Aug 15, 2023 by [Nick Malcolm](/nmalcolm)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.

