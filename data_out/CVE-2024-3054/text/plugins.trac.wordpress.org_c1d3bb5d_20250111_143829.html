

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3067224%2540wpvivid-backuprestore%26old%3D3067224%2540wpvivid-backuprestore)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3057908/wpvivid-backuprestore "Changeset 3057908 for wpvivid-backuprestore")
* [Next Change](/changeset/3067226/wpvivid-backuprestore "Changeset 3067226 for wpvivid-backuprestore") →

---

# Changeset [3067224](/changeset/3067224 "Show full changeset") for [wpvivid-backuprestore](/browser/wpvivid-backuprestore?rev=3067224 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
04/09/2024 12:19:56 AM
([9 months](/timeline?from=2024-04-09T00%3A19%3A56Z&precision=second "See timeline at 04/09/2024 12:19:56 AM") ago)

Author:
wpvivid
Message:

update for backup trunk 0.9.100

Location:
[wpvivid-backuprestore/trunk](/browser/wpvivid-backuprestore/trunk?rev=3067224)
Files:

6 edited

* [includes/class-wpvivid.php](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224 "Show entry in browser")
  (modified)
  ([8 diffs](#file0 "Show differences"))
* [includes/new\_backup/class-wpvivid-restore-db-2.php](/browser/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php?rev=3067224 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [includes/staging/class-wpvivid-staging-ui-display.php](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php?rev=3067224 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [includes/staging/class-wpvivid-staging.php](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php?rev=3067224 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [readme.txt](/browser/wpvivid-backuprestore/trunk/readme.txt?rev=3067224 "Show entry in browser")
  (modified)
  ([previous](/browser/wpvivid-backuprestore/trunk/readme.txt?rev=3057905 "Show previous version in browser"))
* [wpvivid-backuprestore.php](/browser/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php?rev=3067224 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wpvivid-backuprestore/trunk/includes/class-wpvivid.php](/changeset/3067224/wpvivid-backuprestore/trunk/includes/class-wpvivid.php "Show the changeset 3067224 restricted to wpvivid-backuprestore/trunk/includes/class-wpvivid.php")

  | [r3057905](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L3129 "Show revision 3057905 of this file in browser") | [r3067224](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L3129 "Show revision 3067224 of this file in browser") |  |
  | --- | --- | --- |
  | 3129 | 3129 | die(); |
  | 3130 | 3130 | } |
  | 3131 |  | $json = ~~sanitize\_text\_field($\_POST['remote'])~~; |
  |  | 3131 | $json = $\_POST['remote']; |
  | 3132 | 3132 | $json = stripslashes($json); |
  | 3133 | 3133 | $remote\_options = json\_decode($json, true); |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6624) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6624) |  |
  | 6624 | 6624 | } |
  | 6625 | 6625 |  |
  |  | 6626 | $backup\_size=0; |
  | 6626 | 6627 | $backup\_time=$value['create\_time']; |
  | 6627 | 6628 | if(isset($value['backup']['files'])){ |
  | 6628 | 6629 | foreach ($value['backup']['files'] as $file\_info){ |
  |  | 6630 | $backup\_size+=$file\_info['size']; |
  | 6629 | 6631 | if(preg\_match('/[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]{2}-[0-9]{2}/',$file\_info['file\_name'],$matches)) |
  | 6630 | 6632 | { |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6641) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6643) |  |
  | 6641 | 6643 | $backup\_time=strtotime($time); |
  | 6642 | 6644 | } |
  | 6643 |  | break; |
  |  | 6645 | //break; |
  | 6644 | 6646 | } |
  | 6645 | 6647 | } |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6699) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6701) |  |
  | 6699 | 6701 | <div style="float:left;padding:10px 10px 10px 0;">' . $remote\_pic\_html . '</div> |
  | 6700 | 6702 | </td> |
  |  | 6703 |  |
  | 6701 | 6704 | <td class="tablelistcolumn" style="min-width:100px;"> |
  | 6702 | 6705 | <div id="wpvivid\_file\_part\_' .$key . '" style="float:left;padding:10px 10px 10px 0;"> |
  | 6703 | 6706 | <div style="cursor:pointer;" onclick="wpvivid\_initialize\_download(\'' . $key . '\', \'' . $list\_name . '\');" title="'. esc\_html\_\_('Prepare to download the backup', 'wpvivid-backuprestore') .'"> |
  | 6704 |  | <img id="wpvivid\_download\_btn\_' . $key . '" src="' . esc\_url(WPVIVID\_PLUGIN\_URL . '/admin/partials/images/download.png') . '" style="vertical-align:middle;" /><span>' . \_\_('Download', 'wpvivid-backuprestore') . '</span> |
  |  | 6707 | <img id="wpvivid\_download\_btn\_' . $key . '" src="' . esc\_url(WPVIVID\_PLUGIN\_URL . '/admin/partials/images/download.png') . '" style="vertical-align:middle;" /><span>' . \_\_('Download', 'wpvivid-backuprestore') . ' (' . esc\_html(size\_format($backup\_size, 2)) . ')' .'</span> |
  | 6705 | 6708 | <div class="spinner" id="wpvivid\_download\_loading\_' . $key . '" style="float:right;width:auto;height:auto;padding:10px 180px 10px 0;background-position:0 0;"></div> |
  | 6706 | 6709 | </div> |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6762) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6765) |  |
  | 6762 | 6765 | } |
  | 6763 | 6766 |  |
  |  | 6767 | $backup\_size=0; |
  | 6764 | 6768 | $backup\_time=$value['create\_time']; |
  | 6765 | 6769 | if(isset($value['backup']['files'])){ |
  | 6766 | 6770 | foreach ($value['backup']['files'] as $file\_info){ |
  |  | 6771 | $backup\_size+=$file\_info['size']; |
  | 6767 | 6772 | if(preg\_match('/[0-9]{4}-[0-9]{2}-[0-9]{2}-[0-9]{2}-[0-9]{2}/',$file\_info['file\_name'],$matches)) |
  | 6768 | 6773 | { |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6779) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6784) |  |
  | 6779 | 6784 | $backup\_time=strtotime($time); |
  | 6780 | 6785 | } |
  | 6781 |  | break; |
  |  | 6786 | //break; |
  | 6782 | 6787 | } |
  | 6783 | 6788 | } |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6794) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6799) |  |
  | 6794 | 6799 | <img src="<?php echo esc\_url(WPVIVID\_PLUGIN\_URL . $backup\_lock); ?>" name="<?php echo esc\_attr($lock\_status); ?>" onclick="wpvivid\_set\_backup\_lock('<?php echo esc\_js($key); ?>', '<?php echo esc\_js($lock\_status); ?>');" style="vertical-align:middle; cursor:pointer;"/> |
  | 6795 | 6800 | </span> |
  | 6796 |  | <span style="margin:0;">|</span> <span><?php esc\_html\_e('Type: ', 'wpvivid-backuprestore'); ?>~~'~~</span><span><?php echo esc\_html($value['type']); ?></span> |
  |  | 6801 | <span style="margin:0;">|</span> <span><?php esc\_html\_e('Type: ', 'wpvivid-backuprestore'); ?></span><span><?php echo esc\_html($value['type']); ?></span> |
  | 6797 | 6802 | <span style="margin:0;">|</span> <span title="Backup log"><a href="#" onclick="wpvivid\_read\_log('wpvivid\_view\_backup\_log', '<?php echo esc\_js($key); ?>');"><img src="<?php echo esc\_url(WPVIVID\_PLUGIN\_URL.'/admin/partials/images/Log.png'); ?>" style="vertical-align:middle;cursor:pointer;"/><span style="margin:0;"><?php esc\_html\_e('Log', 'wpvivid-backuprestore'); ?></span></a></span> |
  | 6798 | 6803 | </div> |
  | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3057905#L6836) | […](/browser/wpvivid-backuprestore/trunk/includes/class-wpvivid.php?rev=3067224#L6841) |  |
  | 6836 | 6841 | <div id="wpvivid\_file\_part\_<?php echo esc\_attr($key); ?>" style="float:left;padding:10px 10px 10px 0;"> |
  | 6837 | 6842 | <div style="cursor:pointer;" onclick="wpvivid\_initialize\_download('<?php echo esc\_js($key); ?>', '<?php echo esc\_js($list\_name); ?>');" title="<?php esc\_attr\_e('Prepare to download the backup', 'wpvivid-backuprestore'); ?>"> |
  | 6838 |  | <img id="wpvivid\_download\_btn\_<?php echo esc\_attr($key); ?>" src="<?php echo esc\_url(WPVIVID\_PLUGIN\_URL.'/admin/partials/images/download.png'); ?>" style="vertical-align:middle;" /><span><?php esc\_html\_e('Download', 'wpvivid-backuprestore'); ?></span> |
  |  | 6843 | <img id="wpvivid\_download\_btn\_<?php echo esc\_attr($key); ?>" src="<?php echo esc\_url(WPVIVID\_PLUGIN\_URL.'/admin/partials/images/download.png'); ?>" style="vertical-align:middle;" /><span><?php esc\_html\_e('Download', 'wpvivid-backuprestore'); echo ' ('.esc\_html(size\_format($backup\_size, 2)).')'; ?></span> |
  | 6839 | 6844 | <div class="spinner" id="wpvivid\_download\_loading\_<?php esc\_attr($key); ?>" style="float:right;width:auto;height:auto;padding:10px 180px 10px 0;background-position:0 0;"></div> |
  | 6840 | 6845 | </div> |
* ## [wpvivid-backuprestore/trunk/includes/new\_backup/class-wpvivid-restore-db-2.php](/changeset/3067224/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php "Show the changeset 3067224 restricted to wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php")

  | [r3053003](/browser/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php?rev=3053003#L685 "Show revision 3053003 of this file in browser") | [r3067224](/browser/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php?rev=3067224#L685 "Show revision 3067224 of this file in browser") |  |
  | --- | --- | --- |
  | 685 | 685 | { |
  | 686 | 686 | $sub\_task['exec\_sql']['sql\_files'][$sql\_file\_name]['finished']=1; |
  |  | 687 | $sub\_task['exec\_sql']['current\_replace\_table\_finish']=false; |
  | 687 | 688 | } |
  | 688 | 689 | else |
  | […](/browser/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php?rev=3053003#L693) | […](/browser/wpvivid-backuprestore/trunk/includes/new_backup/class-wpvivid-restore-db-2.php?rev=3067224#L694) |  |
  | 693 | 694 | { |
  | 694 | 695 | $sub\_task['exec\_sql']['sql\_files'][$sql\_file\_name]['finished']=1; |
  |  | 696 | $sub\_task['exec\_sql']['current\_replace\_table\_finish']=false; |
  | 695 | 697 | } |
  | 696 | 698 | else |
* ## [wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php](/changeset/3067224/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php "Show the changeset 3067224 restricted to wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php")

  | [r3053003](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php?rev=3053003#L1448 "Show revision 3053003 of this file in browser") | [r3067224](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php?rev=3067224#L1448 "Show revision 3067224 of this file in browser") |  |
  | --- | --- | --- |
  | 1448 | 1448 | } |
  | 1449 | 1449 |  |
  | 1450 |  | ~~function wpvivid\_init\_custom\_include\_tree(tree\_path, is\_staging, parent\_id, refresh=0) {~~ |
  | 1451 |  | ~~if (refresh) {~~ |
  | 1452 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-additional-folder-tree-info').jstree("refresh");~~ |
  | 1453 |  | ~~}~~ |
  | 1454 |  | ~~else {~~ |
  | 1455 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-additional-folder-tree-info').on('activate\_node.jstree', function (e, data) {~~ |
  | 1456 |  | ~~}).jstree({~~ |
  | 1457 |  | ~~"core": {~~ |
  | 1458 |  | ~~"check\_callback": true,~~ |
  | 1459 |  | ~~"multiple": true,~~ |
  | 1460 |  | ~~"data": function (node\_id, callback) {~~ |
  | 1461 |  | ~~var tree\_node = {~~ |
  | 1462 |  | ~~'node': node\_id,~~ |
  | 1463 |  | ~~'path': tree\_path~~ |
  | 1464 |  | ~~};~~ |
  | 1465 |  | ~~var ajax\_data = {~~ |
  | 1466 |  | ~~'action': 'wpvividstg\_get\_custom\_include\_path\_free',~~ |
  | 1467 |  | ~~'tree\_node': tree\_node,~~ |
  | 1468 |  | ~~'is\_staging': is\_staging~~ |
  | 1469 |  | ~~};~~ |
  | 1470 |  | ~~ajax\_data.nonce=wpvivid\_ajax\_object.ajax\_nonce;~~ |
  | 1471 |  | ~~jQuery.ajax({~~ |
  | 1472 |  | ~~type: "post",~~ |
  | 1473 |  | ~~url: wpvivid\_ajax\_object.ajax\_url,~~ |
  | 1474 |  | ~~data: ajax\_data,~~ |
  | 1475 |  | ~~success: function (data) {~~ |
  | 1476 |  | ~~var jsonarray = jQuery.parseJSON(data);~~ |
  | 1477 |  | ~~callback.call(this, jsonarray.nodes);~~ |
  | 1478 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-include-additional-folder-btn').attr('disabled', false);~~ |
  | 1479 |  | ~~},~~ |
  | 1480 |  | ~~error: function (XMLHttpRequest, textStatus, errorThrown) {~~ |
  | 1481 |  | ~~alert("error");~~ |
  | 1482 |  | ~~},~~ |
  | 1483 |  | ~~timeout: 30000~~ |
  | 1484 |  | ~~});~~ |
  | 1485 |  | ~~},~~ |
  | 1486 |  | ~~'themes': {~~ |
  | 1487 |  | ~~'stripes': true~~ |
  | 1488 |  | ~~}~~ |
  | 1489 |  | ~~}~~ |
  | 1490 |  | ~~});~~ |
  | 1491 |  | ~~}~~ |
  | 1492 |  | ~~}~~ |
  | 1493 |  |  |
  | 1494 |  | ~~function wpvivid\_init\_custom\_exclude\_tree(tree\_path, is\_staging, parent\_id, refresh=0) {~~ |
  | 1495 |  | ~~if (refresh) {~~ |
  | 1496 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-exclude-tree-info').jstree("refresh");~~ |
  | 1497 |  | ~~}~~ |
  | 1498 |  | ~~else {~~ |
  | 1499 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-exclude-tree-info').on('activate\_node.jstree', function (event, data) {~~ |
  | 1500 |  | ~~}).jstree({~~ |
  | 1501 |  | ~~"core": {~~ |
  | 1502 |  | ~~"check\_callback": true,~~ |
  | 1503 |  | ~~"multiple": true,~~ |
  | 1504 |  | ~~"data": function (node\_id, callback) {~~ |
  | 1505 |  | ~~var tree\_node = {~~ |
  | 1506 |  | ~~'node': node\_id,~~ |
  | 1507 |  | ~~'path': tree\_path~~ |
  | 1508 |  | ~~};~~ |
  | 1509 |  | ~~var ajax\_data = {~~ |
  | 1510 |  | ~~'action': 'wpvividstg\_get\_custom\_exclude\_path\_free',~~ |
  | 1511 |  | ~~'tree\_node': tree\_node,~~ |
  | 1512 |  | ~~'is\_staging': is\_staging~~ |
  | 1513 |  | ~~};~~ |
  | 1514 |  | ~~ajax\_data.nonce=wpvivid\_ajax\_object.ajax\_nonce;~~ |
  | 1515 |  | ~~jQuery.ajax({~~ |
  | 1516 |  | ~~type: "post",~~ |
  | 1517 |  | ~~url: wpvivid\_ajax\_object.ajax\_url,~~ |
  | 1518 |  | ~~data: ajax\_data,~~ |
  | 1519 |  | ~~success: function (data) {~~ |
  | 1520 |  | ~~var jsonarray = jQuery.parseJSON(data);~~ |
  | 1521 |  | ~~callback.call(this, jsonarray.nodes);~~ |
  | 1522 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-tree-exclude-btn').attr('disabled', false);~~ |
  | 1523 |  | ~~},~~ |
  | 1524 |  | ~~error: function (XMLHttpRequest, textStatus, errorThrown) {~~ |
  | 1525 |  | ~~alert("error");~~ |
  | 1526 |  | ~~},~~ |
  | 1527 |  | ~~timeout: 30000~~ |
  | 1528 |  | ~~});~~ |
  | 1529 |  | ~~},~~ |
  | 1530 |  | ~~'themes': {~~ |
  | 1531 |  | ~~'stripes': true~~ |
  | 1532 |  | ~~}~~ |
  | 1533 |  | ~~}~~ |
  | 1534 |  | ~~});~~ |
  | 1535 |  | ~~}~~ |
  | 1536 |  | ~~}~~ |
  | 1537 |  |  |
  | 1538 | 1450 | function load\_js(parent\_id, is\_staging, theme\_path, plugin\_path, upload\_path, content\_path, home\_path, staging\_site\_id = '') |
  | 1539 | 1451 | { |
  | […](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php?rev=3053003#L1546) | […](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging-ui-display.php?rev=3067224#L1458) |  |
  | 1546 | 1458 | path\_arr['themes'] = theme\_path; |
  | 1547 | 1459 | path\_arr['plugins'] = plugin\_path; |
  | 1548 |  |  |
  | 1549 |  | ~~jQuery('#'+parent\_id).on('click', '.wpvivid-refresh-include-tree', function(){~~ |
  | 1550 |  | ~~wpvivid\_init\_custom\_include\_tree(home\_path, is\_staging, parent\_id, 1);~~ |
  | 1551 |  | ~~});~~ |
  | 1552 |  |  |
  | 1553 |  | ~~jQuery('#'+parent\_id).on('change', '.wpvivid-custom-tree-selector', function(){~~ |
  | 1554 |  | ~~var value = jQuery('#'+parent\_id).find('.wpvivid-custom-tree-selector').val();~~ |
  | 1555 |  | ~~if(value === 'themes'){~~ |
  | 1556 |  | ~~tree\_path = theme\_path;~~ |
  | 1557 |  | ~~}~~ |
  | 1558 |  | ~~else if(value === 'plugins'){~~ |
  | 1559 |  | ~~tree\_path = plugin\_path;~~ |
  | 1560 |  | ~~}~~ |
  | 1561 |  | ~~else if(value === 'content'){~~ |
  | 1562 |  | ~~tree\_path = content\_path;~~ |
  | 1563 |  | ~~}~~ |
  | 1564 |  | ~~else if(value === 'uploads'){~~ |
  | 1565 |  | ~~tree\_path = upload\_path;~~ |
  | 1566 |  | ~~}~~ |
  | 1567 |  | ~~jQuery('#'+parent\_id).find('.wpvivid-custom-exclude-tree-info').jstree("destroy").empty();~~ |
  | 1568 |  | ~~wpvivid\_init\_custom\_exclude\_tree(tree\_path, is\_staging, parent\_id);~~ |
  | 1569 |  | ~~});~~ |
  | 1570 |  |  |
  | 1571 |  | ~~jQuery('#'+parent\_id).on('click', '.wpvivid-refresh-exclude-tree', function(){~~ |
  | 1572 |  | ~~var value = jQuery('#'+parent\_id).find('.wpvivid-custom-tree-selector').val();~~ |
  | 1573 |  | ~~if(value === 'themes'){~~ |
  | 1574 |  | ~~tree\_path = theme\_path;~~ |
  | 1575 |  | ~~}~~ |
  | 1576 |  | ~~else if(value === 'plugins'){~~ |
  | 1577 |  | ~~tree\_path = plugin\_path;~~ |
  | 1578 |  | ~~}~~ |
  | 1579 |  | ~~else if(value === 'content'){~~ |
  | 1580 |  | ~~tree\_path = content\_path;~~ |
  | 1581 |  | ~~}~~ |
  | 1582 |  | ~~else if(value === 'uploads'){~~ |
  | 1583 |  | ~~tree\_path = upload\_path;~~ |
  | 1584 |  | ~~}~~ |
  | 1585 |  | ~~wpvivid\_init\_custom\_exclude\_tree(tree\_path, is\_staging, parent\_id, 1);~~ |
  | 1586 |  | ~~});~~ |
  | 1587 | 1460 |  |
  | 1588 | 1461 | jQuery('#'+parent\_id).on('click', '.wpvivid-custom-tree-exclude-btn', function(){ |
* ## [wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php](/changeset/3067224/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php "Show the changeset 3067224 restricted to wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php")

  | [r3057905](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php?rev=3057905#L216 "Show revision 3057905 of this file in browser") | [r3067224](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php?rev=3067224#L216 "Show revision 3067224 of this file in browser") |  |
  | --- | --- | --- |
  | 216 | 216 | add\_action('wp\_ajax\_wpvividstg\_get\_custom\_database\_size\_free', array($this, 'get\_custom\_database\_size')); |
  | 217 | 217 | add\_action('wp\_ajax\_wpvividstg\_get\_custom\_files\_size\_free', array($this, 'get\_custom\_files\_size')); |
  | 218 |  | ~~add\_action('wp\_ajax\_wpvividstg\_get\_custom\_include\_path\_free', array($this, 'get\_custom\_include\_path'));~~ |
  | 219 |  | ~~add\_action('wp\_ajax\_wpvividstg\_get\_custom\_exclude\_path\_free', array($this, 'get\_custom\_exclude\_path'));~~ |
  | 220 |  | ~~add\_action('wp\_ajax\_wpvividstg\_get\_custom\_themes\_plugins\_info\_free', array($this, 'get\_custom\_themes\_plugins\_info\_ex'));~~ |
  | 221 | 218 | } |
  | 222 | 219 |  |
  | […](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php?rev=3057905#L471) | […](/browser/wpvivid-backuprestore/trunk/includes/staging/class-wpvivid-staging.php?rev=3067224#L468) |  |
  | 471 | 468 | die(); |
  | 472 | 469 | } |
  | 473 |  |  |
  | 474 |  | ~~public function get\_custom\_include\_path(){~~ |
  | 475 |  | ~~global $wpvivid\_plugin;~~ |
  | 476 |  | ~~check\_ajax\_referer( 'wpvivid\_ajax', 'nonce' );~~ |
  | 477 |  | ~~$check=current\_user\_can('manage\_options');~~ |
  | 478 |  | ~~$check=apply\_filters('wpvivid\_ajax\_check\_security',$check);~~ |
  | 479 |  | ~~if(!$check)~~ |
  | 480 |  | ~~{~~ |
  | 481 |  | ~~die();~~ |
  | 482 |  | ~~}~~ |
  | 483 |  | ~~try {~~ |
  | 484 |  | ~~if (isset($\_POST['is\_staging'])) {~~ |
  | 485 |  | ~~$is\_staging = sanitize\_key($\_POST['is\_staging']);~~ |
  | 486 |  |  |
  | 487 |  | ~~$node\_array = array();~~ |
  | 488 |  | ~~$node\_id=sanitize\_text\_field($\_POST['tree\_node']['node']['id']);~~ |
  | 489 |  | ~~if ($node\_id == '#') {~~ |
  | 490 |  | ~~$path = ABSPATH;~~ |
  | 491 |  |  |
  | 492 |  | ~~if (!empty($\_POST['tree\_node']['path'])) {~~ |
  | 493 |  | ~~$path = sanitize\_text\_field($\_POST['tree\_node']['path']);~~ |
  | 494 |  | ~~}~~ |
  | 495 |  |  |
  | 496 |  | ~~if (isset($\_POST['select\_prev\_dir']) && $\_POST['select\_prev\_dir'] === '1') {~~ |
  | 497 |  | ~~$path = dirname($path);~~ |
  | 498 |  | ~~}~~ |
  | 499 |  |  |
  | 500 |  | ~~$node\_array[] = array(~~ |
  | 501 |  | ~~'text' => basename($path),~~ |
  | 502 |  | ~~'children' => true,~~ |
  | 503 |  | ~~'id' => $path,~~ |
  | 504 |  | ~~'icon' => 'dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer',~~ |
  | 505 |  | ~~'state' => array(~~ |
  | 506 |  | ~~'opened' => true~~ |
  | 507 |  | ~~)~~ |
  | 508 |  | ~~);~~ |
  | 509 |  | ~~} else {~~ |
  | 510 |  | ~~$path = sanitize\_text\_field($\_POST['tree\_node']['node']['id']);~~ |
  | 511 |  | ~~}~~ |
  | 512 |  |  |
  | 513 |  | ~~if (file\_exists($path)) {~~ |
  | 514 |  | ~~$path = trailingslashit(str\_replace('\\', '/', realpath($path)));~~ |
  | 515 |  |  |
  | 516 |  | ~~if ($dh = opendir($path)) {~~ |
  | 517 |  | ~~while (substr($path, -1) == '/') {~~ |
  | 518 |  | ~~$path = rtrim($path, '/');~~ |
  | 519 |  | ~~}~~ |
  | 520 |  |  |
  | 521 |  | ~~$skip\_paths = array(".", "..");~~ |
  | 522 |  |  |
  | 523 |  | ~~$file\_array = array();~~ |
  | 524 |  |  |
  | 525 |  | ~~while (($value = readdir($dh)) !== false) {~~ |
  | 526 |  | ~~trailingslashit(str\_replace('\\', '/', $value));~~ |
  | 527 |  |  |
  | 528 |  | ~~if (!in\_array($value, $skip\_paths)) {~~ |
  | 529 |  | ~~if (is\_dir($path . '/' . $value)) {~~ |
  | 530 |  | ~~$wp\_admin\_path = $is\_staging == false ? ABSPATH . 'wp-admin' : $path . '/wp-admin';~~ |
  | 531 |  | ~~$wp\_admin\_path = str\_replace('\\', '/', $wp\_admin\_path);~~ |
  | 532 |  |  |
  | 533 |  | ~~$wp\_include\_path = $is\_staging == false ? ABSPATH . 'wp-includes' : $path . '/wp-includes';~~ |
  | 534 |  | ~~$wp\_include\_path = str\_replace('\\', '/', $wp\_include\_path);~~ |
  | 535 |  |  |
  | 536 |  | ~~$content\_dir = $is\_staging == false ? WP\_CONTENT\_DIR : $path . '/wp-content';~~ |
  | 537 |  | ~~$content\_dir = str\_replace('\\', '/', $content\_dir);~~ |
  | 538 |  | ~~$content\_dir = rtrim($content\_dir, '/');~~ |
  | 539 |  |  |
  | 540 |  | ~~$exclude\_dir = array($wp\_admin\_path, $wp\_include\_path, $content\_dir);~~ |
  | 541 |  | ~~if (!in\_array($path . '/' . $value, $exclude\_dir)) {~~ |
  | 542 |  | ~~$node\_array[] = array(~~ |
  | 543 |  | ~~'text' => $value,~~ |
  | 544 |  | ~~'children' => true,~~ |
  | 545 |  | ~~'id' => $path . '/' . $value,~~ |
  | 546 |  | ~~'icon' => 'dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer'~~ |
  | 547 |  | ~~);~~ |
  | 548 |  | ~~}~~ |
  | 549 |  |  |
  | 550 |  | ~~} else {~~ |
  | 551 |  | ~~$wp\_admin\_path = $is\_staging == false ? ABSPATH : $path;~~ |
  | 552 |  | ~~$wp\_admin\_path = str\_replace('\\', '/', $wp\_admin\_path);~~ |
  | 553 |  | ~~$wp\_admin\_path = rtrim($wp\_admin\_path, '/');~~ |
  | 554 |  | ~~$skip\_path = rtrim($path, '/');~~ |
  | 555 |  |  |
  | 556 |  | ~~if ($wp\_admin\_path == $skip\_path) {~~ |
  | 557 |  | ~~continue;~~ |
  | 558 |  | ~~}~~ |
  | 559 |  | ~~$file\_array[] = array(~~ |
  | 560 |  | ~~'text' => $value,~~ |
  | 561 |  | ~~'children' => false,~~ |
  | 562 |  | ~~'id' => $path . '/' . $value,~~ |
  | 563 |  | ~~'type' => 'file',~~ |
  | 564 |  | ~~'icon' => 'dashicons dashicons-media-default wpvivid-dashicons-grey wpvivid-icon-16px-nopointer'~~ |
  | 565 |  | ~~);~~ |
  | 566 |  | ~~}~~ |
  | 567 |  | ~~}~~ |
  | 568 |  | ~~}~~ |
  | 569 |  | ~~$node\_array = array\_merge($node\_array, $file\_array);~~ |
  | 570 |  | ~~}~~ |
  | 571 |  | ~~} else {~~ |
  | 572 |  | ~~$node\_array = array();~~ |
  | 573 |  | ~~}~~ |
  | 574 |  |  |
  | 575 |  | ~~$ret['nodes'] = $node\_array;~~ |
  | 576 |  | ~~echo wp\_json\_encode($ret);~~ |
  | 577 |  | ~~die();~~ |
  | 578 |  | ~~}~~ |
  | 579 |  | ~~}~~ |
  | 580 |  | ~~catch (Exception $error) {~~ |
  | 581 |  | ~~$message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';';~~ |
  | 582 |  | ~~error\_log($message);~~ |
  | 583 |  | ~~echo wp\_json\_encode(array('result'=>'failed','error'=>$message));~~ |
  | 584 |  | ~~}~~ |
  | 585 |  | ~~die();~~ |
  | 586 |  | ~~}~~ |
  | 587 |  |  |
  | 588 |  | ~~public function get\_custom\_exclude\_path(){~~ |
  | 589 |  | ~~global $wpvivid\_plugin;~~ |
  | 590 |  | ~~check\_ajax\_referer( 'wpvivid\_ajax', 'nonce' );~~ |
  | 591 |  | ~~$check=current\_user\_can('manage\_options');~~ |
  | 592 |  | ~~$check=apply\_filters('wpvivid\_ajax\_check\_security',$check);~~ |
  | 593 |  | ~~if(!$check)~~ |
  | 594 |  | ~~{~~ |
  | 595 |  | ~~die();~~ |
  | 596 |  | ~~}~~ |
  | 597 |  | ~~try{~~ |
  | 598 |  | ~~if (isset($\_POST['is\_staging'])) {~~ |
  | 599 |  | ~~$is\_staging = sanitize\_key($\_POST['is\_staging']);~~ |
  | 600 |  | ~~$node\_array = array();~~ |
  | 601 |  | ~~$node\_id=sanitize\_text\_field($\_POST['tree\_node']['node']['id']);~~ |
  | 602 |  | ~~if ( $node\_id== '#') {~~ |
  | 603 |  | ~~$path = ABSPATH;~~ |
  | 604 |  |  |
  | 605 |  | ~~if (!empty($\_POST['tree\_node']['path'])) {~~ |
  | 606 |  | ~~$path = sanitize\_text\_field($\_POST['tree\_node']['path']);~~ |
  | 607 |  | ~~}~~ |
  | 608 |  |  |
  | 609 |  | ~~$node\_array[] = array(~~ |
  | 610 |  | ~~'text' => basename($path),~~ |
  | 611 |  | ~~'children' => true,~~ |
  | 612 |  | ~~'id' => $path,~~ |
  | 613 |  | ~~'icon' => 'dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer',~~ |
  | 614 |  | ~~'state' => array(~~ |
  | 615 |  | ~~'opened' => true~~ |
  | 616 |  | ~~)~~ |
  | 617 |  | ~~);~~ |
  | 618 |  | ~~} else {~~ |
  | 619 |  | ~~$path = sanitize\_text\_field($\_POST['tree\_node']['node']['id']);~~ |
  | 620 |  | ~~}~~ |
  | 621 |  |  |
  | 622 |  | ~~if (file\_exists($path)) {~~ |
  | 623 |  | ~~$path = trailingslashit(str\_replace('\\', '/', realpath($path)));~~ |
  | 624 |  |  |
  | 625 |  | ~~if ($dh = opendir($path)) {~~ |
  | 626 |  | ~~while (substr($path, -1) == '/') {~~ |
  | 627 |  | ~~$path = rtrim($path, '/');~~ |
  | 628 |  | ~~}~~ |
  | 629 |  | ~~$skip\_paths = array(".", "..");~~ |
  | 630 |  |  |
  | 631 |  | ~~while (($value = readdir($dh)) !== false) {~~ |
  | 632 |  | ~~trailingslashit(str\_replace('\\', '/', $value));~~ |
  | 633 |  | ~~if (!in\_array($value, $skip\_paths)) {~~ |
  | 634 |  | ~~//~~ |
  | 635 |  | ~~$custom\_dir = $is\_staging == false ? WP\_CONTENT\_DIR . '/' . WPVIVID\_STAGING\_DIR : $path . '/' . WPVIVID\_STAGING\_DIR;~~ |
  | 636 |  | ~~$custom\_dir = str\_replace('\\', '/', $custom\_dir);~~ |
  | 637 |  |  |
  | 638 |  | ~~$themes\_dir = $is\_staging == false ? get\_theme\_root() : $path . '/themes';~~ |
  | 639 |  | ~~$themes\_dir = trailingslashit(str\_replace('\\', '/', $themes\_dir));~~ |
  | 640 |  | ~~$themes\_dir = rtrim($themes\_dir, '/');~~ |
  | 641 |  |  |
  | 642 |  | ~~$plugin\_dir = $is\_staging == false ? WP\_PLUGIN\_DIR : $path . '/plugins';~~ |
  | 643 |  | ~~$plugin\_dir = trailingslashit(str\_replace('\\', '/', $plugin\_dir));~~ |
  | 644 |  | ~~$plugin\_dir = rtrim($plugin\_dir, '/');~~ |
  | 645 |  |  |
  | 646 |  | ~~if ($is\_staging == false) {~~ |
  | 647 |  | ~~$upload\_path = wp\_upload\_dir();~~ |
  | 648 |  | ~~$upload\_path['basedir'] = trailingslashit(str\_replace('\\', '/', $upload\_path['basedir']));~~ |
  | 649 |  | ~~$upload\_dir = rtrim($upload\_path['basedir'], '/');~~ |
  | 650 |  | ~~$subsite\_dir = rtrim($upload\_path['basedir'], '/') . '/' . 'sites';~~ |
  | 651 |  | ~~} else {~~ |
  | 652 |  | ~~$upload\_dir = $path . '/uploads';~~ |
  | 653 |  | ~~$subsite\_dir = $path . '/sites';~~ |
  | 654 |  | ~~}~~ |
  | 655 |  | ~~$exclude\_dir = array($themes\_dir, $plugin\_dir, $upload\_dir, $custom\_dir, $subsite\_dir);~~ |
  | 656 |  | ~~if (is\_dir($path . '/' . $value)) {~~ |
  | 657 |  | ~~if (!in\_array($path . '/' . $value, $exclude\_dir)) {~~ |
  | 658 |  | ~~$node['text'] = $value;~~ |
  | 659 |  | ~~$node['children'] = true;~~ |
  | 660 |  | ~~$node['id'] = $path . '/' . $value;~~ |
  | 661 |  | ~~$node['icon'] = 'dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer';~~ |
  | 662 |  | ~~$node\_array[] = $node;~~ |
  | 663 |  | ~~}~~ |
  | 664 |  | ~~}~~ |
  | 665 |  | ~~else{~~ |
  | 666 |  | ~~$node['text'] = $value;~~ |
  | 667 |  | ~~$node['children'] = true;~~ |
  | 668 |  | ~~$node['id'] = $path . '/' . $value;~~ |
  | 669 |  | ~~$node['icon'] = 'dashicons dashicons-media-default wpvivid-dashicons-grey wpvivid-icon-16px-nopointer';~~ |
  | 670 |  | ~~$node\_array[] = $node;~~ |
  | 671 |  | ~~}~~ |
  | 672 |  | ~~}~~ |
  | 673 |  | ~~}~~ |
  | 674 |  | ~~}~~ |
  | 675 |  | ~~}~~ |
  | 676 |  | ~~else {~~ |
  | 677 |  | ~~$node\_array = array();~~ |
  | 678 |  | ~~}~~ |
  | 679 |  |  |
  | 680 |  | ~~$ret['nodes'] = $node\_array;~~ |
  | 681 |  | ~~echo wp\_json\_encode($ret);~~ |
  | 682 |  | ~~}~~ |
  | 683 |  | ~~}~~ |
  | 684 |  | ~~catch (Exception $error) {~~ |
  | 685 |  | ~~$message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';';~~ |
  | 686 |  | ~~error\_log($message);~~ |
  | 687 |  | ~~echo wp\_json\_encode(array('result'=>'failed','error'=>$message));~~ |
  | 688 |  | ~~}~~ |
  | 689 |  | ~~die();~~ |
  | 690 |  | ~~}~~ |
  | 691 |  |  |
  | 692 |  | ~~public function get\_custom\_themes\_plugins\_info\_ex(){~~ |
  | 693 |  | ~~check\_ajax\_referer( 'wpvivid\_ajax', 'nonce' );~~ |
  | 694 |  | ~~$check=current\_user\_can('manage\_options');~~ |
  | 695 |  | ~~$check=apply\_filters('wpvivid\_ajax\_check\_security',$check);~~ |
  | 696 |  | ~~if(!$check)~~ |
  | 697 |  | ~~{~~ |
  | 698 |  | ~~die();~~ |
  | 699 |  | ~~}~~ |
  | 700 |  | ~~try{~~ |
  | 701 |  | ~~if (isset($\_POST['is\_staging']) && !empty($\_POST['is\_staging']))~~ |
  | 702 |  | ~~{~~ |
  | 703 |  | ~~if ($\_POST['is\_staging'] == '1')~~ |
  | 704 |  | ~~{~~ |
  | 705 |  | ~~$is\_staging\_site = true;~~ |
  | 706 |  | ~~$staging\_site\_id = sanitize\_key($\_POST['id']);~~ |
  | 707 |  |  |
  | 708 |  | ~~$task = new WPvivid\_Staging\_Task($staging\_site\_id);~~ |
  | 709 |  | ~~$ret = $this->get\_staging\_directory\_info($task->get\_site\_path());~~ |
  | 710 |  | ~~} else {~~ |
  | 711 |  | ~~$is\_staging\_site = false;~~ |
  | 712 |  | ~~}~~ |
  | 713 |  | ~~} else {~~ |
  | 714 |  | ~~$is\_staging\_site = false;~~ |
  | 715 |  | ~~}~~ |
  | 716 |  |  |
  | 717 |  | ~~if ($is\_staging\_site)~~ |
  | 718 |  | ~~{~~ |
  | 719 |  | ~~$staging\_option = array();~~ |
  | 720 |  | ~~} else {~~ |
  | 721 |  | ~~//$staging\_option = self::wpvivid\_get\_staging\_history();~~ |
  | 722 |  | ~~//if (empty($staging\_option))~~ |
  | 723 |  | ~~//{~~ |
  | 724 |  | ~~$staging\_option = array();~~ |
  | 725 |  | ~~//}~~ |
  | 726 |  | ~~}~~ |
  | 727 |  |  |
  | 728 |  | ~~$themes\_path = $is\_staging\_site == false ? get\_theme\_root() : sanitize\_text\_field($\_POST['staging\_path'])  . DIRECTORY\_SEPARATOR . 'wp-content' . DIRECTORY\_SEPARATOR . 'themes';~~ |
  | 729 |  |  |
  | 730 |  | ~~$exclude\_themes\_list = '';~~ |
  | 731 |  |  |
  | 732 |  | ~~$themes\_info = array();~~ |
  | 733 |  |  |
  | 734 |  | ~~$themes = $is\_staging\_site == false ? wp\_get\_themes() : $ret['themes\_list'];~~ |
  | 735 |  |  |
  | 736 |  | ~~foreach ($themes as $theme)~~ |
  | 737 |  | ~~{~~ |
  | 738 |  | ~~$file = $theme->get\_stylesheet();~~ |
  | 739 |  | ~~$themes\_info[$file] = $this->get\_theme\_plugin\_info($themes\_path . DIRECTORY\_SEPARATOR . $file);~~ |
  | 740 |  | ~~$parent=$theme->parent();~~ |
  | 741 |  | ~~$themes\_info[$file]['parent']=$parent;~~ |
  | 742 |  | ~~$themes\_info[$file]['parent\_file']=$theme->get\_template();~~ |
  | 743 |  | ~~$themes\_info[$file]['child']=array();~~ |
  | 744 |  |  |
  | 745 |  | ~~if(isset($\_POST['subsite']))~~ |
  | 746 |  | ~~{~~ |
  | 747 |  | ~~switch\_to\_blog(sanitize\_key($\_POST['subsite']));~~ |
  | 748 |  | ~~$ct = wp\_get\_theme();~~ |
  | 749 |  | ~~if( $ct->get\_stylesheet()==$file)~~ |
  | 750 |  | ~~{~~ |
  | 751 |  | ~~$themes\_info[$file]['active'] = 1;~~ |
  | 752 |  | ~~}~~ |
  | 753 |  | ~~else~~ |
  | 754 |  | ~~{~~ |
  | 755 |  | ~~$themes\_info[$file]['active'] = 0;~~ |
  | 756 |  | ~~}~~ |
  | 757 |  | ~~restore\_current\_blog();~~ |
  | 758 |  | ~~}~~ |
  | 759 |  | ~~else~~ |
  | 760 |  | ~~{~~ |
  | 761 |  | ~~$themes\_info[$file]['active'] = 1;~~ |
  | 762 |  | ~~}~~ |
  | 763 |  | ~~}~~ |
  | 764 |  |  |
  | 765 |  | ~~foreach ($themes\_info as $file => $info)~~ |
  | 766 |  | ~~{~~ |
  | 767 |  | ~~if($info['active']&&$info['parent']!=false)~~ |
  | 768 |  | ~~{~~ |
  | 769 |  | ~~$themes\_info[$info['parent\_file']]['active']=1;~~ |
  | 770 |  | ~~$themes\_info[$info['parent\_file']]['child'][]=$file;~~ |
  | 771 |  | ~~}~~ |
  | 772 |  | ~~}~~ |
  | 773 |  |  |
  | 774 |  | ~~foreach ($themes\_info as $file => $info) {~~ |
  | 775 |  | ~~if ($info['active'] == 1) {~~ |
  | 776 |  |  |
  | 777 |  | ~~}~~ |
  | 778 |  | ~~else{~~ |
  | 779 |  | ~~$exclude\_themes\_list .= '<div class="wpvivid-text-line" type="folder">~~ |
  | 780 |  | ~~<span class="dashicons dashicons-trash wpvivid-icon-16px wpvivid-remove-custom-exlcude-tree"></span><span class="dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer"></span><span class="wpvivid-text-line">'.$file.'</span>~~ |
  | 781 |  | ~~</div>';~~ |
  | 782 |  | ~~}~~ |
  | 783 |  | ~~/\*if (!empty($staging\_option['themes\_list'])) {~~ |
  | 784 |  | ~~if (in\_array($file, $staging\_option['themes\_list'])) {~~ |
  | 785 |  | ~~$checked = '';~~ |
  | 786 |  | ~~}~~ |
  | 787 |  | ~~}\*/~~ |
  | 788 |  | ~~}~~ |
  | 789 |  |  |
  | 790 |  | ~~$exclude\_plugin\_list = '';~~ |
  | 791 |  | ~~$path = $is\_staging\_site == false ? WP\_PLUGIN\_DIR : sanitize\_text\_field($\_POST['staging\_path']) . DIRECTORY\_SEPARATOR . 'wp-content' . DIRECTORY\_SEPARATOR . 'plugins';~~ |
  | 792 |  | ~~$plugin\_info = array();~~ |
  | 793 |  |  |
  | 794 |  | ~~if (!function\_exists('get\_plugins'))~~ |
  | 795 |  | ~~require\_once(ABSPATH . 'wp-admin/includes/plugin.php');~~ |
  | 796 |  | ~~$plugins = $is\_staging\_site == false ? get\_plugins() : $ret['plugins\_list'];~~ |
  | 797 |  |  |
  | 798 |  | ~~if(isset($\_POST['subsite']))~~ |
  | 799 |  | ~~{~~ |
  | 800 |  | ~~switch\_to\_blog(sanitize\_key($\_POST['subsite']));~~ |
  | 801 |  | ~~$current   = get\_option( 'active\_plugins', array() );~~ |
  | 802 |  | ~~restore\_current\_blog();~~ |
  | 803 |  | ~~}~~ |
  | 804 |  | ~~else~~ |
  | 805 |  | ~~{~~ |
  | 806 |  | ~~$current   = get\_option( 'active\_plugins', array() );~~ |
  | 807 |  | ~~}~~ |
  | 808 |  |  |
  | 809 |  |  |
  | 810 |  | ~~foreach ($plugins as $key => $plugin)~~ |
  | 811 |  | ~~{~~ |
  | 812 |  | ~~$slug = dirname($key);~~ |
  | 813 |  | ~~if ($slug == '.')~~ |
  | 814 |  | ~~continue;~~ |
  | 815 |  | ~~$plugin\_info[$slug] = $this->get\_theme\_plugin\_info($path . DIRECTORY\_SEPARATOR . $slug);~~ |
  | 816 |  | ~~$plugin\_info[$slug]['Name'] = $plugin['Name'];~~ |
  | 817 |  | ~~$plugin\_info[$slug]['slug'] = $slug;~~ |
  | 818 |  |  |
  | 819 |  | ~~if(isset($\_POST['subsite']))~~ |
  | 820 |  | ~~{~~ |
  | 821 |  | ~~if(in\_array($key,$current))~~ |
  | 822 |  | ~~{~~ |
  | 823 |  | ~~$plugin\_info[$slug]['active'] = 1;~~ |
  | 824 |  | ~~}~~ |
  | 825 |  | ~~else~~ |
  | 826 |  | ~~{~~ |
  | 827 |  | ~~$plugin\_info[$slug]['active'] = 0;~~ |
  | 828 |  | ~~}~~ |
  | 829 |  | ~~}~~ |
  | 830 |  | ~~else~~ |
  | 831 |  | ~~{~~ |
  | 832 |  | ~~$plugin\_info[$slug]['active'] = 1;~~ |
  | 833 |  | ~~}~~ |
  | 834 |  | ~~}~~ |
  | 835 |  |  |
  | 836 |  | ~~foreach ($plugin\_info as $slug => $info) {~~ |
  | 837 |  | ~~if ($info['active'] == 1) {~~ |
  | 838 |  |  |
  | 839 |  | ~~}~~ |
  | 840 |  | ~~else{~~ |
  | 841 |  | ~~$exclude\_plugin\_list .= '<div class="wpvivid-text-line" type="folder">~~ |
  | 842 |  | ~~<span class="dashicons dashicons-trash wpvivid-icon-16px wpvivid-remove-custom-exlcude-tree"></span><span class="dashicons dashicons-category wpvivid-dashicons-orange wpvivid-icon-16px-nopointer"></span><span class="wpvivid-text-line">'.$slug.'</span>~~ |
  | 843 |  | ~~</div>';~~ |
  | 844 |  | ~~}~~ |
  | 845 |  | ~~/\*if (!empty($staging\_option['plugins\_list'])) {~~ |
  | 846 |  | ~~if (in\_array($slug, $staging\_option['plugins\_list'])) {~~ |
  | 847 |  | ~~$checked = '';~~ |
  | 848 |  | ~~}~~ |
  | 849 |  | ~~}\*/~~ |
  | 850 |  | ~~}~~ |
  | 851 |  | ~~$ret['result'] = 'success';~~ |
  | 852 |  | ~~$ret['theme\_list'] = $exclude\_themes\_list;~~ |
  | 853 |  | ~~$ret['plugin\_list'] .= $exclude\_plugin\_list;~~ |
  | 854 |  | ~~echo wp\_json\_encode($ret);~~ |
  | 855 |  | ~~}~~ |
  | 856 |  | ~~catch (Exception $error) {~~ |
  | 857 |  | ~~$message = 'An exception has occurred. class: '.get\_class($error).';msg: '.$error->getMessage().';code: '.$error->getCode().';line: '.$error->getLine().';in\_file: '.$error->getFile().';';~~ |
  | 858 |  | ~~error\_log($message);~~ |
  | 859 |  | ~~echo wp\_json\_encode(array('result'=>'failed','error'=>$message));~~ |
  | 860 |  | ~~}~~ |
  | 861 |  | ~~die();~~ |
  | 862 |  | ~~}~~ |
  | 863 | 470 |  |
  | 864 | 471 | public function get\_staging\_site\_data() |
* ## [wpvivid-backuprestore/trunk/wpvivid-backuprestore.php](/changeset/3067224/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php "Show the changeset 3067224 restricted to wpvivid-backuprestore/trunk/wpvivid-backuprestore.php")

  | [r3057905](/browser/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php?rev=3057905#L8 "Show revision 3057905 of this file in browser") | [r3067224](/browser/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php?rev=3067224#L8 "Show revision 3067224 of this file in browser") |  |
  | --- | --- | --- |
  | 8 | 8 | \* Plugin Name:       WPvivid Backup Plugin |
  | 9 | 9 | \* Description:       Clone or copy WP sites then move or migrate them to new host (new domain), schedule backups, transfer backups to leading remote storage. All in one. |
  | 10 |  | \* Version:           0.9.~~99~~ |
  |  | 10 | \* Version:           0.9.100 |
  | 11 | 11 | \* Author:            WPvivid Team |
  | 12 | 12 | \* Author URI:        https://wpvivid.com |
  | […](/browser/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php?rev=3057905#L22) | […](/browser/wpvivid-backuprestore/trunk/wpvivid-backuprestore.php?rev=3067224#L22) |  |
  | 22 | 22 | } |
  | 23 | 23 |  |
  | 24 |  | define( 'WPVIVID\_PLUGIN\_VERSION', '0.9.~~99~~' ); |
  |  | 24 | define( 'WPVIVID\_PLUGIN\_VERSION', '0.9.100' ); |
  | 25 | 25 | // |
  | 26 | 26 | define('WPVIVID\_RESTORE\_INIT','init'); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3067224)
* [Zip Archive](?format=zip&new=3067224)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

