
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fcommit%2F0f075ec8ecb5e43f8fdca5182f8cca4703da0404)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fcommit%2F0f075ec8ecb5e43f8fdca5182f8cca4703da0404)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=libexpat%2Flibexpat)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[libexpat](/libexpat)
/
**[libexpat](/libexpat/libexpat)**
Public

* [Notifications](/login?return_to=%2Flibexpat%2Flibexpat) You must be signed in to change notification settings
* [Fork
  447](/login?return_to=%2Flibexpat%2Flibexpat)
* [Star
   1.1k](/login?return_to=%2Flibexpat%2Flibexpat)

* [Code](/libexpat/libexpat)
* [Issues
  13](/libexpat/libexpat/issues)
* [Pull requests
  5](/libexpat/libexpat/pulls)
* [Actions](/libexpat/libexpat/actions)
* [Security](/libexpat/libexpat/security)
* [Insights](/libexpat/libexpat/pulse)

Additional navigation options

* [Code](/libexpat/libexpat)
* [Issues](/libexpat/libexpat/issues)
* [Pull requests](/libexpat/libexpat/pulls)
* [Actions](/libexpat/libexpat/actions)
* [Security](/libexpat/libexpat/security)
* [Insights](/libexpat/libexpat/pulse)

## Commit

[Permalink](/libexpat/libexpat/commit/0f075ec8ecb5e43f8fdca5182f8cca4703da0404)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

lib|xmlwf|cmake: Extend scope of billion laughs attack protection

[Browse files](/libexpat/libexpat/tree/0f075ec8ecb5e43f8fdca5182f8cca4703da0404)
Browse the repository at this point in the history

```
.. from "defined(XML_DTD)" to "defined(XML_DTD) || XML_GE==1".
```

* Loading branch information

[![@hartwork](https://avatars.githubusercontent.com/u/1577132?s=40&v=4)](/hartwork)

[hartwork](/libexpat/libexpat/commits?author=hartwork "View all commits by hartwork")
committed
Nov 6, 2023

1 parent
[ed87a47](/libexpat/libexpat/commit/ed87a4793404e91c0cc0c81435fcfcc64a8be9f4)

commit 0f075ec

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**62 additions**
and
**49 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* expat

  + expat/CMakeLists.txt
    [CMakeLists.txt](#diff-94a27391ad9f0cbd47c6638e1e6adad47d42abe5a01d99d1401f071c452a432a)
  + lib

    - expat/lib/expat.h
      [expat.h](#diff-1e2178cb5a2656fcc266db43073da47f322c7d50210c537070eebc6c278a6c00)
    - expat/lib/internal.h
      [internal.h](#diff-111e7b4fb84662f4a4697a6ded7a14324b8583190a5aad49fad802f0f9bdea6e)
    - expat/lib/libexpat.def.cmake
      [libexpat.def.cmake](#diff-ce4c7db3f1347e201c201cdd7c89a7db765a2ec5f23310b6ad46de00b1a01958)
    - expat/lib/xmlparse.c
      [xmlparse.c](#diff-d1bcab18f24ba66b34aeb2e156f7fde58ef3de1a165514b0fccf0d04c26838f8)
  + xmlwf

    - expat/xmlwf/xmlwf.c
      [xmlwf.c](#diff-1cf246e737448dc6f8aecc6809a2c52311a8319a469b92b4f18edf197a53f083)

## There are no files selected for viewing

8 changes: 7 additions & 1 deletion

8
[expat/CMakeLists.txt](#diff-94a27391ad9f0cbd47c6638e1e6adad47d42abe5a01d99d1401f071c452a432a "expat/CMakeLists.txt")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/CMakeLists.txt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -403,7 +403,13 @@ if(EXPAT\_SHARED\_LIBS) |
|  |  | endif() |
|  |  | endmacro() |
|  |  |  |
|  |  | \_expat\_def\_file\_toggle(EXPAT\_DTD \_EXPAT\_COMMENT\_DTD) |
|  |  | if(EXPAT\_DTD OR EXPAT\_GE) |
|  |  | set(\_EXPAT\_DTD\_OR\_GE TRUE) |
|  |  | else() |
|  |  | set(\_EXPAT\_DTD\_OR\_GE FALSE) |
|  |  | endif() |
|  |  |  |
|  |  | \_expat\_def\_file\_toggle(\_EXPAT\_DTD\_OR\_GE \_EXPAT\_COMMENT\_DTD\_OR\_GE) |
|  |  | \_expat\_def\_file\_toggle(EXPAT\_ATTR\_INFO \_EXPAT\_COMMENT\_ATTR\_INFO) |
|  |  |  |
|  |  | configure\_file("${CMAKE\_CURRENT\_SOURCE\_DIR}/lib/libexpat.def.cmake" "${CMAKE\_CURRENT\_BINARY\_DIR}/lib/libexpat.def") |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[expat/lib/expat.h](#diff-1e2178cb5a2656fcc266db43073da47f322c7d50210c537070eebc6c278a6c00 "expat/lib/expat.h")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/lib/expat.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1038,13 +1038,15 @@ typedef struct { |
|  |  | XMLPARSEAPI(const XML\_Feature \*) |
|  |  | XML\_GetFeatureList(void); |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | /\* Added in Expat 2.4.0. \*/ |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | /\* Added in Expat 2.4.0 for XML\_DTD defined and |
|  |  | \* added in Expat 2.6.0 for XML\_GE == 1. \*/ |
|  |  | XMLPARSEAPI(XML\_Bool) |
|  |  | XML\_SetBillionLaughsAttackProtectionMaximumAmplification( |
|  |  | XML\_Parser parser, float maximumAmplificationFactor); |
|  |  |  |
|  |  | /\* Added in Expat 2.4.0. \*/ |
|  |  | /\* Added in Expat 2.4.0 for XML\_DTD defined and |
|  |  | \* added in Expat 2.6.0 for XML\_GE == 1. \*/ |
|  |  | XMLPARSEAPI(XML\_Bool) |
|  |  | XML\_SetBillionLaughsAttackProtectionActivationThreshold( |
|  |  | XML\_Parser parser, unsigned long long activationThresholdBytes); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[expat/lib/internal.h](#diff-111e7b4fb84662f4a4697a6ded7a14324b8583190a5aad49fad802f0f9bdea6e "expat/lib/internal.h")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/lib/internal.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -154,7 +154,7 @@ extern "C" { |
|  |  | void \_INTERNAL\_trim\_to\_complete\_utf8\_characters(const char \*from, |
|  |  | const char \*\*fromLimRef); |
|  |  |  |
|  |  | #if defined(XML\_DTD) |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | unsigned long long testingAccountingGetCountBytesDirect(XML\_Parser parser); |
|  |  | unsigned long long testingAccountingGetCountBytesIndirect(XML\_Parser parser); |
|  |  | const char \*unsignedCharToPrintable(unsigned char c); |
| Expand Down | |  |

4 changes: 2 additions & 2 deletions

4
[expat/lib/libexpat.def.cmake](#diff-ce4c7db3f1347e201c201cdd7c89a7db765a2ec5f23310b6ad46de00b1a01958 "expat/lib/libexpat.def.cmake")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/lib/libexpat.def.cmake)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -75,5 +75,5 @@ EXPORTS |
|  |  | XML\_SetHashSalt @67 |
|  |  | ; internal @68 removed with version 2.3.1 |
|  |  | ; added with version 2.4.0 |
|  |  | @\_EXPAT\_COMMENT\_DTD@ XML\_SetBillionLaughsAttackProtectionActivationThreshold @69 |
|  |  | @\_EXPAT\_COMMENT\_DTD@ XML\_SetBillionLaughsAttackProtectionMaximumAmplification @70 |
|  |  | @\_EXPAT\_COMMENT\_DTD\_OR\_GE@ XML\_SetBillionLaughsAttackProtectionActivationThreshold @69 |
|  |  | @\_EXPAT\_COMMENT\_DTD\_OR\_GE@ XML\_SetBillionLaughsAttackProtectionMaximumAmplification @70 |

71 changes: 37 additions & 34 deletions

71
[expat/lib/xmlparse.c](#diff-d1bcab18f24ba66b34aeb2e156f7fde58ef3de1a165514b0fccf0d04c26838f8 "expat/lib/xmlparse.c")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/lib/xmlparse.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -416,7 +416,7 @@ enum XML\_Account { |
|  |  | XML\_ACCOUNT\_NONE /\* i.e. do not account, was accounted already \*/ |
|  |  | }; |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | typedef unsigned long long XmlBigCount; |
|  |  | typedef struct accounting { |
|  |  | XmlBigCount countBytesDirect; |
| Expand All | | @@ -432,7 +432,7 @@ typedef struct entity\_stats { |
|  |  | unsigned int maximumDepthSeen; |
|  |  | unsigned long debugLevel; |
|  |  | } ENTITY\_STATS; |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  |  |
|  |  | typedef enum XML\_Error PTRCALL Processor(XML\_Parser parser, const char \*start, |
|  |  | const char \*end, const char \*\*endPtr); |
| Expand Down  Expand Up | | @@ -570,7 +570,7 @@ static XML\_Parser parserCreate(const XML\_Char \*encodingName, |
|  |  |  |
|  |  | static void parserInit(XML\_Parser parser, const XML\_Char \*encodingName); |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | static float accountingGetCurrentAmplification(XML\_Parser rootParser); |
|  |  | static void accountingReportStats(XML\_Parser originParser, const char \*epilog); |
|  |  | static void accountingOnAbort(XML\_Parser originParser); |
| Expand All | | @@ -593,7 +593,7 @@ static void entityTrackingOnClose(XML\_Parser parser, ENTITY \*entity, |
|  |  |  |
|  |  | static XML\_Parser getRootParserOf(XML\_Parser parser, |
|  |  | unsigned int \*outLevelDiff); |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  |  |
|  |  | static unsigned long getDebugLevel(const char \*variableName, |
|  |  | unsigned long defaultDebugLevel); |
| Expand Down  Expand Up | | @@ -718,7 +718,7 @@ struct XML\_ParserStruct { |
|  |  | enum XML\_ParamEntityParsing m\_paramEntityParsing; |
|  |  | #endif |
|  |  | unsigned long m\_hash\_secret\_salt; |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | ACCOUNTING m\_accounting; |
|  |  | ENTITY\_STATS m\_entity\_stats; |
|  |  | #endif |
| Expand Down  Expand Up | | @@ -1178,7 +1178,7 @@ parserInit(XML\_Parser parser, const XML\_Char \*encodingName) { |
|  |  | #endif |
|  |  | parser->m\_hash\_secret\_salt = 0; |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | memset(&parser->m\_accounting, 0, sizeof(ACCOUNTING)); |
|  |  | parser->m\_accounting.debugLevel = getDebugLevel("EXPAT\_ACCOUNTING\_DEBUG", 0u); |
|  |  | parser->m\_accounting.maximumAmplificationFactor |
| Expand Down  Expand Up | | @@ -2534,8 +2534,9 @@ XML\_GetFeatureList(void) { |
|  |  | #ifdef XML\_ATTR\_INFO |
|  |  | {XML\_FEATURE\_ATTR\_INFO, XML\_L("XML\_ATTR\_INFO"), 0}, |
|  |  | #endif |
|  |  | #ifdef XML\_DTD |
|  |  | /\* Added in Expat 2.4.0. \*/ |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | /\* Added in Expat 2.4.0 for XML\_DTD defined and |
|  |  | \* added in Expat 2.6.0 for XML\_GE == 1. \*/ |
|  |  | {XML\_FEATURE\_BILLION\_LAUGHS\_ATTACK\_PROTECTION\_MAXIMUM\_AMPLIFICATION\_DEFAULT, |
|  |  | XML\_L("XML\_BLAP\_MAX\_AMP"), |
|  |  | (long int) |
| Expand All | | @@ -2550,7 +2551,7 @@ XML\_GetFeatureList(void) { |
|  |  | return features; |
|  |  | } |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | XML\_Bool XMLCALL |
|  |  | XML\_SetBillionLaughsAttackProtectionMaximumAmplification( |
|  |  | XML\_Parser parser, float maximumAmplificationFactor) { |
| Expand All | | @@ -2572,7 +2573,7 @@ XML\_SetBillionLaughsAttackProtectionActivationThreshold( |
|  |  | parser->m\_accounting.activationThresholdBytes = activationThresholdBytes; |
|  |  | return XML\_TRUE; |
|  |  | } |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  |  |
|  |  | /\* Initially tag->rawName always points into the parse buffer; |
|  |  | for those TAG instances opened while the current parse buffer was |
| Expand Down  Expand Up | | @@ -2658,13 +2659,13 @@ externalEntityInitProcessor2(XML\_Parser parser, const char \*start, |
|  |  | int tok = XmlContentTok(parser->m\_encoding, start, end, &next); |
|  |  | switch (tok) { |
|  |  | case XML\_TOK\_BOM: |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, start, next, \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_DIRECT)) { |
|  |  | accountingOnAbort(parser); |
|  |  | return XML\_ERROR\_AMPLIFICATION\_LIMIT\_BREACH; |
|  |  | } |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  |  |
|  |  | /\* If we are at the end of the buffer, this would cause the next stage, |
|  |  | i.e. externalEntityInitProcessor3, to pass control directly to |
| Expand Down  Expand Up | | @@ -2778,7 +2779,7 @@ doContent(XML\_Parser parser, int startTagLevel, const ENCODING \*enc, |
|  |  | for (;;) { |
|  |  | const char \*next = s; /\* XmlContentTok doesn't always set the last arg \*/ |
|  |  | int tok = XmlContentTok(enc, s, end, &next); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | const char \*accountAfter |
|  |  | = ((tok == XML\_TOK\_TRAILING\_RSQB) || (tok == XML\_TOK\_TRAILING\_CR)) |
|  |  | ? (haveMore ? s /\* i.e. 0 bytes \*/ : end) |
| Expand Down  Expand Up | | @@ -2844,14 +2845,14 @@ doContent(XML\_Parser parser, int startTagLevel, const ENCODING \*enc, |
|  |  | XML\_Char ch = (XML\_Char)XmlPredefinedEntityName( |
|  |  | enc, s + enc->minBytesPerChar, next - enc->minBytesPerChar); |
|  |  | if (ch) { |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | /\* NOTE: We are replacing 4-6 characters original input for 1 character |
|  |  | \* so there is no amplification and hence recording without |
|  |  | \* protection. \*/ |
|  |  | accountingDiffTolerated(parser, tok, (char \*)&ch, |
|  |  | ((char \*)&ch) + sizeof(XML\_Char), \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_ENTITY\_EXPANSION); |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  | if (parser->m\_characterDataHandler) |
|  |  | parser->m\_characterDataHandler(parser->m\_handlerArg, &ch, 1); |
|  |  | else if (parser->m\_defaultHandler) |
| Expand Down  Expand Up | | @@ -4053,7 +4054,7 @@ doCdataSection(XML\_Parser parser, const ENCODING \*enc, const char \*\*startPtr, |
|  |  | for (;;) { |
|  |  | const char \*next = s; /\* in case of XML\_TOK\_NONE or XML\_TOK\_PARTIAL \*/ |
|  |  | int tok = XmlCdataSectionTok(enc, s, end, &next); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, s, next, \_\_LINE\_\_, account)) { |
|  |  | accountingOnAbort(parser); |
|  |  | return XML\_ERROR\_AMPLIFICATION\_LIMIT\_BREACH; |
| Expand Down  Expand Up | | @@ -4205,7 +4206,7 @@ doIgnoreSection(XML\_Parser parser, const ENCODING \*enc, const char \*\*startPtr, |
|  |  | \*eventPP = s; |
|  |  | \*startPtr = NULL; |
|  |  | tok = XmlIgnoreSectionTok(enc, s, end, &next); |
|  |  | # ifdef XML\_DTD |
|  |  | # if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, s, next, \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_DIRECT)) { |
|  |  | accountingOnAbort(parser); |
| Expand Down  Expand Up | | @@ -4297,7 +4298,7 @@ processXmlDecl(XML\_Parser parser, int isGeneralTextEntity, const char \*s, |
|  |  | const XML\_Char \*storedversion = NULL; |
|  |  | int standalone = -1; |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, XML\_TOK\_XML\_DECL, s, next, \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_DIRECT)) { |
|  |  | accountingOnAbort(parser); |
| Expand Down  Expand Up | | @@ -4504,7 +4505,7 @@ entityValueInitProcessor(XML\_Parser parser, const char \*s, const char \*end, |
|  |  | is not valid to have multiple BOMs. |
|  |  | \*/ |
|  |  | else if (tok == XML\_TOK\_BOM) { |
|  |  | # ifdef XML\_DTD |
|  |  | # if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, s, next, \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_DIRECT)) { |
|  |  | accountingOnAbort(parser); |
| Expand Down  Expand Up | | @@ -4720,11 +4721,13 @@ doProlog(XML\_Parser parser, const ENCODING \*enc, const char \*s, const char \*end, |
|  |  | } |
|  |  | } |
|  |  | role = XmlTokenRole(&parser->m\_prologState, tok, s, next, enc); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | switch (role) { |
|  |  | case XML\_ROLE\_INSTANCE\_START: // bytes accounted in contentProcessor |
|  |  | case XML\_ROLE\_XML\_DECL: // bytes accounted in processXmlDecl |
|  |  | case XML\_ROLE\_TEXT\_DECL: // bytes accounted in processXmlDecl |
|  |  | # ifdef XML\_DTD |
|  |  | case XML\_ROLE\_TEXT\_DECL: // bytes accounted in processXmlDecl |
|  |  | # endif |
|  |  | break; |
|  |  | default: |
|  |  | if (! accountingDiffTolerated(parser, tok, s, next, \_\_LINE\_\_, account)) { |
| Expand Down  Expand Up | | @@ -5661,7 +5664,7 @@ epilogProcessor(XML\_Parser parser, const char \*s, const char \*end, |
|  |  | for (;;) { |
|  |  | const char \*next = NULL; |
|  |  | int tok = XmlPrologTok(parser->m\_encoding, s, end, &next); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, s, next, \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_DIRECT)) { |
|  |  | accountingOnAbort(parser); |
| Expand Down  Expand Up | | @@ -5741,7 +5744,7 @@ processInternalEntity(XML\_Parser parser, ENTITY \*entity, XML\_Bool betweenDecl) { |
|  |  | return XML\_ERROR\_NO\_MEMORY; |
|  |  | } |
|  |  | entity->open = XML\_TRUE; |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | entityTrackingOnOpen(parser, entity, \_\_LINE\_\_); |
|  |  | #endif |
|  |  | entity->processed = 0; |
| Expand Down  Expand Up | | @@ -5775,9 +5778,9 @@ processInternalEntity(XML\_Parser parser, ENTITY \*entity, XML\_Bool betweenDecl) { |
|  |  | entity->processed = (int)(next - textStart); |
|  |  | parser->m\_processor = internalEntityProcessor; |
|  |  | } else { |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | entityTrackingOnClose(parser, entity, \_\_LINE\_\_); |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  | entity->open = XML\_FALSE; |
|  |  | parser->m\_openInternalEntities = openEntity->next; |
|  |  | /\* put openEntity back in list of free instances \*/ |
| Expand Down  Expand Up | | @@ -5826,7 +5829,7 @@ internalEntityProcessor(XML\_Parser parser, const char \*s, const char \*end, |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | entityTrackingOnClose(parser, entity, \_\_LINE\_\_); |
|  |  | #endif |
|  |  | entity->open = XML\_FALSE; |
| Expand Down  Expand Up | | @@ -5905,7 +5908,7 @@ appendAttributeValue(XML\_Parser parser, const ENCODING \*enc, XML\_Bool isCdata, |
|  |  | const char \*next |
|  |  | = ptr; /\* XmlAttributeValueTok doesn't always set the last arg \*/ |
|  |  | int tok = XmlAttributeValueTok(enc, ptr, end, &next); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, ptr, next, \_\_LINE\_\_, account)) { |
|  |  | accountingOnAbort(parser); |
|  |  | return XML\_ERROR\_AMPLIFICATION\_LIMIT\_BREACH; |
| Expand Down  Expand Up | | @@ -5970,14 +5973,14 @@ appendAttributeValue(XML\_Parser parser, const ENCODING \*enc, XML\_Bool isCdata, |
|  |  | XML\_Char ch = (XML\_Char)XmlPredefinedEntityName( |
|  |  | enc, ptr + enc->minBytesPerChar, next - enc->minBytesPerChar); |
|  |  | if (ch) { |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | /\* NOTE: We are replacing 4-6 characters original input for 1 character |
|  |  | \* so there is no amplification and hence recording without |
|  |  | \* protection. \*/ |
|  |  | accountingDiffTolerated(parser, tok, (char \*)&ch, |
|  |  | ((char \*)&ch) + sizeof(XML\_Char), \_\_LINE\_\_, |
|  |  | XML\_ACCOUNT\_ENTITY\_EXPANSION); |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  | if (! poolAppendChar(pool, ch)) |
|  |  | return XML\_ERROR\_NO\_MEMORY; |
|  |  | break; |
| Expand Down  Expand Up | | @@ -6055,14 +6058,14 @@ appendAttributeValue(XML\_Parser parser, const ENCODING \*enc, XML\_Bool isCdata, |
|  |  | enum XML\_Error result; |
|  |  | const XML\_Char \*textEnd = entity->textPtr + entity->textLen; |
|  |  | entity->open = XML\_TRUE; |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | entityTrackingOnOpen(parser, entity, \_\_LINE\_\_); |
|  |  | #endif |
|  |  | result = appendAttributeValue(parser, parser->m\_internalEncoding, |
|  |  | isCdata, (const char \*)entity->textPtr, |
|  |  | (const char \*)textEnd, pool, |
|  |  | XML\_ACCOUNT\_ENTITY\_EXPANSION); |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | entityTrackingOnClose(parser, entity, \_\_LINE\_\_); |
|  |  | #endif |
|  |  | entity->open = XML\_FALSE; |
| Expand Down  Expand Up | | @@ -6118,7 +6121,7 @@ storeEntityValue(XML\_Parser parser, const ENCODING \*enc, |
|  |  | = entityTextPtr; /\* XmlEntityValueTok doesn't always set the last arg \*/ |
|  |  | int tok = XmlEntityValueTok(enc, entityTextPtr, entityTextEnd, &next); |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | if (! accountingDiffTolerated(parser, tok, entityTextPtr, next, \_\_LINE\_\_, |
|  |  | account)) { |
|  |  | accountingOnAbort(parser); |
| Expand Down  Expand Up | | @@ -7669,7 +7672,7 @@ copyString(const XML\_Char \*s, const XML\_Memory\_Handling\_Suite \*memsuite) { |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  |  |
|  |  | static float |
|  |  | accountingGetCurrentAmplification(XML\_Parser rootParser) { |
| Expand Down  Expand Up | | @@ -8400,7 +8403,7 @@ unsignedCharToPrintable(unsigned char c) { |
|  |  | assert(0); /\* never gets here \*/ |
|  |  | } |
|  |  |  |
|  |  | #endif /\* XML\_DTD \*/ |
|  |  | #endif /\* defined(XML\_DTD) || XML\_GE == 1 \*/ |
|  |  |  |
|  |  | static unsigned long |
|  |  | getDebugLevel(const char \*variableName, unsigned long defaultDebugLevel) { |
| Expand Down | |  |

18 changes: 10 additions & 8 deletions

18
[expat/xmlwf/xmlwf.c](#diff-1cf246e737448dc6f8aecc6809a2c52311a8319a469b92b4f18edf197a53f083 "expat/xmlwf/xmlwf.c")

Show comments

[View file](/libexpat/libexpat/blob/0f075ec8ecb5e43f8fdca5182f8cca4703da0404/expat/xmlwf/xmlwf.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1096,9 +1096,10 @@ tmain(int argc, XML\_Char \*\*argv) { |
|  |  | " (needs a floating point number greater or equal than 1.0)")); |
|  |  | exit(XMLWF\_EXIT\_USAGE\_ERROR); |
|  |  | } |
|  |  | #ifndef XML\_DTD |
|  |  | ftprintf(stderr, T("Warning: Given amplification limit ignored") T( |
|  |  | ", xmlwf has been compiled without DTD support.\n")); |
|  |  | #if ! defined(XML\_DTD) && XML\_GE == 0 |
|  |  | ftprintf(stderr, |
|  |  | T("Warning: Given amplification limit ignored") |
|  |  | T(", xmlwf has been compiled without DTD/GE support.\n")); |
|  |  | #endif |
|  |  | break; |
|  |  | } |
| Expand All | | @@ -1117,9 +1118,10 @@ tmain(int argc, XML\_Char \*\*argv) { |
|  |  | exit(XMLWF\_EXIT\_USAGE\_ERROR); |
|  |  | } |
|  |  | attackThresholdGiven = XML\_TRUE; |
|  |  | #ifndef XML\_DTD |
|  |  | ftprintf(stderr, T("Warning: Given attack threshold ignored") T( |
|  |  | ", xmlwf has been compiled without DTD support.\n")); |
|  |  | #if ! defined(XML\_DTD) && XML\_GE == 0 |
|  |  | ftprintf(stderr, |
|  |  | T("Warning: Given attack threshold ignored") |
|  |  | T(", xmlwf has been compiled without DTD/GE support.\n")); |
|  |  | #endif |
|  |  | break; |
|  |  | } |
| Expand Down  Expand Up | | @@ -1155,13 +1157,13 @@ tmain(int argc, XML\_Char \*\*argv) { |
|  |  | } |
|  |  |  |
|  |  | if (attackMaximumAmplification != -1.0f) { |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | XML\_SetBillionLaughsAttackProtectionMaximumAmplification( |
|  |  | parser, attackMaximumAmplification); |
|  |  | #endif |
|  |  | } |
|  |  | if (attackThresholdGiven) { |
|  |  | #ifdef XML\_DTD |
|  |  | #if defined(XML\_DTD) || XML\_GE == 1 |
|  |  | XML\_SetBillionLaughsAttackProtectionActivationThreshold( |
|  |  | parser, attackThresholdBytes); |
|  |  | #else |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0f075ec`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Flibexpat%2Flibexpat%2Fcommit%2F0f075ec8ecb5e43f8fdca5182f8cca4703da0404) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

