
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fsecurity%2Fadvisories%2FGHSA-q9p4-hw9m-fj2v)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fapollographql%2Frouter%2Fsecurity%2Fadvisories%2FGHSA-q9p4-hw9m-fj2v)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=apollographql%2Frouter)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[apollographql](/apollographql)
/
**[router](/apollographql/router)**
Public

* [Notifications](/login?return_to=%2Fapollographql%2Frouter) You must be signed in to change notification settings
* [Fork
  273](/login?return_to=%2Fapollographql%2Frouter)
* [Star
   829](/login?return_to=%2Fapollographql%2Frouter)

* [Code](/apollographql/router)
* [Issues
  428](/apollographql/router/issues)
* [Pull requests
  79](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects
  0](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

Additional navigation options

* [Code](/apollographql/router)
* [Issues](/apollographql/router/issues)
* [Pull requests](/apollographql/router/pulls)
* [Discussions](/apollographql/router/discussions)
* [Actions](/apollographql/router/actions)
* [Projects](/apollographql/router/projects)
* [Security](/apollographql/router/security)
* [Insights](/apollographql/router/pulse)

# Defect in query plan cache may cause incorrect operations to be executed in Apollo Router 1.44.0 or 1.45.0

Critical

[jasonbarnett667](/jasonbarnett667)
published
GHSA-q9p4-hw9m-fj2v
May 1, 2024

## Package

cargo

apollo-router
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

>=1.44.0 <1.45.1

## Patched versions

1.45.1

apollographql/helm-charts/router
(GitHub Packages Container Registry)

>=1.44.0 <1.45.1

1.45.1

apollographql/router
(GitHub Packages Container Registry)

>=1.44.0 <1.45.1

1.45.1

apollographql/router
(GitHub Releases)

>=1.44.0 <1.45.1

1.45.1

## Description

### Impact

Any instance of Apollo Router 1.44.0 or 1.45.0 that is using Distributed Query Plan Caching is impacted. These versions were released on 2024-04-12 and 2024-04-22 respectively.

The affected versions of Apollo Router contain a bug that could lead to unexpected operations being executed, which can result in unintended data or effects. This only affects Router instances configured to use distributed query plan caching. Router versions other than the ones listed above, and all Router deployments that are not using distributed query plan caching, are unaffected by this defect.

If you are using the affected versions, you can check your router’s configuration YAML to verify if you are impacted:

```
supergraph:
  query_planning:
    cache:
      # Look for this config below
      redis:
        urls: ["redis://..."]
```

A full reference on the [Distributed Query Plan Caching feature is available here.](https://www.apollographql.com/docs/router/configuration/distributed-caching/#distributed-query-plan-caching)

### Impact detail

The root cause of this defect is a bug in Apollo Router’s cache retrieval logic: When this defect is present and distributed query planning caching is enabled, asking the Router to execute an operation (whether it is a query, a mutation, or a subscription) may result in an unexpected variation of that operation being executed or the generation of unexpected errors.

The issue stems from inadvertently executing a modified version of a previously executed operation, whose query plan is stored in the underlying cache (specifically, Redis). Depending on the type of the operation, the result may vary. For a query, results may be fetched that don’t match what was requested (e.g., rather than running `fetchUsers(type: ENTERPRISE)` the Router may run `fetchUsers(type: TRIAL)`. For a mutation, this may result in incorrect mutations being sent to underlying subgraph servers (e.g., rather than sending `deleteUser(id: 10)` to a subgraph, the Router may run `deleteUser(id: 12)`.

### Patches

Apollo Router 1.45.1

If you are using distributed query plan caching, please either upgrade to version 1.45.1 or above or downgrade to version 1.43.2 of the Apollo Router. We do not recommend Apollo Router versions 1.44.0 or 1.45.0 for use and have withdrawn these releases. If you use impacted versions in production, we recommend that you migrate away immediately by redeploying to an unaffected Router version. For non-production use cases, we recommend you migrate at your earliest convenience.

### Workarounds

If you cannot upgrade or downgrade, you can disable distributed query plan caching by removing the `supergraph.query_planning.cache.redis.urls` configuration. Please note that when distributed query plan caching is disabled, each Router instance will maintain its own in-memory query plan cache. This may increase resource utilization for each Router instance and could increase cold-start times as each Router instance builds its query plan cache.

### References

[Apollo Router 1.45.1 Release Notes](https://github.com/apollographql/router/releases/tag/v1.45.1)

### Severity

Critical

9.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
None

Scope
Changed

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:C/C:H/I:H/A:H

### CVE ID

CVE-2024-32971

### Weaknesses

[CWE-440](/advisories?query=cwe%3A440)

### Credits

* [![@xuorig](https://avatars.githubusercontent.com/u/1919498?s=40&v=4)](/xuorig)
  [xuorig](/xuorig)
  Reporter
* [![@o0Ignition0o](https://avatars.githubusercontent.com/u/9465678?s=40&v=4)](/o0Ignition0o)
  [o0Ignition0o](/o0Ignition0o)
  Remediation developer
* [![@peakematt](https://avatars.githubusercontent.com/u/7741049?s=40&v=4)](/peakematt)
  [peakematt](/peakematt)
  Coordinator
* [![@IvanGoncharov](https://avatars.githubusercontent.com/u/8336157?s=40&v=4)](/IvanGoncharov)
  [IvanGoncharov](/IvanGoncharov)
  Remediation reviewer
* [![@Geal](https://avatars.githubusercontent.com/u/119296?s=40&v=4)](/Geal)
  [Geal](/Geal)
  Remediation verifier
* [![@glasser](https://avatars.githubusercontent.com/u/16724?s=40&v=4)](/glasser)
  [glasser](/glasser)
  Remediation reviewer
* [![@jasonbarnett667](https://avatars.githubusercontent.com/u/38733417?s=40&v=4)](/jasonbarnett667)
  [jasonbarnett667](/jasonbarnett667)
  Coordinator
* [![@abernix](https://avatars.githubusercontent.com/u/841294?s=40&v=4)](/abernix)
  [abernix](/abernix)
  Coordinator

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

