

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=89064d09c56b44c668509bf793c410484f63f5ad)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89064d09c56b44c668509bf793c410484f63f5ad)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89064d09c56b44c668509bf793c410484f63f5ad)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89064d09c56b44c668509bf793c410484f63f5ad)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chris Mi <cmi@nvidia.com> | 2024-07-30 09:16:36 +0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-11 12:57:55 +0200 |
| commit | [89064d09c56b44c668509bf793c410484f63f5ad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=89064d09c56b44c668509bf793c410484f63f5ad) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=89064d09c56b44c668509bf793c410484f63f5ad)) | |
| tree | [4b2c4bc31a30d280ccc80ba397acf3c4cdec5ff0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=89064d09c56b44c668509bf793c410484f63f5ad) | |
| parent | [9f13231484939dc3e08816cd227a381a13bc9f42](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9f13231484939dc3e08816cd227a381a13bc9f42) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89064d09c56b44c668509bf793c410484f63f5ad&id2=9f13231484939dc3e08816cd227a381a13bc9f42)) | |
| download | [linux-89064d09c56b44c668509bf793c410484f63f5ad.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-89064d09c56b44c668509bf793c410484f63f5ad.tar.gz) | |

net/mlx5e: Fix CT entry update leaks of modify header context[ Upstream commit 025f2b85a5e5a46df14ecf162c3c80a957a36d0b ]
The cited commit allocates a new modify header to replace the old
one when updating CT entry. But if failed to allocate a new one, eg.
exceed the max number firmware can support, modify header will be
an error pointer that will trigger a panic when deallocating it. And
the old modify header point is copied to old attr. When the old
attr is freed, the old modify header is lost.
Fix it by restoring the old attr to attr when failed to allocate a
new modify header context. So when the CT entry is freed, the right
modify header context will be freed. And the panic of accessing
error pointer is also fixed.
Fixes: 94ceffb48eac ("net/mlx5e: Implement CT entry update")
Signed-off-by: Chris Mi <cmi@nvidia.com>
Signed-off-by: Tariq Toukan <tariqt@nvidia.com>
Reviewed-by: Wojciech Drewek <wojciech.drewek@intel.com>
Link: [https://patch.msgid.link/20240730061638.1831002-8-tariqt@nvidia.com](https://patch.msgid.link/20240730061638.1831002-8-tariqt%40nvidia.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=89064d09c56b44c668509bf793c410484f63f5ad)

| -rw-r--r-- | [drivers/net/ethernet/mellanox/mlx5/core/en/tc\_ct.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlx5/core/en/tc_ct.c?id=89064d09c56b44c668509bf793c410484f63f5ad) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 0 deletions

| diff --git a/drivers/net/ethernet/mellanox/mlx5/core/en/tc\_ct.c b/drivers/net/ethernet/mellanox/mlx5/core/en/tc\_ct.cindex fadfa8b50bebeb..8c4e3ecef5901c 100644--- a/[drivers/net/ethernet/mellanox/mlx5/core/en/tc\_ct.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en/tc_ct.c?id=9f13231484939dc3e08816cd227a381a13bc9f42)+++ b/[drivers/net/ethernet/mellanox/mlx5/core/en/tc\_ct.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlx5/core/en/tc_ct.c?id=89064d09c56b44c668509bf793c410484f63f5ad)@@ -920,6 +920,7 @@ err\_rule: mlx5\_tc\_ct\_entry\_destroy\_mod\_hdr(ct\_priv, zone\_rule->attr, mh); mlx5\_put\_label\_mapping(ct\_priv, attr->ct\_attr.ct\_labels\_id); err\_mod\_hdr:+ \*attr = \*old\_attr; kfree(old\_attr); err\_attr: kvfree(spec); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 18:10:41 +0000

