=== Content from github.com_3b61d9c0_20250110_161159.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrifectatechfoundation%2Fsudo-rs%2Fsecurity%2Fadvisories%2FGHSA-2r3c-m6v7-9354)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrifectatechfoundation%2Fsudo-rs%2Fsecurity%2Fadvisories%2FGHSA-2r3c-m6v7-9354)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=trifectatechfoundation%2Fsudo-rs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[trifectatechfoundation](/trifectatechfoundation)
/
**[sudo-rs](/trifectatechfoundation/sudo-rs)**
Public

* [Notifications](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs) You must be signed in to change notification settings
* [Fork
  79](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs)
* [Star
   3k](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs)

* [Code](/trifectatechfoundation/sudo-rs)
* [Issues
  64](/trifectatechfoundation/sudo-rs/issues)
* [Pull requests
  5](/trifectatechfoundation/sudo-rs/pulls)
* [Actions](/trifectatechfoundation/sudo-rs/actions)
* [Security](/trifectatechfoundation/sudo-rs/security)
* [Insights](/trifectatechfoundation/sudo-rs/pulse)

Additional navigation options

* [Code](/trifectatechfoundation/sudo-rs)
* [Issues](/trifectatechfoundation/sudo-rs/issues)
* [Pull requests](/trifectatechfoundation/sudo-rs/pulls)
* [Actions](/trifectatechfoundation/sudo-rs/actions)
* [Security](/trifectatechfoundation/sudo-rs/security)
* [Insights](/trifectatechfoundation/sudo-rs/pulse)

# Session File Relative Path Traversal in sudo-rs

Moderate

[rnijveld](/rnijveld)
published
GHSA-2r3c-m6v7-9354
Sep 21, 2023

## Package

cargo

sudo-rs
([Rust](/advisories?query=ecosystem%3Arust))

## Affected versions

<= 0.2.0

## Patched versions

0.2.1

## Description

### Background

Sudo-rs allows users to not have to enter authentication at every sudo attempt, but instead only requiring authentication every once in a while in every terminal or process group. Only once a configurable timeout has passed will the user have to re-authenticate themselves. Supporting this functionality is a set of session files (timestamps) for each user, stored in `/var/run/sudo-rs/ts`. These files are named according to the username from which the sudo attempt is made (the origin user).

### Impact

An issue was discovered where usernames containing the `.` and `/` characters could result in the corruption of specific files on the filesystem. As usernames are generally not limited by the characters they can contain, a username appearing to be a relative path can be constructed. For example we could add a user to the system containing the username `../../../../bin/cp`. When logged in as a user with that name, that user could run `sudo -K` to clear their session record file. The session code then constructs the path to the session file by concatenating the username to the session file storage directory, resulting in a resolved path of `/bin/cp`. The code then clears that file, resulting in the `cp` binary effectively being removed from the system.

An attacker needs to be able to login as a user with a constructed username. Given that such a username is unlikely to exist on an existing system, they will also need to be able to create the users with the constructed usernames.

### Patches

The bug is fixed in version 0.2.1 of sudo-rs. Sudo-rs now uses the uid for the user instead of their username for determining the filename. Note that an upgrade to this version will result in existing session files being ignored and users will be forced to re-authenticate. It also fully eliminates any possibility of path traversal, given that uids are always integer values.

### Workarounds

The `sudo -K` and `sudo -k` commands can run, even if a user has no sudo access. Make sure that your system does not contain any users with a specially crafted username. While this is the case and while untrusted users do not have the ability to create arbitrary users on your system you should not be able to exploit this issue.

### References

This issue was identified by Andrea Jegher from Radically Open Security during an audit of the sudo-rs code.

### Severity

Moderate

4.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
High

User interaction
Required

Scope
Unchanged

Confidentiality
None

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:H/UI:R/S:U/C:N/I:H/A:L

### CVE ID

CVE-2023-42456

### Weaknesses

[CWE-23](/advisories?query=cwe%3A23)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_35f2aa67_20250110_161156.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2023/11/01/3) [[next>]](2) [[thread-next>]](../../../2023/11/06/1) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <9db1110b-7dbb-4e32-b174-b62672181c8e@oracle.com>
Date: Thu, 2 Nov 2023 11:40:04 -0700
From: Alan Coopersmith <alan.coopersmith@...cle.com>
To: oss-security@...ts.openwall.com
Subject: Session File Relative Path Traversal in sudo-rs

[I'm not involved with this project or disclosure, but saw it go by and
  thought it worth mentioning here.]

<https://github.com/memorysafety/sudo-rs/security/advisories/GHSA-2r3c-m6v7-9354>
discloses CVE-2023-42456 in versions 0.2.0 & older of the Rust rewrite of sudo.

This vulnerability requires two pre-conditions:

1) Your OS allows usernames containing both '.' and '/' characters.

2) Your site allows users to create usernames containing both '.' and '/'
    characters, with no process or manual review that denies such things.

If both are true, when sudo-rs created a filename containing the username,
it failed to escape the characters, letting them be interpreted by the
filesystem as references to higher level directories ('/../..' etc.)

I don't know how many OS'es meet requirement 1, nor how many sites meet
requirement 2, but it appears the sudo-rs security auditors were able to
convince the developers that the numbers were not provably zero for both.

If those numbers are non-zero, then I have to imagine there's also a non-zero
number of other programs with similar bugs when creating files with usernames
in.

--
         -Alan Coopersmith-                 alan.coopersmith@...cle.com
          Oracle Solaris Engineering - <https://blogs.oracle.com/solaris>

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).



=== Content from github.com_5ab56725_20250110_161159.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrifectatechfoundation%2Fsudo-rs%2Fcommit%2Fbfdbda22968e3de43fa8246cab1681cfd5d5493d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrifectatechfoundation%2Fsudo-rs%2Fcommit%2Fbfdbda22968e3de43fa8246cab1681cfd5d5493d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=trifectatechfoundation%2Fsudo-rs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[trifectatechfoundation](/trifectatechfoundation)
/
**[sudo-rs](/trifectatechfoundation/sudo-rs)**
Public

* [Notifications](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs) You must be signed in to change notification settings
* [Fork
  79](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs)
* [Star
   3k](/login?return_to=%2Ftrifectatechfoundation%2Fsudo-rs)

* [Code](/trifectatechfoundation/sudo-rs)
* [Issues
  64](/trifectatechfoundation/sudo-rs/issues)
* [Pull requests
  5](/trifectatechfoundation/sudo-rs/pulls)
* [Actions](/trifectatechfoundation/sudo-rs/actions)
* [Security](/trifectatechfoundation/sudo-rs/security)
* [Insights](/trifectatechfoundation/sudo-rs/pulse)

Additional navigation options

* [Code](/trifectatechfoundation/sudo-rs)
* [Issues](/trifectatechfoundation/sudo-rs/issues)
* [Pull requests](/trifectatechfoundation/sudo-rs/pulls)
* [Actions](/trifectatechfoundation/sudo-rs/actions)
* [Security](/trifectatechfoundation/sudo-rs/security)
* [Insights](/trifectatechfoundation/sudo-rs/pulse)

## Commit

[Permalink](/trifectatechfoundation/sudo-rs/commit/bfdbda22968e3de43fa8246cab1681cfd5d5493d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-2r3c-m6v7-9354](https://github.com/advisories/GHSA-2r3c-m6v7-9354 "GHSA-2r3c-m6v7-9354")

[Browse files](/trifectatechfoundation/sudo-rs/tree/bfdbda22968e3de43fa8246cab1681cfd5d5493d)
Browse the repository at this point in the history

```
Use uid instead of username for storing session files
```

* Loading branch information

[![@rnijveld](https://avatars.githubusercontent.com/u/193783?s=40&v=4)](/rnijveld)

[rnijveld](/trifectatechfoundation/sudo-rs/commits?author=rnijveld "View all commits by rnijveld")
authored
Sep 21, 2023

2 parents
[9098406](/trifectatechfoundation/sudo-rs/commit/90984061fdb58a3139bcf3bfc9e50119a8b2fb57)
+
[6ce50df](/trifectatechfoundation/sudo-rs/commit/6ce50df620760deb8fb60e2794d0cbe4caa32623)

commit bfdbda2

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**22 additions**
and
**19 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + sudo

    - src/sudo/mod.rs
      [mod.rs](#diff-2050f94fd9259b62161ac792863383346ca89370ac51e7cdb2e0dac5b5faf858)
    - src/sudo/pipeline.rs
      [pipeline.rs](#diff-d4f495d8c90483170619826945e5a30da468852ed41f0d212c47ca07924ea8a8)
  + system

    - src/system/timestamp.rs
      [timestamp.rs](#diff-fe75b5617267100ec347e257100bb5ecd139d416576907336f772537eb4e2a34)

## There are no files selected for viewing

4 changes: 2 additions & 2 deletions

4
[src/sudo/mod.rs](#diff-2050f94fd9259b62161ac792863383346ca89370ac51e7cdb2e0dac5b5faf858 "src/sudo/mod.rs")

Show comments

[View file](/trifectatechfoundation/sudo-rs/blob/bfdbda22968e3de43fa8246cab1681cfd5d5493d/src/sudo/mod.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -92,15 +92,15 @@ fn sudo\_process() -> Result<(), Error> { |
|  |  | SudoAction::RemoveTimestamp => { |
|  |  | let user = resolve\_current\_user()?; |
|  |  | let mut record\_file = |
|  |  | SessionRecordFile::open\_for\_user(&user.name, Duration::seconds(0))?; |
|  |  | SessionRecordFile::open\_for\_user(user.uid, Duration::seconds(0))?; |
|  |  | record\_file.reset()?; |
|  |  | Ok(()) |
|  |  | } |
|  |  | SudoAction::ResetTimestamp => { |
|  |  | if let Some(scope) = RecordScope::for\_process(&Process::new()) { |
|  |  | let user = resolve\_current\_user()?; |
|  |  | let mut record\_file = |
|  |  | SessionRecordFile::open\_for\_user(&user.name, Duration::seconds(0))?; |
|  |  | SessionRecordFile::open\_for\_user(user.uid, Duration::seconds(0))?; |
|  |  | record\_file.disable(scope, None)?; |
|  |  | } |
|  |  | Ok(()) |
| Expand Down | |  |

12 changes: 6 additions & 6 deletions

12
[src/sudo/pipeline.rs](#diff-d4f495d8c90483170619826945e5a30da468852ed41f0d212c47ca07924ea8a8 "src/sudo/pipeline.rs")

Show comments

[View file](/trifectatechfoundation/sudo-rs/blob/bfdbda22968e3de43fa8246cab1681cfd5d5493d/src/sudo/pipeline.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -133,7 +133,7 @@ impl<Policy: PolicyPlugin, Auth: AuthPlugin> Pipeline<Policy, Auth> { |
|  |  | context.use\_session\_records, |
|  |  | scope, |
|  |  | context.current\_user.uid, |
|  |  | &context.current\_user.name, |
|  |  | context.current\_user.uid, |
|  |  | prior\_validity, |
|  |  | ); |
|  |  | self.authenticator.init(context)?; |
| Expand Down  Expand Up | | @@ -201,7 +201,7 @@ fn determine\_auth\_status( |
|  |  | use\_session\_records: bool, |
|  |  | record\_for: Option<RecordScope>, |
|  |  | auth\_uid: UserId, |
|  |  | current\_user: &str, |
|  |  | current\_user: UserId, |
|  |  | prior\_validity: Duration, |
|  |  | ) -> AuthStatus { |
|  |  | if !must\_policy\_authenticate { |
| Expand Down  Expand Up | | @@ -232,13 +232,13 @@ fn determine\_auth\_status( |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | struct AuthStatus<'a> { |
|  |  | struct AuthStatus { |
|  |  | must\_authenticate: bool, |
|  |  | record\_file: Option<SessionRecordFile<'a>>, |
|  |  | record\_file: Option<SessionRecordFile>, |
|  |  | } |
|  |  |  |
|  |  | impl<'a> AuthStatus<'a> { |
|  |  | fn new(must\_authenticate: bool, record\_file: Option<SessionRecordFile<'a>>) -> AuthStatus<'a> { |
|  |  | impl AuthStatus { |
|  |  | fn new(must\_authenticate: bool, record\_file: Option<SessionRecordFile>) -> AuthStatus { |
|  |  | AuthStatus { |
|  |  | must\_authenticate, |
|  |  | record\_file, |
| Expand Down | |  |

25 changes: 14 additions & 11 deletions

25
[src/system/timestamp.rs](#diff-fe75b5617267100ec347e257100bb5ecd139d416576907336f772537eb4e2a34 "src/system/timestamp.rs")

Show comments

[View file](/trifectatechfoundation/sudo-rs/blob/bfdbda22968e3de43fa8246cab1681cfd5d5493d/src/system/timestamp.rs)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,18 +35,18 @@ const SIZE\_OF\_BOOL: i64 = std::mem::size\_of::<BoolStorage>() as i64; |
|  |  | const MOD\_OFFSET: i64 = SIZE\_OF\_TS + SIZE\_OF\_BOOL; |
|  |  |  |
|  |  | #[derive(Debug)] |
|  |  | pub struct SessionRecordFile<'u> { |
|  |  | pub struct SessionRecordFile { |
|  |  | file: File, |
|  |  | timeout: Duration, |
|  |  | for\_user: &'u str, |
|  |  | for\_user: UserId, |
|  |  | } |
|  |  |  |
|  |  | impl<'u> SessionRecordFile<'u> { |
|  |  | impl SessionRecordFile { |
|  |  | const BASE\_PATH: &'static str = "/var/run/sudo-rs/ts"; |
|  |  |  |
|  |  | pub fn open\_for\_user(user: &'u str, timeout: Duration) -> io::Result<Self> { |
|  |  | pub fn open\_for\_user(user: UserId, timeout: Duration) -> io::Result<Self> { |
|  |  | let mut path = PathBuf::from(Self::BASE\_PATH); |
|  |  | path.push(user); |
|  |  | path.push(user.to\_string()); |
|  |  | SessionRecordFile::new(user, secure\_open\_cookie\_file(&path)?, timeout) |
|  |  | } |
|  |  |  |
| Expand All | | @@ -59,7 +59,7 @@ impl<'u> SessionRecordFile<'u> { |
|  |  | /// Create a new SessionRecordFile from the given i/o stream. |
|  |  | /// Timestamps in this file are considered valid if they were created or |
|  |  | /// updated at most `timeout` time ago. |
|  |  | pub fn new(for\_user: &'u str, io: File, timeout: Duration) -> io::Result<Self> { |
|  |  | pub fn new(for\_user: UserId, io: File, timeout: Duration) -> io::Result<Self> { |
|  |  | let mut session\_records = SessionRecordFile { |
|  |  | file: io, |
|  |  | timeout, |
| Expand Down  Expand Up | | @@ -578,6 +578,8 @@ mod tests { |
|  |  |  |
|  |  | use crate::system::tests::tempfile; |
|  |  |  |
|  |  | const TEST\_USER\_ID: UserId = 1000; |
|  |  |  |
|  |  | impl SetLength for Cursor<Vec<u8>> { |
|  |  | fn set\_len(&mut self, new\_len: usize) -> io::Result<()> { |
|  |  | self.get\_mut().truncate(new\_len); |
| Expand Down  Expand Up | | @@ -714,25 +716,25 @@ mod tests { |
|  |  | // valid header should remain valid |
|  |  | let c = tempfile\_with\_data(&[0xD0, 0x50, 0x01, 0x00]).unwrap(); |
|  |  | let timeout = Duration::seconds(30); |
|  |  | assert!(SessionRecordFile::new("test", c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | assert!(SessionRecordFile::new(TEST\_USER\_ID, c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | let v = data\_from\_tempfile(c).unwrap(); |
|  |  | assert\_eq!(&v[..], &[0xD0, 0x50, 0x01, 0x00]); |
|  |  |  |
|  |  | // invalid headers should be corrected |
|  |  | let c = tempfile\_with\_data(&[0xAB, 0xBA]).unwrap(); |
|  |  | assert!(SessionRecordFile::new("test", c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | assert!(SessionRecordFile::new(TEST\_USER\_ID, c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | let v = data\_from\_tempfile(c).unwrap(); |
|  |  | assert\_eq!(&v[..], &[0xD0, 0x50, 0x01, 0x00]); |
|  |  |  |
|  |  | // empty header should be filled in |
|  |  | let c = tempfile\_with\_data(&[]).unwrap(); |
|  |  | assert!(SessionRecordFile::new("test", c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | assert!(SessionRecordFile::new(TEST\_USER\_ID, c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | let v = data\_from\_tempfile(c).unwrap(); |
|  |  | assert\_eq!(&v[..], &[0xD0, 0x50, 0x01, 0x00]); |
|  |  |  |
|  |  | // invalid version should reset file |
|  |  | let c = tempfile\_with\_data(&[0xD0, 0x50, 0xAB, 0xBA, 0x0, 0x0]).unwrap(); |
|  |  | assert!(SessionRecordFile::new("test", c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | assert!(SessionRecordFile::new(TEST\_USER\_ID, c.try\_clone().unwrap(), timeout).is\_ok()); |
|  |  | let v = data\_from\_tempfile(c).unwrap(); |
|  |  | assert\_eq!(&v[..], &[0xD0, 0x50, 0x01, 0x00]); |
|  |  | } |
| Expand All | | @@ -741,7 +743,8 @@ mod tests { |
|  |  | fn can\_create\_and\_update\_valid\_file() { |
|  |  | let timeout = Duration::seconds(30); |
|  |  | let c = tempfile\_with\_data(&[]).unwrap(); |
|  |  | let mut srf = SessionRecordFile::new("test", c.try\_clone().unwrap(), timeout).unwrap(); |
|  |  | let mut srf = |
|  |  | SessionRecordFile::new(TEST\_USER\_ID, c.try\_clone().unwrap(), timeout).unwrap(); |
|  |  | let tty\_scope = RecordScope::Tty { |
|  |  | tty\_device: 0, |
|  |  | session\_pid: 0, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bfdbda2`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Ftrifectatechfoundation%2Fsudo-rs%2Fcommit%2Fbfdbda22968e3de43fa8246cab1681cfd5d5493d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from ferrous-systems.com_7ec534c2_20250110_161158.html ===


[![Ferrous Systems](/images/logo_256_48.svg)](/)

[Training](/training)
[Rust Experts](/rust-experts)
[Ferrocene](https://ferrocene.dev)
[Open Source](/open-source)
[Blog](/blog)
[Get in touch](/contact)
[Github](https://github.com/ferrous-systems/)
[Imprint](/imprint)
[Privacy policy](/privacy)

Menu

* [Home](/)
* [Blog](/blog)
* sudo-rs' first security audit

![Blog coding article](/images/blog/bookcover_blog_post_coding.svg)
[coding](/blog/categories/coding/)
# [sudo-rs' first security audit](/blog/sudo-rs-audit/)

Jorge
November 2023

Article
# sudo-rs' first security audit

##

Published on November 03, 2023
4 min read

* [Sudo-rs](/blog/tags/sudo-rs/)
* [Oss](/blog/tags/oss/)
* [Security](/blog/tags/security/)

Do you need help with coding?

* [Get in touch](/contact)
* [Get updates](https://eepurl.com/guoC6P)

Thanks to funding from [NLNet](https://nlnet.nl/) and [ISRG](https://www.abetterinternet.org/),
the sudo-rs team was able to request an audit from [Radically Open Security](https://www.radicallyopensecurity.com/) (ROS).
In this post, we'll share the findings of the audit and our response to those findings.

ROS performed crystal-box penetration testing on sudo-rs with the goal of
verifying that it was not possible to perform privileged actions without proper authentication.
The audit was carried out between September 4 and September 15 on revision [b5eb2c6](https://github.com/memorysafety/sudo-rs/commit/b5eb2c654f8971a7191d341228f06d58ba3746ff) of the sudo-rs codebase.

## Overview of the findings

The ROS team found one moderate severity issue and two low severity issues:

* CLN-001: relative path traversal vulnerability (moderate)
* CLN-003: Cargo configuration does not strip symbols (low)
* CLN-004: incorrect default permissions on `chown` call (low)

In addition to these findings, ROS performed fuzzing on different components of the sudo-rs code base but found no issues.
You can read the full report [here](https://github.com/memorysafety/sudo-rs/blob/audit-report/docs/audit/audit-report-sudo-rs.pdf).

## CLN-001: relative path traversal vulnerability (moderate)

### Background information

To save the user from re-entering their password on every invocation within a terminal session,
sudo maintains a timestamp file that records when the last successful authentication occurred.
The timestamp files for a user are stored in the directory `/var/run/sudo-rs/ts/$USERNAME`.

The command `sudo --remove-timestamp` removes all timestamp files associated with the invoking user by removing the entire `/var/run/sudo-rs/ts/$USERNAME` directory.

### Attack vector

An attacker able to use `sudo` and create users with names that contain special characters like dots (`.`) and slashes (`/`) can,
for example, create a user named `../../../../usr/bin/cp` and then invoke `sudo -K` as that user to remove the `/usr/bin/cp` command.

### sudo-rs team response

During the audit, it came to light that the original sudo implementation was also affected by this issue, although with a lower security severity due to their use of the `openat` function.

The team took the following actions:

* The team informed Todd Miller, the maintainer of the original sudo implementation, about the issue.
* The team prepared [a fix](https://github.com/memorysafety/sudo-rs/commit/bfdbda22968e3de43fa8246cab1681cfd5d5493d) and requested a CVE number.
* The team notified packagers of sudo-rs about the vulnerability and the bug fix release plan.
* On September 21, the team lifted the embargo on [CVE-2023-42456](https://github.com/advisories/GHSA-2r3c-m6v7-9354) and released bug fix release v0.2.1

Release 1.9.15 of the original sudo will include [a similar fix](https://github.com/sudo-project/sudo/commit/f4acc43663193e17a7280c172e57a4f9a49cb998).
There's no CVE associated to the issue in the original sudo.

## CLN-003: release configuration does not strip symbols (low)

To quote ROS:

> Description: The cargo release build does not strip symbols, so they will be included in the final binary. (..)
> Impact: Since the code is open source, there is not much information to be gained, but removing these symbols might make reverse engineering of the binary harder.

Our comments:

We consider this to be a non-issue in practice given that sudo-rs is an open source project.
Regardless, we decided to [modify the release profile to strip symbols in release builds](https://github.com/memorysafety/sudo-rs/pull/777).

The main reason we kept symbols in the release build was to run `cargo-bloat` as part of our CI checks.
`cargo-bloat` was useful during early development as it helped us identify which external dependencies were worthwhile to remove to decrease binary size.
Fast forward to today, sudo-rs only has 3 dependencies in its dependency graph and plenty of work has gone into reducing binary size so `cargo-bloat` has lost its relevance and we were OK to part with it.

## CLN-004: incorrect default permissions on `chown` call (low)

To quote ROS:

> A function used to invoke the `libc` `chown` function uses a default user ID value instead of failing.

The code in question was

```
type UserId = u16;
type GroupId = u16;

pub fn chown<S: AsRef<CStr>>(
    path: &S,
    uid: impl Into<Option<UserId>>,
    gid: impl Into<Option<GroupId>>,
) -> io::Result<()> {
    let path = path.as_ref().as_ptr();
    let uid = uid.into().unwrap_or(UserId::MAX);
    let gid = gid.into().unwrap_or(GroupId::MAX);

    cerr(unsafe { libc::chown(path, uid, gid) }).map(|_| ())
}

```

Our comments:

Indeed, this function was due for some refactoring:
this `chown` wrapper was always called with a `Some` `uid` argument.
Ultimately, [the function was refactored to not take any `Option` arguments](https://github.com/memorysafety/sudo-rs/pull/768).

---

We would like to thank ROS for conducting the first audit on sudo-rs.
We have learned a lot from it and look forward to future audits and third party reviews.
As ROS put in the report: "security is an ongoing process";
we agree that even after a piece of software has achieved a desired number of features,
work must continue to ensure the software is free from vulnerabilities and other defects.

We would like to use this opportunity to invite security researchers, penetration testers and the general developer community to review [the sudo-rs code base](https://github.com/memorysafety/sudo-rs).
Should you find a security issue, please follow our [security policy](https://github.com/memorysafety/sudo-rs/blob/main/SECURITY.md) to disclose it in a responsible manner.
For non-security issues, you can use [our bug report template on GitHub](https://github.com/memorysafety/sudo-rs/issues/new/choose).

Thanks,
the sudo-rs team

# You might be also interested in these.

![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_small.svg)
![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_medium.svg)
![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_large.svg)
[Announcement](/blog/categories/announcement/)
# [Ferrocene 24.11.0 now available!](/blog/ferrocene-24-11-0/)

* [Ferrocene](/blog/tags/ferrocene/)

Ana
November 2024

[Read more](/blog/ferrocene-24-11-0/)

![Blog coding article](/images/blog/bookcover_blog_overview_coding_small.svg)
![Blog coding article](/images/blog/bookcover_blog_overview_coding_medium.svg)
![Blog coding article](/images/blog/bookcover_blog_overview_coding_large.svg)
[Open Source](/blog/categories/open-source/)
# [Security in hickory-dns](/blog/hickory-dns-client/)

* [Open source](/blog/tags/open-source/)
* [Dns](/blog/tags/dns/)
* [Hickory-dns](/blog/tags/hickory-dns/)

Sebastian
November 2024

[Read more](/blog/hickory-dns-client/)

![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_small.svg)
![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_medium.svg)
![Blog announcement article](/images/blog/bookcover_blog_overview_announcement_large.svg)
[Announcement](/blog/categories/announcement/)
# [Ferrocene 24.08.0 now available!](/blog/ferrocene-24-08-0/)

* [Ferrocene](/blog/tags/ferrocene/)

Pietro
August 2024

[Read more](/blog/ferrocene-24-08-0/)

[![ISO 9001 certificate](/images/ISO_9001_colour_single.gif)](https://www.tuvsud.com/en/services/auditing-and-system-certification/iso-9001)
[![Ferrous Systems: consulting and made-to-measure solutions with Rust programming.](/images/logo_256_48.svg)](/)

[Training](/training)
[Rust Experts](/rust-experts)
[Ferrocene](/ferrocene)
[Open Source](/open-source)
[Blog](/blog)

[Github](https://github.com/ferrous-systems/)
[LinkedIn](https://de.linkedin.com/company/ferrous-systems)
[Mastodon](https://social.ferrous-systems.com/%40ferrous)
[Twitter](https://twitter.com/FerrousSystems/)

[Get in touch](/contact)
[Imprint](/imprint)
[Privacy policy](/privacy)


