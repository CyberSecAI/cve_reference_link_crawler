```
{
  "CVE-2024-27297": {
    "Description": "A fixed-output derivation on Linux can send file descriptors to files in the Nix store to another program running on the host (or another fixed-output derivation) via Unix domain sockets in the abstract namespace. This allows to modify the output of the derivation, after Nix has registered the path as \"valid\" and immutable in the Nix database. In particular, this allows the output of fixed-output derivations to be modified from their expected content.",
    "Root cause": "The vulnerability stems from the ability of fixed-output derivations to send file descriptors to files within the Nix store via abstract Unix domain sockets. Because these sockets are namespaced using the network namespace, file descriptors can be passed between processes within the same network namespace, even across sandbox boundaries.",
    "Weaknesses": [
      "File descriptor leakage from the Nix sandbox.",
      "Ability to modify files in the Nix store post registration.",
      "Fixed-output derivations having network namespace access."
    ],
    "Impact": "The vulnerability allows a malicious actor to modify the output of a fixed-output derivation after it has been registered as valid and immutable in the Nix database. This can lead to the corruption of trusted outputs, such as binaries and libraries, which could compromise the integrity and security of systems built using Nix. In theory, this could allow for supply chain attacks via poisoning of commonly used build outputs.",
     "Attack vectors": [
      "Exploiting Unix domain sockets in the abstract namespace to transfer file descriptors out of the Nix sandbox.",
      "Cooperating Nix derivations to exfiltrate file descriptors."
    ],
    "Required attacker capabilities/position": [
       "Ability to create and execute malicious Nix derivations.",
       "Low privilege access to initiate a build process.",
       "Ability to modify files within the Nix store through an exfiltrated file descriptor."
    ],
    "Patches": "The vulnerability is addressed by copying output paths after the builder is done, but before hashing. This way, any retained handles have no effect since the hash is done on a file the builder no longer has access to. Additionally,  there are discussions about potentially blocking abstract unix sockets or placing the FOD builder in its own network namespace."
  }
}
```