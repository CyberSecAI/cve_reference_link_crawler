=== Content from research.splunk.com_e2d494c1_20250108_125230.html ===

[![Splunk Security Content Logo](https://research.splunk.com/images/logo.svg)](https://research.splunk.com/)

* [Analytic Stories](https://research.splunk.com/stories/)
* [Detections](https://research.splunk.com/detections/)
* [Playbooks](https://research.splunk.com/playbooks/)
* [Data Sources](https://research.splunk.com/sources/)
* [Blog](https://www.splunk.com/en_us/blog/author/secmrkt-research.html)
* [About](http://splunk.com/threat-research)
* [![GitHub Repo](https://research.splunk.com/images/GitHubMarkLight.svg)](https://github.com/splunk/security_content)

## Table of Contents

* + [Description](#description)
  + [Search](#search)
  + [Data Source](#data-source)
  + [Macros Used](#macros-used)
  + [Annotations](#annotations)
  + [Default Configuration](#default-configuration)
  + [Implementation](#implementation)
  + [Known False Positives](#known-false-positives)
  + [Associated Analytic Story](#associated-analytic-story)
  + [Risk Based Analytics (RBA)](#risk-based-analytics-rba)
  + [References](#references)
  + [Detection Testing](#detection-testing)

# Detection: Splunk Data exfiltration from Analytics Workspace using sid query

Updated Date: 2024-10-17
ID: b6d77c6c-f011-4b03-8650-8f10edb7c4a8
Author: Rod Soto, Eric McGinnis
[Type: Hunting](#default-configuration)
[Product: Splunk Enterprise Security](https://www.splunk.com/en_us/products/enterprise-security.html)
### Description

The following analytic identifies attempts to exfiltrate data by executing a prepositioned malicious search ID in Splunk's Analytic Workspace. It leverages the `audit_searches` data source to detect suspicious `mstats` commands indicative of injection attempts. This activity is significant as it may indicate a phishing-based attack where an attacker compels a victim to initiate a malicious request, potentially leading to unauthorized data access. If confirmed malicious, this could result in significant data exfiltration, compromising sensitive information and impacting the organization's security posture.

### Search

```
1`audit_searches` info=granted search NOT ("audit_searches") search NOT ("security_content_summariesonly") AND ((search="*mstats*[*]*" AND provenance="N/A") OR (search="*mstats*\\\"*[*]*\\\"*"))
2| eval warning=if(match(search,"\\\\\""), "POTENTIAL INJECTION STAGING", "POTENTIAL INJECTION EXECUTION")
3| table search, user, warning, timestamp
4| `splunk_data_exfiltration_from_analytics_workspace_using_sid_query_filter`

```
### Data Source

| Name | Platform | Sourcetype | Source |
| --- | --- | --- | --- |
| [Splunk](/sources/d8a2c791-460b-4756-a8e5-ecade77b21e3) | Splunk icon [Splunk](/platform/splunk) | `'splunkd_ui_access'` | `'splunkd_ui_access.log'` |

### Macros Used

| Name | Value |
| --- | --- |
| [audit\_searches](https://github.com/splunk/security_content/blob/develop/macros/audit_searches.yml) | `index=_audit sourcetype=audittrail action=search` |
| splunk\_data\_exfiltration\_from\_analytics\_workspace\_using\_sid\_query\_filter | `search *` |

`splunk_data_exfiltration_from_analytics_workspace_using_sid_query_filter` is an empty macro by default. It allows the user to filter out any results (false positives) without editing the SPL.
### Annotations

- MITRE ATT&CK

+ Kill Chain Phases

+ NIST

+ CIS

- Threat Actors

| ID | Technique | Tactic |
| --- | --- | --- |
| [T1567](https://attack.mitre.org/techniques/T1567/) | Exfiltration Over Web Service | Exfiltration |

KillChainPhase.ACTIONS\_ON\_OBJECTIVES

NistCategory.DE\_AE

Cis18Value.CIS\_10

APT28
Magic Hound

### Default Configuration

This detection is configured by default in Splunk Enterprise Security to run with the following settings:

| Setting | Value |
| --- | --- |
| Disabled | true |
| Cron Schedule | `0 * * * *` |
| Earliest Time | `-70m@m` |
| Latest Time | `-10m@m` |
| Schedule Window | `auto` |
| Creates Risk Event | False |

This configuration file applies to all detections of type hunting.
### Implementation

The vulnerability affects only instances with Splunk Web Enabled. After running this search, please run "Splunk Command and Scripting Interpreter Risky SPL MLTK" to gain more insight into potentially risky commands which could lead to data exfiltration.

### Known False Positives

This search may produce false positives. This detection does not require you to ingest any new data. The detection does require the ability to search the \_audit index. Special attention must be paid to "/en-US/app/search/analytics\_workspace?sid=[sid]" which is where the malicious code will be inserted to trigger attack at victim.

### Associated Analytic Story

* [Splunk Vulnerabilities](/stories/splunk_vulnerabilities/)

### Risk Based Analytics (RBA)

| Risk Message | Risk Score | Impact | Confidence |
| --- | --- | --- | --- |
| Potential data exfiltration attack using SID query by $user$ | 25 | 50 | 50 |

The Risk Score is calculated by the following formula: Risk Score = (Impact \* Confidence/100). Initial Confidence and Impact is set by the analytic author.
### References

* <https://www.splunk.com/en_us/product-security.html>

### Detection Testing

| Test Type | Status | Dataset | Source | Sourcetype |
| --- | --- | --- | --- | --- |
| Validation | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | N/A | N/A | N/A |
| Unit | â [Passing](https://github.com/splunk/security_content/actions/workflows/build.yml) | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1567/splunk/splunk_data_exfiltration_from_analytics_workspace_using_sid_query.log) | `audittrail` | `audittrail` |
| Integration | â Passing | [Dataset](https://media.githubusercontent.com/media/splunk/attack_data/master/datasets/attack_techniques/T1567/splunk/splunk_data_exfiltration_from_analytics_workspace_using_sid_query.log) | `audittrail` | `audittrail` |

Replay any dataset to Splunk Enterprise by using our [`replay.py`](https://github.com/splunk/attack_data#using-replaypy) tool or the [UI](https://github.com/splunk/attack_data#using-ui).
Alternatively you can replay a dataset into a [Splunk Attack Range](https://github.com/splunk/attack_range#replay-dumps-into-attack-range-splunk-server)

---

Source: [GitHub](https://github.com/splunk/security_content/tree/develop/detections/application/splunk_data_exfiltration_from_analytics_workspace_using_sid_query.yml) |
Version: **3**

[Detection: Splunk Command and Scripting Interpreter Risky Commands](https://research.splunk.com/application/1cf58ae1-9177-40b8-a26c-8966040f11ae/ "Detection: Splunk Command and Scripting Interpreter Risky Commands")

[Detection: Splunk Digital Certificates Infrastructure Version](https://research.splunk.com/application/3c162281-7edb-4ebc-b9a4-5087aaf28fa7/ "Detection: Splunk Digital Certificates Infrastructure Version")

Â© 2005 - 2024 Splunk LLC All rights reserved.



=== Content from www.splunk.com_f0dfcb2b_20250108_125231.html ===
 [![ ](/assets/img/logo.svg)](https://www.splunk.com/)

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)

 Toggle menu

* [Home](/)
* [Report a Vulnerability](/report)
* [FAQs](/faqs)
* [Mailing List](https://www.splunk.com/en_us/form/splunk-security-advisories-notification.html)
# Risky command safeguards bypass via Search ID query in Analytics Workspace in Splunk Enterprise

**Advisory ID:** SVD-2022-1106

**CVE ID:** [CVE-2022-43566](https://www.cve.org/CVERecord?id=CVE-2022-43566)

**Published:** 2022-11-02

**Last Update:** 2022-11-02

**CVSSv3.1 Score:** 7.3, High, High

**CVSSv3.1 Vector:** [CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N)

**CWE:** [CWE-20](https://cwe.mitre.org/data/definitions/20.html)

**Bug ID:** SPL-223730

## Description

In Splunk Enterprise versions below 8.2.9, 8.1.12, and 9.0.2, an authenticated user can run risky commands using a more privileged user’s permissions to bypass [SPL safeguards for risky commands](https://docs.splunk.com/Documentation/SplunkCloud/latest/Security/SPLsafeguards) in the Analytics Workspace. The vulnerability requires the attacker to phish the victim by tricking them into initiating a request within their browser. The attacker cannot exploit the vulnerability at will.

## Solution

For Splunk Enterprise, upgrade versions to 8.1.12, 8.2.9, 9.0.2, or higher.

For Splunk Cloud Platform, Splunk is actively patching and monitoring the Splunk Cloud instances.

## Product Status

| Product | Version | Component | Affected Version | Fix Version |
| --- | --- | --- | --- | --- |
| Splunk Enterprise | 8.1 | Splunk Web | 8.1.11 and lower | 8.1.12 |
| Splunk Enterprise | 8.2 | Splunk Web | 8.2.0 to 8.2.8 | 8.2.9 |
| Splunk Enterprise | 9.0 | Splunk Web | 9.0.0 to 9.0.1 | 9.0.2 |
| Splunk Cloud Platform |  | Splunk Web | 9.0.2205 and lower | 9.0.2208 |

## Mitigations and Workarounds

The vulnerability affects instances with the Analytics Workspace enabled. Disabling the Analytics Workplace application is a possible workaround. For more information on managing apps, see [Manage app and add-on objects](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Managingappobjects).

The vulnerability affects instances with [Splunk Web](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) enabled, disabling Splunk Web is a possible workaround. See [Disable unnecessary Splunk Enterprise components](https://docs.splunk.com/Documentation/Splunk/latest/Security/DisableunnecessarySplunkcomponents) and the [web.conf](https://docs.splunk.com/Documentation/Splunk/latest/Admin/Webconf) configuration specification file for more information on disabling Splunk Web.

## Detections

* [Splunk Data exfiltration from Analytics Workspace using sid query](https://research.splunk.com/application/b6d77c6c-f011-4b03-8650-8f10edb7c4a8/)

This detection search lets operators discover attempts to exfiltrate data by bypassing search ID queries in Analytics Workspace in Splunk Enterprise versions 8.2.9, 8.1.12, and 9.0.2.

## Severity

Splunk rates the vulnerability as High, 7.3, with CVSS Vectors of CVSS:3.1/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:H/A:N.

The vulnerability requires both the compromise of a user’s account and user interaction within a browser of a higher privileged user. The vulnerability lets an attacker run risky commands with permissions of a highly privileged user. For more information on risky commands and potential impacts, see [SPL safeguards for risky commands](https://docs.splunk.com/Documentation/SplunkCloud/latest/Security/SPLsafeguards).

If the Splunk Enterprise instance does not run Splunk Web, there is no impact and the severity is Informational.

## Acknowledgments

Anton (therceman)

* Email
* [RSS Feed](/feed.xml)
* [Support](https://login.splunk.com/page/sso_redirect?type=portal)
© 2005 - 2025 Splunk Inc. All rights reserved.[Legal](https://www.splunk.com/en_us/legal.html)     [Privacy     [Website Terms of Use](https://www.splunk.com/en_us/legal/terms/terms-of-use.html)](https://www.splunk.com/en_us/legal/privacy/privacy-policy.html)
