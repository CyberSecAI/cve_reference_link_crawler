

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Paulo Alcantara <pc@manguebit.com> | 2024-02-11 20:19:30 -0300 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:25:13 +0100 |
| commit | [c2aa2718cda2d56b4a551cb40043e9abc9684626](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)) | |
| tree | [3d3577df002e860828951d242b0ae00099a67c32](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626) | |
| parent | [e5643b23cbb064dd3ef1388e933e0964130e048e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e5643b23cbb064dd3ef1388e933e0964130e048e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626&id2=e5643b23cbb064dd3ef1388e933e0964130e048e)) | |
| download | [linux-c2aa2718cda2d56b4a551cb40043e9abc9684626.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-c2aa2718cda2d56b4a551cb40043e9abc9684626.tar.gz) | |

smb: client: set correct id, uid and cruid for multiuser automountscommit 4508ec17357094e2075f334948393ddedbb75157 upstream.
When uid, gid and cruid are not specified, we need to dynamically
set them into the filesystem context used for automounting otherwise
they'll end up reusing the values from the parent mount.
Fixes: 9fd29a5bae6e ("cifs: use fs\_context for automounts")
Reported-by: Shane Nehring <snehring@iastate.edu>
Closes: https://bugzilla.redhat.com/show\_bug.cgi?id=2259257
Cc: stable@vger.kernel.org # 6.2+
Signed-off-by: Paulo Alcantara (Red Hat) <pc@manguebit.com>
Signed-off-by: Steve French <stfrench@microsoft.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)

| -rw-r--r-- | [fs/smb/client/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/smb/client/namespace.c?id=c2aa2718cda2d56b4a551cb40043e9abc9684626) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 16 insertions, 0 deletions

| diff --git a/fs/smb/client/namespace.c b/fs/smb/client/namespace.cindex a6968573b775e7..4a517b280f2b79 100644--- a/[fs/smb/client/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/smb/client/namespace.c?id=e5643b23cbb064dd3ef1388e933e0964130e048e)+++ b/[fs/smb/client/namespace.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/smb/client/namespace.c?id=c2aa2718cda2d56b4a551cb40043e9abc9684626)@@ -168,6 +168,21 @@ static char \*automount\_fullpath(struct dentry \*dentry, void \*page) return s; } +static void fs\_context\_set\_ids(struct smb3\_fs\_context \*ctx)+{+ kuid\_t uid = current\_fsuid();+ kgid\_t gid = current\_fsgid();++ if (ctx->multiuser) {+ if (!ctx->uid\_specified)+ ctx->linux\_uid = uid;+ if (!ctx->gid\_specified)+ ctx->linux\_gid = gid;+ }+ if (!ctx->cruid\_specified)+ ctx->cred\_uid = uid;+}+ /\* \* Create a vfsmount that we can automount \*/@@ -205,6 +220,7 @@ static struct vfsmount \*cifs\_do\_automount(struct path \*path) tmp.leaf\_fullpath = NULL; tmp.UNC = tmp.prepath = NULL; tmp.dfs\_root\_ses = NULL;+ fs\_context\_set\_ids(&tmp);  rc = smb3\_fs\_context\_dup(ctx, &tmp); if (rc) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:23:10 +0000

