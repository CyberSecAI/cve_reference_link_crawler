

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Alex Williamson <alex.williamson@redhat.com> | 2024-04-01 10:53:00 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-13 12:59:21 +0200 |
| commit | [a563fc18583ca4f42e2fdd0c70c7c618288e7ede](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)) | |
| tree | [ed92e80cb25064ddb5f75067b253d92e58cca99d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede) | |
| parent | [09452c8fcbd7817c06e8e3212d99b45917e603a5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=09452c8fcbd7817c06e8e3212d99b45917e603a5) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede&id2=09452c8fcbd7817c06e8e3212d99b45917e603a5)) | |
| download | [linux-a563fc18583ca4f42e2fdd0c70c7c618288e7ede.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a563fc18583ca4f42e2fdd0c70c7c618288e7ede.tar.gz) | |

vfio/fsl-mc: Block calling interrupt handler without trigger[ Upstream commit 7447d911af699a15f8d050dfcb7c680a86f87012 ]
The eventfd\_ctx trigger pointer of the vfio\_fsl\_mc\_irq object is
initially NULL and may become NULL if the user sets the trigger
eventfd to -1. The interrupt handler itself is guaranteed that
trigger is always valid between request\_irq() and free\_irq(), but
the loopback testing mechanisms to invoke the handler function
need to test the trigger. The triggering and setting ioctl paths
both make use of igate and are therefore mutually exclusive.
The vfio-fsl-mc driver does not make use of irqfds, nor does it
support any sort of masking operations, therefore unlike vfio-pci
and vfio-platform, the flow can remain essentially unchanged.
Cc: Diana Craciun <diana.craciun@oss.nxp.com>
Cc: <stable@vger.kernel.org>
Fixes: cc0ee20bd969 ("vfio/fsl-mc: trigger an interrupt via eventfd")
Reviewed-by: Kevin Tian <kevin.tian@intel.com>
Reviewed-by: Eric Auger <eric.auger@redhat.com>
Link: [https://lore.kernel.org/r/20240308230557.805580-8-alex.williamson@redhat.com](https://lore.kernel.org/r/20240308230557.805580-8-alex.williamson%40redhat.com)
Signed-off-by: Alex Williamson <alex.williamson@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)

| -rw-r--r-- | [drivers/vfio/fsl-mc/vfio\_fsl\_mc\_intr.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/vfio/fsl-mc/vfio_fsl_mc_intr.c?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 3 deletions

| diff --git a/drivers/vfio/fsl-mc/vfio\_fsl\_mc\_intr.c b/drivers/vfio/fsl-mc/vfio\_fsl\_mc\_intr.cindex 0d9f3002df7f51..86f770e6d0f8ef 100644--- a/[drivers/vfio/fsl-mc/vfio\_fsl\_mc\_intr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vfio/fsl-mc/vfio_fsl_mc_intr.c?id=09452c8fcbd7817c06e8e3212d99b45917e603a5)+++ b/[drivers/vfio/fsl-mc/vfio\_fsl\_mc\_intr.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/vfio/fsl-mc/vfio_fsl_mc_intr.c?id=a563fc18583ca4f42e2fdd0c70c7c618288e7ede)@@ -142,13 +142,14 @@ static int vfio\_fsl\_mc\_set\_irq\_trigger(struct vfio\_fsl\_mc\_device \*vdev, irq = &vdev->mc\_irqs[index];  if (flags & VFIO\_IRQ\_SET\_DATA\_NONE) {- vfio\_fsl\_mc\_irq\_handler(hwirq, irq);+ if (irq->trigger)+ eventfd\_signal(irq->trigger, 1);  } else if (flags & VFIO\_IRQ\_SET\_DATA\_BOOL) { u8 trigger = \*(u8 \*)data; - if (trigger)- vfio\_fsl\_mc\_irq\_handler(hwirq, irq);+ if (trigger && irq->trigger)+ eventfd\_signal(irq->trigger, 1); }  return 0; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:47:45 +0000

