=== Content from github.com_fd6959cd_20250111_101927.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F94591dca510c796c7d40e9b4167ea56f2fdf28ca)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F94591dca510c796c7d40e9b4167ea56f2fdf28ca)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Simplify test\_win32\_mkdir\_700 to check the exact ACL ([GH-1…](https://github.com/python/cpython/pull/119056)

[Browse files](/python/cpython/tree/94591dca510c796c7d40e9b4167ea56f2fdf28ca)
Browse the repository at this point in the history

```
[…19056](https://github.com/python/cpython/pull/119056))
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 15, 2024

1 parent
[ee13797](/python/cpython/commit/ee13797dec988884f8792144fe5b3d7f5c8083c9)

commit 94591dc

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**9 additions**
and
**16 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

23 changes: 8 additions & 15 deletions

23
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/94591dca510c796c7d40e9b4167ea56f2fdf28ca/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1814,21 +1814,14 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path1 = os.path.join(os\_helper.TESTFN, 'dir1') |
|  |  | path2 = os.path.join(os\_helper.TESTFN, 'dir2') |
|  |  | # mode=0o700 is special-cased to override ACLs on Windows |
|  |  | # There's no way to know exactly how the ACLs will look, so we'll |
|  |  | # check that they are different from a regularly created directory. |
|  |  | os.mkdir(path1, mode=0o700) |
|  |  | os.mkdir(path2, mode=0o777) |
|  |  |  |
|  |  | out1 = subprocess.check\_output(["icacls.exe", path1], encoding="oem") |
|  |  | out2 = subprocess.check\_output(["icacls.exe", path2], encoding="oem") |
|  |  | os.rmdir(path1) |
|  |  | os.rmdir(path2) |
|  |  | out1 = out1.replace(path1, "<PATH>") |
|  |  | out2 = out2.replace(path2, "<PATH>") |
|  |  | self.assertNotEqual(out1, out2) |
|  |  | path = os.path.abspath(os.path.join(os\_helper.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/94591dca510c796c7d40e9b4167ea56f2fdf28ca/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5590,7 +5590,7 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discreationary ACL (D) that is protected (P) and includes |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `94591dc`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F94591dca510c796c7d40e9b4167ea56f2fdf28ca) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4a74d292_20250111_101937.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F118486)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F118486)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fpython%2Fcpython%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [CVE-2024-4030] Enable `mkdir(mode=0o700)` to work on Windows #118486

Closed

[zooba](/zooba) opened this issue
May 1, 2024
· 2 comments

Closed

# [[CVE-2024-4030] Enable `mkdir(mode=0o700)` to work on Windows](#top) #118486

[zooba](/zooba) opened this issue
May 1, 2024
· 2 comments

Assignees
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

Labels
[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[OS-windows](/python/cpython/labels/OS-windows)
[type-security](/python/cpython/labels/type-security)
A security issue

## Comments

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=80&v=4)](/zooba)

Copy link

Member

### **[zooba](/zooba)** commented [May 1, 2024](#issue-2274095396) • edited by bedevere-app bot Loading

| If we interpret `0o700` as "only accessible by the current user", then we can imitate the behaviour with ACLs. Linked PRs  * [gh-118486: Support mkdir(mode=0o700) on Windows #118488](https://github.com/python/cpython/pull/118488) * [gh-118486: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS instead of CURRENT\_USER #118515](https://github.com/python/cpython/pull/118515) * [gh-118486: Update docs for CVE-2024-4030 reference #118737](https://github.com/python/cpython/pull/118737) * [[3.12] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) #118738](https://github.com/python/cpython/pull/118738) * [[3.11] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) #118739](https://github.com/python/cpython/pull/118739) * [[3.10] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) #118740](https://github.com/python/cpython/pull/118740) * [[3.9] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) #118741](https://github.com/python/cpython/pull/118741) * [[3.8] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) #118742](https://github.com/python/cpython/pull/118742) * [[3.13] gh-118486: Update docs for CVE-2024-4030 reference (GH-118737) #118768](https://github.com/python/cpython/pull/118768) * [gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL #119056](https://github.com/python/cpython/pull/119056) * [[3.13] gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL (GH-119056) #119068](https://github.com/python/cpython/pull/119068) * [[3.12] gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL (GH-119056) #119069](https://github.com/python/cpython/pull/119069) |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
added
the
[OS-windows](/python/cpython/labels/OS-windows)
label
[May 1, 2024](#event-12674220596)

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
self-assigned this
[May 1, 2024](#event-12674220639)

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[May 1, 2024](#ref-pullrequest-2274100169)

[gh-118486: Support mkdir(mode=0o700) on Windows
#118488](/python/cpython/pull/118488)
 Merged

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 1, 2024](#ref-commit-4bd91f2)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/4bd91f2384f97f3203e6701d956edc4c1b8ef8b9 "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[4bd91f2](/zooba/cpython/commit/4bd91f2384f97f3203e6701d956edc4c1b8ef8b9)`

[zooba](/zooba)
added a commit
that referenced
this issue
[May 2, 2024](#ref-commit-81939da)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")[GH-118488](https://github.com/python/cpython/pull/118488)[)](/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")`

`[81939da](/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e)`

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 2, 2024](#ref-commit-77b83f4)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Switch mkdir(mode=0o700) on Windows to use OWNER RIG…](/zooba/cpython/commit/77b83f4f096e4ae00e7db130b8533b2aba9c7171 "gh-118486: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS instead of CURRENT_USER")`
…

`[77b83f4](/zooba/cpython/commit/77b83f4f096e4ae00e7db130b8533b2aba9c7171)`

```
…HTS instead of CURRENT_USER
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[May 2, 2024](#ref-pullrequest-2276057425)

[gh-118486: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS instead of CURRENT\_USER
#118515](/python/cpython/pull/118515)
 Merged

[zooba](/zooba)
added a commit
that referenced
this issue
[May 2, 2024](#ref-commit-8ed5466)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS in…](/python/cpython/commit/8ed546679524140d8282175411fd141fe7df070d "gh-118486: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS instead of CURRENT_USER (GH-118515)")`
…

`[8ed5466](/python/cpython/commit/8ed546679524140d8282175411fd141fe7df070d)`

```
…stead of CURRENT_USER ([GH-118515](https://github.com/python/cpython/pull/118515))
```

[![@nineteendo](https://avatars.githubusercontent.com/u/65588599?s=80&u=d35cfb0d0493c5150f1bc5e88dcb8b463fcf5ab3&v=4)](/nineteendo)

Copy link

Contributor

### **[nineteendo](/nineteendo)** commented [May 3, 2024](#issuecomment-2092393617)

| Are you done here? |
| --- |

All reactions

Sorry, something went wrong.

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=80&v=4)](/zooba)

Copy link

Member

Author

### **[zooba](/zooba)** commented [May 3, 2024](#issuecomment-2092729438)

| No, not yet. |
| --- |

All reactions

Sorry, something went wrong.

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
changed the title
~~Enable `mkdir(mode=0o700)` to work on Windows~~
[CVE-2024-4030] Enable `mkdir(mode=0o700)` to work on Windows
[May 7, 2024](#event-12735351761)

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[May 7, 2024](#ref-pullrequest-2284230790)

[gh-118486: Update docs for CVE-2024-4030 reference
#118737](/python/cpython/pull/118737)
 Merged

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
added
[type-security](/python/cpython/labels/type-security)
A security issue
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
labels
[May 7, 2024](#event-12735363623)

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 7, 2024](#ref-commit-1193b36)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/1193b36d3ea4ec9fafaa81321b1ef545bb4be677 "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[1193b36](/zooba/cpython/commit/1193b36d3ea4ec9fafaa81321b1ef545bb4be677)`

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 7, 2024](#ref-commit-018a779)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/018a779c1e1df442a78571a0095b2783366d59cc "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[018a779](/zooba/cpython/commit/018a779c1e1df442a78571a0095b2783366d59cc)`

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 7, 2024](#ref-commit-c85fa1f)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/c85fa1f80ba9ee9f73acf8c3e66cb016a1d629a5 "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[c85fa1f](/zooba/cpython/commit/c85fa1f80ba9ee9f73acf8c3e66cb016a1d629a5)`

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 7, 2024](#ref-commit-86da8de)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/86da8debddf2149219cc1fbd9992121e6ff8d849 "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[86da8de](/zooba/cpython/commit/86da8debddf2149219cc1fbd9992121e6ff8d849)`

This was referenced May 7, 2024

[[3.12] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)
#118738](/python/cpython/pull/118738)
 Merged

[[3.11] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)
#118739](/python/cpython/pull/118739)
 Merged

[[3.10] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)
#118740](/python/cpython/pull/118740)
 Merged

[[3.9] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)
#118741](/python/cpython/pull/118741)
 Merged

[[3.8] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)
#118742](/python/cpython/pull/118742)
 Merged

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 7, 2024](#ref-commit-ffed50e)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows](/zooba/cpython/commit/ffed50e0378cdde3c5978cda59d8c71c031e2b2b "gh-118486: Support mkdir(mode=0o700) on Windows")`

`[ffed50e](/zooba/cpython/commit/ffed50e0378cdde3c5978cda59d8c71c031e2b2b)`

[SonicField](/SonicField)
pushed a commit
to SonicField/cpython
that referenced
this issue
[May 8, 2024](#ref-commit-7ff1c09)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@SonicField](https://avatars.githubusercontent.com/u/920846?s=40&v=4)](/SonicField)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/SonicField/cpython/commit/7ff1c09f56abc66100019d1e4d20e1dabd7b76ec "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")[pythonGH-118488](https://github.com/python/cpython/pull/118488)[)](/SonicField/cpython/commit/7ff1c09f56abc66100019d1e4d20e1dabd7b76ec "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")`

`[7ff1c09](/SonicField/cpython/commit/7ff1c09f56abc66100019d1e4d20e1dabd7b76ec)`

[SonicField](/SonicField)
pushed a commit
to SonicField/cpython
that referenced
this issue
[May 8, 2024](#ref-commit-abd0602)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@SonicField](https://avatars.githubusercontent.com/u/920846?s=40&v=4)](/SonicField)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Switch mkdir(mode=0o700) on Windows to use OWNER RIG…](/SonicField/cpython/commit/abd0602eb73c2321289c306b1475698adc488216 "gh-118486: Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS instead of CURRENT_USER (GH-118515)")`
…

`[abd0602](/SonicField/cpython/commit/abd0602eb73c2321289c306b1475698adc488216)`

```
…HTS instead of CURRENT_USER ([pythonGH-118515](https://github.com/python/cpython/pull/118515))
```

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[May 8, 2024](#ref-pullrequest-2285897194)

[[3.13] gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)
#118768](/python/cpython/pull/118768)
 Merged

[zooba](/zooba)
added a commit
that referenced
this issue
[May 8, 2024](#ref-commit-66f8bb7)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Update docs for](/python/cpython/commit/66f8bb76a15e64a1bb7688b177ed29e26230fdee "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)") [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") [reference (](/python/cpython/commit/66f8bb76a15e64a1bb7688b177ed29e26230fdee "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)")[GH-118737](https://github.com/python/cpython/pull/118737)[)](/python/cpython/commit/66f8bb76a15e64a1bb7688b177ed29e26230fdee "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)")`

`[66f8bb7](/python/cpython/commit/66f8bb76a15e64a1bb7688b177ed29e26230fdee)`

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 9, 2024](#ref-commit-7651f58)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[Merge branch '3.13' into](/zooba/cpython/commit/7651f58aa15c58b09952c1312bbef09bc290fdcf "Merge branch '3.13' into gh-118486-doc-3.13") [pythongh-118486](https://github.com/python/cpython/issues/118486)[-doc-3.13](/zooba/cpython/commit/7651f58aa15c58b09952c1312bbef09bc290fdcf "Merge branch '3.13' into gh-118486-doc-3.13")`

`[7651f58](/zooba/cpython/commit/7651f58aa15c58b09952c1312bbef09bc290fdcf)`

[zooba](/zooba)
added a commit
that referenced
this issue
[May 9, 2024](#ref-commit-d86b494)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Update docs for](/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84 "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)

Update docs for CVE-2024-4030 reference") [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") [reference (](/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84 "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)

Update docs for CVE-2024-4030 reference")[GH-118737](https://github.com/python/cpython/pull/118737)[)](/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84 "gh-118486: Update docs for CVE-2024-4030 reference (GH-118737)

Update docs for CVE-2024-4030 reference")`
…

`[d86b494](/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84)`

```
Update docs for [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") reference
```

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 9, 2024](#ref-commit-1288fdc)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[Merge branch '](/zooba/cpython/commit/1288fdc1f116ad43962718a762d0d25c6d86b2e9 "Merge branch 'gh-118486-3.11' of https://github.com/zooba/cpython into gh-118486-3.11")[pythongh-118486](https://github.com/python/cpython/issues/118486)[-3.11' of](/zooba/cpython/commit/1288fdc1f116ad43962718a762d0d25c6d86b2e9 "Merge branch 'gh-118486-3.11' of https://github.com/zooba/cpython into gh-118486-3.11") <https://github.com/zooba/cpython>[…](/zooba/cpython/commit/1288fdc1f116ad43962718a762d0d25c6d86b2e9 "Merge branch 'gh-118486-3.11' of https://github.com/zooba/cpython into gh-118486-3.11")`
…

`[1288fdc](/zooba/cpython/commit/1288fdc1f116ad43962718a762d0d25c6d86b2e9)`

```
… into [pythongh-118486](https://github.com/python/cpython/issues/118486)-3.11
```

[zooba](/zooba)
added a commit
that referenced
this issue
[May 9, 2024](#ref-commit-eb29e2f)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/eb29e2f5905da93333d1ce78bc98b151e763ff46 "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")[GH-118488](https://github.com/python/cpython/pull/118488)[)](/python/cpython/commit/eb29e2f5905da93333d1ce78bc98b151e763ff46 "gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488)")`

`[eb29e2f](/python/cpython/commit/eb29e2f5905da93333d1ce78bc98b151e763ff46)`

[![@bedevere-app](https://avatars.githubusercontent.com/in/388350?s=40&v=4)](/apps/bedevere-app)
[bedevere-app](/apps/bedevere-app)
bot
mentioned this issue
[May 14, 2024](#ref-pullrequest-2296478583)

[gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL
#119056](/python/cpython/pull/119056)
 Merged

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 14, 2024](#ref-commit-f6ec3b1)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL](/zooba/cpython/commit/f6ec3b18b0519c9a4ee53aa4def9a2aa0e9176f0 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL")`

`[f6ec3b1](/zooba/cpython/commit/f6ec3b18b0519c9a4ee53aa4def9a2aa0e9176f0)`

[zooba](/zooba)
added a commit
that referenced
this issue
[May 15, 2024](#ref-commit-94591dc)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[GH-1…](https://github.com/python/cpython/pull/119056)`
…

`[94591dc](/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca)`

```
[…19056](https://github.com/python/cpython/pull/119056))
```

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-4b6d638)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/miss-islington/cpython/commit/4b6d638475f68653a734ca4875d989d6d0681217 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)
(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)

Co-authored-by: Steve Dower <steve.dower@python.org>")[…](https://github.com/python/cpython/pull/119056)`
…

`[4b6d638](/miss-islington/cpython/commit/4b6d638475f68653a734ca4875d989d6d0681217)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/miss-islington/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

[miss-islington](/miss-islington)
pushed a commit
to miss-islington/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-1da9d7d)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/miss-islington/cpython/commit/1da9d7da1a70df343e4501224cd9a7471fb94e77 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)
(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)

Co-authored-by: Steve Dower <steve.dower@python.org>")[…](https://github.com/python/cpython/pull/119056)`
…

`[1da9d7d](/miss-islington/cpython/commit/1da9d7da1a70df343e4501224cd9a7471fb94e77)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/miss-islington/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

This was referenced May 15, 2024

[[3.13] gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL (GH-119056)
#119068](/python/cpython/pull/119068)
 Merged

[[3.12] gh-118486: Simplify test\_win32\_mkdir\_700 to check the exact ACL (GH-119056)
#119069](/python/cpython/pull/119069)
 Merged

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-e598a53)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/zooba/cpython/commit/e598a53aae1172f4cc67a63d10257b6624c388fe "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[…](https://github.com/python/cpython/pull/119056)`
…

`[e598a53](/zooba/cpython/commit/e598a53aae1172f4cc67a63d10257b6624c388fe)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))
```

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-77ede7c)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/zooba/cpython/commit/77ede7c481db33bf114c72e371267f35a999b4b8 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[…](https://github.com/python/cpython/pull/119056)`
…

`[77ede7c](/zooba/cpython/commit/77ede7c481db33bf114c72e371267f35a999b4b8)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))
```

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-1946e26)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/zooba/cpython/commit/1946e26c3670078185774846459c4b1acb8c3798 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[…](https://github.com/python/cpython/pull/119056)`
…

`[1946e26](/zooba/cpython/commit/1946e26c3670078185774846459c4b1acb8c3798)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))
```

[zooba](/zooba)
added a commit
to zooba/cpython
that referenced
this issue
[May 15, 2024](#ref-commit-c4b3f7a)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/zooba/cpython/commit/c4b3f7a027ecf8258ecf173812263dde27b9eaaa "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[…](https://github.com/python/cpython/pull/119056)`
…

`[c4b3f7a](/zooba/cpython/commit/c4b3f7a027ecf8258ecf173812263dde27b9eaaa)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))
```

[zooba](/zooba)
added a commit
that referenced
this issue
[May 15, 2024](#ref-commit-e1dfa97)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington) [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/python/cpython/commit/e1dfa978b1ad210d551385ad8073ec6154f53763 "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)

(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)

Co-authored-by: Steve Dower <steve.dower@python.org>")[GH-1…](https://github.com/python/cpython/pull/119056)`
…

`[e1dfa97](/python/cpython/commit/e1dfa978b1ad210d551385ad8073ec6154f53763)`

```
[…19056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

[zooba](/zooba)
added a commit
that referenced
this issue
[May 15, 2024](#ref-commit-6d0850c)
[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&u=31ad766412aaeb40a51582d882e34d67f2fae635&v=4)](/miss-islington) [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[gh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/python/cpython/commit/6d0850c4c8188035643586ab4d8ec2468abd699e "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)

(cherry picked from commit 94591dca510c796c7d40e9b4167ea56f2fdf28ca)

Co-authored-by: Steve Dower <steve.dower@python.org>")[GH-1…](https://github.com/python/cpython/pull/119056)`
…

`[6d0850c](/python/cpython/commit/6d0850c4c8188035643586ab4d8ec2468abd699e)`

```
[…19056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

[ambv](/ambv)
pushed a commit
that referenced
this issue
[May 24, 2024](#ref-commit-35c799d)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

`[[3.11]](/python/cpython/commit/35c799d79177b962ddace2fa068101465570a29a "[3.11] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118739)") [gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/35c799d79177b962ddace2fa068101465570a29a "[3.11] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118739)")[GH-118488](https://github.com/python/cpython/pull/118488)[) (](/python/cpython/commit/35c799d79177b962ddace2fa068101465570a29a "[3.11] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118739)")[G…](https://github.com/python/cpython/pull/118739)`
…

`[35c799d](/python/cpython/commit/35c799d79177b962ddace2fa068101465570a29a)`

```
[…H-118739](https://github.com/python/cpython/pull/118739))
```

[ambv](/ambv)
added a commit
to zooba/cpython
that referenced
this issue
[May 24, 2024](#ref-commit-49746a0)
[![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[Merge branch '3.10' into](/zooba/cpython/commit/49746a0221dc367a2e89c29eda9abe1a685eb9f4 "Merge branch '3.10' into gh-118486-3.10") [pythongh-118486](https://github.com/python/cpython/issues/118486)[-3.10](/zooba/cpython/commit/49746a0221dc367a2e89c29eda9abe1a685eb9f4 "Merge branch '3.10' into gh-118486-3.10")`

`[49746a0](/zooba/cpython/commit/49746a0221dc367a2e89c29eda9abe1a685eb9f4)`

[ambv](/ambv)
added a commit
to zooba/cpython
that referenced
this issue
[May 24, 2024](#ref-commit-8f0e88d)
[![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[Merge branch '3.9' into](/zooba/cpython/commit/8f0e88d351be51246f84cbe7b6bcff26bea628dc "Merge branch '3.9' into gh-118486-3.9") [pythongh-118486](https://github.com/python/cpython/issues/118486)[-3.9](/zooba/cpython/commit/8f0e88d351be51246f84cbe7b6bcff26bea628dc "Merge branch '3.9' into gh-118486-3.9")`

`[8f0e88d](/zooba/cpython/commit/8f0e88d351be51246f84cbe7b6bcff26bea628dc)`

[ambv](/ambv)
added a commit
to zooba/cpython
that referenced
this issue
[May 24, 2024](#ref-commit-18afc1f)
[![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[Merge branch '3.8' into](/zooba/cpython/commit/18afc1f4744b74b29e01f3a35c3e2207fae3163d "Merge branch '3.8' into gh-118486-3.8") [pythongh-118486](https://github.com/python/cpython/issues/118486)[-3.8](/zooba/cpython/commit/18afc1f4744b74b29e01f3a35c3e2207fae3163d "Merge branch '3.8' into gh-118486-3.8")`

`[18afc1f](/zooba/cpython/commit/18afc1f4744b74b29e01f3a35c3e2207fae3163d)`

[ambv](/ambv)
added a commit
that referenced
this issue
[May 24, 2024](#ref-commit-c8f868d)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[[3.10]](/python/cpython/commit/c8f868dc52f98011d0f9b459b6487920bfb0ac4d "[3.10] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118740)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>") [gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/c8f868dc52f98011d0f9b459b6487920bfb0ac4d "[3.10] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118740)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[GH-118488](https://github.com/python/cpython/pull/118488)[) (](/python/cpython/commit/c8f868dc52f98011d0f9b459b6487920bfb0ac4d "[3.10] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118740)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[G…](https://github.com/python/cpython/pull/118740)`
…

`[c8f868d](/python/cpython/commit/c8f868dc52f98011d0f9b459b6487920bfb0ac4d)`

```
[…H-118740](https://github.com/python/cpython/pull/118740))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

[ambv](/ambv)
added a commit
that referenced
this issue
[May 24, 2024](#ref-commit-5130731)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[[3.9]](/python/cpython/commit/5130731c9e779b97d00a24f54cdce73ce9975dfd "[3.9] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118741)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>") [gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/5130731c9e779b97d00a24f54cdce73ce9975dfd "[3.9] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118741)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[GH-118488](https://github.com/python/cpython/pull/118488)[) (](/python/cpython/commit/5130731c9e779b97d00a24f54cdce73ce9975dfd "[3.9] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118741)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[GH…](https://github.com/python/cpython/pull/118741)`
…

`[5130731](/python/cpython/commit/5130731c9e779b97d00a24f54cdce73ce9975dfd)`

```
[…-118741](https://github.com/python/cpython/pull/118741))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

[ambv](/ambv)
added a commit
that referenced
this issue
[May 24, 2024](#ref-commit-91e3669)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&u=e9e2a4147de2bb9a92dc0b865daf89bbfa666428&v=4)](/ambv)

`[[3.8]](/python/cpython/commit/91e3669e01245185569d09e9e6e11641282971ee "[3.8] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118742)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>") [gh-118486](https://github.com/python/cpython/issues/118486)[: Support mkdir(mode=0o700) on Windows (](/python/cpython/commit/91e3669e01245185569d09e9e6e11641282971ee "[3.8] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118742)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[GH-118488](https://github.com/python/cpython/pull/118488)[) (](/python/cpython/commit/91e3669e01245185569d09e9e6e11641282971ee "[3.8] gh-118486: Support mkdir(mode=0o700) on Windows (GH-118488) (GH-118742)

Co-authored-by: Łukasz Langa <lukasz@langa.pl>")[GH…](https://github.com/python/cpython/pull/118742)`
…

`[91e3669](/python/cpython/commit/91e3669e01245185569d09e9e6e11641282971ee)`

```
[…-118742](https://github.com/python/cpython/pull/118742))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)
[zooba](/zooba)
closed this as [completed](/python/cpython/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[May 24, 2024](#event-12928103548)

[![@JelleZijlstra](https://avatars.githubusercontent.com/u/906600?s=40&v=4)](/JelleZijlstra)
[JelleZijlstra](/JelleZijlstra)
mentioned this issue
[May 28, 2024](#ref-pullrequest-2320024088)

[backport a9a74da 3.13
#119642](/python/cpython/pull/119642)
 Closed

[estyxx](/estyxx)
pushed a commit
to estyxx/cpython
that referenced
this issue
[Jul 17, 2024](#ref-commit-26483c7)
[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@estyxx](https://avatars.githubusercontent.com/u/28976199?s=40&v=4)](/estyxx)

`[pythongh-118486](https://github.com/python/cpython/issues/118486)[: Simplify test_win32_mkdir_700 to check the exact ACL (](/estyxx/cpython/commit/26483c75bd38e6482e3050f5efaa1873259a907e "gh-118486: Simplify test_win32_mkdir_700 to check the exact ACL (GH-119056)")[…](https://github.com/python/cpython/pull/119056)`
…

`[26483c7](/estyxx/cpython/commit/26483c75bd38e6482e3050f5efaa1873259a907e)`

```
[…pythonGH-119056](https://github.com/python/cpython/pull/119056))
```

[![@hssyoo](https://avatars.githubusercontent.com/u/106777148?s=40&v=4)](/hssyoo)
[hssyoo](/hssyoo)
mentioned this issue
[Dec 17, 2024](#ref-issue-2745539338)

[OpenSSH incompatible with `mkdir(mode=0o700)` on Windows with `OWNER RIGHTS`
#128038](/python/cpython/issues/128038)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fissues%2F118486)

Assignees

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [zooba](/zooba)

Labels

[3.8 (EOL)](/python/cpython/labels/3.8%20%28EOL%29)
end of life
[3.9](/python/cpython/labels/3.9)
only security fixes
[3.10](/python/cpython/labels/3.10)
only security fixes
[3.11](/python/cpython/labels/3.11)
only security fixes
[3.12](/python/cpython/labels/3.12)
bugs and security fixes
[OS-windows](/python/cpython/labels/OS-windows)
[type-security](/python/cpython/labels/type-security)
A security issue

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=52&v=4)](/zooba) [![@nineteendo](https://avatars.githubusercontent.com/u/65588599?s=52&v=4)](/nineteendo)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_acccce4b_20250111_101922.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81939dad77001556c527485d31a2d0f4a759033e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81939dad77001556c527485d31a2d0f4a759033e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488))

[Browse files](/python/cpython/tree/81939dad77001556c527485d31a2d0f4a759033e)
Browse the repository at this point in the history

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 2, 2024

1 parent
[b337248](/python/cpython/commit/b3372481b6cae5766330b041c4622c28cee2119f)

commit 81939da

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**212 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc/library

  + Doc/library/os.rst
    [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Windows

  + Misc/NEWS.d/next/Windows/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-e6892391f5524dad03b01c93bd25bdfaf84a1a64341b8b0313ce20f092c7b861)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/81939dad77001556c527485d31a2d0f4a759033e/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -2430,6 +2430,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -2444,6 +2448,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.13 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

19 changes: 19 additions & 0 deletions

19
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/81939dad77001556c527485d31a2d0f4a759033e/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1811,6 +1811,25 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path1 = os.path.join(os\_helper.TESTFN, 'dir1') |
|  |  | path2 = os.path.join(os\_helper.TESTFN, 'dir2') |
|  |  | # mode=0o700 is special-cased to override ACLs on Windows |
|  |  | # There's no way to know exactly how the ACLs will look, so we'll |
|  |  | # check that they are different from a regularly created directory. |
|  |  | os.mkdir(path1, mode=0o700) |
|  |  | os.mkdir(path2, mode=0o777) |
|  |  |  |
|  |  | out1 = subprocess.check\_output(["icacls.exe", path1], encoding="oem") |
|  |  | out2 = subprocess.check\_output(["icacls.exe", path2], encoding="oem") |
|  |  | os.rmdir(path1) |
|  |  | os.rmdir(path2) |
|  |  | out1 = out1.replace(path1, "<PATH>") |
|  |  | out2 = out2.replace(path2, "<PATH>") |
|  |  | self.assertNotEqual(out1, out2) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/81939dad77001556c527485d31a2d0f4a759033e/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,6 +13,7 @@ |
|  |  | import weakref |
|  |  | import gc |
|  |  | import shutil |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -803,6 +804,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line.removeprefix(dir).strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[Misc/NEWS.d/next/Windows/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-e6892391f5524dad03b01c93bd25bdfaf84a1a64341b8b0313ce20f092c7b861 "Misc/NEWS.d/next/Windows/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/81939dad77001556c527485d31a2d0f4a759033e/Misc/NEWS.d/next/Windows/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,2 @@ |
|  |  | :func:`os.mkdir` now accepts \*mode\* of ``0o700`` to restrict the new |
|  |  | directory to the current user. |

158 changes: 156 additions & 2 deletions

158
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/81939dad77001556c527485d31a2d0f4a759033e/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -37,6 +37,8 @@ |
|  |  | # include <winioctl.h> |
|  |  | # include <lmcons.h> // UNLEN |
|  |  | # include "osdefs.h" // SEP |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | # if defined(MS\_WINDOWS\_DESKTOP) || defined(MS\_WINDOWS\_SYSTEM) |
|  |  | # define HAVE\_SYMLINK |
|  |  | # endif /\* MS\_WINDOWS\_DESKTOP | MS\_WINDOWS\_SYSTEM \*/ |
| Expand Down  Expand Up | | @@ -5539,6 +5541,133 @@ os\_\_path\_normpath\_impl(PyObject \*module, PyObject \*path) |
|  |  | return result; |
|  |  | } |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  |  |
|  |  | /\* We centralise SECURITY\_ATTRIBUTE initialization based around |
|  |  | templates that will probably mostly match common POSIX mode settings. |
|  |  | The \_Py\_SECURITY\_ATTRIBUTE\_DATA structure contains temporary data, as |
|  |  | a constructed SECURITY\_ATTRIBUTE structure typically refers to memory |
|  |  | that has to be alive while it's being used. |
|  |  |  |
|  |  | Typical use will look like: |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA secAttrData; |
|  |  | int error, error2; |
|  |  |  |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | switch (mode) { |
|  |  | case 0x1C0: // 0o700 |
|  |  | error = initializeMkdir700SecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | break; |
|  |  | ... |
|  |  | default: |
|  |  | error = initializeDefaultSecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | break; |
|  |  | } |
|  |  |  |
|  |  | if (!error) { |
|  |  | // do operation, passing pSecAttr |
|  |  | } |
|  |  |  |
|  |  | // Unconditionally clear secAttrData. |
|  |  | error2 = clearSecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | if (!error) { |
|  |  | error = error2; |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (error) { |
|  |  | PyErr\_SetFromWindowsErr(error); |
|  |  | return NULL; |
|  |  | } |
|  |  | \*/ |
|  |  |  |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA { |
|  |  | SECURITY\_ATTRIBUTES securityAttributes; |
|  |  | PACL acl; |
|  |  | SECURITY\_DESCRIPTOR sd; |
|  |  | EXPLICIT\_ACCESS\_W ea[4]; |
|  |  | }; |
|  |  |  |
|  |  | static int |
|  |  | initializeDefaultSecurityAttributes( |
|  |  | PSECURITY\_ATTRIBUTES \*securityAttributes, |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA \*data |
|  |  | ) { |
|  |  | assert(securityAttributes); |
|  |  | assert(data); |
|  |  | \*securityAttributes = NULL; |
|  |  | memset(data, 0, sizeof(\*data)); |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | initializeMkdir700SecurityAttributes( |
|  |  | PSECURITY\_ATTRIBUTES \*securityAttributes, |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA \*data |
|  |  | ) { |
|  |  | assert(securityAttributes); |
|  |  | assert(data); |
|  |  | \*securityAttributes = NULL; |
|  |  | memset(data, 0, sizeof(\*data)); |
|  |  |  |
|  |  | if (!InitializeSecurityDescriptor(&data->sd, SECURITY\_DESCRIPTOR\_REVISION) |
|  |  | || !SetSecurityDescriptorGroup(&data->sd, NULL, TRUE)) { |
|  |  | return GetLastError(); |
|  |  | } |
|  |  |  |
|  |  | data->securityAttributes.nLength = sizeof(SECURITY\_ATTRIBUTES); |
|  |  | data->ea[0].grfAccessPermissions = GENERIC\_ALL; |
|  |  | data->ea[0].grfAccessMode = SET\_ACCESS; |
|  |  | data->ea[0].grfInheritance = SUB\_CONTAINERS\_AND\_OBJECTS\_INHERIT; |
|  |  | data->ea[0].Trustee.TrusteeForm = TRUSTEE\_IS\_NAME; |
|  |  | data->ea[0].Trustee.TrusteeType = TRUSTEE\_IS\_ALIAS; |
|  |  | data->ea[0].Trustee.ptstrName = L"CURRENT\_USER"; |
|  |  |  |
|  |  | data->ea[1].grfAccessPermissions = GENERIC\_ALL; |
|  |  | data->ea[1].grfAccessMode = SET\_ACCESS; |
|  |  | data->ea[1].grfInheritance = SUB\_CONTAINERS\_AND\_OBJECTS\_INHERIT; |
|  |  | data->ea[1].Trustee.TrusteeForm = TRUSTEE\_IS\_NAME; |
|  |  | data->ea[1].Trustee.TrusteeType = TRUSTEE\_IS\_ALIAS; |
|  |  | data->ea[1].Trustee.ptstrName = L"SYSTEM"; |
|  |  |  |
|  |  | data->ea[2].grfAccessPermissions = GENERIC\_ALL; |
|  |  | data->ea[2].grfAccessMode = SET\_ACCESS; |
|  |  | data->ea[2].grfInheritance = SUB\_CONTAINERS\_AND\_OBJECTS\_INHERIT; |
|  |  | data->ea[2].Trustee.TrusteeForm = TRUSTEE\_IS\_NAME; |
|  |  | data->ea[2].Trustee.TrusteeType = TRUSTEE\_IS\_ALIAS; |
|  |  | data->ea[2].Trustee.ptstrName = L"ADMINISTRATORS"; |
|  |  |  |
|  |  | int r = SetEntriesInAclW(3, data->ea, NULL, &data->acl); |
|  |  | if (r) { |
|  |  | return r; |
|  |  | } |
|  |  | if (!SetSecurityDescriptorDacl(&data->sd, TRUE, data->acl, FALSE)) { |
|  |  | return GetLastError(); |
|  |  | } |
|  |  | data->securityAttributes.lpSecurityDescriptor = &data->sd; |
|  |  | \*securityAttributes = &data->securityAttributes; |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | static int |
|  |  | clearSecurityAttributes( |
|  |  | PSECURITY\_ATTRIBUTES \*securityAttributes, |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA \*data |
|  |  | ) { |
|  |  | assert(securityAttributes); |
|  |  | assert(data); |
|  |  | \*securityAttributes = NULL; |
|  |  | if (data->acl) { |
|  |  | if (LocalFree((void \*)data->acl)) { |
|  |  | return GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | #endif |
|  |  |  |
|  |  | /\*[clinic input] |
|  |  | os.mkdir |
|  |  |  |
| Expand Down  Expand Up | | @@ -5568,6 +5697,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=a61722e1576fab03]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | struct \_Py\_SECURITY\_ATTRIBUTE\_DATA secAttrData; |
|  |  | #endif |
|  |  | #ifdef HAVE\_MKDIRAT |
|  |  | int mkdirat\_unavailable = 0; |
|  |  | #endif |
| Expand All | | @@ -5579,11 +5714,30 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | switch (mode) { |
|  |  | case 0x1C0: // 0o700 |
|  |  | error = initializeMkdir700SecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | break; |
|  |  | default: |
|  |  | error = initializeDefaultSecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | break; |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | error = clearSecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | } else { |
|  |  | // Ignore error from "clear" - we have a more interesting one already |
|  |  | clearSecurityAttributes(&pSecAttr, &secAttrData); |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | PyErr\_SetFromWindowsErr(error); |
|  |  | return NULL; |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `81939da`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F81939dad77001556c527485d31a2d0f4a759033e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d3eed521_20250111_101933.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe1dfa978b1ad210d551385ad8073ec6154f53763)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe1dfa978b1ad210d551385ad8073ec6154f53763)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fcommit%2Fshow&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/e1dfa978b1ad210d551385ad8073ec6154f53763)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Simplify test\_win32\_mkdir\_700 to check the exact ACL ([GH-1…](https://github.com/python/cpython/pull/119056)

[Browse files](/python/cpython/tree/e1dfa978b1ad210d551385ad8073ec6154f53763)
Browse the repository at this point in the history

```
[…19056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

* Loading branch information

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington) [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[miss-islington](/python/cpython/commits?author=miss-islington "View all commits by miss-islington")
and
[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 15, 2024

1 parent
[dd8a61f](/python/cpython/commit/dd8a61f901d300beeb2f1875a5efe993d09e01e2)

commit e1dfa97

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**9 additions**
and
**16 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

23 changes: 8 additions & 15 deletions

23
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/e1dfa978b1ad210d551385ad8073ec6154f53763/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1814,21 +1814,14 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path1 = os.path.join(os\_helper.TESTFN, 'dir1') |
|  |  | path2 = os.path.join(os\_helper.TESTFN, 'dir2') |
|  |  | # mode=0o700 is special-cased to override ACLs on Windows |
|  |  | # There's no way to know exactly how the ACLs will look, so we'll |
|  |  | # check that they are different from a regularly created directory. |
|  |  | os.mkdir(path1, mode=0o700) |
|  |  | os.mkdir(path2, mode=0o777) |
|  |  |  |
|  |  | out1 = subprocess.check\_output(["icacls.exe", path1], encoding="oem") |
|  |  | out2 = subprocess.check\_output(["icacls.exe", path2], encoding="oem") |
|  |  | os.rmdir(path1) |
|  |  | os.rmdir(path2) |
|  |  | out1 = out1.replace(path1, "<PATH>") |
|  |  | out2 = out2.replace(path2, "<PATH>") |
|  |  | self.assertNotEqual(out1, out2) |
|  |  | path = os.path.abspath(os.path.join(os\_helper.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/e1dfa978b1ad210d551385ad8073ec6154f53763/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5590,7 +5590,7 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discreationary ACL (D) that is protected (P) and includes |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `e1dfa97`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fe1dfa978b1ad210d551385ad8073ec6154f53763) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_009e0db6_20250111_101930.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fc8f868dc52f98011d0f9b459b6487920bfb0ac4d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fc8f868dc52f98011d0f9b459b6487920bfb0ac4d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/c8f868dc52f98011d0f9b459b6487920bfb0ac4d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.10] [gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488)) ([G…](https://github.com/python/cpython/pull/118740)

[Browse files](/python/cpython/tree/c8f868dc52f98011d0f9b459b6487920bfb0ac4d)
Browse the repository at this point in the history

```
[…H-118740](https://github.com/python/cpython/pull/118740))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&v=4)](/ambv)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
and
[ambv](/python/cpython/commits?author=ambv "View all commits by ambv")
authored
May 24, 2024

1 parent
[333c7dc](/python/cpython/commit/333c7dccd87c637d0b15cf81f9bbec28e39664fd)

commit c8f868d

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**107 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc

  + library

    - Doc/library/os.rst
      [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
  + whatsnew

    - Doc/whatsnew/3.10.rst
      [3.10.rst](#diff-a68d5b2117cfed2ddb0b199e367c22ce9c1427d4a016277eafddb551ca4f250c)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -2065,6 +2065,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -2079,6 +2083,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.10.15 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

15 changes: 15 additions & 0 deletions

15
[Doc/whatsnew/3.10.rst](#diff-a68d5b2117cfed2ddb0b199e367c22ce9c1427d4a016277eafddb551ca4f250c "Doc/whatsnew/3.10.rst")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Doc/whatsnew/3.10.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -1247,6 +1247,13 @@ Add :data:`~os.O\_EVTONLY`, :data:`~os.O\_FSYNC`, :data:`~os.O\_SYMLINK` |
|  |  | and :data:`~os.O\_NOFOLLOW\_ANY` for macOS. |
|  |  | (Contributed by Dong-hee Na in :issue:`43106`.) |
|  |  |  |
|  |  | As of 3.10.15, :func:`os.mkdir` and :func:`os.makedirs` on Windows now support |
|  |  | passing a \*mode\* value of ``0o700`` to apply access control to the new |
|  |  | directory. This implicitly affects :func:`tempfile.mkdtemp` and is a |
|  |  | mitigation for CVE-2024-4030. Other values for \*mode\* continue to be |
|  |  | ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | os.path |
|  |  | ------- |
|  |  |  |
| Expand Down  Expand Up | | @@ -1399,6 +1406,14 @@ Add :data:`sys.stdlib\_module\_names`, containing the list of the standard library |
|  |  | module names. |
|  |  | (Contributed by Victor Stinner in :issue:`42955`.) |
|  |  |  |
|  |  | tempfile |
|  |  | -------- |
|  |  |  |
|  |  | As of 3.10.15 on Windows, the default mode ``0o700`` used by |
|  |  | :func:`tempfile.mkdtemp` now limits access to the new directory due to |
|  |  | changes to :func:`os.mkdir`. This is a mitigation for CVE-2024-4030. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | \_thread |
|  |  | ------- |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1635,6 +1635,18 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path = os.path.abspath(os.path.join(os\_helper.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import stat |
|  |  | import types |
|  |  | import weakref |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -800,6 +801,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line.removeprefix(dir).strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes CVE-2024-4030 |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

44 changes: 41 additions & 3 deletions

44
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/c8f868dc52f98011d0f9b459b6487920bfb0ac4d/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,12 @@ |
|  |  | #include "pycore\_import.h" // \_PyImport\_ReInitLock() |
|  |  | #include "pycore\_initconfig.h" // \_PyStatus\_EXCEPTION() |
|  |  | #include "pycore\_pystate.h" // \_PyInterpreterState\_GET() |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | #endif |
|  |  |  |
|  |  | #include "structmember.h" // PyMemberDef |
|  |  | #ifndef MS\_WINDOWS |
|  |  | # include "posixmodule.h" |
| Expand Down  Expand Up | | @@ -4465,7 +4471,6 @@ os\_\_path\_splitroot\_impl(PyObject \*module, path\_t \*path) |
|  |  |  |
|  |  | #endif /\* MS\_WINDOWS \*/ |
|  |  |  |
|  |  |  |
|  |  | /\*[clinic input] |
|  |  | os.mkdir |
|  |  |  |
| Expand Down  Expand Up | | @@ -4495,6 +4500,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=a61722e1576fab03]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES secAttr = { sizeof(secAttr) }; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | #endif |
|  |  | #ifdef HAVE\_MKDIRAT |
|  |  | int mkdirat\_unavailable = 0; |
|  |  | #endif |
| Expand All | | @@ -4506,11 +4517,38 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
|  |  | L"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)", |
|  |  | SDDL\_REVISION\_1, |
|  |  | &secAttr.lpSecurityDescriptor, |
|  |  | &sdSize |
|  |  | )) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | if (secAttr.lpSecurityDescriptor && |
|  |  | // uncommonly, LocalFree returns non-zero on error, but still uses |
|  |  | // GetLastError() to see what the error code is |
|  |  | LocalFree(secAttr.lpSecurityDescriptor)) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | return PyErr\_SetFromWindowsErr(error); |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c8f868d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fc8f868dc52f98011d0f9b459b6487920bfb0ac4d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_f6475b17_20250111_101925.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F91e3669e01245185569d09e9e6e11641282971ee)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F91e3669e01245185569d09e9e6e11641282971ee)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/91e3669e01245185569d09e9e6e11641282971ee)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.8] [gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488)) ([GH…](https://github.com/python/cpython/pull/118742)

[Browse files](/python/cpython/tree/91e3669e01245185569d09e9e6e11641282971ee)
Browse the repository at this point in the history

```
[…-118742](https://github.com/python/cpython/pull/118742))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&v=4)](/ambv)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
and
[ambv](/python/cpython/commits?author=ambv "View all commits by ambv")
authored
May 24, 2024

1 parent
[29c9728](/python/cpython/commit/29c97287d205bf2f410f4895ebce3f43b5160524)

commit 91e3669

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**108 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc

  + library

    - Doc/library/os.rst
      [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
  + whatsnew

    - Doc/whatsnew/3.8.rst
      [3.8.rst](#diff-fc26ec44ce02bff5ba0fc0c1c750748ff5dea3bec156c6fdf3f666d943e81992)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -1909,6 +1909,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -1923,6 +1927,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.8.20 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

16 changes: 16 additions & 0 deletions

16
[Doc/whatsnew/3.8.rst](#diff-fc26ec44ce02bff5ba0fc0c1c750748ff5dea3bec156c6fdf3f666d943e81992 "Doc/whatsnew/3.8.rst")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Doc/whatsnew/3.8.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -1046,6 +1046,13 @@ treat junctions as links. |
|  |  |  |
|  |  | (Contributed by Steve Dower in :issue:`37834`.) |
|  |  |  |
|  |  | As of 3.8.20, :func:`os.mkdir` and :func:`os.makedirs` on Windows now support |
|  |  | passing a \*mode\* value of ``0o700`` to apply access control to the new |
|  |  | directory. This implicitly affects :func:`tempfile.mkdtemp` and is a |
|  |  | mitigation for CVE-2024-4030. Other values for \*mode\* continue to be |
|  |  | ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  |  |
|  |  | os.path |
|  |  | ------- |
| Expand Down  Expand Up | | @@ -1252,6 +1259,15 @@ in a standardized and extensible format, and offers several other benefits. |
|  |  | (Contributed by C.A.M. Gerlach in :issue:`36268`.) |
|  |  |  |
|  |  |  |
|  |  | tempfile |
|  |  | -------- |
|  |  |  |
|  |  | As of 3.8.20 on Windows, the default mode ``0o700`` used by |
|  |  | :func:`tempfile.mkdtemp` now limits access to the new directory due to |
|  |  | changes to :func:`os.mkdir`. This is a mitigation for CVE-2024-4030. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  |  |
|  |  | threading |
|  |  | --------- |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1380,6 +1380,18 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = support.TESTFN |
|  |  | path = os.path.abspath(os.path.join(support.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(support.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import contextlib |
|  |  | import stat |
|  |  | import weakref |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -760,6 +761,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line[len(dir):].strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes CVE-2024-4030 |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

44 changes: 41 additions & 3 deletions

44
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/91e3669e01245185569d09e9e6e11641282971ee/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,6 +40,12 @@ |
|  |  | #include "pycore\_pystate.h" /\* \_PyRuntime \*/ |
|  |  | #include "pythread.h" |
|  |  | #include "structmember.h" |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | #endif |
|  |  |  |
|  |  | #ifndef MS\_WINDOWS |
|  |  | # include "posixmodule.h" |
|  |  | #else |
| Expand Down  Expand Up | | @@ -4122,7 +4128,6 @@ os\_\_path\_splitroot\_impl(PyObject \*module, path\_t \*path) |
|  |  |  |
|  |  | #endif /\* MS\_WINDOWS \*/ |
|  |  |  |
|  |  |  |
|  |  | /\*[clinic input] |
|  |  | os.mkdir |
|  |  |  |
| Expand Down  Expand Up | | @@ -4151,6 +4156,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=e965f68377e9b1ce]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES secAttr = { sizeof(secAttr) }; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | #endif |
|  |  |  |
|  |  | if (PySys\_Audit("os.mkdir", "Oii", path->object, mode, |
|  |  | dir\_fd == DEFAULT\_DIR\_FD ? -1 : dir\_fd) < 0) { |
| Expand All | | @@ -4159,11 +4170,38 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
|  |  | L"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)", |
|  |  | SDDL\_REVISION\_1, |
|  |  | &secAttr.lpSecurityDescriptor, |
|  |  | &sdSize |
|  |  | )) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | if (secAttr.lpSecurityDescriptor && |
|  |  | // uncommonly, LocalFree returns non-zero on error, but still uses |
|  |  | // GetLastError() to see what the error code is |
|  |  | LocalFree(secAttr.lpSecurityDescriptor)) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | return PyErr\_SetFromWindowsErr(error); |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `91e3669`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F91e3669e01245185569d09e9e6e11641282971ee) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_15dc51ab_20250111_101917.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F66f8bb76a15e64a1bb7688b177ed29e26230fdee)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F66f8bb76a15e64a1bb7688b177ed29e26230fdee)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/66f8bb76a15e64a1bb7688b177ed29e26230fdee)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Update docs for [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") reference ([GH-118737](https://github.com/python/cpython/pull/118737))

[Browse files](/python/cpython/tree/66f8bb76a15e64a1bb7688b177ed29e26230fdee)
Browse the repository at this point in the history

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 8, 2024

1 parent
[891fd12](/python/cpython/commit/891fd12e52d5963a338b30ce2cb7ccac72f8eea5)

commit 66f8bb7

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**18 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc/whatsnew

  + Doc/whatsnew/3.13.rst
    [3.13.rst](#diff-0eef04c1aae0cf8389945464f271ff6789259ef8985f5fdbb21c9a99c4b5021f)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)

## There are no files selected for viewing

14 changes: 14 additions & 0 deletions

14
[Doc/whatsnew/3.13.rst](#diff-0eef04c1aae0cf8389945464f271ff6789259ef8985f5fdbb21c9a99c4b5021f "Doc/whatsnew/3.13.rst")

Show comments

[View file](/python/cpython/blob/66f8bb76a15e64a1bb7688b177ed29e26230fdee/Doc/whatsnew/3.13.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -847,6 +847,12 @@ os |
|  |  | :c:func:`!posix\_spawn\_file\_actions\_addclosefrom\_np`. |
|  |  | (Contributed by Jakub Kulik in :gh:`113117`.) |
|  |  |  |
|  |  | \* :func:`os.mkdir` and :func:`os.makedirs` on Windows now support passing a |
|  |  | \*mode\* value of ``0o700`` to apply access control to the new directory. This |
|  |  | implicitly affects :func:`tempfile.mkdtemp` and is a mitigation for |
|  |  | :cve:`2024-4030`. Other values for \*mode\* continue to be ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | os.path |
|  |  | ------- |
|  |  |  |
| Expand Down  Expand Up | | @@ -989,6 +995,14 @@ sys |
|  |  | This function is not guaranteed to exist in all implementations of Python. |
|  |  | (Contributed by Serhiy Storchaka in :gh:`78573`.) |
|  |  |  |
|  |  | tempfile |
|  |  | -------- |
|  |  |  |
|  |  | \* On Windows, the default mode ``0o700`` used by :func:`tempfile.mkdtemp` now |
|  |  | limits access to the new directory due to changes to :func:`os.mkdir`. This |
|  |  | is a mitigation for :cve:`2024-4030`. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | time |
|  |  | ---- |
|  |  |  |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/66f8bb76a15e64a1bb7688b177ed29e26230fdee/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes :cve:`2024-4030` |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `66f8bb7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F66f8bb76a15e64a1bb7688b177ed29e26230fdee) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from mail.python.org_52233d87_20250111_101938.html ===


[Mailman 3 python.org](/archives/)

[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)

[Manage this list](/mailman3/lists/security-announce.python.org/)
[Sign In](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)
[Sign Up](/accounts/signup/?next=/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)

×
#### Keyboard Shortcuts

### Thread View

* `j`: Next unread message
* `k`: Previous unread message
* `j a`: Jump to all threads* `j l`: Jump to MailingList overview

[newer](/archives/list/security-announce%40python.org/thread/NRUHDUS2IV2USIZM2CVMSFL6SCKU3RZA/ "[CVE-2024-4032] Incorrect IPv4 and IPv6 private ranges")

[[CVE-2024-4032] Incorrect IPv4 and...](/archives/list/security-announce%40python.org/thread/NRUHDUS2IV2USIZM2CVMSFL6SCKU3RZA/ "[CVE-2024-4032] Incorrect IPv4 and IPv6 private ranges")

### [CVE-2024-4030] tempfile.mkdtemp() may be readable and writeable by all users on Windows

[older](/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/ "[CVE-2023-6597] tempfile.TemporaryDirectory dereferences symlinks during cleanup")

[[CVE-2023-6597]...](/archives/list/security-announce%40python.org/thread/Q5C6ATFC67K53XFV4KE45325S7NS62LD/ "[CVE-2023-6597] tempfile.TemporaryDirectory dereferences symlinks during cleanup")

![](https://secure.gravatar.com/avatar/b5a0900288ad3a29fd4a5ef260486055.jpg?s=120&d=mm&r=g)

## [Seth Larson](/archives/users/eb0c073014124400ac984fd5e76d1f7e/ "See the profile for Seth Larson")

7 May
2024

7 May
'24

8:57 p.m.

On Windows a directory returned by tempfile.mkdtemp() would not always have
permissions set to restrict reading and writing to the temporary directory
by other users, instead usually inheriting the correct permissions from the
default location. Alternate configurations or users without a profile
directory may not have the intended permissions.

If you’re not using Windows or haven’t changed the temporary directory
location then you aren’t affected by this vulnerability. On other platforms
the returned directory is consistently readable and writable only by the
current user.

This issue was caused by Python not supporting Unix permissions on Windows.
The fix adds support for Unix “700” for the mkdir function on Windows which
is used by mkdtemp() to ensure the newly created directory has the proper
permissions.

The fix will be made available in CPython versions 3.13.0b1 and 3.12.4.
Backports are pending for other security release streams.

Severity: Medium

Issue: <https://github.com/python/cpython/issues/118486>

Patch:
[https://github.com/python/cpython/commit/81939dad77001556c527485d31a2d0f4a75...](https://github.com/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e)
Patch:
[https://github.com/python/cpython/commit/8ed546679524140d8282175411fd141fe7d...](https://github.com/python/cpython/commit/8ed546679524140d8282175411fd141fe7df070d)

Attachments:

* [attachment.html](/archives/list/security-announce%40python.org/message/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/attachment/2/attachment.html)
  (text/html — 6.6 KB)

[0](#like "You must be logged-in to vote.")
[0](#dislike "You must be logged-in to vote.")

Reply

[Sign in to reply online](/accounts/login/?next=/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)
Use email software

[Show replies by date](/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/?sort=date)

![Loading...](/static/hyperkitty/img/ajax-loader.gif)
[Visit here for a non-javascript version of this page.](/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/?noscript)

247
Age (days ago)

249
Last active (days ago)

[List overview](/archives/list/security-announce%40python.org/)

[Download](/archives/list/security-announce%40python.org/export/security-announce%40python.org-PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636.mbox.gz?thread=PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636 "This thread in gzipped mbox format")

1 comments

2 participants

[Add to favorites](#AddFav "You must be logged-in to have favorites.")
[Remove from favorites](#RmFav)

### tags

### participants (2)

* ![](https://secure.gravatar.com/avatar/b5a0900288ad3a29fd4a5ef260486055.jpg?s=48&d=mm&r=g)
  Seth Larson
* ![](https://secure.gravatar.com/avatar/be200d614c47b5a4dbb6be867080e835.jpg?s=48&d=mm&r=g)
  Steve Dower

![HyperKitty](/static/hyperkitty/img/logo.png)
Powered by [HyperKitty](http://hyperkitty.readthedocs.org) version 1.3.12.



=== Content from github.com_10057730_20250111_101914.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F35c799d79177b962ddace2fa068101465570a29a)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F35c799d79177b962ddace2fa068101465570a29a)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/35c799d79177b962ddace2fa068101465570a29a)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.11] [gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488)) ([G…](https://github.com/python/cpython/pull/118739)

[Browse files](/python/cpython/tree/35c799d79177b962ddace2fa068101465570a29a)
Browse the repository at this point in the history

```
[…H-118739](https://github.com/python/cpython/pull/118739))
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 24, 2024

1 parent
[4762b36](/python/cpython/commit/4762b365406a8cf026a4a4ddcae34c28a41c3de9)

commit 35c799d

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**103 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc

  + library

    - Doc/library/os.rst
      [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
  + whatsnew

    - Doc/whatsnew/3.11.rst
      [3.11.rst](#diff-78f24041d66ab8ed2ae1aee94bcd42396d27af833cb96a3c506294c6d6dce82d)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -2178,6 +2178,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -2192,6 +2196,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.11.10 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[Doc/whatsnew/3.11.rst](#diff-78f24041d66ab8ed2ae1aee94bcd42396d27af833cb96a3c506294c6d6dce82d "Doc/whatsnew/3.11.rst")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Doc/whatsnew/3.11.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -899,6 +899,13 @@ os |
|  |  | instead of ``CryptGenRandom()`` which is deprecated. |
|  |  | (Contributed by Donghee Na in :issue:`44611`.) |
|  |  |  |
|  |  | \* As of 3.11.10, :func:`os.mkdir` and :func:`os.makedirs` on Windows |
|  |  | now support passing a \*mode\* value of ``0o700`` to apply access |
|  |  | control to the new directory. This implicitly affects |
|  |  | :func:`tempfile.mkdtemp` and is a mitigation for CVE-2024-4030. |
|  |  | Other values for \*mode\* continue to be ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  |  |
|  |  | .. \_whatsnew311-pathlib: |
|  |  |  |
| Expand Down  Expand Up | | @@ -1059,6 +1066,11 @@ tempfile |
|  |  | such as compression modules. |
|  |  | (Contributed by Carey Metcalfe in :gh:`70363`.) |
|  |  |  |
|  |  | \* As of 3.11.10 on Windows, the default mode ``0o700`` used by |
|  |  | :func:`tempfile.mkdtemp` now limits access to the new directory due to |
|  |  | changes to :func:`os.mkdir`. This is a mitigation for CVE-2024-4030. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  |  |
|  |  | .. \_whatsnew311-threading: |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1743,6 +1743,18 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path = os.path.abspath(os.path.join(os\_helper.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import stat |
|  |  | import types |
|  |  | import weakref |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -801,6 +802,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line.removeprefix(dir).strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes CVE-2024-4030 |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

42 changes: 40 additions & 2 deletions

42
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/35c799d79177b962ddace2fa068101465570a29a/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -34,6 +34,11 @@ |
|  |  | #include "pycore\_pystate.h" // \_PyInterpreterState\_GET() |
|  |  | #include "pycore\_signal.h" // Py\_NSIG |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | #endif |
|  |  |  |
|  |  | #include "structmember.h" // PyMemberDef |
|  |  | #ifndef MS\_WINDOWS |
|  |  | # include "posixmodule.h" |
| Expand Down  Expand Up | | @@ -4611,6 +4616,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=a61722e1576fab03]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES secAttr = { sizeof(secAttr) }; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | #endif |
|  |  | #ifdef HAVE\_MKDIRAT |
|  |  | int mkdirat\_unavailable = 0; |
|  |  | #endif |
| Expand All | | @@ -4622,11 +4633,38 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
|  |  | L"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)", |
|  |  | SDDL\_REVISION\_1, |
|  |  | &secAttr.lpSecurityDescriptor, |
|  |  | &sdSize |
|  |  | )) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | if (secAttr.lpSecurityDescriptor && |
|  |  | // uncommonly, LocalFree returns non-zero on error, but still uses |
|  |  | // GetLastError() to see what the error code is |
|  |  | LocalFree(secAttr.lpSecurityDescriptor)) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | return PyErr\_SetFromWindowsErr(error); |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `35c799d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F35c799d79177b962ddace2fa068101465570a29a) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_89118652_20250111_101936.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Feb29e2f5905da93333d1ce78bc98b151e763ff46)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Feb29e2f5905da93333d1ce78bc98b151e763ff46)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/eb29e2f5905da93333d1ce78bc98b151e763ff46)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488))

[Browse files](/python/cpython/tree/eb29e2f5905da93333d1ce78bc98b151e763ff46)
Browse the repository at this point in the history

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 9, 2024

1 parent
[c0d257c](/python/cpython/commit/c0d257cc69a943d2c211fe7ad54e706f1085ba1a)

commit eb29e2f

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**106 additions**
and
**2 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc

  + library

    - Doc/library/os.rst
      [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
  + whatsnew

    - Doc/whatsnew/3.12.rst
      [3.12.rst](#diff-0f2c1763c64530268325a0ee2dfaa4f5d555c4ac27deb78bd77102c8ce1b886b)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -2356,6 +2356,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -2370,6 +2374,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.12.4 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[Doc/whatsnew/3.12.rst](#diff-0f2c1763c64530268325a0ee2dfaa4f5d555c4ac27deb78bd77102c8ce1b886b "Doc/whatsnew/3.12.rst")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Doc/whatsnew/3.12.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -778,6 +778,13 @@ os |
|  |  | Both functions may be significantly faster on newer releases of |
|  |  | Windows. (Contributed by Steve Dower in :gh:`99726`.) |
|  |  |  |
|  |  | \* As of 3.12.4, :func:`os.mkdir` and :func:`os.makedirs` on Windows |
|  |  | now support passing a \*mode\* value of ``0o700`` to apply access |
|  |  | control to the new directory. This implicitly affects |
|  |  | :func:`tempfile.mkdtemp` and is a mitigation for :cve:`2024-4030`. |
|  |  | Other values for \*mode\* continue to be ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | os.path |
|  |  | ------- |
|  |  |  |
| Expand Down  Expand Up | | @@ -925,6 +932,10 @@ tempfile |
|  |  | \*delete\_on\_close\* (Contributed by Evgeny Zorin in :gh:`58451`.) |
|  |  | \* :func:`tempfile.mkdtemp` now always returns an absolute path, even if the |
|  |  | argument provided to the \*dir\* parameter is a relative path. |
|  |  | \* As of 3.12.4 on Windows, the default mode ``0o700`` used by |
|  |  | :func:`tempfile.mkdtemp` now limits access to the new directory due to |
|  |  | changes to :func:`os.mkdir`. This is a mitigation for :cve:`2024-4030`. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | threading |
|  |  | --------- |
| Expand Down | |  |

19 changes: 19 additions & 0 deletions

19
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1797,6 +1797,25 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path1 = os.path.join(os\_helper.TESTFN, 'dir1') |
|  |  | path2 = os.path.join(os\_helper.TESTFN, 'dir2') |
|  |  | # mode=0o700 is special-cased to override ACLs on Windows |
|  |  | # There's no way to know exactly how the ACLs will look, so we'll |
|  |  | # check that they are different from a regularly created directory. |
|  |  | os.mkdir(path1, mode=0o700) |
|  |  | os.mkdir(path2, mode=0o777) |
|  |  |  |
|  |  | out1 = subprocess.check\_output(["icacls.exe", path1], encoding="oem") |
|  |  | out2 = subprocess.check\_output(["icacls.exe", path2], encoding="oem") |
|  |  | os.rmdir(path1) |
|  |  | os.rmdir(path2) |
|  |  | out1 = out1.replace(path1, "<PATH>") |
|  |  | out2 = out2.replace(path2, "<PATH>") |
|  |  | self.assertNotEqual(out1, out2) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -13,6 +13,7 @@ |
|  |  | import weakref |
|  |  | import gc |
|  |  | import shutil |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -803,6 +804,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line.removeprefix(dir).strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes :cve:`2024-4030` |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

39 changes: 37 additions & 2 deletions

39
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/eb29e2f5905da93333d1ce78bc98b151e763ff46/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,8 @@ |
|  |  | # include <winioctl.h> |
|  |  | # include <lmcons.h> // UNLEN |
|  |  | # include "osdefs.h" // SEP |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | # if defined(MS\_WINDOWS\_DESKTOP) || defined(MS\_WINDOWS\_SYSTEM) |
|  |  | # define HAVE\_SYMLINK |
|  |  | # endif /\* MS\_WINDOWS\_DESKTOP | MS\_WINDOWS\_SYSTEM \*/ |
| Expand Down  Expand Up | | @@ -5342,6 +5344,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=a61722e1576fab03]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES secAttr = { sizeof(secAttr) }; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | #endif |
|  |  | #ifdef HAVE\_MKDIRAT |
|  |  | int mkdirat\_unavailable = 0; |
|  |  | #endif |
| Expand All | | @@ -5353,11 +5361,38 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discreationary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
|  |  | L"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)", |
|  |  | SDDL\_REVISION\_1, |
|  |  | &secAttr.lpSecurityDescriptor, |
|  |  | &sdSize |
|  |  | )) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | if (secAttr.lpSecurityDescriptor && |
|  |  | // uncommonly, LocalFree returns non-zero on error, but still uses |
|  |  | // GetLastError() to see what the error code is |
|  |  | LocalFree(secAttr.lpSecurityDescriptor)) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | return PyErr\_SetFromWindowsErr(error); |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `eb29e2f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Feb29e2f5905da93333d1ce78bc98b151e763ff46) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_5c3124cb_20250111_101916.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5130731c9e779b97d00a24f54cdce73ce9975dfd)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5130731c9e779b97d00a24f54cdce73ce9975dfd)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/5130731c9e779b97d00a24f54cdce73ce9975dfd)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[3.9] [gh-118486](https://github.com/python/cpython/issues/118486): Support mkdir(mode=0o700) on Windows ([GH-118488](https://github.com/python/cpython/pull/118488)) ([GH…](https://github.com/python/cpython/pull/118741)

[Browse files](/python/cpython/tree/5130731c9e779b97d00a24f54cdce73ce9975dfd)
Browse the repository at this point in the history

```
[…-118741](https://github.com/python/cpython/pull/118741))

Co-authored-by: Łukasz Langa <lukasz@langa.pl>
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba) [![@ambv](https://avatars.githubusercontent.com/u/55281?s=40&v=4)](/ambv)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
and
[ambv](/python/cpython/commits?author=ambv "View all commits by ambv")
authored
May 24, 2024

1 parent
[b228655](/python/cpython/commit/b228655c227b2ca298a8ffac44d14ce3d22f6faa)

commit 5130731

 Show file tree

 Hide file tree

Showing
**6 changed files**
with
**107 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc

  + library

    - Doc/library/os.rst
      [os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e)
  + whatsnew

    - Doc/whatsnew/3.9.rst
      [3.9.rst](#diff-ec874d66bbcf13046b9928aa3716d14a93632f568b914eba32baf46ff4c9eb36)
* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
  + Lib/test/test\_tempfile.py
    [test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

7 changes: 7 additions & 0 deletions

7
[Doc/library/os.rst](#diff-cd9132e5234678864807ae34a75c5d4d6b894b31c327a4d3620fbd0c37eec16e "Doc/library/os.rst")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Doc/library/os.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -1929,6 +1929,10 @@ features: |
|  |  | platform-dependent. On some platforms, they are ignored and you should call |
|  |  | :func:`chmod` explicitly to set them. |
|  |  |  |
|  |  | On Windows, a \*mode\* of ``0o700`` is specifically handled to apply access |
|  |  | control to the new directory such that only the current user and |
|  |  | administrators have access. Other values of \*mode\* are ignored. |
|  |  |  |
|  |  | This function can also support :ref:`paths relative to directory descriptors |
|  |  | <dir\_fd>`. |
|  |  |  |
| Expand All | | @@ -1943,6 +1947,9 @@ features: |
|  |  | .. versionchanged:: 3.6 |
|  |  | Accepts a :term:`path-like object`. |
|  |  |  |
|  |  | .. versionchanged:: 3.9.20 |
|  |  | Windows now handles a \*mode\* of ``0o700``. |
|  |  |  |
|  |  |  |
|  |  | .. function:: makedirs(name, mode=0o777, exist\_ok=False) |
|  |  |  |
| Expand Down | |  |

15 changes: 15 additions & 0 deletions

15
[Doc/whatsnew/3.9.rst](#diff-ec874d66bbcf13046b9928aa3716d14a93632f568b914eba32baf46ff4c9eb36 "Doc/whatsnew/3.9.rst")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Doc/whatsnew/3.9.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -613,6 +613,13 @@ Added :func:`os.waitstatus\_to\_exitcode` function: |
|  |  | convert a wait status to an exit code. |
|  |  | (Contributed by Victor Stinner in :issue:`40094`.) |
|  |  |  |
|  |  | As of 3.9.20, :func:`os.mkdir` and :func:`os.makedirs` on Windows now support |
|  |  | passing a \*mode\* value of ``0o700`` to apply access control to the new |
|  |  | directory. This implicitly affects :func:`tempfile.mkdtemp` and is a |
|  |  | mitigation for CVE-2024-4030. Other values for \*mode\* continue to be |
|  |  | ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | pathlib |
|  |  | ------- |
|  |  |  |
| Expand Down  Expand Up | | @@ -704,6 +711,14 @@ Previously, :attr:`sys.stderr` was block-buffered when non-interactive. Now |
|  |  | ``stderr`` defaults to always being line-buffered. |
|  |  | (Contributed by Jendrik Seipp in :issue:`13601`.) |
|  |  |  |
|  |  | tempfile |
|  |  | -------- |
|  |  |  |
|  |  | As of 3.9.20 on Windows, the default mode ``0o700`` used by |
|  |  | :func:`tempfile.mkdtemp` now limits access to the new directory due to |
|  |  | changes to :func:`os.mkdir`. This is a mitigation for CVE-2024-4030. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | tracemalloc |
|  |  | ----------- |
|  |  |  |
| Expand Down | |  |

12 changes: 12 additions & 0 deletions

12
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1493,6 +1493,18 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | self.assertRaises(OSError, os.makedirs, path, exist\_ok=True) |
|  |  | os.remove(path) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = support.TESTFN |
|  |  | path = os.path.abspath(os.path.join(support.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(support.TESTFN, 'dir1', 'dir2', 'dir3', |
|  |  | 'dir4', 'dir5', 'dir6') |
| Expand Down | |  |

28 changes: 28 additions & 0 deletions

28
[Lib/test/test\_tempfile.py](#diff-cbc50394ff35aa5553e84fa01cfdda48f5215fcb60cd1ee84a0ee9682d908983 "Lib/test/test_tempfile.py")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Lib/test/test_tempfile.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,6 +11,7 @@ |
|  |  | import stat |
|  |  | import types |
|  |  | import weakref |
|  |  | import subprocess |
|  |  | from unittest import mock |
|  |  |  |
|  |  | import unittest |
| Expand Down  Expand Up | | @@ -772,6 +773,33 @@ def test\_mode(self): |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | @unittest.skipUnless(os.name == "nt", "Only on Windows.") |
|  |  | def test\_mode\_win32(self): |
|  |  | # Use icacls.exe to extract the users with some level of access |
|  |  | # Main thing we are testing is that the BUILTIN\Users group has |
|  |  | # no access. The exact ACL is going to vary based on which user |
|  |  | # is running the test. |
|  |  | dir = self.do\_create() |
|  |  | try: |
|  |  | out = subprocess.check\_output(["icacls.exe", dir], encoding="oem").casefold() |
|  |  | finally: |
|  |  | os.rmdir(dir) |
|  |  |  |
|  |  | dir = dir.casefold() |
|  |  | users = set() |
|  |  | found\_user = False |
|  |  | for line in out.strip().splitlines(): |
|  |  | acl = None |
|  |  | # First line of result includes our directory |
|  |  | if line.startswith(dir): |
|  |  | acl = line.removeprefix(dir).strip() |
|  |  | elif line and line[:1].isspace(): |
|  |  | acl = line.strip() |
|  |  | if acl: |
|  |  | users.add(acl.partition(":")[0]) |
|  |  |  |
|  |  | self.assertNotIn(r"BUILTIN\Users".casefold(), users) |
|  |  |  |
|  |  | def test\_collision\_with\_existing\_file(self): |
|  |  | # mkdtemp tries another name when a file with |
|  |  | # the chosen name already exists |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes CVE-2024-4030 |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

44 changes: 41 additions & 3 deletions

44
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/5130731c9e779b97d00a24f54cdce73ce9975dfd/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -24,6 +24,12 @@ |
|  |  | #include "pycore\_ceval.h" // \_PyEval\_ReInitThreads() |
|  |  | #include "pycore\_import.h" // \_PyImport\_ReInitLock() |
|  |  | #include "pycore\_pystate.h" // \_PyInterpreterState\_GET() |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | # include <aclapi.h> // SetEntriesInAcl |
|  |  | # include <sddl.h> // SDDL\_REVISION\_1 |
|  |  | #endif |
|  |  |  |
|  |  | #include "structmember.h" // PyMemberDef |
|  |  | #ifndef MS\_WINDOWS |
|  |  | # include "posixmodule.h" |
| Expand Down  Expand Up | | @@ -4425,7 +4431,6 @@ os\_\_path\_splitroot\_impl(PyObject \*module, path\_t \*path) |
|  |  |  |
|  |  | #endif /\* MS\_WINDOWS \*/ |
|  |  |  |
|  |  |  |
|  |  | /\*[clinic input] |
|  |  | os.mkdir |
|  |  |  |
| Expand Down  Expand Up | | @@ -4454,6 +4459,12 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | /\*[clinic end generated code: output=a70446903abe821f input=e965f68377e9b1ce]\*/ |
|  |  | { |
|  |  | int result; |
|  |  | #ifdef MS\_WINDOWS |
|  |  | int error = 0; |
|  |  | int pathError = 0; |
|  |  | SECURITY\_ATTRIBUTES secAttr = { sizeof(secAttr) }; |
|  |  | SECURITY\_ATTRIBUTES \*pSecAttr = NULL; |
|  |  | #endif |
|  |  | #ifdef HAVE\_MKDIRAT |
|  |  | int mkdirat\_unavailable = 0; |
|  |  | #endif |
| Expand All | | @@ -4465,11 +4476,38 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  |  |
|  |  | #ifdef MS\_WINDOWS |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | result = CreateDirectoryW(path->wide, NULL); |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
|  |  | L"D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)", |
|  |  | SDDL\_REVISION\_1, |
|  |  | &secAttr.lpSecurityDescriptor, |
|  |  | &sdSize |
|  |  | )) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | if (!error) { |
|  |  | result = CreateDirectoryW(path->wide, pSecAttr); |
|  |  | if (secAttr.lpSecurityDescriptor && |
|  |  | // uncommonly, LocalFree returns non-zero on error, but still uses |
|  |  | // GetLastError() to see what the error code is |
|  |  | LocalFree(secAttr.lpSecurityDescriptor)) { |
|  |  | error = GetLastError(); |
|  |  | } |
|  |  | } |
|  |  | Py\_END\_ALLOW\_THREADS |
|  |  |  |
|  |  | if (!result) |
|  |  | if (error) { |
|  |  | return PyErr\_SetFromWindowsErr(error); |
|  |  | } |
|  |  | if (!result) { |
|  |  | return path\_error(path); |
|  |  | } |
|  |  | #else |
|  |  | Py\_BEGIN\_ALLOW\_THREADS |
|  |  | #if HAVE\_MKDIRAT |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `5130731`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F5130731c9e779b97d00a24f54cdce73ce9975dfd) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from security.netapp.com_384259b2_20250111_101938.html ===

[Skip to main content](#n-main-content)

* [NetApp.com](https://www.netapp.com/)
* [Support](https://mysupport.netapp.com)
* [Community](https://community.netapp.com)
* [Training](https://www.netapp.com/support-and-training/netapp-learning-services/)

* [Contact Us](https://www.netapp.com/company/contact-us/)

English
æ¥æ¬èª

[netapp-mark

NetApp

## Product Security](https://security.netapp.com)

Search

Search

* Search

Search

Search

* [Home](https://security.netapp.com/en)
* [Advisories](https://security.netapp.com/advisory/)
* [Bulletins](https://security.netapp.com/bulletins/)
* [Contact](https://security.netapp.com/contact/)
* [Policy](https://security.netapp.com/policy/)
* [Resources](https://security.netapp.com/resources/)
* [Certifications](https://security.netapp.com/certs/)

* [Home](https://security.netapp.com/en)
* [Advisory](https://security.netapp.com/advisory)
* [CVE-2024-4030 Python Vulnerability in NetApp Products](https://security.netapp.com/advisory/ntap-20240705-0005)

## CVE-2024-4030 Python Vulnerability in NetApp Products

circle-info

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

close ×

#### Subscribe to NTAP-20240705-0005 updates

Email

Yes, please send me emails when NetApp Security Advisories are posted or updated.

 By filling and submitting this form, I understand and agree with the [NetApp privacy policy](https://www.netapp.com/company/legal/privacy-policy/ "Privacy Policy") and understand that I can unsubscribe from NetApp Security Advisory communications at any time.

Subscribe

#### Subscribe to NTAP-20240705-0005 advisory updates

OTP

Confirm

ionicons-v5-e

Confirmed your subscription to advisory alerts

close ×

#### Unsubscribe from NTAP-20240705-0005 advisory updates

Email

Unsubscribe

#### Unsubscribe from NTAP-20240705-0005 advisory updates

Email

Confirm

ionicons-v5-e

Unsubscribed successfully from advisory alerts

Subscribe to receive email updates

**Advisory ID:** NTAP-20240705-0005
**Version:**
17.0

**Last updated:**
10/24/2024

**Status:**
Interim.

**CVEs:** CVE-2024-4030

Overview
#### Summary

Multiple NetApp products incorporate Python. Python versions prior to 3.13.0b1 and prior to 3.12.4 are susceptible to a vulnerability which when successfully exploited could lead to disclosure of information or addition or modification of data.

#### Impact

Successful exploitation of this vulnerability could lead to disclosure of information or addition or modification of data.

#### Vulnerability Scoring Details

| **CVE** | **Score** | **Vector** |
| --- | --- | --- |
| [CVE-2024-4030](https://nvd.nist.gov/vuln/detail/CVE-2024-4030) | 7.1 (HIGH) | CVSS:3.1/AV:L/AC:L/PR:L/UI:N/S:U/C:H/I:H/A:N |

#### Exploitation and Public Announcements

NetApp is aware of public discussion of this vulnerability.

#### References

* <https://github.com/python/cpython/commit/81939dad77001556c527485d31a2d0f4a759033e>
* <https://github.com/python/cpython/commit/8ed546679524140d8282175411fd141fe7df070d>
* [https://mail.python.org/archives/list/security-announce@python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/](https://mail.python.org/archives/list/security-announce%40python.org/thread/PRGS5OR3N3PNPT4BMV2VAGN5GMUI5636/)
* <https://github.com/python/cpython/issues/118486>

Affected Products
#### Affected Products

* Active IQ Unified Manager for Microsoft Windows

#### Products Under Investigation

* NetApp HCI Compute Node (Bootstrap OS)
* NetApp SolidFire & HCI Storage Node (Element Software)
* NetApp XCP NFS
* NetApp XCP SMB

#### Products Not Affected

* AFF BIOS - A1K/A70/A90
* AFF BIOS - A700s
* AFF Baseboard Management Controller (BMC) - A1K/A70/A90
* AFF Baseboard Management Controller (BMC) - A700s
* AFF LOADER- A1K/A70/A90
* ATTO FibreBridge - 7600N
* Active IQ Unified Manager for Linux
* Active IQ Unified Manager for VMware vSphere
* Active IQ mobile app
* Astra Control Center
* Astra Control Center - NetApp Kubernetes Monitoring Operator
* Astra Control Provisioner
* Astra Trident
* Astra Trident Autosupport
* BlueXP Classification
* Brocade Fabric Operating System Firmware
* Brocade SAN Navigator (SANnav)
* Cloud Volumes ONTAP Mediator
* Data Infrastructure Insights Acquisition Unit (formerly Cloud Insights Acquisition Unit)
* Data Infrastructure Insights Storage Workload Security Agent (formerly Cloud Insights Storage Workload Security Agent)
* Data Infrastructure Insights Telegraf Agent (formerly Cloud Insights Telegraf Agent)
* E-Series BIOS
* E-Series SANtricity OS Controller Software 11.x
* E-Series SANtricity Unified Manager and Web Services Proxy
* Element .NET SDK
* Element HealthTools
* Element JAVA SDK
* Element Plug-in for vCenter Server
* Element Powershell Tools
* Element Python SDK
* FAS/AFF BIOS - 2820
* FAS/AFF BIOS - 8300/8700/A400/C400
* FAS/AFF BIOS - A250/500f/C250
* FAS/AFF BIOS - A300/8200/C190/A220/2720/2750/A150
* FAS/AFF BIOS - A320
* FAS/AFF BIOS - A700/9000
* FAS/AFF BIOS - A800/C800
* FAS/AFF BIOS - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - 8300/8700/A400/C400
* FAS/AFF Baseboard Management Controller (BMC) - A250/500f/C250
* FAS/AFF Baseboard Management Controller (BMC) - A320
* FAS/AFF Baseboard Management Controller (BMC) - A800/C800
* FAS/AFF Baseboard Management Controller (BMC) - A900/9500
* FAS/AFF Baseboard Management Controller (BMC) - C190/A150/A220/FAS2720/FAS2750
* FAS/AFF Baseboard Management Controller (BMC) - FAS2820
* FAS/AFF Service Processor - A300/8200
* FAS/AFF Service Processor - A700/9000
* Global File Cache
* Host Utilities - SAN for Linux
* Host Utilities - SAN for Windows
* IOM12 SAS Disk Shelf Firmware
* IOM12B SAS Disk Shelf Firmware
* IOM12E SAS Disk Shelf Firmware
* IOM12F SAS Disk Shelf Firmware
* IOM12G SAS Disk Shelf Firmware
* IOM6 SAS Disk Shelf Firmware
* IOM6E SAS Disk Shelf Firmware
* Management Services for Element Software and NetApp HCI
* MetroCluster DataCollector
* MetroCluster Tiebreaker
* Multipath I/O (SANtricity DSM for Windows MPIO)
* NetApp BlueXP
* NetApp Converged Systems Advisor Agent
* NetApp DataOps Toolkit
* NetApp E-Series Host Collection
* NetApp E-Series SANtricity Collection
* NetApp HCI Baseboard Management Controller (BMC) - H300S/H500S/H700S/H410S
* NetApp HCI Baseboard Management Controller (BMC) - H410C
* NetApp HCI Baseboard Management Controller (BMC) - H610C
* NetApp HCI Baseboard Management Controller (BMC) - H610S
* NetApp HCI Baseboard Management Controller (BMC) - H615C
* NetApp HCI Compute Node BIOS
* NetApp HCI Storage Node BIOS
* NetApp Kubernetes Monitoring Operator
* NetApp Manageability SDK
* NetApp NFS Plug-in for VMware VAAI
* NetApp ONTAP PowerShell Toolkit (PSTK)
* NetApp SolidFire & HCI Management Node
* NetApp SolidFire Plug-in for vRealize Orchestrator (SolidFire vRO)
* ONTAP 9
* ONTAP Antivirus Connector
* ONTAP Mediator
* ONTAP Select Deploy administration utility
* ONTAP tools for VMware vSphere 10
* ONTAP tools for VMware vSphere 9
* OnCommand Insight
* OnCommand Workflow Automation
* RcfFileGenerator for MetroCluster IP
* SANtricity Storage Plugin for vCenter
* SRA Plugin for Linux
* SRA Plugin for Windows
* Single Mailbox Recovery
* Snap Creator Framework
* SnapCenter
* SnapCenter Plug-in for VMware vSphere/BlueXP backup and Recovery for Virtual Machine
* SnapGathers
* SnapManager for Hyper-V
* SolidFire Storage Replication Adapter
* StorageGRID (formerly StorageGRID Webscale)
* StorageGRID BIOS SG1000/SG100/SG1100/SG110
* StorageGRID BIOS SG5660/SG5612/SG5760/SG5712
* StorageGRID BIOS SG5812/SG5860
* StorageGRID BIOS SG6060/SGF6024/SGF6112/SG6160
* StorageGRID Baseboard Management Controller (BMC) - SG6060/SG6160/SGF6024/SGF6112/SG100/SG110/SG1000/SG1100
* StorageGRID Baseboard Management Controller (BMC) SG5812/SG5860
* System Manager 9.x
* Terraform Provider for ONTAP
* Workload Factory for VMware

Remediation
#### Software Versions and Fixes

None.

This section will be updated as patches are released.

#### Workarounds

None at this time.

#### Obtaining Software Fixes

Software fixes will be made available through the NetApp Support website in the Software Download section.

<https://mysupport.netapp.com/site/downloads/>

Customers who do not have access to the Support website should contact Technical Support at the number below to obtain the patches.

#### Contact Information

Check <http://mysupport.netapp.com> for further
updates.

**Technical Support**

mysupport.netapp.com

1 888 4 NETAPP (1 888 463 8277) (U.S. and Canada)

+00 800 44 638277 (EMEA/Europe)

+800 800 80 800 (Asia/Pacific)

Revision History
#### Status of This Notice

**Interim.**

NetApp will continue to update this advisory as additional information becomes available.

This advisory should be considered the single source of current, up-to-date, authorized and accurate information from NetApp regarding Full Support products and versions.

This advisory is posted at the following link:

<https://security.netapp.com/advisory/NTAP-20240705-0005>
#### Revision History

| **Revision #** | **Date** | **Comments** |
| --- | --- | --- |
| 1.0 | 20240705 | Initial Public Release |
| 2.0 | 20240711 | ONTAP 9 (formerly Clustered Data ONTAP), FAS/AFF Baseboard Management Controller (BMC) - A900/9500, and Cloud Volumes ONTAP Mediator moved to Products Not Affected |
| 3.0 | 20240814 | ONTAP Mediator moved to Products Not Affected |
| 4.0 | 20240920 | Active IQ Unified Manager for VMware vSphere moved to Products Not Affected |
| 5.0 | 20240926 | ONTAP tools for VMware vSphere 10 moved to Products Not Affected |
| 17.0 | 20241024 | Active IQ Unified Manager for Microsoft Windows moved to Affected Products |

This document is provided solely for informational purposes. All information is based upon NetAppâs current knowledge and understanding of the hardware and software products tested by NetApp, and the methodology and assumptions used by NetApp. NetApp is not responsible for any errors or omissions that may be contained herein, and no warranty, representation, or other legal commitment or obligation is being provided by NetApp. Â© 2025 NetApp, Inc. All rights reserved. No portions of this document may be reproduced without prior written consent of NetApp, Inc.

 ©  NetApp

Have feedback for our website?
[Let us know](https://www.netapp.com/forms/site-feedback/)



=== Content from github.com_cd6b5d92_20250111_101923.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8ed546679524140d8282175411fd141fe7df070d)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8ed546679524140d8282175411fd141fe7df070d)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/8ed546679524140d8282175411fd141fe7df070d)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Switch mkdir(mode=0o700) on Windows to use OWNER RIGHTS in…

[Browse files](/python/cpython/tree/8ed546679524140d8282175411fd141fe7df070d)
Browse the repository at this point in the history

```
…stead of CURRENT_USER ([GH-118515](https://github.com/python/cpython/pull/118515))
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 2, 2024

1 parent
[16acecd](/python/cpython/commit/16acecd77924b849f51b36f41cd21ca759c9ff2a)

commit 8ed5466

Showing
**1 changed file**
with
**16 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

19 changes: 16 additions & 3 deletions

19
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/8ed546679524140d8282175411fd141fe7df070d/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5587,6 +5587,7 @@ struct \_Py\_SECURITY\_ATTRIBUTE\_DATA { |
|  |  | PACL acl; |
|  |  | SECURITY\_DESCRIPTOR sd; |
|  |  | EXPLICIT\_ACCESS\_W ea[4]; |
|  |  | char sid[64]; |
|  |  | }; |
|  |  |  |
|  |  | static int |
| Expand Down  Expand Up | | @@ -5616,13 +5617,25 @@ initializeMkdir700SecurityAttributes( |
|  |  | return GetLastError(); |
|  |  | } |
|  |  |  |
|  |  | int use\_alias = 0; |
|  |  | DWORD cbSid = sizeof(data->sid); |
|  |  | if (!CreateWellKnownSid(WinCreatorOwnerRightsSid, NULL, (PSID)data->sid, &cbSid)) { |
|  |  | use\_alias = 1; |
|  |  | } |
|  |  |  |
|  |  | data->securityAttributes.nLength = sizeof(SECURITY\_ATTRIBUTES); |
|  |  | data->ea[0].grfAccessPermissions = GENERIC\_ALL; |
|  |  | data->ea[0].grfAccessMode = SET\_ACCESS; |
|  |  | data->ea[0].grfInheritance = SUB\_CONTAINERS\_AND\_OBJECTS\_INHERIT; |
|  |  | data->ea[0].Trustee.TrusteeForm = TRUSTEE\_IS\_NAME; |
|  |  | data->ea[0].Trustee.TrusteeType = TRUSTEE\_IS\_ALIAS; |
|  |  | data->ea[0].Trustee.ptstrName = L"CURRENT\_USER"; |
|  |  | if (use\_alias) { |
|  |  | data->ea[0].Trustee.TrusteeForm = TRUSTEE\_IS\_NAME; |
|  |  | data->ea[0].Trustee.TrusteeType = TRUSTEE\_IS\_ALIAS; |
|  |  | data->ea[0].Trustee.ptstrName = L"CURRENT\_USER"; |
|  |  | } else { |
|  |  | data->ea[0].Trustee.TrusteeForm = TRUSTEE\_IS\_SID; |
|  |  | data->ea[0].Trustee.TrusteeType = TRUSTEE\_IS\_WELL\_KNOWN\_GROUP; |
|  |  | data->ea[0].Trustee.ptstrName = (LPWCH)(SID\*)data->sid; |
|  |  | } |
|  |  |  |
|  |  | data->ea[1].grfAccessPermissions = GENERIC\_ALL; |
|  |  | data->ea[1].grfAccessMode = SET\_ACCESS; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `8ed5466`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F8ed546679524140d8282175411fd141fe7df070d) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_082229de_20250111_101918.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6d0850c4c8188035643586ab4d8ec2468abd699e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6d0850c4c8188035643586ab4d8ec2468abd699e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/6d0850c4c8188035643586ab4d8ec2468abd699e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Simplify test\_win32\_mkdir\_700 to check the exact ACL ([GH-1…](https://github.com/python/cpython/pull/119056)

[Browse files](/python/cpython/tree/6d0850c4c8188035643586ab4d8ec2468abd699e)
Browse the repository at this point in the history

```
[…19056](https://github.com/python/cpython/pull/119056))

(cherry picked from commit [94591dc](https://github.com/python/cpython/commit/94591dca510c796c7d40e9b4167ea56f2fdf28ca))

Co-authored-by: Steve Dower <steve.dower@python.org>
```

* Loading branch information

[![@miss-islington](https://avatars.githubusercontent.com/u/31488909?s=40&v=4)](/miss-islington) [![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[miss-islington](/python/cpython/commits?author=miss-islington "View all commits by miss-islington")
and
[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 15, 2024

1 parent
[bac277f](/python/cpython/commit/bac277f1dd1f1895ee54a0ae4bf11cf1f2dc5ac2)

commit 6d0850c

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**9 additions**
and
**16 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Lib/test

  + Lib/test/test\_os.py
    [test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc)
* Modules

  + Modules/posixmodule.c
    [posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791)

## There are no files selected for viewing

23 changes: 8 additions & 15 deletions

23
[Lib/test/test\_os.py](#diff-5007f0845419916c8b0294481e2ee212ca36661d9843f86338ec42254645edfc "Lib/test/test_os.py")

Show comments

[View file](/python/cpython/blob/6d0850c4c8188035643586ab4d8ec2468abd699e/Lib/test/test_os.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1800,21 +1800,14 @@ def test\_exist\_ok\_existing\_regular\_file(self): |
|  |  | @unittest.skipUnless(os.name == 'nt', "requires Windows") |
|  |  | def test\_win32\_mkdir\_700(self): |
|  |  | base = os\_helper.TESTFN |
|  |  | path1 = os.path.join(os\_helper.TESTFN, 'dir1') |
|  |  | path2 = os.path.join(os\_helper.TESTFN, 'dir2') |
|  |  | # mode=0o700 is special-cased to override ACLs on Windows |
|  |  | # There's no way to know exactly how the ACLs will look, so we'll |
|  |  | # check that they are different from a regularly created directory. |
|  |  | os.mkdir(path1, mode=0o700) |
|  |  | os.mkdir(path2, mode=0o777) |
|  |  |  |
|  |  | out1 = subprocess.check\_output(["icacls.exe", path1], encoding="oem") |
|  |  | out2 = subprocess.check\_output(["icacls.exe", path2], encoding="oem") |
|  |  | os.rmdir(path1) |
|  |  | os.rmdir(path2) |
|  |  | out1 = out1.replace(path1, "<PATH>") |
|  |  | out2 = out2.replace(path2, "<PATH>") |
|  |  | self.assertNotEqual(out1, out2) |
|  |  | path = os.path.abspath(os.path.join(os\_helper.TESTFN, 'dir')) |
|  |  | os.mkdir(path, mode=0o700) |
|  |  | out = subprocess.check\_output(["cacls.exe", path, "/s"], encoding="oem") |
|  |  | os.rmdir(path) |
|  |  | self.assertEqual( |
|  |  | out.strip(), |
|  |  | f'{path} "D:P(A;OICI;FA;;;SY)(A;OICI;FA;;;BA)(A;OICI;FA;;;OW)"', |
|  |  | ) |
|  |  |  |
|  |  | def tearDown(self): |
|  |  | path = os.path.join(os\_helper.TESTFN, 'dir1', 'dir2', 'dir3', |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[Modules/posixmodule.c](#diff-b5b7e4f5599916b2018e911ef423f9d3fd46cb71268e1a73c74a1c9ae2cb6791 "Modules/posixmodule.c")

Show comments

[View file](/python/cpython/blob/6d0850c4c8188035643586ab4d8ec2468abd699e/Modules/posixmodule.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5364,7 +5364,7 @@ os\_mkdir\_impl(PyObject \*module, path\_t \*path, int mode, int dir\_fd) |
|  |  | if (mode == 0700 /\* 0o700 \*/) { |
|  |  | ULONG sdSize; |
|  |  | pSecAttr = &secAttr; |
|  |  | // Set a discreationary ACL (D) that is protected (P) and includes |
|  |  | // Set a discretionary ACL (D) that is protected (P) and includes |
|  |  | // inheritable (OICI) entries that allow (A) full control (FA) to |
|  |  | // SYSTEM (SY), Administrators (BA), and the owner (OW). |
|  |  | if (!ConvertStringSecurityDescriptorToSecurityDescriptorW( |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6d0850c`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2F6d0850c4c8188035643586ab4d8ec2468abd699e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_85296d1e_20250111_101932.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd86b49411753bf2c83291e3a14ae43fefded2f84)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd86b49411753bf2c83291e3a14ae43fefded2f84)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=python%2Fcpython)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[python](/python)
/
**[cpython](/python/cpython)**
Public

* [Notifications](/login?return_to=%2Fpython%2Fcpython) You must be signed in to change notification settings
* [Fork
  30.8k](/login?return_to=%2Fpython%2Fcpython)
* [Star
   64.7k](/login?return_to=%2Fpython%2Fcpython)

* [Code](/python/cpython)
* [Issues
  5k+](/python/cpython/issues)
* [Pull requests
  1.8k](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects
  28](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

Additional navigation options

* [Code](/python/cpython)
* [Issues](/python/cpython/issues)
* [Pull requests](/python/cpython/pulls)
* [Actions](/python/cpython/actions)
* [Projects](/python/cpython/projects)
* [Security](/python/cpython/security)
* [Insights](/python/cpython/pulse)

## Commit

[Permalink](/python/cpython/commit/d86b49411753bf2c83291e3a14ae43fefded2f84)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[gh-118486](https://github.com/python/cpython/issues/118486): Update docs for [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") reference ([GH-118737](https://github.com/python/cpython/pull/118737))

[Browse files](/python/cpython/tree/d86b49411753bf2c83291e3a14ae43fefded2f84)
Browse the repository at this point in the history

```
Update docs for [CVE-2024-4030](https://github.com/advisories/GHSA-2w87-6hh6-mqrj "CVE-2024-4030") reference
```

* Loading branch information

[![@zooba](https://avatars.githubusercontent.com/u/1693688?s=40&v=4)](/zooba)

[zooba](/python/cpython/commits?author=zooba "View all commits by zooba")
authored
May 9, 2024

1 parent
[632682c](/python/cpython/commit/632682c0c27f51aa20fa27d1acf80d38997e4022)

commit d86b494

 Show file tree

 Hide file tree

Showing
**2 changed files**
with
**18 additions**
and
**0 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* Doc/whatsnew

  + Doc/whatsnew/3.13.rst
    [3.13.rst](#diff-0eef04c1aae0cf8389945464f271ff6789259ef8985f5fdbb21c9a99c4b5021f)
* Misc/NEWS.d/next/Security

  + Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst
    [2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739)

## There are no files selected for viewing

14 changes: 14 additions & 0 deletions

14
[Doc/whatsnew/3.13.rst](#diff-0eef04c1aae0cf8389945464f271ff6789259ef8985f5fdbb21c9a99c4b5021f "Doc/whatsnew/3.13.rst")

Show comments

[View file](/python/cpython/blob/d86b49411753bf2c83291e3a14ae43fefded2f84/Doc/whatsnew/3.13.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -847,6 +847,12 @@ os |
|  |  | :c:func:`!posix\_spawn\_file\_actions\_addclosefrom\_np`. |
|  |  | (Contributed by Jakub Kulik in :gh:`113117`.) |
|  |  |  |
|  |  | \* :func:`os.mkdir` and :func:`os.makedirs` on Windows now support passing a |
|  |  | \*mode\* value of ``0o700`` to apply access control to the new directory. This |
|  |  | implicitly affects :func:`tempfile.mkdtemp` and is a mitigation for |
|  |  | :cve:`2024-4030`. Other values for \*mode\* continue to be ignored. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | os.path |
|  |  | ------- |
|  |  |  |
| Expand Down  Expand Up | | @@ -989,6 +995,14 @@ sys |
|  |  | This function is not guaranteed to exist in all implementations of Python. |
|  |  | (Contributed by Serhiy Storchaka in :gh:`78573`.) |
|  |  |  |
|  |  | tempfile |
|  |  | -------- |
|  |  |  |
|  |  | \* On Windows, the default mode ``0o700`` used by :func:`tempfile.mkdtemp` now |
|  |  | limits access to the new directory due to changes to :func:`os.mkdir`. This |
|  |  | is a mitigation for :cve:`2024-4030`. |
|  |  | (Contributed by Steve Dower in :gh:`118486`.) |
|  |  |  |
|  |  | time |
|  |  | ---- |
|  |  |  |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst](#diff-905aa8a2d8063f554a45eafbd95f118fcbbcd9f700deb2ef91e0842201cdb739 "Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst")

Show comments

[View file](/python/cpython/blob/d86b49411753bf2c83291e3a14ae43fefded2f84/Misc/NEWS.d/next/Security/2024-05-01-20-57-09.gh-issue-118486.K44KJG.rst)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

|  |  | @@ -0,0 +1,4 @@ |
|  |  | :func:`os.mkdir` on Windows now accepts \*mode\* of ``0o700`` to restrict |
|  |  | the new directory to the current user. This fixes :cve:`2024-4030` |
|  |  | affecting :func:`tempfile.mkdtemp` in scenarios where the base temporary |
|  |  | directory is more permissive than the default. |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d86b494`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpython%2Fcpython%2Fcommit%2Fd86b49411753bf2c83291e3a14ae43fefded2f84) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


