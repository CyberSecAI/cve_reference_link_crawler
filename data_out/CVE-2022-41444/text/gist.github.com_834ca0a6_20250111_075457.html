
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@enferas](https://avatars.githubusercontent.com/u/10528985?s=64&v=4)](/enferas)

# [enferas](/enferas)/**[XSS\_Cacti.md](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2)**

Last active
September 22, 2022 14:18

Show Gist options

* [Download ZIP](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2/archive/07b3f08966b64b3d7d3c556b07f12ebf60e6084b.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/enferas/9079535112e4f4ff2c1d2ce1c099d4c2.js&quot;&gt;&lt;/script&gt;
* Save enferas/9079535112e4f4ff2c1d2ce1c099d4c2 to your computer and use it in GitHub Desktop.

[Code](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2)
[Revisions
3](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/enferas/9079535112e4f4ff2c1d2ce1c099d4c2.js&quot;&gt;&lt;/script&gt;

Save enferas/9079535112e4f4ff2c1d2ce1c099d4c2 to your computer and use it in GitHub Desktop.

[Download ZIP](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2/archive/07b3f08966b64b3d7d3c556b07f12ebf60e6084b.zip)

XSS vulnerability in Cacti

 [Raw](/enferas/9079535112e4f4ff2c1d2ce1c099d4c2/raw/07b3f08966b64b3d7d3c556b07f12ebf60e6084b/XSS_Cacti.md)

[**XSS\_Cacti.md**](#file-xss_cacti-md)

XSS vulnerability in Cacti <https://github.com/Cacti/cacti> version v1.2.21

The path of the vulnerability.
In file <https://github.com/Cacti/cacti/blob/develop/graphs_new.php>

```
//line 40
switch (get_request_var('action')) {
              case 'save':
                            form_save();

//line 117 the source in $_POST
function form_save() {
              if (isset_request_var('save_component_graph')) {
                            /* summarize the 'create graph from host template/snmp index' stuff into an array */
                            foreach ($_POST as $var => $val) {
                            //…..
                           if (strpos($var, 'sgg_') !== false) {
                                                         // Note: the source in $snmp_query_id then function store_get_selected_dq_index will be called
                                                         $snmp_query_id = str_replace('sgg_', '', $var);
                                                        store_get_selected_dq_index($snmp_query_id);
                                          }
                            }
            //…….
}
// line 100
Note the source in $snmp_query_id
function store_get_selected_dq_index($snmp_query_id) {
              // ….
              } elseif (isset_request_var('sgg_' . $snmp_query_id)) {
                             // Note: get_filter_request_var will be called
                            $selected = get_filter_request_var('sgg_' . $snmp_query_id);
              }
//….
}
```

In file <https://github.com/Cacti/cacti/blob/develop/lib/html_utility.php>

```
//line 424
// the source in the argument $name
function get_filter_request_var($name, $filter = FILTER_VALIDATE_INT, $options = array()) {
//….
//line 503
if ($value === false) {
                                          if ($filter == FILTER_VALIDATE_IS_REGEX) {
                                                         //….
                                          } else {
                                                         // Note: function die_html_input_error will be called
                                                         die_html_input_error($name, get_nfilter_request_var($name));
                                          }
                            }
```

In file <https://github.com/Cacti/cacti/blob/develop/lib/html_validate.php>

```
//line 47
// Note: the source in $variable
function die_html_input_error($variable = '', $value = '', $message = '') {
              //….

              if ($message == '') {
              // Note: the $message will include the $variable as I will explain later, then it will be printed
              $message = __('Validation error for variable %s with a value of %s.  See backtrace below for more details.', $variable, $value);
              }
              //Note: the print of the $message
             $variable = ($variable != '' ? ', Variable:' . $variable : '');
              $value    = ($value    != '' ? ', Value:'    . $value    : '');

              if (defined('CACTI_CLI_ONLY')) {
                            cacti_debug_backtrace('Validation Error' . $variable . $value, false);
                            print $message . PHP_EOL;
                            exit(1);
              } elseif (isset_request_var('json')) {
                            cacti_debug_backtrace('Validation Error' . $variable . $value, false);
                            print json_encode(
                                          array(
                                                         'status' => '500',
                                                         'statusText' => __('Validation Error'),
                                                         'responseText' => $message
                                          )
                            );
              } else {
                            cacti_debug_backtrace('Validation Error' . $variable . $value, true);

                            print "<table style='width:100%;text-align:center;'><tr><td>$message</td></tr></table>";
                            bottom_footer();
              }

              exit;
}
}
```

In file <https://github.com/Cacti/cacti/blob/develop/include/global_languages.php>

```
//line 432
function __() {
              global $l10n;

              $args = func_get_args();
              $num  = func_num_args();

              //….
                            else{
                                          $args[0] = __gettext($args[0]);
                            }

                            /* process return string against input arguments */
                            return __uf(call_user_func_array('sprintf', $args));
              }
}

//line 393
function __gettext($text, $domain = 'cacti') {
              //….

              if (!isset($translated)) {
                            $translated = $text;
              }

              //…..
              return __uf($translated);
}

//line 428
function __uf($text) {
              return str_replace('%%', '%', $text);
}
```

The vulnerability is confirmed by the developers.
The email sent on 18/06/2022.

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fenferas%2F9079535112e4f4ff2c1d2ce1c099d4c2)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

