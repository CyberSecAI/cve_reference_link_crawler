

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Arunpravin Paneer Selvam <Arunpravin.PaneerSelvam@amd.com> | 2024-02-14 18:48:52 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-02-23 09:51:45 +0100 |
| commit | [4b59c3fada06e5e8010ef7700689c71986e667a2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4b59c3fada06e5e8010ef7700689c71986e667a2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)) | |
| tree | [74944182c1c6547a664738e138bc03a36e7f9342](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4b59c3fada06e5e8010ef7700689c71986e667a2) | |
| parent | [6190d4c08897d748dd25f0b78267a90aa1694e15](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6190d4c08897d748dd25f0b78267a90aa1694e15) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b59c3fada06e5e8010ef7700689c71986e667a2&id2=6190d4c08897d748dd25f0b78267a90aa1694e15)) | |
| download | [linux-4b59c3fada06e5e8010ef7700689c71986e667a2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4b59c3fada06e5e8010ef7700689c71986e667a2.tar.gz) | |

drm/buddy: Fix alloc\_range() error handling codecommit 8746c6c9dfa31d269c65dd52ab42fde0720b7d91 upstream.
Few users have observed display corruption when they boot
the machine to KDE Plasma or playing games. We have root
caused the problem that whenever alloc\_range() couldn't
find the required memory blocks the function was returning
SUCCESS in some of the corner cases.
The right approach would be if the total allocated size
is less than the required size, the function should
return -ENOSPC.
Cc: <stable@vger.kernel.org> # 6.7+
Fixes: 0a1844bf0b53 ("drm/buddy: Improve contiguous memory allocation")
Closes: https://gitlab.freedesktop.org/drm/amd/-/issues/3097
Tested-by: Mario Limonciello <mario.limonciello@amd.com>
Link: [https://patchwork.kernel.org/project/dri-devel/patch/20240207174456.341121-1-Arunpravin.PaneerSelvam@amd.com/](https://patchwork.kernel.org/project/dri-devel/patch/20240207174456.341121-1-Arunpravin.PaneerSelvam%40amd.com/)
Acked-by: Christian König <christian.koenig@amd.com>
Reviewed-by: Matthew Auld <matthew.auld@intel.com>
Signed-off-by: Arunpravin Paneer Selvam <Arunpravin.PaneerSelvam@amd.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240214131853.5934-1-Arunpravin.PaneerSelvam@amd.com](https://patchwork.freedesktop.org/patch/msgid/20240214131853.5934-1-Arunpravin.PaneerSelvam%40amd.com)
Signed-off-by: Christian König <christian.koenig@amd.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4b59c3fada06e5e8010ef7700689c71986e667a2)

| -rw-r--r-- | [drivers/gpu/drm/drm\_buddy.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/drm_buddy.c?id=4b59c3fada06e5e8010ef7700689c71986e667a2) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 6 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/drm\_buddy.c b/drivers/gpu/drm/drm\_buddy.cindex f57e6d74fb0e03..c1a99bf4dffd1d 100644--- a/[drivers/gpu/drm/drm\_buddy.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/drm_buddy.c?id=6190d4c08897d748dd25f0b78267a90aa1694e15)+++ b/[drivers/gpu/drm/drm\_buddy.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/drm_buddy.c?id=4b59c3fada06e5e8010ef7700689c71986e667a2)@@ -539,6 +539,12 @@ static int \_\_alloc\_range(struct drm\_buddy \*mm, } while (1);  list\_splice\_tail(&allocated, blocks);++ if (total\_allocated < size) {+ err = -ENOSPC;+ goto err\_free;+ }+ return 0;  err\_undo: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 16:48:23 +0000

