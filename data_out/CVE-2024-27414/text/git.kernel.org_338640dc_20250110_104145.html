

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lin Ma <linma@zju.edu.cn> | 2024-02-27 20:11:28 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-03-06 14:45:08 +0000 |
| commit | [f2261eb994aa5757c1da046b78e3229a3ece0ad9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)) | |
| tree | [f49cec2ab6d83c64bb3be6d89f1947aea376afef](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9) | |
| parent | [2b1414d5e94e477edff1d2c79030f1d742625ea0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2b1414d5e94e477edff1d2c79030f1d742625ea0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9&id2=2b1414d5e94e477edff1d2c79030f1d742625ea0)) | |
| download | [linux-f2261eb994aa5757c1da046b78e3229a3ece0ad9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f2261eb994aa5757c1da046b78e3229a3ece0ad9.tar.gz) | |

rtnetlink: fix error logic of IFLA\_BRIDGE\_FLAGS writing back[ Upstream commit 743ad091fb46e622f1b690385bb15e3cd3daf874 ]
In the commit d73ef2d69c0d ("rtnetlink: let rtnl\_bridge\_setlink checks
IFLA\_BRIDGE\_MODE length"), an adjustment was made to the old loop logic
in the function `rtnl\_bridge\_setlink` to enable the loop to also check
the length of the IFLA\_BRIDGE\_MODE attribute. However, this adjustment
removed the `break` statement and led to an error logic of the flags
writing back at the end of this function.
if (have\_flags)
memcpy(nla\_data(attr), &flags, sizeof(flags));
// attr should point to IFLA\_BRIDGE\_FLAGS NLA !!!
Before the mentioned commit, the `attr` is granted to be IFLA\_BRIDGE\_FLAGS.
However, this is not necessarily true fow now as the updated loop will let
the attr point to the last NLA, even an invalid NLA which could cause
overflow writes.
This patch introduces a new variable `br\_flag` to save the NLA pointer
that points to IFLA\_BRIDGE\_FLAGS and uses it to resolve the mentioned
error logic.
Fixes: d73ef2d69c0d ("rtnetlink: let rtnl\_bridge\_setlink checks IFLA\_BRIDGE\_MODE length")
Signed-off-by: Lin Ma <linma@zju.edu.cn>
Acked-by: Nikolay Aleksandrov <razor@blackwall.org>
Link: [https://lore.kernel.org/r/20240227121128.608110-1-linma@zju.edu.cn](https://lore.kernel.org/r/20240227121128.608110-1-linma%40zju.edu.cn)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)

| -rw-r--r-- | [net/core/rtnetlink.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/core/rtnetlink.c?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 6 deletions

| diff --git a/net/core/rtnetlink.c b/net/core/rtnetlink.cindex 7cf1e42d7f93b8..ac379e4590f8de 100644--- a/[net/core/rtnetlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/rtnetlink.c?id=2b1414d5e94e477edff1d2c79030f1d742625ea0)+++ b/[net/core/rtnetlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/core/rtnetlink.c?id=f2261eb994aa5757c1da046b78e3229a3ece0ad9)@@ -5026,10 +5026,9 @@ static int rtnl\_bridge\_setlink(struct sk\_buff \*skb, struct nlmsghdr \*nlh, struct net \*net = sock\_net(skb->sk); struct ifinfomsg \*ifm; struct net\_device \*dev;- struct nlattr \*br\_spec, \*attr = NULL;+ struct nlattr \*br\_spec, \*attr, \*br\_flags\_attr = NULL; int rem, err = -EOPNOTSUPP; u16 flags = 0;- bool have\_flags = false;  if (nlmsg\_len(nlh) < sizeof(\*ifm)) return -EINVAL;@@ -5047,11 +5046,11 @@ static int rtnl\_bridge\_setlink(struct sk\_buff \*skb, struct nlmsghdr \*nlh, br\_spec = nlmsg\_find\_attr(nlh, sizeof(struct ifinfomsg), IFLA\_AF\_SPEC); if (br\_spec) { nla\_for\_each\_nested(attr, br\_spec, rem) {- if (nla\_type(attr) == IFLA\_BRIDGE\_FLAGS && !have\_flags) {+ if (nla\_type(attr) == IFLA\_BRIDGE\_FLAGS && !br\_flags\_attr) { if (nla\_len(attr) < sizeof(flags)) return -EINVAL; - have\_flags = true;+ br\_flags\_attr = attr; flags = nla\_get\_u16(attr); } @@ -5095,8 +5094,8 @@ static int rtnl\_bridge\_setlink(struct sk\_buff \*skb, struct nlmsghdr \*nlh, } } - if (have\_flags)- memcpy(nla\_data(attr), &flags, sizeof(flags));+ if (br\_flags\_attr)+ memcpy(nla\_data(br\_flags\_attr), &flags, sizeof(flags)); out: return err; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 10:40:22 +0000

