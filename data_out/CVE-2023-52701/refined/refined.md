The provided content relates to CVE-2023-52701.

**Root cause of vulnerability:**
The vulnerability stems from the direct copying of `skb->mark` to user space in the `sock_recv_mark()` function when `CONFIG_HARDENED_USERCOPY=y` is enabled. This is problematic because only data from `skb->cb[]` is intended to be directly copied to/from user space.

**Weaknesses/vulnerabilities present:**
- Incorrect memory handling: The code directly copies data from `skb->mark` to user space, which is not allowed with hardened usercopy enabled. This violates the intended restrictions on user space access.
- Kernel memory exposure: The vulnerability allows potential exposure of kernel memory due to the incorrect copy operation.

**Impact of exploitation:**
- Kernel crash: The incorrect memory access leads to a kernel BUG and system crash, as reported by syzbot.
- Potential information leak: Direct access to `skb->mark` from user space could potentially expose sensitive kernel data if the content of that memory area is considered confidential.

**Attack vectors:**
- The vulnerability is triggered during a `recvmsg()` system call when the `SOCK_RCVMARK` socket option is enabled.
- The vulnerability is exposed when a specially crafted network packet is received, where the user has set the `SO_RCVMARK` socket option, causing the kernel to attempt to copy the skb mark to user space using `put_cmsg()`.

**Required attacker capabilities/position:**
- The attacker needs the ability to send network packets to the affected system.
- The attacker needs to be able to set the `SOCK_RCVMARK` option for a socket that will be used for `recvmsg()`.
- The attacker must be able to make a call to `recvmsg()`.

**Additional notes:**

- The vulnerability was discovered by syzbot.
- The fix involves using a bounce buffer to copy `skb->mark` when `CONFIG_HARDENED_USERCOPY=y`. This ensures that the copy is done safely to user space.
- The vulnerability is specific to arm64 architecture when `CONFIG_HARDENED_USERCOPY=y`. x86 and powerpc were not affected because they define `user_access_begin`.
- The commit log references commit 79a8a642bf05, which whitelisted the `skbuff_head_cache "cb"` field, highlighting that this vulnerability is a violation of that security model.