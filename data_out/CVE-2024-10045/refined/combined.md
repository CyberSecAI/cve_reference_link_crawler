=== Content from plugins.trac.wordpress.org_cba46a41_20250111_024132.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Ftransients-manager%2Ftrunk%2Fsrc%2FTransientsManager.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/transients-manager/trunk/src/TransientsManager.php?rev=3166029 "Revision 3166029")
* Next Revision →
* [Blame](/browser/transients-manager/trunk/src/TransientsManager.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/transients-manager/trunk/src/TransientsManager.php)

---

# [source:](/browser?order=name "Go to repository root") [transients-manager](/browser/transients-manager?order=name "View transients-manager")/[trunk](/browser/transients-manager/trunk?order=name "View trunk")/[src](/browser/transients-manager/trunk/src?order=name "View src")/[TransientsManager.php](/browser/transients-manager/trunk/src/TransientsManager.php?order=name "View TransientsManager.php")

View diff against:

View revision:

| [Last change](/changeset/3171619/transients-manager/trunk/src/TransientsManager.php "View differences") on this file was [3171619](/changeset/3171619/ "View changeset 3171619"), checked in by \_smartik\_, [3 months ago](/timeline?from=2024-10-18T17%3A06%3A42Z&precision=second "See timeline at 10/18/2024 05:06:42 PM") |
| --- |
| Release version 2.0.7 |
| **File size:** 54.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | namespace AM\TransientsManager; |
| [4](#L4) |  |
| [5](#L5) | /\*\* |
| [6](#L6) | \* Transients Manager class |
| [7](#L7) | \*/ |
| [8](#L8) | class TransientsManager { |
| [9](#L9) |  |
| [10](#L10) | /\*\* @var ?self \*/ |
| [11](#L11) | private static $instance = null; |
| [12](#L12) |  |
| [13](#L13) | /\*\* |
| [14](#L14) | \* ID of the plugin page |
| [15](#L15) | \* |
| [16](#L16) | \* @since 2.0 |
| [17](#L17) | \* @var   string |
| [18](#L18) | \*/ |
| [19](#L19) | public $page\_id = 'transients-manager'; |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* ID of the Admin Screen |
| [23](#L23) | \* |
| [24](#L24) | \* @since 2.0.5 |
| [25](#L25) | \* @var   string |
| [26](#L26) | \*/ |
| [27](#L27) | public $screen\_id = ''; |
| [28](#L28) |  |
| [29](#L29) | /\*\* |
| [30](#L30) | \* Capability the current-user needs to manage transients |
| [31](#L31) | \* |
| [32](#L32) | \* @since 2.0 |
| [33](#L33) | \* @var   string |
| [34](#L34) | \*/ |
| [35](#L35) | public $capability = 'manage\_options'; |
| [36](#L36) |  |
| [37](#L37) | /\*\* |
| [38](#L38) | \* Timestamp for right now |
| [39](#L39) | \* |
| [40](#L40) | \* @since 2.0 |
| [41](#L41) | \* @var   int |
| [42](#L42) | \*/ |
| [43](#L43) | public $time\_now = 0; |
| [44](#L44) |  |
| [45](#L45) | /\*\* |
| [46](#L46) | \* The next timestamp to delete expired transients (via WP Cron) |
| [47](#L47) | \* |
| [48](#L48) | \* @since 2.0 |
| [49](#L49) | \* @var   int |
| [50](#L50) | \*/ |
| [51](#L51) | public $next\_cron\_delete = 0; |
| [52](#L52) |  |
| [53](#L53) | /\*\* |
| [54](#L54) | \* Transient ID |
| [55](#L55) | \* |
| [56](#L56) | \* @since 2.0.4 |
| [57](#L57) | \* @var   int |
| [58](#L58) | \*/ |
| [59](#L59) | public $transient\_id = 0; |
| [60](#L60) |  |
| [61](#L61) | /\*\* |
| [62](#L62) | \* Transient object |
| [63](#L63) | \* |
| [64](#L64) | \* @since 2.0.4 |
| [65](#L65) | \* @var   object |
| [66](#L66) | \*/ |
| [67](#L67) | public $transient = false; |
| [68](#L68) |  |
| [69](#L69) | /\*\* |
| [70](#L70) | \* Action name |
| [71](#L71) | \* |
| [72](#L72) | \* @since 2.0.4 |
| [73](#L73) | \* @var   string |
| [74](#L74) | \*/ |
| [75](#L75) | public $action = ''; |
| [76](#L76) |  |
| [77](#L77) | /\*\* |
| [78](#L78) | \* |
| [79](#L79) | \* @return self |
| [80](#L80) | \*/ |
| [81](#L81) | public static function getInstance() |
| [82](#L82) | { |
| [83](#L83) | if (is\_null(self::$instance)) { |
| [84](#L84) | self::$instance = new self(); |
| [85](#L85) | } |
| [86](#L86) |  |
| [87](#L87) | return self::$instance; |
| [88](#L88) | } |
| [89](#L89) |  |
| [90](#L90) |  |
| [91](#L91) | /\*\* |
| [92](#L92) | \* Get things started |
| [93](#L93) | \* |
| [94](#L94) | \* @since 1.0 |
| [95](#L95) | \*/ |
| [96](#L96) | public function \_\_construct() { |
| [97](#L97) | // nothing to do |
| [98](#L98) | } |
| [99](#L99) |  |
| [100](#L100) | /\*\* |
| [101](#L101) | \* Get the plugin install time |
| [102](#L102) | \* |
| [103](#L103) | \* @return int |
| [104](#L104) | \*/ |
| [105](#L105) | public function getInstallTime() |
| [106](#L106) | { |
| [107](#L107) | $installTime = get\_option('am\_tm\_install\_time', false); |
| [108](#L108) | if (!$installTime) { |
| [109](#L109) | $installTime = time(); |
| [110](#L110) | update\_option('am\_tm\_install\_time', $installTime); |
| [111](#L111) | } |
| [112](#L112) | return $installTime; |
| [113](#L113) | } |
| [114](#L114) |  |
| [115](#L115) |  |
| [116](#L116) | /\*\* |
| [117](#L117) | \* Add all of the hooks |
| [118](#L118) | \* |
| [119](#L119) | \* @since 2.0 |
| [120](#L120) | \*/ |
| [121](#L121) | public function init() { |
| [122](#L122) | add\_action( 'after\_setup\_theme', array( $this, 'text\_domain' ) ); |
| [123](#L123) | add\_action( 'admin\_init',        array( $this, 'set\_vars' ) ); |
| [124](#L124) | add\_action( 'admin\_init',        array( $this, 'process\_actions' ) ); |
| [125](#L125) | add\_action( 'admin\_menu',        array( $this, 'tools\_link' ) ); |
| [126](#L126) | add\_action( 'admin\_notices',     array( $this, 'notices' ) ); |
| [127](#L127) | add\_action( 'admin\_bar\_menu',    array( $this, 'suspend\_transients\_button' ), 99 ); |
| [128](#L128) | add\_filter( 'pre\_update\_option', array( $this, 'maybe\_block\_update\_transient' ), -1, 2 ); |
| [129](#L129) | add\_filter( 'pre\_get\_option',    array( $this, 'maybe\_block\_update\_transient' ), -1, 2 ); |
| [130](#L130) | add\_action( 'added\_option',      array( $this, 'maybe\_block\_set\_transient' ), -1, 1 ); |
| [131](#L131) |  |
| [132](#L132) | // Styles |
| [133](#L133) | add\_action( "admin\_print\_styles-tools\_page\_{$this->page\_id}", array( $this, 'print\_styles' ) ); |
| [134](#L134) |  |
| [135](#L135) | /\*\* |
| [136](#L136) | \* Allow third-party plugins a chance to modify the hooks above |
| [137](#L137) | \* |
| [138](#L138) | \* @since 2.0 |
| [139](#L139) | \* @param object $this |
| [140](#L140) | \*/ |
| [141](#L141) | do\_action( 'transients\_manager\_hooks', $this ); |
| [142](#L142) | } |
| [143](#L143) |  |
| [144](#L144) | /\*\* |
| [145](#L145) | \* Set many of the class variables |
| [146](#L146) | \* |
| [147](#L147) | \* @since 2.0 |
| [148](#L148) | \*/ |
| [149](#L149) | public function set\_vars() { |
| [150](#L150) |  |
| [151](#L151) | // Times |
| [152](#L152) | $this->time\_now         = time(); |
| [153](#L153) | $this->next\_cron\_delete = wp\_next\_scheduled( 'delete\_expired\_transients' ); |
| [154](#L154) |  |
| [155](#L155) | // Sanitize the transient ID |
| [156](#L156) | $this->transient\_id = ! empty( $\_GET['trans\_id'] ) |
| [157](#L157) | ? absint( $\_GET['trans\_id'] ) |
| [158](#L158) | : 0; |
| [159](#L159) |  |
| [160](#L160) | // Get the transient |
| [161](#L161) | $this->transient = ! empty( $this->transient\_id ) |
| [162](#L162) | ? $this->get\_transient\_by\_id( $this->transient\_id ) |
| [163](#L163) | : false; |
| [164](#L164) |  |
| [165](#L165) | // Sanitize the action |
| [166](#L166) | $this->action = ! empty( $\_REQUEST['action'] ) |
| [167](#L167) | ? sanitize\_key( $\_REQUEST['action'] ) |
| [168](#L168) | : ''; |
| [169](#L169) | } |
| [170](#L170) |  |
| [171](#L171) | /\*\* |
| [172](#L172) | \* Load text domain |
| [173](#L173) | \* |
| [174](#L174) | \* @since 1.0 |
| [175](#L175) | \*/ |
| [176](#L176) | public function text\_domain() { |
| [177](#L177) | load\_plugin\_textdomain( 'transients-manager' ); |
| [178](#L178) | } |
| [179](#L179) |  |
| [180](#L180) | /\*\* |
| [181](#L181) | \* Register menu link under Tools |
| [182](#L182) | \* |
| [183](#L183) | \* @since 1.0 |
| [184](#L184) | \*/ |
| [185](#L185) | public function tools\_link() { |
| [186](#L186) |  |
| [187](#L187) | // Set the screen ID |
| [188](#L188) | $this->screen\_id = add\_management\_page( |
| [189](#L189) | esc\_html\_\_( 'Transients Manager', 'transients-manager' ), |
| [190](#L190) | esc\_html\_\_( 'Transients', 'transients-manager' ), |
| [191](#L191) | $this->capability, |
| [192](#L192) | $this->page\_id, |
| [193](#L193) | array( $this, 'admin' ) |
| [194](#L194) | ); |
| [195](#L195) | } |
| [196](#L196) |  |
| [197](#L197) | /\*\* |
| [198](#L198) | \* Editing or showing? |
| [199](#L199) | \* |
| [200](#L200) | \* @since  2.0 |
| [201](#L201) | \* @return string |
| [202](#L202) | \*/ |
| [203](#L203) | protected function page\_type() { |
| [204](#L204) |  |
| [205](#L205) | // Edit or Show? |
| [206](#L206) | return ! empty( $this->action ) && ( 'edit\_transient' === $this->action ) && ! empty( $this->transient ) |
| [207](#L207) | ? 'edit' |
| [208](#L208) | : 'show'; |
| [209](#L209) | } |
| [210](#L210) |  |
| [211](#L211) | /\*\* |
| [212](#L212) | \* Render the admin UI |
| [213](#L213) | \* |
| [214](#L214) | \* @since 1.0 |
| [215](#L215) | \*/ |
| [216](#L216) | public function admin() { |
| [217](#L217) |  |
| [218](#L218) | // Editing a single Transient |
| [219](#L219) | ( 'edit' === $this->page\_type() ) |
| [220](#L220) | ? $this->page\_edit\_transient( $this->transient ) |
| [221](#L221) | : $this->page\_show\_transients(); |
| [222](#L222) | } |
| [223](#L223) |  |
| [224](#L224) | /\*\* |
| [225](#L225) | \* Admin notices |
| [226](#L226) | \* |
| [227](#L227) | \* @since 2.0 |
| [228](#L228) | \*/ |
| [229](#L229) | public function notices() { |
| [230](#L230) |  |
| [231](#L231) | // Get the current screen |
| [232](#L232) | $screen = get\_current\_screen(); |
| [233](#L233) |  |
| [234](#L234) | // Bail if not the correct screen |
| [235](#L235) | if ( $screen->id !== $this->screen\_id ) { |
| [236](#L236) | return; |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | // Persistent Transients |
| [240](#L240) | if ( wp\_using\_ext\_object\_cache() ) : |
| [241](#L241) |  |
| [242](#L242) | ?> |
| [243](#L243) | <div class="notice notice-info"> |
| [244](#L244) | <p><?php esc\_html\_e( 'You are using a persistent object cache. This screen may show incomplete information.', 'transients-manager' ); ?></p> |
| [245](#L245) | </div> |
| [246](#L246) | <?php |
| [247](#L247) |  |
| [248](#L248) | endif; |
| [249](#L249) |  |
| [250](#L250) | // Updated Transient |
| [251](#L251) | if ( ! empty( $\_GET['updated'] ) ) : |
| [252](#L252) |  |
| [253](#L253) | ?> |
| [254](#L254) | <div class="notice notice-success is-dismissible"> |
| [255](#L255) | <p><strong><?php esc\_html\_e( 'Transient updated.', 'transients-manager' ); ?></strong></p> |
| [256](#L256) | </div> |
| [257](#L257) | <?php |
| [258](#L258) |  |
| [259](#L259) | endif; |
| [260](#L260) |  |
| [261](#L261) | // Deleted Transients |
| [262](#L262) | if ( ! empty( $\_GET['deleted'] ) ) : |
| [263](#L263) |  |
| [264](#L264) | ?> |
| [265](#L265) | <div class="notice notice-success is-dismissible"> |
| [266](#L266) | <p><strong><?php esc\_html\_e( 'Transient deleted.', 'transients-manager' ); ?></strong></p> |
| [267](#L267) | </div> |
| [268](#L268) | <?php |
| [269](#L269) |  |
| [270](#L270) | endif; |
| [271](#L271) | } |
| [272](#L272) |  |
| [273](#L273) | /\*\* |
| [274](#L274) | \* Output the page HTML for the Transients mock-list-table |
| [275](#L275) | \* |
| [276](#L276) | \* @since 2.0 |
| [277](#L277) | \*/ |
| [278](#L278) | protected function page\_show\_transients() { |
| [279](#L279) |  |
| [280](#L280) | // Vars |
| [281](#L281) | $search   = ! empty( $\_GET['s'] ) ? sanitize\_text\_field( $\_GET['s'] ) : ''; |
| [282](#L282) | $per\_page = ! empty( $\_GET['per\_page'] ) ? absint( $\_GET['per\_page'] ) : 30; |
| [283](#L283) | $page     = isset( $\_GET['paged'] ) ? absint( $\_GET['paged'] ) : 1; |
| [284](#L284) | $offset   = $per\_page \* ( $page - 1 ); |
| [285](#L285) | $count    = $this->get\_total\_transients( $search ); |
| [286](#L286) | $pages    = ceil( $count / $per\_page ); |
| [287](#L287) | $one\_page = ( 1 === $pages ) ? 'one-page' : ''; |
| [288](#L288) |  |
| [289](#L289) | // Pagination |
| [290](#L290) | $pagination = paginate\_links( array( |
| [291](#L291) | 'base'      => 'tools.php?%\_%', |
| [292](#L292) | 'format'    => '&paged=%#%', |
| [293](#L293) | 'prev\_text' => '&laquo;', |
| [294](#L294) | 'next\_text' => '&raquo;', |
| [295](#L295) | 'total'     => $pages, |
| [296](#L296) | 'current'   => $page |
| [297](#L297) | ) ); |
| [298](#L298) |  |
| [299](#L299) | // Transients |
| [300](#L300) | $transients = $this->get\_transients( array( |
| [301](#L301) | 'search' => $search, |
| [302](#L302) | 'offset' => $offset, |
| [303](#L303) | 'number' => $per\_page |
| [304](#L304) | ) ); |
| [305](#L305) |  |
| [306](#L306) | ?> |
| [307](#L307) |  |
| [308](#L308) | <div class="wrap"> |
| [309](#L309) | <h1 class="wp-heading-inline"><?php esc\_html\_e( 'Transients', 'transients-manager' ); ?></h1> |
| [310](#L310) | <hr class="wp-header-end"> |
| [311](#L311) |  |
| [312](#L312) | <form method="get"> |
| [313](#L313) | <p class="search-box"> |
| [314](#L314) | <label class="screen-reader-text" for="transient-search-input"><?php esc\_html\_e( 'Search', 'transients-manager' ); ?></label> |
| [315](#L315) | <input type="search" id="transient-search-input" name="s" value="<?php echo esc\_attr( $search ); ?>" /> |
| [316](#L316) | <input type="submit" id="search-submit" class="button" value="<?php esc\_attr\_e( 'Search Transients', 'transients-manager' ); ?>" /> |
| [317](#L317) | <input type="hidden" name="page" value="<?php echo esc\_html( $this->page\_id ); ?>" /> |
| [318](#L318) | </p> |
| [319](#L319) | </form> |
| [320](#L320) |  |
| [321](#L321) | <form method="post" id="transients-delete"> |
| [322](#L322) | <input type="hidden" name="transient" value="all" /> |
| [323](#L323) | <?php wp\_nonce\_field( 'transients\_manager' ); ?> |
| [324](#L324) |  |
| [325](#L325) | <div class="tablenav top"> |
| [326](#L326) | <div class="alignleft actions bulkactions"> |
| [327](#L327) | <label for="bulk-action-selector-top" class="screen-reader-text"><?php esc\_html\_e( 'Select Bulk action', 'transients-manager' ); ?></label> |
| [328](#L328) | <select name="action" id="bulk-action-selector-top"> |
| [329](#L329) | <option value="-1"><?php esc\_html\_e( 'Bulk actions', 'transients-manager' ); ?></option> |
| [330](#L330) |  |
| [331](#L331) | <optgroup label="<?php esc\_attr\_e( 'Selection', 'transients-manager' ); ?>"> |
| [332](#L332) | <option value="delete\_selected\_transients"><?php esc\_html\_e( 'Delete Selected', 'transients-manager' ); ?></option> |
| [333](#L333) | </optgroup> |
| [334](#L334) |  |
| [335](#L335) | <optgroup label="<?php esc\_attr\_e( 'Expiration', 'transients-manager' ); ?>"> |
| [336](#L336) | <option value="delete\_expired\_transients"><?php esc\_html\_e( 'Delete Expired', 'transients-manager' ); ?></option> |
| [337](#L337) | <option value="delete\_transients\_with\_expiration"><?php esc\_html\_e( 'Delete With Expiration', 'transients-manager' ); ?></option> |
| [338](#L338) | <option value="delete\_transients\_without\_expiration"><?php esc\_html\_e( 'Delete Without Expiration', 'transients-manager' ); ?></option> |
| [339](#L339) | </optgroup> |
| [340](#L340) |  |
| [341](#L341) | <optgroup label="<?php esc\_attr\_e( 'Reset', 'transients-manager' ); ?>"> |
| [342](#L342) | <option value="delete\_all\_transients"><?php esc\_html\_e( 'Delete All', 'transients-manager' ); ?></option> |
| [343](#L343) | </optgroup> |
| [344](#L344) | </select> |
| [345](#L345) | <input type="submit" class="button secondary" value="<?php esc\_attr\_e( 'Apply', 'transients-manager' ); ?>" /> |
| [346](#L346) | </div> |
| [347](#L347) |  |
| [348](#L348) | <div class="alignleft actions"> |
| [349](#L349) | <input type="button" class="button secondary" value="<?php esc\_attr\_e( 'Delete All', 'transients-manager' ); ?>" onclick="const select = document.getElementById('bulk-action-selector-top'); select.value='delete\_all\_transients'; select.dispatchEvent(new Event('change')); document.getElementById('transients-delete').submit();" /> |
| [350](#L350) | </div> |
| [351](#L351) |  |
| [352](#L352) | <div class="tablenav-pages <?php echo esc\_attr( $one\_page ); ?>"> |
| [353](#L353) | <span class="displaying-num"><?php printf( \_n( '%s Transient', '%s Transients', $count, 'transients-manager' ), number\_format\_i18n( $count ) ); ?></span> |
| [354](#L354) | <span class="pagination-links"><?php echo $pagination; // HTML OK  ?></span> |
| [355](#L355) | </div> |
| [356](#L356) | </div> |
| [357](#L357) |  |
| [358](#L358) | <table class="wp-list-table widefat fixed transients striped"> |
| [359](#L359) | <thead> |
| [360](#L360) | <tr> |
| [361](#L361) | <td id="cb" class="manage-column column-cb check-column"> |
| [362](#L362) | <label for="cb-select-all-<?php echo (int) $page; ?>" class="screen-reader-text"><?php esc\_html\_e( 'Select All', 'transients-manager' ); ?></label> |
| [363](#L363) | <input type="checkbox" id="cb-select-all-<?php echo (int) $page; ?>"> |
| [364](#L364) | </td> |
| [365](#L365) | <th class="column-primary"><?php esc\_html\_e( 'Name', 'transients-manager' ); ?></th> |
| [366](#L366) | <th class="column-value"><?php esc\_html\_e( 'Value', 'transients-manager' ); ?></th> |
| [367](#L367) | <th class="column-expiration"><?php esc\_html\_e( 'Expiration', 'transients-manager' ); ?></th> |
| [368](#L368) | </tr> |
| [369](#L369) | </thead> |
| [370](#L370) | <tbody> |
| [371](#L371) | <?php if ( ! empty( $transients ) ) : |
| [372](#L372) |  |
| [373](#L373) | foreach ( $transients as $transient ) : |
| [374](#L374) |  |
| [375](#L375) | // Get Transient name |
| [376](#L376) | $name       = $this->get\_transient\_name( $transient ); |
| [377](#L377) | $value      = $this->get\_transient\_value( $transient ); |
| [378](#L378) | $expiration = $this->get\_transient\_expiration( $transient ); |
| [379](#L379) |  |
| [380](#L380) | // Delete |
| [381](#L381) | $delete\_url = wp\_nonce\_url( |
| [382](#L382) | remove\_query\_arg( |
| [383](#L383) | array( 'deleted', 'updated' ), |
| [384](#L384) | add\_query\_arg( |
| [385](#L385) | array( |
| [386](#L386) | 'action'    => 'delete\_transient', |
| [387](#L387) | 'transient' => $name, |
| [388](#L388) | 'name'      => $transient->option\_name |
| [389](#L389) | ) |
| [390](#L390) | ) |
| [391](#L391) | ), |
| [392](#L392) | 'transients\_manager' |
| [393](#L393) | ); |
| [394](#L394) |  |
| [395](#L395) | // Edit |
| [396](#L396) | $edit\_url = remove\_query\_arg( |
| [397](#L397) | array( 'updated', 'deleted' ), |
| [398](#L398) | add\_query\_arg( |
| [399](#L399) | array( |
| [400](#L400) | 'action'   => 'edit\_transient', |
| [401](#L401) | 'trans\_id' => $transient->option\_id |
| [402](#L402) | ) |
| [403](#L403) | ) |
| [404](#L404) | ); ?> |
| [405](#L405) |  |
| [406](#L406) | <tr> |
| [407](#L407) | <th id="cb" class="manage-column column-cb check-column"> |
| [408](#L408) | <label for="cb-select-<?php echo (int) $page; ?>" class="screen-reader-text"><?php printf( esc\_attr\_\_( 'Select %s', 'transients-manager' ), esc\_html( $name ) ); ?></label> |
| [409](#L409) | <input type="checkbox" id="cb-select-<?php echo (int) $transient->option\_id; ?>" name="transients[]" value="<?php echo (int) $transient->option\_id; ?>"> |
| [410](#L410) | </th> |
| [411](#L411) |  |
| [412](#L412) | <td class="column-primary" data-colname="<?php esc\_attr\_e( 'Name', 'transients-manager' ); ?>"> |
| [413](#L413) | <pre class="truncate"> |
| [414](#L414) | <code class="transient-name" title="<?php printf( esc\_attr\_\_( 'Option ID: %d', 'transients-manager' ), (int) $transient->option\_id ); ?>"><?php echo esc\_html( $name ); ?></code> |
| [415](#L415) | </pre> |
| [416](#L416) |  |
| [417](#L417) | <div class="row-actions"> |
| [418](#L418) | <span class="edit"><a href="<?php echo esc\_url( $edit\_url ); ?>" class="edit"><?php esc\_html\_e( 'Edit', 'transients-manager' ); ?></a></span> |
| [419](#L419) | | |
| [420](#L420) | <span class="delete"><a href="<?php echo esc\_url( $delete\_url ); ?>" class="delete"><?php esc\_html\_e( 'Delete', 'transients-manager' ); ?></a></span> |
| [421](#L421) | </div> |
| [422](#L422) |  |
| [423](#L423) | <button type="button" class="toggle-row"> |
| [424](#L424) | <span class="screen-reader-text"><?php esc\_html\_e( 'Show more details', 'transients-manager' ); ?></span> |
| [425](#L425) | </button> |
| [426](#L426) | </td> |
| [427](#L427) |  |
| [428](#L428) | <td data-colname="<?php esc\_attr\_e( 'Value', 'transients-manager' ); ?>"> |
| [429](#L429) | <span class="transient-value truncate"><?php |
| [430](#L430) | echo $value; // HTML OK |
| [431](#L431) | ?></span> |
| [432](#L432) | </td> |
| [433](#L433) |  |
| [434](#L434) | <td data-colname="<?php esc\_attr\_e( 'Expiration', 'transients-manager' ); ?>"> |
| [435](#L435) | <span class="transient-expiration"><?php |
| [436](#L436) | echo $expiration; // HTML OK |
| [437](#L437) | ?></span> |
| [438](#L438) | </td> |
| [439](#L439) | </tr> |
| [440](#L440) |  |
| [441](#L441) | <?php endforeach; |
| [442](#L442) |  |
| [443](#L443) | else : ?> |
| [444](#L444) |  |
| [445](#L445) | <tr><td colspan="4"><?php esc\_html\_e( 'No transients found.', 'transients-manager' ); ?></td> |
| [446](#L446) |  |
| [447](#L447) | <?php endif; ?> |
| [448](#L448) | </tbody> |
| [449](#L449) | <tfoot> |
| [450](#L450) | <tr> |
| [451](#L451) | <td class="manage-column column-cb check-column"> |
| [452](#L452) | <label for="cb-select-all-<?php echo (int) $page; ?>" class="screen-reader-text"><?php esc\_html\_e( 'Select All', 'transients-manager' ); ?></label> |
| [453](#L453) | <input type="checkbox" id="cb-select-all-<?php echo (int) $page; ?>"> |
| [454](#L454) | </td> |
| [455](#L455) | <th class="column-primary"><?php esc\_html\_e( 'Name', 'transients-manager' ); ?></th> |
| [456](#L456) | <th><?php esc\_html\_e( 'Value', 'transients-manager' ); ?></th> |
| [457](#L457) | <th><?php esc\_html\_e( 'Expiration', 'transients-manager' ); ?></th> |
| [458](#L458) | </tr> |
| [459](#L459) | </tfoot> |
| [460](#L460) | </table> |
| [461](#L461) |  |
| [462](#L462) | <div class="tablenav bottom"> |
| [463](#L463) | <div class="alignleft actions bulkactions"> |
| [464](#L464) | <label for="bulk-action-selector-top" class="screen-reader-text"><?php esc\_html\_e( 'Select Bulk action', 'transients-manager' ); ?></label> |
| [465](#L465) | <select name="action" id="bulk-action-selector-bottom"> |
| [466](#L466) | <option value="-1"><?php esc\_html\_e( 'Bulk actions', 'transients-manager' ); ?></option> |
| [467](#L467) |  |
| [468](#L468) | <optgroup label="<?php esc\_attr\_e( 'Selection', 'transients-manager' ); ?>"> |
| [469](#L469) | <option value="delete\_selected\_transients"><?php esc\_html\_e( 'Delete Selected', 'transients-manager' ); ?></option> |
| [470](#L470) | </optgroup> |
| [471](#L471) |  |
| [472](#L472) | <optgroup label="<?php esc\_attr\_e( 'Expiration', 'transients-manager' ); ?>"> |
| [473](#L473) | <option value="delete\_expired\_transients"><?php esc\_html\_e( 'Delete Expired', 'transients-manager' ); ?></option> |
| [474](#L474) | <option value="delete\_transients\_with\_expiration"><?php esc\_html\_e( 'Delete With Expiration', 'transients-manager' ); ?></option> |
| [475](#L475) | <option value="delete\_transients\_without\_expiration"><?php esc\_html\_e( 'Delete Without Expiration', 'transients-manager' ); ?></option> |
| [476](#L476) | </optgroup> |
| [477](#L477) |  |
| [478](#L478) | <optgroup label="<?php esc\_attr\_e( 'Reset', 'transients-manager' ); ?>"> |
| [479](#L479) | <option value="delete\_all\_transients"><?php esc\_html\_e( 'Delete All', 'transients-manager' ); ?></option> |
| [480](#L480) | </optgroup> |
| [481](#L481) | </select> |
| [482](#L482) | <input type="submit" class="button secondary" value="<?php esc\_attr\_e( 'Apply', 'transients-manager' ); ?>" /> |
| [483](#L483) | </div> |
| [484](#L484) |  |
| [485](#L485) | <div class="tablenav-pages <?php echo esc\_attr( $one\_page ); ?>"> |
| [486](#L486) | <span class="displaying-num"><?php printf( \_n( '%s Transient', '%s Transients', $count, 'transients-manager' ), number\_format\_i18n( $count ) ); ?></span> |
| [487](#L487) | <span class="pagination-links"><?php echo $pagination; // HTML OK ?></span> |
| [488](#L488) | </div> |
| [489](#L489) | </div> |
| [490](#L490) | </form> |
| [491](#L491) |  |
| [492](#L492) | <?php $this->site\_time(); ?> |
| [493](#L493) | </div> |
| [494](#L494) |  |
| [495](#L495) | <?php |
| [496](#L496) | } |
| [497](#L497) |  |
| [498](#L498) | /\*\* |
| [499](#L499) | \* Output the page HTML for editing a Transient |
| [500](#L500) | \* |
| [501](#L501) | \* @since 2.0 |
| [502](#L502) | \* @param object $transient |
| [503](#L503) | \*/ |
| [504](#L504) | protected function page\_edit\_transient( $transient = false) { |
| [505](#L505) |  |
| [506](#L506) | // Get values |
| [507](#L507) | $name       = $this->get\_transient\_name( $transient ); |
| [508](#L508) | $expiration = $this->get\_transient\_expiration\_time( $transient ); |
| [509](#L509) | ?> |
| [510](#L510) |  |
| [511](#L511) | <div class="wrap"> |
| [512](#L512) | <h1 class="wp-heading-inline"><?php esc\_html\_e( 'Edit Transient', 'transients-manager' ); ?></h1> |
| [513](#L513) | <hr class="wp-header-end"> |
| [514](#L514) |  |
| [515](#L515) | <form method="post"> |
| [516](#L516) | <input type="hidden" name="transient" value="<?php echo esc\_attr( $name ); ?>" /> |
| [517](#L517) | <input type="hidden" name="action" value="update\_transient" /> |
| [518](#L518) | <?php wp\_nonce\_field( 'transients\_manager' ); ?> |
| [519](#L519) |  |
| [520](#L520) | <table class="form-table"> |
| [521](#L521) | <tbody> |
| [522](#L522) | <tr> |
| [523](#L523) | <th><?php esc\_html\_e( 'Option ID', 'transients-manager' ); ?></th> |
| [524](#L524) | <td><input type="text" disabled class="large-text code" name="name" value="<?php echo esc\_attr( $transient->option\_id ); ?>" /></td> |
| [525](#L525) | </tr> |
| [526](#L526) | <tr> |
| [527](#L527) | <th><?php esc\_html\_e( 'Name', 'transients-manager' ); ?></th> |
| [528](#L528) | <td><input type="text" class="large-text code" name="name" value="<?php echo esc\_attr( $transient->option\_name ); ?>" /></td> |
| [529](#L529) | </tr> |
| [530](#L530) | <tr> |
| [531](#L531) | <th><?php esc\_html\_e( 'Expiration', 'transients-manager' ); ?></th> |
| [532](#L532) | <td><input type="text" class="large-text" name="expires" value="<?php echo esc\_attr( $expiration ); ?>" /> |
| [533](#L533) | </tr> |
| [534](#L534) | <tr> |
| [535](#L535) | <th><?php esc\_html\_e( 'Value', 'transients-manager' ); ?></th> |
| [536](#L536) | <td> |
| [537](#L537) | <textarea class="large-text code" name="value" id="transient-editor" style="height: 302px; padding-left: 35px;"><?php |
| [538](#L538) | echo esc\_textarea( $transient->option\_value ); |
| [539](#L539) | ?></textarea> |
| [540](#L540) | </td> |
| [541](#L541) | </tr> |
| [542](#L542) | </tbody> |
| [543](#L543) | </table> |
| [544](#L544) |  |
| [545](#L545) | <p class="submit"> |
| [546](#L546) | <?php submit\_button( '', 'primary', '', false ); ?> |
| [547](#L547) | </p> |
| [548](#L548) | </form> |
| [549](#L549) | </div> |
| [550](#L550) |  |
| [551](#L551) | <?php |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | /\*\* |
| [555](#L555) | \* Output the time for the site |
| [556](#L556) | \* |
| [557](#L557) | \* (Props to WP Crontrol for this approach) |
| [558](#L558) | \* |
| [559](#L559) | \* @since 2.0 |
| [560](#L560) | \*/ |
| [561](#L561) | public function site\_time() { |
| [562](#L562) |  |
| [563](#L563) | // Get options |
| [564](#L564) | $timezone\_string = get\_option( 'timezone\_string', '' ); |
| [565](#L565) | $gmt\_offset      = get\_option( 'gmt\_offset', 0 ); |
| [566](#L566) | $timezone\_name   = 'UTC'; |
| [567](#L567) |  |
| [568](#L568) | // UTC |
| [569](#L569) | if ( ( 'UTC' !== $timezone\_string ) || ! empty( $gmt\_offset ) ) { |
| [570](#L570) |  |
| [571](#L571) | $formatted\_offset = ( 0 <= $gmt\_offset ) |
| [572](#L572) | ? '+' . (string) $gmt\_offset |
| [573](#L573) | : (string) $gmt\_offset; |
| [574](#L574) |  |
| [575](#L575) | $formatted\_offset = str\_replace( |
| [576](#L576) | array( '.25', '.5',  '.75' ), |
| [577](#L577) | array( ':15', ':30', ':45' ), |
| [578](#L578) | $formatted\_offset |
| [579](#L579) | ); |
| [580](#L580) | } |
| [581](#L581) |  |
| [582](#L582) | // Format the timezone name |
| [583](#L583) | $timezone\_name = ! empty( $formatted\_offset ) |
| [584](#L584) | ? 'UTC' . $formatted\_offset |
| [585](#L585) | : str\_replace( '\_', ' ', $timezone\_string ); |
| [586](#L586) |  |
| [587](#L587) | // Site time |
| [588](#L588) | $site\_time     = date\_i18n( 'Y-m-d H:i:s', $this->time\_now ); |
| [589](#L589) | $site\_time\_utc = gmdate( 'Y-m-d\TH:i:s+00:00', $this->time\_now ); |
| [590](#L590) | $st\_html       = esc\_html( sprintf( |
| [591](#L591) | /\* translators: 1: Date and time, 2: Timezone \*/ |
| [592](#L592) | \_\_( 'Site time: %1$s (%2$s)', 'transients-manager' ), |
| [593](#L593) | $site\_time, |
| [594](#L594) | $timezone\_name |
| [595](#L595) | ) ); |
| [596](#L596) |  |
| [597](#L597) | // Cron time |
| [598](#L598) | $cron\_time     = wp\_date( 'Y-m-d H:i:s', $this->next\_cron\_delete ); |
| [599](#L599) | $cron\_time\_utc = gmdate( 'Y-m-d\TH:i:s+00:00', $this->next\_cron\_delete ); |
| [600](#L600) | $ct\_time\_since = $this->time\_since( $this->next\_cron\_delete - $this->time\_now ); |
| [601](#L601) | $nc\_time       = esc\_html( sprintf( |
| [602](#L602) | /\* translators: 1: Date and time, 2: Timezone, 3: Time since \*/ |
| [603](#L603) | \_\_( 'Expired transients scheduled for deletion on: %1$s (%2$s) – %3$s from now', 'transients-manager' ), |
| [604](#L604) | $cron\_time, |
| [605](#L605) | $timezone\_name, |
| [606](#L606) | $ct\_time\_since |
| [607](#L607) | ) ); |
| [608](#L608) | ?> |
| [609](#L609) |  |
| [610](#L610) | <p class="transients-manager-helpful-times"> |
| [611](#L611) | <?php |
| [612](#L612) |  |
| [613](#L613) | echo sprintf( '<time datetime="%1$s" title="%1$s">%2$s</time>', |
| [614](#L614) | $site\_time\_utc, |
| [615](#L615) | $st\_html |
| [616](#L616) | ); |
| [617](#L617) |  |
| [618](#L618) | ?><br><br><?php |
| [619](#L619) |  |
| [620](#L620) | echo sprintf( '<time datetime="%1$s" title="%1$s">%2$s</time>', |
| [621](#L621) | $cron\_time\_utc, |
| [622](#L622) | $nc\_time |
| [623](#L623) | ); |
| [624](#L624) |  |
| [625](#L625) | ?></p> |
| [626](#L626) |  |
| [627](#L627) | <?php |
| [628](#L628) | } |
| [629](#L629) |  |
| [630](#L630) | /\*\* |
| [631](#L631) | \* Add toolbar node for suspending transients |
| [632](#L632) | \* |
| [633](#L633) | \* @since 1.6 |
| [634](#L634) | \* @param object $wp\_admin\_bar |
| [635](#L635) | \*/ |
| [636](#L636) | public function suspend\_transients\_button( $wp\_admin\_bar ) { |
| [637](#L637) |  |
| [638](#L638) | // Bail if user is not capable |
| [639](#L639) | if ( ! current\_user\_can( $this->capability ) ) { |
| [640](#L640) | return; |
| [641](#L641) | } |
| [642](#L642) |  |
| [643](#L643) | // Suspended |
| [644](#L644) | if ( get\_option( 'pw\_tm\_suspend' ) ) { |
| [645](#L645) | $action = 'unsuspend\_transients'; |
| [646](#L646) | $label  = '<span style="color: #b32d2e;">' . esc\_html\_\_( 'Unsuspend Transients', 'transients-manager' ) . '</span>'; |
| [647](#L647) |  |
| [648](#L648) | // Not suspended |
| [649](#L649) | } else { |
| [650](#L650) | $action = 'suspend\_transients'; |
| [651](#L651) | $label  = esc\_html\_\_( 'Suspend Transients', 'transients-manager' ); |
| [652](#L652) | } |
| [653](#L653) |  |
| [654](#L654) | // Suspend |
| [655](#L655) | $wp\_admin\_bar->add\_node( array( |
| [656](#L656) | 'id'     => 'tm-suspend', |
| [657](#L657) | 'title'  => $label, |
| [658](#L658) | 'parent' => 'top-secondary', |
| [659](#L659) | 'href'   => wp\_nonce\_url( |
| [660](#L660) | add\_query\_arg( |
| [661](#L661) | array( |
| [662](#L662) | 'action' => $action |
| [663](#L663) | ) |
| [664](#L664) | ), |
| [665](#L665) | 'transients\_manager' |
| [666](#L666) | ) |
| [667](#L667) | ) ); |
| [668](#L668) |  |
| [669](#L669) | // View |
| [670](#L670) | $wp\_admin\_bar->add\_node( array( |
| [671](#L671) | 'id'     => 'tm-view', |
| [672](#L672) | 'title'  => esc\_html\_\_( 'View Transients', 'transients-manager' ), |
| [673](#L673) | 'parent' => 'tm-suspend', |
| [674](#L674) | 'href'   => add\_query\_arg( |
| [675](#L675) | array( |
| [676](#L676) | 'page' => $this->page\_id |
| [677](#L677) | ), |
| [678](#L678) | admin\_url( 'tools.php' ) |
| [679](#L679) | ) |
| [680](#L680) | ) ); |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) | /\*\* |
| [684](#L684) | \* Get transients from the database |
| [685](#L685) | \* |
| [686](#L686) | \* These queries are uncached, to prevent race conditions with persistent |
| [687](#L687) | \* object cache setups and the way Transients use them. |
| [688](#L688) | \* |
| [689](#L689) | \* @since  1.0 |
| [690](#L690) | \* @param  array $args |
| [691](#L691) | \* @return array |
| [692](#L692) | \*/ |
| [693](#L693) | private function get\_transients( $args = array() ) { |
| [694](#L694) | global $wpdb; |
| [695](#L695) |  |
| [696](#L696) | // Parse arguments |
| [697](#L697) | $r = $this->parse\_args( $args ); |
| [698](#L698) |  |
| [699](#L699) | // Escape some LIKE parts |
| [700](#L700) | $esc\_name = '%' . $wpdb->esc\_like( '\_transient\_'         ) . '%'; |
| [701](#L701) | $esc\_time = '%' . $wpdb->esc\_like( '\_transient\_timeout\_' ) . '%'; |
| [702](#L702) |  |
| [703](#L703) | // SELECT |
| [704](#L704) | $sql = array( 'SELECT' ); |
| [705](#L705) |  |
| [706](#L706) | // COUNT |
| [707](#L707) | if ( ! empty( $r['count'] ) ) { |
| [708](#L708) | $sql[] = 'count(option\_id)'; |
| [709](#L709) | } else { |
| [710](#L710) | $sql[] = '\*'; |
| [711](#L711) | } |
| [712](#L712) |  |
| [713](#L713) | // FROM |
| [714](#L714) | $sql[] = "FROM {$wpdb->options} WHERE option\_name LIKE %s AND option\_name NOT LIKE %s"; |
| [715](#L715) |  |
| [716](#L716) | // Search |
| [717](#L717) | if ( ! empty( $r['search'] ) ) { |
| [718](#L718) | $search = '%' . $wpdb->esc\_like( $r['search'] ) . '%'; |
| [719](#L719) | $sql[]  = $wpdb->prepare( "AND option\_name LIKE %s", $search ); |
| [720](#L720) | } |
| [721](#L721) |  |
| [722](#L722) | // Limits |
| [723](#L723) | if ( empty( $r['count'] ) ) { |
| [724](#L724) | $offset = absint( $r['offset'] ); |
| [725](#L725) | $number = absint( $r['number'] ); |
| [726](#L726) | $sql[]  = $wpdb->prepare( "ORDER BY option\_id DESC LIMIT %d, %d", $offset, $number ); |
| [727](#L727) | } |
| [728](#L728) |  |
| [729](#L729) | // Combine the SQL parts |
| [730](#L730) | $query = implode( ' ', $sql ); |
| [731](#L731) |  |
| [732](#L732) | // Prepare |
| [733](#L733) | $prepared = $wpdb->prepare( $query, $esc\_name, $esc\_time ); |
| [734](#L734) |  |
| [735](#L735) | // Query |
| [736](#L736) | $transients = empty( $r['count'] ) |
| [737](#L737) | ? $wpdb->get\_results( $prepared ) // Rows |
| [738](#L738) | : $wpdb->get\_var( $prepared );    // Count |
| [739](#L739) |  |
| [740](#L740) | // Return transients |
| [741](#L741) | return $transients; |
| [742](#L742) | } |
| [743](#L743) |  |
| [744](#L744) | /\*\* |
| [745](#L745) | \* Parse the query arguments |
| [746](#L746) | \* |
| [747](#L747) | \* @since  2.0 |
| [748](#L748) | \* @param  array $args |
| [749](#L749) | \* @return array |
| [750](#L750) | \*/ |
| [751](#L751) | private function parse\_args( $args = array() ) { |
| [752](#L752) |  |
| [753](#L753) | // Parse |
| [754](#L754) | $r = wp\_parse\_args( $args, array( |
| [755](#L755) | 'offset' => 0, |
| [756](#L756) | 'number' => 30, |
| [757](#L757) | 'search' => '', |
| [758](#L758) | 'count'  => false |
| [759](#L759) | ) ); |
| [760](#L760) |  |
| [761](#L761) | // Return |
| [762](#L762) | return $r; |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | /\*\* |
| [766](#L766) | \* Retrieve the total number transients in the database |
| [767](#L767) | \* |
| [768](#L768) | \* If a search is performed, it returns the number of found results |
| [769](#L769) | \* |
| [770](#L770) | \* @since  1.0 |
| [771](#L771) | \* @param  string $search |
| [772](#L772) | \* @return int |
| [773](#L773) | \*/ |
| [774](#L774) | private function get\_total\_transients( $search = '' ) { |
| [775](#L775) |  |
| [776](#L776) | // Query |
| [777](#L777) | $count = $this->get\_transients( array( |
| [778](#L778) | 'count'  => true, |
| [779](#L779) | 'search' => $search |
| [780](#L780) | ) ); |
| [781](#L781) |  |
| [782](#L782) | // Return int |
| [783](#L783) | return absint( $count ); |
| [784](#L784) | } |
| [785](#L785) |  |
| [786](#L786) | /\*\* |
| [787](#L787) | \* Retrieve a transient by its ID |
| [788](#L788) | \* |
| [789](#L789) | \* @since  1.0 |
| [790](#L790) | \* @param  int $id |
| [791](#L791) | \* @return object |
| [792](#L792) | \*/ |
| [793](#L793) | private function get\_transient\_by\_id( $id = 0 ) { |
| [794](#L794) | global $wpdb; |
| [795](#L795) |  |
| [796](#L796) | $id = absint( $id ); |
| [797](#L797) |  |
| [798](#L798) | // Bail if empty ID |
| [799](#L799) | if ( empty( $id ) ) { |
| [800](#L800) | return false; |
| [801](#L801) | } |
| [802](#L802) |  |
| [803](#L803) | // Prepare |
| [804](#L804) | $prepared = $wpdb->prepare( "SELECT \* FROM {$wpdb->options} WHERE option\_id = %d", $id ); |
| [805](#L805) |  |
| [806](#L806) | // Query |
| [807](#L807) | return $wpdb->get\_row( $prepared ); |
| [808](#L808) | } |
| [809](#L809) |  |
| [810](#L810) | /\*\* |
| [811](#L811) | \* Is a transient name site-wide? |
| [812](#L812) | \* |
| [813](#L813) | \* @since  2.0 |
| [814](#L814) | \* @param  string $transient\_name |
| [815](#L815) | \* @return boolean |
| [816](#L816) | \*/ |
| [817](#L817) | private function is\_site\_wide( $transient\_name = '' ) { |
| [818](#L818) | return ( false !== strpos( $transient\_name, '\_site\_transient' ) ); |
| [819](#L819) | } |
| [820](#L820) |  |
| [821](#L821) | /\*\* |
| [822](#L822) | \* Retrieve the transient name from the transient object |
| [823](#L823) | \* |
| [824](#L824) | \* @since  1.0 |
| [825](#L825) | \* @return string |
| [826](#L826) | \*/ |
| [827](#L827) | private function get\_transient\_name( $transient = false ) { |
| [828](#L828) |  |
| [829](#L829) | // Bail if no Transient |
| [830](#L830) | if ( empty( $transient ) ) { |
| [831](#L831) | return ''; |
| [832](#L832) | } |
| [833](#L833) |  |
| [834](#L834) | // Position |
| [835](#L835) | $pos = $this->is\_site\_wide( $transient->option\_name ) |
| [836](#L836) | ? 16 |
| [837](#L837) | : 11; |
| [838](#L838) |  |
| [839](#L839) | return substr( $transient->option\_name, $pos, strlen( $transient->option\_name ) ); |
| [840](#L840) | } |
| [841](#L841) |  |
| [842](#L842) | /\*\* |
| [843](#L843) | \* Retrieve the human-friendly transient value from the transient object |
| [844](#L844) | \* |
| [845](#L845) | \* @since  1.0 |
| [846](#L846) | \* @param  object $transient |
| [847](#L847) | \* @return string/int |
| [848](#L848) | \*/ |
| [849](#L849) | private function get\_transient\_value( $transient ) { |
| [850](#L850) |  |
| [851](#L851) | // Get the value type |
| [852](#L852) | $type = $this->get\_transient\_value\_type( $transient ); |
| [853](#L853) |  |
| [854](#L854) | // Trim value to 100 chars |
| [855](#L855) | $value = substr( $transient->option\_value, 0, 100 ); |
| [856](#L856) |  |
| [857](#L857) | // Escape & wrap in <code> tag |
| [858](#L858) | $value = '<code>' . esc\_html( $value ) . '</code>'; |
| [859](#L859) |  |
| [860](#L860) | // Return |
| [861](#L861) | return $value . '<br><span class="transient-type badge">' . esc\_html( $type ) . '</span>'; |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) | /\*\* |
| [865](#L865) | \* Try to guess the type of value the Transient is |
| [866](#L866) | \* |
| [867](#L867) | \* @since  2.0 |
| [868](#L868) | \* @param  object $transient |
| [869](#L869) | \* @return string |
| [870](#L870) | \*/ |
| [871](#L871) | private function get\_transient\_value\_type( $transient ) { |
| [872](#L872) |  |
| [873](#L873) | // Default type |
| [874](#L874) | $type = esc\_html\_\_( 'unknown', 'transients-manager' ); |
| [875](#L875) |  |
| [876](#L876) | // Try to unserialize |
| [877](#L877) | $value = maybe\_unserialize( $transient->option\_value ); |
| [878](#L878) |  |
| [879](#L879) | // Array |
| [880](#L880) | if ( is\_array( $value ) ) { |
| [881](#L881) | $type = esc\_html\_\_( 'array', 'transients-manager' ); |
| [882](#L882) |  |
| [883](#L883) | // Object |
| [884](#L884) | } elseif ( is\_object( $value ) ) { |
| [885](#L885) | $type = esc\_html\_\_( 'object', 'transients-manager' ); |
| [886](#L886) |  |
| [887](#L887) | // Serialized array |
| [888](#L888) | } elseif ( is\_serialized( $value ) ) { |
| [889](#L889) | $type = esc\_html\_\_( 'serialized', 'transients-manager' ); |
| [890](#L890) |  |
| [891](#L891) | // HTML |
| [892](#L892) | } elseif ( strip\_tags( $value ) !== $value ) { |
| [893](#L893) | $type = esc\_html\_\_( 'html', 'transients-manager' ); |
| [894](#L894) |  |
| [895](#L895) | // Scalar |
| [896](#L896) | } elseif ( is\_scalar( $value ) ) { |
| [897](#L897) |  |
| [898](#L898) | if ( is\_numeric( $value ) ) { |
| [899](#L899) |  |
| [900](#L900) | // Likely a timestamp |
| [901](#L901) | if ( 10 === strlen( $value ) ) { |
| [902](#L902) | $type = esc\_html\_\_( 'timestamp?', 'transients-manager' ); |
| [903](#L903) |  |
| [904](#L904) | // Likely a boolean |
| [905](#L905) | } elseif ( in\_array( $value, array( '0', '1' ), true ) ) { |
| [906](#L906) | $type = esc\_html\_\_( 'boolean?', 'transients-manager' ); |
| [907](#L907) |  |
| [908](#L908) | // Any number |
| [909](#L909) | } else { |
| [910](#L910) | $type = esc\_html\_\_( 'numeric', 'transients-manager' ); |
| [911](#L911) | } |
| [912](#L912) |  |
| [913](#L913) | // JSON |
| [914](#L914) | } elseif ( is\_string( $value ) && is\_object( json\_decode( $value ) ) ) { |
| [915](#L915) | $type = esc\_html\_\_( 'json', 'transients-manager' ); |
| [916](#L916) |  |
| [917](#L917) | // Scalar |
| [918](#L918) | } else { |
| [919](#L919) | $type = esc\_html\_\_( 'scalar', 'transients-manager' ); |
| [920](#L920) | } |
| [921](#L921) |  |
| [922](#L922) | // Empty |
| [923](#L923) | } elseif ( empty( $value ) ) { |
| [924](#L924) | $type = esc\_html\_\_( 'empty', 'transients-manager' ); |
| [925](#L925) | } |
| [926](#L926) |  |
| [927](#L927) | // Return type |
| [928](#L928) | return $type; |
| [929](#L929) | } |
| [930](#L930) |  |
| [931](#L931) | /\*\* |
| [932](#L932) | \* Retrieve the expiration timestamp |
| [933](#L933) | \* |
| [934](#L934) | \* @since  1.0 |
| [935](#L935) | \* @param  object $transient |
| [936](#L936) | \* @return int |
| [937](#L937) | \*/ |
| [938](#L938) | private function get\_transient\_expiration\_time( $transient ) { |
| [939](#L939) |  |
| [940](#L940) | // Get the same to use in the option key |
| [941](#L941) | $name = $this->get\_transient\_name( $transient ); |
| [942](#L942) |  |
| [943](#L943) | // Get the value of the timeout |
| [944](#L944) | $time = $this->is\_site\_wide( $transient->option\_name ) |
| [945](#L945) | ? get\_option( "\_site\_transient\_timeout\_{$name}" ) |
| [946](#L946) | : get\_option( "\_transient\_timeout\_{$name}" ); |
| [947](#L947) |  |
| [948](#L948) | // Return the value |
| [949](#L949) | return $time; |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | /\*\* |
| [953](#L953) | \* Retrieve the human-friendly expiration time |
| [954](#L954) | \* |
| [955](#L955) | \* @since  1.0 |
| [956](#L956) | \* @param  object $transient |
| [957](#L957) | \* @return string |
| [958](#L958) | \*/ |
| [959](#L959) | private function get\_transient\_expiration( $transient ) { |
| [960](#L960) |  |
| [961](#L961) | $expiration = $this->get\_transient\_expiration\_time( $transient ); |
| [962](#L962) |  |
| [963](#L963) | // Bail if no expiration |
| [964](#L964) | if ( empty( $expiration ) ) { |
| [965](#L965) | return '&mdash;<br><span class="badge">' . esc\_html\_\_( 'Persistent', 'transients-manager' ) . '</span>'; |
| [966](#L966) | } |
| [967](#L967) |  |
| [968](#L968) | // UTC & local dates |
| [969](#L969) | $date\_utc   = gmdate( 'Y-m-d\TH:i:s+00:00', $expiration ); |
| [970](#L970) | $date\_local = get\_date\_from\_gmt( date( 'Y-m-d H:i:s', $expiration ), 'Y-m-d H:i:s' ); |
| [971](#L971) |  |
| [972](#L972) | // Create <time> tag |
| [973](#L973) | $time = sprintf( |
| [974](#L974) | '<time datetime="%1$s" title="%1$s">%2$s</time>', |
| [975](#L975) | esc\_attr( $date\_utc ), |
| [976](#L976) | esc\_html( $date\_local ) |
| [977](#L977) | ); |
| [978](#L978) |  |
| [979](#L979) | // Expired |
| [980](#L980) | if ( $this->time\_now > $expiration ) { |
| [981](#L981) | return $time . '<br><span class="transient-expired badge">' . esc\_html\_\_( 'Expired', 'transients-manager' ) . '</span>'; |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | // Return time since |
| [985](#L985) | return $time . '<br><span class="badge green">' . $this->time\_since( $expiration - $this->time\_now ) . '</span>'; |
| [986](#L986) | } |
| [987](#L987) |  |
| [988](#L988) | /\*\* |
| [989](#L989) | \* Process delete and update actions |
| [990](#L990) | \* |
| [991](#L991) | \* @since 1.0 |
| [992](#L992) | \*/ |
| [993](#L993) | public function process\_actions() { |
| [994](#L994) |  |
| [995](#L995) | if ( empty( $this->action ) ) { |
| [996](#L996) | return; |
| [997](#L997) | } |
| [998](#L998) |  |
| [999](#L999) | // Bail if malformed Transient request |
| [1000](#L1000) | if ( empty( $\_REQUEST['transient'] ) && ! in\_array( $this->action, array( 'suspend\_transients', 'unsuspend\_transients' ), true ) ) { |
| [1001](#L1001) | return; |
| [1002](#L1002) | } |
| [1003](#L1003) |  |
| [1004](#L1004) | // Bail if user is not capable |
| [1005](#L1005) | if ( ! current\_user\_can( $this->capability ) ) { |
| [1006](#L1006) | return; |
| [1007](#L1007) | } |
| [1008](#L1008) |  |
| [1009](#L1009) | // Bail if nonce fails |
| [1010](#L1010) | if ( empty( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( $\_REQUEST['\_wpnonce'], 'transients\_manager' ) ) { |
| [1011](#L1011) | return; |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) | if ( ! in\_array( $this->action, array( 'suspend\_transients', 'unsuspend\_transients' ), true ) ) { |
| [1015](#L1015) |  |
| [1016](#L1016) | // Encode search string |
| [1017](#L1017) | $search = ! empty( $\_REQUEST['s'] ) |
| [1018](#L1018) | ? urlencode( $\_REQUEST['s'] ) |
| [1019](#L1019) | : ''; |
| [1020](#L1020) |  |
| [1021](#L1021) | // Sanitize transient |
| [1022](#L1022) | $transient = sanitize\_key( $\_REQUEST['transient'] ); |
| [1023](#L1023) |  |
| [1024](#L1024) | // Site wide |
| [1025](#L1025) | $site\_wide = ! empty( $\_REQUEST['name'] ) && $this->is\_site\_wide( $\_REQUEST['name'] ); |
| [1026](#L1026) | } |
| [1027](#L1027) |  |
| [1028](#L1028) | switch ( $this->action ) { |
| [1029](#L1029) |  |
| [1030](#L1030) | case 'suspend\_transients' : |
| [1031](#L1031) | update\_option( 'pw\_tm\_suspend', 1 ); |
| [1032](#L1032) | wp\_safe\_redirect( remove\_query\_arg( array( 'updated', 'deleted', 'action', '\_wpnonce' ) ) ); |
| [1033](#L1033) | exit; |
| [1034](#L1034) |  |
| [1035](#L1035) | case 'unsuspend\_transients' : |
| [1036](#L1036) | delete\_option( 'pw\_tm\_suspend', 1 ); |
| [1037](#L1037) | wp\_safe\_redirect( remove\_query\_arg( array( 'updated', 'deleted', 'action', '\_wpnonce' ) ) ); |
| [1038](#L1038) | exit; |
| [1039](#L1039) |  |
| [1040](#L1040) | case 'delete\_transient' : |
| [1041](#L1041) | $this->delete\_transient( $transient, $site\_wide ); |
| [1042](#L1042) | wp\_safe\_redirect( |
| [1043](#L1043) | remove\_query\_arg( |
| [1044](#L1044) | array( 'updated' ), |
| [1045](#L1045) | add\_query\_arg( |
| [1046](#L1046) | array( |
| [1047](#L1047) | 'page'    => $this->page\_id, |
| [1048](#L1048) | 's'       => $search, |
| [1049](#L1049) | 'deleted' => true |
| [1050](#L1050) | ), |
| [1051](#L1051) | admin\_url( 'tools.php' ) |
| [1052](#L1052) | ) |
| [1053](#L1053) | ) |
| [1054](#L1054) | ); |
| [1055](#L1055) | exit; |
| [1056](#L1056) |  |
| [1057](#L1057) | case 'update\_transient' : |
| [1058](#L1058) | $this->update\_transient( $transient, $site\_wide ); |
| [1059](#L1059) | wp\_safe\_redirect( |
| [1060](#L1060) | remove\_query\_arg( |
| [1061](#L1061) | array( 'deleted' ), |
| [1062](#L1062) | add\_query\_arg( |
| [1063](#L1063) | array( |
| [1064](#L1064) | 'page'    => $this->page\_id, |
| [1065](#L1065) | 's'       => $search, |
| [1066](#L1066) | 'updated' => true |
| [1067](#L1067) | ), |
| [1068](#L1068) | admin\_url( 'tools.php' ) |
| [1069](#L1069) | ) |
| [1070](#L1070) | ) |
| [1071](#L1071) | ); |
| [1072](#L1072) | exit; |
| [1073](#L1073) |  |
| [1074](#L1074) | case 'delete\_selected\_transients' : |
| [1075](#L1075) | $this->delete\_selected\_transients(); |
| [1076](#L1076) | wp\_safe\_redirect( |
| [1077](#L1077) | remove\_query\_arg( |
| [1078](#L1078) | array( 'updated' ), |
| [1079](#L1079) | add\_query\_arg( |
| [1080](#L1080) | array( |
| [1081](#L1081) | 'page'    => $this->page\_id, |
| [1082](#L1082) | 'deleted' => true |
| [1083](#L1083) | ), |
| [1084](#L1084) | admin\_url( 'tools.php' ) |
| [1085](#L1085) | ) |
| [1086](#L1086) | ) |
| [1087](#L1087) | ); |
| [1088](#L1088) | exit; |
| [1089](#L1089) |  |
| [1090](#L1090) | case 'delete\_expired\_transients' : |
| [1091](#L1091) | $this->delete\_expired\_transients(); |
| [1092](#L1092) | wp\_safe\_redirect( |
| [1093](#L1093) | remove\_query\_arg( |
| [1094](#L1094) | array( 'updated' ), |
| [1095](#L1095) | add\_query\_arg( |
| [1096](#L1096) | array( |
| [1097](#L1097) | 'page'    => $this->page\_id, |
| [1098](#L1098) | 'deleted' => true |
| [1099](#L1099) | ), |
| [1100](#L1100) | admin\_url( 'tools.php' ) |
| [1101](#L1101) | ) |
| [1102](#L1102) | ) |
| [1103](#L1103) | ); |
| [1104](#L1104) | exit; |
| [1105](#L1105) |  |
| [1106](#L1106) | case 'delete\_transients\_with\_expiration' : |
| [1107](#L1107) | $this->delete\_transients\_with\_expirations(); |
| [1108](#L1108) | wp\_safe\_redirect( |
| [1109](#L1109) | remove\_query\_arg( |
| [1110](#L1110) | array( 'updated' ), |
| [1111](#L1111) | add\_query\_arg( |
| [1112](#L1112) | array( |
| [1113](#L1113) | 'page'    => $this->page\_id, |
| [1114](#L1114) | 'deleted' => true |
| [1115](#L1115) | ), |
| [1116](#L1116) | admin\_url( 'tools.php' ) |
| [1117](#L1117) | ) |
| [1118](#L1118) | ) |
| [1119](#L1119) | ); |
| [1120](#L1120) | exit; |
| [1121](#L1121) |  |
| [1122](#L1122) | case 'delete\_transients\_without\_expiration' : |
| [1123](#L1123) | $this->delete\_transients\_without\_expirations(); |
| [1124](#L1124) | wp\_safe\_redirect( |
| [1125](#L1125) | remove\_query\_arg( |
| [1126](#L1126) | array( 'updated' ), |
| [1127](#L1127) | add\_query\_arg( |
| [1128](#L1128) | array( |
| [1129](#L1129) | 'page'    => $this->page\_id, |
| [1130](#L1130) | 'deleted' => true |
| [1131](#L1131) | ), |
| [1132](#L1132) | admin\_url( 'tools.php' ) |
| [1133](#L1133) | ) |
| [1134](#L1134) | ) |
| [1135](#L1135) | ); |
| [1136](#L1136) | exit; |
| [1137](#L1137) |  |
| [1138](#L1138) | case 'delete\_all\_transients' : |
| [1139](#L1139) | $this->delete\_all\_transients(); |
| [1140](#L1140) | wp\_safe\_redirect( |
| [1141](#L1141) | remove\_query\_arg( |
| [1142](#L1142) | array( 'updated' ), |
| [1143](#L1143) | add\_query\_arg( |
| [1144](#L1144) | array( |
| [1145](#L1145) | 'page'    => $this->page\_id, |
| [1146](#L1146) | 'deleted' => true |
| [1147](#L1147) | ), |
| [1148](#L1148) | admin\_url( 'tools.php' ) |
| [1149](#L1149) | ) |
| [1150](#L1150) | ) |
| [1151](#L1151) | ); |
| [1152](#L1152) | exit; |
| [1153](#L1153) | } |
| [1154](#L1154) | } |
| [1155](#L1155) |  |
| [1156](#L1156) | /\*\* |
| [1157](#L1157) | \* Delete a transient by name |
| [1158](#L1158) | \* |
| [1159](#L1159) | \* @since  1.0 |
| [1160](#L1160) | \* @param  object $transient |
| [1161](#L1161) | \* @param  boolean $site\_wide |
| [1162](#L1162) | \* @return boolean |
| [1163](#L1163) | \*/ |
| [1164](#L1164) | private function delete\_transient( $transient = '', $site\_wide = false ) { |
| [1165](#L1165) |  |
| [1166](#L1166) | // Bail if no Transient |
| [1167](#L1167) | if ( empty( $transient ) ) { |
| [1168](#L1168) | return false; |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) | // Transient type |
| [1172](#L1172) | $retval = ( false !== $site\_wide ) |
| [1173](#L1173) | ? delete\_site\_transient( $transient ) |
| [1174](#L1174) | : delete\_transient( $transient ); |
| [1175](#L1175) |  |
| [1176](#L1176) | // Return |
| [1177](#L1177) | return $retval; |
| [1178](#L1178) | } |
| [1179](#L1179) |  |
| [1180](#L1180) | /\*\* |
| [1181](#L1181) | \* Bulk delete function |
| [1182](#L1182) | \* |
| [1183](#L1183) | \* @since  1.5 |
| [1184](#L1184) | \* @param  array $transients |
| [1185](#L1185) | \* @return boolean |
| [1186](#L1186) | \*/ |
| [1187](#L1187) | private function bulk\_delete\_transients( $transients = array() ) { |
| [1188](#L1188) |  |
| [1189](#L1189) | // Bail if empty or error |
| [1190](#L1190) | if ( empty( $transients ) || is\_wp\_error( $transients ) ) { |
| [1191](#L1191) | return false; |
| [1192](#L1192) | } |
| [1193](#L1193) |  |
| [1194](#L1194) | // Loop through Transients, and delete them |
| [1195](#L1195) | foreach ( $transients as $transient ) { |
| [1196](#L1196) |  |
| [1197](#L1197) | // Site wide |
| [1198](#L1198) | $site\_wide = $this->is\_site\_wide( $transient ); |
| [1199](#L1199) |  |
| [1200](#L1200) | // Get prefix based on site-wide |
| [1201](#L1201) | $prefix = ! empty( $site\_wide ) |
| [1202](#L1202) | ? '\_site\_transient\_timeout\_' |
| [1203](#L1203) | : '\_transient\_timeout\_'; |
| [1204](#L1204) |  |
| [1205](#L1205) | // Strip prefix from name |
| [1206](#L1206) | $name = str\_replace( $prefix, '', $transient ); |
| [1207](#L1207) |  |
| [1208](#L1208) | // Delete |
| [1209](#L1209) | $this->delete\_transient( $name, $site\_wide ); |
| [1210](#L1210) | } |
| [1211](#L1211) |  |
| [1212](#L1212) | // No errors |
| [1213](#L1213) | return true; |
| [1214](#L1214) | } |
| [1215](#L1215) |  |
| [1216](#L1216) | /\*\* |
| [1217](#L1217) | \* Delete Selected transients. |
| [1218](#L1218) | \* |
| [1219](#L1219) | \* @since  1.8 |
| [1220](#L1220) | \* @return false|int |
| [1221](#L1221) | \*/ |
| [1222](#L1222) | public function delete\_selected\_transients() { |
| [1223](#L1223) | global $wpdb; |
| [1224](#L1224) |  |
| [1225](#L1225) | // Bail if no Transients |
| [1226](#L1226) | if ( empty( $\_REQUEST['transients'] ) || ! is\_array( $\_REQUEST['transients'] ) ) { |
| [1227](#L1227) | return 0; |
| [1228](#L1228) | } |
| [1229](#L1229) |  |
| [1230](#L1230) | // Filter |
| [1231](#L1231) | $transients\_ids\_filtered = wp\_parse\_id\_list( $\_REQUEST['transients'] ); |
| [1232](#L1232) |  |
| [1233](#L1233) | // Bail if no IDs |
| [1234](#L1234) | if ( empty( $transients\_ids\_filtered ) ) { |
| [1235](#L1235) | return 0; |
| [1236](#L1236) | } |
| [1237](#L1237) |  |
| [1238](#L1238) | // Query |
| [1239](#L1239) | $placeholders = array\_fill( 0, count( $transients\_ids\_filtered ), '%d' ); |
| [1240](#L1240) | $format       = implode( ', ', $placeholders ); |
| [1241](#L1241) | $count        = $wpdb->query( $wpdb->prepare( "DELETE FROM {$wpdb->options} WHERE option\_id IN ({$format})", $transients\_ids\_filtered ) ); |
| [1242](#L1242) |  |
| [1243](#L1243) | // Return count of deleted |
| [1244](#L1244) | return $count; |
| [1245](#L1245) | } |
| [1246](#L1246) |  |
| [1247](#L1247) | /\*\* |
| [1248](#L1248) | \* Delete all expired transients |
| [1249](#L1249) | \* |
| [1250](#L1250) | \* @since  1.1 |
| [1251](#L1251) | \* @return boolean |
| [1252](#L1252) | \*/ |
| [1253](#L1253) | public function delete\_expired\_transients() { |
| [1254](#L1254) | global $wpdb; |
| [1255](#L1255) |  |
| [1256](#L1256) | // Query |
| [1257](#L1257) | $esc\_time = '%' . $wpdb->esc\_like( '\_transient\_timeout\_' ) . '%'; |
| [1258](#L1258) | $prepared = $wpdb->prepare( "SELECT option\_name FROM {$wpdb->options} where option\_name LIKE %s AND option\_value+0 < %d", $esc\_time, $this->time\_now ); |
| [1259](#L1259) | $expired  = $wpdb->get\_col( $prepared ); |
| [1260](#L1260) |  |
| [1261](#L1261) | // Bulk delete |
| [1262](#L1262) | return $this->bulk\_delete\_transients( $expired ); |
| [1263](#L1263) | } |
| [1264](#L1264) |  |
| [1265](#L1265) | /\*\* |
| [1266](#L1266) | \* Delete all transients with expiration |
| [1267](#L1267) | \* |
| [1268](#L1268) | \* @since  1.2 |
| [1269](#L1269) | \* @return boolean |
| [1270](#L1270) | \*/ |
| [1271](#L1271) | public function delete\_transients\_with\_expirations() { |
| [1272](#L1272) | global $wpdb; |
| [1273](#L1273) |  |
| [1274](#L1274) | // Query |
| [1275](#L1275) | $esc\_time    = '%' . $wpdb->esc\_like( '\_transient\_timeout\_' ) . '%'; |
| [1276](#L1276) | $prepared    = $wpdb->prepare( "SELECT option\_name FROM {$wpdb->options} where option\_name LIKE %s", $esc\_time ); |
| [1277](#L1277) | $will\_expire = $wpdb->get\_col( $prepared ); |
| [1278](#L1278) |  |
| [1279](#L1279) | // Bulk delete |
| [1280](#L1280) | return $this->bulk\_delete\_transients( $will\_expire ); |
| [1281](#L1281) | } |
| [1282](#L1282) |  |
| [1283](#L1283) | /\*\* |
| [1284](#L1284) | \* Delete all transients without expiration |
| [1285](#L1285) | \* |
| [1286](#L1286) | \* @since  2.0 |
| [1287](#L1287) | \* @return boolean |
| [1288](#L1288) | \*/ |
| [1289](#L1289) | public function delete\_transients\_without\_expirations() { |
| [1290](#L1290) | global $wpdb; |
| [1291](#L1291) |  |
| [1292](#L1292) | // Escape likes |
| [1293](#L1293) | $esc\_time = '%' . $wpdb->esc\_like( '\_transient\_timeout\_' ) . '%'; |
| [1294](#L1294) | $esc\_name = '%' . $wpdb->esc\_like( '\_transient\_'         ) . '%'; |
| [1295](#L1295) |  |
| [1296](#L1296) | // Queries |
| [1297](#L1297) | $timeouts = $wpdb->get\_col( $wpdb->prepare( "SELECT option\_name FROM {$wpdb->options} where option\_name LIKE %s", $esc\_time ) ); |
| [1298](#L1298) | $names    = $wpdb->get\_col( $wpdb->prepare( "SELECT option\_name FROM {$wpdb->options} where option\_name LIKE %s", $esc\_name ) ); |
| [1299](#L1299) |  |
| [1300](#L1300) | // Diff to remove timeouts from names |
| [1301](#L1301) | $items = array\_diff( $names, $timeouts ); |
| [1302](#L1302) |  |
| [1303](#L1303) | // Remove "%\_transient\_timeout\_" from left of timeouts |
| [1304](#L1304) | foreach ( $timeouts as $index => $timeout ) { |
| [1305](#L1305) | $pos = strrpos( $timeout, '\_transient\_timeout\_' ) + strlen( '\_transient\_timeout\_' ); |
| [1306](#L1306) | $timeouts[ $index ] = substr( $timeout, $pos ); |
| [1307](#L1307) | } |
| [1308](#L1308) |  |
| [1309](#L1309) | // Remove "%\_transient\_" from left of items |
| [1310](#L1310) | foreach ( $items as $index => $item ) { |
| [1311](#L1311) | $pos = strrpos( $item, '\_transient\_' ) + strlen( '\_transient\_' ); |
| [1312](#L1312) | $items[ $index ] = substr( $item, $pos ); |
| [1313](#L1313) | } |
| [1314](#L1314) |  |
| [1315](#L1315) | // Remove timeouts from items |
| [1316](#L1316) | $bulk = array\_diff( $items, $timeouts ); |
| [1317](#L1317) |  |
| [1318](#L1318) | // Bulk delete |
| [1319](#L1319) | return $this->bulk\_delete\_transients( $bulk ); |
| [1320](#L1320) | } |
| [1321](#L1321) |  |
| [1322](#L1322) | /\*\* |
| [1323](#L1323) | \* Delete all transients |
| [1324](#L1324) | \* |
| [1325](#L1325) | \* @since  1.0 |
| [1326](#L1326) | \* @return false|int |
| [1327](#L1327) | \*/ |
| [1328](#L1328) | public function delete\_all\_transients() { |
| [1329](#L1329) | global $wpdb; |
| [1330](#L1330) |  |
| [1331](#L1331) | // Escape like |
| [1332](#L1332) | $esc\_name = '%' . $wpdb->esc\_like( '\_transient\_' ) . '%'; |
| [1333](#L1333) |  |
| [1334](#L1334) | // Query |
| [1335](#L1335) | $count = $wpdb->query( |
| [1336](#L1336) | $wpdb->prepare( |
| [1337](#L1337) | "DELETE FROM {$wpdb->options} WHERE option\_name LIKE %s", |
| [1338](#L1338) | $esc\_name |
| [1339](#L1339) | ) |
| [1340](#L1340) | ); |
| [1341](#L1341) |  |
| [1342](#L1342) | // Return count |
| [1343](#L1343) | return $count; |
| [1344](#L1344) | } |
| [1345](#L1345) |  |
| [1346](#L1346) | /\*\* |
| [1347](#L1347) | \* Update an existing transient |
| [1348](#L1348) | \* |
| [1349](#L1349) | \* @since  1.0 |
| [1350](#L1350) | \* @param  object  $transient |
| [1351](#L1351) | \* @param  boolean $site\_wide |
| [1352](#L1352) | \* @return boolean |
| [1353](#L1353) | \*/ |
| [1354](#L1354) | private function update\_transient( $transient = '', $site\_wide = false ) { |
| [1355](#L1355) |  |
| [1356](#L1356) | // Bail if no Transient |
| [1357](#L1357) | if ( empty( $transient ) ) { |
| [1358](#L1358) | return false; |
| [1359](#L1359) | } |
| [1360](#L1360) |  |
| [1361](#L1361) | // Values |
| [1362](#L1362) | $value      = stripslashes( $\_POST['value'] ); |
| [1363](#L1363) | $expiration = absint( stripslashes( $\_POST['expires'] ) ); |
| [1364](#L1364) |  |
| [1365](#L1365) | // Subtract now |
| [1366](#L1366) | $expiration = ( $expiration - $this->time\_now ); |
| [1367](#L1367) |  |
| [1368](#L1368) | // Transient type |
| [1369](#L1369) | $retval = ( false !== $site\_wide ) |
| [1370](#L1370) | ? set\_site\_transient( $transient, $value, $expiration ) |
| [1371](#L1371) | : set\_transient( $transient, $value, $expiration ); |
| [1372](#L1372) |  |
| [1373](#L1373) | // Return |
| [1374](#L1374) | return $retval; |
| [1375](#L1375) | } |
| [1376](#L1376) |  |
| [1377](#L1377) | /\*\* |
| [1378](#L1378) | \* Prevent transient from being updated if transients are suspended |
| [1379](#L1379) | \* |
| [1380](#L1380) | \* @since  1.6 |
| [1381](#L1381) | \* @param  mixed  $value |
| [1382](#L1382) | \* @param  string $option |
| [1383](#L1383) | \* @return mixed |
| [1384](#L1384) | \*/ |
| [1385](#L1385) | public function maybe\_block\_update\_transient( $value = '', $option = '' ) { |
| [1386](#L1386) |  |
| [1387](#L1387) | // Bail if not Suspended |
| [1388](#L1388) | if ( ! get\_option( 'pw\_tm\_suspend' ) ) { |
| [1389](#L1389) | return $value; |
| [1390](#L1390) | } |
| [1391](#L1391) |  |
| [1392](#L1392) | // Bail if not a Transient |
| [1393](#L1393) | if ( false === strpos( $option, '\_transient' ) ) { |
| [1394](#L1394) | return $value; |
| [1395](#L1395) | } |
| [1396](#L1396) |  |
| [1397](#L1397) | // Return false |
| [1398](#L1398) | return false; |
| [1399](#L1399) | } |
| [1400](#L1400) |  |
| [1401](#L1401) | /\*\* |
| [1402](#L1402) | \* Prevent transient from being updated if transients are suspended |
| [1403](#L1403) | \* |
| [1404](#L1404) | \* @since 1.6 |
| [1405](#L1405) | \*/ |
| [1406](#L1406) | public function maybe\_block\_set\_transient( $option = '' ) { |
| [1407](#L1407) |  |
| [1408](#L1408) | // Bail if not Suspended |
| [1409](#L1409) | if ( ! get\_option( 'pw\_tm\_suspend' ) ) { |
| [1410](#L1410) | return; |
| [1411](#L1411) | } |
| [1412](#L1412) |  |
| [1413](#L1413) | // Bail if not a Transient |
| [1414](#L1414) | if ( false === strpos( $option, '\_transient' ) ) { |
| [1415](#L1415) | return; |
| [1416](#L1416) | } |
| [1417](#L1417) |  |
| [1418](#L1418) | // Delete the Transient |
| [1419](#L1419) | delete\_option( $option ); |
| [1420](#L1420) | } |
| [1421](#L1421) |  |
| [1422](#L1422) | /\*\* |
| [1423](#L1423) | \* Converts a period of time in seconds into a human-readable format |
| [1424](#L1424) | \* representing the interval. |
| [1425](#L1425) | \* |
| [1426](#L1426) | \* @since  2.0 |
| [1427](#L1427) | \* @param  int $since A period of time in seconds. |
| [1428](#L1428) | \* @return string An interval represented as a string. |
| [1429](#L1429) | \*/ |
| [1430](#L1430) | public function time\_since( $since = 0 ) { |
| [1431](#L1431) |  |
| [1432](#L1432) | // Array of time period chunks. |
| [1433](#L1433) | $chunks = array( |
| [1434](#L1434) | /\* translators: 1: The number of years in an interval of time. \*/ |
| [1435](#L1435) | array( 60 \* 60 \* 24 \* 365, \_n\_noop( '%s year', '%s years', 'transients-manager' ) ), |
| [1436](#L1436) | /\* translators: 1: The number of months in an interval of time. \*/ |
| [1437](#L1437) | array( 60 \* 60 \* 24 \* 30, \_n\_noop( '%s month', '%s months', 'transients-manager' ) ), |
| [1438](#L1438) | /\* translators: 1: The number of weeks in an interval of time. \*/ |
| [1439](#L1439) | array( 60 \* 60 \* 24 \* 7, \_n\_noop( '%s week', '%s weeks', 'transients-manager' ) ), |
| [1440](#L1440) | /\* translators: 1: The number of days in an interval of time. \*/ |
| [1441](#L1441) | array( 60 \* 60 \* 24, \_n\_noop( '%s day', '%s days', 'transients-manager' ) ), |
| [1442](#L1442) | /\* translators: 1: The number of hours in an interval of time. \*/ |
| [1443](#L1443) | array( 60 \* 60, \_n\_noop( '%s hour', '%s hours', 'transients-manager' ) ), |
| [1444](#L1444) | /\* translators: 1: The number of minutes in an interval of time. \*/ |
| [1445](#L1445) | array( 60, \_n\_noop( '%s minute', '%s minutes', 'transients-manager' ) ), |
| [1446](#L1446) | /\* translators: 1: The number of seconds in an interval of time. \*/ |
| [1447](#L1447) | array( 1, \_n\_noop( '%s second', '%s seconds', 'transients-manager' ) ), |
| [1448](#L1448) | ); |
| [1449](#L1449) |  |
| [1450](#L1450) | if ( $since <= 0 ) { |
| [1451](#L1451) | return esc\_html\_\_( 'now', 'transients-manager' ); |
| [1452](#L1452) | } |
| [1453](#L1453) |  |
| [1454](#L1454) | /\*\* |
| [1455](#L1455) | \* We only want to output two chunks of time here, eg: |
| [1456](#L1456) | \* x years, xx months |
| [1457](#L1457) | \* x days, xx hours |
| [1458](#L1458) | \* so there's only two bits of calculation below: |
| [1459](#L1459) | \*/ |
| [1460](#L1460) | $j = count( $chunks ); |
| [1461](#L1461) |  |
| [1462](#L1462) | // Step one: the first chunk. |
| [1463](#L1463) | for ( $i = 0; $i < $j; $i++ ) { |
| [1464](#L1464) | $seconds = $chunks[ $i ][ 0 ]; |
| [1465](#L1465) | $name    = $chunks[ $i ][ 1 ]; |
| [1466](#L1466) |  |
| [1467](#L1467) | // Finding the biggest chunk (if the chunk fits, break). |
| [1468](#L1468) | $count = floor( $since / $seconds ); |
| [1469](#L1469) |  |
| [1470](#L1470) | if ( ! empty( $count ) ) { |
| [1471](#L1471) | break; |
| [1472](#L1472) | } |
| [1473](#L1473) | } |
| [1474](#L1474) |  |
| [1475](#L1475) | // Set output var. |
| [1476](#L1476) | $output = sprintf( translate\_nooped\_plural( $name, $count, 'transients-manager' ), $count ); |
| [1477](#L1477) |  |
| [1478](#L1478) | // Step two: the second chunk. |
| [1479](#L1479) | if ( $i + 1 < $j ) { |
| [1480](#L1480) | $seconds2 = $chunks[ $i + 1 ][ 0 ]; |
| [1481](#L1481) | $name2    = $chunks[ $i + 1 ][ 1 ]; |
| [1482](#L1482) | $count2   = floor( ( $since - ( $seconds \* $count ) ) / $seconds2 ); |
| [1483](#L1483) |  |
| [1484](#L1484) | // Add to output var. |
| [1485](#L1485) | if ( ! empty( $count2 ) ) { |
| [1486](#L1486) | $output .= ' ' . sprintf( translate\_nooped\_plural( $name2, $count2, 'transients-manager' ), $count2 ); |
| [1487](#L1487) | } |
| [1488](#L1488) | } |
| [1489](#L1489) |  |
| [1490](#L1490) | return $output; |
| [1491](#L1491) | } |
| [1492](#L1492) |  |
| [1493](#L1493) | /\*\* |
| [1494](#L1494) | \* Add <style> tag to "admin\_print\_styles-{$this->page\_id}" hook |
| [1495](#L1495) | \* |
| [1496](#L1496) | \* @since 2.0 |
| [1497](#L1497) | \*/ |
| [1498](#L1498) | public function print\_styles() { |
| [1499](#L1499) |  |
| [1500](#L1500) | // Get the page type |
| [1501](#L1501) | $type = $this->page\_type(); |
| [1502](#L1502) |  |
| [1503](#L1503) | // Editing... |
| [1504](#L1504) | if ( 'edit' === $type ) { |
| [1505](#L1505) |  |
| [1506](#L1506) | // Try to enqueue the code editor |
| [1507](#L1507) | $settings = wp\_enqueue\_code\_editor( |
| [1508](#L1508) | array( |
| [1509](#L1509) | 'type'       => 'text/plain', |
| [1510](#L1510) | 'codemirror' => array( |
| [1511](#L1511) | 'indentUnit' => 4, |
| [1512](#L1512) | 'tabSize'    => 4, |
| [1513](#L1513) | ), |
| [1514](#L1514) | ) |
| [1515](#L1515) | ); |
| [1516](#L1516) |  |
| [1517](#L1517) | // Bail if user disabled CodeMirror. |
| [1518](#L1518) | if ( false === $settings ) { |
| [1519](#L1519) | return; |
| [1520](#L1520) | } |
| [1521](#L1521) |  |
| [1522](#L1522) | // Target the textarea |
| [1523](#L1523) | wp\_add\_inline\_script( |
| [1524](#L1524) | 'code-editor', |
| [1525](#L1525) | sprintf( |
| [1526](#L1526) | 'jQuery( function() { wp.codeEditor.initialize( "transient-editor", %s ); } );', |
| [1527](#L1527) | wp\_json\_encode( $settings ) |
| [1528](#L1528) | ) |
| [1529](#L1529) | ); |
| [1530](#L1530) |  |
| [1531](#L1531) | // Custom styling |
| [1532](#L1532) | wp\_add\_inline\_style( |
| [1533](#L1533) | 'code-editor', |
| [1534](#L1534) | '.CodeMirror-wrap { |
| [1535](#L1535) | width: 99%; |
| [1536](#L1536) | border: 1px solid #8c8f94; |
| [1537](#L1537) | border-radius: 3px; |
| [1538](#L1538) | overflow: hidden; |
| [1539](#L1539) | } |
| [1540](#L1540) | .CodeMirror-gutters { |
| [1541](#L1541) | background: transparent; |
| [1542](#L1542) | }' |
| [1543](#L1543) | ); |
| [1544](#L1544) |  |
| [1545](#L1545) | // Showing list-table... |
| [1546](#L1546) | } else { |
| [1547](#L1547) |  |
| [1548](#L1548) | // Escape once |
| [1549](#L1549) | $esc = esc\_attr( $this->page\_id ); |
| [1550](#L1550) |  |
| [1551](#L1551) | ?> |
| [1552](#L1552) |  |
| [1553](#L1553) | <style type="text/css" id="transients-manager"> |
| [1554](#L1554) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients .column-value { |
| [1555](#L1555) | width: 38%; |
| [1556](#L1556) | } |
| [1557](#L1557) |  |
| [1558](#L1558) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients .column-expiration { |
| [1559](#L1559) | width: 170px; |
| [1560](#L1560) | } |
| [1561](#L1561) |  |
| [1562](#L1562) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients .truncate { |
| [1563](#L1563) | overflow: hidden; |
| [1564](#L1564) | white-space: nowrap; |
| [1565](#L1565) | text-overflow: ellipsis; |
| [1566](#L1566) | } |
| [1567](#L1567) |  |
| [1568](#L1568) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients .column-primary pre { |
| [1569](#L1569) | margin: 0; |
| [1570](#L1570) | } |
| [1571](#L1571) |  |
| [1572](#L1572) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.transient-value { |
| [1573](#L1573) | display: block; |
| [1574](#L1574) | } |
| [1575](#L1575) |  |
| [1576](#L1576) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients code { |
| [1577](#L1577) | background: transparent; |
| [1578](#L1578) | margin: 0; |
| [1579](#L1579) | padding: 0; |
| [1580](#L1580) | } |
| [1581](#L1581) |  |
| [1582](#L1582) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.transient-value, |
| [1583](#L1583) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.transient-expiration { |
| [1584](#L1584) | cursor: default; |
| [1585](#L1585) | } |
| [1586](#L1586) |  |
| [1587](#L1587) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.badge, |
| [1588](#L1588) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients div.row-actions { |
| [1589](#L1589) | margin-top: 5px; |
| [1590](#L1590) | } |
| [1591](#L1591) |  |
| [1592](#L1592) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.badge { |
| [1593](#L1593) | padding: 2px 7px; |
| [1594](#L1594) | border-radius: 4px; |
| [1595](#L1595) | display: inline-flex; |
| [1596](#L1596) | align-items: center; |
| [1597](#L1597) | background: rgba(0, 0, 0, 0.07); |
| [1598](#L1598) | color: #50575e; |
| [1599](#L1599) | } |
| [1600](#L1600) |  |
| [1601](#L1601) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.badge.green { |
| [1602](#L1602) | color: #017d5c; |
| [1603](#L1603) | background: #e5f5f0; |
| [1604](#L1604) | } |
| [1605](#L1605) |  |
| [1606](#L1606) | body.tools\_page\_<?php echo $esc; // Escaped ?> table.transients span.transient-expired { |
| [1607](#L1607) | color: #b32d2e; |
| [1608](#L1608) | background: #ffd6d6; |
| [1609](#L1609) | } |
| [1610](#L1610) |  |
| [1611](#L1611) | body.tools\_page\_<?php echo $esc; // Escaped ?> .tablenav .info { |
| [1612](#L1612) | display: inline-block; |
| [1613](#L1613) | margin: 2px 0; |
| [1614](#L1614) | padding: 2px 7px; |
| [1615](#L1615) | } |
| [1616](#L1616) |  |
| [1617](#L1617) | body.tools\_page\_<?php echo $esc; // Escaped ?> .tablenav-pages span.displaying-num { |
| [1618](#L1618) | display: inline-block; |
| [1619](#L1619) | margin: 5px 0; |
| [1620](#L1620) | } |
| [1621](#L1621) |  |
| [1622](#L1622) | body.tools\_page\_<?php echo $esc; // Escaped ?> span.pagination-links .page-numbers { |
| [1623](#L1623) | border-color: #7e8993; |
| [1624](#L1624) | color: #32373c; |
| [1625](#L1625) | display: inline-block; |
| [1626](#L1626) | vertical-align: baseline; |
| [1627](#L1627) | min-width: 30px; |
| [1628](#L1628) | min-height: 30px; |
| [1629](#L1629) | text-decoration: none; |
| [1630](#L1630) | text-align: center; |
| [1631](#L1631) | font-size: 13px; |
| [1632](#L1632) | line-height: 2.15384615; |
| [1633](#L1633) | margin: 0; |
| [1634](#L1634) | padding: 0 10px; |
| [1635](#L1635) | cursor: pointer; |
| [1636](#L1636) | border-width: 1px; |
| [1637](#L1637) | border-style: solid; |
| [1638](#L1638) | border-radius: 3px; |
| [1639](#L1639) | -webkit-appearance: none; |
| [1640](#L1640) | white-space: nowrap; |
| [1641](#L1641) | box-sizing: border-box; |
| [1642](#L1642) | } |
| [1643](#L1643) |  |
| [1644](#L1644) | body.tools\_page\_<?php echo $esc; // Escaped ?> span.pagination-links .page-numbers.next, |
| [1645](#L1645) | body.tools\_page\_<?php echo $esc; // Escaped ?> span.pagination-links .page-numbers.prev { |
| [1646](#L1646) | font-size: 16px; |
| [1647](#L1647) | line-height: 1.625; |
| [1648](#L1648) | padding: 0 4px; |
| [1649](#L1649) | } |
| [1650](#L1650) |  |
| [1651](#L1651) | body.tools\_page\_<?php echo $esc; // Escaped ?> span.pagination-links a.page-numbers:hover { |
| [1652](#L1652) | background-color: #f0f0f1; |
| [1653](#L1653) | border-color: #717c87; |
| [1654](#L1654) | color: #262a2e; |
| [1655](#L1655) | } |
| [1656](#L1656) |  |
| [1657](#L1657) | body.tools\_page\_<?php echo $esc; // Escaped ?> span.pagination-links span.page-numbers { |
| [1658](#L1658) | color: #a7aaad; |
| [1659](#L1659) | border-color: #dcdcde; |
| [1660](#L1660) | background: #f6f7f7; |
| [1661](#L1661) | box-shadow: none; |
| [1662](#L1662) | cursor: default; |
| [1663](#L1663) | transform: none; |
| [1664](#L1664) | } |
| [1665](#L1665) | </style> |
| [1666](#L1666) |  |
| [1667](#L1667) | <?php |
| [1668](#L1668) | } |
| [1669](#L1669) | } |
| [1670](#L1670) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/transients-manager/trunk/src/TransientsManager.php?format=txt)
* [Original Format](/export/3220510/transients-manager/trunk/src/TransientsManager.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_1bff24d3_20250111_024135.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Transients Manager <= 2.0.6 - Cross-Site Request Forgery

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Transients Manager <= 2.0.6 - Cross-Site Request Forgery

4.3

**Cross-Site Request Forgery (CSRF)**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-10045](https://www.cve.org/CVERecord?id=CVE-2024-10045) |
| --- | --- |
| CVSS | 4.3 (Medium) |
| Publicly Published | October 22, 2024 |
| Last Updated | October 23, 2024 |
| Researcher | [David Gallagher (BatFeats) - Adept Digital](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/david-gallagher) |

### Description

The Transients Manager plugin for WordPress is vulnerable to Cross-Site Request Forgery in all versions up to, and including, 2.0.6. This is due to missing or incorrect nonce validation on the process\_actions function. This makes it possible for unauthenticated attackers to delete transients via a forged request granted they can trick a site administrator into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/transients-manager/trunk/src/TransientsManager.php#L993)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3171619/transients-manager/trunk/src/TransientsManager.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftransients-manager%2Ftransients-manager-206-cross-site-request-forgery&t=Transients%20Manager%20%3C%3D%202.0.6%20-%20Cross-Site%20Request%20Forgery "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftransients-manager%2Ftransients-manager-206-cross-site-request-forgery&text=Transients%20Manager%20%3C%3D%202.0.6%20-%20Cross-Site%20Request%20Forgery "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Ftransients-manager%2Ftransients-manager-206-cross-site-request-forgery "LinkedIn")
Email

## Vulnerability Details for Transients Manager

#### [Transients Manager](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/transients-manager)

| Software Type | Plugin |
| --- | --- |
| Software Slug | transients-manager [(view on wordpress.org)](https://wordpress.org/plugins/transients-manager) |
| Patched? | Yes |
| Remediation | Update to version 2.0.7, or a newer patched version |
| Affected Version | * <= 2.0.6 |
| Patched Version | * 2.0.7 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_696ee8ed_20250111_024134.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3171619%2Ftransients-manager%2Ftrunk%2Fsrc%2FTransientsManager.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3166029/transients-manager/trunk/src/TransientsManager.php "Changeset 3166029 for transients-manager/trunk/src/TransientsManager.php")
* Next Change →

---

# Changeset [3171619](/changeset/3171619 "Show full changeset") for [transients-manager/trunk/src/TransientsManager.php](/browser/transients-manager/trunk/src/TransientsManager.php?rev=3171619 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/18/2024 05:06:42 PM
([3 months](/timeline?from=2024-10-18T17%3A06%3A42Z&precision=second "See timeline at 10/18/2024 05:06:42 PM") ago)

Author:
\_smartik\_
Message:

Release version 2.0.7

File:

1 edited

* [transients-manager/trunk/src/TransientsManager.php](/browser/transients-manager/trunk/src/TransientsManager.php?rev=3171619 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [transients-manager/trunk/src/TransientsManager.php](/changeset/3171619/transients-manager/trunk/src/TransientsManager.php "Show the changeset 3171619 restricted to transients-manager/trunk/src/TransientsManager.php")

  | [r3166029](/browser/transients-manager/trunk/src/TransientsManager.php?rev=3166029#L1008 "Show revision 3166029 of this file in browser") | [r3171619](/browser/transients-manager/trunk/src/TransientsManager.php?rev=3171619#L1008 "Show revision 3171619 of this file in browser") |  |
  | --- | --- | --- |
  | 1008 | 1008 |  |
  | 1009 | 1009 | // Bail if nonce fails |
  | 1010 |  | if ( ~~! empty( $\_REQUEST['\_wpnonce'] ) &&~~ ! wp\_verify\_nonce( $\_REQUEST['\_wpnonce'], 'transients\_manager' ) ) { |
  |  | 1010 | if ( empty( $\_REQUEST['\_wpnonce'] ) || ! wp\_verify\_nonce( $\_REQUEST['\_wpnonce'], 'transients\_manager' ) ) { |
  | 1011 | 1011 | return; |
  | 1012 | 1012 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3171619)
* [Zip Archive](?format=zip&new=3171619)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


