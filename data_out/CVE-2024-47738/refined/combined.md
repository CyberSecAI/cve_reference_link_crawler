=== Content from git.kernel.org_b2581468_20250111_201051.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-07-29 15:48:16 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-17 15:20:38 +0200 |
| commit | [aafca50e71dc8f3192a5bfb325135a7908f3ef9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)) | |
| tree | [560d2c76876e608ca070964987c757898b314578](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | |
| parent | [24f30b34ff76648d26872dd4eaa002f074225058](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=24f30b34ff76648d26872dd4eaa002f074225058) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e&id2=24f30b34ff76648d26872dd4eaa002f074225058)) | |
| download | [linux-aafca50e71dc8f3192a5bfb325135a7908f3ef9e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-aafca50e71dc8f3192a5bfb325135a7908f3ef9e.tar.gz) | |

wifi: mac80211: don't use rate mask for offchannel TX either[ Upstream commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b ]
Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.
The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.
As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.
[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024
Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com](https://patch.msgid.link/20240729074816.20323-1-pkshih%40realtek.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)

| -rw-r--r-- | [include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e) | 2 | |  |  |  | | --- | --- | --- | |

5 files changed, 8 insertions, 6 deletions

| diff --git a/include/net/mac80211.h b/include/net/mac80211.hindex 87a4f334c22a83..a5a5a291573645 100644--- a/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=24f30b34ff76648d26872dd4eaa002f074225058)+++ b/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)@@ -885,8 +885,9 @@ enum mac80211\_tx\_info\_flags { \* of their QoS TID or other priority field values. \* @IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX: first MLO TX, used mostly internally \* for sequence number assignment- \* @IEEE80211\_TX\_CTRL\_SCAN\_TX: Indicates that this frame is transmitted- \* due to scanning, not in normal operation on the interface.+ \* @IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK: Don't use rate mask for this frame+ \* which is transmitted due to scanning or offchannel TX, not in normal+ \* operation on the interface. \* @IEEE80211\_TX\_CTRL\_MLO\_LINK: If not @IEEE80211\_LINK\_UNSPECIFIED, this \* frame should be transmitted on the specific link. This really is \* only relevant for frames that do not have data present, and is@@ -907,7 +908,7 @@ enum mac80211\_tx\_control\_flags { IEEE80211\_TX\_CTRL\_NO\_SEQNO = BIT(7), IEEE80211\_TX\_CTRL\_DONT\_REORDER = BIT(8), IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX = BIT(9),- IEEE80211\_TX\_CTRL\_SCAN\_TX = BIT(10),+ IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK = BIT(10), IEEE80211\_TX\_CTRL\_MLO\_LINK = 0xf0000000, }; diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.cindex 50dc379ca097ec..b2f895ea752dd3 100644--- a/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=24f30b34ff76648d26872dd4eaa002f074225058)+++ b/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)@@ -940,6 +940,7 @@ int ieee80211\_mgmt\_tx(struct wiphy \*wiphy, struct wireless\_dev \*wdev, }  IEEE80211\_SKB\_CB(skb)->flags = flags;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK;  skb->dev = sdata->dev; diff --git a/net/mac80211/rate.c b/net/mac80211/rate.cindex 3cf252418bd38c..78e7ac6c0af0b0 100644--- a/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=24f30b34ff76648d26872dd4eaa002f074225058)+++ b/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)@@ -890,7 +890,7 @@ void ieee80211\_get\_tx\_rates(struct ieee80211\_vif \*vif, if (ieee80211\_is\_tx\_data(skb)) rate\_control\_apply\_mask(sdata, sta, sband, dest, max\_rates); - if (!(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX))+ if (!(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) mask = sdata->rc\_rateidx\_mask[info->band];  if (dest[0].idx < 0)diff --git a/net/mac80211/scan.c b/net/mac80211/scan.cindex 62c22ff329ad4a..6432dd3ec2a7ee 100644--- a/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=24f30b34ff76648d26872dd4eaa002f074225058)+++ b/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)@@ -647,7 +647,7 @@ static void ieee80211\_send\_scan\_probe\_req(struct ieee80211\_sub\_if\_data \*sdata, cpu\_to\_le16(IEEE80211\_SN\_TO\_SEQ(sn)); } IEEE80211\_SKB\_CB(skb)->flags |= tx\_flags;- IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_SCAN\_TX;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK; ieee80211\_tx\_skb\_tid\_band(sdata, skb, 7, channel->band); } }diff --git a/net/mac80211/tx.c b/net/mac80211/tx.cindex 0685ae2ea64eb0..62b2817df2ba90 100644--- a/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=24f30b34ff76648d26872dd4eaa002f074225058)+++ b/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=aafca50e71dc8f3192a5bfb325135a7908f3ef9e)@@ -721,7 +721,7 @@ ieee80211\_tx\_h\_rate\_ctrl(struct ieee80211\_tx\_data \*tx) txrc.skb = tx->skb; txrc.reported\_rate.idx = -1; - if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX)) {+ if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) { txrc.rate\_idx\_mask = ~0; } else { txrc.rate\_idx\_mask = tx->sdata->rc\_rateidx\_mask[info->band]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:09:28 +0000



=== Content from git.kernel.org_00b78866_20250111_201050.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=43897111481b679508711d3ca881c4c6593e9247)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=43897111481b679508711d3ca881c4c6593e9247)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43897111481b679508711d3ca881c4c6593e9247)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43897111481b679508711d3ca881c4c6593e9247)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-07-29 15:48:16 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:37:21 +0200 |
| commit | [43897111481b679508711d3ca881c4c6593e9247](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=43897111481b679508711d3ca881c4c6593e9247) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=43897111481b679508711d3ca881c4c6593e9247)) | |
| tree | [8301c6cc3da86ccd35d724446a442c9897eb68e7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=43897111481b679508711d3ca881c4c6593e9247) | |
| parent | [48c20cecc48eb773cf4b22ee82a3336f48c0d59c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43897111481b679508711d3ca881c4c6593e9247&id2=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)) | |
| download | [linux-43897111481b679508711d3ca881c4c6593e9247.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-43897111481b679508711d3ca881c4c6593e9247.tar.gz) | |

wifi: mac80211: don't use rate mask for offchannel TX either[ Upstream commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b ]
Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.
The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.
As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.
[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024
Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com](https://patch.msgid.link/20240729074816.20323-1-pkshih%40realtek.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=43897111481b679508711d3ca881c4c6593e9247)

| -rw-r--r-- | [include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=43897111481b679508711d3ca881c4c6593e9247) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=43897111481b679508711d3ca881c4c6593e9247) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=43897111481b679508711d3ca881c4c6593e9247) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=43897111481b679508711d3ca881c4c6593e9247) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=43897111481b679508711d3ca881c4c6593e9247) | 2 | |  |  |  | | --- | --- | --- | |

5 files changed, 8 insertions, 6 deletions

| diff --git a/include/net/mac80211.h b/include/net/mac80211.hindex 0a04eaf5343c64..fae37598c11069 100644--- a/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)+++ b/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=43897111481b679508711d3ca881c4c6593e9247)@@ -994,8 +994,9 @@ enum mac80211\_tx\_info\_flags { \* of their QoS TID or other priority field values. \* @IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX: first MLO TX, used mostly internally \* for sequence number assignment- \* @IEEE80211\_TX\_CTRL\_SCAN\_TX: Indicates that this frame is transmitted- \* due to scanning, not in normal operation on the interface.+ \* @IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK: Don't use rate mask for this frame+ \* which is transmitted due to scanning or offchannel TX, not in normal+ \* operation on the interface. \* @IEEE80211\_TX\_CTRL\_MLO\_LINK: If not @IEEE80211\_LINK\_UNSPECIFIED, this \* frame should be transmitted on the specific link. This really is \* only relevant for frames that do not have data present, and is@@ -1016,7 +1017,7 @@ enum mac80211\_tx\_control\_flags { IEEE80211\_TX\_CTRL\_NO\_SEQNO = BIT(7), IEEE80211\_TX\_CTRL\_DONT\_REORDER = BIT(8), IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX = BIT(9),- IEEE80211\_TX\_CTRL\_SCAN\_TX = BIT(10),+ IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK = BIT(10), IEEE80211\_TX\_CTRL\_MLO\_LINK = 0xf0000000, }; diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.cindex 28d03196ef75a7..29fab7ae47b4c7 100644--- a/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)+++ b/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=43897111481b679508711d3ca881c4c6593e9247)@@ -997,6 +997,7 @@ int ieee80211\_mgmt\_tx(struct wiphy \*wiphy, struct wireless\_dev \*wdev, }  IEEE80211\_SKB\_CB(skb)->flags = flags;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK;  skb->dev = sdata->dev; diff --git a/net/mac80211/rate.c b/net/mac80211/rate.cindex 4dc1def6954865..3dc9752188d58f 100644--- a/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)+++ b/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=43897111481b679508711d3ca881c4c6593e9247)@@ -890,7 +890,7 @@ void ieee80211\_get\_tx\_rates(struct ieee80211\_vif \*vif, if (ieee80211\_is\_tx\_data(skb)) rate\_control\_apply\_mask(sdata, sta, sband, dest, max\_rates); - if (!(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX))+ if (!(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) mask = sdata->rc\_rateidx\_mask[info->band];  if (dest[0].idx < 0)diff --git a/net/mac80211/scan.c b/net/mac80211/scan.cindex b5f2df61c7f671..1c5d99975ad04d 100644--- a/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)+++ b/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=43897111481b679508711d3ca881c4c6593e9247)@@ -649,7 +649,7 @@ static void ieee80211\_send\_scan\_probe\_req(struct ieee80211\_sub\_if\_data \*sdata, cpu\_to\_le16(IEEE80211\_SN\_TO\_SEQ(sn)); } IEEE80211\_SKB\_CB(skb)->flags |= tx\_flags;- IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_SCAN\_TX;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK; ieee80211\_tx\_skb\_tid\_band(sdata, skb, 7, channel->band); } }diff --git a/net/mac80211/tx.c b/net/mac80211/tx.cindex bca7b341dd772d..a9ee8698225929 100644--- a/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=48c20cecc48eb773cf4b22ee82a3336f48c0d59c)+++ b/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=43897111481b679508711d3ca881c4c6593e9247)@@ -699,7 +699,7 @@ ieee80211\_tx\_h\_rate\_ctrl(struct ieee80211\_tx\_data \*tx) txrc.skb = tx->skb; txrc.reported\_rate.idx = -1; - if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX)) {+ if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) { txrc.rate\_idx\_mask = ~0; } else { txrc.rate\_idx\_mask = tx->sdata->rc\_rateidx\_mask[info->band]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:09:28 +0000



=== Content from git.kernel.org_655d3ca7_20250111_201050.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-07-29 15:48:16 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:32:21 +0200 |
| commit | [3565ef215101ffadb5fe5394c70b1fca51376b25](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3565ef215101ffadb5fe5394c70b1fca51376b25) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)) | |
| tree | [52e859209b4eb12d8c2a8be00989226ec85e0303](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | |
| parent | [2bee86e57407acd676012247f665b4b1f42d8e6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2bee86e57407acd676012247f665b4b1f42d8e6d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25&id2=2bee86e57407acd676012247f665b4b1f42d8e6d)) | |
| download | [linux-3565ef215101ffadb5fe5394c70b1fca51376b25.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3565ef215101ffadb5fe5394c70b1fca51376b25.tar.gz) | |

wifi: mac80211: don't use rate mask for offchannel TX either[ Upstream commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b ]
Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.
The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.
As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.
[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024
Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com](https://patch.msgid.link/20240729074816.20323-1-pkshih%40realtek.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25)

| -rw-r--r-- | [include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25) | 2 | |  |  |  | | --- | --- | --- | |

5 files changed, 8 insertions, 6 deletions

| diff --git a/include/net/mac80211.h b/include/net/mac80211.hindex 45ad37adbe3287..7b3f56d862de40 100644--- a/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=2bee86e57407acd676012247f665b4b1f42d8e6d)+++ b/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=3565ef215101ffadb5fe5394c70b1fca51376b25)@@ -953,8 +953,9 @@ enum mac80211\_tx\_info\_flags { \* of their QoS TID or other priority field values. \* @IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX: first MLO TX, used mostly internally \* for sequence number assignment- \* @IEEE80211\_TX\_CTRL\_SCAN\_TX: Indicates that this frame is transmitted- \* due to scanning, not in normal operation on the interface.+ \* @IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK: Don't use rate mask for this frame+ \* which is transmitted due to scanning or offchannel TX, not in normal+ \* operation on the interface. \* @IEEE80211\_TX\_CTRL\_MLO\_LINK: If not @IEEE80211\_LINK\_UNSPECIFIED, this \* frame should be transmitted on the specific link. This really is \* only relevant for frames that do not have data present, and is@@ -975,7 +976,7 @@ enum mac80211\_tx\_control\_flags { IEEE80211\_TX\_CTRL\_NO\_SEQNO = BIT(7), IEEE80211\_TX\_CTRL\_DONT\_REORDER = BIT(8), IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX = BIT(9),- IEEE80211\_TX\_CTRL\_SCAN\_TX = BIT(10),+ IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK = BIT(10), IEEE80211\_TX\_CTRL\_MLO\_LINK = 0xf0000000, }; diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.cindex 65e1e9e971fd69..5810d938edc44c 100644--- a/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d)+++ b/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25)@@ -964,6 +964,7 @@ int ieee80211\_mgmt\_tx(struct wiphy \*wiphy, struct wireless\_dev \*wdev, }  IEEE80211\_SKB\_CB(skb)->flags = flags;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK;  skb->dev = sdata->dev; diff --git a/net/mac80211/rate.c b/net/mac80211/rate.cindex 4dc1def6954865..3dc9752188d58f 100644--- a/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d)+++ b/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25)@@ -890,7 +890,7 @@ void ieee80211\_get\_tx\_rates(struct ieee80211\_vif \*vif, if (ieee80211\_is\_tx\_data(skb)) rate\_control\_apply\_mask(sdata, sta, sband, dest, max\_rates); - if (!(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX))+ if (!(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) mask = sdata->rc\_rateidx\_mask[info->band];  if (dest[0].idx < 0)diff --git a/net/mac80211/scan.c b/net/mac80211/scan.cindex b5f2df61c7f671..1c5d99975ad04d 100644--- a/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d)+++ b/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25)@@ -649,7 +649,7 @@ static void ieee80211\_send\_scan\_probe\_req(struct ieee80211\_sub\_if\_data \*sdata, cpu\_to\_le16(IEEE80211\_SN\_TO\_SEQ(sn)); } IEEE80211\_SKB\_CB(skb)->flags |= tx\_flags;- IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_SCAN\_TX;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK; ieee80211\_tx\_skb\_tid\_band(sdata, skb, 7, channel->band); } }diff --git a/net/mac80211/tx.c b/net/mac80211/tx.cindex bca7b341dd772d..a9ee8698225929 100644--- a/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d)+++ b/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25)@@ -699,7 +699,7 @@ ieee80211\_tx\_h\_rate\_ctrl(struct ieee80211\_tx\_data \*tx) txrc.skb = tx->skb; txrc.reported\_rate.idx = -1; - if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX)) {+ if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) { txrc.rate\_idx\_mask = ~0; } else { txrc.rate\_idx\_mask = tx->sdata->rc\_rateidx\_mask[info->band]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:09:27 +0000



=== Content from git.kernel.org_cb28caf2_20250111_201052.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-07-29 15:48:16 +0800 |
| --- | --- | --- |
| committer | Johannes Berg <johannes.berg@intel.com> | 2024-08-27 10:13:23 +0200 |
| commit | [e7a7ef9a0742dbd0818d5b15fba2c5313ace765b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)) | |
| tree | [afec116de062a1177d86c9575e5ebb8a4c5f8d4d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | |
| parent | [ea63fb71993c56628f323b8268d36f4bbd836a7f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ea63fb71993c56628f323b8268d36f4bbd836a7f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b&id2=ea63fb71993c56628f323b8268d36f4bbd836a7f)) | |
| download | [linux-e7a7ef9a0742dbd0818d5b15fba2c5313ace765b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e7a7ef9a0742dbd0818d5b15fba2c5313ace765b.tar.gz) | |

wifi: mac80211: don't use rate mask for offchannel TX eitherLike the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.
The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.
As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.
[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024
Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com](https://patch.msgid.link/20240729074816.20323-1-pkshih%40realtek.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)

| -rw-r--r-- | [include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b) | 2 | |  |  |  | | --- | --- | --- | |

5 files changed, 8 insertions, 6 deletions

| diff --git a/include/net/mac80211.h b/include/net/mac80211.hindex 9406f687cffb7e..de50dc8712c044 100644--- a/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=ea63fb71993c56628f323b8268d36f4bbd836a7f)+++ b/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)@@ -994,8 +994,9 @@ enum mac80211\_tx\_info\_flags { \* of their QoS TID or other priority field values. \* @IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX: first MLO TX, used mostly internally \* for sequence number assignment- \* @IEEE80211\_TX\_CTRL\_SCAN\_TX: Indicates that this frame is transmitted- \* due to scanning, not in normal operation on the interface.+ \* @IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK: Don't use rate mask for this frame+ \* which is transmitted due to scanning or offchannel TX, not in normal+ \* operation on the interface. \* @IEEE80211\_TX\_CTRL\_MLO\_LINK: If not @IEEE80211\_LINK\_UNSPECIFIED, this \* frame should be transmitted on the specific link. This really is \* only relevant for frames that do not have data present, and is@@ -1016,7 +1017,7 @@ enum mac80211\_tx\_control\_flags { IEEE80211\_TX\_CTRL\_NO\_SEQNO = BIT(7), IEEE80211\_TX\_CTRL\_DONT\_REORDER = BIT(8), IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX = BIT(9),- IEEE80211\_TX\_CTRL\_SCAN\_TX = BIT(10),+ IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK = BIT(10), IEEE80211\_TX\_CTRL\_MLO\_LINK = 0xf0000000, }; diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.cindex 28d03196ef75a7..29fab7ae47b4c7 100644--- a/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=ea63fb71993c56628f323b8268d36f4bbd836a7f)+++ b/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)@@ -997,6 +997,7 @@ int ieee80211\_mgmt\_tx(struct wiphy \*wiphy, struct wireless\_dev \*wdev, }  IEEE80211\_SKB\_CB(skb)->flags = flags;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK;  skb->dev = sdata->dev; diff --git a/net/mac80211/rate.c b/net/mac80211/rate.cindex 4dc1def6954865..3dc9752188d58f 100644--- a/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=ea63fb71993c56628f323b8268d36f4bbd836a7f)+++ b/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)@@ -890,7 +890,7 @@ void ieee80211\_get\_tx\_rates(struct ieee80211\_vif \*vif, if (ieee80211\_is\_tx\_data(skb)) rate\_control\_apply\_mask(sdata, sta, sband, dest, max\_rates); - if (!(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX))+ if (!(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) mask = sdata->rc\_rateidx\_mask[info->band];  if (dest[0].idx < 0)diff --git a/net/mac80211/scan.c b/net/mac80211/scan.cindex b5f2df61c7f671..1c5d99975ad04d 100644--- a/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=ea63fb71993c56628f323b8268d36f4bbd836a7f)+++ b/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)@@ -649,7 +649,7 @@ static void ieee80211\_send\_scan\_probe\_req(struct ieee80211\_sub\_if\_data \*sdata, cpu\_to\_le16(IEEE80211\_SN\_TO\_SEQ(sn)); } IEEE80211\_SKB\_CB(skb)->flags |= tx\_flags;- IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_SCAN\_TX;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK; ieee80211\_tx\_skb\_tid\_band(sdata, skb, 7, channel->band); } }diff --git a/net/mac80211/tx.c b/net/mac80211/tx.cindex 72a9ba8bc5fd97..0c79584922cc3b 100644--- a/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=ea63fb71993c56628f323b8268d36f4bbd836a7f)+++ b/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=e7a7ef9a0742dbd0818d5b15fba2c5313ace765b)@@ -699,7 +699,7 @@ ieee80211\_tx\_h\_rate\_ctrl(struct ieee80211\_tx\_data \*tx) txrc.skb = tx->skb; txrc.reported\_rate.idx = -1; - if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX)) {+ if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) { txrc.rate\_idx\_mask = ~0; } else { txrc.rate\_idx\_mask = tx->sdata->rc\_rateidx\_mask[info->band]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:09:29 +0000



=== Content from git.kernel.org_2deadc15_20250111_201051.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ping-Ke Shih <pkshih@realtek.com> | 2024-07-29 15:48:16 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-04 16:28:52 +0200 |
| commit | [d54455a3a965feb547711aff7afd2ca5deadb99c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d54455a3a965feb547711aff7afd2ca5deadb99c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)) | |
| tree | [bab8ea563330da28068fcdf7ed6253abe11cc4c3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | |
| parent | [3b839d4619042b02eecdfc986484ac6e6be6acbf](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3b839d4619042b02eecdfc986484ac6e6be6acbf) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d54455a3a965feb547711aff7afd2ca5deadb99c&id2=3b839d4619042b02eecdfc986484ac6e6be6acbf)) | |
| download | [linux-d54455a3a965feb547711aff7afd2ca5deadb99c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d54455a3a965feb547711aff7afd2ca5deadb99c.tar.gz) | |

wifi: mac80211: don't use rate mask for offchannel TX either[ Upstream commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b ]
Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.
The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.
As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.
[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024
Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih <pkshih@realtek.com>
Link: [https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com](https://patch.msgid.link/20240729074816.20323-1-pkshih%40realtek.com)
Signed-off-by: Johannes Berg <johannes.berg@intel.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d54455a3a965feb547711aff7afd2ca5deadb99c)

| -rw-r--r-- | [include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | 7 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | 1 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | 2 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c) | 2 | |  |  |  | | --- | --- | --- | |

5 files changed, 8 insertions, 6 deletions

| diff --git a/include/net/mac80211.h b/include/net/mac80211.hindex a39bd4169f2926..47ade676565dbc 100644--- a/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=3b839d4619042b02eecdfc986484ac6e6be6acbf)+++ b/[include/net/mac80211.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=d54455a3a965feb547711aff7afd2ca5deadb99c)@@ -936,8 +936,9 @@ enum mac80211\_tx\_info\_flags { \* of their QoS TID or other priority field values. \* @IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX: first MLO TX, used mostly internally \* for sequence number assignment- \* @IEEE80211\_TX\_CTRL\_SCAN\_TX: Indicates that this frame is transmitted- \* due to scanning, not in normal operation on the interface.+ \* @IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK: Don't use rate mask for this frame+ \* which is transmitted due to scanning or offchannel TX, not in normal+ \* operation on the interface. \* @IEEE80211\_TX\_CTRL\_MLO\_LINK: If not @IEEE80211\_LINK\_UNSPECIFIED, this \* frame should be transmitted on the specific link. This really is \* only relevant for frames that do not have data present, and is@@ -958,7 +959,7 @@ enum mac80211\_tx\_control\_flags { IEEE80211\_TX\_CTRL\_NO\_SEQNO = BIT(7), IEEE80211\_TX\_CTRL\_DONT\_REORDER = BIT(8), IEEE80211\_TX\_CTRL\_MCAST\_MLO\_FIRST\_TX = BIT(9),- IEEE80211\_TX\_CTRL\_SCAN\_TX = BIT(10),+ IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK = BIT(10), IEEE80211\_TX\_CTRL\_MLO\_LINK = 0xf0000000, }; diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.cindex 5bedd9cef414d0..2517a5521a5780 100644--- a/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=3b839d4619042b02eecdfc986484ac6e6be6acbf)+++ b/[net/mac80211/offchannel.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c)@@ -940,6 +940,7 @@ int ieee80211\_mgmt\_tx(struct wiphy \*wiphy, struct wireless\_dev \*wdev, }  IEEE80211\_SKB\_CB(skb)->flags = flags;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK;  skb->dev = sdata->dev; diff --git a/net/mac80211/rate.c b/net/mac80211/rate.cindex 3cf252418bd38c..78e7ac6c0af0b0 100644--- a/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=3b839d4619042b02eecdfc986484ac6e6be6acbf)+++ b/[net/mac80211/rate.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c)@@ -890,7 +890,7 @@ void ieee80211\_get\_tx\_rates(struct ieee80211\_vif \*vif, if (ieee80211\_is\_tx\_data(skb)) rate\_control\_apply\_mask(sdata, sta, sband, dest, max\_rates); - if (!(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX))+ if (!(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) mask = sdata->rc\_rateidx\_mask[info->band];  if (dest[0].idx < 0)diff --git a/net/mac80211/scan.c b/net/mac80211/scan.cindex 3d68db738cde45..b58d061333c523 100644--- a/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=3b839d4619042b02eecdfc986484ac6e6be6acbf)+++ b/[net/mac80211/scan.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c)@@ -636,7 +636,7 @@ static void ieee80211\_send\_scan\_probe\_req(struct ieee80211\_sub\_if\_data \*sdata, cpu\_to\_le16(IEEE80211\_SN\_TO\_SEQ(sn)); } IEEE80211\_SKB\_CB(skb)->flags |= tx\_flags;- IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_SCAN\_TX;+ IEEE80211\_SKB\_CB(skb)->control.flags |= IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK; ieee80211\_tx\_skb\_tid\_band(sdata, skb, 7, channel->band); } }diff --git a/net/mac80211/tx.c b/net/mac80211/tx.cindex 415e951e4138a5..45a093d3f1fa7f 100644--- a/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=3b839d4619042b02eecdfc986484ac6e6be6acbf)+++ b/[net/mac80211/tx.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=d54455a3a965feb547711aff7afd2ca5deadb99c)@@ -706,7 +706,7 @@ ieee80211\_tx\_h\_rate\_ctrl(struct ieee80211\_tx\_data \*tx) txrc.skb = tx->skb; txrc.reported\_rate.idx = -1; - if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_SCAN\_TX)) {+ if (unlikely(info->control.flags & IEEE80211\_TX\_CTRL\_DONT\_USE\_RATE\_MASK)) { txrc.rate\_idx\_mask = ~0; } else { txrc.rate\_idx\_mask = tx->sdata->rc\_rateidx\_mask[info->band]; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 20:09:29 +0000


