<!DOCTYPE html>
<html lang='en'>
<head>
<title>wifi: mac80211: don't use rate mask for offchannel TX either - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='3565ef215101ffadb5fe5394c70b1fca51376b25'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='3565ef215101ffadb5fe5394c70b1fca51376b25'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='3565ef215101ffadb5fe5394c70b1fca51376b25'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Ping-Ke Shih &lt;pkshih@realtek.com&gt;</td><td class='right'>2024-07-29 15:48:16 +0800</td></tr>
<tr><th>committer</th><td>Greg Kroah-Hartman &lt;gregkh@linuxfoundation.org&gt;</td><td class='right'>2024-10-04 16:32:21 +0200</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>3565ef215101ffadb5fe5394c70b1fca51376b25</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>52e859209b4eb12d8c2a8be00989226ec85e0303</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>2bee86e57407acd676012247f665b4b1f42d8e6d</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25&amp;id2=2bee86e57407acd676012247f665b4b1f42d8e6d'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3565ef215101ffadb5fe5394c70b1fca51376b25.tar.gz'>linux-3565ef215101ffadb5fe5394c70b1fca51376b25.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>wifi: mac80211: don't use rate mask for offchannel TX either</div><div class='commit-msg'>[ Upstream commit e7a7ef9a0742dbd0818d5b15fba2c5313ace765b ]

Like the commit ab9177d83c04 ("wifi: mac80211: don't use rate mask for
scanning"), ignore incorrect settings to avoid no supported rate warning
reported by syzbot.

The syzbot did bisect and found cause is commit 9df66d5b9f45 ("cfg80211:
fix default HE tx bitrate mask in 2G band"), which however corrects
bitmask of HE MCS and recognizes correctly settings of empty legacy rate
plus HE MCS rate instead of returning -EINVAL.

As suggestions [1], follow the change of SCAN TX to consider this case of
offchannel TX as well.

[1] https://lore.kernel.org/linux-wireless/6ab2dc9c3afe753ca6fdcdd1421e7a1f47e87b84.camel@sipsolutions.net/T/#m2ac2a6d2be06a37c9c47a3d8a44b4f647ed4f024

Reported-by: syzbot+8dd98a9e98ee28dc484a@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/linux-wireless/000000000000fdef8706191a3f7b@google.com/
Fixes: 9df66d5b9f45 ("cfg80211: fix default HE tx bitrate mask in 2G band")
Signed-off-by: Ping-Ke Shih &lt;pkshih@realtek.com&gt;
Link: <a href="https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com">https://patch.msgid.link/20240729074816.20323-1-pkshih@realtek.com</a>
Signed-off-by: Johannes Berg &lt;johannes.berg@intel.com&gt;
Signed-off-by: Sasha Levin &lt;sashal@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/include/net/mac80211.h?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>include/net/mac80211.h</a></td><td class='right'>7</td><td class='graph'><table summary='file diffstat' width='7%'><tr><td class='add' style='width: 57.1%;'/><td class='rem' style='width: 42.9%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/offchannel.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/offchannel.c</a></td><td class='right'>1</td><td class='graph'><table summary='file diffstat' width='7%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 85.7%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/rate.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/rate.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='7%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 14.3%;'/><td class='none' style='width: 71.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/scan.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/scan.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='7%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 14.3%;'/><td class='none' style='width: 71.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/net/mac80211/tx.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/tx.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='7%'><tr><td class='add' style='width: 14.3%;'/><td class='rem' style='width: 14.3%;'/><td class='none' style='width: 71.4%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>5 files changed, 8 insertions, 6 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/include/net/mac80211.h b/include/net/mac80211.h<br/>index 45ad37adbe3287..7b3f56d862de40 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>include/net/mac80211.h</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/include/net/mac80211.h?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>include/net/mac80211.h</a></div><div class='hunk'>@@ -953,8 +953,9 @@ enum mac80211_tx_info_flags {</div><div class='ctx'>  *	of their QoS TID or other priority field values.</div><div class='ctx'>  * @IEEE80211_TX_CTRL_MCAST_MLO_FIRST_TX: first MLO TX, used mostly internally</div><div class='ctx'>  *	for sequence number assignment</div><div class='del'>- * @IEEE80211_TX_CTRL_SCAN_TX: Indicates that this frame is transmitted</div><div class='del'>- *	due to scanning, not in normal operation on the interface.</div><div class='add'>+ * @IEEE80211_TX_CTRL_DONT_USE_RATE_MASK: Don't use rate mask for this frame</div><div class='add'>+ *	which is transmitted due to scanning or offchannel TX, not in normal</div><div class='add'>+ *	operation on the interface.</div><div class='ctx'>  * @IEEE80211_TX_CTRL_MLO_LINK: If not @IEEE80211_LINK_UNSPECIFIED, this</div><div class='ctx'>  *	frame should be transmitted on the specific link. This really is</div><div class='ctx'>  *	only relevant for frames that do not have data present, and is</div><div class='hunk'>@@ -975,7 +976,7 @@ enum mac80211_tx_control_flags {</div><div class='ctx'> 	IEEE80211_TX_CTRL_NO_SEQNO		= BIT(7),</div><div class='ctx'> 	IEEE80211_TX_CTRL_DONT_REORDER		= BIT(8),</div><div class='ctx'> 	IEEE80211_TX_CTRL_MCAST_MLO_FIRST_TX	= BIT(9),</div><div class='del'>-	IEEE80211_TX_CTRL_SCAN_TX		= BIT(10),</div><div class='add'>+	IEEE80211_TX_CTRL_DONT_USE_RATE_MASK	= BIT(10),</div><div class='ctx'> 	IEEE80211_TX_CTRL_MLO_LINK		= 0xf0000000,</div><div class='ctx'> };</div><div class='ctx'> </div><div class='head'>diff --git a/net/mac80211/offchannel.c b/net/mac80211/offchannel.c<br/>index 65e1e9e971fd69..5810d938edc44c 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>net/mac80211/offchannel.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/offchannel.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/offchannel.c</a></div><div class='hunk'>@@ -964,6 +964,7 @@ int ieee80211_mgmt_tx(struct wiphy *wiphy, struct wireless_dev *wdev,</div><div class='ctx'> 	}</div><div class='ctx'> </div><div class='ctx'> 	IEEE80211_SKB_CB(skb)-&gt;flags = flags;</div><div class='add'>+	IEEE80211_SKB_CB(skb)-&gt;control.flags |= IEEE80211_TX_CTRL_DONT_USE_RATE_MASK;</div><div class='ctx'> </div><div class='ctx'> 	skb-&gt;dev = sdata-&gt;dev;</div><div class='ctx'> </div><div class='head'>diff --git a/net/mac80211/rate.c b/net/mac80211/rate.c<br/>index 4dc1def6954865..3dc9752188d58f 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>net/mac80211/rate.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/rate.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/rate.c</a></div><div class='hunk'>@@ -890,7 +890,7 @@ void ieee80211_get_tx_rates(struct ieee80211_vif *vif,</div><div class='ctx'> 	if (ieee80211_is_tx_data(skb))</div><div class='ctx'> 		rate_control_apply_mask(sdata, sta, sband, dest, max_rates);</div><div class='ctx'> </div><div class='del'>-	if (!(info-&gt;control.flags &amp; IEEE80211_TX_CTRL_SCAN_TX))</div><div class='add'>+	if (!(info-&gt;control.flags &amp; IEEE80211_TX_CTRL_DONT_USE_RATE_MASK))</div><div class='ctx'> 		mask = sdata-&gt;rc_rateidx_mask[info-&gt;band];</div><div class='ctx'> </div><div class='ctx'> 	if (dest[0].idx &lt; 0)</div><div class='head'>diff --git a/net/mac80211/scan.c b/net/mac80211/scan.c<br/>index b5f2df61c7f671..1c5d99975ad04d 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>net/mac80211/scan.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/scan.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/scan.c</a></div><div class='hunk'>@@ -649,7 +649,7 @@ static void ieee80211_send_scan_probe_req(struct ieee80211_sub_if_data *sdata,</div><div class='ctx'> 				cpu_to_le16(IEEE80211_SN_TO_SEQ(sn));</div><div class='ctx'> 		}</div><div class='ctx'> 		IEEE80211_SKB_CB(skb)-&gt;flags |= tx_flags;</div><div class='del'>-		IEEE80211_SKB_CB(skb)-&gt;control.flags |= IEEE80211_TX_CTRL_SCAN_TX;</div><div class='add'>+		IEEE80211_SKB_CB(skb)-&gt;control.flags |= IEEE80211_TX_CTRL_DONT_USE_RATE_MASK;</div><div class='ctx'> 		ieee80211_tx_skb_tid_band(sdata, skb, 7, channel-&gt;band);</div><div class='ctx'> 	}</div><div class='ctx'> }</div><div class='head'>diff --git a/net/mac80211/tx.c b/net/mac80211/tx.c<br/>index bca7b341dd772d..a9ee8698225929 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=2bee86e57407acd676012247f665b4b1f42d8e6d'>net/mac80211/tx.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/net/mac80211/tx.c?id=3565ef215101ffadb5fe5394c70b1fca51376b25'>net/mac80211/tx.c</a></div><div class='hunk'>@@ -699,7 +699,7 @@ ieee80211_tx_h_rate_ctrl(struct ieee80211_tx_data *tx)</div><div class='ctx'> 	txrc.skb = tx-&gt;skb;</div><div class='ctx'> 	txrc.reported_rate.idx = -1;</div><div class='ctx'> </div><div class='del'>-	if (unlikely(info-&gt;control.flags &amp; IEEE80211_TX_CTRL_SCAN_TX)) {</div><div class='add'>+	if (unlikely(info-&gt;control.flags &amp; IEEE80211_TX_CTRL_DONT_USE_RATE_MASK)) {</div><div class='ctx'> 		txrc.rate_idx_mask = ~0;</div><div class='ctx'> 	} else {</div><div class='ctx'> 		txrc.rate_idx_mask = tx-&gt;sdata-&gt;rc_rateidx_mask[info-&gt;band];</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-11 20:09:27 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
