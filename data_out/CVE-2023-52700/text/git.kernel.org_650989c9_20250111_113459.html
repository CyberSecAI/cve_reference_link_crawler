

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tung Nguyen <tung.q.nguyen@dektech.com.au> | 2023-02-14 01:26:06 +0000 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2023-02-14 20:46:24 -0800 |
| commit | [11a4d6f67cf55883dc78e31c247d1903ed7feccc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)) | |
| tree | [9d38220e5133a7792620740ac4a99b9f2ce40fd0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc) | |
| parent | [207ce626add80ddd941f62fc2fe5d77586e0801b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=207ce626add80ddd941f62fc2fe5d77586e0801b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc&id2=207ce626add80ddd941f62fc2fe5d77586e0801b)) | |
| download | [linux-11a4d6f67cf55883dc78e31c247d1903ed7feccc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-11a4d6f67cf55883dc78e31c247d1903ed7feccc.tar.gz) | |

tipc: fix kernel warning when sending SYN messageWhen sending a SYN message, this kernel stack trace is observed:
...
[ 13.396352] RIP: 0010:\_copy\_from\_iter+0xb4/0x550
...
[ 13.398494] Call Trace:
[ 13.398630] <TASK>
[ 13.398630] ? \_\_alloc\_skb+0xed/0x1a0
[ 13.398630] tipc\_msg\_build+0x12c/0x670 [tipc]
[ 13.398630] ? shmem\_add\_to\_page\_cache.isra.71+0x151/0x290
[ 13.398630] \_\_tipc\_sendmsg+0x2d1/0x710 [tipc]
[ 13.398630] ? tipc\_connect+0x1d9/0x230 [tipc]
[ 13.398630] ? \_\_local\_bh\_enable\_ip+0x37/0x80
[ 13.398630] tipc\_connect+0x1d9/0x230 [tipc]
[ 13.398630] ? \_\_sys\_connect+0x9f/0xd0
[ 13.398630] \_\_sys\_connect+0x9f/0xd0
[ 13.398630] ? preempt\_count\_add+0x4d/0xa0
[ 13.398630] ? fpregs\_assert\_state\_consistent+0x22/0x50
[ 13.398630] \_\_x64\_sys\_connect+0x16/0x20
[ 13.398630] do\_syscall\_64+0x42/0x90
[ 13.398630] entry\_SYSCALL\_64\_after\_hwframe+0x63/0xcd
It is because commit a41dad905e5a ("iov\_iter: saner checks for attempt
to copy to/from iterator") has introduced sanity check for copying
from/to iov iterator. Lacking of copy direction from the iterator
viewpoint would lead to kernel stack trace like above.
This commit fixes this issue by initializing the iov iterator with
the correct copy direction when sending SYN or ACK without data.
Fixes: f25dcc7687d4 ("tipc: tipc ->sendmsg() conversion")
Reported-by: syzbot+d43608d061e8847ec9f3@syzkaller.appspotmail.com
Acked-by: Jon Maloy <jmaloy@redhat.com>
Signed-off-by: Tung Nguyen <tung.q.nguyen@dektech.com.au>
Link: [https://lore.kernel.org/r/20230214012606.5804-1-tung.q.nguyen@dektech.com.au](https://lore.kernel.org/r/20230214012606.5804-1-tung.q.nguyen%40dektech.com.au)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)

| -rw-r--r-- | [net/tipc/socket.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/tipc/socket.c?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/net/tipc/socket.c b/net/tipc/socket.cindex b35c8701876a2f..a38733f2197ae3 100644--- a/[net/tipc/socket.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/socket.c?id=207ce626add80ddd941f62fc2fe5d77586e0801b)+++ b/[net/tipc/socket.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/tipc/socket.c?id=11a4d6f67cf55883dc78e31c247d1903ed7feccc)@@ -2614,6 +2614,7 @@ static int tipc\_connect(struct socket \*sock, struct sockaddr \*dest, /\* Send a 'SYN-' to destination \*/ m.msg\_name = dest; m.msg\_namelen = destlen;+ iov\_iter\_kvec(&m.msg\_iter, ITER\_SOURCE, NULL, 0, 0);  /\* If connect is in non-blocking case, set MSG\_DONTWAIT to \* indicate send\_msg() is never blocked.@@ -2776,6 +2777,7 @@ static int tipc\_accept(struct socket \*sock, struct socket \*new\_sock, int flags, \_\_skb\_queue\_head(&new\_sk->sk\_receive\_queue, buf); skb\_set\_owner\_r(buf, new\_sk); }+ iov\_iter\_kvec(&m.msg\_iter, ITER\_SOURCE, NULL, 0, 0); \_\_tipc\_sendstream(new\_sock, &m, 0); release\_sock(new\_sk); exit: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 11:33:36 +0000

