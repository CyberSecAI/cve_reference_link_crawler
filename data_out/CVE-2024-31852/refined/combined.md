=== Content from bugs.chromium.org_1908be49_20250110_123558.html ===



=== Content from github.com_cd0f94bb_20250110_123559.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fllvm%2Fllvm-project%2Fissues%2F80287)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fllvm%2Fllvm-project%2Fissues%2F80287)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=llvm%2Fllvm-project)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[llvm](/llvm)
/
**[llvm-project](/llvm/llvm-project)**
Public

* [Notifications](/login?return_to=%2Fllvm%2Fllvm-project) You must be signed in to change notification settings
* [Fork
  12.4k](/login?return_to=%2Fllvm%2Fllvm-project)
* [Star
   30k](/login?return_to=%2Fllvm%2Fllvm-project)

* [Code](/llvm/llvm-project)
* [Issues
  5k+](/llvm/llvm-project/issues)
* [Pull requests
  3.7k](/llvm/llvm-project/pulls)
* [Actions](/llvm/llvm-project/actions)
* [Security](/llvm/llvm-project/security)
* [Insights](/llvm/llvm-project/pulse)

Additional navigation options

* [Code](/llvm/llvm-project)
* [Issues](/llvm/llvm-project/issues)
* [Pull requests](/llvm/llvm-project/pulls)
* [Actions](/llvm/llvm-project/actions)
* [Security](/llvm/llvm-project/security)
* [Insights](/llvm/llvm-project/pulse)

# [Bug][Clang][ARM] Wrong assembly code generation, "LR" corrupted. #80287

[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy link[New issue](/login?return_to=)[Jump to bottom](#comment-composer-heading)Copy linkClosed[#82745](https://github.com/llvm/llvm-project/pull/82745)Closed[[Bug][Clang][ARM] Wrong assembly code generation, "LR" corrupted.](#top)#80287[#82745](https://github.com/llvm/llvm-project/pull/82745)Copy linkAssignees [![ostannard](https://avatars.githubusercontent.com/u/3903045?s=64&v=4)](/ostannard)Labels[backend:ARM](https://github.com/llvm/llvm-project/labels/backend%3AARM)[release:backport](https://github.com/llvm/llvm-project/labels/release%3Abackport)Milestone[LLVM 18.X Release](https://github.com/llvm/llvm-project/milestone/23)![@P1119r1m](https://avatars.githubusercontent.com/u/9807907?u=55cf226d00eb887b8e61b047f26518f468e133c4&v=4&size=80)
## Description

![@P1119r1m](https://avatars.githubusercontent.com/u/9807907?u=55cf226d00eb887b8e61b047f26518f468e133c4&v=4&size=48)[P1119r1m](https://github.com/P1119r1m)opened [on Feb 1, 2024](https://github.com/llvm/llvm-project/issues/80287#issue-2112446046)

The Clang compiler generates code for a function that overwrites the `lr` register without saving its data on stack beforehand.

This bug was detected on a large software component and the problem was minimized to a PoC (see [example.c](https://godbolt.org/z/7PKxqj7vx)).

Clang versions info:

* llvmorg-17-init - bug wasn't detected
* llvmorg-17.0.2 - bug detected
* llvmorg-17.0.6 - bug detected
* llvmorg-18-init - bug detected

Host OS: Ubuntu 20.04.3 LTS

In disassembler the bug looks like this (generated `example.c.o.objdump`):

```
00000010 <BUGGY_FUNCTION>:
;     if (!ctx) {
      10:     	cmp	r0, #0
      14:     	beq	0x48 <BUGGY_FUNCTION+0x38> @ imm = #0x2c                <-- Goto 0x48 if "(!ctx)" is True.
;     ctx->cmd_c = func_2;
      18:     	ldr	r12, [pc, #0x40]        @ 0x60 <BUGGY_FUNCTION+0x50>    <-- Continue if "(!ctx)" is False.
      1c:     	mov	r1, r0
      20:     	mov	r0, #0
;     ctx->cmd_a = func_0;
      24:     	add	lr, r1, #8              <-- ERROR. THIS LOOKS CRAZY!!! "lr" WAS NOT STORED ON THE STACK!
;     ctx->cmd_c = func_2;
      28:     	ldr	r12, [pc, r12]
... < SOME OTHER CODE > ...
      44:     	bx	lr                      <-- ERROR. BRANCH TO "lr" ADDRESS THAT WAS PREVIOUSLY CORRUPTED!!!
      48:     	push	{r11, lr}
... < SOME OTHER CODE > ...

```

Steps to reproduce.

* example.c

```
void __attribute__((optnone)) printer(int line) {}

#define INFO() printer(__LINE__);

extern int func_0(void);
extern int func_1(void);
extern int func_2(void);

typedef int (*f_ptr_t)(void);

typedef struct operation {
    double double_0;
    f_ptr_t cmd_a;
    f_ptr_t cmd_b;
    f_ptr_t cmd_c;
    f_ptr_t cmd_d;
} operation_t;

int BUGGY_FUNCTION(operation_t *ctx)
{
    // INFO(); // UNCOMMENT TO FIX ASSEMBLY CODE GENERATION!!!
    if (!ctx) {
        INFO()
        return -1;
    }
    ctx->cmd_a = func_0;
    ctx->cmd_b = func_1;
    ctx->cmd_c = func_2;
    ctx->cmd_d = (void *)0;
    return 0;
}

```

* reproduce.sh

```
#!/bin/bash

SDK_BIN_PATH=<PUT YOUR BIN PATH LOCATION HERE>

CC="${SDK_BIN_PATH}/armv7-none-gnueabi-clang"
OBJDUMP="${SDK_BIN_PATH}/armv7-none-gnueabi-objdump"

INPUT_FILE=example.c
OBJ_FILE=example.c.o
OBJDUMP_FILE=example.c.o.objdump

echo "Compile and objdump..." \
&& "${CC}" -ggdb -Os -fPIE -c "${INPUT_FILE}" -o "${OBJ_FILE}" \
&& "${OBJDUMP}" -dS "${OBJ_FILE}" | tee "${OBJDUMP_FILE}"

```
## Activity

[Sign up for free](/signup?return_to=) **to join this conversation on GitHub.** Already have an account? [Sign in to comment](/login?return_to=)
## Metadata

### Assignees

* [![@ostannard](https://avatars.githubusercontent.com/u/3903045?s=64&v=4)ostannard](/ostannard)
### Labels

[backend:ARM](https://github.com/llvm/llvm-project/labels/backend%3AARM)[release:backport](https://github.com/llvm/llvm-project/labels/release%3Abackport)
### Type

No type
### Projects

[LLVM Release Status](https://github.com/orgs/llvm/projects/3)

* Status

  Done

### Milestone

* [LLVM 18.X Release](https://github.com/llvm/llvm-project/milestone/23)
### Relationships

None yet
### Development

No branches or pull requests
## Issue actions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_81ce692d_20250110_123600.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fllvmbot%2Fllvm-project%2Fcommit%2F0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fllvmbot%2Fllvm-project%2Fcommit%2F0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=llvmbot%2Fllvm-project)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[llvmbot](/llvmbot)
/
**[llvm-project](/llvmbot/llvm-project)**
Public

forked from [llvm/llvm-project](/llvm/llvm-project)

* [Notifications](/login?return_to=%2Fllvmbot%2Fllvm-project) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fllvmbot%2Fllvm-project)
* [Star
   4](/login?return_to=%2Fllvmbot%2Fllvm-project)

* [Code](/llvmbot/llvm-project)
* [Issues
  3](/llvmbot/llvm-project/issues)
* [Pull requests
  19](/llvmbot/llvm-project/pulls)
* [Actions](/llvmbot/llvm-project/actions)
* [Projects
  0](/llvmbot/llvm-project/projects)
* [Security](/llvmbot/llvm-project/security)
* [Insights](/llvmbot/llvm-project/pulse)

Additional navigation options

* [Code](/llvmbot/llvm-project)
* [Issues](/llvmbot/llvm-project/issues)
* [Pull requests](/llvmbot/llvm-project/pulls)
* [Actions](/llvmbot/llvm-project/actions)
* [Projects](/llvmbot/llvm-project/projects)
* [Security](/llvmbot/llvm-project/security)
* [Insights](/llvmbot/llvm-project/pulse)

## Commit

[Permalink](/llvmbot/llvm-project/commit/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

[ARM] Update IsRestored for LR based on all returns ([llvm#82745](https://github.com/llvm/llvm-project/pull/82745))

[Browse files](/llvmbot/llvm-project/tree/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2)
Browse the repository at this point in the history

```
PR [llvm#75527](https://github.com/llvm/llvm-project/pull/75527) fixed ARMFrameLowering to set the IsRestored flag for LR based
on all of the return instructions in the function, not just one.
However, there is also code in ARMLoadStoreOptimizer which changes
return instructions, but it set IsRestored based on the one instruction
it changed, not the whole function.

The fix is to factor out the code added in [llvm#75527](https://github.com/llvm/llvm-project/pull/75527), and also call it from
ARMLoadStoreOptimizer if it made a change to return instructions.

Fixes [llvm#80287](https://github.com/llvm/llvm-project/issues/80287).

(cherry picked from commit [749384c](https://github.com/llvmbot/llvm-project/commit/749384c08e042739342c88b521c8ba5dac1b9276))
```

* Loading branch information

[![@ostannard](https://avatars.githubusercontent.com/u/3903045?s=40&v=4)](/ostannard) [![@llvmbot](https://avatars.githubusercontent.com/u/60944935?s=40&v=4)](/llvmbot)

[ostannard](/llvmbot/llvm-project/commits?author=ostannard "View all commits by ostannard")
authored and
[llvmbot](/llvmbot/llvm-project/commits?author=llvmbot "View all commits by llvmbot")
committed
Mar 23, 2024

1 parent
[6f8016f](/llvmbot/llvm-project/commit/6f8016fda7d56013a26d6f9bf2bd157aff4b13fa)

commit 0e16af8

 Show file tree

 Hide file tree

Showing
**4 changed files**
with
**27 additions**
and
**22 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* llvm

  + lib/Target/ARM

    - llvm/lib/Target/ARM/ARMFrameLowering.cpp
      [ARMFrameLowering.cpp](#diff-12f26de293375a936a688e79626c748a3c40b983784a99f9952f0f82078bbc6c)
    - llvm/lib/Target/ARM/ARMFrameLowering.h
      [ARMFrameLowering.h](#diff-018c3db7d7f005d3731ac62a62b72bd4f7024433e945757215fa8994a39522ee)
    - llvm/lib/Target/ARM/ARMLoadStoreOptimizer.cpp
      [ARMLoadStoreOptimizer.cpp](#diff-56a6cd22991433929a384e8b3c03e69d8cabe5b85191ac5e056396d8582b4eba)
  + test/CodeGen/ARM

    - llvm/test/CodeGen/ARM/ldst-opt-lr-restored.ll
      [ldst-opt-lr-restored.ll](#diff-e6e324060f0e2098670fe337b7631002b2b2ec8cb7d9954d6b2010b4aa8be8a5)

## There are no files selected for viewing

11 changes: 7 additions & 4 deletions

11
[llvm/lib/Target/ARM/ARMFrameLowering.cpp](#diff-12f26de293375a936a688e79626c748a3c40b983784a99f9952f0f82078bbc6c "llvm/lib/Target/ARM/ARMFrameLowering.cpp")

Show comments

[View file](/llvmbot/llvm-project/blob/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2/llvm/lib/Target/ARM/ARMFrameLowering.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2781,10 +2781,7 @@ void ARMFrameLowering::determineCalleeSaves(MachineFunction &MF, |
|  |  | AFI->setLRIsSpilled(SavedRegs.test(ARM::LR)); |
|  |  | } |
|  |  |  |
|  |  | void ARMFrameLowering::processFunctionBeforeFrameFinalized( |
|  |  | MachineFunction &MF, RegScavenger \*RS) const { |
|  |  | TargetFrameLowering::processFunctionBeforeFrameFinalized(MF, RS); |
|  |  |  |
|  |  | void ARMFrameLowering::updateLRRestored(MachineFunction &MF) { |
|  |  | MachineFrameInfo &MFI = MF.getFrameInfo(); |
|  |  | if (!MFI.isCalleeSavedInfoValid()) |
|  |  | return; |
| Expand All | | @@ -2808,6 +2805,12 @@ void ARMFrameLowering::processFunctionBeforeFrameFinalized( |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | void ARMFrameLowering::processFunctionBeforeFrameFinalized( |
|  |  | MachineFunction &MF, RegScavenger \*RS) const { |
|  |  | TargetFrameLowering::processFunctionBeforeFrameFinalized(MF, RS); |
|  |  | updateLRRestored(MF); |
|  |  | } |
|  |  |  |
|  |  | void ARMFrameLowering::getCalleeSaves(const MachineFunction &MF, |
|  |  | BitVector &SavedRegs) const { |
|  |  | TargetFrameLowering::getCalleeSaves(MF, SavedRegs); |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[llvm/lib/Target/ARM/ARMFrameLowering.h](#diff-018c3db7d7f005d3731ac62a62b72bd4f7024433e945757215fa8994a39522ee "llvm/lib/Target/ARM/ARMFrameLowering.h")

Show comments

[View file](/llvmbot/llvm-project/blob/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2/llvm/lib/Target/ARM/ARMFrameLowering.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -59,6 +59,10 @@ class ARMFrameLowering : public TargetFrameLowering { |
|  |  | void determineCalleeSaves(MachineFunction &MF, BitVector &SavedRegs, |
|  |  | RegScavenger \*RS) const override; |
|  |  |  |
|  |  | /// Update the IsRestored flag on LR if it is spilled, based on the return |
|  |  | /// instructions. |
|  |  | static void updateLRRestored(MachineFunction &MF); |
|  |  |  |
|  |  | void processFunctionBeforeFrameFinalized( |
|  |  | MachineFunction &MF, RegScavenger \*RS = nullptr) const override; |
|  |  |  |
| Expand Down | |  |

23 changes: 10 additions & 13 deletions

23
[llvm/lib/Target/ARM/ARMLoadStoreOptimizer.cpp](#diff-56a6cd22991433929a384e8b3c03e69d8cabe5b85191ac5e056396d8582b4eba "llvm/lib/Target/ARM/ARMLoadStoreOptimizer.cpp")

Show comments

[View file](/llvmbot/llvm-project/blob/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2/llvm/lib/Target/ARM/ARMLoadStoreOptimizer.cpp)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2062,17 +2062,6 @@ bool ARMLoadStoreOpt::MergeReturnIntoLDM(MachineBasicBlock &MBB) { |
|  |  | MO.setReg(ARM::PC); |
|  |  | PrevMI.copyImplicitOps(\*MBB.getParent(), \*MBBI); |
|  |  | MBB.erase(MBBI); |
|  |  | // We now restore LR into PC so it is not live-out of the return block |
|  |  | // anymore: Clear the CSI Restored bit. |
|  |  | MachineFrameInfo &MFI = MBB.getParent()->getFrameInfo(); |
|  |  | // CSI should be fixed after PrologEpilog Insertion |
|  |  | assert(MFI.isCalleeSavedInfoValid() && "CSI should be valid"); |
|  |  | for (CalleeSavedInfo &Info : MFI.getCalleeSavedInfo()) { |
|  |  | if (Info.getReg() == ARM::LR) { |
|  |  | Info.setRestored(false); |
|  |  | break; |
|  |  | } |
|  |  | } |
|  |  | return true; |
|  |  | } |
|  |  | } |
| Expand Down  Expand Up | | @@ -2120,14 +2109,22 @@ bool ARMLoadStoreOpt::runOnMachineFunction(MachineFunction &Fn) { |
|  |  | isThumb2 = AFI->isThumb2Function(); |
|  |  | isThumb1 = AFI->isThumbFunction() && !isThumb2; |
|  |  |  |
|  |  | bool Modified = false; |
|  |  | bool Modified = false, ModifiedLDMReturn = false; |
|  |  | for (MachineBasicBlock &MBB : Fn) { |
|  |  | Modified |= LoadStoreMultipleOpti(MBB); |
|  |  | if (STI->hasV5TOps() && !AFI->shouldSignReturnAddress()) |
|  |  | Modified |= MergeReturnIntoLDM(MBB); |
|  |  | ModifiedLDMReturn |= MergeReturnIntoLDM(MBB); |
|  |  | if (isThumb1) |
|  |  | Modified |= CombineMovBx(MBB); |
|  |  | } |
|  |  | Modified |= ModifiedLDMReturn; |
|  |  |  |
|  |  | // If we merged a BX instruction into an LDM, we need to re-calculate whether |
|  |  | // LR is restored. This check needs to consider the whole function, not just |
|  |  | // the instruction(s) we changed, because there may be other BX returns which |
|  |  | // still need LR to be restored. |
|  |  | if (ModifiedLDMReturn) |
|  |  | ARMFrameLowering::updateLRRestored(Fn); |
|  |  |  |
|  |  | Allocator.DestroyAll(); |
|  |  | return Modified; |
| Expand Down | |  |

11 changes: 6 additions & 5 deletions

11
[llvm/test/CodeGen/ARM/ldst-opt-lr-restored.ll](#diff-e6e324060f0e2098670fe337b7631002b2b2ec8cb7d9954d6b2010b4aa8be8a5 "llvm/test/CodeGen/ARM/ldst-opt-lr-restored.ll")

Show comments

[View file](/llvmbot/llvm-project/blob/0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2/llvm/test/CodeGen/ARM/ldst-opt-lr-restored.ll)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -10,16 +10,17 @@ define i32 @foo(ptr %ctx) { |
|  |  | ; CHECK: @ %bb.0: @ %entry |
|  |  | ; CHECK-NEXT: cbz r0, .LBB0\_2 |
|  |  | ; CHECK-NEXT: @ %bb.1: @ %if.end |
|  |  | ; CHECK-NEXT: movw r12, :lower16:val2 |
|  |  | ; CHECK-NEXT: movw r3, :lower16:val1 |
|  |  | ; CHECK-NEXT: movw r2, :lower16:val0 |
|  |  | ; CHECK-NEXT: mov r1, r0 |
|  |  | ; CHECK-NEXT: movs r0, #0 |
|  |  | ; CHECK-NEXT: movw r12, :lower16:val2 |
|  |  | ; CHECK-NEXT: movw r3, :lower16:val1 |
|  |  | ; CHECK-NEXT: movt r2, :upper16:val0 |
|  |  | ; CHECK-NEXT: add.w lr, r1, #4 |
|  |  | ; CHECK-NEXT: movt r12, :upper16:val2 |
|  |  | ; CHECK-NEXT: movt r3, :upper16:val1 |
|  |  | ; CHECK-NEXT: stm.w lr, {r2, r3, r12} |
|  |  | ; CHECK-NEXT: movt r2, :upper16:val0 |
|  |  | ; CHECK-NEXT: str r2, [r1, #4] |
|  |  | ; CHECK-NEXT: str r3, [r1, #8] |
|  |  | ; CHECK-NEXT: str.w r12, [r1, #12] |
|  |  | ; CHECK-NEXT: str r0, [r1, #16] |
|  |  | ; CHECK-NEXT: bx lr |
|  |  | ; CHECK-NEXT: .LBB0\_2: @ %if.then |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `0e16af8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fllvmbot%2Fllvm-project%2Fcommit%2F0e16af8e4cf3a66ad5d078d52744ae2776f9c4b2) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from llvm.org_aba2ada8_20250110_123601.html ===

[![LLVM Logo](_static/logo.png)](index.html)

### Navigation

* [index](genindex.html "General Index")
* [next](SecurityTransparencyReports.html "LLVM Security Group Transparency Reports") |
* [previous](MemTagSanitizer.html "MemTagSanitizer") |
* [LLVM Home](https://llvm.org/) |
* [Documentation](index.html)»
* [Reference](Reference.html) »
* LLVM Security Response Group

### Documentation

* [Getting Started/Tutorials](https://llvm.org/docs/GettingStartedTutorials.html)
* [User Guides](https://llvm.org/docs/UserGuides.html)
* [Reference](https://llvm.org/docs/Reference.html)

### Getting Involved

* [Contributing to LLVM](https://llvm.org/docs/Contributing.html)
* [Submitting Bug Reports](https://llvm.org/docs/HowToSubmitABug.html)
* [Mailing Lists](https://llvm.org/docs/GettingInvolved.html#mailing-lists)
* [Discord](https://llvm.org/docs/GettingInvolved.html#discord)
* [Meetups and Social Events](https://llvm.org/docs/GettingInvolved.html#meetups-and-social-events)

### Additional Links

* [FAQ](https://llvm.org/docs/FAQ.html)
* [Glossary](https://llvm.org/docs/Lexicon.html)
* [Publications](https://llvm.org/pubs)
* [Github Repository](https://github.com/llvm/llvm-project/)

### This Page

* [Show Source](_sources/Security.rst.txt)

### Quick search

# LLVM Security Response Group[Â¶](#llvm-security-response-group "Link to this heading")

The LLVM Security Response Group has the following goals:

1. Allow LLVM contributors and security researchers to disclose security-related issues affecting the LLVM project to members of the LLVM community.
2. Organize fixes, code reviews, and release management for said issues.
3. Allow distributors time to investigate and deploy fixes before wide dissemination of vulnerabilities or mitigation shortcomings.
4. Ensure timely notification and release to vendors who package and distribute LLVM-based toolchains and projects.
5. Ensure timely notification to users of LLVM-based toolchains whose compiled code is security-sensitive, through the [CVE process](https://cve.mitre.org).

*Note*: these goals ensure timely action, provide disclosure timing when issues are reported, and respect vendorsâ / packagersâ / usersâ constraints.

The LLVM Security Response Group is private. It is composed of trusted LLVM contributors. Its discussions remain within the LLVM Security Response Group (plus issue reporter and key experts) while an issue is being investigated. After an issue becomes public, the entirety of the groupâs discussions pertaining to that issue also become public.

## How to report a security issue?[Â¶](#how-to-report-a-security-issue "Link to this heading")

To report a security issue in any of the LLVM projects, please use the [report a vulnerability](https://github.com/llvm/llvm-security-repo/security/advisories/new) feature in the [llvm/llvm-security-repo](https://github.com/llvm/llvm-security-repo/security) repository on github, under the âSecurityâ tab.

We aim to acknowledge your report within two business days since you first reach out. If you do not receive any response by then, you can escalate by posting on the [Discourse forums](https://discourse.llvm.org) asking to get in touch with someone from the LLVM Security Response Group. **The escalation mailing list is public**: avoid discussing or mentioning the specific issue when posting on it.

## Group Composition[Â¶](#group-composition "Link to this heading")

### Security Response Group Members[Â¶](#security-response-group-members "Link to this heading")

The members of the group represent a wide cross-section of the community, and
meet the criteria for inclusion below. The list is in the format
\* ${full\_name} (${affiliation}) [${github\_username}]. If a github
username for an individual isnât available, the brackets will be empty.

* Abhay Kanhere (Apple) [@AbhayKanhere]
* Ahmed Bougacha (Apple) [@ahmedbougacha]
* Artur Pilipenko (Azul Systems Inc) []
* Boovaragavan Dasarathan (Nvidia) [@mrragava]
* Dimitry Andric (individual; FreeBSD) [@DimitryAndric]
* Ed Maste (individual; FreeBSD) [@emaste]
* George Burgess IV (Google) [@gburgessiv]
* Josh Stone (Red Hat; Rust) [@cuviper]
* Kristof Beyls (ARM) [@kbeyls]
* Matthew Riley (Google) [@mmdriley]
* Matthew Voss (Sony) [@ormris]
* Nikhil Gupta (Nvidia) []
* Oliver Hunt (Apple) [@ojhunt]
* Peter Smith (ARM) [@smithp35]
* Pietro Albini (Ferrous Systems; Rust) [@pietroalbini]
* Serge Guelton (Mozilla) [@serge-sans-paille]
* Sergey Zverev (Intel) [@offsake]
* Shayne Hiet-Block (Microsoft) [@GreatKeeper]
* Tim Penge (Sony) [@tpenge]
* Tulio Magno Quites Machado Filho (Red Hat) [@tuliom]
* Will Huhn (Intel) [@wphuhn-intel]
* Yvan Roux (ST) [@yroux]

### Criteria[Â¶](#criteria "Link to this heading")

* Nominees for LLVM Security Response Group membership should fall in one of these groups:

  + Individual contributors:

    - Specializes in fixing compiler-based security related issues or often participates in their exploration and resolution.
    - Has a track record of finding security vulnerabilities and responsible disclosure of those vulnerabilities.
    - Is a compiler expert who has specific interests in knowing about, resolving, and preventing future security vulnerabilities.
    - Has actively contributed non-trivial code to the LLVM project in the last year.
  + Researchers:

    - Has a track record of finding security vulnerabilities and responsible disclosure of those vulnerabilities.
    - Is a compiler expert who has specific interests in knowing about, resolving, and preventing future security vulnerabilities.
  + Vendor contacts:

    - Represents an organization or company which ships products that include their own copy of LLVM. Due to their position in the organization, the nominee has a reasonable need to know about security issues and disclosure embargoes.
* Additionally, the following are necessary but not sufficient criteria for membership in the LLVM Security Response Group:

  + If already in the LLVM Security Response Group, has actively participated in one (if any) security issue in the last year.
  + If already in the LLVM Security Response Group, has actively participated in most membership discussions in the last year.
  + If already in the LLVM Security Response Group, has actively participated in writing or reviewing a transparency report in the last year.
  + When employed by a company or other entity, the parent entity has no more than three members already in the LLVM Security Response Group.
  + When nominated as a vendor contact, their position with that vendor remains the same as when originally nominated.
  + Nominees are trusted by existing LLVM Security Response Group members to keep communications embargoed while still active.

### Nomination process[Â¶](#nomination-process "Link to this heading")

Anyone who feels they meet these criteria can nominate themselves, or may be nominated by a third party such as an existing LLVM Security Response Group member. The nomination should state whether the nominee is nominated as an individual, researcher, or as a vendor contact. It should clearly describe the grounds for nomination.

For the moment, nominations are generally proposed, discussed, and voted on using a github pull request. An [example nomination is available here](https://github.com/llvm/llvm-project/pull/92174). The use of pull requests helps keep membership discussions open, transparent, and easily accessible to LLVM developers in many ways. If, for any reason, a fully-world-readable nomination seems inappropriate, you may reach out to the LLVM Security Response Group via the [report a vulnerability](https://github.com/llvm/llvm-security-repo/security/advisories/new) route, and a discussion can be had about the best way to approach nomination, given the constraints that individuals are under.

### Choosing new members[Â¶](#choosing-new-members "Link to this heading")

If a nomination for LLVM Security Response Group membership is supported by a majority of existing LLVM Security Response Group members, then it carries within five business days unless an existing member of the Security Response Group objects. If an objection is raised, the LLVM Security Response Group members should discuss the matter and try to come to consensus; failing this, the nomination will succeed only by a two-thirds supermajority vote of the LLVM Security Response Group.

### Accepting membership[Â¶](#accepting-membership "Link to this heading")

Before new LLVM Security Response Group membership is finalized, the successful nominee should accept membership and agree to abide by this security policy, particularly [Privileges and Responsibilities of LLVM Security Response Group Members](#privileges-and-responsibilities-of-llvm-security-response-group-members) below.

### Keeping Membership Current[Â¶](#keeping-membership-current "Link to this heading")

* At least every six months, the LLVM Security Response Group applies the above criteria. The membership list is pruned accordingly.
* Any LLVM Security Response Group member can ask that the criteria be applied within the next five business days.
* If a member of the LLVM Security Response Group does not act in accordance with the letter and spirit of this policy, then their LLVM Security Response Group membership can be revoked by a majority vote of the members, not including the person under consideration for revocation. After a member calls for a revocation vote, voting will be open for five business days.
* Emergency suspension: an LLVM Security Response Group member who blatantly disregards the LLVM Security Policy may have their membership temporarily suspended on the request of any two members. In such a case, the requesting members should notify the LLVM Security Response Group with a description of the offense. At this point, membership will be temporarily suspended for five business days, pending outcome of the vote for permanent revocation.
* The LLVM Board may remove any member from the LLVM Security Response Group.

### Transparency Report[Â¶](#transparency-report "Link to this heading")

Every year, the LLVM Security Response Group must publish a transparency report. The intent of this report is to keep the community informed by summarizing the disclosures that have been made public in the last year. It shall contain a list of all public disclosures, as well as statistics on time to fix issues, length of embargo periods, and so on.

The transparency reports are published at [LLVM Security Group Transparency Reports](SecurityTransparencyReports.html).

## Privileges and Responsibilities of LLVM Security Response Group Members[Â¶](#privileges-and-responsibilities-of-llvm-security-response-group-members "Link to this heading")

### Access[Â¶](#access "Link to this heading")

LLVM Security Response Group members will be subscribed to a private [Discussion Medium](#discussion-medium). It will be used for technical discussions of security issues, as well as process discussions about matters such as disclosure timelines and group membership. Members have access to all security issues.

### Confidentiality[Â¶](#confidentiality "Link to this heading")

Members of the LLVM Security Response Group will be expected to treat LLVM security issue information shared with the group as confidential until publicly disclosed:

* Members should not disclose security issue information to non-members unless both members are employed by the same vendor of a LLVM based product, in which case information can be shared within that organization on a need-to-know basis and handled as confidential information normally is within that organization.
* If the LLVM Security Response Group agrees, designated members may share issues with vendors of non-LLVM based products if their product suffers from the same issue. The non-LLVM vendor should be asked to respect the issueâs embargo date, and to not share the information beyond the need-to-know people within their organization.
* If the LLVM Security Response Group agrees, key experts can be brought in to help address particular issues. The key expert should be asked to respect the issueâs embargo date, and to not share the information.

### Disclosure[Â¶](#disclosure "Link to this heading")

Following the process below, the LLVM Security Response Group decides on embargo date for public disclosure for each Security issue. An embargo may be lifted before the agreed-upon date if all vendors planning to ship a fix have already done so, and if the reporter does not object.

### Collaboration[Â¶](#collaboration "Link to this heading")

Members of the LLVM Security Response Group are expected to:

* Promptly share any LLVM vulnerabilities they become aware of.
* Volunteer to drive issues forward.
* Help evaluate the severity of incoming issues.
* Help write and review patches to address security issues.
* Participate in the member nomination and removal processes.

## Discussion Medium[Â¶](#discussion-medium "Link to this heading")

The medium used to host LLVM Security Response Group discussions is security-sensitive. It should therefore run on infrastructure which can meet our security expectations.

We use [GitHubâs mechanism to privately report security vulnerabilities](https://docs.github.com/en/code-security/security-advisories/guidance-on-reporting-and-writing-information-about-vulnerabilities/privately-reporting-a-security-vulnerability) to have security discussions:

* File security issues.
* Discuss security improvements to LLVM.

We also occasionally need to discuss logistics of the LLVM Security Response Group itself:

* Nominate new members.
* Propose member removal.
* Suggest policy changes.

We often have these discussions publicly, in our [monthly public sync-up call](GettingInvolved.html#online-sync-ups) and on the Discourse forums. For internal or confidential discussions, we also use a private mailing list.

## Process[Â¶](#process "Link to this heading")

The following process occurs on the discussion medium for each reported issue:

* A security issue reporter (not necessarily an LLVM contributor) reports an issue.
* Within two business days, a member of the LLVM Security Response Group is put in charge of driving the issue to an acceptable resolution. This champion doesnât need to be the same person for each issue. This person can self-nominate.
* Members of the LLVM Security Response Group discuss in which circumstances (if any) an issue is relevant to security, and determine if it is a security issue.
* Negotiate an embargo date for public disclosure, with a default minimum time limit of ninety days.
* LLVM Security Response Group members can recommend that key experts be pulled in to specific issue discussions. The key expert can be pulled in unless there are objections from other LLVM Security Response Group members.
* Patches are written and reviewed.
* Backporting security patches from recent versions to old versions cannot always work. It is up to the LLVM Security Response Group to decide if such backporting should be done, and how far back.
* The LLVM Security Response Group figures out how the LLVM projectâs own releases, as well as individual vendorsâ releases, can be timed to patch the issue simultaneously.
* Embargo date can be delayed or pulled forward at the LLVM Security Response Groupâs discretion.
* The issue champion obtains a CVE entry from [MITRE](https://cve.mitre.org).
* Once the embargo expires, the patch is posted publicly according to LLVMâs usual code review process.
* All security issues (as well as nomination / removal discussions) become public within approximately fourteen weeks of the fix landing in the LLVM repository. Precautions should be taken to avoid disclosing particularly sensitive data included in the report (e.g. username and password pairs).

## Changes to the Policy[Â¶](#changes-to-the-policy "Link to this heading")

The LLVM Security Policy may be changed by majority vote of the LLVM Security Response Group. Such changes also need to be approved by the LLVM Board.

## What is considered a security issue?[Â¶](#what-is-considered-a-security-issue "Link to this heading")

The LLVM Project has a significant amount of code, and not all of it is
considered security-sensitive. This is particularly true because LLVM is used in
a wide variety of circumstances: there are different threat models, untrusted
inputs differ, and the environment LLVM runs in is varied. Therefore, what the
LLVM Project considers a security issue is what its members have signed up to
maintain securely.

As this security process matures, members of the LLVM community can propose that
a part of the codebase be designated as security-sensitive (or no longer
security-sensitive). This requires a rationale, and buy-in from the LLVM
community as for any RFC. In some cases, parts of the codebase could be handled
as security-sensitive but need significant work to get to the stage where thatâs
manageable. The LLVM community will need to decide whether it wants to invest in
making these parts of the code securable, and maintain these security
properties over time. In all cases the LLVM Security Response Group should be consulted,
since theyâll be responding to security issues filed against these parts of the
codebase.

If youâre not sure whether an issue is in-scope for this security process or
not, err towards assuming that it is. The Security Response Group might agree or disagree
and will explain its rationale in the report, as well as update this document
through the above process.

The security-sensitive parts of the LLVM Project currently are the following.
Note that this list can change over time.

* None are currently defined. Please donât let this stop you from reporting
  issues to the LLVM Security Response Group that you believe are security-sensitive.

The parts of the LLVM Project which are currently treated as non-security
sensitive are the following. Note that this list can change over time.

* Language front-ends, such as clang, for which a malicious input file can cause
  undesirable behavior. For example, a maliciously crafted C or Rust source file
  can cause arbitrary code to execute in LLVM. These parts of LLVM havenât been
  hardened, and compiling untrusted code usually also includes running utilities
  such as make which can more readily perform malicious things.

### Navigation

* [index](genindex.html "General Index")
* [next](SecurityTransparencyReports.html "LLVM Security Group Transparency Reports") |
* [previous](MemTagSanitizer.html "MemTagSanitizer") |
* [LLVM Home](https://llvm.org/) |
* [Documentation](index.html)»
* [Reference](Reference.html) »
* LLVM Security Response Group

© Copyright 2003-2025, LLVM Project.
Last updated on 2025-01-10.
Created using [Sphinx](https://www.sphinx-doc.org/) 7.2.6.


