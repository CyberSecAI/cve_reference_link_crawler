

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=00baca74fb5879e5f9034b6156671301f500f8ee)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00baca74fb5879e5f9034b6156671301f500f8ee)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00baca74fb5879e5f9034b6156671301f500f8ee)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00baca74fb5879e5f9034b6156671301f500f8ee)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mikulas Patocka <mpatocka@redhat.com> | 2024-07-27 20:22:52 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-11-22 15:37:35 +0100 |
| commit | [00baca74fb5879e5f9034b6156671301f500f8ee](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=00baca74fb5879e5f9034b6156671301f500f8ee) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=00baca74fb5879e5f9034b6156671301f500f8ee)) | |
| tree | [e824bbcd30765f143aa474d726f6dc897fc882f7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=00baca74fb5879e5f9034b6156671301f500f8ee) | |
| parent | [777595da53aa11e7e2fa0332a2c4b0511086be39](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=777595da53aa11e7e2fa0332a2c4b0511086be39) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00baca74fb5879e5f9034b6156671301f500f8ee&id2=777595da53aa11e7e2fa0332a2c4b0511086be39)) | |
| download | [linux-00baca74fb5879e5f9034b6156671301f500f8ee.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-00baca74fb5879e5f9034b6156671301f500f8ee.tar.gz) | |

parisc: fix a possible DMA corruptioncommit 7ae04ba36b381bffe2471eff3a93edced843240f upstream.
ARCH\_DMA\_MINALIGN was defined as 16 - this is too small - it may be
possible that two unrelated 16-byte allocations share a cache line. If
one of these allocations is written using DMA and the other is written
using cached write, the value that was written with DMA may be
corrupted.
This commit changes ARCH\_DMA\_MINALIGN to be 128 on PA20 and 32 on PA1.1 -
that's the largest possible cache line size.
As different parisc microarchitectures have different cache line size, we
define arch\_slab\_minalign(), cache\_line\_size() and
dma\_get\_cache\_alignment() so that the kernel may tune slab cache
parameters dynamically, based on the detected cache line size.
Signed-off-by: Mikulas Patocka <mpatocka@redhat.com>
Cc: stable@vger.kernel.org
Signed-off-by: Helge Deller <deller@gmx.de>
Signed-off-by: Bin Lan <bin.lan.cn@windriver.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=00baca74fb5879e5f9034b6156671301f500f8ee)

| -rw-r--r-- | [arch/parisc/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/parisc/Kconfig?id=00baca74fb5879e5f9034b6156671301f500f8ee) | 1 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/parisc/include/asm/cache.h](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/parisc/include/asm/cache.h?id=00baca74fb5879e5f9034b6156671301f500f8ee) | 11 | |  |  |  | | --- | --- | --- | |

2 files changed, 11 insertions, 1 deletions

| diff --git a/arch/parisc/Kconfig b/arch/parisc/Kconfigindex 3341d4a4219903..3a32b49d7ad0d9 100644--- a/[arch/parisc/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/parisc/Kconfig?id=777595da53aa11e7e2fa0332a2c4b0511086be39)+++ b/[arch/parisc/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/parisc/Kconfig?id=00baca74fb5879e5f9034b6156671301f500f8ee)@@ -18,6 +18,7 @@ config PARISC select ARCH\_SUPPORTS\_HUGETLBFS if PA20 select ARCH\_SUPPORTS\_MEMORY\_FAILURE select ARCH\_STACKWALK+ select ARCH\_HAS\_CACHE\_LINE\_SIZE select ARCH\_HAS\_DEBUG\_VM\_PGTABLE select HAVE\_RELIABLE\_STACKTRACE select DMA\_OPSdiff --git a/arch/parisc/include/asm/cache.h b/arch/parisc/include/asm/cache.hindex e23d06b51a2044..91e753f08eaa3d 100644--- a/[arch/parisc/include/asm/cache.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/parisc/include/asm/cache.h?id=777595da53aa11e7e2fa0332a2c4b0511086be39)+++ b/[arch/parisc/include/asm/cache.h](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/parisc/include/asm/cache.h?id=00baca74fb5879e5f9034b6156671301f500f8ee)@@ -20,7 +20,16 @@  #define SMP\_CACHE\_BYTES L1\_CACHE\_BYTES -#define ARCH\_DMA\_MINALIGN L1\_CACHE\_BYTES+#ifdef CONFIG\_PA20+#define ARCH\_DMA\_MINALIGN 128+#else+#define ARCH\_DMA\_MINALIGN 32+#endif+#define ARCH\_KMALLOC\_MINALIGN 16 /\* ldcw requires 16-byte alignment \*/++#define arch\_slab\_minalign() ((unsigned)dcache\_stride)+#define cache\_line\_size() dcache\_stride+#define dma\_get\_cache\_alignment cache\_line\_size  #define \_\_read\_mostly \_\_section(".data..read\_mostly") |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 18:55:14 +0000

