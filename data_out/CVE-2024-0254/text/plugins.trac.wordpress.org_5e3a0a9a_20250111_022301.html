

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fguest-author-name%2Ftrunk%2Fsfly-guest-author.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/guest-author-name/trunk/sfly-guest-author.php?rev=3030950 "Revision 3030950")
* Next Revision →
* [Blame](/browser/guest-author-name/trunk/sfly-guest-author.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/guest-author-name/trunk/sfly-guest-author.php)

---

# [source:](/browser?order=name "Go to repository root") [guest-author-name](/browser/guest-author-name?order=name "View guest-author-name")/[trunk](/browser/guest-author-name/trunk?order=name "View trunk")/[sfly-guest-author.php](/browser/guest-author-name/trunk/sfly-guest-author.php?order=name "View sfly-guest-author.php")

View diff against:

View revision:

| [Last change](/changeset/3034830/guest-author-name/trunk/sfly-guest-author.php "View differences") on this file was [3034830](/changeset/3034830/ "View changeset 3034830"), checked in by nomadcoder, [11 months ago](/timeline?from=2024-02-12T21%3A33%3A31Z&precision=second "See timeline at 02/12/2024 09:33:31 PM") |
| --- |
| Fix warning message / headers already sent by declaring comment\_list |
| **File size:** 33.2 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Author: Shoofly Solutions |
| [4](#L4) | Plugin Name: (Simply) Guest Author Name |
| [5](#L5) | Slug: guest-author-name |
| [6](#L6) | Plugin URI: http://plugins.shooflysolutions.com/guest-author-name |
| [7](#L7) | Description: An ideal plugin for cross posting. Guest Author Name helps you to publish posts by authors without having to add them as users. If the Guest Author field is filled in on the post, the Guest Author name will override the author.  The optional Url link allows you to link to another web site. |
| [8](#L8) | Version: 4.36 |
| [9](#L9) | Author URI: http://www.shooflysolutions.com |
| [10](#L10) | Copyright (C) 2015, 2016 Shoofly Solutions |
| [11](#L11) | Contact me at http://www.shooflysolutions.com\*/ |
| [12](#L12) | defined( 'ABSPATH' ) or die( 'No script kiddies please!' ); |
| [13](#L13) | remove\_filter('pre\_user\_description', 'wp\_filter\_kses'); |
| [14](#L14) |  |
| [15](#L15) |  |
| [16](#L16) |  |
| [17](#L17) |  |
| [18](#L18) | $path =  (plugin\_dir\_path(\_\_FILE\_\_)); |
| [19](#L19) | require\_once( $path . 'guest-author-notices.php' ); |
| [20](#L20) | require\_once( $path . 'sfly-guest-author-settings.php' ); |
| [21](#L21) |  |
| [22](#L22) | /\*\* |
| [23](#L23) | \* sfly\_guest\_author class. |
| [24](#L24) | \*/ |
| [25](#L25) | if ( !class\_exists( 'sfly\_guest\_author' ) ): |
| [26](#L26) |  |
| [27](#L27) | class sfly\_guest\_author |
| [28](#L28) | { |
| [29](#L29) | /\*\* |
| [30](#L30) | \* \_\_construct function. |
| [31](#L31) | \* |
| [32](#L32) | \* @access public |
| [33](#L33) | \* @return void |
| [34](#L34) | \*/ |
| [35](#L35) | private $comment\_list; |
| [36](#L36) | function \_\_construct() |
| [37](#L37) | { |
| [38](#L38) | $options = get\_option( 'guest\_author\_name\_settings' );  //load settings |
| [39](#L39) | self::sfly\_guest\_author\_add\_filters(); //add filters |
| [40](#L40) | $this->comment\_list = false; //flag to let us know if wp is printing comments |
| [41](#L41) | add\_action('wp\_enqueue\_scripts', array( $this, 'sfly\_guest\_author\_enqueue\_scripts' ) ); //enqueue scripts |
| [42](#L42) | add\_action( 'get\_sidebar', array($this, 'sfly\_guest\_author\_add\_filters' )); // action to disable plugin on the sidebar |
| [43](#L43) | $disable = isset( $options['guest\_author\_disable\_for\_comments'] ) ? true : false ; //disable guest authors for comment section |
| [44](#L44) |  |
| [45](#L45) | if ( $disable ) { |
| [46](#L46) | add\_filter( 'wp\_list\_comments\_args', array( $this, 'list\_comments' ) ); //manage comments |
| [47](#L47) | } |
| [48](#L48) |  |
| [49](#L49) |  |
| [50](#L50) |  |
| [51](#L51) | if (is\_admin()) //Admin page settings |
| [52](#L52) | { |
| [53](#L53) |  |
| [54](#L54) | add\_action( 'add\_meta\_boxes', array( $this, 'add\_meta\_box' ) ); //meta box settings |
| [55](#L55) | add\_action( 'save\_post', array( $this, 'save\_meta' ), 10, 2 );  //action when saving post |
| [56](#L56) | $quickedit = isset( $options['guest\_author\_name\_quickedit'] ) ? true : false ; //quick edit enabled? |
| [57](#L57) | if ( $quickedit ) //quick edit options |
| [58](#L58) | { |
| [59](#L59) | add\_action( 'quick\_edit\_custom\_box', array( $this, 'add\_quick\_meta\_box' ), 10, 2 ) ; |
| [60](#L60) | add\_action( 'manage\_posts\_custom\_column', array( $this, 'render\_post\_columns' ), 10, 2 ) ; |
| [61](#L61) | add\_filter( 'manage\_edit-post\_columns', array( $this, 'change\_posttype\_columns' ) ); |
| [62](#L62) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'guest\_admin\_scripts' ) ); |
| [63](#L63) | } |
| [64](#L64) | } |
| [65](#L65) |  |
| [66](#L66) | } |
| [67](#L67) |  |
| [68](#L68) | /\*\* |
| [69](#L69) | \* sfly\_guest\_author\_open\_link function is not being used currently. |
| [70](#L70) | \* append jQuery to existing script file |
| [71](#L71) | \* @access public |
| [72](#L72) | \* @return void |
| [73](#L73) | \*/ |
| [74](#L74) | function sfly\_guest\_author\_open\_link( $options, $open=true, $clear = false ){ //set the url to open in a new window |
| [75](#L75) |  |
| [76](#L76) | if ( $open || $clear ) { |
| [77](#L77) | $selector = esc\_attr(  $options['guest\_author\_url\_selector\_single'] ) ; |
| [78](#L78) | if ( $selector ) { |
| [79](#L79) | $script = ''; |
| [80](#L80) | if ( $open ) { |
| [81](#L81) | $script=" |
| [82](#L82) | (function($) { |
| [83](#L83) | var url      = window.location.href; |
| [84](#L84) | var href   =  jQuery('.sfly\_guest-author-post $selector' ).attr('href'); |
| [85](#L85) |  |
| [86](#L86) |  |
| [87](#L87) | if ( url != href ) { |
| [88](#L88) | $('.sfly\_guest-author-post $selector' ).attr('target', '\_blank'); |
| [89](#L89) | } |
| [90](#L90) | })(jQuery);"; |
| [91](#L91) | $success = wp\_add\_inline\_script('guest\_author\_post\_scripts', $script); |
| [92](#L92) |  |
| [93](#L93) |  |
| [94](#L94) |  |
| [95](#L95) | } |
| [96](#L96) | if ( $clear ) { |
| [97](#L97) | $script=" |
| [98](#L98) | (function($) { |
| [99](#L99) |  |
| [100](#L100) | $('.sfly\_guest-author-post $selector' ).contents().unwrap(); |
| [101](#L101) | })(jQuery);"; |
| [102](#L102) |  |
| [103](#L103) | $success = wp\_add\_inline\_script('guest\_author\_post\_scripts', $script); |
| [104](#L104) |  |
| [105](#L105) | } |
| [106](#L106) | } |
| [107](#L107) | } |
| [108](#L108) |  |
| [109](#L109) | } |
| [110](#L110) |  |
| [111](#L111) |  |
| [112](#L112) | /\*\* |
| [113](#L113) | \* sfly\_guest\_author\_enqueue\_scripts function. |
| [114](#L114) | \* Enqueue Scripts |
| [115](#L115) | \* @access public |
| [116](#L116) | \* @return void |
| [117](#L117) | \*/ |
| [118](#L118) | function sfly\_guest\_author\_enqueue\_scripts() { |
| [119](#L119) |  |
| [120](#L120) | $options = get\_option( 'guest\_author\_name\_settings' ); |
| [121](#L121) | $open = isset( $options['guest\_author\_open\_new\_window'] ) ? true : false ; |
| [122](#L122) | $clear = isset( $options['guest\_author\_remove\_link'] ) ? true : false ; |
| [123](#L123) |  |
| [124](#L124) | if ( $open  || $clear ) { |
| [125](#L125) | wp\_enqueue\_script('jquery'); |
| [126](#L126) |  |
| [127](#L127) | wp\_enqueue\_script( 'guest\_author\_post\_scripts' ,  plugins\_url('assets/guest-author-post.js', \_\_FILE\_\_), array('jquery'), '1.10', true); |
| [128](#L128) | $this->sfly\_guest\_author\_open\_link( $options, $open, $clear ); |
| [129](#L129) | } |
| [130](#L130) |  |
| [131](#L131) |  |
| [132](#L132) | } |
| [133](#L133) |  |
| [134](#L134) | /\*\* |
| [135](#L135) | \* sfly\_guest\_author\_add\_filters function. |
| [136](#L136) | \* Add Faliters |
| [137](#L137) | \* @access public |
| [138](#L138) | \* @return void |
| [139](#L139) | \*/ |
| [140](#L140) | function sfly\_guest\_author\_add\_filters() { |
| [141](#L141) | $admin = isset( $options['guest\_author\_name\_admin'] ) ? true : false ; |
| [142](#L142) |  |
| [143](#L143) | if (!is\_admin() || $admin || wp\_doing\_ajax() ) |
| [144](#L144) | { |
| [145](#L145) | add\_filter( 'the\_author', array( $this, 'guest\_author\_name' ), 12 ); |
| [146](#L146) | add\_filter( 'get\_the\_author\_display\_name', array( $this, 'guest\_author\_name' ), 12 ); |
| [147](#L147) |  |
| [148](#L148) | } |
| [149](#L149) | if (!is\_admin() || wp\_doing\_ajax() ) |
| [150](#L150) | { |
| [151](#L151) | add\_action ( 'ampforwp\_modify\_author\_name', array( $this, 'guest\_author\_name' ), 12 ); |
| [152](#L152) | add\_filter( 'get\_the\_author\_display\_name', array( $this, 'guest\_author\_name' ), 12 ); //10-2-2022 |
| [153](#L153) |  |
| [154](#L154) | add\_action( 'the\_post', array($this, 'register\_author' ), 10); |
| [155](#L155) | add\_filter( 'author\_link', array( $this, 'guest\_author\_link' ), 12 ); |
| [156](#L156) | add\_filter( 'get\_the\_author\_link', array( $this, 'guest\_author\_link' ), 12 ); |
| [157](#L157) | add\_filter( 'get\_the\_author\_url', array( $this, 'guest\_author\_link' ), 21 ); |
| [158](#L158) | add\_filter( 'ampforwp\_author\_description', array( $this, 'guest\_author\_description\_amp' ), 12 ) ; |
| [159](#L159) | add\_filter( 'author\_description', array( $this, 'guest\_author\_description'), 12) ; |
| [160](#L160) | add\_filter( 'get\_the\_author\_description', array( $this,  'guest\_author\_description' ), 12 ) ; |
| [161](#L161) | add\_filter( 'get\_the\_author\_id', array( $this, 'guest\_author\_id' ), 12 ) ; |
| [162](#L162) | add\_filter( 'author\_id', array( $this, 'guest\_author\_id' ), 12 ); |
| [163](#L163) | add\_filter( 'get\_avatar', array( $this, 'guest\_author\_avatar' ), 40, 5 ); |
| [164](#L164) | add\_filter( 'get\_avatar\_url', array( $this, 'guest\_avatar\_link' ), 40, 3); |
| [165](#L165) | $include = isset( $options['guest\_author\_include\_guest'] ) ? true : false ; |
| [166](#L166) |  |
| [167](#L167) | add\_filter( 'wpseo\_canonical', array( $this, 'guest\_author\_canonical\_link') ); |
| [168](#L168) | if ( $include ) |
| [169](#L169) | add\_action( 'pre\_get\_posts',     array( $this, 'author\_query' ) , 50 );   //Fix query for author query without guest posts or guest author |
| [170](#L170) |  |
| [171](#L171) | add\_filter("td\_wp\_booster\_module\_constructor", array( $this, 'set\_guest\_author\_ids' ), 10, 2   ); |
| [172](#L172) | add\_action('comment\_form\_top', array ($this, 'sfly\_guest\_author\_remove\_filters'), 10);  //remove filters before comments form |
| [173](#L173) | add\_filter( 'body\_class',        array( $this, 'sfly\_guest\_author\_body\_class') );            //add some classes to the body class |
| [174](#L174) |  |
| [175](#L175) | } |
| [176](#L176) | } |
| [177](#L177) | /\*\* |
| [178](#L178) | \* sfly\_guest\_author\_remove\_filters function. |
| [179](#L179) | \* Remove Filters |
| [180](#L180) | \* @access public |
| [181](#L181) | \* @return void |
| [182](#L182) | \*/ |
| [183](#L183) | function sfly\_guest\_author\_remove\_filters() { |
| [184](#L184) | remove\_action( 'the\_post', array($this, 'register\_author') ); |
| [185](#L185) | remove\_filter( 'author\_link', array( $this, 'guest\_author\_link' ) ); |
| [186](#L186) | remove\_filter( 'get\_the\_author\_link', array( $this, 'guest\_author\_link' ) ); |
| [187](#L187) | remove\_filter( 'get\_the\_author\_url', array( $this, 'guest\_author\_link' ) ); |
| [188](#L188) | remove\_filter( 'author\_description', array( $this, 'guest\_author\_description') ) ; |
| [189](#L189) | remove\_filter( 'get\_the\_author\_description', array( $this,  'guest\_author\_description' ) ) ; |
| [190](#L190) | remove\_filter( 'get\_the\_author\_id', array( $this, 'guest\_author\_id' ) ) ; |
| [191](#L191) | remove\_filter( 'author\_id', array( $this, 'guest\_author\_id' ) ); |
| [192](#L192) | remove\_filter( 'get\_avatar', array( $this, 'guest\_author\_avatar' ) ); |
| [193](#L193) | remove\_filter( 'get\_avatar\_url', array( $this, 'guest\_avatar\_link' ) ); |
| [194](#L194) | remove\_filter( 'wpseo\_canonical', array( $this, 'guest\_author\_canonical\_link') ); |
| [195](#L195) | remove\_action( 'pre\_get\_posts',     array( $this, 'author\_query' )  );   //Fix query for author query without guest posts or guest author |
| [196](#L196) | remove\_filter("td\_wp\_booster\_module\_constructor", array( $this, 'set\_guest\_author\_ids' )   ); |
| [197](#L197) | remove\_filter( 'the\_author', array( $this, 'guest\_author\_name' ) ); |
| [198](#L198) | remove\_filter( 'get\_the\_author\_display\_name', array( $this, 'guest\_author\_name' ) ); |
| [199](#L199) | remove\_filter( 'body\_class',        array( $this, 'sfly\_guest\_author\_body\_class') );            //add some classes to the body class |
| [200](#L200) | } |
| [201](#L201) | function sfly\_guest\_author\_excerpt( $content ) { |
| [202](#L202) | global $authordata; |
| [203](#L203) | if ( isset ($authordata) && $authordata->guest\_author ) { |
| [204](#L204) | $content = $content . '<label style="visibility:hidden" class="guest-author-data" data-url="' . $authordata->user\_url . '" data-name="' . $authordata->display\_name . '">'; |
| [205](#L205) | } |
| [206](#L206) | return $content; |
| [207](#L207) | } |
| [208](#L208) | function sfly\_guest\_author\_content( $content ) { |
| [209](#L209) | global $authordata; |
| [210](#L210) | if ( isset ($authordata) && $authordata->guest\_author ) { |
| [211](#L211) | $content = $content . '<label style="visibility:hidden" id="guest-author-data" data-url="' . $authordata->user\_url . '" data-name="' . $authordata->display\_name . '">'; |
| [212](#L212) | } |
| [213](#L213) | return $content; |
| [214](#L214) | } |
| [215](#L215) | /\*\* |
| [216](#L216) | \* guest\_author\_canonical\_link function. |
| [217](#L217) | \* Handle paging |
| [218](#L218) | \* @access public |
| [219](#L219) | \* @param mixed $url |
| [220](#L220) | \* @return void |
| [221](#L221) | \*/ |
| [222](#L222) | function guest\_author\_canonical\_link ($url) |
| [223](#L223) | { |
| [224](#L224) | global $wp; |
| [225](#L225) |  |
| [226](#L226) |  |
| [227](#L227) | $paged = (get\_query\_var('paged')) ? get\_query\_var('paged') : 1; |
| [228](#L228) | if ( $paged > 1 ) { |
| [229](#L229) |  |
| [230](#L230) | $current\_url = home\_url( add\_query\_arg( array(), $wp->request ) ); |
| [231](#L231) | if ($url != $current\_url) |
| [232](#L232) | return $current\_url; |
| [233](#L233) | } |
| [234](#L234) | return $url; |
| [235](#L235) |  |
| [236](#L236) | } |
| [237](#L237) |  |
| [238](#L238) | /\*\* |
| [239](#L239) | \* list\_comments function. |
| [240](#L240) | \* disable guest author functions for comment list |
| [241](#L241) | \* add hooks to ensure that the correct comment author & link |
| [242](#L242) | \* @access public |
| [243](#L243) | \* @param array $r  - arguments not changed) |
| [244](#L244) | \* @return void |
| [245](#L245) | \*/ |
| [246](#L246) | function list\_comments($r) |
| [247](#L247) | { |
| [248](#L248) |  |
| [249](#L249) | $this->comment\_list = true; |
| [250](#L250) | self::sfly\_guest\_author\_remove\_filters(); |
| [251](#L251) | global $guest\_author\_post\_id; |
| [252](#L252) |  |
| [253](#L253) | if ( $guest\_author\_post\_id != null ) |
| [254](#L254) | { |
| [255](#L255) |  |
| [256](#L256) | add\_filter( 'get\_comment\_author', array( $this, 'comment\_author' ), 99, 3); |
| [257](#L257) | add\_filter( 'get\_comment\_author\_link', array( $this, 'comment\_author\_link' ), 99, 3 ); |
| [258](#L258) | } |
| [259](#L259) | return $r; |
| [260](#L260) |  |
| [261](#L261) | } |
| [262](#L262) | /\*\* |
| [263](#L263) | \* comment\_author function. |
| [264](#L264) | \* get the original comment author which can be overriden when it's a guest author post. |
| [265](#L265) | \* @access public |
| [266](#L266) | \* @param string $author - author name |
| [267](#L267) | \* @param int $comment\_ID - comment id |
| [268](#L268) | \* @param object $comment |
| [269](#L269) | \* @return void |
| [270](#L270) | \*/ |
| [271](#L271) | function comment\_author( $author, $comment\_ID, $comment ) |
| [272](#L272) | { |
| [273](#L273) | if ( $author != $comment->author ) |
| [274](#L274) | return $comment->comment\_author; |
| [275](#L275) | else |
| [276](#L276) | return $author; |
| [277](#L277) |  |
| [278](#L278) |  |
| [279](#L279) |  |
| [280](#L280) | } |
| [281](#L281) | /\*\* |
| [282](#L282) | \* comment\_author\_link function. |
| [283](#L283) | \* |
| [284](#L284) | \* @access public |
| [285](#L285) | \* @param mixed $return |
| [286](#L286) | \* @param mixed $author  - author name |
| [287](#L287) | \* @param mixed $comment\_ID  - comment id |
| [288](#L288) | \* @return void |
| [289](#L289) | \*/ |
| [290](#L290) | function comment\_author\_link( $return, $author, $comment\_ID ) |
| [291](#L291) | { |
| [292](#L292) |  |
| [293](#L293) | $comment = get\_comment( $comment\_ID ); |
| [294](#L294) | if ( $author != $comment->author ) { |
| [295](#L295) | $url = $comment->comment\_author\_url; |
| [296](#L296) |  |
| [297](#L297) |  |
| [298](#L298) | if ( empty( $url ) || 'http://' == $url ) { |
| [299](#L299) | $return = $author; |
| [300](#L300) | } else { |
| [301](#L301) | $return = "<a href='$url' rel='external nofollow' class='url'>$author</a>"; |
| [302](#L302) | } |
| [303](#L303) | } |
| [304](#L304) | return $return; |
| [305](#L305) | } |
| [306](#L306) | /\*\* |
| [307](#L307) | \* is\_classic\_editor\_plugin\_active function. |
| [308](#L308) | \* check to see if the classic editor is active |
| [309](#L309) | \* @access public |
| [310](#L310) | \* @return void |
| [311](#L311) | \*/ |
| [312](#L312) | function is\_classic\_editor\_plugin\_active() { |
| [313](#L313) | if ( ! function\_exists( 'is\_plugin\_active' ) ) { |
| [314](#L314) | include\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | if ( is\_plugin\_active( 'classic-editor/classic-editor.php' ) ) { |
| [318](#L318) | return true; |
| [319](#L319) | } |
| [320](#L320) |  |
| [321](#L321) | return false; |
| [322](#L322) | } |
| [323](#L323) | /\*\* |
| [324](#L324) | \* sfly\_guest\_author\_body\_class function. |
| [325](#L325) | \* Add a class to the post body |
| [326](#L326) | \* @access public |
| [327](#L327) | \* @param mixed $classes |
| [328](#L328) | \* @return void |
| [329](#L329) | \*/ |
| [330](#L330) | function sfly\_guest\_author\_body\_class ($classes) { |
| [331](#L331) | global $post; |
| [332](#L332) | if ( is\_single() ) { |
| [333](#L333) | $author = esc\_attr(get\_post\_meta( $post->ID, 'sfly\_guest\_author\_names', true )); |
| [334](#L334) | if ($author) |
| [335](#L335) |  |
| [336](#L336) | $classes[] = 'sfly\_guest-author-post'; |
| [337](#L337) | } |
| [338](#L338) | return $classes; |
| [339](#L339) | } |
| [340](#L340) | /\*\* |
| [341](#L341) | \* register\_author function. |
| [342](#L342) | \* register the author data for the current post being edited |
| [343](#L343) | \* @access public |
| [344](#L344) | \* @return void |
| [345](#L345) | \*/ |
| [346](#L346) | function register\_author() { |
| [347](#L347) | $id = $this->get\_post\_id(); |
| [348](#L348) | $gauthor = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [349](#L349) | $guest\_author\_post\_id = null; |
| [350](#L350) | if (!$gauthor) |
| [351](#L351) | return; |
| [352](#L352) |  |
| [353](#L353) | global $authordata, $post, $guest\_author\_post\_id; |
| [354](#L354) | $guest\_author\_post\_id = $post->ID; |
| [355](#L355) | $author = new WP\_User(); |
| [356](#L356) |  |
| [357](#L357) | $author->user\_url = $this->guest\_author\_link(''); |
| [358](#L358) | $author->user\_email = $this->guest\_author\_email(''); |
| [359](#L359) | $author->user\_description = $this->guest\_author\_description(''); |
| [360](#L360) | $author->display\_name = $this->guest\_author\_name(''); |
| [361](#L361) | $author->ID = $this->guest\_author\_id(''); |
| [362](#L362) | $author->guest\_author = true; |
| [363](#L363) |  |
| [364](#L364) | // register the global |
| [365](#L365) | $authordata = $author; |
| [366](#L366) |  |
| [367](#L367) | } |
| [368](#L368) |  |
| [369](#L369) | /\*\* |
| [370](#L370) | \* guest\_admin\_scripts function. |
| [371](#L371) | \* enqueue scripts |
| [372](#L372) | \* @access public |
| [373](#L373) | \* @param string $hook |
| [374](#L374) | \* @return void |
| [375](#L375) | \*/ |
| [376](#L376) | function guest\_admin\_scripts( $hook ) |
| [377](#L377) | { |
| [378](#L378) |  |
| [379](#L379) | if ( $hook == 'edit.php' ) { |
| [380](#L380) | wp\_enqueue\_script('guest\_author\_name\_scripts', plugins\_url('assets/guest-author.js', \_\_FILE\_\_), array('inline-edit-post'), '1.00'); |
| [381](#L381) |  |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | } |
| [385](#L385) | /\*\* |
| [386](#L386) | \* guest\_author\_id function. |
| [387](#L387) | \* get the author id |
| [388](#L388) | \* @access public |
| [389](#L389) | \* @param number $id |
| [390](#L390) | \* @return the author id or null if it's a guest author |
| [391](#L391) | \*/ |
| [392](#L392) | function guest\_author\_id( $id ) { |
| [393](#L393) | $id = $this->get\_post\_id(); |
| [394](#L394) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [395](#L395) | if ( $author ) |
| [396](#L396) | $id = NULL; |
| [397](#L397) | return $id; |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | /\*\* |
| [401](#L401) | \* author\_query function. |
| [402](#L402) | \* |
| [403](#L403) | \* @access public |
| [404](#L404) | \* @param mixed $query |
| [405](#L405) | \* @return void |
| [406](#L406) | \*/ |
| [407](#L407) | function author\_query( $query ) { |
| [408](#L408) | if ( $query->is\_author ) |
| [409](#L409) | { |
| [410](#L410) | $meta\_query = $query->get('meta\_query'); |
| [411](#L411) | if ( is\_string($meta\_query) ) |
| [412](#L412) | { |
| [413](#L413) | if ($meta\_query == '' ) |
| [414](#L414) | $meta\_query = array(); |
| [415](#L415) | else |
| [416](#L416) | $meta\_query = array ( $meta\_query ); |
| [417](#L417) | } |
| [418](#L418) | //Add our meta query to the original meta queries |
| [419](#L419) | $meta\_query['relation'] = "OR"; |
| [420](#L420) | $meta\_query[] =  array( |
| [421](#L421) | 'key'     => 'sfly\_guest\_author\_names', |
| [422](#L422) | 'compare' => 'NOT EXISTS', |
| [423](#L423) | 'value' => '' |
| [424](#L424) | ); |
| [425](#L425) | $meta\_query[] =  array( |
| [426](#L426) | 'key'     => 'sfly\_guest\_author\_names', |
| [427](#L427) | 'compare' => '=', |
| [428](#L428) | 'value' => '' |
| [429](#L429) | ); |
| [430](#L430) | $query->set('meta\_query',$meta\_query); |
| [431](#L431) | } |
| [432](#L432) |  |
| [433](#L433) | return $query; |
| [434](#L434) | } |
| [435](#L435) |  |
| [436](#L436) |  |
| [437](#L437) | /\*\* |
| [438](#L438) | \* guest\_author\_name function. |
| [439](#L439) | \* get the guest author name if one exists |
| [440](#L440) | \* @access public |
| [441](#L441) | \* @param string $name |
| [442](#L442) | \* @return name to be displayed as the author name |
| [443](#L443) | \*/ |
| [444](#L444) | function guest\_author\_name( $name ) { |
| [445](#L445) | $id = $this->get\_post\_id(); |
| [446](#L446) |  |
| [447](#L447) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [448](#L448) | if ( $author ) { |
| [449](#L449) | $name = $author; |
| [450](#L450) |  |
| [451](#L451) | } |
| [452](#L452) | return $name; |
| [453](#L453) | } |
| [454](#L454) | /\*\* |
| [455](#L455) | \* guest\_author\_link function. |
| [456](#L456) | \* get the guest author url if one exists |
| [457](#L457) | \* @access public |
| [458](#L458) | \* @param string $link - real author link |
| [459](#L459) | \* @return string |
| [460](#L460) | \*/ |
| [461](#L461) | function guest\_author\_link( $link ) { |
| [462](#L462) | $id = $this->get\_post\_id(); |
| [463](#L463) | $author = esc\_attr( get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [464](#L464) | if ( $author ) |
| [465](#L465) | { |
| [466](#L466) | $link = get\_post\_meta( $id, 'sfly\_guest\_link', true ); |
| [467](#L467) | if (!$link) |
| [468](#L468) | $link = ""; |
| [469](#L469) | } |
| [470](#L470) | return $link; |
| [471](#L471) | } |
| [472](#L472) | /\*\* |
| [473](#L473) | \* guest\_author\_description function. |
| [474](#L474) | \* get the guest author bio if it exists |
| [475](#L475) | \* @access public |
| [476](#L476) | \* @param string $description - real author bio |
| [477](#L477) | \* @return string |
| [478](#L478) | \*/ |
| [479](#L479) | function guest\_author\_description( $description ) { |
| [480](#L480) | $id = $this->get\_post\_id(); |
| [481](#L481) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [482](#L482) | if ( $author ) |
| [483](#L483) | { |
| [484](#L484) | $options = get\_option( 'guest\_author\_name\_settings' ); |
| [485](#L485) | $allowhtml = isset( $options['guest\_author\_allow\_html'] ) ? true : false ; |
| [486](#L486) |  |
| [487](#L487) | if ( $allowhtml ) |
| [488](#L488) | $description =  wp\_kses\_post(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true ) ); |
| [489](#L489) | else |
| [490](#L490) | $description =   esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true )) ; |
| [491](#L491) |  |
| [492](#L492) | if (!$description) |
| [493](#L493) | $description = ""; |
| [494](#L494) | } |
| [495](#L495) | return $description; |
| [496](#L496) | } |
| [497](#L497) | /\*\* |
| [498](#L498) | \* guest\_author\_description function. |
| [499](#L499) | \* get the guest author bio if it exists |
| [500](#L500) | \* @access public |
| [501](#L501) | \* @param string $description - real author bio |
| [502](#L502) | \* @return string |
| [503](#L503) | \*/ |
| [504](#L504) | function guest\_author\_description\_amp( $description ) { |
| [505](#L505) |  |
| [506](#L506) | $new\_description = $this->guest\_author\_description($description); |
| [507](#L507) | $pattern = "/<p[^>]\*><\\/p[^>]\*>/"; // regular expression |
| [508](#L508) | $description = preg\_replace($pattern, '', $description); |
| [509](#L509) |  |
| [510](#L510) | if ( $new\_description != $description ) { |
| [511](#L511) | $description = '<p>' . $new\_description . '</p>'; |
| [512](#L512) | } |
| [513](#L513) |  |
| [514](#L514) | return $description; |
| [515](#L515) | } |
| [516](#L516) | /\*\* |
| [517](#L517) | \* guest\_author\_email function. |
| [518](#L518) | \* get the guest author email if one exists |
| [519](#L519) | \* @access public |
| [520](#L520) | \* @param string $email - real author email |
| [521](#L521) | \* @return string |
| [522](#L522) | \*/ |
| [523](#L523) | function guest\_author\_email( $email ) { |
| [524](#L524) | $id = $this->get\_post\_id(); |
| [525](#L525) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [526](#L526) | if ( $author ) |
| [527](#L527) | { |
| [528](#L528) | $email = esc\_html(get\_post\_meta( $id, 'sfly\_guest\_author\_email', true )); |
| [529](#L529) | if (!$email) |
| [530](#L530) | $email = ""; |
| [531](#L531) | } |
| [532](#L532) | return $email; |
| [533](#L533) | } |
| [534](#L534) | /\*\* |
| [535](#L535) | \* guest\_author\_avatar function. |
| [536](#L536) | \* get the guest author avatar image html |
| [537](#L537) | \* @access public |
| [538](#L538) | \* @param string $avatar - real author avatar |
| [539](#L539) | \* @return avatar html |
| [540](#L540) | \*/ |
| [541](#L541) | function guest\_author\_avatar( $avatar, $id\_or\_email, $size, $default, $alt ) |
| [542](#L542) |  |
| [543](#L543) | { |
| [544](#L544) |  |
| [545](#L545) | global $guest\_author\_post\_id; |
| [546](#L546) | if ( (!isset( $guest\_author\_post\_id) ||  $guest\_author\_post\_id <= 0 ) ) { |
| [547](#L547) | return $avatar; |
| [548](#L548) | } |
| [549](#L549) |  |
| [550](#L550) | global $comment; |
| [551](#L551) |  |
| [552](#L552) |  |
| [553](#L553) |  |
| [554](#L554) | if ( isset( $comment )  && $this->comment\_list) { |
| [555](#L555) | $email = $comment->comment\_author\_email; |
| [556](#L556) | if ( $email ) { |
| [557](#L557) | //$image\_path = $this->get\_guest\_gravatar($email); |
| [558](#L558) | $avatar = $this->guest\_author\_avatar\_url\_link( $avatar, $email) ; // '<img src="'.$image\_path.'" width="'.$size.'" height="'.$size.'" />'; |
| [559](#L559) | } else { |
| [560](#L560) | $avatar = $default; |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) |  |
| [564](#L564) | } else { |
| [565](#L565) | $id = $this->get\_post\_id(); |
| [566](#L566) |  |
| [567](#L567) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [568](#L568) |  |
| [569](#L569) | if ( $author ) |
| [570](#L570) | { |
| [571](#L571) | $email = esc\_html(get\_post\_meta( $id, 'sfly\_guest\_author\_email', true )); |
| [572](#L572) |  |
| [573](#L573) |  |
| [574](#L574) | if ( $email ) { |
| [575](#L575) | //      $image\_path = $this->get\_author\_avatar($email); |
| [576](#L576) | $avatar =  $this->guest\_author\_avatar\_url\_link( $avatar, $email);// '<img src="'.$image\_path.'" width="'.$size.'" height="'.$size.'" />'; |
| [577](#L577) | } |
| [578](#L578) |  |
| [579](#L579) | } |
| [580](#L580) | } |
| [581](#L581) |  |
| [582](#L582) | return $avatar; |
| [583](#L583) | } |
| [584](#L584) |  |
| [585](#L585) | /\*\* |
| [586](#L586) | \* guest\_avatar\_link function. |
| [587](#L587) | \* |
| [588](#L588) | \* @access public |
| [589](#L589) | \* @param mixed $email |
| [590](#L590) | \* @param array $args (default: array()) |
| [591](#L591) | \* @return void |
| [592](#L592) | \*/ |
| [593](#L593) | function guest\_avatar\_link( $url, $email, $args = array() ) { |
| [594](#L594) |  |
| [595](#L595) | global $guest\_author\_post\_id; |
| [596](#L596) | global $comment; |
| [597](#L597) | if ( isset( $comment ) &&  $this->comment\_list ) { |
| [598](#L598) | $cemail = $comment->comment\_author\_email; |
| [599](#L599) | if ($cemail) { |
| [600](#L600) | $url = $this->get\_guest\_gravatar\_link($cemail); |
| [601](#L601) | } |
| [602](#L602) | } |
| [603](#L603) | else { |
| [604](#L604) | $id = $this->get\_post\_id(); |
| [605](#L605) |  |
| [606](#L606) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [607](#L607) |  |
| [608](#L608) | if ( $author ) |
| [609](#L609) | { |
| [610](#L610) | $email = esc\_html(get\_post\_meta( $id, 'sfly\_guest\_author\_email', true )); |
| [611](#L611) | if ($email) { |
| [612](#L612) | $url = $this->get\_guest\_gravatar\_link($email); |
| [613](#L613) | } |
| [614](#L614) | } |
| [615](#L615) |  |
| [616](#L616) |  |
| [617](#L617) | } |
| [618](#L618) | return $url; |
| [619](#L619) | } |
| [620](#L620) |  |
| [621](#L621) | /\*\* |
| [622](#L622) | \* guest\_author\_avatar\_url\_link function. |
| [623](#L623) | \* get the avatar url with link |
| [624](#L624) | \* @access public |
| [625](#L625) | \* @param mixed $url |
| [626](#L626) | \* @param mixed $email |
| [627](#L627) | \* @param array $args (default: array()) |
| [628](#L628) | \* @return void |
| [629](#L629) | \*/ |
| [630](#L630) | function guest\_author\_avatar\_url\_link( $url, $email, $args = array() ) |
| [631](#L631) |  |
| [632](#L632) | { |
| [633](#L633) |  |
| [634](#L634) | global $guest\_author\_post\_id; |
| [635](#L635) |  |
| [636](#L636) | if ( !isset( $guest\_author\_post\_id ) || $guest\_author\_post\_id <= 0) { |
| [637](#L637) | return $url; |
| [638](#L638) | } |
| [639](#L639) | global $comment; |
| [640](#L640) |  |
| [641](#L641) | if ( isset( $comment ) &&  $this->comment\_list ) { |
| [642](#L642) | $cemail = $comment->comment\_author\_email; |
| [643](#L643) | if ($cemail) { |
| [644](#L644) |  |
| [645](#L645) | $avatar\_url = $this->get\_guest\_gravatar\_link($cemail); |
| [646](#L646) |  |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) | } |
| [650](#L650) | else { |
| [651](#L651) | $id = $this->get\_post\_id(); |
| [652](#L652) |  |
| [653](#L653) | $author = esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_names', true )); |
| [654](#L654) |  |
| [655](#L655) | if ( $author ) |
| [656](#L656) | { |
| [657](#L657) | $email = esc\_html(get\_post\_meta( $id, 'sfly\_guest\_author\_email', true )); |
| [658](#L658) |  |
| [659](#L659) | if ($email) { |
| [660](#L660) | $avatar\_url = $this->get\_guest\_gravatar\_link($email); |
| [661](#L661) |  |
| [662](#L662) | } |
| [663](#L663) | } |
| [664](#L664) |  |
| [665](#L665) |  |
| [666](#L666) | } |
| [667](#L667) |  |
| [668](#L668) | if ( isset ( $avatar\_url ) ) { |
| [669](#L669) | $avatar\_url = "'" . $avatar\_url . "'"; |
| [670](#L670) |  |
| [671](#L671) | $html = preg\_replace('/<a href="(http:\/\/)?[\w.]+\/([\w]+)"\s?>/',  $avatar\_url ,$url); |
| [672](#L672) |  |
| [673](#L673) | return $html; |
| [674](#L674) | } |
| [675](#L675) | else  { |
| [676](#L676) | return $url; |
| [677](#L677) | } |
| [678](#L678) | } |
| [679](#L679) | /\*\* |
| [680](#L680) | \* get\_guest\_gravatar function. |
| [681](#L681) | \* |
| [682](#L682) | \* @access public |
| [683](#L683) | \* @param mixed $email |
| [684](#L684) | \* @param int $s (default: 80) |
| [685](#L685) | \* @param string $d (default: 'mm') |
| [686](#L686) | \* @param string $r (default: 'g') |
| [687](#L687) | \* @param bool $img (default: false) |
| [688](#L688) | \* @param array $atts (default: array()) |
| [689](#L689) | \* @return void |
| [690](#L690) | \*/ |
| [691](#L691) | function get\_guest\_gravatar( $email, $s = 80, $d = 'mm', $r = 'g', $img = false, $atts = array() ) { |
| [692](#L692) |  |
| [693](#L693) | $url = 'http://www.gravatar.com/avatar/'; |
| [694](#L694) | $url .= md5( strtolower( trim( $email ) ) ); |
| [695](#L695) |  |
| [696](#L696) | $url .= "?s=$s&d=$d&r=$r"; |
| [697](#L697) | if ( $img ) { |
| [698](#L698) | $url = '<img src="' . $url . '"'; |
| [699](#L699) | foreach ( $atts as $key => $val ) |
| [700](#L700) | $url .= ' ' . $key . '="' . $val . '"'; |
| [701](#L701) | $url .= ' />'; |
| [702](#L702) | } |
| [703](#L703) |  |
| [704](#L704) | return $url; |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) | /\*\* |
| [708](#L708) | \* get\_guest\_gravatar\_link function. |
| [709](#L709) | \* |
| [710](#L710) | \* @access public |
| [711](#L711) | \* @param mixed $email |
| [712](#L712) | \* @param int $s (default: 80) |
| [713](#L713) | \* @param string $d (default: 'mm') |
| [714](#L714) | \* @param string $r (default: 'g') |
| [715](#L715) | \* @param bool $img (default: false) |
| [716](#L716) | \* @param array $atts (default: array()) |
| [717](#L717) | \* @return void |
| [718](#L718) | \*/ |
| [719](#L719) | function get\_guest\_gravatar\_link( $email, $s = 80, $d = 'mm', $r = 'g', $img = false, $atts = array() ) { |
| [720](#L720) | $link = 'http://www.gravatar.com/avatar/'; |
| [721](#L721) | $link .= md5( strtolower( trim( $email ) ) ); |
| [722](#L722) |  |
| [723](#L723) | $link .= "?s=$s&d=$d&r=$r"; |
| [724](#L724) |  |
| [725](#L725) |  |
| [726](#L726) | return $link; |
| [727](#L727) | } |
| [728](#L728) | /\*\* |
| [729](#L729) | \* get\_post\_id function. |
| [730](#L730) | \* get the post id for the current post |
| [731](#L731) | \* @access public |
| [732](#L732) | \* @return void |
| [733](#L733) | \*/ |
| [734](#L734) | function get\_post\_id() |
| [735](#L735) | { |
| [736](#L736) | global $post; |
| [737](#L737) | global $post\_id; |
| [738](#L738) | if (isset($post)) |
| [739](#L739) | $id = $post->ID; |
| [740](#L740) | elseif (isset($post\_id)) |
| [741](#L741) | $id = $post\_id; |
| [742](#L742) | else |
| [743](#L743) | $id = NULL; |
| [744](#L744) | return $id; |
| [745](#L745) | } |
| [746](#L746) | /\*\* |
| [747](#L747) | \* Adds the meta box container. |
| [748](#L748) | \*/ |
| [749](#L749) | /\*\* |
| [750](#L750) | \* add\_meta\_box function. |
| [751](#L751) | \* |
| [752](#L752) | \* @access public |
| [753](#L753) | \* @param mixed $post\_type |
| [754](#L754) | \* @return void |
| [755](#L755) | \*/ |
| [756](#L756) | public function add\_meta\_box( $post\_type ) { |
| [757](#L757) | $post\_types = array('post', 'page');     //limit meta box to certain post types |
| [758](#L758) | if ( in\_array( $post\_type, $post\_types )) { |
| [759](#L759) | add\_meta\_box( |
| [760](#L760) | 'some\_meta\_box\_name' |
| [761](#L761) | ,\_\_( 'Guest Author', 'sfly\_guest\_author' ) |
| [762](#L762) | ,array( $this, 'render\_meta\_box\_content' ) |
| [763](#L763) | ,$post\_type |
| [764](#L764) | ,'advanced' |
| [765](#L765) | ,'high' |
| [766](#L766) | ); |
| [767](#L767) | } |
| [768](#L768) | } |
| [769](#L769) |  |
| [770](#L770) | /\*\* |
| [771](#L771) | \* change\_posttype\_columns function. |
| [772](#L772) | \* captions for the post list |
| [773](#L773) | \* @access public |
| [774](#L774) | \* @param mixed $cols |
| [775](#L775) | \* @return void |
| [776](#L776) | \*/ |
| [777](#L777) | function change\_posttype\_columns( $cols ) { |
| [778](#L778) | $cols2 = array( |
| [779](#L779) | 'sfly\_guest\_author' => 'Guest Author', |
| [780](#L780) | 'sfly\_guest\_link' => 'Guest Link', |
| [781](#L781) | 'sfly\_guest\_author\_description' => 'Guest Description', |
| [782](#L782) | 'sfly\_guest\_author\_email' => 'Guest Email', |
| [783](#L783) |  |
| [784](#L784) | ); |
| [785](#L785) | $cols = array\_merge($cols, $cols2); |
| [786](#L786) | return $cols; |
| [787](#L787) | } |
| [788](#L788) |  |
| [789](#L789) | // But remove it again on the edit screen (other screens to?) |
| [790](#L790) |  |
| [791](#L791) | /\*\* |
| [792](#L792) | \* remove\_dummy\_column function. |
| [793](#L793) | \* |
| [794](#L794) | \* @access public |
| [795](#L795) | \* @param mixed $cols |
| [796](#L796) | \* @return void |
| [797](#L797) | \*/ |
| [798](#L798) | function remove\_dummy\_column($cols) |
| [799](#L799) | { |
| [800](#L800) | unset($cols['sfly\_guest\_author']); |
| [801](#L801) | unset($cols['sfly\_guest\_link']); |
| [802](#L802) | unset($cols['sfly\_guest\_author\_description']); |
| [803](#L803) | unset($cols['sfly\_guest\_author\_email']); |
| [804](#L804) | return $cols; |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | /\*\* |
| [808](#L808) | \* render\_post\_columns function. |
| [809](#L809) | \* output the post column data for the list |
| [810](#L810) | \* @access public |
| [811](#L811) | \* @param mixed $column\_name |
| [812](#L812) |  |
| [813](#L813) | \* @param mixed $id |
| [814](#L814) | \* @return void |
| [815](#L815) | \*/ |
| [816](#L816) | function render\_post\_columns($column\_name, $id) { |
| [817](#L817) | $options = get\_option( 'guest\_author\_name\_settings' ); |
| [818](#L818) | $allowhtml = isset( $options['guest\_author\_allow\_html'] ) ? true : false ; |
| [819](#L819) |  |
| [820](#L820) | if ( $allowhtml ) |
| [821](#L821) | $description =  wp\_kses\_post(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true ) ); |
| [822](#L822) | else |
| [823](#L823) | $description =   esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true )) ; |
| [824](#L824) |  |
| [825](#L825) | if (!$description) |
| [826](#L826) | $description = ""; |
| [827](#L827) |  |
| [828](#L828) | switch ($column\_name) { |
| [829](#L829) | case 'sfly\_guest\_author': |
| [830](#L830) | echo sanitize\_text\_field(get\_post\_meta( $id, 'sfly\_guest\_author\_names', TRUE)); |
| [831](#L831) | break; |
| [832](#L832) | case 'sfly\_guest\_link': |
| [833](#L833) | echo esc\_url(get\_post\_meta( $id, 'sfly\_guest\_link', TRUE)); |
| [834](#L834) | break; |
| [835](#L835) | case 'sfly\_guest\_author\_description': |
| [836](#L836) | echo $description; |
| [837](#L837) | break; |
| [838](#L838) | case 'sfly\_guest\_author\_email': |
| [839](#L839) | echo esc\_html(get\_post\_meta( $id, 'sfly\_guest\_author\_email', TRUE)); |
| [840](#L840) |  |
| [841](#L841) |  |
| [842](#L842) | } |
| [843](#L843) | } |
| [844](#L844) |  |
| [845](#L845) | /\*\* |
| [846](#L846) | \* save\_quick\_meta function. |
| [847](#L847) | \* save the data from the quick edit screen |
| [848](#L848) | \* @access public |
| [849](#L849) | \* @param mixed $post\_id |
| [850](#L850) | \* @return void |
| [851](#L851) | \*/ |
| [852](#L852) | function save\_quick\_meta( $post\_id, $post ) { |
| [853](#L853) |  |
| [854](#L854) | $post\_types = array('post', 'page');     //limit meta box to certain post types |
| [855](#L855) | if ( in\_array( $post\_type, $post\_types )) { |
| [856](#L856) | if ( $printNonce ) { |
| [857](#L857) | $printNonce = FALSE; |
| [858](#L858) | wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'guest\_author\_edit\_nonce' ); |
| [859](#L859) | } |
| [860](#L860) | if ( !current\_user\_can( 'edit\_post', $post\_id ) ) { |
| [861](#L861) | return; |
| [862](#L862) | } |
| [863](#L863) | if ( isset( $\_REQUEST['sfly\_guest\_author'] ) ) { |
| [864](#L864) | update\_post\_meta( $post\_id, 'sfly\_guest\_author', santize\_text\_field( $\_REQUEST['sfly\_guest\_author'] ) ); |
| [865](#L865) | } |
| [866](#L866) | if ( isset( $\_REQUEST['sfly\_guest\_link'] ) ) { |
| [867](#L867) | update\_post\_meta( $post\_id, 'sfly\_guest\_link', esc\_url( $\_REQUEST['sfly\_guest\_link'] )); |
| [868](#L868) | } |
| [869](#L869) | if ( isset( $\_REQUEST['sfly\_guest\_author\_description'] ) ) { |
| [870](#L870) | update\_post\_meta( $post\_id, 'sfly\_guest\_author\_description', wp\_kses\_post($\_REQUEST['sfly\_guest\_author\_description'] )); |
| [871](#L871) | } |
| [872](#L872) | if ( isset( $\_REQUEST['sfly\_guest\_author\_email'] ) ) { |
| [873](#L873) | update\_post\_meta( $post\_id, 'sfly\_guest\_author\_email', esc\_html($\_REQUEST['sfly\_guest\_author\_email'] )); |
| [874](#L874) | } |
| [875](#L875) | } |
| [876](#L876) | } |
| [877](#L877) |  |
| [878](#L878) | /\*\* |
| [879](#L879) | \* add\_quick\_meta\_box function. |
| [880](#L880) | \* create the quick edit screen |
| [881](#L881) | \* @access public |
| [882](#L882) | \* @param mixed $col |
| [883](#L883) |  |
| [884](#L884) | \* @param mixed $post\_type |
| [885](#L885) | \* @return void |
| [886](#L886) | \*/ |
| [887](#L887) | public function add\_quick\_meta\_box( $col,  $post\_type ) { |
| [888](#L888) | static $printNonce = TRUE; |
| [889](#L889) | $post\_types = array('post', 'page');     //limit meta box to certain post types |
| [890](#L890) | if ( in\_array( $post\_type, $post\_types )) { |
| [891](#L891) | if ( $printNonce ) { |
| [892](#L892) | wp\_nonce\_field( 'sfly\_guest\_author\_box', 'sfly\_guest\_author\_nonce' ); |
| [893](#L893) | $printNonce = FALSE; |
| [894](#L894) | //      wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), 'guest\_author\_edit\_nonce' ); |
| [895](#L895) | } |
| [896](#L896) | ?> |
| [897](#L897) |  |
| [898](#L898) |  |
| [899](#L899) | <?php |
| [900](#L900) |  |
| [901](#L901) | switch ( $col ) { |
| [902](#L902) | case 'sfly\_guest\_author': |
| [903](#L903) | ?><fieldset class="inline-edit-col-right inline-edit-book"> |
| [904](#L904) | <div class="inline-edit-col column-<?php echo $col; ?>" style="display:block; border:1px;"> |
| [905](#L905) | <label class="inline-edit-group"><div style='display:block'><span class="sfly\_guest\_author" style="width:150px;">Guest Author Name(s)</span><input name="sfly\_guest\_author" class="widefat" /></div></label><?php |
| [906](#L906) | break; |
| [907](#L907) | case 'sfly\_guest\_link': |
| [908](#L908) | ?><label  class="inline-edit-group"><div style="display:block"><span class="sfly\_guest\_link" style="width:150px;">Guest URL</span><input name="sfly\_guest\_link" class="widefat" /></div></label><?php |
| [909](#L909) | break; |
| [910](#L910) | case 'sfly\_guest\_author\_description': |
| [911](#L911) | ?><label class="inline-edit-group"><div style="display:block"><span class="sfly\_guest\_author\_description" style="width:150px;">Author Bio / Description</span><input name="sfly\_guest\_author\_description" class="widefat" /></div></label><?php |
| [912](#L912) | break; |
| [913](#L913) | case 'sfly\_guest\_author\_email': |
| [914](#L914) | ?><label class="inline-edit-group"><div style="display:block"><span class="sfly\_guest\_author\_email" style="width:150px;">Author Gravatar Email</span><input name="sfly\_guest\_author\_email" class="widefat" /></div> |
| [915](#L915) | </div></label> |
| [916](#L916) | </div> |
| [917](#L917) | </fieldset><?php |
| [918](#L918) | break; |
| [919](#L919) | } |
| [920](#L920) | ?> |
| [921](#L921) | <?php |
| [922](#L922) | } |
| [923](#L923) | } |
| [924](#L924) | /\*\* |
| [925](#L925) | \* Save the meta when the post is saved. |
| [926](#L926) | \* |
| [927](#L927) | \* @param int $post\_id The ID of the post being saved. |
| [928](#L928) | \*/ |
| [929](#L929) | /\*\* |
| [930](#L930) | \* save function. |
| [931](#L931) | \* |
| [932](#L932) | \* @access public |
| [933](#L933) | \* @param mixed $post\_id |
| [934](#L934) | \* @return void |
| [935](#L935) | \*/ |
| [936](#L936) | public function save\_meta( $post\_id, $post ) { |
| [937](#L937) |  |
| [938](#L938) | if ( ! isset( $\_POST['sfly\_guest\_author\_nonce'] ) ) |
| [939](#L939) | return $post\_id; |
| [940](#L940) | $nonce = $\_POST['sfly\_guest\_author\_nonce']; |
| [941](#L941) | if ( ! wp\_verify\_nonce( $nonce, 'sfly\_guest\_author\_box' ) ) |
| [942](#L942) | return $post\_id; |
| [943](#L943) | // If this is an autosave, our form has not been submitted, |
| [944](#L944) | //       so we don't want to do anything. |
| [945](#L945) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) |
| [946](#L946) | return $post\_id; |
| [947](#L947) | // Check the user's permissions. |
| [948](#L948) | if ( 'page' == $\_POST['post\_type'] ) { |
| [949](#L949) | if ( ! current\_user\_can( 'edit\_page', $post\_id ) ) |
| [950](#L950) | return $post\_id; |
| [951](#L951) | } else { |
| [952](#L952) | if ( ! current\_user\_can( 'edit\_post', $post\_id ) ) |
| [953](#L953) | return $post\_id; |
| [954](#L954) | } |
| [955](#L955) | // Sanitize the user input. |
| [956](#L956) | $author = sanitize\_text\_field( $\_POST['sfly\_guest\_author'] ); |
| [957](#L957) | $link = esc\_url($\_POST['sfly\_guest\_link']); |
| [958](#L958) |  |
| [959](#L959) | $options = get\_option( 'guest\_author\_name\_settings' ); |
| [960](#L960) | $allowhtml = isset( $options['guest\_author\_allow\_html'] ) ? true : false ; |
| [961](#L961) |  |
| [962](#L962) |  |
| [963](#L963) | if ($allowhtml) |
| [964](#L964) | $description = wp\_kses\_post(  $\_POST['sfly\_guest\_author\_description'] ); |
| [965](#L965) | else |
| [966](#L966) | $description = sanitize\_text\_field( $\_POST['sfly\_guest\_author\_description']); |
| [967](#L967) |  |
| [968](#L968) | $email = sanitize\_email( $\_POST['sfly\_guest\_author\_email'] ); |
| [969](#L969) | // Update the meta field. |
| [970](#L970) | update\_post\_meta( $post\_id, 'sfly\_guest\_author\_names', $author ); |
| [971](#L971) | update\_post\_meta( $post\_id, 'sfly\_guest\_link', $link); |
| [972](#L972) | update\_post\_meta( $post\_id, 'sfly\_guest\_author\_description', $description); |
| [973](#L973) | update\_post\_meta( $post\_id, 'sfly\_guest\_author\_email', $email); |
| [974](#L974) | } |
| [975](#L975) |  |
| [976](#L976) | /\* |
| [977](#L977) | \* render\_meta\_box\_content function. |
| [978](#L978) | \* |
| [979](#L979) | \* @access public |
| [980](#L980) | \* @param mixed $post |
| [981](#L981) | \* @return void |
| [982](#L982) | \*/ |
| [983](#L983) | public function render\_meta\_box\_content( $post ) { |
| [984](#L984) | // Add an nonce field so we can check for it later. |
| [985](#L985) | wp\_nonce\_field( 'sfly\_guest\_author\_box', 'sfly\_guest\_author\_nonce' ); |
| [986](#L986) | // Use get\_post\_meta to retrieve an existing values from the database. |
| [987](#L987) | $value = sanitize\_text\_field(get\_post\_meta( $post->ID, 'sfly\_guest\_author\_names', true ) ); |
| [988](#L988) | $link = esc\_url( get\_post\_meta( $post->ID, 'sfly\_guest\_link', true ) ); |
| [989](#L989) |  |
| [990](#L990) | $options = get\_option( 'guest\_author\_name\_settings' ); |
| [991](#L991) | $allowhtml = isset( $options['guest\_author\_allow\_html'] ) ? true : false ; |
| [992](#L992) | $id = $post->ID; |
| [993](#L993) | if ( $allowhtml ) |
| [994](#L994) | $description =  wp\_kses\_post(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true ) ); |
| [995](#L995) | else |
| [996](#L996) | $description =   esc\_attr(get\_post\_meta( $id, 'sfly\_guest\_author\_description', true ) ) ; |
| [997](#L997) |  |
| [998](#L998) | if (!$description) |
| [999](#L999) | $description = ""; |
| [1000](#L1000) |  |
| [1001](#L1001) | $email = esc\_html( get\_post\_meta( $post->ID, 'sfly\_guest\_author\_email', true ) ); |
| [1002](#L1002) | // Display the form, using the current values. |
| [1003](#L1003) | echo '<label for="sfly\_guest\_author">'; |
| [1004](#L1004) | \_e( 'Guest Author Name(s)', 'sfly\_guest\_author' ); |
| [1005](#L1005) | echo '</label> '; |
| [1006](#L1006) | echo '<input type="text" id="sfly\_guest\_author" name="sfly\_guest\_author"'; |
| [1007](#L1007) | echo ' value="' .  $value  . '" style="max-width:100%" size="150" class="widefat" />'; |
| [1008](#L1008) | echo '<br/><label for="sfly\_guest\_link">'; |
| [1009](#L1009) | \_e( 'Guest URL', 'sfly\_guest\_link' ); |
| [1010](#L1010) | echo '</label><br/>'; |
| [1011](#L1011) | echo '<input type="text" id="sfly\_guest\_link" name="sfly\_guest\_link"'; |
| [1012](#L1012) | echo ' value="' .  $link  . '" style="max-width:100%" class="widefat"  />'; |
| [1013](#L1013) | echo '<br/><label for="sfly\_guest\_description">'; |
| [1014](#L1014) | \_e( 'Guest Description', 'sfly\_guest\_description' ); |
| [1015](#L1015) | echo '</label><br/> '; |
| [1016](#L1016) | echo '<textarea id="sfly\_guest\_author\_description" name="sfly\_guest\_author\_description" style="width:100%;height:40px;">' . $description . '</textarea>'; |
| [1017](#L1017) | echo '<label for="sfly\_guest\_author\_email">'; |
| [1018](#L1018) | \_e( 'Guest Gravatar Email', 'sfly\_guest\_author\_email' ); |
| [1019](#L1019) | echo '</label> '; |
| [1020](#L1020) | echo '<input type="text" id="sfly\_guest\_author\_email" name="sfly\_guest\_author\_email"'; |
| [1021](#L1021) | echo ' value="' .  $email  . '" style="max-width:100%" class="widefat" size="150" />'; |
| [1022](#L1022) | } |
| [1023](#L1023) | /\*\*\*\*Functions for tag\_div only \*\*\*/ |
| [1024](#L1024) |  |
| [1025](#L1025) |  |
| [1026](#L1026) | function set\_guest\_author\_ids($module, $post) { |
| [1027](#L1027) | if ( isset( $post ) ) { |
| [1028](#L1028) | global $g\_post\_id; |
| [1029](#L1029) | $g\_post\_id = $post->ID; |
| [1030](#L1030) | add\_filter('author\_link', array( $this, 'tag\_div\_author' ), 99); |
| [1031](#L1031) | add\_filter( 'get\_the\_author\_display\_name', array( $this, 'tag\_div\_display\_name' ), 99 ); |
| [1032](#L1032) |  |
| [1033](#L1033) | } |
| [1034](#L1034) | else |
| [1035](#L1035) | { |
| [1036](#L1036) | $g\_post\_id = nulll; |
| [1037](#L1037) | remove\_filter('author\_link', array( $this, 'tag\_div\_author' ), 99); |
| [1038](#L1038) | remove\_filter( 'get\_the\_author\_display\_name', array( $this, 'tag\_div\_display\_name' ), 99 ); |
| [1039](#L1039) | } |
| [1040](#L1040) |  |
| [1041](#L1041) | } |
| [1042](#L1042) | function tag\_div\_display\_name( $name ) |
| [1043](#L1043) | { |
| [1044](#L1044) | global $g\_post\_id; |
| [1045](#L1045) | if ( isset(  $g\_post\_id ) &&  $g\_post\_id > 0 ) |
| [1046](#L1046) | { |
| [1047](#L1047) | $author = esc\_attr(get\_post\_meta( $g\_post\_id, 'sfly\_guest\_author\_names', true )); |
| [1048](#L1048) | if ( $author ) |
| [1049](#L1049) | $name = $author; |
| [1050](#L1050) | } |
| [1051](#L1051) | return $name; |
| [1052](#L1052) |  |
| [1053](#L1053) |  |
| [1054](#L1054) | } |
| [1055](#L1055) |  |
| [1056](#L1056) | function tag\_div\_author($link, $authorid=null) |
| [1057](#L1057) | { |
| [1058](#L1058) | global $g\_post\_id; |
| [1059](#L1059) |  |
| [1060](#L1060) | if ( isset ( $g\_post\_id ) && $g\_post\_id  > 0 ) { |
| [1061](#L1061) | $author = esc\_attr(get\_post\_meta( $g\_post\_id, 'sfly\_guest\_author\_names', true )); |
| [1062](#L1062) | if ( $author ) |
| [1063](#L1063) | { |
| [1064](#L1064) | $link = get\_post\_meta( $g\_post\_id, 'sfly\_guest\_link', true ); |
| [1065](#L1065) | if (!$link) |
| [1066](#L1066) | $link = ""; |
| [1067](#L1067) | } |
| [1068](#L1068) |  |
| [1069](#L1069) | } |
| [1070](#L1070) | return $link; |
| [1071](#L1071) |  |
| [1072](#L1072) | } |
| [1073](#L1073) | } |
| [1074](#L1074) | endif; |
| [1075](#L1075) |  |
| [1076](#L1076) | // Admin Settings |
| [1077](#L1077) |  |
| [1078](#L1078) |  |
| [1079](#L1079) |  |
| [1080](#L1080) | new sfly\_guest\_author(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/guest-author-name/trunk/sfly-guest-author.php?format=txt)
* [Original Format](/export/3220507/guest-author-name/trunk/sfly-guest-author.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

