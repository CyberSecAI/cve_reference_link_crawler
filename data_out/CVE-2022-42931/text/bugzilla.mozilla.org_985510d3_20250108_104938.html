

![](/static/v20241211.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1780571)
* [XML](/show_bug.cgi?ctype=xml&id=1780571)

Closed
[Bug 1780571](/show_bug.cgi?id=1780571)
(CVE-2022-42931)

Opened 2 years ago
Closed 2 years ago

# Username leaked to form history

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Username leaked to form history

## Categories

### (Toolkit :: Form Manager, defect, P2)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Form%20Manager#Form%20Manager)

Form Manager
▾

Toolkit :: Form Manager
The component that captures user data appearing on a form and autofills that data on other forms.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Form%20Manager&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Form%20Manager&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Form%20Manager)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

P2

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

106 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Performance Impact | --- |
| --- | --- |
| Webcompat Priority | --- |
| Webcompat Score | --- |
| Accessibility Severity | --- |
| a11y-review | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr102 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix) |
| firefox105 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=wontfix) |
| firefox106 | --- | [fixed](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr102 |  | wontfix |
| firefox-esr115 | --- | --- |
| firefox-esr128 | --- | --- |
| firefox105 |  | wontfix |
| firefox106 |  | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: serg, Assigned: issammani)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/062c8adc1464ca7f8fc2d016dfb828f1?d=mm&size=40)  [issammani](/user_profile?user_id=708367)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/56d78d779f6650bac5fee98c8b204f98?d=mm&size=40)  [serg](/user_profile?user_id=691597)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

---

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

6 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

---

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[Duplicates:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#duplicates)

[394612](/show_bug.cgi?id=394612 "RESOLVED DUPLICATE - Form Manager shouldn't save usernames if the Login Manager might"), [1780655](/show_bug.cgi?id=1780655 "RESOLVED DUPLICATE - login displays multiple addresses")

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

---

## Details

### (Keywords: sec-low, Whiteboard: [adv-main106+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2022-42931

[Keywords:](/describekeywords.cgi)

[sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[adv-main106+]

QA Whiteboard:

---

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [RyanVM](/user_profile?user_id=75935) | [in-testsuite](#a4833940_75935 "2 years ago") | + |
| --- | --- | --- |
| [RyanVM](/user_profile?user_id=75935) | in-testsuite | + |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty | ? |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | qe-verify |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (3 files)

| [Bug 1780571 - Reproduce bug and add test to catch it. r=sgalich!](/attachment.cgi?id=9289451)  [2 years ago](#c7)  [Issam Mani [:issammani]](/user_profile?user_id=708367)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9289451&action=edit) | [Review](/attachment.cgi?id=9289451) |
| --- | --- | --- |
| [Bug 1780571 - Check if input is managed by LoginManager before saving it to FormHistory database. r=sgalich!](/attachment.cgi?id=9289452)  [2 years ago](#c8)  [Issam Mani [:issammani]](/user_profile?user_id=708367)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9289452&action=edit) | [Review](/attachment.cgi?id=9289452) |
| [advisory.txt](/attachment.cgi?id=9298259)  [2 years ago](#c12)  [Tom Ritter [:tjr]](/user_profile?user_id=578488)   280 bytes, text/plain |  | [Details](/attachment.cgi?id=9298259&action=edit) |

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1780571#c0)• 2 years ago |
|  | |

STR

1. verify formhistory.sqlite is empty
2. go [imdb login page](https://www.imdb.com/ap/signin?openid.pape.max_auth_age=0&openid.return_to=https%3A%2F%2Fwww.imdb.com%2Fregistration%2Fap-signin-handler%2Fimdb_us&openid.identity=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.assoc_handle=imdb_us&openid.mode=checkid_setup&siteState=eyJvcGVuaWQuYXNzb2NfaGFuZGxlIjoiaW1kYl91cyIsInJlZGlyZWN0VG8iOiJodHRwczovL3d3dy5pbWRiLmNvbS8_cmVmXz1sb2dpbiJ9&openid.claimed_id=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0%2Fidentifier_select&openid.ns=http%3A%2F%2Fspecs.openid.net%2Fauth%2F2.0&tag=imdbtag_reg-20) (or any other login page)
3. attempt to login and save login in password manager
4. formhistory.sqlite will have username stored in plain text

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597)  Reporter |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a173_691597)• 2 years ago |

Severity: -- → S2Priority: -- → P2

|  | [ineuw](/user_profile?user_id=623933) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1780571#c2)• 2 years ago |
|  | |

I can confirm. This is the formhistory.sqlite entry just now.

677 Bugzilla\_login xxxxx@xxxxxxxxx 1 1658438391070000 1658438391070000 YCjMUXDaRsOqG9JK

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1780571#c3)• 2 years ago |
|  | |

Is this not intentional? The username is part of the form, and is not hidden text? I don't know what the expectations are for this. Are form fields supposed to be stored in one and only one place, so if it's part of a password it's no longer part of the form?

You're the triage owner so I guess you get to say :-) If this is a security bug what severity would you give it? sec-low? sec-moderate? just a privacy problem?

Flags: needinfo?(sgalich)

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597)  Reporter |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1780571#c4)• 2 years ago |
|  | |

(In reply to Daniel Veditz [:dveditz] from [comment #3](/show_bug.cgi?id=1780571#c3 "RESOLVED FIXED - Username leaked to form history"))

> Is this not intentional? The username is part of the form, and is not hidden text? I don't know what the expectations are for this. Are form fields supposed to be stored in one and only one place, so if it's part of a password it's no longer part of the form?
>
> You're the triage owner so I guess you get to say :-) If this is a security bug what severity would you give it? sec-low? sec-moderate? just a privacy problem?

Forms managed by Password Manager encrypt username and password.

Form History should not be involved if form is managed by Password Manager.

At the moment I think this is sec-low. Something that I expect to be encrypted can be found in plain form in another file nearby.

But it may turn to sec-moderate if I can use that username knowledge to figure the encryption key to decrypt password. This is something I still need to review.

Flags: needinfo?(sgalich)

|  | [Issam Mani [:issammani]](/user_profile?user_id=708367)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a670815_708367)• 2 years ago |

Assignee: nobody → imani

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1780571#c5)• 2 years ago |
|  | |

I've spoke with crypto folks, they feel current encryption should hold.

Keywords: [sec-low](/buglist.cgi?keywords=sec-low&resolution=---)

|  | [Issam Mani [:issammani]](/user_profile?user_id=708367)  Assignee |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1780571#c6)• 2 years ago |
|  | |

This bug is similar to [394612](https://bugzilla.mozilla.org/show_bug.cgi?id=394612)

|  | [Issam Mani [:issammani]](/user_profile?user_id=708367)  Assignee |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1780571#c7)• 2 years ago |
|  | |

Attached file
[Bug 1780571 - Reproduce bug and add test to catch it. r=sgalich!](attachment.cgi?id=9289451)
— [Details](attachment.cgi?id=9289451&action=edit)

|  | [Issam Mani [:issammani]](/user_profile?user_id=708367)  Assignee |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1780571#c8)• 2 years ago |
|  | |

Attached file
[Bug 1780571 - Check if input is managed by LoginManager before saving it to FormHistory database. r=sgalich!](attachment.cgi?id=9289452)
— [Details](attachment.cgi?id=9289452&action=edit)

Depends on D154389

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a1818906_600971)• 2 years ago |

[Attachment #9289452](/attachment.cgi?id=9289452&action=edit "Bug 1780571 - Check if input is managed by LoginManager before saving it to FormHistory database. r=sgalich!") -
Attachment description: Bug 1780571 - Check if input is managed by LM before saving to FH. r=sgalich! → Bug 1780571 - Check if input is managed by LoginManager before saving it to FormHistory database. r=sgalich!

|  | [Sebastian Hengst [:aryx] (needinfo me if it's about an intermittent or backout)](/user_profile?user_id=258347) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1780571#c9)• 2 years ago |
|  | |

Reproduce bug and add test to catch it. r=sgalich

<https://hg.mozilla.org/integration/autoland/rev/d7d188482489b74205598e37ae1eb7f1a7152430>

<https://hg.mozilla.org/mozilla-central/rev/d7d188482489>

Check if input is managed by LoginManager before saving it to FormHistory database. r=sgalich

<https://hg.mozilla.org/integration/autoland/rev/65bd3d4ffbc9e9cc000b6cd3151f7f1325a1d396>

<https://hg.mozilla.org/mozilla-central/rev/65bd3d4ffbc9>

Group: firefox-core-security → core-security-releaseStatus: NEW → RESOLVEDClosed: 2 years ago
[status-firefox106](/buglist.cgi?f1=cf_status_firefox106&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox106&o1=equals&v1=fixed)Resolution: --- → FIXEDTarget Milestone: --- → 106 Branch

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a4833940_75935)• 2 years ago |

[status-firefox105](/buglist.cgi?f1=cf_status_firefox105&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox105&o1=equals&v1=wontfix)
[status-firefox-esr102](/buglist.cgi?f1=cf_status_firefox_esr102&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox_esr102&o1=equals&v1=wontfix)Flags: in-testsuite+

|  | [Sergey Galich [:serg]](/user_profile?user_id=691597)  Reporter |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1780571#c10)• 2 years ago |
|  | |

Removing security flag due to similar [bug 394612](/show_bug.cgi?id=394612 "RESOLVED DUPLICATE - Form Manager shouldn't save usernames if the Login Manager might") being public already.

Group: core-security-release

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a7182232_578488)• 2 years ago |

Whiteboard: [adv-main106+]

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1780571#c12)• 2 years ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9298259)
— [Details](attachment.cgi?id=9298259&action=edit)

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1780571#a7347176_578488)• 2 years ago |

Alias: CVE-2022-42931
You need to [log in](/show_bug.cgi?id=1780571&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Issam Mani [:issammani]](/user_profile?user_id=708367)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review

