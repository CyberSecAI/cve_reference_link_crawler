
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFelixSchwarz%2Fmjml-python%2Fissues%2F52)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FFelixSchwarz%2Fmjml-python%2Fissues%2F52)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=FelixSchwarz%2Fmjml-python)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[FelixSchwarz](/FelixSchwarz)
/
**[mjml-python](/FelixSchwarz/mjml-python)**
Public

* [Notifications](/login?return_to=%2FFelixSchwarz%2Fmjml-python) You must be signed in to change notification settings
* [Fork
  17](/login?return_to=%2FFelixSchwarz%2Fmjml-python)
* [Star
   78](/login?return_to=%2FFelixSchwarz%2Fmjml-python)

* [Code](/FelixSchwarz/mjml-python)
* [Issues
  3](/FelixSchwarz/mjml-python/issues)
* [Pull requests
  2](/FelixSchwarz/mjml-python/pulls)
* [Discussions](/FelixSchwarz/mjml-python/discussions)
* [Actions](/FelixSchwarz/mjml-python/actions)
* [Security](/FelixSchwarz/mjml-python/security)
* [Insights](/FelixSchwarz/mjml-python/pulse)

Additional navigation options

* [Code](/FelixSchwarz/mjml-python)
* [Issues](/FelixSchwarz/mjml-python/issues)
* [Pull requests](/FelixSchwarz/mjml-python/pulls)
* [Discussions](/FelixSchwarz/mjml-python/discussions)
* [Actions](/FelixSchwarz/mjml-python/actions)
* [Security](/FelixSchwarz/mjml-python/security)
* [Insights](/FelixSchwarz/mjml-python/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FFelixSchwarz%2Fmjml-python%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FFelixSchwarz%2Fmjml-python%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Escaped HTML tags are "un-escaped" when rendering HTML #52

Closed

[sh-at-cs](/sh-at-cs) opened this issue
Feb 19, 2024
¬∑ 8 comments
 ¬∑ Fixed by [#54](https://github.com/FelixSchwarz/mjml-python/pull/54)

Closed

# [Escaped HTML tags are "un-escaped" when rendering HTML](#top) #52

[sh-at-cs](/sh-at-cs) opened this issue
Feb 19, 2024
¬∑ 8 comments
 ¬∑ Fixed by [#54](https://github.com/FelixSchwarz/mjml-python/pull/54)

## Comments

[![@sh-at-cs](https://avatars.githubusercontent.com/u/112704226?s=80&u=c1a35087d0d516f15f1a6080c4294bcb03f3c194&v=4)](/sh-at-cs)

Copy link

### **[sh-at-cs](/sh-at-cs)** commented [Feb 19, 2024](#issue-2142438119) ‚Ä¢ edited Loading

| Consider:  ``` from mjml import mjml_to_html  result = mjml_to_html(""" <mjml>   <mj-body>     <mj-text>       Pretty unsafe: &lt;script&gt;     </mj-text>   </mj-body> </mjml>""")  print(result["html"]) ```  In the resulting HTML output, the formerly HTML-escaped `<` (`&lt;`) and `>` (`&gt`) are "un-escaped", so the rendered HTML actually contains `Pretty unsafe: <script>`.  Why does this happen? This *reverses* the user's safety measures and can be dangerous.  The MJML reference implementation doesn't do this and correctly keeps such escape sequences untouched: <https://mjml.io/try-it-live/fvvhZhdu9V> |
| --- |
| The text was updated successfully, but these errors were encountered: |

 üëÄ
1
 FelixSchwarz reacted with eyes emoji

All reactions

* üëÄ
  1 reaction

[![@sh-at-cs](https://avatars.githubusercontent.com/u/112704226?s=40&u=c1a35087d0d516f15f1a6080c4294bcb03f3c194&v=4)](/sh-at-cs)
[sh-at-cs](/sh-at-cs)
changed the title
~~Escaped HTML tags are "un-escaped" when rendering to HTML~~
Escaped HTML tags are "un-escaped" when rendering HTML
[Feb 19, 2024](#event-11850765324)

[![@sh-at-cs](https://avatars.githubusercontent.com/u/112704226?s=80&u=c1a35087d0d516f15f1a6080c4294bcb03f3c194&v=4)](/sh-at-cs)

Copy link

Author

### **[sh-at-cs](/sh-at-cs)** commented [Feb 19, 2024](#issuecomment-1952981124) ‚Ä¢ edited Loading

| I tracked it down to the changes made in [84c495d](https://github.com/FelixSchwarz/mjml-python/commit/84c495da20a91640a1ca551ace17df7f3be644aa) ([#45](https://github.com/FelixSchwarz/mjml-python/pull/45)), where the `formatter` argument to BeautifulSoup's `decode_contents` was explicitly set to `None`. If it is set to `"minimal"` instead (the default and prior value), HTML escape sequences are left as they are.  But it seems like (part of) the whole point of [#45](https://github.com/FelixSchwarz/mjml-python/pull/45) was to **not** leave HTML entities as they are so as to fix [#44](https://github.com/FelixSchwarz/mjml-python/issues/44)...  [@caseyjhol](https://github.com/caseyjhol) Care to comment? üôÇ |
| --- |

All reactions

Sorry, something went wrong.

[![@caseyjhol](https://avatars.githubusercontent.com/u/2874325?s=80&u=7c48706ca46951c05d86fc80997a977b95e94188&v=4)](/caseyjhol)

Copy link

Contributor

### **[caseyjhol](/caseyjhol)** commented [Feb 19, 2024](#issuecomment-1953032176) ‚Ä¢ edited Loading

| Ah I could've sworn I tested and accounted for this scenario, but clearly I missed the mark. I think the better approach then might be to limit the scope to `mjStyle` rather than all HTML. |
| --- |

All reactions

Sorry, something went wrong.

[![@sh-at-cs](https://avatars.githubusercontent.com/u/112704226?s=80&u=c1a35087d0d516f15f1a6080c4294bcb03f3c194&v=4)](/sh-at-cs)

Copy link

Author

### **[sh-at-cs](/sh-at-cs)** commented [Feb 19, 2024](#issuecomment-1953197579)

| [@caseyjhol](https://github.com/caseyjhol) Thanks for the quick response! You're right, you did add an example of a very similar situation:   [mjml-python/tests/testdata/css-inlining.mjml](https://github.com/FelixSchwarz/mjml-python/blob/713d0aad96837d12f83627736eaa35e18ff3b9ec/tests/testdata/css-inlining.mjml#L22)  Line 22 in [713d0aa](/FelixSchwarz/mjml-python/commit/713d0aad96837d12f83627736eaa35e18ff3b9ec)   |  | &lt; Hello World &gt; | | --- | --- |      [mjml-python/tests/testdata/css-inlining-expected.html](https://github.com/FelixSchwarz/mjml-python/blob/713d0aad96837d12f83627736eaa35e18ff3b9ec/tests/testdata/css-inlining-expected.html#L127)  Line 127 in [713d0aa](/FelixSchwarz/mjml-python/commit/713d0aad96837d12f83627736eaa35e18ff3b9ec)   |  | <div style="font-family:helvetica;font-size:20px;line-height:1;text-align:left;color:#F45E43;"><span style="border: 3px solid blue;"> &lt; Hello World &gt; </span></div> | | --- | --- |      But as it turns out, the entities are in fact "un-escaped" during rendering of the test MJML file as described in this issue - the reason the test passes anyway is that the space between `&lt;` and `Hello` makes HTMLCompare consider them equal to `< Hello` (the rendered output). Minimal example:  ``` # no exception: htmlcompare.assert_same_html("&lt; script &gt;", "< script >") # exception: htmlcompare.assert_same_html("&lt;script &gt;", "<script >") ```  I haven't checked HTMLCompare's code, but I think this is probably because putting a space between `<` and the tag name [makes it stop being an HTML tag](https://stackoverflow.com/a/3314572/21564193), so the `<` is in fact equivalent to `&lt;` in this context.  But that is exactly the case that people *don't* need to guard against with sanitization/escaping. So the fix for this issue should add another test case (or extend this one) with an escaped HTML tag like `&lt;script&gt;`. |
| --- | --- | --- | --- | --- |

 ‚ù§Ô∏è
1
 FelixSchwarz reacted with heart emoji

All reactions

* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=80&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)

Copy link

Owner

### **[FelixSchwarz](/FelixSchwarz)** commented [Feb 20, 2024](#issuecomment-1953727010)

| [@sh-at-cs](https://github.com/sh-at-cs) Thank you for reporting this issue, including the detailed analysis. I think this is a serious issue which we need to fix. I'll try to spend some time on this later - either on reviewing a solution or trying to fix this myself. When we merged [#45](https://github.com/FelixSchwarz/mjml-python/pull/45) somehow the security implications completely escaped my attention. |
| --- |

 üëç
1
 sh-at-cs reacted with thumbs up emoji
 ‚ù§Ô∏è
1
 sh-at-cs reacted with heart emoji
 üöÄ
1
 sh-at-cs reacted with rocket emoji

All reactions

* üëç
  1 reaction
* ‚ù§Ô∏è
  1 reaction
* üöÄ
  1 reaction

Sorry, something went wrong.

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=80&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)

Copy link

Owner

### **[FelixSchwarz](/FelixSchwarz)** commented [Feb 21, 2024](#issuecomment-1956054365)

| Unfortunately all could do yesterday was to add the test case in a new branch [fix-escaped-html-tags](https://github.com/FelixSchwarz/mjml-python/compare/fix-escaped-html-tags).  How should we fix this issue? I see two approaches (just brainstorming here):   * contents of `<mj-style>` should be kept as-is * possibly parse the contents using [tinycss2](https://github.com/Kozea/tinycss2) to ensure this is really just CSS   Would that solve the issue if we also remove the `formatter=None`? As far as I could see, `css_inline` will keep the escaped sequences (as it should). |
| --- |

 üëç
1
 sh-at-cs reacted with thumbs up emoji
 ‚ù§Ô∏è
1
 sh-at-cs reacted with heart emoji

All reactions

* üëç
  1 reaction
* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@caseyjhol](https://avatars.githubusercontent.com/u/2874325?s=80&u=7c48706ca46951c05d86fc80997a977b95e94188&v=4)](/caseyjhol)

Copy link

Contributor

### **[caseyjhol](/caseyjhol)** commented [Feb 21, 2024](#issuecomment-1956908305)

| Going to try to dig into this today a bit. |
| --- |

 üëç
1
 sh-at-cs reacted with thumbs up emoji
 ‚ù§Ô∏è
1
 sh-at-cs reacted with heart emoji

All reactions

* üëç
  1 reaction
* ‚ù§Ô∏è
  1 reaction

Sorry, something went wrong.

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=80&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)

Copy link

Owner

### **[FelixSchwarz](/FelixSchwarz)** commented [Feb 21, 2024](#issuecomment-1957134524) ‚Ä¢ edited Loading

| I pushed some additional code in the branch [fix-escaped-html-tags](https://github.com/FelixSchwarz/mjml-python/compare/fix-escaped-html-tags). Basically the idea is to do the unescape only for contents of `<mj-style>`.  I also added CSS parsing using tinycss2. My idea is that this would blow up if the contents would be invalid (e.g. other HTML code) but I did not test that. Not sure if it is worth the additional dependency because arbitrary CSS can influence the displayed contents...  Update: It seems like tinycss happily parses even completely invalid HTML but I think css\_inline would remove that. Should we just assume that the `<mj-style>` does not contain untrusted user input? (and maybe add a section to the readme?) |
| --- |

 üëç
1
 sh-at-cs reacted with thumbs up emoji

All reactions

* üëç
  1 reaction

Sorry, something went wrong.

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=80&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)

Copy link

Owner

### **[FelixSchwarz](/FelixSchwarz)** commented [Feb 21, 2024](#issuecomment-1957175150)

| Also maybe you can also check the security advisory draft I created for this issue. Feel free to suggest additions and please check if you agree with the severity classification. |
| --- |

All reactions

Sorry, something went wrong.

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=40&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)
[FelixSchwarz](/FelixSchwarz)
mentioned this issue
[Feb 21, 2024](#ref-pullrequest-2147737434)

[escaped HTML entities like `&gt;` were unescaped in the final mjml output
#54](/FelixSchwarz/mjml-python/pull/54)
 Merged

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=40&u=813ac44c46b5802ad3d5bd82969256d0458d7ef9&v=4)](/FelixSchwarz)
[FelixSchwarz](/FelixSchwarz)
closed this as [completed](/FelixSchwarz/mjml-python/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
[#54](/FelixSchwarz/mjml-python/pull/54)
[Feb 22, 2024](#event-11893912617)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FFelixSchwarz%2Fmjml-python%2Fissues%2F52)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [escaped HTML entities like `&gt;` were unescaped in the final mjml output](/FelixSchwarz/mjml-python/pull/54)
 [FelixSchwarz/mjml-python](/FelixSchwarz/mjml-python)

3 participants

[![@FelixSchwarz](https://avatars.githubusercontent.com/u/212753?s=52&v=4)](/FelixSchwarz) [![@caseyjhol](https://avatars.githubusercontent.com/u/2874325?s=52&v=4)](/caseyjhol) [![@sh-at-cs](https://avatars.githubusercontent.com/u/112704226?s=52&v=4)](/sh-at-cs)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.

