
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fskills-service%2Fblob%2F24dd22f43306fc616e4580fb8bb88f66b5d9b41d%2Fservice%2Fsrc%2Fmain%2Fjava%2Fskills%2Fcontroller%2FAdminController.groovy)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FNationalSecurityAgency%2Fskills-service%2Fblob%2F24dd22f43306fc616e4580fb8bb88f66b5d9b41d%2Fservice%2Fsrc%2Fmain%2Fjava%2Fskills%2Fcontroller%2FAdminController.groovy)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=NationalSecurityAgency%2Fskills-service)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[NationalSecurityAgency](/NationalSecurityAgency)
/
**[skills-service](/NationalSecurityAgency/skills-service)**
Public

* [Notifications](/login?return_to=%2FNationalSecurityAgency%2Fskills-service) You must be signed in to change notification settings
* [Fork
  96](/login?return_to=%2FNationalSecurityAgency%2Fskills-service)
* [Star
   423](/login?return_to=%2FNationalSecurityAgency%2Fskills-service)

* [Code](/NationalSecurityAgency/skills-service)
* [Issues
  163](/NationalSecurityAgency/skills-service/issues)
* [Pull requests
  1](/NationalSecurityAgency/skills-service/pulls)
* [Discussions](/NationalSecurityAgency/skills-service/discussions)
* [Actions](/NationalSecurityAgency/skills-service/actions)
* [Wiki](/NationalSecurityAgency/skills-service/wiki)
* [Security](/NationalSecurityAgency/skills-service/security)
* [Insights](/NationalSecurityAgency/skills-service/pulse)

Additional navigation options

* [Code](/NationalSecurityAgency/skills-service)
* [Issues](/NationalSecurityAgency/skills-service/issues)
* [Pull requests](/NationalSecurityAgency/skills-service/pulls)
* [Discussions](/NationalSecurityAgency/skills-service/discussions)
* [Actions](/NationalSecurityAgency/skills-service/actions)
* [Wiki](/NationalSecurityAgency/skills-service/wiki)
* [Security](/NationalSecurityAgency/skills-service/security)
* [Insights](/NationalSecurityAgency/skills-service/pulse)

## Files

 24dd22f
## Breadcrumbs

1. [skills-service](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d)
2. /[service](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service)
3. /[src](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src)
4. /[main](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main)
5. /[java](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java)
6. /[skills](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills)
7. /[controller](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills/controller)
/
# AdminController.groovy

Copy path Blame  Blame
## Latest commit

## History

[History](/NationalSecurityAgency/skills-service/commits/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills/controller/AdminController.groovy)1731 lines (1434 loc) · 97.5 KB 24dd22f
## Breadcrumbs

1. [skills-service](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d)
2. /[service](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service)
3. /[src](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src)
4. /[main](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main)
5. /[java](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java)
6. /[skills](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills)
7. /[controller](/NationalSecurityAgency/skills-service/tree/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills/controller)
/
# AdminController.groovy

Top
## File metadata and controls

* Code
* Blame

1731 lines (1434 loc) · 97.5 KB[Raw](https://github.com/NationalSecurityAgency/skills-service/raw/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills/controller/AdminController.groovy)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\*\* \* Copyright 2020 SkillTree \* \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* \* https://www.apache.org/licenses/LICENSE-2.0 \* \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/package skills.controller
import groovy.transform.CompileStaticimport groovy.util.logging.Slf4jimport org.apache.commons.lang3.StringUtilsimport org.springframework.beans.factory.annotation.Autowiredimport org.springframework.beans.factory.annotation.Valueimport org.springframework.data.domain.PageRequestimport org.springframework.http.HttpHeadersimport org.springframework.http.HttpStatusimport org.springframework.http.MediaTypeimport org.springframework.http.ResponseEntityimport org.springframework.web.bind.annotation.\*import org.springframework.web.multipart.MultipartFileimport skills.PublicPropsimport skills.auth.UserInfoServiceimport skills.controller.exceptions.ErrorCodeimport skills.controller.exceptions.SkillExceptionimport skills.controller.exceptions.SkillsValidatorimport skills.controller.request.model.\*import skills.controller.result.model.\*import skills.dbupgrade.DBUpgradeSafeimport skills.services.\*import skills.services.admin.\*import skills.services.admin.moveSkills.SkillsMoveServiceimport skills.services.admin.skillReuse.SkillReuseIdUtilimport skills.services.admin.skillReuse.SkillReuseServiceimport skills.services.attributes.ExpirationAttrsimport skills.services.attributes.SkillAttributeServiceimport skills.services.attributes.SkillVideoAttrsimport skills.services.events.BulkSkillEventResultimport skills.services.events.pointsAndAchievements.InsufficientPointsValidatorimport skills.services.inception.InceptionProjectServiceimport skills.services.settings.ProjectSettingsValidatorimport skills.services.settings.Settingsimport skills.services.settings.SettingsServiceimport skills.services.settings.listeners.ValidationResimport skills.services.userActions.DashboardActionimport skills.services.userActions.DashboardItemimport skills.services.userActions.UserActionsHistoryServiceimport skills.services.video.AdminVideoServiceimport skills.storage.model.ExpiredUserAchievementimport skills.storage.model.SkillDefimport skills.storage.model.SkillRelDefimport skills.utils.ClientSecretGeneratorimport skills.utils.InputSanitizerimport skills.utils.TablePageUtil
import java.nio.charset.StandardCharsets
import static org.springframework.data.domain.Sort.Direction.ASCimport static org.springframework.data.domain.Sort.Direction.DESC
@RestController@RequestMapping("/admin")@Slf4j@skills.profile.EnableCallStackProfclass AdminController {
 @Autowired LevelDefinitionStorageService levelDefinitionStorageService
 @Autowired AdminUsersService adminUsersService
 @Autowired UserAdminService userAdminService
 @Autowired SettingsService settingsService
 @Autowired SkillEventAdminService skillEventService
 @Autowired GlobalBadgesService globalBadgesService
 @Autowired PublicPropsBasedValidator propsBasedValidator
 @Autowired ControllerPropsValidatorAndSanitizer controllerPropsValidatorAndSanitizer
 @Autowired ProjAdminService projAdminService
 @Autowired SubjAdminService subjAdminService
 @Autowired ProjectCopyService projectCopyService
 @Autowired BadgeAdminService badgeAdminService
 @Autowired SkillsAdminService skillsAdminService
 @Autowired SaveSkillService saveSkillService
 @Autowired SkillsGroupAdminService skillsGroupAdminService
 @Autowired SkillsDepsService skillsDepsService
 @Autowired ShareSkillsService shareSkillsService
 @Autowired SkillTagService skillTagService
 @Autowired ProjectSettingsValidator projectSettingsValidator
 @Value('#{"${skills.config.ui.maxTimeWindowInMinutes}"}') int maxTimeWindowInMinutes
 @Value('#{"${skills.config.ui.maxBadgeBonusInMinutes}"}') int maxBadgeBonusInMinutes
 @Value('#{"${skills.config.maxUserIdsForBulkSkillReporting:1000}"}') int maxUserIdsForBulkSkillReporting
 @Autowired ProjectErrorService errorService
 @Autowired SkillEventAdminService skillEventAdminService
 @Autowired ContactUsersService contactUsersService
 @Autowired CustomValidator customValidator
 @Autowired UserInfoService userInfoService
 @Autowired SkillCatalogService skillCatalogService
 @Autowired SkillReuseService skillReuseService
 @Autowired SkillsMoveService skillsMoveService
 @Autowired InsufficientPointsValidator insufficientPointsValidator
 @Autowired InviteOnlyProjectService inviteOnlyProjectService
 @Autowired SkillAttributeService skillAttributeService
 @Autowired AdminVideoService adminVideoService
 @Autowired UserAchievementExpirationService userAchievementExpirationService
 @Autowired UserActionsHistoryService userActionsHistoryService
 @Value('#{"${skills.config.ui.maxSkillsInBulkImport}"}') int maxBulkImport
 @Value('#{"${skills.config.ui.maxProjectInviteEmails:50}"}') int maxInviteEmails
 @RequestMapping(value = "/projects/{id}", method = [RequestMethod.PUT, RequestMethod.POST], produces = "application/json") @ResponseBody RequestResult saveProject(@PathVariable("id") String projectId, @RequestBody ProjectRequest projectRequest) { projectRequest = controllerPropsValidatorAndSanitizer.validateAndSanitizeProjectRequest(projectRequest) projectId = controllerPropsValidatorAndSanitizer.validateAndSanitizeProjectId(projectId) projAdminService.saveProject(projectId, projectRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{id}/copy", method = [RequestMethod.PUT, RequestMethod.POST], produces = "application/json") @ResponseBody RequestResult copyProject(@PathVariable("id") String projectId, @RequestBody ProjectRequest projectRequest) { projectRequest = controllerPropsValidatorAndSanitizer.validateAndSanitizeProjectRequest(projectRequest) projectId = controllerPropsValidatorAndSanitizer.validateAndSanitizeProjectId(projectId) projectCopyService.copyProject(projectId, projectRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{id}/invite", method = [RequestMethod.PUT, RequestMethod.POST], produces = "application/json") @ResponseBody InviteUsersResult generateInvite(@PathVariable("id") String projectId, @RequestBody ProjectInviteRequest inviteRequest) { SkillsValidator.isNotBlank(projectId, "Project ID") SkillsValidator.isTrue(!inviteRequest?.recipients?.isEmpty(), "at least one email is required") SkillsValidator.isTrue(inviteRequest?.recipients?.size() <= maxInviteEmails, "No more than ${maxInviteEmails} project invites may be sent at one time")
 InviteUsersResult res = inviteOnlyProjectService.inviteUsers(projectId, inviteRequest.recipients, inviteRequest.validityDuration) return res }
 @RequestMapping(value ="/projects/{id}/invites/status", method = RequestMethod.GET, produces = "application/json") @ResponseBody TableResult getInviteStatus(@PathVariable("id") String projectId, @RequestParam int limit, @RequestParam int page, @RequestParam String orderBy, @RequestParam Boolean ascending, @RequestParam(required = false, defaultValue = "") String query) {
 PageRequest pagingRequest = TablePageUtil.createPagingRequestWithValidation(projectId, limit, page, orderBy, ascending) return inviteOnlyProjectService.getPendingInvites(projectId, URLDecoder.decode(query, StandardCharsets.UTF\_8), pagingRequest) }
 @RequestMapping(value="/projects/{id}/invites/extend", method = RequestMethod.POST, produces = "application/json") @ResponseBody RequestResult extendInviteExpiration(@PathVariable("id") String projectId, @RequestBody InviteExtensionRequest inviteExtensionRequest) { SkillsValidator.isNotBlank(projectId, "Project ID") SkillsValidator.isNotBlank(inviteExtensionRequest?.extensionDuration, "Extension Duration") SkillsValidator.isNotBlank(inviteExtensionRequest?.recipientEmail, "Recipient Email")
 inviteOnlyProjectService.extendValidity(projectId, inviteExtensionRequest.recipientEmail, inviteExtensionRequest.extensionDuration) return RequestResult.success() }
 @RequestMapping(value="/projects/{id}/invites/{recipient}", method = RequestMethod.DELETE, produces = "application/json") @ResponseBody RequestResult deleteInvite(@PathVariable("id") String projectId, @PathVariable("recipient") String recipientEmail) { SkillsValidator.isNotBlank(projectId, "Project ID") SkillsValidator.isNotBlank(recipientEmail, "Recipient Email")
 inviteOnlyProjectService.deleteInvite(projectId, recipientEmail) return RequestResult.success() }
 @RequestMapping(value="/projects/{id}/invites/{recipient}/remind", method = RequestMethod.POST, produces = "application/json") @ResponseBody RequestResult sendInviteReminder(@PathVariable("id") String projectId, @PathVariable("recipient") String recipientEmail) { SkillsValidator.isNotBlank(projectId, "Project ID") SkillsValidator.isNotBlank(recipientEmail, "Recipient Email")
 inviteOnlyProjectService.remindUser(projectId, recipientEmail) return RequestResult.success() }
 @RequestMapping(value="/projects/{id}/cancelExpiration") RequestResult cancelExpiration(@PathVariable("id") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id") projAdminService.cancelProjectExpiration(projectId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{id}", method = RequestMethod.DELETE) void deleteProject(@PathVariable("id") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id") projAdminService.deleteProject(projectId) }
 @RequestMapping(value = "/projects/{projectId}", method = RequestMethod.PATCH, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult setProjectDisplayOrder( @PathVariable("projectId") String projectId, @RequestBody ActionPatchRequest projectPatchRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotNull(projectPatchRequest.action, "Action", projectId)
 projAdminService.setProjectDisplayOrder(projectId, projectPatchRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{id}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody ProjectResult getProject(@PathVariable("id") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id") return projAdminService.getProject(projectId) }
 @RequestMapping(value = "/projects/{id}/projectSearch", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<SimpleProjectResult> searchProjects(@PathVariable("id") String projectId, @RequestParam("nameQuery") nameQuery) { SkillsValidator.isNotBlank(projectId, "Project Id") return projAdminService.searchProjects(projectId, nameQuery)?.findAll {it.projectId != InceptionProjectService.inceptionProjectId} }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}", method = [RequestMethod.PUT, RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult saveSubject(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @RequestBody SubjectRequest subjectRequest) { subjectRequest.subjectId = subjectRequest.subjectId ?: subjectId SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotBlank(subjectRequest?.name, "Subject name", projectId)
 IdFormatValidator.validate(subjectRequest.subjectId)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxIdLength, "Subject Id", subjectRequest.subjectId) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minIdLength, "Subject Id", subjectRequest.subjectId)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxSubjectNameLength, "Subject Name", subjectRequest.name) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minNameLength, "Subject Name", subjectRequest.name) propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.descriptionMaxLength, "Subject Description", subjectRequest.description)
 subjectRequest.subjectId = InputSanitizer.sanitize(subjectRequest.subjectId) subjectRequest.description = InputSanitizer.sanitize(subjectRequest.description) subjectRequest.name = InputSanitizer.sanitize(subjectRequest.name)?.trim() subjectRequest.iconClass = InputSanitizer.sanitize(subjectRequest.iconClass) subjectRequest.helpUrl = InputSanitizer.sanitizeUrl(subjectRequest.helpUrl)
 subjAdminService.saveSubject(InputSanitizer.sanitize(projectId), subjectId, subjectRequest) return new RequestResult(success: true) }
 @DBUpgradeSafe @RequestMapping(value = "/projects/{projectId}/subjectNameExists", method = RequestMethod.POST, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody boolean doesSubjectNameExist(@PathVariable("projectId") String projectId, @RequestBody NameExistsRequest existsRequest) { String subjectName = existsRequest.name?.trim() SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectName, "Subject Name", projectId, null, true )
 def sanitize = InputSanitizer.sanitize(subjectName) return subjAdminService.existsBySubjectName(InputSanitizer.sanitize(projectId), sanitize) }
 @DBUpgradeSafe @RequestMapping(value = "/projects/{projectId}/badgeNameExists", method = RequestMethod.POST, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody boolean doesBadgeExist(@PathVariable("projectId") String projectId, @RequestBody NameExistsRequest nameExistsRequest) { String badgeName = nameExistsRequest.name?.trim() SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeName, "Badge Name", projectId, null, true) return badgeAdminService.existsByBadgeName(InputSanitizer.sanitize(projectId), InputSanitizer.sanitize(badgeName)) }
 @DBUpgradeSafe @RequestMapping(value = "/projects/{projectId}/skillNameExists", method = RequestMethod.POST, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody boolean doesSkillNameExist(@PathVariable("projectId") String projectId, @RequestBody NameExistsRequest existsRequest) { String skillName = existsRequest.name?.trim() SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(skillName, "Skill Name", projectId, null, true) return skillsAdminService.existsBySkillName(InputSanitizer.sanitize(projectId), InputSanitizer.sanitize(skillName)) }
 /\*\* \* checks whether any entities with the given id exist, which can be id for subject, skill, badge, etc... \* @param projectId \* @param id - this id can be subject, skill, badge, et.. \* @return true or false \*/ @RequestMapping(value = "/projects/{projectId}/entityIdExists", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody boolean doesProjectEntityIdExist(@PathVariable("projectId") String projectId, @RequestParam(value = "id") String id) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(id, "Entity Id")
 return skillsAdminService.existsBySkillId(InputSanitizer.sanitize(projectId), InputSanitizer.sanitize(id)) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}", method = RequestMethod.DELETE) void deleteSubject(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId)
 subjAdminService.deleteSubject(projectId, subjectId) }
 @RequestMapping(value = "/projects/{projectId}/subjects", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody List<SubjectResult> getSubjects(@PathVariable("projectId") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id") return subjAdminService.getSubjects(projectId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody SubjectResult getSubject(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) return subjAdminService.getSubject(projectId, subjectId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}", method = RequestMethod.PATCH, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult setSubjectDisplayOrder( @PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @RequestBody ActionPatchRequest subjectPatchRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotNull(subjectPatchRequest.action, "Action must be provided", projectId) subjAdminService.setSubjectDisplayOrder(projectId, subjectId, subjectPatchRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/badges/{badgeId}", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult saveBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId, @RequestBody BadgeRequest badgeRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId) badgeRequest.badgeId = badgeRequest.badgeId ?: badgeId SkillsValidator.isNotBlank(badgeRequest?.name, "Badge Name", projectId) SkillsValidator.isTrue((badgeRequest.startDate && badgeRequest.endDate) || (!badgeRequest.startDate && !badgeRequest.endDate), "If one date is provided then both start and end dates must be provided", projectId)
 IdFormatValidator.validate(badgeRequest.badgeId)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxIdLength, "Badge Id", badgeRequest.badgeId) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minIdLength, "Badge Id", badgeRequest.badgeId)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxBadgeNameLength, "Badge Name", badgeRequest.name) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minNameLength, "Badge Name", badgeRequest.name) propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.descriptionMaxLength, "Badge Description", badgeRequest.description)
 if(badgeRequest.awardAttrs?.numMinutes) { SkillsValidator.isTrue(badgeRequest.awardAttrs?.numMinutes <= maxBadgeBonusInMinutes, "numMinutes must be <= $maxBadgeBonusInMinutes", projectId, badgeRequest.badgeId) }
 badgeRequest.name = InputSanitizer.sanitize(badgeRequest.name)?.trim() badgeRequest.badgeId = InputSanitizer.sanitize(badgeRequest.badgeId) badgeRequest.description = InputSanitizer.sanitize(badgeRequest.description) badgeRequest.helpUrl = InputSanitizer.sanitizeUrl(badgeRequest.helpUrl)
 badgeAdminService.saveBadge(projectId, badgeId, badgeRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/badge/{badgeId}/skills/{skillId}", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult assignSkillToBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId, @PathVariable("skillId") String skillId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId) SkillsValidator.isTrue(!skillId.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "Skill ID must not contain reuse tag", projectId, skillId)
 badgeAdminService.addSkillToBadge(projectId, badgeId, skillId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/badge/{badgeId}/skills/add", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult assignSkillsToBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId, @RequestBody SkillIdsRequest skillsIdsRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId) SkillsValidator.isNotEmpty(skillsIdsRequest?.skillIds, "Skill Ids", projectId) String reusedSkillId = skillsIdsRequest.skillIds.find {it.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()) } SkillsValidator.isTrue(!reusedSkillId, "Skill ID must not contain reuse tag", projectId, reusedSkillId)
 badgeAdminService.addSkillsToBadge(projectId, badgeId, skillsIdsRequest.skillIds) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/badge/{badgeId}/skills/{skillId}", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult removeSkillFromBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId, @PathVariable("skillId") String skillId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId)
 badgeAdminService.removeSkillFromBadge(projectId, badgeId, skillId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/badges/{badgeId}", method = RequestMethod.DELETE) void deleteBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId)
 badgeAdminService.deleteBadge(projectId, badgeId) }
 @RequestMapping(value = "/projects/{projectId}/badges", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody List<BadgeResult> getBadges(@PathVariable("projectId") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id")
 return badgeAdminService.getBadges(projectId) }
 @RequestMapping(value = "/projects/{projectId}/badges/{badgeId}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody BadgeResult getBadge(@PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId)
 return badgeAdminService.getBadge(projectId, badgeId) }
 @RequestMapping(value = "/projects/{projectId}/badges/{badgeId}", method = RequestMethod.PATCH, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody void setBadgeDisplayOrder( @PathVariable("projectId") String projectId, @PathVariable("badgeId") String badgeId, @RequestBody ActionPatchRequest badgePatchRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(badgeId, "Badge Id", projectId) SkillsValidator.isNotNull(badgePatchRequest.action, "Action must be provided", projectId)
 badgeAdminService.setBadgeDisplayOrder(projectId, badgeId, badgePatchRequest) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/skills", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<SkillDefPartialRes> getSkills( @PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @RequestParam(required = false, value = "includeGroupSkills", defaultValue = 'false') Boolean includeGroupSkillsStr) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId)
 Boolean includeGroupSkills = Boolean.valueOf(includeGroupSkillsStr) return skillsAdminService.getSkillsForSubjectWithCatalogStatus(projectId, subjectId, includeGroupSkills) }
 @RequestMapping(value = "/projects/{projectId}/groups/{groupId}/skills", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<SkillDefPartialRes> getSkillsForSkillsGroup( @PathVariable("projectId") String projectId, @PathVariable("groupId") String groupId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(groupId, "Skills Group Id", projectId)
 return skillsAdminService.getSkillsByProjectSkillAndType(projectId, groupId, SkillDef.ContainerType.SkillsGroup, SkillRelDef.RelationshipType.SkillsGroupRequirement) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/skills/{skillId}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody SkillDefRes getSkill( @PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("skillId") String skillId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId)
 return skillsAdminService.getSkill(projectId, subjectId, skillId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/skills/{skillId}", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult saveSkill(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("skillId") String skillId, @RequestBody SkillRequest skillRequest) {
 validateAndSaveSkill(projectId, subjectId, skillId, skillRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/video", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody SkillVideoAttrs saveSkillVideoAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId, @RequestParam(name = "file", required = false) MultipartFile file, @RequestParam(name = "videoUrl", required = false) String videoUrl, @RequestParam(name = "isAlreadyHosted", required = false, defaultValue = "false") Boolean isAlreadyHosted, @RequestParam(name = "captions", required = false) String captions, @RequestParam(name = "transcript", required = false) String transcript) {
 if (captions) { propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxVideoCaptionsLength, "Captions", captions) } if (transcript) { propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxVideoTranscriptLength, "Transcript", transcript) }
 SkillVideoAttrs res = adminVideoService.saveVideo(projectId, skillId, isAlreadyHosted, file, videoUrl, captions, transcript) return res }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/video", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult deleteSkillVideoAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId) { adminVideoService.deleteVideoAttrs(projectId, skillId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/video", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody SkillVideoAttrs getSkillVideoAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId) { return skillAttributeService.getVideoAttrs(projectId, skillId) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/expiration", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult saveSkillExpirationAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId, @RequestBody ExpirationAttrs skillExpirationAttrsRequest) {
 SkillsValidator.isTrue(!skillCatalogService.isSkillImportedFromCatalog(projectId, skillId), "Cannot configure expiration attribute on skills imported from the catalog") SkillsValidator.isTrue(!SkillReuseIdUtil.isTagged(skillId), "Cannot configure expiration attribute on skills that are reused") skillAttributeService.saveExpirationAttrs(projectId, skillId, skillExpirationAttrsRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/expiration", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult deleteSkillExpirationAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId) { skillAttributeService.deleteExpirationAttrs(projectId, skillId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/expiration", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody ExpirationAttrs getSkillExpirationAttrs(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId) {
 return skillAttributeService.getExpirationAttrs(projectId, skillId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/groups/{groupId}/skills/{skillId}", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult saveSkillAndAssignToSkillsGroup(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("groupId") String groupId, @PathVariable("skillId") String skillId, @RequestBody SkillRequest skillRequest) { SkillsValidator.isNotBlank(groupId, "Skills Group Id", projectId) validateAndSaveSkill(projectId, subjectId, skillId, skillRequest, groupId) return new RequestResult(success: true) }
 private void validateAndSaveSkill(String projectId, String subjectId, String skillId, SkillRequest skillRequest, String groupId=null) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId)
 SkillsValidator.isFirstOrMustEqualToSecond(skillRequest.projectId, projectId, "Project Id") skillRequest.projectId = skillRequest.projectId ?: projectId
 SkillsValidator.isFirstOrMustEqualToSecond(skillRequest.subjectId, subjectId, "Subject Id") skillRequest.subjectId = skillRequest.subjectId ?: subjectId skillRequest.skillId = skillRequest.skillId ?: skillId SkillsValidator.isTrue(!skillRequest.skillId.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "Skill ID must not contain reuse tag", projectId, skillId) SkillsValidator.isTrue(!skillRequest.name?.toUpperCase()?.contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "Skill Name must not contain reuse tag", projectId, skillId)
 // if type is not provided then we default to skill skillRequest.type = skillRequest.type ?: SkillDef.ContainerType.Skill.toString() Boolean isBasicSkill = skillRequest.type == SkillDef.ContainerType.Skill.toString()
 IdFormatValidator.validate(skillRequest.skillId, isBasicSkill) propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxIdLength, "Skill Id", skillRequest.skillId) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minIdLength, "Skill Id", skillRequest.skillId)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.maxSkillNameLength, "Skill Name", skillRequest.name) propsBasedValidator.validateMinStrLength(PublicProps.UiProp.minNameLength, "Skill Name", skillRequest.name)
 skillRequest.name = InputSanitizer.sanitize(skillRequest.name)?.trim() skillRequest.projectId = InputSanitizer.sanitize(skillRequest.projectId) skillRequest.skillId = InputSanitizer.sanitize(skillRequest.skillId) skillRequest.subjectId = InputSanitizer.sanitize(skillRequest.subjectId)
 if (isBasicSkill) { SkillsValidator.isTrue(skillRequest.pointIncrement > 0, "pointIncrement must be > 0", projectId, skillId) propsBasedValidator.validateMaxIntValue(PublicProps.UiProp.maxPointIncrement, "pointIncrement", skillRequest.pointIncrement)
 SkillsValidator.isTrue(skillRequest.pointIncrementInterval >= 0, "pointIncrementInterval must be >= 0", projectId, skillId) SkillsValidator.isTrue(skillRequest.pointIncrementInterval <= maxTimeWindowInMinutes, "pointIncrementInterval must be <= $maxTimeWindowInMinutes", projectId, skillId) SkillsValidator.isTrue(skillRequest.numPerformToCompletion > 0, "numPerformToCompletion must be > 0", projectId, skillId) propsBasedValidator.validateMaxIntValue(PublicProps.UiProp.maxNumPerformToCompletion, "numPerformToCompletion", skillRequest.numPerformToCompletion)
 if (skillRequest.pointIncrementInterval > 0) { // if pointIncrementInterval is disabled then this validation is not needed SkillsValidator.isTrue(skillRequest.numMaxOccurrencesIncrementInterval > 0, "numMaxOccurrencesIncrementInterval must be > 0", projectId, skillId) SkillsValidator.isTrue(skillRequest.numPerformToCompletion >= skillRequest.numMaxOccurrencesIncrementInterval, "numPerformToCompletion must be >= numMaxOccurrencesIncrementInterval", projectId, skillId) propsBasedValidator.validateMaxIntValue(PublicProps.UiProp.maxNumPointIncrementMaxOccurrences, "numMaxOccurrencesIncrementInterval", skillRequest.numMaxOccurrencesIncrementInterval) }
 SkillsValidator.isTrue(skillRequest.version >= 0, "version must be >= 0", projectId, skillId) propsBasedValidator.validateMaxIntValue(PublicProps.UiProp.maxSkillVersion, "Skill Version", skillRequest.version)
 propsBasedValidator.validateMaxStrLength(PublicProps.UiProp.descriptionMaxLength, "Skill Description", skillRequest.description) skillRequest.description = InputSanitizer.sanitize(skillRequest.description) skillRequest.helpUrl = InputSanitizer.sanitizeUrl(skillRequest.helpUrl) }
 // default to enabled skillRequest.enabled = skillRequest.enabled == null ? "true" : skillRequest.enabled
 if (skillRequest.selfReportingType == SkillDef.SelfReportingType.Quiz.toString()) { SkillsValidator.isTrue(StringUtils.isNotBlank(skillRequest.quizId), "When selfReportingType=Quiz then quizId param must not be blank", projectId, skillId) }
 if (skillRequest.quizId) { SkillsValidator.isTrue(skillRequest.selfReportingType == SkillDef.SelfReportingType.Quiz.toString(), "When quizId is provided then selfReportingType must equal 'Quiz'", projectId, skillId) SkillsValidator.isTrue(skillRequest.numPerformToCompletion == 1, "When quizId is provided numPerformToCompletion must be equal 1", projectId, skillId) }
 saveSkillService.saveSkillAndSchedulePropagationToImportedSkills(skillId, skillRequest, true, groupId) }
 @GetMapping(value = '/projects/{projectId}/latestVersion', produces = 'application/json') Integer findLatestSkillVersion(@PathVariable('projectId') String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id") return skillsAdminService.findMaxVersionByProjectId(projectId) }
 @RequestMapping(value = "/projects/{projectId}/hasDependency", method = [RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody List<SkillDepResult> doSkillsHaveDependency(@PathVariable("projectId") String projectId, @RequestBody SkillIdsRequest checkSkillsDepsRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotEmpty(checkSkillsDepsRequest?.skillIds, "Skill Ids", projectId)
 return skillsDepsService.checkIfSkillsHaveDeps(projectId, checkSkillsDepsRequest?.skillIds) }
 @RequestMapping(value = "/projects/{projectId}/{id}/prerequisite/{prereqProjectId}/{prereqId}", method = [RequestMethod.POST, RequestMethod.PUT], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult addLearningPathItem(@PathVariable("projectId") String projectId, @PathVariable("id") String id, @PathVariable("prereqProjectId") String prereqProjectId, @PathVariable("prereqId") String prereqId) { SkillsValidator.isNotBlank(projectId, "To Project Id", projectId) SkillsValidator.isNotBlank(id, "To Id", id) SkillsValidator.isNotBlank(prereqProjectId, "From Project Id") SkillsValidator.isNotBlank(prereqId, "From Id", prereqId)
 SkillsValidator.isTrue(!id.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "To ID must not contain reuse tag", projectId, id) SkillsValidator.isTrue(!prereqId.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "From ID must not contain reuse tag", projectId, prereqId)
 skillsDepsService.addLearningPathItem(projectId, id, prereqId, prereqProjectId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/{id}/prerequisiteValidate/{prereqProjectId}/{prereqId}", method = [RequestMethod.GET], produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody DependencyCheckResult validateLearningPathItem(@PathVariable("projectId") String projectId, @PathVariable("id") String id, @PathVariable("prereqProjectId") String prereqProjectId, @PathVariable("prereqId") String prereqId) { SkillsValidator.isNotBlank(projectId, "To Project Id", projectId) SkillsValidator.isNotBlank(id, "To Id", id) SkillsValidator.isNotBlank(prereqProjectId, "From Project Id") SkillsValidator.isNotBlank(prereqId, "From Id", prereqId)
 SkillsValidator.isTrue(!id.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "To ID must not contain reuse tag", projectId, id) SkillsValidator.isTrue(!prereqId.toUpperCase().contains(SkillReuseIdUtil.REUSE\_TAG.toUpperCase()), "From ID must not contain reuse tag", projectId, prereqId)
 return skillsDepsService.validatePossibleLearningPathItem(projectId, id, prereqId, prereqProjectId) }
 @RequestMapping(value = "/projects/{projectId}/{id}/prerequisite/{prereqProjectId}/{prereqId}", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult removeDependencyFromAnotherProject(@PathVariable("projectId") String projectId, @PathVariable("id") String id, @PathVariable("prereqProjectId") String prereqProjectId, @PathVariable("prereqId") String prereqId) { SkillsValidator.isNotBlank(projectId, "To Project Id", projectId) SkillsValidator.isNotBlank(id, "To Id", id) SkillsValidator.isNotBlank(prereqProjectId, "From Project Id") SkillsValidator.isNotBlank(prereqId, "From Id", prereqId)
 skillsDepsService.removeLearningPathItem(projectId, id, prereqProjectId, prereqId) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/dependency/graph", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody SkillsGraphRes getDependencyForProject(@PathVariable("projectId") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id")
 return skillsDepsService.getDependentSkillsGraph(projectId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/skills/{skillId}", method = RequestMethod.PATCH) @ResponseBody RequestResult updateSkillDisplayOrder(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("skillId") String skillId, @RequestBody ActionPatchRequest patchRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId) SkillsValidator.isNotNull(patchRequest.action, "Action must be provided", projectId)
 skillsAdminService.updateSkillDisplayOrder(projectId, subjectId, skillId, patchRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/skills/{skillId}", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody void deleteSkill(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("skillId") String skillId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotBlank(skillId, "Skill Id", projectId)
 skillsAdminService.deleteSkill(projectId, skillId) }
 @RequestMapping(value = "/projects/{projectId}/users/{userId}/events", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult deleteAllSkillEventsForUser(@PathVariable("projectId") String projectId, @PathVariable("userId") String userId) {
 return skillEventService.bulkDeleteSkillEventsForUser(projectId, userId?.toLowerCase()) }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}/users/{userId}/events/{timestamp}", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody RequestResult deleteSkillEvent(@PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId, @PathVariable("userId") String userId, @PathVariable("timestamp") Long timestamp) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotNull(skillId, "Skill Id", projectId) SkillsValidator.isNotNull(userId, "User Id", projectId) SkillsValidator.isNotNull(timestamp, "Timestamp", projectId)
 return skillEventService.deleteSkillEvent(projectId, skillId, userId?.toLowerCase(), timestamp) }
 @RequestMapping(value = "/projects/{projectId}/skills", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<SkillDefSkinnyRes> getAllSkillsForProject( @PathVariable("projectId") String projectId, @RequestParam(required = false, value = "skillNameQuery") String skillNameQuery, @RequestParam(required = false, value = "excludeImportedSkills") Boolean excludeImportedSkills, @RequestParam(required = false, value = "excludeReusedSkills") Boolean excludeReusedSkills, @RequestParam(required = false, value = "includeDisabled", defaultValue = "false") Boolean includeDisabled) { SkillsValidator.isNotBlank(projectId, "Project Id")
 boolean excludeImportedSkillsBol = excludeImportedSkills boolean includeDisabledBool = includeDisabled List<SkillDefSkinnyRes> res = skillsAdminService.getSkinnySkills(projectId, skillNameQuery ?: '', excludeImportedSkillsBol, includeDisabledBool) if (excludeReusedSkills) { res = res.findAll { !it.isReused } } return res }
 @RequestMapping(value = "/projects/{projectId}/skillsAndBadges", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<SkillDefSkinnyRes> getAllSkillsAndBadgesForProject( @PathVariable("projectId") String projectId, @RequestParam(required = false, value = "skillNameQuery") String skillNameQuery, @RequestParam(required = false, value = "excludeImportedSkills") Boolean excludeImportedSkills, @RequestParam(required = false, value = "excludeReusedSkills") Boolean excludeReusedSkills, @RequestParam(required = false, value = "includeDisabled", defaultValue = "false") Boolean includeDisabled) { SkillsValidator.isNotBlank(projectId, "Project Id")
 boolean excludeImportedSkillsBol = excludeImportedSkills boolean includeDisabledBool = includeDisabled List<SkillDefSkinnyRes> res = skillsAdminService.getSkinnySkillsAndBadges(projectId, skillNameQuery ?: '', excludeImportedSkillsBol, includeDisabledBool) if (excludeReusedSkills) { res = res.findAll { !it.isReused } } return res }
 @RequestMapping(value = "/projects/{projectId}/skills/{skillId}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) SkillDefSkinnyRes getSkillInfo( @PathVariable("projectId") String projectId, @PathVariable("skillId") String skillId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(skillId, "Skill Id") SkillDefSkinnyRes res = skillsAdminService.getSkinnySkill(projectId, skillId) return res }
 @RequestMapping(value = "/projects/{projectId}/levels", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<LevelDefinitionRes> getLevels( @PathVariable("projectId") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id")
 List<LevelDefinitionRes> res = levelDefinitionStorageService.getLevels(projectId) return res }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/levels", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) List<LevelDefinitionRes> getLevels( @PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId)
 List<LevelDefinitionRes> res = levelDefinitionStorageService.getLevels(projectId, subjectId) return res }
 @RequestMapping(value = "/projects/{projectId}/levels/last", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) void deleteLastLevel(@PathVariable("projectId") String projectId) { SkillsValidator.isNotBlank(projectId, "Project Id")
 levelDefinitionStorageService.deleteLastLevel(projectId) }
 @RequestMapping(value = "/projects/{projectId}/levels/next", method = [RequestMethod.PUT, RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) RequestResult addNextLevel(@PathVariable("projectId") String projectId, @RequestBody NextLevelRequest nextLevelRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") levelDefinitionStorageService.addNextLevel(projectId, nextLevelRequest) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/levels/last", method = RequestMethod.DELETE, produces = MediaType.APPLICATION\_JSON\_VALUE) void deleteLastLevel(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId) { SkillsValidator.isNotBlank(projectId, "Project Id") levelDefinitionStorageService.deleteLastLevel(projectId, subjectId) }
 @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/levels/next", method = [RequestMethod.PUT, RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) RequestResult addNextLevel( @PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @RequestBody NextLevelRequest nextLevelRequest) { levelDefinitionStorageService.addNextLevel(projectId, nextLevelRequest, subjectId) return new RequestResult(success: true) }
 //Need new methods to edit existing level methods for project and subject @RequestMapping(value = "/projects/{projectId}/subjects/{subjectId}/levels/edit/{level}", method = [RequestMethod.PUT, RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) RequestResult editLevel(@PathVariable("projectId") String projectId, @PathVariable("subjectId") String subjectId, @PathVariable("level") Integer level, @RequestBody EditLevelRequest editLevelRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(subjectId, "Subject Id", projectId) SkillsValidator.isNotNull(level, "Level", projectId)
 levelDefinitionStorageService.editLevel(projectId, editLevelRequest, level, subjectId) return new RequestResult(success: true) }
 //Need new methods to edit existing level methods for project and subject @RequestMapping(value = "/projects/{projectId}/levels/edit/{level}", method = [RequestMethod.PUT, RequestMethod.POST], produces = MediaType.APPLICATION\_JSON\_VALUE) RequestResult editLevel(@PathVariable("projectId") String projectId, @PathVariable("level") Integer level, @RequestBody EditLevelRequest editLevelRequest) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotNull(level, "Level", projectId) levelDefinitionStorageService.editLevel(projectId, editLevelRequest, level) return new RequestResult(success: true) }
 @RequestMapping(value = "/projects/{projectId}/performedSkills/{userId}", method = RequestMethod.GET, produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody @CompileStatic TableResult getUserPerformedSkills(@PathVariable("projectId") String projectId, @PathVariable("userId") String userId, @RequestParam String query, @RequestParam int limit, @RequestParam int page, @RequestParam String orderBy, @RequestParam Boolean ascending) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(userId, "User Id", projectId)
 PageRequest pageRequest = PageRequest.of(page - 1, limit, ascending ? ASC : DESC, orderBy) return userAdminService.loadUserPerformedSkillsPage(projectId, userId?.toLowerCase(), query, pageRequest) }
 @GetMapping(value = '/projects/{projectId}/users/{userId}/stats', produces = 'application/json') @ResponseBody @CompileStatic UserSkillsStats getUserSkillsStats(@PathVariable('projectId') String projectId, @PathVariable('userId') String userId) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isNotBlank(userId, "User Id", projectId)
 return userAdminService.getUserSkillsStats(projectId, userId?.toLowerCase()) }
 @GetMapping(value = "/projects/{projectId}/users", produces = MediaType.APPLICATION\_JSON\_VALUE) @ResponseBody @CompileStatic TableResultWithTotalPoints getProjectUsers(@PathVariable("projectId") String projectId, @RequestParam String query, @RequestParam int limit, @RequestParam int page, @RequestParam String orderBy, @RequestParam Boolean ascending, @RequestParam int minimumPoints) { SkillsValidator.isNotBlank(projectId, "Project Id") SkillsValidator.isTrue(minimumPoints >=0, "Minimum Points is less than 0", projectId)[View remainder of file in raw view](https://github.com/NationalSecurityAgency/skills-service/raw/24dd22f43306fc616e4580fb8bb88f66b5d9b41d/service/src/main/java/skills/controller/AdminController.groovy)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

