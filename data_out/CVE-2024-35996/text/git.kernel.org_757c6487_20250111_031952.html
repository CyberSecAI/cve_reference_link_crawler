

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Christopherson <seanjc@google.com> | 2024-04-19 17:05:54 -0700 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-02 16:29:28 +0200 |
| commit | [38f17d1fbb5bfb56ca1419e2d06376d57a9396f9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)) | |
| tree | [74c14633c8d5f0b5b65a9c034fbe2d7a5bcf1472](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9) | |
| parent | [8bdbcfaf3eac42f98e5486b3d7e130fa287811f6](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8bdbcfaf3eac42f98e5486b3d7e130fa287811f6) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9&id2=8bdbcfaf3eac42f98e5486b3d7e130fa287811f6)) | |
| download | [linux-38f17d1fbb5bfb56ca1419e2d06376d57a9396f9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-38f17d1fbb5bfb56ca1419e2d06376d57a9396f9.tar.gz) | |

cpu: Re-enable CPU mitigations by default for !X86 architecturescommit fe42754b94a42d08cf9501790afc25c4f6a5f631 upstream.
Rename x86's to CPU\_MITIGATIONS, define it in generic code, and force it
on for all architectures exception x86. A recent commit to turn
mitigations off by default if SPECULATION\_MITIGATIONS=n kinda sorta
missed that "cpu\_mitigations" is completely generic, whereas
SPECULATION\_MITIGATIONS is x86-specific.
Rename x86's SPECULATIVE\_MITIGATIONS instead of keeping both and have it
select CPU\_MITIGATIONS, as having two configs for the same thing is
unnecessary and confusing. This will also allow x86 to use the knob to
manage mitigations that aren't strictly related to speculative
execution.
Use another Kconfig to communicate to common code that CPU\_MITIGATIONS
is already defined instead of having x86's menu depend on the common
CPU\_MITIGATIONS. This allows keeping a single point of contact for all
of x86's mitigations, and it's not clear that other architectures \*want\*
to allow disabling mitigations at compile-time.
Fixes: f337a6a21e2f ("x86/cpu: Actually turn off mitigations by default for SPECULATION\_MITIGATIONS=n")
Closes: https://lkml.kernel.org/r/20240413115324.53303a68%40canb.auug.org.au
Reported-by: Stephen Rothwell <sfr@canb.auug.org.au>
Reported-by: Michael Ellerman <mpe@ellerman.id.au>
Reported-by: Geert Uytterhoeven <geert@linux-m68k.org>
Signed-off-by: Sean Christopherson <seanjc@google.com>
Signed-off-by: Borislav Petkov (AMD) <bp@alien8.de>
Acked-by: Josh Poimboeuf <jpoimboe@kernel.org>
Acked-by: Borislav Petkov (AMD) <bp@alien8.de>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240420000556.2645001-2-seanjc@google.com](https://lore.kernel.org/r/20240420000556.2645001-2-seanjc%40google.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)

| -rw-r--r-- | [arch/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/Kconfig?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [arch/x86/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/Kconfig?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9) | 11 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [kernel/cpu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/cpu.c?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 16 insertions, 7 deletions

| diff --git a/arch/Kconfig b/arch/Kconfigindex f99fd9a4ca778d..e959abf969ec31 100644--- a/[arch/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/Kconfig?id=8bdbcfaf3eac42f98e5486b3d7e130fa287811f6)+++ b/[arch/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/Kconfig?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)@@ -9,6 +9,14 @@ # source "arch/$(SRCARCH)/Kconfig" +config ARCH\_CONFIGURES\_CPU\_MITIGATIONS+ bool++if !ARCH\_CONFIGURES\_CPU\_MITIGATIONS+config CPU\_MITIGATIONS+ def\_bool y+endif+ menu "General architecture-dependent options"  config CRASH\_COREdiff --git a/arch/x86/Kconfig b/arch/x86/Kconfigindex 5f7a86f240db76..49cea5b81649d3 100644--- a/[arch/x86/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/Kconfig?id=8bdbcfaf3eac42f98e5486b3d7e130fa287811f6)+++ b/[arch/x86/Kconfig](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/Kconfig?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)@@ -61,6 +61,7 @@ config X86 select ACPI\_SYSTEM\_POWER\_STATES\_SUPPORT if ACPI select ARCH\_32BIT\_OFF\_T if X86\_32 select ARCH\_CLOCKSOURCE\_INIT+ select ARCH\_CONFIGURES\_CPU\_MITIGATIONS select ARCH\_CORRECT\_STACKTRACE\_ON\_KRETPROBE select ARCH\_ENABLE\_HUGEPAGE\_MIGRATION if X86\_64 && HUGETLB\_PAGE && MIGRATION select ARCH\_ENABLE\_MEMORY\_HOTPLUG if X86\_64@@ -2449,17 +2450,17 @@ config CC\_HAS\_SLS config CC\_HAS\_RETURN\_THUNK def\_bool $(cc-option,-mfunction-return=thunk-extern) -menuconfig SPECULATION\_MITIGATIONS- bool "Mitigations for speculative execution vulnerabilities"+menuconfig CPU\_MITIGATIONS+ bool "Mitigations for CPU vulnerabilities" default y help- Say Y here to enable options which enable mitigations for- speculative execution hardware vulnerabilities.+ Say Y here to enable options which enable mitigations for hardware+ vulnerabilities (usually related to speculative execution).  If you say N, all mitigations will be disabled. You really should know what you are doing to say so. -if SPECULATION\_MITIGATIONS+if CPU\_MITIGATIONS  config PAGE\_TABLE\_ISOLATION bool "Remove the kernel mapping in user mode"diff --git a/kernel/cpu.c b/kernel/cpu.cindex 2c44dd12a158c1..e0e09b700b4303 100644--- a/[kernel/cpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cpu.c?id=8bdbcfaf3eac42f98e5486b3d7e130fa287811f6)+++ b/[kernel/cpu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/cpu.c?id=38f17d1fbb5bfb56ca1419e2d06376d57a9396f9)@@ -2788,8 +2788,8 @@ enum cpu\_mitigations { };  static enum cpu\_mitigations cpu\_mitigations \_\_ro\_after\_init =- IS\_ENABLED(CONFIG\_SPECULATION\_MITIGATIONS) ? CPU\_MITIGATIONS\_AUTO :- CPU\_MITIGATIONS\_OFF;+ IS\_ENABLED(CONFIG\_CPU\_MITIGATIONS) ? CPU\_MITIGATIONS\_AUTO :+ CPU\_MITIGATIONS\_OFF;  static int \_\_init mitigations\_parse\_cmdline(char \*arg) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:18:30 +0000

