=== Content from gitlab.com_18886d5f_20250111_184032.html ===


[Skip to content](#content-body)
GitLab
[Next](https://next.gitlab.com)

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# Pages Unique domain overwrite risk

### Problem

Currently it's possible to hijack pages with unique domain URLs. This is permitted because the current format of pages unique domains is `namespace-subgroup-...-project-<RANDOM STRING>`. Once this value is known, one can create a namespace (User or Group) with that *random* string and then a Gitlab Pages for that namespace (<https://docs.gitlab.com/ee/user/project/pages/getting_started_part_one.html#gitlab-pages-default-domain-names>), which will have priority on the URL lookup, hijacking the traffic. Example:

[Screen\_Recording\_2023-06-21\_at\_17.49.15](/-/project/278964/uploads/3e0f346f3eb96870beeb920e057aa78b/Screen_Recording_2023-06-21_at_17.49.15.mp4 "Download 'Screen_Recording_2023-06-21_at_17.49.15'")

### Proposed solution

* Instead of using `-` as the separator on the unique URL, use `*`.
  + `*` are valid URL chars, but are not valid as project/group name/path, preventing malicious users to create projects that could end-up with the same URL as a Pages Unique Domain URL.

### Notes

##### Update: 2023-06-26

```
ProjectSetting.joins(:project)
.where(project_settings: { pages_unique_domain_enabled: true })
.group('projects.visibility_level')
.count
.transform_keys { Gitlab::VisibilityLevel.string_options.key(_1) }

=> {"private"=>241, "public"=>76}
```

Public projects have higher risk of being attacked.

##### Update: 2023-06-27

* Hijacking projects

```
Project.where(path: ProjectSetting.select("project_settings.pages_unique_domain || '.gitlab.io'"))

=> []
```

* Hijacked projects

```
ProjectSetting
.joins(:project)
.where(projects: { path: "project_settings.pages_unique_domain || '.gitlab.io'" })
.select(:project_id)

=> []
```

Edited Jul 12, 2023 by [Kassio Borges](/kassio)

Assignee
Loading

Time tracking
Loading

Confidentiality

Confidentiality controls have moved to the issue actions menu () at the top of the page.


