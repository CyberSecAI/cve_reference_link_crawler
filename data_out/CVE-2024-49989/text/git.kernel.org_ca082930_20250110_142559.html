

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Tim Huang <tim.huang@amd.com> | 2024-08-15 18:45:22 -0400 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2024-08-20 22:14:14 -0400 |
| commit | [20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)) | |
| tree | [567829acfffc24daa566c944a2ca2867f915b517](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d) | |
| parent | [2344413205521775d3b1d418e5659e3ae3bc263f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2344413205521775d3b1d418e5659e3ae3bc263f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d&id2=2344413205521775d3b1d418e5659e3ae3bc263f)) | |
| download | [linux-20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d.tar.gz) | |

drm/amd/display: fix double free issue during amdgpu module unloadFlexible endpoints use DIGs from available inflexible endpoints,
so only the encoders of inflexible links need to be freed.
Otherwise, a double free issue may occur when unloading the
amdgpu module.
[ 279.190523] RIP: 0010:\_\_slab\_free+0x152/0x2f0
[ 279.190577] Call Trace:
[ 279.190580] <TASK>
[ 279.190582] ? show\_regs+0x69/0x80
[ 279.190590] ? die+0x3b/0x90
[ 279.190595] ? do\_trap+0xc8/0xe0
[ 279.190601] ? do\_error\_trap+0x73/0xa0
[ 279.190605] ? \_\_slab\_free+0x152/0x2f0
[ 279.190609] ? exc\_invalid\_op+0x56/0x70
[ 279.190616] ? \_\_slab\_free+0x152/0x2f0
[ 279.190642] ? asm\_exc\_invalid\_op+0x1f/0x30
[ 279.190648] ? dcn10\_link\_encoder\_destroy+0x19/0x30 [amdgpu]
[ 279.191096] ? \_\_slab\_free+0x152/0x2f0
[ 279.191102] ? dcn10\_link\_encoder\_destroy+0x19/0x30 [amdgpu]
[ 279.191469] kfree+0x260/0x2b0
[ 279.191474] dcn10\_link\_encoder\_destroy+0x19/0x30 [amdgpu]
[ 279.191821] link\_destroy+0xd7/0x130 [amdgpu]
[ 279.192248] dc\_destruct+0x90/0x270 [amdgpu]
[ 279.192666] dc\_destroy+0x19/0x40 [amdgpu]
[ 279.193020] amdgpu\_dm\_fini+0x16e/0x200 [amdgpu]
[ 279.193432] dm\_hw\_fini+0x26/0x40 [amdgpu]
[ 279.193795] amdgpu\_device\_fini\_hw+0x24c/0x400 [amdgpu]
[ 279.194108] amdgpu\_driver\_unload\_kms+0x4f/0x70 [amdgpu]
[ 279.194436] amdgpu\_pci\_remove+0x40/0x80 [amdgpu]
[ 279.194632] pci\_device\_remove+0x3a/0xa0
[ 279.194638] device\_remove+0x40/0x70
[ 279.194642] device\_release\_driver\_internal+0x1ad/0x210
[ 279.194647] driver\_detach+0x4e/0xa0
[ 279.194650] bus\_remove\_driver+0x6f/0xf0
[ 279.194653] driver\_unregister+0x33/0x60
[ 279.194657] pci\_unregister\_driver+0x44/0x90
[ 279.194662] amdgpu\_exit+0x19/0x1f0 [amdgpu]
[ 279.194939] \_\_do\_sys\_delete\_module.isra.0+0x198/0x2f0
[ 279.194946] \_\_x64\_sys\_delete\_module+0x16/0x20
[ 279.194950] do\_syscall\_64+0x58/0x120
[ 279.194954] entry\_SYSCALL\_64\_after\_hwframe+0x6e/0x76
[ 279.194980] </TASK>
Reviewed-by: Rodrigo Siqueira <rodrigo.siqueira@amd.com>
Signed-off-by: Tim Huang <tim.huang@amd.com>
Reviewed-by: Roman Li <roman.li@amd.com>
Signed-off-by: Roman Li <roman.li@amd.com>
Tested-by: Daniel Wheeler <daniel.wheeler@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)

| -rw-r--r-- | [drivers/gpu/drm/amd/display/dc/link/link\_factory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/display/dc/link/link_factory.c?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 1 insertions, 1 deletions

| diff --git a/drivers/gpu/drm/amd/display/dc/link/link\_factory.c b/drivers/gpu/drm/amd/display/dc/link/link\_factory.cindex 85fd6e42223805..5e1b5ab9fbc635 100644--- a/[drivers/gpu/drm/amd/display/dc/link/link\_factory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/link_factory.c?id=2344413205521775d3b1d418e5659e3ae3bc263f)+++ b/[drivers/gpu/drm/amd/display/dc/link/link\_factory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/display/dc/link/link_factory.c?id=20b5a8f9f4670a8503aa9fa95ca632e77c6bf55d)@@ -385,7 +385,7 @@ static void link\_destruct(struct dc\_link \*link) if (link->panel\_cntl) link->panel\_cntl->funcs->destroy(&link->panel\_cntl); - if (link->link\_enc) {+ if (link->link\_enc && !link->is\_dig\_mapping\_flexible) { /\* Update link encoder resource tracking variables. These are used for \* the dynamic assignment of link encoders to streams. Virtual links \* are not assigned encoder resources on creation. |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:24:36 +0000

