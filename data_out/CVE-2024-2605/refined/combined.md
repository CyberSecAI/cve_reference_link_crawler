=== Content from www.mozilla.org_28015232_20250110_221422.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-14

## Security Vulnerabilities fixed in Thunderbird 115.9

Announced
March 19, 2024
Impact
high
Products
Thunderbird
Fixed in

* Thunderbird 115.9

*In general, these flaws cannot be exploited through email in the Thunderbird product because scripting is disabled when reading mail, but are potentially risks in browser or browser-like contexts.*

#### [#CVE-2024-0743: Crash in NSS TLS method](#CVE-2024-0743)

Reporter
John Schanck
Impact
high
##### Description

An unchecked return value in TLS handshake code could have caused a potentially exploitable crash.

##### References

* [Bug 1867408](https://bugzilla.mozilla.org/show_bug.cgi?id=1867408)

#### [#CVE-2024-2605: Windows Error Reporter could be used as a Sandbox escape vector](#CVE-2024-2605)

Reporter
goodbyeselene
Impact
high
##### Description

An attacker could have leveraged the Windows Error Reporter to run arbitrary code on the system escaping the sandbox. *Note:* This issue only affected Windows operating systems. Other operating systems are unaffected.

##### References

* [Bug 1872920](https://bugzilla.mozilla.org/show_bug.cgi?id=1872920)

#### [#CVE-2024-2607: JIT code failed to save return registers on Armv7-A](#CVE-2024-2607)

Reporter
Gary Kwong
Impact
high
##### Description

Return registers were overwritten which could have allowed an attacker to execute arbitrary code. *Note:* This issue only affected Armv7-A systems. Other operating systems are unaffected.

##### References

* [Bug 1879939](https://bugzilla.mozilla.org/show_bug.cgi?id=1879939)

#### [#CVE-2024-2608: Integer overflow could have led to out of bounds write](#CVE-2024-2608)

Reporter
Ronald Crane
Impact
high
##### Description

`AppendEncodedAttributeValue(), ExtraSpaceNeededForAttrEncoding()` and `AppendEncodedCharacters()` could have experienced integer overflows, causing underallocation of an output buffer leading to an out of bounds write.

##### References

* [Bug 1880692](https://bugzilla.mozilla.org/show_bug.cgi?id=1880692)

#### [#CVE-2024-2616: Improve handling of out-of-memory conditions in ICU](#CVE-2024-2616)

Reporter
Ryan VanderMeulen and Dan Minor
Impact
high
##### Description

To harden ICU against exploitation, the behavior for out-of-memory conditions was changed to crash instead of attempt to continue.

##### References

* [Bug 1846197](https://bugzilla.mozilla.org/show_bug.cgi?id=1846197)

#### [#CVE-2023-5388: NSS susceptible to timing attack against RSA decryption](#CVE-2023-5388)

Reporter
Hubert Kario
Impact
moderate
##### Description

NSS was susceptible to a timing side-channel attack when performing RSA decryption. This attack could potentially allow an attacker to recover the private data.

##### References

* [Bug 1780432](https://bugzilla.mozilla.org/show_bug.cgi?id=1780432)

#### [#CVE-2024-2610: Improper handling of html and body tags enabled CSP nonce leakage](#CVE-2024-2610)

Reporter
Georg Felber and Marco Squarcina (TU Wien)
Impact
moderate
##### Description

Using a markup injection an attacker could have stolen nonce values. This could have been used to bypass strict content security policies.

##### References

* [Bug 1871112](https://bugzilla.mozilla.org/show_bug.cgi?id=1871112)

#### [#CVE-2024-2611: Clickjacking vulnerability could have led to a user accidentally granting permissions](#CVE-2024-2611)

Reporter
Hafiizh
Impact
moderate
##### Description

A missing delay on when pointer lock was used could have allowed a malicious page to trick a user into granting permissions.

##### References

* [Bug 1876675](https://bugzilla.mozilla.org/show_bug.cgi?id=1876675)

#### [#CVE-2024-2612: Self referencing object could have potentially led to a use-after-free](#CVE-2024-2612)

Reporter
Ronald Crane
Impact
moderate
##### Description

If an attacker could find a way to trigger a particular code path in `SafeRefPtr`, it could have triggered a crash or potentially be leveraged to achieve code execution.

##### References

* [Bug 1879444](https://bugzilla.mozilla.org/show_bug.cgi?id=1879444)

#### [#CVE-2024-2614: Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](#CVE-2024-2614)

Reporter
Noah Lokocz, Kevin Brosnan, Ryan VanderMeulen and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 123, Firefox ESR 115.8, and Thunderbird 115.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685358%2C1861016%2C1880405%2C1881093)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from bugzilla.mozilla.org_4c19c71d_20250110_221420.html ===


![](/static/v20250108.1/extensions/BMO/web/images/moz-fav-one-color-white-rgb.svg)

* [Mozilla Home](https://www.mozilla.org/)
* [Privacy](https://www.mozilla.org/privacy/websites/)
* [Cookies](https://www.mozilla.org/privacy/websites/#cookies)
* [Legal](https://www.mozilla.org/about/legal/)
# [Bugzilla](https://bugzilla.mozilla.org/home "Go to home page")

[Quick Search Tips](/page.cgi?id=quicksearch.html)
[Advanced Search](/query.cgi?format=advanced)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")

* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

* [Log In](/index.cgi?GoAheadAndLogIn=1)

   Log In with GitHub

  or

  Remember me

  [Create an Account](/createaccount.cgi)
  ·
  [Forgot Password](/index.cgi?GoAheadAndLogIn=1#forgot)

* [Browse](/describecomponents.cgi "Browse bugs by component")
* [Advanced Search](/query.cgi?format=advanced "Search bugs using various criteria")
* [New Bug](/enter_bug.cgi "File a new bug")
* [Reports](/report.cgi)
* [Documentation](https://bmo.readthedocs.io/en/latest/)

Please enable JavaScript in your browser to use all the features on this site.

Copy Summary▾

* Markdown
* Markdown (bug number)
* Plain Text
* HTML

View ▾

* Reset Sections
* Expand All Sections
* Collapse All Sections
* History
* [JSON](/rest/bug/1872920)
* [XML](/show_bug.cgi?ctype=xml&id=1872920)

Closed
[Bug 1872920](/show_bug.cgi?id=1872920)
(CVE-2024-2605)

Opened 1 year ago
Closed 11 months ago

# Sandbox escape via process type confusion in mozwer

\*
[Summary:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#short_desc)

Sandbox escape via process type confusion in mozwer

## Categories

### (Toolkit :: Crash Reporting, defect)

[Product:](/describecomponents.cgi?product=Toolkit)

Toolkit
▾

Toolkit
The Mozilla Toolkit is a set of APIs, built on top of Gecko, which provide advanced services to XUL applications. These services include Profile Management, Chrome Registration, Browsing History, Extension and Theme Management, Application Update Service, and Safe Mode. ([More info](https://wiki.mozilla.org/Modules/Toolkit))
[See Open Bugs in This Product](/buglist.cgi?product=Toolkit&bug_status=__open__)
[File New Bug in This Product](/enter_bug.cgi?product=Toolkit)
Watch This Product

[Component:](/describecomponents.cgi?product=Toolkit&component=Crash%20Reporting#Crash%20Reporting)

Crash Reporting
▾

Toolkit :: Crash Reporting
Breakpad crash reporting library - exception handler and crash report sender application.
[See Open Bugs in This Component](/buglist.cgi?product=Toolkit&component=Crash%20Reporting&bug_status=__open__)
[Recently Fixed Bugs in This Component](/buglist.cgi?product=Toolkit&component=Crash%20Reporting&chfield=resolution&chfieldfrom=-6m&chfieldvalue=FIXED&bug_status=__closed__)
[File New Bug in This Component](/enter_bug.cgi?product=Toolkit&component=Crash%20Reporting)
Watch This Component

[Version:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#version)

unspecified

[Platform:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#rep_platform)

Unspecified

Unspecified

[Type:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_type)

defect

[Priority:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#priority)

*Not set*

[Severity:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_severity)

S2

Points:

---

## Tracking

### ()

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED
FIXED

[Status:](https://wiki.mozilla.org/BMO/UserGuide/BugStatuses)

RESOLVED

FIXED

Mark as Assigned

[Milestone:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#target_milestone)

125 Branch

Iteration:

---

[Project Flags:](https://wiki.mozilla.org/BMO/UserGuide#Project_Flags)

| Accessibility Severity | --- |
| --- | --- |
| Webcompat Score | --- |
| a11y-review | --- |
| Webcompat Priority | --- |
| Performance Impact | --- |

[Tracking Flags:](https://wiki.mozilla.org/BMO/UserGuide#Tracking_Flags)

|  | Tracking | Status |
| --- | --- | --- |
| firefox-esr115 | [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed) |
| firefox123 | --- | [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix) |
| firefox124 | [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed) |
| firefox125 | [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B) | [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed) |

|  | Tracking | Status |
| --- | --- | --- |
| relnote-firefox |  | --- |
| thunderbird\_esr115 | --- | --- |
| thunderbird\_esr128 | --- | --- |
| firefox-esr115 | 124+ | fixed |
| firefox-esr128 | --- | --- |
| firefox123 |  | wontfix |
| firefox124 | + | fixed |
| firefox125 | + | fixed |
| firefox134 | --- | --- |
| firefox135 | --- | --- |
| firefox136 | --- | --- |

## People

### (Reporter: ynwarcs, Assigned: gsvelto)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

![](https://secure.gravatar.com/avatar/03fda82227c39197ab49cd9cef4e3e89?d=mm&size=40)  [gsvelto](/user_profile?user_id=448747)

[Assignee:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#assigned_to)

Reset Assignee to default

[Mentors:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_mentor)

---

[QA Contact:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#qa_contact)

Reset QA Contact to default

[Reporter:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#reporter)

![](https://secure.gravatar.com/avatar/6231edffbc4835afa41faa1d4305646d?d=mm&size=40)  [ynwarcs](/user_profile?user_id=740986)

[Triage Owner:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#triage_owner)

![](https://secure.gravatar.com/avatar/03fda82227c39197ab49cd9cef4e3e89?d=mm&size=40)  [gsvelto](/user_profile?user_id=448747)

[CC:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#cc)

23 people

## References

[Depends on:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#dependson)

---

[Blocks:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#blocks)

---

[Regressions:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regresses)

[1882080](/show_bug.cgi?id=1882080 "VERIFIED FIXED - Firefox no longer opens after clicking Restart Firefox inside Mozilla Crash Reporter")

[Regressed by:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#regressed_by)

---

[URL:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#bug_file_loc)

[See Also:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#see_also)

[1868737](/show_bug.cgi?id=1868737 "RESOLVED FIXED - backdrop-filter css property is disabled in RDP session")

## Details

### (Keywords: csectype-sandbox-escape, reporter-external, sec-high, Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.9+])

[Alias:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#alias)

CVE-2024-2605

[Keywords:](/describekeywords.cgi)

[csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

[Whiteboard:](https://wiki.mozilla.org/BMO/UserGuide/Whiteboard)

[reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.9+]

QA Whiteboard:

[post-critsmash-triage]

Has STR:

---

Change Request:

---

[Votes:](https://wiki.mozilla.org/BMO/UserGuide/BugFields#votes)

0

Bug Flags:

| [dveditz](/user_profile?user_id=1689) | [sec-bounty](#a5351346_1689 "1 year ago") | + |
| --- | --- | --- |
| [dveditz](/user_profile?user_id=1689) | sec-bounty | + |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | [qe-verify](#a4612168_488993 "11 months ago") | - |
| --- | --- | --- |
| [avaida](/user_profile?user_id=488993) | qe-verify | - |
| --- | --- | --- |
|  | behind-pref |  |
| --- | --- | --- |
|  | firefox-backlog |  |
|  | sec-bounty-hof |  |
|  | in-qa-testsuite |  | | |
|  | in-testsuite |  |

## Crash Data

Signature:

*None*

## Security

### (public)

This bug is publicly visible.

## User Story

## Attachments

### (14 files, 3 obsolete files)

| [vn0027.patch](/attachment.cgi?id=9370940)  [1 year ago](#c0)  [Miloš](/user_profile?user_id=740986)   2.30 KB, text/plain |  | [Details](/attachment.cgi?id=9370940&action=edit) |
| --- | --- | --- |
| [vn0027.html](/attachment.cgi?id=9370941)  [1 year ago](#c1)  [Miloš](/user_profile?user_id=740986)   356 bytes, text/html |  | [Details](/attachment.cgi?id=9370941&action=edit) |
| [Bug 1872920 - Change the way we identify processes in WER r=yjuglaret](/attachment.cgi?id=9373246)  [1 year ago](#c15)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9373246&action=edit) | [Review](/attachment.cgi?id=9373246) |
| [Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret](/attachment.cgi?id=9376000)  [1 year ago](#c19)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#c45 "11 months ago")  tjr : [sec-approval+](#c38 "11 months ago") | [Details](/attachment.cgi?id=9376000&action=edit) | [Review](/attachment.cgi?id=9376000) |
| [Bug 1872920 - Change the way we identify the parent process r=yjuglaret](/attachment.cgi?id=9376001)  [1 year ago](#c20)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#a4399728_690067 "11 months ago")  tjr : [sec-approval+](#a4139300_578488 "11 months ago") | [Details](/attachment.cgi?id=9376001&action=edit) | [Review](/attachment.cgi?id=9376001) |
| [Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret](/attachment.cgi?id=9376917)  [1 year ago](#c21)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#a4399731_690067 "11 months ago")  tjr : [sec-approval+](#a4139333_578488 "11 months ago") | [Details](/attachment.cgi?id=9376917&action=edit) | [Review](/attachment.cgi?id=9376917) |
| [Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret](/attachment.cgi?id=9379716)  [11 months ago](#c32)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#a4399737_690067 "11 months ago")  tjr : [sec-approval+](#a4139336_578488 "11 months ago") | [Details](/attachment.cgi?id=9379716&action=edit) | [Review](/attachment.cgi?id=9379716) |
| [Bug 1872920 - Introduce the process\_reader crate r=yjuglaret](/attachment.cgi?id=9379717)  [11 months ago](#c33)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | diannaS : [approval-mozilla-beta+](#a4399740_690067 "11 months ago")  tjr : [sec-approval+](#a4139339_578488 "11 months ago") | [Details](/attachment.cgi?id=9379717&action=edit) | [Review](/attachment.cgi?id=9379717) |
| [WIP: Bug 1872920 - Make mozwer use the process reader crate](/attachment.cgi?id=9379718)  [11 months ago](#c34)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379718&action=edit) | [Review](/attachment.cgi?id=9379718) |
| [WIP: Bug 1872920 - Change how we write WER data](/attachment.cgi?id=9379719)  [11 months ago](#c35)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request |  | [Details](/attachment.cgi?id=9379719&action=edit) | [Review](/attachment.cgi?id=9379719) |
| [Bug 1872920 - Make the crash reporter client locate the executable by itself](/attachment.cgi?id=9388000)  [11 months ago](#c49)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4833891_600971 "11 months ago") | [Details](/attachment.cgi?id=9388000&action=edit) | [Review](/attachment.cgi?id=9388000) |
| [Bug 1872920 - Change the way we identify the parent process](/attachment.cgi?id=9388001)  [11 months ago](#c50)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4833840_600971 "11 months ago") | [Details](/attachment.cgi?id=9388001&action=edit) | [Review](/attachment.cgi?id=9388001) |
| [Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes](/attachment.cgi?id=9388002)  [11 months ago](#c51)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4833835_600971 "11 months ago") | [Details](/attachment.cgi?id=9388002&action=edit) | [Review](/attachment.cgi?id=9388002) |
| [Bug 1872920 - Introduce the process\_reader crate](/attachment.cgi?id=9388003)  [11 months ago](#c52)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4833677_600971 "11 months ago") | [Details](/attachment.cgi?id=9388003&action=edit) | [Review](/attachment.cgi?id=9388003) |
| [Bug 1872920 - Change how we notify the main process when we intercept a crash via WER](/attachment.cgi?id=9388004)  [11 months ago](#c53)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4833583_600971 "11 months ago") | [Details](/attachment.cgi?id=9388004&action=edit) | [Review](/attachment.cgi?id=9388004) |
| [Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0](/attachment.cgi?id=9388229)  [11 months ago](#c56)  [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)   48 bytes, text/x-phabricator-request | phab-bot : [approval-mozilla-esr115+](#a4841879_600971 "11 months ago") | [Details](/attachment.cgi?id=9388229&action=edit) | [Review](/attachment.cgi?id=9388229) |
| [advisory.txt](/attachment.cgi?id=9391504)  [10 months ago](#c60)  [Tyson Smith [:tsmith]](/user_profile?user_id=486634)   282 bytes, text/plain |  | [Details](/attachment.cgi?id=9391504&action=edit) |

Show Obsolete

Bottom ↓
Tags ▾

* Reset

Timeline ▾

* Reset
* Collapse All
* Expand All
* Comments Only

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Description](/show_bug.cgi?id=1872920#c0)• 1 year ago |
|  | |

Attached file
[vn0027.patch](attachment.cgi?id=9370940)
— [Details](attachment.cgi?id=9370940&action=edit)

# Sandbox escape via process type confusion in mozwer

TL;DR: A compromised content process on Windows 10 & Windows 11 can pretend to be a browser process, which will lead the `mozwer` module to spawn a `crashreporter.exe` process that inherits environment variables from the content process. By controlling these environment variables, the content process can execute arbitrary code from within the crash reporter and escape the sandbox.

## Details

When one of the firefox processes throws an exception that must be handled out-of-process, a WER (Windows Error Reporting) process is spawned, which loads `mozwer.dll` and executes [OutOfProcessExceptionEventCallback](https://searchfox.org/mozilla-central/source/toolkit/crashreporter/mozwer-rust/lib.rs#80). At the end of this function, there's an attempt to determine whether the exception-throwing process is a browser process or a content process:

```
let wer_data = read_from_process::<InProcessWindowsErrorReportingData>(
    process,
    context as *mut InProcessWindowsErrorReportingData,
)?;

...

if wer_data.process_type == MAIN_PROCESS_TYPE {
    handle_main_process_crash(crash_report, process, &application_info)
} else {
    handle_child_process_crash(crash_report, process)
}

```

Where the `context` variable contains the address of the [gInProcessWerData](https://searchfox.org/mozilla-central/source/mozglue/misc/RuntimeExceptionModule.cpp#43) structure residing in the memory of the crashing process:

```
void RegisterRuntimeExceptionModule() {
...
gInProcessWerData.mProcessType = mozilla::GetGeckoProcessType();
gInProcessWerData.mOOMAllocationSizePtr = &gOOMAllocationSize;
if (FAILED(::WerRegisterRuntimeExceptionModule(sModulePath,
                                                 &gInProcessWerData))) {
    // The registration failed null out sModulePath to record this.
    *sModulePath = L'\0';
    return;
}
...
}

```

Since `wer_data` is read from the memory of the crashing process, a content process can pose as a browser process by simply modifying `gInProcessWerData.mProcessType` within its own memory. Once that happens, `handle_main_process_crash` will be executed instead of `handle_child_process_crash`. This execution path launches the crash reporter:

```
...
let mut environment = read_environment_block(process)?;
launch_crash_reporter_client(
    &application_information.install_path,
    &mut environment,
    &crash_report,
);
...

```
```
fn launch_crash_reporter_client(
    install_path: &Path,
    environment: &mut Vec<u16>,
    crash_report: &CrashReport,
) {
...
unsafe {
    if CreateProcessW(
        null_mut(),
        cmd_line.as_mut_ptr(),
        null_mut(),
        null_mut(),
        FALSE,
        NORMAL_PRIORITY_CLASS | CREATE_NO_WINDOW | CREATE_UNICODE_ENVIRONMENT,
        environment.as_mut_ptr() as *mut _,
        null_mut(),
        &mut si,
        &mut pi,
    ) != 0
    {
        CloseHandle(pi.hProcess);
        CloseHandle(pi.hThread);
    }
}
}

```

When launching the crash reporter, the environment variables are inherited from the crashing process. As such, a content process can set its own environment variables and have them also be set in the launched crash reporter process. By controlling the environment variables inside the crash reporter process, there are multiple paths that a content process could use to achieve arbitrary code exec from the crash reporter (thus, outside the sandbox):

* By abusing the `MOZ_CRASHREPORTER_RESTART_ARG_*` environment variables. These environment variables are used to determine the command line that should be executed in order to restart firefox. For example, by setting `MOZ_CRASHREPORTER_RESTART_ARG_0=path//to//some//executable`, `MOZ_CRASHREPORTER_RESTART_ARG_1=some_arg_1` etc., the crash reporter can be made to execute an arbitrary file present on the system with arbitrary command line arguments. However, user interaction is required, as this code path is only triggered once "Restart" is pressed by the user. Note that the attacker can confuse/convince the user to press the "Restart" button by abusing the `MOZ_CRASHREPORTER_STRINGS_OVERRIDE` environment variable, which allows the attacker to control the text (and thus the layout) of the crash reporter window.
* By abusing the `MOZ_REPLACE_MALLOC_LIB` environment variable. Setting `MOZ_REPLACE_MALLOC_LIB=path//to//some//library` will make the crash reporter process load the specified library on boot. This could be used in conjunction with other vulnerabilities (e.g. allowing the attacker to plant a malicious library file somewhere on the system), but it could also be used stand-alone (e.g. specifying a UNC share path on an SMB-enabled machine, or using a vulnerable library to trigger a vulnerability and continue from there). No interaction is required here.
* By abusing the `SystemRoot` environment variable. This is similar to the case above, in that `SystemRoot` can be hijacked to side-load DLLs whose full path is resolved using this variable. Certain dependencies of the crash reporter load their DLLs by using this environment variable (e.g. `%SystemRoot%\system32\rpcrt4.dll`), making it possible to abuse this behaviour.

## Fix

To fix the issue, you need to ensure that `mozwer` doesn't trust the content process to be truthful about its process type, i.e. this information should come from somewhere unreachable to the content process. I'm not familiar with all the intrinsics of the underlying implementation, but querying the process' command line parameters (as is already being done in the child process crash code path) to determine its type would be a more suitable check, as the process cannot directly affect this.

## Proof of Concept & Repro Steps

We assume that a content process has been fully compromised and can execute arbitrary code. The proof of concept consist of:

* The "payload" function that's executed from the content process and performs the steps necessary to trigger the sandbox escape:
  + Set `gInProcessWerData.mProcessType` to `GeckoProcessType_Default` to pose as a browser process to `mozwer`.
  + Setup the appropriate environment variables for code execution. Depending on the choice of option, one of the aforementioned methods is used. The first method is chosen by default, with `calc.exe` being the command line to execute.
  + Trigger a crash that needs to be handled OOP by WER. For example, we use a classic stack-based buffer overflow, which will be detected by the stack protector and throw out a stack corruption exception.
* A hook inside of the `console.time()` method implementation that's used to trigger the payload function via a crafted HTML file. This part is irrelevant to the vulnerability and the exploit and is used solely for demonstration purposes.

To reproduce the issue:

* Apply the attached `vn0027.patch` as a git patch in the root directory of firefox source.
  + `git apply /path/to/vn0027.patch`
* Build firefox.
* Ensure that local `mozwer.dll` has been registered as a WER exception handler module:
  + `HKLM\SOFTWARE\Microsoft\Windows\Windows Error Reporting\RuntimeExceptionHelperModules` contains a `path/to/mozwer.dll` DWORD entry with value 0.
* Ensure that crash reporter files/folders have been properly setup in `%APPDATA%\Roaming\Mozilla\Firefox\Crash Reports`:
  + There is an InstallTime file corresponding to the firefox build number/timestamp that was built earlier.
  + The `pending` folder exists.
* Grab the attached `vn0027.html`. Start a local http server in the directory where `vn0027.html` resides:
  + `python3 -m http.server`
* Open previously-built firefox and navigate to `localhost:8000/vn0027.html`.
* Observe that firefox shows that the tab crashed.
* Observe that `crashreporter.exe` is executed and the crash reporter window is shown. Observe that the process inherited environment variables from the content process corresponding to the html file that was opened earlier. (You can observe this via e.g. process explorer)
* Observe that pressing "Restart" spawns `calc.exe` (in case the first method is used for code exec), or a specified library has been loaded into `crashreporter.exe` (if using the second or third method for code exec).

**NOTE**: I couldn't get `mozwer` to work on Windows 10 Pro 22H2 (19045.3803), though it could be a local issue. During DLL loading, the process attempts to load `user32.dll` as one of the dependencies of `mozwer.dll` and this throws out a 0xC0000135 error. Everything works as expected on a clean latest Windows 11 insider build, so I recommend using that to test, should you run into any issues on your regular setup.

## IMPORTANT

It is very important to mention that the impact of the vulnerability extends beyond firefox. Since `mozwer.dll` is registered as a WER exception handler module in the registry, any (non-firefox) sandboxed process on the system can use it via `WerRegisterRuntimeExceptionModule("path/to/mozwer.dll", ...)` and escape its sandbox using this vulnerability. This virtually means that having firefox installed on the system makes it possible to escape from any sandboxed process running on the system.

Let me know if any further information is required. I won't be dedicating more time to this issue, unless requested.

Flags: sec-bounty?

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Comment 1](/show_bug.cgi?id=1872920#c1)• 1 year ago |
|  | |

Attached file
[vn0027.html](attachment.cgi?id=9370941)
— [Details](attachment.cgi?id=9370941&action=edit)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3859_1689)• 1 year ago |

[Attachment #9370940](/attachment.cgi?id=9370940&action=edit "vn0027.patch") -
Attachment mime type: text/x-patch → text/plain

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 2](/show_bug.cgi?id=1872920#c2)• 1 year ago |
|  | |

Haven't validated this, but sec-high if true. Bob, can you take a look?

Component: Security → Crash ReportingFlags: needinfo?(bobowencode)Keywords: [csectype-sandbox-escape](/buglist.cgi?keywords=csectype-sandbox-escape&resolution=---),
[sec-high](/buglist.cgi?keywords=sec-high&resolution=---)Product: Firefox → Toolkit

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 3](/show_bug.cgi?id=1872920#c3)• 1 year ago |
|  | |

incidentally, "about:crashcontentprocess" will trigger a contentprocess crash in case that's useful in the future, as a separate step from your patch that sets up the exploit conditions.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Comment 4](/show_bug.cgi?id=1872920#c4)• 1 year ago |
|  | |

(In reply to Daniel Veditz [:dveditz] Back Jan 8 2024 from [comment #2](/show_bug.cgi?id=1872920#c2 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> Haven't validated this, but sec-high if true. Bob, can you take a look?

I'm having trouble validating this as I can't get the WER module to work at all.

I'll keep trying (including the Windows 11 insider build), but this might need to wait for gsvelto.

The attack looks plausible from inspection though.

Flags: needinfo?(bobowencode) → needinfo?(gsvelto)

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Comment 5](/show_bug.cgi?id=1872920#c5)• 1 year ago |
|  | |

(In reply to Bob Owen (:bobowen) from [comment #4](/show_bug.cgi?id=1872920#c4 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> (In reply to Daniel Veditz [:dveditz] Back Jan 8 2024 from [comment #2](/show_bug.cgi?id=1872920#c2 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))
>
> > Haven't validated this, but sec-high if true. Bob, can you take a look?
>
> I'm having trouble validating this as I can't get the WER module to work at all.
>
> I'll keep trying (including the Windows 11 insider build), but this might need to wait for gsvelto.
>
> The attack looks plausible from inspection though.

I recommend double-checking if you properly setup the registry and the AppData folder (steps #3 and #4 in the report), these were the main obstacles I had to overcome to get my local module to work. Of course, this is all setup automatically on production builds during installation. Keep in mind that the name of the InstallTime{BUILD\_NUMBER} file [needs to be updated after every local build in order to reflect the build id (timestamp?) corresponding to the value in the executable](https://searchfox.org/mozilla-central/source/toolkit/crashreporter/mozwer-rust/lib.rs#633). This was particularly problematic for me as I had to trace file accesses from Process Monitor to figure out what the value of the build number actually is.

If the issue persists even though everything is setup properly, it does seem plausible that you could be running into the same issue that I've encountered on my local W10.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Comment 6](/show_bug.cgi?id=1872920#c6)• 1 year ago |
|  | |

(In reply to ynwarcs from [comment #5](/show_bug.cgi?id=1872920#c5 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

...

> I recommend double-checking if you properly setup the registry and the AppData folder (steps #3 and #4 in the report), these were the main obstacles I had to overcome to get my local module to work. Of course, this is all setup automatically on production builds during installation. Keep in mind that the name of the InstallTime{BUILD\_NUMBER} file [needs to be updated after every local build in order to reflect the build id (timestamp?) corresponding to the value in the executable](https://searchfox.org/mozilla-central/source/toolkit/crashreporter/mozwer-rust/lib.rs#633). This was particularly problematic for me as I had to trace file accesses from Process Monitor to figure out what the value of the build number actually is.

Thanks, it is working when I fast fail the parent process (on a VM), so the general set up must be OK, but it's not working on the content process.

I don't even see it attempt to read the InstallTime file for the content crash.

I'll try the insider build.

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Comment 7](/show_bug.cgi?id=1872920#c7)• 1 year ago |
|  | |

WER reporting for content is still failing for me on an insider build (22635.2921).

It appears (from Yannis) that at least one of the things that is blocking this is that win32k lockdown is causing a failure in the WerFault process as it loads dependencies of mozwer.dll.

Presumably WerFault is picking up the win32k lockdown from the content process in some way.

I can get the PoC to work, but only if I disable win32k lockdown on the content process.

ynwarcs - is it possible that win32k lockdown is disabled on your insider build setup for some reason?

You can see this in the "Sandbox" section of `about:support`.

All but one of the WER reported content crashes that I've spot checked from the last two weeks, have win32k lockdown disabled for various reasons. They are all from older versions, with a handful from esr115.

The one with it apparently enabled has what appear to be some sort of security modules loaded from "Beijing Qihu Technology Co., Ltd.", which may be interfering with things.

All that being said we should not be relying on data read from the crashed process to make these decisions, so we need to fix that.

Other child processes that do not have win32k lockdown could be used, although I believe the content process would be the main worry.

I'm not sure the escape immediately allows arbitrary code execution outside the sandbox, but it would allow any existing application to be called with arbitrary command line parameters from the fake restart, so this could be part of a chain of attacks.

As I understand it, the other env vars mentioned would probably need other vulnerable files to be accessible from the machine already.

There are other env vars that could be problematic as well.

We think that using the command line for the process type could also be abused.

Perhaps we could look at the integrity and access token of the process.

We could write the PID of the main process to a file, but we might not want to do that really early in start-up. However we could just not allow restart if the crash was too early.

Flags: needinfo?(ynwarcs)

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Comment 8](/show_bug.cgi?id=1872920#c8)• 1 year ago |
|  | |

(In reply to Bob Owen (:bobowen) from [comment #7](/show_bug.cgi?id=1872920#c7 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> ynwarcs - is it possible that win32k lockdown is disabled on your insider build setup for some reason?
>
> You can see this in the "Sandbox" section of `about:support`.

You're correct that win32k lockdown is disabled on my insider build:

* `Win32k Lockdown State for Content Process = Win32k Lockdown disabled -- Missing Remote WebGL`

In hindsight, I should've checked this before reporting rather than assuming that this is evidence that the failure on the W10 build was a local issue. Apologies for raising a (semi) false alarm with the vulnerability, then.

> All but one of the WER reported content crashes that I've spot checked from the last two weeks, have win32k lockdown disabled for various reasons. They are all from older versions, with a handful from esr115.
>
> The one with it apparently enabled has what appear to be some sort of security modules loaded from "Beijing Qihu Technology Co., Ltd.", which may be interfering with things.

I assumed that mozwer was intended to work with all firefox processes, mainly because I don't see another way of handling OOP-processed exceptions. Is this correct? Does this mean that you're missing crash reports from locked-down processes that would otherwise be handled by WER?

Either way, thanks for getting to the bottom of the issue. From my point of view, the fact that win32k lockdown prevents the bug from being reached significantly downgrades the severity of the bug. Though it should definitely be fixed before/if mozwer is enabled for locked-down processes.

> We think that using the command line for the process type could also be abused.

Then you should most likely also change the child-process-crash code path to stop relying on the command line of the content process to execute code in the parent process. If you backtrace the [`wer_notify_proc` parameter in this `CreateRemoteThread` call](https://searchfox.org/mozilla-central/source/toolkit/crashreporter/mozwer-rust/lib.rs#321), you'll notice that it's read from the command line of the content process and used as the address of the function to be executed in the parent process.

Flags: needinfo?(ynwarcs)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a166649_406194)• 1 year ago |

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Bob Owen (:bobowen)](/user_profile?user_id=458623) |  |
| --- | --- | --- |
| [Comment 9](/show_bug.cgi?id=1872920#c9)• 1 year ago |
|  | |

(In reply to ynwarcs from [comment #8](/show_bug.cgi?id=1872920#c8 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> (In reply to Bob Owen (:bobowen) from [comment #7](/show_bug.cgi?id=1872920#c7 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))
>
> > ynwarcs - is it possible that win32k lockdown is disabled on your insider build setup for some reason?
> >
> > You can see this in the "Sandbox" section of `about:support`.
>
> You're correct that win32k lockdown is disabled on my insider build:
>
> * `Win32k Lockdown State for Content Process = Win32k Lockdown disabled -- Missing Remote WebGL`
>
> In hindsight, I should've checked this before reporting rather than assuming that this is evidence that the failure on the W10 build was a local issue. Apologies for raising a (semi) false alarm with the vulnerability, then.

No apology required, this is still definitely a problem that we need to fix, but win32k lockdown on the content process is a fortunate mitigating factor.

> > All but one of the WER reported content crashes that I've spot checked from the last two weeks, have win32k lockdown disabled for various reasons. They are all from older versions, with a handful from esr115.
> >
> > The one with it apparently enabled has what appear to be some sort of security modules loaded from "Beijing Qihu Technology Co., Ltd.", which may be interfering with things.
>
> I assumed that mozwer was intended to work with all firefox processes, mainly because I don't see another way of handling OOP-processed exceptions. Is this correct? Does this mean that you're missing crash reports from locked-down processes that would otherwise be handled by WER?
>
> Either way, thanks for getting to the bottom of the issue. From my point of view, the fact that win32k lockdown prevents the bug from being reached significantly downgrades the severity of the bug. Though it should definitely be fixed before/if mozwer is enabled for locked-down processes.

Yes, it does mean we're missing them and it's been good to discover a cause for this.

As you say, win32k lockdown is certainly significant as without that other sandbox escapes are probably available.

> > We think that using the command line for the process type could also be abused.
>
> Then you should most likely also change the child-process-crash code path to stop relying on the command line of the content process to execute code in the parent process. If you backtrace the [`wer_notify_proc` parameter in this `CreateRemoteThread` call](https://searchfox.org/mozilla-central/source/toolkit/crashreporter/mozwer-rust/lib.rs#321), you'll notice that it's read from the command line of the content process and used as the address of the function to be executed in the parent process.

Thanks, yes we'll look at that as well.

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 10](/show_bug.cgi?id=1872920#c10)• 1 year ago |
|  | |

> Win32k Lockdown State for Content Process = Win32k Lockdown disabled -- Missing Remote WebGL

I've seen this before when e.g. running x86\_64 Firefox on ARM under emulation, or other VM setups where the 3D drivers are too primitive. I guess reporter was analyzing the exploit in a VM.

If the attacker has no way to force us to end up in this fallback (e.g. by crashing the GPU driver), it's not too bad - and I do think we analyzed this at some point. But it'd be nice to not require this fallback path in a VM :-/

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 11](/show_bug.cgi?id=1872920#c11)• 1 year ago |
|  | |

I've been looking at how to address this and there's two things that I believe must be done:

* Make mozwer use the new mozannotation crates to pull out the annotations. The mozannotation crates do not rely on external data to find the annotations, they look for them using the PE headers, and if something is messed up they just skip them (that is, it never trusts the data extracted from the crashed process). This removes the need for passing an address to mozwer to look things for that we'd need to trust.
* Make mozwer decide whether a process is the parent process only by examining it, possibly by using `NtQueryInformationProcess()`. The PPID for a process should come directly from the kernel and by examining it we should be able to tell if we're a child process or not. This would make sure that child processes can't abuse mozwer to run the crash reporter client.
Flags: needinfo?(gsvelto)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 12](/show_bug.cgi?id=1872920#c12)• 1 year ago |
|  | |

I'll mark this sec-other because it sounds like it is blocked by the win32k lockdown but maybe that's not right.

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 13](/show_bug.cgi?id=1872920#c13)• 1 year ago |
|  | |

Yes, we confirmed that win32k lockdown prevents the exploit from working, but the issue is real and I'm working on it.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 14](/show_bug.cgi?id=1872920#c14)• 1 year ago |
|  | |

I'm filing bugs to fix the various issues highlighted here, including the core problem of mistaking a child process for a main one. Since several changes are required I'm splitting them out in different bugs which I'll link here.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 15](/show_bug.cgi?id=1872920#c15)• 1 year ago |
|  | |

Attached file
[Bug 1872920 - Change the way we identify processes in WER r=yjuglaret](attachment.cgi?id=9373246) (obsolete)
— [Details](attachment.cgi?id=9373246&action=edit)

Depends on D198699

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a1185991_600971)• 1 year ago |

Assignee: nobody → gsveltoStatus: UNCONFIRMED → ASSIGNEDEver confirmed: true

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 16](/show_bug.cgi?id=1872920#c16)• 1 year ago |
|  | |

> it is blocked by the win32k lockdown but maybe that's not right

For most users, this is true. But there are reasonable use cases (using Firefox in a VM) where that won't be true.

|  | [Bob Hood [:bhood]](/user_profile?user_id=697075) |  |
| --- | --- | --- |
| [Comment 17](/show_bug.cgi?id=1872920#c17)• 1 year ago |
|  | |

E.g., [bug 1843782](/show_bug.cgi?id=1843782 "VERIFIED FIXED - Firefox WebGL DrawElementsInstanced Heap-Buffer-Overflow Possibly leading to Sandbox Escape Vulnerability (Mesa VM driver / Linux)")

|  | [Ashley Hale [:ahale]](/user_profile?user_id=706885) |  |
| --- | --- | --- |
| [Comment 18](/show_bug.cgi?id=1872920#c18)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1872920&comment_id=16763618 "1 revision") |
|  | |

I don't think [bug 1847382](/show_bug.cgi?id=1847382 "RESOLVED INVALID - Main window control items greyed out (Dark Mode)") has much relation to this bug, as that requires a very different strategy to exploit (merely crashing the browser is easy with that one, but code execution in the VM guest is unproven and may be difficult, and then proceeding to execute code on the VM host is unproven and may also be difficult, as Microsoft has taken significant measures towards securing Windows graphics drivers - I don't doubt there are bugs, but they may be difficult to exploit).

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a1689249_600971)• 1 year ago |

[Attachment #9373246](/attachment.cgi?id=9373246&action=edit "Bug 1872920 - Change the way we identify processes in WER r=yjuglaret") -
Attachment is obsolete: true

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 19](/show_bug.cgi?id=1872920#c19)• 1 year ago |
|  | |

Attached file
[Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret](attachment.cgi?id=9376000)
— [Details](attachment.cgi?id=9376000&action=edit)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 20](/show_bug.cgi?id=1872920#c20)• 1 year ago |
|  | |

Attached file
[Bug 1872920 - Change the way we identify the parent process r=yjuglaret](attachment.cgi?id=9376001)
— [Details](attachment.cgi?id=9376001&action=edit)

Depends on D199352

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a2206251_600971)• 1 year ago |

[Attachment #9376001](/attachment.cgi?id=9376001&action=edit "Bug 1872920 - Change the way we identify the parent process r=yjuglaret") -
Attachment description: Bug 1872920 - Strip unneeded environment variables before restarting Firefox r=yjuglaret → Bug 1872920 - Change the way we identify the parent process r=yjuglaret

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 21](/show_bug.cgi?id=1872920#c21)• 1 year ago |
|  | |

Attached file
[Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret](attachment.cgi?id=9376917)
— [Details](attachment.cgi?id=9376917&action=edit)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a2342611_406194)• 1 year ago |

Keywords: [sec-other](/buglist.cgi?keywords=sec-other&resolution=---)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 22](/show_bug.cgi?id=1872920#c22)• 1 year ago |
|  | |

I'm clearing the flag, because it is a valid security issue, just not in the standard supported configuration.

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 23](/show_bug.cgi?id=1872920#c23)• 1 year ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1872920&comment_id=16775856 "2 revisions") |
|  | |

> just not in the standard supported configuration

I don't think we say that Firefox is "not fully supported" on VM anywhere. If we disclaim that it is, we should open a documentation bug.

Note that some competitions like pwn2own also use VM (though we did not reproduce this bug on the setup they use).

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a2367767_151147)• 1 year ago |

Flags: needinfo?(continuation)

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 24](/show_bug.cgi?id=1872920#c24)• 1 year ago |
|  | |

Reporter, can you clarify in what environment you originally reproduced this?

Flags: needinfo?(ynwarcs)

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Comment 25](/show_bug.cgi?id=1872920#c25)• 1 year ago |
|  | |

Sure, it was a Windows 11 Insider 26020 Build running in a Hyper-V VM with Enhanced Session enabled. I couldn't reproduce it outside of the VM environment.

Flags: needinfo?(ynwarcs)

|  | [Andrew McCreight [:mccr8]](/user_profile?user_id=406194) |  |
| --- | --- | --- |
| [Comment 26](/show_bug.cgi?id=1872920#c26)• 1 year ago |
|  | |

(In reply to Gian-Carlo Pascutto [:gcp] from [comment #23](/show_bug.cgi?id=1872920#c23 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> I don't think we say that Firefox is "not fully supported" on VM anywhere. If we disclaim that it is, we should open a documentation bug.
>
> Note that some competitions like pwn2own also use VM (though we did not reproduce this bug on the setup they use).

Ok. I don't really know what the status of supportedness is. If we are trying to support that, then that further suggests it shouldn't be sec-other like I had marked it.

Flags: needinfo?(continuation)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Comment 27](/show_bug.cgi?id=1872920#c27)• 11 months ago |
|  | |

I'm calling it sec-high again, because it does represent a sandbox escape. The fact that the win32k lockdown protects most people is a mitigation, but it doesn't protect all people nor all Firefox sandboxed processes. It's also not great that our handler exposes other applications to this risk.

Keywords: [sec-high](/buglist.cgi?keywords=sec-high&resolution=---)

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a2496978_151147)• 11 months ago |

See Also: → [1868737](/show_bug.cgi?id=1868737 "RESOLVED FIXED - backdrop-filter css property is disabled in RDP session")

|  | [Gian-Carlo Pascutto [:gcp]](/user_profile?user_id=151147) |  |
| --- | --- | --- |
| [Comment 28](/show_bug.cgi?id=1872920#c28)• 11 months ago |
|  | |

[Bug 1868737](/show_bug.cgi?id=1868737 "RESOLVED FIXED - backdrop-filter css property is disabled in RDP session") (fixed in Firefox 123) made sure some GFX features keep working even if we can't identify the environment we're running under. VMWare supplies a GFX driver version, so it was not affected, but Parallels and Hyper-V apparently do not. Before the patch in [bug 1868737](/show_bug.cgi?id=1868737 "RESOLVED FIXED - backdrop-filter css property is disabled in RDP session"), this would cause us to disable almost all GFX features in those VM, including some that are required for win32k lockdown.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3432604_448747)• 11 months ago |

Severity: -- → S1
[tracking-firefox123](/buglist.cgi?f1=cf_tracking_firefox123&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%3F)
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [?](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%3F)Priority: -- → P1

|  | [Bob Hood [:bhood]](/user_profile?user_id=697075) |  |
| --- | --- | --- |
| [Comment 29](/show_bug.cgi?id=1872920#c29)• 11 months ago |
|  | |

Gabriele, is the patch in [comment 21](/show_bug.cgi?id=1872920#c21 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") a viable solution for issue, or is it just a temporary mitigation? Now that you've flagged it as an S1, I'm curious if it will make it into Fx123.

Flags: needinfo?(gsvelto)

|  | [Pascal Chevrel:pascalc](/user_profile?user_id=24572) |  |
| --- | --- | --- |
| [Comment 30](/show_bug.cgi?id=1872920#c30)• 11 months ago |
|  | |

Gabriele, you set it as P1/S1, do we have reasons to believe that we should block the 123 release on the resolution of this sec bug? (Release Candidate builds today) Thanks

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 31](/show_bug.cgi?id=1872920#c31)• 11 months ago |
|  | |

Sorry for the noise, I intended this to be P1/S2, not P1/S1. The patch in [comment 21](/show_bug.cgi?id=1872920#c21 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") is enough to fix the issue here but I'm trying to tighten up the interface between the child processes and the main process further, to avoid any potential future exploits on that end.

Severity: S1 → S2
[tracking-firefox123](/buglist.cgi?f1=cf_tracking_firefox123&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox123&o1=equals&v1=%3F) → ---
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
[?](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%3F) → ---Flags: needinfo?(gsvelto)Priority: P1 → --

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 32](/show_bug.cgi?id=1872920#c32)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret](attachment.cgi?id=9379716)
— [Details](attachment.cgi?id=9379716&action=edit)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 33](/show_bug.cgi?id=1872920#c33)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Introduce the process\_reader crate r=yjuglaret](attachment.cgi?id=9379717)
— [Details](attachment.cgi?id=9379717&action=edit)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 34](/show_bug.cgi?id=1872920#c34)• 11 months ago |
|  | |

Attached file
[WIP: Bug 1872920 - Make mozwer use the process reader crate](attachment.cgi?id=9379718) (obsolete)
— [Details](attachment.cgi?id=9379718&action=edit)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 35](/show_bug.cgi?id=1872920#c35)• 11 months ago |
|  | |

Attached file
[WIP: Bug 1872920 - Change how we write WER data](attachment.cgi?id=9379719) (obsolete)
— [Details](attachment.cgi?id=9379719&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3506875_600971)• 11 months ago |

[Attachment #9379719](/attachment.cgi?id=9379719&action=edit "WIP: Bug 1872920 - Change how we write WER data") -
Attachment is obsolete: true

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3506886_600971)• 11 months ago |

[Attachment #9379718](/attachment.cgi?id=9379718&action=edit "WIP: Bug 1872920 - Make mozwer use the process reader crate") -
Attachment is obsolete: true

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3507344_600971)• 11 months ago |

[Attachment #9379717](/attachment.cgi?id=9379717&action=edit "Bug 1872920 - Introduce the process_reader crate r=yjuglaret") -
Attachment description: WIP: Bug 1872920 - Introduce the process\_reader crate → Bug 1872920 - Introduce the process\_reader crate r=yjuglaret

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3507391_600971)• 11 months ago |

[Attachment #9379716](/attachment.cgi?id=9379716&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret") -
Attachment description: WIP: Bug 1872920 - Put WerNotifyProc() in its own section → Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 36](/show_bug.cgi?id=1872920#c36)• 11 months ago |
|  | |

Try runs are green, local testing works fine and all patches are reviewed. I'm landing this today. Sorry it took a bit but we went for a multi-layer fix that tries to address all the potential issues, this entails:

1. The crash reporter client cannot launch arbitrary applications anymore, it can only launch the Firefox executable it came with
2. When the crash reporter is launched from the WER runtime exception module it will refuse to restart Firefox (or any other application) offering the user only to send the report and quit. We consider this an acceptable functional regression until we implement fully out-of-process crash generation
3. The runtime exception module does not read or rely on memory from the crashed process save for identifying child processes, all necessary information is retrieved from sources that cannot have been affected by the crashed process (such as the NT kernel and the application installation)
4. When identifying a child process the runtime exception module checks for its sandboxing status. This means that in a default configuration a child process "masquerading" as the parent process would not be identified as such and still treated as a child process
5. Because of 1 and 2 even if a child process in a non-standard configuration successfully masquerades as the parent process it won't be able to do anything besides launching the crash reporter client: it cannot affect it nor force it to launch another application anymore
6. Last but not least, when dealing with child process crashes the mechanism used to communicate with the parent process does not require any knowledge of the parent process layout. Communication is unidirectional and the address we jump into the parent process is now effectively hard-coded

Note that in the case of a default configuration with Win32k lockdown enabled the child process path still won't work as per the comments here. I want all these fixes to be in place before we make the WER runtime exception module compatible with a Win32k locked down environment.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 37](/show_bug.cgi?id=1872920#c37)• 11 months ago |
|  | |

Comment on [attachment 9376000](/attachment.cgi?id=9376000 "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") [[details]](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Make the crash reporter client locate the executable by itself r=yjuglaret

### Security Approval Request

* **How easily could an exploit be constructed based on the patch?**: The patch set fixes one by one all the possible ways a compromised process could exploit the Windows Error Reporting runtime exception module, as such it does provide hints as what would need to be done to build an exploit.
* **Do comments in the patch, the check-in comment, or tests included in the patch paint a bulls-eye on the security problem?**: Unknown
* **Which branches (beta, release, and/or ESR) are affected by this flaw, and do the release status flags reflect this affected/unaffected state correctly?**: All branches are affected
* **If not all supported branches, which bug introduced the flaw?**: None
* **Do you have backports for the affected branches?**: Yes
* **If not, how different, hard to create, and risky will they be?**:
* **How likely is this patch to cause regressions; how much testing does it need?**: The largely affects things that happen after Firefox has crashed, as such it cannot really make things worse even in the case of regressions.
* **Is the patch ready to land after security approval is given?**: Yes
* **Is Android affected?**: No
[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: sec-approval?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3606459_448747)• 11 months ago |

[Attachment #9376001](/attachment.cgi?id=9376001&action=edit "Bug 1872920 - Change the way we identify the parent process r=yjuglaret") -
Flags: sec-approval?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a3606460_448747)• 11 months ago |

[Attachment #9376917](/attachment.cgi?id=9376917&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret") -
Flags: sec-approval?
[Attachment #9379716](/attachment.cgi?id=9379716&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret") -
Flags: sec-approval?
[Attachment #9379717](/attachment.cgi?id=9379717&action=edit "Bug 1872920 - Introduce the process_reader crate r=yjuglaret") -
Flags: sec-approval?

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 38](/show_bug.cgi?id=1872920#c38)• 11 months ago |
|  | |

Comment on [attachment 9376000](/attachment.cgi?id=9376000 "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") [[details]](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Make the crash reporter client locate the executable by itself r=yjuglaret

Approved to land and uplift if needed

[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4139300_578488)• 11 months ago |

[Attachment #9376001](/attachment.cgi?id=9376001&action=edit "Bug 1872920 - Change the way we identify the parent process r=yjuglaret") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4139333_578488)• 11 months ago |

[Attachment #9376917](/attachment.cgi?id=9376917&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4139336_578488)• 11 months ago |

[Attachment #9379716](/attachment.cgi?id=9379716&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret") -
Flags: sec-approval? → sec-approval+

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4139339_578488)• 11 months ago |

[Attachment #9379717](/attachment.cgi?id=9379717&action=edit "Bug 1872920 - Introduce the process_reader crate r=yjuglaret") -
Flags: sec-approval? → sec-approval+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 39](/show_bug.cgi?id=1872920#c39)• 11 months ago |
|  | |

Pushed by gsvelto@mozilla.com:
<https://hg.mozilla.org/integration/autoland/rev/694ae335f2b1>
Make the crash reporter client locate the executable by itself r=yjuglaret,bobowen
<https://hg.mozilla.org/integration/autoland/rev/cb217b8c1289>
Change the way we identify the parent process r=yjuglaret,bobowen
<https://hg.mozilla.org/integration/autoland/rev/cedd5c4eb7d5>
Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret,bobowen
<https://hg.mozilla.org/integration/autoland/rev/a0c1596012ab>
Introduce the process\_reader crate r=yjuglaret,bobowen
<https://hg.mozilla.org/integration/autoland/rev/0b4047d91582>
Change how we notify the main process when we intercept a crash via WER r=yjuglaret,bobowen

|  | [Ryan VanderMeulen [:RyanVM]](/user_profile?user_id=75935) |  |
| --- | --- | --- |
| [Comment 40](/show_bug.cgi?id=1872920#c40)• 11 months ago |
|  | |

<https://hg.mozilla.org/mozilla-central/rev/694ae335f2b1>

<https://hg.mozilla.org/mozilla-central/rev/cb217b8c1289>

<https://hg.mozilla.org/mozilla-central/rev/cedd5c4eb7d5>

<https://hg.mozilla.org/mozilla-central/rev/a0c1596012ab>

<https://hg.mozilla.org/mozilla-central/rev/0b4047d91582>

Group: firefox-core-security → core-security-releaseStatus: ASSIGNED → RESOLVEDClosed: 11 months ago
[status-firefox123](/buglist.cgi?f1=cf_status_firefox123&o1=isnotempty):
--- → [wontfix](/buglist.cgi?f1=cf_status_firefox123&o1=equals&v1=wontfix)
[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected)
[status-firefox125](/buglist.cgi?f1=cf_status_firefox125&o1=isnotempty):
--- → [fixed](/buglist.cgi?f1=cf_status_firefox125&o1=equals&v1=fixed)
[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
--- → [affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected)
[tracking-firefox124](/buglist.cgi?f1=cf_tracking_firefox124&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox124&o1=equals&v1=%2B)
[tracking-firefox125](/buglist.cgi?f1=cf_tracking_firefox125&o1=isnotempty):
--- → [+](/buglist.cgi?f1=cf_tracking_firefox125&o1=equals&v1=%2B)
[tracking-firefox-esr115](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=isnotempty):
--- → [124+](/buglist.cgi?f1=cf_tracking_firefox_esr115&o1=equals&v1=124%2B)Resolution: --- → FIXEDTarget Milestone: --- → 125 Branch

|  | [BugBot [:suhaib / :marco/ :calixte]](/user_profile?user_id=575867) |  |
| --- | --- | --- |
| [Comment 41](/show_bug.cgi?id=1872920#c41)• 11 months ago |
|  | |

The patch landed in nightly and beta is affected.

:gsvelto, is this bug important enough to require an uplift?

* If yes, please nominate the patch for beta approval.
* If no, please set `status-firefox124` to `wontfix`.

For more information, please visit [BugBot documentation](https://wiki.mozilla.org/BugBot#uplift_beta.py).

Flags: needinfo?(gsvelto)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 42](/show_bug.cgi?id=1872920#c42)• 11 months ago |
|  | |

The patch is working as expected, we get parent process crash reports as usual, we get GPU process crash reports which we weren't getting anymore and we're not getting content crashes which is also expected, since we'd get them only from users with Win32k lockdown disabled. Time for the uplifts.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 43](/show_bug.cgi?id=1872920#c43)• 11 months ago |
|  | |

Comment on [attachment 9376000](/attachment.cgi?id=9376000 "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") [[details]](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Make the crash reporter client locate the executable by itself r=yjuglaret

### Beta/Release Uplift Approval Request

* **User impact if declined**: The flaw allows an attacker who has obtained control of a content process to escape the sandbox and execute applications of its own choosing on the user machine (this affects a significant subset of users but not all of them). Additionally an attacker could leverage our Windows Error Reporting runtime exception module to attack **other applications** that have sandboxed processes exposed to the web.
* **Is this code covered by automated tests?**: No
* **Has the fix been verified in Nightly?**: Yes
* **Needs manual test from QE?**: No
* **If yes, steps to reproduce**:
* **List of other uplifts needed**: [Bug 1874235](/show_bug.cgi?id=1874235 "RESOLVED FIXED - Windows Error Reporting can fail in several ways")
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The changes happen mostly in code paths that are executed after Firefox has already crashed. As such, the chance of introducing visible regressions is rather small.
* **String changes made/needed**: None
* **Is Android affected?**: No

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**:
* **User impact if declined**: See above
* **Fix Landed on Version**: 125
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: See above
Flags: needinfo?(gsvelto)
[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: approval-mozilla-esr115?
[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: approval-mozilla-beta?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4382677_448747)• 11 months ago |

[Attachment #9376001](/attachment.cgi?id=9376001&action=edit "Bug 1872920 - Change the way we identify the parent process r=yjuglaret") -
Flags: approval-mozilla-beta?
[Attachment #9376917](/attachment.cgi?id=9376917&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret") -
Flags: approval-mozilla-beta?
[Attachment #9379716](/attachment.cgi?id=9379716&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret") -
Flags: approval-mozilla-beta?
[Attachment #9379717](/attachment.cgi?id=9379717&action=edit "Bug 1872920 - Introduce the process_reader crate r=yjuglaret") -
Flags: approval-mozilla-beta?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 44](/show_bug.cgi?id=1872920#c44)• 11 months ago |
|  | |

Not all the flags have been set correctly but the approval request applies to all the patches and also to [bug 1874235](/show_bug.cgi?id=1874235 "RESOLVED FIXED - Windows Error Reporting can fail in several ways") which is also required though it only fixes functional changes but does not affect the security issue here.

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 45](/show_bug.cgi?id=1872920#c45)• 11 months ago |
|  | |

Comment on [attachment 9376000](/attachment.cgi?id=9376000 "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") [[details]](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Make the crash reporter client locate the executable by itself r=yjuglaret

Approved for 124.0b4

[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4399728_690067)• 11 months ago |

[Attachment #9376001](/attachment.cgi?id=9376001&action=edit "Bug 1872920 - Change the way we identify the parent process r=yjuglaret") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4399731_690067)• 11 months ago |

[Attachment #9376917](/attachment.cgi?id=9376917&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes r=yjuglaret") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4399737_690067)• 11 months ago |

[Attachment #9379716](/attachment.cgi?id=9379716&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER r=yjuglaret") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4399740_690067)• 11 months ago |

[Attachment #9379717](/attachment.cgi?id=9379717&action=edit "Bug 1872920 - Introduce the process_reader crate r=yjuglaret") -
Flags: approval-mozilla-beta? → approval-mozilla-beta+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 46](/show_bug.cgi?id=1872920#c46)• 11 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-beta/rev/74c15d8edc87>
<https://hg.mozilla.org/releases/mozilla-beta/rev/ff1674ed959e>
<https://hg.mozilla.org/releases/mozilla-beta/rev/50a7cd68ca32>
<https://hg.mozilla.org/releases/mozilla-beta/rev/079865992447>
<https://hg.mozilla.org/releases/mozilla-beta/rev/3548868cfa54>

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4400030_690067)• 11 months ago |

[status-firefox124](/buglist.cgi?f1=cf_status_firefox124&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox124&o1=equals&v1=fixed)

|  | [Andrei Vaida [:avaida]](/user_profile?user_id=488993) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4612168_488993)• 11 months ago |

QA Whiteboard: [post-critsmash-triage]Flags: qe-verify-

|  | [Dianna Smith [:diannaS]](/user_profile?user_id=690067) |  |
| --- | --- | --- |
| [Comment 47](/show_bug.cgi?id=1872920#c47)• 11 months ago • [Edited](/page.cgi?id=comment-revisions.html&bug_id=1872920&comment_id=16813635 "1 revision") |
|  | |

:gsvelto looks like the dependency [bug 1874235](/show_bug.cgi?id=1874235 "RESOLVED FIXED - Windows Error Reporting can fail in several ways") doesnt graft cleanly to esr (i think it is missing [bug 1875097](/show_bug.cgi?id=1875097 "RESOLVED FIXED - Port the mozwer-rust crate to windows-sys")). let me know what you would like me to do

Flags: needinfo?(gsvelto)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4708505_448747)• 11 months ago |

Regressions: [1882080](/show_bug.cgi?id=1882080 "VERIFIED FIXED - Firefox no longer opens after clicking Restart Firefox inside Mozilla Crash Reporter")

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 48](/show_bug.cgi?id=1872920#c48)• 11 months ago |
|  | |

As we discussed I need to rework this patches without [bug 1875097](/show_bug.cgi?id=1875097 "RESOLVED FIXED - Port the mozwer-rust crate to windows-sys") to land them on ESR. Unfortunately I was too quick about landing that because it made my life simpler, but I forgot that it would be impossible to uplift it.

Flags: needinfo?(gsvelto)

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 49](/show_bug.cgi?id=1872920#c49)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Make the crash reporter client locate the executable by itself](attachment.cgi?id=9388000)
— [Details](attachment.cgi?id=9388000&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D199352>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796637_600971)• 11 months ago |

[Attachment #9388000](/attachment.cgi?id=9388000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 50](/show_bug.cgi?id=1872920#c50)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Change the way we identify the parent process](attachment.cgi?id=9388001)
— [Details](attachment.cgi?id=9388001&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D199353>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796663_600971)• 11 months ago |

[Attachment #9388001](/attachment.cgi?id=9388001&action=edit "Bug 1872920 - Change the way we identify the parent process") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 51](/show_bug.cgi?id=1872920#c51)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes](attachment.cgi?id=9388002)
— [Details](attachment.cgi?id=9388002&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D199856>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796690_600971)• 11 months ago |

[Attachment #9388002](/attachment.cgi?id=9388002&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 52](/show_bug.cgi?id=1872920#c52)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Introduce the process\_reader crate](attachment.cgi?id=9388003)
— [Details](attachment.cgi?id=9388003&action=edit)

Original Revision: <https://phabricator.services.mozilla.com/D201590>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796711_600971)• 11 months ago |

[Attachment #9388003](/attachment.cgi?id=9388003&action=edit "Bug 1872920 - Introduce the process_reader crate") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 53](/show_bug.cgi?id=1872920#c53)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Change how we notify the main process when we intercept a crash via WER](attachment.cgi?id=9388004)
— [Details](attachment.cgi?id=9388004&action=edit)

This patch makes several fundamental changes to the logic we use to inform

the main process whenever the WER runtime exception module intercepts a child

process crash:

* We no longer read the process type or any other data from the child process;

  the process type is passed as the runtime exception module's context
* We no longer read the address of the memory area used to communicate with the

  main process from the child process arguments. Instead we allocate memory

  directly into the main process and store the required information there
* We don't read anything from the main process either, the pointer to the

  function used to notify the main process is now found by looking out its

  dedicated section in the parent process' xul.dll mapping
* We no longer read the OOM crash annotation from a child process, this

  functionality will be restored by making the module use the mozannotation

  crates to fetch all the annotations

Original Revision: <https://phabricator.services.mozilla.com/D201589>

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796761_600971)• 11 months ago |

[Attachment #9388004](/attachment.cgi?id=9388004&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 54](/show_bug.cgi?id=1872920#c54)• 11 months ago |
|  | |

Comment on [attachment 9388000](/attachment.cgi?id=9388000 "Bug 1872920 - Make the crash reporter client locate the executable by itself") [[details]](/attachment.cgi?id=9388000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Make the crash reporter client locate the executable by itself

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: See [comment 43](/show_bug.cgi?id=1872920#c43 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer")
* **User impact if declined**: See [comment 43](/show_bug.cgi?id=1872920#c43 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer")
* **Fix Landed on Version**: 125
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**: The alternative would be to remove the WER runtime exception module entirely from ESR; but it would blind us to the type of crashes it catches.

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4796940_448747)• 11 months ago |

[Attachment #9376000](/attachment.cgi?id=9376000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself r=yjuglaret") -
Flags: approval-mozilla-esr115?

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4833583_600971)• 11 months ago |

[Attachment #9388004](/attachment.cgi?id=9388004&action=edit "Bug 1872920 - Change how we notify the main process when we intercept a crash via WER") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4833677_600971)• 11 months ago |

[Attachment #9388003](/attachment.cgi?id=9388003&action=edit "Bug 1872920 - Introduce the process_reader crate") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4833835_600971)• 11 months ago |

[Attachment #9388002](/attachment.cgi?id=9388002&action=edit "Bug 1872920 - Prevent the crash reporer from restarting Firefox when dealing with WER crashes") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4833840_600971)• 11 months ago |

[Attachment #9388001](/attachment.cgi?id=9388001&action=edit "Bug 1872920 - Change the way we identify the parent process") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4833891_600971)• 11 months ago |

[Attachment #9388000](/attachment.cgi?id=9388000&action=edit "Bug 1872920 - Make the crash reporter client locate the executable by itself") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Lando Automation](/user_profile?user_id=640478) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4834244_640478)• 11 months ago |

[status-firefox-esr115](/buglist.cgi?f1=cf_status_firefox_esr115&o1=isnotempty):
[affected](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=affected) → [fixed](/buglist.cgi?f1=cf_status_firefox_esr115&o1=equals&v1=fixed)

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 55](/show_bug.cgi?id=1872920#c55)• 11 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/48f187ce1d98>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/d63417193b5f>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/c507da671b49>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/a89e97918b1b>
<https://hg.mozilla.org/releases/mozilla-esr115/rev/1247a19d2f5b>

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 56](/show_bug.cgi?id=1872920#c56)• 11 months ago |
|  | |

Attached file
[Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0](attachment.cgi?id=9388229)
— [Details](attachment.cgi?id=9388229&action=edit)

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4840368_600971)• 11 months ago |

[Attachment #9388229](/attachment.cgi?id=9388229&action=edit "Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0") -
Flags: approval-mozilla-esr115?

|  | [Gabriele Svelto [:gsvelto]](/user_profile?user_id=448747)  Assignee |  |
| --- | --- | --- |
| [Comment 57](/show_bug.cgi?id=1872920#c57)• 11 months ago |
|  | |

Comment on [attachment 9388229](/attachment.cgi?id=9388229 "Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0") [[details]](/attachment.cgi?id=9388229&action=edit "Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0")

[Bug 1872920](/show_bug.cgi?id=1872920 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer") - Fix building mozwer-rust for rust version 1.69.0

### ESR Uplift Approval Request

* **If this is not a sec:{high,crit} bug, please state case for ESR consideration**: Fixes the build regression introduced with the other uplifts
* **User impact if declined**: We can't build Firefox :-(
* **Fix Landed on Version**:
* **Risk to taking this patch**: Low
* **Why is the change risky/not risky? (and alternatives if risky)**:

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Comment 58](/show_bug.cgi?id=1872920#c58)• 11 months ago |
|  | |

# Uplift Approval Request

* **String changes made/needed**: None
* **Explanation of risk level**: Low
* **Needs manual QE test**: no
* **Risk associated with taking this patch**: Low
* **Fix verified in Nightly**: no
* **User impact if declined**: See ticket
* **Is Android affected?**: no
* **Steps to reproduce for manual QE testing**: N/A
* **Code covered by automated testing**: no

|  | [Phabricator Automation](/user_profile?user_id=600971) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a4841879_600971)• 11 months ago |

[Attachment #9388229](/attachment.cgi?id=9388229&action=edit "Bug 1872920 - Fix building mozwer-rust for rust version 1.69.0") -
Flags: approval-mozilla-esr115? → approval-mozilla-esr115+

|  | [Pulsebot](/user_profile?user_id=510726) |  |
| --- | --- | --- |
| [Comment 59](/show_bug.cgi?id=1872920#c59)• 11 months ago |
| uplift | |

<https://hg.mozilla.org/releases/mozilla-esr115/rev/332453ecfde5>

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a5351346_1689)• 10 months ago |

Flags: sec-bounty? → sec-bounty+

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a6059135_486634)• 10 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?] → [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr124+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a6060247_486634)• 10 months ago |

Whiteboard: [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr124+] → [reporter-external] [client-bounty-form] [verif?][adv-main124+][adv-esr115.9+]

|  | [Tyson Smith [:tsmith]](/user_profile?user_id=486634) |  |
| --- | --- | --- |
| [Comment 60](/show_bug.cgi?id=1872920#c60)• 10 months ago |
|  | |

Attached file
[advisory.txt](attachment.cgi?id=9391504)
— [Details](attachment.cgi?id=9391504&action=edit)

|  | [Miloš](/user_profile?user_id=740986)  Reporter |  |
| --- | --- | --- |
| [Comment 61](/show_bug.cgi?id=1872920#c61)• 10 months ago |
|  | |

Could the advisory be changed to credit "goodbyeselene"? I realize I've forgotten to include this information in the original post, apologies for that. If not, it's not a big deal. Thanks!

|  | [Frederik Braun [:freddy]](/user_profile?user_id=428608) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a6462890_428608)• 10 months ago |

Alias: CVE-2024-2605

|  | [Tom Ritter [:tjr]](/user_profile?user_id=578488) |  |
| --- | --- | --- |
| [Comment 62](/show_bug.cgi?id=1872920#c62)• 10 months ago |
|  | |

(In reply to Miloš from [comment #61](/show_bug.cgi?id=1872920#c61 "RESOLVED FIXED - Sandbox escape via process type confusion in mozwer"))

> Could the advisory be changed to credit "goodbyeselene"? I realize I've forgotten to include this information in the original post, apologies for that. If not, it's not a big deal. Thanks!

Yes, I will update the advisory

|  | [David Lawrence [:dkl]](/user_profile?user_id=5898) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a12776914_5898)• 8 months ago |

Keywords: [reporter-external](/buglist.cgi?keywords=reporter-external&resolution=---)

|  | [Daniel Veditz [:dveditz]](/user_profile?user_id=1689) |  |
| --- | --- | --- |
| [Updated](/show_bug.cgi?id=1872920#a22155430_1689)• 4 months ago |

Group: core-security-release
You need to [log in](/show_bug.cgi?id=1872920&GoAheadAndLogIn=1)
before you can comment on or make changes to this bug.

Top ↑

## Attachment

Hide Details

### General

Creator:  [Miloš](/user_profile?user_id=740986)

Created:
Updated:
Size:

### Description

### File Name

### Content Type

Raw
Diff
Splinter Review



=== Content from www.mozilla.org_1388573f_20250110_221421.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-12

## Security Vulnerabilities fixed in Firefox 124

Announced
March 19, 2024
Impact
high
Products
Firefox
Fixed in

* Firefox 124

#### [#CVE-2024-2605: Windows Error Reporter could be used as a Sandbox escape vector](#CVE-2024-2605)

Reporter
goodbyeselene
Impact
high
##### Description

An attacker could have leveraged the Windows Error Reporter to run arbitrary code on the system escaping the sandbox. *Note:* This issue only affected Windows operating systems. Other operating systems are unaffected.

##### References

* [Bug 1872920](https://bugzilla.mozilla.org/show_bug.cgi?id=1872920)

#### [#CVE-2024-2606: Mishandling of WASM register values](#CVE-2024-2606)

Reporter
P1umer
Impact
high
##### Description

Passing invalid data could have led to invalid wasm values being created, such as arbitrary integers turning into pointer values.

##### References

* [Bug 1879237](https://bugzilla.mozilla.org/show_bug.cgi?id=1879237)

#### [#CVE-2024-2607: JIT code failed to save return registers on Armv7-A](#CVE-2024-2607)

Reporter
Gary Kwong
Impact
high
##### Description

Return registers were overwritten which could have allowed an attacker to execute arbitrary code. *Note:* This issue only affected Armv7-A systems. Other operating systems are unaffected.

##### References

* [Bug 1879939](https://bugzilla.mozilla.org/show_bug.cgi?id=1879939)

#### [#CVE-2024-2608: Integer overflow could have led to out of bounds write](#CVE-2024-2608)

Reporter
Ronald Crane
Impact
high
##### Description

`AppendEncodedAttributeValue(), ExtraSpaceNeededForAttrEncoding()` and `AppendEncodedCharacters()` could have experienced integer overflows, causing underallocation of an output buffer leading to an out of bounds write.

##### References

* [Bug 1880692](https://bugzilla.mozilla.org/show_bug.cgi?id=1880692)

#### [#CVE-2023-5388: NSS susceptible to timing attack against RSA decryption](#CVE-2023-5388)

Reporter
Hubert Kario
Impact
moderate
##### Description

NSS was susceptible to a timing side-channel attack when performing RSA decryption. This attack could potentially allow an attacker to recover the private data.

##### References

* [Bug 1780432](https://bugzilla.mozilla.org/show_bug.cgi?id=1780432)

#### [#CVE-2024-2609: Permission prompt input delay could expire when not in focus](#CVE-2024-2609)

Reporter
Shaheen Fazim
Impact
moderate
##### Description

The permission prompt input delay could have expired while the window is not in focus, which made the prompt vulnerable to clickjacking by malicious websites.

##### References

* [Bug 1866100](https://bugzilla.mozilla.org/show_bug.cgi?id=1866100)

#### [#CVE-2024-2610: Improper handling of html and body tags enabled CSP nonce leakage](#CVE-2024-2610)

Reporter
Georg Felber and Marco Squarcina (TU Wien)
Impact
moderate
##### Description

Using a markup injection an attacker could have stolen nonce values. This could have been used to bypass strict content security policies.

##### References

* [Bug 1871112](https://bugzilla.mozilla.org/show_bug.cgi?id=1871112)

#### [#CVE-2024-2611: Clickjacking vulnerability could have led to a user accidentally granting permissions](#CVE-2024-2611)

Reporter
Hafiizh
Impact
moderate
##### Description

A missing delay on when pointer lock was used could have allowed a malicious page to trick a user into granting permissions.

##### References

* [Bug 1876675](https://bugzilla.mozilla.org/show_bug.cgi?id=1876675)

#### [#CVE-2024-2612: Self referencing object could have potentially led to a use-after-free](#CVE-2024-2612)

Reporter
Ronald Crane
Impact
moderate
##### Description

If an attacker could find a way to trigger a particular code path in `SafeRefPtr`, it could have triggered a crash or potentially be leveraged to achieve code execution.

##### References

* [Bug 1879444](https://bugzilla.mozilla.org/show_bug.cgi?id=1879444)

#### [#CVE-2024-2613: Improper handling of QUIC ACK frame data could have led to OOM](#CVE-2024-2613)

Reporter
Max Inden
Impact
low
##### Description

Data was not properly sanitized when decoding a QUIC ACK frame; this could have led to unrestricted memory consumption and a crash.

##### References

* [Bug 1875701](https://bugzilla.mozilla.org/show_bug.cgi?id=1875701)

#### [#CVE-2024-2614: Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](#CVE-2024-2614)

Reporter
Noah Lokocz, Kevin Brosnan, Ryan VanderMeulen and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 123, Firefox ESR 115.8, and Thunderbird 115.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685358%2C1861016%2C1880405%2C1881093)

#### [#CVE-2024-2615: Memory safety bugs fixed in Firefox 124](#CVE-2024-2615)

Reporter
Paul Bone and the Mozilla Fuzzing Team
Impact
critical
##### Description

Memory safety bugs present in Firefox 123. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 124](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1881074%2C1882438%2C1881650)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)



=== Content from www.mozilla.org_e4d1377b_20250110_221422.html ===


## Help us improve your Mozilla experience

In addition to Cookies necessary for this site to function, we’d like your permission to set some additional Cookies to better understand your browsing needs and improve your experience. Rest assured — we value your privacy.

Accept All Additional Cookies

Reject All Additional Cookies

[Cookie settings](/en-US/privacy/websites/cookie-settings/)

Menu
[![Mozilla](https://www.mozilla.org/media/img/logos/m24/lockup-black.f2ddba3f0724.svg)](/en-US/)

* [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
  Firefox browsers](/en-US/firefox/)
  Close Firefox browsers menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Desktop](/en-US/firefox/new/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for iOS](/en-US/firefox/browsers/mobile/ios/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/logo.eb1324e44442.svg)
    #### Firefox for Android](/en-US/firefox/browsers/mobile/android/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/browser/focus/logo.aac3e33175cb.svg)
    #### Firefox Focus](/en-US/firefox/browsers/mobile/focus/)
  + [#### Firefox blog](https://blog.mozilla.org/firefox/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=firefox)
* [Products](/en-US/products/)
  Close Products menu
  + [![](https://www.mozilla.org/media/protocol/img/logos/mozilla/vpn/logo.c648f487bfb8.svg)
    #### Mozilla VPN](/en-US/products/vpn/)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/monitor/logo.d97e5516f9e6.svg)
    #### Mozilla Monitor](https://monitor.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/firefox/relay/logo-white.d42a8b52e44c.svg)
    #### Firefox Relay](https://relay.firefox.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/protocol/img/logos/pocket/logo.17446bc33a5d.svg)
    #### Pocket](https://getpocket.com/firefox_learnmore/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/nav/icons/icon-mdn-plus.f54475f980ab.svg)
    #### MDN Plus](https://developer.mozilla.org/plus?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/fakespot/logo-blue.3973b8fe9631.svg)
    #### Fakespot](https://fakespot.com/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=products)
  + [![](https://www.mozilla.org/media/img/logos/thunderbird/logo-thunderbird.121e9c0fed45.svg)
    #### Thunderbird](https://www.thunderbird.net/)

  [All products](/en-US/products/)
* [About us](/en-US/about/)
  Close About us menu

  Our Mission

  + [#### About Mozilla](/en-US/about/)
  + [#### The Mozilla Manifesto](/en-US/about/manifesto/)
  + [#### Get Involved](/en-US/contribute/)
  + [#### Innovation Projects](https://future.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Blog](https://blog.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)

  Our Work

  + [#### Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla.ai](https://www.mozilla.ai/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Ventures](https://mozilla.vc/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=nav&utm_content=about-us)
  + [#### Mozilla Advertising](/en-US/advertising/)

## Menu

* Mozilla Security

## [Mozilla Security](/en-US/security/)

* [Advisories](/en-US/security/advisories/)
* [Known Vulnerabilities](/en-US/security/known-vulnerabilities/)
* [Mozilla Security Blog](https://blog.mozilla.com/security/)
* [Security Bug Bounty](/en-US/security/bug-bounty/)
* [Third-party Injection Policy](/en-US/security/third-party-software-injection/)

## [Client Bug Bounty](/en-US/security/client-bug-bounty/)

* [Frequently Asked Questions](/en-US/security/bug-bounty/faq/)
* [Hall of Fame](/en-US/security/bug-bounty/hall-of-fame/)

## [Web Bug Bounty](/en-US/security/web-bug-bounty/)

* [Eligible Websites](/en-US/security/bug-bounty/web-eligible-sites/)
* [Frequently Asked Questions](/en-US/security/bug-bounty/faq-webapp/)
* [Hall of Fame](/en-US/security/bug-bounty/web-hall-of-fame/)

# Mozilla Foundation Security Advisory 2024-13

## Security Vulnerabilities fixed in Firefox ESR 115.9

Announced
March 19, 2024
Impact
high
Products
Firefox ESR
Fixed in

* Firefox ESR 115.9

#### [#CVE-2024-0743: Crash in NSS TLS method](#CVE-2024-0743)

Reporter
John Schanck
Impact
high
##### Description

An unchecked return value in TLS handshake code could have caused a potentially exploitable crash.

##### References

* [Bug 1867408](https://bugzilla.mozilla.org/show_bug.cgi?id=1867408)

#### [#CVE-2024-2605: Windows Error Reporter could be used as a Sandbox escape vector](#CVE-2024-2605)

Reporter
goodbyeselene
Impact
high
##### Description

An attacker could have leveraged the Windows Error Reporter to run arbitrary code on the system escaping the sandbox. *Note:* This issue only affected Windows operating systems. Other operating systems are unaffected.

##### References

* [Bug 1872920](https://bugzilla.mozilla.org/show_bug.cgi?id=1872920)

#### [#CVE-2024-2607: JIT code failed to save return registers on Armv7-A](#CVE-2024-2607)

Reporter
Gary Kwong
Impact
high
##### Description

Return registers were overwritten which could have allowed an attacker to execute arbitrary code. *Note:* This issue only affected Armv7-A systems. Other operating systems are unaffected.

##### References

* [Bug 1879939](https://bugzilla.mozilla.org/show_bug.cgi?id=1879939)

#### [#CVE-2024-2608: Integer overflow could have led to out of bounds write](#CVE-2024-2608)

Reporter
Ronald Crane
Impact
high
##### Description

`AppendEncodedAttributeValue(), ExtraSpaceNeededForAttrEncoding()` and `AppendEncodedCharacters()` could have experienced integer overflows, causing underallocation of an output buffer leading to an out of bounds write.

##### References

* [Bug 1880692](https://bugzilla.mozilla.org/show_bug.cgi?id=1880692)

#### [#CVE-2024-2616: Improve handling of out-of-memory conditions in ICU](#CVE-2024-2616)

Reporter
Ryan VanderMeulen and Dan Minor
Impact
high
##### Description

To harden ICU against exploitation, the behavior for out-of-memory conditions was changed to crash instead of attempt to continue.

##### References

* [Bug 1846197](https://bugzilla.mozilla.org/show_bug.cgi?id=1846197)

#### [#CVE-2023-5388: NSS susceptible to timing attack against RSA decryption](#CVE-2023-5388)

Reporter
Hubert Kario
Impact
moderate
##### Description

NSS was susceptible to a timing side-channel attack when performing RSA decryption. This attack could potentially allow an attacker to recover the private data.

##### References

* [Bug 1780432](https://bugzilla.mozilla.org/show_bug.cgi?id=1780432)

#### [#CVE-2024-2610: Improper handling of html and body tags enabled CSP nonce leakage](#CVE-2024-2610)

Reporter
Georg Felber and Marco Squarcina (TU Wien)
Impact
moderate
##### Description

Using a markup injection an attacker could have stolen nonce values. This could have been used to bypass strict content security policies.

##### References

* [Bug 1871112](https://bugzilla.mozilla.org/show_bug.cgi?id=1871112)

#### [#CVE-2024-2611: Clickjacking vulnerability could have led to a user accidentally granting permissions](#CVE-2024-2611)

Reporter
Hafiizh
Impact
moderate
##### Description

A missing delay on when pointer lock was used could have allowed a malicious page to trick a user into granting permissions.

##### References

* [Bug 1876675](https://bugzilla.mozilla.org/show_bug.cgi?id=1876675)

#### [#CVE-2024-2612: Self referencing object could have potentially led to a use-after-free](#CVE-2024-2612)

Reporter
Ronald Crane
Impact
moderate
##### Description

If an attacker could find a way to trigger a particular code path in `SafeRefPtr`, it could have triggered a crash or potentially be leveraged to achieve code execution.

##### References

* [Bug 1879444](https://bugzilla.mozilla.org/show_bug.cgi?id=1879444)

#### [#CVE-2024-2614: Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](#CVE-2024-2614)

Reporter
Noah Lokocz, Kevin Brosnan, Ryan VanderMeulen and the Mozilla Fuzzing Team
Impact
high
##### Description

Memory safety bugs present in Firefox 123, Firefox ESR 115.8, and Thunderbird 115.8. Some of these bugs showed evidence of memory corruption and we presume that with enough effort some of these could have been exploited to run arbitrary code.

##### References

* [Memory safety bugs fixed in Firefox 124, Firefox ESR 115.9, and Thunderbird 115.9](https://bugzilla.mozilla.org/buglist.cgi?bug_id=1685358%2C1861016%2C1880405%2C1881093)

## Company

* [Leadership](/about/leadership/)
* [Press Center](https://blog.mozilla.org/category/mozilla/news/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=company)
* [Careers](/en-US/careers/)
* [Contact](/en-US/contact/)

## Support

* [Product Help](https://support.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [File a Bug](https://bugzilla.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)
* [Localize Mozilla](https://pontoon.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=support)

## Resources

* [Advertise with Mozilla](/en-US/advertising/)
* [Firefox Release Notes](/firefox/134.0/releasenotes/)

## Developers

* [Developer Edition](/en-US/firefox/developer/)
* [Enterprise](/en-US/firefox/enterprise/)
* [Tools](https://firefox-source-docs.mozilla.org/devtools-user/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer&utm_content=developers)
* [MDN](https://developer.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer)

## Follow @Mozilla

* [X (formerly Twitter) (@mozilla)](https://twitter.com/mozilla)
* [Instagram (@mozilla)](https://www.instagram.com/mozilla/)
* [LinkedIn (@mozilla)](https://www.linkedin.com/company/mozilla-corporation/)
* [TikTok (@mozilla)](https://www.tiktok.com/%40mozilla)
* [Spotify (@mozilla)](https://open.spotify.com/show/0vT7LJMeVDxyQ2ZamHKu08?si=_uDRD6bRR_6M5YZyISGXgA)

## Follow @Firefox

* [X (formerly Twitter) (@firefox)](https://twitter.com/firefox)
* [Instagram (@firefox)](https://www.instagram.com/firefox/)
* [YouTube (@firefoxchannel)](https://www.youtube.com/user/firefoxchannel)
* [TikTok (@firefox)](https://www.tiktok.com/%40firefox)

[Donate](https://foundation.mozilla.org/?form=moco-donate-footer)

Visit [Mozilla Corporation’s](/en-US/) not-for-profit parent, the [Mozilla Foundation](https://foundation.mozilla.org/?utm_source=www.mozilla.org&utm_medium=referral&utm_campaign=footer).

Portions of this content are ©1998–2025 by individual mozilla.org contributors. Content available under a [Creative Commons license](/en-US/foundation/licensing/website-content/).

* [Website Privacy Notice](/en-US/privacy/websites/)
* [Cookies](/en-US/privacy/websites/cookie-settings/)
* [Legal](/en-US/about/legal/)
* [Community Participation Guidelines](/en-US/about/governance/policies/participation/)
* [About this site](/en-US/about/this-site/)

![](https://www.mozilla.org/media/img/logos/m24/wordmark-white.2d673bb5b33a.svg)


