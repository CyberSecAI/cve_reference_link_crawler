

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andrei Matei <andreimatei1@gmail.com> | 2024-03-26 22:42:45 -0400 |
| --- | --- | --- |
| committer | Alexei Starovoitov <ast@kernel.org> | 2024-03-27 09:56:36 -0700 |
| commit | [ecc6a2101840177e57c925c102d2d29f260d37c8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecc6a2101840177e57c925c102d2d29f260d37c8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)) | |
| tree | [bf6977a9ab0b8a0c54accee088371e52c6d6d08d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ecc6a2101840177e57c925c102d2d29f260d37c8) | |
| parent | [a8d89feba7e54e691ca7c4efc2a6264fa83f3687](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a8d89feba7e54e691ca7c4efc2a6264fa83f3687) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecc6a2101840177e57c925c102d2d29f260d37c8&id2=a8d89feba7e54e691ca7c4efc2a6264fa83f3687)) | |
| download | [linux-ecc6a2101840177e57c925c102d2d29f260d37c8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ecc6a2101840177e57c925c102d2d29f260d37c8.tar.gz) | |

bpf: Protect against int overflow for stack access sizeThis patch re-introduces protection against the size of access to stack
memory being negative; the access size can appear negative as a result
of overflowing its signed int representation. This should not actually
happen, as there are other protections along the way, but we should
protect against it anyway. One code path was missing such protections
(fixed in the previous patch in the series), causing out-of-bounds array
accesses in check\_stack\_range\_initialized(). This patch causes the
verification of a program with such a non-sensical access size to fail.
This check used to exist in a more indirect way, but was inadvertendly
removed in a833a17aeac7.
Fixes: a833a17aeac7 ("bpf: Fix verification of indirect var-off stack access")
Reported-by: syzbot+33f4297b5f927648741a@syzkaller.appspotmail.com
Reported-by: syzbot+aafd0513053a1cbf52ef@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/bpf/CAADnVQLORV5PT0iTAhRER+iLBTkByCYNBYyvBSgjN1T31K+gOw@mail.gmail.com/
Acked-by: Andrii Nakryiko <andrii@kernel.org>
Signed-off-by: Andrei Matei <andreimatei1@gmail.com>
Link: [https://lore.kernel.org/r/20240327024245.318299-3-andreimatei1@gmail.com](https://lore.kernel.org/r/20240327024245.318299-3-andreimatei1%40gmail.com)
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ecc6a2101840177e57c925c102d2d29f260d37c8)

| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/bpf/verifier.c?id=ecc6a2101840177e57c925c102d2d29f260d37c8) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 0bfc0050db28d4..353985b2b6a279 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/bpf/verifier.c?id=a8d89feba7e54e691ca7c4efc2a6264fa83f3687)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/bpf/verifier.c?id=ecc6a2101840177e57c925c102d2d29f260d37c8)@@ -6701,6 +6701,11 @@ static int check\_stack\_access\_within\_bounds( err = check\_stack\_slot\_within\_bounds(env, min\_off, state, type); if (!err && max\_off > 0) err = -EINVAL; /\* out of stack access into non-negative offsets \*/+ if (!err && access\_size < 0)+ /\* access\_size should not be negative (or overflow an int); others checks+ \* along the way should have prevented such an access.+ \*/+ err = -EFAULT; /\* invalid negative access size; integer overflow? \*/  if (err) { if (tnum\_is\_const(reg->var\_off)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 18:01:18 +0000

