

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Andrei Matei <andreimatei1@gmail.com> | 2024-03-26 22:42:45 -0400 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-04-10 16:35:43 +0200 |
| commit | [3f0784b2f1eb9147973d8c43ba085c5fdf44ff69](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)) | |
| tree | [a5f98b1d4eb5a44a2f6ca7b3f113365b56f8c0a4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69) | |
| parent | [867a2f598af6a645c865d1101b58c5e070c6dd9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=867a2f598af6a645c865d1101b58c5e070c6dd9e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69&id2=867a2f598af6a645c865d1101b58c5e070c6dd9e)) | |
| download | [linux-3f0784b2f1eb9147973d8c43ba085c5fdf44ff69.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3f0784b2f1eb9147973d8c43ba085c5fdf44ff69.tar.gz) | |

bpf: Protect against int overflow for stack access size[ Upstream commit ecc6a2101840177e57c925c102d2d29f260d37c8 ]
This patch re-introduces protection against the size of access to stack
memory being negative; the access size can appear negative as a result
of overflowing its signed int representation. This should not actually
happen, as there are other protections along the way, but we should
protect against it anyway. One code path was missing such protections
(fixed in the previous patch in the series), causing out-of-bounds array
accesses in check\_stack\_range\_initialized(). This patch causes the
verification of a program with such a non-sensical access size to fail.
This check used to exist in a more indirect way, but was inadvertendly
removed in a833a17aeac7.
Fixes: a833a17aeac7 ("bpf: Fix verification of indirect var-off stack access")
Reported-by: syzbot+33f4297b5f927648741a@syzkaller.appspotmail.com
Reported-by: syzbot+aafd0513053a1cbf52ef@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/bpf/CAADnVQLORV5PT0iTAhRER+iLBTkByCYNBYyvBSgjN1T31K+gOw@mail.gmail.com/
Acked-by: Andrii Nakryiko <andrii@kernel.org>
Signed-off-by: Andrei Matei <andreimatei1@gmail.com>
Link: [https://lore.kernel.org/r/20240327024245.318299-3-andreimatei1@gmail.com](https://lore.kernel.org/r/20240327024245.318299-3-andreimatei1%40gmail.com)
Signed-off-by: Alexei Starovoitov <ast@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)

| -rw-r--r-- | [kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/kernel/bpf/verifier.c?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/kernel/bpf/verifier.c b/kernel/bpf/verifier.cindex 396c4c66932f28..c9fc734989c686 100644--- a/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/bpf/verifier.c?id=867a2f598af6a645c865d1101b58c5e070c6dd9e)+++ b/[kernel/bpf/verifier.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/kernel/bpf/verifier.c?id=3f0784b2f1eb9147973d8c43ba085c5fdf44ff69)@@ -6637,6 +6637,11 @@ static int check\_stack\_access\_within\_bounds( err = check\_stack\_slot\_within\_bounds(env, min\_off, state, type); if (!err && max\_off > 0) err = -EINVAL; /\* out of stack access into non-negative offsets \*/+ if (!err && access\_size < 0)+ /\* access\_size should not be negative (or overflow an int); others checks+ \* along the way should have prevented such an access.+ \*/+ err = -EFAULT; /\* invalid negative access size; integer overflow? \*/  if (err) { if (tnum\_is\_const(reg->var\_off)) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 18:01:16 +0000

