

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2deb10a99671afda30f834e95e5b992a805bba6a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2deb10a99671afda30f834e95e5b992a805bba6a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2deb10a99671afda30f834e95e5b992a805bba6a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2deb10a99671afda30f834e95e5b992a805bba6a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mark Pearson <mpearson-lenovo@squebb.ca> | 2024-10-02 17:12:33 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-10-10 11:58:08 +0200 |
| commit | [2deb10a99671afda30f834e95e5b992a805bba6a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2deb10a99671afda30f834e95e5b992a805bba6a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2deb10a99671afda30f834e95e5b992a805bba6a)) | |
| tree | [51a9cf5751f8c459101ba4437eb77f51073028f6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2deb10a99671afda30f834e95e5b992a805bba6a) | |
| parent | [e115c1b5de55a105c75aba8eb08301c075fa4ef4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e115c1b5de55a105c75aba8eb08301c075fa4ef4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2deb10a99671afda30f834e95e5b992a805bba6a&id2=e115c1b5de55a105c75aba8eb08301c075fa4ef4)) | |
| download | [linux-2deb10a99671afda30f834e95e5b992a805bba6a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2deb10a99671afda30f834e95e5b992a805bba6a.tar.gz) | |

platform/x86: think-lmi: Fix password opcode ordering for workstations[ Upstream commit 6f7d0f5fd8e440c3446560100ac4ff9a55eec340 ]
The Lenovo workstations require the password opcode to be run before
the attribute value is changed (if Admin password is enabled).
Tested on some Thinkpads to confirm they are OK with this order too.
Signed-off-by: Mark Pearson <mpearson-lenovo@squebb.ca>
Fixes: 640a5fa50a42 ("platform/x86: think-lmi: Opcode support")
Reviewed-by: Ilpo JÃ¤rvinen <ilpo.jarvinen@linux.intel.com>
Link: [https://lore.kernel.org/r/20240209152359.528919-1-mpearson-lenovo@squebb.ca](https://lore.kernel.org/r/20240209152359.528919-1-mpearson-lenovo%40squebb.ca)
Reviewed-by: Hans de Goede <hdegoede@redhat.com>
Signed-off-by: Hans de Goede <hdegoede@redhat.com>
(cherry picked from commit 6f7d0f5fd8e440c3446560100ac4ff9a55eec340)
[Harshit: CVE-2024-26836; Resolve conflicts due to missing commit:
318d97849fc2 ("platform/x86: think-lmi: Add bulk save feature") which is
not in 6.6.y]
Signed-off-by: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Signed-off-by: Vegard Nossum <vegard.nossum@oracle.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2deb10a99671afda30f834e95e5b992a805bba6a)

| -rw-r--r-- | [drivers/platform/x86/think-lmi.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/platform/x86/think-lmi.c?id=2deb10a99671afda30f834e95e5b992a805bba6a) | 16 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 7 deletions

| diff --git a/drivers/platform/x86/think-lmi.c b/drivers/platform/x86/think-lmi.cindex aee869769843f5..2396decdb3cb3f 100644--- a/[drivers/platform/x86/think-lmi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/platform/x86/think-lmi.c?id=e115c1b5de55a105c75aba8eb08301c075fa4ef4)+++ b/[drivers/platform/x86/think-lmi.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/platform/x86/think-lmi.c?id=2deb10a99671afda30f834e95e5b992a805bba6a)@@ -1021,7 +1021,16 @@ static ssize\_t current\_value\_store(struct kobject \*kobj, \* Note - this sets the variable and then the password as separate \* WMI calls. Function tlmi\_save\_bios\_settings will error if the \* password is incorrect.+ \* Workstation's require the opcode to be set before changing the+ \* attribute. \*/+ if (tlmi\_priv.pwd\_admin->valid && tlmi\_priv.pwd\_admin->password[0]) {+ ret = tlmi\_opcode\_setting("WmiOpcodePasswordAdmin",+ tlmi\_priv.pwd\_admin->password);+ if (ret)+ goto out;+ }+ set\_str = kasprintf(GFP\_KERNEL, "%s,%s;", setting->display\_name, new\_setting); if (!set\_str) {@@ -1033,13 +1042,6 @@ static ssize\_t current\_value\_store(struct kobject \*kobj, if (ret) goto out; - if (tlmi\_priv.pwd\_admin->valid && tlmi\_priv.pwd\_admin->password[0]) {- ret = tlmi\_opcode\_setting("WmiOpcodePasswordAdmin",- tlmi\_priv.pwd\_admin->password);- if (ret)- goto out;- }- ret = tlmi\_save\_bios\_settings(""); } else { /\* old non-opcode based authentication method (deprecated) \*/ if (tlmi\_priv.pwd\_admin->valid && tlmi\_priv.pwd\_admin->password[0]) { |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:08:35 +0000

