=== Content from github.com_8bbe3cfd_20250111_030842.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Fcommit%2Fa69bbab73220f36e53c801cf7e9ea3627bb017eb)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Fcommit%2Fa69bbab73220f36e53c801cf7e9ea3627bb017eb)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=TeamNewPipe%2FNewPipe)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TeamNewPipe](/TeamNewPipe)
/
**[NewPipe](/TeamNewPipe/NewPipe)**
Public

* [Notifications](/login?return_to=%2FTeamNewPipe%2FNewPipe) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2FTeamNewPipe%2FNewPipe)
* [Star
   32.2k](/login?return_to=%2FTeamNewPipe%2FNewPipe)

* [Code](/TeamNewPipe/NewPipe)
* [Issues
  1.2k](/TeamNewPipe/NewPipe/issues)
* [Pull requests
  14](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects
  2](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

Additional navigation options

* [Code](/TeamNewPipe/NewPipe)
* [Issues](/TeamNewPipe/NewPipe/issues)
* [Pull requests](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

## Commit

[Permalink](/TeamNewPipe/NewPipe/commit/a69bbab73220f36e53c801cf7e9ea3627bb017eb)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-wxrm-jhpf-vp6v](https://github.com/TeamNewPipe/NewPipe/security/advisories/GHSA-wxrm-jhpf-vp6v "GHSA-wxrm-jhpf-vp6v")

[Browse files](/TeamNewPipe/NewPipe/tree/a69bbab73220f36e53c801cf7e9ea3627bb017eb)
Browse the repository at this point in the history

```
Fix preferences import vulnerability
```

* Loading branch information

[![@Stypox](https://avatars.githubusercontent.com/u/36421898?s=40&v=4)](/Stypox)

[Stypox](/TeamNewPipe/NewPipe/commits?author=Stypox "View all commits by Stypox")
authored
Apr 23, 2024

2 parents
[c915b6e](/TeamNewPipe/NewPipe/commit/c915b6e68b4613d414ce97acc1e58eb2f9a91410)
+
[f0db2aa](/TeamNewPipe/NewPipe/commit/f0db2aa43cbfa4d0523e8571042807427c2be2f6)

commit a69bbab

 Show file tree

 Hide file tree

Showing
**27 changed files**
with
**665 additions**
and
**244 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* app/src

  + main

    - java/org/schabi/newpipe

      * error

        + app/src/main/java/org/schabi/newpipe/error/UserAction.java
          [UserAction.java](#diff-c563f9c6e08467f2d55d45382a0ac42b98b1f3f81a287808bb776e7ba877008a)
      * settings

        + app/src/main/java/org/schabi/newpipe/settings/BackupRestoreSettingsFragment.java
          [BackupRestoreSettingsFragment.java](#diff-b7497da783ce5434473639b3766d25a7d02401818cf9bf5004ccef95ea65c587)
        + app/src/main/java/org/schabi/newpipe/settings/ContentSettingsManager.kt
          [ContentSettingsManager.kt](#diff-06c0f92415932141f635518309666a308ed7cb24953fb1d1e7e0c890bbe3e546)
        + app/src/main/java/org/schabi/newpipe/settings/NewPipeFileLocator.kt
          [NewPipeFileLocator.kt](#diff-f5c175359a4e45f50668328cf011d4fdf9c09e23daeb237be068d3d91e6d3395)
        + export

          - app/src/main/java/org/schabi/newpipe/settings/export/BackupFileLocator.kt
            [BackupFileLocator.kt](#diff-62e52902a7e7a7fef73fae4dd8b56ed68d12e4c142ec4a7f83a40b552e88b260)
          - app/src/main/java/org/schabi/newpipe/settings/export/ImportExportManager.kt
            [ImportExportManager.kt](#diff-24b9c1b9c8fb5c4652ce8baef4b60f4d3403de5005ae7d2e7e3c73a5caa1bb7d)
          - app/src/main/java/org/schabi/newpipe/settings/export/PreferencesObjectInputStream.java
            [PreferencesObjectInputStream.java](#diff-d607418e7c4621d6c1f117dc8d16cdac5202788e78f0cd464c67a0dfbef6510e)
      * util

        + app/src/main/java/org/schabi/newpipe/util/ZipHelper.java
          [ZipHelper.java](#diff-1f291c2fe651027e4f067649eea494b847b50f162b4985d29e56029c7a32ade9)
    - res/values

      * app/src/main/res/values/strings.xml
        [strings.xml](#diff-5e01f7d37a66e4ca03deefc205d8e7008661cdd0284a05aaba1858e6b7bf9103)
  + test

    - java/org/schabi/newpipe/settings

      * app/src/test/java/org/schabi/newpipe/settings/ImportAllCombinationsTest.kt
        [ImportAllCombinationsTest.kt](#diff-f93de74f1c567b5eccd5695be2ea4b325962c83fa9378e64e40f4e7c736d0566)
      * app/src/test/java/org/schabi/newpipe/settings/ImportExportManagerTest.kt
        [ImportExportManagerTest.kt](#diff-f5173747cae5f102e14779107dd9d896a0ab8c0e164daac702913b848e84f1a3)
    - resources/settings

      * app/src/test/resources/settings/README.md
        [README.md](#diff-a3772d1cc85be016d6e20bee23fe53646cd7cbae97f0e8b17a414f19c75d1861)
      * app/src/test/resources/settings/db\_noser\_json.zip
        [db\_noser\_json.zip](#diff-3332ac709c4d6e05f225f980d5a147841b0f06979a630efe907146d278f1701d)
      * app/src/test/resources/settings/db\_noser\_nojson.zip
        [db\_noser\_nojson.zip](#diff-bebd1185e5e61186fd5249c640fe8aa4340f78775271e35eded04f9f2fb0404f)
      * app/src/test/resources/settings/db\_ser\_json.zip
        [db\_ser\_json.zip](#diff-ab96a0cc27cebf3f262b5bc845c7dd1622fa1623107ab32ffcd6384d691d49b3)
      * app/src/test/resources/settings/db\_ser\_nojson.zip
        [db\_ser\_nojson.zip](#diff-6a2e7ef6de864da30be61a9ef68b85113be3279182d5729fe322880edd7a4285)
      * app/src/test/resources/settings/db\_vulnser\_json.zip
        [db\_vulnser\_json.zip](#diff-a08f6a1bb4c65ff2e787e38303c909cddbfef295f74515d5f9860e575aa8f014)
      * app/src/test/resources/settings/db\_vulnser\_nojson.zip
        [db\_vulnser\_nojson.zip](#diff-a488b866d5c0118d2a3609ce04b7faf2dbbe362506bca51b219b4a1f3424acd1)
      * app/src/test/resources/settings/newpipe.settings
        [newpipe.settings](#diff-0020ac6ef876e9c4a115c9e94724bfd4fd0cbd58131c7fb352265bd4c9696438)
      * app/src/test/resources/settings/newpipe.zip
        [newpipe.zip](#diff-8207cf1cf2f8a3e21bafa2d87c4022b448486bc46361858436056ba310cb40ea)
      * app/src/test/resources/settings/nodb\_noser\_json.zip
        [nodb\_noser\_json.zip](#diff-90087bdea3748beaf0ac959c50b4bdac0be07f44db73563e410921555d13cef7)
      * app/src/test/resources/settings/nodb\_noser\_nojson.zip
        [nodb\_noser\_nojson.zip](#diff-cfcace7ea8afb80f168b56cfc0df80d490390c4e69e636e371d6985be284e7b1)
      * app/src/test/resources/settings/nodb\_ser\_json.zip
        [nodb\_ser\_json.zip](#diff-2e964562d2491851fc1ed9f7a1e598db857f61332ea24b1f81f87d2ccec8e244)
      * app/src/test/resources/settings/nodb\_ser\_nojson.zip
        [nodb\_ser\_nojson.zip](#diff-d669fa28fbfb394c27cb58fa19660a82c527e76046045a38e7a066bd4e565fcb)
      * app/src/test/resources/settings/nodb\_vulnser\_json.zip
        [nodb\_vulnser\_json.zip](#diff-6ea2e2413515c7a3d722b4d94974d99c43ecbac7ab6b79aadf9d2dd1b80bd746)
      * app/src/test/resources/settings/nodb\_vulnser\_nojson.zip
        [nodb\_vulnser\_nojson.zip](#diff-7787c1478bb33ec5056a5f81a516cd30be9396478162e0029d983c675dfab9d6)
* checkstyle

  + checkstyle/checkstyle.xml
    [checkstyle.xml](#diff-378bf48abef893af8deb679cbe6766a9bb659e6062201d4af1850895c027a429)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[app/src/main/java/org/schabi/newpipe/error/UserAction.java](#diff-c563f9c6e08467f2d55d45382a0ac42b98b1f3f81a287808bb776e7ba877008a "app/src/main/java/org/schabi/newpipe/error/UserAction.java")

Show comments

[View file](/TeamNewPipe/NewPipe/blob/a69bbab73220f36e53c801cf7e9ea3627bb017eb/app/src/main/java/org/schabi/newpipe/error/UserAction.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -6,6 +6,7 @@ |
|  |  | public enum UserAction { |
|  |  | USER\_REPORT("user report"), |
|  |  | UI\_ERROR("ui error"), |
|  |  | DATABASE\_IMPORT\_EXPORT("database import or export"), |
|  |  | SUBSCRIPTION\_CHANGE("subscription change"), |
|  |  | SUBSCRIPTION\_UPDATE("subscription update"), |
|  |  | SUBSCRIPTION\_GET("get subscription"), |
| Expand Down | |  |

46 changes: 38 additions & 8 deletions

46
[app/src/main/java/org/schabi/newpipe/settings/BackupRestoreSettingsFragment.java](#diff-b7497da783ce5434473639b3766d25a7d02401818cf9bf5004ccef95ea65c587 "app/src/main/java/org/schabi/newpipe/settings/BackupRestoreSettingsFragment.java")

Show comments

[View file](/TeamNewPipe/NewPipe/blob/a69bbab73220f36e53c801cf7e9ea3627bb017eb/app/src/main/java/org/schabi/newpipe/settings/BackupRestoreSettingsFragment.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,9 +21,15 @@ |
|  |  | import androidx.preference.Preference; |
|  |  | import androidx.preference.PreferenceManager; |
|  |  |  |
|  |  | import com.grack.nanojson.JsonParserException; |
|  |  |  |
|  |  | import org.schabi.newpipe.NewPipeDatabase; |
|  |  | import org.schabi.newpipe.R; |
|  |  | import org.schabi.newpipe.error.ErrorInfo; |
|  |  | import org.schabi.newpipe.error.ErrorUtil; |
|  |  | import org.schabi.newpipe.error.UserAction; |
|  |  | import org.schabi.newpipe.settings.export.BackupFileLocator; |
|  |  | import org.schabi.newpipe.settings.export.ImportExportManager; |
|  |  | import org.schabi.newpipe.streams.io.NoFileManagerSafeGuard; |
|  |  | import org.schabi.newpipe.streams.io.StoredFileHelper; |
|  |  | import org.schabi.newpipe.util.NavigationHelper; |
| Expand All | | @@ -42,7 +48,7 @@ public class BackupRestoreSettingsFragment extends BasePreferenceFragment { |
|  |  |  |
|  |  | private final SimpleDateFormat exportDateFormat = |
|  |  | new SimpleDateFormat("yyyyMMdd\_HHmmss", Locale.US); |
|  |  | private ContentSettingsManager manager; |
|  |  | private ImportExportManager manager; |
|  |  | private String importExportDataPathKey; |
|  |  | private final ActivityResultLauncher<Intent> requestImportPathLauncher = |
|  |  | registerForActivityResult(new ActivityResultContracts.StartActivityForResult(), |
| Expand All | | @@ -57,8 +63,7 @@ public void onCreatePreferences(@Nullable final Bundle savedInstanceState, |
|  |  | @Nullable final String rootKey) { |
|  |  | final File homeDir = ContextCompat.getDataDir(requireContext()); |
|  |  | Objects.requireNonNull(homeDir); |
|  |  | manager = new ContentSettingsManager(new NewPipeFileLocator(homeDir)); |
|  |  | manager.deleteSettingsFile(); |
|  |  | manager = new ImportExportManager(new BackupFileLocator(homeDir)); |
|  |  |  |
|  |  | importExportDataPathKey = getString(R.string.import\_export\_data\_path); |
|  |  |  |
| Expand Down  Expand Up | | @@ -165,7 +170,7 @@ private void exportDatabase(final StoredFileHelper file, final Uri exportDataUri |
|  |  | Toast.makeText(requireContext(), R.string.export\_complete\_toast, Toast.LENGTH\_SHORT) |
|  |  | .show(); |
|  |  | } catch (final Exception e) { |
|  |  | ErrorUtil.showUiErrorSnackbar(this, "Exporting database", e); |
|  |  | showErrorSnackbar(e, "Exporting database and settings"); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand All | | @@ -182,16 +187,21 @@ private void importDatabase(final StoredFileHelper file, final Uri importDataUri |
|  |  | throw new IOException("Could not create databases dir"); |
|  |  | } |
|  |  |  |
|  |  | // replace the current database |
|  |  | if (!manager.extractDb(file)) { |
|  |  | Toast.makeText(requireContext(), R.string.could\_not\_import\_all\_files, |
|  |  | Toast.LENGTH\_LONG) |
|  |  | .show(); |
|  |  | } |
|  |  |  |
|  |  | // if settings file exist, ask if it should be imported. |
|  |  | if (manager.extractSettings(file)) { |
|  |  | final boolean hasJsonPrefs = manager.exportHasJsonPrefs(file); |
|  |  | if (hasJsonPrefs || manager.exportHasSerializedPrefs(file)) { |
|  |  | new androidx.appcompat.app.AlertDialog.Builder(requireContext()) |
|  |  | .setTitle(R.string.import\_settings) |
|  |  | .setMessage(hasJsonPrefs ? null : requireContext() |
|  |  | .getString(R.string.import\_settings\_vulnerable\_format)) |
|  |  | .setOnDismissListener(dialog -> finishImport(importDataUri)) |
|  |  | .setNegativeButton(R.string.cancel, (dialog, which) -> { |
|  |  | dialog.dismiss(); |
|  |  | finishImport(importDataUri); |
| Expand All | | @@ -201,7 +211,16 @@ private void importDatabase(final StoredFileHelper file, final Uri importDataUri |
|  |  | final Context context = requireContext(); |
|  |  | final SharedPreferences prefs = PreferenceManager |
|  |  | .getDefaultSharedPreferences(context); |
|  |  | manager.loadSharedPreferences(prefs); |
|  |  | try { |
|  |  | if (hasJsonPrefs) { |
|  |  | manager.loadJsonPrefs(file, prefs); |
|  |  | } else { |
|  |  | manager.loadSerializedPrefs(file, prefs); |
|  |  | } |
|  |  | } catch (IOException | ClassNotFoundException | JsonParserException e) { |
|  |  | createErrorNotification(e, "Importing preferences"); |
|  |  | return; |
|  |  | } |
|  |  | cleanImport(context, prefs); |
|  |  | finishImport(importDataUri); |
|  |  | }) |
| Expand All | | @@ -210,7 +229,7 @@ private void importDatabase(final StoredFileHelper file, final Uri importDataUri |
|  |  | finishImport(importDataUri); |
|  |  | } |
|  |  | } catch (final Exception e) { |
|  |  | ErrorUtil.showUiErrorSnackbar(this, "Importing database", e); |
|  |  | showErrorSnackbar(e, "Importing database and settings"); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down  Expand Up | | @@ -247,7 +266,7 @@ private void cleanImport(@NonNull final Context context, |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Save import path and restart system. |
|  |  | \* Save import path and restart app. |
|  |  | \* |
|  |  | \* @param importDataUri The import path to save |
|  |  | \*/ |
| Expand All | | @@ -268,4 +287,15 @@ private void saveLastImportExportDataUri(final Uri importExportDataUri) { |
|  |  | .putString(importExportDataPathKey, importExportDataUri.toString()); |
|  |  | editor.apply(); |
|  |  | } |
|  |  |  |
|  |  | private void showErrorSnackbar(final Throwable e, final String request) { |
|  |  | ErrorUtil.showSnackbar(this, new ErrorInfo(e, UserAction.DATABASE\_IMPORT\_EXPORT, request)); |
|  |  | } |
|  |  |  |
|  |  | private void createErrorNotification(final Throwable e, final String request) { |
|  |  | ErrorUtil.createNotification( |
|  |  | requireContext(), |
|  |  | new ErrorInfo(e, UserAction.DATABASE\_IMPORT\_EXPORT, request) |
|  |  | ); |
|  |  | } |
|  |  | } |

120 changes: 0 additions & 120 deletions

120
[app/src/main/java/org/schabi/newpipe/settings/ContentSettingsManager.kt](#diff-06c0f92415932141f635518309666a308ed7cb24953fb1d1e7e0c890bbe3e546 "app/src/main/java/org/schabi/newpipe/settings/ContentSettingsManager.kt")

Show comments

[View file](/TeamNewPipe/NewPipe/blob/c915b6e68b4613d414ce97acc1e58eb2f9a91410/app/src/main/java/org/schabi/newpipe/settings/ContentSettingsManager.kt)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

21 changes: 0 additions & 21 deletions

21
[app/src/main/java/org/schabi/newpipe/settings/NewPipeFileLocator.kt](#diff-f5c175359a4e45f50668328cf011d4fdf9c09e23daeb237be068d3d91e6d3395 "app/src/main/java/org/schabi/newpipe/settings/NewPipeFileLocator.kt")

Show comments

[View file](/TeamNewPipe/NewPipe/blob/c915b6e68b4613d414ce97acc1e58eb2f9a91410/app/src/main/java/org/schabi/newpipe/settings/NewPipeFileLocator.kt)
Edit file

Delete file

Load diff

This file was deleted.

Oops, something went wrong.

Retry

28 changes: 28 additions & 0 deletions

28
[app/src/main/java/org/schabi/newpipe/settings/export/BackupFileLocator.kt](#diff-62e52902a7e7a7fef73fae4dd8b56ed68d12e4c142ec4a7f83a40b552e88b260 "app/src/main/java/org/schabi/newpipe/settings/export/BackupFileLocator.kt")

Show comments

[View file](/TeamNewPipe/NewPipe/blob/a69bbab73220f36e53c801cf7e9ea3627bb017eb/app/src/main/java/org/schabi/newpipe/settings/export/BackupFileLocator.kt)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,28 @@ |
|  |  | package org.schabi.newpipe.settings.export |
|  |  |  |
|  |  | import java.io.File |
|  |  |  |
|  |  | /\*\* |
|  |  | \* Locates specific files of NewPipe based on the home directory of the app. |
|  |  | \*/ |
|  |  | class BackupFileLocator(private val homeDir: File) { |
|  |  | companion object { |
|  |  | const val FILE\_NAME\_DB = "newpipe.db" |
|  |  | @Deprecated( |
|  |  | "Serializing preferences with Java's ObjectOutputStream is vulnerable to injections", |
|  |  | replaceWith = ReplaceWith("FILE\_NAME\_JSON\_PREFS") |
|  |  | ) |
|  |  | const val FILE\_NAME\_SERIALIZED\_PREFS = "newpipe.settings" |
|  |  | const val FILE\_NAME\_JSON\_PREFS = "preferences.json" |
|  |  | } |
|  |  |  |
|  |  | val dbDir by lazy { File(homeDir, "/databases") } |
|  |  |  |
|  |  | val db by lazy { File(dbDir, FILE\_NAME\_DB) } |
|  |  |  |
|  |  | val dbJournal by lazy { File(dbDir, "$FILE\_NAME\_DB-journal") } |
|  |  |  |
|  |  | val dbShm by lazy { File(dbDir, "$FILE\_NAME\_DB-shm") } |
|  |  |  |
|  |  | val dbWal by lazy { File(dbDir, "$FILE\_NAME\_DB-wal") } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `a69bbab`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Fcommit%2Fa69bbab73220f36e53c801cf7e9ea3627bb017eb) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from docs.oracle.com_230ce376_20250111_030841.html ===


| [CONTENTS](serialTOC.html) | [PREV](version.html) | [NEXT](security.html) | *Java Object Serialization Specificationversion 6.0* |
| --- | --- |

# Object Serialization Stream Protocol

---

| **CHAPTER 6** |
| --- |

#### *Topics:*

> * [Overview](protocol.html#8130)
> * [Stream Elements](protocol.html#8299)
> * [Stream Protocol Versions](protocol.html#5849)
> * [Grammar for the Stream Format](protocol.html#10258)
> * [Example](protocol.html#10128)

---

## *6.1* Overview

> The stream format satisfies the following design goals:

> * Is compact and is structured for efficient reading.

> * Allows skipping through the stream using only the knowledge of the structure and format of the stream. Does not require invoking any per class code.
> * Requires only stream access to the data.

---

## *6.2* Stream Elements

> A basic structure is needed to represent objects in a stream. Each attribute of the object needs to be represented: its classes, its fields, and data written and later read by class-specific methods. The representation of objects in the stream can be described with a grammar. There are special representations for null objects, new objects, classes, arrays, strings, and back references to any object already in the stream. Each object written to the stream is assigned a handle that is used to refer back to the object. Handles are assigned sequentially starting from 0x7E0000. The handles restart at 0x7E0000 when the stream is reset.
>
>
> A class object is represented by the following:

> * Its `ObjectStreamClass` object.

> An `ObjectStreamClass` object for a Class that is not a dynamic proxy class is represented by the following:

> * The Stream Unique Identifier (SUID) of compatible classes.

> * A set of flags indicating various properties of the class, such as whether the class defines a `writeObject` method, and whether the class is serializable, externalizable, or an enum type
> * The number of serializable fields
> * The array of fields of the class that are serialized by the default mechanismFor arrays and object fields, the type of the field is included as a string which must be in "field descriptor" format (e.g., "`Ljava/lang/Object;`") as specified in section 4.3.2 of The JavaTM Virtual Machine Specification, Second Edition.
> * Optional block-data records or objects written by the `annotateClass` method
> * The `ObjectStreamClass` of its supertype (null if the superclass is not serializable)

> An `ObjectStreamClass` object for a dynamic proxy class is represented by the following:

> * The number of interfaces that the dynamic proxy class implements

> * The names of all of the interfaces implemented by the dynamic proxy class, listed in the order that they are returned by invoking the `getInterfaces` method on the Class object.
> * Optional block-data records or objects written by the `annotateProxyClass` method.
> * The ObjectStreamClass of its supertype, `java.lang.reflect.Proxy`.

> The representation of `String` objects consists of length information followed by the contents of the string encoded in modified UTF-8. The modified UTF-8 encoding is the same as used in the JavaTM Virtual Machine and in the `java.io.DataInput` and `DataOutput` interfaces; it differs from standard UTF-8 in the representation of supplementary characters and of the null character. The form of the length information depends on the length of the string in modified UTF-8 encoding. If the modified UTF-8 encoding of the given `String` is less than 65536 bytes in length, the length is written as 2 bytes representing an unsigned 16-bit integer. Starting with the JavaTM 2 platform, Standard Edition, v1.3, if the length of the string in modified UTF-8 encoding is 65536 bytes or more, the length is written in 8 bytes representing a signed 64-bit integer. The typecode preceding the `String` in the serialization stream indicates which format was used to write the `String`.
>
>
> Arrays are represented by the following:

> * Their `ObjectStreamClass` object.

> * The number of elements.
> * The sequence of values. The type of the values is implicit in the type of the array. for example the values of a byte array are of type byte.

> Enum constants are represented by the following:

> * The `ObjectStreamClass` object of the constant's base enum type.

> * The constant's name string.

> New objects in the stream are represented by the following:

> * The most derived class of the object.

> * Data for each serializable class of the object, with the highest superclass first.For each class the stream contains the following:

> * The serializable fields.See [Section 1.5, "Defining Serializable Fields for a Class](serial-arch.html#6250)."
> * If the class has `writeObject`/`readObject` methods, there may be optional objects and/or block-data records of primitive types written by the `writeObject` method followed by an `endBlockData` code.

> All primitive data written by classes is buffered and wrapped in block-data records, regardless if the data is written to the stream within a `writeObject` method or written directly to the stream from outside a `writeObject` method. This data can only be read by the corresponding `readObject` methods or be read directly from the stream. Objects written by the `writeObject` method terminate any previous block-data record and are written either as regular objects or null or back references, as appropriate. The block-data records allow error recovery to discard any optional data. When called from within a class, the stream can discard any data or objects until the `endBlockData`.

---

## *6.3* Stream Protocol Versions

> It was necessary to make a change to the serialization stream format in JDKTM 1.2 that is not backwards compatible to all minor releases of JDKTM 1.1. To provide for cases where backwards compatibility is required, a capability has been added to indicate what *PROTOCOL\_VERSION* to use when writing a serialization stream. The method `ObjectOutputStream.useProtocolVersion` takes as a parameter the protocol version to use to write the serialization stream.
>
>
> The Stream Protocol Versions are as follows:

> * `ObjectStreamConstants.PROTOCOL_VERSION_1`

|  |  | Indicates the initial stream format. |
| --- | --- | --- |

> * `ObjectStreamConstants.PROTOCOL_VERSION_2`

|  |  | Indicates the new external data format. Primitive data is written in block data mode and is terminated with *TC\_ENDBLOCKDATA*. |
| --- | --- | --- |

|  |  | Block data boundaries have been standardized. Primitive data written in block data mode is normalized to not exceed 1024 byte chunks. The benefit of this change was to tighten the specification of serialized data format within the stream. This change is fully backward and forward compatible. |
| --- | --- | --- |

> JDKTM 1.2 defaults to writing `PROTOCOL_VERSION_2`.
>
>
> JDKTM 1.1 defaults to writing `PROTOCOL_VERSION_1`.
>
>
> JDKTM 1.1.7 and greater can read both versions.
>
>
> Releases prior to JDKTM 1.1.7 can only read `PROTOCOL_VERSION_1`.

---

## *6.4* Grammar for the Stream Format

> The table below contains the grammar for the stream format. Nonterminal symbols are shown in italics. Terminal symbols in a *fixed width font*. Definitions of nonterminals are followed by a ":". The definition is followed by one or more alternatives, each on a separate line. The following table describes the notation:
>
>
>
>
> | **Notation** | **Meaning** |
> | *(datatype*) | This token has the data type specified, such as byte. |
> | *token[n]* | A predefined number of occurrences of the token, that is an array. |
> | *x0001* | A literal value expressed in hexadecimal. The number of hex digits reflects the size of the value. |
> | <*xxx*> | A value read from the stream used to indicate the length of an array. |
>
> |  |
> | --- |
>
>
>
>
> Note that the symbol (utf) is used to designate a string written using 2-byte length information, and (long-utf) is used to designate a string written using 8-byte length information. For details, refer to [Section 6.2, "Stream Elements](protocol.html#8299)".

### *6.4.1* Rules of the Grammar

> A Serialized stream is represented by any stream satisfying the *stream* rule.
>
>
> ```
> stream:
>   magic version contents
>
> ```
> ```
> contents:
>   content
>   contents content
>
> ```
> ```
> content:
>   object
>   blockdata
>
> ```
> ```
> object:
>   newObject
>   newClass
>   newArray
>   newString
>   newEnum
>   newClassDesc
>   prevObject
>   nullReference
>   exception
>   TC_RESET
>
> ```
> ```
> newClass:
>   TC_CLASS classDesc newHandle
>
> ```
> ```
> classDesc:
>   newClassDesc
>   nullReference
>   (ClassDesc)prevObject      // an object required to be of type
>                              // ClassDesc
>
> ```
> ```
> superClassDesc:
>   classDesc
>
> ```
> ```
> newClassDesc:
>   TC_CLASSDESC className serialVersionUID newHandle classDescInfo
>   TC_PROXYCLASSDESC newHandle proxyClassDescInfo
>
> ```
> ```
> classDescInfo:
>   classDescFlags fields classAnnotation superClassDesc
>
> ```
> ```
> className:
>   (utf)
>
> ```
> ```
> serialVersionUID:
>   (long)
>
> ```
> ```
> classDescFlags:
>   (byte)                  // Defined in Terminal Symbols and
>                             // Constants
>
> ```
> ```
> proxyClassDescInfo:
>   (int)<count> proxyInterfaceName[count] classAnnotation
>       superClassDesc
>
> ```
> ```
> proxyInterfaceName:
>
> ```
> ```
>   (utf)
>
> ```
> ```
> fields:
>   (short)<count>  fieldDesc[count]
>
> ```
> ```
> fieldDesc:
>   primitiveDesc
>   objectDesc
>
> ```
> ```
> primitiveDesc:
>   prim_typecode fieldName
>
> ```
> ```
> objectDesc:
>   obj_typecode fieldName className1
>
> ```
> ```
> fieldName:
>   (utf)
>
> ```
> ```
> className1:
>   (String)object             // String containing the field's type,
>                              // in field descriptor format
>
> ```
> ```
> classAnnotation:
>   endBlockData
>   contents endBlockData      // contents written by annotateClass
>
> ```
> ```
> prim_typecode:
>   `B'	// byte
>   `C'	// char
>   `D'	// double
>   `F'	// float
>   `I'	// integer
>   `J'	// long
>   `S'	// short
>   `Z'	// boolean
>
> ```
> ```
> obj_typecode:
>   `[`	// array
>   `L'	// object
>
> ```
> ```
> newArray:
>   TC_ARRAY classDesc newHandle (int)<size> values[size]
>
> ```
> ```
> newObject:
>   TC_OBJECT classDesc newHandle classdata[]  // data for each class
>
> ```
> ```
> classdata:
>   nowrclass                 // SC_SERIALIZABLE & classDescFlag &&
>                             // !(SC_WRITE_METHOD & classDescFlags)
>   wrclass objectAnnotation  // SC_SERIALIZABLE & classDescFlag &&
>                             // SC_WRITE_METHOD & classDescFlags
>   externalContents          // SC_EXTERNALIZABLE & classDescFlag &&
>                             // !(SC_BLOCKDATA  & classDescFlags
>   objectAnnotation          // SC_EXTERNALIZABLE & classDescFlag&&
>                             // SC_BLOCKDATA & classDescFlags
>
> ```
> ```
> nowrclass:
>   values                    // fields in order of class descriptor
>
> ```
> ```
> wrclass:
>   nowrclass
>
> ```
> ```
> objectAnnotation:
>   endBlockData
>   contents endBlockData     // contents written by writeObject
>                             // or writeExternal PROTOCOL_VERSION_2.
>
> ```
> ```
> blockdata:
>   blockdatashort
>   blockdatalong
>
> ```
> ```
> blockdatashort:
>   TC_BLOCKDATA (unsigned byte)<size> (byte)[size]
>
> ```
> ```
> blockdatalong:
>   TC_BLOCKDATALONG (int)<size> (byte)[size]
>
> ```
> ```
> endBlockData	:
>   TC_ENDBLOCKDATA
>
> ```
> ```
> externalContent:          // Only parseable by readExternal
>   ( bytes)                // primitive data
>     object
>
> ```
> ```
> externalContents:         // externalContent written by
>   externalContent         // writeExternal in PROTOCOL_VERSION_1.
>   externalContents externalContent
>
> ```
> ```
> newString:
>   TC_STRING newHandle (utf)
>   TC_LONGSTRING newHandle (long-utf)
>
> ```
> ```
> newEnum:
>   TC_ENUM classDesc newHandle enumConstantName
>
> ```
> ```
> enumConstantName:
>   (String)object
>
> ```
> ```
> prevObject
>   TC_REFERENCE (int)handle
>
> ```
> ```
> nullReference
>   TC_NULL
>
> ```
> ```
> exception:
>   TC_EXCEPTION reset (Throwable)object	 reset
>
> ```
> ```
> magic:
>   STREAM_MAGIC
>
> ```
> ```
> version
>   STREAM_VERSION
>
> ```
> ```
> values:          // The size and types are described by the
>                  // classDesc for the current object
>
> ```
> ```
> newHandle:       // The next number in sequence is assigned
>                  // to the object being serialized or deserialized
>
> ```
> ```
> reset:           // The set of known objects is discarded
>                  // so the objects of the exception do not
>                  // overlap with the previously sent objects
>                  // or with objects that may be sent after
>                  // the exception
>
> ```

### *6.4.2* Terminal Symbols and Constants

> The following symbols in `java.io.ObjectStreamConstants` define the terminal and constant values expected in a stream.
>
>
> ```
>     final static short STREAM_MAGIC = (short)0xaced;
>     final static short STREAM_VERSION = 5;
>     final static byte TC_NULL = (byte)0x70;
>     final static byte TC_REFERENCE = (byte)0x71;
>     final static byte TC_CLASSDESC = (byte)0x72;
>     final static byte TC_OBJECT = (byte)0x73;
>     final static byte TC_STRING = (byte)0x74;
>     final static byte TC_ARRAY = (byte)0x75;
>     final static byte TC_CLASS = (byte)0x76;
>     final static byte TC_BLOCKDATA = (byte)0x77;
>     final static byte TC_ENDBLOCKDATA = (byte)0x78;
>     final static byte TC_RESET = (byte)0x79;
>     final static byte TC_BLOCKDATALONG = (byte)0x7A;
>     final static byte TC_EXCEPTION = (byte)0x7B;
>     final static byte TC_LONGSTRING = (byte) 0x7C;
>     final static byte TC_PROXYCLASSDESC = (byte) 0x7D;
>     final static byte TC_ENUM = (byte) 0x7E;
>     final static  int   baseWireHandle = 0x7E0000;
>
> ```
>
> The flag byte *classDescFlags* may include values of
>
>
> ```
>     final static byte SC_WRITE_METHOD = 0x01; //if SC_SERIALIZABLE
>      final static byte SC_BLOCK_DATA = 0x08;    //if SC_EXTERNALIZABLE
>     final static byte SC_SERIALIZABLE = 0x02;
>     final static byte SC_EXTERNALIZABLE = 0x04;
>     final static byte SC_ENUM = 0x10;
>
> ```
>
> The flag *SC\_WRITE\_METHOD* is set if the Serializable class writing the stream had a `writeObject` method that may have written additional data to the stream. In this case a *TC\_ENDBLOCKDATA* marker is always expected to terminate the data for that class.
>
>
> The flag *SC\_BLOCKDATA* is set if the `Externalizable` class is written into the stream using `STREAM_PROTOCOL_2`. By default, this is the protocol used to write `Externalizable` objects into the stream in JDKTM 1.2. JDKTM 1.1 writes *STREAM\_PROTOCOL\_1*.
>
>
> The flag *SC\_SERIALIZABLE* is set if the class that wrote the stream extended `java.io.Serializable` but not `java.io.Externalizable`, the class reading the stream must also extend `java.io.Serializable` and the default serialization mechanism is to be used.
>
>
> The flag *SC\_EXTERNALIZABLE* is set if the class that wrote the stream extended `java.io.Externalizable`, the class reading the data must also extend `Externalizable` and the data will be read using its `writeExternal` and `readExternal` methods.
>
>
> The flag *SC\_ENUM* is set if the class that wrote the stream was an enum type. The receiver's corresponding class must also be an enum type. Data for constants of the enum type will be written and read as described in [Section 1.12, "Serialization of Enum Constants](serial-arch.html#6469)".

#### *Example*

> Consider the case of an original class and two instances in a linked list:
>
>
> ```
> class List implements java.io.Serializable {
>     int value;
>     List next;
>     public static void main(String[] args) {
>         try {
>             List list1 = new List();
>             List list2 = new List();
>             list1.value = 17;
>             list1.next = list2;
>             list2.value = 19;
>             list2.next = null;
>
>             ByteArrayOutputStream o = new ByteArrayOutputStream();
>             ObjectOutputStream out = new ObjectOutputStream(o);
>             out.writeObject(list1);
>             out.writeObject(list2);
>             out.flush();
>             ...
>         } catch (Exception ex) {
>             ex.printStackTrace();
>         }
>     }
> }
>
> ```
>
> The resulting stream contains:
>
>
> ```
> 00: ac ed 00 05 73 72 00 04 4c 69 73 74 69 c8 8a 15 >....sr..Listi...<
>
> ```
> ```
> 10: 40 16 ae 68 02 00 02 49 00 05 76 61 6c 75 65 4c >Z......I..valueL<
>
> ```
> ```
> 20: 00 04 6e 65 78 74 74 00 06 4c 4c 69 73 74 3b 78 >..nextt..LList;x<
>
> ```
> ```
> 30: 70 00 00 00 11 73 71 00 7e 00 00 00 00 00 13 70 >p....sq.~......p<
>
> ```
> ```
> 40: 71 00 7e 00 03                                  >q.~..<
>
> ```
> ```
>
>
> ```

---

 [CONTENTS](serialTOC.html) | [PREV](version.html)
| [NEXT](security.html)

---

*[Copyright](../../../legal/SMICopyright.html) © 2005, 2010, Oracle and/or its affiliates. All rights reserved.*



=== Content from github.com_01337486_20250111_030842.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Freleases%2Ftag%2Fv0.27.0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Freleases%2Ftag%2Fv0.27.0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=TeamNewPipe%2FNewPipe)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TeamNewPipe](/TeamNewPipe)
/
**[NewPipe](/TeamNewPipe/NewPipe)**
Public

* [Notifications](/login?return_to=%2FTeamNewPipe%2FNewPipe) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2FTeamNewPipe%2FNewPipe)
* [Star
   32.2k](/login?return_to=%2FTeamNewPipe%2FNewPipe)

* [Code](/TeamNewPipe/NewPipe/tree/v0.27.0)
* [Issues
  1.2k](/TeamNewPipe/NewPipe/issues)
* [Pull requests
  14](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects
  2](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

Additional navigation options

* [Code](/TeamNewPipe/NewPipe/tree/v0.27.0)
* [Issues](/TeamNewPipe/NewPipe/issues)
* [Pull requests](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

1. [Releases](/TeamNewPipe/NewPipe/releases)
2. [v0.27.0](/TeamNewPipe/NewPipe/releases/tag/v0.27.0)

# v0.27.0

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/TeamNewPipe/NewPipe/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...v0.27.0)

 Loading

[View all tags](/TeamNewPipe/NewPipe/tags)

![@Stypox](https://avatars.githubusercontent.com/u/36421898?s=40&v=4)
[Stypox](/Stypox)
released this
23 Apr 20:45

·
[136 commits](/TeamNewPipe/NewPipe/compare/v0.27.0...master)
to master
since this release

[v0.27.0](/TeamNewPipe/NewPipe/tree/v0.27.0)

[`9828586`](/TeamNewPipe/NewPipe/commit/9828586762997ef1d0ada61cf8a8cd42c0f18800)

This commit was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/36421898?s=64&v=4)](/Stypox)
[Stypox](/Stypox)
Stypox

GPG key ID: 4BDF1B40A49FDD23

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits).

## ⚠️ Important fixes ⚠️

* [YouTube] Fix extraction of comments [TeamNewPipe/NewPipeExtractor#1163](https://github.com/TeamNewPipe/NewPipeExtractor/pull/1163)

  The issue happened because YouTube changed the response of comments. Note that this response doesn't return an exact like count for comments for comments with more than 999 likes, only approximate like counts.

  ℹ️ Third-party social links in descriptions and comments are now showing the accessibility text of YouTube, which is in the form `Social media name: YouTube preview text` instead of just YouTube's preview text.
* [YouTube] Restore access to some streams [TeamNewPipe/NewPipeExtractor#1168](https://github.com/TeamNewPipe/NewPipeExtractor/pull/1168)

  These streams are the audio streams with an average bitrate around 32 and 48 kbps (itags 139, 599, 600) and the 720p MPEG-4 muxed (video + audio) video stream on videos with musical contents (itag 22, on other contents it was still available). Note that they are not returned by YouTube on every video depending on multiple factors and they currently come from the Android YouTube app client that we use.

  Unfortunately, this client has now several integrity checks very hard or almost impossible to implement as a third-party client that we used to workaround before. The workaround shipped until 0.26.1 has been disabled by YouTube (the same one used previously by reVanced for non-root users), and the one shipped in this release is being disabled (A/B test or rollout).

  **These streams should become completely unavailable in the future and may be fully or partially restored in a future NewPipe update.**
* Fix vulnerability when importing backups [GHSA-wxrm-jhpf-vp6v](https://github.com/TeamNewPipe/NewPipe/security/advisories/GHSA-wxrm-jhpf-vp6v "GHSA-wxrm-jhpf-vp6v")

  There is now a new format for settings stored in backups.

  The old patched format is still supported alongside the new format for backwards compatibility, but will soon be removed completely. NewPipe will show a warning when importing settings in the old format.

  **Avoid importing any backup from an untrusted source (e.g. a GitHub issue) if it shows this warning!**

## ⚠️ Known issues/regressions which are not fixed with this update ⚠️

**DO NOT OPEN NEW ISSUES FOR THEM BUT FOLLOW THE LINKED ONES INSTEAD!**

* [YouTube] Avatars, banners and subscriber count are unavailable on channels sometimes: a YouTube A/B test or rollout changes the channel header UI, which is currently unsupported by the extractor. See [#10826](https://github.com/TeamNewPipe/NewPipe/issues/10826) for more details.

## Changelog

This version also includes the changes from [NewPipe Extractor version v0.24.0](https://github.com/TeamNewPipe/NewPipeExtractor/releases/tag/v0.24.0).

### New

* Add support for comment replies [#10018](https://github.com/TeamNewPipe/NewPipe/pull/10018)
* Add playlist description to playlist fragment [#10091](https://github.com/TeamNewPipe/NewPipe/pull/10091)
* Add option to reset settings [#9236](https://github.com/TeamNewPipe/NewPipe/pull/9236)
* Show overall duration of items in a playlist [#6045](https://github.com/TeamNewPipe/NewPipe/pull/6045) [#10952](https://github.com/TeamNewPipe/NewPipe/pull/10952)
* Allow ordering bookmarked playlists [#8221](https://github.com/TeamNewPipe/NewPipe/pull/8221)

### Improved

* [Android 13+] Restore support of custom notification actions [#10712](https://github.com/TeamNewPipe/NewPipe/pull/10712)

  ⚠️ The first three notification actions (play/pause, previous and next) cannot be customized anymore on these Android versions, as they are set by the system ⚠️
* Allow playing/pausing from the notification when the player is buffering [#10712](https://github.com/TeamNewPipe/NewPipe/pull/10712)
* Added "free memory" check before downloading [#10505](https://github.com/TeamNewPipe/NewPipe/pull/10505) [#10896](https://github.com/TeamNewPipe/NewPipe/pull/10896) [#10992](https://github.com/TeamNewPipe/NewPipe/pull/10992)
* Change the landscape layout of list card item [#9975](https://github.com/TeamNewPipe/NewPipe/pull/9975)
* Ask for consent before checking for updates [#10790](https://github.com/TeamNewPipe/NewPipe/pull/10790)
* Moved player notification setting to notification section [#9580](https://github.com/TeamNewPipe/NewPipe/pull/9580)

### Fixed

* Don't write defaultFormat setting, use default value [#10732](https://github.com/TeamNewPipe/NewPipe/pull/10732)
* Calculate cache key based on info type instead of item type [#10717](https://github.com/TeamNewPipe/NewPipe/pull/10717)
* Fix not considering nullability when comparing `getAudioTrackType` [#10909](https://github.com/TeamNewPipe/NewPipe/pull/10909)
* Trim search string and remove duplicate records from the database [#8242](https://github.com/TeamNewPipe/NewPipe/pull/8242)
* Various download fixes [#10912](https://github.com/TeamNewPipe/NewPipe/pull/10912)
* Fix error if there is no avatar when reloading feed [#10957](https://github.com/TeamNewPipe/NewPipe/pull/10957)

### Localization and Documentation

* Update translations [#10890](https://github.com/TeamNewPipe/NewPipe/pull/10890)
* Use GitHub markdown to emphasise warning in README [#10724](https://github.com/TeamNewPipe/NewPipe/pull/10724)

### Development

* Update some AndroidX libraries and `compileSdk` to 34 [#10086](https://github.com/TeamNewPipe/NewPipe/pull/10086)
* Update miscellaneous libraries [#10530](https://github.com/TeamNewPipe/NewPipe/pull/10530)
* Update Matrix chat URL to new link [#10795](https://github.com/TeamNewPipe/NewPipe/pull/10795)
* Update jsoup to 1.17.2 [#10817](https://github.com/TeamNewPipe/NewPipe/pull/10817)
* Update GitHub Actions dependencies in workflows [#10740](https://github.com/TeamNewPipe/NewPipe/pull/10740)
* Fix typo in TextLinkifier.java [#10889](https://github.com/TeamNewPipe/NewPipe/pull/10889)
* Improve app signature check [#10618](https://github.com/TeamNewPipe/NewPipe/pull/10618)
* Update workflows to use Node 20 [#10908](https://github.com/TeamNewPipe/NewPipe/pull/10908)
* `BaseDescriptionFragment`: Assert member is initialized [#10781](https://github.com/TeamNewPipe/NewPipe/pull/10781)

 Assets
3

 Loading

 👍
203
 MrMariU, crok, deth69, rwp0, henriqueffc, ivorget, scharmach, shadergz, Broukmiken, arrufat, and 193 more reacted with thumbs up emoji
 😄
28
 prasetyodedy, shadergz, NielSync, brnwlshubh, maxkorsov, AvenCores, JakeCoyne22, MidlajYH, abusen333, firengate, and 18 more reacted with laugh emoji
 🎉
64
 arrufat, zestygrass, roland-5, bew, toi500, ElSamhaa, Furocious, NielSync, QuestioningEspecialy, c-shubh, and 54 more reacted with hooray emoji
 ❤️
95
 MrMariU, deth69, rwp0, josphh, looser71, kylechui, Denio-7, UIUXGuy, Wojtaz0w, engeir, and 85 more reacted with heart emoji
 🚀
41
 leynier, senolfndk, FrostyNick, roland-5, toi500, ElSamhaa, pk6000, COBACH8, NielSync, IRHM, and 31 more reacted with rocket emoji
 👀
17
 Paxsenix0, maxkorsov, AvenCores, MidlajYH, firengate, Aryan-Chauhan, doomrunningonyomamma, LeoLevinr, LuisAlfredo92, praharaj-ashutosh, and 7 more reacted with eyes emoji

All reactions

* 👍
  203 reactions
* 😄
  28 reactions
* 🎉
  64 reactions
* ❤️
  95 reactions
* 🚀
  41 reactions
* 👀
  17 reactions

 278 people reacted

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_18d3be04_20250111_030843.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Fsecurity%2Fadvisories%2FGHSA-wxrm-jhpf-vp6v)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FTeamNewPipe%2FNewPipe%2Fsecurity%2Fadvisories%2FGHSA-wxrm-jhpf-vp6v)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=TeamNewPipe%2FNewPipe)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[TeamNewPipe](/TeamNewPipe)
/
**[NewPipe](/TeamNewPipe/NewPipe)**
Public

* [Notifications](/login?return_to=%2FTeamNewPipe%2FNewPipe) You must be signed in to change notification settings
* [Fork
  3.1k](/login?return_to=%2FTeamNewPipe%2FNewPipe)
* [Star
   32.2k](/login?return_to=%2FTeamNewPipe%2FNewPipe)

* [Code](/TeamNewPipe/NewPipe)
* [Issues
  1.2k](/TeamNewPipe/NewPipe/issues)
* [Pull requests
  14](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects
  2](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

Additional navigation options

* [Code](/TeamNewPipe/NewPipe)
* [Issues](/TeamNewPipe/NewPipe/issues)
* [Pull requests](/TeamNewPipe/NewPipe/pulls)
* [Discussions](/TeamNewPipe/NewPipe/discussions)
* [Actions](/TeamNewPipe/NewPipe/actions)
* [Projects](/TeamNewPipe/NewPipe/projects)
* [Wiki](/TeamNewPipe/NewPipe/wiki)
* [Security](/TeamNewPipe/NewPipe/security)
* [Insights](/TeamNewPipe/NewPipe/pulse)

# Importing malicious backups can result in arbitrary code execution

High

[Stypox](/Stypox)
published
GHSA-wxrm-jhpf-vp6v
Apr 24, 2024

## Package

org.schabi.newpipe
(Java)

## Affected versions

>= 0.13.4 and < 0.27.0

## Patched versions

>= 0.27.0

## Description

## Summary and impact

NewPipe is an Android app written in Java. It supports exporting and importing backups, as a way to let users move their data to a new device effortlessly. However, in versions up to NewPipe 0.26.1, importing a backup file from an untrusted source could have resulted in *Arbitrary Code Execution*. This is because backups are serialized/deserialized using [*Java's Object Serialization Stream Protocol*](https://docs.oracle.com/javase/6/docs/platform/serialization/spec/protocol.html), which can allow constructing any class in the app, unless properly restricted.

To exploit this vulnerability, an attacker would need to build a backup file containing the exploit, and then persuade a user into importing it. During the import process, the malicious code would be executed, possibly crashing the app, stealing user data from the NewPipe app, performing nasty actions through Android APIs, and attempting Android JVM/Sandbox escapes through vulnerabilities in the Android OS.

The attack can take place only if the user imports a malicious backup file, so an attacker would need to trick a user into importing a backup file from a source they can control. The implementation details of the malicious backup file can be independent of the attacked user or the device they are being run on, and do not require additional privileges.

## Affected versions and remediation options

All NewPipe versions from 0.13.4 to **0.26.1** are **vulnerable**.

NewPipe version **0.27.0** fixes the issue by doing the following:

* Restrict the classes that can be deserialized when calling *Java's Object Serialization Stream Protocol*, by adding a whitelist with only innocuous data-only classes that can't lead to *Abitrary Code Execution*: `Boolean`, `Byte`, `Character`, `Short`, `Integer`, `Long`, `Float`, `Double`, `Void`, `HashMap`, `HashSet` (see [cmu.edu](https://wiki.sei.cmu.edu/confluence/display/java/SER00-J.%2BEnable%2Bserialization%2Bcompatibility%2Bduring%2Bclass%2Bevolution), [OWASP cheatsheet](https://cheatsheetseries.owasp.org/cheatsheets/Deserialization_Cheat_Sheet.html#harden-your-own-javaioobjectinputstream) and [Apache's `ValidatingObjectInputStream`](https://commons.apache.org/proper/commons-io/apidocs/src-html/org/apache/commons/io/serialization/ValidatingObjectInputStream.html#line-118) )
* Deprecate backups serialized with *Java's Object Serialization Stream Protocol*
* Use *JSON* serialization for all newly created backups (but still include an alternative file serialized with *Java's Object Serialization Stream Protocol* in the backup zip for backwards compatibility)
* Show a warning to the user when attempting to import a backup where the only available serialization mode is *Java's Object Serialization Stream Protocol* (note that in the future this serialization mode will be removed completely)

## More details

NewPipe backups are a `.zip` with two files:

* SQLite database (not relevant for this vulnerability)
* settings (an exploit can be embedded here)

During the import process, an `ObjectInputStream` object is used to deserialize the contents of the settings file ([see the code](https://github.com/TeamNewPipe/NewPipe/blob/v0.26.1/app/src/main/java/org/schabi/newpipe/settings/ContentSettingsManager.kt#L80)). In order for the vulnerability to be exploited, the attacker needs to find a class that allows code execution when deserialized. Note that the attacker cannot define a custom Java class within the settings file for this purpose, because Android DEX doesn't allow creating classes at runtime.

The reporter [@litetex](https://github.com/litetex) provided a *Proof of Concept* of the exploit, with a malicious backup that runs `System.exit(1337)` when imported.

## CVSS score

The potential CVSS score would be [8.5 (High)](https://chandanbn.github.io/cvss/#CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:L). Here is a breakdown according to <https://www.first.org/cvss/v3.1/user-guide#Scoring-Rubrics> :

| Category | Value | Why? |
| --- | --- | --- |
| Attack vector | Local | The user needs to be tricked into importing the malicious settings |
| Attack complexity | Low | No special conditions exists, the attack works repeatably |
| User interaction | Required | The user needs to be tricked into importing the malicious settings |
| Privileges Required | None | - |
| Scope | Changed | The exploit can be used to gain further access / run any code |
| Confidentiality | High | All resources of NewPipe can be modified or stolen |
| Integrity | High | All resources of NewPipe can be modified or stolen |
| Availability | Low | An attacker can crash the app once |

## Credits

All credits for the discovery of this vulnerability go to [@litetex](https://github.com/litetex), who also provided a *Proof of Concept* exploit to the NewPipe team and an initial fix attempt in [#9887](https://github.com/TeamNewPipe/NewPipe/pull/9887). The final fix for the vulnerability was provided by [@Stypox](https://github.com/Stypox) along with the help of the NewPipe team.

### Severity

High

8.5

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Local

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Changed

Confidentiality
High

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:L/AC:L/PR:N/UI:R/S:C/C:H/I:H/A:L

### CVE ID

CVE-2024-32876

### Weaknesses

[CWE-502](/advisories?query=cwe%3A502)

### Credits

* [![@litetex](https://avatars.githubusercontent.com/u/40789489?s=40&v=4)](/litetex)
  [litetex](/litetex)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


