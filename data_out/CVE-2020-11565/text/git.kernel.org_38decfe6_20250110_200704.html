

| [cgit logo](/) | [index](/) : [kernel/git/torvalds/linux.git](/pub/scm/linux/kernel/git/torvalds/linux.git/) | for-next master vsnprintf |
| --- | --- | --- |
| Linux kernel source tree | Linus Torvalds |

| [about](/pub/scm/linux/kernel/git/torvalds/linux.git/about/)[summary](/pub/scm/linux/kernel/git/torvalds/linux.git/)[refs](/pub/scm/linux/kernel/git/torvalds/linux.git/refs/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)[log](/pub/scm/linux/kernel/git/torvalds/linux.git/log/)[tree](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)[commit](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)[diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)[stats](/pub/scm/linux/kernel/git/torvalds/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Randy Dunlap <rdunlap@infradead.org> | 2020-04-01 21:10:58 -0700 |
| --- | --- | --- |
| committer | Linus Torvalds <torvalds@linux-foundation.org> | 2020-04-02 09:35:32 -0700 |
| commit | [aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd) ([patch](/pub/scm/linux/kernel/git/torvalds/linux.git/patch/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)) | |
| tree | [68c1de97cf7b4653313a39427c5ad63a05f9dacc](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd) | |
| parent | [d888fb2b189be07df1656a31930b11a62ae88e58](/pub/scm/linux/kernel/git/torvalds/linux.git/commit/?id=d888fb2b189be07df1656a31930b11a62ae88e58) ([diff](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd&id2=d888fb2b189be07df1656a31930b11a62ae88e58)) | |
| download | [linux-aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd.tar.gz](/pub/scm/linux/kernel/git/torvalds/linux.git/snapshot/linux-aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd.tar.gz) | |

mm: mempolicy: require at least one nodeid for MPOL\_PREFERREDUsing an empty (malformed) nodelist that is not caught during mount option
parsing leads to a stack-out-of-bounds access.
The option string that was used was: "mpol=prefer:,". However,
MPOL\_PREFERRED requires a single node number, which is not being provided
here.
Add a check that 'nodes' is not empty after parsing for MPOL\_PREFERRED's
nodeid.
Fixes: 095f1fc4ebf3 ("mempolicy: rework shmem mpol parsing and display")
Reported-by: Entropy Moe <3ntr0py1337@gmail.com>
Reported-by: syzbot+b055b1a6b2b958707a21@syzkaller.appspotmail.com
Signed-off-by: Randy Dunlap <rdunlap@infradead.org>
Signed-off-by: Andrew Morton <akpm@linux-foundation.org>
Tested-by: syzbot+b055b1a6b2b958707a21@syzkaller.appspotmail.com
Cc: Lee Schermerhorn <lee.schermerhorn@hp.com>
Link: [http://lkml.kernel.org/r/89526377-7eb6-b662-e1d8-4430928abde9@infradead.org](http://lkml.kernel.org/r/89526377-7eb6-b662-e1d8-4430928abde9%40infradead.org)
Signed-off-by: Linus Torvalds <torvalds@linux-foundation.org>
[Diffstat](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)

| -rw-r--r-- | [mm/mempolicy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/diff/mm/mempolicy.c?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/mm/mempolicy.c b/mm/mempolicy.cindex 460683bbe58c84..5fb427aed61279 100644--- a/[mm/mempolicy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/mempolicy.c?id=d888fb2b189be07df1656a31930b11a62ae88e58)+++ b/[mm/mempolicy.c](/pub/scm/linux/kernel/git/torvalds/linux.git/tree/mm/mempolicy.c?id=aa9f7d5172fac9bf1f09e678c35e287a40a7b7dd)@@ -2898,7 +2898,9 @@ int mpol\_parse\_str(char \*str, struct mempolicy \*\*mpol) switch (mode) { case MPOL\_PREFERRED: /\*- \* Insist on a nodelist of one node only+ \* Insist on a nodelist of one node only, although later+ \* we use first\_node(nodes) to grab a single node, so here+ \* nodelist (or nodes) cannot be empty. \*/ if (nodelist) { char \*rest = nodelist;@@ -2906,6 +2908,8 @@ int mpol\_parse\_str(char \*str, struct mempolicy \*\*mpol) rest++; if (\*rest) goto out;+ if (nodes\_empty(nodes))+ goto out; } break; case MPOL\_INTERLEAVE: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:05:41 +0000

