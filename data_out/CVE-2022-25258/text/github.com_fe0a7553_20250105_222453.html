
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fszymonh%2Fd-os-descriptor)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fszymonh%2Fd-os-descriptor)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=szymonh%2Fd-os-descriptor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[szymonh](/szymonh)
/
**[d-os-descriptor](/szymonh/d-os-descriptor)**
Public

* [Notifications](/login?return_to=%2Fszymonh%2Fd-os-descriptor) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fszymonh%2Fd-os-descriptor)
* [Star
   0](/login?return_to=%2Fszymonh%2Fd-os-descriptor)

CVE-2022-25258 - Demo exploit targeting usb gadget's os descriptor handler

### License

[GPL-3.0 license](/szymonh/d-os-descriptor/blob/main/LICENSE)

[0
stars](/szymonh/d-os-descriptor/stargazers) [0
forks](/szymonh/d-os-descriptor/forks) [Branches](/szymonh/d-os-descriptor/branches) [Tags](/szymonh/d-os-descriptor/tags) [Activity](/szymonh/d-os-descriptor/activity)
 [Star](/login?return_to=%2Fszymonh%2Fd-os-descriptor)

 [Notifications](/login?return_to=%2Fszymonh%2Fd-os-descriptor) You must be signed in to change notification settings

* [Code](/szymonh/d-os-descriptor)
* [Issues
  0](/szymonh/d-os-descriptor/issues)
* [Pull requests
  0](/szymonh/d-os-descriptor/pulls)
* [Actions](/szymonh/d-os-descriptor/actions)
* [Projects
  0](/szymonh/d-os-descriptor/projects)
* [Security](/szymonh/d-os-descriptor/security)
* [Insights](/szymonh/d-os-descriptor/pulse)

Additional navigation options

* [Code](/szymonh/d-os-descriptor)
* [Issues](/szymonh/d-os-descriptor/issues)
* [Pull requests](/szymonh/d-os-descriptor/pulls)
* [Actions](/szymonh/d-os-descriptor/actions)
* [Projects](/szymonh/d-os-descriptor/projects)
* [Security](/szymonh/d-os-descriptor/security)
* [Insights](/szymonh/d-os-descriptor/pulse)

# szymonh/d-os-descriptor

    main[Branches](/szymonh/d-os-descriptor/branches)[Tags](/szymonh/d-os-descriptor/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[3 Commits](/szymonh/d-os-descriptor/commits/main/) | | |
| [.gitignore](/szymonh/d-os-descriptor/blob/main/.gitignore ".gitignore") | | [.gitignore](/szymonh/d-os-descriptor/blob/main/.gitignore ".gitignore") |  |  |
| [LICENSE](/szymonh/d-os-descriptor/blob/main/LICENSE "LICENSE") | | [LICENSE](/szymonh/d-os-descriptor/blob/main/LICENSE "LICENSE") |  |  |
| [README.md](/szymonh/d-os-descriptor/blob/main/README.md "README.md") | | [README.md](/szymonh/d-os-descriptor/blob/main/README.md "README.md") |  |  |
| [dos\_descriptor.py](/szymonh/d-os-descriptor/blob/main/dos_descriptor.py "dos_descriptor.py") | | [dos\_descriptor.py](/szymonh/d-os-descriptor/blob/main/dos_descriptor.py "dos_descriptor.py") |  |  |
| View all files | | |

## Repository files navigation

* README
* GPL-3.0 license
# d-os-descriptor

## Summary

The USB Gadget Subsystem includes security issues in the OS descriptor handling
section of composite\_setup function (composite.c). Processing of properly
crafted control transfer request messages result in device crash due to null
pointer dereference or memory corruption.

## Description

The OS descriptor handling section of composite\_setup for interface recipient
is implemented as follows.

```
case USB_RECIP_INTERFACE:
    if (w_index != 0x5 || (w_value >> 8))
        break;
    interface = w_value & 0xFF;
    buf[6] = w_index;
    count = count_ext_prop(os_desc_cfg,
        interface);
    put_unaligned_le16(count, buf + 8);
    count = len_ext_prop(os_desc_cfg,
        interface);
    put_unaligned_le32(count, buf);
    value = w_length;
    if (w_length > 0x0A) {
        value = fill_ext_prop(os_desc_cfg,
                        interface, buf);
        if (value >= 0)
            value = min_t(u16, w_length, value);
}
break;

```

The interface variable is derived from w\_value and later utilized to index usb\_configuration->interface array
in count\_ext\_prop, len\_ext\_prop and fill\_ext\_prop functions. Since c->interface array has the size of
MAX\_CONFIG\_INTERFACES (16) elements and interface variable is not validated in neither composite\_setup's
OS descriptor handling section nor the called functions this allows an attacker to index the c->interface array
past the actual boundaries. In case interface variable has a value greater or equal to MAX\_CONFIG\_INTERFACES the
endpoint should be stalled.

In certain cases, depending on actual memory content indexing past c->interface array may trigger buffer overflow
of req->buf via fill\_ext\_prop when wLength is greater than 0x0A. If sum of ext\_prop->name\_len, ext\_prop->data\_len,
14 and 10 overflows int the count + n >= USB\_COMP\_EP0\_OS\_DESC\_BUFSIZ condition would not be met allowing overflow
via memcpy in usb\_ext\_prop\_put\_binary. Yet the probability of such situation seems pretty low.

Furthermore the functions count\_ext\_prop, len\_ext\_prop and fill\_ext\_prop are missing validation if the \*usb\_function
retrieved from c->interface array is actually valid resulting in null pointer dereference. When the retrieved
usb\_function pointer is null the endpoint should be stalled.

```
static int count_ext_prop(struct usb_configuration *c, int interface)
{
	struct usb_function *f;
	int j;

	f = c->interface[interface];
	for (j = 0; j < f->os_desc_n; ++j) {
		struct usb_os_desc *d;

	    if (interface != f->os_desc_table[j].if_id)
	    	continue;
	    d = f->os_desc_table[j].os_desc;
	    if (d && d->ext_compat_id)
	    	return d->ext_prop_count;
    }
return 0;
}

```

## Impact

Linux (and Android) devices exposing usb gadgets with OS descriptor support
may be arbitrarily crashed by a malicious host by means of a single control
transfer message.

## CVE

[CVE-2022-25258](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-25258)

## Patch

A patch addressing the described issue was accepted and is now available in
supported kernel versions. For more information consult the below link.

[USB: gadget: validate interface OS descriptor requests](https://github.com/torvalds/linux/commit/75e5b4849b81e19e9efe1654b30d7f3151c33c2c)

## About

CVE-2022-25258 - Demo exploit targeting usb gadget's os descriptor handler

### Resources

[Readme](#readme-ov-file)
### License

[GPL-3.0 license](#GPL-3.0-1-ov-file)

[Activity](/szymonh/d-os-descriptor/activity)
### Stars

[**0**
stars](/szymonh/d-os-descriptor/stargazers)
### Watchers

[**2**
watching](/szymonh/d-os-descriptor/watchers)
### Forks

[**0**
forks](/szymonh/d-os-descriptor/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fszymonh%2Fd-os-descriptor&report=szymonh+%28user%29)

## [Releases](/szymonh/d-os-descriptor/releases)

No releases published

## [Packages 0](/users/szymonh/packages?repo_name=d-os-descriptor)

No packages published

## Languages

* [Python
  100.0%](/szymonh/d-os-descriptor/search?l=python)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

