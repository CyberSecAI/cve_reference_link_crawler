=== Content from git.kernel.org_519cde70_20250110_203328.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 11:40:47 +0200 |
| commit | [0d60c43df59ef01c08dc7b0c45495178f9d05a13](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)) | |
| tree | [c4b30f7e7e34c186aed27b6e12cf0dac0c983cc6](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13) | |
| parent | [34b0536965417a0468042c6a3106c35f21c604f2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=34b0536965417a0468042c6a3106c35f21c604f2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13&id2=34b0536965417a0468042c6a3106c35f21c604f2)) | |
| download | [linux-0d60c43df59ef01c08dc7b0c45495178f9d05a13.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0d60c43df59ef01c08dc7b0c45495178f9d05a13.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex ccf49faedebf85..3fca560087c97f 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=34b0536965417a0468042c6a3106c35f21c604f2)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)@@ -244,7 +244,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex 8e1651d6a61faf..04e6090cce5950 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=34b0536965417a0468042c6a3106c35f21c604f2)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)@@ -97,7 +97,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_switch\_vm(struct lima\_ip \*ip, struct lima\_vm \*vm)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex 8fef224b93c856..1dacca8bffe1aa 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=34b0536965417a0468042c6a3106c35f21c604f2)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=0d60c43df59ef01c08dc7b0c45495178f9d05a13)@@ -251,7 +251,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_init(struct lima\_ip \*ip)@@ -272,7 +274,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:05 +0000



=== Content from git.kernel.org_e10ae509_20250110_203329.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:07:26 +0200 |
| commit | [17fe8b75aaf0bb1bdc31368963446b421c22d0af](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)) | |
| tree | [eac77ba3e7e0b333d2c2c9c06a59eb00438f13ad](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af) | |
| parent | [e8053aa2ecc4784311cfdc971c4c58ea1d8edcab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e8053aa2ecc4784311cfdc971c4c58ea1d8edcab) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af&id2=e8053aa2ecc4784311cfdc971c4c58ea1d8edcab)) | |
| download | [linux-17fe8b75aaf0bb1bdc31368963446b421c22d0af.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-17fe8b75aaf0bb1bdc31368963446b421c22d0af.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex 6cf46b653e810f..ca3842f719842e 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=e8053aa2ecc4784311cfdc971c4c58ea1d8edcab)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)@@ -324,7 +324,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex a1ae6c252dc2b5..8ca7047adbaca9 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=e8053aa2ecc4784311cfdc971c4c58ea1d8edcab)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex 54b208a4a768e4..d34c9e8840f454 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=e8053aa2ecc4784311cfdc971c4c58ea1d8edcab)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=17fe8b75aaf0bb1bdc31368963446b421c22d0af)@@ -266,7 +266,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -299,7 +301,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:06 +0000



=== Content from git.kernel.org_85797dc5_20250110_203331.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-11 12:50:56 +0200 |
| commit | [b5daf9217a50636a969bc1965f827878aeb09ffe](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b5daf9217a50636a969bc1965f827878aeb09ffe) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)) | |
| tree | [f40398d0c600b2d4267232bcb612a7f62ececa88](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b5daf9217a50636a969bc1965f827878aeb09ffe) | |
| parent | [e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5daf9217a50636a969bc1965f827878aeb09ffe&id2=e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3)) | |
| download | [linux-b5daf9217a50636a969bc1965f827878aeb09ffe.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b5daf9217a50636a969bc1965f827878aeb09ffe.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b5daf9217a50636a969bc1965f827878aeb09ffe)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex e15295071533b5..3282997a0358df 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe)@@ -345,7 +345,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex e18317c5ca8c19..6611e2836bf0dd 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex a4a2ffe6527c2c..eaab4788dff494 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=e0a2d2df9ba7bd6bd7e0a9b6a5e3894f7e8445b3)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=b5daf9217a50636a969bc1965f827878aeb09ffe)@@ -286,7 +286,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -319,7 +321,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:08 +0000



=== Content from git.kernel.org_ff79ffd6_20250110_203330.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Qiang Yu <yuq825@gmail.com> | 2024-04-15 09:06:18 +0800 |
| commit | [a6683c690bbfd1f371510cb051e8fa49507f3f5e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)) | |
| tree | [adb26c314c2aba49d0f1834f409bbd694ece475f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e) | |
| parent | [a421cc7a6a001b70415aa4f66024fa6178885a14](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a421cc7a6a001b70415aa4f66024fa6178885a14) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e&id2=a421cc7a6a001b70415aa4f66024fa6178885a14)) | |
| download | [linux-a6683c690bbfd1f371510cb051e8fa49507f3f5e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-a6683c690bbfd1f371510cb051e8fa49507f3f5e.tar.gz) | |

drm/lima: fix shared irq handling on driver removelima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex e15295071533b5..3282997a0358df 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=a421cc7a6a001b70415aa4f66024fa6178885a14)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)@@ -345,7 +345,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex e18317c5ca8c19..6611e2836bf0dd 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=a421cc7a6a001b70415aa4f66024fa6178885a14)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex a4a2ffe6527c2c..eaab4788dff494 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=a421cc7a6a001b70415aa4f66024fa6178885a14)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=a6683c690bbfd1f371510cb051e8fa49507f3f5e)@@ -286,7 +286,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -319,7 +321,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:07 +0000



=== Content from git.kernel.org_1175d365_20250110_203327.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=04d531b9a1875846d4f89953b469ad463aa7a770)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=04d531b9a1875846d4f89953b469ad463aa7a770)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=04d531b9a1875846d4f89953b469ad463aa7a770)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04d531b9a1875846d4f89953b469ad463aa7a770)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-11 12:49:03 +0200 |
| commit | [04d531b9a1875846d4f89953b469ad463aa7a770](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=04d531b9a1875846d4f89953b469ad463aa7a770) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=04d531b9a1875846d4f89953b469ad463aa7a770)) | |
| tree | [bb6dedbfe58be6af8a8940a29dd83cef001f8c25](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=04d531b9a1875846d4f89953b469ad463aa7a770) | |
| parent | [7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04d531b9a1875846d4f89953b469ad463aa7a770&id2=7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e)) | |
| download | [linux-04d531b9a1875846d4f89953b469ad463aa7a770.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-04d531b9a1875846d4f89953b469ad463aa7a770.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=04d531b9a1875846d4f89953b469ad463aa7a770)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=04d531b9a1875846d4f89953b469ad463aa7a770) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=04d531b9a1875846d4f89953b469ad463aa7a770) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=04d531b9a1875846d4f89953b469ad463aa7a770) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex 6cf46b653e810f..ca3842f719842e 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=04d531b9a1875846d4f89953b469ad463aa7a770)@@ -324,7 +324,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex a1ae6c252dc2b5..8ca7047adbaca9 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=04d531b9a1875846d4f89953b469ad463aa7a770)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex 54b208a4a768e4..d34c9e8840f454 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=7fc8d9a525b5c3f8dfa5ed50901e764d8ede7e1e)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=04d531b9a1875846d4f89953b469ad463aa7a770)@@ -266,7 +266,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -299,7 +301,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:04 +0000



=== Content from git.kernel.org_7117d957_20250110_203330.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-18 13:05:38 +0200 |
| commit | [25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)) | |
| tree | [e7ed49739007bee21637181db2734213e76e0f66](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8) | |
| parent | [94ffdde326f507b1d71b42e0b6f92abeeefa8cd2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=94ffdde326f507b1d71b42e0b6f92abeeefa8cd2) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8&id2=94ffdde326f507b1d71b42e0b6f92abeeefa8cd2)) | |
| download | [linux-25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex 6cf46b653e810f..ca3842f719842e 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=94ffdde326f507b1d71b42e0b6f92abeeefa8cd2)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)@@ -324,7 +324,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex a1ae6c252dc2b5..8ca7047adbaca9 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=94ffdde326f507b1d71b42e0b6f92abeeefa8cd2)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex 54b208a4a768e4..d34c9e8840f454 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=94ffdde326f507b1d71b42e0b6f92abeeefa8cd2)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=25d0d9b83d855cbc5d5aa5ae3cd79d55ea0c84a8)@@ -266,7 +266,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -299,7 +301,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:07 +0000



=== Content from git.kernel.org_97bf971d_20250110_203328.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Erico Nunes <nunes.erico@gmail.com> | 2024-04-02 00:43:28 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-11 12:47:05 +0200 |
| commit | [0a487e977cb8897ae4c51ecd34bbaa2b005266c9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)) | |
| tree | [5cee5018dedec5bd11fce1ed599a38e6ffb365c8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9) | |
| parent | [eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9&id2=eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c)) | |
| download | [linux-0a487e977cb8897ae4c51ecd34bbaa2b005266c9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0a487e977cb8897ae4c51ecd34bbaa2b005266c9.tar.gz) | |

drm/lima: fix shared irq handling on driver remove[ Upstream commit a6683c690bbfd1f371510cb051e8fa49507f3f5e ]
lima uses a shared interrupt, so the interrupt handlers must be prepared
to be called at any time. At driver removal time, the clocks are
disabled early and the interrupts stay registered until the very end of
the remove process due to the devm usage.
This is potentially a bug as the interrupts access device registers
which assumes clocks are enabled. A crash can be triggered by removing
the driver in a kernel with CONFIG\_DEBUG\_SHIRQ enabled.
This patch frees the interrupts at each lima device finishing callback
so that the handlers are already unregistered by the time we fully
disable clocks.
Signed-off-by: Erico Nunes <nunes.erico@gmail.com>
Signed-off-by: Qiang Yu <yuq825@gmail.com>
Link: [https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico@gmail.com](https://patchwork.freedesktop.org/patch/msgid/20240401224329.1228468-2-nunes.erico%40gmail.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)

| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_gp.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_mmu.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9) | 5 | |  |  |  | | --- | --- | --- | |
| -rw-r--r-- | [drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/lima/lima_pp.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9) | 4 | |  |  |  | | --- | --- | --- | |

3 files changed, 11 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/lima/lima\_gp.c b/drivers/gpu/drm/lima/lima\_gp.cindex 6cf46b653e810f..ca3842f719842e 100644--- a/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c)+++ b/[drivers/gpu/drm/lima/lima\_gp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_gp.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)@@ -324,7 +324,9 @@ int lima\_gp\_init(struct lima\_ip \*ip)  void lima\_gp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_gp\_pipe\_init(struct lima\_device \*dev)diff --git a/drivers/gpu/drm/lima/lima\_mmu.c b/drivers/gpu/drm/lima/lima\_mmu.cindex a1ae6c252dc2b5..8ca7047adbaca9 100644--- a/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c)+++ b/[drivers/gpu/drm/lima/lima\_mmu.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_mmu.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)@@ -118,7 +118,12 @@ int lima\_mmu\_init(struct lima\_ip \*ip)  void lima\_mmu\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev;++ if (ip->id == lima\_ip\_ppmmu\_bcast)+ return; + devm\_free\_irq(dev->dev, ip->irq, ip); }  void lima\_mmu\_flush\_tlb(struct lima\_ip \*ip)diff --git a/drivers/gpu/drm/lima/lima\_pp.c b/drivers/gpu/drm/lima/lima\_pp.cindex 54b208a4a768e4..d34c9e8840f454 100644--- a/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=eda60520cfe3aba9f088c68ebd5bcbca9fc6ac3c)+++ b/[drivers/gpu/drm/lima/lima\_pp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/lima/lima_pp.c?id=0a487e977cb8897ae4c51ecd34bbaa2b005266c9)@@ -266,7 +266,9 @@ int lima\_pp\_init(struct lima\_ip \*ip)  void lima\_pp\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  int lima\_pp\_bcast\_resume(struct lima\_ip \*ip)@@ -299,7 +301,9 @@ int lima\_pp\_bcast\_init(struct lima\_ip \*ip)  void lima\_pp\_bcast\_fini(struct lima\_ip \*ip) {+ struct lima\_device \*dev = ip->dev; + devm\_free\_irq(dev->dev, ip->irq, ip); }  static int lima\_pp\_task\_validate(struct lima\_sched\_pipe \*pipe, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:32:05 +0000


