

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jens Axboe <axboe@kernel.dk> | 2024-03-13 18:36:18 -0600 |
| --- | --- | --- |
| committer | Sasha Levin <sashal@kernel.org> | 2024-03-26 18:22:12 -0400 |
| commit | [cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)) | |
| tree | [8479b861a171582ef2673482bdae8a61050208bd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3) | |
| parent | [2692b8a01667275717b6737a0cbdf938c3018868](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2692b8a01667275717b6737a0cbdf938c3018868) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3&id2=2692b8a01667275717b6737a0cbdf938c3018868)) | |
| download | [linux-cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3.tar.gz) | |

io\_uring: drop any code related to SCM\_RIGHTSCommit 6e5e6d274956305f1fc0340522b38f5f5be74bdb upstream.
This is dead code after we dropped support for passing io\_uring fds
over SCM\_RIGHTS, get rid of it.
Signed-off-by: Jens Axboe <axboe@kernel.dk>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)

| -rw-r--r-- | [fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/io_uring.c?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3) | 47 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 44 deletions

| diff --git a/fs/io\_uring.c b/fs/io\_uring.cindex cd1858cc632069..2c793e4ccf096b 100644--- a/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=2692b8a01667275717b6737a0cbdf938c3018868)+++ b/[fs/io\_uring.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/io_uring.c?id=cfb24022bb2c31f1f555dc6bc3cc5e2547446fb3)@@ -63,7 +63,6 @@ #include <linux/net.h> #include <net/sock.h> #include <net/af\_unix.h>-#include <net/scm.h> #include <linux/anon\_inodes.h> #include <linux/sched/mm.h> #include <linux/uaccess.h>@@ -264,10 +263,6 @@ struct io\_ring\_ctx {  struct async\_list pending\_async[2]; -#if defined(CONFIG\_UNIX)- struct socket \*ring\_sock;-#endif- struct list\_head task\_list; spinlock\_t task\_lock; };@@ -3067,20 +3062,10 @@ static int io\_cqring\_wait(struct io\_ring\_ctx \*ctx, int min\_events,  static void \_\_io\_sqe\_files\_unregister(struct io\_ring\_ctx \*ctx) {-#if defined(CONFIG\_UNIX)- if (ctx->ring\_sock) {- struct sock \*sock = ctx->ring\_sock->sk;- struct sk\_buff \*skb;-- while ((skb = skb\_dequeue(&sock->sk\_receive\_queue)) != NULL)- kfree\_skb(skb);- }-#else int i;  for (i = 0; i < ctx->nr\_user\_files; i++) fput(ctx->user\_files[i]);-#endif }  static int io\_sqe\_files\_unregister(struct io\_ring\_ctx \*ctx)@@ -3575,13 +3560,6 @@ static void io\_ring\_ctx\_free(struct io\_ring\_ctx \*ctx) io\_sqe\_files\_unregister(ctx); io\_eventfd\_unregister(ctx); -#if defined(CONFIG\_UNIX)- if (ctx->ring\_sock) {- ctx->ring\_sock->file = NULL; /\* so that iput() is called \*/- sock\_release(ctx->ring\_sock);- }-#endif- io\_mem\_free(ctx->rings); io\_mem\_free(ctx->sq\_sqes); @@ -3833,45 +3811,26 @@ static int io\_allocate\_scq\_urings(struct io\_ring\_ctx \*ctx, /\* \* Allocate an anonymous fd, this is what constitutes the application \* visible backing of an io\_uring instance. The application mmaps this- \* fd to gain access to the SQ/CQ ring details. If UNIX sockets are enabled,- \* we have to tie this fd to a socket for file garbage collection purposes.+ \* fd to gain access to the SQ/CQ ring details. \*/ static int io\_uring\_get\_fd(struct io\_ring\_ctx \*ctx) { struct file \*file; int ret; -#if defined(CONFIG\_UNIX)- ret = sock\_create\_kern(&init\_net, PF\_UNIX, SOCK\_RAW, IPPROTO\_IP,- &ctx->ring\_sock);- if (ret)- return ret;-#endif- ret = get\_unused\_fd\_flags(O\_RDWR | O\_CLOEXEC); if (ret < 0)- goto err;+ return ret;  file = anon\_inode\_getfile("[io\_uring]", &io\_uring\_fops, ctx, O\_RDWR | O\_CLOEXEC); if (IS\_ERR(file)) { put\_unused\_fd(ret);- ret = PTR\_ERR(file);- goto err;+ return PTR\_ERR(file); } -#if defined(CONFIG\_UNIX)- ctx->ring\_sock->file = file;- ctx->ring\_sock->sk->sk\_user\_data = ctx;-#endif fd\_install(ret, file); return ret;-err:-#if defined(CONFIG\_UNIX)- sock\_release(ctx->ring\_sock);- ctx->ring\_sock = NULL;-#endif- return ret; }  static int io\_uring\_create(unsigned entries, struct io\_uring\_params \*p) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 22:32:39 +0000

