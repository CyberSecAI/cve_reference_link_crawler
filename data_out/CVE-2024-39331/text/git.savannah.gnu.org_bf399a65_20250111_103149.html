

| [cgit logo](/cgit/) | [index](/cgit/) : [emacs/org-mode.git](/cgit/emacs/org-mode.git/ "emacs/org-mode.git") | bugfix emacs-sync main |
| --- | --- | --- |
| Emacs Org mode |  |

| [summary](/cgit/emacs/org-mode.git/)[refs](/cgit/emacs/org-mode.git/refs/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)[log](/cgit/emacs/org-mode.git/log/)[tree](/cgit/emacs/org-mode.git/tree/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)[commit](/cgit/emacs/org-mode.git/commit/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)[diff](/cgit/emacs/org-mode.git/diff/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ihor Radchenko <yantar92@posteo.net> | 2024-06-18 13:06:44 +0200 |
| --- | --- | --- |
| committer | Ihor Radchenko <yantar92@posteo.net> | 2024-06-22 16:32:33 +0200 |
| commit | [f4cc61636947b5c2f0afc67174dd369fe3277aa8](/cgit/emacs/org-mode.git/commit/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8) ([patch](/cgit/emacs/org-mode.git/patch/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)) | |
| tree | [c6bd7dd0ba3e0bc4f2b4661bd7c9f415b55a0961](/cgit/emacs/org-mode.git/tree/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8) | |
| parent | [a4ff518a2eef3553295e110168a7b0eab942bfbf](/cgit/emacs/org-mode.git/commit/?id=a4ff518a2eef3553295e110168a7b0eab942bfbf) ([diff](/cgit/emacs/org-mode.git/diff/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8&id2=a4ff518a2eef3553295e110168a7b0eab942bfbf)) | |
| download | [org-mode-f4cc61636947b5c2f0afc67174dd369fe3277aa8.tar.gz](/cgit/emacs/org-mode.git/snapshot/org-mode-f4cc61636947b5c2f0afc67174dd369fe3277aa8.tar.gz) | |

org-link-expand-abbrev: Do not evaluate arbitrary unsafe Elisp code\* lisp/ol.el (org-link-expand-abbrev): Refuse expanding %(...) link
abbrevs that specify unsafe function. Instead, display a warning, and
do not expand the abbrev. Clear all the text properties from the
returned link, to avoid any potential vulnerabilities caused by
properties that may contain arbitrary Elisp.
[Diffstat](/cgit/emacs/org-mode.git/diff/?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)

| -rw-r--r-- | [lisp/ol.el](/cgit/emacs/org-mode.git/diff/lisp/ol.el?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8) | 40 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 29 insertions, 11 deletions

| diff --git a/lisp/ol.el b/lisp/ol.elindex 7a7f4f5..8a556c7 100644--- a/[lisp/ol.el](/cgit/emacs/org-mode.git/tree/lisp/ol.el?id=a4ff518a2eef3553295e110168a7b0eab942bfbf)+++ b/[lisp/ol.el](/cgit/emacs/org-mode.git/tree/lisp/ol.el?id=f4cc61636947b5c2f0afc67174dd369fe3277aa8)@@ -1152,17 +1152,35 @@ Abbreviations are defined in `org-link-abbrev-alist'." (if (not as) link (setq rpl (cdr as))- (cond- ((symbolp rpl) (funcall rpl tag))- ((string-match "%(\\([^)]+\\))" rpl)- (replace-match- (save-match-data- (funcall (intern-soft (match-string 1 rpl)) tag))- t t rpl))- ((string-match "%s" rpl) (replace-match (or tag "") t t rpl))- ((string-match "%h" rpl)- (replace-match (url-hexify-string (or tag "")) t t rpl))- (t (concat rpl tag)))))))+ ;; Drop any potentially dangerous text properties like+ ;; `modification-hooks' that may be used as an attack vector.+ (substring-no-properties+ (cond+ ((symbolp rpl) (funcall rpl tag))+ ((string-match "%(\\([^)]+\\))" rpl)+ (let ((rpl-fun-symbol (intern-soft (match-string 1 rpl))))+ ;; Using `unsafep-function' is not quite enough because+ ;; Emacs considers functions like `genenv' safe, while+ ;; they can potentially be used to expose private system+ ;; data to attacker if abbreviated link is clicked.+ (if (or (eq t (get rpl-fun-symbol 'org-link-abbrev-safe))+ (eq t (get rpl-fun-symbol 'pure)))+ (replace-match+ (save-match-data+ (funcall (intern-soft (match-string 1 rpl)) tag))+ t t rpl)+ (org-display-warning+ (format "Disabling unsafe link abbrev: %s+You may mark function safe via (put '%s 'org-link-abbrev-safe t)"+ rpl (match-string 1 rpl)))+ (setq org-link-abbrev-alist-local (delete as org-link-abbrev-alist-local)+ org-link-abbrev-alist (delete as org-link-abbrev-alist))+ link+ )))+ ((string-match "%s" rpl) (replace-match (or tag "") t t rpl))+ ((string-match "%h" rpl)+ (replace-match (url-hexify-string (or tag "")) t t rpl))+ (t (concat rpl tag))))))))  (defun org-link-open (link &optional arg) "Open a link object LINK. |
| --- |

generated by [cgit v1.1](https://git.zx2c4.com/cgit/about/) at 2025-01-11 10:31:49 +0000

