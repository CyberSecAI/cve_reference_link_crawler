=== Content from git.kernel.org_3e9f2285_20250111_104306.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:34:22 -0800 |
| commit | [9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)) | |
| tree | [9a78c1101c841713cbe96d580f89fb60f4a2f07b](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7) | |
| parent | [69c0b92f78a29ed8b3062fec962056e7bdb26079](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=69c0b92f78a29ed8b3062fec962056e7bdb26079) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7&id2=69c0b92f78a29ed8b3062fec962056e7bdb26079)) | |
| download | [linux-9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex 03fb4669a1f05a..23dc59e40edcd2 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=69c0b92f78a29ed8b3062fec962056e7bdb26079)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=9b5f03500bc5b083c0df696d7dd169d7ef3dd0c7)@@ -510,14 +510,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:43 +0000



=== Content from git.kernel.org_ccb3b5b5_20250111_104304.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:27:19 -0800 |
| commit | [026fd977dc50ff4a5e09bfb0603557f104d3f3a0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)) | |
| tree | [8dc0b07bd0f91fb1bc9be68810e357f5cdcc8806](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0) | |
| parent | [63df75d38342b5d7c16f7ea769d4d268e74c849e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=63df75d38342b5d7c16f7ea769d4d268e74c849e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0&id2=63df75d38342b5d7c16f7ea769d4d268e74c849e)) | |
| download | [linux-026fd977dc50ff4a5e09bfb0603557f104d3f3a0.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-026fd977dc50ff4a5e09bfb0603557f104d3f3a0.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex 2e3a317722a81d..051a777ba1b278 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=63df75d38342b5d7c16f7ea769d4d268e74c849e)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=026fd977dc50ff4a5e09bfb0603557f104d3f3a0)@@ -500,14 +500,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:41 +0000



=== Content from git.kernel.org_9443e2df_20250111_104308.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:33:31 -0800 |
| commit | [bb79613a9a704469ddb8d6c6029d532a5cea384c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)) | |
| tree | [05109c90281728f1db924cff917636f0df6360b4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c) | |
| parent | [fddcaa763b053c5c983907ed6c1a4a141e54f060](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=fddcaa763b053c5c983907ed6c1a4a141e54f060) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c&id2=fddcaa763b053c5c983907ed6c1a4a141e54f060)) | |
| download | [linux-bb79613a9a704469ddb8d6c6029d532a5cea384c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bb79613a9a704469ddb8d6c6029d532a5cea384c.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=bb79613a9a704469ddb8d6c6029d532a5cea384c) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex 93675a0b853b7f..2a26decef8b0ba 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=fddcaa763b053c5c983907ed6c1a4a141e54f060)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=bb79613a9a704469ddb8d6c6029d532a5cea384c)@@ -501,14 +501,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:45 +0000



=== Content from git.kernel.org_1ee5fd78_20250111_104307.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:37:39 -0800 |
| commit | [b582aa1f66411d4adcc1aa55b8c575683fb4687e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)) | |
| tree | [8b314f21f83848935cf730ecc454c0d6ad1da71c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e) | |
| parent | [f2ec41874b650028e7bc11ef44f18a5b4065843f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f2ec41874b650028e7bc11ef44f18a5b4065843f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e&id2=f2ec41874b650028e7bc11ef44f18a5b4065843f)) | |
| download | [linux-b582aa1f66411d4adcc1aa55b8c575683fb4687e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b582aa1f66411d4adcc1aa55b8c575683fb4687e.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex 0e602c3b01ea83..96dd82d63e9875 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=f2ec41874b650028e7bc11ef44f18a5b4065843f)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=b582aa1f66411d4adcc1aa55b8c575683fb4687e)@@ -495,14 +495,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:44 +0000



=== Content from git.kernel.org_2b1f488e_20250111_104308.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Michael Ellerman <mpe@ellerman.id.au> | 2023-12-01 21:15:33 +1100 |
| commit | [bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)) | |
| tree | [56627abd1b154f214957f56998db432702f062cf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5) | |
| parent | [4a74197b65e69c46fe6e53f7df2f4d6ce9ffe012](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4a74197b65e69c46fe6e53f7df2f4d6ce9ffe012) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5&id2=4a74197b65e69c46fe6e53f7df2f4d6ce9ffe012)) | |
| download | [linux-bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem arraydlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex a43bfb01720aef..6f2eebae7bee95 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=4a74197b65e69c46fe6e53f7df2f4d6ce9ffe012)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5)@@ -436,14 +436,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:46 +0000



=== Content from lists.debian.org_8e2a4762_20250111_104309.html ===


---

[[Date Prev](msg00015.html)][[Date Next](msg00017.html)]
[[Thread Prev](msg00015.html)][[Thread Next](msg00017.html)]
[[Date Index](maillist.html#00016)]
[[Thread Index](threads.html#00016)]

# [SECURITY] [DLA 3841-1] linux-5.10 security update

---

* *To*: debian-lts-announce@lists.debian.org
* *Subject*: [SECURITY] [DLA 3841-1] linux-5.10 security update
* *From*: Ben Hutchings <benh@debian.org>
* *Date*: Tue, 25 Jun 2024 21:41:14 +0200
* *Message-id*: <[[ðŸ”Ž]](/msgid-search/ZnsdWnKC38pb009r%40decadent.org.uk)Â [ZnsdWnKC38pb009r@decadent.org.uk](msg00016.html)>
* *Mail-followup-to*: debian-lts@lists.debian.org
* *Reply-to*: debian-lts@lists.debian.org

---

```
-------------------------------------------------------------------------
Debian LTS Advisory DLA-3841-1                debian-lts@lists.debian.org
<https://www.debian.org/lts/security/>                        Ben Hutchings
June 25, 2024                                 <https://wiki.debian.org/LTS>
-------------------------------------------------------------------------

Package        : linux-5.10
Version        : 5.10.209-2~deb10u1
CVE ID         : CVE-2023-6040 CVE-2023-6356 CVE-2023-6535 CVE-2023-6536
                 CVE-2023-6606 CVE-2023-6915 CVE-2023-39198 CVE-2023-46838
                 CVE-2023-51779 CVE-2023-52340 CVE-2023-52436 CVE-2023-52438
                 CVE-2023-52439 CVE-2023-52443 CVE-2023-52444 CVE-2023-52445
                 CVE-2023-52448 CVE-2023-52449 CVE-2023-52451 CVE-2023-52454
                 CVE-2023-52456 CVE-2023-52457 CVE-2023-52462 CVE-2023-52463
                 CVE-2023-52464 CVE-2023-52467 CVE-2023-52469 CVE-2023-52470
                 CVE-2023-52609 CVE-2023-52612 CVE-2023-52675 CVE-2023-52679
                 CVE-2023-52683 CVE-2023-52686 CVE-2023-52690 CVE-2023-52691
                 CVE-2023-52693 CVE-2023-52694 CVE-2023-52696 CVE-2023-52698
                 CVE-2024-0646 CVE-2024-1086 CVE-2024-24860 CVE-2024-26586
                 CVE-2024-26597 CVE-2024-26598 CVE-2024-26633

Several vulnerabilities were discovered in the Linux kernel that may
lead to a privilege escalation, denial of service or information
leaks.

For Debian 10 buster, these problems were fixed earlier in version
5.10.209-2~deb10u1.  This update additionally included many more bug
fixes from stable updates 5.10.206-5.10.209 inclusive.

For the detailed security status of linux-5.10 please refer to
its security tracker page at:
<https://security-tracker.debian.org/tracker/linux-5.10>

Further information about Debian LTS security advisories, how to apply
these updates to your system and frequently asked questions can be
found at: <https://wiki.debian.org/LTS>

```

**Attachment:
[signature.asc](pgpU6AD6rO3sK.pgp)**

*Description:* PGP signature

---



=== Content from git.kernel.org_29da6b19_20250111_104309.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=df16afba2378d985359812c865a15c05c70a967e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=df16afba2378d985359812c865a15c05c70a967e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df16afba2378d985359812c865a15c05c70a967e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df16afba2378d985359812c865a15c05c70a967e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:35:12 -0800 |
| commit | [df16afba2378d985359812c865a15c05c70a967e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df16afba2378d985359812c865a15c05c70a967e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=df16afba2378d985359812c865a15c05c70a967e)) | |
| tree | [f206448632c7b86871c10c1a02beb44fd439a239](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=df16afba2378d985359812c865a15c05c70a967e) | |
| parent | [c927d8aff942524f8ae7a15c70f41289b66b4f90](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c927d8aff942524f8ae7a15c70f41289b66b4f90) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df16afba2378d985359812c865a15c05c70a967e&id2=c927d8aff942524f8ae7a15c70f41289b66b4f90)) | |
| download | [linux-df16afba2378d985359812c865a15c05c70a967e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-df16afba2378d985359812c865a15c05c70a967e.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=df16afba2378d985359812c865a15c05c70a967e)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=df16afba2378d985359812c865a15c05c70a967e) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex aa4042dcd6d40e..4adca5b61daba8 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=c927d8aff942524f8ae7a15c70f41289b66b4f90)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=df16afba2378d985359812c865a15c05c70a967e)@@ -435,14 +435,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:46 +0000



=== Content from git.kernel.org_b8f941f2_20250111_104305.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 15:44:37 -0800 |
| commit | [708a4b59baad96c4718dc0bd3a3427d3ab22fedc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)) | |
| tree | [5f998b58f3cf804fe32af137e00674a8a78511ca](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc) | |
| parent | [9bca92a9b66bd780910c928eba14adfa1d8e1f31](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9bca92a9b66bd780910c928eba14adfa1d8e1f31) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc&id2=9bca92a9b66bd780910c928eba14adfa1d8e1f31)) | |
| download | [linux-708a4b59baad96c4718dc0bd3a3427d3ab22fedc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-708a4b59baad96c4718dc0bd3a3427d3ab22fedc.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex a43bfb01720aef..6f2eebae7bee95 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=9bca92a9b66bd780910c928eba14adfa1d8e1f31)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=708a4b59baad96c4718dc0bd3a3427d3ab22fedc)@@ -436,14 +436,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:42 +0000



=== Content from git.kernel.org_aa51bf4d_20250111_104305.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Nathan Lynch <nathanl@linux.ibm.com> | 2023-11-14 11:01:53 -0600 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-01-25 14:52:32 -0800 |
| commit | [999a27b3ce9a69d54ccd5db000ec3a447bc43e6d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)) | |
| tree | [f40b59c7fe765140b7ebfe5ab89f782eeef7ffae](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d) | |
| parent | [5d69c8859e25e5fca8e29d1a40c08aac55714516](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5d69c8859e25e5fca8e29d1a40c08aac55714516) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d&id2=5d69c8859e25e5fca8e29d1a40c08aac55714516)) | |
| download | [linux-999a27b3ce9a69d54ccd5db000ec3a447bc43e6d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-999a27b3ce9a69d54ccd5db000ec3a447bc43e6d.tar.gz) | |

powerpc/pseries/memhp: Fix access beyond end of drmem array[ Upstream commit bd68ffce69f6cf8ddd3a3c32549d1d2275e49fc5 ]
dlpar\_memory\_remove\_by\_index() may access beyond the bounds of the
drmem lmb array when the LMB lookup fails to match an entry with the
given DRC index. When the search fails, the cursor is left pointing to
&drmem\_info->lmbs[drmem\_info->n\_lmbs], which is one element past the
last valid entry in the array. The debug message at the end of the
function then dereferences this pointer:
pr\_debug("Failed to hot-remove memory at %llx\n",
lmb->base\_addr);
This was found by inspection and confirmed with KASAN:
pseries-hotplug-mem: Attempting to hot-remove LMB, drc index 1234
==================================================================
BUG: KASAN: slab-out-of-bounds in dlpar\_memory+0x298/0x1658
Read of size 8 at addr c000000364e97fd0 by task bash/949
dump\_stack\_lvl+0xa4/0xfc (unreliable)
print\_report+0x214/0x63c
kasan\_report+0x140/0x2e0
\_\_asan\_load8+0xa8/0xe0
dlpar\_memory+0x298/0x1658
handle\_dlpar\_errorlog+0x130/0x1d0
dlpar\_store+0x18c/0x3e0
kobj\_attr\_store+0x68/0xa0
sysfs\_kf\_write+0xc4/0x110
kernfs\_fop\_write\_iter+0x26c/0x390
vfs\_write+0x2d4/0x4e0
ksys\_write+0xac/0x1a0
system\_call\_exception+0x268/0x530
system\_call\_vectored\_common+0x15c/0x2ec
Allocated by task 1:
kasan\_save\_stack+0x48/0x80
kasan\_set\_track+0x34/0x50
kasan\_save\_alloc\_info+0x34/0x50
\_\_kasan\_kmalloc+0xd0/0x120
\_\_kmalloc+0x8c/0x320
kmalloc\_array.constprop.0+0x48/0x5c
drmem\_init+0x2a0/0x41c
do\_one\_initcall+0xe0/0x5c0
kernel\_init\_freeable+0x4ec/0x5a0
kernel\_init+0x30/0x1e0
ret\_from\_kernel\_user\_thread+0x14/0x1c
The buggy address belongs to the object at c000000364e80000
which belongs to the cache kmalloc-128k of size 131072
The buggy address is located 0 bytes to the right of
allocated 98256-byte region [c000000364e80000, c000000364e97fd0)
==================================================================
pseries-hotplug-mem: Failed to hot-remove memory at 0
Log failed lookups with a separate message and dereference the
cursor only when it points to a valid entry.
Signed-off-by: Nathan Lynch <nathanl@linux.ibm.com>
Fixes: 51925fb3c5c9 ("powerpc/pseries: Implement memory hotplug remove in the kernel")
Signed-off-by: Michael Ellerman <mpe@ellerman.id.au>
Link: [https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557@linux.ibm.com](https://msgid.link/20231114-pseries-memhp-fixes-v1-1-fb8f2bb7c557%40linux.ibm.com)
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)

| -rw-r--r-- | [arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/powerpc/platforms/pseries/hotplug-memory.c?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 4 deletions

| diff --git a/arch/powerpc/platforms/pseries/hotplug-memory.c b/arch/powerpc/platforms/pseries/hotplug-memory.cindex 91cf23495ccb58..642951c0d5f5c4 100644--- a/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=5d69c8859e25e5fca8e29d1a40c08aac55714516)+++ b/[arch/powerpc/platforms/pseries/hotplug-memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/powerpc/platforms/pseries/hotplug-memory.c?id=999a27b3ce9a69d54ccd5db000ec3a447bc43e6d)@@ -501,14 +501,15 @@ static int dlpar\_memory\_remove\_by\_index(u32 drc\_index) } } - if (!lmb\_found)+ if (!lmb\_found) {+ pr\_debug("Failed to look up LMB for drc index %x\n", drc\_index); rc = -EINVAL;-- if (rc)+ } else if (rc) { pr\_debug("Failed to hot-remove memory at %llx\n", lmb->base\_addr);- else+ } else { pr\_debug("Memory at %llx was hot-removed\n", lmb->base\_addr);+ }  return rc; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 10:41:43 +0000


