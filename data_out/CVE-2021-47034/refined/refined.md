```
{
  "CVE-2021-47034": {
    "related": true,
    "description": "The provided patches address an issue in the PowerPC 64-bit architecture (specifically with radix page tables) where a missing ptesync instruction can cause spurious faults when updating page table entries (PTEs) for kernel memory. The radix__set_pte_at() function does not include a ptesync for performance reasons, which is acceptable for non-kernel memory, since faults are handled by the page fault handler. However, for kernel memory, these faults can lead to crashes or undefined behavior. The vulnerability occurs because map_kernel_page() does not call flush_cache_vmap() (where a ptesync is present for vmalloc region mappings). This lack of synchronization can lead to issues, especially during code patching with Strict RWX enabled.\n\nSpecifically, when patching instructions via do_patch_instruction(), the page containing the instruction is mapped and then immediately modified. Without proper synchronization using ptesync between setting up the PTE and writing to the page, faults can occur. The lack of proper synchronization can cause a race condition.\n\nThe issue is triggered by code patching. This is demonstrated by turning ftrace on and off repeatedly, which involves a large amount of code patching.\n\nThis leads to a kernel crash, often with a message related to kernel data access on write. In some cases, it may also manifest as a ftrace bug.",
    "vulnerability": {
      "root_cause": "Missing ptesync instruction after setting a page table entry (PTE) for kernel memory.",
      "weaknesses": [
        "Lack of synchronization during PTE updates for kernel memory.",
        "Race condition between setting the PTE and modifying the mapped memory."
      ],
      "impact": "Kernel crash or undefined behavior due to memory access faults.",
      "attack_vectors": [
        "Code patching mechanisms (e.g., ftrace).",
        "Any operation that triggers a direct mapping of kernel memory followed by modification."
      ],
       "required_capabilities": [
        "Ability to trigger code patching (e.g., using ftrace) or map kernel memory.",
           "Execution in the context of the kernel."
      ]
    }
  }
}
```