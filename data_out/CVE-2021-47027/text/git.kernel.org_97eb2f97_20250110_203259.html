

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sean Wang <sean.wang@mediatek.com> | 2021-04-06 11:34:36 +0800 |
| --- | --- | --- |
| committer | Felix Fietkau <nbd@nbd.name> | 2021-04-12 23:07:11 +0200 |
| commit | [e230f0c44f011f3270680a506b19b7e84c5e8923](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e230f0c44f011f3270680a506b19b7e84c5e8923) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)) | |
| tree | [228a7262667b7190764c14fac2d9d022d1ddc3c4](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e230f0c44f011f3270680a506b19b7e84c5e8923) | |
| parent | [9db419f0cb39a63fb2f645a846cae17b81cd5c96](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9db419f0cb39a63fb2f645a846cae17b81cd5c96) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e230f0c44f011f3270680a506b19b7e84c5e8923&id2=9db419f0cb39a63fb2f645a846cae17b81cd5c96)) | |
| download | [linux-e230f0c44f011f3270680a506b19b7e84c5e8923.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e230f0c44f011f3270680a506b19b7e84c5e8923.tar.gz) | |

mt76: mt7921: fix kernel crash when the firmware fails to downloadFix kernel crash when the firmware is missing or fails to download.
[ 9.444758] kernel BUG at drivers/pci/msi.c:375!
[ 9.449363] Internal error: Oops - BUG: 0 [#1] PREEMPT SMP
[ 9.501033] pstate: a0400009 (NzCv daif +PAN -UAO)
[ 9.505814] pc : free\_msi\_irqs+0x180/0x184
[ 9.509897] lr : free\_msi\_irqs+0x40/0x184
[ 9.513893] sp : ffffffc015193870
[ 9.517194] x29: ffffffc015193870 x28: 00000000f0e94fa2
[ 9.522492] x27: 0000000000000acd x26: 000000000000009a
[ 9.527790] x25: ffffffc0152cee58 x24: ffffffdbb383e0d8
[ 9.533087] x23: ffffffdbb38628d0 x22: 0000000000040200
[ 9.538384] x21: ffffff8cf7de7318 x20: ffffff8cd65a2480
[ 9.543681] x19: ffffff8cf7de7000 x18: 0000000000000000
[ 9.548979] x17: ffffff8cf9ca03b4 x16: ffffffdc13ad9a34
[ 9.554277] x15: 0000000000000000 x14: 0000000000080800
[ 9.559575] x13: ffffff8cd65a2980 x12: 0000000000000000
[ 9.564873] x11: ffffff8cfa45d820 x10: ffffff8cfa45d6d0
[ 9.570171] x9 : 0000000000000040 x8 : ffffff8ccef1b780
[ 9.575469] x7 : aaaaaaaaaaaaaaaa x6 : 0000000000000000
[ 9.580766] x5 : ffffffdc13824900 x4 : ffffff8ccefe0000
[ 9.586063] x3 : 0000000000000000 x2 : 0000000000000000
[ 9.591362] x1 : 0000000000000125 x0 : ffffff8ccefe0000
[ 9.596660] Call trace:
[ 9.599095] free\_msi\_irqs+0x180/0x184
[ 9.602831] pci\_disable\_msi+0x100/0x130
[ 9.606740] pci\_free\_irq\_vectors+0x24/0x30
[ 9.610915] mt7921\_pci\_probe+0xbc/0x250 [mt7921e]
[ 9.615693] pci\_device\_probe+0xd4/0x14c
[ 9.619604] really\_probe+0x134/0x2ec
[ 9.623252] driver\_probe\_device+0x64/0xfc
[ 9.627335] device\_driver\_attach+0x4c/0x6c
[ 9.631506] \_\_driver\_attach+0xac/0xc0
[ 9.635243] bus\_for\_each\_dev+0x8c/0xd4
[ 9.639066] driver\_attach+0x2c/0x38
[ 9.642628] bus\_add\_driver+0xfc/0x1d0
[ 9.646365] driver\_register+0x64/0xf8
[ 9.650101] \_\_pci\_register\_driver+0x6c/0x7c
[ 9.654360] init\_module+0x28/0xfdc [mt7921e]
[ 9.658704] do\_one\_initcall+0x13c/0x2d0
[ 9.662615] do\_init\_module+0x58/0x1e8
[ 9.666351] load\_module+0xd80/0xeb4
[ 9.669912] \_\_arm64\_sys\_finit\_module+0xa8/0xe0
[ 9.674430] el0\_svc\_common+0xa4/0x16c
[ 9.678168] el0\_svc\_compat\_handler+0x2c/0x40
[ 9.682511] el0\_svc\_compat+0x8/0x10
[ 9.686076] Code: a94257f6 f9400bf7 a8c47bfd d65f03c0 (d4210000)
[ 9.692155] ---[ end trace 7621f966afbf0a29 ]---
[ 9.697385] Kernel panic - not syncing: Fatal exception
[ 9.702599] SMP: stopping secondary CPUs
[ 9.706549] Kernel Offset: 0x1c03600000 from 0xffffffc010000000
[ 9.712456] PHYS\_OFFSET: 0xfffffff440000000
[ 9.716625] CPU features: 0x080026,2a80aa18
[ 9.720795] Memory Limit: none
Fixes: 5c14a5f944b9 ("mt76: mt7921: introduce mt7921e support")
Reported-by: Claire Chang <tientzu@google.com>
Co-developed-by: YN Chen <YN.Chen@mediatek.com>
Signed-off-by: YN Chen <YN.Chen@mediatek.com>
Signed-off-by: Sean Wang <sean.wang@mediatek.com>
Signed-off-by: Felix Fietkau <nbd@nbd.name>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e230f0c44f011f3270680a506b19b7e84c5e8923)

| -rw-r--r-- | [drivers/net/wireless/mediatek/mt76/mt7921/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/wireless/mediatek/mt76/mt7921/pci.c?id=e230f0c44f011f3270680a506b19b7e84c5e8923) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/drivers/net/wireless/mediatek/mt76/mt7921/pci.c b/drivers/net/wireless/mediatek/mt76/mt7921/pci.cindex e94523bf19be11..40e2086d075c72 100644--- a/[drivers/net/wireless/mediatek/mt76/mt7921/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/mediatek/mt76/mt7921/pci.c?id=9db419f0cb39a63fb2f645a846cae17b81cd5c96)+++ b/[drivers/net/wireless/mediatek/mt76/mt7921/pci.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/wireless/mediatek/mt76/mt7921/pci.c?id=e230f0c44f011f3270680a506b19b7e84c5e8923)@@ -146,10 +146,12 @@ static int mt7921\_pci\_probe(struct pci\_dev \*pdev,  ret = mt7921\_register\_device(dev); if (ret)- goto err\_free\_dev;+ goto err\_free\_irq;  return 0; +err\_free\_irq:+ devm\_free\_irq(&pdev->dev, pdev->irq, dev); err\_free\_dev: mt76\_free\_device(&dev->mt76); err\_free\_pci\_vec: |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:06:37 +0000

