

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3047775%2Fwordpress-popup%2Ftrunk%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php%3Fold%3D3025070%26old_path%3Dwordpress-popup%252Ftags%252F7.8.3%252Finc%252Fproviders%252Fhubspot%252Fhustle-hubspot-api.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Reverse Diff](/changeset/3025070/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?old=3047775&old_path=%2Fwordpress-popup%2Ftrunk%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php)

---

# Changes from [wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070 "Show entry in browser") at [r3025070](/changeset/3025070 "Show full changeset") to [wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775 "Show entry in browser") at [r3047775](/changeset/3047775 "Show full changeset")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

File:

1 edited

* [wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775 "Show entry in browser")
  (modified)
  ([5 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php](/changeset/3047775/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?old=3025070&old_path=wordpress-popup%2Ftags%2F7.8.3%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php "Show the [3025070:3047775] differences restricted to wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php")

  | [r3025070](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070#L11 "Show revision 3025070 of this file in browser") | [r3047775](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775#L11 "Show revision 3047775 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | \*/ |
  | 12 | 12 | class Hustle\_HubSpot\_Api extends Opt\_In\_WPMUDEV\_API { |
  | 13 |  | const CLIENT\_ID     = '5253e533-2dd2-48fd-b102-b92b8f250d1b'; |
  | 14 |  | const CLIENT\_SECRET = '2ed54e79-6ceb-4fc6-96d9-58b4f98e6bca'; |
  | 15 |  | const HAPIKEY       = 'db9600bf-648c-476c-be42-6621d7a1f96a'; |
  | 16 |  | const BASE\_URL      = 'https://app.hubspot.com/'; |
  | 17 |  | const API\_URL       = 'https://api.hubapi.com/'; |
  | 18 |  | const SCOPE         = 'oauth crm.objects.contacts.write crm.lists.read crm.objects.contacts.read crm.schemas.contacts.write crm.schemas.contacts.read crm.lists.write'; |
  |  | 13 | const CLIENT\_ID = '5253e533-2dd2-48fd-b102-b92b8f250d1b'; |
  |  | 14 | const BASE\_URL  = 'https://app.hubspot.com/'; |
  |  | 15 | const API\_URL   = 'https://api.hubapi.com/'; |
  |  | 16 | const SCOPE     = 'oauth crm.objects.contacts.write crm.lists.read crm.objects.contacts.read crm.schemas.contacts.write crm.schemas.contacts.read crm.lists.write'; |
  | 19 | 17 |  |
  | 20 | 18 | const REFERER     = 'hustle\_hubspot\_referer'; |
  | […](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070#L108) | […](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775#L106) |  |
  | 108 | 106 | \* The redirect uri must be constant and should not be change per request. |
  | 109 | 107 | \* |
  |  | 108 | \* @param array $args Args. |
  | 110 | 109 | \* @return string |
  | 111 | 110 | \*/ |
  | 112 |  | private function get\_redirect\_uri() { |
  |  | 111 | private function get\_redirect\_uri( $args = array() ) { |
  | 113 | 112 | $params = wp\_parse\_args( |
  |  | 113 | $args, |
  | 114 | 114 | array( |
  | 115 | 115 | 'action'    => 'authorize', |
  | […](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070#L146) | […](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775#L146) |  |
  | 146 | 146 | $args, |
  | 147 | 147 | array( |
  | 148 |  | 'redirect\_uri' => ~~$this->get\_redirect\_uri(~~), |
  |  | 148 | 'redirect\_uri' => rawurlencode( $this->get\_redirect\_uri() ), |
  | 149 | 149 | 'grant\_type'   => 'authorization\_code', |
  |  | 150 | 'state'        => 'state', // It's added just because state param is required on the final endpoint. It's unuseful here. |
  |  | 151 | 'action'       => 'get\_access\_token', |
  | 150 | 152 | ) |
  | 151 | 153 | ); |
  | 152 | 154 |  |
  | 153 |  | $response = $this->request( 'oauth/v1/token', 'POST', $args, false, true ); |
  | 154 |  |  |
  | 155 |  | if ( ! is\_wp\_error( $response ) && ! empty( $response->refresh\_token ) ) { |
  |  | 155 | $url      = $this->get\_redirect\_uri( $args ); |
  |  | 156 | $res      = wp\_remote\_get( $url ); |
  |  | 157 | $body     = is\_wp\_error( $res ) || ! $res ? '' : wp\_remote\_retrieve\_body( $res ); |
  |  | 158 | $response = $body ? json\_decode( $body ) : ''; |
  |  | 159 |  |
  |  | 160 | if ( ! empty( $response->refresh\_token ) ) { |
  | 156 | 161 | $token\_data = get\_object\_vars( $response ); |
  | 157 | 162 |  |
  | […](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070#L188) | […](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775#L193) |  |
  | 188 | 193 |  |
  | 189 | 194 | $args = array( |
  | 190 |  | 'client\_id'     => self::CLIENT\_ID, |
  | 191 |  | 'client\_secret' => self::CLIENT\_SECRET, |
  | 192 |  | 'scope'         => self::SCOPE, |
  |  | 195 | 'client\_id' => self::CLIENT\_ID, |
  |  | 196 | 'scope'     => self::SCOPE, |
  | 193 | 197 | ); |
  | 194 | 198 | $args = wp\_parse\_args( $args, $query\_args ); |
  | […](/browser/wordpress-popup/tags/7.8.3/inc/providers/hubspot/hustle-hubspot-api.php?rev=3025070#L200) | […](/browser/wordpress-popup/trunk/inc/providers/hubspot/hustle-hubspot-api.php?rev=3047775#L204) |  |
  | 200 | 204 | 'method'  => $method, |
  | 201 | 205 | 'headers' => array( |
  | 202 |  | 'Authorization' => 'Bearer ' . ( ! empty( $access\_token ) ? $access\_token : self::HAPIKEY ), |
  | 203 |  | 'Content-Type'  => 'application/json;charset=utf-8', |
  |  | 206 | 'Content-Type' => 'application/json;charset=utf-8', |
  | 204 | 207 | ), |
  | 205 | 208 | 'body'    => $args, |
  | 206 | 209 | ); |
  | 207 | 210 |  |
  |  | 211 | if ( $access\_token ) { |
  |  | 212 | $\_args['headers']['Authorization'] = 'Bearer ' . $access\_token; |
  |  | 213 | } |
  | 208 | 214 | if ( 'POST' === $method && $x\_www ) { |
  | 209 |  | $\_args['headers']['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8'; } |
  |  | 215 | $\_args['headers']['Content-Type'] = 'application/x-www-form-urlencoded;charset=utf-8'; |
  |  | 216 | } |
  | 210 | 217 |  |
  | 211 | 218 | $response = wp\_remote\_request( $url, $\_args ); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3047775&old=3025070&new_path=%2Fwordpress-popup%2Ftrunk%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php&old_path=%2Fwordpress-popup%2Ftags%2F7.8.3%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php)
* [Zip Archive](?format=zip&new=3047775&old=3025070&new_path=%2Fwordpress-popup%2Ftrunk%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php&old_path=%2Fwordpress-popup%2Ftags%2F7.8.3%2Finc%2Fproviders%2Fhubspot%2Fhustle-hubspot-api.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

