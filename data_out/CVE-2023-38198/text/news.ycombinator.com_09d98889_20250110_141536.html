

| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D36252310) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Acme.sh runs arbitrary commands from a remote server](https://github.com/acmesh-official/acme.sh/issues/4659) ([github.com/acmesh-official](from?site=github.com/acmesh-official)) | | --- | --- | --- | |  | | 291 points by [Kesseki](user?id=Kesseki) [on June 9, 2023](item?id=36252310)  | [hide](hide?id=36252310&goto=item%3Fid%3D36252310) | [past](https://hn.algolia.com/?query=Acme.sh%20runs%20arbitrary%20commands%20from%20a%20remote%20server&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=36252310&auth=7cc26b65e7a3c137b957db474dbfd808278d7bb2) | [67 comments](item?id=36252310) |  | |  |  | [predictabl3](user?id=predictabl3) [on June 9, 2023](item?id=36262701)   | [next](#36254093) [–]  Sounds about par for the course for folks that think shell is a productively sustainable way of writing secure or reliable software. Not even remotely sorry about that opinion. The gall to claim ACME compat, then force require a single client, all so you can remote execute arbitrary commands. Should be enough to ruin the CA, but we know how people handle things like this "oh, won't affect *me*" (until it does). Seemingly just so they can avoid some reverse proxy rules to host the challenge endpoints at the right place? Holy *wow*. Oh there we go baby, eval'ing with arbitrary input in the shell script, complete with lazy inproper string quoting. I should probably just stop before I say more unkind things. Was it even run through shellcheck?! Stop writing this stuff in shell people. 95% of the time I review *any* (posix, nushell lacks most of these issues) shell scripts, it's obvious they would fall apart the second any string unexpectedly had a space in it. Even scripts written by darling companies of HN. | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [l0b0](user?id=l0b0) [on June 9, 2023](item?id=36264581)   | [parent](#36262701) | [next](#36264423) [–]  How did we get here? - The barrier to entry for shell scripting is tiny. You basically start with `ls` in an interactive shell and end up writing a frickin' 500-line monstrosity within a month. - POSIX has fossilised scripting languages. I hoped we'd have something like PowerShell by now, but although we have some fine alternatives, none of them seem to be good enough to actually overcome the inertia of POSIX. - Doing something that looks correct is easy, but doing the *right* thing is super effing hard. See looping through complex sets of files. - People use statements like "It's just a script", as if scripts are somehow easy to write. Bullshit. | | --- | --- | --- | | | |  |  | [SergeAx](user?id=SergeAx) [on June 10, 2023](item?id=36266785)   | [root](#36262701) | [parent](#36264581) | [next](#36264423) [–]  Script may be not easy to write, but it's universally easy to deploy. Single almost cross-platform file, no dependencies. Publish the text on a webpage or in an email newsletter so everyone can copy-paste it to their system. Brilliant. | | --- | --- | --- | | | |  |  | [dundarious](user?id=dundarious) [on June 9, 2023](item?id=36264423)   | [parent](#36262701) | [prev](#36264581) | [next](#36263636) [–]  There is almost never a good reason to use constructs like eval in any language (and it exists in many languages), just like there are barely any good reasons to use constructs like system() in C. It appears acme.sh was running eval. I haven't looked into it, but the most common reason I see eval in use is because people don't know that you do it much simpler/more directly by just geting the shell to run commands that are variables with no issue, e.g., `doit() { printf "running: %s\\n" "$\*" ; "$@" ; } ; doit ls /` which works in POSIX sh, no bashisms. (Obviously you should only call it with at least the first argument being trusted) But shell is really not hard if people stick to a few easy guidelines: - quote all var expansion, e.g., "$var" not $var or ${var} (very rare to need otherwise, and never for untrusted data) - use "$@" to perfectly forward arguments (not $@, not $\*, not "$\*" except when you want to turn many arguments into one) - don't use eval - use `set -eu` and explicitly handle functions/commands that may benignly return/exit non-zero, e.g., `diff -U10 ./a ./b || true` - use printf on untrusted strings instead of echo (just use it generally, I say), e.g., printf %s\\n "$var" instead of echo "$var". One of the few times you want to use "$\*" is with printf though, e.g., printf %s\\n "$\*" instead of echo "$@". Try them out, easy to see why, as with one thing to format and multiple arguments, `printf %s\\n "$@"` is equivalent to `for i in "$@" ; do printf %s\\n "$i" ; done` - when using xargs, use -0 if available, or at least -d\\n if available (busybox doesn't have it for example). also usually want to use -r | | --- | --- | --- | | | |  |  | [predictabl3](user?id=predictabl3) [on June 9, 2023](item?id=36265274)   | [root](#36262701) | [parent](#36264423) | [next](#36263636) [–]  And then run shellcheck because even those of us that painful have this seared into our brains make mistakes. Or just use a scripting language that eliminates many of these headaches (nushell) or a real programming language. I get it, I really do. At least now I have nushell for some sanity, but I still find myself constantly writing a shell script and then realizing after a few iterations that *I should've just written in nushell/Rust*. As a thought experiment, how many places rolled out acme.sh to prod and didn't bother code reviewing it or running it through shellcheck? | | --- | --- | --- | | | |  |  | [dundarious](user?id=dundarious) [on June 9, 2023](item?id=36265387)   | [root](#36262701) | [parent](#36265274) | [next](#36263636) [–]  Every language exists on this spectrum, and pretty much every language is clustered near shell. All languages require you to be "principled" in a few key areas, and many projects (open source *and* closed source) don't do a great job at that. At least shell is good at a specific and very useful thing (sequences and pipelines of other commands), and is already installed on most machines -- even windows nowadays since almost everyone has git installed. My "build system" for C projects is just doing the following from pwsh: `& "$env:GIT\_INSTALL\_ROOT\bin\bash.exe" .\build.sh` Most software is not great. That is the issue. | | --- | --- | --- | | | |  |  | [predictabl3](user?id=predictabl3) [on June 10, 2023](item?id=36266979)   | [root](#36262701) | [parent](#36265387) | [next](#36263636) [–]  I'm happy (and spoiled) that I live in a world where I get to use reliable software and not worry about it being inaccessible. With a single nix command, I'm dropped in an environment with secrets mounted by a single age key, with all programs and configuration exactly as I want. It's trivial for me to "just switch" to nushell/rust and not worry about such things. And nushell and rust are *not* clustered near shell for the aspects I'm talking about in this discussion. "bash is everywhere" is just more lipstick on the pig, in my strong opinion. | | --- | --- | --- | | | |  |  | [superkuh](user?id=superkuh) [on June 9, 2023](item?id=36263636)   | [parent](#36262701) | [prev](#36264423) | [next](#36263249) [–]  People write in bash because you can expect bash to be forward compatible with how people write bash. A bash script written by the average person today will run on a bash interpreter from 2006 (or 2023). Very few languages have the developer culture to achieve this in practice even if it might be possible in theory. And it's not like Bash doesn't get new features. It does constantly. But unlike, say, Rust or JS, the developers don't instantly start using forwards incompatible features. It's a different mindset. If you're writing in shell you're writing for longevity and compatibility. Unfortunately requiring approval and authentication from a random incorporated entity running a CA every 90 days is inherently complex. And all the ACME protocol implementations do is hide that inherent complexity by adding even more. CA TLS HTTP is very fragile but it could be made less so if corporate browsers didn't demand short lifetime certs-- a demand reasonable for businesses but not for human people or things expected to last longer than a few years without being touched. | | --- | --- | --- | | | |  |  | [predictabl3](user?id=predictabl3) [on June 9, 2023](item?id=36265248)   | [root](#36262701) | [parent](#36263636) | [next](#36263249) [–]  This doesn't make any sense to me. Stable Rust is forward compatible just as much as shell scripts are. Bash, for example, *does* introduce things in newer versions and they're near universally ignored. All of this also excludes that the fact that your shell script will be just as janky in 10 years as it is now. Again, I regularly, regularly see shell scripts from companies that HN *fawns* over that don't pass shellcheck and have inherent issues that don't occur in better scripting languages, or full programming languages. "Forward-compat" is not unique, and not a value proposition to me if it inherently means less reliable function. | | --- | --- | --- | | | |  |  | [superkuh](user?id=superkuh) [on June 9, 2023](item?id=36265390)   | [root](#36262701) | [parent](#36265248) | [next](#36263249) [–]  Here's an anecdote to provide sense. I recall when I was using a 3 month old (1.48.0 2020-11-19) rustc on Debian 11 (right before it was officially released) and I kept running into rust software I couldn't compile because rust devs used bleeding edge 1.50 (2021-02-11) features. This wasn't a debian is old thing. The rustc was literally 3 months old at this point. At least one of the devs was a person I knew on IRC. He was kind enough to re-write it ("plotsweep" a rust software defined radio program) using only 1.48 and older features. But that's the exception. Most rust devs assume your toolchain is from 3rd party out-of-repository and latest and think forwards compatibility is useless like you do. Shell scripts can be and often are jank. But at least it's stable jank. Shell devs tend to write portable, stable code because that's the entire point of dealing with the shell jank. | | --- | --- | --- | | | |  |  | [predictabl3](user?id=predictabl3) [on June 9, 2023](item?id=36265461)   | [root](#36262701) | [parent](#36265390) | [next](#36263249) [–]  Yeah, I think we're not going to agree on this. I very much like living in a world where I get to use stable, released software, provided by my distro, to build reliable software that is forward compatible. > This wasn't a debian is old thing. From my reading and understanding, yeah, it was. | | --- | --- | --- | | | |  |  | [bheadmaster](user?id=bheadmaster) [on June 10, 2023](item?id=36268307)   | [root](#36262701) | [parent](#36265461) | [next](#36263249) [–]  Three months old software is new enough to be in Arch repository, so in this case it's not about Debian being old, it's about rust devs using bleeding edge features. If you're contradicting a person's argument ("yeah, it was") at least provide some more explanation, otherwise your comment is rarely more than a "is too!". | | --- | --- | --- | | | |  |  | [yjftsjthsd-h](user?id=yjftsjthsd-h) [on June 9, 2023](item?id=36263249)   | [parent](#36262701) | [prev](#36263636) | [next](#36265271) [–]  Shell is a bad fit for many uses (an ACME client *is* more ambitious than I would build in shell, personally), but the things it's good at, it's *really* good at. I have yet to find anything else that's even close to as good for glue code when I have a handful of tools and/or a bunch of files that I need to string together. Unless you're writing in Ada, I promise whatever language you think is better has its own sharp edges (if we're allowing eval, then not many languages are going to be safe, really). | | --- | --- | --- | | | |  |  | [Bystroushaak](user?id=Bystroushaak) [on June 9, 2023](item?id=36263748)   | [root](#36262701) | [parent](#36263249) | [next](#36270494) [–]  I usually replace shell scripts with python (using sh module: <https://amoffat.github.io/sh/> for calling other scripts/programs). | | --- | --- | --- | | | |  |  | [pdimitar](user?id=pdimitar) [on June 9, 2023](item?id=36264201)   | [root](#36262701) | [parent](#36263748) | [next](#36264109) [–]  Golang is better suited for this, for my needs at least. | | --- | --- | --- | | | |  |  | [ianlevesque](user?id=ianlevesque) [on June 9, 2023](item?id=36264405)   | [root](#36262701) | [parent](#36264201) | [next](#36264109) [–]  Yeah, lego-acme is a solid alternative. <https://github.com/go-acme/lego> | | --- | --- | --- | | | |  |  | [yjftsjthsd-h](user?id=yjftsjthsd-h) [on June 9, 2023](item?id=36264465)   | [root](#36262701) | [parent](#36264405) | [next](#36264109) [–]  Er, are we comparing ACME clients or shell alternatives? | | --- | --- | --- | | | |  |  | [cozzyd](user?id=cozzyd) [on June 9, 2023](item?id=36264109)   | [root](#36262701) | [parent](#36263748) | [prev](#36264201) | [next](#36277083) [–]  yeah until your scripts stop running someday because python... | | --- | --- | --- | | | |  |  | [Bystroushaak](user?id=Bystroushaak) [on June 9, 2023](item?id=36264479)   | [root](#36262701) | [parent](#36264109) | [next](#36277083) [–]  Can you elaborate? | | --- | --- | --- | | | |  |  | [cozzyd](user?id=cozzyd) [on June 9, 2023](item?id=36264573)   | [root](#36262701) | [parent](#36264479) | [next](#36277083) [–]  Python scripts will often break with system upgrades, most acutely when Python2 went away, but under many other circumstances as well. | | --- | --- | --- | | | |  |  | [yjftsjthsd-h](user?id=yjftsjthsd-h) [on June 9, 2023](item?id=36265058)   | [root](#36262701) | [parent](#36264573) | [next](#36277083) [–]  I would expect python2 to only have gone away across major versions of an OS, which is about as non-disruptive as it could have been, considering. Of course, as I write this ansible is broken on one of my machines for reasons that appear to stem from a python 3.x->3.y update, so... | | --- | --- | --- | | | |  |  | [pornel](user?id=pornel) [on June 10, 2023](item?id=36266084)   | [root](#36262701) | [parent](#36265058) | [next](#36277083) [–]  That's the thing — Python can break with any OS update (I personally can break it whenever I touch it ;) OTOH a script for /bin/sh written 30 years ago has a good chance running today unchanged. Having said that, I still would not recommend shell for anything that needs to be robust and secure. | | --- | --- | --- | | | |  |  | [Bystroushaak](user?id=Bystroushaak) [on June 10, 2023](item?id=36274147)   | [root](#36262701) | [parent](#36266084) | [next](#36277083) [–]  Well. I've been using python personally since 2007, and it never broke with update (I still occasionally run scripts written for 2.5). Also, I am working as a python backend dev, dealing with hundreds of systems (we are deploying 270+ systems and supporting another 340 user built docker images built on top of py library), and no problems there either. In my previous job, I was doing deployment to 4000+ kiosk computers, and still, no problems with python breaking. What was definitely problematic was the update from 2 to 3. Another problem may be dependency management (people not pinning dependencies). But the python itself? What does it even mean? Interpreter not starting? | | --- | --- | --- | | | |  |  | [cozzyd](user?id=cozzyd) [on June 11, 2023](item?id=36276909)   | [root](#36262701) | [parent](#36274147) | [next](#36277083) [–]  If you're using Python as a bash script replacement for various individual standalone scripts, typically you would be using system libraries without pinning dependencies, in which case you'll break on various OS updates as Python libraries don't seem to value backwards compatibility. Sure you could include a virtual environment with every script but that's not very ergonomic and will really add up... | | --- | --- | --- | | | |  |  | [Bystroushaak](user?id=Bystroushaak) [on June 12, 2023](item?id=36291222)   | [root](#36262701) | [parent](#36276909) | [next](#36277083) [–]  I would say python's stdlib is mostly stable. Usually when I port shell scripts to python, I create a folder for it and throw in some setup.py / requirements.txt. But lately, I've automated most of the deb package creation process (<https://copier.readthedocs.io>), and I typically create the whole deb package. Of course, for single use stuff, I don't bother with either. | | --- | --- | --- | | | |  |  | [broknbottle](user?id=broknbottle) [on June 11, 2023](item?id=36277083)   | [root](#36262701) | [parent](#36263748) | [prev](#36264109) | [next](#36270494) [–]  macOS doesn’t even come with Python.. | | --- | --- | --- | | | |  |  | [monetus](user?id=monetus) [on June 10, 2023](item?id=36270494)   | [root](#36262701) | [parent](#36263249) | [prev](#36263748) | [next](#36265271) [–]  Ever tried TCL? Curious on your thoughts. | | --- | --- | --- | | | |  |  | [electroly](user?id=electroly) [on June 9, 2023](item?id=36265271)   | [parent](#36262701) | [prev](#36263249) | [next](#36266385) [–]  This is a Chinese CA, I don't think there was a danger of any of us using it, and none of them are here to receive this criticism. Most of your complaints are about the shell script that the Chinese CA is injecting and that's... not really the problem at all. It's amazing that it's not literally a rootkit; that's what I expected when they said a Chinese CA was injecting a shell script that acme.sh was running. You're missing the forest for the trees here. This doesn't get better if they had injected a better-written script or a Rust program or whatever else. They could still have injected *anything*, and *that's* the problem. The people who wrote acme.sh (different people than the Chinese CA), which has the security vulnerability that the Chinese CA exploited, might have some soul-searching to do. | | --- | --- | --- | | | |  |  | [catkitcourt](user?id=catkitcourt) [on June 10, 2023](item?id=36266385)   | [parent](#36262701) | [prev](#36265271) | [next](#36254093) [–]  I had wrote some shell software (~5k loc without comment i think?) and agree. I was using shell because the project want to maintain compatibility between different distros (including some weird customized one without `ps` and `sed`), but that's all. Shell is not a good choice for things other than scripting. | | --- | --- | --- | | | |  |  | [regecks](user?id=regecks) [on June 9, 2023](item?id=36254093)   | [prev](#36262701) | [next](#36263670) [–]  I think the title buries the most horrifying part of this. The HiCA certificate authority is relying on an RCE to do an end-run around the semantics of the ACME HTTP-01 validation method. Fucked up and they should be booted from every root program for this. | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [on June 9, 2023](item?id=36255744)   | [parent](#36254093) | [next](#36262430) [–]  They aren't in any root programs. They're just taking certificate requests and relaying them to real CAs, which is why they need to exploit an RCE in the ACME client, since the ACME client wouldn't otherwise be able to complete the validations required by the actual CA. | | --- | --- | --- | | | |  |  | [chunk\_waffle](user?id=chunk_waffle) [on June 9, 2023](item?id=36262430)   | [parent](#36254093) | [prev](#36255744) | [next](#36254281) [–]  When confronted they just flat out shut down the service. They also donated $1000 to the project, and they've redirected requests to their payment site to the US White House's website, and they're from China. They were also suggesting that user's ran the utility as root... All really shady... | | --- | --- | --- | | | |  |  | [stavros](user?id=stavros) [on June 9, 2023](item?id=36254281)   | [parent](#36254093) | [prev](#36262430) | [next](#36263670) [–]  Wow, that's... bold. | | --- | --- | --- | | | |  |  | [freedomben](user?id=freedomben) [on June 9, 2023](item?id=36263670)   | [prev](#36254093) | [next](#36255275) [–]  Major props and thanks to the HiCA person for engaging on the thread even though they were getting hammered. Yes they made some really (damn clever but) bad implementation decisions to use an RCE in the client to basically hack around the entire system, and then compounded it with other bad decisions to redirect to the US White House website to stop a DDoS, but the fact that they engaged, admitted, and explained what was going on I thought was really big of them. Everybody makes mistakes people. If this person was trying to be malicious they would have disappeared, not come straight clean about it on the thread. | | --- | --- | --- | | | |  |  | [clysm](user?id=clysm) [on June 9, 2023](item?id=36265111)   | [parent](#36263670) | [next](#36255275) [–]  But... HiCA just disappeared. Their site is gone now. | | --- | --- | --- | | | |  |  | [0x0](user?id=0x0) [on June 9, 2023](item?id=36255275)   | [prev](#36263670) | [next](#36262924) [–]  Looks like they are issuing under a sub-CA of "ssl.com" according to [https://github.com/acmesh-official/acme.sh/issues/4659#issue...](https://github.com/acmesh-official/acme.sh/issues/4659#issuecomment-1583611298) Interestingly, the mozilla dev-security-policy group seems to contain a recent discussion about including "ssl.com" in the root store here [https://groups.google.com/a/mozilla.org/g/dev-security-polic...](https://groups.google.com/a/mozilla.org/g/dev-security-policy/c/VqnAop6IPcc) Curious to know if this could, maybe it should, have ripple effects to the various SSL Root CA programs. Having someone run a subCA that actually exploits an RCE against ACME clients doesn't seem very trustworthy, and any CA enabling this behaviour should probably be kicked out of the trust stores? | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [on June 9, 2023](item?id=36255748)   | [parent](#36255275) | [next](#36262924) [–]  The sub CA is operated by ssl.com, not HiCA (which is not a trusted certificate authority). HiCA is relaying the certificate requests to ssl.com, which is properly validating the requests in accordance with all the requirements. ssl.com isn't doing anything wrong. That's why HiCA needs to exploit an RCE in acme.sh - ACME doesn't support relaying certificate requests to other CAs like this. | | --- | --- | --- | | | |  |  | [0x0](user?id=0x0) [on June 9, 2023](item?id=36256172)   | [root](#36255275) | [parent](#36255748) | [next](#36262924) [–]  Someone posted a comment on github claiming they are the founder of Quantum (the sub CA of ssl.com - see <https://crt.sh/?caid=200960> ) and that they are the provider of the HiCA service. So it does sound like there is a closer link here than your comment would indicate: [https://github.com/acmesh-official/acme.sh/issues/4659#issue...](https://github.com/acmesh-official/acme.sh/issues/4659#issuecomment-1584414218) | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [on June 9, 2023](item?id=36256211)   | [root](#36255275) | [parent](#36256172) | [next](#36262924) [–]  Quantum is not a trusted CA. ssl.com has a white-labeled intermediate CA with the name "Quantum" in it, but this intermediate CA is operated by ssl.com under all the same controls as ssl.com's other intermediate CAs. Quantum has no ability to issue trusted certificates themselves. | | --- | --- | --- | | | |  |  | [0x0](user?id=0x0) [on June 9, 2023](item?id=36256252)   | [root](#36255275) | [parent](#36256211) | [next](#36262924) [–]  So the person claiming to be the founder of "QuantumCA" does not possess the private key corresponding to <https://crt.sh/?caid=200960> - can we be sure the private key is only accessible by ssl.com's CA system? So the certificates listed here aren't issued by this person, but by the ssl.com's system? [https://crt.sh/?Identity=%25&iCAID=200960&exclude=expired&de...](https://crt.sh/?Identity=%25&iCAID=200960&exclude=expired&deduplicate=Y) Also, why would ssl.com even create a subCA named "QuantumCA"? Are they in business with this person claiming to be the founder of "QuantumCA" who appears to be responsible for exploiting this acme.sh 0day? What does this say about ssl.com's trustworthiness? Or is the person in the github comments lying? | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [on June 9, 2023](item?id=36256426)   | [root](#36255275) | [parent](#36256252) | [next](#36262924) [–]  > *So the person claiming to be the founder of "QuantumCA" does not possess the private key corresponding to <https://crt.sh/?caid=200960> - can we be sure the private key is only accessible by ssl.com's CA system? So the certificates listed here aren't issued by this person, but by the ssl.com's system? <https://crt.sh/?Identity=%25&iCAID=200960&exclude=expired&de>...* Correct. You can see the Quantum intermediates listed in ssl.com's most recent audit statement, meaning an auditor has verified that ssl.com has controls to protect the private key: [https://www.cpacanada.ca/generichandlers/CPACHandler.ashx?at...](https://www.cpacanada.ca/generichandlers/CPACHandler.ashx?attachmentid=4abb6f0c-a72d-40ca-90a1-1c40b140f75a) (The audit could be flawed, but it's the same amount of assurance we have for any intermediate CA's private key - the fact that "QuantumCA" is in the name does not change the risk calculus) > *Also, why would ssl.com even create a subCA named "QuantumCA"? Are they in business with this person claiming to be the founder of "QuantumCA" who appears to be responsible for exploiting this acme.sh 0day? What does this say about ssl.com's trustworthiness? Or is the person in the github comments lying?* There is a business relationship between QuantumCA and ssl.com. QuantumCA is a reseller of ssl.com, and they've paid extra to ssl.com so that the certificates they purchase get issued from an intermediate CA named "QuantumCA" rather than one of ssl.com's usual intermediate CAs which have "ssl.com" in the name. This lets QuantumCA pretend to be a real CA. This is a common practice in the industry, and I don't think it says anything about the trustworthiness of ssl.com, because the business relationship with QuantumCA doesn't in any way subvert the integrity of the WebPKI since ssl.com retains control of the issuance. Still, I wish intermediate CA white-labeling were banned because it causes terrible confusion about who is and isn't a CA. | | --- | --- | --- | | | |  |  | [0x0](user?id=0x0) [on June 9, 2023](item?id=36256530)   | [root](#36255275) | [parent](#36256426) | [next](#36262924) [–]  I find it troubling that a root CA (ssl.com) is apparently OK with lending their name in a business relationship with an actor that is actively exploiting an acme.sh 0day. | | --- | --- | --- | | | |  |  | [tptacek](user?id=tptacek) [on June 9, 2023](item?id=36263142)   | [root](#36255275) | [parent](#36256530) | [next](#36262097) [–]  This feels a little bit like doubling down to find ways to implicate the actual CA instead of the reseller. It's clear how mismanagement by a real CA would make a more interesting story than by this random no-longer-existing pseudo-reseller, but I don't think there's evidence to support that story yet. | | --- | --- | --- | | | |  |  | [0x0](user?id=0x0) [on June 9, 2023](item?id=36263700)   | [root](#36255275) | [parent](#36263142) | [next](#36262097) [–]  But it's not a random pseudo-reseller? The one github comment from "the founder of Quantum CA" seems to say they are also the creator of HiCA, which is the entity that was exploiting the 0day in acme.sh. And the crt.sh link shows an intermediate CA cert named "QuantumCA", signed by ssl.com. So QuantumCA == HiCA == exploiters of the acme.sh 0day, it's all the same entity? The intermediate CA could just as well be named "0dayexploitersCA"? Why is it not a huge concern that ssl.com is fine with operating such a "0dayexploitersCA" intermediate? Am I missing something here? | | --- | --- | --- | | | |  |  | [zhfliz](user?id=zhfliz) [on June 11, 2023](item?id=36280503)   | [root](#36255275) | [parent](#36263700) | [next](#36262097) [–]  Quantum CA (brand, not operator)/HiCA still can't issue certs for domains they don't "control" by having RCE on the systems they point to. all CA requirements for validation still need to be fulfilled for issued certificates, as ssl.com, the Quantum CA operator, which exclusively holds the private keys, is a "proper" CA. this does not affect the trust in the CA infrastructure or ssl.com itself; while this is morally questionable to keep the business relationship, it does not mean the CA is not following the signing requirements. | | --- | --- | --- | | | |  |  | [mholt](user?id=mholt) [on June 9, 2023](item?id=36262097)   | [root](#36255275) | [parent](#36256530) | [prev](#36263142) | [next](#36262924) [–]  I honestly don't think anyone else knew about the RCE until yesterday. | | --- | --- | --- | | | |  |  | [ronsor](user?id=ronsor) [on June 9, 2023](item?id=36262924)   | [prev](#36255275) | [next](#36266254) [–]  These sorts of hacks remind me of when AOL's AIM server was exploiting bugs in their own client to run verification code[0]. Hardly an acceptable practice in 2023, though. [0] <https://www.geoffchappell.com/notes/security/aim/index.htm> | | --- | --- | --- | | | |  |  | [catkitcourt](user?id=catkitcourt) [on June 10, 2023](item?id=36266254)   | [prev](#36262924) | [next](#36262968) [–]  This raise one more issue about Chinese providers. The site using this exploit, HiCA is run by xiaohuilam on Github. He/She is also the founder of two famous SSL certificate provider in China, DigitalSign and QuantumCA. Additionally, he is also a contributor of acme.sh repository. The acme.sh repository locked issue #4659 quickly after it raise attentions in the developer community in China. It's hard to imagine that, as one of the repository's contributor, once you have found a vulnerability, you are going to use it in your own product, instead of fix it. They are just another version of Pinduoduo (owner of Temu, and also the one who put spyware on user's android phone). | | --- | --- | --- | | | |  |  | [WirelessGigabit](user?id=WirelessGigabit) [on June 9, 2023](item?id=36262968)   | [prev](#36266254) | [next](#36261493) [–]  This means that acme.sh has an RCE. Once the patch is in I'm rotating all my certs, even though I use ZeroSSL. I do wonder if what HiCA did gave possibilities to post the private key somewhere else? | | --- | --- | --- | | | |  |  | [mholt](user?id=mholt) [on June 9, 2023](item?id=36264270)   | [parent](#36262968) | [next](#36261493) [–]  If the executed script transmits the key, then yes. (But the script we observed does not.) | | --- | --- | --- | | | |  |  | [j16sdiz](user?id=j16sdiz) [on June 9, 2023](item?id=36261493)   | [prev](#36262968) | [next](#36258901) [–]  <quote> ... HiCA is injecting arbitrary code/commands into the certificate obtaining process and acme.sh is running them on the client machine. </quote> | | --- | --- | --- | | | |  |  | [Vecr](user?id=Vecr) [on June 9, 2023](item?id=36258901)   | [prev](#36261493) | [next](#36253552) [–]  Even if this is just RCE in the script somehow (I doubt it, it can probably do anything the user running it can), it's horrifying. It means the certificate authority could just take your newly generated certificates and upload them anywhere they want. That's a catastrophic compromise in the TLS security model. | | --- | --- | --- | | | |  |  | [tialaramex](user?id=tialaramex) [on June 9, 2023](item?id=36265258)   | [parent](#36258901) | [next](#36263054) [–]  Somebody who cares about the acme.sh client specifically would be able to say, but in general it's not necessary that your ACME client has these keys. What the ACME protocol wants to do is hand over a CSR (Certificate Signing Request), and get back a certificate, and to achieve that it has to explain how you'll prove you're entitled to such a certificate. Most ACME clients will also make a suitable proof (in at least some cases), and also generate a suitable CSR from first principles, for which they will need to generate a new private key - but that's not a necessary part of the system, and it's certainly not rare to generate your own CSR, either because you must technically, or because your own security processes say *strange women, lying in ponds, distributing swords is no basis for a system of government* sorry, I mean, that this key is private and shouldn't be on the host running ACME services. | | --- | --- | --- | | | |  |  | [Vecr](user?id=Vecr) [on June 10, 2023](item?id=36266594)   | [root](#36258901) | [parent](#36265258) | [next](#36263054) [–]  I've looked at it more, it looks like this RCE could harvest the private key. | | --- | --- | --- | | | |  |  | [tialaramex](user?id=tialaramex) [on June 10, 2023](item?id=36268486)   | [root](#36258901) | [parent](#36266594) | [next](#36263054) [–]  I have no idea, my point was that in general the ACME client can't necessarily give you the private key even if it wanted to, because if you provide a CSR the key needn't even be on the same machine, let alone accessible in its execution environment. | | --- | --- | --- | | | |  |  | [diarrhea](user?id=diarrhea) [on June 9, 2023](item?id=36263054)   | [parent](#36258901) | [prev](#36265258) | [next](#36261733) [–]  Why is distributing the certificate dangerous? It’s public knowledge anyway. | | --- | --- | --- | | | |  |  | [Vecr](user?id=Vecr) [on June 9, 2023](item?id=36263469)   | [root](#36258901) | [parent](#36263054) | [next](#36261733) [–]  The private key I mean, it's really supposed to be secret on your computer and not even the certificate authority is supposed to have access to it. | | --- | --- | --- | | | |  |  | [paulgb](user?id=paulgb) [on June 9, 2023](item?id=36261733)   | [parent](#36258901) | [prev](#36263054) | [next](#36253552) [–]  If the CA is compromised, can’t they just bypass ACME verification and generate a cert for your domain anyway? | | --- | --- | --- | | | |  |  | [mholt](user?id=mholt) [on June 9, 2023](item?id=36262127)   | [root](#36258901) | [parent](#36261733) | [next](#36262252) [–]  Yes, but with serious consequences (it would go into public transparency logs, at least for CAs in most public root stores). If the CA can access your private key, then it can reuse (or worse, redistribute) it without anyone knowing. | | --- | --- | --- | | | |  |  | [dspillett](user?id=dspillett) [on June 9, 2023](item?id=36262252)   | [root](#36258901) | [parent](#36261733) | [prev](#36262127) | [next](#36262133) [–]  The CA isn't directly compromised so a third party couldn't generate any arbitrary certificate this way. Essentially though, assuming my understanding is correct, it would allow them to be a man-in-the-middle and take copies of the keys & certificates used by this tool, allowing them to use keys and certificates generated by that tool. Also, if such a tool is run by root (bad practise, but not uncommon practise) or other significantly privileged user, they potentially have access to far more. | | --- | --- | --- | | | |  |  | [Vecr](user?id=Vecr) [on June 9, 2023](item?id=36262133)   | [root](#36258901) | [parent](#36261733) | [prev](#36262252) | [next](#36253552) [–]  Yeah, but that's more likely to be noticed in cert transparency and by the website operator, as there's either a duplicate cert in the log or the website server does not work. | | --- | --- | --- | | | |  |  | [AmenBreak](user?id=AmenBreak) [on June 9, 2023](item?id=36253552)   | [prev](#36258901) [–]  Is this part of Plan 9? | | --- | --- | --- | | | |  |  | [com](user?id=com) [on June 9, 2023](item?id=36253740)   | [parent](#36253552) | [next](#36263593) [–]  Unfortunately this is related to acme.sh, a shell script tool to request new and replace free certificates. So far, this GitHub issue is quite disturbing. | | --- | --- | --- | | | |  |  | [tinus\_hn](user?id=tinus_hn) [on June 9, 2023](item?id=36253834)   | [root](#36253552) | [parent](#36253740) | [next](#36263593) [–]  IMO it’s just a demonstration why you don’t write complicated or security sensitive code in shell script: it’s basically impossible to get right, there’s pitfalls around every corner and it’s extremely difficult to check for mistakes. | | --- | --- | --- | | | |  |  | [pazderski](user?id=pazderski) [on June 9, 2023](item?id=36255296)   | [root](#36253552) | [parent](#36253834) | [next](#36263593) [–]  I wouldn't say there are too many pitfalls. Quote all variables (acme.sh seem to do well on that part) and don't use eval (probably the reason for this problem). | | --- | --- | --- | | | |  |  | [Eeems](user?id=Eeems) [on June 9, 2023](item?id=36259171)   | [root](#36253552) | [parent](#36255296) | [next](#36263593) [–]  I just read the entire issue thread, yes eval was the reason. | | --- | --- | --- | | | |  |  | [MisterTea](user?id=MisterTea) [on June 9, 2023](item?id=36263593)   | [parent](#36253552) | [prev](#36253740) [–]  No. This is not the acme editor. This is what ACME they are referring to: [https://en.wikipedia.org/wiki/Automatic\_Certificate\_Manageme...](https://en.wikipedia.org/wiki/Automatic_Certificate_Management_Environment) | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |

