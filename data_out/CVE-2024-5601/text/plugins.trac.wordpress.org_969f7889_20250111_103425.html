

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fmediavine-create%2Ftrunk%2Fclass-plugin.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/mediavine-create/trunk/class-plugin.php?rev=3152761 "Revision 3152761")
* Next Revision →
* [Blame](/browser/mediavine-create/trunk/class-plugin.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/mediavine-create/trunk/class-plugin.php)

---

# [source:](/browser?order=name "Go to repository root") [mediavine-create](/browser/mediavine-create?order=name "View mediavine-create")/[trunk](/browser/mediavine-create/trunk?order=name "View trunk")/[class-plugin.php](/browser/mediavine-create/trunk/class-plugin.php?order=name "View class-plugin.php")

View diff against:

View revision:

| [Last change](/changeset/3162244/mediavine-create/trunk/class-plugin.php "View differences") on this file was [3162244](/changeset/3162244/ "View changeset 3162244"), checked in by mediavine, [3 months ago](/timeline?from=2024-10-03T15%3A15%3A22Z&precision=second "See timeline at 10/03/2024 03:15:22 PM") |
| --- |
| Updates to 1.9.11 |
| * Property **svn:executable** set to   *`*`* | |
| **File size:** 35.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace Mediavine\Create; |
| [3](#L3) |  |
| [4](#L4) | use Mediavine\MV\_DBI; |
| [5](#L5) | use Mediavine\Create\Settings\Advanced; |
| [6](#L6) | use Mediavine\Create\Settings\Affiliates; |
| [7](#L7) | use Mediavine\Create\Settings\Control\_Panel; |
| [8](#L8) | use Mediavine\Create\Settings\Display; |
| [9](#L9) | use Mediavine\Create\Settings\Lists; |
| [10](#L10) | use Mediavine\Create\Settings\Recipes; |
| [11](#L11) | use Mediavine\Create\Settings\Pro; |
| [12](#L12) | use Mediavine\Settings; |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* Plugin bootstrap class |
| [16](#L16) | \*/ |
| [17](#L17) | class Plugin { |
| [18](#L18) | const VERSION = '1.9.11'; |
| [19](#L19) |  |
| [20](#L20) | const DB\_VERSION = '1.9.11'; |
| [21](#L21) |  |
| [22](#L22) | const TEXT\_DOMAIN = 'mediavine'; |
| [23](#L23) |  |
| [24](#L24) | const PLUGIN\_DOMAIN = 'mv\_create'; |
| [25](#L25) |  |
| [26](#L26) | const PREFIX = '\_mv\_'; |
| [27](#L27) |  |
| [28](#L28) | const PLUGIN\_FILE\_PATH = \_\_FILE\_\_; |
| [29](#L29) |  |
| [30](#L30) | const PLUGIN\_ACTIVATION\_FILE = 'mediavine-create.php'; |
| [31](#L31) |  |
| [32](#L32) | const REQUIRED\_IMPORTER\_VERSION = '0.10.3'; |
| [33](#L33) |  |
| [34](#L34) | public $api\_route = 'mv-create'; |
| [35](#L35) |  |
| [36](#L36) | public $api\_version = 'v1'; |
| [37](#L37) |  |
| [38](#L38) | public static $db\_interface = null; |
| [39](#L39) |  |
| [40](#L40) | public static $views = null; |
| [41](#L41) |  |
| [42](#L42) | public static $api\_services = null; |
| [43](#L43) |  |
| [44](#L44) | public static $models = null; |
| [45](#L45) |  |
| [46](#L46) | public static $models\_v2 = null; |
| [47](#L47) |  |
| [48](#L48) | public static $custom\_content = null; |
| [49](#L49) |  |
| [50](#L50) | public static $settings = null; |
| [51](#L51) |  |
| [52](#L52) | public static $settings\_group = 'mv\_create'; |
| [53](#L53) |  |
| [54](#L54) | public static $shapes = null; |
| [55](#L55) |  |
| [56](#L56) | public static $mcp\_enabled = false; |
| [57](#L57) |  |
| [58](#L58) | public static $create\_settings\_slugs = [ |
| [59](#L59) | 'mv\_create\_affiliate\_message', |
| [60](#L60) | 'mv\_create\_copyright\_attribution', |
| [61](#L61) | ]; |
| [62](#L62) |  |
| [63](#L63) | public $rest\_response = null; |
| [64](#L64) |  |
| [65](#L65) | private static $instance = null; |
| [66](#L66) |  |
| [67](#L67) | public static function get\_instance() { |
| [68](#L68) | if ( null === self::$instance ) { |
| [69](#L69) | self::$instance = new self(); |
| [70](#L70) | self::$instance->init(); |
| [71](#L71) | } |
| [72](#L72) |  |
| [73](#L73) | return self::$instance; |
| [74](#L74) | } |
| [75](#L75) |  |
| [76](#L76) | public static function assets\_url() { |
| [77](#L77) | return MV\_CREATE\_URL; |
| [78](#L78) | } |
| [79](#L79) |  |
| [80](#L80) | /\*\* |
| [81](#L81) | \* Get MCP site id if it exists |
| [82](#L82) | \* |
| [83](#L83) | \* @return  string|false  Site id if it exists and MCP is active, or false |
| [84](#L84) | \*/ |
| [85](#L85) | public static function get\_mcp\_data() { |
| [86](#L86) | $mcp\_data = false; |
| [87](#L87) | if ( self::$mcp\_enabled ) { |
| [88](#L88) | // TODO: Check if video support exists and is authorized with identity service |
| [89](#L89) | $mcp\_data = [ |
| [90](#L90) | 'site\_id' => get\_option( 'MVCP\_site\_id' ), |
| [91](#L91) | 'version' => get\_option( 'mv\_mcp\_version', null ), |
| [92](#L92) | ]; |
| [93](#L93) | } |
| [94](#L94) |  |
| [95](#L95) | return $mcp\_data; |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | /\*\* |
| [99](#L99) | \* Return image size value and label |
| [100](#L100) | \* |
| [101](#L101) | \* @return array |
| [102](#L102) | \*/ |
| [103](#L103) | public static function get\_image\_size\_values() { |
| [104](#L104) | $image\_sizes                   = Creations::get\_image\_sizes(); |
| [105](#L105) | $image\_sizes\_values\_and\_labels = []; |
| [106](#L106) |  |
| [107](#L107) | // @TODO add a filter for adding size names to exclude from disable list? |
| [108](#L108) | $exclude = [ |
| [109](#L109) | 'mv\_create\_no\_ratio', |
| [110](#L110) | 'mv\_create\_vert', |
| [111](#L111) | ]; |
| [112](#L112) |  |
| [113](#L113) | foreach ( $image\_sizes as $size => $size\_data ) { |
| [114](#L114) | if ( strpos( $size, '\_high\_res' ) || in\_array( $size, $exclude, true ) ) { |
| [115](#L115) | continue; |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) | $image\_sizes\_values\_and\_labels[ $size ] = $size\_data['name']; |
| [119](#L119) | } |
| [120](#L120) |  |
| [121](#L121) | return $image\_sizes\_values\_and\_labels; |
| [122](#L122) | } |
| [123](#L123) |  |
| [124](#L124) | /\*\* |
| [125](#L125) | \* Modify setting array to include custom post types |
| [126](#L126) | \* |
| [127](#L127) | \* @param array $settings array of current settings to be modified with addition of custom post types |
| [128](#L128) | \* |
| [129](#L129) | \* @return array |
| [130](#L130) | \*/ |
| [131](#L131) | public function set\_custom\_post\_type\_option\_value( $settings ) { |
| [132](#L132) | $allowed\_post\_types = $this->get\_custom\_post\_types(); |
| [133](#L133) |  |
| [134](#L134) | $cpt\_field = array\_search( self::$settings\_group . '\_allowed\_cpt\_types', wp\_list\_pluck( $settings, 'slug' ), true ); |
| [135](#L135) |  |
| [136](#L136) | if ( empty( $allowed\_post\_types ) ) { |
| [137](#L137) | $settings[ $cpt\_field ]->value = []; // reset value |
| [138](#L138) | return $settings; |
| [139](#L139) | } |
| [140](#L140) |  |
| [141](#L141) | if ( ! empty( $settings[ $cpt\_field ] ) ) { |
| [142](#L142) | // two things need to happen: |
| [143](#L143) | // 1. CPTs that no longer exist need to be removed as a saved value |
| [144](#L144) | // 2. New CPTs need to be added to options but NOT to saved values — this should already be handled by $this->get\_custom\_post\_types() |
| [145](#L145) |  |
| [146](#L146) | $values        = array\_keys( $allowed\_post\_types ); |
| [147](#L147) | $stored\_values = json\_decode( $settings[ $cpt\_field ]->value ); |
| [148](#L148) |  |
| [149](#L149) | if ( ! is\_array( $stored\_values ) ) { |
| [150](#L150) | return $settings; |
| [151](#L151) | } |
| [152](#L152) |  |
| [153](#L153) | $keys\_to\_remove = array\_diff( $stored\_values, $values ); // CPTs that were removed |
| [154](#L154) |  |
| [155](#L155) | // remove invalid CPTs from saved values |
| [156](#L156) | $new\_values = array\_filter( |
| [157](#L157) | $stored\_values, function ( $i ) use ( $keys\_to\_remove ) { |
| [158](#L158) | return ! in\_array( $i, $keys\_to\_remove, true ); |
| [159](#L159) | } |
| [160](#L160) | ); |
| [161](#L161) |  |
| [162](#L162) | $settings[ $cpt\_field ]->data['options'] = $allowed\_post\_types; |
| [163](#L163) | $settings[ $cpt\_field ]->value           = json\_encode( array\_values( $new\_values ) ); |
| [164](#L164) | } |
| [165](#L165) |  |
| [166](#L166) | return $settings; |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | public static function get\_activation\_path() { |
| [170](#L170) | return MV\_CREATE\_DIR . '/' . self::PLUGIN\_ACTIVATION\_FILE; |
| [171](#L171) | } |
| [172](#L172) |  |
| [173](#L173) | public function load\_models() { |
| [174](#L174) | $models\_loader = new \stdClass(); |
| [175](#L175) |  |
| [176](#L176) | return $models\_loader; |
| [177](#L177) | } |
| [178](#L178) |  |
| [179](#L179) | /\*\* |
| [180](#L180) | \* Runs hook at plugin activation. |
| [181](#L181) | \* |
| [182](#L182) | \* The update hook will run a bit later through its own hook |
| [183](#L183) | \* |
| [184](#L184) | \* @return void |
| [185](#L185) | \*/ |
| [186](#L186) | public function plugin\_activation() { |
| [187](#L187) | do\_action( self::PLUGIN\_DOMAIN . '\_plugin\_activated' ); |
| [188](#L188) | } |
| [189](#L189) |  |
| [190](#L190) | /\*\* |
| [191](#L191) | \* Runs hook at plugin update. |
| [192](#L192) | \* |
| [193](#L193) | \* This runs after all plugins are loaded so it can run after update. It also performs a |
| [194](#L194) | \* check based on version number, just in case someone updates in a non-conventional way. |
| [195](#L195) | \* After completing hooks, Create version number is updated in the db. |
| [196](#L196) | \* |
| [197](#L197) | \* @return void |
| [198](#L198) | \*/ |
| [199](#L199) | public function plugin\_update\_check() { |
| [200](#L200) | if ( get\_option( 'mv\_create\_version' ) === self::VERSION ) { |
| [201](#L201) | return; |
| [202](#L202) | } |
| [203](#L203) |  |
| [204](#L204) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [205](#L205) |  |
| [206](#L206) | /\*\* |
| [207](#L207) | \* Runs just before the plugin saves its new version to the database. |
| [208](#L208) | \* |
| [209](#L209) | \* @param $last\_plugin\_version The last version the plugin was on. If this is a new |
| [210](#L210) | \*              install, the last plugin version will be the current version. |
| [211](#L211) | \*/ |
| [212](#L212) | do\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', $last\_plugin\_version ); |
| [213](#L213) | update\_option( 'mv\_create\_version', self::VERSION ); |
| [214](#L214) | flush\_rewrite\_rules(); |
| [215](#L215) | } |
| [216](#L216) |  |
| [217](#L217) | /\*\* |
| [218](#L218) | \* Runs hook at plugin deactivation and flushes rewrite rules. |
| [219](#L219) | \* |
| [220](#L220) | \* @return void |
| [221](#L221) | \*/ |
| [222](#L222) | public function plugin\_deactivation() { |
| [223](#L223) | do\_action( self::PLUGIN\_DOMAIN . '\_plugin\_deactivated' ); |
| [224](#L224) | flush\_rewrite\_rules(); |
| [225](#L225) | } |
| [226](#L226) |  |
| [227](#L227) | public function generate\_tables() { |
| [228](#L228) | \Mediavine\MV\_DBI::upgrade\_database\_check( self::PLUGIN\_DOMAIN, self::DB\_VERSION ); |
| [229](#L229) | } |
| [230](#L230) |  |
| [231](#L231) | /\*\* |
| [232](#L232) | \* Determine whether Mediavine Control Panel is enabled. |
| [233](#L233) | \*/ |
| [234](#L234) | public function set\_mcp\_status() { |
| [235](#L235) | if ( |
| [236](#L236) | ( |
| [237](#L237) | Plugin\_Checker::is\_mcp\_active() |
| [238](#L238) | ) && get\_option( 'MVCP\_site\_id' ) |
| [239](#L239) | ) { |
| [240](#L240) | self::$mcp\_enabled = true; |
| [241](#L241) | } |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | /\*\* |
| [245](#L245) | \* Bootstrap the plugin. |
| [246](#L246) | \*/ |
| [247](#L247) | public function init() { |
| [248](#L248) | self::$models = new \stdClass(); |
| [249](#L249) |  |
| [250](#L250) | $this->set\_mcp\_status(); |
| [251](#L251) |  |
| [252](#L252) | // initialize Admin\_Notices |
| [253](#L253) | \Mediavine\Create\Admin\_Notices::get\_instance(); |
| [254](#L254) |  |
| [255](#L255) | self::$views         = \Mediavine\View\_Loader::get\_instance( MV\_CREATE\_DIR ); |
| [256](#L256) | self::$api\_services  = \Mediavine\Create\API\_Services::get\_instance(); |
| [257](#L257) | self::$models\_v2     = \Mediavine\MV\_DBI::get\_models( |
| [258](#L258) | [ |
| [259](#L259) | 'mv\_images', |
| [260](#L260) | 'mv\_nutrition', |
| [261](#L261) | 'mv\_products', |
| [262](#L262) | 'mv\_products\_map', |
| [263](#L263) | 'mv\_reviews', |
| [264](#L264) | 'mv\_creations', |
| [265](#L265) | 'mv\_supplies', |
| [266](#L266) | 'mv\_relations', |
| [267](#L267) | 'mv\_revisions', |
| [268](#L268) | 'posts', |
| [269](#L269) | ] |
| [270](#L270) | ); |
| [271](#L271) |  |
| [272](#L272) | // Register feature flags early. |
| [273](#L273) | add\_action( 'after\_setup\_theme', '\Mediavine\Create\register\_flags' ); |
| [274](#L274) |  |
| [275](#L275) | $this->register\_custom\_fields(); |
| [276](#L276) |  |
| [277](#L277) | // Register default Create settings for Creation published data |
| [278](#L278) | add\_filter( |
| [279](#L279) | 'mv\_publish\_create\_settings', function ( $arr ) { |
| [280](#L280) | // Get the authenticated user to assign the copyright attribution if none has been set in settings. |
| [281](#L281) | $user = wp\_get\_current\_user(); |
| [282](#L282) | $arr[ \Mediavine\Create\Plugin::$settings\_group . '\_copyright\_attribution' ] = $user->display\_name; |
| [283](#L283) |  |
| [284](#L284) | // Assign the default settings. These can be overwritten by using this filter. |
| [285](#L285) | foreach ( \Mediavine\Create\Plugin::$create\_settings\_slugs as $slug ) { |
| [286](#L286) | $setting = \Mediavine\Settings::get\_setting( $slug ); |
| [287](#L287) | if ( $setting ) { |
| [288](#L288) | $arr[ $slug ] = $setting; |
| [289](#L289) | } |
| [290](#L290) | } |
| [291](#L291) | return $arr; |
| [292](#L292) | } |
| [293](#L293) | ); |
| [294](#L294) |  |
| [295](#L295) | self::$custom\_content = Custom\_Content::make( 'mv-create', \_\_( 'Create', 'mediavine' ) ); |
| [296](#L296) | self::$settings       = $this->get\_settings(); |
| [297](#L297) | self::$shapes         = $this->get\_shapes\_data(); |
| [298](#L298) |  |
| [299](#L299) | register\_activation\_hook( self::get\_activation\_path(), [ $this, 'plugin\_activation' ] ); |
| [300](#L300) | add\_action( 'setup\_theme', [ $this, 'plugin\_update\_check' ], 10, 2 ); |
| [301](#L301) | register\_deactivation\_hook( self::get\_activation\_path(), [ $this, 'plugin\_deactivation' ] ); |
| [302](#L302) |  |
| [303](#L303) | add\_filter( |
| [304](#L304) | 'mv\_wp\_router\_config', function( $config ) { |
| [305](#L305) | $config->set( |
| [306](#L306) | 'api', [ |
| [307](#L307) | 'namespace'            => 'mv-create', |
| [308](#L308) | 'version'              => 'v1', |
| [309](#L309) | 'controller\_namespace' => 'Mediavine\\Create\\Controllers\\', |
| [310](#L310) | ] |
| [311](#L311) | ); |
| [312](#L312) | return $config; |
| [313](#L313) | } |
| [314](#L314) | ); |
| [315](#L315) |  |
| [316](#L316) | // Load translations. |
| [317](#L317) | add\_action( 'init', 'mv\_create\_load\_plugin\_textdomain', 0 ); |
| [318](#L318) |  |
| [319](#L319) | // Activations hooks, forcing order |
| [320](#L320) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'generate\_tables' ], 20 ); |
| [321](#L321) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'delete\_old\_settings' ], 21 ); |
| [322](#L322) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'create\_settings' ], 30 ); |
| [323](#L323) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'create\_shapes' ], 35 ); |
| [324](#L324) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'republish\_queue' ], 40 ); |
| [325](#L325) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'update\_queue' ], 45 ); |
| [326](#L326) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'update\_reviews\_table' ], 50 ); |
| [327](#L327) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'importer\_admin\_notice' ], 60 ); |
| [328](#L328) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'fix\_cloned\_ratings' ], 70 ); |
| [329](#L329) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'fix\_cookbook\_canonical\_post\_ids' ], 80 ); |
| [330](#L330) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'add\_initial\_revision\_to\_cards' ], 85 ); |
| [331](#L331) | add\_action( self::PLUGIN\_DOMAIN . '\_plugin\_updated', [ $this, 'queue\_existing\_amazon\_products' ], 90 ); |
| [332](#L332) |  |
| [333](#L333) | // Fixes |
| [334](#L334) | add\_action( 'mv\_fix\_video\_description\_queue\_action', [ $this, 'fix\_video\_description' ] ); |
| [335](#L335) |  |
| [336](#L336) | // Shortcodes |
| [337](#L337) | add\_shortcode( 'mv\_img', [ $this, 'mv\_img\_shortcode' ] ); |
| [338](#L338) | add\_shortcode( 'mvc\_ad', [ $this, 'mvc\_ad\_shortcode' ] ); |
| [339](#L339) | add\_shortcode( 'mv\_schema\_meta', [ $this, 'mv\_schema\_meta\_shortcode' ] ); |
| [340](#L340) |  |
| [341](#L341) | // For pubs that were beta-testing Indexes — hides shortcode output |
| [342](#L342) | add\_shortcode( 'mv\_index', '\_\_return\_false' ); |
| [343](#L343) |  |
| [344](#L344) | add\_filter( 'rest\_prepare\_post', [ $this, 'rest\_prepare\_post' ], 10, 3 ); |
| [345](#L345) |  |
| [346](#L346) | add\_filter( 'mv\_create\_paapi\_access\_key\_settings\_value', 'trim', 10 ); |
| [347](#L347) | add\_filter( 'mv\_create\_paapi\_secret\_key\_settings\_value', 'trim', 10 ); |
| [348](#L348) | add\_filter( 'mv\_create\_paapi\_tag\_settings\_value', 'trim', 10 ); |
| [349](#L349) | add\_filter( 'mv\_create\_localized\_admin\_settings', [ $this, 'set\_custom\_post\_type\_option\_value' ], 10 ); |
| [350](#L350) |  |
| [351](#L351) | $Images = new Images(); |
| [352](#L352) | $Images->init(); |
| [353](#L353) |  |
| [354](#L354) | $Settings = new \Mediavine\Settings(); |
| [355](#L355) | $Settings->init(); |
| [356](#L356) |  |
| [357](#L357) | $Nutrition = new Nutrition(); |
| [358](#L358) | $Nutrition->init(); |
| [359](#L359) |  |
| [360](#L360) | $Products = new Products(); |
| [361](#L361) | $Products->init(); |
| [362](#L362) |  |
| [363](#L363) | $Products\_Map = new Products\_Map(); |
| [364](#L364) | $Products\_Map->init(); |
| [365](#L365) |  |
| [366](#L366) | $Relations = new Relations(); |
| [367](#L367) | $Relations->init(); |
| [368](#L368) |  |
| [369](#L369) | $Reviews\_Models = new Reviews\_Models(); |
| [370](#L370) | $Reviews\_Models->init(); |
| [371](#L371) |  |
| [372](#L372) | $Reviews\_API = new Reviews\_API(); |
| [373](#L373) | $Reviews\_API->init(); |
| [374](#L374) |  |
| [375](#L375) | $Reviews = new Reviews(); |
| [376](#L376) | $Reviews->init(); |
| [377](#L377) |  |
| [378](#L378) | Shapes::get\_instance(); |
| [379](#L379) | Creations::get\_instance(); |
| [380](#L380) | Supplies::get\_instance(); |
| [381](#L381) |  |
| [382](#L382) | $Images->step\_queue(); |
| [383](#L383) |  |
| [384](#L384) | Revisions::get\_instance(); |
| [385](#L385) | Data\_Sync::get\_instance(); |
| [386](#L386) |  |
| [387](#L387) | $JSON\_LD = JSON\_LD::get\_instance(); |
| [388](#L388) |  |
| [389](#L389) | \Mediavine\API\_Services::get\_instance(); |
| [390](#L390) |  |
| [391](#L391) | $Admin\_Init = new Admin\_Init(); |
| [392](#L392) | $Admin\_Init->init(); |
| [393](#L393) |  |
| [394](#L394) | Plugin\_Checker::get\_instance(); |
| [395](#L395) | Theme\_Checker::get\_instance(); |
| [396](#L396) |  |
| [397](#L397) | // Version-specific feature registration. |
| [398](#L398) | if ( defined( 'MV\_CREATE\_IS\_PRO' ) ) { |
| [399](#L399) | $this->register\_pro\_features(); |
| [400](#L400) | } else { |
| [401](#L401) | $this->register\_free\_features(); |
| [402](#L402) | } |
| [403](#L403) | } |
| [404](#L404) |  |
| [405](#L405) | /\*\* |
| [406](#L406) | \* Whether or not this instance of the plugin is Pro. |
| [407](#L407) | \* |
| [408](#L408) | \* @return bool |
| [409](#L409) | \*/ |
| [410](#L410) | public static function is\_pro(): bool { |
| [411](#L411) | return (bool) apply\_filters( 'mv\_create\_is\_pro', false ); |
| [412](#L412) | } |
| [413](#L413) |  |
| [414](#L414) | /\*\* |
| [415](#L415) | \* Register Pro-only features. |
| [416](#L416) | \*/ |
| [417](#L417) | public function register\_pro\_features() { |
| [418](#L418) | add\_filter( 'mv\_create\_is\_pro', '\_\_return\_true' ); |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | /\*\* |
| [422](#L422) | \* Register Free-only features. |
| [423](#L423) | \*/ |
| [424](#L424) | public function register\_free\_features() { |
| [425](#L425) | // Do nothing. |
| [426](#L426) | } |
| [427](#L427) |  |
| [428](#L428) | /\*\* |
| [429](#L429) | \* Handle registration of all settings classes and pass complete array |
| [430](#L430) | \* @return array |
| [431](#L431) | \*/ |
| [432](#L432) | public static function get\_settings() { |
| [433](#L433) | // Settings classes divided by groups |
| [434](#L434) | $settings = [ |
| [435](#L435) | [ |
| [436](#L436) | 'slug'  => self::$settings\_group . '\_measurement\_system', |
| [437](#L437) | 'value' => null, |
| [438](#L438) | 'group' => self::$settings\_group, |
| [439](#L439) | 'order' => 20, |
| [440](#L440) | 'data'  => [ |
| [441](#L441) | 'type'         => 'select', |
| [442](#L442) | 'label'        => \_\_( 'Measurement System', 'mediavine' ), |
| [443](#L443) | 'instructions' => \_\_( 'Force a default measurement system (or choose "Any" to allow either).', 'mediavine' ), |
| [444](#L444) | 'default'      => null, |
| [445](#L445) | 'options'      => [ |
| [446](#L446) | [ |
| [447](#L447) | 'label' => \_\_( 'Metric', 'mediavine' ), |
| [448](#L448) | 'value' => 'metric', |
| [449](#L449) | ], |
| [450](#L450) | [ |
| [451](#L451) | 'label' => \_\_( 'Imperial', 'mediavine' ), |
| [452](#L452) | 'value' => 'imperial', |
| [453](#L453) | ], |
| [454](#L454) | [ |
| [455](#L455) | 'label' => \_\_( 'Any', 'mediavine' ), |
| [456](#L456) | 'value' => 'any', |
| [457](#L457) | ], |
| [458](#L458) | ], |
| [459](#L459) | ], |
| [460](#L460) | ], |
| [461](#L461) | [ |
| [462](#L462) | 'slug'  => self::$settings\_group . '\_secondary\_color', |
| [463](#L463) | 'value' => null, |
| [464](#L464) | 'group' => 'mv\_create\_hidden', |
| [465](#L465) | 'order' => '0', |
| [466](#L466) | 'data'  => [], |
| [467](#L467) | ], |
| [468](#L468) | [ |
| [469](#L469) | 'slug'  => self::$settings\_group . '\_api\_token', |
| [470](#L470) | 'value' => null, |
| [471](#L471) | 'group' => self::$settings\_group . '\_api', |
| [472](#L472) | 'order' => 105, |
| [473](#L473) | 'data'  => [ |
| [474](#L474) | 'type'         => 'api\_authentication', |
| [475](#L475) | 'label'        => \_\_( 'Product Registration', 'mediavine' ), |
| [476](#L476) | 'instructions' => \_\_( 'In order to use services like nutrition calculation or link scraping, you must register an account. This is a free, one-time action that will grant access to all of our external APIs.', 'mediavine' ), |
| [477](#L477) | ], |
| [478](#L478) | ], |
| [479](#L479) | [ |
| [480](#L480) | 'slug'  => self::$settings\_group . '\_api\_email\_confirmed', |
| [481](#L481) | 'value' => false, |
| [482](#L482) | 'group' => 'hidden', |
| [483](#L483) | 'order' => 105, |
| [484](#L484) | 'data'  => [], |
| [485](#L485) | ], |
| [486](#L486) | [ |
| [487](#L487) | 'slug'  => self::$settings\_group . '\_api\_user\_id', |
| [488](#L488) | 'value' => false, |
| [489](#L489) | 'group' => 'hidden', |
| [490](#L490) | 'order' => 105, |
| [491](#L491) | 'data'  => [], |
| [492](#L492) | ], |
| [493](#L493) | [ |
| [494](#L494) | 'slug'  => self::$settings\_group . '\_enable\_debugging', |
| [495](#L495) | 'value' => false, |
| [496](#L496) | 'group' => 'mv\_secret\_do\_not\_share\_or\_you\_will\_be\_fired', |
| [497](#L497) | 'order' => 10, |
| [498](#L498) | 'data'  => [ |
| [499](#L499) | 'type'         => 'checkbox', |
| [500](#L500) | 'label'        => \_\_( 'Enabled Debugging', 'mediavine' ), |
| [501](#L501) | 'instructions' => \_\_( 'Enable this setting to send all error log data to Sentry for the Publisher Engineering team to debug. This reduces the need for FTP and should be used in lieu of debug log/error log files.', 'mediavine' ), |
| [502](#L502) | 'default'      => 'Disabled', |
| [503](#L503) | ], |
| [504](#L504) | ], |
| [505](#L505) | ]; |
| [506](#L506) |  |
| [507](#L507) | $settings = array\_merge( |
| [508](#L508) | Advanced::settings(), |
| [509](#L509) | Display::settings(), |
| [510](#L510) | Lists::settings(), |
| [511](#L511) | Recipes::settings(), |
| [512](#L512) | Pro::settings(), |
| [513](#L513) | Affiliates::settings(), |
| [514](#L514) | Control\_Panel::settings(), |
| [515](#L515) | $settings |
| [516](#L516) | ); |
| [517](#L517) |  |
| [518](#L518) | return apply\_filters( 'mv\_create\_init\_settings', $settings ); |
| [519](#L519) | } |
| [520](#L520) |  |
| [521](#L521) | /\*\* |
| [522](#L522) | \* Updates Create Services Site ID with php, create and wp versions |
| [523](#L523) | \* |
| [524](#L524) | \* @return void |
| [525](#L525) | \*/ |
| [526](#L526) | function update\_services\_api() { |
| [527](#L527) | global $wp\_version; |
| [528](#L528) | $php\_version       = PHP\_VERSION; |
| [529](#L529) | $create\_version    = Plugin::VERSION; |
| [530](#L530) | $api\_token\_setting = \Mediavine\Settings::get\_settings( 'mv\_create\_api\_token' ); |
| [531](#L531) |  |
| [532](#L532) | if ( ! $api\_token\_setting ) { |
| [533](#L533) | return; |
| [534](#L534) | } |
| [535](#L535) |  |
| [536](#L536) | $token\_values = explode( '.', $api\_token\_setting->value ); |
| [537](#L537) |  |
| [538](#L538) | if ( empty( $token\_values[1] ) ) { |
| [539](#L539) | return; |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | $token\_data = json\_decode( base64\_decode( $token\_values[1] ) ); |
| [543](#L543) |  |
| [544](#L544) | if ( ! isset( $token\_data->site\_id ) ) { |
| [545](#L545) | return; |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | $data = []; |
| [549](#L549) |  |
| [550](#L550) | if ( isset( $php\_version ) ) { |
| [551](#L551) | $data['php\_version'] = PHP\_VERSION; |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | if ( isset( $wp\_version ) ) { |
| [555](#L555) | $data['wp\_version'] = $wp\_version; |
| [556](#L556) | } |
| [557](#L557) |  |
| [558](#L558) | if ( isset( $create\_version ) ) { |
| [559](#L559) | $data['create\_version'] = $create\_version; |
| [560](#L560) | } |
| [561](#L561) |  |
| [562](#L562) | $result = wp\_remote\_post( |
| [563](#L563) | 'https://create-api.mediavine.com/api/v1/sites/' . $token\_data->site\_id, [ |
| [564](#L564) | 'headers' => [ |
| [565](#L565) | 'Content-Type'  => 'application/json; charset=utf-8', |
| [566](#L566) | 'Authorization' => 'bearer ' . $api\_token\_setting->value, |
| [567](#L567) | ], |
| [568](#L568) | 'body'    => wp\_json\_encode( $data ), |
| [569](#L569) | 'method'  => 'POST', |
| [570](#L570) | ] |
| [571](#L571) | ); |
| [572](#L572) | return; |
| [573](#L573) | } |
| [574](#L574) |  |
| [575](#L575) | public function mv\_schema\_meta\_shortcode( $atts ) { |
| [576](#L576) | if ( isset( $atts['name'] ) ) { |
| [577](#L577) | return '<span data-schema-name="' . esc\_attr( $atts['name'] ) . '" style="display: none;"></span>'; |
| [578](#L578) | } |
| [579](#L579) | return ''; |
| [580](#L580) | } |
| [581](#L581) |  |
| [582](#L582) | public function mv\_img\_shortcode( $atts ) { |
| [583](#L583) | $a = shortcode\_atts( |
| [584](#L584) | [ |
| [585](#L585) | 'id'      => null, |
| [586](#L586) | 'options' => null, |
| [587](#L587) | 'no-pin'  => null, // @todo check for option to turn pinning on or off |
| [588](#L588) | ], $atts |
| [589](#L589) | ); |
| [590](#L590) |  |
| [591](#L591) | if ( isset( $a['id'] ) ) { |
| [592](#L592) | $attr = []; |
| [593](#L593) | if ( isset( $a['no-pin'] ) ) { |
| [594](#L594) | $attr['data-pin-nopin'] = $a['no-pin']; |
| [595](#L595) | } |
| [596](#L596) |  |
| [597](#L597) | if ( isset( $a['options'] ) ) { |
| [598](#L598) | $meta    = wp\_prepare\_attachment\_for\_js( $a['id'] ); |
| [599](#L599) | $alt     = $meta['alt']; |
| [600](#L600) | $title   = $meta['title']; |
| [601](#L601) | $options = json\_decode( $a['options'] ); |
| [602](#L602) |  |
| [603](#L603) | $class = 'align' . esc\_attr( $options->alignment ) . ' size-' . esc\_attr( $options->size ) . ' wp-image-' . $a['id']; |
| [604](#L604) | $class = apply\_filters( 'get\_image\_tag\_class', $class, $a['id'], $options->alignment, $options->size ); |
| [605](#L605) |  |
| [606](#L606) | $attr = [ |
| [607](#L607) | 'alt'   => $alt, |
| [608](#L608) | 'title' => $title, |
| [609](#L609) | 'class' => $class, |
| [610](#L610) | ]; |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | $img = wp\_get\_attachment\_image( $a['id'], '', false, $attr ); |
| [614](#L614) |  |
| [615](#L615) | return $img; |
| [616](#L616) | } |
| [617](#L617) | return ''; |
| [618](#L618) | } |
| [619](#L619) |  |
| [620](#L620) | /\*\* |
| [621](#L621) | \* In 1.4.12, we moved ad insertion logic from the admin UI to the client, see #2860. |
| [622](#L622) | \* This shortcode output is intentionally left empty to provide backwards compatibility |
| [623](#L623) | \* with content that includes the old ad target shortcode. |
| [624](#L624) | \*/ |
| [625](#L625) | public function mvc\_ad\_shortcode() { |
| [626](#L626) | return ''; |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | public function create\_settings() { |
| [630](#L630) | $settings = $this->update\_settings( self::$settings ); |
| [631](#L631) | \Mediavine\Settings::create\_settings\_filter( $settings ); |
| [632](#L632) | } |
| [633](#L633) |  |
| [634](#L634) | public function create\_shapes() { |
| [635](#L635) | $shape\_dbi = new \Mediavine\MV\_DBI( 'mv\_shapes' ); |
| [636](#L636) |  |
| [637](#L637) | foreach ( self::$shapes as $shape ) { |
| [638](#L638) | $shape\_dbi->upsert( $shape ); |
| [639](#L639) | } |
| [640](#L640) | } |
| [641](#L641) |  |
| [642](#L642) | /\*\* |
| [643](#L643) | \* Migrates old settings to newer versions within settings table |
| [644](#L644) | \* |
| [645](#L645) | \* Always check for less than current version as this is run before the version is updated |
| [646](#L646) | \* Add estimated removal date (6 months) so we don't clutter code with future publishes |
| [647](#L647) | \* Remove code within this function, but don't remove this function |
| [648](#L648) | \* |
| [649](#L649) | \* Example usage: |
| [650](#L650) | \* ``` |
| [651](#L651) | \* if ( version\_compare( $last\_plugin\_version, '1.0.0', '<' ) ) { |
| [652](#L652) | \*     $settings = \Mediavine\Settings::migrate\_setting\_value( $settings, self::$settings\_group . '\_slug', 'old\_value', 'new\_value' ); |
| [653](#L653) | \*     $settings = \Mediavine\Settings::migrate\_setting\_slug( $settings, self::$settings\_group . '\_old\_slug', self::$settings\_group . '\_new\_slug' ); |
| [654](#L654) | \* } |
| [655](#L655) | \* ``` |
| [656](#L656) | \* |
| [657](#L657) | \* @param   array  $settings  Current list of settings before running create settings |
| [658](#L658) | \* @return  array             List of settings after migrated changes made |
| [659](#L659) | \*/ |
| [660](#L660) | public function update\_settings( $settings ) { |
| [661](#L661) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [662](#L662) |  |
| [663](#L663) | // Update incorrect card style slug of mv\_create to square (Remove Jan 2020) |
| [664](#L664) | if ( version\_compare( $last\_plugin\_version, '1.4.8', '<' ) ) { |
| [665](#L665) | $settings = \Mediavine\Settings::migrate\_setting\_value( $settings, self::$settings\_group . '\_card\_style', 'mv\_create', 'square' ); |
| [666](#L666) | } |
| [667](#L667) |  |
| [668](#L668) | return $settings; |
| [669](#L669) | } |
| [670](#L670) |  |
| [671](#L671) | public function fix\_video\_description( $id ) { |
| [672](#L672) | // fix the video description |
| [673](#L673) | $creations = new \Mediavine\MV\_DBI( 'mv\_creations' ); |
| [674](#L674) | $creation  = $creations->find\_one\_by\_id( $id ); |
| [675](#L675) |  |
| [676](#L676) | if ( ! empty( $creation->video ) ) { |
| [677](#L677) | $video\_data         = json\_decode( $creation->video ); |
| [678](#L678) | $make\_the\_call      = false; |
| [679](#L679) | $video\_data\_changed = false; |
| [680](#L680) | $update\_data        = [ |
| [681](#L681) | 'id' => $creation->id, |
| [682](#L682) | ]; |
| [683](#L683) |  |
| [684](#L684) | if ( empty( $video\_data->description ) ) { |
| [685](#L685) | if ( |
| [686](#L686) | ! empty( $video\_data->rawData ) && |
| [687](#L687) | ! empty( $video\_data->rawData->description ) |
| [688](#L688) | ) { |
| [689](#L689) | $video\_data->description = $video\_data->rawData->description; |
| [690](#L690) | $video\_data\_changed      = true; |
| [691](#L691) | } else { |
| [692](#L692) | $make\_the\_call = true; |
| [693](#L693) | } |
| [694](#L694) | } |
| [695](#L695) |  |
| [696](#L696) | if ( empty( $video\_data->duration ) ) { |
| [697](#L697) | if ( |
| [698](#L698) | ! empty( $video\_data->rawData ) && |
| [699](#L699) | ! empty( $video\_data->rawData->duration ) |
| [700](#L700) | ) { |
| [701](#L701) | $video\_data->duration = 'PT' . $video\_data->rawData->duration . 'S'; |
| [702](#L702) | $video\_data\_changed   = true; |
| [703](#L703) | } else { |
| [704](#L704) | $make\_the\_call = true; |
| [705](#L705) | } |
| [706](#L706) | } |
| [707](#L707) |  |
| [708](#L708) | if ( $make\_the\_call && $video\_data->slug ) { |
| [709](#L709) | $api\_data = file\_get\_contents( 'https://embed.mediavine.com/oembed/?url=https%3A%2F%2Fvideo.mediavine.com%2Fvideos%2F' . $video\_data->slug ); |
| [710](#L710) | if ( $api\_data ) { |
| [711](#L711) | $new\_video\_data = json\_decode( $api\_data ); |
| [712](#L712) |  |
| [713](#L713) | if ( ! empty( $new\_video\_data->duration ) ) { |
| [714](#L714) | $video\_data->duration = 'PT' . $new\_video\_data->duration . 'S'; |
| [715](#L715) | $video\_data\_changed   = true; |
| [716](#L716) | } |
| [717](#L717) |  |
| [718](#L718) | if ( ! empty( $new\_video\_data->description ) ) { |
| [719](#L719) | $video\_data->description = $new\_video\_data->description; |
| [720](#L720) | $video\_data\_changed      = true; |
| [721](#L721) | } |
| [722](#L722) |  |
| [723](#L723) | if ( ! empty( $new\_video\_data->keywords ) ) { |
| [724](#L724) | $video\_data->keywords = $new\_video\_data->keywords; |
| [725](#L725) | $video\_data\_changed   = true; |
| [726](#L726) | } |
| [727](#L727) | } |
| [728](#L728) | } |
| [729](#L729) |  |
| [730](#L730) | if ( $video\_data\_changed ) { |
| [731](#L731) | $creation->video      = wp\_json\_encode( $video\_data ); |
| [732](#L732) | $update\_data['video'] = $creation->video; |
| [733](#L733) | if ( ! empty( $creation->json\_ld ) ) { |
| [734](#L734) | $json\_ld     = json\_decode( $creation->json\_ld ); |
| [735](#L735) | $upload\_date = $json\_ld->video->uploadDate; |
| [736](#L736) | if ( ! empty( $video\_data->rawData->uploadDate ) ) { |
| [737](#L737) | $upload\_date = $video\_data->rawData->uploadDate; |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | $json\_ld->video         = [ |
| [741](#L741) | '@type'        => 'VideoObject', |
| [742](#L742) | 'name'         => $json\_ld->video->name, |
| [743](#L743) | 'description'  => $video\_data->description, |
| [744](#L744) | 'thumbnailUrl' => $json\_ld->video->thumbnailUrl, |
| [745](#L745) | 'contentUrl'   => $json\_ld->video->contentUrl, |
| [746](#L746) | 'duration'     => $video\_data->duration, |
| [747](#L747) | 'uploadDate'   => $upload\_date, |
| [748](#L748) | ]; |
| [749](#L749) | $creation->json\_ld      = wp\_json\_encode( $json\_ld ); |
| [750](#L750) | $update\_data['json\_ld'] = $creation->json\_ld; |
| [751](#L751) |  |
| [752](#L752) | if ( ! empty( $creation->published ) ) { |
| [753](#L753) | $published\_data           = json\_decode( $creation->published ); |
| [754](#L754) | $published\_data->video    = $creation->json\_ld; |
| [755](#L755) | $update\_data['published'] = wp\_json\_encode( $published\_data ); |
| [756](#L756) | } |
| [757](#L757) | } |
| [758](#L758) |  |
| [759](#L759) | $creations->update( $update\_data ); |
| [760](#L760) |  |
| [761](#L761) | } |
| [762](#L762) | } |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | /\*\* |
| [766](#L766) | \* Updates cards based on various queues and actions. |
| [767](#L767) | \* |
| [768](#L768) | \* Always check for less than current version as this is run before the version is updated. |
| [769](#L769) | \* Add estimated removal date (around 6 months). |
| [770](#L770) | \* |
| [771](#L771) | \* @return void |
| [772](#L772) | \*/ |
| [773](#L773) | public function update\_queue() { |
| [774](#L774) | $creations           = new MV\_DBI( 'mv\_creations' ); |
| [775](#L775) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [776](#L776) |  |
| [777](#L777) | // add version compares here |
| [778](#L778) | // use `Publish::selective\_update\_queue( $creation\_ids, 'fix\_name' );` to selectively update |
| [779](#L779) | // add an action in the plugin `init` method under `fixes` where the action name is `mv\_[fix\_name]\_queue\_action` |
| [780](#L780) |  |
| [781](#L781) | // FIX VIDEO DESCRIPTIONS -- Remove May 2020 |
| [782](#L782) | if ( version\_compare( $last\_plugin\_version, '1.5.4', '<' ) ) { |
| [783](#L783) | // get creation IDS |
| [784](#L784) | $args = [ |
| [785](#L785) | 'select' => [ 'id' ], |
| [786](#L786) | 'limit'  => 10000, |
| [787](#L787) | ]; |
| [788](#L788) | $ids  = array\_values( wp\_list\_pluck( $creations->find( $args ), 'id' ) ); |
| [789](#L789) | if ( ! empty( $ids ) ) { |
| [790](#L790) | Publish::selective\_update\_queue( $ids, 'fix\_video\_description' ); |
| [791](#L791) | } |
| [792](#L792) | } |
| [793](#L793) | } |
| [794](#L794) |  |
| [795](#L795) | /\*\* |
| [796](#L796) | \* Republishes create cards depending on plugin version |
| [797](#L797) | \* |
| [798](#L798) | \* Always check for less than current version as this is run before the version is updated |
| [799](#L799) | \* Add estimated removal date (6 months) so we don't clutter code with future publishes |
| [800](#L800) | \* Remove code within this function, but don't remove this function |
| [801](#L801) | \* |
| [802](#L802) | \* @return  void |
| [803](#L803) | \*/ |
| [804](#L804) | public function republish\_queue() { |
| [805](#L805) | global $wpdb; |
| [806](#L806) | $creations = new \Mediavine\MV\_DBI( 'mv\_creations' ); |
| [807](#L807) | $creations->set\_limit( 10000 ); |
| [808](#L808) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [809](#L809) |  |
| [810](#L810) | // Remove trailing comma from time\_display values that appeared for unknown reasons (Remove February 2021) |
| [811](#L811) | if ( version\_compare( $last\_plugin\_version, '1.7.2', '<' ) ) { |
| [812](#L812) | $cards = $creations->where( [ 'time\_display', 'LIKE', '%,' ] ); |
| [813](#L813) | foreach ( $cards as $card ) { |
| [814](#L814) | $card->time\_display = trim( $card->time\_display, ',' ); |
| [815](#L815) | $creations->update( |
| [816](#L816) | [ |
| [817](#L817) | 'id'           => $card->id, |
| [818](#L818) | 'time\_display' => $card->time\_display, |
| [819](#L819) | ] |
| [820](#L820) | ); |
| [821](#L821) | } |
| [822](#L822) | $ids = array\_values( wp\_list\_pluck( $cards, 'id' ) ); |
| [823](#L823) | if ( ! empty( $ids ) ) { |
| [824](#L824) | \Mediavine\Create\Publish::update\_publish\_queue( $ids ); |
| [825](#L825) | } |
| [826](#L826) | } |
| [827](#L827) | } |
| [828](#L828) |  |
| [829](#L829) | /\*\* |
| [830](#L830) | \* Display importer download admin notice |
| [831](#L831) | \* |
| [832](#L832) | \* @return void |
| [833](#L833) | \*/ |
| [834](#L834) | public function importer\_admin\_notice\_display() { |
| [835](#L835) | printf( |
| [836](#L836) | '<div class="notice notice-info"><p><strong>%1$s</strong></p><p>%2$s</p></div>', |
| [837](#L837) | wp\_kses\_post( \_\_( 'Thanks for installing Create by Mediavine!', 'mediavine' ) ), |
| [838](#L838) | wp\_kses\_post( |
| [839](#L839) | sprintf( |
| [840](#L840) | /\* translators: %1$s: linked importer plugin \*/ |
| [841](#L841) | \_\_( 'If you\'re moving from another recipe plugin, you can also download and install our %1$s.', 'mediavine' ), |
| [842](#L842) | '<a href="https://www.mediavine.com/mediavine-recipe-importers-download" target="\_blank">' . \_\_( 'importer plugin', 'mediavine' ) . '</a>' |
| [843](#L843) | ) |
| [844](#L844) | ) |
| [845](#L845) | ); |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* Display importer download admin notice if plugin not active |
| [850](#L850) | \* |
| [851](#L851) | \* @return void |
| [852](#L852) | \*/ |
| [853](#L853) | public function importer\_admin\_notice() { |
| [854](#L854) | if ( ! class\_exists( 'Mediavine\Create\Importer\Plugin' ) ) { |
| [855](#L855) | add\_action( 'admin\_notices', [ $this, 'importer\_admin\_notice\_display' ] ); |
| [856](#L856) | } |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | /\*\* |
| [860](#L860) | \* Fixes reviews that were imported from other plugins. |
| [861](#L861) | \* |
| [862](#L862) | \* Importers were assigning a `recipe\_id` to imported reviews instead of `creation`. |
| [863](#L863) | \* This caused reviews to not show up, even though they'd been imported. |
| [864](#L864) | \* This method fixes that by reassigning imported reviews. |
| [865](#L865) | \* |
| [866](#L866) | \* Remove Apr 2019 |
| [867](#L867) | \* |
| [868](#L868) | \* @since 1.1.1 |
| [869](#L869) | \* |
| [870](#L870) | \* @return {void} |
| [871](#L871) | \*/ |
| [872](#L872) | public function update\_reviews\_table() { |
| [873](#L873) | global $wpdb; |
| [874](#L874) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [875](#L875) |  |
| [876](#L876) | if ( version\_compare( $last\_plugin\_version, '1.2.0', '<' ) ) { |
| [877](#L877) | // Not all users had the plugin when `recipe\_id` was a column in the `mv\_reviews` table. |
| [878](#L878) | // Check for this column before trying to update it. |
| [879](#L879) | // SECURITY CHECKED: Nothing in this query can be sanitized. |
| [880](#L880) | $has\_recipe\_id\_column\_statement = "SHOW COLUMNS FROM {$wpdb->prefix}mv\_reviews LIKE 'recipe\_id'"; |
| [881](#L881) | $has\_recipe\_id\_column           = $wpdb->get\_row( $has\_recipe\_id\_column\_statement ); |
| [882](#L882) | if ( ! $has\_recipe\_id\_column ) { |
| [883](#L883) | return; |
| [884](#L884) | } |
| [885](#L885) |  |
| [886](#L886) | // SECURITY CHECKED: Nothing in this query can be sanitized. |
| [887](#L887) | $statement = "UPDATE {$wpdb->prefix}mv\_reviews a |
| [888](#L888) | INNER JOIN {$wpdb->prefix}mv\_reviews b on a.id = b.id |
| [889](#L889) | SET a.creation = b.recipe\_id |
| [890](#L890) | WHERE b.recipe\_id"; |
| [891](#L891) | $wpdb->query( $statement ); |
| [892](#L892) | } |
| [893](#L893) | } |
| [894](#L894) |  |
| [895](#L895) | /\*\* |
| [896](#L896) | \* Fixes cloned cards' ratings. |
| [897](#L897) | \* |
| [898](#L898) | \* Previously, cloned cards retained the originating card's `rating` and `rating\_count` |
| [899](#L899) | \* attributes, giving the client-facing card the appearance of its ratings having been |
| [900](#L900) | \* duplicated. Resetting the count resolves this issue. |
| [901](#L901) | \* |
| [902](#L902) | \* Remove November 2019 |
| [903](#L903) | \* |
| [904](#L904) | \* @since 1.3.20 |
| [905](#L905) | \* |
| [906](#L906) | \* @return void |
| [907](#L907) | \*/ |
| [908](#L908) | public function fix\_cloned\_ratings() { |
| [909](#L909) | global $wpdb; |
| [910](#L910) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [911](#L911) |  |
| [912](#L912) | if ( version\_compare( $last\_plugin\_version, '1.3.20', '<' ) ) { |
| [913](#L913) | // SECURITY CHECKED: Nothing in this query can be sanitized. |
| [914](#L914) | $creations\_with\_ratings = $wpdb->get\_results( |
| [915](#L915) | "SELECT id as creation FROM {$wpdb->prefix}mv\_creations WHERE rating AND rating\_count;" |
| [916](#L916) | ); |
| [917](#L917) | $model                  = new Reviews\_Models(); |
| [918](#L918) | foreach ( $creations\_with\_ratings as $review ) { |
| [919](#L919) | $model->update\_creation\_rating( $review ); |
| [920](#L920) | } |
| [921](#L921) | } |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | /\*\* |
| [925](#L925) | \* Fixes canonical post ids of imported Cookbook recipes. |
| [926](#L926) | \* |
| [927](#L927) | \* Recipes imported from Cookbook were using the Cookbook recipe id as the canonical\_post\_id. |
| [928](#L928) | \* Obviously, this was not good, so we need to fix that. |
| [929](#L929) | \* |
| [930](#L930) | \* Remove December 2019 |
| [931](#L931) | \* |
| [932](#L932) | \* @since 1.4.6 |
| [933](#L933) | \* |
| [934](#L934) | \* @return void |
| [935](#L935) | \*/ |
| [936](#L936) | public function fix\_cookbook\_canonical\_post\_ids() { |
| [937](#L937) | global $wpdb; |
| [938](#L938) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [939](#L939) |  |
| [940](#L940) | if ( version\_compare( $last\_plugin\_version, '1.4.6', '<' ) ) { |
| [941](#L941) | // SECURITY CHECKED: Nothing in this query can be sanitized. |
| [942](#L942) | $creations = $wpdb->get\_results( |
| [943](#L943) | "SELECT \* FROM {$wpdb->prefix}mv\_creations WHERE type='recipe' AND metadata LIKE '%cookbook%' AND metadata NOT LIKE '%fixed\_canonical\_post\_id%'", |
| [944](#L944) | ARRAY\_A |
| [945](#L945) | ); |
| [946](#L946) | $ids       = []; |
| [947](#L947) | foreach ( $creations as $creation ) { |
| [948](#L948) | $post     = get\_post( $creation['canonical\_post\_id'] ); |
| [949](#L949) | $metadata = json\_decode( $creation['metadata'] ); |
| [950](#L950) | $posts    = json\_decode( $creation['associated\_posts'] ); |
| [951](#L951) | if ( 'cookbook\_recipe' === $post->post\_type && ! empty( $posts ) ) { |
| [952](#L952) | $creation['canonical\_post\_id'] = $posts[0]; |
| [953](#L953) | } |
| [954](#L954) | $metadata->fixed\_canonical\_post\_id = true; |
| [955](#L955) | $creation['metadata']              = wp\_json\_encode( $metadata ); |
| [956](#L956) | self::$models\_v2->mv\_creations->update\_without\_modified\_date( $creation ); |
| [957](#L957) | $ids[] = $creation->id; |
| [958](#L958) | } |
| [959](#L959) | \Mediavine\Create\Publish::update\_publish\_queue( $ids ); |
| [960](#L960) | } |
| [961](#L961) | } |
| [962](#L962) |  |
| [963](#L963) | /\*\* |
| [964](#L964) | \* Ensures all current versions of create cards store a revision. |
| [965](#L965) | \* |
| [966](#L966) | \* Remove January 2020 |
| [967](#L967) | \* |
| [968](#L968) | \* @since 1.4.11 |
| [969](#L969) | \* |
| [970](#L970) | \* @return void |
| [971](#L971) | \*/ |
| [972](#L972) | public function add\_initial\_revision\_to\_cards() { |
| [973](#L973) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [974](#L974) |  |
| [975](#L975) | if ( version\_compare( $last\_plugin\_version, '1.4.11', '<' ) ) { |
| [976](#L976) | Publish::add\_all\_to\_publish\_queue(); |
| [977](#L977) | } |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) | /\*\* |
| [981](#L981) | \* Queues up all currently existing Amazon products after the API changes |
| [982](#L982) | \* |
| [983](#L983) | \* Remove May 2020 |
| [984](#L984) | \* |
| [985](#L985) | \* @since 1.5.1 |
| [986](#L986) | \* |
| [987](#L987) | \* @return void |
| [988](#L988) | \*/ |
| [989](#L989) | public function queue\_existing\_amazon\_products() { |
| [990](#L990) | $last\_plugin\_version = get\_option( 'mv\_create\_version', Plugin::VERSION ); |
| [991](#L991) |  |
| [992](#L992) | if ( version\_compare( $last\_plugin\_version, '1.5.4', '<' ) ) { |
| [993](#L993) | $Products = Products::get\_instance(); |
| [994](#L994) | $Products->initial\_queue\_products(); |
| [995](#L995) | } |
| [996](#L996) | } |
| [997](#L997) |  |
| [998](#L998) | /\*\* |
| [999](#L999) | \* Sets the default JSON-LD Schema in Head setting to disabled for existing installs. |
| [1000](#L1000) | \* |
| [1001](#L1001) | \* Remove Sept 2021 |
| [1002](#L1002) | \* |
| [1003](#L1003) | \* @since 1.6.7 |
| [1004](#L1004) | \* |
| [1005](#L1005) | \* @return void |
| [1006](#L1006) | \*/ |
| [1007](#L1007) | public function set\_default\_schema\_setting\_on\_existing\_installs( $last\_plugin\_version ) { |
| [1008](#L1008) | // Don't run new installs (previous version newer than 1.6.7). |
| [1009](#L1009) | // We run the not (!) check because we sometimes give patch releases in an x.x.x.x format. |
| [1010](#L1010) | if ( ! version\_compare( $last\_plugin\_version, '1.6.7', '<' ) ) { |
| [1011](#L1011) | return; |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) | // Build mock setting for JSON-LD Schema in Head with disabled value. |
| [1015](#L1015) | $fake\_schema\_setting = [ |
| [1016](#L1016) | [ |
| [1017](#L1017) | 'slug'  => self::$settings\_group . '\_schema\_in\_head', |
| [1018](#L1018) | 'value' => false, |
| [1019](#L1019) | ], |
| [1020](#L1020) | ]; |
| [1021](#L1021) |  |
| [1022](#L1022) | // Create mock setting into database before real settings are updated. |
| [1023](#L1023) | // This will keep the value of the fake setting, but everything else of the real setting. |
| [1024](#L1024) | Settings::create\_settings( $fake\_schema\_setting ); |
| [1025](#L1025) | } |
| [1026](#L1026) |  |
| [1027](#L1027) | /\*\* |
| [1028](#L1028) | \* Deletes old settings that are no longer used in Create |
| [1029](#L1029) | \* |
| [1030](#L1030) | \* @return void |
| [1031](#L1031) | \*/ |
| [1032](#L1032) | public function delete\_old\_settings() { |
| [1033](#L1033) | \Mediavine\Settings::delete\_setting( self::$settings\_group . '\_enable\_link\_scraping' ); |
| [1034](#L1034) | \Mediavine\Settings::delete\_setting( self::$settings\_group . '\_ad\_density' ); |
| [1035](#L1035) | } |
| [1036](#L1036) |  |
| [1037](#L1037) | /\*\* |
| [1038](#L1038) | \* Extend default REST API with useful data. |
| [1039](#L1039) | \* |
| [1040](#L1040) | \* @param [object] $data the current object outbound to rest response |
| [1041](#L1041) | \* @param [object] $post post object for use in the outbound response |
| [1042](#L1042) | \* @param [object] $request the wp rest request object. |
| [1043](#L1043) | \* @return [object] update $data object |
| [1044](#L1044) | \*/ |
| [1045](#L1045) | public function rest\_prepare\_post( $data, $post, $request ) { |
| [1046](#L1046) | $\_data                        = $data->data; |
| [1047](#L1047) | $\_data['mv']                  = []; |
| [1048](#L1048) | $\_data['mv']['thumbnail\_id']  = null; |
| [1049](#L1049) | $\_data['mv']['thumbnail\_uri'] = null; |
| [1050](#L1050) |  |
| [1051](#L1051) | $thumbnail\_id = get\_post\_thumbnail\_id( $post->ID ); |
| [1052](#L1052) |  |
| [1053](#L1053) | if ( empty( $thumbnail\_id ) ) { |
| [1054](#L1054) | $data->data = $\_data; |
| [1055](#L1055) | return $data; |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | $thumbnail                   = wp\_get\_attachment\_image\_src( $thumbnail\_id, 'medium' ); |
| [1059](#L1059) | $\_data['mv']['thumbnail\_id'] = $thumbnail\_id; |
| [1060](#L1060) |  |
| [1061](#L1061) | if ( isset( $thumbnail[0] ) ) { |
| [1062](#L1062) | $\_data['mv']['thumbnail\_uri'] = $thumbnail[0]; |
| [1063](#L1063) | } |
| [1064](#L1064) |  |
| [1065](#L1065) | $data->data = $\_data; |
| [1066](#L1066) | return $data; |
| [1067](#L1067) | } |
| [1068](#L1068) |  |
| [1069](#L1069) | /\*\* |
| [1070](#L1070) | \* Retrieve an array of custom post-types that are public and not built-in |
| [1071](#L1071) | \* |
| [1072](#L1072) | \* @return array |
| [1073](#L1073) | \*/ |
| [1074](#L1074) | private function get\_custom\_post\_types() { |
| [1075](#L1075) | /\*\* |
| [1076](#L1076) | \* @var \WP\_Post\_Type[] |
| [1077](#L1077) | \*/ |
| [1078](#L1078) | $post\_types = get\_post\_types( |
| [1079](#L1079) | [ |
| [1080](#L1080) | 'public'   => true, |
| [1081](#L1081) | '\_builtin' => false, |
| [1082](#L1082) | ], 'objects' |
| [1083](#L1083) | ); |
| [1084](#L1084) |  |
| [1085](#L1085) | $allowed\_post\_types = []; |
| [1086](#L1086) | foreach ( $post\_types as $post\_type ) { |
| [1087](#L1087) | $post\_type\_label = $post\_type->label; |
| [1088](#L1088) | if ( ! empty( $post\_type->labels->singular\_name ) ) { |
| [1089](#L1089) | $post\_type\_label = $post\_type->labels->singular\_name; |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | $allowed\_post\_types[ $post\_type->name ] = $post\_type\_label; |
| [1093](#L1093) | } |
| [1094](#L1094) |  |
| [1095](#L1095) | return $allowed\_post\_types; |
| [1096](#L1096) | } |
| [1097](#L1097) |  |
| [1098](#L1098) | /\*\* |
| [1099](#L1099) | \* Register custom fields for users. |
| [1100](#L1100) | \*/ |
| [1101](#L1101) | public static function register\_custom\_fields() { |
| [1102](#L1102) | add\_filter( |
| [1103](#L1103) | 'mv\_create\_fields', function ( $arr ) { |
| [1104](#L1104) | $arr[] = [ |
| [1105](#L1105) | 'slug'         => 'class', |
| [1106](#L1106) | 'label'        => \_\_( 'CSS Class', 'mediavine' ), |
| [1107](#L1107) | 'instructions' => \_\_( 'Add an additional CSS class to this card.', 'mediavine' ), |
| [1108](#L1108) | 'type'         => 'text', |
| [1109](#L1109) | ]; |
| [1110](#L1110) | $arr[] = [ |
| [1111](#L1111) | 'slug'         => 'mv\_create\_nutrition\_disclaimer', |
| [1112](#L1112) | 'label'        => \_\_( 'Custom Nutrition Disclaimer', 'mediavine' ), |
| [1113](#L1113) | 'instructions' => \_\_( 'Example: Nutrition information isn’t always accurate.', 'mediavine' ), |
| [1114](#L1114) | 'type'         => 'textarea', |
| [1115](#L1115) | 'card'         => 'recipe', |
| [1116](#L1116) | ]; |
| [1117](#L1117) | $arr[] = [ |
| [1118](#L1118) | 'slug'         => 'mv\_create\_affiliate\_message', |
| [1119](#L1119) | 'label'        => \_\_( 'Custom Affiliate Message', 'mediavine' ), |
| [1120](#L1120) | 'instructions' => \_\_( 'Override the default affiliate message for this card.', 'mediavine' ), |
| [1121](#L1121) | 'type'         => 'textarea', |
| [1122](#L1122) | 'card'         => [ 'recipe', 'diy', 'list' ], |
| [1123](#L1123) | ]; |
| [1124](#L1124) | $arr[] = [ |
| [1125](#L1125) | 'slug'         => 'mv\_create\_show\_list\_affiliate\_message', |
| [1126](#L1126) | 'label'        => \_\_( 'Show Custom Affiliate Message', 'mediavine' ), |
| [1127](#L1127) | 'instructions' => \_\_( 'Check this box to display an affiliate message on this List.', 'mediavine' ), |
| [1128](#L1128) | 'type'         => 'checkbox', |
| [1129](#L1129) | 'card'         => 'list', |
| [1130](#L1130) | ]; |
| [1131](#L1131) |  |
| [1132](#L1132) | // Social footer overrides |
| [1133](#L1133) | if ( \Mediavine\Settings::get\_setting( 'mv\_create\_social\_footer', false ) ) { |
| [1134](#L1134) | $arr[] = [ |
| [1135](#L1135) | 'slug'         => 'mv\_create\_social\_footer\_icon', |
| [1136](#L1136) | 'label'        => \_\_( 'Social Footer Icon', 'mediavine' ), |
| [1137](#L1137) | 'instructions' => \_\_( 'Override the default social footer icon for this card.', 'mediavine' ), |
| [1138](#L1138) | 'type'         => 'select', |
| [1139](#L1139) | 'defaultValue' => 'default', |
| [1140](#L1140) | 'options'      => [ |
| [1141](#L1141) | 'default'   => 'Use Default', |
| [1142](#L1142) | 'facebook'  => 'Facebook', |
| [1143](#L1143) | 'instagram' => 'Instagram', |
| [1144](#L1144) | 'pinterest' => 'Pinterest', |
| [1145](#L1145) | ], |
| [1146](#L1146) | 'card'         => [ 'recipe', 'diy' ], |
| [1147](#L1147) | ]; |
| [1148](#L1148) | $arr[] = [ |
| [1149](#L1149) | 'slug'         => 'mv\_create\_social\_footer\_header', |
| [1150](#L1150) | 'label'        => \_\_( 'Social Footer Heading', 'mediavine' ), |
| [1151](#L1151) | 'instructions' => \_\_( 'Override the default social footer heading for this card.', 'mediavine' ), |
| [1152](#L1152) | 'type'         => 'text', |
| [1153](#L1153) | 'card'         => [ 'recipe', 'diy' ], |
| [1154](#L1154) | ]; |
| [1155](#L1155) | $arr[] = [ |
| [1156](#L1156) | 'slug'         => 'mv\_create\_social\_footer\_content', |
| [1157](#L1157) | 'label'        => \_\_( 'Social Footer Content', 'mediavine' ), |
| [1158](#L1158) | 'instructions' => \_\_( 'Override the default social footer content for this card.', 'mediavine' ), |
| [1159](#L1159) | 'type'         => 'wysiwyg', |
| [1160](#L1160) | 'card'         => [ 'recipe', 'diy' ], |
| [1161](#L1161) | ]; |
| [1162](#L1162) | } |
| [1163](#L1163) |  |
| [1164](#L1164) | return $arr; |
| [1165](#L1165) | } |
| [1166](#L1166) | ); |
| [1167](#L1167) | } |
| [1168](#L1168) |  |
| [1169](#L1169) | /\*\* |
| [1170](#L1170) | \* @return array[] |
| [1171](#L1171) | \*/ |
| [1172](#L1172) | public static function get\_shapes\_data() { |
| [1173](#L1173) | return [ |
| [1174](#L1174) | [ |
| [1175](#L1175) | 'name'   => \_\_( 'Recipe', 'mediavine' ), |
| [1176](#L1176) | 'plural' => \_\_( 'Recipes', 'mediavine' ), |
| [1177](#L1177) | 'slug'   => 'recipe', |
| [1178](#L1178) | 'icon'   => 'carrot', |
| [1179](#L1179) | 'shape'  => file\_get\_contents( \_\_DIR\_\_ . '/shapes/recipe.json' ), |
| [1180](#L1180) | ], |
| [1181](#L1181) | [ |
| [1182](#L1182) | 'name'   => \_\_( 'How-To', 'mediavine' ), |
| [1183](#L1183) | 'plural' => \_\_( 'How-Tos', 'mediavine' ), |
| [1184](#L1184) | 'slug'   => 'diy', |
| [1185](#L1185) | 'icon'   => 'lightbulb', |
| [1186](#L1186) | 'shape'  => file\_get\_contents( \_\_DIR\_\_ . '/shapes/how-to.json' ), |
| [1187](#L1187) | ], |
| [1188](#L1188) | [ |
| [1189](#L1189) | 'name'   => \_\_( 'List', 'mediavine' ), |
| [1190](#L1190) | 'plural' => \_\_( 'Lists', 'mediavine' ), |
| [1191](#L1191) | 'slug'   => 'list', |
| [1192](#L1192) | 'icon'   => '', |
| [1193](#L1193) | 'shape'  => file\_get\_contents( \_\_DIR\_\_ . '/shapes/list.json' ), |
| [1194](#L1194) | ], |
| [1195](#L1195) | ]; |
| [1196](#L1196) | } |
| [1197](#L1197) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/mediavine-create/trunk/class-plugin.php?format=txt)
* [Original Format](/export/3220658/mediavine-create/trunk/class-plugin.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

