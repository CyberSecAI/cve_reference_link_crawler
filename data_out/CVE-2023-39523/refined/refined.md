Based on the provided content, here's an analysis of the vulnerability described in CVE-2023-39523:

**Root Cause of Vulnerability:**

- The vulnerability stems from a command injection flaw within the `fetch_docker_image` function in `scanpipe/pipes/fetch.py`.
- The `docker_reference` parameter, which is user-controlled, is passed to the `get_docker_image_platform` function.
- Within `get_docker_image_platform`, a shell command is constructed using the user-supplied `docker_reference` without proper sanitization.
- The constructed shell command is then executed using `pipes.run_command`, allowing for command injection.

**Weaknesses/Vulnerabilities Present:**

- **Command Injection (CWE-77):** The primary weakness is the injection of arbitrary shell commands due to the lack of sanitization of user-provided input when constructing a command for execution. Specifically, the `docker_reference` is directly incorporated into a shell command string without validation.

**Impact of Exploitation:**

- **Arbitrary Command Execution:** An attacker can inject malicious commands, leading to arbitrary code execution on the server or container.
- **Potential Server/Container Damage:** Though the command injection is "blind" (without direct feedback to the attacker), it can potentially cause harm to the server or container by executing commands that compromise confidentiality, integrity, or availability.
- The provided example shows how to read `/etc/passwd` from the server/container and output `PoC`.

**Attack Vectors:**

- **User-Controlled Input:** The attack vector involves injecting malicious commands through the `docker_reference` parameter, which is user-controlled.
- **Project Creation/Modification:** A malicious user who can create or add inputs to a project can inject these commands.

**Required Attacker Capabilities/Position:**

- **Low Privileges Required:** An attacker needs low privileges to create/modify projects and provide malicious `docker_reference` values.
- **No User Interaction Required:** The vulnerability can be exploited without any user interaction.
- **Adjacent Network Access:** The attacker needs adjacent network access to the vulnerable system

**Technical Details:**
- The vulnerable code is located in the `scanpipe/pipes/fetch.py` file, specifically in `fetch_docker_image` and `get_docker_image_platform` functions
- The fix involves adding a regex to validate the docker\_reference variable and sanitizing the inputs.
- The `run_command` function in `scanpipe/pipes/__init__.py` was changed to use `shell=False` to prevent shell injection.

**Mitigation:**

- The vulnerability was fixed in commit `07ec0de1964b14bf085a1c9a27ece2b61ab6105c` by adding input sanitization.
- The fix also involved changing `subprocess.Popen` to `subprocess.run` and passing the command as a list, rather than a string, to avoid shell injection.

**CVSS Score:**

- **CVSS v3 Base Score:** 6.8
- **CVSS:3.1/AV:A/AC:L/PR:L/UI:N/S:U/C:L/I:L/A:H**
- **Attack Vector:** Adjacent
- **Attack Complexity:** Low
- **Privileges Required:** Low
- **User Interaction:** None
- **Scope:** Unchanged
- **Confidentiality:** Low
- **Integrity:** Low
- **Availability:** High