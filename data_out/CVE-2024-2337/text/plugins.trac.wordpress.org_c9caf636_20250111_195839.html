

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Feasy-testimonials%2Ftrunk%2Feasy-testimonials.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/easy-testimonials/trunk/easy-testimonials.php?rev=2846237 "Revision 2846237")
* Next Revision →
* [Blame](/browser/easy-testimonials/trunk/easy-testimonials.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/easy-testimonials/trunk/easy-testimonials.php)

---

# [source:](/browser?order=name "Go to repository root") [easy-testimonials](/browser/easy-testimonials?order=name "View easy-testimonials")/[trunk](/browser/easy-testimonials/trunk?order=name "View trunk")/[easy-testimonials.php](/browser/easy-testimonials/trunk/easy-testimonials.php?order=name "View easy-testimonials.php")

View diff against:

View revision:

| [Last change](/changeset/2877420/easy-testimonials/trunk/easy-testimonials.php "View differences") on this file was [2877420](/changeset/2877420/ "View changeset 2877420"), checked in by ghuger, [22 months ago](/timeline?from=2023-03-09T18%3A22%3A32Z&precision=second "See timeline at 03/09/2023 06:22:32 PM") |
| --- |
| More sanitization |
| **File size:** 79.7 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\* |
| [3](#L3) | Plugin Name: Easy Testimonials |
| [4](#L4) | Plugin URI: https://goldplugins.com/our-plugins/easy-testimonials-details/ |
| [5](#L5) | Description: Easy Testimonials - Provides custom post type, shortcode, sidebar widget, and other functionality for testimonials. |
| [6](#L6) | Author: Gold Plugins |
| [7](#L7) | Version: 3.9.5 |
| [8](#L8) | Author URI: https://goldplugins.com |
| [9](#L9) | Text Domain: easy-testimonials |
| [10](#L10) |  |
| [11](#L11) | This file is part of Easy Testimonials. |
| [12](#L12) |  |
| [13](#L13) | Easy Testimonials is free software: you can redistribute it and/or modify |
| [14](#L14) | it under the terms of the GNU General Public License as published by |
| [15](#L15) | the Free Software Foundation, either version 3 of the License, or |
| [16](#L16) | (at your option) any later version. |
| [17](#L17) |  |
| [18](#L18) | Easy Testimonials is distributed in the hope that it will be useful, |
| [19](#L19) | but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [20](#L20) | MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [21](#L21) | GNU General Public License for more details. |
| [22](#L22) |  |
| [23](#L23) | You should have received a copy of the GNU General Public License |
| [24](#L24) | along with Easy Testimonials .  If not, see <http://www.gnu.org/licenses/>. |
| [25](#L25) | \*/ |
| [26](#L26) |  |
| [27](#L27) | global $easy\_t\_footer\_css\_output; |
| [28](#L28) |  |
| [29](#L29) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/config.php" ); |
| [30](#L30) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/lib.php" ); |
| [31](#L31) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/BikeShed/bikeshed.php" ); |
| [32](#L32) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_Media\_Button/gold-plugins-media-button.class.php" ); |
| [33](#L33) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_Janus/gp-janus.class.php" ); |
| [34](#L34) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_Aloha/gp\_aloha.class.php" ); |
| [35](#L35) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_Sajak/gp\_sajak.class.php" ); |
| [36](#L36) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_SmartTextAvatars/GP\_SmartTextAvatarGenerator.class.php" ); |
| [37](#L37) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/GP\_Fake\_Data\_Generator/GP\_Fake\_Data\_Generator.class.php" ); |
| [38](#L38) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/gp-testimonial.class.php" ); |
| [39](#L39) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/ik-custom-post-type.php" ); |
| [40](#L40) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/lib/easy\_testimonials\_custom\_columns.php" ); |
| [41](#L41) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/settings/testimonial.options.php" ); |
| [42](#L42) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/maintenance/maintenance.php" ); |
| [43](#L43) | include\_once( ABSPATH . 'wp-admin/includes/plugin.php' ); // so we have access to is\_plugin\_active() |
| [44](#L44) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "include/tgmpa/init.php" ); |
| [45](#L45) |  |
| [46](#L46) | /\* blocks \*/ |
| [47](#L47) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "blocks/single-testimonial.php" ); |
| [48](#L48) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "blocks/random-testimonial.php" ); |
| [49](#L49) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "blocks/testimonials-list.php" ); |
| [50](#L50) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "blocks/testimonials-grid.php" ); |
| [51](#L51) | require\_once( plugin\_dir\_path( \_\_FILE\_\_ ) . "blocks/testimonials-cycle.php" ); |
| [52](#L52) |  |
| [53](#L53) |  |
| [54](#L54) | class easyTestimonials |
| [55](#L55) | { |
| [56](#L56) | var $shortcodes; |
| [57](#L57) | var $plugin; |
| [58](#L58) | var $config; |
| [59](#L59) | var $options; |
| [60](#L60) | var $media\_buttons; |
| [61](#L61) |  |
| [62](#L62) | function \_\_construct() |
| [63](#L63) | { |
| [64](#L64) | //catch weird cases when things don't exist and just exit |
| [65](#L65) | if( !class\_exists('easyTestimonialsConfig') ){ |
| [66](#L66) | return false; |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | //load config |
| [70](#L70) | $this->config = new easyTestimonialsConfig(); |
| [71](#L71) |  |
| [72](#L72) | //load options |
| [73](#L73) | $this->options = new easyTestimonialOptions($this->config); |
| [74](#L74) |  |
| [75](#L75) | //register shortcodes |
| [76](#L76) | $this->add\_shortcodes(); |
| [77](#L77) |  |
| [78](#L78) | //create media button object for use with editor widgets |
| [79](#L79) | $this->media\_buttons = new Gold\_Plugins\_Media\_Button('Testimonials', 'testimonial'); |
| [80](#L80) |  |
| [81](#L81) | //for use in upgrade, settings links |
| [82](#L82) | $this->plugin = plugin\_basename(\_\_FILE\_\_); |
| [83](#L83) |  |
| [84](#L84) | //only load Aloha and Janus on Admin screens |
| [85](#L85) | if( is\_admin() ){ |
| [86](#L86) | // load Janus |
| [87](#L87) | new GP\_Janus(); |
| [88](#L88) |  |
| [89](#L89) | // load Aloha |
| [90](#L90) | $aloha\_page\_title = $this->config->is\_pro |
| [91](#L91) | ? \_\_('Welcome To Easy Testimonials Pro') |
| [92](#L92) | : \_\_('Welcome To Easy Testimonials'); |
| [93](#L93) | $aloha\_config = array( |
| [94](#L94) | 'menu\_label' => \_\_('About Plugin'), |
| [95](#L95) | 'page\_title' => $aloha\_page\_title, |
| [96](#L96) | 'top\_level\_menu' => 'easy-testimonials-settings', |
| [97](#L97) | ); |
| [98](#L98) |  |
| [99](#L99) | $this->Aloha = new GP\_Aloha($aloha\_config); |
| [100](#L100) | add\_filter( 'gp\_aloha\_welcome\_page\_content\_easy-testimonials-settings', array($this, 'get\_welcome\_template') ); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | // wp\_kses will not allow <img> tags with data/png for the source, |
| [104](#L104) | // unless we add 'data' to the allowed protocols |
| [105](#L105) | add\_filter( 'kses\_allowed\_protocols', array($this, 'allow\_data\_protocol'), 10, 1 ); |
| [106](#L106) |  |
| [107](#L107) | //add editor widgets |
| [108](#L108) | add\_action( 'admin\_init', array($this, 'add\_media\_buttons') ); |
| [109](#L109) | if ( $this->config->is\_pro ) { |
| [110](#L110) | add\_action( 'admin\_enqueue\_scripts', array($this, 'enqueue\_inline\_script\_for\_notices') ); |
| [111](#L111) | add\_action( 'admin\_notices', array($this, 'pro\_plugin\_upgrade\_notice') ); |
| [112](#L112) | add\_action( 'wp\_ajax\_easy\_t\_dismiss\_pro\_plugin\_notice', array($this, 'dismiss\_pro\_plugin\_upgrade\_notice') ); |
| [113](#L113) | add\_action( 'activate\_easy-testimonials-pro/easy-testimonials-pro.php', array($this, 'pro\_activation\_hook') ); |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | //add JS |
| [117](#L117) | add\_action( 'wp\_enqueue\_scripts', array($this, 'easy\_testimonials\_setup\_js'), 9999 ); |
| [118](#L118) |  |
| [119](#L119) | // add Google web fonts if needed |
| [120](#L120) | add\_action( 'wp\_enqueue\_scripts', array($this, 'enqueue\_webfonts') ); |
| [121](#L121) |  |
| [122](#L122) | //add CSS |
| [123](#L123) | add\_action( 'wp\_enqueue\_scripts', array($this, 'easy\_testimonials\_setup\_css' ) ); |
| [124](#L124) |  |
| [125](#L125) | //add Custom CSS |
| [126](#L126) | add\_action( 'wp\_head', array($this, 'easy\_testimonials\_setup\_custom\_css') ); |
| [127](#L127) |  |
| [128](#L128) | //register sidebar widgets |
| [129](#L129) | add\_action( 'widgets\_init', array($this, 'easy\_testimonials\_register\_widgets' ) ); |
| [130](#L130) |  |
| [131](#L131) | //setup custom post type |
| [132](#L132) | add\_action( 'init', array($this, 'easy\_testimonials\_setup\_testimonials') ); |
| [133](#L133) |  |
| [134](#L134) | //add admin scripts |
| [135](#L135) | add\_action( 'admin\_enqueue\_scripts', array($this, 'easy\_testimonials\_admin\_enqueue\_scripts') ); |
| [136](#L136) |  |
| [137](#L137) | //check for conflicts |
| [138](#L138) | add\_action( 'admin\_enqueue\_scripts', array($this, 'easy\_testimonials\_conflict\_check') ); |
| [139](#L139) |  |
| [140](#L140) | //load text domain for translation purposes |
| [141](#L141) | add\_action( 'plugins\_loaded', array($this, 'easy\_t\_load\_textdomain') ); |
| [142](#L142) |  |
| [143](#L143) | //add custom columns to testimonial category list |
| [144](#L144) | add\_filter( 'manage\_edit-easy-testimonial-category\_columns', array($this, 'easy\_t\_cat\_column\_head'), 10 ); |
| [145](#L145) | add\_action( 'manage\_easy-testimonial-category\_custom\_column', array($this, 'easy\_t\_cat\_columns\_content'), 10, 3 ); |
| [146](#L146) |  |
| [147](#L147) | //add our custom links for Settings and Support to various places on the Plugins page |
| [148](#L148) | add\_filter( "plugin\_action\_links\_{$this->plugin}", array($this, 'add\_settings\_link\_to\_plugin\_action\_links' )); |
| [149](#L149) | add\_filter( 'plugin\_row\_meta', array($this, 'add\_custom\_links\_to\_plugin\_description'), 10, 2 ); |
| [150](#L150) |  |
| [151](#L151) | //add query var for paging |
| [152](#L152) | add\_filter( 'query\_vars', array($this, 'easy\_t\_add\_pagination\_query\_var' )); |
| [153](#L153) |  |
| [154](#L154) | //run activation steps |
| [155](#L155) | register\_activation\_hook( \_\_FILE\_\_, array($this, 'easy\_testimonials\_activation\_hook' )); |
| [156](#L156) |  |
| [157](#L157) | // first override blog post content function by avada to prevent it running on testimonials |
| [158](#L158) | // then apply our own content filter instead |
| [159](#L159) | if(get\_option('easy\_t\_avada\_filter\_override', false)){ |
| [160](#L160) | //attach our custom content filter to their action that will use our styling |
| [161](#L161) | add\_action('avada\_blog\_post\_content', array($this, 'easy\_t\_avada\_content\_filter') ); |
| [162](#L162) | } |
| [163](#L163) |  |
| [164](#L164) | //link hello t action to import function, for use via cron job |
| [165](#L165) | //the cron job is scheduled inside the advanced.options class |
| [166](#L166) | add\_action('hello\_t\_subscription', array($this->options->advanced\_settings\_page, 'add\_hello\_t\_testimonials') ); |
| [167](#L167) |  |
| [168](#L168) | //when you deactivate easy testimonials, disable the hello t cron job. |
| [169](#L169) | register\_deactivation\_hook( \_\_FILE\_\_, array($this->options->advanced\_settings\_page, 'hello\_t\_cron\_deactivate') ); |
| [170](#L170) |  |
| [171](#L171) | //set content filter flag when primary the\_content call is made (ie, the one in which our initial testimonials shortcode lay) |
| [172](#L172) | //this may be causing problems with us rendering shortcodes inside our plugin correctly, and may also be redundant |
| [173](#L173) | //as we already have another internal check to prevent us from applying this filter repeatedly with our plugin |
| [174](#L174) | //making this note to indicate the problem we are trying to solve by removing this line |
| [175](#L175) | //add\_filter('the\_content', array($this, 'set\_content\_flag'), 1 ); |
| [176](#L176) |  |
| [177](#L177) | //override content filter on single testimonial pages |
| [178](#L178) | //to load the proper HTML structure and content for displaying a testimonial |
| [179](#L179) | global $gp\_testimonial\_class; |
| [180](#L180) | $gp\_testimonial\_class = new GP\_Testimonial(false, $this->config); |
| [181](#L181) | add\_filter( 'the\_content', array($gp\_testimonial\_class, 'single\_testimonial\_content\_filter'), 10 ); |
| [182](#L182) |  |
| [183](#L183) | //clean broken images from testimonials, preventing occasional fatal errors on edit screens |
| [184](#L184) | add\_action( 'load-post.php', array($this,'fix\_testimonial\_featured\_images') ); |
| [185](#L185) |  |
| [186](#L186) | // setup custom columns on View All Testimonials screen |
| [187](#L187) | $ezt\_testionials\_cols = new Easy\_Testimonials\_Custom\_Columns(); |
| [188](#L188) |  |
| [189](#L189) | // make the list of themes available in JS (admin only) |
| [190](#L190) | add\_action( 'admin\_init', array($this, 'provide\_config\_data\_to\_admin') ); |
| [191](#L191) |  |
| [192](#L192) | // disable Gutenburg editor on Testimonials |
| [193](#L193) | add\_filter('use\_block\_editor\_for\_post\_type', array($this, 'disable\_gutenberg\_editor'), 10, 2); |
| [194](#L194) |  |
| [195](#L195) | // add Gutenburg custom blocks category |
| [196](#L196) | add\_filter( 'block\_categories\_all', array($this, 'add\_gutenburg\_block\_category'), 10, 2 ); |
| [197](#L197) |  |
| [198](#L198) | // add AJAX hooks for demo content creation/deletion |
| [199](#L199) | add\_action( 'wp\_ajax\_ezt\_delete\_demo\_testimonials', array($this, 'ajax\_delete\_demo\_testimonials') ); |
| [200](#L200) | add\_action( 'wp\_ajax\_ezt\_create\_demo\_testimonials', array($this, 'ajax\_create\_demo\_testimonials') ); |
| [201](#L201) | } |
| [202](#L202) |  |
| [203](#L203) | // Allow data as a protocol.  This is required to use data in an image tag |
| [204](#L204) | function allow\_data\_protocol($protocols) |
| [205](#L205) | { |
| [206](#L206) | if ( ! in\_array('data', $protocols) ) { |
| [207](#L207) | $protocols[] = 'data'; |
| [208](#L208) | } |
| [209](#L209) | return $protocols; |
| [210](#L210) | } |
| [211](#L211) |  |
| [212](#L212) | function provide\_config\_data\_to\_admin() |
| [213](#L213) | { |
| [214](#L214) | // Localize the script with new data |
| [215](#L215) | $translation\_array = array( |
| [216](#L216) | 'themes' => $this->config->load\_theme\_array(), |
| [217](#L217) | 'transitions' => $this->config->load\_cycle\_transitions(), |
| [218](#L218) | 'is\_pro' => $this->config->is\_pro, |
| [219](#L219) | 'theme\_group\_labels' => array( |
| [220](#L220) | 'standard\_themes' => \_\_('Free Themes', 'easy-testimonials'), |
| [221](#L221) | 'pro\_themes' => \_\_('Pro Themes', 'easy-testimonials'), |
| [222](#L222) | ), |
| [223](#L223) | ); |
| [224](#L224) | wp\_localize\_script( 'single-testimonial-block-editor', 'easy\_testimonials\_admin', $translation\_array ); |
| [225](#L225) | } |
| [226](#L226) |  |
| [227](#L227) | function disable\_gutenberg\_editor($current\_status, $post\_type) |
| [228](#L228) | { |
| [229](#L229) | if ('testimonial' === $post\_type) { |
| [230](#L230) | return false; |
| [231](#L231) | } |
| [232](#L232) | return $current\_status; |
| [233](#L233) | } |
| [234](#L234) |  |
| [235](#L235) | function add\_gutenburg\_block\_category ( $categories, $post ) |
| [236](#L236) | { |
| [237](#L237) | return array\_merge( |
| [238](#L238) | $categories, |
| [239](#L239) | array( |
| [240](#L240) | array( |
| [241](#L241) | 'slug'  => 'easy-testimonials', |
| [242](#L242) | 'title' => 'Easy Testimonials', |
| [243](#L243) | ), |
| [244](#L244) | ) |
| [245](#L245) | ); |
| [246](#L246) | } |
| [247](#L247) |  |
| [248](#L248) | function get\_welcome\_template() |
| [249](#L249) | { |
| [250](#L250) | $base\_path = plugin\_dir\_path( \_\_FILE\_\_ ); |
| [251](#L251) | $template\_path = $base\_path . '/include/content/welcome.php'; |
| [252](#L252) | $is\_pro = $this->config->is\_pro; |
| [253](#L253) | $content = file\_exists($template\_path) |
| [254](#L254) | ? include($template\_path) |
| [255](#L255) | : ''; |
| [256](#L256) | return $content; |
| [257](#L257) | } |
| [258](#L258) |  |
| [259](#L259) | //checks for a WP\_Error on this testimonial's featured image |
| [260](#L260) | //if there is an error, we unset the image to prevent edit screen from breaking |
| [261](#L261) | function fix\_testimonial\_featured\_images() |
| [262](#L262) | { |
| [263](#L263) | //if there is a post |
| [264](#L264) | if ( !empty($\_GET['post']) ){ |
| [265](#L265) | // Get the post object |
| [266](#L266) | $post = get\_post($\_GET['post']); |
| [267](#L267) | //and its a testimonial |
| [268](#L268) | if( !empty($post->post\_type) && $post->post\_type == "testimonial" ){ |
| [269](#L269) | // If the post has a bad featured image, remove the meta |
| [270](#L270) | if ( is\_wp\_error(get\_post\_thumbnail\_id($post->ID)) ) { |
| [271](#L271) | delete\_post\_meta($post->ID, '\_thumbnail\_id'); |
| [272](#L272) | } |
| [273](#L273) | } |
| [274](#L274) | } |
| [275](#L275) | } |
| [276](#L276) |  |
| [277](#L277) | //add media buttons |
| [278](#L278) | function add\_media\_buttons(){ |
| [279](#L279) | // add media buttons to admin |
| [280](#L280) | $media\_buttons = array(); |
| [281](#L281) |  |
| [282](#L282) | //single testimonial widget |
| [283](#L283) | $media\_buttons[] = array ( |
| [284](#L284) | 'title' => 'Single Testimonial', |
| [285](#L285) | 'shortcode' => $this->shortcodes['single\_testimonial\_shortcode'], |
| [286](#L286) | 'widget\_class' => 'singletestimonialwidget', |
| [287](#L287) | 'post\_type' => 'testimonial' |
| [288](#L288) |  |
| [289](#L289) | ); |
| [290](#L290) |  |
| [291](#L291) | //single testimonial widget |
| [292](#L292) | $media\_buttons[] = array ( |
| [293](#L293) | 'title' => 'Random Testimonial', |
| [294](#L294) | 'shortcode' => $this->shortcodes['random\_testimonial\_shortcode'], |
| [295](#L295) | 'widget\_class' => 'randomtestimonialwidget', |
| [296](#L296) | 'post\_type' => 'testimonial' |
| [297](#L297) |  |
| [298](#L298) | ); |
| [299](#L299) |  |
| [300](#L300) | //single testimonial widget |
| [301](#L301) | $media\_buttons[] = array ( |
| [302](#L302) | 'title' => 'List of Testimonials', |
| [303](#L303) | 'shortcode' => $this->shortcodes['testimonials\_shortcode'], |
| [304](#L304) | 'widget\_class' => 'listtestimonialswidget', |
| [305](#L305) | 'post\_type' => 'testimonial' |
| [306](#L306) |  |
| [307](#L307) | ); |
| [308](#L308) |  |
| [309](#L309) | //single testimonial widget |
| [310](#L310) | $media\_buttons[] = array ( |
| [311](#L311) | 'title' => 'Grid of Testimonials', |
| [312](#L312) | 'shortcode' => $this->shortcodes['testimonials\_grid\_shortcode'], |
| [313](#L313) | 'widget\_class' => 'testimonialsgridwidget', |
| [314](#L314) | 'post\_type' => 'testimonial' |
| [315](#L315) |  |
| [316](#L316) | ); |
| [317](#L317) |  |
| [318](#L318) | //single testimonial widget |
| [319](#L319) | $media\_buttons[] = array ( |
| [320](#L320) | 'title' => 'Testimonial Cycle', |
| [321](#L321) | 'shortcode' => $this->shortcodes['testimonials\_cycle\_shortcode'], |
| [322](#L322) | 'widget\_class' => 'cycledtestimonialwidget', |
| [323](#L323) | 'post\_type' => 'testimonial' |
| [324](#L324) |  |
| [325](#L325) | ); |
| [326](#L326) |  |
| [327](#L327) | $media\_buttons = apply\_filters( 'easy\_t\_admin\_media\_buttons', $media\_buttons ); |
| [328](#L328) |  |
| [329](#L329) | $cur\_post\_type = ( isset($\_GET['post']) ? get\_post\_type(intval($\_GET['post'])) : '' ); |
| [330](#L330) | //if( is\_admin() && ( empty($\_REQUEST['post\_type']) || $\_REQUEST['post\_type'] !== 'testimonial' ) && ($cur\_post\_type !== 'testimonial') ) |
| [331](#L331) | if( is\_admin() ) |
| [332](#L332) | { |
| [333](#L333) | foreach( $media\_buttons as $media\_button ){ |
| [334](#L334) | $this->media\_buttons->add\_button( $media\_button['title'], $media\_button['shortcode'], $media\_button['widget\_class'], $media\_button['post\_type']); |
| [335](#L335) | } |
| [336](#L336) | } |
| [337](#L337) | } |
| [338](#L338) |  |
| [339](#L339) | //setup the plugins shortcodes |
| [340](#L340) | function add\_shortcodes(){ |
| [341](#L341) | //build array of shortcodes to register |
| [342](#L342) | $this->shortcodes['random\_testimonial\_shortcode'] = get\_option('ezt\_random\_testimonial\_shortcode', 'random\_testimonial'); |
| [343](#L343) | $this->shortcodes['single\_testimonial\_shortcode'] = get\_option('ezt\_single\_testimonial\_shortcode', 'single\_testimonial'); |
| [344](#L344) | $this->shortcodes['testimonials\_shortcode'] = get\_option('ezt\_testimonials\_shortcode', 'testimonials'); |
| [345](#L345) | $this->shortcodes['testimonials\_cycle\_shortcode'] = get\_option('ezt\_cycle\_testimonial\_shortcode', 'testimonials\_cycle'); |
| [346](#L346) | $this->shortcodes['testimonials\_count\_shortcode'] = get\_option('ezt\_testimonials\_count\_shortcode', 'testimonials\_count'); |
| [347](#L347) | $this->shortcodes['testimonials\_grid\_shortcode'] = get\_option('ezt\_testimonials\_grid\_shortcode', 'testimonials\_grid'); |
| [348](#L348) |  |
| [349](#L349) | //TODO: check for shortcode conflicts |
| [350](#L350) | $this->easy\_testimonials\_shortcode\_checker($this->shortcodes); |
| [351](#L351) |  |
| [352](#L352) | //create shortcodes and gutenburg blocks |
| [353](#L353) | add\_shortcode( $this->shortcodes['single\_testimonial\_shortcode'], array($this, 'outputSingleTestimonial') ); |
| [354](#L354) | add\_shortcode( $this->shortcodes['random\_testimonial\_shortcode'], array($this, 'outputRandomTestimonial') ); |
| [355](#L355) | add\_shortcode( $this->shortcodes['testimonials\_shortcode'], array($this, 'outputTestimonials') ); |
| [356](#L356) | add\_shortcode( $this->shortcodes['testimonials\_cycle\_shortcode'], array($this, 'outputTestimonialsCycle') ); |
| [357](#L357) | add\_shortcode( $this->shortcodes['testimonials\_grid\_shortcode'], array($this, 'easy\_t\_testimonials\_grid\_shortcode') ); |
| [358](#L358) | add\_shortcode( $this->shortcodes['testimonials\_count\_shortcode'], array($this, 'outputTestimonialsCount') ); |
| [359](#L359) | add\_shortcode( 'easy\_t\_search\_testimonials', array($this, 'easy\_t\_search\_form\_shortcode') ); |
| [360](#L360) | //add\_shortcode( 'output\_all\_themes', array($this, 'outputAllThemes') ); |
| [361](#L361) |  |
| [362](#L362) | if ( function\_exists('register\_block\_type') ) { |
| [363](#L363) | register\_block\_type( 'easy-testimonials/single-testimonial', array( |
| [364](#L364) | 'editor\_script' => 'single-testimonial-block-editor', |
| [365](#L365) | 'editor\_style'  => 'single-testimonial-block-editor', |
| [366](#L366) | 'style'         => 'single-testimonial-block', |
| [367](#L367) | 'render\_callback' => array($this, 'outputSingleTestimonial') |
| [368](#L368) | ) ); |
| [369](#L369) |  |
| [370](#L370) | register\_block\_type( 'easy-testimonials/random-testimonial', array( |
| [371](#L371) | 'editor\_script' => 'random-testimonial-block-editor', |
| [372](#L372) | 'editor\_style'  => 'random-testimonial-block-editor', |
| [373](#L373) | 'style'         => 'random-testimonial-block', |
| [374](#L374) | 'render\_callback' => array($this, 'outputRandomTestimonial') |
| [375](#L375) | ) ); |
| [376](#L376) |  |
| [377](#L377) | register\_block\_type( 'easy-testimonials/testimonials-list', array( |
| [378](#L378) | 'editor\_script' => 'testimonials-list-block-editor', |
| [379](#L379) | 'editor\_style'  => 'testimonials-list-block-editor', |
| [380](#L380) | 'style'         => 'testimonials-list-block', |
| [381](#L381) | 'render\_callback' => array($this, 'outputTestimonials') |
| [382](#L382) | ) ); |
| [383](#L383) |  |
| [384](#L384) | register\_block\_type( 'easy-testimonials/testimonials-cycle', array( |
| [385](#L385) | 'editor\_script' => 'testimonials-cycle-block-editor', |
| [386](#L386) | 'editor\_style'  => 'testimonials-cycle-block-editor', |
| [387](#L387) | 'style'         => 'testimonials-cycle-block', |
| [388](#L388) | 'render\_callback' => array($this, 'outputTestimonialsCycle') |
| [389](#L389) | ) ); |
| [390](#L390) |  |
| [391](#L391) | register\_block\_type( 'easy-testimonials/testimonials-grid', array( |
| [392](#L392) | 'editor\_script' => 'testimonials-grid-block-editor', |
| [393](#L393) | 'editor\_style'  => 'testimonials-grid-block-editor', |
| [394](#L394) | 'style'         => 'testimonials-grid-block', |
| [395](#L395) | 'render\_callback' => array($this, 'easy\_t\_testimonials\_grid\_shortcode') |
| [396](#L396) | ) ); |
| [397](#L397) | } |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | //setup JS |
| [401](#L401) | function easy\_testimonials\_setup\_js() |
| [402](#L402) | { |
| [403](#L403) | $disable\_cycle2 = get\_option('easy\_t\_disable\_cycle2'); |
| [404](#L404) | $use\_cycle\_fix = get\_option('easy\_t\_use\_cycle\_fix'); |
| [405](#L405) |  |
| [406](#L406) | // register the grid-height script, but only enqueue it later, when/if we see the testimonials\_grid shortcode with the auto\_height option on |
| [407](#L407) | wp\_register\_script( |
| [408](#L408) | 'easy-testimonials-grid', |
| [409](#L409) | plugins\_url('include/assets/js/easy-testimonials-grid.js', \_\_FILE\_\_), |
| [410](#L410) | array( 'jquery' ) |
| [411](#L411) | ); |
| [412](#L412) |  |
| [413](#L413) | //if not pro, so we don't conflict with the pro JS |
| [414](#L414) | if(!$this->config->is\_pro){ |
| [415](#L415) | // unless Cycle2 is disabled (via Settings), enqueue it now |
| [416](#L416) | if(!$disable\_cycle2){ |
| [417](#L417) | wp\_enqueue\_script( |
| [418](#L418) | 'gp\_cycle2', |
| [419](#L419) | plugins\_url('include/assets/js/jquery.cycle2.min.js', \_\_FILE\_\_), |
| [420](#L420) | array( 'jquery' ), |
| [421](#L421) | false, |
| [422](#L422) | true |
| [423](#L423) | ); |
| [424](#L424) | } |
| [425](#L425) | } |
| [426](#L426) |  |
| [427](#L427) | // if the "Cycle Fix" Setting is on, trigger the Cycle2 slideshows explicitly |
| [428](#L428) | // (usually used with the "Disable Cycle2" option selected) |
| [429](#L429) | if($use\_cycle\_fix) { |
| [430](#L430) | wp\_enqueue\_script( |
| [431](#L431) | 'easy-testimonials-cycle-fix', |
| [432](#L432) | plugins\_url('include/assets/js/easy-testimonials-cycle-fix.js', \_\_FILE\_\_), |
| [433](#L433) | array( 'jquery' ), |
| [434](#L434) | false, |
| [435](#L435) | true |
| [436](#L436) | ); |
| [437](#L437) | } |
| [438](#L438) |  |
| [439](#L439) | wp\_register\_script( |
| [440](#L440) | 'easy-testimonials-reveal', |
| [441](#L441) | plugins\_url('include/assets/js/easy-testimonials-reveal.js', \_\_FILE\_\_), |
| [442](#L442) | array( 'jquery' ) |
| [443](#L443) | ); |
| [444](#L444) | wp\_enqueue\_script('easy-testimonials-reveal'); |
| [445](#L445) | wp\_localize\_script( |
| [446](#L446) | 'easy-testimonials-reveal', |
| [447](#L447) | 'easy\_testimonials\_reveal', |
| [448](#L448) | array( |
| [449](#L449) | 'show\_less\_text' => \_\_('Show Less', 'easy-testimonials') |
| [450](#L450) | ) |
| [451](#L451) | ); |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | //add Testimonial CSS to header |
| [455](#L455) | function easy\_testimonials\_setup\_css() |
| [456](#L456) | { |
| [457](#L457) | wp\_register\_style( 'easy\_testimonial\_style', plugins\_url('include/assets/css/style.css', \_\_FILE\_\_) ); |
| [458](#L458) |  |
| [459](#L459) | $cache\_key = '\_easy\_t\_testimonial\_style'; |
| [460](#L460) |  |
| [461](#L461) | $style = get\_option('testimonials\_style', ''); |
| [462](#L462) |  |
| [463](#L463) | // enqueue the base style unless "no\_style" has been specified |
| [464](#L464) | if($style != 'no\_style') { |
| [465](#L465) | wp\_enqueue\_style( 'easy\_testimonial\_style' ); |
| [466](#L466) | } |
| [467](#L467) | } |
| [468](#L468) |  |
| [469](#L469) | //add Custom CSS |
| [470](#L470) | function easy\_testimonials\_setup\_custom\_css() { |
| [471](#L471) | //use this to track if css has been output |
| [472](#L472) | global $easy\_t\_footer\_css\_output; |
| [473](#L473) |  |
| [474](#L474) | if($easy\_t\_footer\_css\_output){ |
| [475](#L475) | return; |
| [476](#L476) | } else { |
| [477](#L477) | //output CSS for all screens |
| [478](#L478) | // note: using strip\_tags here instead of esc\_html because esc\_html can mess up the CSS |
| [479](#L479) | //                      ref: https://wordpress.stackexchange.com/a/406702 |
| [480](#L480) | echo '<style type="text/css" media="screen">' . strip\_tags(get\_option('easy\_t\_custom\_css')) . '</style>'; |
| [481](#L481) |  |
| [482](#L482) | //output CSS for tablet screens |
| [483](#L483) | echo '<style type="text/css" media="screen">@media (max-width: 728px) {' . strip\_tags(get\_option('easy\_t\_custom\_tablet\_css')) . '}</style>'; |
| [484](#L484) |  |
| [485](#L485) | //output CSS for mobile screens |
| [486](#L486) | echo '<style type="text/css" media="screen">@media (max-width: 320px) {' . strip\_tags(get\_option('easy\_t\_custom\_phone\_css')) . '}</style>'; |
| [487](#L487) |  |
| [488](#L488) | //mark CSS as having been output |
| [489](#L489) | $easy\_t\_footer\_css\_output = true; |
| [490](#L490) | } |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | //display Testimonial Count |
| [494](#L494) | //$category is the slug of the category you want a count from |
| [495](#L495) | //if nothing is passed, displays count of all testimonials |
| [496](#L496) | //$status is the status of the testimonials to be included in the count |
| [497](#L497) | //defaults to published testimonials only |
| [498](#L498) | //if $aggregate\_rating is set to true, this will output the aggregate rating markup for the counted testimonials |
| [499](#L499) | //if $aggregate\_rating\_as\_stars is set to true, and $aggregate\_rating |
| [500](#L500) | //      is set to true, stars will be shown with the aggregate rating (can coincide with text) |
| [501](#L501) | //if $aggregate\_rating\_as\_text is set to true, and $aggregate\_rating |
| [502](#L502) | //      is set to true, text will be shown with the aggregate rating (can coincide with stars) |
| [503](#L503) | function easy\_testimonials\_count($category = '', $status = 'publish', $show\_aggregate\_rating = false, $show\_aggregate\_rating\_stars = false, $show\_aggregate\_rating\_text = true ){ |
| [504](#L504) | $tax\_query = array(); |
| [505](#L505) |  |
| [506](#L506) | //if a category slug was passed |
| [507](#L507) | //only count testimonials within that category |
| [508](#L508) | if(strlen($category)>0){ |
| [509](#L509) | $tax\_query = array( |
| [510](#L510) | array( |
| [511](#L511) | 'taxonomy' => 'easy-testimonial-category', |
| [512](#L512) | 'field' => 'slug', |
| [513](#L513) | 'terms' => $category |
| [514](#L514) | ) |
| [515](#L515) | ); |
| [516](#L516) | } |
| [517](#L517) |  |
| [518](#L518) | $args = array ( |
| [519](#L519) | 'post\_type' => 'testimonial', |
| [520](#L520) | 'tax\_query' => $tax\_query, |
| [521](#L521) | 'post\_status' => $status, |
| [522](#L522) | 'nopaging' => true |
| [523](#L523) | ); |
| [524](#L524) |  |
| [525](#L525) | $count\_query = $this->get\_testimonials\_loop( $args ); |
| [526](#L526) |  |
| [527](#L527) | //if the option to show aggregate rating is toggled |
| [528](#L528) | //construct and return the aggregate rating output |
| [529](#L529) | //instead of just returning the numerical count of testimonials |
| [530](#L530) | if( $show\_aggregate\_rating ){ |
| [531](#L531) |  |
| [532](#L532) | //calculate average review value |
| [533](#L533) | $total\_rating = 0; |
| [534](#L534) | $total\_rated\_testimonials = 0;//only want to divide by the number of testimonials with actual ratings |
| [535](#L535) |  |
| [536](#L536) | //TBD: allow control over item rating is displayed about |
| [537](#L537) | $item\_reviewed = get\_option('easy\_t\_global\_item\_reviewed',''); |
| [538](#L538) |  |
| [539](#L539) | foreach ($count\_query->posts as $testimonial){ |
| [540](#L540) | $testimonial\_rating = get\_post\_meta($testimonial->ID, '\_ikcf\_rating', true); |
| [541](#L541) |  |
| [542](#L542) | if(intval($testimonial\_rating) > 0){ |
| [543](#L543) | $total\_rated\_testimonials ++; |
| [544](#L544) | $total\_rating += $testimonial\_rating; |
| [545](#L545) | } |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | //average rating rounded to two digits |
| [549](#L549) | $average\_rating = round( ($total\_rating / $total\_rated\_testimonials), 2); |
| [550](#L550) |  |
| [551](#L551) | //build aggregate rating output wrapper |
| [552](#L552) | $output\_wrapper = ' |
| [553](#L553) | <div class="easy\_t\_aggregate\_rating\_wrapper"> |
| [554](#L554) | %s |
| [555](#L555) | <span class="easy\_t\_aggregate\_rating\_item"> %s </span> |
| [556](#L556) | <div class="easy\_t\_aggregate\_rating"> %s </div> |
| [557](#L557) | </div> |
| [558](#L558) | '; |
| [559](#L559) |  |
| [560](#L560) | //build the rating text |
| [561](#L561) | $rating\_text = '<span class="rating\_text">Rated <span class="easy\_t\_aggregate\_rating\_top\_count">' . $average\_rating . '</span>/5 based on <span class="easy\_t\_aggregate\_rating\_review\_count" >' . $total\_rated\_testimonials . '</span> customer reviews</span>'; |
| [562](#L562) |  |
| [563](#L563) | //build the star rating html |
| [564](#L564) | $x = 5; //total available stars |
| [565](#L565) | //lop off the decimal |
| [566](#L566) | $average\_rating\_decimal = fmod( $average\_rating, 1 ); |
| [567](#L567) |  |
| [568](#L568) | $rating\_stars = '<div class="stars">'; |
| [569](#L569) | //output filled in stars for each integer |
| [570](#L570) | for($i = 0; $i < $average\_rating - $average\_rating\_decimal; $i ++){ |
| [571](#L571) | $rating\_stars .= '<span class="dashicons dashicons-star-filled"></span>'; |
| [572](#L572) | $x--; //one less star available |
| [573](#L573) | } |
| [574](#L574) | //output one half filled star for any decimal amount |
| [575](#L575) | if($average\_rating\_decimal > 0){ |
| [576](#L576) | $rating\_stars .= '<span class="dashicons dashicons-star-half"></span>'; |
| [577](#L577) | $x--; //one less star available |
| [578](#L578) | } |
| [579](#L579) | //fill out the remaining empty stars |
| [580](#L580) | for($i = 0; $i < $x; $i++){ |
| [581](#L581) | $rating\_stars .= '<span class="dashicons dashicons-star-empty"></span>'; |
| [582](#L582) | } |
| [583](#L583) | //close the star rating div |
| [584](#L584) | $rating\_stars .= '</div>'; |
| [585](#L585) |  |
| [586](#L586) | //build the aggregate rating json-ld |
| [587](#L587) | ob\_start(); |
| [588](#L588) | ?> |
| [589](#L589) | <script type="application/ld+json"> |
| [590](#L590) | { |
| [591](#L591) | "@context": "http://schema.org/", |
| [592](#L592) | "@type": "Product", |
| [593](#L593) | "aggregateRating": { |
| [594](#L594) | "@type": "AggregateRating", |
| [595](#L595) | "ratingValue": "<?php echo json\_encode( $average\_rating ); ?>", |
| [596](#L596) | "reviewCount": "<?php echo json\_encode( $total\_rated\_testimonials ); ?>" |
| [597](#L597) | }, |
| [598](#L598) | "name": <?php echo json\_encode( $item\_reviewed ); ?> |
| [599](#L599) | } |
| [600](#L600) | </script> |
| [601](#L601) | <?php |
| [602](#L602) | $rating\_json = ob\_get\_contents(); |
| [603](#L603) | ob\_end\_clean(); |
| [604](#L604) |  |
| [605](#L605) | //assemble the rating output |
| [606](#L606) | $rating\_output = ""; |
| [607](#L607) | //append the star rating to rating output, if set |
| [608](#L608) | if ( $show\_aggregate\_rating\_stars ) { |
| [609](#L609) | $rating\_output .= $rating\_stars ; |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | //append the rating text to rating output, if set |
| [613](#L613) | if ( $show\_aggregate\_rating\_text ) { |
| [614](#L614) | $rating\_output .= $rating\_text; |
| [615](#L615) | } |
| [616](#L616) | //apply the json-ld, item reviewed text, and the selected rating output |
| [617](#L617) | $output = sprintf( $output\_wrapper, $rating\_json, $item\_reviewed, $rating\_output ); |
| [618](#L618) |  |
| [619](#L619) | return apply\_filters('easy\_t\_aggregate\_rating', $output, $count\_query); |
| [620](#L620) | } |
| [621](#L621) |  |
| [622](#L622) | //if we are down here, we aren't doing an aggregate rating |
| [623](#L623) | //so return the count |
| [624](#L624) | return apply\_filters('easy\_t\_testimonials\_count', $count\_query->found\_posts, $count\_query); |
| [625](#L625) | } |
| [626](#L626) |  |
| [627](#L627) | //shortcode mapping function for easy\_testimonials\_count |
| [628](#L628) | //accepts five attributes: |
| [629](#L629) | //      category |
| [630](#L630) | //      status |
| [631](#L631) | //      show\_aggregate\_rating |
| [632](#L632) | //      aggregate\_rating\_as\_stars |
| [633](#L633) | //      aggregate\_rating\_as\_text |
| [634](#L634) | function outputTestimonialsCount($atts){ |
| [635](#L635) | //load shortcode attributes into an array |
| [636](#L636) | extract( shortcode\_atts( array( |
| [637](#L637) | 'category' => '', |
| [638](#L638) | 'status' => 'publish', |
| [639](#L639) | 'show\_aggregate\_rating' => false, |
| [640](#L640) | 'show\_aggregate\_rating\_stars' => false, |
| [641](#L641) | 'show\_aggregate\_rating\_text' => true |
| [642](#L642) | ), $atts ) ); |
| [643](#L643) |  |
| [644](#L644) | $output = $this->easy\_testimonials\_count($category, $status, $show\_aggregate\_rating, $show\_aggregate\_rating\_stars, $show\_aggregate\_rating\_text); |
| [645](#L645) |  |
| [646](#L646) | return $output; |
| [647](#L647) | } |
| [648](#L648) |  |
| [649](#L649) | //load proper language pack based on current language |
| [650](#L650) | function easy\_t\_load\_textdomain() { |
| [651](#L651) | $plugin\_dir = basename(dirname(\_\_FILE\_\_)); |
| [652](#L652) | load\_plugin\_textdomain( 'easy-testimonials', false, $plugin\_dir . 'include/languages' ); |
| [653](#L653) | } |
| [654](#L654) |  |
| [655](#L655) | //setup custom post type for testimonials |
| [656](#L656) | function easy\_testimonials\_setup\_testimonials() |
| [657](#L657) | { |
| [658](#L658) | //setup post type for testimonials |
| [659](#L659) | $postType = array( |
| [660](#L660) | 'name' => 'Testimonial', |
| [661](#L661) | 'plural' =>'Testimonials', |
| [662](#L662) | 'slug' => 'testimonial', |
| [663](#L663) | 'exclude\_from\_search' => !get\_option('easy\_t\_show\_in\_search', true), |
| [664](#L664) | 'supports' => array('title','editor','thumbnail','excerpt','custom-fields') |
| [665](#L665) | ); |
| [666](#L666) | $fields = array(); |
| [667](#L667) | $fields[] = array('name' => 'client', 'title' => 'Client Name', 'description' => "Name of the Client giving the testimonial.  Appears below the Testimonial.", 'type' => 'text'); |
| [668](#L668) | $fields[] = array('name' => 'email', 'title' => 'E-Mail Address', 'description' => "The client's e-mail address.  This field is used to check for a Gravatar, if that option is enabled in your settings.", 'type' => 'text'); |
| [669](#L669) | $fields[] = array('name' => 'position', 'title' => 'Position / Web Address / Other', 'description' => "The information that appears below the client's name.", 'type' => 'text'); |
| [670](#L670) | $fields[] = array('name' => 'other', 'title' => 'Location Reviewed / Product Reviewed / Item Reviewed', 'description' => "The information that appears below the second custom field, Position / Web Address / Other.  Display of this field is required for proper structured data output.", 'type' => 'text'); |
| [671](#L671) | $fields[] = array('name' => 'rating', 'title' => 'Rating', 'description' => "The client's rating, if submitted along with their testimonial.  This can be displayed below the client's position, or name if the position is hidden, or it can be displayed above the testimonial text.", 'type' => 'number', 'min' => 1, 'max' => 5); |
| [672](#L672) | $args = array( |
| [673](#L673) | 'menu\_icon' => 'dashicons-testimonial', |
| [674](#L674) | ); |
| [675](#L675) | $myCustomType = new ikTestimonialsCustomPostType($postType, $fields, false, $args); |
| [676](#L676) | register\_taxonomy( |
| [677](#L677) | 'easy-testimonial-category', |
| [678](#L678) | 'testimonial', |
| [679](#L679) | array( |
| [680](#L680) | 'hierarchical' => true, |
| [681](#L681) | 'label' => \_\_('Testimonial Category', 'easy-testimonials'), |
| [682](#L682) | 'rewrite' => array( |
| [683](#L683) | 'slug' => 'testimonial-category', |
| [684](#L684) | 'with\_front' => true |
| [685](#L685) | ), |
| [686](#L686) | 'show\_in\_rest' => true |
| [687](#L687) | ) |
| [688](#L688) | ); |
| [689](#L689) |  |
| [690](#L690) | //load list of current posts that have featured images |
| [691](#L691) | $supportedTypes = get\_theme\_support( 'post-thumbnails' ); |
| [692](#L692) |  |
| [693](#L693) | //none set, add them just to our type |
| [694](#L694) | if( $supportedTypes === false ){ |
| [695](#L695) | add\_theme\_support( 'post-thumbnails', array( 'testimonial' ) ); |
| [696](#L696) | //for the testimonial thumb images |
| [697](#L697) | } |
| [698](#L698) | //specifics set, add ours to the array |
| [699](#L699) | elseif( is\_array( $supportedTypes ) ){ |
| [700](#L700) | $supportedTypes[0][] = 'testimonial'; |
| [701](#L701) | add\_theme\_support( 'post-thumbnails', $supportedTypes[0] ); |
| [702](#L702) | //for the testimonial thumb images |
| [703](#L703) | } |
| [704](#L704) | //if neither of the above hit, the theme in general supports them for everything.  that includes us! |
| [705](#L705) |  |
| [706](#L706) | add\_image\_size( 'easy\_testimonial\_thumb', 50, 50, true ); |
| [707](#L707) |  |
| [708](#L708) | add\_action( 'admin\_menu', array($this, 'easy\_t\_add\_meta\_boxes')); // add our custom meta boxes |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | function easy\_t\_add\_meta\_boxes(){ |
| [712](#L712) | add\_meta\_box( 'testimonial\_shortcodes', 'Shortcodes', array($this, 'easy\_t\_display\_shortcodes\_meta\_box'), 'testimonial', 'side', 'default' ); |
| [713](#L713) | } |
| [714](#L714) |  |
| [715](#L715) |  |
| [716](#L716) | //this is the heading of the new column we're adding to the testimonial category list |
| [717](#L717) | function easy\_t\_cat\_column\_head($defaults) { |
| [718](#L718) | $defaults = array\_slice($defaults, 0, 2, true) + |
| [719](#L719) | array("single\_shortcode" => "Shortcode") + |
| [720](#L720) | array\_slice($defaults, 2, count($defaults)-2, true); |
| [721](#L721) | return $defaults; |
| [722](#L722) | } |
| [723](#L723) |  |
| [724](#L724) | //this content is displayed in the testimonial category list |
| [725](#L725) | function easy\_t\_cat\_columns\_content($value, $column\_name, $tax\_id) { |
| [726](#L726) |  |
| [727](#L727) | $category = get\_term\_by('id', $tax\_id, 'easy-testimonial-category'); |
| [728](#L728) |  |
| [729](#L729) | return "<textarea>[testimonials category='{$category->slug}']</textarea>"; |
| [730](#L730) | } |
| [731](#L731) |  |
| [732](#L732) | //load a testimonials loop |
| [733](#L733) | //has some object caching |
| [734](#L734) | function get\_testimonials\_loop($atts = array()){ |
| [735](#L735) | //only use cache if enabled (defaults to true) |
| [736](#L736) | if( $this->config->cache\_enabled ){ |
| [737](#L737) | $cache\_key = "easy\_t\_object\_cache\_" . md5(serialize($atts)); |
| [738](#L738) |  |
| [739](#L739) | // Get any existing copy of our transient data |
| [740](#L740) | if ( false === ($testimonials\_loop = get\_transient($cache\_key)) ){ |
| [741](#L741) | // It wasn't there, so regenerate the data and save the transient |
| [742](#L742) | $testimonials\_loop = new WP\_Query($atts); |
| [743](#L743) | set\_transient( $cache\_key, $testimonials\_loop, $this->config->cache\_time ); |
| [744](#L744) | } |
| [745](#L745) | } else { |
| [746](#L746) | $testimonials\_loop = new WP\_Query($atts); |
| [747](#L747) | } |
| [748](#L748) |  |
| [749](#L749) | return $testimonials\_loop; |
| [750](#L750) | } |
| [751](#L751) |  |
| [752](#L752) | //load testimonials into an array and output a random one |
| [753](#L753) | function outputRandomTestimonial($atts){ |
| [754](#L754) | //load shortcode attributes into an array |
| [755](#L755) | $atts = shortcode\_atts( array( |
| [756](#L756) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [757](#L757) | 'count' => 1, |
| [758](#L758) | 'word\_limit' => false, |
| [759](#L759) | 'body\_class' => 'testimonial\_body', |
| [760](#L760) | 'author\_class' => 'testimonial\_author', |
| [761](#L761) | 'show\_title' => 0, |
| [762](#L762) | 'short\_version' => false, |
| [763](#L763) | 'use\_excerpt' => false, |
| [764](#L764) | 'reveal\_full\_content' => false, |
| [765](#L765) | 'category' => '', |
| [766](#L766) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [767](#L767) | 'show\_rating' => 'stars', |
| [768](#L768) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [769](#L769) | 'show\_date' => true, |
| [770](#L770) | 'show\_other' => true, |
| [771](#L771) | 'width' => false, |
| [772](#L772) | 'hide\_view\_more' => 0, |
| [773](#L773) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [774](#L774) | ), $atts ); |
| [775](#L775) |  |
| [776](#L776) | ob\_start(); |
| [777](#L777) |  |
| [778](#L778) |  |
| [779](#L779) | //load testimonials |
| [780](#L780) | $testimonials\_loop = $this->get\_testimonials\_loop( array( 'post\_type' => 'testimonial','posts\_per\_page' => $atts['count'], 'easy-testimonial-category' => $atts['category'], 'orderby' => 'rand') ); |
| [781](#L781) |  |
| [782](#L782) | // |
| [783](#L783) |  |
| [784](#L784) | $testimonials = $testimonials\_loop->get\_posts(); |
| [785](#L785) |  |
| [786](#L786) | //loop through and output testimonials |
| [787](#L787) | foreach($testimonials as $testimonial){ |
| [788](#L788) | $data = array( |
| [789](#L789) | 'testimonial' => $testimonial, |
| [790](#L790) | 'atts' => $atts |
| [791](#L791) | ); |
| [792](#L792) |  |
| [793](#L793) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [794](#L794) |  |
| [795](#L795) | //output the testimonials HTML |
| [796](#L796) | $testimonial->render(); |
| [797](#L797) | } |
| [798](#L798) |  |
| [799](#L799) | wp\_reset\_postdata(); |
| [800](#L800) |  |
| [801](#L801) | //capture the content from the output buffer` |
| [802](#L802) | $content = ob\_get\_contents(); |
| [803](#L803) | ob\_end\_clean(); |
| [804](#L804) |  |
| [805](#L805) | //return the content, with the filter applied |
| [806](#L806) | return apply\_filters('easy\_t\_random\_testimonials\_html', $content); |
| [807](#L807) | } |
| [808](#L808) |  |
| [809](#L809) | //output specific testimonial |
| [810](#L810) | function outputSingleTestimonial($atts) |
| [811](#L811) | { |
| [812](#L812) | //load shortcode attributes into an array |
| [813](#L813) | $atts = shortcode\_atts( array( |
| [814](#L814) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [815](#L815) | 'show\_title' => 0, |
| [816](#L816) | 'body\_class' => 'testimonial\_body', |
| [817](#L817) | 'author\_class' => 'testimonial\_author', |
| [818](#L818) | 'id' => '', |
| [819](#L819) | 'use\_excerpt' => false, |
| [820](#L820) | 'reveal\_full\_content' => false, |
| [821](#L821) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [822](#L822) | 'short\_version' => false, |
| [823](#L823) | 'word\_limit' => false, |
| [824](#L824) | 'show\_rating' => 'stars', |
| [825](#L825) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [826](#L826) | 'show\_position' => true, |
| [827](#L827) | 'show\_date' => true, |
| [828](#L828) | 'show\_other' => true, |
| [829](#L829) | 'width' => false, |
| [830](#L830) | 'hide\_view\_more' => 0, |
| [831](#L831) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [832](#L832) | ), $atts ); |
| [833](#L833) |  |
| [834](#L834) | if ( $atts['reveal\_full\_content'] ) { |
| [835](#L835) | $atts['use\_excerpt'] = true; |
| [836](#L836) | } |
| [837](#L837) |  |
| [838](#L838) | //load testimonials |
| [839](#L839) | $testimonial = get\_post( $atts['id'], OBJECT ); |
| [840](#L840) |  |
| [841](#L841) | //prep content for return |
| [842](#L842) | $content = ""; |
| [843](#L843) |  |
| [844](#L844) | //return nothing if a bad ID is passed (no testimonial found) |
| [845](#L845) | if(!empty($testimonial)){ |
| [846](#L846) | //create a new testimonial object by passing in the current testimonial |
| [847](#L847) | $data = array( |
| [848](#L848) | 'testimonial' => $testimonial, |
| [849](#L849) | 'atts' => $atts |
| [850](#L850) | ); |
| [851](#L851) |  |
| [852](#L852) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [853](#L853) |  |
| [854](#L854) | ob\_start(); |
| [855](#L855) |  |
| [856](#L856) | //output the testimonials HTML |
| [857](#L857) | $testimonial->render(); |
| [858](#L858) | $content = ob\_get\_contents(); |
| [859](#L859) |  |
| [860](#L860) | ob\_end\_clean(); |
| [861](#L861) | } |
| [862](#L862) |  |
| [863](#L863) | return apply\_filters( 'easy\_t\_single\_testimonial\_html', $content); |
| [864](#L864) | } |
| [865](#L865) |  |
| [866](#L866) | //output all testimonials |
| [867](#L867) | function outputTestimonials($atts){ |
| [868](#L868) |  |
| [869](#L869) | //load shortcode attributes into an array |
| [870](#L870) | $atts = shortcode\_atts( array( |
| [871](#L871) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [872](#L872) | 'show\_title' => 0, |
| [873](#L873) | 'count' => -1, |
| [874](#L874) | 'body\_class' => 'testimonial\_body', |
| [875](#L875) | 'author\_class' => 'testimonial\_author', |
| [876](#L876) | 'id' => '', |
| [877](#L877) | 'use\_excerpt' => false, |
| [878](#L878) | 'reveal\_full\_content' => false, |
| [879](#L879) | 'category' => '', |
| [880](#L880) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [881](#L881) | 'short\_version' => false, |
| [882](#L882) | 'orderby' => 'date',//'none','ID','author','title','name','date','modified','parent','rand','menu\_order' |
| [883](#L883) | 'order' => 'DESC', // 'ASC, DESC'' |
| [884](#L884) | 'show\_rating' => 'stars', |
| [885](#L885) | 'paginate' => false, |
| [886](#L886) | 'testimonials\_per\_page' => 10, |
| [887](#L887) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [888](#L888) | 'show\_date' => true, |
| [889](#L889) | 'show\_other' => true, |
| [890](#L890) | 'width' => false, |
| [891](#L891) | 'hide\_view\_more' => true, |
| [892](#L892) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [893](#L893) | ), $atts ); |
| [894](#L894) |  |
| [895](#L895) | if ( $atts['reveal\_full\_content'] ) { |
| [896](#L896) | $atts['use\_excerpt'] = true; |
| [897](#L897) | } |
| [898](#L898) |  |
| [899](#L899) | extract($atts); |
| [900](#L900) |  |
| [901](#L901) | //if a bad value is passed for count, set it to -1 to load all testimonials |
| [902](#L902) | //if $paginate is set to "all", this shortcode was made from a widget |
| [903](#L903) | //and we need to set the count to -1 to load all testimonials |
| [904](#L904) | if(!is\_numeric($count) || $paginate == "all"){ |
| [905](#L905) | $count = -1; |
| [906](#L906) | } |
| [907](#L907) |  |
| [908](#L908) | //if we are paging the testimonials, set the $count to the number of testimonials per page |
| [909](#L909) | //sometimes $paginate is set, but is set to "all" (from the Widget) - |
| [910](#L910) | //this indicates that we want to show every testimonial and not page them |
| [911](#L911) | if($paginate && $paginate != "all"){ |
| [912](#L912) | $count = $testimonials\_per\_page; |
| [913](#L913) | } |
| [914](#L914) |  |
| [915](#L915) | $i = 0; |
| [916](#L916) |  |
| [917](#L917) | $args = array( |
| [918](#L918) | 'post\_type' => 'testimonial', |
| [919](#L919) | 'posts\_per\_page' => $count, |
| [920](#L920) | 'orderby' => $orderby, |
| [921](#L921) | 'order' => $order |
| [922](#L922) | ); |
| [923](#L923) |  |
| [924](#L924) | // add category filter if specified |
| [925](#L925) | if ( !empty($category) ) { |
| [926](#L926) | // IMPORTANT: tax\_query is an ARRAY of ARRAYs |
| [927](#L927) | $args['tax\_query'] = array( |
| [928](#L928) | array( |
| [929](#L929) | 'taxonomy' => 'easy-testimonial-category', |
| [930](#L930) | 'field'    => 'slug', |
| [931](#L931) | 'terms'    => $category, |
| [932](#L932) | ) |
| [933](#L933) | ); |
| [934](#L934) | } |
| [935](#L935) |  |
| [936](#L936) | // handle paging |
| [937](#L937) | $nopaging = ($testimonials\_per\_page <= 0); |
| [938](#L938) |  |
| [939](#L939) | $testimonial\_page = 1; |
| [940](#L940) | if ( get\_query\_var('testimonial\_page') ) { |
| [941](#L941) | $testimonial\_page = get\_query\_var('testimonial\_page'); |
| [942](#L942) | } |
| [943](#L943) | $paged = $testimonial\_page; |
| [944](#L944) |  |
| [945](#L945) | if (!$nopaging && $paginate && $paginate != "all") { |
| [946](#L946) | //if $nopaging is false and $paginate is true, or max (but not "all"), then $testimonials\_per\_page is greater than 0 and the user is trying to paginate them |
| [947](#L947) | //sometimes paginate is true, or 1, or max -- they all indicate the same thing.  "max" comes from the widget, true or 1 come from the shortcode / old instructions |
| [948](#L948) | $args['posts\_per\_page'] = $testimonials\_per\_page; |
| [949](#L949) | $args['paged'] = $paged; |
| [950](#L950) | } |
| [951](#L951) |  |
| [952](#L952) | ob\_start(); |
| [953](#L953) |  |
| [954](#L954) | //load testimonials |
| [955](#L955) | $testimonials\_loop = $this->get\_testimonials\_loop($args); |
| [956](#L956) |  |
| [957](#L957) | $testimonials = $testimonials\_loop->get\_posts(); |
| [958](#L958) |  |
| [959](#L959) | foreach($testimonials as $this\_testimonial){ |
| [960](#L960) | //create a new testimonial object by passing in the current testimonial |
| [961](#L961) | $data = array( |
| [962](#L962) | 'testimonial' => $this\_testimonial, |
| [963](#L963) | 'atts' => $atts |
| [964](#L964) | ); |
| [965](#L965) |  |
| [966](#L966) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [967](#L967) |  |
| [968](#L968) | //output the testimonials HTML |
| [969](#L969) | $testimonial->render(); |
| [970](#L970) | } |
| [971](#L971) |  |
| [972](#L972) | //output the pagination links, if instructed to do so |
| [973](#L973) | //TBD: make all labels controllable via settings |
| [974](#L974) | if($paginate){ |
| [975](#L975) | $pagination\_link\_template = $this->get\_pagination\_link\_template('testimonial\_page'); |
| [976](#L976) |  |
| [977](#L977) | ?> |
| [978](#L978) | <div class="easy\_t\_pagination"> |
| [979](#L979) | <?php |
| [980](#L980) | echo wp\_kses\_post(paginate\_links( array( |
| [981](#L981) | 'base' => $pagination\_link\_template, |
| [982](#L982) | 'format' => '?testimonial\_page=%#%', |
| [983](#L983) | 'current' => max( 1, $paged ), |
| [984](#L984) | 'total' => $testimonials\_loop->max\_num\_pages |
| [985](#L985) | ) ) ); |
| [986](#L986) | ?> |
| [987](#L987) | </div> |
| [988](#L988) | <?php |
| [989](#L989) | } |
| [990](#L990) |  |
| [991](#L991) | wp\_reset\_postdata(); |
| [992](#L992) |  |
| [993](#L993) | $content = ob\_get\_contents(); |
| [994](#L994) | ob\_end\_clean(); |
| [995](#L995) |  |
| [996](#L996) | return apply\_filters('easy\_t\_testimonials\_html', $content); |
| [997](#L997) | } |
| [998](#L998) |  |
| [999](#L999) | function easy\_t\_add\_pagination\_query\_var($query\_vars) |
| [1000](#L1000) | { |
| [1001](#L1001) | $query\_vars[] = 'testimonial\_page'; |
| [1002](#L1002) | return $query\_vars; |
| [1003](#L1003) | } |
| [1004](#L1004) |  |
| [1005](#L1005) | /\* |
| [1006](#L1006) | \* Returns an URL template that can be passed as the 'base' param |
| [1007](#L1007) | \* to WP's paginate\_links function |
| [1008](#L1008) | \* |
| [1009](#L1009) | \* Note: This function is based on WordPress' get\_pagenum\_link. |
| [1010](#L1010) | \* It allows the query string argument to changed from 'paged' |
| [1011](#L1011) | \*/ |
| [1012](#L1012) | function get\_pagination\_link\_template( $arg = 'testimonial\_page' ) |
| [1013](#L1013) | { |
| [1014](#L1014) | $request = remove\_query\_arg( $arg ); |
| [1015](#L1015) |  |
| [1016](#L1016) | $home\_root = parse\_url(home\_url()); |
| [1017](#L1017) | $home\_root = ( isset($home\_root['path']) ) ? $home\_root['path'] : ''; |
| [1018](#L1018) | $home\_root = preg\_quote( $home\_root, '|' ); |
| [1019](#L1019) |  |
| [1020](#L1020) | $request = preg\_replace('|^'. $home\_root . '|i', '', $request); |
| [1021](#L1021) | $request = preg\_replace('|^/+|', '', $request); |
| [1022](#L1022) |  |
| [1023](#L1023) | $base = trailingslashit( get\_bloginfo( 'url' ) ); |
| [1024](#L1024) |  |
| [1025](#L1025) | $result = add\_query\_arg( $arg, '%#%', $base . $request ); |
| [1026](#L1026) | $result = apply\_filters( 'easy\_t\_get\_pagination\_link\_template', $result ); |
| [1027](#L1027) |  |
| [1028](#L1028) | return esc\_url\_raw( $result ); |
| [1029](#L1029) | } |
| [1030](#L1030) |  |
| [1031](#L1031) | /\* |
| [1032](#L1032) | \* Displays a grid of testimonials, with the requested number of columns |
| [1033](#L1033) | \* |
| [1034](#L1034) | \* @param array $atts Shortcode options. These include the [testimonial] |
| [1035](#L1035) | shortcode attributes, which are passed through. |
| [1036](#L1036) | \* |
| [1037](#L1037) | \* @return string HTML representing the grid of testimonials. |
| [1038](#L1038) | \*/ |
| [1039](#L1039) | function easy\_t\_testimonials\_grid\_shortcode($atts) |
| [1040](#L1040) | { |
| [1041](#L1041) | // load shortcode attributes into an array |
| [1042](#L1042) | // note: these are mostly the same attributes as [testimonials] shortcode |
| [1043](#L1043) | $atts = shortcode\_atts( array( |
| [1044](#L1044) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [1045](#L1045) | 'show\_title' => 0, |
| [1046](#L1046) | 'count' => -1, |
| [1047](#L1047) | 'body\_class' => 'testimonial\_body', |
| [1048](#L1048) | 'author\_class' => 'testimonial\_author', |
| [1049](#L1049) | 'id' => '', |
| [1050](#L1050) | 'ids' => '', // i've heard it both ways |
| [1051](#L1051) | 'use\_excerpt' => false, |
| [1052](#L1052) | 'reveal\_full\_content' => false, |
| [1053](#L1053) | 'category' => '', |
| [1054](#L1054) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [1055](#L1055) | 'short\_version' => false, |
| [1056](#L1056) | 'orderby' => 'date',//'none','ID','author','title','name','date','modified','parent','rand','menu\_order' |
| [1057](#L1057) | 'order' => 'DESC', // 'ASC, DESC'' |
| [1058](#L1058) | 'show\_rating' => 'stars', |
| [1059](#L1059) | 'paginate' => false, |
| [1060](#L1060) | 'testimonials\_per\_page' => 10, |
| [1061](#L1061) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [1062](#L1062) | 'show\_date' => true, |
| [1063](#L1063) | 'show\_other' => true, |
| [1064](#L1064) | 'width' => false, |
| [1065](#L1065) | 'cols' => 3, // 1-10 |
| [1066](#L1066) | 'grid\_width' => false, |
| [1067](#L1067) | 'grid\_spacing' => false, |
| [1068](#L1068) | 'grid\_class' => '', |
| [1069](#L1069) | 'cell\_width' => false, |
| [1070](#L1070) | 'responsive' => true, |
| [1071](#L1071) | 'equal\_height\_rows' => false, |
| [1072](#L1072) | 'hide\_view\_more' => 0, |
| [1073](#L1073) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [1074](#L1074) | ), $atts ); |
| [1075](#L1075) |  |
| [1076](#L1076) | if ( $atts['reveal\_full\_content'] ) { |
| [1077](#L1077) | $atts['use\_excerpt'] = true; |
| [1078](#L1078) | } |
| [1079](#L1079) |  |
| [1080](#L1080) | extract( $atts ); |
| [1081](#L1081) |  |
| [1082](#L1082) | // allow ids or id to be passed in |
| [1083](#L1083) | if ( empty($id) && !empty($ids) ) { |
| [1084](#L1084) | $id = $ids; |
| [1085](#L1085) | } |
| [1086](#L1086) |  |
| [1087](#L1087) | //if a bad value is passed for count, set it to -1 to load all testimonials |
| [1088](#L1088) | //if $paginate is set to "all", this shortcode was made from a widget |
| [1089](#L1089) | //and we need to set the count to -1 to load all testimonials |
| [1090](#L1090) | if(!is\_numeric($count) || $paginate == "all"){ |
| [1091](#L1091) | $count = -1; |
| [1092](#L1092) | } |
| [1093](#L1093) |  |
| [1094](#L1094) | //if we are paging the testimonials, set the $count to the number of testimonials per page |
| [1095](#L1095) | //sometimes $paginate is set, but is set to "all" (from the Widget) - |
| [1096](#L1096) | //this indicates that we want to show every testimonial and not page them |
| [1097](#L1097) | if($paginate && $paginate != "all"){ |
| [1098](#L1098) | $count = $testimonials\_per\_page; |
| [1099](#L1099) | } |
| [1100](#L1100) |  |
| [1101](#L1101) | $testimonials\_output = ''; |
| [1102](#L1102) | $col\_counter = 1; |
| [1103](#L1103) | $row\_counter = 0; |
| [1104](#L1104) |  |
| [1105](#L1105) | if ($equal\_height\_rows) { |
| [1106](#L1106) | wp\_enqueue\_script('easy-testimonials-grid'); |
| [1107](#L1107) | } |
| [1108](#L1108) |  |
| [1109](#L1109) | if ( empty($rows) ) { |
| [1110](#L1110) | $rows  = -1; |
| [1111](#L1111) | } |
| [1112](#L1112) |  |
| [1113](#L1113) | // make sure $cols is between 1 and 10 |
| [1114](#L1114) | $cols = max( 1, min( 10, intval($cols) ) ); |
| [1115](#L1115) |  |
| [1116](#L1116) | // create CSS for cells (will be same on each cell) |
| [1117](#L1117) | $cell\_style\_attr = ''; |
| [1118](#L1118) | $cell\_css\_rules = array(); |
| [1119](#L1119) |  |
| [1120](#L1120) | if ( !empty($grid\_spacing) && intval($grid\_spacing) > 0 ) { |
| [1121](#L1121) | $coefficient = intval($grid\_spacing) / 2; |
| [1122](#L1122) | $unit = ( strpos($grid\_spacing, '%') !== false ) ? '%' : 'px'; |
| [1123](#L1123) | $cell\_margin = $coefficient . $unit; |
| [1124](#L1124) | $cell\_css\_rules[] = sprintf('margin-left: %s', $cell\_margin); |
| [1125](#L1125) | $cell\_css\_rules[] = sprintf('margin-right: %s', $cell\_margin); |
| [1126](#L1126) | } |
| [1127](#L1127) |  |
| [1128](#L1128) | if ( !empty($cell\_width) && intval($cell\_width) > 0 ) { |
| [1129](#L1129) | $cell\_css\_rules[] = sprintf('width: %s', $cell\_width); |
| [1130](#L1130) | } |
| [1131](#L1131) |  |
| [1132](#L1132) | $cell\_style\_attr = !empty($cell\_css\_rules) ? sprintf('style="%s"', implode(';', $cell\_css\_rules) ) : ''; |
| [1133](#L1133) |  |
| [1134](#L1134) | // combine the rules into a re-useable opening <div> tag to be used for each cell |
| [1135](#L1135) | $cell\_div\_start = sprintf('<div class="easy\_testimonials\_grid\_cell" %s>', $cell\_style\_attr); |
| [1136](#L1136) |  |
| [1137](#L1137) | // grab all requested testimonials and build one cell (in HTML) for each |
| [1138](#L1138) | // note: using WP\_Query instead of get\_posts in order to respect pagination |
| [1139](#L1139) | //       more info: http://wordpress.stackexchange.com/a/191934 |
| [1140](#L1140) | $args = array( |
| [1141](#L1141) | 'post\_type' => 'testimonial', |
| [1142](#L1142) | 'posts\_per\_page' => $count, |
| [1143](#L1143) | 'easy-testimonial-category' => $category, |
| [1144](#L1144) | 'orderby' => $orderby, |
| [1145](#L1145) | 'order' => $order |
| [1146](#L1146) | ); |
| [1147](#L1147) |  |
| [1148](#L1148) | // handle paging |
| [1149](#L1149) | $nopaging = ($testimonials\_per\_page <= 0); |
| [1150](#L1150) | $paged = !empty($\_REQUEST['testimonial\_page']) && intval($\_REQUEST['testimonial\_page']) > 0 ? intval($\_REQUEST['testimonial\_page']) : 1; |
| [1151](#L1151) | if (!$nopaging && $paginate && $paginate != "all") { |
| [1152](#L1152) | //if $nopaging is false and $paginate is true, or max (but not "all"), then $testimonials\_per\_page is greater than 0 and the user is trying to paginate them |
| [1153](#L1153) | //sometimes paginate is true, or 1, or max -- they all indicate the same thing.  "max" comes from the widget, true or 1 come from the shortcode / old instructions |
| [1154](#L1154) | $args['posts\_per\_page'] = $testimonials\_per\_page; |
| [1155](#L1155) | $args['paged'] = $paged; |
| [1156](#L1156) | } |
| [1157](#L1157) |  |
| [1158](#L1158) | // restrict to specific posts if requested |
| [1159](#L1159) | if ( !empty($id) ) { |
| [1160](#L1160) | $args['post\_\_in'] = array\_map('intval', explode(',', $id)); |
| [1161](#L1161) | } |
| [1162](#L1162) |  |
| [1163](#L1163) | $testimonials\_loop = $this->get\_testimonials\_loop($args); |
| [1164](#L1164) |  |
| [1165](#L1165) | $testimonials = $testimonials\_loop->get\_posts(); |
| [1166](#L1166) |  |
| [1167](#L1167) | $in\_row = false; |
| [1168](#L1168) | foreach( $testimonials as $this\_testimonial ) { |
| [1169](#L1169) |  |
| [1170](#L1170) | if ($col\_counter == 1) { |
| [1171](#L1171) | $in\_row = true; |
| [1172](#L1172) | $row\_counter++; |
| [1173](#L1173) | $testimonials\_output .= sprintf('<div class="easy\_testimonials\_grid\_row easy\_testimonials\_grid\_row\_%d">', $row\_counter); |
| [1174](#L1174) | } |
| [1175](#L1175) |  |
| [1176](#L1176) | $testimonials\_output .= $cell\_div\_start; |
| [1177](#L1177) |  |
| [1178](#L1178) | //create a new testimonial object by passing in the current testimonial |
| [1179](#L1179) | $data = array( |
| [1180](#L1180) | 'testimonial' => $this\_testimonial, |
| [1181](#L1181) | 'atts' => $atts |
| [1182](#L1182) | ); |
| [1183](#L1183) |  |
| [1184](#L1184) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [1185](#L1185) |  |
| [1186](#L1186) | //load output into variable to concatenate |
| [1187](#L1187) | ob\_start(); |
| [1188](#L1188) | $testimonial->render(); |
| [1189](#L1189) | $ob\_content = ob\_get\_contents(); |
| [1190](#L1190) | ob\_end\_clean(); |
| [1191](#L1191) |  |
| [1192](#L1192) | $testimonials\_output .= $ob\_content; |
| [1193](#L1193) |  |
| [1194](#L1194) | $testimonials\_output .= '</div>'; |
| [1195](#L1195) |  |
| [1196](#L1196) | if ($col\_counter == $cols) { |
| [1197](#L1197) | $in\_row = false; |
| [1198](#L1198) | $testimonials\_output .= '</div><!--easy\_testimonials\_grid\_row-->'; |
| [1199](#L1199) | $col\_counter = 1; |
| [1200](#L1200) | } else { |
| [1201](#L1201) | $col\_counter++; |
| [1202](#L1202) | } |
| [1203](#L1203) | } // endwhile; |
| [1204](#L1204) |  |
| [1205](#L1205) | // close any half finished rows |
| [1206](#L1206) | if ($in\_row) { |
| [1207](#L1207) | $testimonials\_output .= '</div><!--easy\_testimonials\_grid\_row-->'; |
| [1208](#L1208) | } |
| [1209](#L1209) |  |
| [1210](#L1210) | //output the pagination links, if instructed to do so |
| [1211](#L1211) | //TBD: make all labels controllable via settings |
| [1212](#L1212) | if($paginate){ |
| [1213](#L1213) | $pagination\_link\_template = $this->get\_pagination\_link\_template('testimonial\_page'); |
| [1214](#L1214) |  |
| [1215](#L1215) | $testimonials\_output .= '<div class="easy\_t\_pagination">'; |
| [1216](#L1216) | $testimonials\_output .= paginate\_links(array( |
| [1217](#L1217) | 'base' => $pagination\_link\_template, |
| [1218](#L1218) | 'format' => '?testimonial\_page=%#%', |
| [1219](#L1219) | 'current' => max( 1, $paged ), |
| [1220](#L1220) | 'total' => $testimonials\_loop->max\_num\_pages |
| [1221](#L1221) | )); |
| [1222](#L1222) | $testimonials\_output .= '</div>  '; |
| [1223](#L1223) | } |
| [1224](#L1224) |  |
| [1225](#L1225) | // restore globals to their original values (i.e, $post and friends) |
| [1226](#L1226) | wp\_reset\_postdata(); |
| [1227](#L1227) |  |
| [1228](#L1228) | // setup the grid's CSS, insert the grid of testimonials (the cells) |
| [1229](#L1229) | // into the grid, add a clearing div, and return the whole thing |
| [1230](#L1230) | $grid\_classes = array( |
| [1231](#L1231) | 'easy\_testimonials\_grid', |
| [1232](#L1232) | 'easy\_testimonials\_grid\_' . $cols |
| [1233](#L1233) | ); |
| [1234](#L1234) |  |
| [1235](#L1235) | if ($responsive) { |
| [1236](#L1236) | $grid\_classes[] = 'easy\_testimonials\_grid\_responsive'; |
| [1237](#L1237) | } |
| [1238](#L1238) |  |
| [1239](#L1239) | if ($equal\_height\_rows) { |
| [1240](#L1240) | $grid\_classes[] = 'easy\_testimonials\_grid\_equal\_height\_rows'; |
| [1241](#L1241) | } |
| [1242](#L1242) |  |
| [1243](#L1243) | // add any grid classes specified by the user |
| [1244](#L1244) | if ( !empty($grid\_class) ) { |
| [1245](#L1245) | $grid\_classes = array\_merge( $grid\_classes, explode(' ', $grid\_class) ); |
| [1246](#L1246) | } |
| [1247](#L1247) |  |
| [1248](#L1248) | // combine all classes into an class attribute |
| [1249](#L1249) | $grid\_class\_attr = sprintf( 'class="%s"', implode(' ', $grid\_classes) ); |
| [1250](#L1250) |  |
| [1251](#L1251) | // add all style rules for the grid (currently, only specifies width) |
| [1252](#L1252) | $grid\_css\_rules = array(); |
| [1253](#L1253) | if ( !empty($grid\_width) && intval($grid\_width) > 0 ) { |
| [1254](#L1254) | $grid\_css\_rules[] = sprintf('width: %s', $grid\_width); |
| [1255](#L1255) | } |
| [1256](#L1256) |  |
| [1257](#L1257) | // combine all CSS rules into an HTML style attribute |
| [1258](#L1258) | $grid\_style\_attr = sprintf( 'style="%s"', implode(';', $grid\_css\_rules) ); |
| [1259](#L1259) |  |
| [1260](#L1260) | // add classes and CSS rules to the grid, insert cells, return result |
| [1261](#L1261) | $grid\_template = '<div %s %s>%s</div>'; |
| [1262](#L1262) | $grid\_html = sprintf($grid\_template, $grid\_class\_attr, $grid\_style\_attr, $testimonials\_output); |
| [1263](#L1263) | return $grid\_html; |
| [1264](#L1264) | } |
| [1265](#L1265) |  |
| [1266](#L1266) | //output a single testimonial for each theme\_array |
| [1267](#L1267) | //useful for demoing all of the themes or testing compatibility on a given website |
| [1268](#L1268) | //output all testimonials |
| [1269](#L1269) | function outputAllThemes($atts){ |
| [1270](#L1270) | //load shortcode attributes into an array |
| [1271](#L1271) | $atts = shortcode\_atts( array( |
| [1272](#L1272) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [1273](#L1273) | 'show\_title' => 0, |
| [1274](#L1274) | 'count' => 1, |
| [1275](#L1275) | 'body\_class' => 'testimonial\_body', |
| [1276](#L1276) | 'author\_class' => 'testimonial\_author', |
| [1277](#L1277) | 'id' => '', |
| [1278](#L1278) | 'use\_excerpt' => false, |
| [1279](#L1279) | 'reveal\_full\_content' => false, |
| [1280](#L1280) | 'category' => '', |
| [1281](#L1281) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [1282](#L1282) | 'short\_version' => false, |
| [1283](#L1283) | 'orderby' => 'date',//'none','ID','author','title','name','date','modified','parent','rand','menu\_order' |
| [1284](#L1284) | 'order' => 'DESC', // 'ASC, DESC'' |
| [1285](#L1285) | 'show\_rating' => 'stars', |
| [1286](#L1286) | 'paginate' => false, |
| [1287](#L1287) | 'testimonials\_per\_page' => 10, |
| [1288](#L1288) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [1289](#L1289) | 'show\_date' => true, |
| [1290](#L1290) | 'show\_other' => true, |
| [1291](#L1291) | 'show\_free\_themes' => false, |
| [1292](#L1292) | 'width' => false, |
| [1293](#L1293) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [1294](#L1294) | ), $atts ); |
| [1295](#L1295) |  |
| [1296](#L1296) | if ( $atts['reveal\_full\_content'] ) { |
| [1297](#L1297) | $atts['use\_excerpt'] = true; |
| [1298](#L1298) | } |
| [1299](#L1299) |  |
| [1300](#L1300) | extract($atts); |
| [1301](#L1301) |  |
| [1302](#L1302) | ob\_start(); |
| [1303](#L1303) |  |
| [1304](#L1304) | //load testimonials |
| [1305](#L1305) | $testimonials\_loop = $this->get\_testimonials\_loop(array( 'post\_type' => 'testimonial','posts\_per\_page' => $count, 'easy-testimonial-category' => $category, 'orderby' => $orderby, 'order' => $order, 'paged' => get\_query\_var( 'paged' ))); |
| [1306](#L1306) |  |
| [1307](#L1307) | $testimonials = $testimonials\_loop->get\_posts(); |
| [1308](#L1308) |  |
| [1309](#L1309) | $theme\_array = $this->config->load\_theme\_array(); |
| [1310](#L1310) |  |
| [1311](#L1311) | foreach($theme\_array as $theme\_slug => $theme\_name) { |
| [1312](#L1312) |  |
| [1313](#L1313) | $atts['theme'] = $theme\_slug; |
| [1314](#L1314) |  |
| [1315](#L1315) | foreach($testimonials as $this\_testimonial){ |
| [1316](#L1316) | //create a new testimonial object by passing in the current testimonial |
| [1317](#L1317) | $data = array( |
| [1318](#L1318) | 'testimonial' => $this\_testimonial, |
| [1319](#L1319) | 'atts' => $atts |
| [1320](#L1320) | ); |
| [1321](#L1321) |  |
| [1322](#L1322) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [1323](#L1323) |  |
| [1324](#L1324) | //output the testimonials HTML |
| [1325](#L1325) | $testimonial->render(); |
| [1326](#L1326) | } |
| [1327](#L1327) |  |
| [1328](#L1328) | wp\_reset\_postdata(); |
| [1329](#L1329) | } |
| [1330](#L1330) |  |
| [1331](#L1331) | $content = ob\_get\_contents(); |
| [1332](#L1332) | ob\_end\_clean(); |
| [1333](#L1333) |  |
| [1334](#L1334) | return apply\_filters('easy\_t\_testimonials\_html', $content); |
| [1335](#L1335) | } |
| [1336](#L1336) |  |
| [1337](#L1337) | //output all testimonials for use in JS widget |
| [1338](#L1338) | function outputTestimonialsCycle($atts){ |
| [1339](#L1339) | //load shortcode attributes into an array |
| [1340](#L1340) | $atts = shortcode\_atts( array( |
| [1341](#L1341) | 'testimonials\_link' => get\_option('testimonials\_link'), |
| [1342](#L1342) | 'show\_title' => 0, |
| [1343](#L1343) | 'count' => -1, |
| [1344](#L1344) | 'transition' => 'scrollHorz', |
| [1345](#L1345) | 'show\_thumbs' => get\_option('testimonials\_image', true), |
| [1346](#L1346) | 'timer' => '5000', |
| [1347](#L1347) | 'container' => false,//deprecated, use auto\_height instead |
| [1348](#L1348) | 'use\_excerpt' => false, |
| [1349](#L1349) | 'auto\_height' => 'container', |
| [1350](#L1350) | 'category' => '', |
| [1351](#L1351) | 'body\_class' => 'testimonial\_body', |
| [1352](#L1352) | 'author\_class' => 'testimonial\_author', |
| [1353](#L1353) | 'random' => '', |
| [1354](#L1354) | 'orderby' => 'date',//'none','ID','author','title','name','date','modified','parent','rand','menu\_order' |
| [1355](#L1355) | 'order' => 'DESC', // 'ASC, DESC'' |
| [1356](#L1356) | 'pager' => false, |
| [1357](#L1357) | 'show\_pager\_icons' => false, |
| [1358](#L1358) | 'show\_rating' => 'stars', |
| [1359](#L1359) | 'testimonials\_per\_slide' => 1, |
| [1360](#L1360) | 'theme' => get\_option('testimonials\_style', 'light\_grey-classic\_style'), |
| [1361](#L1361) | 'show\_date' => true, |
| [1362](#L1362) | 'show\_other' => true, |
| [1363](#L1363) | 'pause\_on\_hover' => false, |
| [1364](#L1364) | 'prev\_next' => false, |
| [1365](#L1365) | 'width' => false, |
| [1366](#L1366) | 'paused' => false, |
| [1367](#L1367) | 'display\_pagers\_above' => false, |
| [1368](#L1368) | 'hide\_view\_more' => 0, |
| [1369](#L1369) | 'show\_log' => ( defined('WP\_DEBUG') && true === WP\_DEBUG ) ? 1 : 0, |
| [1370](#L1370) | 'output\_schema\_markup' => get\_option('easy\_t\_output\_schema\_markup', true) |
| [1371](#L1371) | ), $atts ); |
| [1372](#L1372) |  |
| [1373](#L1373) | extract($atts); |
| [1374](#L1374) |  |
| [1375](#L1375) | if(!is\_numeric($count)){ |
| [1376](#L1376) | $count = -1; |
| [1377](#L1377) | } |
| [1378](#L1378) |  |
| [1379](#L1379) | ob\_start(); |
| [1380](#L1380) |  |
| [1381](#L1381) | $i = 0; |
| [1382](#L1382) |  |
| [1383](#L1383) | if(!$this->config->is\_pro && !in\_array($transition, array('fadeOut','fade','scrollHorz'))){ |
| [1384](#L1384) | $transition = 'fadeout'; |
| [1385](#L1385) | } |
| [1386](#L1386) |  |
| [1387](#L1387) | //use random WP query to be sure we aren't just randomly sorting a chronologically queried set of testimonials |
| [1388](#L1388) | //this prevents us from just randomly ordering the same 5 testimonials constantly! |
| [1389](#L1389) | if($random){ |
| [1390](#L1390) | $orderby = "rand"; |
| [1391](#L1391) | } |
| [1392](#L1392) |  |
| [1393](#L1393) | //determine if autoheight is set to container or to calculate |
| [1394](#L1394) | //not sure why i did this so backwards to begin with!  oh well... |
| [1395](#L1395) | if($container){ |
| [1396](#L1396) | $container = "container"; |
| [1397](#L1397) | } |
| [1398](#L1398) | if($auto\_height == "calc"){ |
| [1399](#L1399) | $container = "calc"; |
| [1400](#L1400) | } else if($auto\_height == "container"){ |
| [1401](#L1401) | $container = "container"; |
| [1402](#L1402) | } |
| [1403](#L1403) |  |
| [1404](#L1404) | //generate a random number to have a unique wrapping class on each slideshow |
| [1405](#L1405) | //this should prevent controls that effect more than one slideshow on a page |
| [1406](#L1406) | $target = rand(); |
| [1407](#L1407) |  |
| [1408](#L1408) | //use the width for the slideshow wrapper, to keep the previous/next buttons and pager icons within the desired layout |
| [1409](#L1409) | $width = $width ? 'style="width: ' . $width . '"' : 'style="width: ' . get\_option('easy\_t\_width','') . '"'; |
| [1410](#L1410) |  |
| [1411](#L1411) | //load testimonials |
| [1412](#L1412) | $testimonials\_loop = $this->get\_testimonials\_loop(array( 'post\_type' => 'testimonial','posts\_per\_page' => $count, 'orderby' => $orderby, 'order' => $order, 'easy-testimonial-category' => $category)); |
| [1413](#L1413) | //for tracking number of testimonials in this loop |
| [1414](#L1414) | $count = $testimonials\_loop->post\_count; |
| [1415](#L1415) |  |
| [1416](#L1416) | $testimonials = $testimonials\_loop->get\_posts(); |
| [1417](#L1417) |  |
| [1418](#L1418) | ?> |
| [1419](#L1419) | <div class="easy-t-slideshow-wrap <?php echo esc\_attr("easy-t-{$target}");?>" <?php echo esc\_attr($width); ?>> |
| [1420](#L1420) |  |
| [1421](#L1421) | <?php //only display cycle controls if there is more than one testimonial ?> |
| [1422](#L1422) | <?php if($display\_pagers\_above && $count > 1): ?> |
| [1423](#L1423) | <div class="easy-t-cycle-controls"> |
| [1424](#L1424) | <?php if($prev\_next):?><div class="cycle-prev easy-t-cycle-prev"><?php echo esc\_html(get\_option('easy\_t\_previous\_text', '<< Prev')); ?></div><?php endif; ?> |
| [1425](#L1425) | <?php if($pager || $show\_pager\_icons ): ?> |
| [1426](#L1426) | <div class="easy-t-cycle-pager"></div> |
| [1427](#L1427) | <?php endif; ?> |
| [1428](#L1428) | <?php if($prev\_next):?><div class="cycle-next easy-t-cycle-next"><?php echo esc\_html(get\_option('easy\_t\_next\_text', 'Next >>')); ?></div><?php endif; ?> |
| [1429](#L1429) | </div> |
| [1430](#L1430) | <?php endif; ?> |
| [1431](#L1431) |  |
| [1432](#L1432) | <?php |
| [1433](#L1433) | //thanks, wpgaijin |
| [1434](#L1434) | //https://wordpress.org/support/topic/still-got-bugs |
| [1435](#L1435) | $data\_cycle\_array = array( |
| [1436](#L1436) | 'data\_cycle\_fx'             => 'data-cycle-fx="'. $transition .'"', |
| [1437](#L1437) | 'data\_cycle\_timeout'        => 'data-cycle-timeout="'. $timer . '"', |
| [1438](#L1438) | 'data\_cycle\_slides'         => 'data-cycle-slides="div.testimonial\_slide"', |
| [1439](#L1439) | 'data\_cycle\_auto\_height'    => ( $container ) ? 'data-cycle-auto-height="' . $container .'"' : '', |
| [1440](#L1440) | 'data\_cycle\_random'         => ( $random ) ? 'data-cycle-random="true"' : '', |
| [1441](#L1441) | 'data\_cycle\_pause\_on\_hover' => ( $pause\_on\_hover ) ? 'data-cycle-pause-on-hover="true"' : '', |
| [1442](#L1442) | 'data\_cycle\_paused'         => ( $paused ) ? 'data-cycle-paused="true"' : '', |
| [1443](#L1443) | 'data\_cycle\_prev'           => ( $prev\_next ) ? 'data-cycle-prev=".easy-t-' . $target .' .easy-t-cycle-prev"' : '', |
| [1444](#L1444) | 'data\_cycle\_next'           => ( $prev\_next ) ? 'data-cycle-next=".easy-t-' . $target .' .easy-t-cycle-next"' : '', |
| [1445](#L1445) | 'data\_cycle\_pager'          => ( $pager || $show\_pager\_icons ) ? 'data-cycle-pager=".easy-t-'. $target .' .easy-t-cycle-pager"' : '', |
| [1446](#L1446) | 'data-cycle-log'                        => ( !$show\_log ) ? 'data-cycle-log="false"' : '', |
| [1447](#L1447) | 'data-cycle-fix-carousel'       => ( $transition == "carousel" ) ? 'data-cycle-fix-carousel="1"' : '' |
| [1448](#L1448) | ); |
| [1449](#L1449) |  |
| [1450](#L1450) | if ($transition == "carousel"){ |
| [1451](#L1451) | $data\_cycle\_array['data-cycle-fix-carousel-visible'] = 'data-cycle-carousel-visible="'.$testimonials\_per\_slide.'"'; |
| [1452](#L1452) | $data\_cycle\_array['data-cycle-fix-carousel-fluid'] = 'data-cycle-carousel-fluid="true"'; |
| [1453](#L1453) | } |
| [1454](#L1454) |  |
| [1455](#L1455) | $data\_cycle = implode( ' ', $data\_cycle\_array ); |
| [1456](#L1456) | $data\_cycle = rtrim( $data\_cycle ); |
| [1457](#L1457) | ?> |
| [1458](#L1458) | <div class="cycle-slideshow" <?php echo esc\_html($data\_cycle); ?>> |
| [1459](#L1459) | <?php |
| [1460](#L1460) |  |
| [1461](#L1461) | $counter = 0; |
| [1462](#L1462) |  |
| [1463](#L1463) | foreach($testimonials as $this\_testimonial){ |
| [1464](#L1464) | //hide all but the first slide |
| [1465](#L1465) | if($counter == 0){ |
| [1466](#L1466) | $testimonial\_display = ''; |
| [1467](#L1467) | } else { |
| [1468](#L1468) | $testimonial\_display = 'style="display:none;"'; |
| [1469](#L1469) | } |
| [1470](#L1470) |  |
| [1471](#L1471) | //create slide div |
| [1472](#L1472) | //if this is a carousel, bypass the wrapping multiple testimonials in one slide step |
| [1473](#L1473) | if($counter%$testimonials\_per\_slide == 0 || $transition == "carousel"){ |
| [1474](#L1474) | echo "<div { " . esc\_html($testimonial\_display) . "} class=\"testimonial\_slide\">"; |
| [1475](#L1475) | } |
| [1476](#L1476) |  |
| [1477](#L1477) | $counter ++; |
| [1478](#L1478) |  |
| [1479](#L1479) | //create a new testimonial object by passing in the current testimonial |
| [1480](#L1480) | $data = array( |
| [1481](#L1481) | 'testimonial' => $this\_testimonial, |
| [1482](#L1482) | 'atts' => $atts |
| [1483](#L1483) | ); |
| [1484](#L1484) |  |
| [1485](#L1485) | $testimonial = new GP\_Testimonial($data, $this->config); |
| [1486](#L1486) |  |
| [1487](#L1487) | //output the testimonials HTML |
| [1488](#L1488) | $testimonial->render(); |
| [1489](#L1489) |  |
| [1490](#L1490) | //close slide |
| [1491](#L1491) | //if this is a carousel, bypass the wrapping multiple testimonials in one slide step |
| [1492](#L1492) | if($counter%$testimonials\_per\_slide == 0 || $transition == "carousel"){ |
| [1493](#L1493) | echo "</div>"; |
| [1494](#L1494) | } |
| [1495](#L1495) | } |
| [1496](#L1496) |  |
| [1497](#L1497) | wp\_reset\_postdata(); |
| [1498](#L1498) |  |
| [1499](#L1499) | ?> |
| [1500](#L1500) | </div> |
| [1501](#L1501) |  |
| [1502](#L1502) | <?php //only display cycle controls if there is more than one testimonial ?> |
| [1503](#L1503) | <?php if(!$display\_pagers\_above && $count > 1): ?> |
| [1504](#L1504) | <div class="easy-t-cycle-controls"> |
| [1505](#L1505) | <?php if($prev\_next):?><div class="cycle-prev easy-t-cycle-prev"><?php echo esc\_html(get\_option('easy\_t\_previous\_text', '<< Prev')); ?></div><?php endif; ?> |
| [1506](#L1506) | <?php if($pager || $show\_pager\_icons ): ?> |
| [1507](#L1507) | <div class="easy-t-cycle-pager"></div> |
| [1508](#L1508) | <?php endif; ?> |
| [1509](#L1509) | <?php if($prev\_next):?><div class="cycle-next easy-t-cycle-next"><?php echo esc\_html(get\_option('easy\_t\_next\_text', 'Next >>')); ?></div><?php endif; ?> |
| [1510](#L1510) | </div> |
| [1511](#L1511) | <?php endif; ?> |
| [1512](#L1512) |  |
| [1513](#L1513) | </div><!-- end slideshow wrap --><?php |
| [1514](#L1514) |  |
| [1515](#L1515) | $content = ob\_get\_contents(); |
| [1516](#L1516) | ob\_end\_clean(); |
| [1517](#L1517) |  |
| [1518](#L1518) | return apply\_filters( 'easy\_t\_testimonials\_cyle\_html', $content); |
| [1519](#L1519) | } |
| [1520](#L1520) |  |
| [1521](#L1521) | //things to do on plugin activation |
| [1522](#L1522) | function easy\_testimonials\_activation\_hook() { |
| [1523](#L1523) | //flush rewrite rules |
| [1524](#L1524) | $this->easy\_testimonials\_setup\_testimonials(); |
| [1525](#L1525) | flush\_rewrite\_rules(); |
| [1526](#L1526) |  |
| [1527](#L1527) | // make sure the welcome screen gets seen again |
| [1528](#L1528) | if ( !empty($this->Aloha) ) { |
| [1529](#L1529) | $this->Aloha->reset\_welcome\_screen(); |
| [1530](#L1530) | } |
| [1531](#L1531) |  |
| [1532](#L1532) | // generate example testimonials on first activation |
| [1533](#L1533) | $this->generate\_example\_testimonials(); |
| [1534](#L1534) | } |
| [1535](#L1535) |  |
| [1536](#L1536) | // run during plugin activation |
| [1537](#L1537) | // checks to see if flag for having created example testimonials is set |
| [1538](#L1538) | // if not, insert example testimonials and set flag |
| [1539](#L1539) | function generate\_example\_testimonials( $force = false ){ |
| [1540](#L1540) | $has\_generated\_examples = get\_option('ezt\_has\_generated\_examples', false); |
| [1541](#L1541) |  |
| [1542](#L1542) | $number\_of\_testimonials = wp\_count\_posts('testimonial'); |
| [1543](#L1543) | $total\_testimonials = $number\_of\_testimonials->publish + $number\_of\_testimonials->draft + $number\_of\_testimonials->future + $number\_of\_testimonials->pending; |
| [1544](#L1544) |  |
| [1545](#L1545) | //if we haven't generated examples yet |
| [1546](#L1546) | //and the user hasn't added any testimonials of their own |
| [1547](#L1547) | //then make some |
| [1548](#L1548) | if( (!$has\_generated\_examples && $total\_testimonials < 1) || $force ){ |
| [1549](#L1549) | //make some testimonials |
| [1550](#L1550) | //add a custom field that identifies these as examples, for easy functional removal |
| [1551](#L1551) | $example\_testimonial\_1 = array( |
| [1552](#L1552) | 'post\_title' => 'This is a great product.', |
| [1553](#L1553) | 'post\_content' => 'I needed a simple, easy-to-use way to add testimonials to my website and display them.  Easy Testimonials Pro did all of that and more!', |
| [1554](#L1554) | 'post\_status' => 'publish', |
| [1555](#L1555) | 'post\_type' => 'testimonial' |
| [1556](#L1556) | ); |
| [1557](#L1557) |  |
| [1558](#L1558) | $example\_testimonial\_custom\_fields\_1 = array( |
| [1559](#L1559) | 'item\_reviewed' => 'Easy Testimonials', |
| [1560](#L1560) | 'rating' => '5', |
| [1561](#L1561) | 'client\_name' => 'Janet Exampleton', |
| [1562](#L1562) | 'position' => 'Owner, Exampleton Productions', |
| [1563](#L1563) | 'image' => 'avatar-1.jpg', |
| [1564](#L1564) | 'is\_example\_testimonial' => '1' |
| [1565](#L1565) | ); |
| [1566](#L1566) |  |
| [1567](#L1567) | $example\_testimonial\_2 = array( |
| [1568](#L1568) | 'post\_title' => 'Excellent Customer Support', |
| [1569](#L1569) | 'post\_content' => 'I receieved excellent customer support, and quickly. Thank you so much!', |
| [1570](#L1570) | 'post\_status' => 'publish', |
| [1571](#L1571) | 'post\_type' => 'testimonial' |
| [1572](#L1572) | ); |
| [1573](#L1573) |  |
| [1574](#L1574) | $example\_testimonial\_custom\_fields\_2 = array( |
| [1575](#L1575) | 'item\_reviewed' => 'Easy Testimonials', |
| [1576](#L1576) | 'rating' => '5', |
| [1577](#L1577) | 'client\_name' => 'Linda Herman', |
| [1578](#L1578) | 'position' => 'Founder, Herman Studios', |
| [1579](#L1579) | 'image' => 'avatar-2.jpg', |
| [1580](#L1580) | 'is\_example\_testimonial' => '1' |
| [1581](#L1581) | ); |
| [1582](#L1582) |  |
| [1583](#L1583) | $example\_testimonial\_3 = array( |
| [1584](#L1584) | 'post\_title' => 'Would recommend to anyone', |
| [1585](#L1585) | 'post\_content' => 'I love your product! I would recommend this to anyone. What a great find!', |
| [1586](#L1586) | 'post\_status' => 'publish', |
| [1587](#L1587) | 'post\_type' => 'testimonial' |
| [1588](#L1588) | ); |
| [1589](#L1589) |  |
| [1590](#L1590) | $example\_testimonial\_custom\_fields\_3 = array( |
| [1591](#L1591) | 'item\_reviewed' => 'Easy Testimonials', |
| [1592](#L1592) | 'rating' => '5', |
| [1593](#L1593) | 'client\_name' => 'Steve', |
| [1594](#L1594) | 'position' => 'Developer, Acme Co.', |
| [1595](#L1595) | 'image' => 'avatar-3.jpg', |
| [1596](#L1596) | 'is\_example\_testimonial' => '1' |
| [1597](#L1597) | ); |
| [1598](#L1598) |  |
| [1599](#L1599) | $this->create\_example\_testimonial($example\_testimonial\_1, $example\_testimonial\_custom\_fields\_1); |
| [1600](#L1600) | $this->create\_example\_testimonial($example\_testimonial\_2, $example\_testimonial\_custom\_fields\_2); |
| [1601](#L1601) | $this->create\_example\_testimonial($example\_testimonial\_3, $example\_testimonial\_custom\_fields\_3); |
| [1602](#L1602) |  |
| [1603](#L1603) | //set flag in options so we know this has been run once |
| [1604](#L1604) | update\_option('ezt\_has\_generated\_examples', true); |
| [1605](#L1605) | } else { |
| [1606](#L1606) | /\* wp\_die("Has generated examples."); \*/ |
| [1607](#L1607) | } |
| [1608](#L1608) | } |
| [1609](#L1609) |  |
| [1610](#L1610) | function create\_example\_testimonial($example\_testimonial, $example\_testimonial\_custom\_fields) |
| [1611](#L1611) | { |
| [1612](#L1612) | $new\_id = 0; |
| [1613](#L1613) | $new\_id = wp\_insert\_post($example\_testimonial); |
| [1614](#L1614) | $avatar\_path = (trailingslashit( dirname( \_\_FILE\_\_ ) ) . 'include/assets/img/examples/' . $example\_testimonial\_custom\_fields['image']); |
| [1615](#L1615) | $this->set\_featured\_image\_from\_file($avatar\_path, $new\_id); |
| [1616](#L1616) |  |
| [1617](#L1617) | // save each testimonial field as a post meta field |
| [1618](#L1618) | foreach ($example\_testimonial\_custom\_fields as $key => $val) { |
| [1619](#L1619) | if ( strpos($key, '\_cf\_') === false ) { |
| [1620](#L1620) | // save standard field |
| [1621](#L1621) | $meta\_key = '\_ikcf\_' . $key; |
| [1622](#L1622) | } |
| [1623](#L1623) | else { |
| [1624](#L1624) | // save custom field (no prefix) |
| [1625](#L1625) | $meta\_key = $key; |
| [1626](#L1626) | } |
| [1627](#L1627) |  |
| [1628](#L1628) | // rename keys for weird cases from old versions of Easy Testimonials |
| [1629](#L1629) | if ( '\_ikcf\_client\_name' == $meta\_key ) { |
| [1630](#L1630) | $meta\_key = '\_ikcf\_client'; |
| [1631](#L1631) | } |
| [1632](#L1632) | else if ( '\_ikcf\_item\_reviewed' == $meta\_key ) { |
| [1633](#L1633) | $meta\_key = '\_ikcf\_other'; |
| [1634](#L1634) | } |
| [1635](#L1635) |  |
| [1636](#L1636) | // now that we have determined the correct key, we actually save the value |
| [1637](#L1637) | update\_post\_meta( $new\_id, $meta\_key, $val ); |
| [1638](#L1638) | } |
| [1639](#L1639) | return $new\_id; |
| [1640](#L1640) | } |
| [1641](#L1641) |  |
| [1642](#L1642) | //register any widgets here |
| [1643](#L1643) | function easy\_testimonials\_register\_widgets() { |
| [1644](#L1644) | include('include/widgets/random\_testimonial\_widget.php'); |
| [1645](#L1645) | include('include/widgets/single\_testimonial\_widget.php'); |
| [1646](#L1646) | include('include/widgets/testimonial\_cycle\_widget.php'); |
| [1647](#L1647) | include('include/widgets/testimonial\_list\_widget.php'); |
| [1648](#L1648) | include('include/widgets/testimonial\_grid\_widget.php'); |
| [1649](#L1649) |  |
| [1650](#L1650) | register\_widget( 'randomTestimonialWidget' ); |
| [1651](#L1651) | register\_widget( 'cycledTestimonialWidget' ); |
| [1652](#L1652) | register\_widget( 'listTestimonialsWidget' ); |
| [1653](#L1653) | register\_widget( 'singleTestimonialWidget' ); |
| [1654](#L1654) | register\_widget( 'TestimonialsGridWidget' ); |
| [1655](#L1655) | } |
| [1656](#L1656) |  |
| [1657](#L1657) | function easy\_testimonials\_admin\_enqueue\_scripts($hook) |
| [1658](#L1658) | { |
| [1659](#L1659) | //RWG: only enqueue scripts and styles on Easy T admin pages or widgets page |
| [1660](#L1660) | $screen = get\_current\_screen(); |
| [1661](#L1661) | $cpt = $this->determine\_current\_post\_type(); |
| [1662](#L1662) |  |
| [1663](#L1663) | if ( strpos($hook,'easy-testimonials') !== false || |
| [1664](#L1664) | $screen->id === "widgets" || |
| [1665](#L1665) | (function\_exists('is\_customize\_preview') && is\_customize\_preview()) || |
| [1666](#L1666) | 'testimonial' == $cpt ) |
| [1667](#L1667) | { |
| [1668](#L1668) | wp\_register\_style( 'easy\_testimonials\_admin\_stylesheet', plugins\_url('include/assets/css/admin\_style.css', \_\_FILE\_\_) ); |
| [1669](#L1669) | wp\_enqueue\_style( 'easy\_testimonials\_admin\_stylesheet' ); |
| [1670](#L1670) | wp\_enqueue\_script( |
| [1671](#L1671) | 'easy-testimonials-admin', |
| [1672](#L1672) | plugins\_url('include/assets/js/easy-testimonials-admin.js', \_\_FILE\_\_), |
| [1673](#L1673) | array( 'jquery' ), |
| [1674](#L1674) | false, |
| [1675](#L1675) | true |
| [1676](#L1676) | ); |
| [1677](#L1677) | wp\_enqueue\_script( |
| [1678](#L1678) | 'gp-admin\_easy\_t', |
| [1679](#L1679) | plugins\_url('include/assets/js/gp-admin\_v2.js', \_\_FILE\_\_), |
| [1680](#L1680) | array( 'jquery' ), |
| [1681](#L1681) | false, |
| [1682](#L1682) | true |
| [1683](#L1683) | ); |
| [1684](#L1684) |  |
| [1685](#L1685) | // Localize the script with new data |
| [1686](#L1686) | $admin\_translation\_array = array( |
| [1687](#L1687) | 'str\_demo\_content\_created' => \_\_('Demo testimonials have been created!', 'easy-testimonials'), |
| [1688](#L1688) | 'str\_demo\_content\_deleted' => \_\_('All demo testimonials have been deleted.', 'easy-testimonials'), |
| [1689](#L1689) | ); |
| [1690](#L1690) | wp\_localize\_script( 'easy-testimonials-admin', 'easy\_testimonials\_admin\_strings', $admin\_translation\_array ); |
| [1691](#L1691) |  |
| [1692](#L1692) | //add any additional scripts using this hook |
| [1693](#L1693) | do\_action( 'easy\_t\_admin\_enqueue\_scripts', $hook ); |
| [1694](#L1694) | } |
| [1695](#L1695) |  |
| [1696](#L1696) | //RWG: include pro styles on Theme Selection screen, for preview purposes |
| [1697](#L1697) | if(strpos($hook,'easy-testimonials-style-settings')!==false){ |
| [1698](#L1698) | //basic styling |
| [1699](#L1699) | wp\_register\_style( 'easy\_testimonial\_style', plugins\_url('include/assets/css/style.css', \_\_FILE\_\_) ); |
| [1700](#L1700) | wp\_enqueue\_style( 'easy\_testimonial\_style' ); |
| [1701](#L1701) | } |
| [1702](#L1702) |  |
| [1703](#L1703) | // also include some styles on \*all\* admin pages |
| [1704](#L1704) | wp\_register\_style( 'easy\_testimonials\_admin\_stylesheet\_global', plugins\_url('include/assets/css/admin\_style\_global.css', \_\_FILE\_\_) ); |
| [1705](#L1705) | wp\_enqueue\_style( 'easy\_testimonials\_admin\_stylesheet\_global' ); |
| [1706](#L1706) | } |
| [1707](#L1707) |  |
| [1708](#L1708) | function determine\_current\_post\_type() |
| [1709](#L1709) | { |
| [1710](#L1710) |  |
| [1711](#L1711) | global $post, $typenow, $current\_screen; |
| [1712](#L1712) |  |
| [1713](#L1713) | if ( !empty($post) && !empty($post->post\_type) ) { |
| [1714](#L1714) | return $post->post\_type; |
| [1715](#L1715) | } |
| [1716](#L1716) | elseif ( !empty($typenow) ) { |
| [1717](#L1717) | return $typenow; |
| [1718](#L1718) | } |
| [1719](#L1719) | elseif( !empty($current\_screen) && !empty($current\_screen->post\_type) ) { |
| [1720](#L1720) | return $current\_screen->post\_type; |
| [1721](#L1721) | } |
| [1722](#L1722) | elseif( isset($\_REQUEST['post\_type']) ) { |
| [1723](#L1723) | return sanitize\_key($\_REQUEST['post\_type']); |
| [1724](#L1724) | } |
| [1725](#L1725) | return ''; |
| [1726](#L1726) | } |
| [1727](#L1727) |  |
| [1728](#L1728) | //check for installed plugins with known conflicts |
| [1729](#L1729) | //if any are found, display appropriate messaging with suggested steps |
| [1730](#L1730) | //currently only checks for woothemes testimonials |
| [1731](#L1731) | function easy\_testimonials\_conflict\_check($hook\_suffix){ |
| [1732](#L1732) |  |
| [1733](#L1733) | /\* Avada Check \*/ |
| [1734](#L1734) | $my\_theme = wp\_get\_theme(); |
| [1735](#L1735) | if( strpos( $my\_theme->get('Name'), "Avada" ) === 0 ) { |
| [1736](#L1736) | // looks like we are using Avada! |
| [1737](#L1737) | // make sure we have avada compatibility enabled. If not, show a warning! |
| [1738](#L1738) | if(!get\_option('easy\_t\_avada\_filter\_override', false)){ |
| [1739](#L1739) | add\_action('admin\_notices', array($this, 'easy\_t\_avada\_admin\_notice') ); |
| [1740](#L1740) | } |
| [1741](#L1741) | } |
| [1742](#L1742) |  |
| [1743](#L1743) | // only run the rest of the checks on Easy Testimonials pages |
| [1744](#L1744) | if (strpos($hook\_suffix,'easy-testimonials') === false) { |
| [1745](#L1745) | return; |
| [1746](#L1746) | } |
| [1747](#L1747) |  |
| [1748](#L1748) | /\* WooThemes Testimonials Check \*/ |
| [1749](#L1749) | $woothemes\_testimonials = "testimonials-by-woothemes/woothemes-testimonials.php"; |
| [1750](#L1750) | if(is\_plugin\_active($woothemes\_testimonials)){//woothemes testimonials found |
| [1751](#L1751) | add\_action('admin\_notices', array($this, 'easy\_t\_woothemes\_testimonials\_admin\_notice') ); |
| [1752](#L1752) | } |
| [1753](#L1753) |  |
| [1754](#L1754) | /\* WP Engine Check \*/ |
| [1755](#L1755) | if( class\_exists( 'WpeCommon' ) ){ |
| [1756](#L1756) | add\_action('admin\_notices', array($this, 'easy\_t\_wpengine\_admin\_notice') ); |
| [1757](#L1757) | } |
| [1758](#L1758) | } |
| [1759](#L1759) |  |
| [1760](#L1760) | //output warning message about wpengine conflicts |
| [1761](#L1761) | function easy\_t\_wpengine\_admin\_notice(){ |
| [1762](#L1762) | echo '<div class="gp\_error fade"><p>'; |
| [1763](#L1763) | echo '<strong>ALERT:</strong> We have detected that this site us running on WP Engine.<br/><br/>  Random Testimonials will not work if you have disabled Random SQL Queries under your WP Engine Options.'; |
| [1764](#L1764) | echo "</p></div>"; |
| [1765](#L1765) | } |
| [1766](#L1766) |  |
| [1767](#L1767) | //output warning message about woothemes testimonials conflicts |
| [1768](#L1768) | function easy\_t\_woothemes\_testimonials\_admin\_notice(){ |
| [1769](#L1769) | echo '<div class="gp\_error fade"><p>'; |
| [1770](#L1770) | echo '<strong>ALERT:</strong> We have detected that Testimonials by WooThemes is installed.<br/><br/>  This plugin has known conflicts with Easy Testimonials. To prevent any issues, we recommend deactivating Testimonials by WooThemes while using Easy Testimonials.'; |
| [1771](#L1771) | echo "</p></div>"; |
| [1772](#L1772) | } |
| [1773](#L1773) |  |
| [1774](#L1774) | //output warning message about avada conflicts |
| [1775](#L1775) | function easy\_t\_avada\_admin\_notice() { |
| [1776](#L1776) | echo '<div class="gp\_error fade"><p>'; |
| [1777](#L1777) | echo '<strong>ALERT:</strong> Easy Testimonials has detected that Avada by Theme Fusion is installed.<br/><br/>  To ensure compatibility, please <a href="' . esc\_url(admin\_url( "admin.php?page=easy-testimonials-advanced-settings#tab-compatibility\_options" )) . '">visit our Compatibility Options</a> on the Advanced Settings tab and verify that "Override Avada Blog Post Content Filter on Testimonials" is checked.'; |
| [1778](#L1778) | echo "</p></div>"; |
| [1779](#L1779) | } |
| [1780](#L1780) |  |
| [1781](#L1781) | // add inline links to our plugin's description area on the Plugins page |
| [1782](#L1782) | function add\_custom\_links\_to\_plugin\_description($links, $file) { |
| [1783](#L1783) |  |
| [1784](#L1784) | /\*\* Check if the plugin file name matches the passed $file name \*/ |
| [1785](#L1785) | if ( $file == $this->plugin ) |
| [1786](#L1786) | { |
| [1787](#L1787) | $new\_links['settings\_link'] = '<a href="admin.php?page=easy-testimonials-settings">Settings</a>'; |
| [1788](#L1788) | $new\_links['support\_link'] = '<a href="https://goldplugins.com/contact/?utm-source=plugin\_menu&utm\_campaign=support&utm\_banner=plugin\_list\_support\_link" target="\_blank">Get Support</a>'; |
| [1789](#L1789) |  |
| [1790](#L1790) | if(!$this->config->is\_pro){ |
| [1791](#L1791) | $new\_links['upgrade\_to\_pro'] = '<a href="https://goldplugins.com/our-plugins/easy-testimonials-details/upgrade-to-easy-testimonials-pro/?utm\_source=plugin\_menu&utm\_campaign=upgrade" target="\_blank">Upgrade to Pro</a>'; |
| [1792](#L1792) | } |
| [1793](#L1793) |  |
| [1794](#L1794) | $links = array\_merge( $links, $new\_links); |
| [1795](#L1795) | } |
| [1796](#L1796) | return $links; |
| [1797](#L1797) | } |
| [1798](#L1798) |  |
| [1799](#L1799) | //add an inline link to the settings page, before the "deactivate" link |
| [1800](#L1800) | function add\_settings\_link\_to\_plugin\_action\_links($links) |
| [1801](#L1801) | { |
| [1802](#L1802) | $settings\_link = sprintf( '<a href="%s">%s</a>', admin\_url('admin.php?page=easy-testimonials-settings'), \_\_('Settings') ); |
| [1803](#L1803) | array\_unshift($links, $settings\_link); |
| [1804](#L1804) |  |
| [1805](#L1805) | $docs\_link = sprintf( '<a href="%s">%s</a>', 'https://goldplugins.com/documentation/easy-testimonials-documentation/?utm\_source=easy-testimonials-action-links&utm\_campaign=easy\_t\_docs', \_\_('Documentation') ); |
| [1806](#L1806) | array\_unshift($links, $docs\_link); |
| [1807](#L1807) |  |
| [1808](#L1808) | if(!$this->config->is\_pro){ |
| [1809](#L1809) | $upgrade\_url = 'https://goldplugins.com/our-plugins/easy-testimonials-details/upgrade-to-easy-testimonials-pro/?utm\_source=easy\_t\_free\_plugin&utm\_campaign=upgrade\_to\_pro'; |
| [1810](#L1810) | $upgrade\_link = sprintf( '<a href="%s" target="\_blank" style="color: #e64a19; font-weight: bold; font-size: 108%%;">%s</a>', $upgrade\_url, \_\_('Upgrade to Pro') ); |
| [1811](#L1811) | array\_unshift($links, $upgrade\_link); |
| [1812](#L1812) | } |
| [1813](#L1813) |  |
| [1814](#L1814) | if ( isset($links['edit']) ) { |
| [1815](#L1815) | unset($links['edit']); |
| [1816](#L1816) | } |
| [1817](#L1817) |  |
| [1818](#L1818) | return $links; |
| [1819](#L1819) | } |
| [1820](#L1820) |  |
| [1821](#L1821) | /\* Displays a meta box with the shortcodes to display the current testimonial \*/ |
| [1822](#L1822) | function easy\_t\_display\_shortcodes\_meta\_box() { |
| [1823](#L1823) | global $post; |
| [1824](#L1824) | echo "<strong>To display this testimonial</strong>, add this shortcode to any post or page:<br />"; |
| [1825](#L1825) | $ex\_shortcode = sprintf('[single\_testimonial id="%d"]', $post->ID); |
| [1826](#L1826) | printf('<textarea class="gp\_highlight\_code">%s</textarea>', esc\_html($ex\_shortcode)); |
| [1827](#L1827) | } |
| [1828](#L1828) |  |
| [1829](#L1829) | /\* Styling Functions \*/ |
| [1830](#L1830) |  |
| [1831](#L1831) | function list\_required\_google\_fonts() |
| [1832](#L1832) | { |
| [1833](#L1833) | // check each typography setting for google fonts, and build a list |
| [1834](#L1834) | $option\_keys = array( |
| [1835](#L1835) | 'easy\_t\_body\_font\_family', |
| [1836](#L1836) | 'easy\_t\_author\_font\_family', |
| [1837](#L1837) | 'easy\_t\_position\_font\_family', |
| [1838](#L1838) | 'easy\_t\_date\_font\_family', |
| [1839](#L1839) | 'easy\_t\_rating\_font\_family' |
| [1840](#L1840) | ); |
| [1841](#L1841) | $fonts = array(); |
| [1842](#L1842) | foreach ($option\_keys as $option\_key) { |
| [1843](#L1843) | $option\_value = get\_option($option\_key); |
| [1844](#L1844) | if (strpos($option\_value, 'google:') !== FALSE) { |
| [1845](#L1845) | $option\_value = str\_replace('google:', '', $option\_value); |
| [1846](#L1846) |  |
| [1847](#L1847) | //only add the font to the array if it was in fact a google font |
| [1848](#L1848) | $fonts[$option\_value] = $option\_value; |
| [1849](#L1849) | } |
| [1850](#L1850) | } |
| [1851](#L1851) | return $fonts; |
| [1852](#L1852) | } |
| [1853](#L1853) |  |
| [1854](#L1854) | // Enqueue any needed Google Web Fonts |
| [1855](#L1855) | function enqueue\_webfonts() |
| [1856](#L1856) | { |
| [1857](#L1857) | $cache\_key = '\_easy\_t\_webfont\_str'; |
| [1858](#L1858) | $font\_str = get\_transient($cache\_key); |
| [1859](#L1859) | if ($font\_str == false) { |
| [1860](#L1860) | $font\_list = $this->list\_required\_google\_fonts(); |
| [1861](#L1861) | if ( !empty($font\_list) ) { |
| [1862](#L1862) | $font\_list\_encoded = array\_map('urlencode', $font\_list); |
| [1863](#L1863) | $font\_str = implode('|', $font\_list\_encoded); |
| [1864](#L1864) | } else { |
| [1865](#L1865) | $font\_str = 'x'; |
| [1866](#L1866) | } |
| [1867](#L1867) | set\_transient($cache\_key, $font\_str); |
| [1868](#L1868) | } |
| [1869](#L1869) |  |
| [1870](#L1870) | //don't register this unless a font is set to register |
| [1871](#L1871) | if(strlen($font\_str)>2){ |
| [1872](#L1872) | $protocol = is\_ssl() ? 'https:' : 'http:'; |
| [1873](#L1873) | $font\_url = $protocol . '//fonts.googleapis.com/css?family=' . $font\_str; |
| [1874](#L1874) | wp\_register\_style( 'easy\_testimonials\_webfonts', $font\_url); |
| [1875](#L1875) | wp\_enqueue\_style( 'easy\_testimonials\_webfonts' ); |
| [1876](#L1876) | } |
| [1877](#L1877) | } |
| [1878](#L1878) |  |
| [1879](#L1879) | //checks for registered shortcodes and displays alert on settings screen if there are any current conflicts |
| [1880](#L1880) | function easy\_testimonials\_shortcode\_checker(array $atts){ |
| [1881](#L1881) | //TBD |
| [1882](#L1882) | } |
| [1883](#L1883) |  |
| [1884](#L1884) | //search form shortcode |
| [1885](#L1885) | function easy\_t\_search\_form\_shortcode() |
| [1886](#L1886) | { |
| [1887](#L1887) | add\_filter('get\_search\_form', array($this, 'easy\_t\_restrict\_search\_to\_custom\_post\_type'), 10); |
| [1888](#L1888) | $search\_html = get\_search\_form(); |
| [1889](#L1889) | remove\_filter('get\_search\_form', array($this, 'easy\_t\_restrict\_search\_to\_custom\_post\_type')); |
| [1890](#L1890) | return $search\_html; |
| [1891](#L1891) | } |
| [1892](#L1892) |  |
| [1893](#L1893) | function easy\_t\_restrict\_search\_to\_custom\_post\_type($search\_html) |
| [1894](#L1894) | { |
| [1895](#L1895) | $post\_type = 'testimonial'; |
| [1896](#L1896) | $hidden\_input = sprintf('<input type="hidden" name="post\_type" value="%s">', $post\_type); |
| [1897](#L1897) | $replace\_with = $hidden\_input . '</form>'; |
| [1898](#L1898) | return str\_replace('</form>', $replace\_with, $search\_html); |
| [1899](#L1899) | } |
| [1900](#L1900) |  |
| [1901](#L1901) | /\*\* |
| [1902](#L1902) | \* If the user has an active key but doesn't have the Pro plugin, show them |
| [1903](#L1903) | \* a notice to this effect. |
| [1904](#L1904) | \*/ |
| [1905](#L1905) | function pro\_plugin\_upgrade\_notice() |
| [1906](#L1906) | { |
| [1907](#L1907) | // Only show notices to pro users without the Pro plugin |
| [1908](#L1908) | // who also have an email set (suggesting a old user) |
| [1909](#L1909) | $pro\_plugin\_path = "easy-testimonials-pro/easy-testimonials-pro.php"; |
| [1910](#L1910) | $registered\_name = get\_option('\_easy\_t\_registered\_name', false); |
| [1911](#L1911) |  |
| [1912](#L1912) | if ( empty($registered\_name) |
| [1913](#L1913) | || !$this->config->is\_pro |
| [1914](#L1914) | || is\_plugin\_active($pro\_plugin\_path) ) { |
| [1915](#L1915) | return; |
| [1916](#L1916) | } |
| [1917](#L1917) |  |
| [1918](#L1918) | // Quit if the user has already dismissed the notice, unless this is an |
| [1919](#L1919) | // Easy T settings page, in which case we always show the notice |
| [1920](#L1920) | $is\_easy\_t\_page = !empty( $\_GET['page'] ) && (strpos($\_GET['page'], 'easy-t') !== false); |
| [1921](#L1921) | $easy\_t\_hide\_pro\_plugin\_notice = get\_option('easy\_t\_hide\_pro\_plugin\_notice'); |
| [1922](#L1922) |  |
| [1923](#L1923) | if ( !$is\_easy\_t\_page && !empty( $easy\_t\_hide\_pro\_plugin\_notice ) ) { |
| [1924](#L1924) | return; |
| [1925](#L1925) | } |
| [1926](#L1926) |  |
| [1927](#L1927) | // don't show the notice on the Install Pro Plugin page |
| [1928](#L1928) | $hide\_on\_pages =  array( |
| [1929](#L1929) | 'easy-testimonials-install-plugins', |
| [1930](#L1930) | 'easy\_testimonials\_pro\_error\_page', |
| [1931](#L1931) | ); |
| [1932](#L1932) | $is\_plugin\_install\_page = !empty( $\_GET['page'] ) && in\_array($\_GET['page'], $hide\_on\_pages); |
| [1933](#L1933) | if ( $is\_plugin\_install\_page ) { |
| [1934](#L1934) | return; |
| [1935](#L1935) | } |
| [1936](#L1936) |  |
| [1937](#L1937) | // render the message |
| [1938](#L1938) | $div\_style = "border: 4px solid #46b450; padding: 20px 38px 10px 20px;"; |
| [1939](#L1939) | $heading\_style = "color: green; font-size: 20px; font-family: -apple-system,BlinkMacSystemFont,&quot;Segoe UI&quot;,Roboto,Oxygen-Sans,Ubuntu,Cantarell,&quot;Helvetica Neue&quot;,sans-serif; font-weight: 600"; |
| [1940](#L1940) | $p\_style = "font-size: 16px; font-weight: normal; margin-bottom: 1em;"; |
| [1941](#L1941) | $button\_style = "font-size: 16px; height: 52px; line-height: 50px;"; |
| [1942](#L1942) | $package\_url = get\_option('\_easy\_testimonials\_upgrade\_package\_url', ''); |
| [1943](#L1943) | $next\_url = !empty($package\_url) |
| [1944](#L1944) | ? admin\_url('admin.php?page=easy-testimonials-install-plugins') |
| [1945](#L1945) | : admin\_url('admin.php?page=easy\_testimonials\_pro\_privacy\_notice'); |
| [1946](#L1946) |  |
| [1947](#L1947) | $message = sprintf( '<h3 style="%s">%s</h3>', |
| [1948](#L1948) | $heading\_style, |
| [1949](#L1949) | 'Easy Testimonials Pro - ' . \_\_('Update Required') |
| [1950](#L1950) | ); |
| [1951](#L1951) | $message .= sprintf( '<p style="%s">%s</p>', $p\_style, \_\_('In order to keep using all the great features of Easy Testimonials Pro, you\'ll need to install the Easy Testimonials Pro plugin. Without this, Pro features such as your Submit A Testimonial form will not work.') ); |
| [1952](#L1952) | $message .= sprintf( '<p style="%s">%s</p>', $p\_style, \_\_('Installing Easy Testimonials Pro only takes a moment. None of your data or settings will be affected.') ); |
| [1953](#L1953) | $message .= sprintf( '<p style="%s">%s</p>', $p\_style,  \_\_('Click the button below to begin.') ); |
| [1954](#L1954) | $message .= sprintf( '<p style="%s"><a class="button button-primary button-hero" style="%s" href="%s">%s</a></p>', |
| [1955](#L1955) | $p\_style, |
| [1956](#L1956) | $button\_style, |
| [1957](#L1957) | $next\_url, |
| [1958](#L1958) | \_\_('Install Easy Testimonials Pro') |
| [1959](#L1959) | ); |
| [1960](#L1960) | $div\_id = 'easy\_testimonials\_pro\_plugin\_notice'; |
| [1961](#L1961) | printf ( '<div id="%s" style="%s" class="notice notice-%s is-dismissible easy\_t\_install\_pro\_plugin\_notice">%s</div>', |
| [1962](#L1962) | esc\_attr($div\_id), |
| [1963](#L1963) | esc\_attr($div\_style), |
| [1964](#L1964) | 'success', |
| [1965](#L1965) | esc\_html($message) ); |
| [1966](#L1966) | } |
| [1967](#L1967) |  |
| [1968](#L1968) | /\*\* |
| [1969](#L1969) | \* Adds an inline script to watch for clicks on the "Pro plugin required" |
| [1970](#L1970) | \* notice's dismiss button |
| [1971](#L1971) | \*/ |
| [1972](#L1972) | function enqueue\_inline\_script\_for\_notices($hook = '') |
| [1973](#L1973) | { |
| [1974](#L1974) | $js = ' |
| [1975](#L1975) | jQuery(function () { |
| [1976](#L1976) | jQuery("#easy\_testimonials\_pro\_plugin\_notice").on("click", ".notice-dismiss", function () { |
| [1977](#L1977) | jQuery.post( |
| [1978](#L1978) | ajaxurl, |
| [1979](#L1979) | { |
| [1980](#L1980) | action: "easy\_t\_dismiss\_pro\_plugin\_notice" |
| [1981](#L1981) | } |
| [1982](#L1982) | ); |
| [1983](#L1983) | }); |
| [1984](#L1984) | }); |
| [1985](#L1985) | '; |
| [1986](#L1986) | if ( !wp\_script\_is( 'jquery', 'done' ) ) { |
| [1987](#L1987) | wp\_enqueue\_script( 'jquery' ); |
| [1988](#L1988) | } |
| [1989](#L1989) | // note: attach to jquery-core, not jquery, or it won't fire |
| [1990](#L1990) | wp\_add\_inline\_script('jquery-core', $js); |
| [1991](#L1991) | } |
| [1992](#L1992) |  |
| [1993](#L1993) | /\*\* |
| [1994](#L1994) | \* AJAX hook - records dismissal of the "Pro plugin required" notice. |
| [1995](#L1995) | \*/ |
| [1996](#L1996) | function dismiss\_pro\_plugin\_upgrade\_notice() |
| [1997](#L1997) | { |
| [1998](#L1998) | update\_option('easy\_t\_hide\_pro\_plugin\_notice', 1); |
| [1999](#L1999) | wp\_die('OK'); |
| [2000](#L2000) | } |
| [2001](#L2001) |  |
| [2002](#L2002) | function pro\_activation\_hook() |
| [2003](#L2003) | { |
| [2004](#L2004) | // delete registered name field (no longer needed with |
| [2005](#L2005) | // Pro plugin installed) |
| [2006](#L2006) | delete\_option('easy\_t\_registered\_name'); |
| [2007](#L2007) | } |
| [2008](#L2008) |  |
| [2009](#L2009) | /\* Avada Compatibility \*/ |
| [2010](#L2010) | //make our own version of the avada blog post content function that doesn't run if the current post type is a testimonial |
| [2011](#L2011) | //since avada uses !function\_exists correctly, our function will be declared first and will win! |
| [2012](#L2012) |  |
| [2013](#L2013) | function avada\_render\_blog\_post\_content() { |
| [2014](#L2014) | global $post; |
| [2015](#L2015) | if($post->post\_type != "testimonial"){ |
| [2016](#L2016) | if ( is\_search() && Avada()->settings->get( 'search\_excerpt' ) ) { |
| [2017](#L2017) | return; |
| [2018](#L2018) | } |
| [2019](#L2019) | if ( function\_exists('fusion\_get\_post\_content') ) { |
| [2020](#L2020) | echo wp\_kses\_post( fusion\_get\_post\_content() ); |
| [2021](#L2021) | } |
| [2022](#L2022) | } |
| [2023](#L2023) | } |
| [2024](#L2024) |  |
| [2025](#L2025) | //make our own version of the avada post title function that doesn't run if the current post type is a testimonial |
| [2026](#L2026) | function avada\_render\_post\_title( $post\_id = '', $linked = TRUE, $custom\_title = '', $custom\_size = '2' ) { |
| [2027](#L2027) | global $post; |
| [2028](#L2028) | if($post->post\_type != "testimonial"){ |
| [2029](#L2029) | $entry\_title\_class = ''; |
| [2030](#L2030) |  |
| [2031](#L2031) | // Add the entry title class if rich snippets are enabled |
| [2032](#L2032) | if ( ! Avada()->settings->get( 'disable\_date\_rich\_snippet\_pages' ) ) { |
| [2033](#L2033) | $entry\_title\_class = ' class="entry-title"'; |
| [2034](#L2034) | } |
| [2035](#L2035) |  |
| [2036](#L2036) | // If we have a custom title, use it |
| [2037](#L2037) | if ( $custom\_title ) { |
| [2038](#L2038) | $title = $custom\_title; |
| [2039](#L2039) | // Otherwise get post title |
| [2040](#L2040) | } else { |
| [2041](#L2041) | $title = get\_the\_title( $post\_id ); |
| [2042](#L2042) | } |
| [2043](#L2043) |  |
| [2044](#L2044) | // If the post title should be linked at the markup |
| [2045](#L2045) | if ( $linked ) { |
| [2046](#L2046) | $link\_target = ''; |
| [2047](#L2047) | if( fusion\_get\_page\_option( 'link\_icon\_target', $post\_id ) == 'yes' || |
| [2048](#L2048) | fusion\_get\_page\_option( 'post\_links\_target', $post\_id ) == 'yes' ) { |
| [2049](#L2049) | $link\_target = ' target="\_blank"'; |
| [2050](#L2050) | } |
| [2051](#L2051) |  |
| [2052](#L2052) | $title = sprintf( '<a href="%s"%s>%s</a>', get\_permalink( $post\_id ), $link\_target, $title ); |
| [2053](#L2053) | } |
| [2054](#L2054) |  |
| [2055](#L2055) | // Setup the HTML markup of the post title |
| [2056](#L2056) | $html = sprintf( '<h%s%s>%s</h%s>', $custom\_size, $entry\_title\_class, $title, $custom\_size ); |
| [2057](#L2057) |  |
| [2058](#L2058) | return $html; |
| [2059](#L2059) | } |
| [2060](#L2060) | } |
| [2061](#L2061) |  |
| [2062](#L2062) | function set\_content\_flag($content) |
| [2063](#L2063) | { |
| [2064](#L2064) | $this->config->set\_content\_flag(true); |
| [2065](#L2065) | return $content; |
| [2066](#L2066) | } |
| [2067](#L2067) |  |
| [2068](#L2068) | function easy\_t\_avada\_content\_filter(){ |
| [2069](#L2069) | global $post; |
| [2070](#L2070) |  |
| [2071](#L2071) | if($post->post\_type == 'testimonial'){ |
| [2072](#L2072) | the\_content(); |
| [2073](#L2073) | } |
| [2074](#L2074) | } |
| [2075](#L2075) |  |
| [2076](#L2076) | /\* |
| [2077](#L2077) | \* Sets the featured image for a given post to a local file |
| [2078](#L2078) | \* |
| [2079](#L2079) | \* @param string $imgfile The local file path |
| [2080](#L2080) | \* @param id $parent\_post\_id The post to which to attach the image |
| [2081](#L2081) | \* |
| [2082](#L2082) | \* @return int Attachment ID. |
| [2083](#L2083) | \*/ |
| [2084](#L2084) | function set\_featured\_image\_from\_file($imgfile, $parent\_post\_id) |
| [2085](#L2085) | { |
| [2086](#L2086) | $filename = basename($imgfile); |
| [2087](#L2087) | $upload\_file = wp\_upload\_bits($filename, null, file\_get\_contents($imgfile)); |
| [2088](#L2088) | if (!$upload\_file['error']) { |
| [2089](#L2089) | $wp\_filetype = wp\_check\_filetype($filename, null ); |
| [2090](#L2090) | $attachment = array( |
| [2091](#L2091) | 'post\_mime\_type' => $wp\_filetype['type'], |
| [2092](#L2092) | 'post\_parent' => 0, |
| [2093](#L2093) | 'post\_title' => preg\_replace('/\.[^.]+$/', '', $filename), |
| [2094](#L2094) | 'post\_content' => '', |
| [2095](#L2095) | 'post\_status' => 'inherit' |
| [2096](#L2096) | ); |
| [2097](#L2097) | $attachment\_id = wp\_insert\_attachment( $attachment, $upload\_file['file'], $parent\_post\_id ); |
| [2098](#L2098) |  |
| [2099](#L2099) | if (!is\_wp\_error($attachment\_id)) { |
| [2100](#L2100) | require\_once(ABSPATH . "wp-admin" . '/includes/image.php'); |
| [2101](#L2101) | $attachment\_data = wp\_generate\_attachment\_metadata( $attachment\_id, $upload\_file['file'] ); |
| [2102](#L2102) | wp\_update\_attachment\_metadata( $attachment\_id,  $attachment\_data ); |
| [2103](#L2103) | } |
| [2104](#L2104) |  |
| [2105](#L2105) | set\_post\_thumbnail( $parent\_post\_id, $attachment\_id ); |
| [2106](#L2106) | } |
| [2107](#L2107) | } |
| [2108](#L2108) |  |
| [2109](#L2109) | //lookup testimonials with the example testimonial meta value |
| [2110](#L2110) | //delete all matching testimonials |
| [2111](#L2111) | function delete\_example\_testimonials(){ |
| [2112](#L2112) | //find matching testimonials |
| [2113](#L2113) | $args = array( |
| [2114](#L2114) | 'post\_type' => 'testimonial', |
| [2115](#L2115) | 'posts\_per\_page' => -1, |
| [2116](#L2116) | 'paged' => false, |
| [2117](#L2117) | 'meta\_query' => array( |
| [2118](#L2118) | array( |
| [2119](#L2119) | 'key' => '\_ikcf\_is\_example\_testimonial', |
| [2120](#L2120) | 'value' => '1' |
| [2121](#L2121) | ) |
| [2122](#L2122) | ) |
| [2123](#L2123) | ); |
| [2124](#L2124) | $example\_testimonials = get\_posts($args); |
| [2125](#L2125) |  |
| [2126](#L2126) | //delete them |
| [2127](#L2127) | foreach($example\_testimonials as $testimonial){ |
| [2128](#L2128) | wp\_delete\_post($testimonial->ID); |
| [2129](#L2129) | } |
| [2130](#L2130) |  |
| [2131](#L2131) | $this->deleted\_testimonials = true; |
| [2132](#L2132) | } |
| [2133](#L2133) |  |
| [2134](#L2134) | function ajax\_delete\_demo\_testimonials() |
| [2135](#L2135) | { |
| [2136](#L2136) | $this->delete\_example\_testimonials(); |
| [2137](#L2137) | } |
| [2138](#L2138) |  |
| [2139](#L2139) | function ajax\_create\_demo\_testimonials() |
| [2140](#L2140) | { |
| [2141](#L2141) | $this->generate\_example\_testimonials(true); |
| [2142](#L2142) | wp\_die('1'); |
| [2143](#L2143) | } |
| [2144](#L2144) |  |
| [2145](#L2145) | }//end easyTestimonials |
| [2146](#L2146) |  |
| [2147](#L2147) | // create an instance of easyTestimonials |
| [2148](#L2148) | if ( !isset($easy\_testimonials) ) { |
| [2149](#L2149) | $easy\_testimonials = new easyTestimonials(); |
| [2150](#L2150) | } |
| [2151](#L2151) |  |
| [2152](#L2152) | // create an instance of BikeShed that we can use later |
| [2153](#L2153) | if (is\_admin()) { |
| [2154](#L2154) | global $EasyT\_BikeShed; |
| [2155](#L2155) | $EasyT\_BikeShed = new Easy\_Testimonials\_GoldPlugins\_BikeShed(); |
| [2156](#L2156) | } |
| [2157](#L2157) |  |
| [2158](#L2158) | // can now load addons |
| [2159](#L2159) | do\_action('easy\_testimonials\_bootstrap'); |
| [2160](#L2160) |  |
| [2161](#L2161) |  |
| [2162](#L2162) | add\_filter( 'render\_block', function ( $block\_content, $block ) { |
| [2163](#L2163) | if ( 0 === strpos($block['blockName'], 'easy-testimonials/') ) { |
| [2164](#L2164) | remove\_filter( 'the\_content', 'wpautop' ); |
| [2165](#L2165) | } |
| [2166](#L2166) |  |
| [2167](#L2167) | return $block\_content; |
| [2168](#L2168) | }, 10, 2 ); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/easy-testimonials/trunk/easy-testimonials.php?format=txt)
* [Original Format](/export/3220813/easy-testimonials/trunk/easy-testimonials.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

