=== Content from github.com_f15c2187_20250111_083822.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fantoonpurnal%2Fclangover)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fantoonpurnal%2Fclangover)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E&source=header-repo&source_repo=antoonpurnal%2Fclangover)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[antoonpurnal](/antoonpurnal)
/
**[clangover](/antoonpurnal/clangover)**
Public

* [Notifications](/login?return_to=%2Fantoonpurnal%2Fclangover) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fantoonpurnal%2Fclangover)
* [Star
   19](/login?return_to=%2Fantoonpurnal%2Fclangover)

[19
stars](/antoonpurnal/clangover/stargazers) [0
forks](/antoonpurnal/clangover/forks) [Branches](/antoonpurnal/clangover/branches) [Tags](/antoonpurnal/clangover/tags) [Activity](/antoonpurnal/clangover/activity)
 [Star](/login?return_to=%2Fantoonpurnal%2Fclangover)

 [Notifications](/login?return_to=%2Fantoonpurnal%2Fclangover) You must be signed in to change notification settings

* [Code](/antoonpurnal/clangover)
* [Issues
  0](/antoonpurnal/clangover/issues)
* [Pull requests
  0](/antoonpurnal/clangover/pulls)
* [Actions](/antoonpurnal/clangover/actions)
* [Projects
  0](/antoonpurnal/clangover/projects)
* [Security](/antoonpurnal/clangover/security)
* [Insights](/antoonpurnal/clangover/pulse)

Additional navigation options

* [Code](/antoonpurnal/clangover)
* [Issues](/antoonpurnal/clangover/issues)
* [Pull requests](/antoonpurnal/clangover/pulls)
* [Actions](/antoonpurnal/clangover/actions)
* [Projects](/antoonpurnal/clangover/projects)
* [Security](/antoonpurnal/clangover/security)
* [Insights](/antoonpurnal/clangover/pulse)

# antoonpurnal/clangover

    main[Branches](/antoonpurnal/clangover/branches)[Tags](/antoonpurnal/clangover/tags)Go to fileCode
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| Latest commit History[1 Commit](/antoonpurnal/clangover/commits/main/) | | |
| [kyber @ 11d00ff](/pq-crystals/kyber/tree/11d00ff1f20cfca1f72d819e5a45165c1e0a2816 "kyber") | | [kyber @ 11d00ff](/pq-crystals/kyber/tree/11d00ff1f20cfca1f72d819e5a45165c1e0a2816 "kyber") |  |  |
| [.gitignore](/antoonpurnal/clangover/blob/main/.gitignore ".gitignore") | | [.gitignore](/antoonpurnal/clangover/blob/main/.gitignore ".gitignore") |  |  |
| [.gitmodules](/antoonpurnal/clangover/blob/main/.gitmodules ".gitmodules") | | [.gitmodules](/antoonpurnal/clangover/blob/main/.gitmodules ".gitmodules") |  |  |
| [Makefile](/antoonpurnal/clangover/blob/main/Makefile "Makefile") | | [Makefile](/antoonpurnal/clangover/blob/main/Makefile "Makefile") |  |  |
| [README.md](/antoonpurnal/clangover/blob/main/README.md "README.md") | | [README.md](/antoonpurnal/clangover/blob/main/README.md "README.md") |  |  |
| [attack.c](/antoonpurnal/clangover/blob/main/attack.c "attack.c") | | [attack.c](/antoonpurnal/clangover/blob/main/attack.c "attack.c") |  |  |
| [guess.h](/antoonpurnal/clangover/blob/main/guess.h "guess.h") | | [guess.h](/antoonpurnal/clangover/blob/main/guess.h "guess.h") |  |  |
| View all files | | |

## Repository files navigation

* README
## Description

This proof-of-concept demonstration exploits the observation that compiling the
[Kyber reference implementation](https://github.com/pq-crystals/kyber/tree/b628ba78711bc28327dc7d2d5c074a00f061884e)
with Clang may result in the emission of a secret-dependent branch.

Despite the source-level constant-time implementation of `poly_frommsg`, Clang
has been observed to produce [insecure assembly](https://godbolt.org/#z:OYLghAFBqRAWIDGB7AJgUwKKoJYBdkAnAGhxAgDMcAbdAOwEMBbdEAcgEY3iLk68Ayoga0QHACw8%2BeAKoBndAAUAHuwAM3AFZji1BnVAB9Y4mILaiPDj7l6qAMLJqAVyZ0QAJmJ2AMjjroAHKuAEbohJ4cxAAOyHL41nSOLm6eMXEJfH4BwUxhER5R5uiWiQJ4DIR4ya7uXsWlfOWVeNlBoeGRZhVVNan1Pa3%2B7XmdhQCUZsjOhIisbACkHgDM/oguGADUC8v2cni4/AB0cDuYC2oAghfXKxhUAZsA0gCaAEKYAEqGgZseAKwANhuS2W92Gz3eX0MAEVNstlh4AJwgq54ACe0XQ902%2B0IzksCwA7G8bptNv48BxAYY8JsUOgKBQ5At/m9Xh9voFWQARHakq7EnmbWLUdH81GXABuyBwqBFTnRhgohGQTCYcmAEFF6M2ACoSPS%2BPtNs5KQAOWmbDXAVlvRG88Ygklk010eLAALyykU4iaCVXcmU6lWpgMOQAawD10Dm14hAgOB2PLU/KTuw50MCAHpzWmlqSPG9xtsXbHyfGIP7lin%2BdX7Hnlm9/UWCyXiQLLuTu9bwxHtjXNgBaRP8EN4cZQG12pP/YVnM6bTROjyAjhOpuunuEIdnBlMlls816pNF/1zgfCsOR7arzZQTPfGEF9fZjwbzs9oWu7%2BCok8thJmodh/m4dxOG4ZB2HsXFplmdBb2WLhiDwdRAOIeAkDVaIaHCUhyBQJgcNoCJEHWfRgFpfE6AjHgaDwcI5HIEI0OIEJ/EqdF2GQ9jGEIdEAHkQk0EpUIg4hCJYfgBLoMVWIwEJnGAewRGoJjxIwMMDFENgNGIXBCFEnApXQdS9PQZQSmcBjuO4Sl0GA3TuGoHAQkITjHAwVi8EIHAmFs4gTMIEI4nQHl0C04AXIMNDJgoPRgDkAA1HB0AAdwErFwOQ3h%2BCEERWAkKR%2BHkJRVCcv0dD0GLjEMUwXJCJjIEmZBoisY12CHAS5EgoLfIwJqIEmaJ9CCZh5k2ZRzUBIdAXEelquAe8fOcGiSy6nqzAcoybAgOw%2BncKJfGGXJ8h0WJ4napInFqc6MiutpTs6IptsaOhml6G7Uheiwro%2BoYcg6CIikGA6dH2FpHqBsRJjkOC5hh3QQLA1ioLYSbptm%2BbyIMZbqIjdbuu4MSNEmTDCOIvCyAgCncNInHKJWmi6OoBjCCYiAWIq3jOICnn%2BKEkTLACyT6DwGS5IqhSlJU6g1ICzSKJ0vSDKMkyzO4CyrJs8T7McvSGvc/jPPmPSfL8gKgpChRwsi6LQCcuKEuS1KMqygLcsEYRRCKz3SpUVjtGWXQKJAWr6tcwaWraxJ1K65DkD6uVTPAIaYlGwJxvYDGZrmhaKLx1aCc2ATkIaK7bDoBwvsO7wq6h0ZgfSS7EjBqILsyOgG7On6dve0Ga/B16/sGbvnu6Fo24nqox%2BB2H4cKoDkeIcC9LRnOsfz3GICZ4vS%2BJ2KMIQWmSPwmnsLppAGaoouWbZjmub0/muPE5/BdEkW1Sk8XZJflX0EUspVS6lkKK20qbbgqtSjq1YlrRA1l5jIT1qxQ2Hk0AQJQr5fy4krahVtkrfwDtSY8GdildKmV6Ae2kPlH2kg/YKADhVbQRIQ41RMLoSOqdo5XTjgJDww4KB0GQEOEylgiA4AAF7oF6uEfqKdmrpxyFndGU1c7Y0WoXNaJd%2BFCJEaJcRUjuDl0SJXauKRa7HUBo3O6Lc%2BBTw7g9E60Ne5vX%2BlPYxTRR5OOsSDSeg9fEz28T3eeMwEbriRmwUCK9UbZ1UZvBmmi946OEaIggvlDEoUPuTC%2Bp9qYn06GRRaN9mZUFZoxZirFn58w4gLYSH9xKi2kr/eSACZbAIVhFJWGCoFWBgRVOBCCArIIqqg426DvJYMtuEa2YVOnaUIYfeKDBEpkLdpQ8SnsaGFTodIf25U9LaEBKwow7CGpR2IK1HhnUBLLAEbo1JBjpEXKTgNLhiixosFiZjPOCSd74xLDczY9z9HpKeR49we0q5T0sSMHuzdO72PuokWeQ9fplAHuY1Ffd/oooCdUfx08AawueiE%2BCiNHJRNXpBL5ait5LT%2BUXAFtzgViNBQfR2kwIxiDUGoCJ4gUYVTRkYkAvKSaAUmEFeINhxBAA) for at least the following configurations:

* ISA: x86
* Clang versions: v15-18
* Clang options:
  + `-Os`
  + `-O1`
  + `-O2 -fno-vectorize`
  + `-O3 -fno-vectorize`

On an Intel Core i7-13700H (Clang 16.0.6), it takes between 5-10 minutes to leak
the entire ML-KEM 512 secret key using end-to-end decapsulation timing
measurements.

The attack strategy is a plaintext-checking oracle attack a la
[Ravi et al.](https://eprint.iacr.org/2019/948)
and [Ueno et al.](https://eprint.iacr.org/2021/849)

## Running the PoC

```
# Pull pqcrystals/kyber standard branch (though attack also affects main branch)
git submodule init && git submodule update

# Modify compiler options and produce shared library
sed -i 's/-O3/-Os/g' kyber/ref/Makefile
CC=clang make -C kyber/ref shared

# Build the key recovery PoC
make

# Run the key recovery PoC
./clangover

```

## Remarks

If the PoC doesn't produce the correct key guesses on your machine, here is some
guidance:

1. Check that you are running on x86
2. Check that you are using `clang` version 15 or later
   (latest is 18.1 at time of writing)
3. This PoC contains some parameters in `attack.c`. Consider tweaking them for
   your machine. Of special interest are:
   * `CONFIDENCE_HIGH`: the higher, the more robust
   * `EVALUATE_EVERY_N_ITERATIONS`: the higher, the more robust
   * `OUTLIER_THRESHOLD`: can go either way

## About

No description, website, or topics provided.
### Resources

[Readme](#readme-ov-file)

[Activity](/antoonpurnal/clangover/activity)
### Stars

[**19**
stars](/antoonpurnal/clangover/stargazers)
### Watchers

[**1**
watching](/antoonpurnal/clangover/watchers)
### Forks

[**0**
forks](/antoonpurnal/clangover/forks)
[Report repository](/contact/report-content?content_url=https%3A%2F%2Fgithub.com%2Fantoonpurnal%2Fclangover&report=antoonpurnal+%28user%29)

## [Releases](/antoonpurnal/clangover/releases)

No releases published

## [Packages 0](/users/antoonpurnal/packages?repo_name=clangover)

No packages published

## Languages

* [C
  96.6%](/antoonpurnal/clangover/search?l=c)
* [Makefile
  3.4%](/antoonpurnal/clangover/search?l=makefile)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_d8ef0063_20250111_083823.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpq-crystals%2Fkyber%2Fcommit%2F9b8d30698a3e7449aeb34e62339d4176f11e3c6c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpq-crystals%2Fkyber%2Fcommit%2F9b8d30698a3e7449aeb34e62339d4176f11e3c6c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=pq-crystals%2Fkyber)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[pq-crystals](/pq-crystals)
/
**[kyber](/pq-crystals/kyber)**
Public

* [Notifications](/login?return_to=%2Fpq-crystals%2Fkyber) You must be signed in to change notification settings
* [Fork
  207](/login?return_to=%2Fpq-crystals%2Fkyber)
* [Star
   867](/login?return_to=%2Fpq-crystals%2Fkyber)

* [Code](/pq-crystals/kyber)
* [Issues
  17](/pq-crystals/kyber/issues)
* [Pull requests
  7](/pq-crystals/kyber/pulls)
* [Actions](/pq-crystals/kyber/actions)
* [Projects
  0](/pq-crystals/kyber/projects)
* [Security](/pq-crystals/kyber/security)
* [Insights](/pq-crystals/kyber/pulse)

Additional navigation options

* [Code](/pq-crystals/kyber)
* [Issues](/pq-crystals/kyber/issues)
* [Pull requests](/pq-crystals/kyber/pulls)
* [Actions](/pq-crystals/kyber/actions)
* [Projects](/pq-crystals/kyber/projects)
* [Security](/pq-crystals/kyber/security)
* [Insights](/pq-crystals/kyber/pulse)

## Commit

[Permalink](/pq-crystals/kyber/commit/9b8d30698a3e7449aeb34e62339d4176f11e3c6c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fixed secret-dependent branch in poly\_frommsg introduced by recent ve…

[Browse files](/pq-crystals/kyber/tree/9b8d30698a3e7449aeb34e62339d4176f11e3c6c)
Browse the repository at this point in the history

```
…rsions of clang with some flags (Thanks to Antoon Purnal for pointing this out!)
```

* Loading branch information

[![@cryptojedi](https://avatars.githubusercontent.com/u/3762820?s=40&v=4)](/cryptojedi)

[cryptojedi](/pq-crystals/kyber/commits?author=cryptojedi "View all commits by cryptojedi")
committed
Jun 3, 2024

1 parent
[b628ba7](/pq-crystals/kyber/commit/b628ba78711bc28327dc7d2d5c074a00f061884e)

commit 9b8d306

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**13 additions**
and
**3 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* ref

  + ref/poly.c
    [poly.c](#diff-7980ab4906160ca7543d48513c4c5a4512471b3aa97cf4b7badefa2d8cc1e102)
  + ref/verify.c
    [verify.c](#diff-b7c51795a476c98e151b0c58da7e0692ed078a44f13b245cf09c82eac70e4302)
  + ref/verify.h
    [verify.h](#diff-0834e94c8bbb0c7c27fe80d288e5053b689b13b15a83438f2b24f777fba23290)

## There are no files selected for viewing

6 changes: 3 additions & 3 deletions

6
[ref/poly.c](#diff-7980ab4906160ca7543d48513c4c5a4512471b3aa97cf4b7badefa2d8cc1e102 "ref/poly.c")

Show comments

[View file](/pq-crystals/kyber/blob/9b8d30698a3e7449aeb34e62339d4176f11e3c6c/ref/poly.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -5,6 +5,7 @@ |
|  |  | #include "reduce.h" |
|  |  | #include "cbd.h" |
|  |  | #include "symmetric.h" |
|  |  | #include "verify.h" |
|  |  |  |
|  |  | /\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\*\* |
|  |  | \* Name: poly\_compress |
| Expand Down  Expand Up | | @@ -166,16 +167,15 @@ void poly\_frombytes(poly \*r, const uint8\_t a[KYBER\_POLYBYTES]) |
|  |  | void poly\_frommsg(poly \*r, const uint8\_t msg[KYBER\_INDCPA\_MSGBYTES]) |
|  |  | { |
|  |  | unsigned int i,j; |
|  |  | int16\_t mask; |
|  |  |  |
|  |  | #if (KYBER\_INDCPA\_MSGBYTES != KYBER\_N/8) |
|  |  | #error "KYBER\_INDCPA\_MSGBYTES must be equal to KYBER\_N/8 bytes!" |
|  |  | #endif |
|  |  |  |
|  |  | for(i=0;i<KYBER\_N/8;i++) { |
|  |  | for(j=0;j<8;j++) { |
|  |  | mask = -(int16\_t)((msg[i] >> j)&1); |
|  |  | r->coeffs[8\*i+j] = mask & ((KYBER\_Q+1)/2); |
|  |  | r->coeffs[8\*i+j] = 0; |
|  |  | cmov\_int16(r->coeffs+8\*i+j, ((KYBER\_Q+1)/2), (msg[i] >> j)&1); |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

7 changes: 7 additions & 0 deletions

7
[ref/verify.c](#diff-b7c51795a476c98e151b0c58da7e0692ed078a44f13b245cf09c82eac70e4302 "ref/verify.c")

Show comments

[View file](/pq-crystals/kyber/blob/9b8d30698a3e7449aeb34e62339d4176f11e3c6c/ref/verify.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -55,3 +55,10 @@ void cmov(uint8\_t \*r, const uint8\_t \*x, size\_t len, uint8\_t b) |
|  |  | for(i=0;i<len;i++) |
|  |  | r[i] ^= b & (r[i] ^ x[i]); |
|  |  | } |
|  |  |  |
|  |  |  |
|  |  | void cmov\_int16(int16\_t \*r, int16\_t v, uint16\_t b) |
|  |  | { |
|  |  | b = -b; |
|  |  | \*r ^= b & ((\*r) ^ v); |
|  |  | } |

3 changes: 3 additions & 0 deletions

3
[ref/verify.h](#diff-0834e94c8bbb0c7c27fe80d288e5053b689b13b15a83438f2b24f777fba23290 "ref/verify.h")

Show comments

[View file](/pq-crystals/kyber/blob/9b8d30698a3e7449aeb34e62339d4176f11e3c6c/ref/verify.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -11,4 +11,7 @@ int verify(const uint8\_t \*a, const uint8\_t \*b, size\_t len); |
|  |  | #define cmov KYBER\_NAMESPACE(cmov) |
|  |  | void cmov(uint8\_t \*r, const uint8\_t \*x, size\_t len, uint8\_t b); |
|  |  |  |
|  |  | #define cmov\_int16 KYBER\_NAMESPACE(cmov\_int16) |
|  |  | void cmov\_int16(int16\_t \*r, int16\_t v, uint16\_t b); |
|  |  |  |
|  |  | #endif |

Toggle all file notes
Toggle all file annotations

### 2 comments on commit `9b8d306`

[![@Masken3](https://avatars.githubusercontent.com/u/566921?s=80&v=4)](/Masken3)

Copy link

### @Masken3 **[Masken3](/Masken3)** commented on `[9b8d306](/pq-crystals/kyber/commit/9b8d30698a3e7449aeb34e62339d4176f11e3c6c)` [Jun 10, 2024](#commitcomment-142953352)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Could this be vulnerable to link-time optimizations with `-flto`?

Sorry, something went wrong.

All reactions

[![@cryptojedi](https://avatars.githubusercontent.com/u/3762820?s=80&v=4)](/cryptojedi)

Copy link

Contributor

Author

### @cryptojedi **[cryptojedi](/cryptojedi)** commented on `[9b8d306](/pq-crystals/kyber/commit/9b8d30698a3e7449aeb34e62339d4176f11e3c6c)` [Jun 13, 2024](#commitcomment-143084350) via email

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Masken3 \*\*\*@\*\*\*.\*\*\*> wrote:
 Could this be vulnerable to link-time optimizations with `-flto`?
Yes. In fact, what I wrote as a reply to Antoon Purnal when he pointed
out the issue was
"I guess an obvious fix is to implement a cmov in a separate file and
call it from poly\_frommsg. Then the compiler cannot apply the
optimization, because it doesn't know that the last argument is always
either zero or one (well, at least if you don't compile with -lto)."
Some other fixes have now been suggested that will also work with -flto
(see, e.g., PR 78 and pqc-forum posts by DJB and Falko Strenzke
suggesting to use an additional volatile mask).
I will probably integrate one of those, although all "solutions"
(including my own of splitting across files) are very hacky workarounds
owed to the fact that compilers like clang and gcc are not security
aware.

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fpq-crystals%2Fkyber%2Fcommit%2F9b8d30698a3e7449aeb34e62339d4176f11e3c6c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from news.ycombinator.com_c1a4a9c5_20250111_083823.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D40577486) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Exploitable timing leak in the reference implementation of Kyber](https://twitter.com/purnaltoon/status/1797644696568959476) ([twitter.com/purnaltoon](from?site=twitter.com/purnaltoon)) | | --- | --- | --- | |  | | 2 points by [oger](user?id=oger) [7 months ago](item?id=40577486)  | [hide](hide?id=40577486&goto=item%3Fid%3D40577486) | [past](https://hn.algolia.com/?query=Exploitable%20timing%20leak%20in%20the%20reference%20implementation%20of%20Kyber&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=40577486&auth=8754d4126fb943487ab56d0c494df941587c6b52) | [1 comment](item?id=40577486) |  | |  |  | [oger](user?id=oger) [7 months ago](item?id=40577487)   [–]  tl;dr: Don’t trust (optimizing) compilers. And NIST. | | --- | --- | --- | | | --- | --- | --- | --- | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |



=== Content from pqshield.com_7689830e_20250111_083824.html ===
 ![](https://pqshield.com/wp-content/uploads/2024/05/Sub-Header-Option-2.jpg)![](data:image/svg+xml...) [![PQShield logo](https://pqshield.com/wp-content/themes/pqshield/images/PQ-Logo.svg)![PQShield logo](data:image/svg+xml...)](https://pqshield.com/ "PQShield")

* [Team PQShield](https://pqshield.com/team-pqshield/)
* [Products](https://pqshield.com/products/)
  ### Products

  + [PQSDK](https://pqshield.com/products/pqs-sw-sdk/)
  + [PQCryptoLib](https://pqshield.com/products/pqs-sw-clb/)
  + [PQCryptoLib – Embedded](https://pqshield.com/products/pqs-sw-cle/)
  + [PQPlatform – Hash](https://pqshield.com/products/pqp-hw-hbs/)
  + [PQPlatform – Lattice](https://pqshield.com/products/pqp-hw-lat/)
  + [PQPlatform – CoPro](https://pqshield.com/products/pqp-hw-cop/)
  + [PQPlatform – SubSys](https://pqshield.com/products/pqp-hw-sub/)
  + [PQPerform – Lattice](https://pqshield.com/products/pqf-hw-lat/)
  + [Product Security](https://pqshield.com/products/product-security/)
* [Markets](https://pqshield.com/markets/)
  ### Markets

  + [Semiconductors and Manufacturing](https://pqshield.com/markets/semiconductors-manufacturing/)
  + [Identity and Paymentech](https://pqshield.com/markets/identity-paymentech/)
  + [Military and Aerospace](https://pqshield.com/markets/military-aerospace/)
  + [System Integrators](https://pqshield.com/markets/system-integrators/)
  + [Automotive](https://pqshield.com/markets/automotive/)
  + [Industrial IoT](https://pqshield.com/markets/industrial-iot/)
  + [Network & Telecommunications](https://pqshield.com/markets/network-telecommunications/)
  + [Enterprise Platforms](https://pqshield.com/markets/enterprise-platforms/)
* [Publications](https://pqshield.com/publications/)
* [News](https://pqshield.com/news/)
* [Partners](https://pqshield.com/partners/)
* [Careers](https://pqshield.com/careers/)
* [Contact](https://pqshield.com/contact-us/)
[![Twitter](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-X.svg?v=1)![Twitter](data:image/svg+xml...)](https://twitter.com/PqShield)[![LinkedIn](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-LI.svg?v=1)![LinkedIn](data:image/svg+xml...)](https://www.linkedin.com/company/pqshield/)[![Youtube](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-YT.svg?v=1)![Youtube](data:image/svg+xml...)](https://www.youtube.com/channel/UCoiZ4TzLcBNpNtXyJI7-cOg) [![PQShield logo](https://pqshield.com/wp-content/themes/pqshield/images/PQ-Logo.svg)![PQShield logo](data:image/svg+xml...)](https://pqshield.com/ "PQShield")
##

* [Home](https://pqshield.com/)
* [Team PQShield](https://pqshield.com/team-pqshield/)
* [Products](https://pqshield.com/products/)
  + [PQSDK](https://pqshield.com/products/pqs-sw-sdk/)
  + [PQCryptoLib](https://pqshield.com/products/pqs-sw-clb/)
  + [PQCryptoLib – Embedded](https://pqshield.com/products/pqs-sw-cle/)
  + [PQPlatform – Hash](https://pqshield.com/products/pqp-hw-hbs/)
  + [PQPlatform – Lattice](https://pqshield.com/products/pqp-hw-lat/)
  + [PQPlatform – CoPro](https://pqshield.com/products/pqp-hw-cop/)
  + [PQPlatform – SubSys](https://pqshield.com/products/pqp-hw-sub/)
  + [PQPerform – Lattice](https://pqshield.com/products/pqf-hw-lat/)
  + [Product Security](https://pqshield.com/products/product-security/)
* [Markets](https://pqshield.com/markets/)
  + [Semiconductors and Manufacturing](https://pqshield.com/markets/semiconductors-manufacturing/)
  + [Identity and Paymentech](https://pqshield.com/markets/identity-paymentech/)
  + [Military and Aerospace](https://pqshield.com/markets/military-aerospace/)
  + [System Integrators](https://pqshield.com/markets/system-integrators/)
  + [Automotive](https://pqshield.com/markets/automotive/)
  + [Industrial IoT](https://pqshield.com/markets/industrial-iot/)
  + [Network & Telecommunications](https://pqshield.com/markets/network-telecommunications/)
  + [Enterprise Platforms](https://pqshield.com/markets/enterprise-platforms/)
* [Publications](https://pqshield.com/publications/)
* [News](https://pqshield.com/news/)
* [Partners](https://pqshield.com/partners/)
* [Careers](https://pqshield.com/careers/)
* [Contact](https://pqshield.com/contact-us/)
# PQShield plugs timing leaks in Kyber / ML-KEM to improve PQC implementation maturity

  Back Topics: Comment Date: 03/06/2024![](https://pqshield.com/wp-content/uploads/2024/06/PQS_News_Building-Securely.png)![](data:image/svg+xml...)

Compilers can suddenly and silently introduce implementation vulnerabilities in yesterday’s secure code. PQShield recently discovered an instance of this problem in the popular ML-KEM (Kyber) reference implementation, and it has been resolved with the help of Peter Schwabe and the Kyber team. In this article, we investigate the issue in detail, and take a deep-dive into its root cause, as well as explaining how the problem was resolved.

It’s about time

Even the most secure cryptographic algorithm can be rendered ineffective if its *implementation* contains vulnerabilities. A key part of implementation security is resistance against side-channel attacks, which exploit the physical side-effects of cryptographic computations to infer sensitive information.

To remain secure against side-channel attacks, cryptographic algorithms must be implemented such that no attacker-observable effect of their execution depends on the secrets they process. In this blog post, we’re concerned with a particular side channel that’s observable in almost all cryptographic deployment scenarios: *time*.

Constant time cryptography

Let’s assume we want to deploy a cryptographic algorithm across a wide range of platforms. How would a skilled cryptography engineer write portable code that doesn’t leak its secrets through timing?

Consider a toy example. Let’s say you have to write a function that expands a 256-bit string msg into an array r of 256 integers of 16 bits. In particular, r[j] needs to be populated with some constant if the j-th bit of msg is set, and zero otherwise.

A novice cryptography engineer might come up with a C routine that’s something like this:

![](https://pqshield.com/wp-content/uploads/2024/06/blog_01_insec_source.png)![](data:image/svg+xml...)

It’s good, but (regarding our earlier side-channel discussion) there is an issue with this piece of code. Its control flow (i.e, the sequence of operations it performs) depends on the bits of msg. The part of the code where the control flow diverges is marked in red.

Does that matter? Well, that depends on how this particular function is used: it *does* matter if msg is supposed to be secret, since it is effectively getting encoded, bit-by-bit, in the control flow of the program.

Let’s write a secure version of this function.

To take the secret bits into account without branching on them, let’s use a common trick in cryptography engineering: bit masks.  We can negate the message bit to produce a mask that is either all-zeros (bit j is zero) or all-ones (bit j is one). We can then use the mask to either zero out the constant (bit j is zero) or load it as-is (bit j is one). Here is the complete function:

![](https://pqshield.com/wp-content/uploads/2024/06/blog_02_sec_source.png)![](data:image/svg+xml...)

Notice that the control flow of **expand\_secure** is independent of the bits of msg. The assignment to r happens regardless of the message bit, and the mask ensures the correct data flow. So, all is well! Right?

Compiler woes

When a developer writes code in a portable high-level language like C, C++, or Rust, the source code is not executed directly on the machine. Instead, it is first compiled into assembly or machine code by a compiler, such as GCC or Clang for C/C++, so that it can run natively on the specific target machine.

Compilers not only perform this *transformation* to machine code, they also have several *optimization* passes. Well-known examples are loop unrolling and the removal of code that does not affect the program’s output. But there are many, [many](https://github.com/llvm/llvm-project/tree/main/llvm/lib/Target/X86) more. Modern compilers have become very proficient at performing optimizations to generate fast machine code from portable high-level source code.

Let’s take a look at a state-of-the-art mainstream compiler in action. Returning to our toy example, let’s compile the insecure **expand\_insecure** for x86 using the most recent version of Clang (v18), optimizing for code size (-Os):

![](https://pqshield.com/wp-content/uploads/2024/06/blog_03_insecure_assembly.png)

The vulnerability we identified before obviously hasn’t magically disappeared. It can be observed in the inner loop, and is marked in red. The move of 1665 (our choice of constant) into edx is either skipped or not skipped, depending on the relevant bit of msg.

Now let’s compile the secure **expand\_secure** implementation and see how it differs – showing only the inner loop for brevity:

![](https://pqshield.com/wp-content/uploads/2024/06/blog_04_secure_assembly.png)![](data:image/svg+xml...)

… there must have been a mix-up! Really? Isn’t it the same assembly? What happened?

It appears that Clang eagerly:

1. noticed that the mask is either all-zero or all-one,
2. inferred that the masked load is therefore either zero or CONSTANT,
3. emitted a branch, because it is heuristically the fastest on x86

So, we can see here that the compiler can *silently* undo measures taken by the skilled implementer. This behaviour is not limited to the configuration above (clang -Os). If you [play around](https://godbolt.org/#z:OYLghAFBqRAWIDGB7AJgUwKKoJYBdkAnAGhxAgDMcAbdAOwEMBbdEAcgEY3iLk68Ayoga0QHACw8%2BeAKoBndAAUAHuwAM3AFZji1BnVAB9Y4mILaiPDj7l6qAMLJqAVyZ0QAZg/E7AGRx06AByrgBG6IRikgAOyHL41nSOLm6e3rHxVnz%2BgSFM4ZESZugWWXQCeAyEeMmu7l7FpYkVVXg5wWERUWaV1bWpDXK9bQEd%2BV0SAJRmyM6EiKxsAKQATB4BiC4YANRLHvZDuPwAdHB7mEtqAIKXN2sYVIHbAgCSAFqY2ysArABst6sPA9Rtt7AB5IICAAqVyCUO2HF%2Bv2%2BAOuADdkDhUNt0MpovpUIYFIg5ugIAE8IjDHhtoQlt8AEKvD70gAixG2KDoQ22zgpAA5qdsmHJgPSGR4VmzJgCAOwM27bXncnDAQLYinbHDETR7BXXJUUqk0pgMOQAaz1qKuSt4hHJe1Zaj1OD29mZmAA9PyXasFSsGZNdvLFUrtnaILqPE69VH7D6PAzdQG/UGliGDWGlaaLbto9sALTk/jGyZQEVixmu76svMXDyfTQyla/DgyxOhrN0xn8gBUroDupredrOfNuxboIh0NhUKtmaV6dZoaXctZbGm1HY3247k43GQ7Hs2zks3m6AnHi4xDw6g3xHgSGQTGiNAipHIKBfb8iiE2%2BmAalCGcOhzR4Gg8AiORyFCO9iFCAIqgAT3Ya8EMYQgkLBUJNHQSxUO4L8WH4ME6GoFC2A0YgMFCZxgHsERqGg/dqPQU0DFESjuFwQg8KsNF0GYqjcTw5xIII0h%2BBKODqBwUJCGQxwMDgvBCBwJgJIEwhQjidBWTYgDZIMO9pgoPRgDkAA1HB0AAdzBaJ6Ak3h%2BCEERWCKFzZAUFQ4O0DhdAAkBjEMUxZNCaDIGmZBojKZiCzBOQDy0tSMEiiBpnxXJmEWbZlH5X4C1%2BcROT0AxtggVSQPNIMEqSxo%2BMSWw6AcJw6h0PxRjyAodAyBI%2BH6dwAr6sp2m6iYGssZphkGnRzEavgWmqMbOkKHpWlmgKhlaFbxkKaZTzmBYxE3bddzgw82DygqipK/9ysq4DQNqxLuFvLjpkfL9X1oEgyAgb6fyQe7AKq0DwOoSDCGgiBYK4%2BDEMwiT0OQ7DcPwliiPoPBSPIuCaLohjqCYiSMHY4BOKonjGoEoTuBEklxJYilpPh8KFMwpTFio1T1M0iIdIUfTyaM0APp4cyrJs%2BzHL3a8vLc0RPOkeQlFUeHtG8MqjBMXQ5PS6LYsSeKwWvZAUqxQTwAy4gsuCHL2GuwritKgCKrBmrtlN7h5qmmwIDsTafBa3aeuGuJ%2BqSNrUnDzJElDibfbKJaamjobJuT4YE7W7a%2BjTuas661aTpmI6PNOtgd2IPcqMup3btdh6PaDb2bxMh8EEB36PwB58fq6P9taA6qIahmG4aolGkZYqesJwviJKxkiyIoqn0Fo%2BjGOY68ycM7nuJwXiptpuCGbExZrxZrc2bkjmkK5lS1I0litMFvSDI4gIxY0UzJesuyHJORYgrYQStJBeVVr5DWIBZSBWMiFMK%2BtraGziuwBKKxCwUDoMgAsAlLBEBwAAL3QMlCIqUrZRVtvoe2LBHb5WdndbW7snqezBBg7BuC%2BIEOIT7EoC13ABxakHTquRi6x0jkHEa8ci57Tmnwv25QZr5y2vIzOO0ZFh3WnnFI6dc4jFEbItspdzwl2vlXGuB46E3RdiDZh1UW7sJwXgggakeFt3Fl9PuP4e5dwHiDYe4MqCQygjBOCs9kaIznujd614l44xXvjdehMt6kw/hTfe1FD40ytvDM%2BTNL5SWvlRdmik0AZN5s/a8r9dLC0Ml/duZkGAWX/jLIB8tpCKw8uAlWPl1ZUW0L8OBOtQp6wisg4gMVUFsASh4TBHDnHcJIRMi2aVxl2yCA7K69CG62MevYr2sz5lcNcUspOTVBGtR0R1EOGiJpSIGso22EdRq3Jzqo6aG1HlnMWoXAxmi9FBz0dnEuh0TFGLMedeGddtk2KYXs56BzthHPwSct6JlpjmjEGoNQuh2DiEhbXdgPsQA4vej/aYWl4g2HEEAA%3D%3D) with compilers and options, you’ll notice this compiler-induced security regression in **expand\_secure** for at least:

* Versions: x86 Clang 15, 16, 17 and 18
* Options: -Os, -O1,  -O2 -fno-vectorize and -O3 -fno-vectorize

In the past, some [other](https://www.cl.cam.ac.uk/~rja14/Papers/whatyouc.pdf) [secure](https://electricdusk.com/cmov-conversion.html) [source](https://leslyann-daniel.fr/ressources/papers/2020_SP_binsecrel.pdf) [patterns](https://core.ac.uk/download/pdf/148026376.pdf) have also been shown to be compiled into vulnerable machine code.

What about ML-KEM?

ML-KEM (Kyber) is the soon-to-be standard for post-quantum key encapsulation (FIPS-203). It turns out that the routine we described earlier isn’t just a toy example; it’s actually an important routine in ML-KEM, and it’s needed in both key encapsulation and decapsulation. In the reference implementation, this function is called poly\_frommsg. You can inspect it [here](https://github.com/pq-crystals/kyber/blob/b628ba78711bc28327dc7d2d5c074a00f061884e/ref/poly.c#L166). Looks good?

It does! However, having loaded ‘[Chekhov’s gun](https://en.wikipedia.org/wiki/Chekhov%27s_gun)’ with the previous section, it’s time to fire it.

The code pattern corresponds to the **expand\_secure** implementation. For the compiler options we mentioned, Clang emits a vulnerable secret-dependent branch in this part of the ML-KEM reference code.

So just how bad is this?

* On the one hand, the msg argument is a critical security parameter in both encapsulation and decapsulation.
* On the other hand, there’s *one* vulnerable branch. In decapsulation, poly\_frommsg is used *once*. The whole decapsulation takes *more than 100K cycles.* Surely the timing difference produced by this one branch is too small to matter?

Well, there are two answers. The first is that research shows that sophisticated local attackers can perform [high-resolution cache attacks](https://antoonpurnal.github.io/files/pdf/PrimeScope.pdf), target the [branch predictor](https://www.cs.ucr.edu/~nael/pubs/asplos18.pdf) to learn which branches are taken, or [slow down the library](https://eprint.iacr.org/2015/1141.pdf) to amplify the timing difference. So the prudent approach is to patch.

The second answer is that, *actually*, measuring the time it takes for a complete decapsulation is enough for an attacker to piece together the key.

**To back up this claim, we provide a** [practical demo](https://github.com/antoonpurnal/clangover) **that shows the role of the timing vulnerability in the recovery of an ML-KEM 512 secret key**. The demo terminates successfully in less than 10 minutes on the author’s laptop.

![](https://pqshield.com/wp-content/uploads/2024/06/blog_05_poc.png)![](data:image/svg+xml...)

Affected Libraries

In summary: while not all compilers, options and platforms are affected, *if a given binary is affected, the security impact may be critical*. Therefore, the conservative approach is to take this issue seriously, and look out for patches from your cryptography provider.

The [reference implementation](https://github.com/pq-crystals/kyber) has been patched by implementing the relevant conditional move as a function in a separate file. This change prevents Clang from recognizing the binary nature of the condition flag, and hence from applying the optimization.

We’ve been coordinating with libraries that integrate the reference implementation. We notified [liboqs](https://github.com/open-quantum-safe/liboqs), [aws-lc](https://github.com/aws/aws-lc), [pq-code-package](https://github.com/pq-code-package) and [WolfSSL](https://github.com/wolfSSL/wolfssl) in advance through their private vulnerability disclosure process. We also informed [PQClean](https://github.com/PQClean/PQClean) and [rustpq/pqcrypto](https://github.com/rustpq/pqcrypto), together with a public disclosure of the issue.

It’s important to note that this does not rule out the possibility that other libraries, which are based on the reference implementation but do not use the poly\_frommsg function verbatim, may be vulnerable – either now or in the future.

We’d like to thank Peter Schwabe (and the Kyber team) for their role in the swift and collaborative disclosure process, helping us coordinate with the wider PQC ecosystem.

Implementation Security Matters

PQShield cares about advancing PQC implementation maturity inside and outside of our products. Timing vulnerability testing is included in [all three PQShield security profiles](https://pqshield.com/wp-content/uploads/2024/03/PQS_Security_2pp-A4_Digital.pdf) – *Cloud*, *Edge*, and *Government* – and features several complementary **post-compilation** constant-time checks.

Our own quantum-safe [software products](https://pqshield.com/products/) (PQCryptoLib, PQCryptoLib Embedded, and PQSDK) were never affected by this issue. As providers of post-quantum solutions, our goal is to stay one step ahead of the attackers, and we hope that with our focus on research, development, and implementation, we can continue to contribute solutions to potential vulnerabilities.

 [## Sign up for our newsletter

![](https://pqshield.com/wp-content/themes/pqshield/images/any-icon.php?icon=Arrow-Down-Newsletter.svg&colour=DarkBlue&property=stroke)![](data:image/svg+xml...)](#newsletter-signup)    [![back-to-top](https://pqshield.com/wp-content/themes/pqshield/images/any-icon.php?icon=back-to-top-icon.svg&colour=Gold&color2=White)![back-to-top](data:image/svg+xml...)](#page) ![PQShield logo](https://pqshield.com/wp-content/uploads/2024/04/PQ-Logo.png)![PQShield logo](data:image/svg+xml...)PQShield comprises a world-class collaboration of post-quantum cryptographers, engineers, and operators. We’ve helped shape all of the first international PQC NIST standards, and we were the first cybersecurity company to develop quantum-safe cryptography on chips, in applications, and in the cloud.![](https://pqshield.com/wp-content/uploads/2024/10/ISOIEC-Footer-x2_Oct24.png)![](data:image/svg+xml...)
#### Links

* [Team PQShield](https://pqshield.com/team-pqshield/)
* [Products](https://pqshield.com/products/)
* [Markets](https://pqshield.com/markets/)
* [Publications](https://pqshield.com/publications/)
* [News](https://pqshield.com/news/)
* [Partners](https://pqshield.com/partners/)
* [Careers](https://pqshield.com/careers/)
* [Contact](https://pqshield.com/contact-us/)
* [Security, Quality & Legal](https://pqshield.com/security-quality-legal/)
* [Report a Bug or Vulnerability](https://content.pqshield.com/productreport)
#### Markets

* [Semiconductors and Manufacturing](https://pqshield.com/markets/)
* [Military and Aerospace](https://pqshield.com/markets/)
* [Identity and Paymentech](https://pqshield.com/markets/)
* [System Integrators](https://pqshield.com/markets/)
* [Network & Telecommunications](https://pqshield.com/markets/)
* [Automotive](https://pqshield.com/markets/)
* [Industrial IoT](https://pqshield.com/markets/)
* [Enterprise Platforms](https://pqshield.com/markets/)
#### Products

* [PQSDK](https://pqshield.com/products/pqs-sw-sdk/)
* [PQCryptoLib](https://pqshield.com/products/pqs-sw-clb/)
* [PQCryptoLib – Embedded](https://pqshield.com/products/pqs-sw-cle/)
* [PQPlatform – Hash](https://pqshield.com/products/pqp-hw-hbs/)
* [PQPlatform – Lattice](https://pqshield.com/products/pqp-hw-lat/)
* [PQPlatform – CoPro](https://pqshield.com/products/pqp-hw-cop/)
* [PQPlatform – SubSys](https://pqshield.com/products/pqp-hw-sub/)
* [PQPerform – Lattice](https://pqshield.com/products/pqf-hw-lat/)
* [Product Security](https://pqshield.com/products/product-security/)

* [Security, Quality & Legal](https://pqshield.com/security-quality-legal/)
© PQShield Ltd 2025 [![Twitter](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-X.svg?v=1)![Twitter](data:image/svg+xml...)](https://twitter.com/PqShield) [![LinkedIn](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-LI.svg?v=1)![LinkedIn](data:image/svg+xml...)](https://www.linkedin.com/company/pqshield/) [![Youtube](https://pqshield.com/wp-content/themes/pqshield/images/icons/Social-YT.svg?v=1)![Youtube](data:image/svg+xml...)](https://www.youtube.com/channel/UCoiZ4TzLcBNpNtXyJI7-cOg)[![Aubergine 262 ltd. Logo](https://pqshield.com/wp-content/themes/pqshield/images/aubergine-logo.svg)![Aubergine 262 ltd. Logo](data:image/svg+xml...)](https://www.aubergine262.com/)       ![](https://ws.zoominfo.com/pixel/622f77f9304c31001cf3636a)

=== Content from twitter.com_9765a187_20250111_083825.html ===


