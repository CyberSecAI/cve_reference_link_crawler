
[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F93110)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F93110)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=rust-lang%2Frust)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[rust-lang](/rust-lang)
/
**[rust](/rust-lang/rust)**
Public

* [Notifications](/login?return_to=%2Frust-lang%2Frust) You must be signed in to change notification settings
* [Fork
  12.9k](/login?return_to=%2Frust-lang%2Frust)
* [Star
   100k](/login?return_to=%2Frust-lang%2Frust)

* [Code](/rust-lang/rust)
* [Issues
  5k+](/rust-lang/rust/issues)
* [Pull requests
  652](/rust-lang/rust/pulls)
* [Actions](/rust-lang/rust/actions)
* [Projects
  7](/rust-lang/rust/projects)
* [Security](/rust-lang/rust/security)
* [Insights](/rust-lang/rust/pulse)

Additional navigation options

* [Code](/rust-lang/rust)
* [Issues](/rust-lang/rust/issues)
* [Pull requests](/rust-lang/rust/pulls)
* [Actions](/rust-lang/rust/actions)
* [Projects](/rust-lang/rust/projects)
* [Security](/rust-lang/rust/security)
* [Insights](/rust-lang/rust/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Frust-lang%2Frust%2Fissues%2Fnew%2Fchoose)

By clicking â€œSign up for GitHubâ€, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). Weâ€™ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Frust-lang%2Frust%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# [stable] Fix CVE 2022 21658 and prepare 1.58.1 #93110

 Merged

[bors](/bors)
merged 15 commits into
[rust-lang:stable](/rust-lang/rust/tree/stable "rust-lang/rust:stable")
from
[pietroalbini:pa-cve-2022-21658-stable](/pietroalbini/rust/tree/pa-cve-2022-21658-stable "pietroalbini/rust:pa-cve-2022-21658-stable")

Jan 20, 2022

 Merged

# [[stable] Fix CVE 2022 21658 and prepare 1.58.1](#top) #93110

[bors](/bors)
merged 15 commits into
[rust-lang:stable](/rust-lang/rust/tree/stable "rust-lang/rust:stable")
from
[pietroalbini:pa-cve-2022-21658-stable](/pietroalbini/rust/tree/pa-cve-2022-21658-stable "pietroalbini/rust:pa-cve-2022-21658-stable")

Jan 20, 2022

[Conversation
26](/rust-lang/rust/pull/93110)
[Commits
15](/rust-lang/rust/pull/93110/commits)
[Checks
0](/rust-lang/rust/pull/93110/checks)
[Files changed](/rust-lang/rust/pull/93110/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=60&v=4)](/pietroalbini)

Copy link

Member

### @pietroalbini **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issue-1109166475)

Followup to [#93071](https://github.com/rust-lang/rust/pull/93071). Includes the fix for CVE-2022-21658.

r? [@ghost](https://github.com/ghost)

cc @rust-lang/release @rust-lang/security

Sorry, something went wrong.

All reactions

 [calebcartwright](/calebcartwright)
and others
added 11 commits
[January 19, 2022 10:25](#commits-pushed-b167157)

[![@calebcartwright](https://avatars.githubusercontent.com/u/13042488?s=40&v=4)](/calebcartwright) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[fix(rustfmt): resolve generated file formatting issue](/rust-lang/rust/pull/93110/commits/b16715751a222be1953bae1010c77eae6996fd8a "fix(rustfmt): resolve generated file formatting issue")`

`[b167157](/rust-lang/rust/pull/93110/commits/b16715751a222be1953bae1010c77eae6996fd8a)`

[![@Aaron1011](https://avatars.githubusercontent.com/u/1408859?s=40&v=4)](/Aaron1011) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Only check for errors in predicate when skipping impl assembly](/rust-lang/rust/pull/93110/commits/70a61c97cbc8375432b16482f127d45b08054951 "Only check for errors in predicate when skipping impl assembly

Prior to PR #91205, checking for errors in the overall obligation
would check checking the `ParamEnv`, due to an incorrect
`super_visit_with` impl. With this bug fixed, we will now
bail out of impl candidate assembly if the `ParamEnv` contains
any error types.

In practice, this appears to be overly conservative - when an error
occurs early in compilation, we end up giving up early for some
predicates that we could have successfully evaluated without overflow.
By only checking for errors in the predicate itself, we avoid causing
additional spurious 'type annotations needed' errors after a 'real'
error has already occurred.

With this PR, the diagnostic changes caused by PR #91205 are reverted.")`
 â€¦

`[70a61c9](/rust-lang/rust/pull/93110/commits/70a61c97cbc8375432b16482f127d45b08054951)`

```
Prior to PR [rust-lang#91205](https://github.com/rust-lang/rust/pull/91205), checking for errors in the overall obligation
would check checking the `ParamEnv`, due to an incorrect
`super_visit_with` impl. With this bug fixed, we will now
bail out of impl candidate assembly if the `ParamEnv` contains
any error types.

In practice, this appears to be overly conservative - when an error
occurs early in compilation, we end up giving up early for some
predicates that we could have successfully evaluated without overflow.
By only checking for errors in the predicate itself, we avoid causing
additional spurious 'type annotations needed' errors after a 'real'
error has already occurred.

With this PR, the diagnostic changes caused by PR [rust-lang#91205](https://github.com/rust-lang/rust/pull/91205) are reverted.
```

[![@Qwaz](https://avatars.githubusercontent.com/u/5073807?s=40&v=4)](/Qwaz) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Move non_send_fields_in_send_ty back to nursery](/rust-lang/rust/pull/93110/commits/a14ae6f0791f499a2205a11846fdd75f25a5ae9a "Move `non_send_fields_in_send_ty` back to `nursery`")`

`[a14ae6f](/rust-lang/rust/pull/93110/commits/a14ae6f0791f499a2205a11846fdd75f25a5ae9a)`

[![@Jarcho](https://avatars.githubusercontent.com/u/7761774?s=40&v=4)](/Jarcho) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Handle implicit named arguments in useless_format](/rust-lang/rust/pull/93110/commits/408709d88c4e8928aaf57663e6d4b692839e9626 "Handle implicit named arguments in `useless_format`")`

`[408709d](/rust-lang/rust/pull/93110/commits/408709d88c4e8928aaf57663e6d4b692839e9626)`

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[add release notes for 1.58.1](/rust-lang/rust/pull/93110/commits/acd647611d03cc80bb2b9cc6186c8f83c8ca7940 "add release notes for 1.58.1")`

`[acd6476](/rust-lang/rust/pull/93110/commits/acd647611d03cc80bb2b9cc6186c8f83c8ca7940)`

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[bump cargo to fix spurious failure](/rust-lang/rust/pull/93110/commits/0076b17beffa3aca955b5311fcdeb2a1309af865 "bump cargo to fix spurious failure")`

`[0076b17](/rust-lang/rust/pull/93110/commits/0076b17beffa3aca955b5311fcdeb2a1309af865)`

[![@ChrisDenton](https://avatars.githubusercontent.com/u/4459874?s=40&v=4)](/ChrisDenton) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Fix CVE-2022-21658 for Windows](/rust-lang/rust/pull/93110/commits/4f0ad1c92ca08da6e8dc17838070975762f59714 "Fix CVE-2022-21658 for Windows")`

`[4f0ad1c](/rust-lang/rust/pull/93110/commits/4f0ad1c92ca08da6e8dc17838070975762f59714)`

[![@hkratz](https://avatars.githubusercontent.com/u/3736990?s=40&v=4)](/hkratz) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Fix CVE-2022-21658 for UNIX-like](/rust-lang/rust/pull/93110/commits/32ed6e599bb4722efefd78bbc9cd7ec4613cb946 "Fix CVE-2022-21658 for UNIX-like")`

`[32ed6e5](/rust-lang/rust/pull/93110/commits/32ed6e599bb4722efefd78bbc9cd7ec4613cb946)`

[![@alexcrichton](https://avatars.githubusercontent.com/u/64996?s=40&v=4)](/alexcrichton) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Fix CVE-2022-21658 for WASI](/rust-lang/rust/pull/93110/commits/406cc071d6cfdfdb678bf3d83d766851de95abaf "Fix CVE-2022-21658 for WASI")`

`[406cc07](/rust-lang/rust/pull/93110/commits/406cc071d6cfdfdb678bf3d83d766851de95abaf)`

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Update std::fs::remove_dir_all documentation](/rust-lang/rust/pull/93110/commits/42cb17e224e1c5ba6292adeb5b77db5bd19a7e3e "Update std::fs::remove_dir_all documentation")`

`[42cb17e](/rust-lang/rust/pull/93110/commits/42cb17e224e1c5ba6292adeb5b77db5bd19a7e3e)`

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[Update release notes to include CVE-2022-21658](/rust-lang/rust/pull/93110/commits/1e17daf1e0104ef096f70c062dd92e4310cd2966 "Update release notes to include CVE-2022-21658")`

`[1e17daf](/rust-lang/rust/pull/93110/commits/1e17daf1e0104ef096f70c062dd92e4310cd2966)`

[![@rustbot](https://avatars.githubusercontent.com/u/47979223?s=40&u=8e3da52dfa4b8cfeb822acd82600ee339d4637bd&v=4)](/rustbot)
[rustbot](/rustbot)
added
the
[T-compiler](/rust-lang/rust/labels/T-compiler)
Relevant to the compiler team, which will review and decide on the PR/issue.
label
[Jan 20, 2022](#event-5923992780)

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=80&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)

Copy link

Member

Author

### **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issuecomment-1017386815)

| [@bors](https://github.com/bors) r+ p=1000 rollup=never |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017386866)

| ðŸ“Œ Commit [1e17daf](https://github.com/rust-lang/rust/commit/1e17daf1e0104ef096f70c062dd92e4310cd2966) has been approved by `pietroalbini` |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
added
the
[S-waiting-on-bors](/rust-lang/rust/labels/S-waiting-on-bors)
Status: Waiting on bors to run and complete tests. Bors will change the label on completion.
label
[Jan 20, 2022](#event-5923994633)

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017387421)

| âŒ› Testing commit [1e17daf](https://github.com/rust-lang/rust/commit/1e17daf1e0104ef096f70c062dd92e4310cd2966) with merge 141c792fcb22e7b5e2e37ec143a68518b2e9c48a... |
| --- |

All reactions

Sorry, something went wrong.

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)
[pietroalbini](/pietroalbini)
mentioned this pull request
[Jan 20, 2022](#ref-pullrequest-1107882719)

[[stable] Prepare 1.58.1 point release
#93071](/rust-lang/rust/pull/93071)
 Merged

[![@rust-log-analyzer](https://avatars.githubusercontent.com/u/68648060?s=80&u=5800488b3a43878989d2df5c0eead5c90ce18593&v=4)](/rust-log-analyzer)

### This comment has been minimized.

[Sign in to view](/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F93110)

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017396482)

| ðŸ’” Test failed - [checks-actions](https://github.com/rust-lang-ci/rust/runs/4881260973?check_suite_focus=true) |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
added
[S-waiting-on-review](/rust-lang/rust/labels/S-waiting-on-review)
Status: Awaiting review from the assignee but also interested parties.
and removed
[S-waiting-on-bors](/rust-lang/rust/labels/S-waiting-on-bors)
Status: Waiting on bors to run and complete tests. Bors will change the label on completion.
labels
[Jan 20, 2022](#event-5924057989)

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=80&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)

Copy link

Member

Author

### **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issuecomment-1017407255)

| cc [@hkratz](https://github.com/hkratz), something went wrong during the rebase :( |
| --- |

All reactions

Sorry, something went wrong.

[![@hkratz](https://avatars.githubusercontent.com/u/3736990?s=40&v=4)](/hkratz) [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&v=4)](/pietroalbini)

`[backport missed illumos fix](/rust-lang/rust/pull/93110/commits/cb88166762d30dfc6f7d57679755e79ba5676f4c "backport missed illumos fix")`

`[cb88166](/rust-lang/rust/pull/93110/commits/cb88166762d30dfc6f7d57679755e79ba5676f4c)`

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=80&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)

Copy link

Member

Author

### **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issuecomment-1017411001)

| [@bors](https://github.com/bors) r+ p=1000 rollup=never |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017411011)

| ðŸ“Œ Commit [cb88166](https://github.com/rust-lang/rust/commit/cb88166762d30dfc6f7d57679755e79ba5676f4c) has been approved by `pietroalbini` |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
added
[S-waiting-on-bors](/rust-lang/rust/labels/S-waiting-on-bors)
Status: Waiting on bors to run and complete tests. Bors will change the label on completion.
and removed
[S-waiting-on-review](/rust-lang/rust/labels/S-waiting-on-review)
Status: Awaiting review from the assignee but also interested parties.
labels
[Jan 20, 2022](#event-5924182752)

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017411110)

| âŒ› Testing commit [cb88166](https://github.com/rust-lang/rust/commit/cb88166762d30dfc6f7d57679755e79ba5676f4c) with merge 2486f951e3e7b4ec9048593c82664b7353d1814d... |
| --- |

All reactions

Sorry, something went wrong.

14 hidden items

Load moreâ€¦

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=80&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)

Copy link

Member

Author

### **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issuecomment-1017459309)

| [@bors](https://github.com/bors) r+ p=1000 rollup=never  Improved the Fuchsia fix and fixed a compiler error in REDOX. |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017459323)

| ðŸ“Œ Commit [1c63ec4](https://github.com/rust-lang/rust/commit/1c63ec48b8cbf553d291a04957d86cfd191fcd78) has been approved by `pietroalbini` |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
added
[S-waiting-on-bors](/rust-lang/rust/labels/S-waiting-on-bors)
Status: Waiting on bors to run and complete tests. Bors will change the label on completion.
and removed
[S-waiting-on-review](/rust-lang/rust/labels/S-waiting-on-review)
Status: Awaiting review from the assignee but also interested parties.
labels
[Jan 20, 2022](#event-5924565717)

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017459425)

| âŒ› Testing commit [1c63ec4](https://github.com/rust-lang/rust/commit/1c63ec48b8cbf553d291a04957d86cfd191fcd78) with merge [08182e4](https://github.com/rust-lang/rust/commit/08182e4670b07fbb0511e01338eb9d6402c90dd3)... |
| --- |

All reactions

Sorry, something went wrong.

This was referenced Jan 20, 2022

[intra-doc: Use the impl's assoc item where possible
#92680](/rust-lang/rust/pull/92680)
 Merged

[Fix variant index / discriminant confusion in uninhabited enum branching
#89764](/rust-lang/rust/pull/89764)
 Merged

[update comment for `ensure_monomorphic_enough`
#93114](/rust-lang/rust/pull/93114)
 Merged

[Update some rustc dependencies to deduplicate them
#92896](/rust-lang/rust/pull/92896)
 Merged

[Stabilize `-Z print-link-args` as `--print link-args`
#91606](/rust-lang/rust/pull/91606)
 Merged

[[beta] Fix CVE-2022-21658
#93111](/rust-lang/rust/pull/93111)
 Merged

[Fix CVE-2022-21658
#93112](/rust-lang/rust/pull/93112)
 Merged

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=80&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)

Copy link

Member

Author

### **[pietroalbini](/pietroalbini)** commented [Jan 20, 2022](#issuecomment-1017640351)

| [@bors](https://github.com/bors) treeclosed- |
| --- |

All reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=80&v=4)](/bors)

Copy link

Contributor

### **[bors](/bors)** commented [Jan 20, 2022](#issuecomment-1017646858)

| â˜€ï¸ Test successful - [checks-actions](https://github.com/rust-lang-ci/rust/runs/4884645566?check_suite_focus=true) Approved by: pietroalbini Pushing [08182e4](https://github.com/rust-lang/rust/commit/08182e4670b07fbb0511e01338eb9d6402c90dd3) to stable... |
| --- |

 ðŸŽ‰
3
 flip1995, tatsuya6502, and pietroalbini reacted with hooray emoji

All reactions

* ðŸŽ‰
  3 reactions

Sorry, something went wrong.

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
added
the
[merged-by-bors](/rust-lang/rust/labels/merged-by-bors)
This PR was explicitly merged by bors.
label
[Jan 20, 2022](#event-5926042510)

[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)
[bors](/bors)
merged commit [`08182e4`](/rust-lang/rust/commit/08182e4670b07fbb0511e01338eb9d6402c90dd3)
into
rust-lang:stable

[Jan 20, 2022](https://github.com/rust-lang/rust/pull/93110#event-5926043202)

 [![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)
[pietroalbini](/pietroalbini)
deleted the
pa-cve-2022-21658-stable

branch
[January 20, 2022 15:50](#event-5926045191)

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)
[pietroalbini](/pietroalbini)
mentioned this pull request
[Jan 20, 2022](#ref-pullrequest-1109528787)

[[stable] Prepare 1.58.1 artifacts
#93121](/rust-lang/rust/pull/93121)
 Merged

[bors](/bors)
added a commit
to rust-lang-ci/rust
that referenced
this pull request
[Jan 20, 2022](#ref-commit-db9d1b2)
[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)

`[Auto merge of](/rust-lang-ci/rust/commit/db9d1b20bba1968c1ec1fc49616d4742c1725b4b "Auto merge of #93121 - pietroalbini:pa-1.58.1-really, r=pietroalbini

[stable] Prepare 1.58.1 artifacts

#93110 added all the changes needed for the 1.58.1 release, but didn't bump the version number. This PR bumps the version number to produce the 1.58.1 stable artifacts.

r? `@ghost`") [rust-lang#93121](https://github.com/rust-lang/rust/pull/93121) [- pietroalbini:pa-1.58.1-really, r=pietâ€¦](/rust-lang-ci/rust/commit/db9d1b20bba1968c1ec1fc49616d4742c1725b4b "Auto merge of #93121 - pietroalbini:pa-1.58.1-really, r=pietroalbini

[stable] Prepare 1.58.1 artifacts

#93110 added all the changes needed for the 1.58.1 release, but didn't bump the version number. This PR bumps the version number to produce the 1.58.1 stable artifacts.

r? `@ghost`")`
â€¦

`[db9d1b2](/rust-lang-ci/rust/commit/db9d1b20bba1968c1ec1fc49616d4742c1725b4b)`

```
â€¦roalbini

[stable] Prepare 1.58.1 artifacts

[rust-lang#93110](https://github.com/rust-lang/rust/pull/93110) added all the changes needed for the 1.58.1 release, but didn't bump the version number. This PR bumps the version number to produce the 1.58.1 stable artifacts.

r? `@ghost`
```

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=40&u=8c43b73285fe3e82d464b38b98020290f4bc4882&v=4)](/pietroalbini)
[pietroalbini](/pietroalbini)
mentioned this pull request
[Jan 20, 2022](#ref-pullrequest-1109737704)

[Add script to prevent point releases with same number as existing ones
#93128](/rust-lang/rust/pull/93128)
 Merged

[![the8472](https://avatars.githubusercontent.com/u/1065730?s=60&v=4)](/the8472)

**[the8472](/the8472)**
reviewed
[Jan 20, 2022](#pullrequestreview-858777308)

 [View reviewed changes](/rust-lang/rust/pull/93110/files/1c63ec48b8cbf553d291a04957d86cfd191fcd78)

[library/std/src/sys/unix/fs.rs](/rust-lang/rust/pull/93110/files/1c63ec48b8cbf553d291a04957d86cfd191fcd78#diff-4a74019cd4088485a9e0706be6ccf93ff091cb19d9aad474e4e9d03e2bb8522d)

|  |  | let child = child?; |
| --- | --- | --- |
|  |  | match is\_dir(&child) { |
|  |  | Some(true) => { |
|  |  | remove\_dir\_all\_recursive(Some(fd), Path::new(&child.file\_name()))?; |

Copy link

Member

### @the8472 **[the8472](/the8472)** [Jan 20, 2022](#discussion_r789132637)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This seems like a breaking change since it lacks loop detection? A sufficiently deep directory tree should return ELOOP or ENAMETOOLONG, but the kernel can't do that for us if we're using `openat`. Instead of returning an error it would result stack overflow panics.

I already had a PR open for openat-based remove\_dir\_all ([#88731](https://github.com/rust-lang/rust/pull/88731)) that does loop detection.

Sorry, something went wrong.

All reactions

Copy link

Contributor

### @hkratz **[hkratz](/hkratz)** [Jan 20, 2022](#discussion_r789138299) â€¢ edited Loading

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

There should be no loops. Bind mounts on Linux and directory hardlinks (available for Macos only) are not allowed to loop and we are not descending into symlinked dirs because we open them with `openat(..., O_NOFOLLOW)`.

Sorry, something went wrong.

All reactions

Copy link

Member

### @the8472 **[the8472](/the8472)** [Jan 20, 2022](#discussion_r789141945)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

I thought I have managed to introduce loops with bind mounts or overlayfs in the past. But let me check again.

And FUSE might be another option.

Sorry, something went wrong.

All reactions

Copy link

Member

### @the8472 **[the8472](/the8472)** [Jan 20, 2022](#discussion_r789142227)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Anyway, I have filed [#93129](https://github.com/rust-lang/rust/issues/93129) let's continue discussion there.

Sorry, something went wrong.

All reactions

[![@the8472](https://avatars.githubusercontent.com/u/1065730?s=40&v=4)](/the8472)
[the8472](/the8472)
mentioned this pull request
[Jan 20, 2022](#ref-issue-1109754094)

[Security fix for remove\_dir\_all may have introduced a regression how filesystem loops are handled
#93129](/rust-lang/rust/issues/93129)

Open

[matthiaskrgr](/matthiaskrgr)
added a commit
to matthiaskrgr/rust
that referenced
this pull request
[Jan 20, 2022](#ref-commit-9ea966a)
[![@matthiaskrgr](https://avatars.githubusercontent.com/u/476013?s=40&v=4)](/matthiaskrgr)

`[Rollup merge of](/matthiaskrgr/rust/commit/9ea966a275b5d7753f3c14f3122549f08fc854e4 "Rollup merge of #93128 - pietroalbini:pa-verify-stable-version-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with #93110 and #93121, where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`") [rust-lang#93128](https://github.com/rust-lang/rust/pull/93128) [- pietroalbini:pa-verify-stable-versiâ€¦](/matthiaskrgr/rust/commit/9ea966a275b5d7753f3c14f3122549f08fc854e4 "Rollup merge of #93128 - pietroalbini:pa-verify-stable-version-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with #93110 and #93121, where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`")`
â€¦

`[9ea966a](/matthiaskrgr/rust/commit/9ea966a275b5d7753f3c14f3122549f08fc854e4)`

```
â€¦on-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with [rust-lang#93110](https://github.com/rust-lang/rust/pull/93110) and [rust-lang#93121](https://github.com/rust-lang/rust/pull/93121), where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`
```

[![@dscottboggs](https://avatars.githubusercontent.com/u/7088510?s=40&v=4)](/dscottboggs)
[dscottboggs](/dscottboggs)
mentioned this pull request
[Jan 23, 2022](#ref-pullrequest-1111863645)

[Bump rust version to mitigate CVE-2022-21658
dani-garcia/vaultwarden#2255](/dani-garcia/vaultwarden/pull/2255)
 Merged

[ehuss](/ehuss)
pushed a commit
to ehuss/rust
that referenced
this pull request
[Jan 25, 2022](#ref-commit-9f7c5dc)
[![@matthiaskrgr](https://avatars.githubusercontent.com/u/476013?s=40&v=4)](/matthiaskrgr) [![@ehuss](https://avatars.githubusercontent.com/u/43198?s=40&v=4)](/ehuss)

`[Rollup merge of](/ehuss/rust/commit/9f7c5dce21e0e17833ff6da4800ce1211aca02de "Rollup merge of #93128 - pietroalbini:pa-verify-stable-version-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with #93110 and #93121, where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`") [rust-lang#93128](https://github.com/rust-lang/rust/pull/93128) [- pietroalbini:pa-verify-stable-versiâ€¦](/ehuss/rust/commit/9f7c5dce21e0e17833ff6da4800ce1211aca02de "Rollup merge of #93128 - pietroalbini:pa-verify-stable-version-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with #93110 and #93121, where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`")`
â€¦

`[9f7c5dc](/ehuss/rust/commit/9f7c5dce21e0e17833ff6da4800ce1211aca02de)`

```
â€¦on-number, r=Mark-Simulacrum

Add script to prevent point releases with same number as existing ones

This will hopefully prevent what happened today with [rust-lang#93110](https://github.com/rust-lang/rust/pull/93110) and [rust-lang#93121](https://github.com/rust-lang/rust/pull/93121), where we built point release artifacts without changing version numbers, thus requiring another PR to change the version number.

r? `@Mark-Simulacrum`
```

[![@flip1995](https://avatars.githubusercontent.com/u/9744647?s=40&v=4)](/flip1995)
[flip1995](/flip1995)
mentioned this pull request
[Jan 27, 2022](#ref-pullrequest-1116276858)

[[beta] Clippy: Handle implicit named arguments in `useless_format`
#93377](/rust-lang/rust/pull/93377)
 Merged

[bors](/bors)
added a commit
to rust-lang-ci/rust
that referenced
this pull request
[Jan 27, 2022](#ref-commit-28c8a34)
[![@bors](https://avatars.githubusercontent.com/u/3372342?s=40&v=4)](/bors)

`[Auto merge of](/rust-lang-ci/rust/commit/28c8a34e18fc05277c81328d1bbf5ed931f4d22e "Auto merge of #93377 - flip1995:beta-backport, r=Mark-Simulacrum

[beta] Clippy: Handle implicit named arguments in `useless_format`

Closes #92938

This backports a Clippy fix to beta, that was already backported for 1.58.1 in https://github.com/rust-lang/rust/pull/93110") [rust-lang#93377](https://github.com/rust-lang/rust/pull/93377) [- flip1995:beta-backport, r=Mark-Simulaâ€¦](/rust-lang-ci/rust/commit/28c8a34e18fc05277c81328d1bbf5ed931f4d22e "Auto merge of #93377 - flip1995:beta-backport, r=Mark-Simulacrum

[beta] Clippy: Handle implicit named arguments in `useless_format`

Closes #92938

This backports a Clippy fix to beta, that was already backported for 1.58.1 in https://github.com/rust-lang/rust/pull/93110")`
â€¦

`[28c8a34](/rust-lang-ci/rust/commit/28c8a34e18fc05277c81328d1bbf5ed931f4d22e)`

```
â€¦crum

[beta] Clippy: Handle implicit named arguments in `useless_format`

Closes [rust-lang#92938](https://github.com/rust-lang/rust/issues/92938)

This backports a Clippy fix to beta, that was already backported for 1.58.1 in [rust-lang#93110](https://github.com/rust-lang/rust/pull/93110)
```

[![@cuviper](https://avatars.githubusercontent.com/u/36186?s=40&v=4)](/cuviper)
[cuviper](/cuviper)
added this to the [1.58.1](/rust-lang/rust/milestone/91) milestone
[Nov 16, 2023](#event-10987237553)

[![@fmease](https://avatars.githubusercontent.com/u/14913065?s=40&v=4)](/fmease)
[fmease](/fmease)
mentioned this pull request
[Nov 25, 2024](#ref-issue-2690425028)

[Meta tracking issue for release notes PRs
#133444](/rust-lang/rust/issues/133444)

Open

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Frust-lang%2Frust%2Fpull%2F93110)

Reviewers

[![@hkratz](https://avatars.githubusercontent.com/u/3736990?s=40&v=4)](/hkratz) [hkratz](/hkratz)

hkratz left review comments

[![@the8472](https://avatars.githubusercontent.com/u/1065730?s=40&v=4)](/the8472) [the8472](/the8472)

the8472 left review comments

Assignees

No one assigned

Labels

[merged-by-bors](/rust-lang/rust/labels/merged-by-bors)
This PR was explicitly merged by bors.
[S-waiting-on-bors](/rust-lang/rust/labels/S-waiting-on-bors)
Status: Waiting on bors to run and complete tests. Bors will change the label on completion.
[T-compiler](/rust-lang/rust/labels/T-compiler)
Relevant to the compiler team, which will review and decide on the PR/issue.

Projects

None yet

Milestone

 [**1.58.1**](/rust-lang/rust/milestone/91 "1.58.1")

Development

Successfully merging this pull request may close these issues.

14 participants

[![@pietroalbini](https://avatars.githubusercontent.com/u/2299951?s=52&v=4)](/pietroalbini) [![@bors](https://avatars.githubusercontent.com/u/3372342?s=52&v=4)](/bors) [![@rust-log-analyzer](https://avatars.githubusercontent.com/u/68648060?s=52&v=4)](/rust-log-analyzer) [![@the8472](https://avatars.githubusercontent.com/u/1065730?s=52&v=4)](/the8472) [![@hkratz](https://avatars.githubusercontent.com/u/3736990?s=52&v=4)](/hkratz) [![@kaimast](https://avatars.githubusercontent.com/u/4525445?s=52&v=4)](/kaimast) [![@cuviper](https://avatars.githubusercontent.com/u/36186?s=52&v=4)](/cuviper) [![@rustbot](https://avatars.githubusercontent.com/u/47979223?s=52&v=4)](/rustbot) [![@calebcartwright](https://avatars.githubusercontent.com/u/13042488?s=52&v=4)](/calebcartwright) [![@Aaron1011](https://avatars.githubusercontent.com/u/1408859?s=52&v=4)](/Aaron1011) [![@Qwaz](https://avatars.githubusercontent.com/u/5073807?s=52&v=4)](/Qwaz) [![@Jarcho](https://avatars.githubusercontent.com/u/7761774?s=52&v=4)](/Jarcho) [![@ChrisDenton](https://avatars.githubusercontent.com/u/4459874?s=52&v=4)](/ChrisDenton) [![@alexcrichton](https://avatars.githubusercontent.com/u/64996?s=52&v=4)](/alexcrichton)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

Â© 2025 GitHub,Â Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You canâ€™t perform that action at this time.

