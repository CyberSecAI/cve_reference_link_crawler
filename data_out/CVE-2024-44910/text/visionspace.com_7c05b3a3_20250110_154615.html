

[Skip to content](#content_skip_link_anchor)
[Skip to footer](#footer_skip_link_anchor)
[![VisionSpace](//visionspace.com/wp-content/uploads/2024/07/cropped-VISIONSPACE_EYE_BLACK_HR-1.png)](https://visionspace.com/)

* Services
  + [Projects](https://visionspace.com/projects/)
  + [Consultancy](https://visionspace.com/services/consultancy/)
  + [Cybersecurity](https://visionspace.com/services/cybersecurity/)
  + [Programming](https://visionspace.com/services/programming/)
  + [Satellite Operations](https://visionspace.com/services/satellite-operations/)
* Products
  + [Karel](https://www.karel.ai/)
  + [ParleIoT](https://visionspace.com/our-services/product-parle-iot/)
  + [Pianista](https://visionspace.com/our-services/product-pianista/)
  + [SLE Provider](https://github.com/visionspacetec/sle-provider)
  + [VStart](http://vstart.io/)
* [Blog](https://visionspace.com/blog-standard/)
* About Us
  + [Branding](https://zeroheight.com/4836ffb25)
  + [Contacts](https://visionspace.com/contacts/)
  + [Our Team](https://visionspace.com/our-team/)
* [Careers](https://visionspace.corehr.hrcloud.com/vstg/#/jobs)
* [Login](https://groundflex.sharepoint.com/sites/visionspace)

![VisionSpace](//visionspace.com/wp-content/uploads/2024/07/cropped-VISIONSPACE_EYE_BLACK_HR-1.png)

[![VisionSpace](//visionspace.com/wp-content/uploads/2024/07/cropped-VISIONSPACE_EYE_BLACK_HR-1.png)](https://visionspace.com/)

![VisionSpace](//visionspace.com/wp-content/uploads/2024/07/cropped-VISIONSPACE_EYE_BLACK_HR-1.png)

[![VisionSpace](//visionspace.com/wp-content/uploads/2023/12/VISIONSPACE_EYE_WHITE.png)](https://visionspace.com/)
Close

* Services
  + [Projects](https://visionspace.com/projects/)
  + [Consultancy](https://visionspace.com/services/consultancy/)
  + [Cybersecurity](https://visionspace.com/services/cybersecurity/)
  + [Programming](https://visionspace.com/services/programming/)
  + [Satellite Operations](https://visionspace.com/services/satellite-operations/)
* Products
  + [Karel](https://www.karel.ai/)
  + [ParleIoT](https://visionspace.com/our-services/product-parle-iot/)
  + [Pianista](https://visionspace.com/our-services/product-pianista/)
  + [SLE Provider](https://github.com/visionspacetec/sle-provider)
  + [VStart](http://vstart.io/)
* [Blog](https://visionspace.com/blog-standard/)
* About Us
  + [Branding](https://zeroheight.com/4836ffb25)
  + [Contacts](https://visionspace.com/contacts/)
  + [Our Team](https://visionspace.com/our-team/)
* [Careers](https://visionspace.corehr.hrcloud.com/vstg/#/jobs)
* [Login](https://groundflex.sharepoint.com/sites/visionspace)

###### Have a Project?

info@website.com

###### Want to Work with Us?

[Send Brief](https://visionspace.com/contacts/)

###### Want to Buy Illustrations?

[Go to Shop](https://visionspace.com/shop/)

[Cybersecurity](https://visionspace.com/category/cyber/) [Space](https://visionspace.com/category/space/) [Technology](https://visionspace.com/category/technology/)
# How to crash a Spacecraft – DoS through Vulnerability in NASA CryptoLib v1.3.0

[By![](https://secure.gravatar.com/avatar/fa6dd76f1a53e40e0f9d64826f5607f3?s=56&d=mm&r=g)Andrzej Olchawa](https://visionspace.com/author/a-olchawa/)August 21, 2024

![](https://visionspace.com/wp-content/uploads/2024/08/crashing-cryptolib-1024x683.png)

*Written by:* [Ayman Boulaich](https://www.linkedin.com/in/aymanblh/),[Andy Olchawa](https://www.linkedin.com/in/andrzejolchawa/), [Milenko Starcik](https://www.linkedin.com/in/milenko-starcik-b7960b198/) @visionspace

[CryptoLib](https://github.com/nasa/CryptoLib), a software library developed by NASA, implements the [CCSDS](https://public.ccsds.org/) Space Data Link Security Protocol (SDLS) to secure communications between spacecraft running the [Core Flight System (cFS)](https://cfs.gsfc.nasa.gov/) and their corresponding ground stations. The library is essential in safeguarding the integrity and confidentiality of data exchanged during space missions.

Our vulnerability research team has identified out-of-bounds vulnerabilities within CryptoLib that, if exploited, can lead to a catastrophic crash in any software system dependent on it. To underscore the potential risks to space missions, we have created a Proof-of-Concept (PoC) exploit that demonstrates the impact of the vulnerabilities.

In this article, we begin with a demonstration (see Video 1) that showcases our PoC exploit successfully crashing both the cFS onboard a spacecraft and its ground station counterpart (COSMOS), as deployed within [NASA’s Operational Simulator for Small Satellites (NOS3)](https://www.nasa.gov/nasa-operational-simulation-for-small-satellites/). Following this demonstration, we dive into a detailed technical analysis of the vulnerabilities, exploring how they affect various subsystems within CryptoLib.

Public disclosures:

* CVE-2024-44910: Segmentation Fault on AOS frames
* CVE-2024-44912: Multiple Segmentation Fault on TM frames
* CVE-2024-44911: Segmentation Fault on TC frames

Video 1: Out-of-Bounds read in CryptoLib – PoC

## SPI Overview

The *Security Parameter Index (SPI)* is a transmitted value uniquely identifying the SA applicable to a Transfer Frame. All *Transfer Frames* having the same SPI on a physical channel share a single SA. The SPI can be considered a table index key to an SA database that stores all the managed information required by each of the SAs on a physical channel [5].

*Security Association (SA)* is a structure that defines a simplex (one-way), stateful cryptographic session for providing authentication, data integrity, replay protection, and/or data confidentiality at the receiving and sending ends.

To achieve this, CryptoLib uses an interface called *sa\_if* located in */src/sa/internal/sa\_interface\_inmemory.template.c*, which is loaded in memory in and has a function called *get\_sa\_from\_spi* that retrieves a SA pointer from a SPI.

Our assessment found that this function doesn’t check the SPI before retrieving the *SA* (see Figure 1).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture1-1024x581.png)

So, if we can make the library call this function with a value outside the array range, we will retrieve an invalid pointer to the SA structure. If it is dereferenced to get one of his security parameters, a *segfault* will occur, crashing the program (see Figure 2).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture2-1024x575.png)
## SegFault on AOS Frames

AOS is a data link layer protocol used by space missions and the one used for sending *AOS frames*. This protocol has been designed to meet the requirements of space missions for the efficient transfer of space application data of various types and characteristics over space-to-ground, ground-to-space, or space-to-space communications links (hereafter called space links) [2].

*SDLS-AOS* standard frame structure can be defined in Figure 3. The most important part of understanding the exploiting methodology is that there are two *Security Fields*, one for encryption and the other for authentication, respectively, and that the primary header is responsible for storing the *GVCID*.

![](https://visionspace.com/wp-content/uploads/2024/08/Picture3.png)

The *security header* is equivalent in every type of frame and consists of a 2-byte *SPI* followed by the *IV*, *SN*, and *PL* (optional) fields used for encryption/decryption. We are focusing on *SPI*, as we will see afterward that other header fields aren’t relevant for this research (see Figure 4).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture4.png)

Figure 4: Security Header structure

Figure 5 shows a code from the *AOS decryption function* called *Crypto\_AOS\_ProcessSecurity* located in */src/core/crypto\_aos.c*. We can see that the value of *SPI* is not checked before calling the *get\_sa\_from\_spi* function (line 977).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture5-1024x445.png)

Figure 5: *SPI* extraction from the input frame and *sa\_get\_from\_spi* call

A *segfault* should arise if we put an invalid index on the *AOS frame* and the *SA* pointer is dereferenced.

The only check done before getting the *SA pointer* is whether the *GVCID* is valid, so we must put a valid one on the primary header (see Figure 6 and Figure 7).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture6-1024x77.png)

Figure 6: Bit math to retrieve the GVCID values from the input frame

As shown in Figure 7, the check is not directly made, but the *GVCID* values need to be valid to extract the managed parameters (line 942).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture7-1024x335.png)

Figure 7: Retrieving the managed parameters with GVCID values

Figure 8 shows an example of how we can decrypt (line 52) a malicious *AOS frame* (line 47) that will cause a crash.

![](https://visionspace.com/wp-content/uploads/2024/08/Picture8.png)

Figure 8: Test case to demonstrate the program crash with crafted *AOS frame* with invalid *SPI*

Once executed, as demonstrated in Figure 9, the application crashes with a segmentation fault error. With the help of a debugger, we can see the exact line where the dereference is happening (see Figure 10 and Figure 11).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture9-1024x144.png)

Figure 9: *Segmentation fault* arises when executing it

![](https://visionspace.com/wp-content/uploads/2024/08/Picture10-1024x90.png)

Figure 10: The debugger log shows the vulnerable line

![](https://visionspace.com/wp-content/uploads/2024/08/Picture11-1024x484.png)

Figure 11: Line where *sa\_ptr* is dereferenced

This is so harmful as a *segfault* can lead to a *Denial of Service* in one of the two communication ends, i.e., it can crash the software onboard and on the ground.

## Multiple SegFault on TM Frames

TM is a data link layer protocol used by space missions to send *TM frames*. This protocol has been designed to meet the requirements of space missions for the efficient transfer of space application data of various types and characteristics over space-to-ground, ground-to-space, or space-to-space communications links (hereafter called space links) [3].

*SDLS-TM* standard frame structure can be defined as in Figure 12.

![](https://visionspace.com/wp-content/uploads/2024/08/Picture12-1024x323.png)

Figure 12: *TM* frame structure

The structure is like the *AOS* example, with the only key difference being that we have an optional secondary header instead of an optional insert zone (We will recall this field in a later vulnerability).

### SegFault via SPI

Figure 13 shows code from the *TM decryption* function called *Crypto\_TM\_ProcessSecurity* located in */src/core/crypto\_tm.c*. We can see that the SPI is not checked before calling the *get\_sa\_from\_spi* function (line 1004).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture13.png)

Figure 13: *SPI* extraction from the input frame and *sa\_get\_from\_spi* call

The *GVCID* is the only thing checked (line 952) before calling *sa\_get\_from\_spi*, so we have the same vulnerability as *AOS frames* (see Figure 14).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture14.png)

Figure 14: Retrieving the managed parameters with *GVCID* values

By changing the config to treat the frame as a *TM frame*, we can trigger the same vulnerability but, this time, decrypting (line 51) a malicious *TM frame* (line 46) (see Figure 15 and Figure 16).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture15.png)

Figure 15: Test case to demonstrate the program crash with crafted *TM frame* with invalid *SPI*

![](https://visionspace.com/wp-content/uploads/2024/08/Picture16.png)

Figure 16: *Segmentation fault* arises when executing it

![](https://visionspace.com/wp-content/uploads/2024/08/Picture17.png)

Figure 17: The debugger log shows the vulnerable line

![](https://visionspace.com/wp-content/uploads/2024/08/Picture18.png)

Figure 18: Line where *sa\_ptr* is dereferenced

### SegFault via Secondary Header

The *Transfer Frame Secondary Header* is optional; its presence or absence shall be signaled by the *Transfer Frame Secondary Header Flag* in the *Transfer Frame Primary Header Data Field Status* (see Figure 19 and Figure 20).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture19.png)

Figure 19: TM frame Primary Header structure

![](https://visionspace.com/wp-content/uploads/2024/08/Picture20.png)

Figure 20: TM frame Primary Header Data Field Status structure

*Transfer Frame Secondary Header* field structure can be defined as in Figure 21.

![](https://visionspace.com/wp-content/uploads/2024/08/Picture21.png)

Figure 21: TM frame *Secondary Header* structure

The important thing here is the *Transfer Frame Secondary Header Length*, only by modifying the secondary header size the entire frame structure will change and if the secondary header data field size remains the same, we are able to change the SPI value, which is next to it, and then cause a *segfault*.

Now our payload looks like Figure 22, now we have a secondary header which his data field has 6 byte length but as we can see on the *Secondary Header Length* is only 4 bytes, changing the *SPI* value from 0x000C to 0xEEFF causing a *segfault* (see Figure 23).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture22.png)

Figure 22: Test case to demonstrate the program crash with crafted TM frame with invalid Secondary Header Length

![](https://visionspace.com/wp-content/uploads/2024/08/Picture23.png)

Figure 23: Segmentation fault arises when executing it

## SegFault on TC Frames

TC is a data link layer protocol used by space missions and for sending TC frames. This protocol has been designed to meet the requirements of space missions for efficient transfer of space application data of various types and characteristics over space-to-ground, ground-to-space, or space-to-space communications links (hereafter called space links) [4].

*SDLS-TC* standard frame structure can be defined as in Figure 24. We don’t have a secondary header or insert zone in this case. Segment Header is the new field that takes 1 byte between Primary Header where *GVCID* is saved and *Security Header*. As we will see later, the structure doesn’t change the way to approach.

![](https://visionspace.com/wp-content/uploads/2024/08/Picture24-1024x317.png)

Figure 24: TC frame structure

Figure 25 shows code from the TC decryption function called *Crypto\_TC\_ProcessSecurity* located in /src/core/crypto\_tc.c. We can see that the SPI is not checked before calling the *get\_sa\_from\_spi* function (line 904).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture25.png)

Figure 25: SPI extraction from the input frame and *sa\_get\_from\_spi* call

As the Gvcid is the only thing checked (line 882) before calling *sa\_get\_from\_spi*, we have the same vulnerability here as in AOS and TM frames (see Figure 26).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture26.png)

Figure 26: Retrieving the managed parameters with GVCID values

By changing the configuration to treat the frame as a *TC frame*, we can trigger the same vulnerability, but this time decrypting (line 58) a malicious *TC frame*. The frame is complete this time as the length is checked (line 51) (see Figure 27 and Figure 28).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture27.png)

Figure 27: Test case to demonstrate the program crash with crafted TC frame with invalid SPI

![](https://visionspace.com/wp-content/uploads/2024/08/Picture28.png)

Figure 28: Segmentation fault arises when executing it

Using the debugger to see where the dereference is done (see Figure 29), I realized that the triggered line differs from *TM* and *AOS* frames. That’s because a function checks the SA (see Figure 30) but does not check if it is valid. However, its security parameters are valid, and the *segfault* arises by making the dereference to check it (see Figure 31).

![](https://visionspace.com/wp-content/uploads/2024/08/Picture29-1024x71.png)

Figure 29: Debugger log shows the vulnerable line

![](https://visionspace.com/wp-content/uploads/2024/08/Picture30.png)

Figure 30: Function which validates SA parameters

![](https://visionspace.com/wp-content/uploads/2024/08/Picture31-1024x422.png)

Figure 31: Line where *sa\_ptr* is dereferenced

## Recommendations

Just checking if *SPI* is within the *SA* array length range before retrieving the *SA* pointer on the *get\_sa\_from\_spi()* function will be enough to remove this attack vector.

[1] [NASA CryptoLib](https://github.com/nasa/CryptoLib)
[2] [AOS Space Data Link Protocol](https://public.ccsds.org/Pubs/732x0b4.pdf)
[3] [TM Space Data Link Protocol](https://public.ccsds.org/Pubs/132x0b3.pdf)
[4] [TC Space Data Link Protocol](https://public.ccsds.org/Pubs/232x0b4c1.pdf)
[5] [SDLS](https://public.ccsds.org/Pubs/355x0b2.pdf)

[![VisionSpace](//visionspace.com/wp-content/uploads/2022/12/VISIONSPACE_WHITE.png)](https://visionspace.com/)

###### Germany

Robert-Bosch-Str 7

hello@visionspace.com

+49 (0) 6151 6292270

###### Portugal

Rua Arnaldo Sobral 49

info@visionspace.com

+351 233 094 826

###### Certifications

[![](https://visionspace.com/wp-content/uploads/2022/12/icon_ISO9001_1.png)](https://visionspace.com/wp-content/uploads/2024/07/DESTU_819943705_GenericCertificate_Final_until-11032027.pdf)

[![](https://visionspace.com/wp-content/uploads/2022/12/VISIONSPACE-PORTUGAL-516007432-Selo-TOP5-2023-150x150.png)](https://visionspace.com/wp-content/uploads/2024/07/VISIONSPACE-PORTUGAL-516007432-CERTIFICADO-TOP-5-2023.pdf)

![](https://visionspace.com/wp-content/uploads/2022/12/shutterstock_1846638856_w-1024x1024.png)

[VisionSpace Group](https://visionspace.com) © 2024. All rights reserved.

[![VisionSpace](https://visionspace.com/wp-content/uploads/2024/07/cropped-VISIONSPACE_EYE_BLACK_HR-1.png)](https://visionspace.com/)
Manage Consent

To provide the best experiences, we use technologies like cookies to store and/or access device information. Consenting to these technologies will allow us to process data such as browsing behavior or unique IDs on this site. Not consenting or withdrawing consent, may adversely affect certain features and functions.

Functional
Functional

Always active

The technical storage or access is strictly necessary for the legitimate purpose of enabling the use of a specific service explicitly requested by the subscriber or user, or for the sole purpose of carrying out the transmission of a communication over an electronic communications network.

Preferences
Preferences

The technical storage or access is necessary for the legitimate purpose of storing preferences that are not requested by the subscriber or user.

Statistics
Statistics

The technical storage or access that is used exclusively for statistical purposes.
The technical storage or access that is used exclusively for anonymous statistical purposes. Without a subpoena, voluntary compliance on the part of your Internet Service Provider, or additional records from a third party, information stored or retrieved for this purpose alone cannot usually be used to identify you.

Marketing
Marketing

The technical storage or access is required to create user profiles to send advertising, or to track the user on a website or across several websites for similar marketing purposes.

Manage options
Manage services
Manage {vendor\_count} vendors
[Read more about these purposes](https://cookiedatabase.org/tcf/purposes/)

Accept
Deny
View preferences
Save preferences
View preferences

{title}
{title}
{title}

Manage consent

