=== Content from git.kernel.org_f7e3538a_20250110_134716.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mingwei Zhang <mizhang@google.com> | 2021-09-12 18:18:15 +0000 |
| --- | --- | --- |
| committer | Paolo Bonzini <pbonzini@redhat.com> | 2021-09-22 10:33:10 -0400 |
| commit | [f1815e0aa770f2127c5df31eb5c2f0e37b60fa77](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)) | |
| tree | [915060ea1082e5a52b35b8ee7aaeea946890011a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77) | |
| parent | [bb18a677746543e7f5eeb478129c92cedb0f9658](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bb18a677746543e7f5eeb478129c92cedb0f9658) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77&id2=bb18a677746543e7f5eeb478129c92cedb0f9658)) | |
| download | [linux-f1815e0aa770f2127c5df31eb5c2f0e37b60fa77.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f1815e0aa770f2127c5df31eb5c2f0e37b60fa77.tar.gz) | |

KVM: SVM: fix missing sev\_decommission in sev\_receive\_startDECOMMISSION the current SEV context if binding an ASID fails after
RECEIVE\_START. Per AMD's SEV API, RECEIVE\_START generates a new guest
context and thus needs to be paired with DECOMMISSION:
The RECEIVE\_START command is the only command other than the LAUNCH\_START
command that generates a new guest context and guest handle.
The missing DECOMMISSION can result in subsequent SEV launch failures,
as the firmware leaks memory and might not able to allocate more SEV
guest contexts in the future.
Note, LAUNCH\_START suffered the same bug, but was previously fixed by
commit 934002cd660b ("KVM: SVM: Call SEV Guest Decommission if ASID
binding fails").
Cc: Alper Gun <alpergun@google.com>
Cc: Borislav Petkov <bp@alien8.de>
Cc: Brijesh Singh <brijesh.singh@amd.com>
Cc: David Rienjes <rientjes@google.com>
Cc: Marc Orr <marcorr@google.com>
Cc: John Allen <john.allen@amd.com>
Cc: Peter Gonda <pgonda@google.com>
Cc: Sean Christopherson <seanjc@google.com>
Cc: Tom Lendacky <thomas.lendacky@amd.com>
Cc: Vipin Sharma <vipinsh@google.com>
Cc: stable@vger.kernel.org
Reviewed-by: Marc Orr <marcorr@google.com>
Acked-by: Brijesh Singh <brijesh.singh@amd.com>
Fixes: af43cbbf954b ("KVM: SVM: Add support for KVM\_SEV\_RECEIVE\_START command")
Signed-off-by: Mingwei Zhang <mizhang@google.com>
Reviewed-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20210912181815.3899316-1-mizhang@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)

| -rw-r--r-- | [arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/sev.c?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/sev.c b/arch/x86/kvm/svm/sev.cindex 61c4bf4b3a0a87..4d68a37a8a24e3 100644--- a/[arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/sev.c?id=bb18a677746543e7f5eeb478129c92cedb0f9658)+++ b/[arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/sev.c?id=f1815e0aa770f2127c5df31eb5c2f0e37b60fa77)@@ -1404,8 +1404,10 @@ static int sev\_receive\_start(struct kvm \*kvm, struct kvm\_sev\_cmd \*argp)  /\* Bind ASID to this guest \*/ ret = sev\_bind\_asid(kvm, start.handle, error);- if (ret)+ if (ret) {+ sev\_decommission(start.handle); goto e\_free\_session;+ }  params.handle = start.handle; if (copy\_to\_user((void \_\_user \*)(uintptr\_t)argp->data, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:45:53 +0000



=== Content from git.kernel.org_0612dea2_20250110_134715.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Mingwei Zhang <mizhang@google.com> | 2021-09-12 18:18:15 +0000 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-10-07 07:53:08 +0200 |
| commit | [efd7866e114dcb44f86d151e843f8276b7efbc67](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=efd7866e114dcb44f86d151e843f8276b7efbc67) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)) | |
| tree | [1df3a5a62731fc777aa08737154f8bee3954c27e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=efd7866e114dcb44f86d151e843f8276b7efbc67) | |
| parent | [540dd9506ae0a59a5cd84c9eec348e43e1b32577](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=540dd9506ae0a59a5cd84c9eec348e43e1b32577) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=efd7866e114dcb44f86d151e843f8276b7efbc67&id2=540dd9506ae0a59a5cd84c9eec348e43e1b32577)) | |
| download | [linux-efd7866e114dcb44f86d151e843f8276b7efbc67.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-efd7866e114dcb44f86d151e843f8276b7efbc67.tar.gz) | |

KVM: SVM: fix missing sev\_decommission in sev\_receive\_startcommit f1815e0aa770f2127c5df31eb5c2f0e37b60fa77 upstream.
DECOMMISSION the current SEV context if binding an ASID fails after
RECEIVE\_START. Per AMD's SEV API, RECEIVE\_START generates a new guest
context and thus needs to be paired with DECOMMISSION:
The RECEIVE\_START command is the only command other than the LAUNCH\_START
command that generates a new guest context and guest handle.
The missing DECOMMISSION can result in subsequent SEV launch failures,
as the firmware leaks memory and might not able to allocate more SEV
guest contexts in the future.
Note, LAUNCH\_START suffered the same bug, but was previously fixed by
commit 934002cd660b ("KVM: SVM: Call SEV Guest Decommission if ASID
binding fails").
Cc: Alper Gun <alpergun@google.com>
Cc: Borislav Petkov <bp@alien8.de>
Cc: Brijesh Singh <brijesh.singh@amd.com>
Cc: David Rienjes <rientjes@google.com>
Cc: Marc Orr <marcorr@google.com>
Cc: John Allen <john.allen@amd.com>
Cc: Peter Gonda <pgonda@google.com>
Cc: Sean Christopherson <seanjc@google.com>
Cc: Tom Lendacky <thomas.lendacky@amd.com>
Cc: Vipin Sharma <vipinsh@google.com>
Cc: stable@vger.kernel.org
Reviewed-by: Marc Orr <marcorr@google.com>
Acked-by: Brijesh Singh <brijesh.singh@amd.com>
Fixes: af43cbbf954b ("KVM: SVM: Add support for KVM\_SEV\_RECEIVE\_START command")
Signed-off-by: Mingwei Zhang <mizhang@google.com>
Reviewed-by: Sean Christopherson <seanjc@google.com>
Message-Id: <20210912181815.3899316-1-mizhang@google.com>
Signed-off-by: Paolo Bonzini <pbonzini@redhat.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=efd7866e114dcb44f86d151e843f8276b7efbc67)

| -rw-r--r-- | [arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/x86/kvm/svm/sev.c?id=efd7866e114dcb44f86d151e843f8276b7efbc67) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 1 deletions

| diff --git a/arch/x86/kvm/svm/sev.c b/arch/x86/kvm/svm/sev.cindex 8baf3422ffa51e..cb166bde449bdd 100644--- a/[arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/sev.c?id=540dd9506ae0a59a5cd84c9eec348e43e1b32577)+++ b/[arch/x86/kvm/svm/sev.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/x86/kvm/svm/sev.c?id=efd7866e114dcb44f86d151e843f8276b7efbc67)@@ -1405,8 +1405,10 @@ static int sev\_receive\_start(struct kvm \*kvm, struct kvm\_sev\_cmd \*argp)  /\* Bind ASID to this guest \*/ ret = sev\_bind\_asid(kvm, start.handle, error);- if (ret)+ if (ret) {+ sev\_decommission(start.handle); goto e\_free\_session;+ }  params.handle = start.handle; if (copy\_to\_user((void \_\_user \*)(uintptr\_t)argp->data, |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:45:53 +0000


