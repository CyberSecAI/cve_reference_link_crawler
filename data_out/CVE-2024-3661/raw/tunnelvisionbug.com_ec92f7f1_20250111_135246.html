<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="UTF-8">
    
<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Introduction | TunnelVision</title>
<meta name="generator" content="Jekyll v3.10.0" />
<meta property="og:title" content="Introduction" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="A local network VPN leaking technique that affects all routing-based VPNs" />
<meta property="og:description" content="A local network VPN leaking technique that affects all routing-based VPNs" />
<link rel="canonical" href="https://www.tunnelvisionbug.com/" />
<meta property="og:url" content="https://www.tunnelvisionbug.com/" />
<meta property="og:site_name" content="TunnelVision" />
<meta property="og:type" content="website" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Introduction" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"WebSite","description":"A local network VPN leaking technique that affects all routing-based VPNs","headline":"Introduction","name":"TunnelVision","url":"https://www.tunnelvisionbug.com/"}</script>
<!-- End Jekyll SEO tag -->

    <link rel="preconnect" href="https://fonts.gstatic.com">
    <link rel="preload" href="https://fonts.googleapis.com/css?family=Open+Sans:400,700&display=swap" as="style" type="text/css" crossorigin>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="theme-color" content="#157878">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="stylesheet" href="/assets/css/style.css?v=be079aee6e0e18872514e7f1eb4a41d0d486406b">
    <!-- start custom head snippets, customize with your own _includes/head-custom.html file -->

<!-- Setup Google Analytics -->

 
<!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-6JTRL0ZRGQ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-6JTRL0ZRGQ');
</script>




<!-- You can set your favicon here -->
<!-- link rel="shortcut icon" type="image/x-icon" href="/favicon.ico" -->
<link rel="apple-touch-icon" sizes="180x180" href="https://tunnelvisionbug.com/assets/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://tunnelvisionbug.com/assets/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="https://tunnelvisionbug.com/assets/favicon-16x16.png">
<link rel="manifest" href="https://tunnelvisionbug.com/assets/site.webmanifest">
<meta property="og:title" content="TunnelVision">
<meta property="og:image" content="https://tunnelvisionbug.com/assets/TunnelVision_cn.jpg">
<meta property="og:description" content="CVE-2024-3661 - A local network VPN leaking technique that affects all routing-based VPNs">
<meta property="og:url" content="https://tunnelvisionbug.com">
<meta name="twitter:card" content="summary_large_image">
<!-- end custom head snippets -->

  </head>
  <body bgcolor="#18181B" >
    <div class="eye-div" > 
      <img class="eye" src="/assets/TunnelVision_cn.jpg"> 
    
    <header class="page-header" role="banner">
      
        <div class="description-container">
          <h1 class="project-name"> TunnelVision</h1>
          <p class="cve-tag"> CVE-2024-3661</p>
          </div>
    
    <div style="text-align: left;">
      <h2 class="project-tagline">A local network VPN leaking technique that affects all routing-based VPNs<br />Authors: <a href="https://www.linkedin.com/in/danicronce/">Dani Cronce</a> & <a href="https://www.linkedin.com/in/lmoratti/">Lizzie Moratti</a> from <a href="https://www.leviathansecurity.com/">Leviathan Security Group</a></h2>
     </div>
    
     <br />
      
      <a href="./" class="btn">Technical Advisory</a>
      <a href="./General-Public" class="btn">General Public Advisory</a>
      <a href="./faq" class="btn">FAQ</a>
      <a href="https://www.leviathansecurity.com/blog/tunnelvision" class="btn">Full blog</a>
      <a href="https://github.com/leviathansecurity/TunnelVision/" class="btn">Lab Setup</a>
      
      
    
    </header>
  </div>
    <main id="content" class="main-content" role="main">
      <div align="right" padding-left=10% >
<style>
#share-buttons {display: inline-block; vertical-align: middle; }
#share-buttons:after {content: ""; display: inline-block; clear: both;}
#share-buttons > div {
    position: relative;
    text-align: left; 
    height: 36px; 
    width: 32px; 
    float: left; 
    text-align: center;
}
#share-buttons > div > svg {height: 16px; fill: #d5d5d5; margin-top: 10px;}
#share-buttons > div:hover {cursor: pointer;}
#share-buttons > div.facebook:hover > svg {fill: #3B5998;}
#share-buttons > div.twitter:hover > svg {fill: #55ACEE;}
#share-buttons > div.linkedin:hover > svg {fill: #0077b5;}
#share-buttons > div.mail:hover > svg {fill: #7D7D7D;}
#share-buttons > div.clipboard:hover > svg {fill:#3B5998;}
#share-buttons > div.facebook > svg {height: 18px; margin-top: 9px;}
#share-buttons > div.twitter > svg {height: 20px; margin-top: 8px;}
#share-buttons > div.linkedin > svg {height: 19px; margin-top: 7px;}
#share-buttons > div.mail > svg {height: 14px; margin-top: 11px;}
#share-buttons > div.clipboard > svg {height: 20px; margin-top: 8px;}
</style>

<span style="color: silver;">Share via: </span><div id="share-buttons">
    <div class="clipboard" title="Copy via clipboard for Slack, Discord, Telegram, etc" onclick="navigator.clipboard.writeText('https://www.tunnelvisionbug.com/ A local network VPN leaking technique that affects all routing-based VPNs. CVE-2024-3661')">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 1792 1792">
            <path d="M384,320 H1408 V1664 H384 V320" stroke="#b3b3b3" stroke-width="120"/>
            <path d="M640,160 H1152 V384 H640 V160" stroke="#b3b3b3" stroke-width="120" />
            <path d="M896,128 C768,128 768,160 768,160 H1024 C1024,160 1024,128 896,128" stroke="#b3b3b3" stroke-width="120"/>
        </svg>
        
        </div>
    <div class="twitter" title="Share this on X (formerly Twitter)" onclick="window.open('https://twitter.com/intent/tweet?text=https://www.tunnelvisionbug.com/');">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 50 50">
            <path d="M 11 4 C 7.134 4 4 7.134 4 11 L 4 39 C 4 42.866 7.134 46 11 46 L 39 46 C 42.866 46 46 42.866 46 39 L 46 11 C 46 7.134 42.866 4 39 4 L 11 4 z M 13.085938 13 L 21.023438 13 L 26.660156 21.009766 L 33.5 13 L 36 13 L 27.789062 22.613281 L 37.914062 37 L 29.978516 37 L 23.4375 27.707031 L 15.5 37 L 13 37 L 22.308594 26.103516 L 13.085938 13 z M 16.914062 15 L 31.021484 35 L 34.085938 35 L 19.978516 15 L 16.914062 15 z"></path>
        </svg>        
    </div>
    <div class="linkedin" title="Share this on Linkedin" onclick="window.open('https://www.linkedin.com/shareArticle?mini=true&url=https://www.tunnelvisionbug.com/&title=&summary=&source=');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M477 625v991h-330v-991h330zm21-306q1 73-50.5 122t-135.5 49h-2q-82 0-132-49t-50-122q0-74 51.5-122.5t134.5-48.5 133 48.5 51 122.5zm1166 729v568h-329v-530q0-105-40.5-164.5t-126.5-59.5q-63 0-105.5 34.5t-63.5 85.5q-11 30-11 81v553h-329q2-399 2-647t-1-296l-1-48h329v144h-2q20-32 41-56t56.5-52 87-43.5 114.5-15.5q171 0 275 113.5t104 332.5z"/></svg></div>
    <div class="facebook" title="Share this on Facebook" onclick="window.open('http://www.facebook.com/share.php?u=https://www.tunnelvisionbug.com/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1343 12v264h-157q-86 0-116 36t-30 108v189h293l-39 296h-254v759h-306v-759h-255v-296h255v-218q0-186 104-288.5t277-102.5q147 0 228 12z"/></svg></div>
    <div class="mail" title="Share this through Email" onclick="window.open('mailto:?&body=https://www.tunnelvisionbug.com/');"><svg viewBox="0 0 1792 1792" xmlns="http://www.w3.org/2000/svg"><path d="M1792 710v794q0 66-47 113t-113 47h-1472q-66 0-113-47t-47-113v-794q44 49 101 87 362 246 497 345 57 42 92.5 65.5t94.5 48 110 24.5h2q51 0 110-24.5t94.5-48 92.5-65.5q170-123 498-345 57-39 100-87zm0-294q0 79-49 151t-122 123q-376 261-468 325-10 7-42.5 30.5t-54 38-52 32.5-57.5 27-50 9h-2q-23 0-50-9t-57.5-27-52-32.5-54-38-42.5-30.5q-91-64-262-182.5t-205-142.5q-62-42-117-115.5t-55-136.5q0-78 41.5-130t118.5-52h1472q65 0 112.5 47t47.5 113z"/></svg></div>
    
</div>

</div>
      <p>Publish Date: 5/6/2024</p>
      <h1 id="introduction">Introduction</h1>
<p>VPNs are marketed as a security service that protects users even on untrusted networks (e.g. public Wi-Fi). However, it has been known within the security industry that these claims are questionable, and small leaks have been discovered over the years. Most research has been focused on VPN servers rather than leaking client traffic on a local network.</p>

<p>Recently, a technique known as <a href="https://tunnelcrack.mathyvanhoef.com/">TunnelCrack</a> allowed attackers to leak data from a VPN. Simultaneously, we have been working on a more general technique we call “TunnelVision.”</p>

<p>TunnelVision leaks VPN traffic more simply and powerfully. We have demonstrated an attacker can leak all traffic just by being on the same local network as a VPN user.</p>

<p>From the user’s perspective, they appear as if they are connected to the VPN.</p>

<h1 id="how-tunnelvision-works">How TunnelVision Works</h1>
<p>Computers may be connected to multiple networks at once. A VPN is also a network you’re connected to. Computers decide which network they should send traffic through using a set of rules called “routing tables.”</p>

<p>An attacker on the same local network can manipulate these rules and force traffic over the wrong network. <strong>TunnelVision does not generally require compromising a DHCP server</strong>. More technical details are available on the <a href="https://www.leviathansecurity.com/blog/tunnelvision">blog post</a>.</p>

<p>From there, they can redirect traffic meant for the VPN to the local network, <em>completely bypassing the VPN.</em> Because this technique is not dependent on exploiting VPN technologies or underlying protocols, it works completely independently of the VPN provider or implementation.</p>

<p>We call this total bypass, <strong>decloaking.</strong></p>

<div class="youtube-wrapper">
    <iframe src="https://www.youtube.com/embed/ajsLmZia6UU" allowfullscreen=""></iframe>
  </div>

<h1 id="impact">Impact</h1>
<p>VPN users who expect VPNs to protect them on untrusted networks are as susceptible to the very same attacks as if they weren’t using a VPN. This is particularly dangerous for people who rely on VPNs to keep them safe such as journalists and political dissidents.</p>

<p>Luckily, most users who use commercial VPNs are sending web traffic which is mostly HTTPS (<a href="https://w3techs.com/technologies/details/ce-httpsdefault">about 85%, actually</a>). HTTPS traffic looks like gibberish to attackers using Tunnelvision, but they know who you are sending that gibberish to which can be an issue. If a website is using HTTP, then it becomes possible to view everything you are saying as well as who you are saying it to.</p>

<p>Our research challenges previous understanding of VPN technology. It also raises questions about what other technologies are impacted by routing table attacks and how this could go unnoticed for 20+ years.</p>

<h1 id="why-we-are-publishing-now">Why We Are Publishing Now</h1>
<p>We aim to raise awareness about this technique in the security and privacy communities. Since it could have been exploitable as early as 2002, it might already be in use without widespread knowledge.</p>

<p>We initially disclosed this to several VPN providers but quickly realized that it wasn’t scalable, and there were too many affected parties. We contacted the EFF and CISA and, through them, we’ve made over 50+ vendors aware of this before public release.</p>

<p>In addition, we decided to name the CVE in the hopes that a more human-readable name would extend the awareness to outside the security and privacy communities and into the general public.</p>

<h1 id="how-do-we-fix-this">How Do We Fix This</h1>
<p>Well, that’s a difficult question. VPNs were not made to secure every connection on a computer. Their purpose is to connect two local networks that normally are not connected and to secure data going over that channel. It was not meant to protect traffic on the local network, just to protect traffic after exiting to the WAN.</p>

<p>In that regard, VPNs are working as intended, local network protocols are working as intended, and the routing tables in your operating system are working as intended. Fundamentally, the public understanding of VPNs is what’s broken. This is largely due to marketing campaigns by VPN providers. </p>

<p>There is a fix on Linux operating systems through a feature called “network namespaces.” Network namespaces can segment interfaces and routing tables away from the local network’s control.</p>

<p>Other operating systems do not have a full fix available. For those operating systems, the best that a VPN provider can do is mitigate the leak. However, all mitigations we’ve observed still expose a serious issue for users who rely on total privacy of their connection, and the issue can also be abused for censorship.</p>

<p>Additionally, there might be bypasses that we have not discovered for the mitigations, so inevitably relying on using mitigations will create a “cat and mouse” game between attackers and defenders.</p>

<p>Groups primarily affected by the shortcomings of mitigations are those who commonly are the targets of surveillance or spyware, journalists, whistleblowers, and those needing to bypass censorship.</p>

<p>One could argue that the OS maintainers should implement this feature, and one could also argue that VPNs shouldn’t be advertising a feature that is impossible on many devices.</p>

<p>Ultimately, we feel that it’s a shared responsibility, and the people who suffer from this are the VPN users.</p>

<h1 id="call-to-action">Call to Action</h1>
<p>If you require the total privacy of your connection:</p>
<ol>
  <li>Do not use untrusted networks (Public WiFi)</li>
  <li>Consider using a hotspot with your VPN</li>
  <li>Consider using a VPN inside a virtual machine that does not have a bridged network adapter</li>
  <li>Use AdBlock and privacy browsers that reject tracking cookies</li>
</ol>

<p>If you are a VPN provider:</p>
<ol>
  <li>Review and update your marketing: do not claim untrusted networks can be secured by you</li>
  <li>Where possible, use network namespaces features in your product</li>
  <li>Consider host-based firewall protections to partially mitigate local network attacks</li>
</ol>

<p>If you are an operating system maintainer:</p>
<ol>
  <li>Consider implementing network namespaces if your operating system doesn’t support it.</li>
</ol>

<h1 id="prior-research">Prior Research</h1>
<p>We found research related to DHCP leaking default routes over an incorrect interface <a href="https://petsymposium.org/popets/2015/popets-2015-0006.pdf">as far back as 2015</a>.
However, it was implied that DHCP only pushed default routes and the research did not take into account DHCP option 121.</p>

<p><a href="https://www.anvilsecure.com/blog/dhcp-games-with-smart-router-devices.html">This research from Anvil Secure</a> did mention option 121, and they used this technique against attacking
smart router devices with multiple physical network interfaces. However, this was not applied to network
client devices that use a VPN which creates a virtual interface.</p>

<p>In August 2023, <a href="https://tunnelcrack.mathyvanhoef.com/#summary">TunnelCrack was published</a> demonstrating that routing rules can be attacked in different ways
to leak VPN traffic. The paper details two methods of leaking VPN traffic:</p>
<ul>
  <li>Abusing non-RFC1918 IP ranges to leak traffic.</li>
  <li>DNS spoofing the VPN server’s domain name to trick the VPN client into adding a routing rule
exception for an IP address.</li>
</ul>

<p>However, neither technique described in TunnelCrack leveraged DHCP option 121 to push
routes. Pushing routes through DHCP has a significantly higher impact from the same attacker vantage
point (the ability to hand out IP leases for a non-RFC1918 range or spoofing DNS replies).</p>

<p>In short, researchers came very close to discovering TunnelVision earlier.</p>

      
    </main>
    
    
    <footer class="site-footer">
      <span class="site-footer-credits">
        <div style="display:inline-block">
        <a href="https://www.leviathansecurity.com/"><img class="leviathan_logo" src="/assets/leviathan_logo.png"></a>
      </div>
        <div style="text-align: left; display:inline-block;padding:16px 16px 16px; color:#fff">
          <div>
            Leviathan's stance on researchers owning the rights to their work allowed us to publish this independent research on their blog while retaining ownership.
            <br />
            <br /> 
            We will forever be grateful to Leviathan for allowing us to chase our curiosity. 
        </div>
      </div>
        <br />
      </span>
    </footer>
  </body>
  
</html>
