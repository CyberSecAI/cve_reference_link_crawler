
[0](/cart)

[Skip to Content](#page)

[![Leviathan Security Group - Penetration Testing, Security Assessment, Risk Advisory](//images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png?format=1500w)](/)

[Services](/services)
[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Programs](/programs)
[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Research](/87134534-caab-4bdf-b4e2-a956a078f00a)
[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Company](/company)
[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

Open Menu
Close Menu

[![Leviathan Security Group - Penetration Testing, Security Assessment, Risk Advisory](//images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png?format=1500w)](/)

[Services](/services)
[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Programs](/programs)
[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Research](/87134534-caab-4bdf-b4e2-a956a078f00a)
[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Company](/company)
[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

Open Menu
Close Menu

[Folder:
Services](/services)

[Back](/)

[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Folder:
Programs](/programs)

[Back](/)

[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Folder:
Research](/87134534-caab-4bdf-b4e2-a956a078f00a)

[Back](/)

[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Folder:
Company](/company)

[Back](/)

[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

# **Tunnel****Vision**

## **Decloaking Route-Based VPNs**

**CVE-2024-3661**

**Identified by Lizzie Moratti and Dani Cronce**

[Technical Details](/blog/tunnelvision)

[Video Demo](https://www.youtube.com/watch?v=ajsLmZia6UU)

[Advisory](https://tunnelvisionbug.com)

## **Unmasking** VPN Vulnerabilities

Virtual Private Networks (VPNs) are often touted as a shield against cyber threats, especially when connecting to untrusted networks like public Wi-Fi. However, recent revelations within the security industry have cast doubt on these claims. Over the years, researchers have uncovered small leaks in VPNs, primarily focusing on vulnerabilities in VPN servers. But what about the client-side traffic leaking on local networks?

Enter **TunnelVision**, a powerful technique that exposes VPN traffic even when users believe they are securely connected. Let’s delve into how TunnelVision works and its impact on VPN users.

## **How** **TunnelVision** **Works**

At its core, TunnelVision exploits the way computers handle multiple network connections. When you connect to a VPN, it becomes another network interface alongside your regular connections (like your home Wi-Fi or coffee shop network). These connections are governed by routing tables—rules that determine which network should handle your traffic.

Now imagine an attacker resides on the same local network as a VPN user. They are able to manipulate these routing rules, diverting traffic away from the VPN. This means that even though you appear connected to the VPN, your data may be flowing through other networks—completely bypassing the VPN’s protection.

In essence, TunnelVision achieves **decloaking**: revealing the traffic that should otherwise be protected.

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/b133703c-c26c-48f1-95b6-8967e4d41d98/16.png)

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/1cc753d1-670b-4ec4-9470-4543b777c5d2/18.png)

## **Aftermath**

The consequences are **significant**.

VPN users who rely on these services for protection on untrusted networks are just as vulnerable as if they weren’t using a VPN at all. TunnelVision undermines the very purpose of VPNs, leaving users exposed to potential attacks.

Stay informed and take precautions. Learn more about **TunnelVision** and protect your online privacy.

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/6422a021-f5df-4646-bf4b-7eb20704f55c/4.png)

Reach out by submiting the contact form below
**For media inquiries, please contact: PR@leviathansecurity.com**

Our team will schedule some time to answer any questions you may have about the services Leviathan provides.

All fields marked with \* are required

\* First Name:

\* Last Name:

\* Email:

Phone:

\* Company:

City:

State/Province:

\* Website:

Submit

## Frequently Asked **Questions**

### How was this found?

We researched VPN threat models for a project and produced methods to attack VPNs. The team’s idea proved to be a severe issue, and we suspected it affected the entirety of the VPN industry. That’s when we began research in earnest.

### Has this been exploited in the wild?

We have not seen evidence as of 5/6/2024 of exploitation in the wild. However, we believe this was possible as far back as 2002, so it’s possible someone besides us found TunnelVision but didn’t widely disclose or realize the severity.

In order to detect this, you would need to be reviewing DHCP network traffic and DHCP client logs. This might be possible retroactively.

### Haven’t routing table leaks in VPNs been known for years?

Correct, routing table issues have been known for years. This is why the privacy and anonymity communities discourage VPNs. Most issues found have been small and patchable leaks.

### How is this novel?

We have not seen any prior research using DHCP option 121 to inject routes and decloak VPNs, which is the novel part of our research. It also is not completely patchable in the same way smaller leaks have been (besides on Linux). We pointed to prior research on this topic related to routing table issues that have been known for years that we were able to find.

UPDATE: The purpose of this research was to test this technique against modern VPN providers to determine their vulnerability and to notify the wider public of this issue. This is why we agreed with CISA to file a CVE when we disclosed to them and why we decided to name the vulnerability.

After publication, we have received details about prior research into combining routing table behavior with option 121. These researchers showed that at least some people were aware of DHCP option 121’s effect on VPNs going back to at least 2015. Despite this, the research did not lead to wide deployment of mitigations nor the general public awareness of the decloaking behavior.

That said, we are grateful for the input of past researchers who explored the problem space. We will continue to credit our fellow security researchers who explored these issues.

Prior works referencing DHCP 121 route injection or VPN decloaking:

* 2015 [Hardening OpenVPN for Def Con](https://www.agwa.name/blog/post/hardening_openvpn_for_def_con%5D)
* 2016 [Samy Kamkar’s PoisonTap](https://github.com/samyk/poisontap)
* 2017 [Jomo’s Mastodon](https://mstdn.io/%40jomo/98981403329690455)
* 2023 [Lowend talk thread](https://lowendtalk.com/discussion/188857/a-rogue-dhcp-server-within-your-network-can-and-will-hijack-your-vpn-traffic)

### Wouldn’t exploiting this be obvious?

Not really. The VPN user shows as being connected to the VPN. Attackers can control which IPs they wish to decloak, so theoretically they could choose to not decloak leak checking IPs. They could also leak DNS IPs while forwarding the traffic so the VPN connection is intact, but they obtain information about the traffic in the tunnel.

In no circumstances did we observe a VPN server disconnecting us with kill switches or other features.

### Why are you saying the mitigation’s side-channel is so impactful?

When a mitigation is in place, an attacker can still obtain the destination you are talking to and the amount of traffic you are sending to that destination. Since most web traffic is encrypted with HTTPS, attackers can usually only determine the destination and protocol of the traffic anyway. This means the vulnerability that the mitigation introduces has nearly the same impact as decloaking.

The side-channel is also flexible in use:

1. The traffic can be checked against a predefined list of IP addresses.
2. The traffic can be selectively denied as a censorship mechanism.
3. The attacker can use IP space denial with binary search to determine all current connections in logarithmic time.

### Why is this so bad compared to other leaks?

VPN providers often claim that no one, not even a network administrator, is able to remove your VPN protections. They may state it as “securing you on an untrusted network.”

TunnelVision shows that a network administrator can completely remove VPN protections. To make matters worse, we’ve demonstrated that an attacker who is on the same network has ways to control DHCP. This is demonstrated in our [POC video](https://www.youtube.com/watch?v=ajsLmZia6UU).

### Don’t most networks have widespread adoption of DHCP snooping or other protections?

Most enterprise networks do. However, most people using VPNs are not connecting from an enterprise network. They are connecting from public networks or their home networks.

In addition, part of the VPN provider threat model is they can secure *any* untrusted network, including those who do not have these protections.

### Can you change the configuration of the DHCP server in the middle of a VPN session?

Yes. By setting a short DHCP lease length, an attacker can modify the configurations in the middle of a VPN session.

### Isn’t most web traffic encrypted with HTTPS anyways?

This is true. If HTTPS traffic is decloaked it is still not possible to view the encrypted contents of the packet. For unencrypted protocols, the packet’s payload is readable.

However, it is still possible to see the destination and the protocol of the packet. Normally, that information would be inside the VPN protocol’s payload and encrypted.

### Aren’t you going to be snooping on encrypted packets?

The packets will not be encrypted. DHCP option 121 will alter your routing table and send your traffic over a non-VPN interface, completely bypassing the encryption routine VPN application processes normally do. You can’t encrypt what you never receive.

Latest Content

[![3 Pillars of Security at Day 1 Start Ups - Risk]()](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[3 Pillars of Security at Day 1 Start Ups - Risk](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[Read More →](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[![UEFI is the new BIOS]()](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

[UEFI is the new BIOS](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

Learn about UEFI reverse engineering and exploit development so that you too can build the skills necessary to find and exploit UEFI bugs, understand common UEFI vulnerabilities, and better secure the firmware security supply chain.

[Read More →](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

[![The Unexpected Benefits of Threat Modeling]()](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

[The Unexpected Benefits of Threat Modeling](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

Threat modeling is a disciplined approach to technology design that identifies security threats and design constraints to prevent security flaws before they manifest in your platform.

[Read More →](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

[![Bypassing SSRF Filters Using r3dir]()](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

[Bypassing SSRF Filters Using r3dir](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

We demonstrate how to use the r3dir tool to bypass some SSRF filters. r3dir is a convenient redirection service made for SSRF filter bypasses.

[Read More →](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

[![CVE-2024-31735: LibEvent Library Memory Leak]()](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

[CVE-2024-31735: LibEvent Library Memory Leak](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

A memory leak in the LibEvent Library v2.1.12-stable allows an attacker to cause a denial of service (DoS).

[Read More →](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

[![Vulnerability Research and the Importance of Supporting Young Talent]()](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

[Vulnerability Research and the Importance of Supporting Young Talent](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

This is a story with a happy ending where we were able to get back to the collaboration from the early open disclosure days, utilize modern practices to ensure responsible handling of the information, and allow a young person to make a positive contribution to infosec.

[Read More →](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

[![TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak]()](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

[TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

We discovered a fundamental design problem in VPNs and we're calling it TunnelVision. This problem lets someone see what you're doing online, even if you think you're safely using a VPN.

[Read More →](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

[![Encoding Bitwise Functions as Polynomials]()](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

[Encoding Bitwise Functions as Polynomials](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

Use polynomials to represent Boolean functions, see how they can be solved using generic math, analyze the properties of the representation, and use them to construct an arithmetic logic unit (ALU).

[Read More →](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

[![When You Have No Bars]()](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

[When You Have No Bars](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

A major network update failure led to a massive cellphone service outage across the US, impacting thousands and disrupting essential services. Despite cellular networks’ redundancy, the incident highlighted vulnerabilities in communication infrastructure when multiple base stations fail simultaneously.

[Read More →](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

* Services
  #### Application Security

  + [Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)
  + [Secure Code Review](/services/application-security/secure-code-review)
  #### Network Security

  + [Network Penetration Testing](/services/network-security/network-penetration-testing)
  #### Risk Advisory

  + [VCISO Services](/services/risk-advisory-services/virtual-chief-information-security-officer)
  + [Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

  #### Hardware Security

  + [Smart Device/IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

  #### Vendor Security

  + [Vendor Security Management Services](/services/vendor-security-management)
* Programs
  #### App Defense Alliance

  + [Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)
  + [Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

  #### Google Programs

  + [Nest SDM API Assessment](/programs/google-nest-security-assessment)

  #### Shopify Programs

  + [Shopify Plus Certified App Assessment](/shopify-plus-certified)
* Research
  + [TunnelVision](/research/tunnelvision)
  + [LibEvent CVE-2024-31735](/blog/cve-2024-31735-libevent-library-memory-leak)
* Blog
  #### Featured

  [![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/1714397721412-K7KKE0AMAP8OI38VO0I3/TunnelVision_No_Light_At_The_End_of_The_Tunnel?format=300w?format=300w)](https://www.leviathansecurity.com/blog/tunnelvision)

  [TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak](https://www.leviathansecurity.com/blog/tunnelvision)

  #### Categories

  + [Risk Advisory](/blog/category/Risk%2BAdvisory)
  + [Application Security](/blog/category/Application%2BSecurity)
  + [Network Security](/blog/category/Network%2BSecurity)
  + [Enterprise Security](/blog/category/Enterprise%2BSecurity)
  + [Hardware Security](/blog/category/Hardware%2BSecurity)
  + [View All Blog Posts](/blog)
* Company
  + [Press Box](/press-box)
  + [Careers](/careers)
  + [About Us](/about-us)
  + [Privacy Policy](/privacy-policy)

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png)

#### Services

[Web Application Penetration Testing](https://www.leviathansecurity.com/services/application-security/web-application-penetration-testing)

[Secure Code Review](https://www.leviathansecurity.com/services/application-security/secure-code-review)

[Network Penetration Testing](https://www.leviathansecurity.com/services/network-security/network-penetration-testing)

[VCISO Services](https://www.leviathansecurity.com/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](https://www.leviathansecurity.com/services/risk-advisory-services/tabletop-exercises)

[Smart Device/IoT Security Assessment](https://www.leviathansecurity.com/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security Management Services](https://www.leviathansecurity.com/services/vendor-security-management)

#### Programs

[Cloud Application Security Assessment (CASA)](https://www.leviathansecurity.com/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](https://www.leviathansecurity.com/programs/google-masa-mobile-application-security-assessment)

[Nest SDM API Assessment](https://www.leviathansecurity.com/programs/google-nest-security-assessment)

[Shopify Plus Certified Assessment](/shopify-plus-certified)

#### Research

[TunnelVision](https://www.leviathansecurity.com/research/tunnelvision)

[LibEvent CVE-2024-31735](/blog/cve-2024-31735-libevent-library-memory-leak)

#### Blog

[Risk Advisory](https://www.leviathansecurity.com/blog/category/Risk%2BAdvisory)

[Application Security](https://www.leviathansecurity.com/blog/category/Application%2BSecurity)

[Network Security](https://www.leviathansecurity.com/blog/category/Network%2BSecurity)

[Enterprise Security](https://www.leviathansecurity.com/blog/category/Enterprise%2BSecurity)

[Hardware Security](https://www.leviathansecurity.com/blog/category/Hardware%2BSecurity)

[View All Blog Posts](https://www.leviathansecurity.com/blog)

#### Company

[Press Box](https://www.leviathansecurity.com/press-box)

[Careers](https://www.leviathansecurity.com/careers)

[About Us](https://www.leviathansecurity.com/about-us)

[Privacy Policy](https://www.leviathansecurity.com/privacy-policy)

[Contact Us](/contact)

