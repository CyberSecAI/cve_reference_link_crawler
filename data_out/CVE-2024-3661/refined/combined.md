=== Content from news.ycombinator.com_66b4b1db_20250111_135243.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D40284111) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Novel attack against virtually all VPN apps neuters their entire purpose](https://arstechnica.com/security/2024/05/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose/) ([arstechnica.com](from?site=arstechnica.com)) | | --- | --- | --- | |  | | 204 points by [quibuss](user?id=quibuss) [8 months ago](item?id=40284111)  | [hide](hide?id=40284111&goto=item%3Fid%3D40284111) | [past](https://hn.algolia.com/?query=Novel%20attack%20against%20virtually%20all%20VPN%20apps%20neuters%20their%20entire%20purpose&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=40284111&auth=d649c524e8eb65f69a199acbd215611d618bf880) | [76 comments](item?id=40284111) |  | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40284312)   | [next](#40284628) [–]  I mentioned attacks using DHCP option 121 (aka "classless static routes") nearly 9 years ago in my blog post about attacks on OpenVPN: [https://www.agwa.name/blog/post/hardening\_openvpn\_for\_def\_co...](https://www.agwa.name/blog/post/hardening_openvpn_for_def_con) (under "Attacks on redirect-gateway") It's really hard to make a robust VPN. | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [JeremyNT](user?id=JeremyNT) [8 months ago](item?id=40287317)   | [parent](#40284312) | [next](#40284904) [–]  Your writeup is IMO much better than the way this is being reported. FWIW, I remember reading something similar years ago (I'm not certain it was your specific post, but it might have been). It's strange to see this being described as "novel" now, unless there's something new to it that I am missing. | | --- | --- | --- | | | |  |  | [mycall](user?id=mycall) [8 months ago](item?id=40284904)   | [parent](#40284312) | [prev](#40287317) | [next](#40284628) [–]  How hard is it for a firewall to block option 121 (and 33)? Cloudflare WARP made a robust VPN but is not cheap. | | --- | --- | --- | | | |  |  | [gruez](user?id=gruez) [8 months ago](item?id=40285603)   | [root](#40284312) | [parent](#40284904) | [next](#40284950) [–]  It's probably more straightforward to have the firewall block all traffic from using the non-VPN interfaces (ie. blacklist approach) instead. In the other thread[1] there was disagreement about whether commercial VPN services actually implement their 'killswitch" in this way. Apparently NordVPN does not (hearsay), but neither side provided a good survey of other providers. [1] <https://news.ycombinator.com/item?id=40279632> | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40284950)   | [root](#40284312) | [parent](#40284904) | [prev](#40285603) | [next](#40301769) [–]  Ignoring or blocking these options is trivial but ineffective since the DHCP server can still send a malicious subnet mask. (Edited to replace "default gateway" with "subnet mask") | | --- | --- | --- | | | |  |  | [peddling-brink](user?id=peddling-brink) [8 months ago](item?id=40285478)   | [root](#40284312) | [parent](#40284950) | [next](#40301769) [–]  Forgive my ignorance, but what could a malicious gateway do in this instance? | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40285564)   | [root](#40284312) | [parent](#40285478) | [next](#40301769) [–]  Whoops, I posted too early in the morning, I meant to say "malicious subnet mask" :-) Basically, the DHCP server sends a subnet mask for an absolutely huge subnet (e.g. a /2), and the route for that subnet takes precedence over the VPN route. The attacker can only intercept 25% of the IPv4 address space with a /2 but that's still pretty bad. | | --- | --- | --- | | | |  |  | [peddling-brink](user?id=peddling-brink) [8 months ago](item?id=40290768)   | [root](#40284312) | [parent](#40285564) | [next](#40301769) [–]  Clever, thanks! | | --- | --- | --- | | | |  |  | [felixg3](user?id=felixg3) [8 months ago](item?id=40301769)   | [root](#40284312) | [parent](#40284904) | [prev](#40284950) | [next](#40284628) [–]  Cloudflare Warp is free, I think - if you create a Zero Trust Organisation for free and configure the Warp client to use it, you can use unmetered Warp+ with Argo routing without charge. | | --- | --- | --- | | | |  |  | [dmm](user?id=dmm) [8 months ago](item?id=40284628)   | [prev](#40284312) | [next](#40285079) [–]  Would isolating a Wireguard interface using namespaces as described here[0] mitigate this? [0] <https://www.wireguard.com/netns/#the-new-namespace-solution> | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40285027)   | [parent](#40284628) | [next](#40285079) [–]  Yes, namespaces are the gold standard solution. | | --- | --- | --- | | | |  |  | [bscphil](user?id=bscphil) [8 months ago](item?id=40285566)   | [root](#40284628) | [parent](#40285027) | [next](#40285079) [–]  In addition, wg-quick appears to use the rule-based solution with multiple tables by default. As I understand it this should make Wireguard (with wg-quick) users on Linux immune to this attack. My default route sends traffic to my gateway, not my VPN: ```     default via <gateway ip> dev host0 proto static  ``` So there's nothing for an attacker to do here. They could make themselves my gateway perhaps, but the `ip rule` would still send my traffic to Wireguard and the result would not be readable. The issue described in the article is what happens if you take the most basic approach, which is described in the Wireguard article: "instead of replacing the default route, we can just override it with two more specific rules that add up in sum to the default, but match before the default". This is historically what OpenVPN has done, and it's vulnerable to this issue. | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40285693)   | [root](#40284628) | [parent](#40285566) | [next](#40285079) [–]  In general, rule-based solutions are good if they use fwmark, but this gives me pause: > And finally we add a convenience feature for still accessing the local network, whereby we allow packets without the fwmark to use the main routing table, not the WireGuard interface's routing table, if it matches any routes in it with a prefix length greater than zero, such as non-default local routes. [<https://www.wireguard.com/netns/#improved-rule-based-routing>] Doesn't that completely neutralize the protection against a DHCP server sending malicious routes or a gigantic subnet mask? | | --- | --- | --- | | | |  |  | [zokier](user?id=zokier) [8 months ago](item?id=40289244)   | [root](#40284628) | [parent](#40285693) | [next](#40285079) [–]  its just a default convenience feature from wg-quick, its not intended to be something that fits all usecases; on trusted networks split-tunneling like that makes lot of sense | | --- | --- | --- | | | |  |  | [fxtentacle](user?id=fxtentacle) [8 months ago](item?id=40285079)   | [prev](#40284628) | [next](#40284745) [–]  "there are no ways to prevent such attacks except when the user's VPN runs on Linux or Android" I guess it really is the year of the Linux desktop :) | | --- | --- | --- | | | |  |  | [51Cards](user?id=51Cards) [8 months ago](item?id=40285161)   | [parent](#40285079) | [next](#40285671) [–]  Sadly, I've read similar comments for 10+ years now and yet, here we still are. | | --- | --- | --- | | | |  |  | [999900000999](user?id=999900000999) [8 months ago](item?id=40285711)   | [root](#40285079) | [parent](#40285161) | [next](#40285626) [–]  Do we want Linux going mainstream? Do you want every distro turning into Ubuntu with cloud services and telemetry all over the place ? | | --- | --- | --- | | | |  |  | [anthk](user?id=anthk) [8 months ago](item?id=40286428)   | [root](#40285079) | [parent](#40285711) | [next](#40285626) [–]  As long as Trisquel, Hyperbola or Guix exist, who cares. | | --- | --- | --- | | | |  |  | [Zuiii](user?id=Zuiii) [8 months ago](item?id=40293682)   | [root](#40285079) | [parent](#40286428) | [next](#40285626) [–]  > who cares. Oh most of us will definitely care once linux developers start targeting the Ubuntus instead of the Trisquels (like how developers now target "android" instead of AOSP). I mean just look at how Gnome behaves now that it is the default DE. A truly mainstream distro would be the death of the Linux desktop. I hope that year never comes. | | --- | --- | --- | | | |  |  | [anthk](user?id=anthk) [8 months ago](item?id=40295824)   | [root](#40285079) | [parent](#40293682) | [next](#40285626) [–]  As long as the code is libre, the Ubuntu LTS releases will perfectly map the Trisquel ones. Today, if some service needs propietary code, it's doomed to rot. For firmware with desktop users and programmers/devops using Ubuntu at work -not an issue on servers- , it's preferable to use the Xanmod kernel with Trisquel than falling into thw whole cascade of propietary code in Ubuntu. At least nonfree firmware it's a non burnt hardware ROM; that setup it's 90% free according to the FSF values. Also, you don't get overlayed taxing crap as snaps. | | --- | --- | --- | | | |  |  | [rokkitmensch](user?id=rokkitmensch) [8 months ago](item?id=40285626)   | [root](#40285079) | [parent](#40285161) | [prev](#40285711) | [next](#40285671) [–]  Don't worry: Apples desktop quality is degrading so quickly it will be The Year of Linux on the Desktop by the end of the decade! | | --- | --- | --- | | | |  |  | [coldtea](user?id=coldtea) [8 months ago](item?id=40285671)   | [parent](#40285079) | [prev](#40285161) | [next](#40286184) [–]  So, it sounds like something that can be trivially implemented just as well on Windows, macOS, iOS, and xBSD? If Linux can do it, why not the others? | | --- | --- | --- | | | |  |  | [zokier](user?id=zokier) [8 months ago](item?id=40289183)   | [root](#40285079) | [parent](#40285671) | [next](#40286184) [–]  I'd imagine on openbsd rdomains might help here, but I'm not openbsd guru | | --- | --- | --- | | | |  |  | [anon84873628](user?id=anon84873628) [8 months ago](item?id=40286184)   | [parent](#40285079) | [prev](#40285671) | [next](#40284745) [–]  And yet the article goes on to say that Linux doesn't fully mitigate the issue. Confusing. | | --- | --- | --- | | | |  |  | [alexpc201](user?id=alexpc201) [8 months ago](item?id=40287221)   | [root](#40285079) | [parent](#40286184) | [next](#40284745) [–]  Linux doesn’t mitigate it out of the box, but you can do this: <https://www.wireguard.com/netns/#the-new-namespace-solution> | | --- | --- | --- | | | |  |  | [this\_user](user?id=this_user) [8 months ago](item?id=40284745)   | [prev](#40285079) | [next](#40285154) [–]  The real problem with all of this is that DHCP has a lot of weird legacy options that most people are not aware off and that may or may not be fully implemented on most clients, but some of which that are pretty powerful. And in practice, clients trust DHCP servers implicitly, because it's an old protocol that didn't really consider the possibility that you may be on a LAN where the DHCP cannot be trusted. | | --- | --- | --- | | | |  |  | [agwa](user?id=agwa) [8 months ago](item?id=40285018)   | [parent](#40284745) | [next](#40285154) [–]  That's not really the problem - DHCP's subnet mask option is definitely not weird or legacy but can also be used to execute these attacks. The real problem is that encrypted packets from the VPN client use the same routing table as unencrypted packets from applications. This makes it very difficult to create a robust routing policy that says "all unencrypted packets are routed via the VPN, and all encrypted packets are routed via the physical network interface". | | --- | --- | --- | | | |  |  | [zokier](user?id=zokier) [8 months ago](item?id=40289167)   | [root](#40284745) | [parent](#40285018) | [next](#40285154) [–]  > The real problem is that encrypted packets from the VPN client use the same routing table as unencrypted packets from applications worth noting that this really is very dependent on the specifics of your VPN implementation. For example StrongSwan (ipsec) and WireGuard by default afaik use separate route tables. In general using separate route tables for virtual vs physical networks is not exactly rocket science. | | --- | --- | --- | | | |  |  | [jacob019](user?id=jacob019) [8 months ago](item?id=40285154)   | [prev](#40284745) | [next](#40287027) [–]  It seems that this is only an issue if there is a malicious actor present on the remote network. I've always considered VPN services to be snakeoil, and this doesn't really seem like a problem with VPN technology at all. If you are connecting to an untrusted network, then you are at risk. This has always been true. From the VPN service providers perspective, can't this be mitigated by blocking direct traffic between clients? | | --- | --- | --- | | | |  |  | [WirelessGigabit](user?id=WirelessGigabit) [8 months ago](item?id=40289579)   | [parent](#40285154) | [next](#40285437) [–]  But VPNs are sold as the solution for when you are on an untrusted network, like at Starbucks. But, because of this someone can have a Pineapple with a Starbucks SSID, push option 121 and capture a WHOLE bunch of traffic, even though the person using it has configured NordVPN on their iPhone with the killswitch on. | | --- | --- | --- | | | |  |  | [ang\_cire](user?id=ang_cire) [8 months ago](item?id=40293295)   | [root](#40285154) | [parent](#40289579) | [next](#40285437) [–]  My VPN is for my tunnel out of my home network, not for remote networks. This is definitely a major issue if mitigations aren't implemented, but it's not relevant to all use cases for VPNs. | | --- | --- | --- | | | |  |  | [bscphil](user?id=bscphil) [8 months ago](item?id=40285437)   | [parent](#40285154) | [prev](#40289579) | [next](#40287027) [–]  > It seems that this is only an issue if there is a malicious actor present on the remote network. As I understand it, the problem comes not from the remote network provided by the VPN, but by the local network - the physical link over which the user accesses the Internet. | | --- | --- | --- | | | |  |  | [jacob019](user?id=jacob019) [8 months ago](item?id=40285694)   | [root](#40285154) | [parent](#40285437) | [next](#40285616) [–]  Ah, thanks for explaining. So this is only an issue if there is a malicious actor present on the local network. I would say that you are already compromised at that point. Say you are using public WIFI, a VPN service is pointless, you already have an anonymous public IP. Anything sensitive is encrypted end-to-end. And most public WIFI has client isolation. I suppose it could be a problem in certain countries, if your ISP can find out that you're visiting banned sites with a VPN. | | --- | --- | --- | | | |  |  | [gruez](user?id=gruez) [8 months ago](item?id=40285616)   | [root](#40285154) | [parent](#40285437) | [prev](#40285694) | [next](#40287027) [–]  eg. malicious wifi hotspot | | --- | --- | --- | | | |  |  | [gz5](user?id=gz5) [8 months ago](item?id=40287027)   | [prev](#40285154) | [next](#40284433) [–]  Encapsulate and encrypt in the app itself, or in the browser. App (via the openziti sdk): <https://blog.openziti.io/no-listening-ports> Browser (the openziti js sdk loads on the fly): <https://blog.openziti.io/introducing-openziti-browzer> Disclosure: openziti (apache v2) maintainer | | --- | --- | --- | | | |  |  | [russfink](user?id=russfink) [8 months ago](item?id=40287280)   | [parent](#40287027) | [next](#40284433) [–]  Agree. The stated attack is not against an end to end solution. | | --- | --- | --- | | | |  |  | [londons\_explore](user?id=londons_explore) [8 months ago](item?id=40284433)   | [prev](#40287027) | [next](#40285904) [–]  It's because networks/routing tables aren't really designed with security principles in mind. If they were, it would be a simple setting to set an ACL on the network interface to say "DENY all traffic except from VPN application". | | --- | --- | --- | | | |  |  | [ta1243](user?id=ta1243) [8 months ago](item?id=40284614)   | [parent](#40284433) | [next](#40289203) [–]  You seem to be conflating routing and firewalling/access control. You can control your routing table using standard tools (ip route add). You can have helper applications work on it, and get hints from external sources like dhcp, where you can listen to its suggestions (IP, subnet, DNS, extra routes, and other options), or ignore them. If you take those hints then that's your choice. With icmp redirects you can choose to allow them or not with settings like net.ipv4.conf.all.accept\_redirects. Then as a belt and braces you have iptables. If you want an ACL on the network interface to say "DENY all traffic except from VPN application", then set your input/output/forward chains to default deny and have a rule to allow from pid=$vpn\_pid. I believe you can use pid in pre/postrouting chains. Personally when I'm travelling I have rules which only allow access to my vpn targets, and from memory just DHCP and arp. Have to temporarily disable it for captive portals but then it's back on. Sometimes a network won't accept UDP, so I generally have to tether for normal response. | | --- | --- | --- | | | |  |  | [zokier](user?id=zokier) [8 months ago](item?id=40289203)   | [parent](#40284433) | [prev](#40284614) | [next](#40285904) [–]  It is pretty simple to set routing like that on Linux. | | --- | --- | --- | | | |  |  | [flufluflufluffy](user?id=flufluflufluffy) [8 months ago](item?id=40285904)   | [prev](#40284433) | [next](#40284695) [–]  Not my area of expertise — can somebody clarify if the DHCP server runs on your router, or your local machine? The article keeps mentioning it needs to be on the “same network” but the graphic seems like it’s all on one device. edit: ahh I’m dumb, it’s the router (correct me if I’m wrong!). So as others have said, you have to already be on a compromised network, yes? | | --- | --- | --- | | | |  |  | [numpad0](user?id=numpad0) [8 months ago](item?id=40286883)   | [parent](#40285904) | [next](#40286090) [–]  DHCP is bit like hotel front and key slip. When a laptop connects to a Wi-Fi, it broadcasts DHCPDISCOVER message using the Wi-Fi card's MAC address, to which local DHCP server responds with IP address + option strings, such as subnet mask, gateway IP, local timezone(but not time), local X Window Manager address, network FQDN, and so on. Every consumer Wi-Fi router has DHCP server program included and set to auto configure, and that is how it's normally operated, but technically multiple servers can coexist within the same subnet, and the server computer doesn't have to be itself the default gateway. Among the options strings that DHCP server may provide is DHCP option 121 Classless Static Routes, added in 2002, that can "push" routing information to clients for convenience. Apparently this option 121 can be abused to trick your laptop into set and prioritize `route add [google.com] via [malicious\_host] dev wlan0` over `route add [google.com] via [vpn\_right] dev vpn0` which routes traffic to [google.com], or 0.0.0.0/0 for that matter, through [malicious\_host]. DHCP is more of a convenience feature for private IP address LANs, not strictly necessary for operating IP LAN. I've heard generations prior to ours sometimes leased clothespins labeled with IPs off the wall to guests, along instruction papers. DHCP completely automates that. | | --- | --- | --- | | | |  |  | [tithe](user?id=tithe) [8 months ago](item?id=40286090)   | [parent](#40285904) | [prev](#40286883) | [next](#40284695) [–]  DHCP is a client-server protocol, so it "runs" both on the router (as a server program vending available IP addresses) and the local machine (as a client program initiating the request for an IP address, and ultimately accepting the given IP address from the DHCP server on the router). | | --- | --- | --- | | | |  |  | [jaggs](user?id=jaggs) [8 months ago](item?id=40284695)   | [prev](#40285904) | [next](#40284820) [–]  Android phones running VPNs are apparently still secure. They're recommending using phone as hotspots if you can. | | --- | --- | --- | | | |  |  | [gipsies](user?id=gipsies) [8 months ago](item?id=40284820)   | [prev](#40284695) | [next](#40284591) [–]  There needs to be extra evidence before claiming that "virtually all VPNs apps" are vulnerable. From my understanding, they tested WireGuard on multiple platforms. However, other VPN clients may install extra firewall rules, I've seen that happen with VPNs on Windows/macOS/Linux. | | --- | --- | --- | | | |  |  | [avsteele](user?id=avsteele) [8 months ago](item?id=40284591)   | [prev](#40284820) | [next](#40285842) [–]  So every company who uses VPNs to allow their people to get into the network from offsite (customer site, airport, hotel) now can't safely? You basically have to trust everyone on the remote LAN to not act like a malicious DHCP server. Reading the other thread, this wouldn't even be just the gateway.. Sounds bad! | | --- | --- | --- | | | |  |  | [skywhopper](user?id=skywhopper) [8 months ago](item?id=40284706)   | [parent](#40284591) | [next](#40284949) [–]  Presumably most corporate VPNs are used to access specific resources on internal company networks, so if you were affected by this, those resources would fail to load entirely. But also, if you were using more specific routes for your corporate VPN traffic and not just forwarding all traffic through it, then the simple attack of sending two /1 rules wouldn’t interfere. You’d still leak some metadata, but you leak a lot by using public networks anyway. | | --- | --- | --- | | | |  |  | [dspillett](user?id=dspillett) [8 months ago](item?id=40284949)   | [parent](#40284591) | [prev](#40284706) | [next](#40284606) [–]  *> You basically have to trust everyone on the remote LAN to not* More than that when connecting via WiFi as almost everyone on a laptop does these days: you have to be careful of “evil twin” attacks from random APs nearby. Though if you are accessing a VPN to get access to internal network resources, and someone uses this hack to redirect you, you are not going to see those resources anyway and you'll know something is wrong. Accessing any insecure resources is a risk (HTTP traffic can be monitored, fake servers could collect authentication credentials such as SSH user+pass info if not using key-based auth) but only if they are otherwise public because your redirected connection won't be able to route to your corporate network's internal hosts. Unless I'm misreading (possible, I've only skimmed the details) those using VPNs because they already don't trust their outgoing connection, or are otherwise wanting to disguise their ID and/or location, are more at risk than road-worriers (or these days “home warriors” more likely) connecting to DayJob's VPN. | | --- | --- | --- | | | |  |  | [djbusby](user?id=djbusby) [8 months ago](item?id=40285275)   | [root](#40284591) | [parent](#40284949) | [next](#40284606) [–]  When I connect on SSH it verify the host-key. So, that would warn before submitting user/pass (but also, user-key should be used) | | --- | --- | --- | | | |  |  | [dspillett](user?id=dspillett) [8 months ago](item?id=40297032)   | [root](#40284591) | [parent](#40285275) | [next](#40284606) [–]  If doing SSH properly, yes. Though for new hosts people often don't verify the initial host key at all, just blindly accepting it, so that would be an extra risk vector. Heck, I'm sure many don't bother verifying a new key when they get the warning, instead just removing the old from .ssh/known\_hosts (or equivalent) to quiet the complaining! Though to be honest, with that security posture nothing is going to save them and our efforts are better spent securing others! I know at least one of our clients has automated systems that ignore key changes, because we once had a temporary config cockup that sent some connections to a host with the wrong key and some data was received there without any reported issues… | | --- | --- | --- | | | |  |  | [prmoustache](user?id=prmoustache) [8 months ago](item?id=40284606)   | [parent](#40284591) | [prev](#40284949) | [next](#40285337) [–]  On the other hand, it is fairly easy to obtain an ip, change your config to static ip reusing same ip, then and only then connect to the VPN. | | --- | --- | --- | | | |  |  | [mschuster91](user?id=mschuster91) [8 months ago](item?id=40284616)   | [root](#40284591) | [parent](#40284606) | [next](#40297317) [–]  It's incredibly brittle. The more frequented a network is the shorter the DHCP leases will be, I've seen public hotspots with 10 minutes of lease time. | | --- | --- | --- | | | |  |  | [prmoustache](user?id=prmoustache) [8 months ago](item?id=40284725)   | [root](#40284591) | [parent](#40284616) | [next](#40297317) [–]  That doesn't mean the dhcp reuse the ip if it sees it used. Some old clients do not behave correctly and I believe DHCP servers take that into account. | | --- | --- | --- | | | |  |  | [dspillett](user?id=dspillett) [8 months ago](item?id=40297317)   | [root](#40284591) | [parent](#40284606) | [prev](#40284616) | [next](#40285337) [–]  “Fairly easy” for those of us with a technical background. I'm not volunteering to explain that to the CEO when he hears about this and asks how he can access internal company resources safely while mobile! | | --- | --- | --- | | | |  |  | [jacob019](user?id=jacob019) [8 months ago](item?id=40285337)   | [parent](#40284591) | [prev](#40284606) | [next](#40285842) [–]  They could send a /32 route for a single IP, just to decloak you. | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40285842)   | [prev](#40284591) | [next](#40300812) [–]  Attack assumes that someone already controls DHCP. If bad actor controls DHCP you have a bigger problem. | | --- | --- | --- | | | |  |  | [mehdix](user?id=mehdix) [8 months ago](item?id=40287025)   | [parent](#40285842) | [next](#40285932) [–]  It's a common scenario. Bars, coffee shops, trains, universities, etc. all offer free public wifi with DHCP outside your control. | | --- | --- | --- | | | |  |  | [pid-1](user?id=pid-1) [8 months ago](item?id=40285932)   | [parent](#40285842) | [prev](#40287025) | [next](#40286604) [–]  If one is working from a non trusted network (idk, a coffee shop), isn't that true? | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40286048)   | [root](#40285842) | [parent](#40285932) | [next](#40286604) [–]  I would break it down in two parts. 1. Coffee shop Wi-Fi router is compromised. Than that's a possible vector. 2. Bad actor sitting in the coffee shop and trying to carry out attack similar to the one described on the link. Fortunately that won't work on any decent WiFi infra from Meraki, Ubiquiti or similar. DHCP attacks are always a problem on dumb wired switches though. | | --- | --- | --- | | | |  |  | [ls612](user?id=ls612) [8 months ago](item?id=40286709)   | [root](#40285842) | [parent](#40286048) | [next](#40286604) [–]  Are there workarounds VPN clients can use to prevent this attack from working (or in the worst case, disconnect rather than send traffic outside the tunnel on a hostile network)? | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40289910)   | [root](#40285842) | [parent](#40286709) | [next](#40286604) [–]  Yes. On Linux there are methods to put VPN in a namespace and thus avoid the issue. | | --- | --- | --- | | | |  |  | [digitalsushi](user?id=digitalsushi) [8 months ago](item?id=40286604)   | [parent](#40285842) | [prev](#40285932) | [next](#40286984) [–]  If you dont run your network, you should assume there is a bad actor. Many wifi/router combos have a password of 'admin' or just as easy. Even if the coffee shop giving you wifi is innocent, the person that reconfigured their network in 10 seconds might not be. | | --- | --- | --- | | | |  |  | [russfink](user?id=russfink) [8 months ago](item?id=40287315)   | [root](#40285842) | [parent](#40286604) | [next](#40286984) [–]  But the coffee shop is not offering VPN services, at least none that I would accept. | | --- | --- | --- | | | |  |  | [ambichook](user?id=ambichook) [8 months ago](item?id=40293177)   | [root](#40285842) | [parent](#40287315) | [next](#40286984) [–]  but you're using a vpn *at* the coffee shop for privacy reasons, and the compromised dhcp server will allow a malicious actor to read all of your packets anyway | | --- | --- | --- | | | |  |  | [numpad0](user?id=numpad0) [8 months ago](item?id=40286984)   | [parent](#40285842) | [prev](#40286604) | [next](#40285975) [–]  DHCP servers aren't connected to any IP routing mechanisms, so there can be arbitrary numbers of so long there aren't duplicate assignments(but even that isn't DHCP problem). IIRC the client randomly chooses one if multiple offers were received. | | --- | --- | --- | | | |  |  | [harveyrook](user?id=harveyrook) [8 months ago](item?id=40285975)   | [parent](#40285842) | [prev](#40286984) | [next](#40286997) [–]  Doesn't this blow up the attack surface area to any isp and to any place that offers free wifi? With this attack, I can't assume that it's safe to bring my laptop to a coffee shop and enable the VPN. | | --- | --- | --- | | | |  |  | [whyleyc](user?id=whyleyc) [8 months ago](item?id=40286997)   | [parent](#40285842) | [prev](#40285975) | [next](#40300812) [–]  It's worse than that - an attacker on the same local network as the target machine can tie up the legitimate DHCP server by reserving all available addresses and then start advertising themselves as an alternate DHCP server (to inject the malicious routing to the target). | | --- | --- | --- | | | |  |  | [PeterStuer](user?id=PeterStuer) [8 months ago](item?id=40300812)   | [prev](#40285842) | [next](#40291764) [–]  My VPN provider claims I'm not vulnerable to this by default (running this VPN endpoint on a spare ASUS Router ([https://www.expressvpn.com/blog/tunnelvision-expressvpns-sta...](https://www.expressvpn.com/blog/tunnelvision-expressvpns-statement-and-assessment-of-the-technique/)) | | --- | --- | --- | | | |  |  | [username135](user?id=username135) [8 months ago](item?id=40291764)   | [prev](#40300812) | [next](#40286053) [–]  One thing ive seen overlooked is the mention of trusted vs untrusted networks. | | --- | --- | --- | | | |  |  | [yencabulator](user?id=yencabulator) [8 months ago](item?id=40286053)   | [prev](#40291764) | [next](#40295710) [–]  Adding routes via DHCP does nothing to my VPN that is activated by fwmark. | | --- | --- | --- | | | |  |  | [M95D](user?id=M95D) [8 months ago](item?id=40295710)   | [prev](#40286053) | [next](#40285794) [–]  TLDR explanation: - User connects to an untrusted network (public wifi). - That network uses DHCP to assign IP address for the user. - A malicious DHCP would push static routes via DHCP that are more specific than a common default route, and send traffic via a malicious gateway. - User connects to his/her VPN thinking his/her traffic is secured over the insecure network. - The malicious static routes, being more specific, take precedence over the default route added by the VPN. | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40285794)   | [prev](#40295710) | [next](#40284763) [–]  Wait til they learn you can initiate booting the whole OS through DHCP + tftp. | | --- | --- | --- | | | |  |  | [blueflow](user?id=blueflow) [8 months ago](item?id=40286877)   | [parent](#40285794) | [next](#40284763) [–]  All of which has been common knowledge for network admins 20 years ago. Where did we go wrong? | | --- | --- | --- | | | |  |  | [bell-cot](user?id=bell-cot) [8 months ago](item?id=40284763)   | [prev](#40285794) | [next](#40284403) [–]  And yet another time when a strict policy of "Always Ban the OhSoCoolConvenientKludgeTech for anything that could matter" turns out to look like a genius move. :( | | --- | --- | --- | | | |  |  | [hifromwork](user?id=hifromwork) [8 months ago](item?id=40285296)   | [parent](#40284763) | [next](#40284403) [–]  I don't understand your comment, can you explain? What is the "OhSoCoolConvenientKludgeTech" that should be banned in this case? VPN? | | --- | --- | --- | | | |  |  | [bell-cot](user?id=bell-cot) [8 months ago](item?id=40286075)   | [root](#40284763) | [parent](#40285296) | [next](#40284403) [–]  I was thinking of DHCP - though the VPN tech certainly doesn't look good either. | | --- | --- | --- | | | |  |  | [yaris](user?id=yaris) [8 months ago](item?id=40284403)   | [prev](#40284763) [–]  Dupe? <https://news.ycombinator.com/item?id=40279632> | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |



=== Content from www.agwa.name_86d37bf7_20250111_135246.html ===


[Skip to Content [alt-c]](#content)

# [Andrew Ayer](/)

## Sections

* [Blog](/blog/)
* [Projects](/projects/)
* [Photos](/photos/)
## Blog

* [Latest](/blog/)
* [Popular](/blog/popular)
* [Archives](/blog/index)
* [RSS](/blog/feed)

August 7, 2015

## Hardening OpenVPN for DEF CON

As people head off to DEF CON this week, many are probably relying on
[OpenVPN](https://openvpn.net/index.php/open-source.html)
to safely tunnel their Internet traffic through "the world's most hostile network"
back to an ordinarily hostile network.
While I believe OpenVPN itself to be quite secure, the way in which
it interacts with the operating system to route your traffic is quite
unrobust and can be subverted in numerous ways on a hostile local area
network. This article will describe some of the problems and suggest
countermeasures. The article is Linux-centric, since I'm
most familiar with Linux, but many of these concerns apply to other operating
systems as well.

#### IPv6

Unless you explicitly configure your OpenVPN tunnel to support IPv6
(which is only possible if your server has IPv6 connectivity), then all
IPv6 traffic from your client will bypass the VPN and egress
over the local network. This should concern you as more and more
websites are available over IPv6 (including this blog), and clients
generally prefer to use IPv6 if it's available.

The easiest countermeasure is to just disable IPv6 while you're at DEF CON.
As a bonus, you'll reduce your network stack's attack surface and will be safe
in the unlikely event someone drops an IPv6-specific 0day at DEF CON.

#### DNS

If you're using a VPN, you want to make sure you're using a trusted
DNS server. If you use an attacker-controlled DNS server, they can
return rogue IP addresses and redirect all your traffic back to a
network they control after it passes through your VPN, rendering your
VPN moot. Unfortunately, Unix-based operating systems (including OS
X, though it may have improved since I last looked at this a few years ago)
handle DNS server configuration incredibly poorly. Even if your VPN
server specifies the address of a trusted DNS server, the DHCP server
on the local network might return the address of a rogue DNS server.
Which DNS server you end up using depends on too many factors to discuss here,
but needless to say it does not inspire confidence.

I recommend doing whatever it takes to disable the retrieval of DNS
information over DHCP, and hard-coding the IP address of a trusted DNS
server in [/etc/resolv.conf](http://linux.die.net/man/5/resolv.conf).
On Debian, if isc-dhcp-client is your
DHCP client, the most airtight way to stop DHCP messing with your DNS
settings is to place the following in `/etc/dhcp/dhclient-enter-hooks.d/zzz-preserve-resolvconf`:

`make_resolv_conf() {
true
}`

I don't know enough about other operating systems/DHCP clients to provide
specific instructions.

#### Denial of service

An attacker can always block your VPN, preventing you from using it. If they
did this continuously, you'd probably notice that your VPN failed to start, and
then proceed cautiously (or not at all) knowing you didn't have the protection
of a VPN. A more clever attacker would let you establish the VPN connection, and
only start blocking it later. If the OpenVPN client times out and quits, you'll
start sending traffic over the untrusted network, and you might not notice.

I will present a countermeasure for this along with the countermeasure for the next attack.

#### Attacks on redirect-gateway

The usual way of telling OpenVPN to route all Internet traffic over the VPN is
to use the `redirect-gateway def1` option. When this option is used,
the OpenVPN client adds three routes to your system's main routing table:

1. A specific route for the VPN server, via the local network's default gateway.
2. A route for 0.0.0.0/1 via the VPN.
3. A route for 128.0.0.0/1 via the VPN.

The first route prevents the encrypted VPN traffic from being routed via the VPN itself,
which would cause a feedback loop.
The last two routes are a clever hack: together, 0.0.0.0/1 and 128.0.0.0/1
cover the entire IPv4 address space, and since they are more specific than the default
route for 0.0.0.0/0 that came from the local DHCP server, they take precedence.

However, a DHCP server can also push its own routes (called
"[classless static routes](https://tools.ietf.org/html/rfc3442)") to the DHCP client.
So a rogue DHCP server can push routes even more specific
than the OpenVPN routes, such as for 0.0.0.0/2, 64.0.0.0/2, 128.0.0.0/2, and 192.0.0.0/2. These
routes cover the entire IPv4 address space, and take precedence over the less-specific OpenVPN routes.

You could tell your DHCP client to ignore classless static routes, but there's another attack:
a rogue DHCP server could push a subnet mask for an extremely large subnet, such as /2. Then the interface route
for the local network would be more specific than your OpenVPN routes. The attacker can only
grab 25% of the IPv4 address space this way, but that's a sizable percentage of the Internet.

A better countermeasure is to take advantage of Linux's advanced routing
and use multiple routing tables. Although rarely used, a Linux system
can have multiple routing tables, and you can use routing policy rules to
specify which routing table a packet should use. The idea is to put all
your OpenVPN routes in a dedicated routing table, and then add routing
policy rules that say:

1. If a packet is destined for the VPN server, use the main routing table.
2. Otherwise, use the OpenVPN routing table.

This keeps your OpenVPN routes safely segregated from routes pushed by the DHCP server.
The only packets that will ever use the routing table controlled by the DHCP server will
be encrypted packets to the VPN server itself. Everything else will use a routing table
controlled only by OpenVPN.

The first step is to configure the routing rules. Unfortunately, distros
don't provide a good way of managing these, leaving you to run a series
of `ip rule` commands by hand. The changes made by these commands
are lost when the system reboots, so I suggest placing
them in a system startup script such as `rc.local`.

`ip rule add to 203.0.113.41 table main pref 1000
ip rule add to 203.0.113.41 unreachable pref 1001
ip rule add table 94 pref 1002
ip rule add unreachable pref 1003`

Replace 203.0.113.41 with the IP address of your VPN server. The preferences (1000-1003) ensure
the rules are sorted correctly. 94 is the number of the OpenVPN routing table, which we'll
reference below. The second rule prevents VPN server packets from being routed over the VPN
itself in case the main routing table is empty, and the final rule prevents packets from using
the main routing table in case the OpenVPN routing table is empty (which would happen if OpenVPN
quit unexpectedly).

The next step is to configure the OpenVPN client to add its routes to table 94 instead of the main
routing table. OpenVPN itself lacks support for this, but I wrote a routing hook that provides
support. Download the [hook](/blog/post/hardening_openvpn_for_def_con/media/route)
and install it to `/usr/local/lib/openvpn/route`. Make it executable
with `chmod +x`. Then, add the following options to your OpenVPN client config:

`setenv OPENVPN_ROUTE_TABLE 94
route-noexec
route-up /usr/local/lib/openvpn/route
route 0.0.0.0 0.0.0.0`

Remove the existing `redirect-gateway` option (also check the server config in case it's
being pushed to the client).

The first option sets the routing table number. This has to match the number used in the
`ip rule` command above. The second and third options tell OpenVPN to use my routing hook
instead of its builtin routing code. The final option tells OpenVPN to route all traffic
over the VPN.

#### Even worse attacks

If you want to be really careful, you should redirect your network device to an isolated VM and run
all of your networking config (e.g. DHCP client, wireless supplicant) inside it. The Linux
userspace networking stack is pretty hairy, and it all runs as root. A vulnerability would allow
an attacker to take over your system before you even start your VPN.

Using a dedicated network VM is pretty complicated and beyond the scope
of this blog post. Fortunately, if you're using an up-to-date operating
system you're probably safe, since it seems unlikely anyone would burn
a 0day at DEF CON just to take over random conference-goers' laptops.
I'd be much more worried about the other attacks, which are straightforward
enough to be in script kiddie territory.

Don't miss my next post

Enter your email address to get my latest posts by email:Subscribe

You can also [subscribe with RSS](/blog/feed) or follow me on
[Bluesky](https://bsky.app/profile/agwa.name) or
[the fediverse (Mastodon)](https://follow.agwa.name/agwa).

### Older ([View Archive](/blog/index))

[How to Responsibly Publish a Misissued SSL Certificate](/blog/post/how_to_responsibly_misissue_a_cert "How to Responsibly Publish a Misissued SSL Certificate")

### Newer

[I Don't Accept the Risk of SHA-1](/blog/post/i_dont_accept_the_risk_of_sha1 "I Don't Accept the Risk of SHA-1")

### Comments

#### Reader [Victor Dorneanu](http://blog.dornea.nu "http://blog.dornea.nu") on 2015-11-15 at 16:26:

Hi Andrew!

First thanks for this excellent article. I was playing around with your hook script and then I've noticed that nothing really happens. Having a look at your script I've seen this one:

> /sbin/ip route show dev $dev table main | while read route

In my client conf I have:

`# Add extra client protection
script-security 2
setenv OPENVPN_ROUTE_TABLE 94
route-noexec
route-up /usr/local/bin/route
route 0.0.0.0 0.0.0.0`

The connection is being successfully established, however the tun0 device has no ip routes at all, so in that case

> /sbin/ip route show dev $dev table main | while read route

will cause nothing to happen.

Any ideas?

Cheers,
Victor

[Reply](/blog/post/hardening_openvpn_for_def_con/comment/31664)

#### Anonymous on 2017-05-14 at 15:35:

Nice article, but I think that it would be better to use Qubes OS's separate VPN domain (virtual machine), you can find more here <https://www.qubes-os.org/doc/vpn/>

[Reply](/blog/post/hardening_openvpn_for_def_con/comment/31967)

#### Reader [Lizzie Moratti](https://tunnelvisionbug.com "https://tunnelvisionbug.com") on 2024-05-08 at 17:15:

Hi Andrew, great article!

For the sentence, "The attacker can only grab 25% of the IPv4 address space this way, but that's a sizable percentage of the Internet." I do want to note that Option 121 actually allows you to push as many routes as you can fit into the packet length. We've done upwards of 10 routes at a single time.

One interesting thing we're exploring is the idea of installing routes for all traffic except a single IP-address. When a VPN is using a mitigation like fire-wall based rules that create a DOS you can use this to confirm a host is speaking to a single IP address. There's a lot of other things you can do with 121!

You mention VMs as a fix but you can also use Network Namspaces (on Linux) to isolate the network stacks. This might be a bit easier if you really need to use the host OS. <https://www.wireguard.com/netns/#the-new-namespace-solution>

[Reply](/blog/post/hardening_openvpn_for_def_con/comment/32490)

#### [Andrew Ayer](https://www.agwa.name "https://www.agwa.name") on 2024-05-12 at 21:08:

Hi Lizzie, thanks for reading!

"25% of the IPv4 address space" refers to attacks using a subnet mask (option 1). Obviously classless static routes (option 121) are more powerful, but they might be ignored by clients. A subnet mask attack is less powerful but will work against any DHCP client.

Network namespaces are another great option to protect against route attacks, though I've unfortunately encountered some wireless drivers which don't support network namespaces. When I wrote this post, I was also thinking about remote code execution vulnerabilities in the DHCP client, which network namespaces wouldn't defend against, but these days I would look for a DHCP client written in a memory-safe language instead of going to the trouble of using VMs.

[Reply](/blog/post/hardening_openvpn_for_def_con/comment/32493)

### Post a Comment

Your comment will be public. To contact me privately, [email me](/). Please keep your comment polite, on-topic, and comprehensible. Your comment may be held for moderation before being published.

Your Name:  (Optional; will be published)

Your Email Address:  (Optional; will not be published)

Your Website:  (Optional; will be published)

* Blank lines separate paragraphs.
* Lines starting with `>` are indented as block quotes.
* Lines starting with two spaces are reproduced verbatim (good for code).
* Text surrounded by \*asterisks\* is *italicized*.
* Text surrounded by `back ticks` is `monospaced`.
* URLs are turned into links.
* Use the Preview button to check your formatting.

© 2025 Andrew Ayer



=== Content from mullvad.net_2f7e8781_20250111_135240.html ===

This site needs Javascript for some functionality to work properly
 [Skip to main content](#main) Â  [![Mullvad logo, to the homepage](/_app/immutable/assets/logo.Ba5MUFAA.svg)](/en/)

* [About](/en/about)
* Products
  + [VPN](/en/vpn)
  + [Browser](/en/browser)
  + [Search](https://leta.mullvad.net)
  + [Encrypted DNS](/en/help/dns-over-https-and-dns-over-tls)
  + [Browser Extension](/en/help/mullvad-browser-extension)
* [Blog](/en/blog)
* [Pricing](/en/pricing)
* [Servers](/en/servers)
* [Downloads](/en/download)
* [Help](/en/help)

 [Account](/en/account) [Get started](/en/account/create)
# Evaluating the impact of TunnelVision

May 7, 2024 [Security](/en/blog/tag/security)Â

We evaluated the impact of the latest TunnelVision attack (CVE-2024-3661) and have found it to be very similar to TunnelCrack LocalNet (CVE-2023-36672 and CVE-2023-35838).

We have determined that from a security and privacy standpoint in relation to the Mullvad VPN app they are virtually identical. Both attacks rely on the attacker being on the same local network as the victim, and in one way or another being able to act as the victim's DHCP server and tell the victim that some public IP range(s) should be routed via the attacker instead of via the VPN tunnel.

The desktop versions (Windows, macOS and Linux) of Mullvad's VPN app have firewall rules in place to block any traffic to public IPs outside the VPN tunnel. These effectively prevent both LocalNet and TunnelVision from allowing the attacker to get hold of plaintext traffic from the victim.

Android is not vulnerable to TunnelVision simply because it does not implement DHCP option 121, as explained in the original article about TunnelVision.

iOS is unfortunately vulnerable to TunnelVision, for the same reason it is vulnerable to LocalNet, as [we outlined in our blog post about TunnelCrack](/blog/response-to-tunnelcrack-vulnerability-disclosure). The fix for TunnelVision is probably the same as for LocalNet, but we have not yet been able to integrate and ship that to production.

## Mullvad

* [About](/en/about)
* [Help](/en/help)
* [Servers](/en/servers)
* [Pricing](/en/pricing)
* [Blog](/en/blog)
* [Mullvad VPN](/en/vpn)
* [Mullvad Browser](/en/browser)
* [Why privacy matters](/en/why-privacy-matters)
* [Why Mullvad VPN?](/en/why-mullvad-vpn)
* [What is a VPN?](/en/vpn/what-is-vpn)
* [Downloads](/en/download)
* [Stop chat control](/en/chatcontrol)
* [Press](/en/press)
* [Jobs](https://www.mullvad.careers/)

## Policies

* [Policies](/en/policies)
* [Open source](/en/open-source)
* [Privacy policy](/en/help/privacy-policy)
* [Cookies](/en/help/cookie-policy)
* [Terms of service](/en/help/terms-service)
* [Partnerships and resellers](/en/help/partnerships-and-resellers)
* [Reviews, ads and affiliates](/en/help/policy-reviews-advertising-and-affiliates)
* [Reporting a bug or vulnerability](/en/help/how-report-bug-or-vulnerability)

## Address

Mullvad VPN AB

Box 53049

400 14 Gothenburg

Sweden

support@mullvadvpn.net

* [GPG key](/static/gpg/mullvadvpn-support-mail.asc)
* [Onion service](http://o54hon2e2vj6c7m3aqqu6uyece65by3vgoxxhlqlsvkmacw6a7m7kiad.onion)

## Follow us

* [@mullvadnet](https://www.x.com/mullvadnet)
* [@mullvadnet](https://mastodon.online/%40mullvadnet)
* [Mullvad VPN](https://www.youtube.com/c/MullvadVPNNet)
* [mullvad](https://github.com/mullvad)
## Language

English

* [Ø§ÙØ¹Ø±Ø¨ÙÙØ©](/en/setlocale/ar?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Dansk](/en/setlocale/da?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Deutsch](/en/setlocale/de?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [English](/en/setlocale/en?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [EspaÃ±ol](/en/setlocale/es?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [ÙØ§Ø±Ø³Û](/en/setlocale/fa?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Suomi](/en/setlocale/fi?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [FranÃ§ais](/en/setlocale/fr?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Italiano](/en/setlocale/it?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [æ¥æ¬èª](/en/setlocale/ja?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [íêµ­ì´](/en/setlocale/ko?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Nederlands](/en/setlocale/nl?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Norsk](/en/setlocale/no?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Polski](/en/setlocale/pl?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [PortuguÃªs](/en/setlocale/pt?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Ð ÑÑÑÐºÐ¸Ð¹](/en/setlocale/ru?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [Svenska](/en/setlocale/sv?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [à¸ à¸²à¸©à¸²à¹à¸à¸¢](/en/setlocale/th?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [TÃ¼rkÃ§e](/en/setlocale/tr?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [ç®ä½ä¸­æ](/en/setlocale/zh-hans?page=/en/blog/evaluating-the-impact-of-tunnelvision)
* [ç¹é«ä¸­æ](/en/setlocale/zh-hant?page=/en/blog/evaluating-the-impact-of-tunnelvision)



=== Content from www.zscaler.com_dd9c0e7f_20250111_135249.html ===
This site uses JavaScript to provide a number of functions, to use this site please enable JavaScript in your browser.OpenSearch[ThreatLabz](https://threatlabz.zscaler.com/)[CXO REvolutionaries](/cxorevolutionaries)[Careers](/careers)[Partners](/partners)[Support](https://help.zscaler.com/phone-support)ShowContact Us[Get in touch](/company/contact)1-408-533-0288Chat with usShowSign In[Zscaler Cloud Portal | Admin](https://admin.zscaler.net/)[Zscaler Cloud Portal One | Admin](https://admin.zscalerone.net/)[Zscaler Cloud Portal Two | Admin](https://admin.zscalertwo.net/)[Zscaler Cloud Portal Three | Admin](https://admin.zscalerthree.net/)[Zscaler Cloud Portal Beta | Admin](https://admin.zscalerbeta.net/)[admin.zscloud.net](https://admin.zscloud.net)[Zscaler Private Access Cloud Portal One | Admin](https://admin.private.zscaler.com/)[Zscaler Private Access Cloud Portal Two | Admin](https://admin.zpatwo.net/)[Home](/)PlatformProductsSolutionsResourcesCompany[Request a demo](/custom-product-demo)[Secure the Workforce](/products-and-solutions/secure-your-users)

Provide users with seamless, secure, reliable access to applications and data.

[Secure the Cloud](/products-and-solutions/workload-communications)

Build and run secure cloud apps, enable zero trust cloud connectivity, and protect workloads from data center to cloud.

[Secure IoT/OT](/products-and-solutions/secure-your-ot-and-iot)

Provide zero trust connectivity for IoT and OT devices and secure remote access to OT systems.

[Secure B2B](/products-and-solutions/zscaler-b2b)

Provide zero trust site-to-site connectivity and reliable access to B2B apps for partners.

[Why Zscaler](/products-and-solutions/zero-trust-exchange-zte)[Leadership in AI/ML](/products-and-solutions/ai-cybersecurity)[Zscaler SASE](/products-and-solutions/secure-access-service-edge-sase)[Zscaler SSE](/products-and-solutions/security-service-edge-sse)[Analyst Recognition](/company/analyst-reports)[Customer Stories](/customers)[Partner Ecosystem](/partners/technology)[Reduce Your Carbon Footprint](/corporate-responsibility/environmental-impact)[GARTNER REPORT

Zscaler: A Leader in the 2024 Gartner® Magic Quadrant™ for Security Service Edge (SSE)

Get the report![GARTNER REPORT](/_next/image?url=https%3A%2F%2Fcms.zscaler.com%2Fsites%2Fdefault%2Ffiles%2Fimages%2Fsub-menu%2FGartner-report.png&w=600&q=75)](/gartner-magic-quadrant-security-service-edge-sse)[Cyberthreat Protection](/products-and-solutions/cyberthreat-protection)[Secure Internet Access (ZIA)](/products-and-solutions/zscaler-internet-access)[Secure Private Access (ZPA)](/products-and-solutions/zscaler-private-access)[Zero Trust Firewall](/products-and-solutions/cloud-firewall)[Sandbox](/products-and-solutions/cloud-sandbox)[Browser Isolation](/products-and-solutions/browser-isolation)[Data Protection](/products-and-solutions/data-protection)[Web and Email DLP](/products-and-solutions/data-loss-prevention)[Multi-Mode CASB](/products-and-solutions/cloud-access-security-broker-casb)[Endpoint DLP](/products-and-solutions/endpoint-dlp)[Unified SaaS Security](/products-and-solutions/saas-security)[Gen AI and Copilot Security](/products-and-solutions/securing-generative-ai)[DSPM](/products-and-solutions/data-security-posture-management-dspm)[BYOD Security](/demo/byod)[Zero Trust Networking](/products-and-solutions/zero-trust-branch-and-cloud)[Zero Trust SD-WAN](/products-and-solutions/zero-trust-sd-wan)[Zero Trust Device Segmentation](/products-and-solutions/zero-trust-device-segmentation)[Zero Trust Cloud](/products-and-solutions/workload-communications)[Zero Trust for IoT/OT](/products-and-solutions/secure-your-ot-and-iot)[Digital Experience (ZDX)](/products-and-solutions/zscaler-digital-experience-zdx)[Zero Trust SASE](/products-and-solutions/secure-access-service-edge-sase)[Risk Management](/products-and-solutions/risk-management)[Data Fabric for Security](/products-and-solutions/data-fabric)[Risk360](/products-and-solutions/zscaler-risk-360)[Unified Vulnerability Management](/products-and-solutions/vulnerability-management)[Deception](/products-and-solutions/deception-technology)[Breach Predictor](/products-and-solutions/breach-predictor)[Identity Protection](/products-and-solutions/zscaler-itdr)[External Attack Surface Management](/products-and-solutions/external-attack-surface-management)[Managed Threat Hunting](/products-and-solutions/managed-threat-hunting)

USE CASES

[Zero Trust + AI](/products-and-solutions/ai-cybersecurity)[Business Insights](/products-and-solutions/business-insights)[Replace VPN](/products-and-solutions/vpn-alternative)[Stop Ransomware](/products-and-solutions/ransomware-protection)[VDI Alternative](/demo/vdi-alternative) [Secure Your Data](/products-and-solutions/data-protection)[Optimize Digital Experiences](/products-and-solutions/zscaler-digital-experience-zdx)[Deploy Zero Trust SASE](/products-and-solutions/secure-access-service-edge-sase)[Deploy BYOD Securely](/demo/byod)[Reduce Cyber Risk](/products-and-solutions/zscaler-risk-360)[Accelerate M&A and Divestitures](/solutions/mergers-acquisitions-divestitures)

INDUSTRY & MARKET SOLUTIONS

[Healthcare](/industries/healthcare)[Banking & Financial Services](/industries/financial-services)[US Public Sector](/industries/public-sector)[US Federal Government](/industries/public-sector/federal)[US State & Local Government](/industries/public-sector/state-and-local)[Education](/industries/public-sector/education)[Australia Government](/industries/australian-government)[China Government](/industries/zscaler-china-premium-access)

PARTNERS

[Explore Our Partners](/partners)[Become a Partner](https://partners.zscaler.com/s/partneronboarding)[Partner Portal](/partners#zscaler-partner-portal)

TECHNOLOGY PARTNERS

[Explore Technology Partners](/partners/technology)[Microsoft](/partners/microsoft)[CrowdStrike](/partners/crowdstrike)[AWS](/partners/aws)[Okta](/partners/okta)[Rubrik](/partners/rubrik)[SAP](/partners/sap)USE CASES[Zero Trust + AI](/products-and-solutions/ai-cybersecurity)[Business Insights](/products-and-solutions/business-insights)[Replace VPN](/products-and-solutions/vpn-alternative)[Stop Ransomware](/products-and-solutions/ransomware-protection)[VDI Alternative](/demo/vdi-alternative) [Secure Your Data](/products-and-solutions/data-protection)[Optimize Digital Experiences](/products-and-solutions/zscaler-digital-experience-zdx)[Deploy Zero Trust SASE](/products-and-solutions/secure-access-service-edge-sase)[Deploy BYOD Securely](/demo/byod)[Reduce Cyber Risk](/products-and-solutions/zscaler-risk-360)[Accelerate M&A and Divestitures](/solutions/mergers-acquisitions-divestitures)INDUSTRY & MARKET SOLUTIONS[Healthcare](/industries/healthcare)[Banking & Financial Services](/industries/financial-services)[US Public Sector](/industries/public-sector)[US Federal Government](/industries/public-sector/federal)[US State & Local Government](/industries/public-sector/state-and-local)[Education](/industries/public-sector/education)[Australia Government](/industries/australian-government)[China Government](/industries/zscaler-china-premium-access)PARTNERS[Explore Our Partners](/partners)[Become a Partner](https://partners.zscaler.com/s/partneronboarding)[Partner Portal](/partners#zscaler-partner-portal)TECHNOLOGY PARTNERS[Explore Technology Partners](/partners/technology)[Microsoft](/partners/microsoft)[CrowdStrike](/partners/crowdstrike)[AWS](/partners/aws)[Okta](/partners/okta)[Rubrik](/partners/rubrik)[SAP](/partners/sap)

Resource Center

[Resource Library](/resources)[Blog](/blogs)[Customer Success Stories](/customers)[Webinars](/resources/webinars)[Zpedia](/zpedia)

Events & Trainings

[Upcoming Events](/events)[Zenith Live](https://reg.zenithlive.com/flow/zscaler/ams25/zlregion/page/regionselect)[Zscaler Academy](/zscaler-academy)

Security Research & Services

[ThreatLabz Analytics](https://threatlabz.zscaler.com/cloud-insights/cloud-activity-dashboard)[Security Advisory Updates](/security-advisories)[Zero Trust Resources](/zpedia?type=zero-trust)

Tools

[Security Preview](http://securitypreview.zscaler.com)[Security and Risk Assessment](/tools)[Disclose a Vulnerability](/security/vulnerability-disclosure-program)[Executive Insights App](/cio-insights/executive-insights-app)[Ransomware Protection ROI Calculator](/resources/ransomware-roi)

Community & Support

[Customer Success Center](https://customer.zscaler.com/)[Zenith Community](https://community.zscaler.com/)[CXO REvolutionaries](/cxorevolutionaries)[Zscaler Help Portal](https://help.zscaler.com/)[CXO REVOLUTIONARIES

Amplifying the voices of real-world digital and zero trust pioneers

Visit now![CXO REvolutionaries](/_next/image?url=https%3A%2F%2Fcms.zscaler.com%2Fsites%2Fdefault%2Ffiles%2Fimages%2Fsub-menu%2FCxo-revolutionaries.png&w=768&q=75)](/cxorevolutionaries)Resource Center[Resource Library](/resources)[Blog](/blogs)[Customer Success Stories](/customers)[Webinars](/resources/webinars)[Zpedia](/zpedia)Events & Trainings[Upcoming Events](/events)[Zenith Live](https://reg.zenithlive.com/flow/zscaler/ams25/zlregion/page/regionselect)[Zscaler Academy](/zscaler-academy)Security Research & Services[ThreatLabz Analytics](https://threatlabz.zscaler.com/cloud-insights/cloud-activity-dashboard)[Security Advisory Updates](/security-advisories)[Zero Trust Resources](/zpedia?type=zero-trust)Tools[Security Preview](http://securitypreview.zscaler.com)[Security and Risk Assessment](/tools)[Disclose a Vulnerability](/security/vulnerability-disclosure-program)[Executive Insights App](/cio-insights/executive-insights-app)[Ransomware Protection ROI Calculator](/resources/ransomware-roi)Community & Support[Customer Success Center](https://customer.zscaler.com/)[Zenith Community](https://community.zscaler.com/)[CXO REvolutionaries](/cxorevolutionaries)[Zscaler Help Portal](https://help.zscaler.com/)[About Zscaler](/company/about-zscaler)

Discover how it began and where it’s going

[Partners](/partners)

Meet our partners and explore system integrators and technology alliances

[News & Announcements](/company/news-press)

Stay up to date with the latest news

[Leadership Team](/company/leadership)

Meet our management team

[Partner Integrations](/partners/technology)

Explore our technology partner integrations

[Investor Relations](https://ir.zscaler.com/)

See news, stock information, and quarterly reports

[Corporate Responsibility](/corporate-responsibility)

Learn about our approach

[Careers](/careers)

Join our mission

[Press Center](/company/media-center)

Find everything you need to cover Zscaler

[Compliance](/compliance/overview)

Understand our adherence to rigorous standards

[Zenith Ventures](/company/zenithventures)

Learn about our strategic startup investments

[Home](/)[Request a demo](/custom-product-demo)

Zscaler Blog

Get the latest Zscaler blog updates in your inbox

[Subscribe](#subscribe-blog)[Security Research](/blogs?type=security-research)
# CVE-2024-3661, a.k.a. TunnelVision, Exposes a VPN Bypass Vulnerability

[**NISHANT GUPTA,**](/author/nishantgupta) [**NATARAJA GUNDALE,**](/author/ngundale) [**VARUN SANDILA**](/author/vsandila)May 07, 2024 - 6 min read [Threatlabz Research](/blogs?topic=threatlabz-research)

Contents

1. [Introduction](#introduction)
2. [Recommendations](#recommendations)
3. [Affected Operating Systems](#affected-operating-systems)
4. [How It Works](#how-it-works)
5. [Zscaler Patches](#zscaler-patches)
6. [Conclusion](#conclusion)
7. [References](#references)
8. [More blogs](#more-blogs)
Copy URLCopy URL

***\*Updated on November 7, 2024**: This blog was updated to reflect Zscaler patch information.*

## Introduction

On May 6, 2024, a researcher from Leviathan Security Group identified a new technique, termed as “TunnelVision”, that can bypass VPN encapsulation and enable attackers to send the traffic outside a VPN tunnel using the built-in features of Dynamic Host Configuration Protocol (DHCP). TunnelVision involves the routing of traffic without encryption through a VPN. This traffic can be directed by the attacker's configured DHCP server using option 121, ultimately being redirected to the internet via a side channel created by the attacker. The existing VPN tunnel remains intact, and the side channel created by the attacker cannot be detected by the existing VPN tunnel. [CVE-2024-3661](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-3661) has been assigned to this critical vulnerability.

## Recommendations

**For organizations**
Zscaler ThreatLabz recommends organizations: enable DHCP snooping, ARP protections, and port security on switches used for communication. If feasible, ignore option 121 for the DHCP server when VPN is being used in the network.

**Note:** In some scenarios, completely ignoring option 121 may result in network connectivity issues.

**For VPN providers**
Zscaler ThreatLabz recommends VPN providers integrate network namespaces into operating systems where feasible.

### Further Details

The content below elaborates on our recommendations for mitigating this vulnerability.

* **DHCP Snooping:** Enabling DHCP snooping on LAN switches helps prevent rogue DHCP servers and eliminates potentially harmful DHCP traffic. DHCP snooping allows network access only for clients with specified IP and/or MAC addresses. It also provides ARP security as a sub-feature, allowing precise control over permitted ARP packets within the network.
* **Port Security:** Network switches can be configured with port security, which enables you to limit the number of MAC addresses learned per port. This configuration ensures that the switch only forwards packets with recognized MAC addresses while discarding others. As a result, fake packets are effectively blocked from reaching the DHCP server.
* **Ignoring DHCP Option 121:** Another potential countermeasure is to disregard option 121 during VPN activation. DHCP option 121 typically adds classless route options, which specify a set of classless static routes for the client's routing table. However, it is important to note that ignoring these routes may disrupt network connectivity, despite the intended purpose of option 121.
## Affected Operating Systems

This issue impacts operating systems following RFC specifications for DHCP clients and featuring DHCP option 121 route support.

Affected systems include:

* Windows
* Linux
* MacOS
* iOS

Notably, Android remains unaffected as it lacks support for DHCP option 121.

## How It Works

The VPN client creates an encrypted version of the packet which is originally received from the file descriptor associated with its virtual network interface. It places this encrypted payload in the layer for its underlying VPN protocol, then uses that protocol to communicate with the VPN server.

Once a VPN client establishes a connection with a VPN server, it configures the host's settings to route traffic through the established tunnel.

DHCP provides time-based leases for IP addresses and sets the default gateway, which acts as the primary route to the internet or Domain Name System (DNS) servers. In 2002, RFC 3442 introduced option 121 for classless static routes, allowing administrators to add static routes with classless ranges to a client’s routing table.

![A depiction of how the attacker could use a DHCP starvation attack to create a side channel for communication, thereby rerouting legitimate traffic.](https://cms.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/tunnelvision_fig_1.png)

Figure 1: A depiction of how the attacker could use a DHCP starvation attack to create a side channel for communication, thereby rerouting legitimate traffic.

The attack steps are explained below:

1. An attacker utilizes a DHCP starvation attack to flood the legitimate DHCP server with DHCP Discovery packets until all available addresses are exhausted. Subsequently, the attacker sets up a rogue DHCP server and sends incorrect network settings via new DHCP requests.
2. An attacker operates a DHCP server on the same network as a targeted VPN user and utilizes DHCP option 121, as depicted in the figure below, to configure a static route in the routing table. The attacker ensures that the preference of the configured static route is higher than that of the default route. Additionally, the attacker sets the DHCP configuration to use itself as the gateway, enabling the DHCP server to act as an Adversary-in-the-Middle (AiTM). This allows the attacker to intercept unencrypted traffic before forwarding it to the default gateway through traffic forwarding configuration.

   ![Figure 2: Packet indicating the usage of option 121 in the DHCP offer.](https://cms.zscaler.com/cdn-cgi/image/format=auto/sites/default/files/images/blogs/tunnelvision_fig_2.png)

   Figure 2: Packet indicating the usage of option 121 in the DHCP offer.
3. An attacker establishes a side channel for communication and data transfer to their own controlled systems located outside the internet, bypassing the VPN tunnel. However, this bypassing of the VPN tunnel does not give any indication to the user's identity.
## Zscaler Patches

Zscaler added protection for the following clients.

### Windows client

Only Windows Client Connector devices running on **route-based mode** **are impacted**. Windows clients running Z-Tunnel 2.0 or the Packet Filter driver in Z-Tunnel 1.0 mode are not affected.

If your devices are running on route-based mode, Zscaler recommends [migrating](https://help.zscaler.com/client-connector/using-windows-filter-driver-zscaler-client-connector) to packet filters.

To check if you are running on route-based mode:

1. Navigate to your Client Connector Portal.
2. Under the Administration section, inspect your forwarding profiles.
3. If “Route Based” is selected for any of these that are actively being used by devices, then route-based mode is in effect. Please refer to [Using the Windows Filter Driver for Zscaler Client Connector](https://help.zscaler.com/client-connector/using-windows-filter-driver-zscaler-client-connector) for detailed steps on migrating to packet filters.

If you have any questions about migrating to packet filtering, reach out to your Zscaler account team.

### macOS client

**All macOS clients are impacted.** The macOS client uses a virtual network adapter within the operating system. As such, DHCP is utilized, and option 121 can be used to publish routes for the virtual network adapter.

Zscaler added protection against this vulnerability in the Zscaler Client Connector (version 4.2.0.282) for macOS clients on May 21, 2024.

### Linux client

**All Linux clients are impacted.**The Linux client uses a virtual network adapter within the operating system. Consequently, DHCP is utilized, and option 121 can be used to publish routes to the virtual network adapter.

Zscaler added protection against this vulnerability for the following Linux clients:

* Zscaler Client Connector (1.5.1.25) on May 17, 2024
* Zscaler Client Connector (3.7.0.134) on June 6, 2024

### iOS client

Not impacted.

### Android client

Not impacted.

## Conclusion

The TunnelVision vulnerability (CVE-2024-3661) exposes a method for attackers to bypass VPN encapsulation and redirect traffic outside the VPN tunnel. This technique involves using DHCP option 121 to route traffic without encryption through a VPN, ultimately sending it to the internet via a side channel created by the attacker. To mitigate this vulnerability, Zscaler ThreatLabz recommends organizations to implement DHCP snooping, ARP protections, and port security on switches. It is also advised to consider ignoring option 121 for the DHCP server when VPN is in use, although this may result in network connectivity issues in certain scenarios.

## References

* [TunnelVision](https://www.tunnelvisionbug.com/)
* [TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak](https://www.leviathansecurity.com/blog/tunnelvision)
* [MITRE CVE-2024-3661](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-3661)
* [Classless Static Route Option for Dynamic Host Configuration Protocol (DHCP)](https://datatracker.ietf.org/doc/html/rfc3442)
* [Dynamic Host Configuration Protocol (DHCP) Starvation Attack](https://en.wikipedia.org/wiki/Link_layer_security#Dynamic_Host_Configuration_Protocol_(DHCP)_starvation)
* [DHCP snooping](https://en.wikipedia.org/wiki/DHCP_snooping)
* [ARP spoofing](https://en.wikipedia.org/wiki/ARP_spoofing)
 ![form submtited](/assets/images/validation_success.svg)Thank you for reading
## Was this post useful?

![vote yes](/assets/images/validation_yes.svg)Yes, very!![vote no](/assets/images/validation_no.svg)Not really
## Explore more Zscaler blogs

![Another CVE (PAN-OS Zero-Day), Another Reason to Consider Zero Trust](/_next/image?url=https%3A%2F%2Fcms.zscaler.com%2Fsites%2Fdefault%2Ffiles%2Fimages%2Fblogs%2Fblog-tile-img-700x467-not-secured_0.jpg&w=1920&q=75 "Image of computer with with an 'unlocked' symbol in the center. ")Another CVE (PAN-OS Zero-Day), Another Reason to Consider Zero Trust[Read post](/blogs/security-research/another-cve-pan-os-zero-day-another-reason-consider-zero-trust)![An eclipse on a computer.](/_next/image?url=https%3A%2F%2Fcms.zscaler.com%2Fsites%2Fdefault%2Ffiles%2Fimages%2Fblogs%2Feclipse_0.jpeg&w=1920&q=75 "A Look at CVE-2024-3400 Activity and Upstyle Backdoor Technical Analysis")A Look at CVE-2024-3400 Activity and Upstyle Backdoor Technical Analysis[Read post](/blogs/security-research/look-cve-2024-3400-activity-and-upstyle-backdoor-technical-analysis)![A person typing at their computer](/_next/image?url=https%3A%2F%2Fcms.zscaler.com%2Fsites%2Fdefault%2Ffiles%2Fimages%2Fblogs%2Fblog-tile-img-700x467-alert_2.jpg&w=1920&q=75 "CVE Advisory: CVE-2024-3094 - Security Compromise in XZ Utils")CVE Advisory: CVE-2024-3094 - Security Compromise in XZ Utils[Read post](/blogs/security-research/cve-advisory-cve-2024-3094-security-compromise-xz-utils)
## Get the latest Zscaler blog updates in your inbox

![](/_next/image?url=%2Fassets%2Fimages%2Floading.webp&w=256&q=75)

By submitting the form, you are agreeing to our [privacy policy](/privacy/company-privacy-policy).

THE ZSCALER EXPERIENCE

Learn about:

[Your world, secured](/experience)[Zero Trust](/resources/security-terms-glossary/what-is-zero-trust)[Secure Access Service Edge (SASE)](/resources/security-terms-glossary/what-is-sase)[Security Service Edge (SSE)](/resources/security-terms-glossary/what-is-security-service-edge-sse)[Zero Trust Network Access (ZTNA)](/resources/security-terms-glossary/what-is-zero-trust-network-access)[Secure Web Gateway (SWG)](/resources/security-terms-glossary/what-is-secure-web-gateway)[Cloud Access Security Broker (CASB)](/resources/security-terms-glossary/what-is-cloud-access-security-broker)[Cloud Native Application Protection Platform (CNAPP)](/resources/security-terms-glossary/what-is-cloud-native-application-protection-platform-cnapp)[Data Security Posture Management (DSPM)](/zpedia/what-is-data-security-posture-management)PRODUCTS & SOLUTIONS[Secure Your Users](/products-and-solutions/secure-your-users)[Secure Your Workloads](/products-and-solutions/workload-communications)[Secure Your IoT and OT](/products-and-solutions/secure-your-ot-and-iot)[Secure Internet Access (ZIA)](/products-and-solutions/zscaler-internet-access)[Data Protection (CASB/DLP)](/products-and-solutions/data-protection)[Digital Experience (ZDX)](/products-and-solutions/zscaler-digital-experience-zdx)[Industry & Market Solutions](/industries)[Partner Integrations](/partners/technology)[Zscaler Client Connector](/products-and-solutions/zscaler-client-connector)PLATFORM[Zero Trust Exchange Platform](/products-and-solutions/zero-trust-exchange-zte)[Secure Digital Transformation](/experience-one-true-zero-trust)[Network Transformation](/capabilities/secure-access-service-edge)[Application Transformation](/products-and-solutions/application-transformation)[Security Transformation](/products-and-solutions/security-transformation)RESOURCES[Resource Library](/resources)[Customer Success Stories](/customers)[Security Preview](http://securitypreview.zscaler.com)[Threat Assessment Tools](/tools)[ThreatLabz Analytics & Insights](https://threatlabz.zscaler.com/cloud-insights/cloud-activity-dashboard)[Upcoming Events](/events)[Blog](/blogs)[Zscaler Academy](/zscaler-academy)[CXO Revolutionaries](/cxorevolutionaries)[Zpedia](/zpedia)[Ransomware Protection ROI Calculator](/resources/ransomware-roi)POPULAR LINKS[Pricing & Plans](/pricing-and-plans)[About Zscaler](/company/about-zscaler)[Leadership Team](/company/leadership)[Career Opportunities](/careers)[Find or Become a Partner](/partners)[Customer Success Center](https://customer.zscaler.com/)[Investor Relations](https://ir.zscaler.com/)[Press Center](/company/media-center)[News & Announcements](/company/news-press)[Corporate Responsibility](/corporate-responsibility)[Compliance](/compliance/overview)[Contact Zscaler](/company/contact)[Home](/)[Français](/fr)[Deutsch](/de)[Italiano](/it)[日本](/jp)[Castellano - Mexico](/mx)[Castellano - España](/es)[Portugues - Brasil](/br)

Zscaler is universally recognized as the leader in zero trust. Leveraging the largest security cloud on the planet, Zscaler anticipates, secures, and simplifies the experience of doing business for the world's most established companies.

[Français](/fr)[Deutsch](/de)[Italiano](/it)[日本](/jp)[Castellano - Mexico](/mx)[Castellano - España](/es)[Portugues - Brasil](/br)![](/_next/image?url=%2Fassets%2Fimages%2Floading.webp&w=256&q=75)[Visit us on Facebook](https://www.facebook.com/zscaler)[Linkedin](https://www.linkedin.com/company/zscaler)[Follow us on X](https://x.com/zscaler)[Subscribe our Youtube Channel](https://www.youtube.com/user/ZscalerMarketing)[Sitemap](/sitemap.xml)[Privacy](/privacy/overview)[Legal](/legal/overview)[Security](/security/vulnerability-disclosure-program)**© 2025 Zscaler**, Inc.

All rights reserved. Zscaler™ and other trademarks listed at zscaler.com/legal/trademarks are either (i) registered trademarks or service marks or (ii) trademarks or service marks of Zscaler, Inc. in the United States and/or other countries. Any other trademarks are the properties of their respective owners.



=== Content from krebsonsecurity.com_e0fad0bd_20250111_135239.html ===


Advertisement[![](/b-knowbe4/23.jpg)](https://www.knowbe4.com/phisher-ai-osterman-6?utm_source=Krebs&utm_medium=display&utm_campaign=SATBrandAwareness&utm_content=AIEmail)
Advertisement[![](/b-knowbe4/23.jpg)](https://www.knowbe4.com/phisher-ai-osterman-6?utm_source=Krebs&utm_medium=display&utm_campaign=SATBrandAwareness&utm_content=AIEmail)

[![Krebs on Security](https://krebsonsecurity.com/wp-content/uploads/2021/03/kos-27-03-2021.jpg)](https://krebsonsecurity.com/ "Krebs on Security")

[Skip to content](#content "Skip to content")

* [Home](https://krebsonsecurity.com/)
* [About the Author](https://krebsonsecurity.com/about/)
* [Advertising/Speaking](https://krebsonsecurity.com/cpm/)

# Why Your VPN May Not Be As Secure As It Claims

May 6, 2024

[44 Comments](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comments)

Virtual private networking (VPN) companies market their services as a way to prevent anyone from snooping on your Internet usage. But new research suggests this is a dangerous assumption when connecting to a VPN via an untrusted network, because attackers on the same network could force a target’s traffic off of the protection provided by their VPN without triggering any alerts to the user.

![](https://krebsonsecurity.com/wp-content/uploads/2024/05/tunnelvision.png)

When a device initially tries to connect to a network, it broadcasts a message to the entire local network stating that it is requesting an Internet address. Normally, the only system on the network that notices this request and replies is the router responsible for managing the network to which the user is trying to connect.

The machine on a network responsible for fielding these requests is called a **Dynamic Host Configuration Protocol** (DHCP) server, which will issue time-based leases for IP addresses. The DHCP server also takes care of setting a specific local address — known as an **Internet gateway** — that all connecting systems will use as a primary route to the Web.

VPNs work by creating a virtual network interface that serves as an encrypted tunnel for communications. But researchers at **Leviathan Security** say they’ve discovered it’s possible to abuse an obscure feature built into the DHCP standard so that other users on the local network are forced to connect to a rogue DHCP server.

“Our technique is to run a DHCP server on the same network as a targeted VPN user and to also set our DHCP configuration to use itself as a gateway,” Leviathan researchers **Lizzie Moratti** and **Dani Cronce** wrote. “When the traffic hits our gateway, we use traffic forwarding rules on the DHCP server to pass traffic through to a legitimate gateway while we snoop on it.”

The feature being abused here is known as [DHCP option 121](https://datatracker.ietf.org/doc/html/rfc3442), and it allows a DHCP server to set a route on the VPN user’s system that is more specific than those used by most VPNs. Abusing this option, Leviathan found, effectively gives an attacker on the local network the ability to set up routing rules that have a higher priority than the routes for the virtual network interface that the target’s VPN creates.

“Pushing a route also means that the network traffic will be sent over the same interface as the DHCP server instead of the virtual network interface,” the Leviathan researchers said. “This is intended functionality that isn’t clearly stated in the RFC [standard]. Therefore, for the routes we push, it is never encrypted by the VPN’s virtual interface but instead transmitted by the network interface that is talking to the DHCP server. As an attacker, we can select which IP addresses go over the tunnel and which addresses go over the network interface talking to our DHCP server.”

Leviathan found they could force VPNs on the local network that already had a connection to arbitrarily request a new one. In this well-documented tactic, known as a [DHCP starvation attack](https://www.prosec-networks.com/en/blog/dhcp-starvation-attack/), an attacker floods the DHCP server with requests that consume all available IP addresses that can be allocated. Once the network’s legitimate DHCP server is completely tied up, the attacker can then have their rogue DHCP server respond to all pending requests.

“This technique can also be used against an already established VPN connection once the VPN user’s host needs to renew a lease from our DHCP server,” the researchers wrote. “We can artificially create that scenario by setting a short lease time in the DHCP lease, so the user updates their routing table more frequently. In addition, the VPN control channel is still intact because it already uses the physical interface for its communication. In our testing, the VPN always continued to report as connected, and the kill switch was never engaged to drop our VPN connection.”

The researchers say their methods could be used by an attacker who compromises a DHCP server or wireless access point, or by a rogue network administrator who owns the infrastructure themselves and maliciously configures it. Alternatively, an attacker could set up an “[evil twin](https://www.techtarget.com/searchsecurity/definition/evil-twin)” wireless hotspot that mimics the signal broadcast by a legitimate provider.

## ANALYSIS

**Bill Woodcock** is executive director at [Packet Clearing House](http://www.pch.net), a nonprofit based in San Francisco. Woodcock said Option 121 has been included in the DHCP standard since 2002, which means the attack described by Leviathan has technically been possible for the last 22 years.

“They’re realizing now that this can be used to circumvent a VPN in a way that’s really problematic, and they’re right,” Woodcock said.

Woodcock said anyone who might be a target of spear phishing attacks should be very concerned about using VPNs on an untrusted network.

“Anyone who is in a position of authority or maybe even someone who is just a high net worth individual, those are all very reasonable targets of this attack,” he said. “If I were trying to do an attack against someone at a relatively high security company and I knew where they typically get their coffee or sandwich at twice a week, this is a very effective tool in that toolbox. I’d be a little surprised if it wasn’t already being exploited in that way, because again this isn’t rocket science. It’s just thinking a little outside the box.”

Successfully executing this attack on a network likely would not allow an attacker to see all of a target’s traffic or browsing activity. That’s because for the vast majority of the websites visited by the target, the content is encrypted (the site’s address begins with https://). However, an attacker would still be able to see the metadata — such as the source and destination addresses — of any traffic flowing by.

KrebsOnSecurity shared Leviathan’s research with [John Kristoff](https://www.netscout.com/asert/john-kristoff), founder of [dataplane.org](https://dataplane.org/) and a PhD candidate in computer science at the **University of Illinois Chicago**. Kristoff said practically all user-edge network gear, including WiFi deployments, support some form of rogue DHCP server detection and mitigation, but that it’s unclear how widely deployed those protections are in real-world environments.

“However, and I think this is a key point to emphasize, an untrusted network is an untrusted network, which is why you’re usually employing the VPN in the first place,” Kristoff said. “If [the] local network is inherently hostile and has no qualms about operating a rogue DHCP server, then this is a sneaky technique that could be used to de-cloak some traffic – and if done carefully, I’m sure a user might never notice.”

## MITIGATIONS

According to Leviathan, there are several ways to minimize the threat from rogue DHCP servers on an unsecured network. One is using a device powered by the **Android** operating system, which apparently ignores DHCP option 121.

Relying on a temporary wireless hotspot controlled by a cellular device you own also effectively blocks this attack.

“They create a password-locked LAN with automatic network address translation,” the researchers wrote of cellular hot-spots. “Because this network is completely controlled by the cellular device and requires a password, an attacker should not have local network access.”

Leviathan’s Moratti said another mitigation is to run your VPN from inside of a virtual machine (VM) — like Parallels, VMware or VirtualBox. VPNs run inside of a VM are not vulnerable to this attack, Moratti said, provided they are not run in “[bridged mode](https://www.virtualbox.org/manual/ch06.html#network_bridged),” which causes the VM to replicate another node on the network.

In addition, a technology called “deep packet inspection” can be used to deny all in- and outbound traffic from the physical interface except for the DHCP and the VPN server. However, Leviathan says this approach opens up a potential “side channel” attack that could be used to determine the destination of traffic.

“This could be theoretically done by performing traffic analysis on the volume a target user sends when the attacker’s routes are installed compared to the baseline,” they wrote. “In addition, this selective denial-of-service is unique as it could be used to censor specific resources that an attacker doesn’t want a target user to connect to even while they are using the VPN.”

Moratti said Leviathan’s research shows that many VPN providers are currently making promises to their customers that their technology can’t keep.

“VPNs weren’t designed to keep you more secure on your local network, but to keep your traffic more secure on the Internet,” Moratti said. “When you start making assurances that your product protects people from seeing your traffic, there’s an assurance or promise that can’t be met.”

A copy of Leviathan’s research, along with code intended to allow others to duplicate their findings in a lab environment, is available [here](https://www.leviathansecurity.com/blog/tunnelvision).

*This entry was posted on Monday 6th of May 2024 10:24 AM*

[A Little Sunshine](https://krebsonsecurity.com/category/sunshine/) [Latest Warnings](https://krebsonsecurity.com/category/latest-warnings/) [The Coming Storm](https://krebsonsecurity.com/category/comingstorm/) [Web Fraud 2.0](https://krebsonsecurity.com/category/web-fraud-2-0/)
[Bill Woodcock](https://krebsonsecurity.com/tag/bill-woodcock/) [Dani Cronce](https://krebsonsecurity.com/tag/dani-cronce/) [DHCP option 121](https://krebsonsecurity.com/tag/dhcp-option-121/) [DHCP starvation attack](https://krebsonsecurity.com/tag/dhcp-starvation-attack/) [Dynamic Host Control Protocol](https://krebsonsecurity.com/tag/dynamic-host-control-protocol/) [John Kristoff](https://krebsonsecurity.com/tag/john-kristoff/) [Leviathan Security](https://krebsonsecurity.com/tag/leviathan-security/) [Lizzie Moratti](https://krebsonsecurity.com/tag/lizzie-moratti/) [Packet Clearing House](https://krebsonsecurity.com/tag/packet-clearing-house/)

Post navigation
[← Man Who Mass-Extorted Psychotherapy Patients Gets Six Years](https://krebsonsecurity.com/2024/04/man-who-mass-extorted-psychotherapy-patients-gets-six-years/)
[U.S. Charges Russian Man as Boss of LockBit Ransomware Group →](https://krebsonsecurity.com/2024/05/u-s-charges-russian-man-as-boss-of-lockbit-ransomware-group/)

## 44 thoughts on “Why Your VPN May Not Be As Secure As It Claims”

1. RWKOS [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609286)

   Would be interested to understand what effect this has on Apple+ Private Relay running on iOS and macOS.

   1. PHP [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609323)

      Apple+ private relay is, as far as I understand it, web proxies. Not VPN or VPN like.

      But the obvious choice as a hacker would be to generate routes to subnets not including RFC-1918 addresses. Then most VPNs towards company resources would still work.

      As a user, you should use DNS over HTTPS, and a proxy server with 2-way encryption / authentication. Then your web traffic would be tunnelled

      The VPN is really there for other purposes. It was designed to reach internal resources/small subnets, to which nobody else has access. Thus if somebody announces a 10.0.0.0/8 route, your would lose your access to the protected resourced.
3. Steve [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609287)

   I’m not looking forward to how my company’s security division will react to this. Of course, the real question is how long ago hackers figured out this weakness. Great reporting, Brian.
5. Jokerstein [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609288)

   I’ve reached out to Proton to ask about this in ProtonVPN.

   1. Wannabe Techguy [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609295)

      That’s what I use too. I have to wonder if a VPN is worth bothering with.
7. Charles Mills [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609289)

   Of course, the BIG insecurity with VPNs is that you are trusting the VPN vendor. It sees all of your traffic, totally unencrypted. For a free VPN, consider the basic Internet rule: if you’re not paying, you’re not the customer; you must be the merchandise.

   1. Clown [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609328)

      You do realize a VPN does not always mean a service bought or gotten free of monetary chargefrom an obscure vendor to “hide from spying on the Internet”? That millions of people use a VPN for work, set up by their employer for the purpose of securely accessing their employer’s internal resources?

      1. Jojo [May 23, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609889)

         But perhaps those employee internal resources are worth looking at for those who gather corporate intelligence? Such knowledge may even point to other weaknesses in that company network that could be taken advantage of.
9. Joe [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609292)

   This compromises routing-based VPNs, which set up routing rules to direct traffic through a virtual VPN interface rather than through the usual physical network interface. The compromise uses DHCP Option 121 to modify the routing table by adding more-specific routes than those set up by the VPN. Because more-specific routes have higher priority when routing, they are used to route traffic for specific IP addresses or address ranges through the physical network interface instead of through the VPN, thus exposing the traffic.

   Would it be possible to write a program to examine the routing table after each DHCP renewal, detect such situations, and alert the user and/or delete the more-specific routes? (That would require knowledge of exactly how the VPN software sets up the routing, which might only be known to the VPN software itself.)
11. Anon [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609294)

    Is this the down fall of internet threats?
13. plinker [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609296)

    My father told me many years ago that there was never a safe built that man could not get into. Forward many years and we see the same thing with the digital communication. The biggest problem is people doing unsafe things by going places not secure, even so called secure places could be compromised. This is the new world so we have to be aware what we do
15. netseceng\_ct [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609298)

    This will only work if the client-to-site VPN provider’s network is compromised or, in the case of work-based VPNs, your corporate network has already been compromised. Even then, it is much more complex than shown above when dealing with Internet IP addressing/routing and/or client-to-site VPN devices (appliances).

    DHCP, a BROADCAST protocol by nature, is unable to extend beyond the local network range without the inclusion of helper statements on a routing device. In the context of client-to-site VPNs, DHCP is typically managed by the same VPN concentrator, firewall, SSL VPN concentrator, or other client-to-site VPN device (appliances). These devices issue a DHCP lease only after proper authentication, and the DHCP request is transmitted solely during the tunnel build, never on the local network .

    If your provider is not following this Network Security 101 best practice, then use at your own risk.

    1. Mela Y [May 24, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609930)

       No, watch the Leviathan presentation. The VPN provider’s network doesn’t have anything to do with it. It is the Local network. So the coffee shop Wifi network or your home local network. This is not about the routes that the VPN gives the client. Its about the routes received from the local DHCP server having a higher priority.
17. Peter [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609303)

    I feel like I’m missing something here between all the panic I see going on across various talking heads. My VPN client connects to my VPN concentrator to establish a full tunnel connection and both auth via strong mechanisms to each other (two factor with physical tokens), wtf do I care if the full local network has been compromised, that’s the entire point of why we use VPNs, because we expect local compromised networks. I’m pretty sure Tor doesn’t care either.

    1. Aksel [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609314)

       If you are sure that your VPN concentrator is being strongly authenticated then this vulnerability does not apply to you
    3. Don [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609342)

       You power up your laptop in your local network. It receives a DHCP assignment from the compromised DHCP server, using option 121 to set itself as a gateway, with all traffic routed to the DHCP server. You kick off your VPN client, and it goes through the DHCP server as gateway to get to your VPN provider. You are authenticated and the tunnel is established. You bring up a browser and navigate to a site of your choosing, but you laptop is now configured to send all traffic directly to the DHCP server as gateway, not to the VPN-provided gateway that is normally there for the virtual interface on your laptop. All your network traffic goes through the DHCP server, but not through your VPN tunnel. You have the tunnel and all your traffic going through the DHCP server, but your traffic is not taking the tunnel.
    5. Ehud Gavron [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609344)

       When you say “afull tunnel connection…” you’re really saying “a secure mechanism to send default IP traffic to.”

       DHCP Option 121 allows the DHCP server (or a rogue one) to give your routing kernel MORE SPECIFIC ROUTES, and the way IP route selection works, the most specific routes are used. The default route (the one through your “full tunnel connection”) is the ROUTE OF LAST RESORT.

       To make this clear in an example. You connect your “full tunnel connection” and now have a default route, or ROUTE OF LAST RESORT through that tunnel. You also have a local route from the address you got at the coffeeshop to the coffeeshop router. If you didn’t have that, once the VPN came up your routing kernel would no longer know how to talk to the net… and the VPN would drop, rinse, repeat.

       DHCP option 121 allows adding a route for you to, say, whatever IP <http://www.bankofamerica.com> is. That means for all traffic other than that going to <http://www.bankofamerica.com>‘s IP you’ll go through the default route and the VPN. But if you go to the BofA one… it will go to the destination the option 121 route gave you, on the local coffeeshop LAN, where it can be intercepted, stored, forwarded, so you think you’re going through the tunnel, but you’re not.

       I hope that helps.
    7. storm shadow [May 9, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609433)

       2 cents, can’t this be disabled via gpo, rules or manually turned off,

       this dhcp option 121 like LMHost without breaking any dependencies?

       same with any virtual dhcp on vital servers or vip devices?

       If this is needed for whatever reason put a canary checker on this when activated.
19. Doug In MKE [May 6, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609315)

    I wonder whether VPN services which offer Dedicated IP (such as NordVPN) would be less vulnerable, since, it seems, there seem to be no other users who’d have the capability to share the same user- and IP Address-space.

    1. IT [May 12, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609534)

       My friend bought his laptop from Best Buy and I think they sold the same IP address to both of us.
21. Fr00tL00ps [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609316)

    For the uninitiated it’s important to note; as advised on other forums;

    ” it’s important to clarify the use of the term “VPN” here. This affects “VPNs” used for anonymizing internet traffic or for geofence defeating on streaming services and such. It should not impact VPNs used to access private networks via the Internet.

    For example, if you use a VPN to connect to your home network and access machines inside your LAN that are not directly exposed to the internet, this won’t affect that at all. It only affects VPN setups that redirect all Internet traffic via the VPN.

    You may also be able to partially defeat it by not using a /0 route. You could instead do four routing entries with /2 networks. Of course, if the hacker sets up their network the same way, this could also be defeated. “

    1. Mela Y [May 24, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609931)

       Not necessarily. It might need to be a more targeted attack. Whereas the Internet-bound traffic can be somewhat decloaked by snooping DNS alone, the attacker may just need to know and create routes for specific home network IPs.

       The biggest impact for this attack may be for those wanting to hide metadata (what sites being visited) from the local area network. But that is only because there is an assumed TLS layer of encryption.

       This attack can still compromise people using a VPN to their home network. For one, many locally hosted services at home, they don’t use TLS at all. Or at best a self-signed cert with no HSTS or pinning where a MITM can easily intercept all traffic as plaintext.
23. e fromme [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609331)

    One has to understand, why would anyone want to crack your VPN network? What is it that they are so enthralled with? Your porn watching habits perhaps? Or do you think big brother is watching you all the time, trying to conjure up something to arrest you for something, while going about your boring daily existence. Are you so vain to think your social media (there’s nothing social about social media BTW) presence has national security consequences? Me, I’m an old man who just reads the news, places bets on the stock market and orders a lot of stupid stuff via amazon . I peruse the internet daily, bemoaning the stupidity and arrogance of youth, of politicians (at least as the media portrays them), and the waste of words and bandwidth the media spends on the Kadasians and Markle. God help us. I have little to hide, just that bank account in the Bahamas, from the IRS. Lol.

    1. NotReally InFrance [May 10, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609493)

       Your “why hide?” question is what many people ask when they don’t understand the actual threats. Collection of data allows for various things… marketing, deceptive marketing, guessing of behavior and passwords, impersonation, framing people for things they didn’t do, possibly breaking into their accounts, impersonation (even better with access to their accounts), re-selling their information and accounts, and so on. Just because normal people aren’t interesting does not mean they are worthless for attacks, extortion, or stealing their info/accounts. For some attackers, the point would not be to target and circumvent VPN traffic but to prevent it from working whether a target uses a VPN or not.

       For a comparison, some people say that if a robber wants to get in your house, they can. Most people don’t leave their doors open with signs on their front walls saying that their doors are unlocked because SOME security is better than allowing every bad thing to happen because it could happen.

       1. IT [May 12, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609535)

          Most people that use VPNs are perverts and criminals. Not everyone that uses a VPN is a pervert or a criminal, but almost all criminals use a VPN. If someone says to me that they are using a VPN I assume they are doing something illegal. I didn’t hire someone a few months ago because I saw he had Mullvad when he shared his screen so I knew the kinds of things he was doing

          1. Fr00tL00ps [May 15, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609661)

             “I didn’t hire someone a few months ago because I saw he had Mullvad when he shared his screen”

             I hope you don’t work in Cyber Security, because if you do, sadly that is your loss. Anyone who uses a VPN in their home environment, in my eyes, is someone who takes their personal/private security seriously. And by that logic they would bring that mindset into their workplace, which is a good thing. Not everyone has criminal intent. You are making ignorant assumptions to your own detriment. Sigh.
    3. NotReally InFrance [May 10, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609496)

       For E Fromme and similar users, your “why hide?” question is what many people ask when they don’t understand the actual threats. Collection of data allows for various things… marketing, deceptive marketing, guessing of behavior and passwords, impersonation, framing people for things they didn’t do, possibly breaking into their accounts, impersonation (even better with access to their accounts), re-selling their information and accounts, and so on. Just because normal people aren’t interesting does not mean they are worthless for attacks, extortion, or stealing their info/accounts. Even boring people may have accounts, friends, relatives, and jobs. For some attackers, the point would not just be to target and circumvent VPN traffic but to prevent such a VPN from working whether a target uses a VPN or not.

       Considering this other cliche, some people say that if a robber wants to get in your house, they can get in. Most people don’t leave their doors open with signs on their front walls saying that their doors are unlocked because SOME security is better than ALLOWING every bad thing to happen because it COULD happen. Similarly, the recommendations to disable adblock, disable firewalls, and uninstall antivirus programs because they “get in the way” are (to me) recommendations to play in traffic, with sick and stupid friends, never wearing a mask, and to do other dangerous pranks, and generally have no regard for safety because being smart is “inconvenient”. Any person or company that prevents the use of protections like adblock is an advocate for information misuse and (knowingly or not) is willing to sacrifice user privacy and safety for the profits and happiness of their webmasters and advertising associates. Attacks in simple web traffic (with web pages and such) include cross-site exploits and attacks directly on browsers, which ad-hosts can knowingly or unknowingly publish.

       1. viva la mel gibson, debbie gibson, truth, and your mom being happy for a brighter future for her kids [May 13, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609583)

          well said NotREally InFRance

          the borg is real
    5. CaptainGato [May 13, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609588)

       please give a TED talk and award yourself a medal of honor

       your kids will thank you for making the world a better place
    7. CaptainGato [May 13, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609589)

       please give a TED talk and award yourself a medal of honor,

       the future will thank you for making the world a better place
    9. Mela Y [May 24, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609933)

       @e fromme

       Talk to a threat intel analyst or a red teamer about about what you really need to be worried about.

       Just from your one paragraph, and with no personal interest in you, an attacker can be highly motivated to target you just to make money. So lets break it down…

       “I’m an old man who just reads the news, places bets on the stock market and orders a lot of stupid stuff via amazon”

       An attacker could target you and your stock broker(s). With this TunnelVision attack, they will quickly find out where you trade stocks. They find out the authentication methods available from them, and if 2FA is likely will find out your mobile provider too as to bribe your mobile carrier to SIM swap you.

       If they correlate with your email or phone number, they will send you text, emails and phone calls that convince you to click on their phishing page with a convincing login page. Or maybe they will hit you with ads for their “investment opportunities”. They can tailor their scams to match sites and services you have visited or apps/tabs that run in the background.
25. [Catwhisperer](https://happycattech.com) [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609337)

    Isn’t this resolved by setting static addresses that don’t expire? If all the devices on the network are on static addresses how would someone cause DHCP renewal?

    1. lowest on the totem pole [May 13, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609582)

       Static addresses can be cloned or man in the middle. For vip users, use a yubi key with assigned static ip with mac address then static ip address lease time outs. So when they need complain about not being about to connect only reconnect via direct verified phone conversation and checking of mac address filtering, dns check, reverse dns check.
27. Barry Suskind [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609345)

    Some VPN services I’ve find didn’t redirect DNS so even if they used the tunnel, they still made requests to the provider or whomever the system DNS used.

    Also, don’t think a VPN offers privacy. As soon as you launch a browser or apps on your phone lots of data is shared and a VPN doesn’t protect that.

    Last and most important. If your company uses a containerized approach to BYOD that approach also may use a VPN to decide how to route traffic. However, traffic like to O365 could go direct so any app defined in the BYOD service regardless of using the container’s VPN or not will NOT use you private VPN and will send out traffic directly. I verified this on my phone as still rely on the BlackBerry UEM services
29. ANKIT KUMAR SHARMA [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609350)

    Can’t we use DHCP snooping and Dynamic arp inspection to secure the network from such attack. it worked well to protect the network from malicious actor. In addition we can use mac-address-sticky as well so that no one can a rogue device on the network.
31. [James Cridland](https://james.cridland.net) [May 7, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609368)

    >> Successfully executing this attack on a network likely would not allow an attacker to see all of a target’s traffic or browsing activity. That’s because for the vast majority of the websites visited by the target, the content is encrypted (the site’s address begins with <https://>). However, an attacker would still be able to see the metadata — such as the source and destination addresses — of any traffic flowing by.

    To be boringly pedantic, this isn’t entirely true. The attacker would be able to see the source and destination DOMAINS, but wouldn’t be able to see the “addresses”, as defined in this paragraph.

    So, you’d be able to see that someone visited example.com but you don’t know if they visited example.com/krebs-is-nice or example.com/krebs-is-nasty . Domain names are \*never\* encrypted, even with HTTPS.

    I now win the prize for the most pedantic post ever made.

    1. Mela Y [May 24, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609932)

       Even more pedantic… the “addresses” as defined in the paragraph and entire article… is the “IP Address”. What you are describing is called the URL or web “page”.
33. schorsch [May 8, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609384)

    You name option 121 an ‘obscure feature’. But it really is not obscure. Neither in the sense, that it is hidden nor in the sense, that it’s use is a warning sign or even unusual. It may be a rarely used, a rarely known feature. But it’s surely not obscure.

    If you have several clients in a common address range, but this clients shall have different privileges, classless routing has very potent abilities. You could reach your goals by other means, you could use different address ranges – but when I first learned of option 121, it’s simplicity and elegance was simply convincing.
35. No Data [May 8, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609388)

    @ e fromme

    Maybe your comment “Why would anyone want to crack your VPN network? What is it that they are so enthralled with?” was meant ironically. I just wanted to point out that there are many types of hackers, not just ones who go after your money. There are also hackers who are stalkers and think they own their victims and will go to extreme lengths to gain and maintain control over their victims machines, network and dataflow. As a victim of (group) cyber stalking, I experience the toll this takes on my life (or what’s left of it) every single day, including financial strain, social isolation and constant fear. And If I had the choice I’d prefer a hacker who’s after my money any day, instead of living this nightmare that just goes on endlessly. At least then a victim can prove something and there’s more dignity in being a thief than stalking a hacker inflicting mental en emotional cruelty just for the fun of it. So yes, there are definitely people who want to crack your VPN network. And for you security men and women trying to fix vulnerabilities like this. You do this stuff for people like me, your work matters and is important!

    1. Reilly Sands [May 12, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609528)

       So the world revolves around No Data huh? So you’re a victim huh? What did you do to incur the wrath of a group od stalkers? Piss them off you did? Think long and hard before you use the internet to expound you opinions and beliefs. As the guy wrote, social media is not social. And no, you don’t have a God, or constitutional, given right to be free of criticism and hate on the internet.
37. Mylifeinabox [May 8, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609400)

    @ E fromme; Maybe your comment “Why would anyone want to crack your VPN network? What is it that they are so enthralled with?” was meant ironically. I just wanted to point out that there are many types of hackers, not just ones who go after your money. There are also hackers who are stalkers and think they own their victims and will go to extreme lengths to gain and maintain control over their victims machines, network and data flow. As a victim of (group) cyber stalking, I experience the toll this takes on my life (or what’s left of it) every single day, including financial strain, social isolation and constant fear. And If I had the choice I’d prefer a hacker who’s after my money any day, instead of living this nightmare that just goes on endlessly. At least then a victim can prove something and there’s more dignity in being a thief than stalking a hacker inflicting mental en emotional cruelty just for the fun of it. So yes, there are definitely people who want to crack your VPN network. And for you security men and women fixing vulnerabilities like this, many thanks for your efforts! Your work is important especially for people like me.

    1. NotReally InFrance [May 10, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609495)

       For Mylifeinabox here, this is a sad but true example: someone knows about the issues while being (or because of being) a victim. Most people are probably happy being as blissfully ignorant as “E fromme”, with social media posts detailing their actual lives and trivial activities, real name on LinkedIn, posting their resumes in hopes of actual offers without worrying that they could be used as targets within their current companies, have their identities stolen, have their accounts breached because major companies and service providers mistake “public record” information for “private information suitable for identity verification”. As for data collection, the potential for misuse is unlimited and overlapping. If a group of tech thugs steals private information, they can use it for breaking into accounts, sell info for profit, and threaten the victim with the release of private info, known passwords, and reporting them for real/false/staged crimes.
39. Ben [May 20, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609791)

    I see VPN as just retail marketing it’s a subscription based product that’s not needed. It’s too complicated for an average user. Similar products Lifelock and anti virus are marketed to take your money I’ll pass.

    1. Mela Y [May 24, 2024](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/#comment-609934)

       VPN has a very narrow set of benefits. The problem is indeed the marketing gets broad and over-simplifies a very complex topic.

       A VPN is supposed to provide extra protection from the potentially untrusted local network and their ISP. Once the traffic hits the VPN provider, it will no longer have that protection through most of the untrusted journey to the destination.

       As it relates to this article, the issue is that a compromised server on the untrused local network can decloak the traffic when it was expected to be secure.

Comments are closed.

Advertisement[![](/b-nyu/17.png)](https://cybersecurity-strategy-masters.nyu.edu/)

Advertisement

Mailing List

[Subscribe here](/subscribe/)

Search KrebsOnSecurity

Search for:

Recent Posts

* [A Day in the Life of a Prolific Voice Phishing Crew](https://krebsonsecurity.com/2025/01/a-day-in-the-life-of-a-prolific-voice-phishing-crew/)
* [U.S. Army Soldier Arrested in AT&T, Verizon Extortions](https://krebsonsecurity.com/2024/12/u-s-army-soldier-arrested-in-att-verizon-extortions/)
* [Happy 15th Anniversary, KrebsOnSecurity!](https://krebsonsecurity.com/2024/12/happy-15th-anniversary-krebsonsecurity/)
* [Web Hacking Service ‘Araneida’ Tied to Turkish IT Firm](https://krebsonsecurity.com/2024/12/web-hacking-service-araneida-tied-to-turkish-it-firm/)
* [How to Lose a Fortune with Just One Bad Click](https://krebsonsecurity.com/2024/12/how-to-lose-a-fortune-with-just-one-bad-click/)

Story Categories

* [A Little Sunshine](https://krebsonsecurity.com/category/sunshine/)
* [All About Skimmers](https://krebsonsecurity.com/category/all-about-skimmers/)
* [Ashley Madison breach](https://krebsonsecurity.com/category/ashley-madison-breach/)
* [Breadcrumbs](https://krebsonsecurity.com/category/breadcrumbs/)
* [Data Breaches](https://krebsonsecurity.com/category/data-breaches/)
* [DDoS-for-Hire](https://krebsonsecurity.com/category/ddos-for-hire/)
* [Employment Fraud](https://krebsonsecurity.com/category/employment-fraud/)
* [How to Break Into Security](https://krebsonsecurity.com/category/how-to-break-into-security/)
* [Internet of Things (IoT)](https://krebsonsecurity.com/category/internet-of-things-iot/)
* [Latest Warnings](https://krebsonsecurity.com/category/latest-warnings/)
* [Ne'er-Do-Well News](https://krebsonsecurity.com/category/neer-do-well-news/)
* [Other](https://krebsonsecurity.com/category/other/)
* [Pharma Wars](https://krebsonsecurity.com/category/pharma-wars/)
* [Ransomware](https://krebsonsecurity.com/category/ransomware/)
* [Russia's War on Ukraine](https://krebsonsecurity.com/category/russias-war-on-ukraine/)
* [Security Tools](https://krebsonsecurity.com/category/security-tools/)
* [SIM Swapping](https://krebsonsecurity.com/category/sim-swapping/)
* [Spam Nation](https://krebsonsecurity.com/category/spam-nation/)
* [Target: Small Businesses](https://krebsonsecurity.com/category/smallbizvictims/)
* [Tax Refund Fraud](https://krebsonsecurity.com/category/tax-refund-fraud/)
* [The Coming Storm](https://krebsonsecurity.com/category/comingstorm/)
* [Time to Patch](https://krebsonsecurity.com/category/patches/)
* [Web Fraud 2.0](https://krebsonsecurity.com/category/web-fraud-2-0/)

Why So Many Top Hackers Hail from Russia

[![](https://krebsonsecurity.com/wp-content/uploads/2017/06/computered-580x389.png)](https://krebsonsecurity.com/2017/06/why-so-many-top-hackers-hail-from-russia/)

© Krebs on Security - [Mastodon](https://infosec.exchange/%40briankrebs)



=== Content from bst.cisco.com_1564493d_20250111_135236.html ===




=== Content from support.citrix.com_0b74acaf_20250111_135245.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from www.theregister.com_7a59378e_20250111_135247.html ===


[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_extents_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/user_icon_white_filled_extents_16x16.png)
Sign in / up](https://account.theregister.com/register/)

[![The Register® — Biting the hand that feeds IT](/design_picker/fa16d26efb42e6ba1052f1d387470f643c5aa18d/graphics/std/reg_logo_no_strapline.png)](https://www.theregister.com/)

[![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/std/magnifying_glass_white_extents_16x16.png)](https://search.theregister.com/)

![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_16x16.png)
![](/design_picker/ae01b183a707a7db8cd5f2c947715ed56d335138/graphics/icon/burger_menu_white_close_16x16.png)

## Topics

[Security](#subnav-box-nav-security)
## [Security](#subnav-box-nav-security)

[All Security](https://www.theregister.com/security/)[Cyber-crime](https://www.theregister.com/security/cyber_crime/)[Patches](https://www.theregister.com/security/patches/)[Research](https://www.theregister.com/security/research/)[CSO](https://www.theregister.com/security/cso/)
[(X)](#masthead)

[Off-Prem](#subnav-box-nav-off_prem)
## [Off-Prem](#subnav-box-nav-off_prem)

[All Off-Prem](https://www.theregister.com/off_prem/)[Edge + IoT](https://www.theregister.com/off_prem/edge_iot/)[Channel](https://www.theregister.com/off_prem/channel/)[PaaS + IaaS](https://www.theregister.com/off_prem/paas_iaas/)[SaaS](https://www.theregister.com/off_prem/saas/)
[(X)](#masthead)

[On-Prem](#subnav-box-nav-on_prem)
## [On-Prem](#subnav-box-nav-on_prem)

[All On-Prem](https://www.theregister.com/on_prem/)[Systems](https://www.theregister.com/on_prem/systems/)[Storage](https://www.theregister.com/on_prem/storage/)[Networks](https://www.theregister.com/on_prem/networks/)[HPC](https://www.theregister.com/on_prem/hpc/)[Personal Tech](https://www.theregister.com/on_prem/personal_tech/)[CxO](https://www.theregister.com/on_prem/cxo/)[Public Sector](https://www.theregister.com/on_prem/public_sector/)
[(X)](#masthead)

[Software](#subnav-box-nav-software)
## [Software](#subnav-box-nav-software)

[All Software](https://www.theregister.com/software/)[AI + ML](https://www.theregister.com/software/ai_ml/)[Applications](https://www.theregister.com/software/applications/)[Databases](https://www.theregister.com/software/databases/)[DevOps](https://www.theregister.com/software/devops/)[OSes](https://www.theregister.com/software/oses/)[Virtualization](https://www.theregister.com/software/virtualization/)
[(X)](#masthead)

[Offbeat](#subnav-box-nav-offbeat)
## [Offbeat](#subnav-box-nav-offbeat)

[All Offbeat](https://www.theregister.com/offbeat/)[Debates](https://www.theregister.com/Debates/)[Columnists](https://www.theregister.com/offbeat/columnists/)[Science](https://www.theregister.com/offbeat/science/)[Geek's Guide](https://www.theregister.com/offbeat/geeks_guide/)[BOFH](https://www.theregister.com/offbeat/bofh/)[Legal](https://www.theregister.com/offbeat/legal/)[Bootnotes](https://www.theregister.com/offbeat/bootnotes/)[Site News](https://www.theregister.com/offbeat/site_news/)[About Us](https://www.theregister.com/offbeat/about_us/)
[(X)](#masthead)

[Special Features](#subnav-box-nav-special_features)
## Special Features

[All Special Features](https://www.theregister.com/special_features)
[The Future of the Datacenter](https://www.theregister.com/special_features/future_of_the_datacenter)
[Cybersecurity Month](https://www.theregister.com/special_features/cybersecurity_month)
[VMware Explore](https://www.theregister.com/special_features/vmware_explore)
[Cloud Infrastructure Month](https://www.theregister.com/special_features/cloud_infrastructure_month)

## Vendor Voice

[Vendor Voice](#subnav-box-nav-tag-vendor-voice)
## [Vendor Voice](#subnav-box-nav-tag-vendor-voice)

[All Vendor Voice](https://www.theregister.com/VendorVoice/)
[Pure Storage](https://www.theregister.com/VendorVoice/pure_storage_portworx/)
[Kilka Tech](https://www.theregister.com/VendorVoice/aws_klika_tech/)
[HERE and AWS](https://www.theregister.com/VendorVoice/aws_here/)
[Vonage](https://www.theregister.com/VendorVoice/aws_vonage/)
[GE Vernova with AWS](https://www.theregister.com/VendorVoice/aws_ge_vernova_manufacturing/)
[Amazon Web Services (AWS) New Horizon in Cloud Computing](https://www.theregister.com/VendorVoice/aws_new_horizon_solutions/)
[DDN](https://www.theregister.com/VendorVoice/ddn/)
[Google Cloud Data Transformation](https://www.theregister.com/VendorVoice/google_cloud_data_transformation/)
[Google Gemini](https://www.theregister.com/VendorVoice/google_gemini/)
[Hewlett Packard Enterprise: Edge-to-Cloud Platform](https://www.theregister.com/VendorVoice/hpe_greenlake/)
[Intel vPro](https://www.theregister.com/VendorVoice/intelvpro/)
[VMware](https://www.theregister.com/VendorVoice/vmware/)
[(X)](#masthead)

[Resources](#subnav-box-nav-resources)
## Resources

[Whitepapers](https://whitepapers.theregister.com/)
[Webinars & Events](https://whitepapers.theregister.com/events/list/)
[Newsletters](https://account.theregister.com/edit/newsletter/)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

#### [Spotlight on RSA](/special_features/spotlight_on_rsa/)

[**34**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2024/05/07/vpn_tunnelvision_dhcp/ "View comments on this article")

# Watch out for rogue DHCP servers decloaking your VPN connections

[**34**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)](https://forums.theregister.com/forum/all/2024/05/07/vpn_tunnelvision_dhcp/ "View comments on this article")

## Avoid traffic-redirecting snoops who have TunnelVision

![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_red.svg)
[Brandon Vigliarolo](/Author/Brandon-Vigliarolo "Read more by this author")

Tue 7 May 2024  //
21:50 UTC

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)

A newly discovered vulnerability undermines countless VPN clients in that their traffic can be quietly routed away from their encrypted tunnels and intercepted by snoops on the network.

Dubbed [TunnelVision](https://www.tunnelvisionbug.com/) by the eggheads at Leviathan Security Group who uncovered and [documented](https://www.leviathansecurity.com/blog/tunnelvision) it, the technique ([CVE-2024-3661](https://nvd.nist.gov/vuln/detail/CVE-2024-3661)) can result in a VPN user believing their connection is properly secured, and being routed through an encrypted tunnel as usual, while an attacker on their network has instead redirected their connections so that it can be potentially inspected.

To make matters worse, the issue involves DHCP, meaning it mostly doesn't matter which VPN is being used or what OS it's running on - you're probably vulnerable. Unless you're on Android; more on that later.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=2&c=2Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D2%26raptor%3Dcondor%26pos%3Dtop%26test%3D0)

"Furthermore, the strength of the encryption algorithm a VPN uses makes no difference," Leviathan Security noted. "TunnelVision's effect is independent of the underlying VPN protocol because it reconfigures the operating system network stack the VPN relies on."

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D426raptor%3Dfalcon%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D4%26raptor%3Dfalcon%26pos%3Dmid%26test%3D0)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)

Anyone who is able to operate a DHCP server on the same network as someone using a VPN, and get that VPN client's machine to use that DHCP server, can decloak their traffic because of a particular feature in the configuration protocol: option [121](https://techhub.hpe.com/eginfolib/networking/docs/switches/12500/5998-4863_l3-ip-svcs_cg/content/378497849.htm#:~:text=Option%20121%E2%80%94Classless%20route%20option,add%20to%20its%20routing%20table.), which allows administrators to add classless static routes to client routing tables.

As Leviathan Security put it, to exploit someone's VPN client:

The targeted host must accept a DHCP lease from the attacker-controlled server.

The targeted host’s DHCP client must implement DHCP option 121.

Said DHCP server could be on a public network, such as some airport or hotel Wi-Fi. That DHCP system could be run by a crooked net administrator although the Leviathan team explained how anyone else on the network could set up a DHCP server to undermine VPN clients on that LAN, by suggesting the following three scenarios:

1. A rogue DHCP server using a DHCP starvation attack against the true DHCP, then responding to new clients. We have achieved this in lab environments and are working on a follow-up blog post.

2. A rogue DHCP server racing to respond to DHCPDISCOVER broadcasts to abuse DHCP clients’ common behavior where they implement first-offer lease selection.

3. ARP spoofing to intercept traffic between the true DHCP server and client, then waiting for a client to renew their lease.

Once a miscreant is in a position to issue DHCP leases to a target's machine, they can use option 121 to force all data - even traffic that's supposed to be destined for a VPN tunnel - through a gateway set up by the DHCP server and then read whatever traffic they can.

As always with VPN security issues, if an eavesdropper intercepts your, say, HTTPS/TLS or SSH encrypted connections, that snoop can't easily read the content of those connections; anything going plain text through your tunnel can be accessed by the snoop, though.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D426raptor%3Dfalcon%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=4&c=44Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D4%26raptor%3Dfalcon%26pos%3Dmid%26test%3D0)

"Most users who use commercial VPNs are sending web traffic which is mostly HTTPS," as Leviathan's Dani Cronce and Lizzie Moratti put it. "HTTPS traffic looks like gibberish to attackers using TunnelVision. But they know who you are sending that gibberish to which can be an issue."

In Cronce and Moratti's testing, their VPN software never reported an issue with the connection, and kill switches that were supposed to flip when the VPN routes were interrupted were never triggered.

This isn't a particularly new issue, either. "We … believe this technique may have been possible as far back as 2002 and could have already been discovered and potentially used in the wild," the duo said, adding that their work is an evolution of the [TunnelCrack](https://www.theregister.com/2023/08/10/tunnelcrack_vpn/) exploit we covered last year among other prior research.

### Very Public Networks

As mentioned above, the type of VPN targeted by TunnelVision doesn't really matter, and in all but a single case the operating system doesn't matter either. Android users are safe because the OS doesn't support DHCP option 121.

So, what can be done to protect VPN users, who are seeming quite vulnerable in light of this discovery? That's tricky.

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=3&c=33Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D3%26raptor%3Deagle%26pos%3Dmid%26test%3D0)

"TunnelVision doesn't rely on violating any security properties of the underlying technologies," the researchers noted. "From our perspective, TunnelVision is how DHCP, routing tables, and VPNs are intended to work."

The only true solution, for Linux folk anyway, is to [enable](https://www.wireguard.com/netns/#the-new-namespace-solution) network namespaces; everything else is a workaround that's not entirely guaranteed to work, it's said. Non-Linux OS makers are urged to implement network namespaces if they haven't already.

* [Curious tale of broken VPNs, the Year 2038, and certs that expired 100 years ago](https://www.theregister.com/2024/02/09/it_incident_report_the_clock/)
* [Microsoft confesses April Windows update breaks some VPN connections](https://www.theregister.com/2024/05/01/microsoft_windows_vpn_problems/)
* [Google One VPN axed for everyone but Pixel loyalists ... for now](https://www.theregister.com/2024/04/12/vpn_google_shuttered/)
* [There's a good chance your VPN is vulnerable to privacy-menacing TunnelCrack attack](https://www.theregister.com/2023/08/10/tunnelcrack_vpn/)

The duo offer some firewall-level mitigations but warn these "create a selective denial of service for traffic using the DHCP route and introduce a side-channel." Check out the above write-ups for more details.

If it's possible to tell your system to ignore DHCP rule 121 while a VPN is active, that would be a good plan, and Leviathan also recommends using a VPN through a dedicated, password-protected wireless hotspot for an added layer of security. Their suggestions for VPN users is:

Do not use untrusted networks (public Wi-Fi).

Consider using a hotspot with your VPN.

Consider using a VPN inside a virtual machine that does not have a bridged network adapter.

And for VPN providers:

Review and update your marketing: do not claim untrusted networks can be secured by you.

Where possible, use network namespaces features in your product.

Consider host-based firewall protections to partially mitigate local network attacks.

The bottom line is that when using a VPN client on a public or untrusted network with a host machine that supports DHCP option 121, consider preventing that option from being used or take steps to protect the client, such as by putting it on its own network.

Putting in place measures to detect and block rogue DHCP servers would be helpful too on more serious networks.

"All mitigations we've observed still expose a serious issue for users who rely on total privacy of their connection, and the issue can also be abused for censorship," Cronce and Moratti said. "We feel that [fixing this is] a shared responsibility, and the people who suffer from this are VPN users." ®

**Get our** [Tech Resources](https://whitepapers.theregister.com/)

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

#### More about

* [Dynamic Host Configuration Protocol](/Tag/Dynamic%20Host%20Configuration%20Protocol/)
* [Privacy](/Tag/Privacy/)
* [VPN](/Tag/VPN/)

More like these

×
### More about

* [Dynamic Host Configuration Protocol](/Tag/Dynamic%20Host%20Configuration%20Protocol/)
* [Privacy](/Tag/Privacy/)
* [VPN](/Tag/VPN/)

### Narrower topics

* [cookies](/Tag/cookies/)
* [Privacy Sandbox](/Tag/Privacy%20Sandbox/)

### Broader topics

* [Network](/Tag/Network/)

#### More about

![](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/icons/social_share_icon.svg)
Share

[**34**
![comment bubble on white](/design_picker/f5daacc84b9722c1e31ba85f836c37e4ad993fc4/graphics/icons/bubble_comment_white.png)
COMMENTS](https://forums.theregister.com/forum/all/2024/05/07/vpn_tunnelvision_dhcp/ "View comments on this article")

#### More about

* [Dynamic Host Configuration Protocol](/Tag/Dynamic%20Host%20Configuration%20Protocol/)
* [Privacy](/Tag/Privacy/)
* [VPN](/Tag/VPN/)

More like these

×
### More about

* [Dynamic Host Configuration Protocol](/Tag/Dynamic%20Host%20Configuration%20Protocol/)
* [Privacy](/Tag/Privacy/)
* [VPN](/Tag/VPN/)

### Narrower topics

* [cookies](/Tag/cookies/)
* [Privacy Sandbox](/Tag/Privacy%20Sandbox/)

### Broader topics

* [Network](/Tag/Network/)

#### TIP US OFF

[Send us news](https://www.theregister.com/Profile/contact/)

---

### Other stories you might like

[#### Pornhub pulls out of Florida, VPN demand 'surges 1150%'

State masks up finally – its IP addresses, that is
Personal Tech5 Jan 2025 | 124](/2025/01/05/pornhub_vpn_demand_surge/?td=keepreading)

[#### Apple auto-opts everyone into having their photos analyzed by AI for landmarks

Homomorphic-based Enhanced Visual Search is so privacy-preserving, iPhone giant activated it without asking
Personal Tech3 Jan 2025 | 68](/2025/01/03/apple_enhanced_visual_search/?td=keepreading)

[#### Apple offers to settle 'snooping Siri' lawsuit for an utterly incredible $95M

Even the sound of a zip could be enough to start the recordings, according to claims
Security2 Jan 2025 | 39](/2025/01/02/apple_siri_lawsuit/?td=keepreading)

[#### Fortify your data

How cyber resilient storage hardware can defeat ransomware
Sponsored Feature](/2024/11/26/fortify_your_data/?td=keepreading)

[![](https://pubads.g.doubleclick.net/gampad/ad?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)](https://pubads.g.doubleclick.net/gampad/jump?co=1&iu=/6978/reg_specialfeatures/spotlightonrsa&sz=300x50%7C300x100%7C300x250%7C300x251%7C300x252%7C300x600%7C300x601&tile=6&c=66Z4J3r3KFsntpXb-3spxnAAAAAMA&t=ct%3Dns%26unitnum%3D6%26raptor%3Dhawk%26pos%3Dbtm%26test%3D0)

[#### Encryption backdoor debate 'done and dusted,' former White House tech advisor says

interview When the FBI urges E2EE, you know it's serious business
Cyber-crime4 Jan 2025 | 71](/2025/01/04/encryption_backdoor_debate/?td=keepreading)

[#### What happens when someone subpoenas Cloudflare to unmask a blogger? This...

Ex-politician in UK claims he's been defamed – and goes to court in US for answers
Legal9 Jan 2025 | 78](/2025/01/09/uk_blog_cloudflare_subpoena/?td=keepreading)

[#### Telemetry data from 800K VW Group EVs exposed online

Infosec in Brief PLUS: DoJ bans data sale to enemy nations; Do Kwon extradited to US; Tenable CEO passes away; and more
Security6 Jan 2025 | 44](/2025/01/06/volkswagen_ev_data_exposed/?td=keepreading)

[#### Fining Big Tech isn't working. Make them give away illegally trained LLMs as public domain

Opinion It's all made from our data, anyway, so it should be ours to use as we want
AI + ML22 Dec 2024 | 142](/2024/12/22/ai_poisoned_tree/?td=keepreading)

[#### One third of adults can't delete device data

Easier to let those old phones gather dust in a drawer, survey finds
Security24 Dec 2024 | 189](/2024/12/24/uk_device_data_deletion/?td=keepreading)

[#### Firefox ditches Do Not Track because nobody was listening anyway

Few websites actually respect the option, says Mozilla
Software12 Dec 2024 | 88](/2024/12/12/firefox_do_not_track/?td=keepreading)

[#### Google Timeline location purge causes collateral damage

Privacy measure leaves some mourning lost memories
Security13 Dec 2024 | 48](/2024/12/13/google_timeline_purge/?td=keepreading)

[#### WhatsApp finally fixes View Once flaw that allowed theft of supposedly vanishing pics

And it only took four months, tut
Security10 Dec 2024 | 22](/2024/12/10/whatsapp_view_once/?td=keepreading)

The Register ![icon](/design_picker/d518b499f8a6e2c65d4d8c49aca8299d54b03012/graphics/icon/vulture_white.png) Biting the hand that feeds IT

#### About Us

* [Contact us](https://www.theregister.com/Profile/contact/)
* [Advertise with us](https://www.theregister.com/AdvertiseWithUs/)
* [Who we are](https://www.theregister.com/Profile/about_the_register/)

#### Our Websites

* [The Next Platform](https://www.nextplatform.com/)
* [DevClass](https://devclass.com/)
* [Blocks and Files](https://blocksandfiles.com/)

#### Your Privacy

* [Cookies Policy](https://www.theregister.com/Profile/cookies/)
* [Privacy Policy](https://www.theregister.com/Profile/privacy/)
* [Ts & Cs](https://www.theregister.com/Profile/terms_and_conditions_of_use/)

[![Situation Publishing](/design_picker/d2e337b97204af4aa34dda04c4e5d56d954b216f/graphics/std/sitpublogo_2022.png)](https://situationpublishing.com/)

Copyright. All rights reserved © 1998–2025

![no-js](/Design/graphics/std/transparent_pixel.png)



=== Content from news.ycombinator.com_2662dee2_20250111_135243.html ===


| |  | **[Hacker News](news)** [new](newest) | [past](front) | [comments](newcomments) | <ask> | <show> | <jobs> | <submit> | [login](login?goto=item%3Fid%3D40279632) | | --- | --- | --- | |
| --- | --- | --- | --- |
|
| |  |  | [Attackers can decloak routing-based VPNs](https://www.leviathansecurity.com/blog/tunnelvision) ([leviathansecurity.com](from?site=leviathansecurity.com)) | | --- | --- | --- | |  | | 446 points by [dsr\_](user?id=dsr_) [8 months ago](item?id=40279632)  | [hide](hide?id=40279632&goto=item%3Fid%3D40279632) | [past](https://hn.algolia.com/?query=Attackers%20can%20decloak%20routing-based%20VPNs&type=story&dateRange=all&sort=byDate&storyText=false&prefix&page=0) | [favorite](fave?id=40279632&auth=75ddfda1c083e2a558e89e7c80dd0816200318ea) | [232 comments](item?id=40279632) |  | |  |  | [lathiat](user?id=lathiat) [8 months ago](item?id=40281267)   | [next](#40279798) [–]  This is a slight variation on the "Poison Tap" attack from Samy Kamkar in 2016, where you do the same thing but with a USB/Thunderbolt network adapter. You plug it into the victim device, advertise two more specific routes of 0.0.0.0/1 and 128.0.0.0/1 and then you get all the traffic in preference to other system interfaces despite interface ordering: <https://github.com/samyk/poisontap> I imagine there is also probably some other prior art. But that's a very well known one. They also claim that it affects all VPN clients in the headline, yet so many such clients setup firewall rules to block traffic to/from the physical interface as they acknowledge in the write-up. Most of the VPNs that are claiming to hide your identity or where such cloaking is important tend to implement that. I'm sure plenty of setups don't have it enabled by default, but I think it would have been productive to document what percentage of leading personal/commercial and corporate VPN solutions have this enabled by default. A good write-up and explanation for the lay person, but I think the headline over-sells it a little bit given the number of clients that would prevent most of the data leak with those firewall rules and not acknowledging the prior art in this area. | | --- | --- | --- | | | --- | --- | --- | --- | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40281438)   | [parent](#40281267) | [next](#40279798) [–]  Well said. This is a nothing-burger for all VPNs except the ones that are likely heavily leaking already due to the absence of basic firewall rules. Their "side channel attack" also made me spit out my drink. EDIT: looks like NordVPN (at least on mac) doesn't have those basic firewall rules and so IS vulnerable to this exploit. | | --- | --- | --- | | | |  |  | [foobiekr](user?id=foobiekr) [8 months ago](item?id=40282201)   | [root](#40281267) | [parent](#40281438) | [next](#40282776) [–]  A general rule for life is that companies making a big deal about military grade encryption or about how they are affiliated with Nordic countries are scams. | | --- | --- | --- | | | |  |  | [berniedurfee](user?id=berniedurfee) [8 months ago](item?id=40284579)   | [root](#40281267) | [parent](#40282201) | [next](#40283402) [–]  Or more generally, marketing budget and trustworthiness tend to be inversely proportional. | | --- | --- | --- | | | |  |  | [froddd](user?id=froddd) [8 months ago](item?id=40283402)   | [root](#40281267) | [parent](#40282201) | [prev](#40284579) | [next](#40282554) [–]  Can you expand on that? Specifically the affiliation with Nordic countries? I’m a Nord VPN customer, I’d quite like to know more — may help inform any future decision on renewing or even staying with them. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283592)   | [root](#40281267) | [parent](#40283402) | [next](#40282554) [–]  In general, Nordic countries are known for their extensive privacy laws, which in theory would make it harder for law enforcement to gain access to your traffic (and with a court order it is very easy to decloak your VPN traffic). However, as all Nordic countries are part of the Schengen Area, they are bound by European laws - and their enforcement. When Europol started cracking down on VPN providers that didn't comply, NordVPN (and all others who wanted to remain in the European market) were forced to admit [1] that they do comply with law enforcement orders. Today, all VPNs that you can legally buy are worthless in the aspects they advertise to you. You neither get extra security through encryption when browsing the web (https is already good enough for public wifi) nor actual privacy from your own government. There is exactly one use case for public commercial VPNs these days: If you want to easily access the internet from a different location to bypass geoblocking. But many big services like Netflix have started to simply block or otherwise limit access from traffic that comes from big VPN provider IP ranges, so even that use-case is becoming more worthless every year. [1] [https://www.pcmag.com/news/nordvpn-actually-we-do-comply-wit...](https://www.pcmag.com/news/nordvpn-actually-we-do-comply-with-law-enforcement-data-requests) | | --- | --- | --- | | | |  |  | [NoGravitas](user?id=NoGravitas) [8 months ago](item?id=40284716)   | [root](#40281267) | [parent](#40283592) | [next](#40287065) [–]  You are missing one valid use-case: avoiding three-strikes letters being sent to your ISP by the MPA. Unless you're part of a release group, the complaints from the MPA never rise to the level of actual legal action, so your VPN provider is free to bin them, whereas your actual ISP would almost certainly act on them. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40290968)   | [root](#40281267) | [parent](#40284716) | [next](#40287065) [–]  Yes of course, if you're engaged in low level criminal behaviour, then even these low levels of obfuscation will keep some pressure off your back. But since copyright law is somewhat of a grey area in the EU, you technically don't even need a VPN for that. You could run a VPS somewhere and get the same results much cheaper. But this kind of use case is not something VPN providers can advertise with anyways, so my point remains unchanged. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40336553)   | [root](#40281267) | [parent](#40290968) | [next](#40287065) [–]  You can get a good VPN for $5/month. I don't think you can get a decent VPN with enough bandwidth to use as a tunnel for the same price. And as for infringement being grey in the EU, not really it goes by country. Nothing grey about it in Denmark for example. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40341317)   | [root](#40281267) | [parent](#40336553) | [next](#40287065) [–]  You can literally get a VPS with gigabit connection for free these days. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40341813)   | [root](#40281267) | [parent](#40341317) | [next](#40287065) [–]  Link? | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40343359)   | [root](#40281267) | [parent](#40341813) | [next](#40287065) [–]  Try (to) google (as in GCP). AWS, Azure and pretty much everyone else also has some kind of free tier. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [7 months ago](item?id=40388657)   | [root](#40281267) | [parent](#40343359) | [next](#40287065) [–]  Yeah, there's no VPS with a gigabit connection for free. | | --- | --- | --- | | | |  |  | [jkaplowitz](user?id=jkaplowitz) [8 months ago](item?id=40287065)   | [root](#40281267) | [parent](#40283592) | [prev](#40284716) | [next](#40336366) [–]  HTTPS is not enough for public WiFi. Domain names get leaked due to how the TLS negotiation works, and unencrypted HTTP sites or ones with weak crypto are still more common than they should be. Plus, many public WiFi networks exist which block SSH or specific websites to keep security auditors happy while allowing VPN to make business people happy. I used such a public WiFi quite recently, which blocked not only SSH but Hacker News - I assume some bad site database misunderstands the name of this site. As for hiding from governments, I’m not aware of any Western government that has so far gained the power to force its companies to affirmatively lie about whether they have shared logs with the government. So far, they can sometimes force silence, and can sometimes force a previously published canary notice not to be removed, but they haven’t yet had any right confirmed to uphold a compelled lie. So any Western provider that continues to publish suitably broadly worded canary notices on a verifiably still-updated basis (e.g. securely OpenPGP-signed together with a bit of new daily news headlines) is either telling the truth or is lying without being legally forced to do so. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40291019)   | [root](#40281267) | [parent](#40287065) | [next](#40336366) [–]  >I’m not aware of any Western government that has so far gained the power to force its companies to affirmatively lie about whether they have shared logs with the government Do you see the problem with this statement? | | --- | --- | --- | | | |  |  | [jkaplowitz](user?id=jkaplowitz) [8 months ago](item?id=40296758)   | [root](#40281267) | [parent](#40291019) | [next](#40336366) [–]  Depends on what things you think are likely to be true in secret or judicially determined in the future without an intervening legislative change. My impression of the law in most Western countries is that the courts would overturn any requirement to compel a company to affirmatively lie to the public through explicit speech of some kind, even in the national security context. Orders compelling silence or non-removal of past statements are a very different constitutional and human rights balance than compelled false speech. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40341335)   | [root](#40281267) | [parent](#40296758) | [next](#40336366) [–]  >My impression of the law in most Western countries Apparently you still didn't get it, so let me spell it out: Your entire point hinges on your own *impression* that your government won't abuse its power. An impression that will always be heavily influenced by PR and propaganda, no matter where you live - and one that seems eerily off considering the fact how often surveillance programs and attempts at destroying what privacy we have left make it to the surface. This kind of blind trust in your superiors is the straightest way to a 1984-esque dystopia. | | --- | --- | --- | | | |  |  | [jkaplowitz](user?id=jkaplowitz) [8 months ago](item?id=40369368)   | [root](#40281267) | [parent](#40341335) | [next](#40336366) [–]  You’re assuming a lot of inaccurate things about my beliefs. I do not have blind trust in my government or other Western governments. In, fact, I expect them to actively abuse their power in myriad ways, many of which try to destroy privacy. I didn’t say otherwise; indeed, if I were to assume that the government would never try to compel affirmative lies, I would have never needed to discuss how the courts would react to such an attempt. I don’t think it will be productive to continue this subthread if doing so would be as focused on clarifying misunderstandings as this exchange was, so do not be surprised if this ends up as my last reply in this subthread. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40336366)   | [root](#40281267) | [parent](#40283592) | [prev](#40287065) | [next](#40284050) [–]  Mullvad at least doesn't seem to log :shrug\_emoji: | | --- | --- | --- | | | |  |  | [froddd](user?id=froddd) [8 months ago](item?id=40284050)   | [root](#40281267) | [parent](#40283592) | [prev](#40336366) | [next](#40283599) [–]  So, should they be requested to do so by a formally issued court order, they would comply and start logging a user’s activity, but do not do so by default. Calling them worthless at providing secure browsing seems far-fetched; calling them a scam is fully disingenuous. | | --- | --- | --- | | | |  |  | [jhugo](user?id=jhugo) [8 months ago](item?id=40284661)   | [root](#40281267) | [parent](#40284050) | [next](#40283599) [–]  What, specifically, is the “secure browsing” that they offer and how does it improve on HTTP over modern TLS? Funnelling your traffic through another entity doesn’t magically increase security. | | --- | --- | --- | | | |  |  | [ang\_cire](user?id=ang_cire) [8 months ago](item?id=40285990)   | [root](#40281267) | [parent](#40284661) | [next](#40285346) [–]  \*Tunneling\* it through one hides the nature of that traffic from intermediary systems that it traverses from you up to that VPN exit point. There is a lot of metadata in packets that can be viewed by any interim hop, like your ISP, workplace IT security, ARP-cache-poisoned coffeeshop router, etc. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40336372)   | [root](#40281267) | [parent](#40285990) | [next](#40285346) [–]  > ARP-cache-poisoned coffeeshop router, etc. Eh, that's not really a thing anymore. | | --- | --- | --- | | | |  |  | [ang\_cire](user?id=ang_cire) [7 months ago](item?id=40417656)   | [root](#40281267) | [parent](#40336372) | [next](#40285346) [–]  Not for Starbucks, who does fancy per-user VLANs, but for your local spot that's using an AP-router-combo they bought at Best buy, it sure is. | | --- | --- | --- | | | |  |  | [froddd](user?id=froddd) [8 months ago](item?id=40285346)   | [root](#40281267) | [parent](#40284661) | [prev](#40285990) | [next](#40283599) [–]  Being able to cover/scramble your actual or virtual location can provide security in some contexts | | --- | --- | --- | | | |  |  | [Shared404](user?id=Shared404) [8 months ago](item?id=40285443)   | [root](#40281267) | [parent](#40285346) | [next](#40283599) [–]  It also would prevent your ISP or local attackers from seeing the domains you are reaching out to, which is still visible over https. It's all tradeoffs. | | --- | --- | --- | | | |  |  | [stavros](user?id=stavros) [8 months ago](item?id=40283599)   | [root](#40281267) | [parent](#40283592) | [prev](#40284050) | [next](#40282554) [–]  Even Mullvad? | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283616)   | [root](#40281267) | [parent](#40283599) | [next](#40283624) [–]  You can answer the question yourself for any provider using this simple test: Can you legally buy access to it from inside the EU? If yes, they will suffer from the same problem as all other providers. | | --- | --- | --- | | | |  |  | [stavros](user?id=stavros) [8 months ago](item?id=40283621)   | [root](#40281267) | [parent](#40283616) | [next](#40283624) [–]  What are these problems, exactly? | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283658)   | [root](#40281267) | [parent](#40283621) | [next](#40283624) [–]  As I said above, a simple court order can destroy any attempt at privacy. All (serious) VPN providers claim they don't store logs. But that does not mean that a court can't force them to do so. When combined with a gag order you can have someone collecting all your traffic without you even realizing it. And that's just the VPN provider, which usually doesn't own any datacenters. The datacenter providers can also receive the orders to either monitor traffic or even install hardware to do so. If you want any hope of privacy, you steer clear of all big commercial "privacy" providers, because they are very high on every government agency's list. And you just need one component in the entire chain to be compromised. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40336385)   | [root](#40281267) | [parent](#40283658) | [next](#40301878) [–]  > All (serious) VPN providers claim they don't store logs. But that does not mean that a court can't force them to do so. When combined with a gag order you can have someone collecting all your traffic without you even realizing it. And that's just the VPN provider, which usually doesn't own any datacenters. The datacenter providers can also receive the orders to either monitor traffic or even install hardware to do so. If None of this really matters unless you are doing something illegal enough that the government is interested in you and convinced a judge to get warrants. That isn't 99% of people. 99% of people just want to try and stop being traced and their data being harvested with an easy solution that mostly works for that purpose. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40341384)   | [root](#40281267) | [parent](#40336385) | [next](#40301878) [–]  >None of this really matters unless you are doing something illegal enough that the government is interested in you The issue here is that how "illegal" something is depends heavily on where you live. In some places speaking against the government can get you killed [1]. In others, hosting movies can get your house raided by police helicopters [2]. [1] <https://www.unesco.org/en/safety-journalists/observatory> [2] <https://www.youtube.com/watch?v=KmIPVrkN1hA> | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40341819)   | [root](#40281267) | [parent](#40341384) | [next](#40301878) [–]  > The issue here is that how "illegal" something is depends heavily on where you live. The context of the discussion was the EU. And the point stands. For 99% of people VPNs offer privacy even against the government, that would need to meet a high burden of proof and require a warrant to break that privacy. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40354493)   | [root](#40281267) | [parent](#40341819) | [next](#40301878) [–]  I said nothing that goes against the context. Again: When you are actually scared of getting cought for something, a commercial VPN very likely doesn't help. That goes for all jurisdictions. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [7 months ago](item?id=40388676)   | [root](#40281267) | [parent](#40354493) | [next](#40301878) [–]  > I said nothing that goes against the context. You mentioned the EU as a whole but the point is it isn't and is indeed widely varied when it comes to the sorts of laws you are relying on to make your argument. | | --- | --- | --- | | | |  |  | [Suppafly](user?id=Suppafly) [8 months ago](item?id=40301878)   | [root](#40281267) | [parent](#40283658) | [prev](#40336385) | [next](#40283770) [–]  >When combined with a gag order you can have someone collecting all your traffic without you even realizing it. Are such gag orders common in the EU? I know they are fairly common in the US, but don't know enough about EU laws to know if that's an actual concern there or not. | | --- | --- | --- | | | |  |  | [carlhjerpe](user?id=carlhjerpe) [8 months ago](item?id=40283770)   | [root](#40281267) | [parent](#40283658) | [prev](#40301878) | [next](#40283624) [–]  You're spreading FUD, the Swedish government can't do shit to Mullvad but take their servers offline. Possibly if it was a matter of national security, at which point our recommendations are useless either way. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283903)   | [root](#40281267) | [parent](#40283770) | [next](#40283624) [–]  False. Like all member states, the Swedish government has officialy ceded jurisdiction and enforcement of certain laws to the EU. Only VPN providers who do not comply with such international court orders get shut down. Look at what happened to vpnlab: The police literally write on their seized domain that they have forcefully attained access to everything, because the provider would not give it away freely: <https://vpnlab.net/> Consequently, you can assume that all other VPN providers who are still doing business in Europe are freely giving away their data to government agencies. | | --- | --- | --- | | | |  |  | [berkes](user?id=berkes) [8 months ago](item?id=40284181)   | [root](#40281267) | [parent](#40283903) | [next](#40283624) [–]  You presume that a) all governments are bad, b) law is controlled by these governments and c) we only have to hide from governments. Neither are absolutely true. I mostly trust my (western european) government to not fuck me over when I am abiding the laws. Which I mightn't always do. I mostly trust them to be proportional: e.g. not beat me up or throw me in prison for smoking a spliff or drinking in public. A court order is handled by courts. Which, at least in most European countries, is independent. This is shifting in some countries, but that's a rather big deal. "Cut of from EU benefits" big. Regardless what police or governments want, they have to abide by laws. And courts decisions on allowing access to my internet usage. While in many countries governments are truly life threatening to minorities, that's not the only privacy concern. I have much more to "fear" from my ISP selling out, my datacenter getting bought by a FAANG or just those FAANGs spying on my every move. What I'm trying to say is: you are spreading FUD by inventing some absolutisms that are really a spectrum for most common VPN users. Also: VPNs have always known to be detrimental to your security when browsing "really" secure: through TOR. | | --- | --- | --- | | | |  |  | [mrangle](user?id=mrangle) [8 months ago](item?id=40286319)   | [root](#40281267) | [parent](#40284181) | [next](#40283624) [–]  >Regardless what police or governments want, they have to abide by laws I can't tell if this person actually believes what they wrote, or if it is some kind of attempted public social pressure technique meant to adjust the Overton Window from a rational place. Be it 2024 or 1624, to assert that one trusts the gov to "not fuck them over" takes a special type of naivete. It certainly takes a general obliviousness to the news cycle, willful or otherwise. As well as an obliviousness to the logic of self-interest, bureaucratic expediency, State survival, profit motivation, corruption, party politics, and more. It takes an obliviousness to history. I doubt that few people in law enforcement, public bureaucracies, or even in most elected offices would agree with the statement under discussion. In fact, the most best (or most just) system seems to be mostly built on fail-safes against being fucked over in this manner, even if all systems arguably eventually fall to corruption. Which underscores such government motivation. If your take is that "in many countries governments are truly life threatening to minorities", then the rest of the Profession of Trust makes no logical sense for the population generally: if the bar is the threat to life. And while that is a sensible ceiling for a "do not trust" conclusion, I would argue that the bar doesn't need to be that high. | | --- | --- | --- | | | |  |  | [berkes](user?id=berkes) [8 months ago](item?id=40288442)   | [root](#40281267) | [parent](#40286319) | [next](#40283624) [–]  I believe what I wrote. Do note that this applies to *Western Europe* (more precisely: the Netherlands). And do note that "to be f#ed over" is rather broad and personal. While one person might feel they are truly "f#d" by police" when they get a ticket driving their bike without lights at night, that's obviously not what I mean. I am by conviction an Anarchist (though certainly not libertarian), and I do see the times and places where government did absolutely f# over minorities here¹. But: hear me out: those are cases where the government, through democratic mandate, made (extremely) bad laws. And then had to abide by their own laws. Sometimes forced by the -independent- courts². Democracy works: "we, the people, voted for incompetent and blasé governors, racists even, who then turned out to be imcompetent and blasé. And in doing so f\*d minorities". It's not the government, really, but the will of the people! Do I trust the police force (the institude)? Not really. But I don't need to, because it is kept in check by a functioning democratic system and courts. Again, this is not the US. Nor Somalia or South Africa. Do I trust a police officer (a human)? Quite probably; in the Netherlands a majority isn't power-tripping nazi scum but rather people with a (imo weird) calling to help. ¹ e.g. a still ongoing case at [https://en.wikipedia.org/wiki/Dutch\_childcare\_benefits\_scand...](https://en.wikipedia.org/wiki/Dutch_childcare_benefits_scandal) ² e.g. [https://en.wikipedia.org/wiki/Nitrogen\_crisis\_in\_the\_Netherl...](https://en.wikipedia.org/wiki/Nitrogen_crisis_in_the_Netherlands%5C)\* | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [8 months ago](item?id=40336400)   | [root](#40281267) | [parent](#40288442) | [next](#40283624) [–]  > those are cases where the government, through democratic mandate, made (extremely) bad laws Yes, due to democracy. You think *more* democracy is the answer? | | --- | --- | --- | | | |  |  | [CRConrad](user?id=CRConrad) [8 months ago](item?id=40364189)   | [root](#40281267) | [parent](#40336400) | [next](#40283624) [–]  Yes, because those cases are fortunately rather few. And usually (far!) fewer than in places with *less* democracy. So it seems plausible that they were caused by *not enough* (or otherwise "bad") democracy, not too much of it. | | --- | --- | --- | | | |  |  | [DEADMINCE](user?id=DEADMINCE) [7 months ago](item?id=40388665)   | [root](#40281267) | [parent](#40364189) | [next](#40283624) [–]  I absolutely think they were caused by too much democracy. Most people are not equipped and may never be so to vote or have a say on the most important issues. They need to be managed by those that are capable. | | --- | --- | --- | | | |  |  | [CRConrad](user?id=CRConrad) [7 months ago](item?id=40438485)   | [root](#40281267) | [parent](#40388665) | [next](#40283624) [–]  > I absolutely think they were caused by too much democracy. Most people are not equipped and may never be so to vote or have a say on the most important issues. They need to be managed by those that are capable. Said all fascists and communists everywhere ever. Oh, and probably all the Ayn-Randian libertariards too. Which of all those are you? | | --- | --- | --- | | | |  |  | [actionfromafar](user?id=actionfromafar) [8 months ago](item?id=40283624)   | [root](#40281267) | [parent](#40283599) | [prev](#40283616) | [next](#40282554) [–]  Mullvad complies, but they go out of their way to keep very little information. If you don't have the information in the first place, you can't surrender it. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283668)   | [root](#40281267) | [parent](#40283624) | [next](#40282554) [–]  Beware that despite all marketing statements, VPN providers can easily be forced to store logs using court orders, even if they don't do it by default. | | --- | --- | --- | | | |  |  | [actionfromafar](user?id=actionfromafar) [8 months ago](item?id=40284269)   | [root](#40281267) | [parent](#40283668) | [next](#40283982) [–]  That still has value, it's much harder to do drag-net style surveillance if you need court orders to collect new information and can't scoop up old information. | | --- | --- | --- | | | |  |  | [alexey-salmin](user?id=alexey-salmin) [8 months ago](item?id=40283982)   | [root](#40281267) | [parent](#40283668) | [prev](#40284269) | [next](#40283854) [–]  > VPN providers can easily be forced to store logs using court orders It's not grave if the provider is allowed to notify the user that logs are being collected from now on. Is there a country where gag orders are unconstitutional or something of that sort? | | --- | --- | --- | | | |  |  | [carbotaniuman](user?id=carbotaniuman) [8 months ago](item?id=40283854)   | [root](#40281267) | [parent](#40283668) | [prev](#40283982) | [next](#40282554) [–]  You can always shut down rather than do so - it's happened in the US. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40283918)   | [root](#40281267) | [parent](#40283854) | [next](#40282554) [–]  This also happened with providers in Europe. So you can safely assume that any VPN provider who is still doing business in Europe is compromised in some way or another by the government. | | --- | --- | --- | | | |  |  | [yaris](user?id=yaris) [8 months ago](item?id=40284341)   | [root](#40281267) | [parent](#40283918) | [next](#40282554) [–]  "Compromised" is a wrong word to use, unless you consider any obedience to the law "compromise". VPN providers who are still doing business in EU (not Europe) do obey court orders - that would be more correct wording. Any non-compliance is a one-time occurence: either you decide to cease operations or you are forced to cease operations by LEA, as in vpnlab.net example. | | --- | --- | --- | | | |  |  | [sigmoid10](user?id=sigmoid10) [8 months ago](item?id=40354563)   | [root](#40281267) | [parent](#40284341) | [next](#40282554) [–]  If you actually look at the vpnlab example, you'll find that the government got access to *all* their data, not just for specific cases. So you can assume that all remaining providers have yielded the same level of access. | | --- | --- | --- | | | |  |  | [codetrotter](user?id=codetrotter) [8 months ago](item?id=40282554)   | [root](#40281267) | [parent](#40282201) | [prev](#40283402) | [next](#40282776) [–]  Yeah. But Mullvad VPN, based in Sweden, is an actual good one. | | --- | --- | --- | | | |  |  | [pests](user?id=pests) [8 months ago](item?id=40282860)   | [root](#40281267) | [parent](#40282554) | [next](#40282776) [–]  Migadu for email hosting is amazing as well, also Sweden I beleive. | | --- | --- | --- | | | |  |  | [ChymeraXYZ](user?id=ChymeraXYZ) [8 months ago](item?id=40283117)   | [root](#40281267) | [parent](#40282860) | [next](#40282776) [–]  Migadu is Swiss | | --- | --- | --- | | | |  |  | [prmoustache](user?id=prmoustache) [8 months ago](item?id=40283974)   | [root](#40281267) | [parent](#40283117) | [next](#40282776) [–]  Why do people keep mistaking Sweden and Switzerland? | | --- | --- | --- | | | |  |  | [pests](user?id=pests) [8 months ago](item?id=40289290)   | [root](#40281267) | [parent](#40283974) | [next](#40284855) [–]  My mistake, I did know they were one of the two. I should have double checked. In general I know the difference between the two just forgot which Migadu was based on. | | --- | --- | --- | | | |  |  | [short\_sells\_poo](user?id=short_sells_poo) [8 months ago](item?id=40284855)   | [root](#40281267) | [parent](#40283974) | [prev](#40289290) | [next](#40282776) [–]  People confuse Switzerland and Swaziland and those two aren't even on the same continent :) | | --- | --- | --- | | | |  |  | [thenthenthen](user?id=thenthenthen) [8 months ago](item?id=40286079)   | [root](#40281267) | [parent](#40284855) | [next](#40282776) [–]  Something something Austria | | --- | --- | --- | | | |  |  | [ikiris](user?id=ikiris) [8 months ago](item?id=40282776)   | [root](#40281267) | [parent](#40281438) | [prev](#40282201) | [next](#40279798) [–]  What was the side channel attack? There’s no way I’m reading 20 pages of networking for absolute toddlers to try to find it. | | --- | --- | --- | | | |  |  | [josephcsible](user?id=josephcsible) [8 months ago](item?id=40282984)   | [root](#40281267) | [parent](#40282776) | [next](#40279798) [–]  The side channel attack lets the attacker determine whether or not you're trying to connect to certain IP addresses over your VPN. If you properly fix this, then even when the DHCP server is performing the attack, the traffic in question still goes through your VPN. If you just mitigate it, then when the DHCP server is performing the attack, the traffic will be dropped. The side channel is that if you just mitigate it, then the attacker can repeatedly start and stop the attack for specific IP addresses, while monitoring how much VPN traffic you're sending and receiving. | | --- | --- | --- | | | |  |  | [ikiris](user?id=ikiris) [8 months ago](item?id=40283724)   | [root](#40281267) | [parent](#40282984) | [next](#40279798) [–]  That’s certainly a take. | | --- | --- | --- | | | |  |  | [Aloisius](user?id=Aloisius) [8 months ago](item?id=40279798)   | [prev](#40281267) | [next](#40280070) [–]  I don't know why this article is so long. DHCP Option 121 allows the DHCP server to set routing rules for a given CIDR range, which end up having a higher priority than the default 0.0.0.0/0 rule due to higher specificity (longer prefix). | | --- | --- | --- | | | |  |  | [morattisec](user?id=morattisec) [8 months ago](item?id=40279966)   | [parent](#40279798) | [next](#40280976) [–]  One of the authors here, the intention was to provide a primer of the topics since we figured this would draw people from a nontechnical background too. That and half the information on the internet about VPNs is from VPN providers and is incorrect or not technical enough to describe how they \_actually\_ work. We had a sentence in the intro that was supposed to be a hyperlink to the “hey if you know this stuff you should skip to the POC section”. I’ll make sure that gets updated/more obvious. | | --- | --- | --- | | | |  |  | [wolverine876](user?id=wolverine876) [8 months ago](item?id=40280106)   | [root](#40279798) | [parent](#40279966) | [next](#40280108) [–]  What I read does a great job of explaining the technology; I know it pretty well but it's great to have an updated, clear, concise, well-organized, integrated explanation all in one place. I can't imagine how long that took to make it that clear! (Everything posted here gets similar complaints about the writing, headline, too short, too long, too hot, too cold, etc. Goldilocks is never pleased here. Welcome to HN! :) | | --- | --- | --- | | | |  |  | [nonrandomstring](user?id=nonrandomstring) [8 months ago](item?id=40280108)   | [root](#40279798) | [parent](#40279966) | [prev](#40280106) | [next](#40280101) [–]  Good call. For a general IT audience you are speaking to, context building really helps refresh the scene before dropping the exploit. Well communicated. | | --- | --- | --- | | | |  |  | [tgsovlerkhgsel](user?id=tgsovlerkhgsel) [8 months ago](item?id=40280101)   | [root](#40279798) | [parent](#40279966) | [prev](#40280108) | [next](#40280118) [–]  The PoC section doesn't explain the issue. I think a one-line TL;DR similar to the summary above would be best, e.g. "A malicious DHCP server can use DHCP Option 121 to set routing rules, which can override the routing rule used by VPNs and cause traffic to be routed outside the VPN" (I like it that you provide the background for people who need it, but also found the actually relevant information extremely annoying to find.) | | --- | --- | --- | | | |  |  | [timbre1234](user?id=timbre1234) [8 months ago](item?id=40284599)   | [root](#40279798) | [parent](#40280101) | [next](#40280749) [–]  Or they could have maybe lead with that sentence and THEN given the explanation. Too many tech people have that "I want to slowly lead you to the point like Sherlock Holmes mystery" style of writing, and it is such a time-waste. Arthur Conan Doyle was paid by the word, you aren't. Please, everyone, back to middle school: State a Thesis in your first sentence and THEN expand on it, don't force me to spend pages trying to figure it out. | | --- | --- | --- | | | |  |  | [aeonik](user?id=aeonik) [8 months ago](item?id=40284688)   | [root](#40279798) | [parent](#40284599) | [next](#40280749) [–]  It's not just tech people, but any field with a high enough complexity. The "abstract" of a journal article is supposed to contain all the key points of a science experiment *including the results*, but it's too rare that they do. I think some folks are just hitting their limits, and needed more time to digest/ review their publication. Other folks are doing it I obfuscate or pad their work, for whatever reason. | | --- | --- | --- | | | |  |  | [IggleSniggle](user?id=IggleSniggle) [8 months ago](item?id=40285172)   | [root](#40279798) | [parent](#40284688) | [next](#40280749) [–]  When you're deep enough in a thing it can be hard to know what counts as "high level summary." For example, "attackers can decloak routing-based VPNs" might seem like a good high level summary. "Attackers can decloak routing-based VPNs using DHCP rules that give priority to an attacker over other lower priority routes" might seem like it's just in the weeds enough to be misleading, or to result in a bunch of people now believing they are educated on the subject when they really are not. Picking the right level to communicate such that you avoid clickbait journalists spreading a lie of omission/ hysteria is an art. Personally, I think we should be grateful for all the effort put into clearly communicating all the most relevant nuances; we can generalize that any high complexity field is doing its readers a service when it approaches communication this way. I'd rather the "result" be communicated at too high a level than too close to the middle (giving the illusion of understanding the nuance) | | --- | --- | --- | | | |  |  | [dylan604](user?id=dylan604) [8 months ago](item?id=40280749)   | [root](#40279798) | [parent](#40280101) | [prev](#40284599) | [next](#40280110) [–]  Just accept you were not the target audience and skim like the rest of the world. Not every article is written for you. It's available for you to read, but was more than likely not with you in mind. Some of us still like words and the reading of them when they provide details and more in-depth understanding than a tweet. | | --- | --- | --- | | | |  |  | [mindslight](user?id=mindslight) [8 months ago](item?id=40281969)   | [root](#40279798) | [parent](#40280749) | [next](#40280110) [–]  I hate tweet culture as much as anybody, but this is not the alternative. This article is so painfully long, I got bored even just trying to skim it. Reading it word for word will turn any noob into a seasoned greybeard through the sheer passage of time. If you really like words and reading them this much, I'd recommend adding some dictionaries to your reading list. | | --- | --- | --- | | | |  |  | [tgsovlerkhgsel](user?id=tgsovlerkhgsel) [8 months ago](item?id=40282637)   | [root](#40279798) | [parent](#40281969) | [next](#40280110) [–]  ChatGPT is great for providing endless reading material too! | | --- | --- | --- | | | |  |  | [wolverine876](user?id=wolverine876) [8 months ago](item?id=40280110)   | [root](#40279798) | [parent](#40280101) | [prev](#40280749) | [next](#40280118) [–]  > found the actually relevant information extremely annoying to find Skip down to the DHCP section? | | --- | --- | --- | | | |  |  | [idkdotcom](user?id=idkdotcom) [8 months ago](item?id=40280118)   | [root](#40279798) | [parent](#40279966) | [prev](#40280101) | [next](#40280046) [–]  Have you identified actual VPN vendors that are affected by this? I won't disclose which ones I use, but I would love to know if they have been affected. | | --- | --- | --- | | | |  |  | [bimguy](user?id=bimguy) [8 months ago](item?id=40280046)   | [root](#40279798) | [parent](#40279966) | [prev](#40280118) | [next](#40280266) [–]  Great write up by the way. Even some technical people might not know about this, not all technical people are network experts after all. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280266)   | [root](#40279798) | [parent](#40279966) | [prev](#40280046) | [next](#40280976) [–]  I looked at this in detail. This exploit is a nothing-burger for most decent VPNs. A simple "leak protection" (aka Killswitch) firewall rule completely negates this attack. All decent VPNs implement such a rule by default. Dealing with undesirable routes (whether pre existing or pushed by a DHCP server) is nothing new or in the slightest bit hard to defend against. If a VPN does not implement such a firewall rule already then it's likely already leaking so all this exploit demonstrates is that "A VPN without leak protection, leaks". (I won't even mention the "side channel" attack as it's completely ridiculous) I liked your write-up and option 121 is a little known option, so it's good to know about. But let's not pretend this thing is bigger than it is. | | --- | --- | --- | | | |  |  | [CommitSyn](user?id=CommitSyn) [8 months ago](item?id=40280351)   | [root](#40279798) | [parent](#40280266) | [next](#40280289) [–]  FTA: Importantly, the VPN control channel is maintained so features such as kill switches are never tripped, and users continue to show as connected to a VPN in all the cases we’ve observed. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280376)   | [root](#40279798) | [parent](#40280351) | [next](#40280532) [–]  They don't know what they're talking about. Kill switches are not "tripped" there is no "control channel". A kill switch is just a firewall rule that is ALWAYS engaged and all it does is blocks off-VPN traffic. It 100% will defend against this exploit. | | --- | --- | --- | | | |  |  | [jcrawfordor](user?id=jcrawfordor) [8 months ago](item?id=40280496)   | [root](#40279798) | [parent](#40280376) | [next](#40280667) [–]  Most practical VPN services don't actually implement it this way, it's a somewhat difficult and rather OS-specific problem depending on the firewall services offered by the OS. On some popular OS like mobile ones it's just not possible at all. So just to grab an example, NordVPN's implementation does indeed work as the article presents: it monitors the VPN and disables network access for applications if the VPN connection drops. This is indeed vulnerable to any number of potential problems, and depending on the OS and user savvy you can set up better protection using e.g. the iptables owner module. It's very non-portable though, sometimes even between Linux distributions, and hard to support at scale. Actually I'd say a true "no access except through the VPN" rule is easiest to implement on Windows, but NordVPN doesn't seem to do it there either, I'm not sure why. To be fair, it's right in the name: a kill switch is a switch that kills things. It isn't proper network policy like per-process routing tables that are, unfortunately, difficult to implement for consumer machines. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280597)   | [root](#40279798) | [parent](#40280496) | [next](#40280563) [–]  Mobile is an exception (but they already state android is immune), let's stick to desktop for the sake of discussion, the 3 major desktop platforms: mac, win, linux :) On mac - just implement a block everything rule with pf and then just allow traffic on the tunnel and whitelist the VPN endpoint. Boom, a kill switch that defends against this exploit. And there's no racey nordvpn-style "control channel" (if nord really works like this i have an even lower opinion of them than i do currently). On linux - iptables (for example) - just implement a general DROP policy then override with a specific ALLOW on the tunnel interface. On Windows - Use WFP to implement a block everything rule, then provide a higher priority rule to allow on the tunnel interface. All three of these techniques are the recommended way to implement a kill switch and it's used heavily in the VPN industry by anyone sensible. It completely defends against this TunnelVision exploit too. The way that you suggest kill switch is implemented (reactive and monitoring the connection?) is very fragile, racey and prone to leak, i absolutely would not trust it and it shouldn't even be called a kill switch. It's an embarrassment. :) | | --- | --- | --- | | | |  |  | [jcrawfordor](user?id=jcrawfordor) [8 months ago](item?id=40280670)   | [root](#40279798) | [parent](#40280597) | [next](#40281083) [–]  I'm not saying how it *should* be implemented, I'm saying how it *is* implemented by a number of popular VPN services. Take up the argument with them. There are VPN providers that do it right on at least some platforms, but unfortunately the way most document it it's very hard to tell without experimenting with the client to verify. As far as I know, use of the term "kill switch" closely correlates with an untrustworthy implementation. Consider the case of Mullvad who handle this a lot better and also decline to call it a "kill switch" for that reason. And that's not to say that Mullvad is perfect, easy to find forum threads by people who had traffic leakage for various reasons. I wouldn't trust anything you didn't set up yourself. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40281083)   | [root](#40279798) | [parent](#40280597) | [prev](#40280670) | [next](#40280563) [–]  You wrote three different ways to end up with all traffic dropped and a broken VPN connection. Traffic sent to the VPN interface gets encapsulated by the VPN client software and then routed to the Internet. If your firewall rule is dropping all traffic not destined for the VPN interface, it will drop the encapsulated traffic. You need two (sets of) rules: one allowing traffic on the VPN interface and one allowing traffic which is already cloaked by the VPN software (or not cloaked, but used to establish/maintain the tunnel itself). That second category is a bit complicated, because you need to be able to route to the VPN server regardless of which network you're connected to - and the DHCP server tells you how to do that. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40281244)   | [root](#40279798) | [parent](#40281083) | [next](#40280563) [–]  Yes. I just provided simplified firewall rules in my answer. You also need to whitelist either the VPN endpoint itself (and add a route to that endpoint) or you need to whitelist the process (such as wireguard or openvpn) that hits that endpoint. Not sure how a DHCP server is relevant in the slightest here except for the initial host network config of course. But the host network should already be configured before the VPN comes up. Source: i've implemented this dozens of times (and you probably have too, it sounds like) so let's not quibble over the details ;) | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40281481)   | [root](#40279798) | [parent](#40281244) | [next](#40280563) [–]  If you're connected to a random network, whose configuration you don't know in advance, how do you route packets to your VPN server? The usual answer is that the network's router tells you how to do that, by supplying DHCP options. The point I'm making here is that you can't just configure a firewall rule and have it work properly. What actually needs to happen is that the VPN client software is using one routing table - let's call it "host routing" - and everything else on the system is using a second routing table - let's call that "VPN routing". The DHCP server inserts rules into the host routing table, and the *only* software using those rules is the VPN client for its management and tunnel traffic. Otherwise, what if the network to which you connect says "the next hop for all internet traffic is 10.10.10.10"? You need to respect that rule when sending traffic to your VPN server, and ignore it for applications whose traffic will be tunneled. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40281695)   | [root](#40279798) | [parent](#40281481) | [next](#40280563) [–]  Let's walk through this step by step because there's a lot of confusion on your end. \* Step one - You connect your computer to a network - yes you'll get a DHCP lease, and you'll get an ip address, and a default gateway. This default route will be added to your routing table. \* Step two - If the TunnelVision exploit (DHCP option 121) is at play you'll also get a few MORE SPECIFIC routes than the default gateway. These also get added to your routing table \* Step three - You connect your VPN. The VPN will bring up a firewall. It will also bring up `128/1` and `0/1` routes that point at the VPN tunnel. The VPN tunnel now takes over the default route. This firewall will block all traffic that's not on the tun device (the VPN interface). Further, it will whitelist the VPN endpoint IP and create a route for it (it can do this since it already received the default gateway from the DHCP server) \* Step four - Your host starts sending traffic - either this traffic will go through the VPN tunnel (the default route) OR it will *attempt* to go through the more specific option 121 pushed malicious routes added by the compromised DHCP server (depending on the destination ip of the outbound packets). \* Step five - All traffic that *would* go down the malicious option 121 routes are BLOCKED by the firewall rule. Hence nullifying the TunnelVision exploit. That's all. Done. Where's the complexity in that? As i said before i've done this dozens of times. I'm talking from experience. I know this works. Further you say: > The point I'm making here is that you can't just configure a firewall rule and have it work properly. What actually needs to happen is that the VPN client software is using one routing table - let's call it "host routing" - and everything else on the system is using a second routing table - let's call that "VPN routing". You are aware we're talking about consumer VPNs right? The majority of users are on Windows and Mac. Neither of those OSes support multiple routing tables. Only Linux supports multiple routing tables. You're also just plain wrong - as i demonstrated above - you *CAN* just configure a firewall rule and it WILL just work properly. Again, i'm talking from experience. | | --- | --- | --- | | | |  |  | [pests](user?id=pests) [8 months ago](item?id=40282921)   | [root](#40279798) | [parent](#40281695) | [next](#40284568) [–]  In your step 4, what happens when the VPN traffic gets routed over option 121 pushed routes? Don't you block it - thus blocking your entire VPN? > OR it will attempt to go through the more specific option 121 pushed malicious routes added by the compromised DHCP server (depending on the destination ip of the outbound packets). This right here... we don't want our VPN-secued traffic going out over routes broadcast by the malicious DHCP server, so you block it... right? How does that traffic leave the local network and reach the VPN server? | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40283742)   | [root](#40279798) | [parent](#40282921) | [next](#40284568) [–]  Read my reply to the other poster, i answer exactly this. Actually test it yourself. Stop theorizing. I tested it. It works exactly as I said. I think i know where you're confused. There is a firewall whitelist on the VPN endpoint route. Also it's impossible for the DHCP server to push a route more specific than this since it's a /32 route, so it's unaffected (together with the firewall rule allowing it) by anything the DHCP server attempts to do. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40284562)   | [root](#40279798) | [parent](#40283742) | [next](#40284568) [–]  I think you might be saying to add rules like `iptables -A OUTPUT -d <vpnserver>/32 -j ACCEPT`, `iptables -A OUTPUT -o vpn0 -j ACCEPT`, and `iptables -A OUTPUT -j DROP`. I'm a bit confused though because you only mentioned one rule and that's three. But also, I think using that combination of rules would result in dropping all traffic that someone attempts this attack against - in other words, turning it into a denial-of-service attack instead of a loss-of-confidentiality one. But there's no technical need to drop the maliciously-routed traffic, is there? | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40294947)   | [root](#40279798) | [parent](#40284562) | [next](#40284568) [–]  Yes exactly. It becomes a "denial of service" against the option 121 pushed subnet routes. That's already discussed in the paper, i assumed you knew that already. There's nothing else you can do in this situation other than detecting and then removing those routes, which is possible. In lieu of deleting the routes the best and most secure option is to block that subnet. A DoS is infinitely better than a LEAK. There are SOME things you could do (other than just removing the routes) to prevent the DoS i guess if you *REALLY* wanted - there is some package rewriting capabilties in the mac pf firewall and windows WFP would support this too (though it would require a 'callout' driver (kernel code) at the IP\_OUTBOUND layer), and linux allows something like this too with fwmarks and multiple routing tables + a source NAT, but it's not really worth the effort in a rare case like this. Easiest just to let those packets be blocked. The network you're on is controlled by a bad actor with a malicious DHCP server. Best option for you is to GTFO. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40295139)   | [root](#40279798) | [parent](#40294947) | [next](#40284568) [–]  Okay, I'm glad we've got that sorted out. What I do is put the VPN client into a tagged network namespace (yes, fwmark), and then have a routing rule that makes everything else use a separate routing table. The DHCP server inserts rules into the routing table used only by the VPN client. Doing it that way, all leaks are prevented, and also there's no way to denial-of-service traffic within the tunnel - no matter what routes are pushed, it keeps flowing as normal. No source NAT is required, only `MANGLE`. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40295563)   | [root](#40279798) | [parent](#40295139) | [next](#40284568) [–]  Cool! glad we're on the same page finally :) Yeah, lots of cool stuff you can do with Linux. just wish that the other OSes were half as good, unfortunately most of them require kernel code to do what would be a simple shell script in linux | | --- | --- | --- | | | |  |  | [Brian\_K\_White](user?id=Brian_K_White) [8 months ago](item?id=40284568)   | [root](#40279798) | [parent](#40281695) | [prev](#40282921) | [next](#40282657) [–]  The only problem with this persons comments is saying "you're wrong" "you're confused" so much. The actual content is 100%. Get over the "you're wrong" tone and ingest the tech message. It's really a misnomer to call the firewall a kill switch since it isn't reacting, it's already in effect, already blocking the bad traffic before the bad traffic happens. No switch is thrown. Any vpns that DO work that way are silly and should not be used. If this is most popular commercial vpns today, oh well so be it. The articles going around saying "affects all vpns and nothing can stop it" are also just silly and wrong. But it is probably true that most convenient vpns are currently leaking. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40284715)   | [root](#40279798) | [parent](#40284568) | [next](#40282657) [–]  I can see how you can write rules that block "bad traffic", but I can't see how you write them so they don't also block some "good traffic" when the network assigns a routing rule. I think the person here might be glossing over writing overzealous rules that cause the VPN connection to go down when an Option 121 route is assigned, when the ideal solution leaves the VPN functional (and causes tunneled traffic to ignore the route). | | --- | --- | --- | | | |  |  | [Brian\_K\_White](user?id=Brian_K_White) [8 months ago](item?id=40288305)   | [root](#40279798) | [parent](#40284715) | [next](#40282657) [–]  That has already been explained a couple times over. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40293078)   | [root](#40279798) | [parent](#40288305) | [next](#40282657) [–]  I don't understand your explanation because you just keep alluding to certain firewall rules but not actually showing them. If you've done this, could you paste an `iptables -L -v` for me? That would make clear exactly what you're talking about. If there is a problem, I could then point it out, and if there is not, I could then understand how to do what you're saying. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40282657)   | [root](#40279798) | [parent](#40281695) | [prev](#40284568) | [next](#40280563) [–]  I think you missed a step in your progression. Step one, you connect to the network and get routes. Step two, you connect your VPN. Step three, your host starts sending traffic. At this point, your firewall rules are now active and dropping any traffic you've told them to. Step four, you renew your DHCP lease and get new routes via option 121. Those routes might be malicious, or they might not. One of three things is true at step four. Either: A. Your firewall rules will block all traffic over the new routes B. Your firewal rules will not block any traffic over the new routes C. Your firewall rules will block some subset of traffic over the new routes If A is true, then your VPN tunnel goes down (undesirable), as the VPN server can no longer be contacted. If B is true, then you are vulnerable to the TunnelVision exploit. If C is true, and the subset of traffic blocked is exactly the subset intended to route over the VPN but maliciously diverted, then the VPN tunnel goes down because the firewall rules are blocking its traffic. If C is true, and somehow the firewall rule is rewriting the traffic that's pointed not-over-the-VPN to be instead routed over the VPN (by using NAT?), then the VPN tunnel stays up and there is no problem. I'd be interested in seeing the set of firewall rules that will let the VPN tunnel stay up, with management traffic going over the added-after-the-tunnel-was-brought-up next-hop, and tunneled traffic continuing to flow ignoring the new route. I haven't seen those rules in the past so if you have experience writing them, please show me. Personally I've only used Linux multiple routing tables to plug this leak. EDIT: formatting | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40283735)   | [root](#40279798) | [parent](#40282657) | [next](#40280563) [–]  No, you're wrong again. I just tested this (simulating routes added by a DHCP option 121) and it works exactly as I said. C is what happens. But it doesn't happen the way you say at all. Only the traffic heading to the new 121 routes are blocked - why is it blocked? because the routes are on the physical interface, and the firewall rules blocks all off-VPN traffic (except traffic to the VPN endpoint itself) The tunnel stays up because the tunnel connection is over the physical interface. The VPN endpoint has a physical route from the host to the VPN endpoint which is whitelisted in the firewall. So new physical routes (which option 121 would push) don't impact anything as VPN endpoint route is physical anyway. Also it's impossible for the DHCP server to push a route MORE specific than the endpoint route (which is a /32) that already exists, so it can't be overridden (and it wouldn't matter anyway since it would still be a physical route, which is what is desired here). Can you stop just talking and actually TRY it? it's all theoretical for you since you're not actually testing it and your theory is completely wrong. I am actually testing it, so i know I am correct. | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40284509)   | [root](#40279798) | [parent](#40283735) | [next](#40280563) [–]  Could you please show me a rule so I can "try it"? I'd love it if this worked. Let's say: - the physical interface name is "wlan0" - the VPN virtual interface name is "tun0" - the VPN server is 10.1.1.1 on TCP port 8888 - the DHCP server on initial lease sends "0.0.0.0/0 via 10.8.8.8" - the DHCP server on renew sends the above rule and also "10.0.0.0/8 via 10.9.9.9" - Before the renew, traffic not routed via 10.8.8.8 is blocked - After the renew, traffic with a destination IP matching 10.0.0.0/8 not routed via 10.9.9.9 is blocked What should the firewall rule look like to let the VPN connection stay up both before and after the new rule, while also ensuring that traffic to 10.7.7.7 goes via the VPN and not via 10.9.9.9 or 10.8.8.8? EDIT: you keep saying "I'm wrong" but I'm just asking how this firewall rule can be structured to do what you say. It occurs to me that perhaps you're saying you can make traffic for 10.7.7.7 get blocked. But in the above, and before, what I'm asking for is how to make traffic for 10.7.7.7 continue to get sent over the VPN after the new rule addition, just like it was before - in other words, no dropped packets. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40294887)   | [root](#40279798) | [parent](#40284509) | [next](#40280563) [–]  Your examples are strange as you're using rfc1918 addresses (i.e private range) rather than public ips. So all your examples are very odd. 10.7.7.7 will get dropped. This is correct behaviour based on the routing rules in your example. The VPN connection will stay up as it has a /32 route setup through the wlan0 interface. What we're concerned about with TunnelVision is preventing LEAKS, this is what constitutes VPN security. If the DHCP server sends a route that forces traffic through the physical interface instead, then the best you can do is BLOCK it. If you really wanted to you could detect and remove the route, but that's a different question and still has nothing to do with the question we're concerned about which is plugging LEAKS. Also why on earth are you using rfc1918 addresses as an example, it's more meaningful to be using public ip addresses - i.e the DHCP server pushes a 1.1.1.1/32 route. The issue with rfc1918 addresses is it's totally not clear if they will get routed at all as you didn't specify whether they're on-link or not as you didn't provide a subnet mask. The rules are: \* an ALLOW rule on the vpn endpoint ip + a /32 route for the endpoint \* an ALLOW rule on tun0 traffic \* a BLOCK rule on EVERYTHING else - i.e just a iptables -I OUTPUT -j DROP Can we please stop the back and forth now, it's really starting to chew up too much time. I don't want to have a conversation about the specific addressing scheme you're using - you should have used public ips to make things much clearer, i don't want a long argument now about subbets and whether certain addreses in your example are on-link or require a routing hop. This is so tiring. :) | | --- | --- | --- | | | |  |  | [Borealid](user?id=Borealid) [8 months ago](item?id=40295158)   | [root](#40279798) | [parent](#40294887) | [next](#40280563) [–]  I used RFC1918 addresses as examples only. 10.7.7.7 shouldn't get dropped, because it's supposed to be routed over the VPN. The DHCP server shouldn't be able to cause VPN-bound traffic to be dropped, in my opinion. As I replied to one of your other comments, I don't think making the attack go from privacy-breach to denial-of-service is "preventing" the attack: you've only partially mitigated it. Full mitigation requires more than the firewall rules you've described. Said differently, a malicious DHCP server should not be able to denial-of-service traffic within your VPN (or, by selectively pushing routes and then observing the impact on generated traffic, probabalistically determine the IPs with which you're communicating!). | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40295574)   | [root](#40279798) | [parent](#40295158) | [next](#40280563) [–]  Ok. Well, the attack is so rare that i don't believe putting mitigations against the DoS is worth the effort. The mitigations are not that trivial (though it's arguable that just removing the route is kind of trivial, but still not worth it IMO). Better a DoS than a leak in any case :) | | --- | --- | --- | | | |  |  | [0x457](user?id=0x457) [8 months ago](item?id=40280563)   | [root](#40279798) | [parent](#40280496) | [prev](#40280597) | [next](#40280667) [–]  Let's be honest, there're 2 OSs on desktop that matter to VPN providers that provide "all-in-one app" - Windows and macOS. Both have easy to configure from your application. On linux, well, you have to choose: - use iptables style rules regardless of the backend or - use nftables style rules regardless of the backend. So it's 3 firewalls that you have to think about. On mobile, well, on mobile you're mostly at the mercy of the platform owner and generally can't do much. Hence, why connecting phone to "SoftAP/ether\_g + VPN" device is better than a direct connection. | | --- | --- | --- | | | |  |  | [Dylan16807](user?id=Dylan16807) [8 months ago](item?id=40280667)   | [root](#40279798) | [parent](#40280376) | [prev](#40280496) | [next](#40280532) [–]  > A kill switch is just Not always. Some VPNs have a kill switch feature for closing specified programs. Hopefully in addition to the firewall rule. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280725)   | [root](#40279798) | [parent](#40280667) | [next](#40280532) [–]  "closing specified programs" has to be the silliest thing i've ever heard. By the time you close it, it's probably already leaked thousands of packets. The leak of a SINGLE packet is already too much. Such an "application killing kill switch" is just marketing fluff, it makes zero sense from a security standpoint. | | --- | --- | --- | | | |  |  | [\_twor](user?id=_twor) [8 months ago](item?id=40283880)   | [root](#40279798) | [parent](#40280725) | [next](#40282417) [–]  I can't check your fascinating answers but a friend is, and is beginning to concur, so I'll take theirs and your advice as closer to correct. Thank you. Next question, where have you been for so long and only back now why giving such juicy answers? | | --- | --- | --- | | | |  |  | [Dylan16807](user?id=Dylan16807) [8 months ago](item?id=40282417)   | [root](#40279798) | [parent](#40280725) | [prev](#40283880) | [next](#40280532) [–]  Well to be fair I'm not sure if they kill the programs before or after disconnecting the VPN interface. I'd sure hope it's before. | | --- | --- | --- | | | |  |  | [0x457](user?id=0x457) [8 months ago](item?id=40280532)   | [root](#40279798) | [parent](#40280351) | [prev](#40280376) | [next](#40280289) [–]  Let me explain how a \_very\_ basic setup works: you set up a firewall rules allowing only connection to VPN on all interfaces except your VPN interface. If you're running a torrent box, then you can do whatever your OS equivalent of "this process uses this routing table". My seed box was using interfaces that were set up in dom0 and guests didn't even know about a ways to reach outside without a VPN connection being established by the host. The point is - "such" attacks have no legs against anything beyond "OpenVPN: Getting Started" kind of server. | | --- | --- | --- | | | |  |  | [barbariangrunge](user?id=barbariangrunge) [8 months ago](item?id=40280289)   | [root](#40279798) | [parent](#40280266) | [prev](#40280351) | [next](#40280976) [–]  Looking at mozilla vpn, I can’t tell if there is such a setting, unless it’s just enabled by default. Can anyone clarify? | | --- | --- | --- | | | |  |  | [SushiHippie](user?id=SushiHippie) [8 months ago](item?id=40280417)   | [root](#40279798) | [parent](#40280289) | [next](#40280976) [–]  > A VPN kill switch is a must-have for privacy reasons when using a VPN. If you are actively using the VPN to transfer data and your Internet connection becomes unstable or drops, the entire network connection on your device will be blocked to prevent your local IP address from being exposed to the outside world. The kill switch is on by default on Windows, Android, iOS, macOS and Linux and there is no setting to turn it off. <https://support.mozilla.org/en-US/kb/mozilla-vpn-kill-switch> | | --- | --- | --- | | | |  |  | [ajsnigrutin](user?id=ajsnigrutin) [8 months ago](item?id=40280976)   | [parent](#40279798) | [prev](#40279966) | [next](#40280070) [–]  ...and the attacker needs to be in the same L2 network as the victim to trigger the attack. (i guess... didn't read the article, just the post above) | | --- | --- | --- | | | |  |  | [sambazi](user?id=sambazi) [8 months ago](item?id=40283096)   | [root](#40279798) | [parent](#40280976) | [next](#40280070) [–]  virtual network interfaces are a thing | | --- | --- | --- | | | |  |  | [ajsnigrutin](user?id=ajsnigrutin) [8 months ago](item?id=40286117)   | [root](#40279798) | [parent](#40283096) | [next](#40291718) [–]  Sure, but he still needs access to the L2 network, the virtual interface has to be connected/bridged to something. Unless if you're thinking about a virtual interface and dhcp server directly on the victims pc (bridged to the interface with the dhcp client), but if the attacker can do that, he can also just capture the data directly. | | --- | --- | --- | | | |  |  | [remram](user?id=remram) [8 months ago](item?id=40291718)   | [root](#40279798) | [parent](#40283096) | [prev](#40286117) | [next](#40280070) [–]  Yes but what do you mean by that? | | --- | --- | --- | | | |  |  | [k0ss\_net](user?id=k0ss_net) [8 months ago](item?id=40280070)   | [prev](#40279798) | [next](#40279843) [–]  I swore I had already read about this attack from some other author, so I went searching and after sifting through tons of VPN provider spam in search results I found the prior work [1]. This new article goes into some more depth on how to exploit the flaw and has some code to help PoC it though. 1: [https://www.usenix.org/conference/usenixsecurity23/presentat...](https://www.usenix.org/conference/usenixsecurity23/presentation/xue) | | --- | --- | --- | | | |  |  | [gnabgib](user?id=gnabgib) [8 months ago](item?id=40280137)   | [parent](#40280070) | [next](#40283113) [–]  That article is referenced in the Appendix: ```   However, neither technique described in the August 2023 paper leveraged DHCP option 121 to push routes. Pushing routes through DHCP has a significantly higher impact from the same attacker vantage point (the ability to hand out IP leases for a non-RFC1918 range or spoofing DNS replies). ``` | | --- | --- | --- | | | |  |  | [k0ss\_net](user?id=k0ss_net) [8 months ago](item?id=40280769)   | [root](#40280070) | [parent](#40280137) | [next](#40283113) [–]  Ah good find, I totally missed the appendix when reading on mobile. | | --- | --- | --- | | | |  |  | [sambazi](user?id=sambazi) [8 months ago](item?id=40283113)   | [parent](#40280070) | [prev](#40280137) | [next](#40279843) [–]  the "attack" is widely known and is used as a config option for the openvpn client (redirect-gateway def1) | | --- | --- | --- | | | |  |  | [pushedx](user?id=pushedx) [8 months ago](item?id=40279843)   | [prev](#40280070) | [next](#40280243) [–]  The threat model is that an arbitrary attacker can somehow become the DHCP server on your LAN, which is unlikely but not impossible. On the other hand, if you are using an ISP provided gateway device.. | | --- | --- | --- | | | |  |  | [smarx007](user?id=smarx007) [8 months ago](item?id=40280017)   | [parent](#40279843) | [next](#40280267) [–]  > arbitrary attacker can somehow become the DHCP server on your LAN, which is unlikely but not impossible Coffee shop wi-fi? A.k.a merely the no. 1 selling point for most VPN offerings. The proper course of action in this case is to use your 4G/5G connection and not to connect to shady networks you don't trust. | | --- | --- | --- | | | |  |  | [SahAssar](user?id=SahAssar) [8 months ago](item?id=40280231)   | [root](#40279843) | [parent](#40280017) | [next](#40283196) [–]  > A.k.a merely the no. 1 selling point for most VPN offerings. I thought the selling point was protection against hackers. No, was it your ISP seeing your (basically always HTTPS encrypted) traffic? Or facebook/google harvesting your data? Or russian hackers? Or watching netflix from other countries? Or data-harvesters watching your traffic? Or if you just really like downloading linux ISOs? I also think I heard something about snowden and NSA tracking in a few ads. Something something cheaper airplane tickets? Either way, it's all scary and for the low fee of 5$ per month (sign up for 3 years and you get 3 months free with my code!) you don't have to worry your pretty little head about it anymore. Don't worry about that our company is registered in Bermuda and is just 3 months old. | | --- | --- | --- | | | |  |  | [acdha](user?id=acdha) [8 months ago](item?id=40280812)   | [root](#40279843) | [parent](#40280231) | [next](#40283196) [–]  There are super shady VPN providers but that doesn’t mean local network risks can be ignored. For example, how frequently do you hear about compromised networks of routers and access points? Attackers could be using those for far more stealthy means. Also, remember when Verizon decided to helpfully inject cross-domain tracking cookies into their customers’ traffic? Do you really want to gamble that some MBA wouldn’t start to think about ways to monetize activity collection from VPN users? Some provider won’t sell schools, coffee shops, etc. a service which will block the “wrong” traffic and that just quietly expands to cover, say, women looking for family planning advice or college students in Florida looking for trans support? | | --- | --- | --- | | | |  |  | [mschuster91](user?id=mschuster91) [8 months ago](item?id=40283196)   | [root](#40279843) | [parent](#40280017) | [prev](#40280231) | [next](#40283986) [–]  > The proper course of action in this case is to use your 4G/5G connection and not to connect to shady networks you don't trust. Sadly, there are carriers on this planet who think it's a good idea to charge ridiculous prices for mobile data (Germany) or to block hotspot functionality unless you pay up (US, see [1] for the technical background - both Apple and Google are complicit). In a world where politicians would care about their people, there would be no need for wifi hotspots to exist in the first place. Additionally, there are certain advertising brokers such as utiq that cooperate with major phone networks to provide detailed tracking, so they and advertisers know pretty precisely who you are just because you tethered your laptop to your phone. And finally, you can't trust your phone ISP either - Verizon got caught red-handed injecting tracking "supercookies" into their customers' traffic [2], thank God at least that vector got closed with everyone and their dog going HTTPS. In general: anything involving residential ISPs is rife with scams. [1] <https://news.ycombinator.com/item?id=20460438> [2] [http://webpolicy.org/2014/10/24/how-verizons-advertising-hea...](http://webpolicy.org/2014/10/24/how-verizons-advertising-header-works/) | | --- | --- | --- | | | |  |  | [prmoustache](user?id=prmoustache) [8 months ago](item?id=40283986)   | [root](#40279843) | [parent](#40280017) | [prev](#40283196) | [next](#40280267) [–]  > Coffee shop wi-fi? A.k.a merely the no. 1 selling point for most VPN offerings. Isn't the #1 selling point of general consumer's (not Enterprise) VPNs to stream video and audio from another country? | | --- | --- | --- | | | |  |  | [threePointFive](user?id=threePointFive) [8 months ago](item?id=40280267)   | [parent](#40279843) | [prev](#40280017) | [next](#40280073) [–]  "the DCHP server" implies it is somehow a special device on your network, which is a flawed assumption. DHCP works on an broadcast protocol and your device will accept the first offer. The fact that the most common residential configuration is for your DHCP to be hosted on your router and thus likely the first to respond is inconsequential to the fact that any hostile device on your network could use this exploit. | | --- | --- | --- | | | |  |  | [immibis](user?id=immibis) [8 months ago](item?id=40281712)   | [root](#40279843) | [parent](#40280267) | [next](#40280657) [–]  That's not at all guaranteed. The residential gateway most likely contains a hardware switch and a CPU, which also does the routing. The CPU is attached to the switch like any other device, though probably with less physical-layer bits, and some of them aren't all that fast. | | --- | --- | --- | | | |  |  | [pushedx](user?id=pushedx) [8 months ago](item?id=40280657)   | [root](#40279843) | [parent](#40280267) | [prev](#40281712) | [next](#40280073) [–]  not implying anything in that regard, I can imagine a clever attack which involves a local malicious dhcp implementation | | --- | --- | --- | | | |  |  | [flir](user?id=flir) [8 months ago](item?id=40280073)   | [parent](#40279843) | [prev](#40280267) | [next](#40279992) [–]  Surely one of the big use-cases for a VPN is that the network you're connected to is untrusted? | | --- | --- | --- | | | |  |  | [radiowave](user?id=radiowave) [8 months ago](item?id=40279992)   | [parent](#40279843) | [prev](#40280073) | [next](#40280066) [–]  Or become the DHCP server on whatever third party wifi you're connected to. | | --- | --- | --- | | | |  |  | [tgsovlerkhgsel](user?id=tgsovlerkhgsel) [8 months ago](item?id=40280066)   | [parent](#40279843) | [prev](#40279992) | [next](#40283793) [–]  That's one of the commonly advertised reasons to use VPNs: protection in untrusted WiFi networks. | | --- | --- | --- | | | |  |  | [justanotherjoe](user?id=justanotherjoe) [8 months ago](item?id=40283793)   | [parent](#40279843) | [prev](#40280066) | [next](#40280246) [–]  what are you insinuating? I still need to be spelt out. Are you saying that ISP's gateway device have any incentives to decloak my vpn traffic? Sounds like a huge liability for no reason? Surely they will be out of business it sounds so bad? | | --- | --- | --- | | | |  |  | [CodeWriter23](user?id=CodeWriter23) [8 months ago](item?id=40280246)   | [parent](#40279843) | [prev](#40283793) | [next](#40280056) [–]  You mean like a pwned home router? | | --- | --- | --- | | | |  |  | [Aurornis](user?id=Aurornis) [8 months ago](item?id=40280056)   | [parent](#40279843) | [prev](#40280246) | [next](#40280243) [–]  The risk is outside the home: Using a VPN at the coffee shop, hotel, office, etc. | | --- | --- | --- | | | |  |  | [isodude](user?id=isodude) [8 months ago](item?id=40280243)   | [prev](#40279843) | [next](#40284201) [–]  You can also mitigate this by placing the VPN interface in a VRF on Linux. I.e. systemd-networkd have support for doing that out of the box. One thing to watch out or is that when enabling VRF, the ip rule entry for l3mdev is listed as 1000 but rule for local traffic is listed as 0, the local rule should be moved to 1000+. | | --- | --- | --- | | | |  |  | [sargun](user?id=sargun) [8 months ago](item?id=40280280)   | [parent](#40280243) | [next](#40284201) [–]  Is there a way to run an app in a specific VRF nowadays? | | --- | --- | --- | | | |  |  | [tuetuopay](user?id=tuetuopay) [8 months ago](item?id=40280305)   | [root](#40280243) | [parent](#40280280) | [next](#40280307) [–]  Just like with netns using ip: `ip vrf exec <vrf> <command>`. It’s been available for a while now | | --- | --- | --- | | | |  |  | [isodude](user?id=isodude) [8 months ago](item?id=40280307)   | [root](#40280243) | [parent](#40280280) | [prev](#40280305) | [next](#40284201) [–]  Look here: <https://jerryxiao.cc/archives/1004> Yes, it's eBPF but the solution is quite neat to be honest. And you can integrate it into systemd units. | | --- | --- | --- | | | |  |  | [crest](user?id=crest) [8 months ago](item?id=40284201)   | [prev](#40280243) | [next](#40281016) [–]  The "attack" is just a clever use of DHCP option 121. It's a valid attack against a badly broken client configuration. Just replacing the default route (or overwriting it with two /1 routes) and adding a host route to the VPN endpoint is not secure. To properly isolate the encapsulated traffic from the underlaying network you have to use proper policy based routing (e.g. Linux network namespaces, FreeBSD vnet, OpenBSD rdomains). Attempting to cobble together something with packet filters and a userspace "kill switch" is broken by design and just shows how little the common VPN hosters understand or care about their supposed core competency. Good old enumerating badness strikes again. | | --- | --- | --- | | | |  |  | [Grimeton](user?id=Grimeton) [8 months ago](item?id=40281016)   | [prev](#40284201) | [next](#40279995) [–]  What else is new? I'm more worried about people using VPN services that are IP4 only while having IP6 enabled in the system. That can go terribly wrong... | | --- | --- | --- | | | |  |  | [tristor](user?id=tristor) [8 months ago](item?id=40279995)   | [prev](#40281016) | [next](#40282947) [–]  There are numerous ways to defeat a VPN on a client device, this is why I prefer to put a router that terminates VPN tunnels with no other available routes between my clients and the Internet when I feel the need for a VPN. You can trivially set up one of these "travel routers" and carry it with you everywhere, which is exactly what I do. | | --- | --- | --- | | | |  |  | [AnotherGoodName](user?id=AnotherGoodName) [8 months ago](item?id=40280138)   | [parent](#40279995) | [next](#40282685) [–]  I highly encourage dedicated VPN routers at home with each router having it's own wifi network as a way to connect to VPNs. It's easier to connect and more reliable than locally running VPN software on each device imho. Eg. I have a router sharing wifi for 'work' with a permanently maintained vpn connection to the workplace intranet. Another sharing wifi as 'Australia' that I connect to whenever I want to watch TV from Australia with a VPN to an Australian server and lastly the standard home Internet wifi. It's super easy to do if you have a couple of old wifi routers and even cheap home ones seem to have some VPN support these days. A big advantage, aside from centralizing the VPN setup so you don't screw it up is that it's trivial to connect any device to the VPN. Just join the relevant wifi address! Boom I'm now in a VPN to Australia from any device without messing around setting up that device specifically because I connected to the 'Australia' wifi. I do this with multiple old routers but I actually think there's probably a market for a single home router that vpns to multiple locations in the world with a different wifi network for each of those just for the sake of easily having your TV/Roku/iPad appearing to be from somewhere else trivially. | | --- | --- | --- | | | |  |  | [CommitSyn](user?id=CommitSyn) [8 months ago](item?id=40280406)   | [root](#40279995) | [parent](#40280138) | [next](#40282685) [–]  Is there a simple DIY? Is it as simple as running a custom router firmware or software on a small mini PC? Last I looked into this a couple years ago, it basically wasn't possible to chain multiple VPN providers on the same machine, even using VPNs, but maybe I'm misremembering. You could of course just use the built-in VPN connection of your router, but that lacks all the benefits of updated software/firewall, and I want my family to be able to watch Netflix, browse the web without running a CAPTCHAthon, etc. | | --- | --- | --- | | | |  |  | [madars](user?id=madars) [8 months ago](item?id=40282483)   | [root](#40279995) | [parent](#40280406) | [next](#40282685) [–]  [https://kiljan.org/2021/12/14/vpn-as-wan-for-guest-network-o...](https://kiljan.org/2021/12/14/vpn-as-wan-for-guest-network-on-openwrt-2021-edition/) is a great start for how to set up a WiFi network with an always-on VPN | | --- | --- | --- | | | |  |  | [varenc](user?id=varenc) [8 months ago](item?id=40282685)   | [parent](#40279995) | [prev](#40280138) | [next](#40280139) [–]  The attack is only possible when you have untrusted devices on your local LAN. If you’re already bringing your own gateway with a VPN on it then I’m guessing untrusted LAN devices aren’t much of a concern. But if you did have something untrusted on your LAN and you’re using DHCP, then that untrusted device could snoop your unencrypted\* traffic with this trick, albeit it couldn’t find your real IP since your gateway is concealing that. The attack seems most feasible in a coffee shop wifi situation, where you’re unlikely to be bringing your own router. \*by “unencrypted traffic” I mean traffic that’s not encapsulated for transport to your VPN provider. Most everything is HTTPS nowadays so the contents of that traffic would still be encrypted of course. | | --- | --- | --- | | | |  |  | [tristor](user?id=tristor) [8 months ago](item?id=40284813)   | [root](#40279995) | [parent](#40282685) | [next](#40280139) [–]  Why would you be unlikely to bring your own router in a coffee-shop situation? My travel router fits in a small pouch with its power adapter and together is no larger than a couple of decks of cards. If I have my laptop, then I have my backpack, which means I have my travel router. | | --- | --- | --- | | | |  |  | [varenc](user?id=varenc) [8 months ago](item?id=40292966)   | [root](#40279995) | [parent](#40284813) | [next](#40280139) [–]  Hah, well I have a travel router as well I use for things like hotels, but I wouldn't really want to bring it to a coffeeshop because the setup process is a bit onerous. I need to get the travel router to connect to whatever the coffeshop's wifi is and then get through its captive portal. The last part can be tricky in my experience though it's certainly doable. Personally I wouldn't bother with the hassle and would instead just rely on an on-device VPN which I now would need to ensure is protected from this type of attack. | | --- | --- | --- | | | |  |  | [wolverine876](user?id=wolverine876) [8 months ago](item?id=40280139)   | [parent](#40279995) | [prev](#40282685) | [next](#40280276) [–]  If you could list some hardware and software, it would save us the effort ... | | --- | --- | --- | | | |  |  | [tristor](user?id=tristor) [8 months ago](item?id=40284514)   | [root](#40279995) | [parent](#40280139) | [next](#40280276) [–]  I currently carry a GL-Inet MT-3000 with me. | | --- | --- | --- | | | |  |  | [Aloisius](user?id=Aloisius) [8 months ago](item?id=40280276)   | [parent](#40279995) | [prev](#40280139) | [next](#40282947) [–]  I'd imagine most travel routers are still vulnerable to this. | | --- | --- | --- | | | |  |  | [tristor](user?id=tristor) [8 months ago](item?id=40284835)   | [root](#40279995) | [parent](#40280276) | [next](#40282947) [–]  How? Serious question. This uses DHCP Options to set routes, which is an optional behavior on the client (but on by default), I have it disabled. I also don’t allow setting DNS via DHCP or anything but giving me an IP and gateway. Clients behind the device are unimpacted, the device itself is configured in a way which eliminates this vulnerability. | | --- | --- | --- | | | |  |  | [caeruleus](user?id=caeruleus) [8 months ago](item?id=40282947)   | [prev](#40279995) | [next](#40280348) [–]  This should have been pretty obvious for more technical people, but it's a nice introduction into networking and VPNs. I have configured a Linux VPN gateway VM a couple of times now and the reliance on the routing table only always felt brittle, especially when paired with running on the same machine that uses the connection. In addition to network namespaces and physical VPN gateway routers, an architecture based on VMs can thus also solve this. In my homelab, the firewall blocks any unexpected traffic from the VPN gateway VM (devices in the VPN VLAN are not allowed any outgoing connections, the gateway VM has a separate VLAN for outgoing ones). As a personal solution, QubesOS makes configuring a similar setup quite friction-less, but once again requires more technical knowledge than a regular OS. | | --- | --- | --- | | | |  |  | [mrbluecoat](user?id=mrbluecoat) [8 months ago](item?id=40280348)   | [prev](#40282947) | [next](#40280260) [–]  > because Android does not implement support for DHCP option 121, it was uniquely unaffected Curious if that was a deliberate decision because Google knew about this or completely coincidental.. | | --- | --- | --- | | | |  |  | [kccqzy](user?id=kccqzy) [8 months ago](item?id=40280946)   | [parent](#40280348) | [next](#40280430) [–]  Looking at <https://issuetracker.google.com/issues/117544989> seems like Google mostly just ignored this feature request without giving any reason. I wonder the same. Perhaps someone who works at Google with access to the internal Buganizer will know more. But if you want me to speculate, my speculation is that the team behind Android networking is highly pro-IPv6. They don't really care about missing niche features in IPv4. Even for IPv6 they have a specific vision for how IPv6 should be used, resulting in deliberate non-support of features like stateful DHCPv6. | | --- | --- | --- | | | |  |  | [skissane](user?id=skissane) [8 months ago](item?id=40280430)   | [parent](#40280348) | [prev](#40280946) | [next](#40280515) [–]  There are so many DHCP options, for something like Android it makes sense to start with only supporting the bare minimum and then only enable support for an additional option if there is a requirement raised for it. Given this DHCP option isn’t commonly used, such a strategy would likely result in it not being supported, irrespective of any security concerns with it. | | --- | --- | --- | | | |  |  | [megous](user?id=megous) [8 months ago](item?id=40280515)   | [parent](#40280348) | [prev](#40280430) | [next](#40280260) [–]  Android doesn't even implement the new DHCP version defined first 21 years ago: <https://www.rfc-editor.org/rfc/rfc3315> So not really a surprise. | | --- | --- | --- | | | |  |  | [EasyMark](user?id=EasyMark) [8 months ago](item?id=40280260)   | [prev](#40280348) | [next](#40283244) [–]  I haven't seen anywhere that said there can be a "fix" for this outside of not allowing "option 121" to be in use at all the DHCP server. Is there no way to mitigate this in the VPN client, or is it simply too fundamental to the way the networks work that there is and never can be a "fix" on the VPN client? I wouldn't expect a malware laden network's "admin" to ever fix this or even hear about it. | | --- | --- | --- | | | |  |  | [morattisec](user?id=morattisec) [8 months ago](item?id=40280296)   | [parent](#40280260) | [next](#40280297) [–]  The only fix we’ve observed in the wild was limited to Linux hosts. WireGuard has documentation about how to implement that properly using network namespaces which can be used to isolate network stacks. <https://www.wireguard.com/netns/> however, the VPN provider must implement it this way. In our demo we use WireGuard that is implemented without namespaces. The other operating systems do not support that feature. The mitigations we saw were firewall based rules, which create a side-channel that be used to leak the destination of traffic. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280324)   | [root](#40280260) | [parent](#40280296) | [next](#40280297) [–]  The "side channel" is silly. You assume someone is hitting the same endpoint over and over and over and with significantly high traffic that it rises above the noise. Did u even do any of the math required to demonstrate it can actually work in a reasonable time frame? Did u clearly list the very onerous assumptions required to pull it off? This whole thing is silly. | | --- | --- | --- | | | |  |  | [morattisec](user?id=morattisec) [8 months ago](item?id=40280470)   | [root](#40280260) | [parent](#40280324) | [next](#40280297) [–]  So in the example we gave for the side-channel you’d be correct that “it depends”. We also wrote that it was flexible. I do want to point out that you could deny all traffic except allow a single IP address to test the inverse in a low traffic setting. With a low DHCP lease time it’s feasible that could look like a shaky connection. This is only possible because the kill switches don’t actually disconnect the user. There’s also mitigation bypasses that are likely to be discovered, we have a few we’re working on. | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280518)   | [root](#40280260) | [parent](#40280470) | [next](#40280297) [–]  The side channel attack is silly and impractical. You know it's silly. I know it's silly. Let's quit pretending. The firewall rule is 100% sufficient to defend against this exploit. All good VPNs already provide it by default. It's not deep. They're just routes. Please stop the FUD. | | --- | --- | --- | | | |  |  | [StressedDev](user?id=StressedDev) [8 months ago](item?id=40281189)   | [root](#40280260) | [parent](#40280518) | [next](#40290192) [–]  Side channels are a huge danger. An example is cryptographic functions have been cracked because of timing differences based on the key or data being encrypted. This is why cryptographic ciphers are implemented in constant time code (i.e. code that always runs in the same amount of time regardless of its input). | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40281261)   | [root](#40280260) | [parent](#40281189) | [next](#40290192) [–]  I'm talking about the *specific side channel attack* mentioned in their report. Not side channels generally ;) | | --- | --- | --- | | | |  |  | [hughesjj](user?id=hughesjj) [8 months ago](item?id=40290192)   | [root](#40280260) | [parent](#40280518) | [prev](#40281189) | [next](#40280297) [–]  Did you say the same thing about meltdown/spectre? Ramhammer? Those are way more impractical but the industry still moved mountains (and killed perf) to mitigate them | | --- | --- | --- | | | |  |  | [banister](user?id=banister) [8 months ago](item?id=40280297)   | [parent](#40280260) | [prev](#40280296) | [next](#40283244) [–]  Most decent VPNs are already protected against it. It's a simple firewall rule known as leak protection or a kill switch which blocks all off-VPN traffic including on option 121 routes. This article is 99% FUD IMO. | | --- | --- | --- | | | |  |  | [EasyMark](user?id=EasyMark) [8 months ago](item?id=40346522)   | [root](#40280260) | [parent](#40280297) | [next](#40283244) [–]  Thanks. I might send a support email request to mullvad and see if they're affected. | | --- | --- | --- | | | |  |  | [dpeckett](user?id=dpeckett) [8 months ago](item?id=40283244)   | [prev](#40280260) | [next](#40286182) [–]  An interesting (and portable) alternative to network namespaces is to bypass kernel networking entirely and use a userspace network stack. I've got an example of doing just that with my project Noisy Sockets, [https://github.com/noisysockets/noisysockets/blob/main/examp...](https://github.com/noisysockets/noisysockets/blob/main/examples/gateway/main.go) | | --- | --- | --- | | | |  |  | [catlikesshrimp](user?id=catlikesshrimp) [8 months ago](item?id=40286182)   | [prev](#40283244) | [next](#40279746) [–]  Not a rethoric question: Has anyone here compared western VPN services to Russian and Chinese available VPN? I know you are trading one spy for another, but those two countries are, supposedly, not cooperating with the west. You are also raising a tall flag whem connecting to one of those two countries via VPN. Appart from that, would it be more "Private" for the regular small time evildoer? | | --- | --- | --- | | | |  |  | [the8472](user?id=the8472) [8 months ago](item?id=40279746)   | [prev](#40286182) | [next](#40280314) [–]  linux not affected *if* network namespaces are used to separate vpn and physical interfaces. | | --- | --- | --- | | | |  |  | [jeroenhd](user?id=jeroenhd) [8 months ago](item?id=40280314)   | [prev](#40279746) | [next](#40280284) [–]  > We noted that because Android does not implement support for DHCP option 121, it was uniquely unaffected. Phew, that was my biggest concern. This would've been pretty difficult to work around (as are Android's well-known VPN bypasses through system apps, but those need local execution privileges). | | --- | --- | --- | | | |  |  | [isodude](user?id=isodude) [8 months ago](item?id=40280284)   | [prev](#40280314) | [next](#40279924) [–]  I saw a github project that tries to make wireguard+netns more easy to setup: <https://github.com/kalken/eznetns> | | --- | --- | --- | | | |  |  | [rnewme](user?id=rnewme) [8 months ago](item?id=40280355)   | [parent](#40280284) | [next](#40279924) [–]  What would be the opposite approach, to make sure all traffic goes through VPN, and only VPN, even if user didn't start the VPN connection (default to no connectivity)? Is there better approach then just disabling all other network interfaces? | | --- | --- | --- | | | |  |  | [isodude](user?id=isodude) [8 months ago](item?id=40280413)   | [root](#40280284) | [parent](#40280355) | [next](#40279924) [–]  AFAIK Wireguard will always listen in the default namespace, thus you need to isolate everything else. A fun way of doing it though is to do an ip rule that uses the VRF table, and matches on the user id. That way all traffic from certain users will always end up in the same routing table. You can go further and match on everything except the Wireguard endpoint. With iptables you can MARK the traffic you want to be differently and then catch that traffic with ip rule. | | --- | --- | --- | | | |  |  | [rnewme](user?id=rnewme) [8 months ago](item?id=40350875)   | [root](#40280284) | [parent](#40280413) | [next](#40279924) [–]  Cool, thank you! | | --- | --- | --- | | | |  |  | [ls612](user?id=ls612) [8 months ago](item?id=40279924)   | [prev](#40280284) | [next](#40286675) [–]  So for this attack does the attacker need to control your internet router? Or does it only need to control ISP infrastructure? | | --- | --- | --- | | | |  |  | [yjftsjthsd-h](user?id=yjftsjthsd-h) [8 months ago](item?id=40280007)   | [parent](#40279924) | [next](#40286675) [–]  Pretty sure the attacker has to control your DHCP server, which in ex. a home environment is usually the router. | | --- | --- | --- | | | |  |  | [tinco](user?id=tinco) [8 months ago](item?id=40280094)   | [root](#40279924) | [parent](#40280007) | [next](#40280133) [–]  No, the attacker just has to be on the network. When on the network the attacker can deploy various techniques to become the DHCP server. Since it's (relatively) easy to become a DHCP server on a network, it's considered a big deal when the DHCP server can trick you into doing something like in this case decloaking your VPN traffic. | | --- | --- | --- | | | |  |  | [ls612](user?id=ls612) [8 months ago](item?id=40280134)   | [root](#40279924) | [parent](#40280094) | [next](#40280133) [–]  What is the fix for this vulnerability? Is it the router that needs to get a software update, the VPN client, the OS, or some/all of the above? | | --- | --- | --- | | | |  |  | [tinco](user?id=tinco) [8 months ago](item?id=40280561)   | [root](#40279924) | [parent](#40280134) | [next](#40280133) [–]  The OS needs an extra feature, and then clients need to make use of that feature. There's other workarounds listed in the "Mitigations" section of the post. But the problem is basically that everything is working as intended, for example if you disable the "Option 121" feature then under certain circumstances you might not have internet connection. Apparently Android devices don't support Option 121 at all, and it makes them unaffected by this vulnerability, but also causes to sometimes not be able to connect to networks. | | --- | --- | --- | | | |  |  | [morattisec](user?id=morattisec) [8 months ago](item?id=40280133)   | [root](#40279924) | [parent](#40280007) | [prev](#40280094) | [next](#40280219) [–]  This is mostly correct, in our POC video we showcase a lab where we go from being an adjacent host on the network to being the DHCP server. We did this by DHCP starving the true DHCP server and hoarding all the leases. Then we serve our own and do not have to compete with the true DHCP. There’s network protections against this such as guest network isolation or switches with DHCP snooping protections. However, those are usually on enterprises and relying on those being in place kind of removes the point of “securing an untrusted network” like many VPN providers claim. | | --- | --- | --- | | | |  |  | [champtar](user?id=champtar) [8 months ago](item?id=40281573)   | [root](#40279924) | [parent](#40280133) | [next](#40280219) [–]  You should play with IPv6, you can bypass IPv6 RA Guard on some switches (including Cisco) <https://blog.champtar.fr/VLAN0_LLC_SNAP/>, allowing attacks in 'trusted' networks | | --- | --- | --- | | | |  |  | [lsllc](user?id=lsllc) [8 months ago](item?id=40280219)   | [root](#40279924) | [parent](#40280007) | [prev](#40280133) | [next](#40286675) [–]  Many networking switches/systems (e.g. UniFi from Ubiquiti) let you enable DHCP Snooping which drops Layer 2 traffic from rogue DHCP servers to prevent this: <https://en.wikipedia.org/wiki/DHCP_snooping> | | --- | --- | --- | | | |  |  | [champtar](user?id=champtar) [8 months ago](item?id=40281647)   | [root](#40279924) | [parent](#40280219) | [next](#40286675) [–]  I invite you to not trust blindly L2 security features, anything that use denylist approach can miss some corner cases, have a good read :) <https://blog.champtar.fr/VLAN0_LLC_SNAP/> | | --- | --- | --- | | | |  |  | [lsllc](user?id=lsllc) [8 months ago](item?id=40285519)   | [root](#40279924) | [parent](#40281647) | [next](#40286675) [–]  Interesting write up! I typically use multiple-WLANs as well as guest-isolation on the "guest" network which further reduces the attack surface. All of the network infra also runs on a separate management VLAN and (by default) switch ports are on the guest network so if someone randomly plugs in to a ethernet jack, they're not getting on the MGMT lan. Maybe not perfect, but certainly better than your average Comcast/Verizon/Orange/SFR setup! | | --- | --- | --- | | | |  |  | [gwbas1c](user?id=gwbas1c) [8 months ago](item?id=40286675)   | [prev](#40279924) | [next](#40283857) [–]  > We want to stress that there are ways an attacker who is on the same network as a targeted user might be able to become their DHCP server Does this mean your ISP could also perform this attack on you? IE: If there is a warrant for a wiretap, or otherwise your ISP is malicious? | | --- | --- | --- | | | |  |  | [deskr](user?id=deskr) [8 months ago](item?id=40283857)   | [prev](#40286675) | [next](#40299421) [–]  Improvement suggestion: This article could do with an executive summary for professionals. | | --- | --- | --- | | | |  |  | [diskdance](user?id=diskdance) [8 months ago](item?id=40299421)   | [prev](#40283857) | [next](#40279804) [–]  I have a mixed feeling about that Android keeps itself safe from this attack by not implementing DHCP option 121. IIRC Android also chooses not to support DHCPv6 intentionally. | | --- | --- | --- | | | |  |  | [formerly\_proven](user?id=formerly_proven) [8 months ago](item?id=40279804)   | [prev](#40299421) | [next](#40284929) [–]  tldr DHCP can add routes, so it can add routes for the internal network of a VPN. It’s not obvious to me why this works, because VPNs set metric 1 on their routes, that’s why traffic goes into them regardless of what IP the surrounding network used. DHCP option 121 has no metric field, so it should get a high default metric and shouldn’t have any impact on a VPN with specific routes. If you only “set the default gateway” (0.0.0.0/0 route), then this probably works. But that also seems particularly amateurish, even for enterprise VPN admins. | | --- | --- | --- | | | |  |  | [Aloisius](user?id=Aloisius) [8 months ago](item?id=40279872)   | [parent](#40279804) | [next](#40279827) [–]  More specific routes are higher priority than less specific ones, so 0.0.0.0/1 is chosen over one for 0.0.0.0/0 even with metric 1. | | --- | --- | --- | | | |  |  | [ikiris](user?id=ikiris) [8 months ago](item?id=40279827)   | [parent](#40279804) | [prev](#40279872) | [next](#40284929) [–]  because unless you have matching routes, most specific wins | | --- | --- | --- | | | |  |  | [sylware](user?id=sylware) [8 months ago](item?id=40284929)   | [prev](#40279804) | [next](#40283355) [–]  I recall 20 years ago: statistical attack on TOR network, namely with enough man-in-the-middle agents on TOR nodes, you actually "know"... | | --- | --- | --- | | | |  |  | [throw156754228](user?id=throw156754228) [8 months ago](item?id=40283355)   | [prev](#40284929) | [next](#40281059) [–]  Well written, I appreciated the background. Far more enjoyable to read than a good deal of the incoherent articles posted on here. | | --- | --- | --- | | | |  |  | [more\_corn](user?id=more_corn) [8 months ago](item?id=40281059)   | [prev](#40283355) | [next](#40283290) [–]  When connected to a hostile network. | | --- | --- | --- | | | |  |  | [avery17](user?id=avery17) [8 months ago](item?id=40281403)   | [parent](#40281059) | [next](#40283290) [–]  All networks will become hostile. Airport/airplane wifi is no longer safe as a simple example. | | --- | --- | --- | | | |  |  | [throwinway](user?id=throwinway) [8 months ago](item?id=40283290)   | [prev](#40281059) | [next](#40284803) [–]  Is disabling DHCP a mitigation? | | --- | --- | --- | | | |  |  | [incomingpain](user?id=incomingpain) [8 months ago](item?id=40284803)   | [prev](#40283290) | [next](#40282528) [–]  Cisco ASAs don't seem to support option 121. Are they immune to this one? | | --- | --- | --- | | | |  |  | [exabrial](user?id=exabrial) [8 months ago](item?id=40282528)   | [prev](#40284803) | [next](#40282351) [–]  Same like on device vpns are pretty sketchy. | | --- | --- | --- | | | |  |  | [ranger\_danger](user?id=ranger_danger) [8 months ago](item?id=40282351)   | [prev](#40282528) | [next](#40279748) [–]  Good thing I don't use DHCP. | | --- | --- | --- | | | |  |  | [acer4666](user?id=acer4666) [8 months ago](item?id=40279748)   | [prev](#40282351) | [next](#40280982) [–]  Is there a tl;dr so we don't have to wade through swathes of AI generated text explaining what a network is? | | --- | --- | --- | | | |  |  | [yjftsjthsd-h](user?id=yjftsjthsd-h) [8 months ago](item?id=40279793)   | [parent](#40279748) | [next](#40279971) [–]  An attacker who controls the DHCP server can give your device more specific routes and this apparently can cause traffic to go over those routes instead of the VPN. So if your VPN says that it's taking traffic for 0.0.0.0/0, and the DHCP server says 0.0.0.0/1 and 1.0.0.0/1 route over 10.1.1.1, then all your traffic gets sent over 10.1.1.1 because those routes are more specific so they "win". (Please feel free to correct if I've missed something; this was my interpretation of [https://arstechnica.com/security/2024/05/novel-attack-agains...](https://arstechnica.com/security/2024/05/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose/) ) | | --- | --- | --- | | | |  |  | [rahimnathwani](user?id=rahimnathwani) [8 months ago](item?id=40280922)   | [root](#40279748) | [parent](#40279793) | [next](#40279885) [–]  > can cause traffic to go over those routes instead of the VPN AIUI the vulnerability is more about forcing traffic via a specific *interface* than it is about the setting the *route*. The host's routing table contains at least these fields: A) destination (IP or subnet) B) gateway (aka route, aka next hop) C) interface The article says that when the route is set using DHCP Option 21, the interface field is set to the interface on which the DHCP response was received. So, if I've understood the article correctly, even if the route/gateway address is correct and not malicious, the host will send out packets for that destination via the regular (wifi or ethernet) interface, instead of the VPN interface. Imagine a coffee shop scenario: a malicious DHCP server responds to your DHCP request. It includes Option 121, making certain traffic go to the 10.0.0.1 (the coffee shop router address). Now, even though that gateway isn't malicious, the fact that the traffic is now going over the wifi interface instead of VPN, means someone can snoop on it. | | --- | --- | --- | | | |  |  | [sixothree](user?id=sixothree) [8 months ago](item?id=40279885)   | [root](#40279748) | [parent](#40279793) | [prev](#40280922) | [next](#40279971) [–]  Will static IP and gateway alleviate this threat? I guess at what level too. | | --- | --- | --- | | | |  |  | [jofla\_net](user?id=jofla_net) [8 months ago](item?id=40285825)   | [root](#40279748) | [parent](#40279885) | [next](#40279971) [–]  I tend to think yes. If the initial attack as i understand it, is from a dhcp server handing out poisoned options, then if a client is set-up as static from the get-go it'll never request a lease to begin with and, well, there you have it. | | --- | --- | --- | | | |  |  | [krebsonsecurity](user?id=krebsonsecurity) [8 months ago](item?id=40279971)   | [parent](#40279748) | [prev](#40279793) | [next](#40280039) [–]  I interviewed some smart people about their research in story published today: [https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-...](https://krebsonsecurity.com/2024/05/why-your-vpn-may-not-be-as-secure-as-it-claims/) | | --- | --- | --- | | | |  |  | [morattisec](user?id=morattisec) [8 months ago](item?id=40280039)   | [parent](#40279748) | [prev](#40279971) | [next](#40279763) [–]  You probably followed the advice to read from the 121 section already but if you’re sharing this others it might be helpful to link our website that serves as a TLDR + FAQ. <https://tunnelvisionbug.com/> There’s also a general public advisory there that’s supposed to be for anyone non-technical but who wants to understand the issue. All this content was also written by hand over 8ish months too, no AI was used | | --- | --- | --- | | | |  |  | [wrs](user?id=wrs) [8 months ago](item?id=40280084)   | [root](#40279748) | [parent](#40280039) | [next](#40279763) [–]  This is a great explanation of basic networking mechanisms that most people know almost nothing about. Don’t listen to the haters. I feel that I’m in a high percentile for networking knowledge, but I didn’t know about option 121! | | --- | --- | --- | | | |  |  | [rahimnathwani](user?id=rahimnathwani) [8 months ago](item?id=40279763)   | [parent](#40279748) | [prev](#40280039) | [next](#40280982) [–]  Scroll down to "What is DHCP option 121?" and start reading there. | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40280982)   | [prev](#40279748) | [next](#40279907) [–]  This is a perfect example of the CVE mining. There is nothing novel in the attack nor it's a security problem. DHCP environment *must* be trusted. We do have IP Source Guard and DHCP Snooping for decades to avoid scenarios from that link ( and many other). | | --- | --- | --- | | | |  |  | [StressedDev](user?id=StressedDev) [8 months ago](item?id=40281146)   | [parent](#40280982) | [next](#40279907) [–]  I have never heard anyone claim that VPNs only work if DHCP can be trusted. Note that that means trusting all devices on a network because any device can be a DHCP server. This is a great find and a real security bug. I cannot believe how many people are downplaying this work. | | --- | --- | --- | | | |  |  | [betaby](user?id=betaby) [8 months ago](item?id=40281924)   | [root](#40280982) | [parent](#40281146) | [next](#40279907) [–]  It has nothing to do with VPN. Attack on the mined CVE is a general type of the malicious DHCP attack described in any CCNA level book since 90s. | | --- | --- | --- | | | |  |  | [hughesjj](user?id=hughesjj) [8 months ago](item?id=40290263)   | [root](#40280982) | [parent](#40281924) | [next](#40279907) [–]  it does expose a nuance in VPN configuration though. If we all as an industry perfectly implemented things to be 100% to the spec, and 100% understand all security considerations in the spec from the start, this would be a nothing burger. From TFA it seems like nordvpn at minimum is affected by this, as per the user report. Lots of users assuming a lot of trust just got violated. I'm sure there's all lots of devs at the VPN vendors and network admins in corporate settings looking around to ensure the hole is plugged. | | --- | --- | --- | | | |  |  | [fargle](user?id=fargle) [8 months ago](item?id=40279907)   | [prev](#40280982) | [next](#40279841) [–]  always the breathless sensationalized vulnerability headlines... it's interesting, but of limited usefulness - the device has to accept responses from a dhcp server. if an attacker controls a dhcp server, he's either on the network already or has already had to do a lot worse than installing a couple static routes to get there. it's not nothing - a compromised home gateway could use this technique to sneak into a corporate VPN via a users' laptop, but if you have a compromised home gateway, you have a *lot* of other problems that could lead to the same result. | | --- | --- | --- | | | |  |  | [Aloisius](user?id=Aloisius) [8 months ago](item?id=40279994)   | [parent](#40279907) | [next](#40279841) [–]  I think a public wifi network effectively being able to disable someone's VPN is pretty bad. | | --- | --- | --- | | | |  |  | [JackSlateur](user?id=JackSlateur) [8 months ago](item?id=40280128)   | [root](#40279907) | [parent](#40279994) | [next](#40280795) [–]  There are lots of ways to disable vpn : basic firewall on the router, if you have access ARP poisoning if you do not. | | --- | --- | --- | | | |  |  | [Aloisius](user?id=Aloisius) [8 months ago](item?id=40280178)   | [root](#40279907) | [parent](#40280128) | [next](#40280795) [–]  Yes, but this disables a user's VPN without alerting the user. Firewalling off their VPN service would cause a visible connection failure. | | --- | --- | --- | | | |  |  | [fargle](user?id=fargle) [8 months ago](item?id=40280795)   | [root](#40279907) | [parent](#40279994) | [prev](#40280128) | [next](#40279841) [–]  if you are on a public wifi, particularly if you can control an evil dhcp server, there are sooo many other ways to attack someone's pc client and network. this is just another. it doesn't even seem that unexpected. | | --- | --- | --- | | | |  |  | [vel0city](user?id=vel0city) [8 months ago](item?id=40281165)   | [root](#40279907) | [parent](#40280795) | [next](#40279841) [–]  But this heavily undermines one major selling point VPN providers use: safety on public wifi and other untrusted networks. | | --- | --- | --- | | | |  |  | [bedobi](user?id=bedobi) [8 months ago](item?id=40279841)   | [prev](#40279907) [–]  VPN can be trivially defeated any number of ways. I was shocked when I first learned this ten fifteen years ago through a site that showed my internet provider and location despite being on a VPN. I forgot the name of the site. A huge problem that doesn't even require defeating is, most OSs and VPN clients, if the connection is shaky, just reverts to the default connection. Even a single packet is enough for your VPN to be worth nothing. In Ubuntu, it required setting up elaborate firewall rules and activate them after you get a stable VPN connection to avoid this. (and even that doesn't protect you from DNS and other stuff being able to track you) (let alone cookies which reveal who you are etc etc) | | --- | --- | --- | | | |  |  | [lxgr](user?id=lxgr) [8 months ago](item?id=40279927)   | [parent](#40279841) | [next](#40283552) [–]  What is a trivial way to reveal a VPN-using website visitor’s actual IP these days? Browsers have improved a lot over the last ten years. > A huge problem that doesn't even require defeating is, most OSs and VPN clients, if the connection is shaky, just reverts to the default connection. This is mostly a function of the VPN client, not the OS. Some clients will reinstate default routes pretty quickly when they lose connectivity, others are pretty sticky. At least Android even offers a specific “always-on VPN” option to prevent leaks like that. | | --- | --- | --- | | | |  |  | [vardump](user?id=vardump) [8 months ago](item?id=40283552)   | [parent](#40279841) | [prev](#40279927) | [next](#40279928) [–]  What leaks your location might just be a DNS request. Depends on the configuration. The site can include a completely unique DNS name as a part of a page. Something like "a5afbdeffe.attacker.com". | | --- | --- | --- | | | |  |  | [dinobones](user?id=dinobones) [8 months ago](item?id=40279928)   | [parent](#40279841) | [prev](#40283552) | [next](#40280092) [–]  Are there any router/cheap "bridge" devices that can sit between your router and the internet and force outbound communication to go through the VPN, as if it were your ISP? | | --- | --- | --- | | | |  |  | [Hikikomori](user?id=Hikikomori) [8 months ago](item?id=40279985)   | [root](#40279841) | [parent](#40279928) | [next](#40280156) [–]  Just use iptables and only allow the vpn traffic. Or do the same with a small Linux box. | | --- | --- | --- | | | |  |  | [bedobi](user?id=bedobi) [8 months ago](item?id=40280038)   | [root](#40279841) | [parent](#40279985) | [next](#40280156) [–]  apparently lots of folks who do this still have problems that a lot of software that promises to do this actually only does it for ipv4, so ipv6 traffic still exposes them, lol | | --- | --- | --- | | | |  |  | [\_0ffh](user?id=_0ffh) [8 months ago](item?id=40280774)   | [root](#40279841) | [parent](#40280038) | [next](#40280156) [–]  It's not unusual to get the recommendation to deactivate ipv6, which isn't hard (on Linux at least). | | --- | --- | --- | | | |  |  | [wepple](user?id=wepple) [8 months ago](item?id=40280156)   | [root](#40279841) | [parent](#40279928) | [prev](#40279985) | [next](#40280010) [–]  There have been a bunch of these, although if you’re really that concerned, you might as well go all in with tor A modern version of this: <https://github.com/grugq/portal> | | --- | --- | --- | | | |  |  | [dpifke](user?id=dpifke) [8 months ago](item?id=40280536)   | [root](#40279841) | [parent](#40280156) | [next](#40280010) [–]  You do not want to mix your non-anonymous and anonymous traffic over the same Tor connection, especially if you don't control the bridge (first hop) to which you're connecting. | | --- | --- | --- | | | |  |  | [GardenLetter27](user?id=GardenLetter27) [8 months ago](item?id=40280010)   | [root](#40279841) | [parent](#40279928) | [prev](#40280156) | [next](#40280005) [–]  On Linux this is easy with a network namespace and nftables. | | --- | --- | --- | | | |  |  | [mftrhu](user?id=mftrhu) [8 months ago](item?id=40280005)   | [root](#40279841) | [parent](#40279928) | [prev](#40280010) | [next](#40279963) [–]  Pretty much any of the GL.iNet devices should be able to do that. | | --- | --- | --- | | | |  |  | [bedobi](user?id=bedobi) [8 months ago](item?id=40279963)   | [root](#40279841) | [parent](#40279928) | [prev](#40280005) | [next](#40280092) [–]  apparently lots of folks use Raspberry Pi's for this, which has added benefit of PiHole filtering out of ads etc no personal experience but sounds nifty, maybe there are other options too | | --- | --- | --- | | | |  |  | [m463](user?id=m463) [8 months ago](item?id=40280092)   | [parent](#40279841) | [prev](#40279928) | [next](#40279946) [–]  Can just be location services - it uses known bluetooth devices and known wifi networks to deduce your location | | --- | --- | --- | | | |  |  | [bedobi](user?id=bedobi) [8 months ago](item?id=40280136)   | [root](#40279841) | [parent](#40280092) | [next](#40279946) [–]  can be but that wasn't what i was experiencing | | --- | --- | --- | | | |  |  | [whoomp12342](user?id=whoomp12342) [8 months ago](item?id=40279946)   | [parent](#40279841) | [prev](#40280092) [–]  is there reading on this matter? | | --- | --- | --- | | |
| |  | | --- |   [Guidelines](newsguidelines.html) | [FAQ](newsfaq.html) | [Lists](lists) | [API](https://github.com/HackerNews/API) | [Security](security.html) | [Legal](https://www.ycombinator.com/legal/) | [Apply to YC](https://www.ycombinator.com/apply/) | Contact Search: |



=== Content from www.watchguard.com_62b895b2_20250111_135249.html ===

[Skip to main content](#main-content)

Open main menu

* [Log In](https://portal.watchguard.com/)
* |
* [Contact Us](/wgrd-about/contact)

[![Home](/sites/default/files/images/branding/watchguard-logo_3.svg)](/)

* [Solutions](/wgrd-solutions)
  + [Cybersecurity Trends

    ›](/wgrd-solutions/security-trends)
  + [SD-WAN](/wgrd-solutions/security-trends/sd-wan)
  + [XDR Security](/wgrd-solutions/security-trends/xdr-security)
  + [Zero Trust Security](/wgrd-solutions/security-trends/zero-trust)
  + [MSP vs MSSP](/wgrd-solutions/security-trends/managed-security-services)
  + [For Businesses

    ›](/wgrd-solutions/business)
  + [Industries](/wgrd-solutions/industries)
  + [Regulations](/wgrd-solutions/regulatory-compliance)
  + [Organizations](/wgrd-solutions/organizations)
  + [Security Models](/wgrd-solutions/business/security-models)
  + [For MSPs

    ›](/wgrd-solutions/msp)
  + [Security Tech Stack](/wgrd-solutions/msp/tech-stack)
  + [Security Frameworks](/wgrd-solutions/msp/security-frameworks)
  + [Cyber Insurance](/wgrd-solutions/msp/cyber-insurance)
  + [For SOCs

    ›](/wgrd-solutions/soc)
  + [Modern SOC](/wgrd-solutions/soc/modern-soc)
  + [Threat Hunting](/wgrd-solutions/soc/threat-hunting)
  + [Unified Security Platform
    ›](/wgrd-solutions/unified-security-platform)
  + [Simplify Your Security.](/wgrd-solutions/unified-security-platform)
* [Products & Services](/wgrd-products)
  + [Network Security

    ›](/wgrd-products/network-security)
  + [Firewalls](/wgrd-products/firewalls)
  + [Firewall Security Services](/wgrd-products/security-services)
  + [Network Detection & Response (NDR)](/wgrd-products/threatsync-ndr)
  + [Secure Wi-Fi](/wgrd-products/secure-wifi)
  + [Endpoint Security

    ›](/wgrd-products/endpoint-security)
  + [Endpoint Detection & Response (EDR)](/wgrd-products/endpoint-protection-detection-response)
  + [Endpoint Protection & Anti-Virus (AV)](/wgrd-products/watchguard-endpoint-protection-antivirus)
  + [Patch Management & Data Security](/wgrd-products/endpoint-security-modules)
  + [DNS-Level Protection](/wgrd-products/dnswatchgo)
  + [Identity Security

    ›](/wgrd-products/authpoint)
  + [Multi-Factor Authentication (MFA)](/wgrd-products/authpoint/multi-factor-authentication)
  + [Single Sign-on (SSO)](/wgrd-products/authpoint/sso)
  + [Hardware Token](/wgrd-products/authpoint/hardware-tokens)
  + [Platform Security

    ›](/wgrd-products/platform)
  + [AI-Powered XDR](/wgrd-products/threatsync-family)
  + [Cloud Management](/wgrd-products/watchguard-cloud)
  + [Compliance Reports](/wgrd-products/compliance-reports)
  + [Security Operations Center](/wgrd-products/security-operations-center-soc)
  + [Managed Services for MSPs

    ›](/wgrd-products/managed-services)
  + [Managed Detection & Response](/wgrd-products/managed-services/mdr)
  + [View All Products

    ›](/wgrd-products/all-products-list)
* [Research](/wgrd-resource-center)
  + [Threat Lab
    ›](/wgrd-security-hub)
  + [Internet Security Report](/wgrd-security-hub/internet-security-report)
  + [Threat Landscape](/wgrd-security-hub/threat-landscape)
  + [Ransomware Tracker](/wgrd-security-hub/ransomware-tracker)
  + [Secplicity Blog](/wgrd-security-hub/secplicity-blog)
  + [The 443 Podcast](/wgrd-security-hub/podcast-the-443)
  + [Product Resources

    ›](/wgrd-resource-center)
  + [On-Demand Webinars](/wgrd-resource-center/webinars)
  + [White Papers](/wgrd-resource-center/white-papers)
  + [Datasheets & Brochures](/wgrd-resource-center/datasheets)
  + [Case Studies](/wgrd-resource-center/case-studies)
  + Help Me Choose
  + [UTM vs NGFW](/wgrd-resource-center/help-me-choose)
  + [WatchGuard Appliance Sizing Tool](/wgrd-resource-center/watchguard-appliance-sizing-tool)
  + [Compare WatchGuard Appliances](/wgrd-products/appliances-compare)
  + [Find an Integration](/wgrd-partners/technology-partners)
  + [Help Me Buy

    ›](/wgrd-products/how-to-buy-watchguard)
  + [Demos & Free Trials](/wgrd-products/demos-free-trials)
  + [Sales Promotions](/wgrd-resource-center/promotions)
  + [Find a Reseller](https://findpartner.watchguard.com/)
  + [Online Store (Renewals Only)](https://securityshop.watchguard.com/)
* [Partners](/wgrd-partners)
  + Become a Partner
  + [Channel Partner Program](/wgrd-partners/channel-partner-program)
  + [Benefits for the MSP](/wgrd-partners/watchguard-benefits-msps)
  + [Getting Started as a Partner](/wgrd-partners/getting-started)
  + [Join the WatchGuardONE Program](/wgrd-partners/join-watchguardone)
  + Partner Resources
  + [WatchGuard Cloud for Partners](/wgrd-partners/cloud-platform)
  + [Unified Security Platform for Partners](/wgrd-partners/unified-security-platform-partners)
  + [Specializations & Certifications](/wgrd-partners/specializations-certifications)
  + [Partner Tools](/wgrd-partners/partner-tools)
  + [Partner Success Stories](/wgrd-resource-center/partner-success-stories)
  + Find A Partner
  + [Find a Reseller](https://findpartner.watchguard.com/)
  + [Find a Distributor](https://findpartner.watchguard.com/PartnerSearch?type=distributor)
  [![Handshake with images of people superimposed inside the silhouette](/sites/default/files/WatchGuardONE_nav-callout.png)

  Become a WatchGuardONE Partner Today](/wgrd-partners/join-watchguardone)
  [Join Now](/wgrd-partners/join-watchguardone)
* [News](/wgrd-news)
  + [WatchGuard News

    ›](/wgrd-news)
  + [Press Releases](/wgrd-news/press-releases)
  + [Press Coverage](/wgrd-news/press-coverage)
  + [Corporate News Blog](/wgrd-news/blog)
  + [Upcoming Webinars & Events](/wgrd-resource-center/events)
  + [Awards & Recognition](/wgrd-news/awards)
  + [Media Contacts](/wgrd-news/media-contacts)
  + [About WatchGuard

    ›](/wgrd-about)
  + [Leadership](/wgrd-about/leadership)
  + [Social Responsibility](/wgrd-about/corporate-social-responsibility)
  + [Careers](/wgrd-careers)
  + WatchGuard & Kraken
  + [Cyber Defenders of the Deep](/wgrd-resource-center/kraken)
  + [The Last Stop of Defense](/wgrd-resource-center/kraken/the-last-stop)
  + [Kraken Case Study](/wgrd-resource-center/kraken/case-study)
  [![Erin and Shane in rainbow pride decorations](/sites/default/files/thm-navaboutus_Pride_0.jpg)

  WatchGuard Careers
  Your new team is waiting for you](/wgrd-careers)
  [Join Team Red](/wgrd-careers)
* [Support](/wgrd-support/overview)
  + Technical Resources
  + [Technical Search](https://techsearch.watchguard.com/)
  + [User Forums](https://community.watchguard.com/watchguard-community/)
  + [Technical Documentation](/wgrd-support/find-answers/technical-documentation)
  + [Product & Support Blog](/wgrd-blog)
  + [Software Downloads](https://software.watchguard.com/)
  + [Security Portal](/wgrd-support/security-portal/overview)
  + [Training

    ›](/wgrd-training/overview)
  + [Certification](/wgrd-training/certification)
  + [WatchGuard Learning Center](https://learn.watchguard.com/)
  + [Locate a Training Partner](/wgrd-training/locate-training-center)
  + [Training Schedule](/wgrd-training/partners-schedule)
  + [Video Tutorials](/wgrd-help/video-tutorials/overview)
  + [Support Services

    ›](/wgrd-support-services/overview)
  + [Hire an Expert](/wgrd-support/hire-expert)
  + [Support Levels](/wgrd-support/support-levels)
  + [Additional Support Services](/wgrd-support/additional-support-services)
  + [Security Advisory List
    ›](/wgrd-psirt/advisories)
  + [Status Dashboard
    ›](https://status.watchguard.com/)
  [![Person touching hologram buttons](/sites/default/files/thm-navsupport.png)

  Manage Your Support Services
  Products, user profile, cloud services, and more](https://watchguard.force.com/customers/CustomerCommunityHome)
  [Log In](https://watchguard.force.com/customers/CustomerCommunityHome)
* [Try Now](/wgrd-products/demos-free-trials)

Search

Security Advisory Detail

#### Go to

## PSIRT Subnav Menu

* [Advisory List](/wgrd-psirt/advisories)
* [Report A Vulnerability](/wgrd-psirt/report-vulnerability)
* [Responsible Disclosure Policy](/wgrd-psirt/responsible-disclosure-policy)
* [Trust Center](/wgrd-trust-center)

# CVE-2024-3661 Impact of TunnelVision Vulnerability

Advisory ID
WGSA-2024-00009

CVE
CVE-2024-3661

Impact
High

Status
Acknowledged

Product Family
Other Software

Published Date
2024-06-07

Updated Date
2024-06-06

Workaround Available
True

CVSS Score
7.6

CVSS Vector
CVSS:3.1/AV:A/AC:L/PR:N/UI:N/S:U/C:H/I:L/A:L

Summary

Researchers at Leviathan Security discovered VPN clients that rely on routes to redirect traffic can be forced to leak traffic over the physical interface when the endpoint processes a DHCP option 121 message from a rogue DHCP server. An attacker on the same local network can exploit this vulnerability to divert traffic out of the tunnel, allowing them to disrupt and potentially read or modify unencrypted connections. This vulnerability does not allow an attacker to read encrypted traffic.

The WatchGuard Mobile VPN with SSL and IPSEC Mobile VPN clients for Windows and macOS use the endpoint computer’s route table to direct traffic through the tunnel. Modifications to the endpoint computer's route table, such as those introduced via the scenario described in TunnelVision, could impact VPN traffic routing.

Affected

| Product | Version | Status |
| --- | --- | --- |
| WatchGuard Mobile VPN with SSL for Windows | All | Affected |
| WatchGuard Mobile VPN with SSL for macOS | All | Affected |
| WatchGuard IPSEC Mobile VPN Client for Windows (NCP) | All | Affected |
| WatchGuard IPSEC Mobile VPN Client for macOS (NCP) | All | Affected |

Workaround

* IPSec Mobile VPN: Use the *Allow All Traffic Through Tunnel* configuration option to route all traffic through the tunnel
* Mobile VPN with SSL: Use the *Force all client traffic through the tunnel* configuration option to route all traffic through the tunnel

References
<https://www.cve.org/CVERecord?id=CVE-2024-3661>
<https://www.leviathansecurity.com/blog/tunnelvision>

Advisory Product List
Product Family
Product Branch
Product List

Other Software

SSL VPN

SSL VPN

Other Software

IPSec VPN

IPSec VPN

[Advisory List](/wgrd-psirt/advisories)

#### Solutions

* [Cybersecurity Trends](/wgrd-solutions/security-trends)
* [For Businesses](/wgrd-solutions/business)
* [For MSPs](/wgrd-solutions/msp)
* [For SOCs](/wgrd-solutions/soc)
* [Unified Security Platform](/wgrd-solutions/unified-security-platform)

#### Products & Services

* [Network Security](/wgrd-products/network-security)
* [Endpoint Security](/wgrd-products/endpoint-security)
* [Identity Security](/wgrd-products/authpoint)
* [Platform Security](/wgrd-products/platform)
* [Managed Services for MSPs](/wgrd-products/managed-services)
* [Product List & SKUs](/wgrd-products/purchase-options)

#### About WatchGuard

WatchGuard has deployed nearly a million integrated, multi-function threat management appliances worldwide. Our signature red boxes are architected to be the industry's smartest, fastest, and meanest security devices with every scanning engine running at full throttle.

#### Research

* [Webinars](/wgrd-resource-center/webinars)
* [Case Studies](/wgrd-resource-center/case-studies)
* [Product Resources](/wgrd-resource-center)
* [Compare Appliances](/wgrd-products/appliances-compare)
* [Visio Icons](/wgrd-resource-center/visio-icons)
* [Media & Brand Kit](https://watchguard.widencollective.com/portals/jhpiq1og/WatchGuardResources)

#### Get In Touch

* **Global Headquarters**

  255 S. King Street, Suite 1100

  Seattle, WA 98104, United States
* **Phone**

  1.800.734.9905 US & Canada

* [Contact Us](/wgrd-about/contact)

#### Social Media

[LinkedIn](https://www.linkedin.com/company/watchguard-technologies)
[X](https://x.com/watchguard)
[Facebook](https://www.facebook.com/watchguardtechnologies)

#### About Us

* [Leadership](/wgrd-about/leadership)
* [Why Buy Red](/wgrd-about/why-buy-red)
* [Press Releases](/wgrd-news/press-releases)
* [Corporate News Blog](/wgrd-news/blog)
* [Awards & Recognition](/wgrd-news/awards)
* [Upcoming Events](/wgrd-resource-center/events)
* [Careers](/wgrd-careers)

#### Global Sites

* [English](https://www.watchguard.com/)
* [Deutsch](https://www.watchguard.com/de)
* [Español](https://www.watchguard.com/es)
* [Français](https://www.watchguard.com/fr)
* [Italiano](https://www.watchguard.com/it)
* [Português do Brasil](https://www.watchguard.com/br)
* [日本語](https://www.watchguard.co.jp/)

#### Support

* [Support Center](/wgrd-support/overview)
* [Product & Support Blog](/wgrd-blog)
* [Knowledge Base](https://techsearch.watchguard.com/WGSupportSearch#t=All&sort=relevancy)
* [User Forums](https://community.watchguard.com/watchguard-community/)
* [Technical Documentation](/wgrd-support/find-answers/technical-documentation)
* [Software Downloads](https://software.watchguard.com/)
* [Security Portal](/wgrd-support/security-portal/overview)
* [Training & Certification](/wgrd-training/overview)
* [Support Services](/wgrd-support-services/overview)
* [Manage Email Preferences](https://secure.watchguard.com/subscription-center.html)

#### Trust

* [Cookie Policy](/wgrd-trust-center/cookie-policy)
* [Privacy Policy](/wgrd-trust-center/privacy-policy)
* [PSIRT](/wgrd-psirt/advisories)
* [Trust Center](/wgrd-trust-center)

Copyright © 1996-2025 WatchGuard Technologies, Inc. All Rights Reserved.

[Terms of Use](/wgrd-trust-center/terms-of-use) | [California Collection Notice](/wgrd-trust-center/us-residents#CA) | [Do Not Sell or Share My Personal Information](/wgrd-trust-center/us-residents#privacyrights)

* [Solutions](/wgrd-solutions)
* [Products & Services](/wgrd-products)
* [Research](/wgrd-resource-center)
* [Partner Program](/wgrd-partners)
* [Support](/wgrd-support/overview)
* [News](/wgrd-news)
* [Careers](/wgrd-careers)
* [Portal Login](https://login.watchguard.com/)
* [Contact Us](/wgrd-about/contact)
* [Try Now](/wgrd-products/demos-free-trials)



=== Content from my.f5.com_2eef8a90_20250111_135241.html ===
Loading×Sorry to interruptCSS ErrorRefresh

=== Content from fortiguard.fortinet.com_46fe889d_20250111_135238.html ===


* ![search](https://filestore.fortinet.com/fortiguard/static/images/icons_white/search.svg?v=33241)
  Search

  ![search](https://filestore.fortinet.com/fortiguard/static/images/icons_white/search.svg?v=33241)

  Please select any available option

  Normal

  Exact Match

  CVE

  ID

  PSIRT

  Antispam

  Outbreak Alert

  IP/Domain/URL

[![fortiguard-logo](https://filestore.fortinet.com/fortiguard/static/images/fortiguard-logo-dark-theme.svg?v=33241)](/)

* Research
  ## Research Center

  Explore latest research and threat reports on emerging cyber threats.
  + [Outbreak Alerts](/outbreak-alert)
  + [Security Blog](https://www.fortinet.com/blog/threat-research.html)
  + [Threat Signal](/threat-signal-report)
* Services
  ## Services

  By Outbreak
  By Solution
  By Product

  ### Protect

  Counter measures across the security fabric for protecting assets, data and network.
  + [Anti-Botnet](/services/botnet)
  + [AntiMalware](/services/antivirus)
  + [AntiSpam](/services/antispam)
  + [Application Control](/services/appcontrol)
  + [Intrusion Protection](/services/ips)
  + [Operational Technology Security](/services/operational-technology-security-service)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Application Security](/services/ws)
  + [Web Filtering](/services/wf)
  ### Detect

  Find and correlate important information to identify an outbreak.Find and correlate
  + [Anti-Recon and Anti-Exploit](/services/arae)
  + [Cloud Threat Detection](/services/cloud-vulnerability-and-threat-detection)
  + [Endpoint Detection & Response](/services/fedr)
  + [Indicators of Compromise](/services/ioc)
  + [Outbreak Deception](/services/odcs)
  + [Outbreak Detection](/services/outbreak-detection-service)
  + [SOC Automation](/services/security-automation-service)
  ### Respond

  Develop containment techniques to mitigate impacts of security events.Develop containment
  + [Endpoint Detection and Response](https://www.fortinet.com/products/fortixdr)
  + [Endpoint Forensics](https://www.fortinet.com/products/endpoint-security/forticlient#support-services)
  + [Incident Response](https://www.fortinet.com/solutions/enterprise-midsize-business/security-as-a-service/respond)
  ### Recover

  Improve security posture and processes by implementing security awareness and training.
  + [Assessment Services](https://www.fortinet.com/solutions/enterprise-midsize-business/security-as-a-service/assess)
  + [NSE Training](https://www.fortinet.com/training/cybersecurity-professionals)
  + [Security Awareness Training](https://www.fortinet.com/training/security-awareness-training)

  ### Identify

  Identify processes and assets that need protection.Identify processes and assets that
  + [Breach Attack Simulation](/services/breach-attack-simulation)
  + [Cloud Vulnerability](/services/cloud-vulnerability-and-threat-detection)
  + [Dynamic Application Security Testing](/services/dynamic-application-security-testing)
  + [Endpoint Vulnerability](/services/ev)
  + [FortiDevSec](/services/fortidevsec)
  + [Inline-CASB Application Definitions](/updates/casb)
  + [IoT Detection](/services/dds)
  + [Pen Testing](/services/pentesting)
  + [Recon: ACI](https://www.fortinet.com/products/fortirecon)
  + [Recon: BP](https://www.fortinet.com/products/fortirecon)
  + [Recon: EASM](https://www.fortinet.com/products/fortirecon)
  + [Security Rating](/services/secr)

  + ### Network Security

    ![Network Security icon](https://filestore.fortinet.com/fortiguard/static/images/icons_white/network.svg?v=33241)
  + [Anti-Botnet](/services/botnet)
  + [Anti-Recon and Anti-Exploit](/services/arae)
  + [Cloud Vulnerability and Threat Detection](/services/cloud-vulnerability-and-threat-detection)
  + [Data Loss Prevention](/services/dlp)
  + [Indicators of Compromise](/services/ioc)
  + [Inline-CASB Application Definitions](/updates/casb)
  + [Internet Services](/services/isdb)
  + [Intrusion Protection](/services/ips)
  + [IP Geolocation](/services/ipge)
  + [Secure DNS](/services/sdns)
  + ### Endpoint Security

    ![Endpoint Security icon](https://filestore.fortinet.com/fortiguard/static/images/icons_white/contentendpoint.svg?v=33241)
  + [ANN and NDR](/services/fortindr)
  + [AntiVirus](/services/antivirus)
  + [Endpoint Detection & Response](/services/fedr)
  + [Endpoint Vulnerability](/services/ev)
  + [IoT Detection](/services/dds)
  + [Sandbox Behavior Engine](/services/sandbox)
  + ### Application Security

    ![Application Security icon](https://filestore.fortinet.com/fortiguard/static/images/icons_white/application.svg?v=33241)
  + [AntiSpam](/services/antispam)
  + [Application Control](/services/appcontrol)
  + [Client Application Firewall](/services/fct-app)
  + [Credential Stuffing Defense](/services/csd)
  + [Dynamic Application Security Testing](/services/dynamic-application-security-testing)
  + [Operational Technology Security](/services/operational-technology-security-service)
  + [Web Application Security](/services/ws)
  + [Web Filtering](/services/wf)
  + ### Security Operations

    ![Security Operations icon](https://filestore.fortinet.com/fortiguard/static/images/icons_white/response.svg?v=33241)
  + [Breach Attack Simulation](/services/breach-attack-simulation)
  + [FortiDevSec](/services/fortidevsec)
  + [Outbreak Deception](/services/odcs)
  + [Outbreak Detection](/services/outbreak-detection-service)
  + [Pen Testing](/services/pentesting)
  + [Security Rating](/services/secr)

  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortigate.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortianalyzer.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/forticlient.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortiweb.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fadc.svg?v=33241)

    FortiADC

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortiauthenticator.svg?v=33241)

    FortiAuthenticator

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/cnp.svg?v=33241)

    FortiCNP

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortiddos.svg?v=33241)

    FortiDDoS

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortideceptor.svg?v=33241)

    FortiDeceptor

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fedr.svg?v=33241)

    FortiEDR

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortimail.svg?v=33241)

    FortiMail

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + empty
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortindr.svg?v=33241)

    FortiNDR

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortipam.svg?v=33241)

    FortiPAM

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortipolicy.svg?v=33241)

    FortiPolicy

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortiproxy.svg?v=33241)

    FortiProxy

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortirecon.svg?v=33241)

    FortiRecon

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortisandbox.svg?v=33241)

    FortiSandBox

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortisase.svg?v=33241)

    FortiSASE

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortisiem.svg?v=33241)

    FortiSIEM

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortitester.svg?v=33241)

    FortiTester

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/fortidast.svg?v=33241)

    FortiDAST

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + ![](https://filestore.fortinet.com/fortiguard/static/images/icons_white/cnpvuln.svg?v=33241)

    FortiCNAPP

    ![](https://filestore.fortinet.com/fortiguard/static/images/arrow-white.svg?v=33241)
  + empty
  + [Anti-Botnet](/services/botnet)
  + [AntiVirus](/services/antivirus)
  + [Application Control](/services/appcontrol)
  + [Inline-CASB Application Definitions](/updates/casb)
  + [Intrusion Protection](/services/ips)
  + [IoT Detection](/services/dds)
  + [IP Geolocation](/services/ipge)
  + [Operational Technology Security](/services/operational-technology-security-service)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Secure DNS](/services/sdns)
  + [Security Rating](/services/secr)
  + [Web Filtering](/services/wf)
  + [Indicators of Compromise](/services/ioc)
  + [Outbreak Detection](/services/outbreak-detection-service)
  + [SOC Automation](/services/security-automation-service)
  + [Anti-Botnet](/services/botnet)
  + [Anti-Recon and Anti-Exploit](/services/arae)
  + [AntiVirus](/services/antivirus)
  + [Application Firewall](/services/fct-app)
  + [Credential Stuffing Defense](/services/csd)
  + [Endpoint Vulnerability](/services/ev)
  + [Intrusion Protection](/services/ips)
  + [Outbreak Detection](/services/eoap)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Filtering](/services/wf)
  + [Anti-Botnet](/services/botnet)
  + [AntiVirus](/services/antivirus)
  + [Application Control](/services/appcontrol)
  + [Credential Stuffing Defense](/services/csd)
  + [Fuzzy Webshell](/updates/webshell)
  + [IP Geolocation](/services/ipge)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Application Security](/services/ws)
  + [Anti-Botnet](/services/botnet)
  + [AntiVirus](/services/antivirus)
  + [Credential Stuffing Defense](/services/csd)
  + [Intrusion Protection](/services/ips)
  + [IP Geolocation](/services/ipge)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Application Security](/services/ws)
  + [Web Filtering](/services/wf)
  + [IP Geolocation](/services/ipge)
  + [Anti-Botnet](/services/botnet)
  + [Data Loss Prevention](/services/dlp)
  + [IP Geolocation](/services/ipge)
  + [Vulnerability](/services/cloud-vulnerability-and-threat-detection)
  + [Anti-Botnet](/services/botnet)
  + [Anti-Recon and Anti-Exploit](/services/arae)
  + [AntiVirus](/services/antivirus)
  + [Intrusion Protection](/services/ips)
  + [Outbreak Deception](/services/odcs)
  + [AntiVirus](/services/antivirus)
  + [EndPoint Detection and Response](/services/fedr)
  + [Endpoint Vulnerability](/services/ev)
  + [Indicators of Compromise](/services/ioc)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Filtering](/services/wf)
  + [AntiSpam](/services/antispam)
  + [AntiVirus](/services/antivirus)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Filtering](/services/wf)
  + [Network Detection and Response](/services/fortindr)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [AntiVirus](/services/antivirus)
  + [Data Loss Prevention](/services/dlp)
  + [Anti-Botnet](/services/botnet)
  + [Application Control](/services/appcontrol)
  + [Anti-Botnet](/services/botnet)
  + [Application Control](/services/appcontrol)
  + [Industrial Security](/services/operational-technology-security-service)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Digital Risk Protection](https://www.fortinet.com/products/fortirecon)
  + [AntiVirus](/services/antivirus)
  + [Intrusion Protection](/services/ips)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Web Filtering](/services/wf)
  + [Anti-Botnet](/services/botnet)
  + [AntiVirus](/services/antivirus)
  + [Application Control](/services/appcontrol)
  + [Data Loss Prevention](/services/dlp)
  + [Endpoint Vulnerability](/services/ev)
  + [Intrusion Protection](/services/ips)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Secure DNS](/services/sdns)
  + [Web Filtering](/services/wf)
  + [Indicators of Compromise](/services/ioc)
  + [IP Geolocation](/services/ipge)
  + [Outbreak Detection](/services/fortisiem)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Breach Attack Simulation](/services/breach-attack-simulation)
  + [Dynamic Application Security Testing](/services/dynamic-application-security-testing)
  + [Cloud Threat Detection](/services/cloud-vulnerability-and-threat-detection)
  + [Cloud Vulnerability](/services/cloud-vulnerability-and-threat-detection)
* Threat Intelligence
  ## Threat Intelligence Center

  Browse the FortiGuard Labs extensive encyclopedia and Threat Analytics.

  + [Application Control](/appcontrol)
  + [FortiGuard Encyclopedia](/encyclopedia)
  + [Outbreak Threat Map](/threat-map)
  + [Threat Actor Encyclopedia](/threat-actor)
  + [Threat Analytics](/threat-research)
  + [Web Filtering](/webfilter)
* Support
  ## Support Center

  PSIRT
  Center

  Product
  Support

  Fortinet Product Security Incident Response Team (PSIRT) updates.

  + [Advisories](/psirt)
  + [PSIRT Blog](https://www.fortinet.com/blog/psirt-blogs)
  + [PSIRT Contact](/faq/psirt-contact)
  + [Security Vulnerability Policy](/psirt_policy)
  Get the support whenever you need it.

  + [FortiCare Support](https://www.fortinet.com/support/contact)
  + [Fortinet Community](https://community.fortinet.com/)
* Resources
  ## Resource Center

  Learn about service status, publications and other available resources.

  + [FortiGuard Sample Files](/sample-files)
  + [MITRE ATT&CK Matrix](/mitre-mapping)
  + [NIST Cybersecurity Framework](/nist-csf)
  + [Publications](/events)
  + [Security Best Practices](/security-best-practices)
* About
  ## About

  FortiGuard Labs
  Partners

  AI-Powered Threat Intelligence for an Evolving Digital World.
  + [Contact Us](/contactus)
  + [Frequently Asked Questions](/faq)
  + [Premium Services](/premium-services)
  + [RSS Feeds](/rss-feeds)
  Leveraging cyber security industry partner relationships.
  + [Cyber Threat Alliance](/cta)
  + [MITRE Engenuity](https://www.fortinet.com/corporate/about-us/product-certifications/mitre-att-ck)

[![fortiguard-logo](https://filestore.fortinet.com/fortiguard/static/images/fortiguard-logo-dark-theme.svg?v=33241)](/)
![search](https://filestore.fortinet.com/fortiguard/static/images/icons_white/search.svg?v=33241)

* Research
  + [Outbreak Alerts](/outbreak-alert)
  + [Security Blog](https://www.fortinet.com/blog/threat-research.html)
  + [Threat Signal](/threat-signal-report)
* Services
  + [Anti-Botnet](/services/botnet)
  + [Anti-Recon and Anti-Exploit](/services/arae)
  + [AntiMalware](/services/antivirus)
  + [AntiSpam](/services/antispam)
  + [Application Control](/services/appcontrol)
  + [Assessment Services](https://www.fortinet.com/solutions/enterprise-midsize-business/security-as-a-service/assess)
  + [Breach Attack Simulation](/services/breach-attack-simulation)
  + [Cloud Threat Detection](/services/cloud-vulnerability-and-threat-detection)
  + [Cloud Vulnerability](/services/cloud-vulnerability-and-threat-detection)
  + [Dynamic Application Security Testing](/services/dynamic-application-security-testing)
  + [Endpoint Detection & Response](/services/fedr)
  + [Endpoint Detection and Response](https://www.fortinet.com/products/fortixdr)
  + [Endpoint Forensics](https://www.fortinet.com/products/endpoint-security/forticlient#support-services)
  + [Endpoint Vulnerability](/services/ev)
  + [FortiDevSec](/services/fortidevsec)
  + [Incident Response](https://www.fortinet.com/solutions/enterprise-midsize-business/security-as-a-service/respond)
  + [Indicators of Compromise](/services/ioc)
  + [Inline-CASB Application Definitions](/updates/casb)
  + [Intrusion Protection](/services/ips)
  + [IoT Detection](/services/dds)
  + [NSE Training](https://www.fortinet.com/training/cybersecurity-professionals)
  + [Operational Technology Security](/services/operational-technology-security-service)
  + [Outbreak Deception](/services/odcs)
  + [Outbreak Detection](/services/outbreak-detection-service)
  + [Pen Testing](/services/pentesting)
  + [Recon: ACI](https://www.fortinet.com/products/fortirecon)
  + [Recon: BP](https://www.fortinet.com/products/fortirecon)
  + [Recon: EASM](https://www.fortinet.com/products/fortirecon)
  + [Sandbox Behavior Engine](/services/sandbox)
  + [Security Awareness Training](https://www.fortinet.com/training/security-awareness-training)
  + [Security Rating](/services/secr)
  + [SOC Automation](/services/security-automation-service)
  + [Web Application Security](/services/ws)
  + [Web Filtering](/services/wf)
* Threat Intelligence
  + [Application Control](/appcontrol)
  + [FortiGuard Encyclopedia](/encyclopedia)
  + [Outbreak Threat Map](/threat-map)
  + [Threat Actor Encyclopedia](/threat-actor)
  + [Threat Analytics](/threat-research)
  + [Web Filtering](/webfilter)
* Resources
  + [FortiGuard Sample Files](/sample-files)
  + [MITRE ATT&CK Matrix](/mitre-mapping)
  + [NIST Cybersecurity Framework](/nist-csf)
  + [Publications](/events)
  + [Security Best Practices](/security-best-practices)
* Support
  ### PSIRT Center

  + [Advisories](/psirt)
  + [PSIRT Blog](https://www.fortinet.com/blog/psirt-blogs)
  + [PSIRT Contact](/faq/psirt-contact)
  + [Security Vulnerability Policy](/psirt_policy)
  ### Product Support

  + [FortiCare Support](https://www.fortinet.com/support/contact)
  + [Fortinet Community](https://community.fortinet.com/)
* About
  ### FortiGuard Labs

  + [Contact Us](/contactus)
  + [Frequently Asked Questions](/faq)
  + [Premium Services](/premium-services)
  + [RSS Feeds](/rss-feeds)
  ### Partners

  + [Cyber Threat Alliance](/cta)
  + [MITRE Engenuity](https://www.fortinet.com/corporate/about-us/product-certifications/mitre-att-ck)
* [FORTINET](https://fortinet.com)

Normal

Exact Match

CVE

ID

PSIRT

Antispam

Outbreak Alert

IP/Domain/URL

![search](https://filestore.fortinet.com/fortiguard/static/images/icons_white/search.svg?v=33241)

[## virus logo](/psirt)
# TunnelVision - CVE-2024-3661

### Summary

Fortinet is aware of the recent publication of the TunnelVision vulnerability (CVE-2024-3661).

| Version | Affected | Solution |
| --- | --- | --- |
| FortiClientLinux 7.4 | 7.4.0 | Upgrade to upcoming 7.4.1 or above |
| FortiClientLinux 7.2 | 7.2.0 through 7.2.4 | Upgrade to upcoming 7.2.5 or above |
| FortiClientLinux 7.0 | 7.0 all versions | Migrate to a fixed release |
| FortiClientLinux 6.4 | 6.4 all versions | Migrate to a fixed release |
| FortiClientMac 7.4 | 7.4.0 | Upgrade to upcoming 7.4.1 or above |
| FortiClientMac 7.2 | 7.2.0 through 7.2.4 | Upgrade to upcoming 7.2.5 or above |
| FortiClientMac 7.0 | 7.0 all versions | Migrate to a fixed release |
| FortiClientMac 6.4 | 6.4 all versions | Migrate to a fixed release |
| FortiClientWindows 7.4 | 7.4.0 | Upgrade to upcoming 7.4.1 or above |
| FortiClientWindows 7.2 | 7.2.0 through 7.2.4 | Upgrade to upcoming 7.2.5 or above |
| FortiClientWindows 7.0 | 7.0 all versions | Migrate to a fixed release |
| FortiClientWindows 6.4 | 6.4 all versions | Migrate to a fixed release |

**Solutions:**
FortiClientWindows:
SSL-VPN Full Tunnel with 'exclusive-routing' enabled is unaffected. Note that application-based split tunneling takes precedence and disables exclusive-routing.
<https://community.fortinet.com/t5/FortiGate/Technical-Tip-Enabling-SSL-VPN-Full-Tunnel/ta-p/191848>
FortiOS site-to-site VPN:
FortiOS may be affected when it is configured as a DHCP client on the interface that is connected to the rogue DHCP server, and the 'dhcp-classless-route-addition' setting is enabled.
To disable it, enter the following command:
`<br/>config system interface<br/>edit <port><br/>set dhcp-classless-route-addition disable<br/>end<br/>`
With this setting disabled, FortiOS does not process the DHCP option 121 and is therefore unaffected. The default value may differ between models.
**Workarounds:**
Avoid connecting to potentially unsafe Wi-Fi network.
**Mitigations:**
With an IPSec VPN Full-Tunnel, attempts to reroute traffic with this technique will result in the FortiGate firewall policies dropping the packets not coming from the VPN tunnel interface before they reach the attacker controlled channel. Ensure that enable\_local\_lan is set to 0.
<https://community.fortinet.com/t5/FortiGate/Technical-Tip-IPSec-dial-up-full-tunnel-with-FortiClient/ta-p/189452>
<https://community.fortinet.com/t5/FortiGate/Technical-Tip-Impossible-to-access-local-area-network-of-the/ta-p/244482>

### Timeline

2024-06-11: Initial publication
2024-06-17: Update solution versions

### References

* TunnelVision by Leviathan Security Group [1] <https://www.leviathansecurity.com/blog/tunnelvision><
* /p>

| IR Number | FG-IR-24-170 |
| --- | --- |
| Published Date | Jun 11, 2024 |
| Updated Date | Jun 17, 2024 |
| Component | SSL-VPN |
| Severity | Medium |
| CVSSv3 Score | [4.7](https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:H/PR:N/UI:N/S:U/C:L/I:L/A:L/E:P/RL:X/RC:X&version=3.1) |
| Impact | Improper access control |
| CVE ID | [CVE-2024-3661](https://www.cve.org/CVERecord?id=CVE-2024-3661) |
| CVRF | [Download](/psirt/cvrf/FG-IR-24-170) |
| Language | English Portuguese |

[![fortinet logo in the footer](https://filestore.fortinet.com/fortiguard/static/images/fortinet-footer-logo.svg?v=33241)](https://www.fortinet.com)

* [Contact Us](/contactus)
* [Legal](https://www.fortinet.com/corporate/about-us/legal.html)
* [Privacy](https://www.fortinet.com/corporate/about-us/privacy.html)
* [Partners](/partners)
* [Feedback](/faq/general-contact)

* [![facebook-icon-footer](https://filestore.fortinet.com/fortiguard/static/images/facebook_icon_footer.svg?v=33241)](https://www.facebook.com/FortiGuard.Labs)
* [![twitter-icon-footer](https://filestore.fortinet.com/fortiguard/static/images/x_icon_footer.svg?v=33241)](https://x.com/FortiGuardLabs)
* [![linkedin-icon-footer](https://filestore.fortinet.com/fortiguard/static/images/linkedin_icon_footer.svg?v=33241)](https://www.linkedin.com/showcase/3668640/)
* [![linkedin-icon-footer](https://filestore.fortinet.com/fortiguard/static/images/instagram_icon_footer.svg?v=33241)](https://www.instagram.com/fortinet/)
* [![rss-icon-footer](https://filestore.fortinet.com/fortiguard/static/images/rss_icon_footer.svg?v=33241)](/rss-feeds)

Copyright © 2025 Fortinet, Inc. All Rights Reserved.



=== Content from tunnelvisionbug.com_ec92f7f1_20250111_135246.html ===

![](/assets/TunnelVision_cn.jpg)
# TunnelVision

CVE-2024-3661

## A local network VPN leaking technique that affects all routing-based VPNsAuthors: [Dani Cronce](https://www.linkedin.com/in/danicronce/) & [Lizzie Moratti](https://www.linkedin.com/in/lmoratti/) from [Leviathan Security Group](https://www.leviathansecurity.com/)

[Technical Advisory](./)
[General Public Advisory](./General-Public)
[FAQ](./faq)
[Full blog](https://www.leviathansecurity.com/blog/tunnelvision)
[Lab Setup](https://github.com/leviathansecurity/TunnelVision/)

Share via:

Publish Date: 5/6/2024

# Introduction

VPNs are marketed as a security service that protects users even on untrusted networks (e.g. public Wi-Fi). However, it has been known within the security industry that these claims are questionable, and small leaks have been discovered over the years. Most research has been focused on VPN servers rather than leaking client traffic on a local network.

Recently, a technique known as [TunnelCrack](https://tunnelcrack.mathyvanhoef.com/) allowed attackers to leak data from a VPN. Simultaneously, we have been working on a more general technique we call “TunnelVision.”

TunnelVision leaks VPN traffic more simply and powerfully. We have demonstrated an attacker can leak all traffic just by being on the same local network as a VPN user.

From the user’s perspective, they appear as if they are connected to the VPN.

# How TunnelVision Works

Computers may be connected to multiple networks at once. A VPN is also a network you’re connected to. Computers decide which network they should send traffic through using a set of rules called “routing tables.”

An attacker on the same local network can manipulate these rules and force traffic over the wrong network. **TunnelVision does not generally require compromising a DHCP server**. More technical details are available on the [blog post](https://www.leviathansecurity.com/blog/tunnelvision).

From there, they can redirect traffic meant for the VPN to the local network, *completely bypassing the VPN.* Because this technique is not dependent on exploiting VPN technologies or underlying protocols, it works completely independently of the VPN provider or implementation.

We call this total bypass, **decloaking.**

# Impact

VPN users who expect VPNs to protect them on untrusted networks are as susceptible to the very same attacks as if they weren’t using a VPN. This is particularly dangerous for people who rely on VPNs to keep them safe such as journalists and political dissidents.

Luckily, most users who use commercial VPNs are sending web traffic which is mostly HTTPS ([about 85%, actually](https://w3techs.com/technologies/details/ce-httpsdefault)). HTTPS traffic looks like gibberish to attackers using Tunnelvision, but they know who you are sending that gibberish to which can be an issue. If a website is using HTTP, then it becomes possible to view everything you are saying as well as who you are saying it to.

Our research challenges previous understanding of VPN technology. It also raises questions about what other technologies are impacted by routing table attacks and how this could go unnoticed for 20+ years.

# Why We Are Publishing Now

We aim to raise awareness about this technique in the security and privacy communities. Since it could have been exploitable as early as 2002, it might already be in use without widespread knowledge.

We initially disclosed this to several VPN providers but quickly realized that it wasn’t scalable, and there were too many affected parties. We contacted the EFF and CISA and, through them, we’ve made over 50+ vendors aware of this before public release.

In addition, we decided to name the CVE in the hopes that a more human-readable name would extend the awareness to outside the security and privacy communities and into the general public.

# How Do We Fix This

Well, that’s a difficult question. VPNs were not made to secure every connection on a computer. Their purpose is to connect two local networks that normally are not connected and to secure data going over that channel. It was not meant to protect traffic on the local network, just to protect traffic after exiting to the WAN.

In that regard, VPNs are working as intended, local network protocols are working as intended, and the routing tables in your operating system are working as intended. Fundamentally, the public understanding of VPNs is what’s broken. This is largely due to marketing campaigns by VPN providers.

There is a fix on Linux operating systems through a feature called “network namespaces.” Network namespaces can segment interfaces and routing tables away from the local network’s control.

Other operating systems do not have a full fix available. For those operating systems, the best that a VPN provider can do is mitigate the leak. However, all mitigations we’ve observed still expose a serious issue for users who rely on total privacy of their connection, and the issue can also be abused for censorship.

Additionally, there might be bypasses that we have not discovered for the mitigations, so inevitably relying on using mitigations will create a “cat and mouse” game between attackers and defenders.

Groups primarily affected by the shortcomings of mitigations are those who commonly are the targets of surveillance or spyware, journalists, whistleblowers, and those needing to bypass censorship.

One could argue that the OS maintainers should implement this feature, and one could also argue that VPNs shouldn’t be advertising a feature that is impossible on many devices.

Ultimately, we feel that it’s a shared responsibility, and the people who suffer from this are the VPN users.

# Call to Action

If you require the total privacy of your connection:

1. Do not use untrusted networks (Public WiFi)
2. Consider using a hotspot with your VPN
3. Consider using a VPN inside a virtual machine that does not have a bridged network adapter
4. Use AdBlock and privacy browsers that reject tracking cookies

If you are a VPN provider:

1. Review and update your marketing: do not claim untrusted networks can be secured by you
2. Where possible, use network namespaces features in your product
3. Consider host-based firewall protections to partially mitigate local network attacks

If you are an operating system maintainer:

1. Consider implementing network namespaces if your operating system doesn’t support it.

# Prior Research

We found research related to DHCP leaking default routes over an incorrect interface [as far back as 2015](https://petsymposium.org/popets/2015/popets-2015-0006.pdf).
However, it was implied that DHCP only pushed default routes and the research did not take into account DHCP option 121.

[This research from Anvil Secure](https://www.anvilsecure.com/blog/dhcp-games-with-smart-router-devices.html) did mention option 121, and they used this technique against attacking
smart router devices with multiple physical network interfaces. However, this was not applied to network
client devices that use a VPN which creates a virtual interface.

In August 2023, [TunnelCrack was published](https://tunnelcrack.mathyvanhoef.com/#summary) demonstrating that routing rules can be attacked in different ways
to leak VPN traffic. The paper details two methods of leaking VPN traffic:

* Abusing non-RFC1918 IP ranges to leak traffic.
* DNS spoofing the VPN server’s domain name to trick the VPN client into adding a routing rule
  exception for an IP address.

However, neither technique described in TunnelCrack leveraged DHCP option 121 to push
routes. Pushing routes through DHCP has a significantly higher impact from the same attacker vantage
point (the ability to hand out IP leases for a non-RFC1918 range or spoofing DNS replies).

In short, researchers came very close to discovering TunnelVision earlier.

[![](/assets/leviathan_logo.png)](https://www.leviathansecurity.com/)

Leviathan's stance on researchers owning the rights to their work allowed us to publish this independent research on their blog while retaining ownership.

We will forever be grateful to Leviathan for allowing us to chase our curiosity.



=== Content from datatracker.ietf.org_a3c66329_20250111_135237.html ===


* Light
* Dark
* Auto

[RFC 2131

Draft Standard](/doc/rfc2131/)

|  | Title |  | Dynamic Host Configuration Protocol |
| --- | --- | --- | --- |
| Document | Document type |  | RFC - Draft Standard  March 1997  [View errata](https://www.rfc-editor.org/errata_search.php?rfc=2131 "Click to view errata.") [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") [IPR](/ipr/search/?submit=draft&id=rfc2131 "Click to view IPR declarations.") Updated by [RFC 4361](/doc/html/rfc4361 "Node-specific Client Identifiers for Dynamic Host Configuration Protocol Version Four (DHCPv4)"), [RFC 5494](/doc/html/rfc5494 "IANA Allocation Guidelines for the Address Resolution Protocol (ARP)"), [RFC 6842](/doc/html/rfc6842 "Client Identifier Option in DHCP Server Replies"), [RFC 3396](/doc/html/rfc3396 "Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)") Obsoletes [RFC 1541](/doc/html/rfc1541 "Dynamic Host Configuration Protocol") Was [draft-ietf-dhc-dhcp](/doc/draft-ietf-dhc-dhcp/08/) ([dhc WG](/wg/dhc/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [08](/doc/html/draft-ietf-dhc-dhcp-08) * [RFC 2131](/doc/html/rfc2131) |
|  | Compare versions |  | RFC 2131  draft-ietf-dhc-dhcp-08  draft-ietf-dhc-dhcp-07  draft-ietf-dhc-dhcp-06  draft-ietf-dhc-dhcp-05  draft-ietf-dhc-dhcp-04  draft-ietf-dhc-dhcp-03  draft-ietf-dhc-dhcp-02  draft-ietf-dhc-dhcp-01  draft-ietf-dhc-dhcp-00   RFC 2131  draft-ietf-dhc-dhcp-08  draft-ietf-dhc-dhcp-07  draft-ietf-dhc-dhcp-06  draft-ietf-dhc-dhcp-05  draft-ietf-dhc-dhcp-04  draft-ietf-dhc-dhcp-03  draft-ietf-dhc-dhcp-02  draft-ietf-dhc-dhcp-01  draft-ietf-dhc-dhcp-00   Side-by-side  Inline |
|  | Author |  | [Ralph Droms](/person/rdroms.ietf%40gmail.com "Datatracker profile of Ralph Droms")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc2131.txt) [html](https://www.rfc-editor.org/rfc/rfc2131.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc2131.txt.pdf) [w/errata](https://www.rfc-editor.org/rfc/inline-errata/rfc2131.html) [bibtex](/doc/rfc2131/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/dhcwg/?q=rfc2131 OR %22draft-ietf-dhc-dhcp%22) |
|  |  |  | [Report a bug](https://github.com/ietf-tools/datatracker/issues/new/choose) |

```
Network Working Group                                           R. Droms
Request for Comments: 2131                           Bucknell University
Obsoletes: [1541](/doc/html/rfc1541)                                               March 1997
Category: Standards Track

                  Dynamic Host Configuration Protocol

Status of this memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Abstract

   The Dynamic Host Configuration Protocol (DHCP) provides a framework
   for passing configuration information to hosts on a TCPIP network.
   DHCP is based on the Bootstrap Protocol (BOOTP) [[7](#ref-7 "\"Bootstrap Protocol (BOOTP)\"")], adding the
   capability of automatic allocation of reusable network addresses and
   additional configuration options [[19](#ref-19 "MIT)")].  DHCP captures the behavior of
   BOOTP relay agents [[7](#ref-7 "\"Bootstrap Protocol (BOOTP)\""), [21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")], and DHCP participants can interoperate
   with BOOTP participants [[9](#ref-9 "\"Interoperation between DHCP and BOOTP\"")].

Table of Contents

   [1](#section-1).  Introduction. . . . . . . . . . . . . . . . . . . . . . . . .  [2](#page-2)
   [1.1](#section-1.1) Changes to [RFC1541](/doc/html/rfc1541). . . . . . . . . . . . . . . . . . . . . .  [3](#page-3)
   [1.2](#section-1.2) Related Work. . . . . . . . . . . . . . . . . . . . . . . . .  [4](#page-4)
   [1.3](#section-1.3) Problem definition and issues . . . . . . . . . . . . . . . .  [4](#page-4)
   [1.4](#section-1.4) Requirements. . . . . . . . . . . . . . . . . . . . . . . . .  [5](#page-5)
   [1.5](#section-1.5) Terminology . . . . . . . . . . . . . . . . . . . . . . . . .  [6](#page-6)
   [1.6](#section-1.6) Design goals. . . . . . . . . . . . . . . . . . . . . . . . .  [6](#page-6)
   [2](#section-2).  Protocol Summary. . . . . . . . . . . . . . . . . . . . . . .  [8](#page-8)
   [2.1](#section-2.1) Configuration parameters repository . . . . . . . . . . . . . [11](#page-11)
   [2.2](#section-2.2) Dynamic allocation of network addresses . . . . . . . . . . . [12](#page-12)
   [3](#section-3).  The Client-Server Protocol. . . . . . . . . . . . . . . . . . [13](#page-13)
   [3.1](#section-3.1) Client-server interaction - allocating a network address. . . [13](#page-13)
   3.2 Client-server interaction - reusing a  previously allocated
       network address . . . . . . . . . . . . . . . . . . . . . . . [17](#page-17)
   [3.3](#section-3.3) Interpretation and representation of time values. . . . . . . [20](#page-20)
   3.4 Obtaining parameters with externally configured network
       address . . . . . . . . . . . . . . . . . . . . . . . . . . . [20](#page-20)
   [3.5](#section-3.5) Client parameters in DHCP . . . . . . . . . . . . . . . . . . [21](#page-21)
   [3.6](#section-3.6) Use of DHCP in clients with multiple interfaces . . . . . . . [22](#page-22)
   [3.7](#section-3.7) When clients should use DHCP. . . . . . . . . . . . . . . . . [22](#page-22)
   [4](#section-4).  Specification of the DHCP client-server protocol. . . . . . . [22](#page-22)

Droms                       Standards Track                     [Page 1]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   [4.1](#section-4.1) Constructing and sending DHCP messages. . . . . . . . . . . . [22](#page-22)
   [4.2](#section-4.2) DHCP server administrative controls . . . . . . . . . . . . . [25](#page-25)
   [4.3](#section-4.3) DHCP server behavior. . . . . . . . . . . . . . . . . . . . . [26](#page-26)
   [4.4](#section-4.4) DHCP client behavior. . . . . . . . . . . . . . . . . . . . . [34](#page-34)
   [5](#section-5).  Acknowledgments. . . . . . . . . . . . . . . . . . . . . . . .[42](#page-42)
   [6](#section-6).  References . . . . . . . . . . . . . . . . . . . . . . . . . .[42](#page-42)
   [7](#section-7).  Security Considerations. . . . . . . . . . . . . . . . . . . .[43](#page-43)
   [8](#section-8).  Author's Address . . . . . . . . . . . . . . . . . . . . . . .[44](#page-44)
   [A](#appendix-A).  Host Configuration Parameters  . . . . . . . . . . . . . . . .[45](#page-45)
List of Figures
   [1](#section-1). Format of a DHCP message . . . . . . . . . . . . . . . . . . .  [9](#page-9)
   [2](#section-2). Format of the 'flags' field. . . . . . . . . . . . . . . . . . [11](#page-11)
   3. Timeline diagram of messages exchanged between DHCP client and
      servers when allocating a new network address. . . . . . . . . [15](#page-15)
   4. Timeline diagram of messages exchanged between DHCP client and
      servers when reusing a previously allocated network address. . [18](#page-18)
   [5](#section-5). State-transition diagram for DHCP clients. . . . . . . . . . . [34](#page-34)
List of Tables
   [1](#section-1). Description of fields in a DHCP message. . . . . . . . . . . . [10](#page-10)
   [2](#section-2). DHCP messages. . . . . . . . . . . . . . . . . . . . . . . . . [14](#page-14)
   [3](#section-3). Fields and options used by DHCP servers. . . . . . . . . . . . [28](#page-28)
   [4](#section-4). Client messages from various states. . . . . . . . . . . . . . [33](#page-33)
   [5](#section-5). Fields and options used by DHCP clients. . . . . . . . . . . . [37](#page-37)

[1](#section-1). Introduction

   The Dynamic Host Configuration Protocol (DHCP) provides configuration
   parameters to Internet hosts.  DHCP consists of two components: a
   protocol for delivering host-specific configuration parameters from a
   DHCP server to a host and a mechanism for allocation of network
   addresses to hosts.

   DHCP is built on a client-server model, where designated DHCP server
   hosts allocate network addresses and deliver configuration parameters
   to dynamically configured hosts.  Throughout the remainder of this
   document, the term "server" refers to a host providing initialization
   parameters through DHCP, and the term "client" refers to a host
   requesting initialization parameters from a DHCP server.

   A host should not act as a DHCP server unless explicitly configured
   to do so by a system administrator.  The diversity of hardware and
   protocol implementations in the Internet would preclude reliable
   operation if random hosts were allowed to respond to DHCP requests.
   For example, IP requires the setting of many parameters within the
   protocol implementation software.  Because IP can be used on many
   dissimilar kinds of network hardware, values for those parameters
   cannot be guessed or assumed to have correct defaults.  Also,
   distributed address allocation schemes depend on a polling/defense

Droms                       Standards Track                     [Page 2]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   mechanism for discovery of addresses that are already in use.  IP
   hosts may not always be able to defend their network addresses, so
   that such a distributed address allocation scheme cannot be
   guaranteed to avoid allocation of duplicate network addresses.

   DHCP supports three mechanisms for IP address allocation.  In
   "automatic allocation", DHCP assigns a permanent IP address to a
   client.  In "dynamic allocation", DHCP assigns an IP address to a
   client for a limited period of time (or until the client explicitly
   relinquishes the address).  In "manual allocation", a client's IP
   address is assigned by the network administrator, and DHCP is used
   simply to convey the assigned address to the client.  A particular
   network will use one or more of these mechanisms, depending on the
   policies of the network administrator.

   Dynamic allocation is the only one of the three mechanisms that
   allows automatic reuse of an address that is no longer needed by the
   client to which it was assigned.  Thus, dynamic allocation is
   particularly useful for assigning an address to a client that will be
   connected to the network only temporarily or for sharing a limited
   pool of IP addresses among a group of clients that do not need
   permanent IP addresses.  Dynamic allocation may also be a good choice
   for assigning an IP address to a new client being permanently
   connected to a network where IP addresses are sufficiently scarce
   that it is important to reclaim them when old clients are retired.
   Manual allocation allows DHCP to be used to eliminate the error-prone
   process of manually configuring hosts with IP addresses in
   environments where (for whatever reasons) it is desirable to manage
   IP address assignment outside of the DHCP mechanisms.

   The format of DHCP messages is based on the format of BOOTP messages,
   to capture the BOOTP relay agent behavior described as part of the
   BOOTP specification [[7](#ref-7 "\"Bootstrap Protocol (BOOTP)\""), [21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")] and to allow interoperability of existing
   BOOTP clients with DHCP servers.  Using BOOTP relay agents eliminates
   the necessity of having a DHCP server on each physical network
   segment.

[1.1](#section-1.1) Changes to [RFC 1541](/doc/html/rfc1541)

   This document updates the DHCP protocol specification that appears in
   [RFC1541](/doc/html/rfc1541).  A new DHCP message type, DHCPINFORM, has been added; see
   [section 3.4](#section-3.4), 4.3 and 4.4 for details.  The classing mechanism for
   identifying DHCP clients to DHCP servers has been extended to include
   "vendor" classes as defined in sections [4.2](#section-4.2) and [4.3](#section-4.3).  The minimum
   lease time restriction has been removed.  Finally, many editorial
   changes have been made to clarify the text as a result of experience
   gained in DHCP interoperability tests.

Droms                       Standards Track                     [Page 3]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[1.2](#section-1.2) Related Work

   There are several Internet protocols and related mechanisms that
   address some parts of the dynamic host configuration problem.  The
   Reverse Address Resolution Protocol (RARP) [[10](#ref-10 "\"A Reverse Address Resolution Protocol\"")] (through the
   extensions defined in the Dynamic RARP (DRARP) [[5](#ref-5 "\"Dynamic Reverse Address Resolution Protocol (DRARP)\"")]) explicitly
   addresses the problem of network address discovery, and includes an
   automatic IP address assignment mechanism.  The Trivial File Transfer
   Protocol (TFTP) [[20](#ref-20 "\"The TFTP Protocol (Revision 2)\"")] provides for transport of a boot image from a
   boot server.  The Internet Control Message Protocol (ICMP) [[16](#ref-16 "\"Internet Control Message Protocol\"")]
   provides for informing hosts of additional routers via "ICMP
   redirect" messages.  ICMP also can provide subnet mask information
   through the "ICMP mask request" message and other information through
   the (obsolete) "ICMP information request" message.  Hosts can locate
   routers through the ICMP router discovery mechanism [[8](#ref-8 "\"ICMP Router Discovery Messages\"")].

   BOOTP is a transport mechanism for a collection of configuration
   information.  BOOTP is also extensible, and official extensions [[17](#ref-17 "\"BOOTP Vendor Information Extensions\"")]
   have been defined for several configuration parameters.  Morgan has
   proposed extensions to BOOTP for dynamic IP address assignment [[15](#ref-15 "\"Dynamic IP Address Assignment for Ethernet Attached Hosts\"")].
   The Network Information Protocol (NIP), used by the Athena project at
   MIT, is a distributed mechanism for dynamic IP address assignment
   [[19](#ref-19 "MIT)")].  The Resource Location Protocol RLP [[1](#ref-1 "\"Resource Location Protocol\"")] provides for location
   of higher level services.  Sun Microsystems diskless workstations use
   a boot procedure that employs RARP, TFTP and an RPC mechanism called
   "bootparams" to deliver configuration information and operating
   system code to diskless hosts.  (Sun Microsystems, Sun Workstation
   and SunOS are trademarks of Sun Microsystems, Inc.)  Some Sun
   networks also use DRARP and an auto-installation mechanism to
   automate the configuration of new hosts in an existing network.

   In other related work, the path minimum transmission unit (MTU)
   discovery algorithm can determine the MTU of an arbitrary internet
   path [[14](#ref-14 "\"Path MTU Discovery\"")].  The Address Resolution Protocol (ARP) has been proposed
   as a transport protocol for resource location and selection [[6](#ref-6 "\"Uniform Access to Internet Directory Services\"")].
   Finally, the Host Requirements RFCs [[3](#ref-3 "\"Requirements for Internet Hosts -- Communication Layers\""), [4](#ref-4 "Editor")] mention specific
   requirements for host reconfiguration and suggest a scenario for
   initial configuration of diskless hosts.

[1.3](#section-1.3) Problem definition and issues

   DHCP is designed to supply DHCP clients with the configuration
   parameters defined in the Host Requirements RFCs.  After obtaining
   parameters via DHCP, a DHCP client should be able to exchange packets
   with any other host in the Internet.  The TCP/IP stack parameters
   supplied by DHCP are listed in [Appendix A](#appendix-A).

Droms                       Standards Track                     [Page 4]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   Not all of these parameters are required for a newly initialized
   client.  A client and server may negotiate for the transmission of
   only those parameters required by the client or specific to a
   particular subnet.

   DHCP allows but does not require the configuration of client
   parameters not directly related to the IP protocol.  DHCP also does
   not address registration of newly configured clients with the Domain
   Name System (DNS) [[12](#ref-12 "\"Domain Names -- Concepts and Facilities\""), [13](#ref-13 "\"Domain Names -- Implementation and Specification\"")].

   DHCP is not intended for use in configuring routers.

[1.4](#section-1.4) Requirements

   Throughout this document, the words that are used to define the
   significance of particular requirements are capitalized.  These words
   are:

      o "MUST"

        This word or the adjective "REQUIRED" means that the
        item is an absolute requirement of this specification.

      o "MUST NOT"

        This phrase means that the item is an absolute prohibition
        of this specification.

      o "SHOULD"

        This word or the adjective "RECOMMENDED" means that there
        may exist valid reasons in particular circumstances to ignore
        this item, but the full implications should be understood and
        the case carefully weighed before choosing a different course.

      o "SHOULD NOT"

        This phrase means that there may exist valid reasons in
        particular circumstances when the listed behavior is acceptable
        or even useful, but the full implications should be understood
        and the case carefully weighed before implementing any behavior
        described with this label.

Droms                       Standards Track                     [Page 5]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      o "MAY"

        This word or the adjective "OPTIONAL" means that this item is
        truly optional.  One vendor may choose to include the item
        because a particular marketplace requires it or because it
        enhances the product, for example; another vendor may omit the
        same item.

[1.5](#section-1.5) Terminology

   This document uses the following terms:

      o "DHCP client"

      A DHCP client is an Internet host using DHCP to obtain
      configuration parameters such as a network address.

      o "DHCP server"

      A DHCP server is an Internet host that returns configuration
      parameters to DHCP clients.

      o "BOOTP relay agent"

      A BOOTP relay agent or relay agent is an Internet host or router
      that passes DHCP messages between DHCP clients and DHCP servers.
      DHCP is designed to use the same relay agent behavior as specified
      in the BOOTP protocol specification.

      o "binding"

      A binding is a collection of configuration parameters, including
      at least an IP address, associated with or "bound to" a DHCP
      client.  Bindings are managed by DHCP servers.

[1.6](#section-1.6) Design goals

   The following list gives general design goals for DHCP.

      o DHCP should be a mechanism rather than a policy.  DHCP must
        allow local system administrators control over configuration
        parameters where desired; e.g., local system administrators
        should be able to enforce local policies concerning allocation
        and access to local resources where desired.

Droms                       Standards Track                     [Page 6]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      o Clients should require no manual configuration.  Each client
        should be able to discover appropriate local configuration
        parameters without user intervention and incorporate those
        parameters into its own configuration.

      o Networks should require no manual configuration for individual
        clients.  Under normal circumstances, the network manager
        should not have to enter any per-client configuration
        parameters.

      o DHCP should not require a server on each subnet.  To allow for
        scale and economy, DHCP must work across routers or through the
        intervention of BOOTP relay agents.

      o A DHCP client must be prepared to receive multiple responses
        to a request for configuration parameters.  Some installations
        may include multiple, overlapping DHCP servers to enhance
        reliability and increase performance.

      o DHCP must coexist with statically configured, non-participating
        hosts and with existing network protocol implementations.

      o DHCP must interoperate with the BOOTP relay agent behavior as
        described by [RFC 951](/doc/html/rfc951) and by [RFC 1542](/doc/html/rfc1542) [[21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")].

      o DHCP must provide service to existing BOOTP clients.

   The following list gives design goals specific to the transmission of
   the network layer parameters.  DHCP must:

      o Guarantee that any specific network address will not be in
        use by more than one DHCP client at a time,

      o Retain DHCP client configuration across DHCP client reboot.  A
        DHCP client should, whenever possible, be assigned the same
        configuration parameters (e.g., network address) in response
        to each request,

      o Retain DHCP client configuration across server reboots, and,
        whenever possible, a DHCP client should be assigned the same
        configuration parameters despite restarts of the DHCP mechanism,

      o Allow automated assignment of configuration parameters to new
        clients to avoid hand configuration for new clients,

      o Support fixed or permanent allocation of configuration
        parameters to specific clients.

Droms                       Standards Track                     [Page 7]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[2](#section-2). Protocol Summary

   From the client's point of view, DHCP is an extension of the BOOTP
   mechanism.  This behavior allows existing BOOTP clients to
   interoperate with DHCP servers without requiring any change to the
   clients' initialization software.  [RFC 1542](/doc/html/rfc1542) [[2](#ref-2 "\"DHCP Options and BOOTP Vendor Extensions\"")] details the
   interactions between BOOTP and DHCP clients and servers [[9](#ref-9 "\"Interoperation between DHCP and BOOTP\"")].  There
   are some new, optional transactions that optimize the interaction
   between DHCP clients and servers that are described in sections [3](#section-3) and
   4.

   Figure 1 gives the format of a DHCP message and table 1 describes
   each of the fields in the DHCP message.  The numbers in parentheses
   indicate the size of each field in octets.  The names for the fields
   given in the figure will be used throughout this document to refer to
   the fields in DHCP messages.

   There are two primary differences between DHCP and BOOTP.  First,
   DHCP defines mechanisms through which clients can be assigned a
   network address for a finite lease, allowing for serial reassignment
   of network addresses to different clients.  Second, DHCP provides the
   mechanism for a client to acquire all of the IP configuration
   parameters that it needs in order to operate.

   DHCP introduces a small change in terminology intended to clarify the
   meaning of one of the fields.  What was the "vendor extensions" field
   in BOOTP has been re-named the "options" field in DHCP. Similarly,
   the tagged data items that were used inside the BOOTP "vendor
   extensions" field, which were formerly referred to as "vendor
   extensions," are now termed simply "options."

Droms                       Standards Track                     [Page 8]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   0                   1                   2                   3
   0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
   +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
   |     op (1)    |   htype (1)   |   hlen (1)    |   hops (1)    |
   +---------------+---------------+---------------+---------------+
   |                            xid (4)                            |
   +-------------------------------+-------------------------------+
   |           secs (2)            |           flags (2)           |
   +-------------------------------+-------------------------------+
   |                          ciaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          yiaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          siaddr  (4)                          |
   +---------------------------------------------------------------+
   |                          giaddr  (4)                          |
   +---------------------------------------------------------------+
   |                                                               |
   |                          chaddr  (16)                         |
   |                                                               |
   |                                                               |
   +---------------------------------------------------------------+
   |                                                               |
   |                          sname   (64)                         |
   +---------------------------------------------------------------+
   |                                                               |
   |                          file    (128)                        |
   +---------------------------------------------------------------+
   |                                                               |
   |                          options (variable)                   |
   +---------------------------------------------------------------+

                  Figure 1:  Format of a DHCP message

   DHCP defines a new 'client identifier' option that is used to pass an
   explicit client identifier to a DHCP server.  This change eliminates
   the overloading of the 'chaddr' field in BOOTP messages, where
   'chaddr' is used both as a hardware address for transmission of BOOTP
   reply messages and as a client identifier.  The 'client identifier'
   is an opaque key, not to be interpreted by the server; for example,
   the 'client identifier' may contain a hardware address, identical to
   the contents of the 'chaddr' field, or it may contain another type of
   identifier, such as a DNS name.  The 'client identifier' chosen by a
   DHCP client MUST be unique to that client within the subnet to which
   the client is attached. If the client uses a 'client identifier' in
   one message, it MUST use that same identifier in all subsequent
   messages, to ensure that all servers correctly identify the client.

Droms                       Standards Track                     [Page 9]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   DHCP clarifies the interpretation of the 'siaddr' field as the
   address of the server to use in the next step of the client's
   bootstrap process.  A DHCP server may return its own address in the
   'siaddr' field, if the server is prepared to supply the next
   bootstrap service (e.g., delivery of an operating system executable
   image).  A DHCP server always returns its own address in the 'server
   identifier' option.

   FIELD      OCTETS       DESCRIPTION
   -----      ------       -----------

   op            1  Message op code / message type.
                    1 = BOOTREQUEST, 2 = BOOTREPLY
   htype         1  Hardware address type, see ARP section in "Assigned
                    Numbers" RFC; e.g., '1' = 10mb ethernet.
   hlen          1  Hardware address length (e.g.  '6' for 10mb
                    ethernet).
   hops          1  Client sets to zero, optionally used by relay agents
                    when booting via a relay agent.
   xid           4  Transaction ID, a random number chosen by the
                    client, used by the client and server to associate
                    messages and responses between a client and a
                    server.
   secs          2  Filled in by client, seconds elapsed since client
                    began address acquisition or renewal process.
   flags         2  Flags (see figure 2).
   ciaddr        4  Client IP address; only filled in if client is in
                    BOUND, RENEW or REBINDING state and can respond
                    to ARP requests.
   yiaddr        4  'your' (client) IP address.
   siaddr        4  IP address of next server to use in bootstrap;
                    returned in DHCPOFFER, DHCPACK by server.
   giaddr        4  Relay agent IP address, used in booting via a
                    relay agent.
   chaddr       16  Client hardware address.
   sname        64  Optional server host name, null terminated string.
   file        128  Boot file name, null terminated string; "generic"
                    name or null in DHCPDISCOVER, fully qualified
                    directory-path name in DHCPOFFER.
   options     var  Optional parameters field.  See the options
                    documents for a list of defined options.

           Table 1:  Description of fields in a DHCP message

   The 'options' field is now variable length. A DHCP client must be
   prepared to receive DHCP messages with an 'options' field of at least
   length 312 octets.  This requirement implies that a DHCP client must
   be prepared to receive a message of up to 576 octets, the minimum IP

Droms                       Standards Track                    [Page 10]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   datagram size an IP host must be prepared to accept [[3](#ref-3 "\"Requirements for Internet Hosts -- Communication Layers\"")].  DHCP
   clients may negotiate the use of larger DHCP messages through the
   'maximum DHCP message size' option.  The options field may be further
   extended into the 'file' and 'sname' fields.

   In the case of a client using DHCP for initial configuration (before
   the client's TCP/IP software has been completely configured), DHCP
   requires creative use of the client's TCP/IP software and liberal
   interpretation of [RFC 1122](/doc/html/rfc1122).  The TCP/IP software SHOULD accept and
   forward to the IP layer any IP packets delivered to the client's
   hardware address before the IP address is configured; DHCP servers
   and BOOTP relay agents may not be able to deliver DHCP messages to
   clients that cannot accept hardware unicast datagrams before the
   TCP/IP software is configured.

   To work around some clients that cannot accept IP unicast datagrams
   before the TCP/IP software is configured as discussed in the previous
   paragraph, DHCP uses the 'flags' field [[21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")].  The leftmost bit is
   defined as the BROADCAST (B) flag.  The semantics of this flag are
   discussed in [section 4.1](#section-4.1) of this document.  The remaining bits of the
   flags field are reserved for future use.  They MUST be set to zero by
   clients and ignored by servers and relay agents.  Figure 2 gives the
   format of the 'flags' field.

                                    1 1 1 1 1 1
                0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5
                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
                |B|             MBZ             |
                +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+

                B:  BROADCAST flag

                MBZ:  MUST BE ZERO (reserved for future use)

                Figure 2:  Format of the 'flags' field

[2.1](#section-2.1) Configuration parameters repository

   The first service provided by DHCP is to provide persistent storage
   of network parameters for network clients.  The model of DHCP
   persistent storage is that the DHCP service stores a key-value entry
   for each client, where the key is some unique identifier (for
   example, an IP subnet number and a unique identifier within the
   subnet) and the value contains the configuration parameters for the
   client.

   For example, the key might be the pair (IP-subnet-number, hardware-
   address) (note that the "hardware-address" should be typed by the

Droms                       Standards Track                    [Page 11]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   type of hardware to accommodate possible duplication of hardware
   addresses resulting from bit-ordering problems in a mixed-media,
   bridged network) allowing for serial or concurrent reuse of a
   hardware address on different subnets, and for hardware addresses
   that may not be globally unique.  Alternately, the key might be the
   pair (IP-subnet-number, hostname), allowing the server to assign
   parameters intelligently to a DHCP client that has been moved to a
   different subnet or has changed hardware addresses (perhaps because
   the network interface failed and was replaced). The protocol defines
   that the key will be (IP-subnet-number, hardware-address) unless the
   client explicitly supplies an identifier using the 'client
   identifier' option.           A client can query the DHCP service to
   retrieve its configuration parameters.  The client interface to the
   configuration parameters repository consists of protocol messages to
   request configuration parameters and responses from the server
   carrying the configuration parameters.

[2.2](#section-2.2) Dynamic allocation of network addresses

   The second service provided by DHCP is the allocation of temporary or
   permanent network (IP) addresses to clients.  The basic mechanism for
   the dynamic allocation of network addresses is simple: a client
   requests the use of an address for some period of time.  The
   allocation mechanism (the collection of DHCP servers) guarantees not
   to reallocate that address within the requested time and attempts to
   return the same network address each time the client requests an
   address.  In this document, the period over which a network address
   is allocated to a client is referred to as a "lease" [[11](#ref-11 "\"Leases: An Efficient Fault-Tolerant Mechanism for Distributed File Cache Consistency\"")].  The
   client may extend its lease with subsequent requests.  The client may
   issue a message to release the address back to the server when the
   client no longer needs the address.  The client may ask for a
   permanent assignment by asking for an infinite lease.  Even when
   assigning "permanent" addresses, a server may choose to give out
   lengthy but non-infinite leases to allow detection of the fact that
   the client has been retired.

   In some environments it will be necessary to reassign network
   addresses due to exhaustion of available addresses.  In such
   environments, the allocation mechanism will reuse addresses whose
   lease has expired.  The server should use whatever information is
   available in the configuration information repository to choose an
   address to reuse.  For example, the server may choose the least
   recently assigned address.  As a consistency check, the allocating
   server SHOULD probe the reused address before allocating the address,
   e.g., with an ICMP echo request, and the client SHOULD probe the
   newly received address, e.g., with ARP.

Droms                       Standards Track                    [Page 12]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[3](#section-3). The Client-Server Protocol

   DHCP uses the BOOTP message format defined in [RFC 951](/doc/html/rfc951) and given in
   table 1 and figure 1.  The 'op' field of each DHCP message sent from
   a client to a server contains BOOTREQUEST. BOOTREPLY is used in the
   'op' field of each DHCP message sent from a server to a client.

   The first four octets of the 'options' field of the DHCP message
   contain the (decimal) values 99, 130, 83 and 99, respectively (this
   is the same magic cookie as is defined in [RFC 1497](/doc/html/rfc1497) [[17](#ref-17 "\"BOOTP Vendor Information Extensions\"")]).  The
   remainder of the 'options' field consists of a list of tagged
   parameters that are called "options".  All of the "vendor extensions"
   listed in [RFC 1497](/doc/html/rfc1497) are also DHCP options.  [RFC 1533](/doc/html/rfc1533) gives the
   complete set of options defined for use with DHCP.

   Several options have been defined so far.  One particular option -
   the "DHCP message type" option - must be included in every DHCP
   message.  This option defines the "type" of the DHCP message.
   Additional options may be allowed, required, or not allowed,
   depending on the DHCP message type.

   Throughout this document, DHCP messages that include a 'DHCP message
   type' option will be referred to by the type of the message; e.g., a
   DHCP message with 'DHCP message type' option type 1 will be referred
   to as a "DHCPDISCOVER" message.

[3.1](#section-3.1) Client-server interaction - allocating a network address

   The following summary of the protocol exchanges between clients and
   servers refers to the DHCP messages described in table 2.  The
   timeline diagram in figure 3 shows the timing relationships in a
   typical client-server interaction.  If the client already knows its
   address, some steps may be omitted; this abbreviated interaction is
   described in [section 3.2](#section-3.2).

   1. The client broadcasts a DHCPDISCOVER message on its local physical
      subnet.  The DHCPDISCOVER message MAY include options that suggest
      values for the network address and lease duration.  BOOTP relay
      agents may pass the message on to DHCP servers not on the same
      physical subnet.

   2. Each server may respond with a DHCPOFFER message that includes an
      available network address in the 'yiaddr' field (and other
      configuration parameters in DHCP options).  Servers need not
      reserve the offered network address, although the protocol will
      work more efficiently if the server avoids allocating the offered
      network address to another client.  When allocating a new address,
      servers SHOULD check that the offered network address is not

Droms                       Standards Track                    [Page 13]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      already in use; e.g., the server may probe the offered address
      with an ICMP Echo Request.  Servers SHOULD be implemented so that
      network administrators MAY choose to disable probes of newly
      allocated addresses.  The server transmits the DHCPOFFER message
      to the client, using the BOOTP relay agent if necessary.

   Message         Use
   -------         ---

   DHCPDISCOVER -  Client broadcast to locate available servers.

   DHCPOFFER    -  Server to client in response to DHCPDISCOVER with
                   offer of configuration parameters.

   DHCPREQUEST  -  Client message to servers either (a) requesting
                   offered parameters from one server and implicitly
                   declining offers from all others, (b) confirming
                   correctness of previously allocated address after,
                   e.g., system reboot, or (c) extending the lease on a
                   particular network address.

   DHCPACK      -  Server to client with configuration parameters,
                   including committed network address.

   DHCPNAK      -  Server to client indicating client's notion of network
                   address is incorrect (e.g., client has moved to new
                   subnet) or client's lease as expired

   DHCPDECLINE  -  Client to server indicating network address is already
                   in use.

   DHCPRELEASE  -  Client to server relinquishing network address and
                   cancelling remaining lease.

   DHCPINFORM   -  Client to server, asking only for local configuration
                   parameters; client already has externally configured
                   network address.

                          Table 2:  DHCP messages

Droms                       Standards Track                    [Page 14]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

                Server          Client          Server
            (not selected)                    (selected)

                  v               v               v
                  |               |               |
                  |     Begins initialization     |
                  |               |               |
                  | _____________/|\____________  |
                  |/DHCPDISCOVER | DHCPDISCOVER  \|
                  |               |               |
              Determines          |          Determines
             configuration        |         configuration
                  |               |               |
                  |\             |  ____________/ |
                  | \________    | /DHCPOFFER     |
                  | DHCPOFFER\   |/               |
                  |           \  |                |
                  |       Collects replies        |
                  |             \|                |
                  |     Selects configuration     |
                  |               |               |
                  | _____________/|\____________  |
                  |/ DHCPREQUEST  |  DHCPREQUEST\ |
                  |               |               |
                  |               |     Commits configuration
                  |               |               |
                  |               | _____________/|
                  |               |/ DHCPACK      |
                  |               |               |
                  |    Initialization complete    |
                  |               |               |
                  .               .               .
                  .               .               .
                  |               |               |
                  |      Graceful shutdown        |
                  |               |               |
                  |               |\ ____________ |
                  |               | DHCPRELEASE  \|
                  |               |               |
                  |               |        Discards lease
                  |               |               |
                  v               v               v
     Figure 3: Timeline diagram of messages exchanged between DHCP
               client and servers when allocating a new network address

Droms                       Standards Track                    [Page 15]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

  3. The client receives one or more DHCPOFFER messages from one or more
     servers.  The client may choose to wait for multiple responses.
     The client chooses one server from which to request configuration
     parameters, based on the configuration parameters offered in the
     DHCPOFFER messages.  The client broadcasts a DHCPREQUEST message
     that MUST include the 'server identifier' option to indicate which
     server it has selected, and that MAY include other options
     specifying desired configuration values.  The 'requested IP
     address' option MUST be set to the value of 'yiaddr' in the
     DHCPOFFER message from the server.  This DHCPREQUEST message is
     broadcast and relayed through DHCP/BOOTP relay agents.  To help
     ensure that any BOOTP relay agents forward the DHCPREQUEST message
     to the same set of DHCP servers that received the original
     DHCPDISCOVER message, the DHCPREQUEST message MUST use the same
     value in the DHCP message header's 'secs' field and be sent to the
     same IP broadcast address as the original DHCPDISCOVER message.
     The client times out and retransmits the DHCPDISCOVER message if
     the client receives no DHCPOFFER messages.

  4. The servers receive the DHCPREQUEST broadcast from the client.
     Those servers not selected by the DHCPREQUEST message use the
     message as notification that the client has declined that server's
     offer.  The server selected in the DHCPREQUEST message commits the
     binding for the client to persistent storage and responds with a
     DHCPACK message containing the configuration parameters for the
     requesting client.  The combination of 'client identifier' or
     'chaddr' and assigned network address constitute a unique
     identifier for the client's lease and are used by both the client
     and server to identify a lease referred to in any DHCP messages.
     Any configuration parameters in the DHCPACK message SHOULD NOT
     conflict with those in the earlier DHCPOFFER message to which the
     client is responding.  The server SHOULD NOT check the offered
     network address at this point. The 'yiaddr' field in the DHCPACK
     messages is filled in with the selected network address.

     If the selected server is unable to satisfy the DHCPREQUEST message
     (e.g., the requested network address has been allocated), the
     server SHOULD respond with a DHCPNAK message.

     A server MAY choose to mark addresses offered to clients in
     DHCPOFFER messages as unavailable.  The server SHOULD mark an
     address offered to a client in a DHCPOFFER message as available if
     the server receives no DHCPREQUEST message from that client.

  5. The client receives the DHCPACK message with configuration
     parameters.  The client SHOULD perform a final check on the
     parameters (e.g., ARP for allocated network address), and notes the
     duration of the lease specified in the DHCPACK message.  At this

Droms                       Standards Track                    [Page 16]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

     point, the client is configured.  If the client detects that the
     address is already in use (e.g., through the use of ARP), the
     client MUST send a DHCPDECLINE message to the server and restarts
     the configuration process.  The client SHOULD wait a minimum of ten
     seconds before restarting the configuration process to avoid
     excessive network traffic in case of looping.

     If the client receives a DHCPNAK message, the client restarts the
     configuration process.

     The client times out and retransmits the DHCPREQUEST message if the
     client receives neither a DHCPACK or a DHCPNAK message.  The client
     retransmits the DHCPREQUEST according to the retransmission
     algorithm in [section 4.1](#section-4.1).  The client should choose to retransmit
     the DHCPREQUEST enough times to give adequate probability of
     contacting the server without causing the client (and the user of
     that client) to wait overly long before giving up; e.g., a client
     retransmitting as described in [section 4.1](#section-4.1) might retransmit the
     DHCPREQUEST message four times, for a total delay of 60 seconds,
     before restarting the initialization procedure.  If the client
     receives neither a DHCPACK or a DHCPNAK message after employing the
     retransmission algorithm, the client reverts to INIT state and
     restarts the initialization process.  The client SHOULD notify the
     user that the initialization process has failed and is restarting.

  6. The client may choose to relinquish its lease on a network address
     by sending a DHCPRELEASE message to the server.  The client
     identifies the lease to be released with its 'client identifier',
     or 'chaddr' and network address in the DHCPRELEASE message. If the
     client used a 'client identifier' when it obtained the lease, it
     MUST use the same 'client identifier' in the DHCPRELEASE message.

[3.2](#section-3.2) Client-server interaction - reusing a previously allocated network
    address

   If a client remembers and wishes to reuse a previously allocated
   network address, a client may choose to omit some of the steps
   described in the previous section.  The timeline diagram in figure 4
   shows the timing relationships in a typical client-server interaction
   for a client reusing a previously allocated network address.

Droms                       Standards Track                    [Page 17]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   1. The client broadcasts a DHCPREQUEST message on its local subnet.
      The message includes the client's network address in the
      'requested IP address' option. As the client has not received its
      network address, it MUST NOT fill in the 'ciaddr' field. BOOTP
      relay agents pass the message on to DHCP servers not on the same
      subnet.  If the client used a 'client identifier' to obtain its
      address, the client MUST use the same 'client identifier' in the
      DHCPREQUEST message.

   2. Servers with knowledge of the client's configuration parameters
      respond with a DHCPACK message to the client.  Servers SHOULD NOT
      check that the client's network address is already in use; the
      client may respond to ICMP Echo Request messages at this point.

                Server          Client          Server

                  v               v               v
                  |                |               |
                  |              Begins            |
                  |          initialization        |
                  |                |               |
                  |                /|\             |
                  |   _________ __/ | \__________  |
                  | /DHCPREQU EST  |  DHCPREQUEST\ |
                  |/               |              \|
                  |                |               |
               Locates             |            Locates
            configuration          |         configuration
                  |                |               |
                  |\               |              /|
                  | \              |  ___________/ |
                  |  \             | /  DHCPACK    |
                  |   \ _______    |/              |
                  |     DHCPACK\   |               |
                  |          Initialization        |
                  |             complete           |
                  |               \|               |
                  |                |               |
                  |           (Subsequent          |
                  |             DHCPACKS           |
                  |             ignored)           |
                  |                |               |
                  |                |               |
                  v                v               v

     Figure 4: Timeline diagram of messages exchanged between DHCP
               client and servers when reusing a previously allocated
               network address

Droms                       Standards Track                    [Page 18]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      If the client's request is invalid (e.g., the client has moved
      to a new subnet), servers SHOULD respond with a DHCPNAK message to
      the client. Servers SHOULD NOT respond if their information is not
      guaranteed to be accurate.  For example, a server that identifies a
      request for an expired binding that is owned by another server SHOULD
      NOT respond with a DHCPNAK unless the servers are using an explicit
      mechanism to maintain coherency among the servers.

      If 'giaddr' is 0x0 in the DHCPREQUEST message, the client is on
      the same subnet as the server.  The server MUST
      broadcast the DHCPNAK message to the 0xffffffff broadcast address
      because the client may not have a correct network address or subnet
      mask, and the client may not be answering ARP requests.
      Otherwise, the server MUST send the DHCPNAK message to the IP
      address of the BOOTP relay agent, as recorded in 'giaddr'.  The
      relay agent will, in turn, forward the message directly to the
      client's hardware address, so that the DHCPNAK can be delivered even
      if the client has moved to a new network.

   3. The client receives the DHCPACK message with configuration
      parameters.  The client performs a final check on the parameters
      (as in [section 3.1](#section-3.1)), and notes the duration of the lease specified
      in the DHCPACK message.  The specific lease is implicitly identified
      by the 'client identifier' or 'chaddr' and the network address.  At
      this point, the client is configured.

      If the client detects that the IP address in the DHCPACK message
      is already in use, the client MUST send a DHCPDECLINE message to the
      server and restarts the configuration process by requesting a
      new network address.  This action corresponds to the client
      moving to the INIT state in the DHCP state diagram, which is
      described in [section 4.4](#section-4.4).

      If the client receives a DHCPNAK message, it cannot reuse its
      remembered network address.  It must instead request a new
      address by restarting the configuration process, this time
      using the (non-abbreviated) procedure described in [section](#section-3.1)
      [3.1](#section-3.1).  This action also corresponds to the client moving to
      the INIT state in the DHCP state diagram.

      The client times out and retransmits the DHCPREQUEST message if
      the client receives neither a DHCPACK nor a DHCPNAK message.  The
      client retransmits the DHCPREQUEST according to the retransmission
      algorithm in [section 4.1](#section-4.1).  The client should choose to retransmit
      the DHCPREQUEST enough times to give adequate probability of
      contacting the server without causing the client (and the user of
      that client) to wait overly long before giving up; e.g., a client
      retransmitting as described in [section 4.1](#section-4.1) might retransmit the

Droms                       Standards Track                    [Page 19]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      DHCPREQUEST message four times, for a total delay of 60 seconds,
      before restarting the initialization procedure.  If the client
      receives neither a DHCPACK or a DHCPNAK message after employing
      the retransmission algorithm, the client MAY choose to use the
      previously allocated network address and configuration parameters
      for the remainder of the unexpired lease.  This corresponds to
      moving to BOUND state in the client state transition diagram shown
      in figure 5.

   4. The client may choose to relinquish its lease on a network
      address by sending a DHCPRELEASE message to the server.  The
      client identifies the lease to be released with its
      'client identifier', or 'chaddr' and network address in the
      DHCPRELEASE message.

      Note that in this case, where the client retains its network
      address locally, the client will not normally relinquish its
      lease during a graceful shutdown.  Only in the case where the
      client explicitly needs to relinquish its lease, e.g., the client
      is about to be moved to a different subnet, will the client send
      a DHCPRELEASE message.

[3.3](#section-3.3) Interpretation and representation of time values

   A client acquires a lease for a network address for a fixed period of
   time (which may be infinite).  Throughout the protocol, times are to
   be represented in units of seconds.  The time value of 0xffffffff is
   reserved to represent "infinity".

   As clients and servers may not have synchronized clocks, times are
   represented in DHCP messages as relative times, to be interpreted
   with respect to the client's local clock.  Representing relative
   times in units of seconds in an unsigned 32 bit word gives a range of
   relative times from 0 to approximately 100 years, which is sufficient
   for the relative times to be measured using DHCP.

   The algorithm for lease duration interpretation given in the previous
   paragraph assumes that client and server clocks are stable relative
   to each other.  If there is drift between the two clocks, the server
   may consider the lease expired before the client does.  To
   compensate, the server may return a shorter lease duration to the
   client than the server commits to its local database of client
   information.

[3.4](#section-3.4) Obtaining parameters with externally configured network address

   If a client has obtained a network address through some other means
   (e.g., manual configuration), it may use a DHCPINFORM request message

Droms                       Standards Track                    [Page 20]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   to obtain other local configuration parameters.  Servers receiving a
   DHCPINFORM message construct a DHCPACK message with any local
   configuration parameters appropriate for the client without:
   allocating a new address, checking for an existing binding, filling
   in 'yiaddr' or including lease time parameters.  The servers SHOULD
   unicast the DHCPACK reply to the address given in the 'ciaddr' field
   of the DHCPINFORM message.

   The server SHOULD check the network address in a DHCPINFORM message
   for consistency, but MUST NOT check for an existing lease.  The
   server forms a DHCPACK message containing the configuration
   parameters for the requesting client and sends the DHCPACK message
   directly to the client.

[3.5](#section-3.5) Client parameters in DHCP

   Not all clients require initialization of all parameters listed in
   [Appendix A](#appendix-A).  Two techniques are used to reduce the number of
   parameters transmitted from the server to the client.  First, most of
   the parameters have defaults defined in the Host Requirements RFCs;
   if the client receives no parameters from the server that override
   the defaults, a client uses those default values.  Second, in its
   initial DHCPDISCOVER or DHCPREQUEST message, a client may provide the
   server with a list of specific parameters the client is interested
   in.  If the client includes a list of parameters in a DHCPDISCOVER
   message, it MUST include that list in any subsequent DHCPREQUEST
   messages.

   The client SHOULD include the 'maximum DHCP message size' option to
   let the server know how large the server may make its DHCP messages.
   The parameters returned to a client may still exceed the space
   allocated to options in a DHCP message.  In this case, two additional
   options flags (which must appear in the 'options' field of the
   message) indicate that the 'file' and 'sname' fields are to be used
   for options.

   The client can inform the server which configuration parameters the
   client is interested in by including the 'parameter request list'
   option.  The data portion of this option explicitly lists the options
   requested by tag number.

   In addition, the client may suggest values for the network address
   and lease time in the DHCPDISCOVER message.  The client may include
   the 'requested IP address' option to suggest that a particular IP
   address be assigned, and may include the 'IP address lease time'
   option to suggest the lease time it would like.  Other options
   representing "hints" at configuration parameters are allowed in a
   DHCPDISCOVER or DHCPREQUEST message.  However, additional options may

Droms                       Standards Track                    [Page 21]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   be ignored by servers, and multiple servers may, therefore, not
   return identical values for some options.  The 'requested IP address'
   option is to be filled in only in a DHCPREQUEST message when the
   client is verifying network parameters obtained previously. The
   client fills in the 'ciaddr' field only when correctly configured
   with an IP address in BOUND, RENEWING or REBINDING state.

   If a server receives a DHCPREQUEST message with an invalid 'requested
   IP address', the server SHOULD respond to the client with a DHCPNAK
   message and may choose to report the problem to the system
   administrator.  The server may include an error message in the
   'message' option.

[3.6](#section-3.6) Use of DHCP in clients with multiple interfaces

   A client with multiple network interfaces must use DHCP through each
   interface independently to obtain configuration information
   parameters for those separate interfaces.

[3.7](#section-3.7) When clients should use DHCP

   A client SHOULD use DHCP to reacquire or verify its IP address and
   network parameters whenever the local network parameters may have
   changed; e.g., at system boot time or after a disconnection from the
   local network, as the local network configuration may change without
   the client's or user's knowledge.

   If a client has knowledge of a previous network address and is unable
   to contact a local DHCP server, the client may continue to use the
   previous network address until the lease for that address expires.
   If the lease expires before the client can contact a DHCP server, the
   client must immediately discontinue use of the previous network
   address and may inform local users of the problem.

[4](#section-4). Specification of the DHCP client-server protocol

   In this section, we assume that a DHCP server has a block of network
   addresses from which it can satisfy requests for new addresses.  Each
   server also maintains a database of allocated addresses and leases in
   local permanent storage.

[4.1](#section-4.1) Constructing and sending DHCP messages

   DHCP clients and servers both construct DHCP messages by filling in
   fields in the fixed format section of the message and appending
   tagged data items in the variable length option area.  The options
   area includes first a four-octet 'magic cookie' (which was described
   in [section 3](#section-3)), followed by the options.  The last option must always

Droms                       Standards Track                    [Page 22]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   be the 'end' option.

   DHCP uses UDP as its transport protocol.  DHCP messages from a client
   to a server are sent to the 'DHCP server' port (67), and DHCP
   messages from a server to a client are sent to the 'DHCP client' port
   (68). A server with multiple network address (e.g., a multi-homed
   host) MAY use any of its network addresses in outgoing DHCP messages.

   The 'server identifier' field is used both to identify a DHCP server
   in a DHCP message and as a destination address from clients to
   servers.  A server with multiple network addresses MUST be prepared
   to to accept any of its network addresses as identifying that server
   in a DHCP message.  To accommodate potentially incomplete network
   connectivity, a server MUST choose an address as a 'server
   identifier' that, to the best of the server's knowledge, is reachable
   from the client.  For example, if the DHCP server and the DHCP client
   are connected to the same subnet (i.e., the 'giaddr' field in the
   message from the client is zero), the server SHOULD select the IP
   address the server is using for communication on that subnet as the
   'server identifier'.  If the server is using multiple IP addresses on
   that subnet, any such address may be used.  If the server has
   received a message through a DHCP relay agent, the server SHOULD
   choose an address from the interface on which the message was
   recieved as the 'server identifier' (unless the server has other,
   better information on which to make its choice).  DHCP clients MUST
   use the IP address provided in the 'server identifier' option for any
   unicast requests to the DHCP server.

   DHCP messages broadcast by a client prior to that client obtaining
   its IP address must have the source address field in the IP header
   set to 0.

   If the 'giaddr' field in a DHCP message from a client is non-zero,
   the server sends any return messages to the 'DHCP server' port on the
   BOOTP relay agent whose address appears in 'giaddr'. If the 'giaddr'
   field is zero and the 'ciaddr' field is nonzero, then the server
   unicasts DHCPOFFER and DHCPACK messages to the address in 'ciaddr'.
   If 'giaddr' is zero and 'ciaddr' is zero, and the broadcast bit is
   set, then the server broadcasts DHCPOFFER and DHCPACK messages to
   0xffffffff. If the broadcast bit is not set and 'giaddr' is zero and
   'ciaddr' is zero, then the server unicasts DHCPOFFER and DHCPACK
   messages to the client's hardware address and 'yiaddr' address.  In
   all cases, when 'giaddr' is zero, the server broadcasts any DHCPNAK
   messages to 0xffffffff.

   If the options in a DHCP message extend into the 'sname' and 'file'
   fields, the 'option overload' option MUST appear in the 'options'
   field, with value 1, 2 or 3, as specified in [RFC 1533](/doc/html/rfc1533).  If the

Droms                       Standards Track                    [Page 23]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   'option overload' option is present in the 'options' field, the
   options in the 'options' field MUST be terminated by an 'end' option,
   and MAY contain one or more 'pad' options to fill the options field.
   The options in the 'sname' and 'file' fields (if in use as indicated
   by the 'options overload' option) MUST begin with the first octet of
   the field, MUST be terminated by an 'end' option, and MUST be
   followed by 'pad' options to fill the remainder of the field.  Any
   individual option in the 'options', 'sname' and 'file' fields MUST be
   entirely contained in that field.  The options in the 'options' field
   MUST be interpreted first, so that any 'option overload' options may
   be interpreted.  The 'file' field MUST be interpreted next (if the
   'option overload' option indicates that the 'file' field contains
   DHCP options), followed by the 'sname' field.

   The values to be passed in an 'option' tag may be too long to fit in
   the 255 octets available to a single option (e.g., a list of routers
   in a 'router' option [[21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")]).  Options may appear only once, unless
   otherwise specified in the options document.  The client concatenates
   the values of multiple instances of the same option into a single
   parameter list for configuration.

   DHCP clients are responsible for all message retransmission.  The
   client MUST adopt a retransmission strategy that incorporates a
   randomized exponential backoff algorithm to determine the delay
   between retransmissions.  The delay between retransmissions SHOULD be
   chosen to allow sufficient time for replies from the server to be
   delivered based on the characteristics of the internetwork between
   the client and the server.  For example, in a 10Mb/sec Ethernet
   internetwork, the delay before the first retransmission SHOULD be 4
   seconds randomized by the value of a uniform random number chosen
   from the range -1 to +1.  Clients with clocks that provide resolution
   granularity of less than one second may choose a non-integer
   randomization value.  The delay before the next retransmission SHOULD
   be 8 seconds randomized by the value of a uniform number chosen from
   the range -1 to +1.  The retransmission delay SHOULD be doubled with
   subsequent retransmissions up to a maximum of 64 seconds.  The client
   MAY provide an indication of retransmission attempts to the user as
   an indication of the progress of the configuration process.

   The 'xid' field is used by the client to match incoming DHCP messages
   with pending requests.  A DHCP client MUST choose 'xid's in such a
   way as to minimize the chance of using an 'xid' identical to one used
   by another client. For example, a client may choose a different,
   random initial 'xid' each time the client is rebooted, and
   subsequently use sequential 'xid's until the next reboot.  Selecting
   a new 'xid' for each retransmission is an implementation decision.  A
   client may choose to reuse the same 'xid' or select a new 'xid' for
   each retransmitted message.

Droms                       Standards Track                    [Page 24]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   Normally, DHCP servers and BOOTP relay agents attempt to deliver
   DHCPOFFER, DHCPACK and DHCPNAK messages directly to the client using
   uicast delivery.  The IP destination address (in the IP header) is
   set to the DHCP 'yiaddr' address and the link-layer destination
   address is set to the DHCP 'chaddr' address.  Unfortunately, some
   client implementations are unable to receive such unicast IP
   datagrams until the implementation has been configured with a valid
   IP address (leading to a deadlock in which the client's IP address
   cannot be delivered until the client has been configured with an IP
   address).

   A client that cannot receive unicast IP datagrams until its protocol
   software has been configured with an IP address SHOULD set the
   BROADCAST bit in the 'flags' field to 1 in any DHCPDISCOVER or
   DHCPREQUEST messages that client sends.  The BROADCAST bit will
   provide a hint to the DHCP server and BOOTP relay agent to broadcast
   any messages to the client on the client's subnet.  A client that can
   receive unicast IP datagrams before its protocol software has been
   configured SHOULD clear the BROADCAST bit to 0.  The BOOTP
   clarifications document discusses the ramifications of the use of the
   BROADCAST bit [[21](#ref-21 "\"Clarifications and Extensions for the Bootstrap Protocol\"")].

   A server or relay agent sending or relaying a DHCP message directly
   to a DHCP client (i.e., not to a relay agent specified in the
   'giaddr' field) SHOULD examine the BROADCAST bit in the 'flags'
   field.  If this bit is set to 1, the DHCP message SHOULD be sent as
   an IP broadcast using an IP broadcast address (preferably 0xffffffff)
   as the IP destination address and the link-layer broadcast address as
   the link-layer destination address.  If the BROADCAST bit is cleared
   to 0, the message SHOULD be sent as an IP unicast to the IP address
   specified in the 'yiaddr' field and the link-layer address specified
   in the 'chaddr' field.  If unicasting is not possible, the message
   MAY be sent as an IP broadcast using an IP broadcast address
   (preferably 0xffffffff) as the IP destination address and the link-
   layer broadcast address as the link-layer destination address.

[4.2](#section-4.2) DHCP server administrative controls

   DHCP servers are not required to respond to every DHCPDISCOVER and
   DHCPREQUEST message they receive.  For example, a network
   administrator, to retain stringent control over the clients attached
   to the network, may choose to configure DHCP servers to respond only
   to clients that have been previously registered through some external
   mechanism.  The DHCP specification describes only the interactions
   between clients and servers when the clients and servers choose to
   interact; it is beyond the scope of the DHCP specification to
   describe all of the administrative controls that system
   administrators might want to use.  Specific DHCP server

Droms                       Standards Track                    [Page 25]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   implementations may incorporate any controls or policies desired by a
   network administrator.

   In some environments, a DHCP server will have to consider the values
   of the vendor class options included in DHCPDISCOVER or DHCPREQUEST
   messages when determining the correct parameters for a particular
   client.

   A DHCP server needs to use some unique identifier to associate a
   client with its lease.  The client MAY choose to explicitly provide
   the identifier through the 'client identifier' option.  If the client
   supplies a 'client identifier', the client MUST use the same 'client
   identifier' in all subsequent messages, and the server MUST use that
   identifier to identify the client.  If the client does not provide a
   'client identifier' option, the server MUST use the contents of the
   'chaddr' field to identify the client. It is crucial for a DHCP
   client to use an identifier unique within the subnet to which the
   client is attached in the 'client identifier' option.  Use of
   'chaddr' as the client's unique identifier may cause unexpected
   results, as that identifier may be associated with a hardware
   interface that could be moved to a new client.  Some sites may choose
   to use a manufacturer's serial number as the 'client identifier', to
   avoid unexpected changes in a clients network address due to transfer
   of hardware interfaces among computers.  Sites may also choose to use
   a DNS name as the 'client identifier', causing address leases to be
   associated with the DNS name rather than a specific hardware box.

   DHCP clients are free to use any strategy in selecting a DHCP server
   among those from which the client receives a DHCPOFFER message.  The
   client implementation of DHCP SHOULD provide a mechanism for the user
   to select directly the 'vendor class identifier' values.

[4.3](#section-4.3) DHCP server behavior

   A DHCP server processes incoming DHCP messages from a client based on
   the current state of the binding for that client.  A DHCP server can
   receive the following messages from a client:

      o DHCPDISCOVER

      o DHCPREQUEST

      o DHCPDECLINE

      o DHCPRELEASE

      o DHCPINFORM

Droms                       Standards Track                    [Page 26]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   Table 3 gives the use of the fields and options in a DHCP message by
   a server.  The remainder of this section describes the action of the
   DHCP server for each possible incoming message.

[4.3.1](#section-4.3.1) DHCPDISCOVER message

   When a server receives a DHCPDISCOVER message from a client, the
   server chooses a network address for the requesting client.  If no
   address is available, the server may choose to report the problem to
   the system administrator. If an address is available, the new address
   SHOULD be chosen as follows:

      o The client's current address as recorded in the client's current
        binding, ELSE

      o The client's previous address as recorded in the client's (now
        expired or released) binding, if that address is in the server's
        pool of available addresses and not already allocated, ELSE

      o The address requested in the 'Requested IP Address' option, if that
        address is valid and not already allocated, ELSE

      o A new address allocated from the server's pool of available
        addresses; the address is selected based on the subnet from which
        the message was received (if 'giaddr' is 0) or on the address of
        the relay agent that forwarded the message ('giaddr' when not 0).

   As described in [section 4.2](#section-4.2), a server MAY, for administrative
   reasons, assign an address other than the one requested, or may
   refuse to allocate an address to a particular client even though free
   addresses are available.

   Note that, in some network architectures (e.g., internets with more
   than one IP subnet assigned to a physical network segment), it may be
   the case that the DHCP client should be assigned an address from a
   different subnet than the address recorded in 'giaddr'.  Thus, DHCP
   does not require that the client be assigned as address from the
   subnet in 'giaddr'.  A server is free to choose some other subnet,
   and it is beyond the scope of the DHCP specification to describe ways
   in which the assigned IP address might be chosen.

   While not required for correct operation of DHCP, the server SHOULD
   NOT reuse the selected network address before the client responds to
   the server's DHCPOFFER message.  The server may choose to record the
   address as offered to the client.

   The server must also choose an expiration time for the lease, as
   follows:

Droms                       Standards Track                    [Page 27]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   o IF the client has not requested a specific lease in the
     DHCPDISCOVER message and the client already has an assigned network
     address, the server returns the lease expiration time previously
     assigned to that address (note that the client must explicitly
     request a specific lease to extend the expiration time on a
     previously assigned address), ELSE

   o IF the client has not requested a specific lease in the
     DHCPDISCOVER message and the client does not have an assigned
     network address, the server assigns a locally configured default
     lease time, ELSE

   o IF the client has requested a specific lease in the DHCPDISCOVER
     message (regardless of whether the client has an assigned network
     address), the server may choose either to return the requested
     lease (if the lease is acceptable to local policy) or select
     another lease.

Field      DHCPOFFER            DHCPACK             DHCPNAK
-----      ---------            -------             -------
'op'       BOOTREPLY            BOOTREPLY           BOOTREPLY
'htype'    (From "Assigned Numbers" RFC)
'hlen'     (Hardware address length in octets)
'hops'     0                    0                   0
'xid'      'xid' from client    'xid' from client   'xid' from client
           DHCPDISCOVER         DHCPREQUEST         DHCPREQUEST
           message              message             message
'secs'     0                    0                   0
'ciaddr'   0                    'ciaddr' from       0
                                DHCPREQUEST or 0
'yiaddr'   IP address offered   IP address          0
           to client            assigned to client
'siaddr'   IP address of next   IP address of next  0
           bootstrap server     bootstrap server
'flags'    'flags' from         'flags' from        'flags' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'giaddr'   'giaddr' from        'giaddr' from       'giaddr' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'chaddr'   'chaddr' from        'chaddr' from       'chaddr' from
           client DHCPDISCOVER  client DHCPREQUEST  client DHCPREQUEST
           message              message             message
'sname'    Server host name     Server host name    (unused)
           or options           or options
'file'     Client boot file     Client boot file    (unused)
           name or options      name or options
'options'  options              options

Droms                       Standards Track                    [Page 28]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

Option                    DHCPOFFER    DHCPACK            DHCPNAK
------                    ---------    -------            -------
Requested IP address      MUST NOT     MUST NOT           MUST NOT
IP address lease time     MUST         MUST (DHCPREQUEST) MUST NOT
                                       MUST NOT (DHCPINFORM)
Use 'file'/'sname' fields MAY          MAY                MUST NOT
DHCP message type         DHCPOFFER    DHCPACK            DHCPNAK
Parameter request list    MUST NOT     MUST NOT           MUST NOT
Message                   SHOULD       SHOULD             SHOULD
Client identifier         MUST NOT     MUST NOT           MAY
Vendor class identifier   MAY          MAY                MAY
Server identifier         MUST         MUST               MUST
Maximum message size      MUST NOT     MUST NOT           MUST NOT
All others                MAY          MAY                MUST NOT

           Table 3:  Fields and options used by DHCP servers

   Once the network address and lease have been determined, the server
   constructs a DHCPOFFER message with the offered configuration
   parameters.  It is important for all DHCP servers to return the same
   parameters (with the possible exception of a newly allocated network
   address) to ensure predictable client behavior regardless of which
   server the client selects.  The configuration parameters MUST be
   selected by applying the following rules in the order given below.
   The network administrator is responsible for configuring multiple
   DHCP servers to ensure uniform responses from those servers.  The
   server MUST return to the client:

   o The client's network address, as determined by the rules given
     earlier in this section,

   o The expiration time for the client's lease, as determined by the
     rules given earlier in this section,

   o Parameters requested by the client, according to the following
     rules:

        -- IF the server has been explicitly configured with a default
           value for the parameter, the server MUST include that value
           in an appropriate option in the 'option' field, ELSE

        -- IF the server recognizes the parameter as a parameter
           defined in the Host Requirements Document, the server MUST
           include the default value for that parameter as given in the
           Host Requirements Document in an appropriate option in the
           'option' field, ELSE

        -- The server MUST NOT return a value for that parameter,

Droms                       Standards Track                    [Page 29]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

     The server MUST supply as many of the requested parameters as
     possible and MUST omit any parameters it cannot provide.  The
     server MUST include each requested parameter only once unless
     explicitly allowed in the DHCP Options and BOOTP Vendor
     Extensions document.

   o Any parameters from the existing binding that differ from the Host
     Requirements Document defaults,

   o Any parameters specific to this client (as identified by
     the contents of 'chaddr' or 'client identifier' in the DHCPDISCOVER
     or DHCPREQUEST message), e.g., as configured by the network
     administrator,

   o Any parameters specific to this client's class (as identified
     by the contents of the 'vendor class identifier'
     option in the DHCPDISCOVER or DHCPREQUEST message),
     e.g., as configured by the network administrator; the parameters
     MUST be identified by an exact match between the client's vendor
     class identifiers and the client's classes identified in the
     server,

   o Parameters with non-default values on the client's subnet.

   The server MAY choose to return the 'vendor class identifier' used to
   determine the parameters in the DHCPOFFER message to assist the
   client in selecting which DHCPOFFER to accept.  The server inserts
   the 'xid' field from the DHCPDISCOVER message into the 'xid' field of
   the DHCPOFFER message and sends the DHCPOFFER message to the
   requesting client.

[4.3.2](#section-4.3.2) DHCPREQUEST message

   A DHCPREQUEST message may come from a client responding to a
   DHCPOFFER message from a server, from a client verifying a previously
   allocated IP address or from a client extending the lease on a
   network address.  If the DHCPREQUEST message contains a 'server
   identifier' option, the message is in response to a DHCPOFFER
   message.  Otherwise, the message is a request to verify or extend an
   existing lease.  If the client uses a 'client identifier' in a
   DHCPREQUEST message, it MUST use that same 'client identifier' in all
   subsequent messages. If the client included a list of requested
   parameters in a DHCPDISCOVER message, it MUST include that list in
   all subsequent messages.

Droms                       Standards Track                    [Page 30]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   Any configuration parameters in the DHCPACK message SHOULD NOT
   conflict with those in the earlier DHCPOFFER message to which the
   client is responding.  The client SHOULD use the parameters in the
   DHCPACK message for configuration.

   Clients send DHCPREQUEST messages as follows:

   o DHCPREQUEST generated during SELECTING state:

      Client inserts the address of the selected server in 'server
      identifier', 'ciaddr' MUST be zero, 'requested IP address' MUST be
      filled in with the yiaddr value from the chosen DHCPOFFER.

      Note that the client may choose to collect several DHCPOFFER
      messages and select the "best" offer.  The client indicates its
      selection by identifying the offering server in the DHCPREQUEST
      message.  If the client receives no acceptable offers, the client
      may choose to try another DHCPDISCOVER message.  Therefore, the
      servers may not receive a specific DHCPREQUEST from which they can
      decide whether or not the client has accepted the offer.  Because
      the servers have not committed any network address assignments on
      the basis of a DHCPOFFER, servers are free to reuse offered
      network addresses in response to subsequent requests.  As an
      implementation detail, servers SHOULD NOT reuse offered addresses
      and may use an implementation-specific timeout mechanism to decide
      when to reuse an offered address.

   o DHCPREQUEST generated during INIT-REBOOT state:

      'server identifier' MUST NOT be filled in, 'requested IP address'
      option MUST be filled in with client's notion of its previously
      assigned address. 'ciaddr' MUST be zero. The client is seeking to
      verify a previously allocated, cached configuration. Server SHOULD
      send a DHCPNAK message to the client if the 'requested IP address'
      is incorrect, or is on the wrong network.

      Determining whether a client in the INIT-REBOOT state is on the
      correct network is done by examining the contents of 'giaddr', the
      'requested IP address' option, and a database lookup. If the DHCP
      server detects that the client is on the wrong net (i.e., the
      result of applying the local subnet mask or remote subnet mask (if
      'giaddr' is not zero) to 'requested IP address' option value
      doesn't match reality), then the server SHOULD send a DHCPNAK
      message to the client.

Droms                       Standards Track                    [Page 31]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      If the network is correct, then the DHCP server should check if
      the client's notion of its IP address is correct. If not, then the
      server SHOULD send a DHCPNAK message to the client. If the DHCP
      server has no record of this client, then it MUST remain silent,
      and MAY output a warning to the network administrator. This
      behavior is necessary for peaceful coexistence of non-
      communicating DHCP servers on the same wire.

      If 'giaddr' is 0x0 in the DHCPREQUEST message, the client is on
      the same subnet as the server.  The server MUST broadcast the
      DHCPNAK message to the 0xffffffff broadcast address because the
      client may not have a correct network address or subnet mask, and
      the client may not be answering ARP requests.

      If 'giaddr' is set in the DHCPREQUEST message, the client is on a
      different subnet.  The server MUST set the broadcast bit in the
      DHCPNAK, so that the relay agent will broadcast the DHCPNAK to the
      client, because the client may not have a correct network address
      or subnet mask, and the client may not be answering ARP requests.

   o DHCPREQUEST generated during RENEWING state:

      'server identifier' MUST NOT be filled in, 'requested IP address'
      option MUST NOT be filled in, 'ciaddr' MUST be filled in with
      client's IP address. In this situation, the client is completely
      configured, and is trying to extend its lease. This message will
      be unicast, so no relay agents will be involved in its
      transmission.  Because 'giaddr' is therefore not filled in, the
      DHCP server will trust the value in 'ciaddr', and use it when
      replying to the client.

      A client MAY choose to renew or extend its lease prior to T1.  The
      server may choose not to extend the lease (as a policy decision by
      the network administrator), but should return a DHCPACK message
      regardless.

   o DHCPREQUEST generated during REBINDING state:

      'server identifier' MUST NOT be filled in, 'requested IP address'
      option MUST NOT be filled in, 'ciaddr' MUST be filled in with
      client's IP address. In this situation, the client is completely
      configured, and is trying to extend its lease. This message MUST
      be broadcast to the 0xffffffff IP broadcast address.  The DHCP
      server SHOULD check 'ciaddr' for correctness before replying to
      the DHCPREQUEST.

Droms                       Standards Track                    [Page 32]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

      The DHCPREQUEST from a REBINDING client is intended to accommodate
      sites that have multiple DHCP servers and a mechanism for
      maintaining consistency among leases managed by multiple servers.
      A DHCP server MAY extend a client's lease only if it has local
      administrative authority to do so.

[4.3.3](#section-4.3.3) DHCPDECLINE message

   If the server receives a DHCPDECLINE message, the client has
   discovered through some other means that the suggested network
   address is already in use.  The server MUST mark the network address
   as not available and SHOULD notify the local system administrator of
   a possible configuration problem.

[4.3.4](#section-4.3.4) DHCPRELEASE message

   Upon receipt of a DHCPRELEASE message, the server marks the network
   address as not allocated.  The server SHOULD retain a record of the
   client's initialization parameters for possible reuse in response to
   subsequent requests from the client.

[4.3.5](#section-4.3.5) DHCPINFORM message

   The server responds to a DHCPINFORM message by sending a DHCPACK
   message directly to the address given in the 'ciaddr' field of the
   DHCPINFORM message.  The server MUST NOT send a lease expiration time
   to the client and SHOULD NOT fill in 'yiaddr'.  The server includes
   other parameters in the DHCPACK message as defined in [section 4.3.1](#section-4.3.1).

[4.3.6](#section-4.3.6) Client messages

   Table 4 details the differences between messages from clients in
   various states.

   ---------------------------------------------------------------------
   |              |INIT-REBOOT  |SELECTING    |RENEWING     |REBINDING |
   ---------------------------------------------------------------------
   |broad/unicast |broadcast    |broadcast    |unicast      |broadcast |
   |server-ip     |MUST NOT     |MUST         |MUST NOT     |MUST NOT  |
   |requested-ip  |MUST         |MUST         |MUST NOT     |MUST NOT  |
   |ciaddr        |zero         |zero         |IP address   |IP address|
   ---------------------------------------------------------------------

              Table 4: Client messages from different states

Droms                       Standards Track                    [Page 33]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[4.4](#section-4.4) DHCP client behavior

   Figure 5 gives a state-transition diagram for a DHCP client.  A
   client can receive the following messages from a server:

         o DHCPOFFER

         o DHCPACK

         o DHCPNAK

   The DHCPINFORM message is not shown in figure 5.  A client simply
   sends the DHCPINFORM and waits for DHCPACK messages.  Once the client
   has selected its parameters, it has completed the configuration
   process.

   Table 5 gives the use of the fields and options in a DHCP message by
   a client.  The remainder of this section describes the action of the
   DHCP client for each possible incoming message.  The description in
   the following section corresponds to the full configuration procedure
   previously described in [section 3.1](#section-3.1), and the text in the subsequent
   section corresponds to the abbreviated configuration procedure
   described in [section 3.2](#section-3.2).

Droms                       Standards Track                    [Page 34]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

 --------                               -------
|        | +-------------------------->|       |<-------------------+
| INIT-  | |     +-------------------->| INIT  |                    |
| REBOOT |DHCPNAK/         +---------->|       |<---+               |
|        |Restart|         |            -------     |               |
 --------  |  DHCPNAK/     |               |                        |
    |      Discard offer   |      -/Send DHCPDISCOVER               |
-/Send DHCPREQUEST         |               |                        |
    |      |     |      DHCPACK            v        |               |
 -----------     |   (not accept.)/   -----------   |               |
|           |    |  Send DHCPDECLINE |           |                  |
| REBOOTING |    |         |         | SELECTING |<----+            |
|           |    |        /          |           |     |DHCPOFFER/  |
 -----------     |       /            -----------   |  |Collect     |
    |            |      /                  |   |       |  replies   |
DHCPACK/         |     /  +----------------+   +-------+            |
Record lease, set|    |   v   Select offer/                         |
timers T1, T2   ------------  send DHCPREQUEST      |               |
    |   +----->|            |             DHCPNAK, Lease expired/   |
    |   |      | REQUESTING |                  Halt network         |
    DHCPOFFER/ |            |                       |               |
    Discard     ------------                        |               |
    |   |        |        |                   -----------           |
    |   +--------+     DHCPACK/              |           |          |
    |              Record lease, set    -----| REBINDING |          |
    |                timers T1, T2     /     |           |          |
    |                     |        DHCPACK/   -----------           |
    |                     v     Record lease, set   ^               |
    +----------------> -------      /timers T1,T2   |               |
               +----->|       |<---+                |               |
               |      | BOUND |<---+                |               |
  DHCPOFFER, DHCPACK, |       |    |            T2 expires/   DHCPNAK/
   DHCPNAK/Discard     -------     |             Broadcast  Halt network
               |       | |         |            DHCPREQUEST         |
               +-------+ |        DHCPACK/          |               |
                    T1 expires/   Record lease, set |               |
                 Send DHCPREQUEST timers T1, T2     |               |
                 to leasing server |                |               |
                         |   ----------             |               |
                         |  |          |------------+               |
                         +->| RENEWING |                            |
                            |          |----------------------------+
                             ----------
          Figure 5:  State-transition diagram for DHCP clients

Droms                       Standards Track                    [Page 35]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[4.4.1](#section-4.4.1) Initialization and allocation of network address

   The client begins in INIT state and forms a DHCPDISCOVER message.
   The client SHOULD wait a random time between one and ten seconds to
   desynchronize the use of DHCP at startup.  The client sets 'ciaddr'
   to 0x00000000.  The client MAY request specific parameters by
   including the 'parameter request list' option.  The client MAY
   suggest a network address and/or lease time by including the
   'requested IP address' and 'IP address lease time' options.  The
   client MUST include its hardware address in the 'chaddr' field, if
   necessary for delivery of DHCP reply messages.  The client MAY
   include a different unique identifier in the 'client identifier'
   option, as discussed in [section 4.2](#section-4.2).  If the client included a list
   of requested parameters in a DHCPDISCOVER message, it MUST include
   that list in all subsequent messages.

   The client generates and records a random transaction identifier and
   inserts that identifier into the 'xid' field.  The client records its
   own local time for later use in computing the lease expiration.  The
   client then broadcasts the DHCPDISCOVER on the local hardware
   broadcast address to the 0xffffffff IP broadcast address and 'DHCP
   server' UDP port.

   If the 'xid' of an arriving DHCPOFFER message does not match the
   'xid' of the most recent DHCPDISCOVER message, the DHCPOFFER message
   must be silently discarded.  Any arriving DHCPACK messages must be
   silently discarded.

   The client collects DHCPOFFER messages over a period of time, selects
   one DHCPOFFER message from the (possibly many) incoming DHCPOFFER
   messages (e.g., the first DHCPOFFER message or the DHCPOFFER message
   from the previously used server) and extracts the server address from
   the 'server identifier' option in the DHCPOFFER message.  The time
   over which the client collects messages and the mechanism used to
   select one DHCPOFFER are implementation dependent.

Droms                       Standards Track                    [Page 36]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

Field      DHCPDISCOVER          DHCPREQUEST           DHCPDECLINE,
           DHCPINFORM                                  DHCPRELEASE
-----      ------------          -----------           -----------
'op'       BOOTREQUEST           BOOTREQUEST           BOOTREQUEST
'htype'    (From "Assigned Numbers" RFC)
'hlen'     (Hardware address length in octets)
'hops'     0                     0                     0
'xid'      selected by client    'xid' from server     selected by
                                 DHCPOFFER message     client
'secs'     0 or seconds since    0 or seconds since    0
           DHCP process started  DHCP process started
'flags'    Set 'BROADCAST'       Set 'BROADCAST'       0
           flag if client        flag if client
           requires broadcast    requires broadcast
           reply                 reply
'ciaddr'   0 (DHCPDISCOVER)      0 or client's         0 (DHCPDECLINE)
           client's              network address       client's network
           network address       (BOUND/RENEW/REBIND)  address
           (DHCPINFORM)                                (DHCPRELEASE)
'yiaddr'   0                     0                     0
'siaddr'   0                     0                     0
'giaddr'   0                     0                     0
'chaddr'   client's hardware     client's hardware     client's hardware
           address               address               address
'sname'    options, if           options, if           (unused)
           indicated in          indicated in
           'sname/file'          'sname/file'
           option; otherwise     option; otherwise
           unused                unused
'file'     options, if           options, if           (unused)
           indicated in          indicated in
           'sname/file'          'sname/file'
           option; otherwise     option; otherwise
           unused                unused
'options'  options               options               (unused)

Droms                       Standards Track                    [Page 37]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

Option                     DHCPDISCOVER  DHCPREQUEST      DHCPDECLINE,
                           DHCPINFORM                     DHCPRELEASE
------                     ------------  -----------      -----------
Requested IP address       MAY           MUST (in         MUST
                           (DISCOVER)    SELECTING or     (DHCPDECLINE),
                           MUST NOT      INIT-REBOOT)     MUST NOT
                           (INFORM)      MUST NOT (in     (DHCPRELEASE)
                                         BOUND or
                                         RENEWING)
IP address lease time      MAY           MAY              MUST NOT
                           (DISCOVER)
                           MUST NOT
                           (INFORM)
Use 'file'/'sname' fields  MAY           MAY              MAY
DHCP message type          DHCPDISCOVER/ DHCPREQUEST      DHCPDECLINE/
                           DHCPINFORM                     DHCPRELEASE
Client identifier          MAY           MAY              MAY
Vendor class identifier    MAY           MAY              MUST NOT
Server identifier          MUST NOT      MUST (after      MUST
                                         SELECTING)
                                         MUST NOT (after
                                         INIT-REBOOT,
                                         BOUND, RENEWING
                                         or REBINDING)
Parameter request list     MAY           MAY              MUST NOT
Maximum message size       MAY           MAY              MUST NOT
Message                    SHOULD NOT    SHOULD NOT       SHOULD
Site-specific              MAY           MAY              MUST NOT
All others                 MAY           MAY              MUST NOT

             Table 5:  Fields and options used by DHCP clients

   If the parameters are acceptable, the client records the address of
   the server that supplied the parameters from the 'server identifier'
   field and sends that address in the 'server identifier' field of a
   DHCPREQUEST broadcast message.  Once the DHCPACK message from the
   server arrives, the client is initialized and moves to BOUND state.
   The DHCPREQUEST message contains the same 'xid' as the DHCPOFFER
   message.  The client records the lease expiration time as the sum of
   the time at which the original request was sent and the duration of
   the lease from the DHCPACK message.    The client SHOULD perform a
   check on the suggested address to ensure that the address is not
   already in use.  For example, if the client is on a network that
   supports ARP, the client may issue an ARP request for the suggested
   request.  When broadcasting an ARP request for the suggested address,
   the client must fill in its own hardware address as the sender's
   hardware address, and 0 as the sender's IP address, to avoid
   confusing ARP caches in other hosts on the same subnet.  If the

Droms                       Standards Track                    [Page 38]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   network address appears to be in use, the client MUST send a
   DHCPDECLINE message to the server. The client SHOULD broadcast an ARP
   reply to announce the client's new IP address and clear any outdated
   ARP cache entries in hosts on the client's subnet.

[4.4.2](#section-4.4.2) Initialization with known network address

   The client begins in INIT-REBOOT state and sends a DHCPREQUEST
   message.  The client MUST insert its known network address as a
   'requested IP address' option in the DHCPREQUEST message.  The client
   may request specific configuration parameters by including the
   'parameter request list' option.  The client generates and records a
   random transaction identifier and inserts that identifier into the
   'xid' field.  The client records its own local time for later use in
   computing the lease expiration.  The client MUST NOT include a
   'server identifier' in the DHCPREQUEST message.  The client then
   broadcasts the DHCPREQUEST on the local hardware broadcast address to
   the 'DHCP server' UDP port.

   Once a DHCPACK message with an 'xid' field matching that in the
   client's DHCPREQUEST message arrives from any server, the client is
   initialized and moves to BOUND state.  The client records the lease
   expiration time as the sum of the time at which the DHCPREQUEST
   message was sent and the duration of the lease from the DHCPACK
   message.

[4.4.3](#section-4.4.3) Initialization with an externally assigned network address

   The client sends a DHCPINFORM message. The client may request
   specific configuration parameters by including the 'parameter request
   list' option. The client generates and records a random transaction
   identifier and inserts that identifier into the 'xid' field. The
   client places its own network address in the 'ciaddr' field. The
   client SHOULD NOT request lease time parameters.

   The client then unicasts the DHCPINFORM to the DHCP server if it
   knows the server's address, otherwise it broadcasts the message to
   the limited (all 1s) broadcast address.  DHCPINFORM messages MUST be
   directed to the 'DHCP server' UDP port.

   Once a DHCPACK message with an 'xid' field matching that in the
   client's DHCPINFORM message arrives from any server, the client is
   initialized.

   If the client does not receive a DHCPACK within a reasonable period
   of time (60 seconds or 4 tries if using timeout suggested in [section](#section-4.1)
   [4.1](#section-4.1)), then it SHOULD display a message informing the user of the
   problem, and then SHOULD begin network processing using suitable

Droms                       Standards Track                    [Page 39]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   defaults as per [Appendix A](#appendix-A).

[4.4.4](#section-4.4.4) Use of broadcast and unicast

   The DHCP client broadcasts DHCPDISCOVER, DHCPREQUEST and DHCPINFORM
   messages, unless the client knows the address of a DHCP server.  The
   client unicasts DHCPRELEASE messages to the server.  Because the
   client is declining the use of the IP address supplied by the server,
   the client broadcasts DHCPDECLINE messages.

   When the DHCP client knows the address of a DHCP server, in either
   INIT or REBOOTING state, the client may use that address in the
   DHCPDISCOVER or DHCPREQUEST rather than the IP broadcast address.
   The client may also use unicast to send DHCPINFORM messages to a
   known DHCP server.  If the client receives no response to DHCP
   messages sent to the IP address of a known DHCP server, the DHCP
   client reverts to using the IP broadcast address.

[4.4.5](#section-4.4.5) Reacquisition and expiration

   The client maintains two times, T1 and T2, that specify the times at
   which the client tries to extend its lease on its network address.
   T1 is the time at which the client enters the RENEWING state and
   attempts to contact the server that originally issued the client's
   network address.  T2 is the time at which the client enters the
   REBINDING state and attempts to contact any server. T1 MUST be
   earlier than T2, which, in turn, MUST be earlier than the time at
   which the client's lease will expire.

   To avoid the need for synchronized clocks, T1 and T2 are expressed in
   options as relative times [[2](#ref-2 "\"DHCP Options and BOOTP Vendor Extensions\"")].

   At time T1 the client moves to RENEWING state and sends (via unicast)
   a DHCPREQUEST message to the server to extend its lease.  The client
   sets the 'ciaddr' field in the DHCPREQUEST to its current network
   address. The client records the local time at which the DHCPREQUEST
   message is sent for computation of the lease expiration time.  The
   client MUST NOT include a 'server identifier' in the DHCPREQUEST
   message.

   Any DHCPACK messages that arrive with an 'xid' that does not match
   the 'xid' of the client's DHCPREQUEST message are silently discarded.
   When the client receives a DHCPACK from the server, the client
   computes the lease expiration time as the sum of the time at which
   the client sent the DHCPREQUEST message and the duration of the lease
   in the DHCPACK message.  The client has successfully reacquired its
   network address, returns to BOUND state and may continue network
   processing.

Droms                       Standards Track                    [Page 40]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   If no DHCPACK arrives before time T2, the client moves to REBINDING
   state and sends (via broadcast) a DHCPREQUEST message to extend its
   lease.  The client sets the 'ciaddr' field in the DHCPREQUEST to its
   current network address.  The client MUST NOT include a 'server
   identifier' in the DHCPREQUEST message.

   Times T1 and T2 are configurable by the server through options.  T1
   defaults to (0.5 * duration_of_lease).  T2 defaults to (0.875 *
   duration_of_lease).  Times T1 and T2 SHOULD be chosen with some
   random "fuzz" around a fixed value, to avoid synchronization of
   client reacquisition.

   A client MAY choose to renew or extend its lease prior to T1.  The
   server MAY choose to extend the client's lease according to policy
   set by the network administrator.  The server SHOULD return T1 and
   T2, and their values SHOULD be adjusted from their original values to
   take account of the time remaining on the lease.

   In both RENEWING and REBINDING states, if the client receives no
   response to its DHCPREQUEST message, the client SHOULD wait one-half
   of the remaining time until T2 (in RENEWING state) and one-half of
   the remaining lease time (in REBINDING state), down to a minimum of
   60 seconds, before retransmitting the DHCPREQUEST message.

   If the lease expires before the client receives a DHCPACK, the client
   moves to INIT state, MUST immediately stop any other network
   processing and requests network initialization parameters as if the
   client were uninitialized.  If the client then receives a DHCPACK
   allocating that client its previous network address, the client
   SHOULD continue network processing.  If the client is given a new
   network address, it MUST NOT continue using the previous network
   address and SHOULD notify the local users of the problem.

[4.4.6](#section-4.4.6) DHCPRELEASE

   If the client no longer requires use of its assigned network address
   (e.g., the client is gracefully shut down), the client sends a
   DHCPRELEASE message to the server.  Note that the correct operation
   of DHCP does not depend on the transmission of DHCPRELEASE messages.

Droms                       Standards Track                    [Page 41]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[5](#section-5). Acknowledgments

   The author thanks the many (and too numerous to mention!) members of
   the DHC WG for their tireless and ongoing efforts in the development
   of DHCP and this document.

   The efforts of J Allard, Mike Carney, Dave Lapp, Fred Lien and John
   Mendonca in organizing DHCP interoperability testing sessions are
   gratefully acknowledged.

   The development of this document was supported in part by grants from
   the Corporation for National Research Initiatives (CNRI), Bucknell
   University and Sun Microsystems.

[6](#section-6). References

   [1] Acetta, M., "Resource Location Protocol", [RFC 887](/doc/html/rfc887), CMU, December
       1983.

   [2] Alexander, S., and R. Droms, "DHCP Options and BOOTP Vendor
       Extensions", [RFC 1533](/doc/html/rfc1533), Lachman Technology, Inc., Bucknell
       University, October 1993.

   [3] Braden, R., Editor, "Requirements for Internet Hosts --
       Communication Layers", STD 3, [RFC 1122](/doc/html/rfc1122), USC/Information Sciences
       Institute, October 1989.

   [4] Braden, R., Editor, "Requirements for Internet Hosts --
       Application and Support, STD 3, [RFC 1123](/doc/html/rfc1123), USC/Information
       Sciences Institute, October 1989.

   [5] Brownell, D, "Dynamic Reverse Address Resolution Protocol
       (DRARP)", Work in Progress.

   [6] Comer, D., and R. Droms, "Uniform Access to Internet Directory
       Services", Proc. of ACM SIGCOMM '90 (Special issue of Computer
       Communications Review), 20(4):50--59, 1990.

   [7] Croft, B., and J. Gilmore, "Bootstrap Protocol (BOOTP)", [RFC 951](/doc/html/rfc951),
       Stanford and SUN Microsystems, September 1985.

   [8] Deering, S., "ICMP Router Discovery Messages", [RFC 1256](/doc/html/rfc1256), Xerox
       PARC, September 1991.

   [9] Droms, D., "Interoperation between DHCP and BOOTP", [RFC 1534](/doc/html/rfc1534),
       Bucknell University, October 1993.

Droms                       Standards Track                    [Page 42]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   [10] Finlayson, R., Mann, T., Mogul, J., and M. Theimer, "A Reverse
        Address Resolution Protocol", [RFC 903](/doc/html/rfc903), Stanford, June 1984.

   [11] Gray C., and D. Cheriton, "Leases: An Efficient Fault-Tolerant
        Mechanism for Distributed File Cache Consistency", In Proc. of
        the Twelfth ACM Symposium on Operating Systems Design, 1989.

   [12] Mockapetris, P., "Domain Names -- Concepts and Facilities", STD
        13, [RFC 1034](/doc/html/rfc1034), USC/Information Sciences Institute, November 1987.

   [13] Mockapetris, P., "Domain Names -- Implementation and
        Specification", STD 13, [RFC 1035](/doc/html/rfc1035), USC/Information Sciences
        Institute, November 1987.

   [14] Mogul J., and S. Deering, "Path MTU Discovery", [RFC 1191](/doc/html/rfc1191),
        November 1990.

   [15] Morgan, R., "Dynamic IP Address Assignment for Ethernet Attached
        Hosts", Work in Progress.

   [16] Postel, J., "Internet Control Message Protocol", STD 5, [RFC 792](/doc/html/rfc792),
        USC/Information Sciences Institute, September 1981.

   [17] Reynolds, J., "BOOTP Vendor Information Extensions", [RFC 1497](/doc/html/rfc1497),
        USC/Information Sciences Institute, August 1993.

   [18] Reynolds, J., and J. Postel, "Assigned Numbers", STD 2, [RFC 1700](/doc/html/rfc1700),
        USC/Information Sciences Institute, October 1994.

   [19] Jeffrey Schiller and Mark Rosenstein. A Protocol for the Dynamic
        Assignment of IP Addresses for use on an Ethernet. (Available
        from the Athena Project, MIT), 1989.

   [20] Sollins, K., "The TFTP Protocol (Revision 2)",  [RFC 783](/doc/html/rfc783), NIC,
        June 1981.

   [21] Wimer, W., "Clarifications and Extensions for the Bootstrap
        Protocol", [RFC 1542](/doc/html/rfc1542), Carnegie Mellon University, October 1993.

[7](#section-7). Security Considerations

   DHCP is built directly on UDP and IP which are as yet inherently
   insecure.  Furthermore, DHCP is generally intended to make
   maintenance of remote and/or diskless hosts easier.  While perhaps
   not impossible, configuring such hosts with passwords or keys may be
   difficult and inconvenient.  Therefore, DHCP in its current form is
   quite insecure.

Droms                       Standards Track                    [Page 43]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

   Unauthorized DHCP servers may be easily set up.  Such servers can
   then send false and potentially disruptive information to clients
   such as incorrect or duplicate IP addresses, incorrect routing
   information (including spoof routers, etc.), incorrect domain
   nameserver addresses (such as spoof nameservers), and so on.
   Clearly, once this seed information is in place, an attacker can
   further compromise affected systems.

   Malicious DHCP clients could masquerade as legitimate clients and
   retrieve information intended for those legitimate clients.  Where
   dynamic allocation of resources is used, a malicious client could
   claim all resources for itself, thereby denying resources to
   legitimate clients.

[8](#section-8). Author's Address

      Ralph Droms
      Computer Science Department
      323 Dana Engineering
      Bucknell University
      Lewisburg, PA 17837

      Phone: (717) 524-1145
      EMail: droms@bucknell.edu

Droms                       Standards Track                    [Page 44]
```

---

```

[RFC 2131](/doc/html/rfc2131)          Dynamic Host Configuration Protocol         March 1997

[A](#appendix-A). Host Configuration Parameters

   IP-layer_parameters,_per_host:_

   Be a router                     on/off                 HRC 3.1
   Non-local source routing        on/off                 HRC 3.3.5
   Policy filters for
   non-local source routing        (list)                 HRC 3.3.5
   Maximum reassembly size         integer                HRC 3.3.2
   Default TTL                     integer                HRC 3.2.1.7
   PMTU aging timeout              integer                MTU 6.6
   MTU plateau table               (list)                 MTU 7
   IP-layer_parameters,_per_interface:_
   IP address                      (address)              HRC 3.3.1.6
   Subnet mask                     (address mask)         HRC 3.3.1.6
   MTU                             integer                HRC 3.3.3
   All-subnets-MTU                 on/off                 HRC 3.3.3
   Broadcast address flavor        0x00000000/0xffffffff  HRC 3.3.6
   Perform mask discovery          on/off                 HRC 3.2.2.9
   Be a mask supplier              on/off                 HRC 3.2.2.9
   Perform router discovery        on/off                 RD 5.1
   Router solicitation address     (address)              RD 5.1
   Default routers, list of:
           router address          (address)              HRC 3.3.1.6
           preference level        integer                HRC 3.3.1.6
   Static routes, list of:
           destination             (host/subnet/net)      HRC 3.3.1.2
           destination mask        (address mask)         HRC 3.3.1.2
           type-of-service         integer                HRC 3.3.1.2
           first-hop router        (address)              HRC 3.3.1.2
           ignore redirects        on/off                 HRC 3.3.1.2
           PMTU                    integer                MTU 6.6
           perform PMTU discovery  on/off                 MTU 6.6

   Link-layer_parameters,_per_interface:_
   Trailers                       on/off                 HRC 2.3.1
   ARP cache timeout              integer                HRC 2.3.2.1
   Ethernet encapsulation         ([RFC 894](/doc/html/rfc894)/RFC 1042)     HRC 2.3.3

   TCP_parameters,_per_host:_
   TTL                            integer                HRC 4.2.2.19
   Keep-alive interval            integer                HRC 4.2.3.6
   Keep-alive data size           0/1                    HRC 4.2.3.6

Key:

   MTU = Path MTU Discovery ([RFC 1191](/doc/html/rfc1191), Proposed Standard)
   RD = Router Discovery ([RFC 1256](/doc/html/rfc1256), Proposed Standard)

Droms                       Standards Track                    [Page 45]

```

[Datatracker](/doc/rfc2131/)

RFC 2131

RFC
- Draft Standard

* Info
* Contents
* Prefs

| Document | Document type |  | RFC - Draft Standard  March 1997  [View errata](https://www.rfc-editor.org/errata_search.php?rfc=2131 "Click to view errata.") [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") [IPR](/ipr/search/?submit=draft&id=rfc2131 "Click to view IPR declarations.") Updated by [RFC 4361](/doc/html/rfc4361 "Node-specific Client Identifiers for Dynamic Host Configuration Protocol Version Four (DHCPv4)"), [RFC 5494](/doc/html/rfc5494 "IANA Allocation Guidelines for the Address Resolution Protocol (ARP)"), [RFC 6842](/doc/html/rfc6842 "Client Identifier Option in DHCP Server Replies"), [RFC 3396](/doc/html/rfc3396 "Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)") Obsoletes [RFC 1541](/doc/html/rfc1541 "Dynamic Host Configuration Protocol") Was [draft-ietf-dhc-dhcp](/doc/draft-ietf-dhc-dhcp/08/) ([dhc WG](/wg/dhc/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [08](/doc/html/draft-ietf-dhc-dhcp-08) * [RFC 2131](/doc/html/rfc2131) |
|  | Compare versions |  | RFC 2131  draft-ietf-dhc-dhcp-08  draft-ietf-dhc-dhcp-07  draft-ietf-dhc-dhcp-06  draft-ietf-dhc-dhcp-05  draft-ietf-dhc-dhcp-04  draft-ietf-dhc-dhcp-03  draft-ietf-dhc-dhcp-02  draft-ietf-dhc-dhcp-01  draft-ietf-dhc-dhcp-00   RFC 2131  draft-ietf-dhc-dhcp-08  draft-ietf-dhc-dhcp-07  draft-ietf-dhc-dhcp-06  draft-ietf-dhc-dhcp-05  draft-ietf-dhc-dhcp-04  draft-ietf-dhc-dhcp-03  draft-ietf-dhc-dhcp-02  draft-ietf-dhc-dhcp-01  draft-ietf-dhc-dhcp-00   Side-by-side  Inline |
|  | Author |  | [Ralph Droms](/person/rdroms.ietf%40gmail.com "Datatracker profile of Ralph Droms")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc2131.txt) [html](https://www.rfc-editor.org/rfc/rfc2131.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc2131.txt.pdf) [w/errata](https://www.rfc-editor.org/rfc/inline-errata/rfc2131.html) [bibtex](/doc/rfc2131/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/dhcwg/?q=rfc2131 OR %22draft-ietf-dhc-dhcp%22) |

[Report a datatracker bug](https://github.com/ietf-tools/datatracker/issues/new/choose)

Show sidebar by default

Yes

No

Tab to show by default

Info

Contents

HTMLization configuration

HTMLize the plaintext

Plaintextify the HTML

Maximum font size

Page dependencies

Inline

Reference

Citation links

 Go to reference section

Go to linked document

![](//analytics.ietf.org/piwik.php?idsite=7)



=== Content from datatracker.ietf.org_3d0db6b9_20250111_135238.html ===


* Light
* Dark
* Auto

[RFC 3442

Proposed Standard](/doc/rfc3442/)

|  | Title |  | The Classless Static Route Option for Dynamic Host Configuration Protocol (DHCP) version 4 |
| --- | --- | --- | --- |
| Document | Document type |  | RFC - Proposed Standard  December 2002  [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") Updates [RFC 2132](/doc/html/rfc2132 "DHCP Options and BOOTP Vendor Extensions") Was [draft-ietf-dhc-csr](/doc/draft-ietf-dhc-csr/07/) ([dhc WG](/wg/dhc/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [07](/doc/html/draft-ietf-dhc-csr-07) * [RFC 3442](/doc/html/rfc3442) |
|  | Compare versions |  | RFC 3442  draft-ietf-dhc-csr-07  draft-ietf-dhc-csr-06  draft-ietf-dhc-csr-05  draft-ietf-dhc-csr-04  draft-ietf-dhc-csr-03  draft-ietf-dhc-csr-02  draft-ietf-dhc-csr-01  draft-ietf-dhc-csr-00   RFC 3442  draft-ietf-dhc-csr-07  draft-ietf-dhc-csr-06  draft-ietf-dhc-csr-05  draft-ietf-dhc-csr-04  draft-ietf-dhc-csr-03  draft-ietf-dhc-csr-02  draft-ietf-dhc-csr-01  draft-ietf-dhc-csr-00   Side-by-side  Inline |
|  | Authors |  | [Ted Lemon](/person/mellon%40fugue.com "Datatracker profile of Ted Lemon") , [Stuart Cheshire](/person/cheshire%40apple.com "Datatracker profile of Stuart Cheshire") , [Bernie Volz](/person/bevolz%40gmail.com "Datatracker profile of Bernie Volz")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc3442.txt) [html](https://www.rfc-editor.org/rfc/rfc3442.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc3442.txt.pdf) [bibtex](/doc/rfc3442/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/dhcwg/?q=rfc3442 OR %22draft-ietf-dhc-csr%22) |
|  |  |  | [Report a bug](https://github.com/ietf-tools/datatracker/issues/new/choose) |

```
Network Working Group                                           T. Lemon
Request for Comments: 3442                                 Nominum, Inc.
Updates: [2132](/doc/html/rfc2132)                                                S. Cheshire
Category: Standards Track                           Apple Computer, Inc.
                                                                 B. Volz
                                                                Ericsson
                                                           December 2002

                 The Classless Static Route Option for
          Dynamic Host Configuration Protocol (DHCP) version 4

Status of this Memo

   This document specifies an Internet standards track protocol for the
   Internet community, and requests discussion and suggestions for
   improvements.  Please refer to the current edition of the "Internet
   Official Protocol Standards" (STD 1) for the standardization state
   and status of this protocol.  Distribution of this memo is unlimited.

Copyright Notice

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

Abstract

   This document defines a new Dynamic Host Configuration Protocol
   (DHCP) option which is passed from the DHCP Server to the DHCP Client
   to configure a list of static routes in the client.  The network
   destinations in these routes are classless - each routing table entry
   includes a subnet mask.

Introduction

   This option obsoletes the Static Route option (option 33) defined in
   [RFC 2132](/doc/html/rfc2132) [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")].

   The IP protocol [[1](#ref-1 "\"Internet Protocol\"")] uses routers to transmit packets from hosts
   connected to one IP subnet to hosts connected to a different IP
   subnet.  When an IP host (the source host) wishes to transmit a
   packet to another IP host (the destination), it consults its routing
   table to determine the IP address of the router that should be used
   to forward the packet to the destination host.

   The routing table on an IP host can be maintained in a variety of
   ways - using a routing information protocol such as RIP [[8](#ref-8 "\"Routing Information Protocol\"")], ICMP
   router discovery [[6](#ref-6 "\"Internet Control Message Protocol\""),[9](#ref-9 "\"ICMP Router Discovery Messages\"")] or using the DHCP Router option, defined in
   [RFC 2132](/doc/html/rfc2132) [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")].

Lemon, et. al.              Standards Track                     [Page 1]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   In a network that already provides DHCP service, using DHCP to update
   the routing table on a DHCP client has several virtues.  It is
   efficient, since it makes use of messages that would have been sent
   anyway.  It is convenient - the DHCP server configuration is already
   being maintained, so maintaining routing information, at least on a
   relatively stable network, requires little extra work.  If DHCP
   service is already in use, no additional infrastructure need be
   deployed.

   The DHCP protocol as defined in [RFC 2131](/doc/html/rfc2131) [[3](#ref-3 "\"Dynamic Host Configuration Protocol\"")] and the options defined
   in [RFC 2132](/doc/html/rfc2132) [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")] only provide a mechanism for installing a default
   route or installing a table of classful routes.  Classful routes are
   routes whose subnet mask is implicit in the subnet number - see
   [section 3.2](#section-3.2) of STD 5, [RFC 791](/doc/html/rfc791) [[1](#ref-1 "\"Internet Protocol\"")] for details on classful routing.

   Classful routing is no longer in common use, so the DHCP Static Route
   option is no longer useful.  Currently, classless routing [[7](#ref-7 "\"Internet Standard Subnetting Procedure\""), [10](#ref-10 "\"Variable Length Subnet Table For IPv4\"")] is
   the most commonly-deployed form of routing on the Internet.  In
   classless routing, IP addresses consist of a network number (the
   combination of the network number and subnet number described in [RFC](/doc/html/rfc950)
   [950](/doc/html/rfc950) [[7](#ref-7 "\"Internet Standard Subnetting Procedure\"")]) and a host number.

   In classful IP, the network number and host number are derived from
   the IP address using a bitmask whose value is determined by the first
   few bits of the IP address.  In classless IP, the network number and
   host number are derived from the IP address using a separate
   quantity, the subnet mask.  In order to determine the network to
   which a given route applies, an IP host must know both the network
   number AND the subnet mask for that network.

   The Static Routes option (option 33) does not provide a subnet mask
   for each route - it is assumed that the subnet mask is implicit in
   whatever network number is specified in each route entry.  The
   Classless Static Routes option does provide a subnet mask for each
   entry, so that the subnet mask can be other than what would be
   determined using the algorithm specified in STD 5, [RFC 791](/doc/html/rfc791) [[1](#ref-1 "\"Internet Protocol\"")] and
   STD 5, [RFC 950](/doc/html/rfc950) [[7](#ref-7 "\"Internet Standard Subnetting Procedure\"")].

Definitions

   The key words "MUST", "MUST NOT", "REQUIRED", "SHALL", "SHALL NOT",
   "SHOULD", "SHOULD NOT", "RECOMMENDED", "MAY" and "OPTIONAL" in this
   document are to be interpreted as described in [BCP 14](/doc/html/bcp14), [RFC 2119](/doc/html/rfc2119) [[2](#ref-2 "\"Key words for use in RFCs to Indicate Requirement Levels\"")].

Lemon, et. al.              Standards Track                     [Page 2]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   This document also uses the following terms:

      "DHCP client"

         DHCP client or "client" is an Internet host using DHCP to
         obtain configuration parameters such as a network address.

      "DHCP server"

         A DHCP server or "server" is an Internet host that returns
         configuration parameters to DHCP clients.

      "link"

         Any set of network attachment points that will all receive a
         link-layer broadcast sent on any one of the attachment points.
         This term is used in DHCP because in some cases more than one
         IP subnet may be configured on a link.  DHCP uses a local-
         network (all-ones) broadcast, which is not subnet-specific, and
         will therefore reach all nodes connected to the link,
         regardless of the IP subnet or subnets on which they are
         configured.

         A "link" is sometimes referred to as a broadcast domain or
         physical network segment.

Classless Route Option Format

   The code for this option is 121, and its minimum length is 5 bytes.
   This option can contain one or more static routes, each of which
   consists of a destination descriptor and the IP address of the router
   that should be used to reach that destination.

    Code Len Destination 1    Router 1
   +-----+---+----+-----+----+----+----+----+----+
   | 121 | n | d1 | ... | dN | r1 | r2 | r3 | r4 |
   +-----+---+----+-----+----+----+----+----+----+

    Destination 2       Router 2
   +----+-----+----+----+----+----+----+
   | d1 | ... | dN | r1 | r2 | r3 | r4 |
   +----+-----+----+----+----+----+----+

   In the above example, two static routes are specified.

Lemon, et. al.              Standards Track                     [Page 3]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   Destination descriptors describe the IP subnet number and subnet mask
   of a particular destination using a compact encoding.  This encoding
   consists of one octet describing the width of the subnet mask,
   followed by all the significant octets of the subnet number.

   The width of the subnet mask describes the number of one bits in the
   mask, so for example a subnet with a subnet number of 10.0.127.0 and
   a netmask of 255.255.255.0 would have a subnet mask width of 24.

   The significant portion of the subnet number is simply all of the
   octets of the subnet number where the corresponding octet in the
   subnet mask is non-zero.  The number of significant octets is the
   width of the subnet mask divided by eight, rounding up, as shown in
   the following table:

        Width of subnet mask     Number of significant octets
                     0                     0
                  1- 8                     1
                  9-16                     2
                 17-24                     3
                 25-32                     4

   The following table contains some examples of how various subnet
   number/mask combinations can be encoded:

   Subnet number   Subnet mask      Destination descriptor
   0               0                0
   10.0.0.0        255.0.0.0        8.10
   10.0.0.0        255.255.255.0    24.10.0.0
   10.17.0.0       255.255.0.0      16.10.17
   10.27.129.0     255.255.255.0    24.10.27.129
   10.229.0.128    255.255.255.128  25.10.229.0.128
   10.198.122.47   255.255.255.255  32.10.198.122.47

Local Subnet Routes

   In some cases more than one IP subnet may be configured on a link.
   In such cases, a host whose IP address is in one IP subnet in the
   link could communicate directly with a host whose IP address is in a
   different IP subnet on the same link.  In cases where a client is
   being assigned an IP address on an IP subnet on such a link, for each
   IP subnet in the link other than the IP subnet on which the client
   has been assigned the DHCP server MAY be configured to specify a
   router IP address of 0.0.0.0.

Lemon, et. al.              Standards Track                     [Page 4]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   For example, consider the case where there are three IP subnets
   configured on a link: 10.0.0/24, 192.168.0/24, 10.0.21/24.  If the
   client is assigned an IP address of 10.0.21.17, then the server could
   include a route with a destination of 10.0.0/24 and a router address
   of 0.0.0.0, and also a route with a destination of 192.168.0/24 and a
   router address of 0.0.0.0.

   A DHCP client whose underlying TCP/IP stack does not provide this
   capability MUST ignore routes in the Classless Static Routes option
   whose router IP address is 0.0.0.0.  Please note that the behavior
   described here only applies to the Classless Static Routes option,
   not to the Static Routes option nor the Router option.

DHCP Client Behavior

   DHCP clients that do not support this option MUST ignore it if it is
   received from a DHCP server.  DHCP clients that support this option
   MUST install the routes specified in the option, except as specified
   in the Local Subnet Routes section.  DHCP clients that support this
   option MUST NOT install the routes specified in the Static Routes
   option (option code 33) if both a Static Routes option and the
   Classless Static Routes option are provided.

   DHCP clients that support this option and that send a DHCP Parameter
   Request List option MUST request both this option and the Router
   option [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")] in the DHCP Parameter Request List.

   DHCP clients that support this option and send a parameter request
   list MAY also request the Static Routes option, for compatibility
   with older servers that don't support Classless Static Routes.  The
   Classless Static Routes option code MUST appear in the parameter
   request list prior to both the Router option code and the Static
   Routes option code, if present.

   If the DHCP server returns both a Classless Static Routes option and
   a Router option, the DHCP client MUST ignore the Router option.

   Similarly, if the DHCP server returns both a Classless Static Routes
   option and a Static Routes option, the DHCP client MUST ignore the
   Static Routes option.

   After deriving a subnet number and subnet mask from each destination
   descriptor, the DHCP client MUST zero any bits in the subnet number
   where the corresponding bit in the mask is zero. In other words, the
   subnet number installed in the routing table is the logical AND of
   the subnet number and subnet mask given in the Classless Static
   Routes option. For example, if the server sends a route with a
   destination of 129.210.177.132 (hexadecimal 81D4B184) and a subnet

Lemon, et. al.              Standards Track                     [Page 5]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   mask of 255.255.255.128 (hexadecimal FFFFFF80), the client will
   install a route with a destination of 129.210.177.128 (hexadecimal
   81D4B180).

Requirements to Avoid Sizing Constraints

   Because a full routing table can be quite large, the standard 576
   octet maximum size for a DHCP message may be too short to contain
   some legitimate Classless Static Route options.  Because of this,
   clients implementing the Classless Static Route option SHOULD send a
   Maximum DHCP Message Size [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")] option if the DHCP client's TCP/IP
   stack is capable of receiving larger IP datagrams.  In this case, the
   client SHOULD set the value of this option to at least the MTU of the
   interface that the client is configuring.  The client MAY set the
   value of this option higher, up to the size of the largest UDP packet
   it is prepared to accept.  (Note that the value specified in the
   Maximum DHCP Message Size option is the total maximum packet size,
   including IP and UDP headers.)

   DHCP clients requesting this option, and DHCP servers sending this
   option, MUST implement DHCP option concatenation [[5](#ref-5 "\"Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)\"")].  In the
   terminology of [RFC 3396](/doc/html/rfc3396) [[5](#ref-5 "\"Encoding Long Options in the Dynamic Host Configuration Protocol (DHCPv4)\"")], the Classless Static Route Option is a
   concatenation-requiring option.

DHCP Server Administrator Responsibilities

   Many clients may not implement the Classless Static Routes option.
   DHCP server administrators should therefore configure their DHCP
   servers to send both a Router option and a Classless Static Routes
   option, and should specify the default router(s) both in the Router
   option and in the Classless Static Routes option.

   When a DHCP client requests the Classless Static Routes option and
   also requests either or both of the Router option and the Static
   Routes option, and the DHCP server is sending Classless Static Routes
   options to that client, the server SHOULD NOT include the Router or
   Static Routes options.

Security Considerations

   Potential exposures to attack in the DHCP protocol are discussed in
   [section 7](#section-7) of the DHCP protocol specification [[3](#ref-3 "\"Dynamic Host Configuration Protocol\"")] and in
   Authentication for DHCP Messages [[11](#ref-11 "\"Authentication for DHCP Messages\"")].

   The Classless Static Routes option can be used to misdirect network
   traffic by providing incorrect IP addresses for routers.  This can be
   either a Denial of Service attack, where the router IP address given
   is simply invalid, or can be used to set up a man-in-the-middle

Lemon, et. al.              Standards Track                     [Page 6]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

   attack by providing the IP address of a potential snooper.  This is
   not a new problem - the existing Router and Static Routes options
   defined in [RFC 2132](/doc/html/rfc2132) [[4](#ref-4 "\"DHCP Options and BOOTP Vendor Extensions\"")] exhibit the same vulnerability.

IANA Considerations

   This DHCP option has been allocated the option code 121 in the list
   of DHCP option codes that the IANA maintains.

Normative References

   [1]  Postel, J., "Internet Protocol", STD 5, [RFC 791](/doc/html/rfc791), September 1981.

   [2]  Bradner, S., "Key words for use in RFCs to Indicate Requirement
        Levels", [BCP 14](/doc/html/bcp14), [RFC 2119](/doc/html/rfc2119), March 1997.

   [3]  Droms, R., "Dynamic Host Configuration Protocol", [RFC 2131](/doc/html/rfc2131),
        March 1997.

   [4]  Alexander, S. and R. Droms, "DHCP Options and BOOTP Vendor
        Extensions", [RFC 2132](/doc/html/rfc2132), March 1997.

   [5]  Lemon, T. and S. Cheshire, "Encoding Long Options in the Dynamic
        Host Configuration Protocol (DHCPv4)", [RFC 3396](/doc/html/rfc3396), November 2002.

Informative References

   [6]  Postel, J., "Internet Control Message Protocol", STD 5, [RFC 792](/doc/html/rfc792),
        September 1981.

   [7]  Mogul, J. and J. Postel, "Internet Standard Subnetting
        Procedure", STD 5, [RFC 950](/doc/html/rfc950), August 1985.

   [8]  Hedrick, C., "Routing Information Protocol", [RFC 1058](/doc/html/rfc1058), June
        1988.

   [9]  Deering, S., "ICMP Router Discovery Messages", [RFC 1256](/doc/html/rfc1256),
        September 1991.

   [10] Pummill, T. and B. Manning, "Variable Length Subnet Table For
        IPv4", [RFC 1878](/doc/html/rfc1878), December 1995.

   [11] Droms, R. and W. Arbaugh, "Authentication for DHCP Messages",
        [RFC 3118](/doc/html/rfc3118), June 2001.

Lemon, et. al.              Standards Track                     [Page 7]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

Intellectual Property Statement

   The IETF takes no position regarding the validity or scope of any
   intellectual property or other rights that might be claimed to
   pertain to the implementation or use of the technology described in
   this document or the extent to which any license under such rights
   might or might not be available; neither does it represent that it
   has made any effort to identify any such rights.  Information on the
   IETF's procedures with respect to rights in standards-track and
   standards-related documentation can be found in [BCP-11](/doc/html/bcp11).  Copies of
   claims of rights made available for publication and any assurances of
   licenses to be made available, or the result of an attempt made to
   obtain a general license or permission for the use of such
   proprietary rights by implementors or users of this specification can
   be obtained from the IETF Secretariat.

   The IETF invites any interested party to bring to its attention any
   copyrights, patents or patent applications, or other proprietary
   rights which may cover technology that may be required to practice
   this standard.  Please address the information to the IETF Executive
   Director.

Authors' Addresses

   Ted Lemon
   Nominum, Inc.
   2385 Bay Road
   Redwood City, CA 94063

   EMail: Ted.Lemon@nominum.com

   Stuart Cheshire
   Apple Computer, Inc.
   1 Infinite Loop
   Cupertino
   California 95014
   USA

   Phone: +1 408 974 3207
   EMail: rfc@stuartcheshire.org

   Bernie Volz
   Ericsson
   959 Concord Street
   Framingham, MA, 01701

   Phone: +1 508 875 3162
   EMail: bernie.volz@ericsson.com

Lemon, et. al.              Standards Track                     [Page 8]
```

---

```

[RFC 3442](/doc/html/rfc3442)        Classless Static Route Option for DHCPv4   December 2002

Full Copyright Statement

   Copyright (C) The Internet Society (2002).  All Rights Reserved.

   This document and translations of it may be copied and furnished to
   others, and derivative works that comment on or otherwise explain it
   or assist in its implementation may be prepared, copied, published
   and distributed, in whole or in part, without restriction of any
   kind, provided that the above copyright notice and this paragraph are
   included on all such copies and derivative works.  However, this
   document itself may not be modified in any way, such as by removing
   the copyright notice or references to the Internet Society or other
   Internet organizations, except as needed for the purpose of
   developing Internet standards in which case the procedures for
   copyrights defined in the Internet Standards process must be
   followed, or as required to translate it into languages other than
   English.

   The limited permissions granted above are perpetual and will not be
   revoked by the Internet Society or its successors or assigns.

   This document and the information contained herein is provided on an
   "AS IS" basis and THE INTERNET SOCIETY AND THE INTERNET ENGINEERING
   TASK FORCE DISCLAIMS ALL WARRANTIES, EXPRESS OR IMPLIED, INCLUDING
   BUT NOT LIMITED TO ANY WARRANTY THAT THE USE OF THE INFORMATION
   HEREIN WILL NOT INFRINGE ANY RIGHTS OR ANY IMPLIED WARRANTIES OF
   MERCHANTABILITY OR FITNESS FOR A PARTICULAR PURPOSE.

Acknowledgement

   Funding for the RFC Editor function is currently provided by the
   Internet Society.

Lemon, et. al.              Standards Track                     [Page 9]

```

[Datatracker](/doc/rfc3442/)

RFC 3442

RFC
- Proposed Standard

* Info
* Contents
* Prefs

| Document | Document type |  | RFC - Proposed Standard  December 2002  [Report errata](https://www.rfc-editor.org/errata.php#reportnew "Click to report an error in the document.") Updates [RFC 2132](/doc/html/rfc2132 "DHCP Options and BOOTP Vendor Extensions") Was [draft-ietf-dhc-csr](/doc/draft-ietf-dhc-csr/07/) ([dhc WG](/wg/dhc/about/)) |
| --- | --- | --- | --- |
|  | Select version |  | * [07](/doc/html/draft-ietf-dhc-csr-07) * [RFC 3442](/doc/html/rfc3442) |
|  | Compare versions |  | RFC 3442  draft-ietf-dhc-csr-07  draft-ietf-dhc-csr-06  draft-ietf-dhc-csr-05  draft-ietf-dhc-csr-04  draft-ietf-dhc-csr-03  draft-ietf-dhc-csr-02  draft-ietf-dhc-csr-01  draft-ietf-dhc-csr-00   RFC 3442  draft-ietf-dhc-csr-07  draft-ietf-dhc-csr-06  draft-ietf-dhc-csr-05  draft-ietf-dhc-csr-04  draft-ietf-dhc-csr-03  draft-ietf-dhc-csr-02  draft-ietf-dhc-csr-01  draft-ietf-dhc-csr-00   Side-by-side  Inline |
|  | Authors |  | [Ted Lemon](/person/mellon%40fugue.com "Datatracker profile of Ted Lemon") , [Stuart Cheshire](/person/cheshire%40apple.com "Datatracker profile of Stuart Cheshire") , [Bernie Volz](/person/bevolz%40gmail.com "Datatracker profile of Bernie Volz")   Email authors |
|  | RFC stream |  | IETF Logo IETF Logo |
|  | Other formats |  | [txt](https://www.rfc-editor.org/rfc/rfc3442.txt) [html](https://www.rfc-editor.org/rfc/rfc3442.html) [pdf](https://www.rfc-editor.org/rfc/pdfrfc/rfc3442.txt.pdf) [bibtex](/doc/rfc3442/bibtex/) |
|  | Additional resources |  | [Mailing list discussion](https://mailarchive.ietf.org/arch/browse/dhcwg/?q=rfc3442 OR %22draft-ietf-dhc-csr%22) |

[Report a datatracker bug](https://github.com/ietf-tools/datatracker/issues/new/choose)

Show sidebar by default

Yes

No

Tab to show by default

Info

Contents

HTMLization configuration

HTMLize the plaintext

Plaintextify the HTML

Maximum font size

Page dependencies

Inline

Reference

Citation links

 Go to reference section

Go to linked document

![](//analytics.ietf.org/piwik.php?idsite=7)



=== Content from arstechnica.com_df63257b_20250111_135236.html ===


[Skip to content](#main)

[Ars Technica home](https://arstechnica.com/)

Sections

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

* [Feature](/features/)
* [Reviews](/reviews/)
* [Store](/store/)

* [AI](https://arstechnica.com/ai/)
* [Biz & IT](https://arstechnica.com/information-technology/)
* [Cars](https://arstechnica.com/cars/)
* [Culture](https://arstechnica.com/culture/)
* [Gaming](https://arstechnica.com/gaming/)
* [Health](https://arstechnica.com/health/)
* [Policy](https://arstechnica.com/tech-policy/)
* [Science](https://arstechnica.com/science/)
* [Security](https://arstechnica.com/security/)
* [Space](https://arstechnica.com/space/)
* [Tech](https://arstechnica.com/gadgets/)

[Forum](/civis/)

[Subscribe](/store/product/subscriptions/)

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Pin to story

Theme

* HyperLight
* Day & Night
* Dark
* System

Search dialog...

Sign In

Sign in dialog...

Sign in

VPN BUSTER

# Novel attack against virtually all VPN apps neuters their entire purpose

TunnelVision vulnerability has existed since 2002 and may already be known to attackers.

[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
–
May 6, 2024 4:35 pm

| [264](https://arstechnica.com/security/2024/05/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose/#comments "264 comments")

[![](https://cdn.arstechnica.net/wp-content/uploads/2024/05/vpn-tunnel.jpg)](https://cdn.arstechnica.net/wp-content/uploads/2024/05/vpn-tunnel.jpg)

Credit:
Getty Images

Credit:
Getty Images

Text
settings

Story text

Size
Small
Standard
Large

Width
\*

Standard
Wide

Links
Standard
Orange

\* Subscribers only

  [Learn more](/store/product/subscriptions/)

Minimize to nav

Researchers have devised an attack against nearly all virtual private network applications that forces them to send and receive some or all traffic outside of the encrypted tunnel designed to protect it from snooping or tampering.

TunnelVision, as the researchers have named their attack, largely negates the entire purpose and selling point of VPNs, which is to encapsulate incoming and outgoing Internet traffic in an encrypted tunnel and to cloak the user’s IP address. The researchers believe it affects all VPN applications when they’re connected to a hostile network and that there are no ways to prevent such attacks except when the user's VPN runs on Linux or Android. They also said their attack technique may have been possible since 2002 and may already have been discovered and used in the wild since then.

## Reading, dropping, or modifying VPN traffic

The effect of TunnelVision is “the victim's traffic is now decloaked and being routed through the attacker directly,” a [video demonstration](https://www.youtube.com/watch?v=ajsLmZia6UU) explained. “The attacker can read, drop or modify the leaked traffic and the victim maintains their connection to both the VPN and the Internet.”

TunnelVision - CVE-2024-3661 - Decloaking Full and Split Tunnel VPNs - Leviathan Security Group.

The attack works by manipulating the [DHCP server](https://en.wikipedia.org/wiki/Dynamic_Host_Configuration_Protocol) that allocates IP addresses to devices trying to connect to the local network. A setting known as [option 121](https://datatracker.ietf.org/doc/html/rfc3442) allows the DHCP server to override default routing rules that send VPN traffic through a local IP address that initiates the encrypted tunnel. By using option 121 to route VPN traffic through the DHCP server, the attack diverts the data to the DHCP server itself. Researchers from Leviathan Security explained:

> Our technique is to run a DHCP server on the same network as a targeted VPN user and to also set our DHCP configuration to use itself as a gateway. When the traffic hits our gateway, we use traffic forwarding rules on the DHCP server to pass traffic through to a legitimate gateway while we snoop on it.
>
> We use DHCP option 121 to set a route on the VPN user’s routing table. The route we set is arbitrary and we can also set multiple routes if needed. By pushing routes that are more specific than a /0 CIDR range that most VPNs use, we can make routing rules that have a higher priority than the routes for the virtual interface the VPN creates. We can set multiple /1 routes to recreate the 0.0.0.0/0 all traffic rule set by most VPNs.
>
> Pushing a route also means that the network traffic will be sent over the same interface as the DHCP server instead of the virtual network interface. This is intended functionality that isn’t clearly stated in the RFC. Therefore, for the routes we push, it is never encrypted by the VPN’s virtual interface but instead transmitted by the network interface that is talking to the DHCP server. As an attacker, we can select which IP addresses go over the tunnel and which addresses go over the network interface talking to our DHCP server.
>
> [![](https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic.png)](https://cdn.arstechnica.net/wp-content/uploads/2024/05/TunnelVision_Diagram_DHCP_121_Reroute_Traffic.png)
> A malicious DHCP option 121 route that causes traffic to never be encrypted by the VPN process.
> Credit:
> Leviathan Security
>
>
>
>
>
> A malicious DHCP option 121 route that causes traffic to never be encrypted by the VPN process.
> Credit:
> Leviathan Security
>
>
>
>
>
>
> We now have traffic being transmitted outside the VPN’s encrypted tunnel. This technique can also be used against an already established VPN connection once the VPN user’s host needs to renew a lease from our DHCP server. We can artificially create that scenario by setting a short lease time in the DHCP lease, so the user updates their routing table more frequently. In addition, the VPN control channel is still intact because it already uses the physical interface for its communication. In our testing, the VPN always continued to report as connected, and the kill switch was never engaged to drop our VPN connection.

The attack can most effectively be carried out by a person who has administrative control over the network the target is connecting to. In that scenario, the attacker configures the DHCP server to use option 121. It’s also possible for people who can connect to the network as an unprivileged user to perform the attack by setting up their own rogue DHCP server.

The attack allows some or all traffic to be routed through the unencrypted tunnel. In either case, the VPN application will report that all data is being sent through the protected connection. Any traffic that’s diverted away from this tunnel will not be encrypted by the VPN and the Internet IP address viewable by the remote user will belong to the network the VPN user is connected to, rather than one designated by the VPN app.

Interestingly, Android is the only operating system that fully immunizes VPN apps from the attack because it doesn't implement option 121. For all other OSes, there are no complete fixes. When apps run on Linux there’s a setting that minimizes the effects, but even then TunnelVision can be used to exploit a [side channel](https://en.wikipedia.org/wiki/Side-channel_attack) that can be used to de-anonymize destination traffic and perform targeted denial-of-service attacks. Network firewalls can also be configured to deny inbound and outbound traffic to and from the physical interface. This remedy is problematic for two reasons: (1) a VPN user connecting to an untrusted network has no ability to control the firewall and (2) it opens the same side channel present with the Linux mitigation.

The most effective fixes are to run the VPN inside of a virtual machine whose network adapter isn’t in bridged mode or to connect the VPN to the Internet through the Wi-Fi network of a cellular device. The research, from Leviathan Security researchers Lizzie Moratti and Dani Cronce, is available [here](https://www.leviathansecurity.com/blog/tunnelvision).

Listing image:
Getty Images

[![Photo of Dan Goodin](/wp-content/uploads/2018/10/Dang.jpg)](https://arstechnica.com/author/dan-goodin/)
[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
Senior Security Editor

[Dan Goodin](https://arstechnica.com/author/dan-goodin/)
Senior Security Editor

Dan Goodin is Senior Security Editor at Ars Technica, where he oversees coverage of malware, computer espionage, botnets, hardware hacking, encryption, and passwords. In his spare time, he enjoys gardening, cooking, and following the independent music scene. Dan is based in San Francisco. Follow him at [here](https://infosec.exchange/%40dangoodin) on Mastodon and [here](https://bsky.app/profile/dangoodin.bsky.social) on Bluesky. Contact him on Signal at DanArs.82.

[264 Comments](https://arstechnica.com/security/2024/05/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose/#comments "264 comments")

Staff Picks

m
[mktogeek](https://arstechnica.com/civis/members/mktogeek.303197/)

I think it's important to clarify the use of the term "VPN" here. This affects "VPNs" used for *anonymizing internet traffic* or for geofence defeating on streaming services and such. It should *not* impact VPNs used to access private networks via the Internet.

[May 6, 2024 at 8:59 pm](https://arstechnica.com/civis/posts/42807583/)

Comments

[Forum view](https://arstechnica.com/civis/threads/novel-attack-against-virtually-all-vpn-apps-neuters-their-entire-purpose.1500526/)

![Loading](https://arstechnica.com/wp-content/themes/ars-v9/public/images/firework-loader.75ab30.gif)

[Prev story](https://arstechnica.com/gadgets/2024/05/google-fit-apis-get-shut-down-in-2025-might-break-fitness-devices/ "Go to: Google Fit APIs get shut down in 2025, might break fitness devices")

[Next story](https://arstechnica.com/gaming/2024/05/hackers-discover-how-to-reprogram-nes-tetris-from-within-the-game/ "Go to: Hackers discover how to reprogram NES <em>Tetris</em> from within the game")

Most Read

1. [![Listing image for first story in Most Read: Judge ends man’s 11-year quest to dig up landfill and recover $765M in bitcoin](https://cdn.arstechnica.net/wp-content/uploads/2025/01/newport-landfill-768x432-1736530527.jpg)](https://arstechnica.com/tech-policy/2025/01/judge-ends-mans-11-year-quest-to-dig-up-landfill-and-recover-765m-in-bitcoin/)

   1.
   [Judge ends man’s 11-year quest to dig up landfill and recover $765M in bitcoin](https://arstechnica.com/tech-policy/2025/01/judge-ends-mans-11-year-quest-to-dig-up-landfill-and-recover-765m-in-bitcoin/)
2. 2.
   [A glowing ring of metal fell to Earth, and no one has any idea what it is](https://arstechnica.com/space/2025/01/a-glowing-ring-of-metal-fell-to-earth-and-no-one-has-any-idea-what-it-is/)
3. 3.
   [A taller, heavier, smarter version of SpaceX’s Starship is almost ready to fly](https://arstechnica.com/space/2025/01/a-taller-heavier-smarter-version-of-spacexs-starship-is-almost-ready-to-fly/)
4. 4.
   [German router maker is latest company to inadvertently clarify the LGPL license](https://arstechnica.com/gadgets/2025/01/suing-wi-fi-router-makers-remains-a-necessary-part-of-open-source-license-law/)
5. 5.
   [Man turns irreversibly gray from an unidentified silver exposure](https://arstechnica.com/health/2025/01/man-turns-irreversibly-gray-from-an-unidentified-silver-exposure/)

Customize

Ars Technica has been separating the signal from
the noise for over 25 years. With our unique combination of
technical savvy and wide-ranging interest in the technological arts
and sciences, Ars is the trusted source in a sea of information. After
all, you don’t need to know everything, only what’s important.

More
from Ars

* [About Us](https://arstechnica.com/about-us/)
* [Staff Directory](https://arstechnica.com/staff-directory/)
* [Newsletters](https://arstechnica.com/newsletters/)
* [Ars Videos](https://arstechnica.com/video/)
* [General FAQ](https://arstechnica.com/general-faq/)
* [RSS Feeds](https://arstechnica.com/rss-feeds/)

Contact

* [Contact us](https://arstechnica.com/contact-us/)
* [Advertise with us](https://www.condenast.com/brands/ars-technica)
* [Reprints](https://arstechnica.com/reprints/)

Do Not Sell My Personal
Information

© 2025 Condé Nast. All rights reserved. Use of and/or
registration on any portion of this site constitutes acceptance of our [User Agreement](https://www.condenast.com/user-agreement/) and
[Privacy Policy and
Cookie Statement](https://www.condenast.com/privacy-policy/) and [Ars
Technica Addendum](/amendment-to-conde-nast-user-agreement-privacy-policy/) and [Your
California Privacy Rights](https://www.condenast.com/privacy-policy/#california). Ars Technica may earn compensation on
sales from links on this site. [Read our
affiliate link policy](/affiliate-link-policy/). The material on this site may not be
reproduced, distributed, transmitted, cached or otherwise used, except
with the prior written permission of Condé Nast. [Ad
Choices](https://www.aboutads.info/)



=== Content from security.paloaltonetworks.com_76381ae6_20250111_135244.html ===


* [Get support](https://support.paloaltonetworks.com/support)
* [Security advisories](/)
* [Report vulnerabilities](/report)
* [Bug Bounty](/scope)
* [Subscribe](https://support.paloaltonetworks.com/SupportAccount/Preferences)
* [RSS feed](/rss.xml)
[Palo Alto Networks Security Advisories](/) /
CVE-2024-3661
## CVE-2024-3661 Impact of TunnelVision Vulnerability

Urgency
REDUCED
047910
[Severity
2.1 ·
LOW](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:A/AC:H/AT:P/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N/AU:Y/R:A/V:D/RE:M/U:Green "CVSS-BT: CVSS:4.0/AV:A/AC:H/AT:P/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N/AU:Y/R:A/V:D/RE:M/U:Green")Exploit Maturity
**N/A**Response Effort
**MODERATE**Recovery
**AUTOMATIC**Value Density
**DIFFUSE**Attack Vector
**ADJACENT**Attack Complexity
**HIGH**Attack Requirements
**PRESENT**Automatable
**YES**User Interaction
**PASSIVE**Product Confidentiality
**LOW**Product Integrity
**LOW**Product Availability
**LOW**Privileges Required
**NONE**Subsequent Confidentiality
**NONE**Subsequent Integrity
**NONE**Subsequent Availability
**NONE**[CVE](https://www.cve.org/CVERecord?id=CVE-2024-3661 "See CVE.org record")
[JSON](/json/CVE-2024-3661 "Download the information in this advisory in CVE-JSON format")
[CSAF](/csaf/CVE-2024-3661 "Download the information in this advisory in CSAF format")

 Published
**2024-05-16** Updated
**2024-05-16**Discovered
**externally**
### Description

The Palo Alto Networks Product Security Assurance team has evaluated the TunnelVision vulnerability as it relates to our products. This issue allows an attacker with the ability to send DHCP messages on the same local area network, such as a rogue Wi-Fi network, to leak traffic outside of the GlobalProtect tunnel, allowing the attacker to read, disrupt, or possibly modify network traffic that was expected to be protected by the GlobalProtect tunnel. However, this attack does not enable the attacker to decrypt HTTPS or other encrypted traffic.

Cloud NGFW, PAN-OS, and Prisma Access do not process DHCP option 121 and are therefore unaffected.

GlobalProtect app on Windows and macOS systems with Endpoint Traffic Policy Enforcement enabled are unaffected. Endpoint Traffic Policy Enforcement is disabled by default.

GlobalProtect app on Linux is affected. A fix will be released in an upcoming release.

GlobalProtect app on iOS with IncludeAllNetworks set to 1 is unaffected.

GlobalProtect app on Android is unaffected since the Android DHCP client does not process DHCP option 121.

### Product Status

| Versions | Affected | Unaffected |
| Cloud NGFW | None | All |
| GlobalProtect App | All without Endpoint Traffic Policy Enforcement set to All Traffic on WindowsAll without Endpoint Traffic Policy Enforcement set to All Traffic on macOSAll on LinuxAll without IncludeAllNetworks set to 1 on iOSNone on Android | All with Endpoint Traffic Policy Enforcement set to All Traffic on WindowsAll with Endpoint Traffic Policy Enforcement set to All Traffic on macOSUpcoming major release on LinuxAll with IncludeAllNetworks set to 1 on iOSAll on Android |
| PAN-OS | None | All |
| Prisma Access | None | All |

### Required Configuration for Exposure

No special configuration is required to be affected by this issue.

### Severity: LOW, Suggested Urgency: REDUCED

CVSS-BT:
2.1 /
CVSS-B:
2.1 ([CVSS:4.0/AV:A/AC:H/AT:P/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N/AU:Y/R:A/V:D/RE:M/U:Green](https://www.first.org/cvss/calculator/4.0#CVSS:4.0/AV:A/AC:H/AT:P/PR:N/UI:P/VC:L/VI:L/VA:L/SC:N/SI:N/SA:N/AU:Y/R:A/V:D/RE:M/U:Green))

### Exploitation Status

Palo Alto Networks is not aware of any malicious exploitation of this issue in any of our products.

### Weakness Type

[CWE-501 Trust Boundary Violation](https://cwe.mitre.org/data/definitions/501 "More at https://cwe.mitre.org/data/definitions/501")

[CWE-306 Missing Authentication for Critical Function](https://cwe.mitre.org/data/definitions/306 "More at https://cwe.mitre.org/data/definitions/306")

### Solution

For Windows and macOS devices, ensure that Endpoint Traffic Policy Enforcement is set to All Traffic (Network → GlobalProtect Portals → <portal-config> → Agent → <agent-config> → App → Endpoint Traffic Policy Enforcement). Please see the following document for additional details: <https://docs.paloaltonetworks.com/globalprotect/6-0/globalprotect-app-new-features/new-features-released-in-gp-app/endpoint-traffic-policy-enforcement>.

For iOS devices, ensure that IncludeAllNetworks is set to 1 using mobile device management. For additional guidance, please see our mobile device management documentation at <https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/mobile-endpoint-management> and the Apple documentation at <https://developer.apple.com/documentation/devicemanagement/vpn/vpn>. To allow users to access their local network, ensure that ExcludeLocalNetwork is set to 1, so that the GlobalProtect app will route all local network traffic outside the tunnel.

Updates will be released for the GlobalProtect app on Linux in an upcoming major release.

### Workarounds and Mitigations

For the GlobalProtect app on Windows, macOS, and Linux, this attack can be mitigated by enabling the "No direct access to local network" feature in the Split Tunnel tab on the firewall. Detailed information can be found at:

* <https://docs.paloaltonetworks.com/pan-os/11-0/pan-os-web-interface-help/globalprotect/network-globalprotect-gateways/globalprotect-gateways-agent-tab/client-settings-tab>
* <https://docs.paloaltonetworks.com/prisma/prisma-access/3-0/prisma-access-panorama-admin/prisma-access-advanced-deployments/mobile-user-globalprotect-advanced-deployments/sinkhole-ipv6-traffic-from-mobile-users/configure-globalprotect-to-disable-direct-access-to-the-local-network>

Note that enabling "No direct access to local network" prevents end users from connecting to local LAN devices such as home printers, network storage, or streaming devices. You can configure exceptions for specific users, operating systems, source addresses, destination domains, and applications by following the instructions at:

* <https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/globalprotect-gateways/split-tunnel-traffic-on-globalprotect-gateways/configure-a-split-tunnel-based-on-the-access-route>
* <https://docs.paloaltonetworks.com/globalprotect/10-1/globalprotect-admin/globalprotect-gateways/split-tunnel-traffic-on-globalprotect-gateways/configure-a-split-tunnel-based-on-the-domain-and-application>

You can mitigate this attack for the GlobalProtect app on iOS devices by disabling Wi-Fi.

### Timeline

2024-05-16
Initial publication[Terms of use](https://www.paloaltonetworks.com/legal-notices/terms-of-use)[Privacy](https://www.paloaltonetworks.com/legal-notices/privacy)[Product Security Assurance and Vulnerability Disclosure Policy](https://paloaltonetworks.com/product-security-assurance)[Report vulnerabilities](/report)[Manage subscriptions](https://support.paloaltonetworks.com/SupportAccount/Preferences)© 2025 Palo Alto Networks, Inc. All rights reserved.

=== Content from www.leviathansecurity.com_ee0604b4_20250111_135247.html ===

[0](/cart)

[Skip to Content](#page)

[![Leviathan Security Group - Penetration Testing, Security Assessment, Risk Advisory](//images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png?format=1500w)](/)

[Services](/services)
[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Programs](/programs)
[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Research](/87134534-caab-4bdf-b4e2-a956a078f00a)
[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Company](/company)
[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

Open Menu
Close Menu

[![Leviathan Security Group - Penetration Testing, Security Assessment, Risk Advisory](//images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png?format=1500w)](/)

[Services](/services)
[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Programs](/programs)
[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Research](/87134534-caab-4bdf-b4e2-a956a078f00a)
[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Company](/company)
[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

Open Menu
Close Menu

[Folder:
Services](/services)

[Back](/)

[Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)

[Secure Code Review](/services/application-security/secure-code-review)

[Network Penetration Testing](/services/network-security/network-penetration-testing)

[Smart Device and IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security](/services/vendor-security-management)

[Risk Advisory Services](/#navheading)

[Virtual Chief Information Security Officer (VCISO)](/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

[Folder:
Programs](/programs)

[Back](/)

[Nest Device Access Security Assessment (SDM API)](/programs/google-nest-security-assessment)

[Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

[Shopify Plus Certified App Assessment](/shopify-plus-certified)

[Folder:
Research](/87134534-caab-4bdf-b4e2-a956a078f00a)

[Back](/)

[TunnelVision](/research/tunnelvision)

[Blog](/blog)

[Folder:
Company](/company)

[Back](/)

[Press Box](/press-box)

[Careers](/careers)

[About Us](/about-us)

[Privacy Policy](/privacy-policy)

[Contact Us](/contact)

# **Tunnel****Vision**

## **Decloaking Route-Based VPNs**

**CVE-2024-3661**

**Identified by Lizzie Moratti and Dani Cronce**

[Technical Details](/blog/tunnelvision)

[Video Demo](https://www.youtube.com/watch?v=ajsLmZia6UU)

[Advisory](https://tunnelvisionbug.com)

## **Unmasking** VPN Vulnerabilities

Virtual Private Networks (VPNs) are often touted as a shield against cyber threats, especially when connecting to untrusted networks like public Wi-Fi. However, recent revelations within the security industry have cast doubt on these claims. Over the years, researchers have uncovered small leaks in VPNs, primarily focusing on vulnerabilities in VPN servers. But what about the client-side traffic leaking on local networks?

Enter **TunnelVision**, a powerful technique that exposes VPN traffic even when users believe they are securely connected. Let’s delve into how TunnelVision works and its impact on VPN users.

## **How** **TunnelVision** **Works**

At its core, TunnelVision exploits the way computers handle multiple network connections. When you connect to a VPN, it becomes another network interface alongside your regular connections (like your home Wi-Fi or coffee shop network). These connections are governed by routing tables—rules that determine which network should handle your traffic.

Now imagine an attacker resides on the same local network as a VPN user. They are able to manipulate these routing rules, diverting traffic away from the VPN. This means that even though you appear connected to the VPN, your data may be flowing through other networks—completely bypassing the VPN’s protection.

In essence, TunnelVision achieves **decloaking**: revealing the traffic that should otherwise be protected.

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/b133703c-c26c-48f1-95b6-8967e4d41d98/16.png)

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/1cc753d1-670b-4ec4-9470-4543b777c5d2/18.png)

## **Aftermath**

The consequences are **significant**.

VPN users who rely on these services for protection on untrusted networks are just as vulnerable as if they weren’t using a VPN at all. TunnelVision undermines the very purpose of VPNs, leaving users exposed to potential attacks.

Stay informed and take precautions. Learn more about **TunnelVision** and protect your online privacy.

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/6422a021-f5df-4646-bf4b-7eb20704f55c/4.png)

Reach out by submiting the contact form below
**For media inquiries, please contact: PR@leviathansecurity.com**

Our team will schedule some time to answer any questions you may have about the services Leviathan provides.

All fields marked with \* are required

\* First Name:

\* Last Name:

\* Email:

Phone:

\* Company:

City:

State/Province:

\* Website:

Submit

## Frequently Asked **Questions**

### How was this found?

We researched VPN threat models for a project and produced methods to attack VPNs. The team’s idea proved to be a severe issue, and we suspected it affected the entirety of the VPN industry. That’s when we began research in earnest.

### Has this been exploited in the wild?

We have not seen evidence as of 5/6/2024 of exploitation in the wild. However, we believe this was possible as far back as 2002, so it’s possible someone besides us found TunnelVision but didn’t widely disclose or realize the severity.

In order to detect this, you would need to be reviewing DHCP network traffic and DHCP client logs. This might be possible retroactively.

### Haven’t routing table leaks in VPNs been known for years?

Correct, routing table issues have been known for years. This is why the privacy and anonymity communities discourage VPNs. Most issues found have been small and patchable leaks.

### How is this novel?

We have not seen any prior research using DHCP option 121 to inject routes and decloak VPNs, which is the novel part of our research. It also is not completely patchable in the same way smaller leaks have been (besides on Linux). We pointed to prior research on this topic related to routing table issues that have been known for years that we were able to find.

UPDATE: The purpose of this research was to test this technique against modern VPN providers to determine their vulnerability and to notify the wider public of this issue. This is why we agreed with CISA to file a CVE when we disclosed to them and why we decided to name the vulnerability.

After publication, we have received details about prior research into combining routing table behavior with option 121. These researchers showed that at least some people were aware of DHCP option 121’s effect on VPNs going back to at least 2015. Despite this, the research did not lead to wide deployment of mitigations nor the general public awareness of the decloaking behavior.

That said, we are grateful for the input of past researchers who explored the problem space. We will continue to credit our fellow security researchers who explored these issues.

Prior works referencing DHCP 121 route injection or VPN decloaking:

* 2015 [Hardening OpenVPN for Def Con](https://www.agwa.name/blog/post/hardening_openvpn_for_def_con%5D)
* 2016 [Samy Kamkar’s PoisonTap](https://github.com/samyk/poisontap)
* 2017 [Jomo’s Mastodon](https://mstdn.io/%40jomo/98981403329690455)
* 2023 [Lowend talk thread](https://lowendtalk.com/discussion/188857/a-rogue-dhcp-server-within-your-network-can-and-will-hijack-your-vpn-traffic)

### Wouldn’t exploiting this be obvious?

Not really. The VPN user shows as being connected to the VPN. Attackers can control which IPs they wish to decloak, so theoretically they could choose to not decloak leak checking IPs. They could also leak DNS IPs while forwarding the traffic so the VPN connection is intact, but they obtain information about the traffic in the tunnel.

In no circumstances did we observe a VPN server disconnecting us with kill switches or other features.

### Why are you saying the mitigation’s side-channel is so impactful?

When a mitigation is in place, an attacker can still obtain the destination you are talking to and the amount of traffic you are sending to that destination. Since most web traffic is encrypted with HTTPS, attackers can usually only determine the destination and protocol of the traffic anyway. This means the vulnerability that the mitigation introduces has nearly the same impact as decloaking.

The side-channel is also flexible in use:

1. The traffic can be checked against a predefined list of IP addresses.
2. The traffic can be selectively denied as a censorship mechanism.
3. The attacker can use IP space denial with binary search to determine all current connections in logarithmic time.

### Why is this so bad compared to other leaks?

VPN providers often claim that no one, not even a network administrator, is able to remove your VPN protections. They may state it as “securing you on an untrusted network.”

TunnelVision shows that a network administrator can completely remove VPN protections. To make matters worse, we’ve demonstrated that an attacker who is on the same network has ways to control DHCP. This is demonstrated in our [POC video](https://www.youtube.com/watch?v=ajsLmZia6UU).

### Don’t most networks have widespread adoption of DHCP snooping or other protections?

Most enterprise networks do. However, most people using VPNs are not connecting from an enterprise network. They are connecting from public networks or their home networks.

In addition, part of the VPN provider threat model is they can secure *any* untrusted network, including those who do not have these protections.

### Can you change the configuration of the DHCP server in the middle of a VPN session?

Yes. By setting a short DHCP lease length, an attacker can modify the configurations in the middle of a VPN session.

### Isn’t most web traffic encrypted with HTTPS anyways?

This is true. If HTTPS traffic is decloaked it is still not possible to view the encrypted contents of the packet. For unencrypted protocols, the packet’s payload is readable.

However, it is still possible to see the destination and the protocol of the packet. Normally, that information would be inside the VPN protocol’s payload and encrypted.

### Aren’t you going to be snooping on encrypted packets?

The packets will not be encrypted. DHCP option 121 will alter your routing table and send your traffic over a non-VPN interface, completely bypassing the encryption routine VPN application processes normally do. You can’t encrypt what you never receive.

Latest Content

[![3 Pillars of Security at Day 1 Start Ups - Risk]()](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[3 Pillars of Security at Day 1 Start Ups - Risk](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[Read More →](/blog/3-pillars-of-security-at-day-1-start-ups-risk)

Nov 13, 2024

[Risk Advisory](/blog?category=Risk+Advisory)

[![UEFI is the new BIOS]()](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

[UEFI is the new BIOS](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

Learn about UEFI reverse engineering and exploit development so that you too can build the skills necessary to find and exploit UEFI bugs, understand common UEFI vulnerabilities, and better secure the firmware security supply chain.

[Read More →](/blog/uefi-is-the-new-bios)

Sep 23, 2024

[Hardware Security](/blog?category=Hardware+Security), [Application Security](/blog?category=Application+Security)

[![The Unexpected Benefits of Threat Modeling]()](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

[The Unexpected Benefits of Threat Modeling](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

Threat modeling is a disciplined approach to technology design that identifies security threats and design constraints to prevent security flaws before they manifest in your platform.

[Read More →](/blog/the-unexpected-benefits-of-threat-modeling)

Aug 5, 2024

[Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Enterprise Security](/blog?category=Enterprise+Security), [Hardware Security](/blog?category=Hardware+Security)

[![Bypassing SSRF Filters Using r3dir]()](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

[Bypassing SSRF Filters Using r3dir](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

We demonstrate how to use the r3dir tool to bypass some SSRF filters. r3dir is a convenient redirection service made for SSRF filter bypasses.

[Read More →](/blog/bypassing-ssrf-filters-using-r3dir)

Jun 21, 2024

[Application Security](/blog?category=Application+Security)

[![CVE-2024-31735: LibEvent Library Memory Leak]()](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

[CVE-2024-31735: LibEvent Library Memory Leak](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

A memory leak in the LibEvent Library v2.1.12-stable allows an attacker to cause a denial of service (DoS).

[Read More →](/blog/cve-2024-31735-libevent-library-memory-leak)

Jun 6, 2024

[Application Security](/blog?category=Application+Security)

[![Vulnerability Research and the Importance of Supporting Young Talent]()](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

[Vulnerability Research and the Importance of Supporting Young Talent](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

This is a story with a happy ending where we were able to get back to the collaboration from the early open disclosure days, utilize modern practices to ensure responsible handling of the information, and allow a young person to make a positive contribution to infosec.

[Read More →](/blog/vulnerabilty-research-and-the-importance-of-supporting-young-talent)

Jun 4, 2024

[Enterprise Security](/blog?category=Enterprise+Security), [Application Security](/blog?category=Application+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory), [Hardware Security](/blog?category=Hardware+Security)

[![TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak]()](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

[TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

We discovered a fundamental design problem in VPNs and we're calling it TunnelVision. This problem lets someone see what you're doing online, even if you think you're safely using a VPN.

[Read More →](/blog/tunnelvision)

May 6, 2024

[Network Security](/blog?category=Network+Security)

[![Encoding Bitwise Functions as Polynomials]()](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

[Encoding Bitwise Functions as Polynomials](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

Use polynomials to represent Boolean functions, see how they can be solved using generic math, analyze the properties of the representation, and use them to construct an arithmetic logic unit (ALU).

[Read More →](/blog/encoding-bitwise-functions-as-polynomials)

May 2, 2024

[Application Security](/blog?category=Application+Security)

[![When You Have No Bars]()](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

[When You Have No Bars](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

A major network update failure led to a massive cellphone service outage across the US, impacting thousands and disrupting essential services. Despite cellular networks’ redundancy, the incident highlighted vulnerabilities in communication infrastructure when multiple base stations fail simultaneously.

[Read More →](/blog/when-you-have-no-bars)

Apr 25, 2024

[Hardware Security](/blog?category=Hardware+Security), [Network Security](/blog?category=Network+Security), [Risk Advisory](/blog?category=Risk+Advisory)

* Services
  #### Application Security

  + [Web Application Penetration Testing](/services/application-security/web-application-penetration-testing)
  + [Secure Code Review](/services/application-security/secure-code-review)
  #### Network Security

  + [Network Penetration Testing](/services/network-security/network-penetration-testing)
  #### Risk Advisory

  + [VCISO Services](/services/risk-advisory-services/virtual-chief-information-security-officer)
  + [Tabletop Exercises](/services/risk-advisory-services/tabletop-exercises)

  #### Hardware Security

  + [Smart Device/IoT Security Assessment](/services/hardware-security/smart-device-and-iot-security-assessment)

  #### Vendor Security

  + [Vendor Security Management Services](/services/vendor-security-management)
* Programs
  #### App Defense Alliance

  + [Cloud Application Security Assessment (CASA)](/programs/google-casa-cloud-application-security-assessment)
  + [Mobile Application Security Assessment (MASA)](/programs/google-masa-mobile-application-security-assessment)

  #### Google Programs

  + [Nest SDM API Assessment](/programs/google-nest-security-assessment)

  #### Shopify Programs

  + [Shopify Plus Certified App Assessment](/shopify-plus-certified)
* Research
  + [TunnelVision](/research/tunnelvision)
  + [LibEvent CVE-2024-31735](/blog/cve-2024-31735-libevent-library-memory-leak)
* Blog
  #### Featured

  [![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/1714397721412-K7KKE0AMAP8OI38VO0I3/TunnelVision_No_Light_At_The_End_of_The_Tunnel?format=300w?format=300w)](https://www.leviathansecurity.com/blog/tunnelvision)

  [TunnelVision (CVE-2024-3661): How Attackers Can Decloak Routing-Based VPNs For a Total VPN Leak](https://www.leviathansecurity.com/blog/tunnelvision)

  #### Categories

  + [Risk Advisory](/blog/category/Risk%2BAdvisory)
  + [Application Security](/blog/category/Application%2BSecurity)
  + [Network Security](/blog/category/Network%2BSecurity)
  + [Enterprise Security](/blog/category/Enterprise%2BSecurity)
  + [Hardware Security](/blog/category/Hardware%2BSecurity)
  + [View All Blog Posts](/blog)
* Company
  + [Press Box](/press-box)
  + [Careers](/careers)
  + [About Us](/about-us)
  + [Privacy Policy](/privacy-policy)

![](https://images.squarespace-cdn.com/content/v1/6128b1eb2eb2cf15b7a35a2f/17e6fa19-9978-4af8-bcf2-8b8540c1fe4e/Leviathan-Logo-Horizontal-White.png)

#### Services

[Web Application Penetration Testing](https://www.leviathansecurity.com/services/application-security/web-application-penetration-testing)

[Secure Code Review](https://www.leviathansecurity.com/services/application-security/secure-code-review)

[Network Penetration Testing](https://www.leviathansecurity.com/services/network-security/network-penetration-testing)

[VCISO Services](https://www.leviathansecurity.com/services/risk-advisory-services/virtual-chief-information-security-officer)

[Tabletop Exercises](https://www.leviathansecurity.com/services/risk-advisory-services/tabletop-exercises)

[Smart Device/IoT Security Assessment](https://www.leviathansecurity.com/services/hardware-security/smart-device-and-iot-security-assessment)

[Vendor Security Management Services](https://www.leviathansecurity.com/services/vendor-security-management)

#### Programs

[Cloud Application Security Assessment (CASA)](https://www.leviathansecurity.com/programs/google-casa-cloud-application-security-assessment)

[Mobile Application Security Assessment (MASA)](https://www.leviathansecurity.com/programs/google-masa-mobile-application-security-assessment)

[Nest SDM API Assessment](https://www.leviathansecurity.com/programs/google-nest-security-assessment)

[Shopify Plus Certified Assessment](/shopify-plus-certified)

#### Research

[TunnelVision](https://www.leviathansecurity.com/research/tunnelvision)

[LibEvent CVE-2024-31735](/blog/cve-2024-31735-libevent-library-memory-leak)

#### Blog

[Risk Advisory](https://www.leviathansecurity.com/blog/category/Risk%2BAdvisory)

[Application Security](https://www.leviathansecurity.com/blog/category/Application%2BSecurity)

[Network Security](https://www.leviathansecurity.com/blog/category/Network%2BSecurity)

[Enterprise Security](https://www.leviathansecurity.com/blog/category/Enterprise%2BSecurity)

[Hardware Security](https://www.leviathansecurity.com/blog/category/Hardware%2BSecurity)

[View All Blog Posts](https://www.leviathansecurity.com/blog)

#### Company

[Press Box](https://www.leviathansecurity.com/press-box)

[Careers](https://www.leviathansecurity.com/careers)

[About Us](https://www.leviathansecurity.com/about-us)

[Privacy Policy](https://www.leviathansecurity.com/privacy-policy)

[Contact Us](/contact)



=== Content from issuetracker.google.com_65365f52_20250111_135239.html ===
[Sign in](https://accounts.google.com/ServiceLogin?passive=1209600&osid=1&continue=https%3A%2F%2Fissuetracker.google.com%2Fissues%2F263721377&followup=https%3A%2F%2Fissuetracker.google.com%2Fissues%2F263721377&ec=GAZAkwI)
