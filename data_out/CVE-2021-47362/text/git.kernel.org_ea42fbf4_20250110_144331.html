

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Lijo Lazar <lijo.lazar@amd.com> | 2021-09-23 11:58:43 +0800 |
| --- | --- | --- |
| committer | Alex Deucher <alexander.deucher@amd.com> | 2021-09-23 17:06:11 -0400 |
| commit | [ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)) | |
| tree | [bc07cfa669c75f119f9f0c51c9d897afb2e00632](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa) | |
| parent | [f63251184a81039ebc805306505838c2a073e51a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f63251184a81039ebc805306505838c2a073e51a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa&id2=f63251184a81039ebc805306505838c2a073e51a)) | |
| download | [linux-ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa.tar.gz) | |

drm/amd/pm: Update intermediate power state for SIUpdate the current state as boot state during dpm initialization.
During the subsequent initialization, set\_power\_state gets called to
transition to the final power state. set\_power\_state refers to values
from the current state and without current state populated, it could
result in NULL pointer dereference.
For ex: on platforms where PCI speed change is supported through ACPI
ATCS method, the link speed of current state needs to be queried before
deciding on changing to final power state's link speed. The logic to query
ATCS-support was broken on certain platforms. The issue became visible
when broken ATCS-support logic got fixed with commit
f9b7f3703ff9 ("drm/amdgpu/acpi: make ATPX/ATCS structures global (v2)").
Bug: https://gitlab.freedesktop.org/drm/amd/-/issues/1698
Signed-off-by: Lijo Lazar <lijo.lazar@amd.com>
Reviewed-by: Hawking Zhang <Hawking.Zhang@amd.com>
Acked-by: Alex Deucher <alexander.deucher@amd.com>
Signed-off-by: Alex Deucher <alexander.deucher@amd.com>
Cc: stable@vger.kernel.org
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)

| -rw-r--r-- | [drivers/gpu/drm/amd/pm/powerplay/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/amd/pm/powerplay/si_dpm.c?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa) | 2 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 0 deletions

| diff --git a/drivers/gpu/drm/amd/pm/powerplay/si\_dpm.c b/drivers/gpu/drm/amd/pm/powerplay/si\_dpm.cindex bdbbeb959c6814..81f82aa05ec287 100644--- a/[drivers/gpu/drm/amd/pm/powerplay/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/pm/powerplay/si_dpm.c?id=f63251184a81039ebc805306505838c2a073e51a)+++ b/[drivers/gpu/drm/amd/pm/powerplay/si\_dpm.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/amd/pm/powerplay/si_dpm.c?id=ab39d3cef526ba09c4c6923b4cd7e6ec1c5d4faa)@@ -6867,6 +6867,8 @@ static int si\_dpm\_enable(struct amdgpu\_device \*adev) si\_enable\_auto\_throttle\_source(adev, AMDGPU\_DPM\_AUTO\_THROTTLE\_SRC\_THERMAL, true); si\_thermal\_start\_thermal\_controller(adev); + ni\_update\_current\_ps(adev, boot\_ps);+ return 0; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:42:09 +0000

