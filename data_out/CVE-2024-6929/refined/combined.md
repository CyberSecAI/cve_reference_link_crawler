=== Content from wordpress.org_80d829c4_20250111_043054.html ===


[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Showcase](https://wordpress.org/showcase/)
* [Hosting](https://wordpress.org/hosting/)
* Extend
  + [Themes](https://wordpress.org/themes/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Blocks](https://wordpress.org/blocks/)
  + [Openverse ↗︎](https://openverse.org/)
* Learn
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* Community
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [Events](https://events.wordpress.org/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* About
  + [About WordPress](https://wordpress.org/about/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
* [Get WordPress](https://wordpress.org/download/)

Search in WordPress.org

[Get WordPress](https://wordpress.org/download/)

[WordPress.org](https://wordpress.org/)

[Plugin Directory](https://wordpress.org/plugins/)

Dynamic Featured Image

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fdynamic-featured-image&locale=en_US)

* [Submit a plugin](https://wordpress.org/plugins/developers/)
* [My favorites](https://wordpress.org/plugins/browse/favorites/)
* [Log in](https://login.wordpress.org/?redirect_to=https%3A%2F%2Fwordpress.org%2Fplugins%2Fdynamic-featured-image&locale=en_US)

Search plugins

![](https://s.w.org/plugins/geopattern-icon/dynamic-featured-image_444643.svg)
# dynamic-featured-image

By [Ankit Pokhrel](https://ankitpokhrel.com)

* [Details](https://wordpress.org/plugins/dynamic-featured-image/#description)
* [Reviews](https://wordpress.org/plugins/dynamic-featured-image/#reviews)
* [Development](https://wordpress.org/plugins/dynamic-featured-image/#developers)

[Support](https://wordpress.org/support/plugin/dynamic-featured-image/)

## Description

This plugin has been closed as of September 2, 2024 and is not available for download. Reason: Security Issue.

## Reviews

![](https://secure.gravatar.com/avatar/46d4581101b66f7edf94e2fae074bb09d3d7f15832c15d739968dc2af0e43418?s=60&d=retro&r=g)
### [Really Flexible for use](https://wordpress.org/support/topic/really-flexible-for-use/)

[Sattajit](https://profiles.wordpress.org/sattajit/ "Posts by Sattajit")
May 13, 2024

Really Flexible for use

![](https://secure.gravatar.com/avatar/f6762cdfffc01b7b93234d2ea9e5e2585898ad41d97a0f01a6930bf6ac7dd536?s=60&d=retro&r=g)
### [Very nice!](https://wordpress.org/support/topic/very-nice-1941/)

[philliproth](https://profiles.wordpress.org/philliproth/ "Posts by philliproth")
April 3, 2024

Works perfectly

![](https://secure.gravatar.com/avatar/a4348f35b2ef74b4485607812f75b59752ea415443dc2b0c22c62bc5c9a72b83?s=60&d=retro&r=g)
### [Works great with a little code](https://wordpress.org/support/topic/works-great-with-a-little-code/)

[clarke77](https://profiles.wordpress.org/clarke77/ "Posts by clarke77")
April 9, 2021

I got the free version working perfectly last night with WordPress 5.7.
The description says the plugin will “add any number of featured images … without writing a single line of code”, which is a bit misleading. The plugin provides a GUI interface to flag images as featured, but to actually have the images appear on your site you need to write some code.
Stack Overflow to the rescue. I found this snippet there and got it working:
if( class\_exists('Dynamic\_Featured\_Image') ) {
global $dynamic\_featured\_image;
$featured\_images = $dynamic\_featured\_image->get\_featured\_images( );
//print\_r($featured\_images);
//You can now loop through the image to display them as required
foreach($featured\_images as $featured\_image) {
echo "<img src='".$featured\_image['full']."'>";
}
}
Detailed instructions for those who, like me, don’t know PHP at all:
Go to Appearance/Theme Editor
Double click on the part of the site you want to add featured images. This will probably be ‘Single Page’ or ‘Single Post’, but it could be ‘Theme Header’, ‘Theme Footer’, or whatever.
For most pages, you’ll want to paste the above code into ‘the loop’. If you don’t know what ‘the loop’ is, it’s worth looking in to, as it’s probably a bit different on different themes. On most themes, pasting the code anywhere between while (have\_posts()): the\_post(); and endwhile; should work. But where you put it in relation to other things in ‘the loop’ probably matters.
Note that everything between the quotes, after the word ‘echo’ in the code above is what will appear on your page. So any other stuff you want to add (list items, div tags, etc.) needs to go in there.
If you’re adding any attributes, use single quotes or your whole site will bork.
Have fun!
Hope that helps. And thank you, Ankit, for a great plugin!

![](https://secure.gravatar.com/avatar/8812d783629ce418b7b8dfe2a9385264dcfacf5ef0e0662a9e4e1dcd9bc0edd0?s=60&d=retro&r=g)
### [Does not work](https://wordpress.org/support/topic/does-not-work-998/)

[Marc73](https://profiles.wordpress.org/marc73/ "Posts by Marc73")
December 3, 2018

This is a poorly documented, poorly coded half-done plugin. The plugin, if you read the fine print, assumes you would go to a github page, and follow vague instructions on what functions you need to call in your theme… as if this is something that the average user can do.
It is a great idea to show many featured images… it is a pitty you have a be a coder, to create your child-theme and hack it to get this to work.

![](https://secure.gravatar.com/avatar/b68e9aabb8ac31abcc86c26ab2f715e25e72c10ac63c2614b60a1cd000611863?s=60&d=retro&r=g)
### [Worst plugin ever](https://wordpress.org/support/topic/worst-plugin-ever-34/)

[kellybaya](https://profiles.wordpress.org/kellybaya/ "Posts by kellybaya")
September 16, 2018

DO NOT purchase the Pro version of this plugin. It does not work as described and has terrible documentation. Emails sent asking for a refund have been ignored. Looking though the support forum I can also see that support for this plugin is non-existent. These guys don’t care about their customers or the quality of their work.

![](https://secure.gravatar.com/avatar/6f09bb82a28724503bfe1455dc236d035bc34a61bf046eec8d34d7b5956fa70d?s=60&d=retro&r=g)
### [not a good review](https://wordpress.org/support/topic/not-a-good-review/)

[alternativedge](https://profiles.wordpress.org/alternativedge/ "Posts by alternativedge")
September 5, 2018

word of advice for those looking to buy the pro version… don’t!!
Truly a master piece in terms of terrible development and documentation..
I am in awe……

[Read all 58 reviews](https://wordpress.org/support/plugin/dynamic-featured-image/reviews/)
## Contributors & Developers

“Dynamic Featured Image” is open source software. The following people have contributed to this plugin.

Contributors

* ![](https://secure.gravatar.com/avatar/07f2aef5d1e12e750ce5f46b0f7d845fc134b911511fb6b46eddda8a1a783152?s=32&d=mm&r=g) [Ankit Pokhrel](https://profiles.wordpress.org/ankitpokhrel/)
* ![](https://secure.gravatar.com/avatar/186e5c1de958782b20b72c083873860e428fbba9cd5ec55f6c188eea3b73e86e?s=32&d=mm&r=g) [Christian Foellmann](https://profiles.wordpress.org/cfoellmann/)

“Dynamic Featured Image” has been translated into 13 locales. Thank you to [the translators](https://translate.wordpress.org/projects/wp-plugins/dynamic-featured-image/contributors) for their contributions.

[Translate “Dynamic Featured Image” into your language.](https://translate.wordpress.org/projects/wp-plugins/dynamic-featured-image)

### Interested in development?

[Browse the code](https://plugins.trac.wordpress.org/browser/dynamic-featured-image/), check out the [SVN repository](https://plugins.svn.wordpress.org/dynamic-featured-image/), or subscribe to the [development log](https://plugins.trac.wordpress.org/log/dynamic-featured-image/) by [RSS](https://plugins.trac.wordpress.org/log/dynamic-featured-image/?limit=100&mode=stop_on_copy&format=rss).

## Meta

* Version **3.7.0**
* Last updated **4 years ago**
* Active installations **N/A**
* WordPress version **3.8 or higher**
* Tested up to **5.6.14**
* PHP version **5.4 or higher**
* Languages
  See all 14

  Close

  [Chinese (Taiwan)](https://tw.wordpress.org/plugins/dynamic-featured-image/), [Dutch](https://nl.wordpress.org/plugins/dynamic-featured-image/), [Dutch (Belgium)](https://nl-be.wordpress.org/plugins/dynamic-featured-image/), [English (Canada)](https://en-ca.wordpress.org/plugins/dynamic-featured-image/), [English (South Africa)](https://en-za.wordpress.org/plugins/dynamic-featured-image/), [English (UK)](https://en-gb.wordpress.org/plugins/dynamic-featured-image/), [English (US)](https://wordpress.org/plugins/dynamic-featured-image/), [French (France)](https://fr.wordpress.org/plugins/dynamic-featured-image/), [Galician](https://gl.wordpress.org/plugins/dynamic-featured-image/), [Spanish (Mexico)](https://es-mx.wordpress.org/plugins/dynamic-featured-image/), [Spanish (Spain)](https://es.wordpress.org/plugins/dynamic-featured-image/), [Spanish (Venezuela)](https://ve.wordpress.org/plugins/dynamic-featured-image/), [Swedish](https://sv.wordpress.org/plugins/dynamic-featured-image/), and [Ukrainian](https://uk.wordpress.org/plugins/dynamic-featured-image/).

  [Translate into your language](https://translate.wordpress.org/projects/wp-plugins/dynamic-featured-image)
* [Advanced View](https://wordpress.org/plugins/dynamic-featured-image/advanced/)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Privacy](https://wordpress.org/about/privacy/)

* [Showcase](https://wordpress.org/showcase/)
* [Themes](https://wordpress.org/themes/)
* [Plugins](https://wordpress.org/plugins/)
* [Patterns](https://wordpress.org/patterns/)

* [Learn](https://learn.wordpress.org/)
* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [WordPress.tv ↗](https://wordpress.tv/)

* [Get Involved](https://make.wordpress.org/)
* [Events](https://events.wordpress.org/)
* [Donate ↗](https://wordpressfoundation.org/donate/)
* [Five for the Future](https://wordpress.org/five-for-the-future/)

* [WordPress.com ↗](https://wordpress.com/?ref=wporg-footer)
* [Matt ↗](https://ma.tt/)
* [bbPress ↗](https://bbpress.org/)
* [BuddyPress ↗](https://buddypress.org/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our X (formerly Twitter) account](https://www.x.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)
* [Visit our YouTube channel](https://www.youtube.com/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_e49ac3da_20250111_043053.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdynamic-featured-image%2Ftrunk%2Fdynamic-featured-image.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?rev=1988001 "Revision 1988001")
* Next Revision →
* [Blame](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/dynamic-featured-image/trunk/dynamic-featured-image.php)

---

# [source:](/browser?order=name "Go to repository root") [dynamic-featured-image](/browser/dynamic-featured-image?order=name "View dynamic-featured-image")/[trunk](/browser/dynamic-featured-image/trunk?order=name "View trunk")/[dynamic-featured-image.php](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?order=name "View dynamic-featured-image.php")

View diff against:

View revision:

| [Last change](/changeset/2068424/dynamic-featured-image/trunk/dynamic-featured-image.php "View differences") on this file was [2068424](/changeset/2068424/ "View changeset 2068424"), checked in by ankitpokhrel, [6 years ago](/timeline?from=2019-04-14T09%3A41%3A22Z&precision=second "See timeline at 04/14/2019 09:41:22 AM") |
| --- |
| Version 3.7.0 |
| **File size:** 32.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name: Dynamic Featured Image |
| [4](#L4) | \* Plugin URI: http://wordpress.org/plugins/dynamic-featured-image/ |
| [5](#L5) | \* Description: Dynamically adds multiple featured image or post thumbnail functionality to your posts, pages and custom post types. |
| [6](#L6) | \* Version: 3.7.0 |
| [7](#L7) | \* Author: Ankit Pokhrel |
| [8](#L8) | \* Author URI: https://ankitpokhrel.com |
| [9](#L9) | \* License: GPL2 or later |
| [10](#L10) | \* License URI: http://www.gnu.org/licenses/gpl-2.0.html |
| [11](#L11) | \* Text Domain: dynamic-featured-image |
| [12](#L12) | \* Domain Path: /languages |
| [13](#L13) | \* GitHub Plugin URI: https://github.com/ankitpokhrel/Dynamic-Featured-Image |
| [14](#L14) | \* |
| [15](#L15) | \* @package dynamic-featured-image |
| [16](#L16) | \* |
| [17](#L17) | \* Copyright (C) 2013-2019 Ankit Pokhrel <info@ankitpokhrel.com, https://ankitpokhrel.com> |
| [18](#L18) | \* |
| [19](#L19) | \* This program is free software; you can redistribute it and/or modify |
| [20](#L20) | \* it under the terms of the GNU General Public License as published by |
| [21](#L21) | \* the Free Software Foundation; either version 3 of the License, or |
| [22](#L22) | \* (at your option) any later version. |
| [23](#L23) | \* |
| [24](#L24) | \* This program is distributed in the hope that it will be useful, |
| [25](#L25) | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [26](#L26) | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [27](#L27) | \* GNU General Public License for more details. |
| [28](#L28) | \* |
| [29](#L29) | \* You should have received a copy of the GNU General Public License |
| [30](#L30) | \* along with this program.  If not, see <http://www.gnu.org/licenses/>. |
| [31](#L31) | \*/ |
| [32](#L32) |  |
| [33](#L33) | // Avoid direct calls to this file. |
| [34](#L34) | if ( ! defined( 'ABSPATH' ) ) { |
| [35](#L35) | header( 'Status: 403 Forbidden' ); |
| [36](#L36) | header( 'HTTP/1.1 403 Forbidden' ); |
| [37](#L37) | exit(); |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Dynamic Featured Image plugin main class. |
| [42](#L42) | \* |
| [43](#L43) | \* @author Ankit Pokhrel <info@ankitpokhrel.com> |
| [44](#L44) | \* @version 3.7.0 |
| [45](#L45) | \*/ |
| [46](#L46) | class Dynamic\_Featured\_Image { |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Current version of the plugin. |
| [49](#L49) | \* |
| [50](#L50) | \* @since 3.0.0 |
| [51](#L51) | \*/ |
| [52](#L52) | const VERSION = '3.7.0'; |
| [53](#L53) |  |
| [54](#L54) | /\*\* |
| [55](#L55) | \* Text domain. |
| [56](#L56) | \* |
| [57](#L57) | \* @since 3.6.0 |
| [58](#L58) | \*/ |
| [59](#L59) | const TEXT\_DOMAIN = 'dynamic-featured-image'; |
| [60](#L60) |  |
| [61](#L61) | /\*\* |
| [62](#L62) | \* Documentation Link. |
| [63](#L63) | \* |
| [64](#L64) | \* @since 3.6.0 |
| [65](#L65) | \*/ |
| [66](#L66) | const WIKI\_LINK = 'https://github.com/ankitpokhrel/Dynamic-Featured-Image/wiki/'; |
| [67](#L67) |  |
| [68](#L68) | /\*\* |
| [69](#L69) | \* Upgrade Link. |
| [70](#L70) | \* |
| [71](#L71) | \* @since 3.6.0 |
| [72](#L72) | \*/ |
| [73](#L73) | const UPGRADE\_LINK = 'https://ankitpokhrel.com/explore/dynamic-featured-image-pro/'; |
| [74](#L74) |  |
| [75](#L75) | /\*\* |
| [76](#L76) | \* Image upload directory. |
| [77](#L77) | \* |
| [78](#L78) | \* @var $upload\_dir string |
| [79](#L79) | \*/ |
| [80](#L80) | private $upload\_dir; |
| [81](#L81) |  |
| [82](#L82) | /\*\* |
| [83](#L83) | \* Image upload URL. |
| [84](#L84) | \* |
| [85](#L85) | \* @var $upload\_url string |
| [86](#L86) | \*/ |
| [87](#L87) | private $upload\_url; |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Database object. |
| [91](#L91) | \* |
| [92](#L92) | \* @var $db wpdb |
| [93](#L93) | \*/ |
| [94](#L94) | private $db; |
| [95](#L95) |  |
| [96](#L96) | /\*\* |
| [97](#L97) | \* Title for dfi metabox. |
| [98](#L98) | \* |
| [99](#L99) | \* @var $metabox\_title string |
| [100](#L100) | \*/ |
| [101](#L101) | protected $metabox\_title; |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Users post type filter for dfi metabox. |
| [105](#L105) | \* |
| [106](#L106) | \* @var $user\_filter array |
| [107](#L107) | \*/ |
| [108](#L108) | protected $user\_filter; |
| [109](#L109) |  |
| [110](#L110) | /\*\* |
| [111](#L111) | \* Constructor. Hooks all interactions to initialize the class. |
| [112](#L112) | \* |
| [113](#L113) | \* @since 1.0.0 |
| [114](#L114) | \* @access public |
| [115](#L115) | \* @global object $wpdb |
| [116](#L116) | \* |
| [117](#L117) | \* @see     add\_action() |
| [118](#L118) | \*/ |
| [119](#L119) | public function \_\_construct() { |
| [120](#L120) | // plugin update warning. |
| [121](#L121) | add\_action( 'in\_plugin\_update\_message-' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'update\_notice' ) ); |
| [122](#L122) |  |
| [123](#L123) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_admin\_scripts' ) ); |
| [124](#L124) | add\_action( 'add\_meta\_boxes', array( $this, 'initialize\_featured\_box' ) ); |
| [125](#L125) | add\_action( 'save\_post', array( $this, 'save\_meta' ) ); |
| [126](#L126) | add\_action( 'plugins\_loaded', array( $this, 'load\_plugin\_textdomain' ) ); |
| [127](#L127) |  |
| [128](#L128) | // handle ajax request. |
| [129](#L129) | add\_action( 'wp\_ajax\_dfiMetaBox\_callback', array( $this, 'ajax\_callback' ) ); |
| [130](#L130) |  |
| [131](#L131) | // add action links. |
| [132](#L132) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'dfi\_action\_links' ) ); |
| [133](#L133) |  |
| [134](#L134) | // media uploader custom fields. |
| [135](#L135) | add\_filter( 'attachment\_fields\_to\_edit', array( $this, 'media\_attachment\_custom\_fields' ), 10, 2 ); |
| [136](#L136) | add\_filter( 'attachment\_fields\_to\_save', array( $this, 'media\_attachment\_custom\_fields\_save' ), 10, 2 ); |
| [137](#L137) |  |
| [138](#L138) | // plugin sponsors. |
| [139](#L139) | new PluginSponsor(); |
| [140](#L140) |  |
| [141](#L141) | // get the site protocol. |
| [142](#L142) | $protocol = $this->get\_protocol(); |
| [143](#L143) |  |
| [144](#L144) | $this->upload\_dir = wp\_upload\_dir(); |
| [145](#L145) | $this->upload\_url = preg\_replace( '#^https?://#', '', $this->upload\_dir['baseurl'] ); |
| [146](#L146) |  |
| [147](#L147) | // add protocol to the upload url. |
| [148](#L148) | $this->upload\_url = $protocol . $this->upload\_url; |
| [149](#L149) |  |
| [150](#L150) | // post type filter added by user. |
| [151](#L151) | $this->user\_filter = array(); |
| [152](#L152) |  |
| [153](#L153) | global $wpdb; |
| [154](#L154) | $this->db = $wpdb; |
| [155](#L155) | } |
| [156](#L156) |  |
| [157](#L157) | /\*\* |
| [158](#L158) | \* Return site protocol. |
| [159](#L159) | \* |
| [160](#L160) | \* @since 3.5.1 |
| [161](#L161) | \* @access public |
| [162](#L162) | \* |
| [163](#L163) | \* @return string |
| [164](#L164) | \*/ |
| [165](#L165) | private function get\_protocol() { |
| [166](#L166) | return is\_ssl() ? 'https://' : 'http://'; |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | /\*\* |
| [170](#L170) | \* Add required admin scripts. |
| [171](#L171) | \* |
| [172](#L172) | \* @since 1.0.0 |
| [173](#L173) | \* @access public |
| [174](#L174) | \* |
| [175](#L175) | \* @see  wp\_enqueue\_style() |
| [176](#L176) | \* @see  wp\_register\_script() |
| [177](#L177) | \* @see  wp\_enqueue\_script() |
| [178](#L178) | \* |
| [179](#L179) | \* @return void |
| [180](#L180) | \*/ |
| [181](#L181) | public function enqueue\_admin\_scripts() { |
| [182](#L182) | // enqueue styles. |
| [183](#L183) | wp\_enqueue\_style( 'style-dfi', plugins\_url( '/css/style-dfi.css', \_\_FILE\_\_ ), array(), self::VERSION ); |
| [184](#L184) |  |
| [185](#L185) | // register script. |
| [186](#L186) | wp\_register\_script( 'scripts-dfi', plugins\_url( '/js/script-dfi.js', \_\_FILE\_\_ ), array( 'jquery' ), self::VERSION ); |
| [187](#L187) |  |
| [188](#L188) | // localize the script with required data. |
| [189](#L189) | wp\_localize\_script( |
| [190](#L190) | 'scripts-dfi', |
| [191](#L191) | 'DFI\_SPECIFIC', |
| [192](#L192) | array( |
| [193](#L193) | 'upload\_url'               => $this->upload\_url, |
| [194](#L194) | 'metabox\_title'            => \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ), |
| [195](#L195) | 'mediaSelector\_title'      => \_\_( 'Dynamic Featured Image - Media Selector', self::TEXT\_DOMAIN ), |
| [196](#L196) | 'mediaSelector\_buttonText' => \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ), |
| [197](#L197) | 'ajax\_nonce'               => wp\_create\_nonce( plugin\_basename( \_\_FILE\_\_ ) ), |
| [198](#L198) | ) |
| [199](#L199) | ); |
| [200](#L200) |  |
| [201](#L201) | // enqueue scripts. |
| [202](#L202) | wp\_enqueue\_script( 'scripts-dfi' ); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | /\*\* |
| [206](#L206) | \* Add upgrade link. |
| [207](#L207) | \* |
| [208](#L208) | \* @access public |
| [209](#L209) | \* @since  3.5.1 |
| [210](#L210) | \* @action plugin\_action\_links |
| [211](#L211) | \* |
| [212](#L212) | \* @codeCoverageIgnore |
| [213](#L213) | \* |
| [214](#L214) | \* @param  array $links Action links. |
| [215](#L215) | \* |
| [216](#L216) | \* @return array |
| [217](#L217) | \*/ |
| [218](#L218) | public function dfi\_action\_links( $links ) { |
| [219](#L219) | $upgrade\_link = array( |
| [220](#L220) | '<a href="' . self::UPGRADE\_LINK . '" target="\_blank">Upgrade to Premium</a>' |
| [221](#L221) | ); |
| [222](#L222) |  |
| [223](#L223) | return array\_merge( $links, $upgrade\_link ); |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* Add featured meta boxes dynamically. |
| [228](#L228) | \* |
| [229](#L229) | \* @since 1.0.0 |
| [230](#L230) | \* @access public |
| [231](#L231) | \* @global object $post |
| [232](#L232) | \* |
| [233](#L233) | \* @see  get\_post\_meta() |
| [234](#L234) | \* @see  get\_post\_types() |
| [235](#L235) | \* @see  add\_meta\_box() |
| [236](#L236) | \* @see  add\_filter() |
| [237](#L237) | \* |
| [238](#L238) | \* @return void |
| [239](#L239) | \*/ |
| [240](#L240) | public function initialize\_featured\_box() { |
| [241](#L241) | global $post; |
| [242](#L242) |  |
| [243](#L243) | // make metabox title dynamic. |
| [244](#L244) | $this->metabox\_title = apply\_filters( 'dfi\_set\_metabox\_title', \_\_( 'Featured Image', self::TEXT\_DOMAIN ) ); |
| [245](#L245) |  |
| [246](#L246) | $featured\_data  = get\_post\_meta( $post->ID, 'dfiFeatured', true ); |
| [247](#L247) | $total\_featured = is\_array( $featured\_data ) ? count( $featured\_data ) : 0; |
| [248](#L248) |  |
| [249](#L249) | $default\_filter    = array( 'attachment', 'revision', 'nav\_menu\_item' ); |
| [250](#L250) | $this->user\_filter = apply\_filters( 'dfi\_post\_type\_user\_filter', $this->user\_filter ); |
| [251](#L251) |  |
| [252](#L252) | $post\_types = array\_diff( get\_post\_types(), array\_merge( $default\_filter, $this->user\_filter ) ); |
| [253](#L253) | $post\_types = apply\_filters( 'dfi\_post\_types', $post\_types ); |
| [254](#L254) |  |
| [255](#L255) | if ( ! empty( $featured\_data ) && $total\_featured >= 1 ) { |
| [256](#L256) | $i = 2; |
| [257](#L257) | foreach ( $featured\_data as $featured ) { |
| [258](#L258) | $this->dfi\_add\_meta\_box( $post\_types, $featured, $i++ ); |
| [259](#L259) | } |
| [260](#L260) | } else { |
| [261](#L261) | $this->dfi\_add\_meta\_box( $post\_types ); |
| [262](#L262) | } |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | /\*\* |
| [266](#L266) | \* Translates more than one digit number digit by digit. |
| [267](#L267) | \* |
| [268](#L268) | \* @param  int $number Integer to be translated. |
| [269](#L269) | \* |
| [270](#L270) | \* @return string Translated number |
| [271](#L271) | \*/ |
| [272](#L272) | protected function get\_number\_translation( $number ) { |
| [273](#L273) | if ( $number <= 9 ) { |
| [274](#L274) | return \_\_( $number, self::TEXT\_DOMAIN ); |
| [275](#L275) | } else { |
| [276](#L276) | $pieces = str\_split( $number, 1 ); |
| [277](#L277) | $buffer = ''; |
| [278](#L278) | foreach ( $pieces as $piece ) { |
| [279](#L279) | $buffer .= \_\_( $piece, self::TEXT\_DOMAIN ); |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | return $buffer; |
| [283](#L283) | } |
| [284](#L284) | } |
| [285](#L285) |  |
| [286](#L286) | /\*\* |
| [287](#L287) | \* Adds meta boxes. |
| [288](#L288) | \* |
| [289](#L289) | \* @param  array  $post\_types Post types to show featured image box. |
| [290](#L290) | \* @param  object $featured Callback arguments. |
| [291](#L291) | \* @param  int    $i Index of the featured image. |
| [292](#L292) | \* |
| [293](#L293) | \* @return void |
| [294](#L294) | \*/ |
| [295](#L295) | private function dfi\_add\_meta\_box( $post\_types, $featured = null, $i = null ) { |
| [296](#L296) | if ( ! is\_null( $i ) ) { |
| [297](#L297) | foreach ( $post\_types as $type ) { |
| [298](#L298) | add\_meta\_box( |
| [299](#L299) | 'dfiFeaturedMetaBox-' . $i, |
| [300](#L300) | \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ) . ' ' . $this->get\_number\_translation( $i ), |
| [301](#L301) | array( $this, 'featured\_meta\_box' ), |
| [302](#L302) | $type, |
| [303](#L303) | apply\_filters( 'dfi\_metabox\_context', 'side' ), |
| [304](#L304) | apply\_filters( 'dfi\_metabox\_priority', 'low' ), |
| [305](#L305) | array( $featured, $i + 1 ) |
| [306](#L306) | ); |
| [307](#L307) |  |
| [308](#L308) | add\_filter( "postbox\_classes\_{$type}\_dfiFeaturedMetaBox-" . $i, array( $this, 'add\_metabox\_classes' ) ); |
| [309](#L309) | } |
| [310](#L310) | } else { |
| [311](#L311) | foreach ( $post\_types as $type ) { |
| [312](#L312) | add\_meta\_box( |
| [313](#L313) | 'dfiFeaturedMetaBox', |
| [314](#L314) | \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ) . ' ' . \_\_( 2, self::TEXT\_DOMAIN ), |
| [315](#L315) | array( $this, 'featured\_meta\_box' ), |
| [316](#L316) | $type, |
| [317](#L317) | apply\_filters( 'dfi\_metabox\_context', 'side' ), |
| [318](#L318) | apply\_filters( 'dfi\_metabox\_priority', 'low' ), |
| [319](#L319) | array( null, null ) |
| [320](#L320) | ); |
| [321](#L321) |  |
| [322](#L322) | add\_filter( "postbox\_classes\_{$type}\_dfiFeaturedMetaBox", array( $this, 'add\_metabox\_classes' ) ); |
| [323](#L323) | } |
| [324](#L324) | } |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | /\*\* |
| [328](#L328) | \* Separate thumb and full image url from given URL string. |
| [329](#L329) | \* |
| [330](#L330) | \* @since  3.3.1 |
| [331](#L331) | \* |
| [332](#L332) | \* @param  string $url\_string Url string. |
| [333](#L333) | \* @param  string $state Thumb or full. |
| [334](#L334) | \* |
| [335](#L335) | \* @return string|null |
| [336](#L336) | \*/ |
| [337](#L337) | private function separate( $url\_string, $state = 'thumb' ) { |
| [338](#L338) | $image\_piece = explode( ',', $url\_string ); |
| [339](#L339) |  |
| [340](#L340) | if ( 'thumb' === $state ) { |
| [341](#L341) | return isset( $image\_piece[0] ) ? $image\_piece[0] : null; |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | return isset( $image\_piece[1] ) ? $image\_piece[1] : null; |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | /\*\* |
| [348](#L348) | \* Create a nonce field. |
| [349](#L349) | \* |
| [350](#L350) | \* @since  3.5.0 |
| [351](#L351) | \* |
| [352](#L352) | \* @see  wp\_nonce\_field() |
| [353](#L353) | \* @see  plugin\_basename() |
| [354](#L354) | \* |
| [355](#L355) | \* @codeCoverageIgnore |
| [356](#L356) | \* |
| [357](#L357) | \* @param  string $key Nonce key. |
| [358](#L358) | \* |
| [359](#L359) | \* @return string |
| [360](#L360) | \*/ |
| [361](#L361) | protected function nonce\_field( $key ) { |
| [362](#L362) | return wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), $key, true, false ); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | /\*\* |
| [366](#L366) | \* Featured meta box as seen in the admin. |
| [367](#L367) | \* |
| [368](#L368) | \* @since 1.0.0 |
| [369](#L369) | \* @access public |
| [370](#L370) | \* |
| [371](#L371) | \* @param  object $post Global post object. |
| [372](#L372) | \* @param  array  $featured Array containing featured image count. |
| [373](#L373) | \* |
| [374](#L374) | \* @throws Exception Medium size image not found. |
| [375](#L375) | \* @return void |
| [376](#L376) | \*/ |
| [377](#L377) | public function featured\_meta\_box( $post, $featured ) { |
| [378](#L378) | $featured\_img         = $featured['args'][0]; |
| [379](#L379) | $featured\_id          = is\_null( $featured['args'][1] ) ? 2 : --$featured['args'][1]; |
| [380](#L380) | $featured\_img\_full    = $featured\_img; |
| [381](#L381) | $featured\_img\_trimmed = $featured\_img; |
| [382](#L382) |  |
| [383](#L383) | if ( ! is\_null( $featured\_img ) ) { |
| [384](#L384) | $featured\_img\_trimmed = $this->separate( $featured\_img ); |
| [385](#L385) | $featured\_img\_full    = $this->separate( $featured\_img, 'full' ); |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | $thumbnail     = null; |
| [389](#L389) | $attachment\_id = null; |
| [390](#L390) | if ( ! empty( $featured\_img\_full ) ) { |
| [391](#L391) | $attachment\_id = $this->get\_image\_id( $this->upload\_url . $featured\_img\_full ); |
| [392](#L392) |  |
| [393](#L393) | $thumbnail = $this->get\_image\_thumb\_by\_attachment\_id( $attachment\_id, 'medium' ); |
| [394](#L394) |  |
| [395](#L395) | if ( empty( $thumbnail ) ) { |
| [396](#L396) | // since medium sized thumbnail image is missing, |
| [397](#L397) | // let's set full image url as thumbnail. |
| [398](#L398) | $thumbnail = $featured\_img\_full; |
| [399](#L399) | } |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | // Add a nonce field. |
| [403](#L403) | echo $this->nonce\_field( 'dfi\_fimageplug-' . $featured\_id ); // WPCS: XSS ok. |
| [404](#L404) | echo $this->get\_featured\_box( $featured\_img\_trimmed, $featured\_img, $featured\_id, $thumbnail, $post->ID, $attachment\_id ); // WPCS: XSS ok. |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | /\*\* |
| [408](#L408) | \* Returns featured box html content. |
| [409](#L409) | \* |
| [410](#L410) | \* @since  3.1.0 |
| [411](#L411) | \* @access private |
| [412](#L412) | \* |
| [413](#L413) | \* @param string $featured\_img\_trimmed Medium sized image. |
| [414](#L414) | \* @param string $featured\_img         Full sized image. |
| [415](#L415) | \* @param string $featured\_id          Featured id number for translation. |
| [416](#L416) | \* @param string $thumbnail            Thumb sized image. |
| [417](#L417) | \* @param int    $post\_id              Post id. |
| [418](#L418) | \* @param int    $attachment\_id        Attachment id. |
| [419](#L419) | \* |
| [420](#L420) | \* @return string Html content |
| [421](#L421) | \*/ |
| [422](#L422) | private function get\_featured\_box( $featured\_img\_trimmed, $featured\_img, $featured\_id, $thumbnail, $post\_id, $attachment\_id ) { |
| [423](#L423) | $has\_featured\_image = ! empty( $featured\_img\_trimmed ) ? ' hasFeaturedImage' : ''; |
| [424](#L424) | $thumbnail          = ! is\_null( $thumbnail ) ? $thumbnail : ''; |
| [425](#L425) | $dfi\_empty          = is\_null( $featured\_img\_trimmed ) ? 'dfiImgEmpty' : ''; |
| [426](#L426) |  |
| [427](#L427) | return "<a href='javascript:void(0)' class='dfiFeaturedImage{$has\_featured\_image}' title='" . \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ) . "' data-post-id='" . $post\_id . "' data-attachment-id='" . $attachment\_id . "'><span class='dashicons dashicons-camera'></span></a><br/> |
| [428](#L428) | <img src='" . $thumbnail . "' class='dfiImg {$dfi\_empty}'/> |
| [429](#L429) | <div class='dfiLinks'> |
| [430](#L430) | <a href='javascript:void(0)' data-id='{$featured\_id}' data-id-local='" . $this->get\_number\_translation( $featured\_id + 1 ) . "' class='dfiAddNew dashicons dashicons-plus' title='" . \_\_( 'Add New', self::TEXT\_DOMAIN ) . "'></a> |
| [431](#L431) | <a href='javascript:void(0)' class='dfiRemove dashicons dashicons-minus' title='" . \_\_( 'Remove', self::TEXT\_DOMAIN ) . "'></a> |
| [432](#L432) | </div> |
| [433](#L433) | <div class='dfiClearFloat'></div> |
| [434](#L434) | <input type='hidden' name='dfiFeatured[]' value='{$featured\_img}'  class='dfiImageHolder' />"; |
| [435](#L435) | } |
| [436](#L436) |  |
| [437](#L437) | /\*\* |
| [438](#L438) | \* Load new featured meta box via ajax. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.0.0 |
| [441](#L441) | \* @access public |
| [442](#L442) | \* |
| [443](#L443) | \* @return void |
| [444](#L444) | \*/ |
| [445](#L445) | public function ajax\_callback() { |
| [446](#L446) | check\_ajax\_referer( plugin\_basename( \_\_FILE\_\_ ), 'security' ); |
| [447](#L447) |  |
| [448](#L448) | $featured\_id = isset( $\_POST['id'] ) ? intval( wp\_unslash( $\_POST['id'] ) ) : null; |
| [449](#L449) |  |
| [450](#L450) | if ( ! is\_numeric( $featured\_id ) ) { |
| [451](#L451) | return; |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | // @codingStandardsIgnoreStart |
| [455](#L455) | echo $this->nonce\_field( 'dfi\_fimageplug-' . $featured\_id ); |
| [456](#L456) | ?> |
| [457](#L457) | <a href="javascript:void(0)" class="dfiFeaturedImage" |
| [458](#L458) | title="<?php echo \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ) ?>"><span |
| [459](#L459) | class="dashicons dashicons-camera"></span></a><br/> |
| [460](#L460) | <img src="" class="dfiImg dfiImgEmpty"/> |
| [461](#L461) | <div class="dfiLinks"> |
| [462](#L462) | <a href="javascript:void(0)" data-id="<?php echo $featured\_id ?>" |
| [463](#L463) | data-id-local="<?php echo $this->get\_number\_translation( $featured\_id + 1 ) ?>" |
| [464](#L464) | class="dfiAddNew dashicons dashicons-plus" title="<?php echo \_\_( 'Add New', self::TEXT\_DOMAIN ) ?>"></a> |
| [465](#L465) | <a href="javascript:void(0)" class="dfiRemove dashicons dashicons-minus" |
| [466](#L466) | title="<?php echo \_\_( 'Remove', self::TEXT\_DOMAIN ) ?>"></a> |
| [467](#L467) | </div> |
| [468](#L468) | <div class="dfiClearFloat"></div> |
| [469](#L469) | <input type="hidden" name="dfiFeatured[]" value="" class="dfiImageHolder"/> |
| [470](#L470) | <?php |
| [471](#L471) | // @codingStandardsIgnoreEnd |
| [472](#L472) | wp\_die( '' ); |
| [473](#L473) | } |
| [474](#L474) |  |
| [475](#L475) | /\*\* |
| [476](#L476) | \* Add custom class 'featured-meta-box' to meta box. |
| [477](#L477) | \* |
| [478](#L478) | \* @since 1.0.0 |
| [479](#L479) | \* @access public |
| [480](#L480) | \* |
| [481](#L481) | \* @see  add\_metabox\_classes |
| [482](#L482) | \* |
| [483](#L483) | \* @param array $classes Classes to add in the meta box. |
| [484](#L484) | \* |
| [485](#L485) | \* @return array |
| [486](#L486) | \*/ |
| [487](#L487) | public function add\_metabox\_classes( $classes ) { |
| [488](#L488) | array\_push( $classes, 'featured-meta-box' ); |
| [489](#L489) |  |
| [490](#L490) | return $classes; |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | /\*\* |
| [494](#L494) | \* Add custom fields in media uploader. |
| [495](#L495) | \* |
| [496](#L496) | \* @since  3.4.0 |
| [497](#L497) | \* |
| [498](#L498) | \* @param array $form\_fields Fields to include in media attachment form. |
| [499](#L499) | \* @param array $post Post data. |
| [500](#L500) | \* |
| [501](#L501) | \* @return array |
| [502](#L502) | \*/ |
| [503](#L503) | public function media\_attachment\_custom\_fields( $form\_fields, $post ) { |
| [504](#L504) | $form\_fields['dfi-link-to-image'] = array( |
| [505](#L505) | 'label' => \_\_( 'Link to Image', self::TEXT\_DOMAIN ), |
| [506](#L506) | 'input' => 'text', |
| [507](#L507) | 'value' => get\_post\_meta( $post->ID, '\_dfi\_link\_to\_image', true ), |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | return $form\_fields; |
| [511](#L511) | } |
| [512](#L512) |  |
| [513](#L513) | /\*\* |
| [514](#L514) | \* Save values of media uploader custom fields. |
| [515](#L515) | \* |
| [516](#L516) | \* @since 3.4.0 |
| [517](#L517) | \* |
| [518](#L518) | \* @param array $post Post data for database. |
| [519](#L519) | \* @param array $attachment Attachment fields from $\_POST form. |
| [520](#L520) | \* |
| [521](#L521) | \* @return array |
| [522](#L522) | \*/ |
| [523](#L523) | public function media\_attachment\_custom\_fields\_save( $post, $attachment ) { |
| [524](#L524) | if ( isset( $attachment['dfi-link-to-image'] ) ) { |
| [525](#L525) | update\_post\_meta( $post['ID'], '\_dfi\_link\_to\_image', $attachment['dfi-link-to-image'] ); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | return $post; |
| [529](#L529) | } |
| [530](#L530) |  |
| [531](#L531) | /\*\* |
| [532](#L532) | \* Update featured images in the database. |
| [533](#L533) | \* |
| [534](#L534) | \* @since 1.0.0 |
| [535](#L535) | \* @access public |
| [536](#L536) | \* |
| [537](#L537) | \* @see  plugin\_basename() |
| [538](#L538) | \* @see  update\_post\_meta() |
| [539](#L539) | \* @see  current\_user\_can() |
| [540](#L540) | \* |
| [541](#L541) | \* @param  int $post\_id Current post id. |
| [542](#L542) | \* |
| [543](#L543) | \* @return bool|null |
| [544](#L544) | \*/ |
| [545](#L545) | public function save\_meta( $post\_id ) { |
| [546](#L546) | // Check auto save. |
| [547](#L547) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) { |
| [548](#L548) | return false; |
| [549](#L549) | } |
| [550](#L550) |  |
| [551](#L551) | if ( ! $this->verify\_nonces() ) { |
| [552](#L552) | return false; |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | // Check permission before saving data. |
| [556](#L556) | if ( current\_user\_can( 'edit\_posts', $post\_id ) && isset( $\_POST['dfiFeatured'] ) ) { // WPCS: CSRF ok. |
| [557](#L557) | $featured\_images = is\_array( $\_POST['dfiFeatured'] ) ? $\_POST['dfiFeatured'] : array(); // WPCS: sanitization ok, CSRF ok. |
| [558](#L558) |  |
| [559](#L559) | update\_post\_meta( $post\_id, 'dfiFeatured', $this->sanitize\_array( $featured\_images ) ); |
| [560](#L560) | } |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | /\*\* |
| [564](#L564) | \* Sanitize array. |
| [565](#L565) | \* |
| [566](#L566) | \* @since 3.6.0 |
| [567](#L567) | \* @access protected |
| [568](#L568) | \* |
| [569](#L569) | \* @param array $input\_array Input array. |
| [570](#L570) | \* |
| [571](#L571) | \* @return array |
| [572](#L572) | \*/ |
| [573](#L573) | protected function sanitize\_array( $input\_array ) { |
| [574](#L574) | $sanitized = array(); |
| [575](#L575) |  |
| [576](#L576) | foreach ( $input\_array as $value ) { |
| [577](#L577) | $sanitized[] = sanitize\_text\_field( wp\_unslash( $value ) ); |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | return $sanitized; |
| [581](#L581) | } |
| [582](#L582) |  |
| [583](#L583) | /\*\* |
| [584](#L584) | \* Verify metabox nonces. |
| [585](#L585) | \* |
| [586](#L586) | \* @access protected |
| [587](#L587) | \* @see  wp\_verify\_nonce() |
| [588](#L588) | \* |
| [589](#L589) | \* @return bool |
| [590](#L590) | \*/ |
| [591](#L591) | protected function verify\_nonces() { |
| [592](#L592) | $keys = preg\_grep( '/dfi\_fimageplug-\d+$/', array\_keys( $\_POST ) ); // WPCS: CSRF ok. |
| [593](#L593) |  |
| [594](#L594) | if ( empty( $keys ) ) { |
| [595](#L595) | return false; |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | foreach ( $keys as $key ) { |
| [599](#L599) | // Verify nonce. |
| [600](#L600) | if ( ! isset( $\_POST[ $key ] ) || |
| [601](#L601) | ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_POST[ $key ] ) ), plugin\_basename( \_\_FILE\_\_ ) ) |
| [602](#L602) | ) { |
| [603](#L603) | return false; |
| [604](#L604) | } |
| [605](#L605) | } |
| [606](#L606) |  |
| [607](#L607) | return true; |
| [608](#L608) | } |
| [609](#L609) |  |
| [610](#L610) | /\*\* |
| [611](#L611) | \* Add update notice. Displayed in plugin update page. |
| [612](#L612) | \* |
| [613](#L613) | \* @since 2.0.0 |
| [614](#L614) | \* @access public |
| [615](#L615) | \* |
| [616](#L616) | \* @return void |
| [617](#L617) | \*/ |
| [618](#L618) | public function update\_notice() { |
| [619](#L619) | $info = \_\_( 'ATTENTION! Please read the <a href="' . self::WIKI\_LINK . '" target="\_blank">DOCUMENTATION</a> properly before update.', |
| [620](#L620) | self::TEXT\_DOMAIN ); |
| [621](#L621) |  |
| [622](#L622) | echo '<span style="color: red; padding: 7px 0; display: block">' . strip\_tags( $info, '<a><b><i><span>' ) . '</span>'; // WPCS: XSS ok. |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | /\*\* |
| [626](#L626) | \* Execute query. |
| [627](#L627) | \* |
| [628](#L628) | \* @param string $query Query to execute. |
| [629](#L629) | \* |
| [630](#L630) | \* @return null|string |
| [631](#L631) | \*/ |
| [632](#L632) | private function execute\_query( $query ) { |
| [633](#L633) | return $this->db->get\_var( $query ); |
| [634](#L634) | } |
| [635](#L635) |  |
| [636](#L636) | /\*\* |
| [637](#L637) | \* Get attachment id of the image by image url. |
| [638](#L638) | \* |
| [639](#L639) | \* @since 3.1.7 |
| [640](#L640) | \* @access protected |
| [641](#L641) | \* @global object $wpdb |
| [642](#L642) | \* |
| [643](#L643) | \* @param  string $image\_url URL of an image. |
| [644](#L644) | \* |
| [645](#L645) | \* @return string |
| [646](#L646) | \*/ |
| [647](#L647) | protected function get\_attachment\_id( $image\_url ) { |
| [648](#L648) | return $this->execute\_query( $this->db->prepare( 'SELECT ID FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | /\*\* |
| [652](#L652) | \* Get image url of the image by attachment id. |
| [653](#L653) | \* |
| [654](#L654) | \* @since 2.0.0 |
| [655](#L655) | \* @access public |
| [656](#L656) | \* |
| [657](#L657) | \* @see  wp\_get\_attachment\_image\_src() |
| [658](#L658) | \* |
| [659](#L659) | \* @param  int    $attachment\_id attachment id of an image. |
| [660](#L660) | \* @param  string $size size of the image to fetch (thumbnail, medium, full). |
| [661](#L661) | \* |
| [662](#L662) | \* @return string |
| [663](#L663) | \*/ |
| [664](#L664) | public function get\_image\_url( $attachment\_id, $size = 'full' ) { |
| [665](#L665) | $image\_thumb = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [666](#L666) |  |
| [667](#L667) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | /\*\* |
| [671](#L671) | \* Get image thumbnail url of specific size by attachment id. |
| [672](#L672) | \* |
| [673](#L673) | \* @since 3.7.0 |
| [674](#L674) | \* @access public |
| [675](#L675) | \* |
| [676](#L676) | \* @see wp\_get\_attachment\_image\_src() |
| [677](#L677) | \* |
| [678](#L678) | \* @param int $attachment\_id attachment id of an image. |
| [679](#L679) | \* @param string $size size of the image to fetch (thumbnail, medium, full). |
| [680](#L680) | \* |
| [681](#L681) | \* @return string|null |
| [682](#L682) | \*/ |
| [683](#L683) | public function get\_image\_thumb\_by\_attachment\_id( $attachment\_id, $size = 'thumbnail' ) { |
| [684](#L684) | if ( empty( $attachment\_id ) ) { |
| [685](#L685) | return null; |
| [686](#L686) | } |
| [687](#L687) |  |
| [688](#L688) | $image\_thumb = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [689](#L689) |  |
| [690](#L690) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [691](#L691) | } |
| [692](#L692) |  |
| [693](#L693) | /\*\* |
| [694](#L694) | \* Get image thumbnail url of specific size by image url. |
| [695](#L695) | \* |
| [696](#L696) | \* @since 2.0.0 |
| [697](#L697) | \* @access public |
| [698](#L698) | \* |
| [699](#L699) | \* @see  get\_image\_id() |
| [700](#L700) | \* @see  wp\_get\_attachment\_image\_src() |
| [701](#L701) | \* |
| [702](#L702) | \* @param  string $image\_url url of an image. |
| [703](#L703) | \* @param  string $size size of the image to fetch (thumbnail, medium, full). |
| [704](#L704) | \* |
| [705](#L705) | \* @return string |
| [706](#L706) | \*/ |
| [707](#L707) | public function get\_image\_thumb( $image\_url, $size = 'thumbnail' ) { |
| [708](#L708) | $attachment\_id = $this->get\_image\_id( $image\_url ); |
| [709](#L709) | $image\_thumb   = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [710](#L710) |  |
| [711](#L711) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Gets attachment id from given image url. |
| [716](#L716) | \* |
| [717](#L717) | \* @param  string $image\_url url of an image. |
| [718](#L718) | \* |
| [719](#L719) | \* @since  2.0.0 |
| [720](#L720) | \* @access public |
| [721](#L721) | \* |
| [722](#L722) | \* @return int|null attachment id of an image |
| [723](#L723) | \*/ |
| [724](#L724) | public function get\_image\_id( $image\_url ) { |
| [725](#L725) | $attachment\_id = $this->get\_attachment\_id( $image\_url ); |
| [726](#L726) |  |
| [727](#L727) | if ( is\_null( $attachment\_id ) ) { |
| [728](#L728) | /\* |
| [729](#L729) | \* Check if the image is an edited image. |
| [730](#L730) | \* and try to get the attachment id. |
| [731](#L731) | \*/ |
| [732](#L732) |  |
| [733](#L733) | global $wp\_version; |
| [734](#L734) |  |
| [735](#L735) | if ( intval( $wp\_version ) >= 4 ) { |
| [736](#L736) | return attachment\_url\_to\_postid( $image\_url ); |
| [737](#L737) | } |
| [738](#L738) |  |
| [739](#L739) | // Fallback. |
| [740](#L740) | $image\_url = str\_replace( $this->upload\_url . '/', '', $image\_url ); |
| [741](#L741) |  |
| [742](#L742) | $row = $this->execute\_query( $this->db->prepare( 'SELECT post\_id FROM ' . $this->db->postmeta . ' WHERE meta\_key = %s AND meta\_value = %s', '\_wp\_attached\_file', $image\_url ) ); |
| [743](#L743) | if ( ! is\_null( $row ) ) { |
| [744](#L744) | $attachment\_id = $row; |
| [745](#L745) | } |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | return $attachment\_id; |
| [749](#L749) | } |
| [750](#L750) |  |
| [751](#L751) | /\*\* |
| [752](#L752) | \* Get image title. |
| [753](#L753) | \* |
| [754](#L754) | \* @since 2.0.0 |
| [755](#L755) | \* @access public |
| [756](#L756) | \* |
| [757](#L757) | \* @param string $image\_url URL of an image. |
| [758](#L758) | \* |
| [759](#L759) | \* @return string |
| [760](#L760) | \*/ |
| [761](#L761) | public function get\_image\_title( $image\_url ) { |
| [762](#L762) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_title FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | /\*\* |
| [766](#L766) | \* Get image title by id. |
| [767](#L767) | \* |
| [768](#L768) | \* @since 2.0.0 |
| [769](#L769) | \* @access public |
| [770](#L770) | \* |
| [771](#L771) | \* @param  int $attachment\_id Attachment id of an image. |
| [772](#L772) | \* |
| [773](#L773) | \* @return string |
| [774](#L774) | \*/ |
| [775](#L775) | public function get\_image\_title\_by\_id( $attachment\_id ) { |
| [776](#L776) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_title FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [777](#L777) | } |
| [778](#L778) |  |
| [779](#L779) | /\*\* |
| [780](#L780) | \* Get image caption. |
| [781](#L781) | \* |
| [782](#L782) | \* @since 2.0.0 |
| [783](#L783) | \* @access public |
| [784](#L784) | \* |
| [785](#L785) | \* @param  string $image\_url URL of an image. |
| [786](#L786) | \* |
| [787](#L787) | \* @return string |
| [788](#L788) | \*/ |
| [789](#L789) | public function get\_image\_caption( $image\_url ) { |
| [790](#L790) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_excerpt FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | /\*\* |
| [794](#L794) | \* Get image caption by id. |
| [795](#L795) | \* |
| [796](#L796) | \* @since 2.0.0 |
| [797](#L797) | \* @access public |
| [798](#L798) | \* |
| [799](#L799) | \* @param  int $attachment\_id Attachment id of an image. |
| [800](#L800) | \* |
| [801](#L801) | \* @return string |
| [802](#L802) | \*/ |
| [803](#L803) | public function get\_image\_caption\_by\_id( $attachment\_id ) { |
| [804](#L804) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_excerpt FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | /\*\* |
| [808](#L808) | \* Get image alternate text. |
| [809](#L809) | \* |
| [810](#L810) | \* @since 2.0.0 |
| [811](#L811) | \* @access public |
| [812](#L812) | \* |
| [813](#L813) | \* @see  get\_post\_meta() |
| [814](#L814) | \* |
| [815](#L815) | \* @param  string $image\_url URL of an image. |
| [816](#L816) | \* |
| [817](#L817) | \* @return string |
| [818](#L818) | \*/ |
| [819](#L819) | public function get\_image\_alt( $image\_url ) { |
| [820](#L820) | $attachment = $this->db->get\_col( $this->db->prepare( 'SELECT ID FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [821](#L821) |  |
| [822](#L822) | $alt = null; |
| [823](#L823) | if ( ! empty( $attachment ) ) { |
| [824](#L824) | $alt = get\_post\_meta( $attachment[0], '\_wp\_attachment\_image\_alt' ); |
| [825](#L825) | } |
| [826](#L826) |  |
| [827](#L827) | return ( is\_null( $alt ) || empty( $alt ) ) ? null : $alt[0]; |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | /\*\* |
| [831](#L831) | \* Get image alternate text by attachment id. |
| [832](#L832) | \* |
| [833](#L833) | \* @since 2.0.0 |
| [834](#L834) | \* @access public |
| [835](#L835) | \* |
| [836](#L836) | \* @see  get\_post\_meta() |
| [837](#L837) | \* |
| [838](#L838) | \* @param  int $attachment\_id Attachment id of an image. |
| [839](#L839) | \* |
| [840](#L840) | \* @return string |
| [841](#L841) | \*/ |
| [842](#L842) | public function get\_image\_alt\_by\_id( $attachment\_id ) { |
| [843](#L843) | $alt = get\_post\_meta( $attachment\_id, '\_wp\_attachment\_image\_alt' ); |
| [844](#L844) |  |
| [845](#L845) | return empty( $alt ) ? null : $alt[0]; |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* Get image description. |
| [850](#L850) | \* |
| [851](#L851) | \* @since 3.0.0 |
| [852](#L852) | \* @access public |
| [853](#L853) | \* |
| [854](#L854) | \* @param  string $image\_url URL of an image. |
| [855](#L855) | \* |
| [856](#L856) | \* @return string |
| [857](#L857) | \*/ |
| [858](#L858) | public function get\_image\_description( $image\_url ) { |
| [859](#L859) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_content FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | /\*\* |
| [863](#L863) | \* Get image description by id. |
| [864](#L864) | \* |
| [865](#L865) | \* @since 3.0.0 |
| [866](#L866) | \* @access public |
| [867](#L867) | \* |
| [868](#L868) | \* @param  int $attachment\_id attachment id of an image. |
| [869](#L869) | \* |
| [870](#L870) | \* @return string |
| [871](#L871) | \*/ |
| [872](#L872) | public function get\_image\_description\_by\_id( $attachment\_id ) { |
| [873](#L873) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_content FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | /\*\* |
| [877](#L877) | \* Get link to image. |
| [878](#L878) | \* |
| [879](#L879) | \* @since 3.4.0 |
| [880](#L880) | \* @access public |
| [881](#L881) | \* |
| [882](#L882) | \* @param  int $attachment\_id Attachment id of an image. |
| [883](#L883) | \* |
| [884](#L884) | \* @return string|null |
| [885](#L885) | \*/ |
| [886](#L886) | public function get\_link\_to\_image( $attachment\_id ) { |
| [887](#L887) | return get\_post\_meta( $attachment\_id, '\_dfi\_link\_to\_image', true ); |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) | /\*\* |
| [891](#L891) | \* Get all attachment ids of the post. |
| [892](#L892) | \* |
| [893](#L893) | \* @since 2.0.0 |
| [894](#L894) | \* @access public |
| [895](#L895) | \* |
| [896](#L896) | \* @see  get\_post\_meta() |
| [897](#L897) | \* |
| [898](#L898) | \* @param  int $post\_id id of the current post. |
| [899](#L899) | \* |
| [900](#L900) | \* @return array |
| [901](#L901) | \*/ |
| [902](#L902) | public function get\_post\_attachment\_ids( $post\_id ) { |
| [903](#L903) | $dfi\_images = get\_post\_meta( $post\_id, 'dfiFeatured', true ); |
| [904](#L904) | $ret\_val    = array(); |
| [905](#L905) |  |
| [906](#L906) | if ( ! empty( $dfi\_images ) && is\_array( $dfi\_images ) ) { |
| [907](#L907) | foreach ( $dfi\_images as $dfi\_image ) { |
| [908](#L908) | $dfi\_image\_full = $this->separate( $dfi\_image, 'full' ); |
| [909](#L909) | $ret\_val[]      = (int) $this->get\_image\_id( $this->upload\_url . $dfi\_image\_full ); |
| [910](#L910) | } |
| [911](#L911) | } |
| [912](#L912) |  |
| [913](#L913) | return $ret\_val; |
| [914](#L914) | } |
| [915](#L915) |  |
| [916](#L916) | /\*\* |
| [917](#L917) | \* Get real post id. |
| [918](#L918) | \* |
| [919](#L919) | \* @since 3.6.0 |
| [920](#L920) | \* @access protected |
| [921](#L921) | \* |
| [922](#L922) | \* @param int|null $post\_id Post id. |
| [923](#L923) | \* |
| [924](#L924) | \* @return int|null |
| [925](#L925) | \*/ |
| [926](#L926) | protected function get\_real\_post\_id( $post\_id = null ) { |
| [927](#L927) | if ( ! is\_null( $post\_id ) && is\_numeric( $post\_id ) ) { |
| [928](#L928) | return $post\_id; |
| [929](#L929) | } |
| [930](#L930) |  |
| [931](#L931) | global $post; |
| [932](#L932) |  |
| [933](#L933) | return $post->ID; |
| [934](#L934) | } |
| [935](#L935) |  |
| [936](#L936) | /\*\* |
| [937](#L937) | \* Fetches featured image data of nth position. |
| [938](#L938) | \* |
| [939](#L939) | \* @since  3.0.0 |
| [940](#L940) | \* @access  public |
| [941](#L941) | \* |
| [942](#L942) | \* @see  get\_featured\_images() |
| [943](#L943) | \* |
| [944](#L944) | \* @param  int $position Position of the featured image. |
| [945](#L945) | \* @param  int $post\_id Current post id. |
| [946](#L946) | \* |
| [947](#L947) | \* @return array if found, null otherwise. |
| [948](#L948) | \*/ |
| [949](#L949) | public function get\_nth\_featured\_image( $position, $post\_id = null ) { |
| [950](#L950) | $post\_id = $this->get\_real\_post\_id( ( $post\_id ) ); |
| [951](#L951) |  |
| [952](#L952) | $featured\_images = $this->get\_featured\_images( $post\_id ); |
| [953](#L953) |  |
| [954](#L954) | return isset( $featured\_images[ $position - 2 ] ) ? $featured\_images[ $position - 2 ] : null; |
| [955](#L955) | } |
| [956](#L956) |  |
| [957](#L957) | /\*\* |
| [958](#L958) | \* Check if the image is attached with the particular post. |
| [959](#L959) | \* |
| [960](#L960) | \* @since 2.0.0 |
| [961](#L961) | \* @access public |
| [962](#L962) | \* |
| [963](#L963) | \* @see  get\_post\_attachment\_ids() |
| [964](#L964) | \* |
| [965](#L965) | \* @param  int $attachment\_id Attachment id of an image. |
| [966](#L966) | \* @param  int $post\_id Current post id. |
| [967](#L967) | \* |
| [968](#L968) | \* @return bool |
| [969](#L969) | \*/ |
| [970](#L970) | public function is\_attached( $attachment\_id, $post\_id ) { |
| [971](#L971) | if ( empty( $attachment\_id ) ) { |
| [972](#L972) | return false; |
| [973](#L973) | } |
| [974](#L974) |  |
| [975](#L975) | $attachment\_ids = $this->get\_post\_attachment\_ids( $post\_id ); |
| [976](#L976) |  |
| [977](#L977) | return in\_array( $attachment\_id, $attachment\_ids, true ) ? true : false; |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) | /\*\* |
| [981](#L981) | \* Retrieve featured images for specific post(s). |
| [982](#L982) | \* |
| [983](#L983) | \* @since 2.0.0 |
| [984](#L984) | \* @access public |
| [985](#L985) | \* |
| [986](#L986) | \* @see get\_post\_meta() |
| [987](#L987) | \* |
| [988](#L988) | \* @param  int $post\_id id of the current post. |
| [989](#L989) | \* |
| [990](#L990) | \* @return array |
| [991](#L991) | \*/ |
| [992](#L992) | public function get\_featured\_images( $post\_id = null ) { |
| [993](#L993) | $post\_id    = $this->get\_real\_post\_id( $post\_id ); |
| [994](#L994) | $dfi\_images = get\_post\_meta( $post\_id, 'dfiFeatured', true ); |
| [995](#L995) | $ret\_images = array(); |
| [996](#L996) |  |
| [997](#L997) | if ( ! empty( $dfi\_images ) && is\_array( $dfi\_images ) ) { |
| [998](#L998) | $dfi\_images = array\_filter( $dfi\_images ); |
| [999](#L999) |  |
| [1000](#L1000) | $count = 0; |
| [1001](#L1001) | foreach ( $dfi\_images as $dfi\_image ) { |
| [1002](#L1002) | $dfi\_image\_trimmed = $this->separate( $dfi\_image ); |
| [1003](#L1003) | $dfi\_image\_full    = $this->separate( $dfi\_image, 'full' ); |
| [1004](#L1004) |  |
| [1005](#L1005) | try { |
| [1006](#L1006) | $ret\_images[ $count ]['thumb']         = $this->get\_real\_upload\_path( $dfi\_image\_trimmed ); |
| [1007](#L1007) | $ret\_images[ $count ]['full']          = $this->get\_real\_upload\_path( $dfi\_image\_full ); |
| [1008](#L1008) | $ret\_images[ $count ]['attachment\_id'] = $this->get\_image\_id( $ret\_images[ $count ]['full'] ); |
| [1009](#L1009) | } catch ( Exception $e ) { |
| [1010](#L1010) | /\* Ignore the exception and continue with other featured images \*/ |
| [1011](#L1011) | } |
| [1012](#L1012) |  |
| [1013](#L1013) | $count ++; |
| [1014](#L1014) | } |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | return $ret\_images; |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Check to see if the upload url is already available in path. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since  3.1.14 |
| [1024](#L1024) | \* @access protected |
| [1025](#L1025) | \* |
| [1026](#L1026) | \* @param  string $img Uploaded image. |
| [1027](#L1027) | \* |
| [1028](#L1028) | \* @return string |
| [1029](#L1029) | \*/ |
| [1030](#L1030) | protected function get\_real\_upload\_path( $img ) { |
| [1031](#L1031) | // check if upload path is already attached. |
| [1032](#L1032) | if ( false !== strpos( $img, $this->upload\_url ) || preg\_match( '/https?:\/\//', $img ) ) { |
| [1033](#L1033) | return $img; |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | return $this->upload\_url . $img; |
| [1037](#L1037) | } |
| [1038](#L1038) |  |
| [1039](#L1039) | /\*\* |
| [1040](#L1040) | \* Retrieve featured images for specific post(s) including the default Featured Image. |
| [1041](#L1041) | \* |
| [1042](#L1042) | \* @since 3.1.7 |
| [1043](#L1043) | \* @access public |
| [1044](#L1044) | \* |
| [1045](#L1045) | \* @see  $this->get\_featured\_images() |
| [1046](#L1046) | \* |
| [1047](#L1047) | \* @param int $post\_id Current post id. |
| [1048](#L1048) | \* |
| [1049](#L1049) | \* @return array An array of images or an empty array on failure |
| [1050](#L1050) | \*/ |
| [1051](#L1051) | public function get\_all\_featured\_images( $post\_id = null ) { |
| [1052](#L1052) | $post\_id      = $this->get\_real\_post\_id( $post\_id ); |
| [1053](#L1053) | $thumbnail\_id = get\_post\_thumbnail\_id( $post\_id ); |
| [1054](#L1054) | $all\_images   = array(); |
| [1055](#L1055) |  |
| [1056](#L1056) | if ( ! empty( $thumbnail\_id ) ) { |
| [1057](#L1057) | $featured\_image         = array( |
| [1058](#L1058) | 'thumb'         => wp\_get\_attachment\_thumb\_url( $thumbnail\_id ), |
| [1059](#L1059) | 'full'          => wp\_get\_attachment\_url( $thumbnail\_id ), |
| [1060](#L1060) | 'attachment\_id' => $thumbnail\_id, |
| [1061](#L1061) | ); |
| [1062](#L1062) |  |
| [1063](#L1063) | $all\_images[] = $featured\_image; |
| [1064](#L1064) | } |
| [1065](#L1065) |  |
| [1066](#L1066) | return array\_merge( $all\_images, $this->get\_featured\_images( $post\_id ) ); |
| [1067](#L1067) | } |
| [1068](#L1068) |  |
| [1069](#L1069) | /\*\* |
| [1070](#L1070) | \* Load the plugin's textdomain hooked to 'plugins\_loaded'. |
| [1071](#L1071) | \* |
| [1072](#L1072) | \* @since 1.0.0 |
| [1073](#L1073) | \* @access public |
| [1074](#L1074) | \* |
| [1075](#L1075) | \* @see    load\_plugin\_textdomain() |
| [1076](#L1076) | \* @see    plugin\_basename() |
| [1077](#L1077) | \* @action plugins\_loaded |
| [1078](#L1078) | \* |
| [1079](#L1079) | \* @codeCoverageIgnore |
| [1080](#L1080) | \* |
| [1081](#L1081) | \* @return void |
| [1082](#L1082) | \*/ |
| [1083](#L1083) | public function load\_plugin\_textdomain() { |
| [1084](#L1084) | load\_plugin\_textdomain( |
| [1085](#L1085) | self::TEXT\_DOMAIN, |
| [1086](#L1086) | false, |
| [1087](#L1087) | dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/' |
| [1088](#L1088) | ); |
| [1089](#L1089) | } |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Sponsors who support this plugin. |
| [1093](#L1093) | include 'sponsors.php'; |
| [1094](#L1094) |  |
| [1095](#L1095) | /\*\* |
| [1096](#L1096) | \* Instantiate the main class. |
| [1097](#L1097) | \* |
| [1098](#L1098) | \* @since 1.0.0 |
| [1099](#L1099) | \* @access public |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @var object $dynamic\_featured\_image holds the instantiated class {@uses Dynamic\_Featured\_Image} |
| [1102](#L1102) | \*/ |
| [1103](#L1103) | global $dynamic\_featured\_image; |
| [1104](#L1104) | $dynamic\_featured\_image = new Dynamic\_Featured\_Image(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?format=txt)
* [Original Format](/export/3220525/dynamic-featured-image/trunk/dynamic-featured-image.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_176beddd_20250111_043053.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fdynamic-featured-image%2Ftrunk%2Fdynamic-featured-image.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?rev=1988001 "Revision 1988001")
* Next Revision →
* [Blame](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/dynamic-featured-image/trunk/dynamic-featured-image.php)

---

# [source:](/browser?order=name "Go to repository root") [dynamic-featured-image](/browser/dynamic-featured-image?order=name "View dynamic-featured-image")/[trunk](/browser/dynamic-featured-image/trunk?order=name "View trunk")/[dynamic-featured-image.php](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?order=name "View dynamic-featured-image.php")

View diff against:

View revision:

| [Last change](/changeset/2068424/dynamic-featured-image/trunk/dynamic-featured-image.php "View differences") on this file was [2068424](/changeset/2068424/ "View changeset 2068424"), checked in by ankitpokhrel, [6 years ago](/timeline?from=2019-04-14T09%3A41%3A22Z&precision=second "See timeline at 04/14/2019 09:41:22 AM") |
| --- |
| Version 3.7.0 |
| **File size:** 32.9 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Plugin Name: Dynamic Featured Image |
| [4](#L4) | \* Plugin URI: http://wordpress.org/plugins/dynamic-featured-image/ |
| [5](#L5) | \* Description: Dynamically adds multiple featured image or post thumbnail functionality to your posts, pages and custom post types. |
| [6](#L6) | \* Version: 3.7.0 |
| [7](#L7) | \* Author: Ankit Pokhrel |
| [8](#L8) | \* Author URI: https://ankitpokhrel.com |
| [9](#L9) | \* License: GPL2 or later |
| [10](#L10) | \* License URI: http://www.gnu.org/licenses/gpl-2.0.html |
| [11](#L11) | \* Text Domain: dynamic-featured-image |
| [12](#L12) | \* Domain Path: /languages |
| [13](#L13) | \* GitHub Plugin URI: https://github.com/ankitpokhrel/Dynamic-Featured-Image |
| [14](#L14) | \* |
| [15](#L15) | \* @package dynamic-featured-image |
| [16](#L16) | \* |
| [17](#L17) | \* Copyright (C) 2013-2019 Ankit Pokhrel <info@ankitpokhrel.com, https://ankitpokhrel.com> |
| [18](#L18) | \* |
| [19](#L19) | \* This program is free software; you can redistribute it and/or modify |
| [20](#L20) | \* it under the terms of the GNU General Public License as published by |
| [21](#L21) | \* the Free Software Foundation; either version 3 of the License, or |
| [22](#L22) | \* (at your option) any later version. |
| [23](#L23) | \* |
| [24](#L24) | \* This program is distributed in the hope that it will be useful, |
| [25](#L25) | \* but WITHOUT ANY WARRANTY; without even the implied warranty of |
| [26](#L26) | \* MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the |
| [27](#L27) | \* GNU General Public License for more details. |
| [28](#L28) | \* |
| [29](#L29) | \* You should have received a copy of the GNU General Public License |
| [30](#L30) | \* along with this program.  If not, see <http://www.gnu.org/licenses/>. |
| [31](#L31) | \*/ |
| [32](#L32) |  |
| [33](#L33) | // Avoid direct calls to this file. |
| [34](#L34) | if ( ! defined( 'ABSPATH' ) ) { |
| [35](#L35) | header( 'Status: 403 Forbidden' ); |
| [36](#L36) | header( 'HTTP/1.1 403 Forbidden' ); |
| [37](#L37) | exit(); |
| [38](#L38) | } |
| [39](#L39) |  |
| [40](#L40) | /\*\* |
| [41](#L41) | \* Dynamic Featured Image plugin main class. |
| [42](#L42) | \* |
| [43](#L43) | \* @author Ankit Pokhrel <info@ankitpokhrel.com> |
| [44](#L44) | \* @version 3.7.0 |
| [45](#L45) | \*/ |
| [46](#L46) | class Dynamic\_Featured\_Image { |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Current version of the plugin. |
| [49](#L49) | \* |
| [50](#L50) | \* @since 3.0.0 |
| [51](#L51) | \*/ |
| [52](#L52) | const VERSION = '3.7.0'; |
| [53](#L53) |  |
| [54](#L54) | /\*\* |
| [55](#L55) | \* Text domain. |
| [56](#L56) | \* |
| [57](#L57) | \* @since 3.6.0 |
| [58](#L58) | \*/ |
| [59](#L59) | const TEXT\_DOMAIN = 'dynamic-featured-image'; |
| [60](#L60) |  |
| [61](#L61) | /\*\* |
| [62](#L62) | \* Documentation Link. |
| [63](#L63) | \* |
| [64](#L64) | \* @since 3.6.0 |
| [65](#L65) | \*/ |
| [66](#L66) | const WIKI\_LINK = 'https://github.com/ankitpokhrel/Dynamic-Featured-Image/wiki/'; |
| [67](#L67) |  |
| [68](#L68) | /\*\* |
| [69](#L69) | \* Upgrade Link. |
| [70](#L70) | \* |
| [71](#L71) | \* @since 3.6.0 |
| [72](#L72) | \*/ |
| [73](#L73) | const UPGRADE\_LINK = 'https://ankitpokhrel.com/explore/dynamic-featured-image-pro/'; |
| [74](#L74) |  |
| [75](#L75) | /\*\* |
| [76](#L76) | \* Image upload directory. |
| [77](#L77) | \* |
| [78](#L78) | \* @var $upload\_dir string |
| [79](#L79) | \*/ |
| [80](#L80) | private $upload\_dir; |
| [81](#L81) |  |
| [82](#L82) | /\*\* |
| [83](#L83) | \* Image upload URL. |
| [84](#L84) | \* |
| [85](#L85) | \* @var $upload\_url string |
| [86](#L86) | \*/ |
| [87](#L87) | private $upload\_url; |
| [88](#L88) |  |
| [89](#L89) | /\*\* |
| [90](#L90) | \* Database object. |
| [91](#L91) | \* |
| [92](#L92) | \* @var $db wpdb |
| [93](#L93) | \*/ |
| [94](#L94) | private $db; |
| [95](#L95) |  |
| [96](#L96) | /\*\* |
| [97](#L97) | \* Title for dfi metabox. |
| [98](#L98) | \* |
| [99](#L99) | \* @var $metabox\_title string |
| [100](#L100) | \*/ |
| [101](#L101) | protected $metabox\_title; |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Users post type filter for dfi metabox. |
| [105](#L105) | \* |
| [106](#L106) | \* @var $user\_filter array |
| [107](#L107) | \*/ |
| [108](#L108) | protected $user\_filter; |
| [109](#L109) |  |
| [110](#L110) | /\*\* |
| [111](#L111) | \* Constructor. Hooks all interactions to initialize the class. |
| [112](#L112) | \* |
| [113](#L113) | \* @since 1.0.0 |
| [114](#L114) | \* @access public |
| [115](#L115) | \* @global object $wpdb |
| [116](#L116) | \* |
| [117](#L117) | \* @see     add\_action() |
| [118](#L118) | \*/ |
| [119](#L119) | public function \_\_construct() { |
| [120](#L120) | // plugin update warning. |
| [121](#L121) | add\_action( 'in\_plugin\_update\_message-' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'update\_notice' ) ); |
| [122](#L122) |  |
| [123](#L123) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_admin\_scripts' ) ); |
| [124](#L124) | add\_action( 'add\_meta\_boxes', array( $this, 'initialize\_featured\_box' ) ); |
| [125](#L125) | add\_action( 'save\_post', array( $this, 'save\_meta' ) ); |
| [126](#L126) | add\_action( 'plugins\_loaded', array( $this, 'load\_plugin\_textdomain' ) ); |
| [127](#L127) |  |
| [128](#L128) | // handle ajax request. |
| [129](#L129) | add\_action( 'wp\_ajax\_dfiMetaBox\_callback', array( $this, 'ajax\_callback' ) ); |
| [130](#L130) |  |
| [131](#L131) | // add action links. |
| [132](#L132) | add\_filter( 'plugin\_action\_links\_' . plugin\_basename( \_\_FILE\_\_ ), array( $this, 'dfi\_action\_links' ) ); |
| [133](#L133) |  |
| [134](#L134) | // media uploader custom fields. |
| [135](#L135) | add\_filter( 'attachment\_fields\_to\_edit', array( $this, 'media\_attachment\_custom\_fields' ), 10, 2 ); |
| [136](#L136) | add\_filter( 'attachment\_fields\_to\_save', array( $this, 'media\_attachment\_custom\_fields\_save' ), 10, 2 ); |
| [137](#L137) |  |
| [138](#L138) | // plugin sponsors. |
| [139](#L139) | new PluginSponsor(); |
| [140](#L140) |  |
| [141](#L141) | // get the site protocol. |
| [142](#L142) | $protocol = $this->get\_protocol(); |
| [143](#L143) |  |
| [144](#L144) | $this->upload\_dir = wp\_upload\_dir(); |
| [145](#L145) | $this->upload\_url = preg\_replace( '#^https?://#', '', $this->upload\_dir['baseurl'] ); |
| [146](#L146) |  |
| [147](#L147) | // add protocol to the upload url. |
| [148](#L148) | $this->upload\_url = $protocol . $this->upload\_url; |
| [149](#L149) |  |
| [150](#L150) | // post type filter added by user. |
| [151](#L151) | $this->user\_filter = array(); |
| [152](#L152) |  |
| [153](#L153) | global $wpdb; |
| [154](#L154) | $this->db = $wpdb; |
| [155](#L155) | } |
| [156](#L156) |  |
| [157](#L157) | /\*\* |
| [158](#L158) | \* Return site protocol. |
| [159](#L159) | \* |
| [160](#L160) | \* @since 3.5.1 |
| [161](#L161) | \* @access public |
| [162](#L162) | \* |
| [163](#L163) | \* @return string |
| [164](#L164) | \*/ |
| [165](#L165) | private function get\_protocol() { |
| [166](#L166) | return is\_ssl() ? 'https://' : 'http://'; |
| [167](#L167) | } |
| [168](#L168) |  |
| [169](#L169) | /\*\* |
| [170](#L170) | \* Add required admin scripts. |
| [171](#L171) | \* |
| [172](#L172) | \* @since 1.0.0 |
| [173](#L173) | \* @access public |
| [174](#L174) | \* |
| [175](#L175) | \* @see  wp\_enqueue\_style() |
| [176](#L176) | \* @see  wp\_register\_script() |
| [177](#L177) | \* @see  wp\_enqueue\_script() |
| [178](#L178) | \* |
| [179](#L179) | \* @return void |
| [180](#L180) | \*/ |
| [181](#L181) | public function enqueue\_admin\_scripts() { |
| [182](#L182) | // enqueue styles. |
| [183](#L183) | wp\_enqueue\_style( 'style-dfi', plugins\_url( '/css/style-dfi.css', \_\_FILE\_\_ ), array(), self::VERSION ); |
| [184](#L184) |  |
| [185](#L185) | // register script. |
| [186](#L186) | wp\_register\_script( 'scripts-dfi', plugins\_url( '/js/script-dfi.js', \_\_FILE\_\_ ), array( 'jquery' ), self::VERSION ); |
| [187](#L187) |  |
| [188](#L188) | // localize the script with required data. |
| [189](#L189) | wp\_localize\_script( |
| [190](#L190) | 'scripts-dfi', |
| [191](#L191) | 'DFI\_SPECIFIC', |
| [192](#L192) | array( |
| [193](#L193) | 'upload\_url'               => $this->upload\_url, |
| [194](#L194) | 'metabox\_title'            => \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ), |
| [195](#L195) | 'mediaSelector\_title'      => \_\_( 'Dynamic Featured Image - Media Selector', self::TEXT\_DOMAIN ), |
| [196](#L196) | 'mediaSelector\_buttonText' => \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ), |
| [197](#L197) | 'ajax\_nonce'               => wp\_create\_nonce( plugin\_basename( \_\_FILE\_\_ ) ), |
| [198](#L198) | ) |
| [199](#L199) | ); |
| [200](#L200) |  |
| [201](#L201) | // enqueue scripts. |
| [202](#L202) | wp\_enqueue\_script( 'scripts-dfi' ); |
| [203](#L203) | } |
| [204](#L204) |  |
| [205](#L205) | /\*\* |
| [206](#L206) | \* Add upgrade link. |
| [207](#L207) | \* |
| [208](#L208) | \* @access public |
| [209](#L209) | \* @since  3.5.1 |
| [210](#L210) | \* @action plugin\_action\_links |
| [211](#L211) | \* |
| [212](#L212) | \* @codeCoverageIgnore |
| [213](#L213) | \* |
| [214](#L214) | \* @param  array $links Action links. |
| [215](#L215) | \* |
| [216](#L216) | \* @return array |
| [217](#L217) | \*/ |
| [218](#L218) | public function dfi\_action\_links( $links ) { |
| [219](#L219) | $upgrade\_link = array( |
| [220](#L220) | '<a href="' . self::UPGRADE\_LINK . '" target="\_blank">Upgrade to Premium</a>' |
| [221](#L221) | ); |
| [222](#L222) |  |
| [223](#L223) | return array\_merge( $links, $upgrade\_link ); |
| [224](#L224) | } |
| [225](#L225) |  |
| [226](#L226) | /\*\* |
| [227](#L227) | \* Add featured meta boxes dynamically. |
| [228](#L228) | \* |
| [229](#L229) | \* @since 1.0.0 |
| [230](#L230) | \* @access public |
| [231](#L231) | \* @global object $post |
| [232](#L232) | \* |
| [233](#L233) | \* @see  get\_post\_meta() |
| [234](#L234) | \* @see  get\_post\_types() |
| [235](#L235) | \* @see  add\_meta\_box() |
| [236](#L236) | \* @see  add\_filter() |
| [237](#L237) | \* |
| [238](#L238) | \* @return void |
| [239](#L239) | \*/ |
| [240](#L240) | public function initialize\_featured\_box() { |
| [241](#L241) | global $post; |
| [242](#L242) |  |
| [243](#L243) | // make metabox title dynamic. |
| [244](#L244) | $this->metabox\_title = apply\_filters( 'dfi\_set\_metabox\_title', \_\_( 'Featured Image', self::TEXT\_DOMAIN ) ); |
| [245](#L245) |  |
| [246](#L246) | $featured\_data  = get\_post\_meta( $post->ID, 'dfiFeatured', true ); |
| [247](#L247) | $total\_featured = is\_array( $featured\_data ) ? count( $featured\_data ) : 0; |
| [248](#L248) |  |
| [249](#L249) | $default\_filter    = array( 'attachment', 'revision', 'nav\_menu\_item' ); |
| [250](#L250) | $this->user\_filter = apply\_filters( 'dfi\_post\_type\_user\_filter', $this->user\_filter ); |
| [251](#L251) |  |
| [252](#L252) | $post\_types = array\_diff( get\_post\_types(), array\_merge( $default\_filter, $this->user\_filter ) ); |
| [253](#L253) | $post\_types = apply\_filters( 'dfi\_post\_types', $post\_types ); |
| [254](#L254) |  |
| [255](#L255) | if ( ! empty( $featured\_data ) && $total\_featured >= 1 ) { |
| [256](#L256) | $i = 2; |
| [257](#L257) | foreach ( $featured\_data as $featured ) { |
| [258](#L258) | $this->dfi\_add\_meta\_box( $post\_types, $featured, $i++ ); |
| [259](#L259) | } |
| [260](#L260) | } else { |
| [261](#L261) | $this->dfi\_add\_meta\_box( $post\_types ); |
| [262](#L262) | } |
| [263](#L263) | } |
| [264](#L264) |  |
| [265](#L265) | /\*\* |
| [266](#L266) | \* Translates more than one digit number digit by digit. |
| [267](#L267) | \* |
| [268](#L268) | \* @param  int $number Integer to be translated. |
| [269](#L269) | \* |
| [270](#L270) | \* @return string Translated number |
| [271](#L271) | \*/ |
| [272](#L272) | protected function get\_number\_translation( $number ) { |
| [273](#L273) | if ( $number <= 9 ) { |
| [274](#L274) | return \_\_( $number, self::TEXT\_DOMAIN ); |
| [275](#L275) | } else { |
| [276](#L276) | $pieces = str\_split( $number, 1 ); |
| [277](#L277) | $buffer = ''; |
| [278](#L278) | foreach ( $pieces as $piece ) { |
| [279](#L279) | $buffer .= \_\_( $piece, self::TEXT\_DOMAIN ); |
| [280](#L280) | } |
| [281](#L281) |  |
| [282](#L282) | return $buffer; |
| [283](#L283) | } |
| [284](#L284) | } |
| [285](#L285) |  |
| [286](#L286) | /\*\* |
| [287](#L287) | \* Adds meta boxes. |
| [288](#L288) | \* |
| [289](#L289) | \* @param  array  $post\_types Post types to show featured image box. |
| [290](#L290) | \* @param  object $featured Callback arguments. |
| [291](#L291) | \* @param  int    $i Index of the featured image. |
| [292](#L292) | \* |
| [293](#L293) | \* @return void |
| [294](#L294) | \*/ |
| [295](#L295) | private function dfi\_add\_meta\_box( $post\_types, $featured = null, $i = null ) { |
| [296](#L296) | if ( ! is\_null( $i ) ) { |
| [297](#L297) | foreach ( $post\_types as $type ) { |
| [298](#L298) | add\_meta\_box( |
| [299](#L299) | 'dfiFeaturedMetaBox-' . $i, |
| [300](#L300) | \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ) . ' ' . $this->get\_number\_translation( $i ), |
| [301](#L301) | array( $this, 'featured\_meta\_box' ), |
| [302](#L302) | $type, |
| [303](#L303) | apply\_filters( 'dfi\_metabox\_context', 'side' ), |
| [304](#L304) | apply\_filters( 'dfi\_metabox\_priority', 'low' ), |
| [305](#L305) | array( $featured, $i + 1 ) |
| [306](#L306) | ); |
| [307](#L307) |  |
| [308](#L308) | add\_filter( "postbox\_classes\_{$type}\_dfiFeaturedMetaBox-" . $i, array( $this, 'add\_metabox\_classes' ) ); |
| [309](#L309) | } |
| [310](#L310) | } else { |
| [311](#L311) | foreach ( $post\_types as $type ) { |
| [312](#L312) | add\_meta\_box( |
| [313](#L313) | 'dfiFeaturedMetaBox', |
| [314](#L314) | \_\_( $this->metabox\_title, self::TEXT\_DOMAIN ) . ' ' . \_\_( 2, self::TEXT\_DOMAIN ), |
| [315](#L315) | array( $this, 'featured\_meta\_box' ), |
| [316](#L316) | $type, |
| [317](#L317) | apply\_filters( 'dfi\_metabox\_context', 'side' ), |
| [318](#L318) | apply\_filters( 'dfi\_metabox\_priority', 'low' ), |
| [319](#L319) | array( null, null ) |
| [320](#L320) | ); |
| [321](#L321) |  |
| [322](#L322) | add\_filter( "postbox\_classes\_{$type}\_dfiFeaturedMetaBox", array( $this, 'add\_metabox\_classes' ) ); |
| [323](#L323) | } |
| [324](#L324) | } |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) | /\*\* |
| [328](#L328) | \* Separate thumb and full image url from given URL string. |
| [329](#L329) | \* |
| [330](#L330) | \* @since  3.3.1 |
| [331](#L331) | \* |
| [332](#L332) | \* @param  string $url\_string Url string. |
| [333](#L333) | \* @param  string $state Thumb or full. |
| [334](#L334) | \* |
| [335](#L335) | \* @return string|null |
| [336](#L336) | \*/ |
| [337](#L337) | private function separate( $url\_string, $state = 'thumb' ) { |
| [338](#L338) | $image\_piece = explode( ',', $url\_string ); |
| [339](#L339) |  |
| [340](#L340) | if ( 'thumb' === $state ) { |
| [341](#L341) | return isset( $image\_piece[0] ) ? $image\_piece[0] : null; |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | return isset( $image\_piece[1] ) ? $image\_piece[1] : null; |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | /\*\* |
| [348](#L348) | \* Create a nonce field. |
| [349](#L349) | \* |
| [350](#L350) | \* @since  3.5.0 |
| [351](#L351) | \* |
| [352](#L352) | \* @see  wp\_nonce\_field() |
| [353](#L353) | \* @see  plugin\_basename() |
| [354](#L354) | \* |
| [355](#L355) | \* @codeCoverageIgnore |
| [356](#L356) | \* |
| [357](#L357) | \* @param  string $key Nonce key. |
| [358](#L358) | \* |
| [359](#L359) | \* @return string |
| [360](#L360) | \*/ |
| [361](#L361) | protected function nonce\_field( $key ) { |
| [362](#L362) | return wp\_nonce\_field( plugin\_basename( \_\_FILE\_\_ ), $key, true, false ); |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | /\*\* |
| [366](#L366) | \* Featured meta box as seen in the admin. |
| [367](#L367) | \* |
| [368](#L368) | \* @since 1.0.0 |
| [369](#L369) | \* @access public |
| [370](#L370) | \* |
| [371](#L371) | \* @param  object $post Global post object. |
| [372](#L372) | \* @param  array  $featured Array containing featured image count. |
| [373](#L373) | \* |
| [374](#L374) | \* @throws Exception Medium size image not found. |
| [375](#L375) | \* @return void |
| [376](#L376) | \*/ |
| [377](#L377) | public function featured\_meta\_box( $post, $featured ) { |
| [378](#L378) | $featured\_img         = $featured['args'][0]; |
| [379](#L379) | $featured\_id          = is\_null( $featured['args'][1] ) ? 2 : --$featured['args'][1]; |
| [380](#L380) | $featured\_img\_full    = $featured\_img; |
| [381](#L381) | $featured\_img\_trimmed = $featured\_img; |
| [382](#L382) |  |
| [383](#L383) | if ( ! is\_null( $featured\_img ) ) { |
| [384](#L384) | $featured\_img\_trimmed = $this->separate( $featured\_img ); |
| [385](#L385) | $featured\_img\_full    = $this->separate( $featured\_img, 'full' ); |
| [386](#L386) | } |
| [387](#L387) |  |
| [388](#L388) | $thumbnail     = null; |
| [389](#L389) | $attachment\_id = null; |
| [390](#L390) | if ( ! empty( $featured\_img\_full ) ) { |
| [391](#L391) | $attachment\_id = $this->get\_image\_id( $this->upload\_url . $featured\_img\_full ); |
| [392](#L392) |  |
| [393](#L393) | $thumbnail = $this->get\_image\_thumb\_by\_attachment\_id( $attachment\_id, 'medium' ); |
| [394](#L394) |  |
| [395](#L395) | if ( empty( $thumbnail ) ) { |
| [396](#L396) | // since medium sized thumbnail image is missing, |
| [397](#L397) | // let's set full image url as thumbnail. |
| [398](#L398) | $thumbnail = $featured\_img\_full; |
| [399](#L399) | } |
| [400](#L400) | } |
| [401](#L401) |  |
| [402](#L402) | // Add a nonce field. |
| [403](#L403) | echo $this->nonce\_field( 'dfi\_fimageplug-' . $featured\_id ); // WPCS: XSS ok. |
| [404](#L404) | echo $this->get\_featured\_box( $featured\_img\_trimmed, $featured\_img, $featured\_id, $thumbnail, $post->ID, $attachment\_id ); // WPCS: XSS ok. |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | /\*\* |
| [408](#L408) | \* Returns featured box html content. |
| [409](#L409) | \* |
| [410](#L410) | \* @since  3.1.0 |
| [411](#L411) | \* @access private |
| [412](#L412) | \* |
| [413](#L413) | \* @param string $featured\_img\_trimmed Medium sized image. |
| [414](#L414) | \* @param string $featured\_img         Full sized image. |
| [415](#L415) | \* @param string $featured\_id          Featured id number for translation. |
| [416](#L416) | \* @param string $thumbnail            Thumb sized image. |
| [417](#L417) | \* @param int    $post\_id              Post id. |
| [418](#L418) | \* @param int    $attachment\_id        Attachment id. |
| [419](#L419) | \* |
| [420](#L420) | \* @return string Html content |
| [421](#L421) | \*/ |
| [422](#L422) | private function get\_featured\_box( $featured\_img\_trimmed, $featured\_img, $featured\_id, $thumbnail, $post\_id, $attachment\_id ) { |
| [423](#L423) | $has\_featured\_image = ! empty( $featured\_img\_trimmed ) ? ' hasFeaturedImage' : ''; |
| [424](#L424) | $thumbnail          = ! is\_null( $thumbnail ) ? $thumbnail : ''; |
| [425](#L425) | $dfi\_empty          = is\_null( $featured\_img\_trimmed ) ? 'dfiImgEmpty' : ''; |
| [426](#L426) |  |
| [427](#L427) | return "<a href='javascript:void(0)' class='dfiFeaturedImage{$has\_featured\_image}' title='" . \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ) . "' data-post-id='" . $post\_id . "' data-attachment-id='" . $attachment\_id . "'><span class='dashicons dashicons-camera'></span></a><br/> |
| [428](#L428) | <img src='" . $thumbnail . "' class='dfiImg {$dfi\_empty}'/> |
| [429](#L429) | <div class='dfiLinks'> |
| [430](#L430) | <a href='javascript:void(0)' data-id='{$featured\_id}' data-id-local='" . $this->get\_number\_translation( $featured\_id + 1 ) . "' class='dfiAddNew dashicons dashicons-plus' title='" . \_\_( 'Add New', self::TEXT\_DOMAIN ) . "'></a> |
| [431](#L431) | <a href='javascript:void(0)' class='dfiRemove dashicons dashicons-minus' title='" . \_\_( 'Remove', self::TEXT\_DOMAIN ) . "'></a> |
| [432](#L432) | </div> |
| [433](#L433) | <div class='dfiClearFloat'></div> |
| [434](#L434) | <input type='hidden' name='dfiFeatured[]' value='{$featured\_img}'  class='dfiImageHolder' />"; |
| [435](#L435) | } |
| [436](#L436) |  |
| [437](#L437) | /\*\* |
| [438](#L438) | \* Load new featured meta box via ajax. |
| [439](#L439) | \* |
| [440](#L440) | \* @since 1.0.0 |
| [441](#L441) | \* @access public |
| [442](#L442) | \* |
| [443](#L443) | \* @return void |
| [444](#L444) | \*/ |
| [445](#L445) | public function ajax\_callback() { |
| [446](#L446) | check\_ajax\_referer( plugin\_basename( \_\_FILE\_\_ ), 'security' ); |
| [447](#L447) |  |
| [448](#L448) | $featured\_id = isset( $\_POST['id'] ) ? intval( wp\_unslash( $\_POST['id'] ) ) : null; |
| [449](#L449) |  |
| [450](#L450) | if ( ! is\_numeric( $featured\_id ) ) { |
| [451](#L451) | return; |
| [452](#L452) | } |
| [453](#L453) |  |
| [454](#L454) | // @codingStandardsIgnoreStart |
| [455](#L455) | echo $this->nonce\_field( 'dfi\_fimageplug-' . $featured\_id ); |
| [456](#L456) | ?> |
| [457](#L457) | <a href="javascript:void(0)" class="dfiFeaturedImage" |
| [458](#L458) | title="<?php echo \_\_( 'Set Featured Image', self::TEXT\_DOMAIN ) ?>"><span |
| [459](#L459) | class="dashicons dashicons-camera"></span></a><br/> |
| [460](#L460) | <img src="" class="dfiImg dfiImgEmpty"/> |
| [461](#L461) | <div class="dfiLinks"> |
| [462](#L462) | <a href="javascript:void(0)" data-id="<?php echo $featured\_id ?>" |
| [463](#L463) | data-id-local="<?php echo $this->get\_number\_translation( $featured\_id + 1 ) ?>" |
| [464](#L464) | class="dfiAddNew dashicons dashicons-plus" title="<?php echo \_\_( 'Add New', self::TEXT\_DOMAIN ) ?>"></a> |
| [465](#L465) | <a href="javascript:void(0)" class="dfiRemove dashicons dashicons-minus" |
| [466](#L466) | title="<?php echo \_\_( 'Remove', self::TEXT\_DOMAIN ) ?>"></a> |
| [467](#L467) | </div> |
| [468](#L468) | <div class="dfiClearFloat"></div> |
| [469](#L469) | <input type="hidden" name="dfiFeatured[]" value="" class="dfiImageHolder"/> |
| [470](#L470) | <?php |
| [471](#L471) | // @codingStandardsIgnoreEnd |
| [472](#L472) | wp\_die( '' ); |
| [473](#L473) | } |
| [474](#L474) |  |
| [475](#L475) | /\*\* |
| [476](#L476) | \* Add custom class 'featured-meta-box' to meta box. |
| [477](#L477) | \* |
| [478](#L478) | \* @since 1.0.0 |
| [479](#L479) | \* @access public |
| [480](#L480) | \* |
| [481](#L481) | \* @see  add\_metabox\_classes |
| [482](#L482) | \* |
| [483](#L483) | \* @param array $classes Classes to add in the meta box. |
| [484](#L484) | \* |
| [485](#L485) | \* @return array |
| [486](#L486) | \*/ |
| [487](#L487) | public function add\_metabox\_classes( $classes ) { |
| [488](#L488) | array\_push( $classes, 'featured-meta-box' ); |
| [489](#L489) |  |
| [490](#L490) | return $classes; |
| [491](#L491) | } |
| [492](#L492) |  |
| [493](#L493) | /\*\* |
| [494](#L494) | \* Add custom fields in media uploader. |
| [495](#L495) | \* |
| [496](#L496) | \* @since  3.4.0 |
| [497](#L497) | \* |
| [498](#L498) | \* @param array $form\_fields Fields to include in media attachment form. |
| [499](#L499) | \* @param array $post Post data. |
| [500](#L500) | \* |
| [501](#L501) | \* @return array |
| [502](#L502) | \*/ |
| [503](#L503) | public function media\_attachment\_custom\_fields( $form\_fields, $post ) { |
| [504](#L504) | $form\_fields['dfi-link-to-image'] = array( |
| [505](#L505) | 'label' => \_\_( 'Link to Image', self::TEXT\_DOMAIN ), |
| [506](#L506) | 'input' => 'text', |
| [507](#L507) | 'value' => get\_post\_meta( $post->ID, '\_dfi\_link\_to\_image', true ), |
| [508](#L508) | ); |
| [509](#L509) |  |
| [510](#L510) | return $form\_fields; |
| [511](#L511) | } |
| [512](#L512) |  |
| [513](#L513) | /\*\* |
| [514](#L514) | \* Save values of media uploader custom fields. |
| [515](#L515) | \* |
| [516](#L516) | \* @since 3.4.0 |
| [517](#L517) | \* |
| [518](#L518) | \* @param array $post Post data for database. |
| [519](#L519) | \* @param array $attachment Attachment fields from $\_POST form. |
| [520](#L520) | \* |
| [521](#L521) | \* @return array |
| [522](#L522) | \*/ |
| [523](#L523) | public function media\_attachment\_custom\_fields\_save( $post, $attachment ) { |
| [524](#L524) | if ( isset( $attachment['dfi-link-to-image'] ) ) { |
| [525](#L525) | update\_post\_meta( $post['ID'], '\_dfi\_link\_to\_image', $attachment['dfi-link-to-image'] ); |
| [526](#L526) | } |
| [527](#L527) |  |
| [528](#L528) | return $post; |
| [529](#L529) | } |
| [530](#L530) |  |
| [531](#L531) | /\*\* |
| [532](#L532) | \* Update featured images in the database. |
| [533](#L533) | \* |
| [534](#L534) | \* @since 1.0.0 |
| [535](#L535) | \* @access public |
| [536](#L536) | \* |
| [537](#L537) | \* @see  plugin\_basename() |
| [538](#L538) | \* @see  update\_post\_meta() |
| [539](#L539) | \* @see  current\_user\_can() |
| [540](#L540) | \* |
| [541](#L541) | \* @param  int $post\_id Current post id. |
| [542](#L542) | \* |
| [543](#L543) | \* @return bool|null |
| [544](#L544) | \*/ |
| [545](#L545) | public function save\_meta( $post\_id ) { |
| [546](#L546) | // Check auto save. |
| [547](#L547) | if ( defined( 'DOING\_AUTOSAVE' ) && DOING\_AUTOSAVE ) { |
| [548](#L548) | return false; |
| [549](#L549) | } |
| [550](#L550) |  |
| [551](#L551) | if ( ! $this->verify\_nonces() ) { |
| [552](#L552) | return false; |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | // Check permission before saving data. |
| [556](#L556) | if ( current\_user\_can( 'edit\_posts', $post\_id ) && isset( $\_POST['dfiFeatured'] ) ) { // WPCS: CSRF ok. |
| [557](#L557) | $featured\_images = is\_array( $\_POST['dfiFeatured'] ) ? $\_POST['dfiFeatured'] : array(); // WPCS: sanitization ok, CSRF ok. |
| [558](#L558) |  |
| [559](#L559) | update\_post\_meta( $post\_id, 'dfiFeatured', $this->sanitize\_array( $featured\_images ) ); |
| [560](#L560) | } |
| [561](#L561) | } |
| [562](#L562) |  |
| [563](#L563) | /\*\* |
| [564](#L564) | \* Sanitize array. |
| [565](#L565) | \* |
| [566](#L566) | \* @since 3.6.0 |
| [567](#L567) | \* @access protected |
| [568](#L568) | \* |
| [569](#L569) | \* @param array $input\_array Input array. |
| [570](#L570) | \* |
| [571](#L571) | \* @return array |
| [572](#L572) | \*/ |
| [573](#L573) | protected function sanitize\_array( $input\_array ) { |
| [574](#L574) | $sanitized = array(); |
| [575](#L575) |  |
| [576](#L576) | foreach ( $input\_array as $value ) { |
| [577](#L577) | $sanitized[] = sanitize\_text\_field( wp\_unslash( $value ) ); |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | return $sanitized; |
| [581](#L581) | } |
| [582](#L582) |  |
| [583](#L583) | /\*\* |
| [584](#L584) | \* Verify metabox nonces. |
| [585](#L585) | \* |
| [586](#L586) | \* @access protected |
| [587](#L587) | \* @see  wp\_verify\_nonce() |
| [588](#L588) | \* |
| [589](#L589) | \* @return bool |
| [590](#L590) | \*/ |
| [591](#L591) | protected function verify\_nonces() { |
| [592](#L592) | $keys = preg\_grep( '/dfi\_fimageplug-\d+$/', array\_keys( $\_POST ) ); // WPCS: CSRF ok. |
| [593](#L593) |  |
| [594](#L594) | if ( empty( $keys ) ) { |
| [595](#L595) | return false; |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | foreach ( $keys as $key ) { |
| [599](#L599) | // Verify nonce. |
| [600](#L600) | if ( ! isset( $\_POST[ $key ] ) || |
| [601](#L601) | ! wp\_verify\_nonce( sanitize\_text\_field( wp\_unslash( $\_POST[ $key ] ) ), plugin\_basename( \_\_FILE\_\_ ) ) |
| [602](#L602) | ) { |
| [603](#L603) | return false; |
| [604](#L604) | } |
| [605](#L605) | } |
| [606](#L606) |  |
| [607](#L607) | return true; |
| [608](#L608) | } |
| [609](#L609) |  |
| [610](#L610) | /\*\* |
| [611](#L611) | \* Add update notice. Displayed in plugin update page. |
| [612](#L612) | \* |
| [613](#L613) | \* @since 2.0.0 |
| [614](#L614) | \* @access public |
| [615](#L615) | \* |
| [616](#L616) | \* @return void |
| [617](#L617) | \*/ |
| [618](#L618) | public function update\_notice() { |
| [619](#L619) | $info = \_\_( 'ATTENTION! Please read the <a href="' . self::WIKI\_LINK . '" target="\_blank">DOCUMENTATION</a> properly before update.', |
| [620](#L620) | self::TEXT\_DOMAIN ); |
| [621](#L621) |  |
| [622](#L622) | echo '<span style="color: red; padding: 7px 0; display: block">' . strip\_tags( $info, '<a><b><i><span>' ) . '</span>'; // WPCS: XSS ok. |
| [623](#L623) | } |
| [624](#L624) |  |
| [625](#L625) | /\*\* |
| [626](#L626) | \* Execute query. |
| [627](#L627) | \* |
| [628](#L628) | \* @param string $query Query to execute. |
| [629](#L629) | \* |
| [630](#L630) | \* @return null|string |
| [631](#L631) | \*/ |
| [632](#L632) | private function execute\_query( $query ) { |
| [633](#L633) | return $this->db->get\_var( $query ); |
| [634](#L634) | } |
| [635](#L635) |  |
| [636](#L636) | /\*\* |
| [637](#L637) | \* Get attachment id of the image by image url. |
| [638](#L638) | \* |
| [639](#L639) | \* @since 3.1.7 |
| [640](#L640) | \* @access protected |
| [641](#L641) | \* @global object $wpdb |
| [642](#L642) | \* |
| [643](#L643) | \* @param  string $image\_url URL of an image. |
| [644](#L644) | \* |
| [645](#L645) | \* @return string |
| [646](#L646) | \*/ |
| [647](#L647) | protected function get\_attachment\_id( $image\_url ) { |
| [648](#L648) | return $this->execute\_query( $this->db->prepare( 'SELECT ID FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [649](#L649) | } |
| [650](#L650) |  |
| [651](#L651) | /\*\* |
| [652](#L652) | \* Get image url of the image by attachment id. |
| [653](#L653) | \* |
| [654](#L654) | \* @since 2.0.0 |
| [655](#L655) | \* @access public |
| [656](#L656) | \* |
| [657](#L657) | \* @see  wp\_get\_attachment\_image\_src() |
| [658](#L658) | \* |
| [659](#L659) | \* @param  int    $attachment\_id attachment id of an image. |
| [660](#L660) | \* @param  string $size size of the image to fetch (thumbnail, medium, full). |
| [661](#L661) | \* |
| [662](#L662) | \* @return string |
| [663](#L663) | \*/ |
| [664](#L664) | public function get\_image\_url( $attachment\_id, $size = 'full' ) { |
| [665](#L665) | $image\_thumb = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [666](#L666) |  |
| [667](#L667) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | /\*\* |
| [671](#L671) | \* Get image thumbnail url of specific size by attachment id. |
| [672](#L672) | \* |
| [673](#L673) | \* @since 3.7.0 |
| [674](#L674) | \* @access public |
| [675](#L675) | \* |
| [676](#L676) | \* @see wp\_get\_attachment\_image\_src() |
| [677](#L677) | \* |
| [678](#L678) | \* @param int $attachment\_id attachment id of an image. |
| [679](#L679) | \* @param string $size size of the image to fetch (thumbnail, medium, full). |
| [680](#L680) | \* |
| [681](#L681) | \* @return string|null |
| [682](#L682) | \*/ |
| [683](#L683) | public function get\_image\_thumb\_by\_attachment\_id( $attachment\_id, $size = 'thumbnail' ) { |
| [684](#L684) | if ( empty( $attachment\_id ) ) { |
| [685](#L685) | return null; |
| [686](#L686) | } |
| [687](#L687) |  |
| [688](#L688) | $image\_thumb = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [689](#L689) |  |
| [690](#L690) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [691](#L691) | } |
| [692](#L692) |  |
| [693](#L693) | /\*\* |
| [694](#L694) | \* Get image thumbnail url of specific size by image url. |
| [695](#L695) | \* |
| [696](#L696) | \* @since 2.0.0 |
| [697](#L697) | \* @access public |
| [698](#L698) | \* |
| [699](#L699) | \* @see  get\_image\_id() |
| [700](#L700) | \* @see  wp\_get\_attachment\_image\_src() |
| [701](#L701) | \* |
| [702](#L702) | \* @param  string $image\_url url of an image. |
| [703](#L703) | \* @param  string $size size of the image to fetch (thumbnail, medium, full). |
| [704](#L704) | \* |
| [705](#L705) | \* @return string |
| [706](#L706) | \*/ |
| [707](#L707) | public function get\_image\_thumb( $image\_url, $size = 'thumbnail' ) { |
| [708](#L708) | $attachment\_id = $this->get\_image\_id( $image\_url ); |
| [709](#L709) | $image\_thumb   = wp\_get\_attachment\_image\_src( $attachment\_id, $size ); |
| [710](#L710) |  |
| [711](#L711) | return empty( $image\_thumb ) ? null : $image\_thumb[0]; |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Gets attachment id from given image url. |
| [716](#L716) | \* |
| [717](#L717) | \* @param  string $image\_url url of an image. |
| [718](#L718) | \* |
| [719](#L719) | \* @since  2.0.0 |
| [720](#L720) | \* @access public |
| [721](#L721) | \* |
| [722](#L722) | \* @return int|null attachment id of an image |
| [723](#L723) | \*/ |
| [724](#L724) | public function get\_image\_id( $image\_url ) { |
| [725](#L725) | $attachment\_id = $this->get\_attachment\_id( $image\_url ); |
| [726](#L726) |  |
| [727](#L727) | if ( is\_null( $attachment\_id ) ) { |
| [728](#L728) | /\* |
| [729](#L729) | \* Check if the image is an edited image. |
| [730](#L730) | \* and try to get the attachment id. |
| [731](#L731) | \*/ |
| [732](#L732) |  |
| [733](#L733) | global $wp\_version; |
| [734](#L734) |  |
| [735](#L735) | if ( intval( $wp\_version ) >= 4 ) { |
| [736](#L736) | return attachment\_url\_to\_postid( $image\_url ); |
| [737](#L737) | } |
| [738](#L738) |  |
| [739](#L739) | // Fallback. |
| [740](#L740) | $image\_url = str\_replace( $this->upload\_url . '/', '', $image\_url ); |
| [741](#L741) |  |
| [742](#L742) | $row = $this->execute\_query( $this->db->prepare( 'SELECT post\_id FROM ' . $this->db->postmeta . ' WHERE meta\_key = %s AND meta\_value = %s', '\_wp\_attached\_file', $image\_url ) ); |
| [743](#L743) | if ( ! is\_null( $row ) ) { |
| [744](#L744) | $attachment\_id = $row; |
| [745](#L745) | } |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | return $attachment\_id; |
| [749](#L749) | } |
| [750](#L750) |  |
| [751](#L751) | /\*\* |
| [752](#L752) | \* Get image title. |
| [753](#L753) | \* |
| [754](#L754) | \* @since 2.0.0 |
| [755](#L755) | \* @access public |
| [756](#L756) | \* |
| [757](#L757) | \* @param string $image\_url URL of an image. |
| [758](#L758) | \* |
| [759](#L759) | \* @return string |
| [760](#L760) | \*/ |
| [761](#L761) | public function get\_image\_title( $image\_url ) { |
| [762](#L762) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_title FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [763](#L763) | } |
| [764](#L764) |  |
| [765](#L765) | /\*\* |
| [766](#L766) | \* Get image title by id. |
| [767](#L767) | \* |
| [768](#L768) | \* @since 2.0.0 |
| [769](#L769) | \* @access public |
| [770](#L770) | \* |
| [771](#L771) | \* @param  int $attachment\_id Attachment id of an image. |
| [772](#L772) | \* |
| [773](#L773) | \* @return string |
| [774](#L774) | \*/ |
| [775](#L775) | public function get\_image\_title\_by\_id( $attachment\_id ) { |
| [776](#L776) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_title FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [777](#L777) | } |
| [778](#L778) |  |
| [779](#L779) | /\*\* |
| [780](#L780) | \* Get image caption. |
| [781](#L781) | \* |
| [782](#L782) | \* @since 2.0.0 |
| [783](#L783) | \* @access public |
| [784](#L784) | \* |
| [785](#L785) | \* @param  string $image\_url URL of an image. |
| [786](#L786) | \* |
| [787](#L787) | \* @return string |
| [788](#L788) | \*/ |
| [789](#L789) | public function get\_image\_caption( $image\_url ) { |
| [790](#L790) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_excerpt FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [791](#L791) | } |
| [792](#L792) |  |
| [793](#L793) | /\*\* |
| [794](#L794) | \* Get image caption by id. |
| [795](#L795) | \* |
| [796](#L796) | \* @since 2.0.0 |
| [797](#L797) | \* @access public |
| [798](#L798) | \* |
| [799](#L799) | \* @param  int $attachment\_id Attachment id of an image. |
| [800](#L800) | \* |
| [801](#L801) | \* @return string |
| [802](#L802) | \*/ |
| [803](#L803) | public function get\_image\_caption\_by\_id( $attachment\_id ) { |
| [804](#L804) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_excerpt FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [805](#L805) | } |
| [806](#L806) |  |
| [807](#L807) | /\*\* |
| [808](#L808) | \* Get image alternate text. |
| [809](#L809) | \* |
| [810](#L810) | \* @since 2.0.0 |
| [811](#L811) | \* @access public |
| [812](#L812) | \* |
| [813](#L813) | \* @see  get\_post\_meta() |
| [814](#L814) | \* |
| [815](#L815) | \* @param  string $image\_url URL of an image. |
| [816](#L816) | \* |
| [817](#L817) | \* @return string |
| [818](#L818) | \*/ |
| [819](#L819) | public function get\_image\_alt( $image\_url ) { |
| [820](#L820) | $attachment = $this->db->get\_col( $this->db->prepare( 'SELECT ID FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [821](#L821) |  |
| [822](#L822) | $alt = null; |
| [823](#L823) | if ( ! empty( $attachment ) ) { |
| [824](#L824) | $alt = get\_post\_meta( $attachment[0], '\_wp\_attachment\_image\_alt' ); |
| [825](#L825) | } |
| [826](#L826) |  |
| [827](#L827) | return ( is\_null( $alt ) || empty( $alt ) ) ? null : $alt[0]; |
| [828](#L828) | } |
| [829](#L829) |  |
| [830](#L830) | /\*\* |
| [831](#L831) | \* Get image alternate text by attachment id. |
| [832](#L832) | \* |
| [833](#L833) | \* @since 2.0.0 |
| [834](#L834) | \* @access public |
| [835](#L835) | \* |
| [836](#L836) | \* @see  get\_post\_meta() |
| [837](#L837) | \* |
| [838](#L838) | \* @param  int $attachment\_id Attachment id of an image. |
| [839](#L839) | \* |
| [840](#L840) | \* @return string |
| [841](#L841) | \*/ |
| [842](#L842) | public function get\_image\_alt\_by\_id( $attachment\_id ) { |
| [843](#L843) | $alt = get\_post\_meta( $attachment\_id, '\_wp\_attachment\_image\_alt' ); |
| [844](#L844) |  |
| [845](#L845) | return empty( $alt ) ? null : $alt[0]; |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* Get image description. |
| [850](#L850) | \* |
| [851](#L851) | \* @since 3.0.0 |
| [852](#L852) | \* @access public |
| [853](#L853) | \* |
| [854](#L854) | \* @param  string $image\_url URL of an image. |
| [855](#L855) | \* |
| [856](#L856) | \* @return string |
| [857](#L857) | \*/ |
| [858](#L858) | public function get\_image\_description( $image\_url ) { |
| [859](#L859) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_content FROM ' . $this->db->posts . ' WHERE guid = %s', $image\_url ) ); |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | /\*\* |
| [863](#L863) | \* Get image description by id. |
| [864](#L864) | \* |
| [865](#L865) | \* @since 3.0.0 |
| [866](#L866) | \* @access public |
| [867](#L867) | \* |
| [868](#L868) | \* @param  int $attachment\_id attachment id of an image. |
| [869](#L869) | \* |
| [870](#L870) | \* @return string |
| [871](#L871) | \*/ |
| [872](#L872) | public function get\_image\_description\_by\_id( $attachment\_id ) { |
| [873](#L873) | return $this->execute\_query( $this->db->prepare( 'SELECT post\_content FROM ' . $this->db->posts . ' WHERE ID = %d', $attachment\_id ) ); |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | /\*\* |
| [877](#L877) | \* Get link to image. |
| [878](#L878) | \* |
| [879](#L879) | \* @since 3.4.0 |
| [880](#L880) | \* @access public |
| [881](#L881) | \* |
| [882](#L882) | \* @param  int $attachment\_id Attachment id of an image. |
| [883](#L883) | \* |
| [884](#L884) | \* @return string|null |
| [885](#L885) | \*/ |
| [886](#L886) | public function get\_link\_to\_image( $attachment\_id ) { |
| [887](#L887) | return get\_post\_meta( $attachment\_id, '\_dfi\_link\_to\_image', true ); |
| [888](#L888) | } |
| [889](#L889) |  |
| [890](#L890) | /\*\* |
| [891](#L891) | \* Get all attachment ids of the post. |
| [892](#L892) | \* |
| [893](#L893) | \* @since 2.0.0 |
| [894](#L894) | \* @access public |
| [895](#L895) | \* |
| [896](#L896) | \* @see  get\_post\_meta() |
| [897](#L897) | \* |
| [898](#L898) | \* @param  int $post\_id id of the current post. |
| [899](#L899) | \* |
| [900](#L900) | \* @return array |
| [901](#L901) | \*/ |
| [902](#L902) | public function get\_post\_attachment\_ids( $post\_id ) { |
| [903](#L903) | $dfi\_images = get\_post\_meta( $post\_id, 'dfiFeatured', true ); |
| [904](#L904) | $ret\_val    = array(); |
| [905](#L905) |  |
| [906](#L906) | if ( ! empty( $dfi\_images ) && is\_array( $dfi\_images ) ) { |
| [907](#L907) | foreach ( $dfi\_images as $dfi\_image ) { |
| [908](#L908) | $dfi\_image\_full = $this->separate( $dfi\_image, 'full' ); |
| [909](#L909) | $ret\_val[]      = (int) $this->get\_image\_id( $this->upload\_url . $dfi\_image\_full ); |
| [910](#L910) | } |
| [911](#L911) | } |
| [912](#L912) |  |
| [913](#L913) | return $ret\_val; |
| [914](#L914) | } |
| [915](#L915) |  |
| [916](#L916) | /\*\* |
| [917](#L917) | \* Get real post id. |
| [918](#L918) | \* |
| [919](#L919) | \* @since 3.6.0 |
| [920](#L920) | \* @access protected |
| [921](#L921) | \* |
| [922](#L922) | \* @param int|null $post\_id Post id. |
| [923](#L923) | \* |
| [924](#L924) | \* @return int|null |
| [925](#L925) | \*/ |
| [926](#L926) | protected function get\_real\_post\_id( $post\_id = null ) { |
| [927](#L927) | if ( ! is\_null( $post\_id ) && is\_numeric( $post\_id ) ) { |
| [928](#L928) | return $post\_id; |
| [929](#L929) | } |
| [930](#L930) |  |
| [931](#L931) | global $post; |
| [932](#L932) |  |
| [933](#L933) | return $post->ID; |
| [934](#L934) | } |
| [935](#L935) |  |
| [936](#L936) | /\*\* |
| [937](#L937) | \* Fetches featured image data of nth position. |
| [938](#L938) | \* |
| [939](#L939) | \* @since  3.0.0 |
| [940](#L940) | \* @access  public |
| [941](#L941) | \* |
| [942](#L942) | \* @see  get\_featured\_images() |
| [943](#L943) | \* |
| [944](#L944) | \* @param  int $position Position of the featured image. |
| [945](#L945) | \* @param  int $post\_id Current post id. |
| [946](#L946) | \* |
| [947](#L947) | \* @return array if found, null otherwise. |
| [948](#L948) | \*/ |
| [949](#L949) | public function get\_nth\_featured\_image( $position, $post\_id = null ) { |
| [950](#L950) | $post\_id = $this->get\_real\_post\_id( ( $post\_id ) ); |
| [951](#L951) |  |
| [952](#L952) | $featured\_images = $this->get\_featured\_images( $post\_id ); |
| [953](#L953) |  |
| [954](#L954) | return isset( $featured\_images[ $position - 2 ] ) ? $featured\_images[ $position - 2 ] : null; |
| [955](#L955) | } |
| [956](#L956) |  |
| [957](#L957) | /\*\* |
| [958](#L958) | \* Check if the image is attached with the particular post. |
| [959](#L959) | \* |
| [960](#L960) | \* @since 2.0.0 |
| [961](#L961) | \* @access public |
| [962](#L962) | \* |
| [963](#L963) | \* @see  get\_post\_attachment\_ids() |
| [964](#L964) | \* |
| [965](#L965) | \* @param  int $attachment\_id Attachment id of an image. |
| [966](#L966) | \* @param  int $post\_id Current post id. |
| [967](#L967) | \* |
| [968](#L968) | \* @return bool |
| [969](#L969) | \*/ |
| [970](#L970) | public function is\_attached( $attachment\_id, $post\_id ) { |
| [971](#L971) | if ( empty( $attachment\_id ) ) { |
| [972](#L972) | return false; |
| [973](#L973) | } |
| [974](#L974) |  |
| [975](#L975) | $attachment\_ids = $this->get\_post\_attachment\_ids( $post\_id ); |
| [976](#L976) |  |
| [977](#L977) | return in\_array( $attachment\_id, $attachment\_ids, true ) ? true : false; |
| [978](#L978) | } |
| [979](#L979) |  |
| [980](#L980) | /\*\* |
| [981](#L981) | \* Retrieve featured images for specific post(s). |
| [982](#L982) | \* |
| [983](#L983) | \* @since 2.0.0 |
| [984](#L984) | \* @access public |
| [985](#L985) | \* |
| [986](#L986) | \* @see get\_post\_meta() |
| [987](#L987) | \* |
| [988](#L988) | \* @param  int $post\_id id of the current post. |
| [989](#L989) | \* |
| [990](#L990) | \* @return array |
| [991](#L991) | \*/ |
| [992](#L992) | public function get\_featured\_images( $post\_id = null ) { |
| [993](#L993) | $post\_id    = $this->get\_real\_post\_id( $post\_id ); |
| [994](#L994) | $dfi\_images = get\_post\_meta( $post\_id, 'dfiFeatured', true ); |
| [995](#L995) | $ret\_images = array(); |
| [996](#L996) |  |
| [997](#L997) | if ( ! empty( $dfi\_images ) && is\_array( $dfi\_images ) ) { |
| [998](#L998) | $dfi\_images = array\_filter( $dfi\_images ); |
| [999](#L999) |  |
| [1000](#L1000) | $count = 0; |
| [1001](#L1001) | foreach ( $dfi\_images as $dfi\_image ) { |
| [1002](#L1002) | $dfi\_image\_trimmed = $this->separate( $dfi\_image ); |
| [1003](#L1003) | $dfi\_image\_full    = $this->separate( $dfi\_image, 'full' ); |
| [1004](#L1004) |  |
| [1005](#L1005) | try { |
| [1006](#L1006) | $ret\_images[ $count ]['thumb']         = $this->get\_real\_upload\_path( $dfi\_image\_trimmed ); |
| [1007](#L1007) | $ret\_images[ $count ]['full']          = $this->get\_real\_upload\_path( $dfi\_image\_full ); |
| [1008](#L1008) | $ret\_images[ $count ]['attachment\_id'] = $this->get\_image\_id( $ret\_images[ $count ]['full'] ); |
| [1009](#L1009) | } catch ( Exception $e ) { |
| [1010](#L1010) | /\* Ignore the exception and continue with other featured images \*/ |
| [1011](#L1011) | } |
| [1012](#L1012) |  |
| [1013](#L1013) | $count ++; |
| [1014](#L1014) | } |
| [1015](#L1015) | } |
| [1016](#L1016) |  |
| [1017](#L1017) | return $ret\_images; |
| [1018](#L1018) | } |
| [1019](#L1019) |  |
| [1020](#L1020) | /\*\* |
| [1021](#L1021) | \* Check to see if the upload url is already available in path. |
| [1022](#L1022) | \* |
| [1023](#L1023) | \* @since  3.1.14 |
| [1024](#L1024) | \* @access protected |
| [1025](#L1025) | \* |
| [1026](#L1026) | \* @param  string $img Uploaded image. |
| [1027](#L1027) | \* |
| [1028](#L1028) | \* @return string |
| [1029](#L1029) | \*/ |
| [1030](#L1030) | protected function get\_real\_upload\_path( $img ) { |
| [1031](#L1031) | // check if upload path is already attached. |
| [1032](#L1032) | if ( false !== strpos( $img, $this->upload\_url ) || preg\_match( '/https?:\/\//', $img ) ) { |
| [1033](#L1033) | return $img; |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | return $this->upload\_url . $img; |
| [1037](#L1037) | } |
| [1038](#L1038) |  |
| [1039](#L1039) | /\*\* |
| [1040](#L1040) | \* Retrieve featured images for specific post(s) including the default Featured Image. |
| [1041](#L1041) | \* |
| [1042](#L1042) | \* @since 3.1.7 |
| [1043](#L1043) | \* @access public |
| [1044](#L1044) | \* |
| [1045](#L1045) | \* @see  $this->get\_featured\_images() |
| [1046](#L1046) | \* |
| [1047](#L1047) | \* @param int $post\_id Current post id. |
| [1048](#L1048) | \* |
| [1049](#L1049) | \* @return array An array of images or an empty array on failure |
| [1050](#L1050) | \*/ |
| [1051](#L1051) | public function get\_all\_featured\_images( $post\_id = null ) { |
| [1052](#L1052) | $post\_id      = $this->get\_real\_post\_id( $post\_id ); |
| [1053](#L1053) | $thumbnail\_id = get\_post\_thumbnail\_id( $post\_id ); |
| [1054](#L1054) | $all\_images   = array(); |
| [1055](#L1055) |  |
| [1056](#L1056) | if ( ! empty( $thumbnail\_id ) ) { |
| [1057](#L1057) | $featured\_image         = array( |
| [1058](#L1058) | 'thumb'         => wp\_get\_attachment\_thumb\_url( $thumbnail\_id ), |
| [1059](#L1059) | 'full'          => wp\_get\_attachment\_url( $thumbnail\_id ), |
| [1060](#L1060) | 'attachment\_id' => $thumbnail\_id, |
| [1061](#L1061) | ); |
| [1062](#L1062) |  |
| [1063](#L1063) | $all\_images[] = $featured\_image; |
| [1064](#L1064) | } |
| [1065](#L1065) |  |
| [1066](#L1066) | return array\_merge( $all\_images, $this->get\_featured\_images( $post\_id ) ); |
| [1067](#L1067) | } |
| [1068](#L1068) |  |
| [1069](#L1069) | /\*\* |
| [1070](#L1070) | \* Load the plugin's textdomain hooked to 'plugins\_loaded'. |
| [1071](#L1071) | \* |
| [1072](#L1072) | \* @since 1.0.0 |
| [1073](#L1073) | \* @access public |
| [1074](#L1074) | \* |
| [1075](#L1075) | \* @see    load\_plugin\_textdomain() |
| [1076](#L1076) | \* @see    plugin\_basename() |
| [1077](#L1077) | \* @action plugins\_loaded |
| [1078](#L1078) | \* |
| [1079](#L1079) | \* @codeCoverageIgnore |
| [1080](#L1080) | \* |
| [1081](#L1081) | \* @return void |
| [1082](#L1082) | \*/ |
| [1083](#L1083) | public function load\_plugin\_textdomain() { |
| [1084](#L1084) | load\_plugin\_textdomain( |
| [1085](#L1085) | self::TEXT\_DOMAIN, |
| [1086](#L1086) | false, |
| [1087](#L1087) | dirname( plugin\_basename( \_\_FILE\_\_ ) ) . '/languages/' |
| [1088](#L1088) | ); |
| [1089](#L1089) | } |
| [1090](#L1090) | } |
| [1091](#L1091) |  |
| [1092](#L1092) | // Sponsors who support this plugin. |
| [1093](#L1093) | include 'sponsors.php'; |
| [1094](#L1094) |  |
| [1095](#L1095) | /\*\* |
| [1096](#L1096) | \* Instantiate the main class. |
| [1097](#L1097) | \* |
| [1098](#L1098) | \* @since 1.0.0 |
| [1099](#L1099) | \* @access public |
| [1100](#L1100) | \* |
| [1101](#L1101) | \* @var object $dynamic\_featured\_image holds the instantiated class {@uses Dynamic\_Featured\_Image} |
| [1102](#L1102) | \*/ |
| [1103](#L1103) | global $dynamic\_featured\_image; |
| [1104](#L1104) | $dynamic\_featured\_image = new Dynamic\_Featured\_Image(); |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/dynamic-featured-image/trunk/dynamic-featured-image.php?format=txt)
* [Original Format](/export/3220525/dynamic-featured-image/trunk/dynamic-featured-image.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_211899fe_20250111_043055.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Dynamic Featured Image <= 3.7.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via dfiFeatured Parameter

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Dynamic Featured Image <= 3.7.0 - Authenticated (Contributor+) Stored Cross-Site Scripting via dfiFeatured Parameter

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-6929](https://www.cve.org/CVERecord?id=CVE-2024-6929) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | September 4, 2024 |
| Last Updated | September 5, 2024 |
| Researcher | [vgo0](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/dale-mavers) |

### Description

The Dynamic Featured Image plugin for WordPress is vulnerable to Stored Cross-Site Scripting via the ‘dfiFeatured’ parameter in all versions up to, and including, 3.7.0 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers, with Contributor-level access and above, to inject arbitrary web scripts in pages that will execute whenever a user accesses an injected page.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/dynamic-featured-image/trunk/dynamic-featured-image.php#L434)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/dynamic-featured-image/trunk/dynamic-featured-image.php#L469)
* [wordpress.org](https://wordpress.org/plugins/dynamic-featured-image/#developers)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdynamic-featured-image%2Fdynamic-featured-image-370-authenticated-contributor-stored-cross-site-scripting-via-dfifeatured-parameter&t=Dynamic%20Featured%20Image%20%3C%3D%203.7.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20dfiFeatured%20Parameter "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdynamic-featured-image%2Fdynamic-featured-image-370-authenticated-contributor-stored-cross-site-scripting-via-dfifeatured-parameter&text=Dynamic%20Featured%20Image%20%3C%3D%203.7.0%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20dfiFeatured%20Parameter "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fdynamic-featured-image%2Fdynamic-featured-image-370-authenticated-contributor-stored-cross-site-scripting-via-dfifeatured-parameter "LinkedIn")
Email

## Vulnerability Details for Dynamic Featured Image

#### [Dynamic Featured Image](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/dynamic-featured-image)

| Software Type | Plugin |
| --- | --- |
| Software Slug | dynamic-featured-image [(view on wordpress.org)](https://wordpress.org/plugins/dynamic-featured-image) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 3.7.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


