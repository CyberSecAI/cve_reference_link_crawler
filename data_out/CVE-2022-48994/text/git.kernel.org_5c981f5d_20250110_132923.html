

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e385360705a0b346bdb57ce938249175d0613b8a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e385360705a0b346bdb57ce938249175d0613b8a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e385360705a0b346bdb57ce938249175d0613b8a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e385360705a0b346bdb57ce938249175d0613b8a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Kees Cook <keescook@chromium.org> | 2022-11-18 15:23:50 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-12-14 11:26:12 +0100 |
| commit | [e385360705a0b346bdb57ce938249175d0613b8a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e385360705a0b346bdb57ce938249175d0613b8a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e385360705a0b346bdb57ce938249175d0613b8a)) | |
| tree | [60674c741932383a04b7644281fe4cfe52b63fe0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e385360705a0b346bdb57ce938249175d0613b8a) | |
| parent | [992a37d814809e9ea9e10f387f4e86c09e8e3ba9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=992a37d814809e9ea9e10f387f4e86c09e8e3ba9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e385360705a0b346bdb57ce938249175d0613b8a&id2=992a37d814809e9ea9e10f387f4e86c09e8e3ba9)) | |
| download | [linux-e385360705a0b346bdb57ce938249175d0613b8a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e385360705a0b346bdb57ce938249175d0613b8a.tar.gz) | |

ALSA: seq: Fix function prototype mismatch in snd\_seq\_expand\_var\_event[ Upstream commit 05530ef7cf7c7d700f6753f058999b1b5099a026 ]
With clang's kernel control flow integrity (kCFI, CONFIG\_CFI\_CLANG),
indirect call targets are validated against the expected function
pointer prototype to make sure the call target is valid to help mitigate
ROP attacks. If they are not identical, there is a failure at run time,
which manifests as either a kernel panic or thread getting killed.
seq\_copy\_in\_user() and seq\_copy\_in\_kernel() did not have prototypes
matching snd\_seq\_dump\_func\_t. Adjust this and remove the casts. There
are not resulting binary output differences.
This was found as a result of Clang's new -Wcast-function-type-strict
flag, which is more sensitive than the simpler -Wcast-function-type,
which only checks for type width mismatches.
Reported-by: kernel test robot <lkp@intel.com>
Link: [https://lore.kernel.org/lkml/202211041527.HD8TLSE1-lkp@intel.com](https://lore.kernel.org/lkml/202211041527.HD8TLSE1-lkp%40intel.com)
Cc: Jaroslav Kysela <perex@perex.cz>
Cc: Takashi Iwai <tiwai@suse.com>
Cc: "Gustavo A. R. Silva" <gustavoars@kernel.org>
Cc: alsa-devel@alsa-project.org
Signed-off-by: Kees Cook <keescook@chromium.org>
Link: [https://lore.kernel.org/r/20221118232346.never.380-kees@kernel.org](https://lore.kernel.org/r/20221118232346.never.380-kees%40kernel.org)
Signed-off-by: Takashi Iwai <tiwai@suse.de>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e385360705a0b346bdb57ce938249175d0613b8a)

| -rw-r--r-- | [sound/core/seq/seq\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/sound/core/seq/seq_memory.c?id=e385360705a0b346bdb57ce938249175d0613b8a) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 7 insertions, 4 deletions

| diff --git a/sound/core/seq/seq\_memory.c b/sound/core/seq/seq\_memory.cindex ab1112e90f88db..6f413c711535e0 100644--- a/[sound/core/seq/seq\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/seq/seq_memory.c?id=992a37d814809e9ea9e10f387f4e86c09e8e3ba9)+++ b/[sound/core/seq/seq\_memory.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/sound/core/seq/seq_memory.c?id=e385360705a0b346bdb57ce938249175d0613b8a)@@ -126,15 +126,19 @@ EXPORT\_SYMBOL(snd\_seq\_dump\_var\_event); \* expand the variable length event to linear buffer space. \*/ -static int seq\_copy\_in\_kernel(char \*\*bufptr, const void \*src, int size)+static int seq\_copy\_in\_kernel(void \*ptr, void \*src, int size) {+ char \*\*bufptr = ptr;+ memcpy(\*bufptr, src, size); \*bufptr += size; return 0; } -static int seq\_copy\_in\_user(char \_\_user \*\*bufptr, const void \*src, int size)+static int seq\_copy\_in\_user(void \*ptr, void \*src, int size) {+ char \_\_user \*\*bufptr = ptr;+ if (copy\_to\_user(\*bufptr, src, size)) return -EFAULT; \*bufptr += size;@@ -163,8 +167,7 @@ int snd\_seq\_expand\_var\_event(const struct snd\_seq\_event \*event, int count, char return newlen; } err = snd\_seq\_dump\_var\_event(event,- in\_kernel ? (snd\_seq\_dump\_func\_t)seq\_copy\_in\_kernel :- (snd\_seq\_dump\_func\_t)seq\_copy\_in\_user,+ in\_kernel ? seq\_copy\_in\_kernel : seq\_copy\_in\_user, &buf); return err < 0 ? err : newlen; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:28:01 +0000

