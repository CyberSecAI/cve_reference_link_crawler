=== Content from plugins.trac.wordpress.org_896baa9f_20250110_220453.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3162399%2Fthemify-builder%2Ftrunk%2Fclasses%2Fclass-themify-builder-model.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3093475/themify-builder/trunk/classes/class-themify-builder-model.php "Changeset 3093475 for themify-builder/trunk/classes/class-themify-builder-model.php")
* [Next Change](/changeset/3194622/themify-builder/trunk/classes/class-themify-builder-model.php "Changeset 3194622 for themify-builder/trunk/classes/class-themify-builder-model.php") →

---

# Changeset [3162399](/changeset/3162399 "Show full changeset") for [themify-builder/trunk/classes/class-themify-builder-model.php](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/04/2024 12:52:31 AM
([3 months](/timeline?from=2024-10-04T00%3A52%3A31Z&precision=second "See timeline at 10/04/2024 12:52:31 AM") ago)

Author:
themifyme
Message:

update plugin

File:

1 edited

* [themify-builder/trunk/classes/class-themify-builder-model.php](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399 "Show entry in browser")
  (modified)
  ([4 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [themify-builder/trunk/classes/class-themify-builder-model.php](/changeset/3162399/themify-builder/trunk/classes/class-themify-builder-model.php "Show the changeset 3162399 restricted to themify-builder/trunk/classes/class-themify-builder-model.php")

  | [r3093475](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3093475#L1117 "Show revision 3093475 of this file in browser") | [r3162399](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399#L1117 "Show revision 3162399 of this file in browser") |  |
  | --- | --- | --- |
  | 1117 | 1117 | <?php if ($hasUpdater === true): ?> |
  | 1118 | 1118 | <?php $tab = $k === 'plugin' ? 2 : 1; ?> |
  | 1119 |  | <a role="button" class="button button-primary" href="<?php echo ~~add\_query\_arg(array('page' => 'themify-license', 'promotion' => $tab), admin\_url()~~) ?>"><?php \_e('Update them', 'themify') ?></a> |
  |  | 1119 | <a role="button" class="button button-primary" href="<?php echo esc\_url( add\_query\_arg(array('page' => 'themify-license', 'promotion' => $tab), admin\_url()) ) ?>"><?php \_e('Update them', 'themify') ?></a> |
  | 1120 | 1120 | <?php elseif ($hasUpdater === false): ?> |
  | 1121 |  | <?php printf(\_\_('%s', 'themify'), '<a role="button" class="button" href="' . ~~add\_query\_arg(array('tf-activate-updater' => 1)~~) . '">' . \_\_('Activate Themify Updater', 'themify') . '</a>') ?></a> |
  |  | 1121 | <?php printf(\_\_('%s', 'themify'), '<a role="button" class="button" href="' . esc\_url( add\_query\_arg(array('tf-activate-updater' => 1)) ) . '">' . \_\_('Activate Themify Updater', 'themify') . '</a>') ?></a> |
  | 1122 | 1122 | <?php else: ?> |
  | 1123 |  | <?php printf(\_\_('Install %s plugin to auto update them.', 'themify'), '<a href="' . ~~add\_query\_arg(array('page' => 'themify-install-plugins'), admin\_url('admin.php')~~) . '">' . \_\_('Themify Updater', 'themify') . '</a>') ?></a> |
  |  | 1123 | <?php printf(\_\_('Install %s plugin to auto update them.', 'themify'), '<a href="' . esc\_url( add\_query\_arg(array('page' => 'themify-install-plugins'), admin\_url('admin.php')) ) . '">' . \_\_('Themify Updater', 'themify') . '</a>') ?></a> |
  | 1124 | 1124 | <?php endif; ?> |
  | 1125 | 1125 | </p> |
  | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3093475#L1304) | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399#L1304) |  |
  | 1304 | 1304 | 'private' => \themify\_builder\_get( 'setting-hcaptcha\_secret', 'hcaptcha\_secret' ) |
  | 1305 | 1305 | ]; |
  |  | 1306 | } else if ( $provider === 'turnstile' ) { |
  |  | 1307 | return [ |
  |  | 1308 | 'public' => \themify\_builder\_get( 'setting-turnstile\_site', 'turnstile\_site' ), |
  |  | 1309 | 'private' => \themify\_builder\_get( 'setting-turnstile\_secret', 'turnstile\_secret' ) |
  |  | 1310 | ]; |
  | 1306 | 1311 | } |
  | 1307 | 1312 | } |
  | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3093475#L1317) | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399#L1322) |  |
  | 1317 | 1322 | if ( $provider === 'recaptcha' ) { |
  | 1318 | 1323 | $output .= '<div class="themify\_captcha\_field ' . ( 'v2' === $keys['version'] ? 'g-recaptcha' : '' ) .'" data-sitekey="' . esc\_attr($keys['public'] ) . '" data-ver="' . esc\_attr( $keys['version'] ) . '"></div>'; |
  |  | 1324 | } else if ( $provider === 'turnstile' ) { |
  |  | 1325 | $output .= '<div class="themify\_captcha\_field turnstile" data-sitekey="' . esc\_attr($keys['public'] ) . '"></div>'; |
  | 1319 | 1326 | } else if( $provider === 'hcaptcha' ) { |
  | 1320 | 1327 | $output .= '<div class="themify\_captcha\_field h-captcha" data-sitekey="' . esc\_attr( $keys['public'] ) . '"></div>'; |
  | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3093475#L1336) | […](/browser/themify-builder/trunk/classes/class-themify-builder-model.php?rev=3162399#L1343) |  |
  | 1336 | 1343 | } |
  | 1337 | 1344 |  |
  | 1338 |  | $url = $provider === 'recaptcha' ? 'https://www.google.com/recaptcha/api/siteverify' : 'https://hcaptcha.com/siteverify'; |
  |  | 1345 | switch ( $provider ) { |
  |  | 1346 | case 'recaptcha' : |
  |  | 1347 | $url = 'https://www.google.com/recaptcha/api/siteverify'; |
  |  | 1348 | break; |
  |  | 1349 | case 'hcaptcha' : |
  |  | 1350 | $url = 'https://hcaptcha.com/siteverify'; |
  |  | 1351 | break; |
  |  | 1352 | case 'turnstile' : |
  |  | 1353 | $url = 'https://challenges.cloudflare.com/turnstile/v0/siteverify'; |
  |  | 1354 | break; |
  |  | 1355 | } |
  |  | 1356 |  |
  | 1339 | 1357 | $url = add\_query\_arg( [ |
  | 1340 | 1358 | 'secret' => $keys['private'], |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3162399)
* [Zip Archive](?format=zip&new=3162399)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_0319aec0_20250110_220451.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fthemify-builder%2Ftags%2F7.6.2%2Fclasses%2Fclass-themify-builder-model.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php)

---

# [source:](/browser?order=name "Go to repository root") [themify-builder](/browser/themify-builder?order=name "View themify-builder")/[tags](/browser/themify-builder/tags?order=name "View tags")/[7.6.2](/browser/themify-builder/tags/7.6.2?order=name "View 7.6.2")/[classes](/browser/themify-builder/tags/7.6.2/classes?order=name "View classes")/[class-themify-builder-model.php](/browser/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php?order=name "View class-themify-builder-model.php")

View diff against:

View revision:

| [Last change](/changeset/3136845/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php "View differences") on this file was [3136845](/changeset/3136845/ "View changeset 3136845"), checked in by themifyme, [5 months ago](/timeline?from=2024-08-16T23%3A37%3A30Z&precision=second "See timeline at 08/16/2024 11:37:30 PM") |
| --- |
| update plugin |
| **File size:** 56.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | /\*\* |
| [4](#L4) | \* Class for interact with DB or data resource and state. |
| [5](#L5) | \* |
| [6](#L6) | \* @package    Themify\_Builder |
| [7](#L7) | \* @subpackage Themify\_Builder/classes |
| [8](#L8) | \*/ |
| [9](#L9) | final class Themify\_Builder\_Model { |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Feature Image Size |
| [13](#L13) | \* @var array |
| [14](#L14) | \*/ |
| [15](#L15) | public static $featured\_image\_size = array(); |
| [16](#L16) |  |
| [17](#L17) | /\*\* |
| [18](#L18) | \* Image Width |
| [19](#L19) | \* @var array |
| [20](#L20) | \*/ |
| [21](#L21) | public static $image\_width = array(); |
| [22](#L22) |  |
| [23](#L23) | /\*\* |
| [24](#L24) | \* Image Height |
| [25](#L25) | \* @var array |
| [26](#L26) | \*/ |
| [27](#L27) | public static $image\_height = array(); |
| [28](#L28) |  |
| [29](#L29) | /\*\* |
| [30](#L30) | \* External Link |
| [31](#L31) | \* @var array |
| [32](#L32) | \*/ |
| [33](#L33) | public static $external\_link = array(); |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Lightbox Link |
| [37](#L37) | \* @var array |
| [38](#L38) | \*/ |
| [39](#L39) | public static $lightbox\_link = array(); |
| [40](#L40) | public static $modules = array();//deprecated use Themify\_Builder\_Component\_Module::load\_modules |
| [41](#L41) | private const TRANSIENT\_NAME = 'tb\_edit\_'; |
| [42](#L42) |  |
| [43](#L43) | /\*\* |
| [44](#L44) | \* Active custom post types registered by Builder. |
| [45](#L45) | \* |
| [46](#L46) | \* @var array |
| [47](#L47) | \*/ |
| [48](#L48) | public static $builder\_cpt = array(); |
| [49](#L49) |  |
| [50](#L50) | /\*\* |
| [51](#L51) | \* Directory Registry |
| [52](#L52) | \*/ |
| [53](#L53) | private static $modules\_registry = array(); |
| [54](#L54) |  |
| [55](#L55) | /\*\* |
| [56](#L56) | \* Hook Content cache, used by Post modules |
| [57](#L57) | \*/ |
| [58](#L58) | private static $hook\_contents=array(); |
| [59](#L59) |  |
| [60](#L60) | private function \_\_construct() { |
| [61](#L61) |  |
| [62](#L62) | } |
| [63](#L63) |  |
| [64](#L64) | /\*\* |
| [65](#L65) | \* Get favorite option to module instance |
| [66](#L66) | \* @return array |
| [67](#L67) | \*/ |
| [68](#L68) | public static function get\_favorite\_modules():array { |
| [69](#L69) | $fv = get\_user\_option('themify\_module\_favorite', get\_current\_user\_id()); |
| [70](#L70) | if(!empty($fv)){ |
| [71](#L71) | $fv=json\_decode($fv,true); |
| [72](#L72) | if(!array\_key\_exists(0, $fv)){ |
| [73](#L73) | $fv=array\_keys($fv); |
| [74](#L74) | } |
| [75](#L75) | } |
| [76](#L76) | else{ |
| [77](#L77) | $fv=array(); |
| [78](#L78) | } |
| [79](#L79) | return $fv; |
| [80](#L80) | } |
| [81](#L81) |  |
| [82](#L82) | /\*\* |
| [83](#L83) | \* Check whether builder is active or not |
| [84](#L84) | \* @return bool |
| [85](#L85) | \*/ |
| [86](#L86) | public static function builder\_check():bool { |
| [87](#L87) | static $is = NULL; |
| [88](#L88) | if ($is === null) { |
| [89](#L89) | $is = apply\_filters('themify\_enable\_builder', themify\_builder\_get('setting-page\_builder\_is\_active', 'builder\_is\_active'))!=='disable'; |
| [90](#L90) | } |
| [91](#L91) | return $is; |
| [92](#L92) | } |
| [93](#L93) |  |
| [94](#L94) |  |
| [95](#L95) | /\*\* |
| [96](#L96) | \* Check is the frontend editor page |
| [97](#L97) | \*/ |
| [98](#L98) | public static function is\_frontend\_editor\_page(?int $post\_id = null):bool { |
| [99](#L99) | $post\_id = $post\_id ??self::get\_ID(); |
| [100](#L100) | return apply\_filters('themify\_builder\_is\_frontend\_editor', Themify\_Access\_Role::check\_access\_frontend($post\_id), $post\_id); |
| [101](#L101) | } |
| [102](#L102) |  |
| [103](#L103) | /\*\* |
| [104](#L104) | \* Check if builder frontend edit being invoked |
| [105](#L105) | \*/ |
| [106](#L106) | public static function is\_front\_builder\_activate():bool { |
| [107](#L107) | static $is = NULL; |
| [108](#L108) | if ($is === null) { |
| [109](#L109) | $is = Themify\_Builder::$frontedit\_active === true || ((isset($\_GET['tb-preview']) || (isset($\_COOKIE['tb\_active']) && !is\_admin() && !themify\_is\_ajax()) && self::is\_frontend\_editor\_page())); |
| [110](#L110) | if ($is === true) { |
| [111](#L111) | add\_filter('lazyload\_is\_enabled', '\_\_return\_false', 1, 100); //disable jetpack lazy load |
| [112](#L112) | add\_filter('rocket\_use\_native\_lazyload', '\_\_return\_false', 1, 100); |
| [113](#L113) | } |
| [114](#L114) | } |
| [115](#L115) | return $is; |
| [116](#L116) | } |
| [117](#L117) |  |
| [118](#L118) |  |
| [119](#L119) | /\*\* |
| [120](#L120) | \* Load general metabox fields |
| [121](#L121) | \*/ |
| [122](#L122) | public static function load\_general\_metabox():void { |
| [123](#L123) | // Featured Image Size |
| [124](#L124) | self::$featured\_image\_size = apply\_filters('themify\_builder\_metabox\_featured\_image\_size', array( |
| [125](#L125) | 'name' => 'feature\_size', |
| [126](#L126) | 'title' => \_\_('Image Size', 'themify'), |
| [127](#L127) | 'description' => sprintf(\_\_('Image sizes can be set at <a href="%s">Media Settings</a>', 'themify'), admin\_url('options-media.php')), |
| [128](#L128) | 'type' => 'featimgdropdown' |
| [129](#L129) | )); |
| [130](#L130) | // Image Width |
| [131](#L131) | self::$image\_width = apply\_filters('themify\_builder\_metabox\_image\_width', array( |
| [132](#L132) | 'name' => 'image\_width', |
| [133](#L133) | 'title' => \_\_('Image Width', 'themify'), |
| [134](#L134) | 'description' => '', |
| [135](#L135) | 'type' => 'textbox', |
| [136](#L136) | 'meta' => array('size' => 'small') |
| [137](#L137) | )); |
| [138](#L138) | // Image Height |
| [139](#L139) | self::$image\_height = apply\_filters('themify\_builder\_metabox\_image\_height', array( |
| [140](#L140) | 'name' => 'image\_height', |
| [141](#L141) | 'title' => \_\_('Image Height', 'themify'), |
| [142](#L142) | 'description' => '', |
| [143](#L143) | 'type' => 'textbox', |
| [144](#L144) | 'meta' => array('size' => 'small'), |
| [145](#L145) | 'class' => self::is\_img\_php\_disabled() ? 'builder\_show\_if\_enabled\_img\_php' : '', |
| [146](#L146) | )); |
| [147](#L147) | // External Link |
| [148](#L148) | self::$external\_link = apply\_filters('themify\_builder\_metabox\_external\_link', array( |
| [149](#L149) | 'name' => 'external\_link', |
| [150](#L150) | 'title' => \_\_('External Link', 'themify'), |
| [151](#L151) | 'description' => \_\_('Link Featured Image and Post Title to external URL', 'themify'), |
| [152](#L152) | 'type' => 'textbox', |
| [153](#L153) | 'meta' => array() |
| [154](#L154) | )); |
| [155](#L155) | // Lightbox Link |
| [156](#L156) | self::$lightbox\_link = apply\_filters('themify\_builder\_metabox\_lightbox\_link', array( |
| [157](#L157) | 'name' => 'lightbox\_link', |
| [158](#L158) | 'title' => \_\_('Lightbox Link', 'themify'), |
| [159](#L159) | 'description' => \_\_('Link Featured Image to lightbox image, video or external iframe', 'themify'), |
| [160](#L160) | 'type' => 'textbox', |
| [161](#L161) | 'meta' => array() |
| [162](#L162) | )); |
| [163](#L163) | } |
| [164](#L164) |  |
| [165](#L165) |  |
| [166](#L166) |  |
| [167](#L167) | /\*\* |
| [168](#L168) | \* Return frame layout |
| [169](#L169) | \*/ |
| [170](#L170) | public static function get\_frame\_layout():array { |
| [171](#L171) | $path = THEMIFY\_BUILDER\_URI . '/img/row-frame/'; |
| [172](#L172) | return array( |
| [173](#L173) | array('value' => 'none', 'label' => 'none', 'img' => $path . 'none.png'), |
| [174](#L174) | array('value' => 'corner1', 'label' => 'Rounded Corners', 'img' => $path . 'corner1.svg'), |
| [175](#L175) | array('value' => 'corner2', 'label' => 'Bracket Corners', 'img' => $path . 'corner2.svg'), |
| [176](#L176) | array('value' => 'corner3', 'label' => 'Flower Corners', 'img' => $path . 'corner3.svg'), |
| [177](#L177) | array('value' => 'corner4', 'label' => 'Slant Corners', 'img' => $path . 'corner4.svg'), |
| [178](#L178) | array('value' => 'slant1', 'label' => 'Slant 1', 'img' => $path . 'slant1.svg'), |
| [179](#L179) | array('value' => 'slant2', 'label' => 'Slant 2', 'img' => $path . 'slant2.svg'), |
| [180](#L180) | array('value' => 'slant3', 'label' => 'Slant 3', 'img' => $path . 'slant3.svg'), |
| [181](#L181) | array('value' => 'arrow1', 'label' => 'Arrow 1', 'img' => $path . 'arrow1.svg'), |
| [182](#L182) | array('value' => 'arrow2', 'label' => 'Arrow 2', 'img' => $path . 'arrow2.svg'), |
| [183](#L183) | array('value' => 'arrow3', 'label' => 'Arrow 3', 'img' => $path . 'arrow3.svg'), |
| [184](#L184) | array('value' => 'arrow4', 'label' => 'Arrow 4', 'img' => $path . 'arrow4.svg'), |
| [185](#L185) | array('value' => 'arrow5', 'label' => 'Arrow 5', 'img' => $path . 'arrow5.svg'), |
| [186](#L186) | array('value' => 'arrow6', 'label' => 'Arrow 6', 'img' => $path . 'arrow6.svg'), |
| [187](#L187) | array('value' => 'cloud1', 'label' => 'Cloud 1', 'img' => $path . 'cloud1.svg'), |
| [188](#L188) | array('value' => 'cloud2', 'label' => 'Cloud 2', 'img' => $path . 'cloud2.svg'), |
| [189](#L189) | array('value' => 'curve1', 'label' => 'Curve 1', 'img' => $path . 'curve1.svg'), |
| [190](#L190) | array('value' => 'curve2', 'label' => 'Curve 2', 'img' => $path . 'curve2.svg'), |
| [191](#L191) | array('value' => 'mountain1', 'label' => 'Mountain 1', 'img' => $path . 'mountain1.svg'), |
| [192](#L192) | array('value' => 'mountain2', 'label' => 'Mountain 2', 'img' => $path . 'mountain2.svg'), |
| [193](#L193) | array('value' => 'mountain3', 'label' => 'Mountain 3', 'img' => $path . 'mountain3.svg'), |
| [194](#L194) | array('value' => 'wave1', 'label' => 'Wave 1', 'img' => $path . 'wave1.svg'), |
| [195](#L195) | array('value' => 'wave2', 'label' => 'Wave 2', 'img' => $path . 'wave2.svg'), |
| [196](#L196) | array('value' => 'wave3', 'label' => 'Wave 3', 'img' => $path . 'wave3.svg'), |
| [197](#L197) | array('value' => 'wave4', 'label' => 'Wave 4', 'img' => $path . 'wave4.svg'), |
| [198](#L198) | array('value' => 'ink-splash1', 'label' => 'Ink Splash 1', 'img' => $path . 'ink-splash1.svg'), |
| [199](#L199) | array('value' => 'ink-splash2', 'label' => 'Ink Splash 2', 'img' => $path . 'ink-splash2.svg'), |
| [200](#L200) | array('value' => 'zig-zag', 'label' => 'Zig Zag', 'img' => $path . 'zig-zag.svg'), |
| [201](#L201) | array('value' => 'grass', 'label' => 'Grass', 'img' => $path . 'grass.svg'), |
| [202](#L202) | array('value' => 'melting', 'label' => 'Melting', 'img' => $path . 'melting.svg'), |
| [203](#L203) | array('value' => 'lace', 'label' => 'Lace', 'img' => $path . 'lace.svg'), |
| [204](#L204) | ); |
| [205](#L205) | } |
| [206](#L206) |  |
| [207](#L207) |  |
| [208](#L208) | /\*\* |
| [209](#L209) | \* Get Post Types, which ready for an operation |
| [210](#L210) | \* @return array |
| [211](#L211) | \*/ |
| [212](#L212) | public static function get\_post\_types():array { |
| [213](#L213) |  |
| [214](#L214) | // If it's not a product search, proceed: retrieve the post types. |
| [215](#L215) | $types = get\_post\_types(array('exclude\_from\_search' => false)); |
| [216](#L216) | if (themify\_is\_themify\_theme()) { |
| [217](#L217) | // Exclude pages ///////////////// |
| [218](#L218) | $exclude\_pages = themify\_builder\_get('setting-search\_settings\_exclude'); |
| [219](#L219) | if (!empty($exclude\_pages)) { |
| [220](#L220) | unset($types['page']); |
| [221](#L221) | } |
| [222](#L222) | // Exclude posts ///////////////// |
| [223](#L223) | $exclude\_posts = themify\_builder\_get('setting-search\_exclude\_post'); |
| [224](#L224) | if (!empty($exclude\_posts)) { |
| [225](#L225) | unset($types['post']); |
| [226](#L226) | } |
| [227](#L227) | // Exclude custom post types ///// |
| [228](#L228) | $exclude\_types = apply\_filters('themify\_types\_excluded\_in\_search', get\_post\_types(array( |
| [229](#L229) | '\_builtin' => false, |
| [230](#L230) | 'public' => true, |
| [231](#L231) | 'exclude\_from\_search' => false |
| [232](#L232) | ))); |
| [233](#L233) |  |
| [234](#L234) | foreach (array\_keys($exclude\_types) as $type) { |
| [235](#L235) | $check = \themify\_builder\_get('setting-search\_exclude\_' . $type); |
| [236](#L236) | if (!empty($check)) { |
| [237](#L237) | unset($types[$type]); |
| [238](#L238) | } |
| [239](#L239) | } |
| [240](#L240) | } |
| [241](#L241) | // Exclude Layout and Layout Part custom post types ///// |
| [242](#L242) | unset($types['section'], $types[Themify\_Builder\_Layouts::LAYOUT\_SLUG], $types[Themify\_Builder\_Layouts::LAYOUT\_PART\_SLUG], $types['elementor\_library']); |
| [243](#L243) |  |
| [244](#L244) | return $types; |
| [245](#L245) | } |
| [246](#L246) |  |
| [247](#L247) | /\*\* |
| [248](#L248) | \* Check whether builder animation is active |
| [249](#L249) | \* @return boolean|string |
| [250](#L250) | \*/ |
| [251](#L251) | public static function is\_animation\_active() { |
| [252](#L252) | static $is = NULL; |
| [253](#L253) | if ($is === null) { |
| [254](#L254) | $val = \themify\_builder\_get('setting-page\_builder\_animation\_appearance', 'builder\_animation\_appearance'); |
| [255](#L255) | $is = $val === 'all' || self::is\_front\_builder\_activate()? false : ('mobile' === $val ? 'm' : true); |
| [256](#L256) | } |
| [257](#L257) | return $is; |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) | /\*\* |
| [261](#L261) | \* Check whether builder parallax is active |
| [262](#L262) | \* @return boolean|string |
| [263](#L263) | \*/ |
| [264](#L264) | public static function is\_parallax\_active() { |
| [265](#L265) | static $is = NULL; |
| [266](#L266) | if ($is === null) { |
| [267](#L267) | $val = \themify\_builder\_get('setting-page\_builder\_animation\_parallax\_bg', 'builder\_animation\_parallax\_bg'); |
| [268](#L268) | $is = self::is\_front\_builder\_activate() ? true : ($val === 'all'? false : ('mobile' === $val ? 'm' : true)); |
| [269](#L269) | } |
| [270](#L270) | return $is; |
| [271](#L271) | } |
| [272](#L272) |  |
| [273](#L273) | /\*\* |
| [274](#L274) | \* Check whether builder scroll effect is active |
| [275](#L275) | \* @return boolean|string |
| [276](#L276) | \*/ |
| [277](#L277) | public static function is\_scroll\_effect\_active() { |
| [278](#L278) | static $is = NULL; |
| [279](#L279) | if ($is === null) { |
| [280](#L280) | // check if mobile excludes disabled OR disabled all transitions |
| [281](#L281) | $val = \themify\_builder\_get('setting-page\_builder\_animation\_scroll\_effect', 'builder\_animation\_scroll\_effect'); |
| [282](#L282) | $is = $val === 'all' || self::is\_front\_builder\_activate()? false : ('mobile' === $val ? 'm' : true); |
| [283](#L283) | } |
| [284](#L284) | return $is; |
| [285](#L285) | } |
| [286](#L286) |  |
| [287](#L287) | /\*\* |
| [288](#L288) | \* Check whether builder sticky scroll is active |
| [289](#L289) | \* @return boolean|string |
| [290](#L290) | \*/ |
| [291](#L291) | public static function is\_sticky\_scroll\_active() { |
| [292](#L292) | static $is = NULL; |
| [293](#L293) | if ($is === null) { |
| [294](#L294) | $val = \themify\_builder\_get('setting-page\_builder\_animation\_sticky\_scroll', 'builder\_animation\_sticky\_scroll'); |
| [295](#L295) | $is = $val === 'all' || self::is\_front\_builder\_activate()? false : ('mobile' === $val ? 'm' : true); |
| [296](#L296) | $is = apply\_filters('tb\_sticky\_scroll\_active', $is); |
| [297](#L297) | } |
| [298](#L298) | return $is; |
| [299](#L299) | } |
| [300](#L300) |  |
| [301](#L301) |  |
| [302](#L302) | /\*\* |
| [303](#L303) | \* Returns list of colors and thumbnails |
| [304](#L304) | \* |
| [305](#L305) | \* @return array |
| [306](#L306) | \*/ |
| [307](#L307) | public static function get\_gutters(bool $def=true):array { |
| [308](#L308) | $gutters=array( |
| [309](#L309) | 'gutter'=>3.2, |
| [310](#L310) | 'narrow'=>1.6, |
| [311](#L311) | 'none'=>0 |
| [312](#L312) | ); |
| [313](#L313) | foreach($gutters as $k=>$v){ |
| [314](#L314) | $val=\themify\_builder\_get( 'setting-'.$k,'setting-'.$k); |
| [315](#L315) | if($val!==null && $val!==''){ |
| [316](#L316) | if($v!=$val){ |
| [317](#L317) | $gutters[$k]=$val; |
| [318](#L318) | } |
| [319](#L319) | elseif($def===false){ |
| [320](#L320) | unset($gutters[$k]); |
| [321](#L321) | } |
| [322](#L322) | } |
| [323](#L323) | } |
| [324](#L324) | return $gutters; |
| [325](#L325) | } |
| [326](#L326) |  |
| [327](#L327) |  |
| [328](#L328) |  |
| [329](#L329) | /\*\* |
| [330](#L330) | \* Check whether an image script is use or not |
| [331](#L331) | \* |
| [332](#L332) | \* @since 2.4.2 Check if it's a Themify theme or not. If it's not, it's Builder standalone plugin. |
| [333](#L333) | \* |
| [334](#L334) | \* @return boolean |
| [335](#L335) | \*/ |
| [336](#L336) | public static function is\_img\_php\_disabled():bool { |
| [337](#L337) | static $is = NULL; |
| [338](#L338) | if ($is === null) { |
| [339](#L339) | $is = \themify\_builder\_get('setting-img\_settings\_use', 'image\_setting-img\_settings\_use') ? true : false; |
| [340](#L340) | } |
| [341](#L341) | return $is; |
| [342](#L342) | } |
| [343](#L343) |  |
| [344](#L344) | public static function is\_fullwidth\_layout\_supported():bool { |
| [345](#L345) | return apply\_filters('themify\_builder\_fullwidth\_layout\_support', false); |
| [346](#L346) | } |
| [347](#L347) |  |
| [348](#L348) | /\*\* |
| [349](#L349) | \* Get alt text defined in WP Media attachment by a given URL |
| [350](#L350) | \* |
| [351](#L351) | \* @since 2.2.5 |
| [352](#L352) | \* |
| [353](#L353) | \* @param string $image\_url |
| [354](#L354) | \* |
| [355](#L355) | \* @return string |
| [356](#L356) | \*/ |
| [357](#L357) | public static function get\_alt\_by\_url(string $image\_url):string { |
| [358](#L358) | $attachment\_id = themify\_get\_attachment\_id\_from\_url($image\_url); |
| [359](#L359) | if ($attachment\_id && ($alt = get\_post\_meta($attachment\_id, '\_wp\_attachment\_image\_alt', true))) { |
| [360](#L360) | return $alt; |
| [361](#L361) | } |
| [362](#L362) | return ''; |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | /\*\* |
| [366](#L366) | \* Get all modules settings for used in localize script. |
| [367](#L367) | \* |
| [368](#L368) | \* @access public |
| [369](#L369) | \* @return array |
| [370](#L370) | \*/ |
| [371](#L371) | public static function get\_modules\_localize\_settings():array { |
| [372](#L372) | $return = array(); |
| [373](#L373) | $modules=Themify\_Builder\_Component\_Module::load\_modules(); |
| [374](#L374) | foreach ($modules as $id=>$module) { |
| [375](#L375) | $return[$id]=array(); |
| [376](#L376) |  |
| [377](#L377) | if(is\_string($module)){ |
| [378](#L378) | $icon = $module::get\_module\_icon(); |
| [379](#L379) | $name= $module::get\_module\_name(); |
| [380](#L380) | }else{ |
| [381](#L381) | $icon = $module->get\_icon(); |
| [382](#L382) | $name= $module->get\_name(); |
| [383](#L383) | } |
| [384](#L384) | $return[$id]['name']=$name; |
| [385](#L385) | if ($icon !== '-1') { |
| [386](#L386) | if ($icon === '') { |
| [387](#L387) | $icon = $id; |
| [388](#L388) | } |
| [389](#L389) | $return[$id]['icon'] = $icon; |
| [390](#L390) | \themify\_get\_icon($icon, 'ti'); |
| [391](#L391) | } |
| [392](#L392) | } |
| [393](#L393) |  |
| [394](#L394) | return $return; |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) |  |
| [398](#L398) | public static function format\_text(string $content):string { |
| [399](#L399) | global $wp\_embed; |
| [400](#L400) |  |
| [401](#L401) | $isLoop = Themify\_Builder::$is\_loop; |
| [402](#L402) | Themify\_Builder::$is\_loop = true; |
| [403](#L403) | $content = wptexturize($content); |
| [404](#L404) |  |
| [405](#L405) | $pattern = '|<p>\s\*(https?://[^\s"]+)\s\*</p>|im'; // pattern to check embed url |
| [406](#L406) | $to = '<p>' . PHP\_EOL . '$1' . PHP\_EOL . '</p>'; // add line break |
| [407](#L407) | $content = $wp\_embed->run\_shortcode($content); |
| [408](#L408) | $content = preg\_replace($pattern, $to, $content); |
| [409](#L409) | $content = $wp\_embed->autoembed($content); |
| [410](#L410) | $content = do\_shortcode(shortcode\_unautop($content)); |
| [411](#L411) | Themify\_Builder::$is\_loop = $isLoop; |
| [412](#L412) | $content = convert\_smilies($content); |
| [413](#L413) | return self::generate\_read\_more($content); |
| [414](#L414) |  |
| [415](#L415) | } |
| [416](#L416) |  |
| [417](#L417) | /\* |
| [418](#L418) | \* Generate read more link for text module |
| [419](#L419) | \* |
| [420](#L420) | \* @param string $content |
| [421](#L421) | \* @return string generated load more link in the text. |
| [422](#L422) | \*/ |
| [423](#L423) |  |
| [424](#L424) | public static function generate\_read\_more(string $content):string { |
| [425](#L425) | if (!empty($content) && \strpos($content, '!--more') !== false && \preg\_match('/(<|&lt;)!--more(.\*?)?--(>|&gt;)/', $content, $matches)) { |
| [426](#L426) | $text = \trim($matches[2]); |
| [427](#L427) | $read\_more\_text = !empty($text) ? $text : apply\_filters('themify\_builder\_more\_text', \_\_('More ', 'themify')); |
| [428](#L428) | $content = \str\_replace($matches[0], '<div class="more-text" style="display: none">', $content); |
| [429](#L429) | $content .= '</div><a href="#" class="module-text-more">' . $read\_more\_text . '</a>'; |
| [430](#L430) | } |
| [431](#L431) | return $content; |
| [432](#L432) | } |
| [433](#L433) |  |
| [434](#L434) |  |
| [435](#L435) | public static function is\_module\_active(string $mod\_name):bool { |
| [436](#L436) | if (themify\_is\_themify\_theme()) { |
| [437](#L437) | $data = \themify\_get\_data(); |
| [438](#L438) | $pre = 'setting-page\_builder\_exc\_'; |
| [439](#L439) | } else { |
| [440](#L440) | $pre = 'builder\_exclude\_module\_'; |
| [441](#L441) | $data = self::get\_builder\_settings(); |
| [442](#L442) | } |
| [443](#L443) | return empty($data[$pre . $mod\_name]); |
| [444](#L444) | } |
| [445](#L445) |  |
| [446](#L446) | /\*\* |
| [447](#L447) | \* Get module php files data |
| [448](#L448) | \*/ |
| [449](#L449) | public static function get\_modules(string $type = 'active',bool $ignore=false) { |
| [450](#L450) | $directories = self::$modules\_registry; |
| [451](#L451) | $defaultModules=array( |
| [452](#L452) | 'accordion'=>true, |
| [453](#L453) | 'alert'=>true, |
| [454](#L454) | 'box'=>true, |
| [455](#L455) | 'buttons'=>true, |
| [456](#L456) | 'callout'=>true, |
| [457](#L457) | 'code'=>true, |
| [458](#L458) | 'copyright'=>true, |
| [459](#L459) | 'divider'=>true, |
| [460](#L460) | 'fancy-heading'=>true, |
| [461](#L461) | 'feature'=>true, |
| [462](#L462) | 'gallery'=>true, |
| [463](#L463) | 'icon'=>true, |
| [464](#L464) | 'image'=>true, |
| [465](#L465) | 'layout-part'=>true, |
| [466](#L466) | 'link-block'=>true, |
| [467](#L467) | 'login'=>true, |
| [468](#L468) | 'lottie'=>true, |
| [469](#L469) | 'map'=>true, |
| [470](#L470) | 'menu'=>true, |
| [471](#L471) | 'optin'=>true, |
| [472](#L472) | 'overlay-content'=>true, |
| [473](#L473) | 'page-break'=>true, |
| [474](#L474) | 'plain-text'=>true, |
| [475](#L475) | 'post'=>true, |
| [476](#L476) | 'service-menu'=>true, |
| [477](#L477) | 'signup-form'=>true, |
| [478](#L478) | 'slider'=>true, |
| [479](#L479) | 'social-share'=>true, |
| [480](#L480) | 'star'=>true, |
| [481](#L481) | 'tab'=>true, |
| [482](#L482) | 'testimonial-slider'=>true, |
| [483](#L483) | 'text'=>true, |
| [484](#L484) | 'toc'=>true, |
| [485](#L485) | 'video'=>true, |
| [486](#L486) | 'widget'=>true, |
| [487](#L487) | 'widgetized'=>true |
| [488](#L488) | ); |
| [489](#L489) | $deprecated=array( |
| [490](#L490) | 'highlight'=>true, |
| [491](#L491) | 'portfolio'=>true, |
| [492](#L492) | 'testimonial'=>true |
| [493](#L493) | ); |
| [494](#L494) | $isNotSingle=$type === 'active' || $type === 'all'; |
| [495](#L495) | if($isNotSingle===true || isset($deprecated[$type])){ |
| [496](#L496) | foreach($deprecated as $id=>$dir){ |
| [497](#L497) | if(self::is\_cpt\_active( $id )){ |
| [498](#L498) | $defaultModules[$id]=$dir; |
| [499](#L499) | } |
| [500](#L500) | } |
| [501](#L501) | } |
| [502](#L502) | unset($deprecated); |
| [503](#L503) | if($isNotSingle===true){ |
| [504](#L504) | $modules = array(); |
| [505](#L505) | $defaultModules+=$directories; |
| [506](#L506) | foreach($defaultModules as $id=>$dir){ |
| [507](#L507) | if ($type !== 'active' || self::is\_module\_active($id)) { |
| [508](#L508) | $modules[$id] = $dir; |
| [509](#L509) | } |
| [510](#L510) | } |
| [511](#L511) | return $modules; |
| [512](#L512) | } |
| [513](#L513) | elseif((isset($defaultModules[$type]) || isset($directories[$type])) && ($ignore===true || self::is\_module\_active($type))){ |
| [514](#L514) | return isset($defaultModules[$type])?$defaultModules[$type]:$directories[$type]; |
| [515](#L515) | } |
| [516](#L516) | return ''; |
| [517](#L517) | } |
| [518](#L518) |  |
| [519](#L519) | /\*\* |
| [520](#L520) | \* Check whether theme loop template exist |
| [521](#L521) | \* @param string $template\_name |
| [522](#L522) | \* @param string $template\_path |
| [523](#L523) | \* @return boolean |
| [524](#L524) | \*/ |
| [525](#L525) | public static function is\_loop\_template\_exist(string $template\_name, string $template\_path):bool { |
| [526](#L526) | return !locate\_template(array(trailingslashit($template\_path) . $template\_name)) ? false : true; |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) | public static function add\_module(string $path) { |
| [530](#L530) |  |
| [531](#L531) | if(\strpos($path, '.php') !== false){ |
| [532](#L532) | $path\_info = \pathinfo($path); |
| [533](#L533) | $id = \str\_replace('module-', '', $path\_info['filename']); |
| [534](#L534) | self::$modules\_registry[$id]=$path\_info['dirname']; |
| [535](#L535) | } |
| [536](#L536) | elseif (is\_dir($path)) {//backward |
| [537](#L537) | $d = dir($path); |
| [538](#L538) | while (( false !== ( $entry = $d->read() ))) { |
| [539](#L539) | if ($entry !== '.' && $entry !== '..' && $entry !== '.svn' && strpos($entry, 'module-') === 0) { |
| [540](#L540) | $id = str\_replace(array('module-','.php'), '', $entry); |
| [541](#L541) | self::$modules\_registry[$id] =rtrim($d->path,'/'); |
| [542](#L542) | } |
| [543](#L543) | } |
| [544](#L544) | } |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | public static function get\_directory\_path($context=''):array { |
| [548](#L548) | return self::$modules\_registry; |
| [549](#L549) | } |
| [550](#L550) |  |
| [551](#L551) |  |
| [552](#L552) | public static function is\_cpt\_active(string $post\_type):bool { |
| [553](#L553) | return apply\_filters("builder\_is\_{$post\_type}\_active", \in\_array($post\_type, self::$builder\_cpt, true)); |
| [554](#L554) | } |
| [555](#L555) |  |
| [556](#L556) | public static function builder\_cpt\_check():void { |
| [557](#L557) | if(empty(self::$builder\_cpt)){ |
| [558](#L558) | global $wpdb; |
| [559](#L559) | foreach (array('slider', 'highlight', 'testimonial') as $cpt) { |
| [560](#L560) | if (post\_type\_exists($cpt)) { |
| [561](#L561) | self::$builder\_cpt[] = $cpt; |
| [562](#L562) | } |
| [563](#L563) | else { |
| [564](#L564) | $post=$wpdb->get\_row('SELECT 1 FROM ' .  $wpdb->posts . ' WHERE `post\_type`="' . $cpt . '" LIMIT 1'); |
| [565](#L565) | if (!empty($post)) { |
| [566](#L566) | self::$builder\_cpt[] = $cpt; |
| [567](#L567) | } |
| [568](#L568) | } |
| [569](#L569) | } |
| [570](#L570) | } |
| [571](#L571) | } |
| [572](#L572) |  |
| [573](#L573) | /\*\* |
| [574](#L574) | \* Get a list of post types that can be accessed publicly |
| [575](#L575) | \* |
| [576](#L576) | \* does not include attachments, Builder layouts and layout parts, |
| [577](#L577) | \* and also custom post types in Builder that have their own module. |
| [578](#L578) | \* |
| [579](#L579) | \* @return array of key => label pairs |
| [580](#L580) | \*/ |
| [581](#L581) | public static function get\_public\_post\_types():array { |
| [582](#L582) | $excluded = array('attachment'=>true, Themify\_Builder\_Layouts::LAYOUT\_SLUG=>true, Themify\_Builder\_Layouts::LAYOUT\_PART\_SLUG=>true,Themify\_Global\_Styles::SLUG=>true, Themify\_Custom\_Fonts::SLUG=>true,  'section'=>true, 'elementor\_library'=>true); |
| [583](#L583) | $result=[]; |
| [584](#L584) | foreach (get\_post\_types(array('public' => true, 'publicly\_queryable' => 'true'), 'objects') as $key => $value) { |
| [585](#L585) | if (!isset($excluded[$key])) { |
| [586](#L586) | $result[$key] = $value->labels->singular\_name; |
| [587](#L587) | } |
| [588](#L588) | } |
| [589](#L589) | return apply\_filters('builder\_get\_public\_post\_types', $result); |
| [590](#L590) | } |
| [591](#L591) |  |
| [592](#L592) | /\*\* |
| [593](#L593) | \* Get a list of taxonomies that can be accessed publicly |
| [594](#L594) | \* |
| [595](#L595) | \* does not include post formats, section categories (used by some themes), |
| [596](#L596) | \* and also custom post types in Builder that have their own module. |
| [597](#L597) | \* |
| [598](#L598) | \* @return array of key => label pairs |
| [599](#L599) | \*/ |
| [600](#L600) | public static function get\_public\_taxonomies():array { |
| [601](#L601) | $excluded = array('post\_format'=>true, 'section-category'=>true,'product\_shipping\_class'=>true); |
| [602](#L602) | $result=[]; |
| [603](#L603) | foreach (get\_taxonomies(array('public' => true), 'objects') as $key => $value) { |
| [604](#L604) | if (!isset($excluded[$key])) { |
| [605](#L605) | $result[$key] = $value->labels->name; |
| [606](#L606) | } |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | return apply\_filters('builder\_get\_public\_taxonomies', $result); |
| [610](#L610) | } |
| [611](#L611) |  |
| [612](#L612) | public static function parse\_slug\_to\_ids(string $slug\_string, string $post\_type = 'post'):array { |
| [613](#L613) | $slug\_arr = \explode(',', $slug\_string); |
| [614](#L614) | $return = []; |
| [615](#L615) | if (!empty($slug\_arr)) { |
| [616](#L616) | foreach ($slug\_arr as $slug) { |
| [617](#L617) | $return[] = \is\_numeric( $slug ) ? $slug : self::get\_id\_by\_slug(trim($slug), $post\_type); |
| [618](#L618) | } |
| [619](#L619) | } |
| [620](#L620) | return $return; |
| [621](#L621) | } |
| [622](#L622) |  |
| [623](#L623) | public static function get\_id\_by\_slug(string $slug,string $post\_type = 'post'):?int{ |
| [624](#L624) | $args = array( |
| [625](#L625) | 'name' => $slug, |
| [626](#L626) | 'post\_type' => $post\_type, |
| [627](#L627) | 'post\_status' => 'publish', |
| [628](#L628) | 'numberposts' => 1, |
| [629](#L629) | 'no\_found\_rows' => true, |
| [630](#L630) | 'cache\_results' => false, |
| [631](#L631) | 'ignore\_sticky\_posts' => true, |
| [632](#L632) | 'update\_post\_term\_cache' => false, |
| [633](#L633) | 'update\_post\_meta\_cache' => false, |
| [634](#L634) | 'orderby' => 'none' |
| [635](#L635) | ); |
| [636](#L636) | $my\_posts = get\_posts($args); |
| [637](#L637) | return $my\_posts ? $my\_posts[0]->ID : null; |
| [638](#L638) | } |
| [639](#L639) |  |
| [640](#L640) | public static function getMapKey():?string { |
| [641](#L641) | return \themify\_builder\_get('setting-google\_map\_key', 'builder\_settings\_google\_map\_key'); |
| [642](#L642) | } |
| [643](#L643) |  |
| [644](#L644) | /\*\* |
| [645](#L645) | \* Get Builder Settings |
| [646](#L646) | \*/ |
| [647](#L647) | public static function get\_builder\_settings():array { |
| [648](#L648) | static $data = null; |
| [649](#L649) | if ($data === null) { |
| [650](#L650) | $data = get\_option('themify\_builder\_setting'); |
| [651](#L651) | if (!empty($data) && is\_array($data)) { |
| [652](#L652) | foreach ($data as $name => $value) { |
| [653](#L653) | $data[$name] = stripslashes($value); |
| [654](#L654) | } |
| [655](#L655) | } |
| [656](#L656) | else { |
| [657](#L657) | $data = array(); |
| [658](#L658) | } |
| [659](#L659) | } |
| [660](#L660) | return $data; |
| [661](#L661) | } |
| [662](#L662) |  |
| [663](#L663) | /\*\* |
| [664](#L664) | \* Get ID |
| [665](#L665) | \*/ |
| [666](#L666) | public static function get\_ID() { |
| [667](#L667) | return \themify\_is\_shop() ? \themify\_shop\_pageId() : \get\_the\_id(); |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) |  |
| [671](#L671) | public static function get\_transient\_time() { |
| [672](#L672) | return apply\_filters('themify\_builder\_ticks', MINUTE\_IN\_SECONDS / 2); |
| [673](#L673) | } |
| [674](#L674) |  |
| [675](#L675) | public static function set\_edit\_transient($post\_id, $value) { |
| [676](#L676) | return Themify\_Storage::set(self::TRANSIENT\_NAME . $post\_id, $value, self::get\_transient\_time()); |
| [677](#L677) | } |
| [678](#L678) |  |
| [679](#L679) | public static function get\_edit\_transient($post\_id) { |
| [680](#L680) | return Themify\_Storage::get(self::TRANSIENT\_NAME . $post\_id); |
| [681](#L681) | } |
| [682](#L682) |  |
| [683](#L683) | public static function remove\_edit\_transient($post\_id) { |
| [684](#L684) | return Themify\_Storage::delete(self::TRANSIENT\_NAME . $post\_id); |
| [685](#L685) | } |
| [686](#L686) |  |
| [687](#L687) |  |
| [688](#L688) | /\*\* |
| [689](#L689) | \* Check if gutenberg active |
| [690](#L690) | \* @return boolean |
| [691](#L691) | \*/ |
| [692](#L692) | public static function is\_gutenberg\_active():bool { |
| [693](#L693) | static $is = null; |
| [694](#L694) | if ($is === null) { |
| [695](#L695) | $is = !self::is\_plugin\_active('disable-gutenberg/disable-gutenberg.php') && !self::is\_plugin\_active('classic-editor/classic-editor.php'); |
| [696](#L696) | } |
| [697](#L697) | return $is; |
| [698](#L698) | } |
| [699](#L699) |  |
| [700](#L700) |  |
| [701](#L701) | /\*\* |
| [702](#L702) | \* Check if we are gutenberg editor |
| [703](#L703) | \* !IMPORTANT can be used only after action "get\_current\_screen" |
| [704](#L704) | \* @return boolean |
| [705](#L705) | \*/ |
| [706](#L706) | public static function is\_gutenberg\_editor():bool { |
| [707](#L707) | static $is = null; |
| [708](#L708) | if ($is === null) { |
| [709](#L709) | $is = !isset($\_GET['classic-editor']) && is\_admin() && self::is\_gutenberg\_active() && get\_current\_screen()->is\_block\_editor(); |
| [710](#L710) | } |
| [711](#L711) | return $is; |
| [712](#L712) | } |
| [713](#L713) |  |
| [714](#L714) | /\*\* |
| [715](#L715) | \* Plugin Active checking |
| [716](#L716) | \* |
| [717](#L717) | \* @access public |
| [718](#L718) | \* @param string $plugin |
| [719](#L719) | \* @return bool |
| [720](#L720) | \*/ |
| [721](#L721) | public static function is\_plugin\_active(string $plugin):bool { |
| [722](#L722) | static $plugins = null; |
| [723](#L723) | static $active\_plugins = array(); |
| [724](#L724) | if ($plugins === null) { |
| [725](#L725) | $plugins = is\_multisite() ? get\_site\_option('active\_sitewide\_plugins') : false; |
| [726](#L726) | $active\_plugins = (array) apply\_filters('active\_plugins', get\_option('active\_plugins')); |
| [727](#L727) | } |
| [728](#L728) | return ( $plugins !== false && isset($plugins[$plugin]) ) || in\_array($plugin, $active\_plugins, true); |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) |  |
| [732](#L732) | public static function checkUniqId($id):string{ |
| [733](#L733) | static $ids=array(); |
| [734](#L734) | if($id!==null && !isset($ids[$id])){ |
| [735](#L735) | $ids[$id] = true; |
| [736](#L736) | return $id; |
| [737](#L737) | } |
| [738](#L738) | $id=self::generateID(); |
| [739](#L739) | if(isset($ids[$id])){ |
| [740](#L740) | while(isset($ids[$id])){ |
| [741](#L741) | $id = self::generateID(); |
| [742](#L742) | } |
| [743](#L743) | } |
| [744](#L744) | $ids[$id] = true; |
| [745](#L745) | return $id; |
| [746](#L746) | } |
| [747](#L747) |  |
| [748](#L748) | public static function generateID():string { |
| [749](#L749) | $hash = ''; |
| [750](#L750) | $alpha\_numeric = 'abcdefghijklmnopqrstuvwxyz0123456789'; |
| [751](#L751) | for ($i = 0; $i < 4; ++$i) { |
| [752](#L752) | $hash .= '' . $alpha\_numeric[rand(0, 35)]; |
| [753](#L753) | } |
| [754](#L754) | $m = microtime(); |
| [755](#L755) | $len = strlen($m); |
| [756](#L756) | if ($len > 10) { |
| [757](#L757) | $len = floor($len / 2); |
| [758](#L758) | } |
| [759](#L759) | --$len; |
| [760](#L760) | for ($i = 0; $i < 3; ++$i) { |
| [761](#L761) | $h = $m[rand(2, $len)]; |
| [762](#L762) | if ($h === '') { |
| [763](#L763) | $h = $m[rand(2, ( $len - 1))]; |
| [764](#L764) | } |
| [765](#L765) | $hash .= $h; |
| [766](#L766) | } |
| [767](#L767) | return $hash; |
| [768](#L768) | } |
| [769](#L769) |  |
| [770](#L770) |  |
| [771](#L771) | public static function removeElementIds(array &$data):void { |
| [772](#L772) | //save sticky/unsticky ids |
| [773](#L773) | $elementIds=$sticky=array(); |
| [774](#L774) | foreach ($data as $i=>&$r) { |
| [775](#L775) | if(isset($r['element\_id'])){ |
| [776](#L776) | $elementIds[$r['element\_id']]=$i; |
| [777](#L777) | } |
| [778](#L778) | if(isset($r['styling']['unstick\_when\_el\_row\_id'])){ |
| [779](#L779) | $sticky[$i.'r']=$r['styling']['unstick\_when\_el\_row\_id']; |
| [780](#L780) | } |
| [781](#L781) | if(isset($r['styling']['unstick\_when\_el\_mod\_id'])){ |
| [782](#L782) | $sticky[$i.'m']=$r['styling']['unstick\_when\_el\_mod\_id']; |
| [783](#L783) | } |
| [784](#L784) | unset($r['cid'], $r['element\_id']); |
| [785](#L785) |  |
| [786](#L786) | if (!empty($r['cols'])) { |
| [787](#L787) |  |
| [788](#L788) | foreach ($r['cols'] as $j=>&$c) { |
| [789](#L789) |  |
| [790](#L790) | unset($c['cid'], $c['element\_id']); |
| [791](#L791) |  |
| [792](#L792) | if (!empty($c['modules'])) { |
| [793](#L793) |  |
| [794](#L794) | foreach ($c['modules'] as $mk=>&$m) { |
| [795](#L795) | if(isset($m['element\_id'])){ |
| [796](#L796) | $elementIds[$m['element\_id']]=$i.'-'.$j.'-'.$mk; |
| [797](#L797) | unset($m['element\_id']); |
| [798](#L798) | } |
| [799](#L799) | if (isset($m['mod\_settings']['cid'])) { |
| [800](#L800) | unset($m['mod\_settings']['cid']); |
| [801](#L801) | } |
| [802](#L802) | if(isset($m['mod\_settings']['unstick\_when\_el\_row\_id'])){ |
| [803](#L803) | $sticky[$i.'-'.$j.'-'.$mk.'r']=$m['mod\_settings']['unstick\_when\_el\_row\_id']; |
| [804](#L804) | } |
| [805](#L805) | if(isset($m['mod\_settings']['unstick\_when\_el\_mod\_id'])){ |
| [806](#L806) | $sticky[$i.'-'.$j.'-'.$mk.'m']=$m['mod\_settings']['unstick\_when\_el\_mod\_id']; |
| [807](#L807) | } |
| [808](#L808) | if (!empty($m['cols'])) { |
| [809](#L809) | if(isset($m['styling']['unstick\_when\_el\_row\_id'])){ |
| [810](#L810) | $sticky[$i.'-'.$j.'-'.$mk.'r']=$m['styling']['unstick\_when\_el\_row\_id']; |
| [811](#L811) | } |
| [812](#L812) | if(isset($m['styling']['unstick\_when\_el\_mod\_id'])){ |
| [813](#L813) | $sticky[$i.'-'.$j.'-'.$mk.'m']=$m['styling']['unstick\_when\_el\_mod\_id']; |
| [814](#L814) | } |
| [815](#L815) | foreach ($m['cols'] as $sb=>&$sub\_col) { |
| [816](#L816) |  |
| [817](#L817) | unset($sub\_col['cid'], $sub\_col['element\_id']); |
| [818](#L818) |  |
| [819](#L819) | if (!empty($sub\_col['modules'])) { |
| [820](#L820) |  |
| [821](#L821) | foreach ($sub\_col['modules'] as $sm=>&$sub\_m) { |
| [822](#L822) | if(isset($sub\_m['element\_id'])){ |
| [823](#L823) | $elementIds[$sub\_m['element\_id']]=$i.'-'.$j.'-'.$mk.'-'.$sb.'-'.$sm; |
| [824](#L824) | unset($sub\_m['element\_id']); |
| [825](#L825) | } |
| [826](#L826) | if(isset($sub\_m['mod\_settings']['unstick\_when\_el\_row\_id'])){ |
| [827](#L827) | $sticky[$i.'-'.$j.'-'.$mk.'-'.$sb.'-'.$sm.'r']=$sub\_m['mod\_settings']['unstick\_when\_el\_row\_id']; |
| [828](#L828) | } |
| [829](#L829) | if(isset($sub\_m['mod\_settings']['unstick\_when\_el\_mod\_id'])){ |
| [830](#L830) | $sticky[$i.'-'.$j.'-'.$mk.'-'.$sb.'-'.$sm.'m']=$sub\_m['mod\_settings']['unstick\_when\_el\_mod\_id']; |
| [831](#L831) | } |
| [832](#L832) | if (isset($sub\_m['mod\_settings']['cid'])) { |
| [833](#L833) | unset($sub\_m['mod\_settings']['cid']); |
| [834](#L834) | } |
| [835](#L835) | } |
| [836](#L836) | } |
| [837](#L837) | } |
| [838](#L838) | } |
| [839](#L839) | } |
| [840](#L840) | } |
| [841](#L841) | } |
| [842](#L842) | } |
| [843](#L843) | } |
| [844](#L844) | if(!empty($sticky)){ |
| [845](#L845) | foreach($sticky as $v=>$id){ |
| [846](#L846) | if(isset($elementIds[$id])){ |
| [847](#L847) | $newId=self::generateID(); |
| [848](#L848) | $path1=explode('-',$elementIds[$id]); |
| [849](#L849) | $key=strpos($v,'r',1)!==false?'unstick\_when\_el\_row\_id':'unstick\_when\_el\_mod\_id'; |
| [850](#L850) | $path2=explode('-',strtr($v,array('r'=>'','m'=>''))); |
| [851](#L851) | if(isset($path1[4])){ |
| [852](#L852) | if(!isset($data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['cols'][$path1[3]]['modules'][$path1[4]]['element\_id'])){ |
| [853](#L853) | $data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['cols'][$path1[3]]['modules'][$path1[4]]['element\_id']=$newId; |
| [854](#L854) | } |
| [855](#L855) | else{ |
| [856](#L856) | $newId=$data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['cols'][$path1[3]]['modules'][$path1[4]]['element\_id']; |
| [857](#L857) | } |
| [858](#L858) | } |
| [859](#L859) | elseif(isset($path1[1])){ |
| [860](#L860) | if(!isset($data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['element\_id'])){ |
| [861](#L861) | $data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['element\_id']=$newId; |
| [862](#L862) | } |
| [863](#L863) | else{ |
| [864](#L864) | $newId=$data[$path1[0]]['cols'][$path1[1]]['modules'][$path1[2]]['element\_id']; |
| [865](#L865) | } |
| [866](#L866) | } |
| [867](#L867) | else{ |
| [868](#L868) | if(!isset($data[$path1[0]]['element\_id'])){ |
| [869](#L869) | $data[$path1[0]]['element\_id']=$newId; |
| [870](#L870) | } |
| [871](#L871) | else{ |
| [872](#L872) | $newId=$data[$path1[0]]['element\_id']; |
| [873](#L873) | } |
| [874](#L874) | } |
| [875](#L875) |  |
| [876](#L876) | if(isset($path2[4])){ |
| [877](#L877) | $data[$path2[0]]['cols'][$path2[1]]['modules'][$path2[2]]['cols'][$path2[3]]['modules'][$path2[4]]['mod\_settings'][$key]=$newId; |
| [878](#L878) | } |
| [879](#L879) | elseif(isset($path2[1])){ |
| [880](#L880) | $mKey=!empty($data[$path2[0]]['cols'][$path2[1]]['modules'][$path2[2]]['cols'])?'styling':'mod\_settings'; |
| [881](#L881) | $data[$path2[0]]['cols'][$path2[1]]['modules'][$path2[2]][$mKey][$key]=$newId; |
| [882](#L882) | } |
| [883](#L883) | else{ |
| [884](#L884) | $data[$path2[0]]['styling'][$key]=$newId; |
| [885](#L885) | } |
| [886](#L886) | } |
| [887](#L887) | } |
| [888](#L888) | } |
| [889](#L889) | unset($sticky,$elementIds); |
| [890](#L890) | } |
| [891](#L891) |  |
| [892](#L892) |  |
| [893](#L893) | /\*\* |
| [894](#L894) | \* Generate an unique Id for each component if it doesn't have and check unique in the builder |
| [895](#L895) | \*/ |
| [896](#L896) | public static function generateElementsIds(array &$data):void { |
| [897](#L897) | foreach ($data as &$r) { |
| [898](#L898) | $r['element\_id'] = self::checkUniqId((isset($r['element\_id']) ? $r['element\_id'] : null)); |
| [899](#L899) | unset($r['row\_order'],$r['cid']); |
| [900](#L900) | if (!empty($r['cols'])) { |
| [901](#L901) | foreach ($r['cols'] as &$c) { |
| [902](#L902) | $c['element\_id'] = self::checkUniqId((isset($c['element\_id']) ? $c['element\_id'] : null)); |
| [903](#L903) | unset($c['column\_order'],$c['cid']); |
| [904](#L904) | if (!empty($c['modules'])) { |
| [905](#L905) | foreach ($c['modules'] as &$m) { |
| [906](#L906) | if (!is\_array($m)) { |
| [907](#L907) | continue; |
| [908](#L908) | } |
| [909](#L909) | $m['element\_id'] = self::checkUniqId((isset($m['element\_id']) ? $m['element\_id'] : null)); |
| [910](#L910) | unset($m['row\_order'],$m['mod\_settings']['cid']); |
| [911](#L911) | if (!empty($m['cols'])) { |
| [912](#L912) | foreach ($m['cols'] as &$sub\_col) { |
| [913](#L913) | $sub\_col['element\_id'] = self::checkUniqId((isset($sub\_col['element\_id']) ? $sub\_col['element\_id'] : null)); |
| [914](#L914) | unset($sub\_col['column\_order'],$sub\_col['cid']); |
| [915](#L915) | if (!empty($sub\_col['modules'])) { |
| [916](#L916) | foreach ($sub\_col['modules'] as &$sub\_m) { |
| [917](#L917) | $sub\_m['element\_id'] = self::checkUniqId((isset($sub\_m['element\_id']) ? $sub\_m['element\_id'] : null)); |
| [918](#L918) | unset($sub\_m['mod\_settings']['cid']); |
| [919](#L919) | } |
| [920](#L920) | } |
| [921](#L921) | } |
| [922](#L922) | } |
| [923](#L923) | } |
| [924](#L924) | } |
| [925](#L925) | } |
| [926](#L926) | } |
| [927](#L927) | } |
| [928](#L928) | } |
| [929](#L929) |  |
| [930](#L930) | public static function parseTerms(string $terms, $taxonomy=''):array { |
| [931](#L931) | $include\_by\_id = $exclude\_by\_id = $include\_by\_slug = $exclude\_by\_slug = array(); |
| [932](#L932) | // deal with how category fields are saved |
| [933](#L933) | $terms = \preg\_replace('/\|[multiple|single]\*$/', '', $terms); |
| [934](#L934) |  |
| [935](#L935) | if ( $terms === '0' || $terms === '' ) { |
| [936](#L936) | return array(); |
| [937](#L937) | } |
| [938](#L938) |  |
| [939](#L939) | $temp\_terms = explode(',', $terms); |
| [940](#L940) |  |
| [941](#L941) | foreach ($temp\_terms as $t) { |
| [942](#L942) | $t = trim($t); |
| [943](#L943) | $isNumeric = is\_numeric($t); |
| [944](#L944) | $exclude = $t[0] === '-'; |
| [945](#L945) | if ($isNumeric === false) { |
| [946](#L946) | if ($exclude===true) { |
| [947](#L947) | $exclude\_by\_slug[] = ltrim($t, '-'); |
| [948](#L948) | } else { |
| [949](#L949) | $include\_by\_slug[] = $t; |
| [950](#L950) | } |
| [951](#L951) | } else { |
| [952](#L952) | if ($exclude===true) { |
| [953](#L953) | $exclude\_by\_id[] = ltrim($t, '-'); |
| [954](#L954) | } else { |
| [955](#L955) | $include\_by\_id[] = $t; |
| [956](#L956) | } |
| [957](#L957) | } |
| [958](#L958) | } |
| [959](#L959) | return array\_filter(compact('include\_by\_id', 'exclude\_by\_id', 'include\_by\_slug', 'exclude\_by\_slug')); |
| [960](#L960) | } |
| [961](#L961) |  |
| [962](#L962) | public static function parseTermsQuery(array &$args,string $term,string $taxonomy):void { |
| [963](#L963) | $terms = self::parseTerms($term); |
| [964](#L964) | if (!empty( $terms ) ) { |
| [965](#L965) | $args['tax\_query'] = array(); |
| [966](#L966) | if (!empty($terms['include\_by\_id']) && !in\_array('0', $terms['include\_by\_id'])) { |
| [967](#L967) | $args['tax\_query'][] = array( |
| [968](#L968) | array( |
| [969](#L969) | 'taxonomy' => $taxonomy, |
| [970](#L970) | 'field' => 'id', |
| [971](#L971) | 'terms' => $terms['include\_by\_id'] |
| [972](#L972) | ) |
| [973](#L973) | ); |
| [974](#L974) | } |
| [975](#L975) | if (!empty($terms['include\_by\_slug']) && !in\_array('0', $terms['include\_by\_slug'])) { |
| [976](#L976) | $args['tax\_query'][] = array( |
| [977](#L977) | array( |
| [978](#L978) | 'taxonomy' => $taxonomy, |
| [979](#L979) | 'field' => 'slug', |
| [980](#L980) | 'terms' => $terms['include\_by\_slug'] |
| [981](#L981) | ) |
| [982](#L982) | ); |
| [983](#L983) | } |
| [984](#L984) | if (!empty($terms['exclude\_by\_id'])) { |
| [985](#L985) | $args['tax\_query'][] = array( |
| [986](#L986) | 'taxonomy' => $taxonomy, |
| [987](#L987) | 'field' => 'id', |
| [988](#L988) | 'terms' => $terms['exclude\_by\_id'], |
| [989](#L989) | 'operator' => 'NOT IN' |
| [990](#L990) | ); |
| [991](#L991) | } |
| [992](#L992) | if (!empty($terms['exclude\_by\_slug'])) { |
| [993](#L993) | $args['tax\_query'][] = array( |
| [994](#L994) | 'taxonomy' => $taxonomy, |
| [995](#L995) | 'field' => 'slug', |
| [996](#L996) | 'terms' => $terms['exclude\_by\_slug'], |
| [997](#L997) | 'operator' => 'NOT IN' |
| [998](#L998) | ); |
| [999](#L999) | } |
| [1000](#L1000) | } |
| [1001](#L1001) | } |
| [1002](#L1002) |  |
| [1003](#L1003) | public static function load\_appearance\_css(string $data):void { |
| [1004](#L1004) | static $is=null; |
| [1005](#L1005) | if ($is===null && $data !== '' && $data != 'bordered' && $data !== 'circle') { |
| [1006](#L1006) | if(Themify\_Builder::$frontedit\_active === true){ |
| [1007](#L1007) | $is=true; |
| [1008](#L1008) | } |
| [1009](#L1009) | else{ |
| [1010](#L1010) | $data=trim($data); |
| [1011](#L1011) | if($data!==''){ |
| [1012](#L1012) | $arr=array('glossy','rounded','shadow','gradient','embossed'); |
| [1013](#L1013) | foreach($arr as $v){ |
| [1014](#L1014) | if(\strpos($data,$v)!==false){ |
| [1015](#L1015) | $is=true; |
| [1016](#L1016) | self::loadCssModules('app',THEMIFY\_BUILDER\_CSS\_MODULES . 'appearance.css'); |
| [1017](#L1017) | break; |
| [1018](#L1018) | } |
| [1019](#L1019) | } |
| [1020](#L1020) | } |
| [1021](#L1021) | } |
| [1022](#L1022) | } |
| [1023](#L1023) | } |
| [1024](#L1024) |  |
| [1025](#L1025) | public static function load\_color\_css(string $color) { |
| [1026](#L1026) | static $is=null; |
| [1027](#L1027) | if ($is===null && $color != '' && $color !== 'tb\_default\_color' && $color !== 'default' && $color !== 'transparent'  && $color !== 'white' && $color !== 'outline' && Themify\_Builder::$frontedit\_active === false) { |
| [1028](#L1028) | $is=true; |
| [1029](#L1029) | self::loadCssModules('color',THEMIFY\_BUILDER\_CSS\_MODULES.'colors.css'); |
| [1030](#L1030) | } |
| [1031](#L1031) | } |
| [1032](#L1032) |  |
| [1033](#L1033) | public static function load\_module\_self\_style(string $slug, string $css, string $alter\_url = '', string $media='all') { |
| [1034](#L1034) | if (Themify\_Builder::$frontedit\_active === false) { |
| [1035](#L1035) | $key = $slug . '\_' . str\_replace('/', '\_', $css); |
| [1036](#L1036) | if ($alter\_url === '') { |
| [1037](#L1037) | $alter\_url = THEMIFY\_BUILDER\_CSS\_MODULES . $slug . '\_styles/' . $css; |
| [1038](#L1038) | } |
| [1039](#L1039) | self::loadCssModules($key, $alter\_url . '.css',THEMIFY\_VERSION,$media); |
| [1040](#L1040) | } |
| [1041](#L1041) | } |
| [1042](#L1042) |  |
| [1043](#L1043) | public static function loadCssModules(string $key, string $url, string $v=THEMIFY\_VERSION, string $media = 'all') { |
| [1044](#L1044) | if(!is\_admin() || themify\_is\_ajax()){ |
| [1045](#L1045) | $key='tb\_' . $key; |
| [1046](#L1046) | \themify\_enque\_style($key, $url, null, $v, $media); |
| [1047](#L1047) | \Themify\_Enqueue\_Assets::addLocalization('done', $key, true); |
| [1048](#L1048) | } |
| [1049](#L1049) | } |
| [1050](#L1050) |  |
| [1051](#L1051) | public static function check\_plugins\_compatible():void {//check compatible of plugins |
| [1052](#L1052) | if (isset($\_GET['page']) && $\_GET['page'] === 'themify-license') { |
| [1053](#L1053) | return; |
| [1054](#L1054) | } |
| [1055](#L1055) | if (!function\_exists('get\_plugins')) { |
| [1056](#L1056) | require\_once ABSPATH . 'wp-admin/includes/plugin.php'; |
| [1057](#L1057) | } |
| [1058](#L1058) | $plugins = get\_plugins(); |
| [1059](#L1059) | $plugin\_root = WP\_PLUGIN\_DIR; |
| [1060](#L1060) | $needUpdate = false; |
| [1061](#L1061) | $hasUpdater = $updaterUrl = null; |
| [1062](#L1062) | $\_messages = array(); |
| [1063](#L1063) | $fw = THEMIFY\_VERSION; |
| [1064](#L1064) | $dependceFW = array('announcement-bar', 'themify-audio-dock', 'themify-builder-pro', 'themify-icons', 'themify-shortcodes', 'themify-popup', 'themify-portfolio-post', 'themify-event-post', 'themify-store-locator', 'themify-tiles'); |
| [1065](#L1065) | foreach ($plugins as $k => $p) { |
| [1066](#L1066) | if (isset($p['Author']) && $p['Author'] === 'Themify') { |
| [1067](#L1067) | $slug = dirname($k); |
| [1068](#L1068) | if (strpos($slug, 'builder-') === 0 || $slug === 'themify-updater' || in\_array($slug, $dependceFW, true)) { |
| [1069](#L1069) | if ($slug === 'themify-updater') { |
| [1070](#L1070) | if ($hasUpdater === null) { |
| [1071](#L1071) | $hasUpdater = is\_plugin\_active($k); |
| [1072](#L1072) | $updaterUrl = $k; |
| [1073](#L1073) | } |
| [1074](#L1074) | } else { |
| [1075](#L1075) | if (!isset($p['Compatibility'])) { |
| [1076](#L1076) | $data = get\_file\_data($plugin\_root . '/' . $k, array('v' => 'Compatibility'), false); |
| [1077](#L1077) | $v = $p['Compatibility'] = $data['v']; |
| [1078](#L1078) | $needUpdate = true; |
| [1079](#L1079) | } else { |
| [1080](#L1080) | $v = $p['Compatibility']; |
| [1081](#L1081) | } |
| [1082](#L1082) | $up = ''; |
| [1083](#L1083) | if($v){ |
| [1084](#L1084) | $v=explode(',',$v); |
| [1085](#L1085) | } |
| [1086](#L1086) | if (!$v) { // Compatibility header missing, plugin is older than FW 5.0.0 update |
| [1087](#L1087) | $up = 'plugin'; |
| [1088](#L1088) | } |
| [1089](#L1089) | elseif (version\_compare(trim($v[0]), $fw, '>') || (!empty($v[1]) && version\_compare($fw, trim($v[1]), '>='))){ // plugin requires a higher version of FW |
| [1090](#L1090) | $up = 'theme'; |
| [1091](#L1091) | } |
| [1092](#L1092) | if ($up !== '') { |
| [1093](#L1093) | if (!isset($\_messages[$up])) { |
| [1094](#L1094) | $\_messages[$up] = array(); |
| [1095](#L1095) | } |
| [1096](#L1096) | $\_messages[$up][] = $p['Name']; |
| [1097](#L1097) | } |
| [1098](#L1098) | } |
| [1099](#L1099) | } |
| [1100](#L1100) | } |
| [1101](#L1101) | } |
| [1102](#L1102) | if ($needUpdate === true) { |
| [1103](#L1103) | wp\_cache\_set('plugins', $plugins, 'plugins'); |
| [1104](#L1104) | } |
| [1105](#L1105) | if ($hasUpdater === false && $updaterUrl !== null && !empty($\_GET['tf-activate-updater'])) { |
| [1106](#L1106) | $tab = !empty($\_messages['theme']) ? 1 : 2; |
| [1107](#L1107) | $hasUpdater = activate\_plugins($updaterUrl, add\_query\_arg(array('page' => 'themify-license', 'promotion' => $tab), admin\_url())); |
| [1108](#L1108) | } |
| [1109](#L1109) | unset($needUpdate, $plugins, $dependceFW); |
| [1110](#L1110) |  |
| [1111](#L1111) | if (!empty($\_messages)) { |
| [1112](#L1112) | foreach ($\_messages as $k => $msg):?> |
| [1113](#L1113) | <div class="notice notice-error tf\_compatible\_erros tf\_<?php echo $k ?>\_erros"> |
| [1114](#L1114) | <p><strong><?php echo $k === 'plugin' ? \_\_('The following plugin(s) are not compatible with the activated theme. Please update your plugins:', 'themify') : \_\_('Please update your activated Themify theme or Builder plugin. The following plugin(s) are incompatible:', 'themify'); ?></strong></p> |
| [1115](#L1115) | <p><?php echo implode(', ', $msg); ?></p> |
| [1116](#L1116) | <p> |
| [1117](#L1117) | <?php if ($hasUpdater === true): ?> |
| [1118](#L1118) | <?php $tab = $k === 'plugin' ? 2 : 1; ?> |
| [1119](#L1119) | <a role="button" class="button button-primary" href="<?php echo add\_query\_arg(array('page' => 'themify-license', 'promotion' => $tab), admin\_url()) ?>"><?php \_e('Update them', 'themify') ?></a> |
| [1120](#L1120) | <?php elseif ($hasUpdater === false): ?> |
| [1121](#L1121) | <?php printf(\_\_('%s', 'themify'), '<a role="button" class="button" href="' . add\_query\_arg(array('tf-activate-updater' => 1)) . '">' . \_\_('Activate Themify Updater', 'themify') . '</a>') ?></a> |
| [1122](#L1122) | <?php else: ?> |
| [1123](#L1123) | <?php printf(\_\_('Install %s plugin to auto update them.', 'themify'), '<a href="' . add\_query\_arg(array('page' => 'themify-install-plugins'), admin\_url('admin.php')) . '">' . \_\_('Themify Updater', 'themify') . '</a>') ?></a> |
| [1124](#L1124) | <?php endif; ?> |
| [1125](#L1125) | </p> |
| [1126](#L1126) | </div> |
| [1127](#L1127) | <?php |
| [1128](#L1128) | endforeach; |
| [1129](#L1129) | } |
| [1130](#L1130) | } |
| [1131](#L1131) |  |
| [1132](#L1132) | /\*\* |
| [1133](#L1133) | \* Checks if Builder is disabled for a given post type |
| [1134](#L1134) | \*/ |
| [1135](#L1135) | public static function is\_builder\_disabled\_for\_post\_type( string $post\_type ):bool { |
| [1136](#L1136) | static $cache =array(); |
| [1137](#L1137) | if ( ! isset( $cache[ $post\_type ] ) ) { |
| [1138](#L1138) | $cache[ $post\_type ] = apply\_filters( "tb\_is\_disabled\_for\_{$post\_type}", null ); |
| [1139](#L1139) | if ( !isset($cache[ $post\_type ]) ) { |
| [1140](#L1140) | $cache[ $post\_type ] = themify\_builder\_check( 'setting-page\_builder\_disable\_' . $post\_type, 'builder\_disable\_tb\_' . $post\_type ); |
| [1141](#L1141) | } |
| [1142](#L1142) | } |
| [1143](#L1143) |  |
| [1144](#L1144) | return $cache[ $post\_type ]; |
| [1145](#L1145) | } |
| [1146](#L1146) |  |
| [1147](#L1147) | /\*\* |
| [1148](#L1148) | \* Parses the settings from a module and applies Advanced Query settings on the $query\_arg |
| [1149](#L1149) | \* |
| [1150](#L1150) | \* @return void |
| [1151](#L1151) | \*/ |
| [1152](#L1152) | public static function parse\_query\_filter(array $module\_settings,array &$query\_args ) { |
| [1153](#L1153) | if ( ! empty( $module\_settings['query\_date\_to'] ) ) { |
| [1154](#L1154) | $query\_args['date\_query']['inclusive'] = true; |
| [1155](#L1155) | $query\_args['date\_query']['before'] = $module\_settings['query\_date\_to']; |
| [1156](#L1156) | } |
| [1157](#L1157) | if ( ! empty( $module\_settings['query\_date\_from'] ) ) { |
| [1158](#L1158) | $query\_args['date\_query']['inclusive'] = true; |
| [1159](#L1159) | $query\_args['date\_query']['after'] = $module\_settings['query\_date\_from']; |
| [1160](#L1160) | } |
| [1161](#L1161) |  |
| [1162](#L1162) | if ( ! empty( $module\_settings['query\_authors'] ) ) { |
| [1163](#L1163) | $authors\_ids = []; |
| [1164](#L1164) | $authors = \explode( ',', $module\_settings['query\_authors'] ); |
| [1165](#L1165) | foreach ( $authors as $author ) { |
| [1166](#L1166) | $author=trim($author); |
| [1167](#L1167) | if ( is\_numeric( $author ) ) { |
| [1168](#L1168) | $authors\_ids[] = (int) $author; |
| [1169](#L1169) | } |
| [1170](#L1170) | elseif ( $user = get\_user\_by( 'login', $author ) ) { |
| [1171](#L1171) | $authors\_ids[] = $user->ID; |
| [1172](#L1172) | } |
| [1173](#L1173) | } |
| [1174](#L1174) | if ( ! empty( $authors\_ids ) ) { |
| [1175](#L1175) | $query\_args['author\_\_in'] = $authors\_ids; |
| [1176](#L1176) | } |
| [1177](#L1177) | } |
| [1178](#L1178) |  |
| [1179](#L1179) | if ( ! empty( $module\_settings['query\_cf\_key'] ) ) { |
| [1180](#L1180) | $meta\_query = [ |
| [1181](#L1181) | 'compare' => empty( $module\_settings['query\_cf\_c'] ) ? 'LIKE' : $module\_settings['query\_cf\_c'], |
| [1182](#L1182) | 'key' => $module\_settings['query\_cf\_key'] |
| [1183](#L1183) | ]; |
| [1184](#L1184) | if ( $meta\_query['compare'] !== 'NOT EXISTS' && $meta\_query['compare'] !== 'EXISTS' && ! empty( $module\_settings['query\_cf\_value'] ) ) { |
| [1185](#L1185) | $meta\_query['value'] = $module\_settings['query\_cf\_value']; |
| [1186](#L1186) | } |
| [1187](#L1187) |  |
| [1188](#L1188) | if ( ! isset( $query\_args['meta\_query'] ) ) { |
| [1189](#L1189) | $query\_args['meta\_query'] = []; |
| [1190](#L1190) | } |
| [1191](#L1191) | $query\_args['meta\_query'][] = $meta\_query; |
| [1192](#L1192) | } |
| [1193](#L1193) | } |
| [1194](#L1194) |  |
| [1195](#L1195) | /\*\* |
| [1196](#L1196) | \* Setup Hook Content feature for the module |
| [1197](#L1197) | \* |
| [1198](#L1198) | \* @return void |
| [1199](#L1199) | \*/ |
| [1200](#L1200) | public static function hook\_content\_start( array $settings ) { |
| [1201](#L1201) | if (!empty( $settings['hook\_content'] ) ) { |
| [1202](#L1202) | foreach ( $settings['hook\_content'] as $hook ) { |
| [1203](#L1203) | if (!empty( $hook['c'] ) ) { |
| [1204](#L1204) | if(!isset(self::$hook\_contents[ $hook['h'] ])){ |
| [1205](#L1205) | self::$hook\_contents[ $hook['h'] ]=array(); |
| [1206](#L1206) | } |
| [1207](#L1207) | self::$hook\_contents[ $hook['h'] ][] = $hook['c']; |
| [1208](#L1208) | add\_action( $hook['h'], array( \_\_CLASS\_\_, 'hook\_content\_output' ) ); |
| [1209](#L1209) | } |
| [1210](#L1210) | } |
| [1211](#L1211) | } |
| [1212](#L1212) | } |
| [1213](#L1213) |  |
| [1214](#L1214) | /\*\* |
| [1215](#L1215) | \* Remove hooks added by self::hook\_content\_start and reset cache |
| [1216](#L1216) | \* |
| [1217](#L1217) | \* @return void |
| [1218](#L1218) | \*/ |
| [1219](#L1219) | public static function hook\_content\_end(array $settings ) { |
| [1220](#L1220) | self::$hook\_contents = null; |
| [1221](#L1221) | if (!empty( $settings['hook\_content'] ) ) { |
| [1222](#L1222) | foreach ( $settings['hook\_content'] as $hook ) { |
| [1223](#L1223) | if (!empty( $hook['c'] ) ) { |
| [1224](#L1224) | remove\_action( $hook['h'], array( \_\_CLASS\_\_, 'hook\_content\_output' ) ); |
| [1225](#L1225) | } |
| [1226](#L1226) | } |
| [1227](#L1227) | } |
| [1228](#L1228) | } |
| [1229](#L1229) |  |
| [1230](#L1230) | /\*\* |
| [1231](#L1231) | \* Display the contents of a hook added in Post modules |
| [1232](#L1232) | \* |
| [1233](#L1233) | \* @return void |
| [1234](#L1234) | \*/ |
| [1235](#L1235) | public static function hook\_content\_output() { |
| [1236](#L1236) | $current\_filter = \current\_filter(); |
| [1237](#L1237) | if ( isset( self::$hook\_contents[ $current\_filter ] ) ) { |
| [1238](#L1238) | foreach ( self::$hook\_contents[ $current\_filter ] as $content ) { |
| [1239](#L1239) | echo '<!-- post hook:' , $current\_filter , ' -->' , do\_shortcode( $content ) , '<!-- /post hook:' , $current\_filter , ' -->'; |
| [1240](#L1240) | } |
| [1241](#L1241) | } |
| [1242](#L1242) | } |
| [1243](#L1243) |  |
| [1244](#L1244) |  |
| [1245](#L1245) | /\*\* |
| [1246](#L1246) | \* Returns an array containing paths to different assets loade by Builder editor |
| [1247](#L1247) | \*/ |
| [1248](#L1248) | public static function get\_layouts():array { |
| [1249](#L1249) | $themeLayoutsPath=get\_parent\_theme\_file\_path('builder-layouts/layouts.php'); |
| [1250](#L1250) | $arr= array( |
| [1251](#L1251) | // Pre-designed layouts |
| [1252](#L1252) | 'predesigned' => array( |
| [1253](#L1253) | 'title'=>\_\_( 'Pre-designed', 'themify' ), |
| [1254](#L1254) | 'url'=>'https://themify.org/public-api/builder-layouts/' |
| [1255](#L1255) | ) |
| [1256](#L1256) | ); |
| [1257](#L1257) | if(is\_file($themeLayoutsPath)){ |
| [1258](#L1258) | $themeLayouts=include $themeLayoutsPath; |
| [1259](#L1259) | $arr['theme']=array( |
| [1260](#L1260) | 'title'=>\_\_( 'Theme', 'themify' ), |
| [1261](#L1261) | 'data'=>$themeLayouts |
| [1262](#L1262) | ); |
| [1263](#L1263) | } |
| [1264](#L1264) | return $arr; |
| [1265](#L1265) | } |
| [1266](#L1266) |  |
| [1267](#L1267) | public static function getReCaptchaOption(string $name,?string $default=''):string{ |
| [1268](#L1268) | if($name==='version'){ |
| [1269](#L1269) | $contact\_key='recapthca\_version'; |
| [1270](#L1270) | $builder\_key='builder\_settings\_recaptcha\_version'; |
| [1271](#L1271) | $tf\_name='setting-recaptcha\_version'; |
| [1272](#L1272) | } |
| [1273](#L1273) | elseif($name==='public\_key'){ |
| [1274](#L1274) | $contact\_key='recapthca\_public\_key'; |
| [1275](#L1275) | $builder\_key='builder\_settings\_recaptcha\_site\_key'; |
| [1276](#L1276) | $tf\_name='setting-recaptcha\_site\_key'; |
| [1277](#L1277) | } |
| [1278](#L1278) | elseif($name==='private\_key'){ |
| [1279](#L1279) | $contact\_key='recapthca\_private\_key'; |
| [1280](#L1280) | $builder\_key='builder\_settings\_recaptcha\_secret\_key'; |
| [1281](#L1281) | $tf\_name='setting-recaptcha\_secret\_key'; |
| [1282](#L1282) | } |
| [1283](#L1283) | if(isset($tf\_name)){ |
| [1284](#L1284) | $val=\themify\_builder\_get($tf\_name, $builder\_key); |
| [1285](#L1285) | if(!empty($val)){ |
| [1286](#L1286) | return $val; |
| [1287](#L1287) | } |
| [1288](#L1288) | } |
| [1289](#L1289) | $options = class\_exists('Builder\_Contact',false)?get\_option('builder\_contact'):array(); |
| [1290](#L1290) | return $options[$contact\_key]??$default??''; |
| [1291](#L1291) | } |
| [1292](#L1292) |  |
| [1293](#L1293) |  |
| [1294](#L1294) | public static function get\_captcha\_keys(?string $provider ):array { |
| [1295](#L1295) | if ( $provider === 'recaptcha' ) { |
| [1296](#L1296) | return [ |
| [1297](#L1297) | 'public' => self::getReCaptchaOption( 'public\_key' ), |
| [1298](#L1298) | 'private' => self::getReCaptchaOption( 'private\_key' ), |
| [1299](#L1299) | 'version' => self::getReCaptchaOption( 'version', 'v2' ) |
| [1300](#L1300) | ]; |
| [1301](#L1301) | } elseif ( $provider === 'hcaptcha' ) { |
| [1302](#L1302) | return [ |
| [1303](#L1303) | 'public' => \themify\_builder\_get( 'setting-hcaptcha\_site', 'hcaptcha\_site' ), |
| [1304](#L1304) | 'private' => \themify\_builder\_get( 'setting-hcaptcha\_secret', 'hcaptcha\_secret' ) |
| [1305](#L1305) | ]; |
| [1306](#L1306) | } |
| [1307](#L1307) | } |
| [1308](#L1308) |  |
| [1309](#L1309) | public static function get\_captcha\_field(?string $provider, string $before = '',string  $after = '' ):string { |
| [1310](#L1310) | $keys = self::get\_captcha\_keys( $provider ); |
| [1311](#L1311) | $output = ''; |
| [1312](#L1312) | if ( empty( $keys['public'] ) || empty( $keys['private'] ) ) { |
| [1313](#L1313) | if ( current\_user\_can( 'manage\_options' ) ) { |
| [1314](#L1314) | $output = sprintf( \_\_('Requires Captcha keys entered at: <a target="\_blank" href="%s">Integration API</a>.', 'themify'), admin\_url('admin.php?page=themify#setting-integration-api') ); |
| [1315](#L1315) | } |
| [1316](#L1316) | } else { |
| [1317](#L1317) | if ( $provider === 'recaptcha' ) { |
| [1318](#L1318) | $output .= '<div class="themify\_captcha\_field ' . ( 'v2' === $keys['version'] ? 'g-recaptcha' : '' ) .'" data-sitekey="' . esc\_attr($keys['public'] ) . '" data-ver="' . esc\_attr( $keys['version'] ) . '"></div>'; |
| [1319](#L1319) | } else if( $provider === 'hcaptcha' ) { |
| [1320](#L1320) | $output .= '<div class="themify\_captcha\_field h-captcha" data-sitekey="' . esc\_attr( $keys['public'] ) . '"></div>'; |
| [1321](#L1321) | } |
| [1322](#L1322) | } |
| [1323](#L1323) |  |
| [1324](#L1324) | return $before . $output . $after; |
| [1325](#L1325) | } |
| [1326](#L1326) |  |
| [1327](#L1327) | /\*\* |
| [1328](#L1328) | \* Validate a captcha form |
| [1329](#L1329) | \* |
| [1330](#L1330) | \* @return true|WP\_Error |
| [1331](#L1331) | \*/ |
| [1332](#L1332) | public static function validate\_captcha( $provider, $response ) { |
| [1333](#L1333) | $keys = self::get\_captcha\_keys( $provider ); |
| [1334](#L1334) | if ( empty( $keys['public'] ) || empty( $keys['private'] ) ) { |
| [1335](#L1335) | return new WP\_Error( 'missing\_captcha\_key', \_\_( 'Captcha API keys are not provided.', 'themify' ) ); |
| [1336](#L1336) | } |
| [1337](#L1337) |  |
| [1338](#L1338) | $url = $provider === 'recaptcha' ? 'https://www.google.com/recaptcha/api/siteverify' : 'https://hcaptcha.com/siteverify'; |
| [1339](#L1339) | $url = add\_query\_arg( [ |
| [1340](#L1340) | 'secret' => $keys['private'], |
| [1341](#L1341) | 'response' => $response |
| [1342](#L1342) | ], $url ); |
| [1343](#L1343) | $result = wp\_remote\_get( $url ); |
| [1344](#L1344) | if ( is\_wp\_error( $result ) ) { |
| [1345](#L1345) | return $result; |
| [1346](#L1346) | } else if ( ! isset( $result['body'] ) ) { |
| [1347](#L1347) | return new WP\_Error( 'captcha\_connection\_fail', \_\_( 'Trouble verifying captcha. Please try again.', 'themify' ) ); |
| [1348](#L1348) | } |
| [1349](#L1349) | $result = json\_decode( $result['body'], true ); |
| [1350](#L1350) | if ( ! $result['success'] ) { |
| [1351](#L1351) | return new WP\_Error( 'captcha\_test\_fail', \_\_( 'Trouble verifying captcha. Please try again.', 'themify' ) ); |
| [1352](#L1352) | } |
| [1353](#L1353) |  |
| [1354](#L1354) | return true; |
| [1355](#L1355) | } |
| [1356](#L1356) |  |
| [1357](#L1357) |  |
| [1358](#L1358) |  |
| [1359](#L1359) |  |
| [1360](#L1360) | //deprecated functions |
| [1361](#L1361) |  |
| [1362](#L1362) |  |
| [1363](#L1363) | /\*\* |
| [1364](#L1364) | \* Set Pre-built Layout version |
| [1365](#L1365) | \*/ |
| [1366](#L1366) | public static function set\_current\_layouts\_version($version) {//deprecated |
| [1367](#L1367) | $key='tbuilder\_layouts\_version'; |
| [1368](#L1368) | delete\_transient($key); |
| [1369](#L1369) | return Themify\_Storage::set($key,$version); |
| [1370](#L1370) | } |
| [1371](#L1371) |  |
| [1372](#L1372) | /\*\* |
| [1373](#L1373) | \* Get current Pre-built Layout version |
| [1374](#L1374) | \*/ |
| [1375](#L1375) | public static function get\_current\_layouts\_version() {//deprecated |
| [1376](#L1376) | $key='tbuilder\_layouts\_version'; |
| [1377](#L1377) | delete\_transient($key); |
| [1378](#L1378) | $current\_layouts\_version = Themify\_Storage::get($key); |
| [1379](#L1379) | if (false === $current\_layouts\_version) { |
| [1380](#L1380) | self::set\_current\_layouts\_version('0'); |
| [1381](#L1381) | $current\_layouts\_version = '0'; |
| [1382](#L1382) | } |
| [1383](#L1383) | return $current\_layouts\_version; |
| [1384](#L1384) | } |
| [1385](#L1385) |  |
| [1386](#L1386) | /\*\* |
| [1387](#L1387) | \* Check whether layout is pre-built layout or custom |
| [1388](#L1388) | \*/ |
| [1389](#L1389) | public static function is\_prebuilt\_layout($id) {//deprecated |
| [1390](#L1390) | $protected = get\_post\_meta($id, '\_themify\_builder\_prebuilt\_layout', true); |
| [1391](#L1391) | return isset($protected) && 'yes' === $protected; |
| [1392](#L1392) | } |
| [1393](#L1393) |  |
| [1394](#L1394) |  |
| [1395](#L1395) | public static function get\_images\_from\_gallery\_shortcode($shortcode) {//deprecated from 2020.06.02,instead of use themify\_get\_gallery\_shortcode |
| [1396](#L1396) | return themify\_get\_gallery\_shortcode($shortcode); |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) |  |
| [1400](#L1400) | public static function get\_icon($icon) {//deprecated |
| [1401](#L1401) | return $icon; |
| [1402](#L1402) | } |
| [1403](#L1403) |  |
| [1404](#L1404) |  |
| [1405](#L1405) | public static function register\_directory($context, $path) {//deprecated use add\_module |
| [1406](#L1406) | if($context==='modules'){ |
| [1407](#L1407) | self::add\_module($path); |
| [1408](#L1408) | } |
| [1409](#L1409) | } |
| [1410](#L1410) |  |
| [1411](#L1411) | public static function remove\_cache($post\_id, $tag = false, array $args = array()) {//deprecated |
| [1412](#L1412) | //TFCache::remove\_cache($tag, $post\_id, $args); |
| [1413](#L1413) | } |
| [1414](#L1414) |  |
| [1415](#L1415) |  |
| [1416](#L1416) | public static function register\_module($module\_class) {//deprecated |
| [1417](#L1417) | $instance = new $module\_class(); |
| [1418](#L1418) | self::$modules[$instance->slug] = $instance; |
| [1419](#L1419) | } |
| [1420](#L1420) |  |
| [1421](#L1421) |  |
| [1422](#L1422) | public static function hasAccess() {//deprecated |
| [1423](#L1423) | return Themify\_Access\_Role::check\_access\_backend(); |
| [1424](#L1424) | } |
| [1425](#L1425) |  |
| [1426](#L1426) | public static function localize\_js($object\_name, $l10n) {//deprecated |
| [1427](#L1427) | foreach ((array) $l10n as $key => $value) { |
| [1428](#L1428) | if (is\_scalar($value)) { |
| [1429](#L1429) | $l10n[$key] = html\_entity\_decode((string) $value, ENT\_QUOTES, 'UTF-8'); |
| [1430](#L1430) | } |
| [1431](#L1431) | } |
| [1432](#L1432) | $l10n = apply\_filters("tb\_localize\_js\_{$object\_name}", $l10n); |
| [1433](#L1433) |  |
| [1434](#L1434) | return $l10n ? "var $object\_name = " . wp\_json\_encode($l10n) . ';' : ''; |
| [1435](#L1435) | } |
| [1436](#L1436) |  |
| [1437](#L1437) |  |
| [1438](#L1438) | /\*\* |
| [1439](#L1439) | \* Returns list of colors and thumbnails |
| [1440](#L1440) | \* |
| [1441](#L1441) | \* @return array |
| [1442](#L1442) | \*/ |
| [1443](#L1443) | public static function get\_colors() {//deprecated moved to js |
| [1444](#L1444) | return array(); |
| [1445](#L1445) | } |
| [1446](#L1446) |  |
| [1447](#L1447) | /\*\* |
| [1448](#L1448) | \* Check whether module is active |
| [1449](#L1449) | \* @param $name |
| [1450](#L1450) | \* @return boolean |
| [1451](#L1451) | \*/ |
| [1452](#L1452) | public static function check\_module\_active(string $name):bool {//deprecated use Themify\_Builder\_Component\_Module::load\_modules |
| [1453](#L1453) | return isset(self::$modules[$name]); |
| [1454](#L1454) | } |
| [1455](#L1455) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php?format=txt)
* [Original Format](/export/3220472/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_52ebb348_20250110_220454.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Themify Builder <= 7.6.2 - Reflected Cross-Site Scripting

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Themify Builder <= 7.6.2 - Reflected Cross-Site Scripting

6.1

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-9385](https://www.cve.org/CVERecord?id=CVE-2024-9385) |
| --- | --- |
| CVSS | 6.1 (Medium) |
| Publicly Published | October 4, 2024 |
| Last Updated | October 5, 2024 |
| Researcher | [Colin Xu](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/colin-xu) |

### Description

The Themify Builder plugin for WordPress is vulnerable to Reflected Cross-Site Scripting due to the use of add\_query\_arg without appropriate escaping on the URL in all versions up to, and including, 7.6.2. This makes it possible for unauthenticated attackers to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/themify-builder/tags/7.6.2/classes/class-themify-builder-model.php#L1121)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3162399/themify-builder/trunk/classes/class-themify-builder-model.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fthemify-builder%2Fthemify-builder-762-reflected-cross-site-scripting&t=Themify%20Builder%20%3C%3D%207.6.2%20-%20Reflected%20Cross-Site%20Scripting "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fthemify-builder%2Fthemify-builder-762-reflected-cross-site-scripting&text=Themify%20Builder%20%3C%3D%207.6.2%20-%20Reflected%20Cross-Site%20Scripting "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fthemify-builder%2Fthemify-builder-762-reflected-cross-site-scripting "LinkedIn")
Email

## Vulnerability Details for Themify Builder

#### [Themify Builder](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/themify-builder)

| Software Type | Plugin |
| --- | --- |
| Software Slug | themify-builder [(view on wordpress.org)](https://wordpress.org/plugins/themify-builder) |
| Patched? | Yes |
| Remediation | Update to version 7.6.3, or a newer patched version |
| Affected Version | * <= 7.6.2 |
| Patched Version | * 7.6.3 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


