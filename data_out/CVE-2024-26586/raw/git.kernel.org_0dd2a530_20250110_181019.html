<!DOCTYPE html>
<html lang='en'>
<head>
<title>mlxsw: spectrum_acl_tcam: Fix stack corruption - kernel/git/stable/linux.git - Linux kernel stable tree</title>
<meta name='generator' content='cgit 1.2.3-korg'/>
<meta name='robots' content='noindex, nofollow'/>
<link rel='stylesheet' type='text/css' href='/cgit-data/cgit.css'/>
<script type='text/javascript' src='/cgit-data/cgit.js'></script>
<link rel='shortcut icon' href='/favicon.ico'/>
<link rel='alternate' title='Atom feed' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git/atom/?h=master' type='application/atom+xml'/>
<link rel='vcs-git' href='git://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://git.kernel.org/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
<link rel='vcs-git' href='https://kernel.googlesource.com/pub/scm/linux/kernel/git/stable/linux.git' title='kernel/git/stable/linux.git Git repository'/>
</head>
<body>
<div id='cgit'><table id='header'>
<tr>
<td class='logo' rowspan='2'><a href='/'><img src='/cgit-data/cgit.png' alt='cgit logo'/></a></td>
<td class='main'><a href='/'>index</a> : <a href='/pub/scm/linux/kernel/git/stable/linux.git/'>kernel/git/stable/linux.git</a></td><td class='form'><form method='get'>
<input type='hidden' name='id' value='483ae90d8f976f8339cf81066312e1329f2d3706'/><select name='h' onchange='this.form.submit();'>
<option value='linux-2.6.11.y'>linux-2.6.11.y</option>
<option value='linux-2.6.12.y'>linux-2.6.12.y</option>
<option value='linux-2.6.13.y'>linux-2.6.13.y</option>
<option value='linux-2.6.14.y'>linux-2.6.14.y</option>
<option value='linux-2.6.15.y'>linux-2.6.15.y</option>
<option value='linux-2.6.16.y'>linux-2.6.16.y</option>
<option value='linux-2.6.17.y'>linux-2.6.17.y</option>
<option value='linux-2.6.18.y'>linux-2.6.18.y</option>
<option value='linux-2.6.19.y'>linux-2.6.19.y</option>
<option value='linux-2.6.20.y'>linux-2.6.20.y</option>
<option value='linux-2.6.21.y'>linux-2.6.21.y</option>
<option value='linux-2.6.22.y'>linux-2.6.22.y</option>
<option value='linux-2.6.23.y'>linux-2.6.23.y</option>
<option value='linux-2.6.24.y'>linux-2.6.24.y</option>
<option value='linux-2.6.25.y'>linux-2.6.25.y</option>
<option value='linux-2.6.26.y'>linux-2.6.26.y</option>
<option value='linux-2.6.27.y'>linux-2.6.27.y</option>
<option value='linux-2.6.28.y'>linux-2.6.28.y</option>
<option value='linux-2.6.29.y'>linux-2.6.29.y</option>
<option value='linux-2.6.30.y'>linux-2.6.30.y</option>
<option value='linux-2.6.31.y'>linux-2.6.31.y</option>
<option value='linux-2.6.32.y'>linux-2.6.32.y</option>
<option value='linux-2.6.33.y'>linux-2.6.33.y</option>
<option value='linux-2.6.34.y'>linux-2.6.34.y</option>
<option value='linux-2.6.35.y'>linux-2.6.35.y</option>
<option value='linux-2.6.36.y'>linux-2.6.36.y</option>
<option value='linux-2.6.37.y'>linux-2.6.37.y</option>
<option value='linux-2.6.38.y'>linux-2.6.38.y</option>
<option value='linux-2.6.39.y'>linux-2.6.39.y</option>
<option value='linux-3.0.y'>linux-3.0.y</option>
<option value='linux-3.1.y'>linux-3.1.y</option>
<option value='linux-3.10.y'>linux-3.10.y</option>
<option value='linux-3.11.y'>linux-3.11.y</option>
<option value='linux-3.12.y'>linux-3.12.y</option>
<option value='linux-3.13.y'>linux-3.13.y</option>
<option value='linux-3.14.y'>linux-3.14.y</option>
<option value='linux-3.15.y'>linux-3.15.y</option>
<option value='linux-3.16.y'>linux-3.16.y</option>
<option value='linux-3.17.y'>linux-3.17.y</option>
<option value='linux-3.18.y'>linux-3.18.y</option>
<option value='linux-3.19.y'>linux-3.19.y</option>
<option value='linux-3.2.y'>linux-3.2.y</option>
<option value='linux-3.3.y'>linux-3.3.y</option>
<option value='linux-3.4.y'>linux-3.4.y</option>
<option value='linux-3.5.y'>linux-3.5.y</option>
<option value='linux-3.6.y'>linux-3.6.y</option>
<option value='linux-3.7.y'>linux-3.7.y</option>
<option value='linux-3.8.y'>linux-3.8.y</option>
<option value='linux-3.9.y'>linux-3.9.y</option>
<option value='linux-4.0.y'>linux-4.0.y</option>
<option value='linux-4.1.y'>linux-4.1.y</option>
<option value='linux-4.10.y'>linux-4.10.y</option>
<option value='linux-4.11.y'>linux-4.11.y</option>
<option value='linux-4.12.y'>linux-4.12.y</option>
<option value='linux-4.13.y'>linux-4.13.y</option>
<option value='linux-4.14.y'>linux-4.14.y</option>
<option value='linux-4.15.y'>linux-4.15.y</option>
<option value='linux-4.16.y'>linux-4.16.y</option>
<option value='linux-4.17.y'>linux-4.17.y</option>
<option value='linux-4.18.y'>linux-4.18.y</option>
<option value='linux-4.19.y'>linux-4.19.y</option>
<option value='linux-4.2.y'>linux-4.2.y</option>
<option value='linux-4.20.y'>linux-4.20.y</option>
<option value='linux-4.3.y'>linux-4.3.y</option>
<option value='linux-4.4.y'>linux-4.4.y</option>
<option value='linux-4.5.y'>linux-4.5.y</option>
<option value='linux-4.6.y'>linux-4.6.y</option>
<option value='linux-4.7.y'>linux-4.7.y</option>
<option value='linux-4.8.y'>linux-4.8.y</option>
<option value='linux-4.9.y'>linux-4.9.y</option>
<option value='linux-5.0.y'>linux-5.0.y</option>
<option value='linux-5.1.y'>linux-5.1.y</option>
<option value='linux-5.10.y'>linux-5.10.y</option>
<option value='linux-5.11.y'>linux-5.11.y</option>
<option value='linux-5.12.y'>linux-5.12.y</option>
<option value='linux-5.13.y'>linux-5.13.y</option>
<option value='linux-5.14.y'>linux-5.14.y</option>
<option value='linux-5.15.y'>linux-5.15.y</option>
<option value='linux-5.16.y'>linux-5.16.y</option>
<option value='linux-5.17.y'>linux-5.17.y</option>
<option value='linux-5.18.y'>linux-5.18.y</option>
<option value='linux-5.19.y'>linux-5.19.y</option>
<option value='linux-5.2.y'>linux-5.2.y</option>
<option value='linux-5.3.y'>linux-5.3.y</option>
<option value='linux-5.4.y'>linux-5.4.y</option>
<option value='linux-5.5.y'>linux-5.5.y</option>
<option value='linux-5.6.y'>linux-5.6.y</option>
<option value='linux-5.7.y'>linux-5.7.y</option>
<option value='linux-5.8.y'>linux-5.8.y</option>
<option value='linux-5.9.y'>linux-5.9.y</option>
<option value='linux-6.0.y'>linux-6.0.y</option>
<option value='linux-6.1.y'>linux-6.1.y</option>
<option value='linux-6.10.y'>linux-6.10.y</option>
<option value='linux-6.11.y'>linux-6.11.y</option>
<option value='linux-6.12.y'>linux-6.12.y</option>
<option value='linux-6.2.y'>linux-6.2.y</option>
<option value='linux-6.3.y'>linux-6.3.y</option>
<option value='linux-6.4.y'>linux-6.4.y</option>
<option value='linux-6.5.y'>linux-6.5.y</option>
<option value='linux-6.6.y'>linux-6.6.y</option>
<option value='linux-6.7.y'>linux-6.7.y</option>
<option value='linux-6.8.y'>linux-6.8.y</option>
<option value='linux-6.9.y'>linux-6.9.y</option>
<option value='linux-rolling-lts'>linux-rolling-lts</option>
<option value='linux-rolling-stable'>linux-rolling-stable</option>
<option value='master' selected='selected'>master</option>
</select> <input type='submit' value='switch'/></form></td></tr>
<tr><td class='sub'>Linux kernel stable tree</td><td class='sub right'>Stable Group</td></tr></table>
<table class='tabs'><tr><td>
<a href='/pub/scm/linux/kernel/git/stable/linux.git/about/'>about</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/'>summary</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>refs</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/log/'>log</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>tree</a><a class='active' href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>commit</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>diff</a><a href='/pub/scm/linux/kernel/git/stable/linux.git/stats/'>stats</a></td><td class='form'><form class='right' method='get' action='/pub/scm/linux/kernel/git/stable/linux.git/log/'>
<input type='hidden' name='id' value='483ae90d8f976f8339cf81066312e1329f2d3706'/><select name='qt'>
<option value='grep'>log msg</option>
<option value='author'>author</option>
<option value='committer'>committer</option>
<option value='range'>range</option>
</select>
<input class='txt' type='search' size='10' name='q' value=''/>
<input type='submit' value='search'/>
</form>
</td></tr></table>
<div class='content'><div class='cgit-panel'><b>diff options</b><form method='get'><input type='hidden' name='id' value='483ae90d8f976f8339cf81066312e1329f2d3706'/><table><tr><td colspan='2'/></tr><tr><td class='label'>context:</td><td class='ctrl'><select name='context' onchange='this.form.submit();'><option value='1'>1</option><option value='2'>2</option><option value='3' selected='selected'>3</option><option value='4'>4</option><option value='5'>5</option><option value='6'>6</option><option value='7'>7</option><option value='8'>8</option><option value='9'>9</option><option value='10'>10</option><option value='15'>15</option><option value='20'>20</option><option value='25'>25</option><option value='30'>30</option><option value='35'>35</option><option value='40'>40</option></select></td></tr><tr><td class='label'>space:</td><td class='ctrl'><select name='ignorews' onchange='this.form.submit();'><option value='0' selected='selected'>include</option><option value='1'>ignore</option></select></td></tr><tr><td class='label'>mode:</td><td class='ctrl'><select name='dt' onchange='this.form.submit();'><option value='0' selected='selected'>unified</option><option value='1'>ssdiff</option><option value='2'>stat only</option></select></td></tr><tr><td/><td class='ctrl'><noscript><input type='submit' value='reload'/></noscript></td></tr></table></form></div><table summary='commit info' class='commit-info'>
<tr><th>author</th><td>Ido Schimmel &lt;idosch@nvidia.com&gt;</td><td class='right'>2024-01-17 16:04:18 +0100</td></tr>
<tr><th>committer</th><td>Jakub Kicinski &lt;kuba@kernel.org&gt;</td><td class='right'>2024-01-18 09:48:08 -0800</td></tr>
<tr><th>commit</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>483ae90d8f976f8339cf81066312e1329f2d3706</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>patch</a>)</td></tr>
<tr><th>tree</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>2e36e009360d198cef7bfec4a1e727b16daa6491</a></td></tr>
<tr><th>parent</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=efeb7dfea8ee10cdec11b6b6ba4e405edbe75809'>efeb7dfea8ee10cdec11b6b6ba4e405edbe75809</a> (<a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=483ae90d8f976f8339cf81066312e1329f2d3706&amp;id2=efeb7dfea8ee10cdec11b6b6ba4e405edbe75809'>diff</a>)</td></tr><tr><th>download</th><td colspan='2' class='oid'><a href='/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-483ae90d8f976f8339cf81066312e1329f2d3706.tar.gz'>linux-483ae90d8f976f8339cf81066312e1329f2d3706.tar.gz</a><br/></td></tr></table>
<div class='commit-subject'>mlxsw: spectrum_acl_tcam: Fix stack corruption</div><div class='commit-msg'>When tc filters are first added to a net device, the corresponding local
port gets bound to an ACL group in the device. The group contains a list
of ACLs. In turn, each ACL points to a different TCAM region where the
filters are stored. During forwarding, the ACLs are sequentially
evaluated until a match is found.

One reason to place filters in different regions is when they are added
with decreasing priorities and in an alternating order so that two
consecutive filters can never fit in the same region because of their
key usage.

In Spectrum-2 and newer ASICs the firmware started to report that the
maximum number of ACLs in a group is more than 16, but the layout of the
register that configures ACL groups (PAGT) was not updated to account
for that. It is therefore possible to hit stack corruption [1] in the
rare case where more than 16 ACLs in a group are required.

Fix by limiting the maximum ACL group size to the minimum between what
the firmware reports and the maximum ACLs that fit in the PAGT register.

Add a test case to make sure the machine does not crash when this
condition is hit.

[1]
Kernel panic - not syncing: stack-protector: Kernel stack is corrupted in: mlxsw_sp_acl_tcam_group_update+0x116/0x120
[...]
 dump_stack_lvl+0x36/0x50
 panic+0x305/0x330
 __stack_chk_fail+0x15/0x20
 mlxsw_sp_acl_tcam_group_update+0x116/0x120
 mlxsw_sp_acl_tcam_group_region_attach+0x69/0x110
 mlxsw_sp_acl_tcam_vchunk_get+0x492/0xa20
 mlxsw_sp_acl_tcam_ventry_add+0x25/0xe0
 mlxsw_sp_acl_rule_add+0x47/0x240
 mlxsw_sp_flower_replace+0x1a9/0x1d0
 tc_setup_cb_add+0xdc/0x1c0
 fl_hw_replace_filter+0x146/0x1f0
 fl_change+0xc17/0x1360
 tc_new_tfilter+0x472/0xb90
 rtnetlink_rcv_msg+0x313/0x3b0
 netlink_rcv_skb+0x58/0x100
 netlink_unicast+0x244/0x390
 netlink_sendmsg+0x1e4/0x440
 ____sys_sendmsg+0x164/0x260
 ___sys_sendmsg+0x9a/0xe0
 __sys_sendmsg+0x7a/0xc0
 do_syscall_64+0x40/0xe0
 entry_SYSCALL_64_after_hwframe+0x63/0x6b

Fixes: c3ab435466d5 ("mlxsw: spectrum: Extend to support Spectrum-2 ASIC")
Reported-by: Orel Hagag &lt;orelh@nvidia.com&gt;
Signed-off-by: Ido Schimmel &lt;idosch@nvidia.com&gt;
Reviewed-by: Amit Cohen &lt;amcohen@nvidia.com&gt;
Signed-off-by: Petr Machata &lt;petrm@nvidia.com&gt;
Acked-by: Paolo Abeni &lt;pabeni@redhat.com&gt;
Link: <a href="https://lore.kernel.org/r/2d91c89afba59c22587b444994ae419dbea8d876.1705502064.git.petrm@nvidia.com">https://lore.kernel.org/r/2d91c89afba59c22587b444994ae419dbea8d876.1705502064.git.petrm@nvidia.com</a>
Signed-off-by: Jakub Kicinski &lt;kuba@kernel.org&gt;
</div><div class='diffstat-header'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=483ae90d8f976f8339cf81066312e1329f2d3706'>Diffstat</a></div><table summary='diffstat' class='diffstat'><tr><td class='mode'>-rw-r--r--</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c?id=483ae90d8f976f8339cf81066312e1329f2d3706'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c</a></td><td class='right'>2</td><td class='graph'><table summary='file diffstat' width='56%'><tr><td class='add' style='width: 3.6%;'/><td class='rem' style='width: 0.0%;'/><td class='none' style='width: 96.4%;'/></tr></table></td></tr>
<tr><td class='mode'>-rwxr-xr-x</td><td class='upd'><a href='/pub/scm/linux/kernel/git/stable/linux.git/diff/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh?id=483ae90d8f976f8339cf81066312e1329f2d3706'>tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh</a></td><td class='right'>56</td><td class='graph'><table summary='file diffstat' width='56%'><tr><td class='add' style='width: 98.2%;'/><td class='rem' style='width: 1.8%;'/><td class='none' style='width: 0.0%;'/></tr></table></td></tr>
</table><div class='diffstat-summary'>2 files changed, 57 insertions, 1 deletions</div><table summary='diff' class='diff'><tr><td><div class='head'>diff --git a/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c b/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c<br/>index 7d1e91196e943a..50ea1eff02b2f7 100644<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c?id=efeb7dfea8ee10cdec11b6b6ba4e405edbe75809'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c?id=483ae90d8f976f8339cf81066312e1329f2d3706'>drivers/net/ethernet/mellanox/mlxsw/spectrum_acl_tcam.c</a></div><div class='hunk'>@@ -1564,6 +1564,8 @@ int mlxsw_sp_acl_tcam_init(struct mlxsw_sp *mlxsw_sp,</div><div class='ctx'> 	tcam-&gt;max_groups = max_groups;</div><div class='ctx'> 	tcam-&gt;max_group_size = MLXSW_CORE_RES_GET(mlxsw_sp-&gt;core,</div><div class='ctx'> 						  ACL_MAX_GROUP_SIZE);</div><div class='add'>+	tcam-&gt;max_group_size = min_t(unsigned int, tcam-&gt;max_group_size,</div><div class='add'>+				     MLXSW_REG_PAGT_ACL_MAX_NUM);</div><div class='ctx'> </div><div class='ctx'> 	err = ops-&gt;init(mlxsw_sp, tcam-&gt;priv, tcam);</div><div class='ctx'> 	if (err)</div><div class='head'>diff --git a/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh b/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh<br/>index 7bf56ea161e357..616d3581419ca0 100755<br/>--- a/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh?id=efeb7dfea8ee10cdec11b6b6ba4e405edbe75809'>tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh</a><br/>+++ b/<a href='/pub/scm/linux/kernel/git/stable/linux.git/tree/tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh?id=483ae90d8f976f8339cf81066312e1329f2d3706'>tools/testing/selftests/drivers/net/mlxsw/spectrum-2/tc_flower.sh</a></div><div class='hunk'>@@ -11,7 +11,7 @@ ALL_TESTS="single_mask_test identical_filters_test two_masks_test \</div><div class='ctx'> 	multiple_masks_test ctcam_edge_cases_test delta_simple_test \</div><div class='ctx'> 	delta_two_masks_one_key_test delta_simple_rehash_test \</div><div class='ctx'> 	bloom_simple_test bloom_complex_test bloom_delta_test \</div><div class='del'>-	max_erp_entries_test"</div><div class='add'>+	max_erp_entries_test max_group_size_test"</div><div class='ctx'> NUM_NETIFS=2</div><div class='ctx'> source $lib_dir/lib.sh</div><div class='ctx'> source $lib_dir/tc_common.sh</div><div class='hunk'>@@ -1033,6 +1033,60 @@ max_erp_entries_test()</div><div class='ctx'> 		"max chain $chain_failed, mask $mask_failed"</div><div class='ctx'> }</div><div class='ctx'> </div><div class='add'>+max_group_size_test()</div><div class='add'>+{</div><div class='add'>+	# The number of ACLs in an ACL group is limited. Once the maximum</div><div class='add'>+	# number of ACLs has been reached, filters cannot be added. This test</div><div class='add'>+	# verifies that when this limit is reached, insertion fails without</div><div class='add'>+	# crashing.</div><div class='add'>+</div><div class='add'>+	RET=0</div><div class='add'>+</div><div class='add'>+	local num_acls=32</div><div class='add'>+	local max_size</div><div class='add'>+	local ret</div><div class='add'>+</div><div class='add'>+	if [[ "$tcflags" != "skip_sw" ]]; then</div><div class='add'>+		return 0;</div><div class='add'>+	fi</div><div class='add'>+</div><div class='add'>+	for ((i=1; i &lt; $num_acls; i++)); do</div><div class='add'>+		if [[ $(( i % 2 )) == 1 ]]; then</div><div class='add'>+			tc filter add dev $h2 ingress pref $i proto ipv4 \</div><div class='add'>+				flower $tcflags dst_ip 198.51.100.1/32 \</div><div class='add'>+				ip_proto tcp tcp_flags 0x01/0x01 \</div><div class='add'>+				action drop &amp;&gt; /dev/null</div><div class='add'>+		else</div><div class='add'>+			tc filter add dev $h2 ingress pref $i proto ipv6 \</div><div class='add'>+				flower $tcflags dst_ip 2001:db8:1::1/128 \</div><div class='add'>+				action drop &amp;&gt; /dev/null</div><div class='add'>+		fi</div><div class='add'>+</div><div class='add'>+		ret=$?</div><div class='add'>+		[[ $ret -ne 0 ]] &amp;&amp; max_size=$((i - 1)) &amp;&amp; break</div><div class='add'>+	done</div><div class='add'>+</div><div class='add'>+	# We expect to exceed the maximum number of ACLs in a group, so that</div><div class='add'>+	# insertion eventually fails. Otherwise, the test should be adjusted to</div><div class='add'>+	# add more filters.</div><div class='add'>+	check_fail $ret "expected to exceed number of ACLs in a group"</div><div class='add'>+</div><div class='add'>+	for ((; i &gt;= 1; i--)); do</div><div class='add'>+		if [[ $(( i % 2 )) == 1 ]]; then</div><div class='add'>+			tc filter del dev $h2 ingress pref $i proto ipv4 \</div><div class='add'>+				flower $tcflags dst_ip 198.51.100.1/32 \</div><div class='add'>+				ip_proto tcp tcp_flags 0x01/0x01 \</div><div class='add'>+				action drop &amp;&gt; /dev/null</div><div class='add'>+		else</div><div class='add'>+			tc filter del dev $h2 ingress pref $i proto ipv6 \</div><div class='add'>+				flower $tcflags dst_ip 2001:db8:1::1/128 \</div><div class='add'>+				action drop &amp;&gt; /dev/null</div><div class='add'>+		fi</div><div class='add'>+	done</div><div class='add'>+</div><div class='add'>+	log_test "max ACL group size test ($tcflags). max size $max_size"</div><div class='add'>+}</div><div class='add'>+</div><div class='ctx'> setup_prepare()</div><div class='ctx'> {</div><div class='ctx'> 	h1=${NETIFS[p1]}</div></td></tr></table></div> <!-- class=content -->
<div class='footer'>generated by <a href='https://git.zx2c4.com/cgit/about/'>cgit 1.2.3-korg</a> (<a href='https://git-scm.com/'>git 2.43.0</a>) at 2025-01-10 18:08:56 +0000</div>
</div> <!-- id=cgit -->
</body>
</html>
