php
namespace WP\_Rplg\_Google\_Reviews\Includes;
use WP\_Rplg\_Google\_Reviews\Includes\Core\Core;
class Feed\_Shortcode {
private $core;
private $view;
private $assets;
private $feed\_old;
private $feed\_deserializer;
public function \_\_construct(Feed\_Deserializer $feed\_deserializer, Assets $assets, Core $core, View $view, Feed\_Old $feed\_old) {
$this-feed\_deserializer = $feed\_deserializer;
$this->assets = $assets;
$this->core = $core;
$this->view = $view;
$this->feed\_old = $feed\_old;
}
public function register() {
add\_shortcode('grw', array($this, 'init'));
}
public function init($atts) {
if (get\_option('grw\_active') === '0') {
return '';
}
if (isset($atts['place\_id']) && strlen($atts['place\_id']) > 0) {
$feed = $this->feed\_old->get\_feed($atts['place\_id'], $atts);
} else {
$atts = shortcode\_atts(array('id' => 0), $atts, 'grw');
$feed = $this->feed\_deserializer->get\_feed($atts['id']);
if (!$feed) {
return null;
}
}
$grw\_demand\_assets = get\_option('grw\_demand\_assets');
if ($grw\_demand\_assets || $grw\_demand\_assets == 'true') {
$this->assets->enqueue\_public\_styles();
$this->assets->enqueue\_public\_scripts();
}
$data = $this->core->get\_reviews($feed);
return $this->view->render($feed->ID, $data['businesses'], $data['reviews'], $data['options']);
}
}
