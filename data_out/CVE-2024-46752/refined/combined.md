=== Content from git.kernel.org_52da2a93_20250110_142252.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Filipe Manana <fdmanana@suse.com> | 2024-06-18 15:55:16 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:07:49 +0200 |
| commit | [b50857b96429a09fd3beed9f7f21b7bb7c433688](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)) | |
| tree | [a747e0b617adcc0d6a70e90428fe82cb958b6b82](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688) | |
| parent | [728d4d045b628e006b48a448f3326a7194c88d32](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=728d4d045b628e006b48a448f3326a7194c88d32) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688&id2=728d4d045b628e006b48a448f3326a7194c88d32)) | |
| download | [linux-b50857b96429a09fd3beed9f7f21b7bb7c433688.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b50857b96429a09fd3beed9f7f21b7bb7c433688.tar.gz) | |

btrfs: replace BUG\_ON() with error handling at update\_ref\_for\_cow()[ Upstream commit b56329a782314fde5b61058e2a25097af7ccb675 ]
Instead of a BUG\_ON() just return an error, log an error message and
abort the transaction in case we find an extent buffer belonging to the
relocation tree that doesn't have the full backref flag set. This is
unexpected and should never happen (save for bugs or a potential bad
memory).
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)

| -rw-r--r-- | [fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/btrfs/ctree.c?id=b50857b96429a09fd3beed9f7f21b7bb7c433688) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/fs/btrfs/ctree.c b/fs/btrfs/ctree.cindex 8b53313bf3b2c7..0b8c8b5094efb3 100644--- a/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=728d4d045b628e006b48a448f3326a7194c88d32)+++ b/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=b50857b96429a09fd3beed9f7f21b7bb7c433688)@@ -306,8 +306,16 @@ static noinline int update\_ref\_for\_cow(struct btrfs\_trans\_handle \*trans, }  owner = btrfs\_header\_owner(buf);- BUG\_ON(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&- !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF));+ if (unlikely(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&+ !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF))) {+ btrfs\_crit(fs\_info,+"found tree block at bytenr %llu level %d root %llu refs %llu flags %llx without full backref flag set",+ buf->start, btrfs\_header\_level(buf),+ btrfs\_root\_id(root), refs, flags);+ ret = -EUCLEAN;+ btrfs\_abort\_transaction(trans, ret);+ return ret;+ }  if (refs > 1) { if ((owner == root->root\_key.objectid || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:29 +0000



=== Content from git.kernel.org_17d1a74f_20250110_142253.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Filipe Manana <fdmanana@suse.com> | 2024-06-18 15:55:16 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:13:02 +0200 |
| commit | [f895db00c65e5d77c437cce946da9ec29dcdf563](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=f895db00c65e5d77c437cce946da9ec29dcdf563) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)) | |
| tree | [550611332917d79effcded9d965bb78730544474](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=f895db00c65e5d77c437cce946da9ec29dcdf563) | |
| parent | [a7f16a7a709845855cb5a0e080a52bda5873f9de](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a7f16a7a709845855cb5a0e080a52bda5873f9de) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f895db00c65e5d77c437cce946da9ec29dcdf563&id2=a7f16a7a709845855cb5a0e080a52bda5873f9de)) | |
| download | [linux-f895db00c65e5d77c437cce946da9ec29dcdf563.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-f895db00c65e5d77c437cce946da9ec29dcdf563.tar.gz) | |

btrfs: replace BUG\_ON() with error handling at update\_ref\_for\_cow()[ Upstream commit b56329a782314fde5b61058e2a25097af7ccb675 ]
Instead of a BUG\_ON() just return an error, log an error message and
abort the transaction in case we find an extent buffer belonging to the
relocation tree that doesn't have the full backref flag set. This is
unexpected and should never happen (save for bugs or a potential bad
memory).
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=f895db00c65e5d77c437cce946da9ec29dcdf563)

| -rw-r--r-- | [fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/btrfs/ctree.c?id=f895db00c65e5d77c437cce946da9ec29dcdf563) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/fs/btrfs/ctree.c b/fs/btrfs/ctree.cindex 8a791b648ac538..f56914507fceb0 100644--- a/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=a7f16a7a709845855cb5a0e080a52bda5873f9de)+++ b/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=f895db00c65e5d77c437cce946da9ec29dcdf563)@@ -462,8 +462,16 @@ static noinline int update\_ref\_for\_cow(struct btrfs\_trans\_handle \*trans, }  owner = btrfs\_header\_owner(buf);- BUG\_ON(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&- !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF));+ if (unlikely(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&+ !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF))) {+ btrfs\_crit(fs\_info,+"found tree block at bytenr %llu level %d root %llu refs %llu flags %llx without full backref flag set",+ buf->start, btrfs\_header\_level(buf),+ btrfs\_root\_id(root), refs, flags);+ ret = -EUCLEAN;+ btrfs\_abort\_transaction(trans, ret);+ return ret;+ }  if (refs > 1) { if ((owner == btrfs\_root\_id(root) || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:30 +0000



=== Content from git.kernel.org_f3caf44a_20250110_142252.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b56329a782314fde5b61058e2a25097af7ccb675)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b56329a782314fde5b61058e2a25097af7ccb675)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b56329a782314fde5b61058e2a25097af7ccb675)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56329a782314fde5b61058e2a25097af7ccb675)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Filipe Manana <fdmanana@suse.com> | 2024-06-18 15:55:16 +0100 |
| --- | --- | --- |
| committer | David Sterba <dsterba@suse.com> | 2024-07-11 15:33:26 +0200 |
| commit | [b56329a782314fde5b61058e2a25097af7ccb675](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b56329a782314fde5b61058e2a25097af7ccb675) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b56329a782314fde5b61058e2a25097af7ccb675)) | |
| tree | [48f6fd98eca48fd72499c3e386fb310d91ed6196](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b56329a782314fde5b61058e2a25097af7ccb675) | |
| parent | [716404e59a17f917b32c649a733c9a23e5d15ad4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=716404e59a17f917b32c649a733c9a23e5d15ad4) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56329a782314fde5b61058e2a25097af7ccb675&id2=716404e59a17f917b32c649a733c9a23e5d15ad4)) | |
| download | [linux-b56329a782314fde5b61058e2a25097af7ccb675.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b56329a782314fde5b61058e2a25097af7ccb675.tar.gz) | |

btrfs: replace BUG\_ON() with error handling at update\_ref\_for\_cow()Instead of a BUG\_ON() just return an error, log an error message and
abort the transaction in case we find an extent buffer belonging to the
relocation tree that doesn't have the full backref flag set. This is
unexpected and should never happen (save for bugs or a potential bad
memory).
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b56329a782314fde5b61058e2a25097af7ccb675)

| -rw-r--r-- | [fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/btrfs/ctree.c?id=b56329a782314fde5b61058e2a25097af7ccb675) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/fs/btrfs/ctree.c b/fs/btrfs/ctree.cindex 7b2f1de845e788..e33f9f5a228d6c 100644--- a/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=716404e59a17f917b32c649a733c9a23e5d15ad4)+++ b/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=b56329a782314fde5b61058e2a25097af7ccb675)@@ -461,8 +461,16 @@ static noinline int update\_ref\_for\_cow(struct btrfs\_trans\_handle \*trans, }  owner = btrfs\_header\_owner(buf);- BUG\_ON(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&- !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF));+ if (unlikely(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&+ !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF))) {+ btrfs\_crit(fs\_info,+"found tree block at bytenr %llu level %d root %llu refs %llu flags %llx without full backref flag set",+ buf->start, btrfs\_header\_level(buf),+ btrfs\_root\_id(root), refs, flags);+ ret = -EUCLEAN;+ btrfs\_abort\_transaction(trans, ret);+ return ret;+ }  if (refs > 1) { if ((owner == btrfs\_root\_id(root) || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:30 +0000



=== Content from git.kernel.org_a7286439_20250110_142251.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Filipe Manana <fdmanana@suse.com> | 2024-06-18 15:55:16 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:11:37 +0200 |
| commit | [41a0f85e268d72fe04f731b8ceea4748c2d65491](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)) | |
| tree | [2e3eb1cb9d611cc4b9abc3fd2c8662285f0890e8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491) | |
| parent | [7d1df13bf078ffebfedd361d714ff6cee1ff01b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7d1df13bf078ffebfedd361d714ff6cee1ff01b9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491&id2=7d1df13bf078ffebfedd361d714ff6cee1ff01b9)) | |
| download | [linux-41a0f85e268d72fe04f731b8ceea4748c2d65491.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-41a0f85e268d72fe04f731b8ceea4748c2d65491.tar.gz) | |

btrfs: replace BUG\_ON() with error handling at update\_ref\_for\_cow()[ Upstream commit b56329a782314fde5b61058e2a25097af7ccb675 ]
Instead of a BUG\_ON() just return an error, log an error message and
abort the transaction in case we find an extent buffer belonging to the
relocation tree that doesn't have the full backref flag set. This is
unexpected and should never happen (save for bugs or a potential bad
memory).
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)

| -rw-r--r-- | [fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/btrfs/ctree.c?id=41a0f85e268d72fe04f731b8ceea4748c2d65491) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/fs/btrfs/ctree.c b/fs/btrfs/ctree.cindex 118ad4d2cbbe26..2eb4e03080ac9b 100644--- a/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=7d1df13bf078ffebfedd361d714ff6cee1ff01b9)+++ b/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=41a0f85e268d72fe04f731b8ceea4748c2d65491)@@ -451,8 +451,16 @@ static noinline int update\_ref\_for\_cow(struct btrfs\_trans\_handle \*trans, }  owner = btrfs\_header\_owner(buf);- BUG\_ON(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&- !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF));+ if (unlikely(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&+ !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF))) {+ btrfs\_crit(fs\_info,+"found tree block at bytenr %llu level %d root %llu refs %llu flags %llx without full backref flag set",+ buf->start, btrfs\_header\_level(buf),+ btrfs\_root\_id(root), refs, flags);+ ret = -EUCLEAN;+ btrfs\_abort\_transaction(trans, ret);+ return ret;+ }  if (refs > 1) { if ((owner == root->root\_key.objectid || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:28 +0000



=== Content from git.kernel.org_f51af220_20250110_142251.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Filipe Manana <fdmanana@suse.com> | 2024-06-18 15:55:16 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-12 11:10:24 +0200 |
| commit | [0fbac73a97286a7ec72229cb9b42d760a2c717ac](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)) | |
| tree | [67b02a36d4bf8f3ff738b2fa481c9d1c379c3a35](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac) | |
| parent | [9cc887ac24b7a0598f4042ae9af6b9a33072f75b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9cc887ac24b7a0598f4042ae9af6b9a33072f75b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac&id2=9cc887ac24b7a0598f4042ae9af6b9a33072f75b)) | |
| download | [linux-0fbac73a97286a7ec72229cb9b42d760a2c717ac.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-0fbac73a97286a7ec72229cb9b42d760a2c717ac.tar.gz) | |

btrfs: replace BUG\_ON() with error handling at update\_ref\_for\_cow()[ Upstream commit b56329a782314fde5b61058e2a25097af7ccb675 ]
Instead of a BUG\_ON() just return an error, log an error message and
abort the transaction in case we find an extent buffer belonging to the
relocation tree that doesn't have the full backref flag set. This is
unexpected and should never happen (save for bugs or a potential bad
memory).
Reviewed-by: Qu Wenruo <wqu@suse.com>
Signed-off-by: Filipe Manana <fdmanana@suse.com>
Reviewed-by: David Sterba <dsterba@suse.com>
Signed-off-by: David Sterba <dsterba@suse.com>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)

| -rw-r--r-- | [fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/btrfs/ctree.c?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac) | 12 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 2 deletions

| diff --git a/fs/btrfs/ctree.c b/fs/btrfs/ctree.cindex e08688844f1e1c..66d1f34c3fc695 100644--- a/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=9cc887ac24b7a0598f4042ae9af6b9a33072f75b)+++ b/[fs/btrfs/ctree.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/btrfs/ctree.c?id=0fbac73a97286a7ec72229cb9b42d760a2c717ac)@@ -324,8 +324,16 @@ static noinline int update\_ref\_for\_cow(struct btrfs\_trans\_handle \*trans, }  owner = btrfs\_header\_owner(buf);- BUG\_ON(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&- !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF));+ if (unlikely(owner == BTRFS\_TREE\_RELOC\_OBJECTID &&+ !(flags & BTRFS\_BLOCK\_FLAG\_FULL\_BACKREF))) {+ btrfs\_crit(fs\_info,+"found tree block at bytenr %llu level %d root %llu refs %llu flags %llx without full backref flag set",+ buf->start, btrfs\_header\_level(buf),+ btrfs\_root\_id(root), refs, flags);+ ret = -EUCLEAN;+ btrfs\_abort\_transaction(trans, ret);+ return ret;+ }  if (refs > 1) { if ((owner == root->root\_key.objectid || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 14:21:28 +0000


