=== Content from www.wordfence.com_7193cd01_20250111_165402.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Page Builder Sandwich <= 5.1.0 - Missing Authorization to Authenticated(Subscriber+) Arbitrary Post Editing

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Page Builder Sandwich <= 5.1.0 - Missing Authorization to Authenticated(Subscriber+) Arbitrary Post Editing

6.5

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:U/C:N/I:H/A:N)

| CVE | [CVE-2024-1285](https://www.cve.org/CVERecord?id=CVE-2024-1285) |
| --- | --- |
| CVSS | 6.5 (Medium) |
| Publicly Published | March 4, 2024 |
| Last Updated | March 5, 2024 |
| Researcher | [Krzysztof Zając - CERT PL](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/krzysztof-zajac) |

### Description

The Page Builder Sandwich – Front End WordPress Page Builder Plugin plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the 'gambit\_builder\_save\_content' function in all versions up to, and including, 5.1.0. This makes it possible for authenticated attackers, with subscriber access and above, to insert arbitrary content into existing posts.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php#L958)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-builder-sandwich%2Fpage-builder-sandwich-510-missing-authorization-to-authenticatedsubscriber-arbitrary-post-editing&t=Page%20Builder%20Sandwich%20%3C%3D%205.1.0%20-%20Missing%20Authorization%20to%20Authenticated%28Subscriber%2B%29%20Arbitrary%20Post%20Editing "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-builder-sandwich%2Fpage-builder-sandwich-510-missing-authorization-to-authenticatedsubscriber-arbitrary-post-editing&text=Page%20Builder%20Sandwich%20%3C%3D%205.1.0%20-%20Missing%20Authorization%20to%20Authenticated%28Subscriber%2B%29%20Arbitrary%20Post%20Editing "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fpage-builder-sandwich%2Fpage-builder-sandwich-510-missing-authorization-to-authenticatedsubscriber-arbitrary-post-editing "LinkedIn")
Email

## Vulnerability Details for Page Builder Sandwich – Front End WordPress Page Builder Plugin

#### [Page Builder Sandwich – Front End WordPress Page Builder Plugin](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/page-builder-sandwich)

| Software Type | Plugin |
| --- | --- |
| Software Slug | page-builder-sandwich [(view on wordpress.org)](https://wordpress.org/plugins/page-builder-sandwich) |
| Patched? | No |
| Remediation | No known patch available. Please review the vulnerability's details in depth and employ mitigations based on your organization's risk tolerance. It may be best to uninstall the affected software and find a replacement. |
| Affected Version | * <= 5.1.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_0b823f71_20250111_165400.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fpage-builder-sandwich%2Ftags%2F5.1.0%2Fclass-page-builder-sandwich.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* [Blame](/browser/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php)

---

# [source:](/browser?order=name "Go to repository root") [page-builder-sandwich](/browser/page-builder-sandwich?order=name "View page-builder-sandwich")/[tags](/browser/page-builder-sandwich/tags?order=name "View tags")/[5.1.0](/browser/page-builder-sandwich/tags/5.1.0?order=name "View 5.1.0")/[class-page-builder-sandwich.php](/browser/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php?order=name "View class-page-builder-sandwich.php")

View diff against:

View revision:

| [Last change](/changeset/2872362/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php "View differences") on this file was [2872362](/changeset/2872362/ "View changeset 2872362"), checked in by pagebuildersandwich, [23 months ago](/timeline?from=2023-02-28T13%3A24%3A25Z&precision=second "See timeline at 02/28/2023 01:24:25 PM") |
| --- |
| * Fixed: Templates issue * Fixed: Templates design issue * [WordPress](/wiki/WordPress) 6.1.1 tested |
| **File size:** 45.8 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | /\*\* |
| [3](#L3) | \* Page Builder Sandwich main functionality class |
| [4](#L4) | \* |
| [5](#L5) | \* @package Page Builder Sandwich |
| [6](#L6) | \*/ |
| [7](#L7) |  |
| [8](#L8) | if ( ! defined( 'ABSPATH' ) ) { exit; // Exit if accessed directly. |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | // Initializes plugin class. |
| [12](#L12) | if ( ! class\_exists( 'PageBuilderSandwich' ) ) { |
| [13](#L13) |  |
| [14](#L14) | /\*\* |
| [15](#L15) | \* This is where all the plugin's functionality happens. |
| [16](#L16) | \*/ |
| [17](#L17) | class PageBuilderSandwich { |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* If the page contains multiple contents from other posts, multiple |
| [21](#L21) | \* PBS wrappers can be added in. This makes sure that it's only added once. |
| [22](#L22) | \* |
| [23](#L23) | \* @var boolean |
| [24](#L24) | \*/ |
| [25](#L25) | private $added\_builder\_wrapper\_once = false; |
| [26](#L26) |  |
| [27](#L27) | /\*\* |
| [28](#L28) | \* If the page contains multiple contents from other posts, multiple |
| [29](#L29) | \* PBS wrappers can be added in. This makes sure that it's only added once |
| [30](#L30) | \* during the fallback function. |
| [31](#L31) | \* |
| [32](#L32) | \* @var boolean |
| [33](#L33) | \*/ |
| [34](#L34) | private $added\_builder\_wrapper\_fallback\_once = false; |
| [35](#L35) |  |
| [36](#L36) | /\*\* |
| [37](#L37) | \* The holder for our main post's post\_id. We'll use this in other places |
| [38](#L38) | \* such as in class-title.php to check whether we're in our main post. |
| [39](#L39) | \* |
| [40](#L40) | \* @var int |
| [41](#L41) | \*/ |
| [42](#L42) | public static $main\_post\_id = 0; |
| [43](#L43) |  |
| [44](#L44) | /\*\* |
| [45](#L45) | \* Holds the main PBS instance. |
| [46](#L46) | \* |
| [47](#L47) | \* @since 4.3 |
| [48](#L48) | \* |
| [49](#L49) | \* @var PageBuilderSandwich |
| [50](#L50) | \*/ |
| [51](#L51) | private static $\_instance = null; |
| [52](#L52) |  |
| [53](#L53) | /\*\* |
| [54](#L54) | \* Get/create the PBS instance. |
| [55](#L55) | \* |
| [56](#L56) | \* @since 4.3 |
| [57](#L57) | \* |
| [58](#L58) | \* @return PageBuilderSandwich |
| [59](#L59) | \*/ |
| [60](#L60) | public static function instance() { |
| [61](#L61) | if ( empty( self::$\_instance ) ) { |
| [62](#L62) | self::$\_instance = new PageBuilderSandwich(); |
| [63](#L63) | } |
| [64](#L64) |  |
| [65](#L65) | return self::$\_instance; |
| [66](#L66) | } |
| [67](#L67) |  |
| [68](#L68) | /\*\* |
| [69](#L69) | \* Hook into WordPress. |
| [70](#L70) | \* |
| [71](#L71) | \* @return      void |
| [72](#L72) | \* @since       1.0 |
| [73](#L73) | \*/ |
| [74](#L74) | function \_\_construct() { |
| [75](#L75) |  |
| [76](#L76) | new PBSCompatibility(); |
| [77](#L77) |  |
| [78](#L78) | /\*\* |
| [79](#L79) | \* Necessary stuff to make content work for non-editors / logged out users. |
| [80](#L80) | \*/ |
| [81](#L81) |  |
| [82](#L82) | // These are the scripts which is needed by non-editors. |
| [83](#L83) | add\_action( 'wp\_enqueue\_scripts', array( $this, 'enqueue\_frontend' ) ); |
| [84](#L84) |  |
| [85](#L85) | // Gathers all the ce-tags so we can include the different scripts needed (see previous line). |
| [86](#L86) | add\_filter( 'the\_content', array( $this, 'gather\_ce\_tags' ), 0 ); |
| [87](#L87) | add\_filter( 'the\_content', array( $this, 'add\_spec\_style\_tag' ), 9999999 ); |
| [88](#L88) |  |
| [89](#L89) | // Allow all stuff in TinyMCE. |
| [90](#L90) | add\_filter( 'tiny\_mce\_before\_init', array( $this, 'tinymce\_allow\_divs' ), 20 ); |
| [91](#L91) | add\_filter( 'teeny\_mce\_before\_init', array( $this, 'tinymce\_allow\_divs' ), 20 ); |
| [92](#L92) |  |
| [93](#L93) | /\*\* |
| [94](#L94) | \* Allow others to stop the loading of PBS when necessary, e.g. other builders, and stuff that can heavily conflict. |
| [95](#L95) | \*/ |
| [96](#L96) |  |
| [97](#L97) | if ( ! apply\_filters( 'pbs\_load\_editor', true ) ) { |
| [98](#L98) | return; |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | /\*\* |
| [102](#L102) | \* All stuff below are for the editor. |
| [103](#L103) | \*/ |
| [104](#L104) | // Our admin-side scripts & styles. |
| [105](#L105) | add\_action( 'admin\_enqueue\_scripts', array( $this, 'enqueue\_admin\_scripts' ) ); |
| [106](#L106) |  |
| [107](#L107) | // Enqueues scripts and styles specific for all parts of the plugin. |
| [108](#L108) | add\_action( 'wp\_enqueue\_scripts', array( $this, 'enqueue\_editor' ) ); |
| [109](#L109) |  |
| [110](#L110) | // Apply different markers that we need for the builder to work properly in the frontend. |
| [111](#L111) | add\_filter( 'the\_content', array( $this, 'escape\_pretext\_shortcodes' ), 0 ); |
| [112](#L112) | add\_filter( 'the\_content', array( $this, 'add\_shortcode\_markers' ), 0 ); |
| [113](#L113) | add\_filter( 'pbs\_save\_content', array( $this, 'remove\_shortcode\_markers' ) ); |
| [114](#L114) | add\_filter( 'the\_content', array( $this, 'add\_oembed\_markers' ), 0 ); |
| [115](#L115) | add\_filter( 'pbs\_save\_content', array( $this, 'remove\_oembed\_markers' ) ); |
| [116](#L116) | add\_filter( 'the\_content', array( $this, 'add\_iframe\_markers' ), 0 ); |
| [117](#L117) |  |
| [118](#L118) | // Add the wrapper to detect the content area for the builder. |
| [119](#L119) | add\_filter( 'the\_content', array( $this, 'add\_builder\_wrapper' ), 9 ); |
| [120](#L120) | add\_filter( 'the\_content', array( $this, 'add\_builder\_wrapper\_fallback' ), 999999 ); |
| [121](#L121) |  |
| [122](#L122) | // Important: We have to delay some filters so that our `add\_builder\_wrapper` works correctly. |
| [123](#L123) | $this->delay\_the\_content\_filters(); |
| [124](#L124) |  |
| [125](#L125) | // Saving handlers. |
| [126](#L126) | add\_action( 'wp\_ajax\_gambit\_builder\_save\_content', array( $this, 'save\_content' ) ); |
| [127](#L127) | add\_filter( 'pbs\_save\_content', array( $this, 'cleanup\_content' ), 999 ); |
| [128](#L128) |  |
| [129](#L129) | // Other necessary scripts. |
| [130](#L130) | add\_action( 'wp\_footer', array( $this, 'add\_builder\_templates' ) ); |
| [131](#L131) | add\_action( 'wp\_footer', array( $this, 'add\_wplink\_dependencies' ) ); |
| [132](#L132) | add\_action( 'wp\_footer', array( $this, 'add\_empty\_text\_placeholder' ) ); |
| [133](#L133) |  |
| [134](#L134) | // Add our admin bar button. |
| [135](#L135) | if ( ! is\_admin() ) { |
| [136](#L136) | add\_action( 'admin\_bar\_menu', array( $this, 'add\_edit\_admin\_bar\_button' ), 999 ); |
| [137](#L137) | } |
| [138](#L138) |  |
| [139](#L139) | // Minimum styling to make the default content editor play nice with PBS's saved content. |
| [140](#L140) | add\_action( 'admin\_init', array( $this, 'add\_editor\_styles' ) ); |
| [141](#L141) |  |
| [142](#L142) | new PBSRenderShortcode(); |
| [143](#L143) | } |
| [144](#L144) |  |
| [145](#L145) |  |
| [146](#L146) | /\*\* |
| [147](#L147) | \* We need to delay these filters because OTHER plugins & themes MAY append some stuff |
| [148](#L148) | \* in `the\_content` filter which SHOULDN'T be editable in PBS. So the solution would be |
| [149](#L149) | \* to grab/wrap the content BEFORE priority 10. We do ours in priority 9. |
| [150](#L150) | \* |
| [151](#L151) | \* But we need wpautop to first run, but that's called at priority 10 - which is too late. |
| [152](#L152) | \* to fix this, we move wpautop to priority 8. |
| [153](#L153) | \*/ |
| [154](#L154) | public function delay\_the\_content\_filters() { |
| [155](#L155) | remove\_filter( 'the\_content', 'wpautop' ); |
| [156](#L156) | add\_filter( 'the\_content', 'wpautop', 8 ); |
| [157](#L157) |  |
| [158](#L158) | // Since we moved wpautop to priority 8, it might conflict with others which need to run |
| [159](#L159) | // before wpautop, delay those also. |
| [160](#L160) | if ( ! empty( $GLOBALS['wp\_embed'] ) ) { |
| [161](#L161) | remove\_filter( 'the\_content', array( $GLOBALS['wp\_embed'], 'run\_shortcode' ), 8 ); |
| [162](#L162) | add\_filter( 'the\_content', array( $GLOBALS['wp\_embed'], 'run\_shortcode' ), 7 ); |
| [163](#L163) | remove\_filter( 'the\_content', array( $GLOBALS['wp\_embed'], 'autoembed' ), 8 ); |
| [164](#L164) | add\_filter( 'the\_content', array( $GLOBALS['wp\_embed'], 'autoembed' ), 7 ); |
| [165](#L165) | } |
| [166](#L166) | } |
| [167](#L167) |  |
| [168](#L168) |  |
| [169](#L169) | /\*\* |
| [170](#L170) | \* We are adding divs with attributes normally not allowed in TinyMCE. Allow our divs in TinyMCE. |
| [171](#L171) | \* |
| [172](#L172) | \* @since 2.9 |
| [173](#L173) | \* |
| [174](#L174) | \* @param array $init TinyMCE init parameters. |
| [175](#L175) | \* |
| [176](#L176) | \* @return array The modified TinyMCE init parameters. |
| [177](#L177) | \*/ |
| [178](#L178) | public function tinymce\_allow\_divs( $init ) { |
| [179](#L179) | if ( ! empty( $init['extended\_valid\_elements'] ) ) { |
| [180](#L180) | $init['extended\_valid\_elements'] .= ','; |
| [181](#L181) | } else { |
| [182](#L182) | $init['extended\_valid\_elements'] = ''; |
| [183](#L183) | } |
| [184](#L184) | $init['extended\_valid\_elements'] .= 'div[\*]'; |
| [185](#L185) | return apply\_filters( 'pbs\_tinymce\_allow\_divs', $init ); |
| [186](#L186) | } |
| [187](#L187) |  |
| [188](#L188) |  |
| [189](#L189) | /\*\* |
| [190](#L190) | \* Checks whether the current user has editing privileges in the current |
| [191](#L191) | \* page/post/CPT. |
| [192](#L192) | \* |
| [193](#L193) | \* @since 2.0 |
| [194](#L194) | \* |
| [195](#L195) | \* @return boolean Returns true if the current page is a post and if its editable. |
| [196](#L196) | \*/ |
| [197](#L197) | public static function is\_editable\_by\_user() { |
| [198](#L198) |  |
| [199](#L199) | // If $wp\_query is not yet defined, other functions below would |
| [200](#L200) | // encounter errors because they're called too early. Check it first. |
| [201](#L201) | global $wp\_query; |
| [202](#L202) | if ( ! isset( $wp\_query ) ) { |
| [203](#L203) | return false; |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | $is\_editable = true; |
| [207](#L207) |  |
| [208](#L208) | // Don't show in the customizer. |
| [209](#L209) | if ( is\_customize\_preview() ) { |
| [210](#L210) | $is\_editable = false; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | // Don't show for non-single pages. |
| [214](#L214) | if ( ! is\_single() && ! is\_page() ) { |
| [215](#L215) | $is\_editable = false; |
| [216](#L216) | } |
| [217](#L217) |  |
| [218](#L218) | // Don't show if we are not in the main query. |
| [219](#L219) | if ( ! is\_main\_query() ) { |
| [220](#L220) | $is\_editable = false; |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | // Don't show if post data is not available. |
| [224](#L224) | if ( empty( $GLOBALS['post'] ) ) { |
| [225](#L225) | $is\_editable = false; |
| [226](#L226) | } |
| [227](#L227) |  |
| [228](#L228) | if ( $is\_editable ) { |
| [229](#L229) |  |
| [230](#L230) | global $post; |
| [231](#L231) | if ( is\_single() ) { |
| [232](#L232) | if ( $post ) { |
| [233](#L233) | $is\_editable = current\_user\_can( 'edit\_post', $post->ID ); |
| [234](#L234) | } else { |
| [235](#L235) | $is\_editable = current\_user\_can( 'edit\_posts' ); |
| [236](#L236) | } |
| [237](#L237) | } else { |
| [238](#L238) | if ( $post ) { |
| [239](#L239) | $is\_editable = current\_user\_can( 'edit\_page', $post->ID ); |
| [240](#L240) | } else { |
| [241](#L241) | $is\_editable = current\_user\_can( 'edit\_pages' ); |
| [242](#L242) | } |
| [243](#L243) | } |
| [244](#L244) | } |
| [245](#L245) |  |
| [246](#L246) | return apply\_filters( 'pbs\_is\_editable\_by\_user', $is\_editable ); |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) |  |
| [250](#L250) | /\*\* |
| [251](#L251) | \* Adds PBS required template files. |
| [252](#L252) | \* |
| [253](#L253) | \* @since 2.0 |
| [254](#L254) | \*/ |
| [255](#L255) | public function add\_builder\_templates() { |
| [256](#L256) | if ( ! self::is\_editable\_by\_user() ) { |
| [257](#L257) | return; |
| [258](#L258) | } |
| [259](#L259) |  |
| [260](#L260) | global $pbs\_url\_for\_templates; |
| [261](#L261) | $pbs\_url\_for\_templates = trailingslashit( plugins\_url( 'page\_builder\_sandwich', \_\_FILE\_\_ ) ); |
| [262](#L262) |  |
| [263](#L263) | include 'page\_builder\_sandwich/templates/pbs-modal.php'; |
| [264](#L264) | include 'page\_builder\_sandwich/templates/option-border.php'; |
| [265](#L265) | include 'page\_builder\_sandwich/templates/option-text.php'; |
| [266](#L266) | include 'page\_builder\_sandwich/templates/option-textarea.php'; |
| [267](#L267) | include 'page\_builder\_sandwich/templates/option-color.php'; |
| [268](#L268) | include 'page\_builder\_sandwich/templates/option-margins-and-paddings.php'; |
| [269](#L269) | include 'page\_builder\_sandwich/templates/option-select.php'; |
| [270](#L270) | include 'page\_builder\_sandwich/templates/option-checkbox.php'; |
| [271](#L271) | include 'page\_builder\_sandwich/templates/option-button2.php'; |
| [272](#L272) | include 'page\_builder\_sandwich/templates/option-shortcode-generic.php'; |
| [273](#L273) | include 'page\_builder\_sandwich/templates/option-image.php'; |
| [274](#L274) | include 'page\_builder\_sandwich/templates/option-file.php'; |
| [275](#L275) | include 'page\_builder\_sandwich/templates/option-number.php'; |
| [276](#L276) | include 'page\_builder\_sandwich/templates/option-note.php'; |
| [277](#L277) | include 'page\_builder\_sandwich/templates/option-link.php'; |
| [278](#L278) | include 'page\_builder\_sandwich/templates/frame-admin.php'; |
| [279](#L279) | include 'page\_builder\_sandwich/templates/frame-shortcode-picker.php'; |
| [280](#L280) | include 'page\_builder\_sandwich/templates/frame-predesigned-picker.php'; |
| [281](#L281) | include 'page\_builder\_sandwich/templates/modal-intro-tour.php'; |
| [282](#L282) |  |
| [283](#L283) | global $pbs\_fs; |
| [284](#L284) | if ( ! PBS\_IS\_LITE && $pbs\_fs->can\_use\_premium\_code() ) { |
| [285](#L285) | include 'page\_builder\_sandwich/templates/option-multicheck.php'; |
| [286](#L286) | include 'page\_builder\_sandwich/templates/option-iframe.php'; |
| [287](#L287) |  |
| [288](#L288) | include 'page\_builder\_sandwich/templates/design-element-page-headings.php'; |
| [289](#L289) | include 'page\_builder\_sandwich/templates/design-element-page-headings-2.php'; |
| [290](#L290) | include 'page\_builder\_sandwich/templates/design-element-page-headings-3.php'; |
| [291](#L291) | include 'page\_builder\_sandwich/templates/design-element-page-headings-4.php'; |
| [292](#L292) | include 'page\_builder\_sandwich/templates/design-element-page-headings-5.php'; |
| [293](#L293) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions.php'; |
| [294](#L294) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions-2.php'; |
| [295](#L295) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions-3.php'; |
| [296](#L296) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions-4.php'; |
| [297](#L297) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions-5.php'; |
| [298](#L298) | include 'page\_builder\_sandwich/templates/design-element-call-to-actions-6.php'; |
| [299](#L299) | include 'page\_builder\_sandwich/templates/design-element-testimonials.php'; |
| [300](#L300) | include 'page\_builder\_sandwich/templates/design-element-testimonials-2.php'; |
| [301](#L301) | include 'page\_builder\_sandwich/templates/design-element-testimonials-3.php'; |
| [302](#L302) | include 'page\_builder\_sandwich/templates/design-element-testimonials-4.php'; |
| [303](#L303) | include 'page\_builder\_sandwich/templates/design-element-testimonials-5.php'; |
| [304](#L304) | // include 'page\_builder\_sandwich/templates/design-element-testimonials-6.php'; |
| [305](#L305) | include 'page\_builder\_sandwich/templates/design-element-pricing-tables.php'; |
| [306](#L306) | include 'page\_builder\_sandwich/templates/design-element-pricing-tables-2.php'; |
| [307](#L307) | include 'page\_builder\_sandwich/templates/design-element-pricing-tables-3.php'; |
| [308](#L308) | include 'page\_builder\_sandwich/templates/design-element-pricing-tables-4.php'; |
| [309](#L309) | include 'page\_builder\_sandwich/templates/design-element-pricing-tables-5.php'; |
| [310](#L310) | include 'page\_builder\_sandwich/templates/design-element-large-features.php'; |
| [311](#L311) | include 'page\_builder\_sandwich/templates/design-element-large-features-2.php'; |
| [312](#L312) | include 'page\_builder\_sandwich/templates/design-element-large-features-3.php'; |
| [313](#L313) | include 'page\_builder\_sandwich/templates/design-element-large-features-4.php'; |
| [314](#L314) | include 'page\_builder\_sandwich/templates/design-element-large-features-5.php'; |
| [315](#L315) | include 'page\_builder\_sandwich/templates/design-element-large-features-6.php'; |
| [316](#L316) | include 'page\_builder\_sandwich/templates/design-element-large-features-7.php'; |
| [317](#L317) | include 'page\_builder\_sandwich/templates/design-element-large-features-8.php'; |
| [318](#L318) | include 'page\_builder\_sandwich/templates/design-element-large-features-9.php'; |
| [319](#L319) | include 'page\_builder\_sandwich/templates/design-element-large-features-10.php'; |
| [320](#L320) | include 'page\_builder\_sandwich/templates/design-element-large-features-11.php'; |
| [321](#L321) | include 'page\_builder\_sandwich/templates/design-element-large-features-12.php'; |
| [322](#L322) | include 'page\_builder\_sandwich/templates/design-element-large-features-13.php'; |
| [323](#L323) | include 'page\_builder\_sandwich/templates/design-element-large-features-14.php'; |
| [324](#L324) | include 'page\_builder\_sandwich/templates/design-element-team-members.php'; |
| [325](#L325) | include 'page\_builder\_sandwich/templates/design-element-team-members-2.php'; |
| [326](#L326) | include 'page\_builder\_sandwich/templates/design-element-team-members-3.php'; |
| [327](#L327) | include 'page\_builder\_sandwich/templates/design-element-team-members-4.php'; |
| [328](#L328) | include 'page\_builder\_sandwich/templates/design-element-gallery-1.php'; |
| [329](#L329) | include 'page\_builder\_sandwich/templates/design-element-gallery-2.php'; |
| [330](#L330) | include 'page\_builder\_sandwich/templates/design-element-gallery-3.php'; |
| [331](#L331) | include 'page\_builder\_sandwich/templates/design-element-gallery-4.php'; |
| [332](#L332) | include 'page\_builder\_sandwich/templates/design-element-gallery-5.php'; |
| [333](#L333) |  |
| [334](#L334) | } else { |
| [335](#L335) | include 'page\_builder\_sandwich/templates/modal-learn-premium.php'; |
| [336](#L336) | include 'page\_builder\_sandwich/templates/modal-learn-premium-elements.php'; |
| [337](#L337) | include 'page\_builder\_sandwich/templates/option-text-dummy.php'; |
| [338](#L338) | } |
| [339](#L339) | } |
| [340](#L340) |  |
| [341](#L341) |  |
| [342](#L342) | /\*\* |
| [343](#L343) | \* Adds the necessary script and markup for the link dialog modal. |
| [344](#L344) | \* This modal is used to create/edit text links. |
| [345](#L345) | \* |
| [346](#L346) | \* @since 2.1 |
| [347](#L347) | \*/ |
| [348](#L348) | public function add\_wplink\_dependencies() { |
| [349](#L349) | if ( self::is\_editable\_by\_user() ) { |
| [350](#L350) |  |
| [351](#L351) | // Render the link dialog html. |
| [352](#L352) | require\_once ABSPATH . WPINC . '/class-wp-editor.php'; |
| [353](#L353) | \_WP\_Editors::wp\_link\_dialog(); |
| [354](#L354) |  |
| [355](#L355) | // We need this dummy textarea to make the link modal work. |
| [356](#L356) | echo '<textarea id="dummy-wplink-textarea"></textarea>'; |
| [357](#L357) |  |
| [358](#L358) | // The variable adminajax isn't normally defined in the frontend and is needed by wpLink. |
| [359](#L359) | echo '<script>var ajaxurl = "' . esc\_url( admin\_url( 'admin-ajax.php' ) ) . '";</script>'; |
| [360](#L360) | } |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) |  |
| [364](#L364) | /\*\* |
| [365](#L365) | \* Adds PBS buttons to the admin bar in the frontend. These buttons are used |
| [366](#L366) | \* directly by our editor. |
| [367](#L367) | \* |
| [368](#L368) | \* @since 2.0 |
| [369](#L369) | \* |
| [370](#L370) | \* @param object $wp\_admin\_bar The admin bar object. |
| [371](#L371) | \* |
| [372](#L372) | \* @return void |
| [373](#L373) | \*/ |
| [374](#L374) | public function add\_edit\_admin\_bar\_button( $wp\_admin\_bar ) { |
| [375](#L375) | if ( ! self::is\_editable\_by\_user() ) { |
| [376](#L376) | return; |
| [377](#L377) | } |
| [378](#L378) | $args = array( |
| [379](#L379) | 'id'    => 'gambit\_builder\_edit', |
| [380](#L380) | 'title' => '<span class="ab-icon"></span>' . \_\_( 'Page Builder Sandwich', 'page-builder-sandwich' ), |
| [381](#L381) | 'href'  => apply\_filters( 'pbs\_admin\_bar\_edit\_button\_url', '#' ), |
| [382](#L382) | 'meta'  => array( 'class' => 'pbs-adminbar-icon' ), |
| [383](#L383) | ); |
| [384](#L384) | $wp\_admin\_bar->add\_node( $args ); |
| [385](#L385) |  |
| [386](#L386) | global $pbs\_fs; |
| [387](#L387) | if ( PBS\_IS\_LITE || ! $pbs\_fs->can\_use\_premium\_code() ) { |
| [388](#L388) | $args = array( |
| [389](#L389) | 'id'    => 'pbs\_go\_premium', |
| [390](#L390) | 'title' => '<span class="ab-icon"></span>' |
| [391](#L391) | . \_\_( 'Learn More About Premium', 'page-builder-sandwich' ), |
| [392](#L392) | 'href'  => '#', |
| [393](#L393) | 'meta'  => array( |
| [394](#L394) | 'class' => 'pbs-adminbar-icon', |
| [395](#L395) | ), |
| [396](#L396) | ); |
| [397](#L397) | $wp\_admin\_bar->add\_node( $args ); |
| [398](#L398) | } |
| [399](#L399) |  |
| [400](#L400) | /\*\* |
| [401](#L401) | \* Allow others to add more admin bar buttons. |
| [402](#L402) | \* |
| [403](#L403) | \* @since 4.0 |
| [404](#L404) | \* |
| [405](#L405) | \* @param object $wp\_admin\_bar The admin bar object. |
| [406](#L406) | \*/ |
| [407](#L407) | do\_action( 'pbs\_pre\_add\_edit\_admin\_bar\_button', $wp\_admin\_bar ); |
| [408](#L408) |  |
| [409](#L409) | // Save button label. |
| [410](#L410) | $save\_label = '<span id="pbs-save-publish-label">' . \_\_( 'Save and Update', 'page-builder-sandwich' ) . '</span>'; |
| [411](#L411) | $save\_label .= '<span id="pbs-save-draft-label">' . \_\_( 'Save as Draft', 'page-builder-sandwich' ) . '</span>'; |
| [412](#L412) | $save\_label .= '<span id="pbs-save-pending-label">' . \_\_( 'Save as Pending Review', 'page-builder-sandwich' ) . '</span>'; |
| [413](#L413) | $args = array( |
| [414](#L414) | 'id'    => 'gambit\_builder\_save', |
| [415](#L415) | 'title' => $save\_label, |
| [416](#L416) | 'href'  => '#', |
| [417](#L417) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [418](#L418) | ); |
| [419](#L419) | $wp\_admin\_bar->add\_node( $args ); |
| [420](#L420) | $args = array( |
| [421](#L421) | 'id'    => 'gambit\_builder\_save\_options', |
| [422](#L422) | 'title' => '<span class="ab-icon"></span> |
| [423](#L423) | <span id="pbs-save-button"> |
| [424](#L424) | <span id="pbs-save-publish">' . esc\_html\_\_( 'Save and Publish', 'page-builder-sandwich' ) . '</span> |
| [425](#L425) | <span id="pbs-save-pending">' . esc\_html\_\_( 'Save as Pending Review', 'page-builder-sandwich' ) . '</span> |
| [426](#L426) | <span id="pbs-save-draft">' . esc\_html\_\_( 'Save as Draft', 'page-builder-sandwich' ) . '</span> |
| [427](#L427) | </span>', |
| [428](#L428) | 'href'  => '#', |
| [429](#L429) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [430](#L430) | ); |
| [431](#L431) | $wp\_admin\_bar->add\_node( $args ); |
| [432](#L432) | $args = array( |
| [433](#L433) | 'id'    => 'gambit\_builder\_cancel', |
| [434](#L434) | 'title' => \_\_( 'Cancel', 'page-builder-sandwich' ), |
| [435](#L435) | 'href'  => '#', |
| [436](#L436) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [437](#L437) | ); |
| [438](#L438) | $wp\_admin\_bar->add\_node( $args ); |
| [439](#L439) | $args = array( |
| [440](#L440) | 'id'    => 'gambit\_builder\_busy', |
| [441](#L441) | 'title' => '<span class="ab-icon"></span>' . \_\_( 'Saving, Please wait...', 'page-builder-sandwich' ), |
| [442](#L442) | 'href'  => '#', |
| [443](#L443) | 'meta'  => array( 'class' => 'pbs-adminbar-icon' ), |
| [444](#L444) | ); |
| [445](#L445) | $wp\_admin\_bar->add\_node( $args ); |
| [446](#L446) |  |
| [447](#L447) | $args = array( |
| [448](#L448) | 'id'    => 'pbs\_help\_docs', |
| [449](#L449) | 'title' => '<span class="ab-icon"></span>', |
| [450](#L450) | 'href'  => '#', |
| [451](#L451) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [452](#L452) | ); |
| [453](#L453) | $wp\_admin\_bar->add\_node( $args ); |
| [454](#L454) |  |
| [455](#L455) | /\*\* |
| [456](#L456) | \* Allow others to add more admin bar buttons. |
| [457](#L457) | \* |
| [458](#L458) | \* @since 4.0 |
| [459](#L459) | \* |
| [460](#L460) | \* @param object $wp\_admin\_bar The admin bar object. |
| [461](#L461) | \*/ |
| [462](#L462) | do\_action( 'pbs\_post\_add\_edit\_admin\_bar\_button', $wp\_admin\_bar ); |
| [463](#L463) |  |
| [464](#L464) | if ( PBS\_IS\_PRO ) { |
| [465](#L465) | $args = array( |
| [466](#L466) | 'id'    => 'gambit\_builder\_css', |
| [467](#L467) | 'title' => '<span class="ab-icon"></span>' . \_\_( 'CSS', 'page-builder-sandwich' ), |
| [468](#L468) | 'href'  => '#', |
| [469](#L469) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [470](#L470) | ); |
| [471](#L471) | $wp\_admin\_bar->add\_node( $args ); |
| [472](#L472) | $args = array( |
| [473](#L473) | 'id'    => 'gambit\_builder\_js', |
| [474](#L474) | 'title' => '<span class="ab-icon"></span>' . \_\_( 'Javascript', 'page-builder-sandwich' ), |
| [475](#L475) | 'href'  => '#', |
| [476](#L476) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [477](#L477) | ); |
| [478](#L478) | $wp\_admin\_bar->add\_node( $args ); |
| [479](#L479) | $args = array( |
| [480](#L480) | 'id'    => 'gambit\_builder\_source', |
| [481](#L481) | 'title' => '<span class="ab-icon"></span>' . \_\_( 'Source', 'page-builder-sandwich' ), |
| [482](#L482) | 'href'  => '#', |
| [483](#L483) | 'meta'  => array( 'class' => 'pbs-adminbar-icon pbs-adminbar-right' ), |
| [484](#L484) | ); |
| [485](#L485) | $wp\_admin\_bar->add\_node( $args ); |
| [486](#L486) | } |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) |  |
| [490](#L490) | /\*\* |
| [491](#L491) | \* Adds markers to oembed URLs so PBS can edit them. |
| [492](#L492) | \* |
| [493](#L493) | \* @since 2.0 |
| [494](#L494) | \* |
| [495](#L495) | \* @param string $content The current post content. |
| [496](#L496) | \* |
| [497](#L497) | \* @return string The modified content. |
| [498](#L498) | \*/ |
| [499](#L499) | public function add\_oembed\_markers( $content ) { |
| [500](#L500) | if ( ! self::is\_editable\_by\_user() ) { |
| [501](#L501) | return $content; |
| [502](#L502) | } |
| [503](#L503) |  |
| [504](#L504) | // Check all one liner URLs for possible embedable URLs. |
| [505](#L505) | preg\_match\_all( '/^\s\*(?:http|https)?(?:\:\/\/)?(?:www.)?(([A-Za-z0-9-]+\.)\*[A-Za-z0-9-]+\.[A-Za-z]+)(?:\/.\*)?\s\*$/im', $content, $oembed\_urls, PREG\_SET\_ORDER | PREG\_OFFSET\_CAPTURE ); |
| [506](#L506) |  |
| [507](#L507) | if ( ! empty( $oembed\_urls ) ) { |
| [508](#L508) |  |
| [509](#L509) | require\_once ABSPATH . WPINC . '/class-oembed.php'; |
| [510](#L510) |  |
| [511](#L511) | // Use the embed object for checking oembeds. |
| [512](#L512) | $embed\_object = \_wp\_oembed\_get\_object(); |
| [513](#L513) | $oembed\_args = array( |
| [514](#L514) | 'discover' => false, // Turn this off to stop remote gets, we only need to check URLs. |
| [515](#L515) | ); |
| [516](#L516) |  |
| [517](#L517) | for ( $i = count( $oembed\_urls ) - 1; $i >= 0; $i-- ) { |
| [518](#L518) | $match = $oembed\_urls[ $i ]; |
| [519](#L519) | $oembed\_url = $match[0][0]; |
| [520](#L520) |  |
| [521](#L521) | // Check whether the URL is an oembed URL. |
| [522](#L522) | if ( ! $embed\_object->get\_provider( $oembed\_url, $oembed\_args ) ) { |
| [523](#L523) | continue; |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) | $modifiedo\_embed\_url = '<div data-ce-moveable data-ce-static data-ce-tag="embed" data-url="' . esc\_url( $oembed\_url ) . '">' . "\n" . $oembed\_url . "\n" . '</div>'; |
| [527](#L527) |  |
| [528](#L528) | $content = substr( $content, 0, $match[0][1] ) . $modifiedo\_embed\_url . substr( $content, $match[0][1] + strlen( $match[0][0] ) ); |
| [529](#L529) |  |
| [530](#L530) | } |
| [531](#L531) | } |
| [532](#L532) |  |
| [533](#L533) | remove\_action( 'the\_content', array( $this, 'add\_oembed\_markers' ), 1 ); |
| [534](#L534) |  |
| [535](#L535) | return apply\_filters( 'pbs\_add\_oembed\_markers', $content ); |
| [536](#L536) | } |
| [537](#L537) |  |
| [538](#L538) |  |
| [539](#L539) | /\*\* |
| [540](#L540) | \* When saving content, remove oembeds and bring them back to normal URLs |
| [541](#L541) | \* to let WP perform its normal embed procedures. |
| [542](#L542) | \* |
| [543](#L543) | \* @since 2.0 |
| [544](#L544) | \* |
| [545](#L545) | \* @param string $content The current post content. |
| [546](#L546) | \* |
| [547](#L547) | \* @return string The modified content. |
| [548](#L548) | \*/ |
| [549](#L549) | public function remove\_oembed\_markers( $content ) { |
| [550](#L550) | if ( ! class\_exists( 'simple\_html\_dom' ) ) { |
| [551](#L551) | require\_once( 'page\_builder\_sandwich/inc/simple\_html\_dom.php' ); |
| [552](#L552) | } |
| [553](#L553) |  |
| [554](#L554) | // Remove all data-shortcode and replace it with the decoded shortcode. Do this from last to first to preserve nesting. |
| [555](#L555) | $html = new simple\_html\_dom(); |
| [556](#L556) | $html->load( $content, true, false ); |
| [557](#L557) |  |
| [558](#L558) | $elements = $html->find( '[data-ce-tag="embed"]' ); |
| [559](#L559) | for ( $i = count( $elements ) - 1; $i >= 0; $i-- ) { |
| [560](#L560) | $element = $elements[ $i ]; |
| [561](#L561) | $url = $element->{'data-url'}; |
| [562](#L562) |  |
| [563](#L563) | $elements[ $i ]->outertext = '<p>' . $url . '</p>'; |
| [564](#L564) | } |
| [565](#L565) | $content = (string) $html; |
| [566](#L566) |  |
| [567](#L567) | return apply\_filters( 'pbs\_remove\_oembed\_markers', $content ); |
| [568](#L568) | } |
| [569](#L569) |  |
| [570](#L570) |  |
| [571](#L571) | /\*\* |
| [572](#L572) | \* Strings inside preformatted text that look like shortcodes get detected |
| [573](#L573) | \* as shortcodes. To prevent this, escape "[" inside preformatted text. |
| [574](#L574) | \* |
| [575](#L575) | \* @since 3.0 |
| [576](#L576) | \* |
| [577](#L577) | \* @param string $content The current post content. |
| [578](#L578) | \* |
| [579](#L579) | \* @return string The modified content. |
| [580](#L580) | \*/ |
| [581](#L581) | public function escape\_pretext\_shortcodes( $content ) { |
| [582](#L582) |  |
| [583](#L583) | if ( ! class\_exists( 'simple\_html\_dom' ) ) { |
| [584](#L584) | require\_once( 'page\_builder\_sandwich/inc/simple\_html\_dom.php' ); |
| [585](#L585) | } |
| [586](#L586) |  |
| [587](#L587) | // Remove all data-shortcode and replace it with the decoded shortcode. Do this from last to first to preserve nesting. |
| [588](#L588) | $html = new simple\_html\_dom(); |
| [589](#L589) | $html->load( $content, true, false ); |
| [590](#L590) |  |
| [591](#L591) | $elements = $html->find( 'pre' ); |
| [592](#L592) | for ( $i = count( $elements ) - 1; $i >= 0; $i-- ) { |
| [593](#L593) | $elements[ $i ]->innertext = preg\_replace( '/\[/', '&#91;', $elements[ $i ]->innertext ); |
| [594](#L594) | } |
| [595](#L595) | $content = (string) $html; |
| [596](#L596) |  |
| [597](#L597) | return apply\_filters( 'pbs\_escape\_pretext\_shortcodes', $content ); |
| [598](#L598) | } |
| [599](#L599) |  |
| [600](#L600) |  |
| [601](#L601) | /\*\* |
| [602](#L602) | \* Adds Shortcode markers to shortcode-like strings. |
| [603](#L603) | \* |
| [604](#L604) | \* @since 3.0.1 |
| [605](#L605) | \* |
| [606](#L606) | \* @param string $content The post content. |
| [607](#L607) | \* |
| [608](#L608) | \* @return string The modified content. |
| [609](#L609) | \*/ |
| [610](#L610) | public function \_add\_shortcode\_markers( $content ) { |
| [611](#L611) |  |
| [612](#L612) | // Some shortcodes register their shortcode tags late. Instead |
| [613](#L613) | // of using get\_shortcode\_regex(), build our own regex using the |
| [614](#L614) | // same method, but capture all sc-like tags instead of just |
| [615](#L615) | // using the registered ones. |
| [616](#L616) | // @codingStandardsIgnoreStart |
| [617](#L617) | $shortcode\_pattern = |
| [618](#L618) | '\\[' // Opening bracket |
| [619](#L619) | . '(\\[?)' // 1: Optional second opening bracket for escaping shortcodes: [[tag]]. |
| [620](#L620) | . "([^\s\\[\\]]+)" // 2: Shortcode name |
| [621](#L621) | // . "([^\\d\\s<>\\/\\[\\]][^\\s<>\\/\\[\\]]{0,})" // 2: Shortcode name |
| [622](#L622) | . '(?![\\w-])' // Not followed by word character or hyphen |
| [623](#L623) | . '(' // 3: Unroll the loop: Inside the opening shortcode tag |
| [624](#L624) | .     '[^\\]\\/]\*' // Not a closing bracket or forward slash |
| [625](#L625) | .     '(?:' |
| [626](#L626) | .         '\\/(?!\\])' // A forward slash not followed by a closing bracket |
| [627](#L627) | .         '[^\\]\\/]\*' // Not a closing bracket or forward slash |
| [628](#L628) | .     ')\*?' |
| [629](#L629) | . ')' |
| [630](#L630) | . '(?:' |
| [631](#L631) | .     '(\\/)' // 4: Self closing tag ... |
| [632](#L632) | .     '\\]' // ... and closing bracket |
| [633](#L633) | . '|' |
| [634](#L634) | .     '\\]' // Closing bracket |
| [635](#L635) | .     '(?:' |
| [636](#L636) | .         '(' // 5: Unroll the loop: Optionally, anything between the opening and closing shortcode tags |
| [637](#L637) | .             '[^\\[]\*+' // Not an opening bracket |
| [638](#L638) | .             '(?:' |
| [639](#L639) | .                 '\\[(?!\\/\\2\\])' // An opening bracket not followed by the closing shortcode tag |
| [640](#L640) | .                 '[^\\[]\*+' // Not an opening bracket |
| [641](#L641) | .             ')\*+' |
| [642](#L642) | .         ')' |
| [643](#L643) | .         '\\[\\/\\2\\]' // Closing shortcode tag |
| [644](#L644) | .     ')?' |
| [645](#L645) | . ')' |
| [646](#L646) | . '(\\]?)'; // 6: Optional second closing brocket for escaping shortcodes: [[tag]] |
| [647](#L647) | // @codingStandardsIgnoreEnd |
| [648](#L648) |  |
| [649](#L649) | preg\_match\_all( "/$shortcode\_pattern/", $content, $shortcodes, PREG\_SET\_ORDER | PREG\_OFFSET\_CAPTURE ); |
| [650](#L650) |  |
| [651](#L651) | // Wrap markers around shortcodes found. |
| [652](#L652) | if ( ! empty( $shortcodes ) ) { |
| [653](#L653) | for ( $i = count( $shortcodes ) - 1; $i >= 0; $i-- ) { |
| [654](#L654) | $match = $shortcodes[ $i ]; |
| [655](#L655) |  |
| [656](#L656) | $shortcode = substr( $content, $match[0][1], strlen( $match[0][0] ) ); |
| [657](#L657) | $shortcode\_tag = $match[2][0]; |
| [658](#L658) | $based\_shortcode = base64\_encode( $shortcode ); |
| [659](#L659) |  |
| [660](#L660) | $modified\_shortcode = '<div data-ce-moveable data-ce-static data-ce-tag="shortcode" data-base="' . $shortcode\_tag . '" data-shortcode="' . $based\_shortcode . '">' . $shortcode . '</div>'; |
| [661](#L661) | // $modified\_shortcode = '<div data-ce-moveable data-ce-static data-base="' . $shortcode\_tag . '" data-shortcode="' . $based\_shortcode . '">' . $shortcode . '</div>'; |
| [662](#L662) | $content = substr( $content, 0, $match[0][1] ) . $modified\_shortcode . substr( $content, $match[0][1] + strlen( $match[0][0] ) ); |
| [663](#L663) | } |
| [664](#L664) | } |
| [665](#L665) |  |
| [666](#L666) | return $content; |
| [667](#L667) | } |
| [668](#L668) |  |
| [669](#L669) |  |
| [670](#L670) | /\*\* |
| [671](#L671) | \* Wrap all shortcodes with markers so PBS can handle shortcode editing. |
| [672](#L672) | \* |
| [673](#L673) | \* @since 2.0 |
| [674](#L674) | \* |
| [675](#L675) | \* @param string $content The current post content. |
| [676](#L676) | \* |
| [677](#L677) | \* @return string The modified content. |
| [678](#L678) | \*/ |
| [679](#L679) | public function add\_shortcode\_markers( $content ) { |
| [680](#L680) | if ( ! self::is\_editable\_by\_user() ) { |
| [681](#L681) | return $content; |
| [682](#L682) | } |
| [683](#L683) |  |
| [684](#L684) | // Ignore all brackets inside HTML tags because that may screw up our shortcode pattern. HACKY I know, but we have no choice or else we will most likely get false positive. |
| [685](#L685) | $content = preg\_replace\_callback( '/<[^>]+[\[\]][^>]+>/', array( $this, '\_add\_shortcode\_markers\_hacky\_brackets' ), $content ); |
| [686](#L686) |  |
| [687](#L687) | // Escape all brackets inside script tags. |
| [688](#L688) | $content = preg\_replace\_callback( '/<script.\*?[\[\]].\*?<\/script>/', array( $this, '\_add\_shortcode\_markers\_hacky\_brackets' ), $content ); |
| [689](#L689) |  |
| [690](#L690) | // Escape all brackets inside style tags. |
| [691](#L691) | $content = preg\_replace\_callback( '/<style.\*?[\[\]].\*?<\/style>/', array( $this, '\_add\_shortcode\_markers\_hacky\_brackets' ), $content ); |
| [692](#L692) |  |
| [693](#L693) | // Add wrappers around all shortcodes that we can find. |
| [694](#L694) | $content = $this->\_add\_shortcode\_markers( $content ); |
| [695](#L695) |  |
| [696](#L696) | // Bring back the brackets we removed above. |
| [697](#L697) | $content = preg\_replace( '/—–\{——/', '[', $content ); |
| [698](#L698) | $content = preg\_replace( '/—–\}——/', ']', $content ); |
| [699](#L699) |  |
| [700](#L700) | remove\_action( 'the\_content', array( $this, 'add\_shortcode\_markers' ), 1 ); |
| [701](#L701) |  |
| [702](#L702) | // Stray spaces can create lost paragraph tags. |
| [703](#L703) | $content = preg\_replace( '/(\/\w+>)\s+(<\/\w+)/', '$1$2', $content ); |
| [704](#L704) | return apply\_filters( 'pbs\_add\_shortcode\_markers', $content ); |
| [705](#L705) | } |
| [706](#L706) |  |
| [707](#L707) |  |
| [708](#L708) | /\*\* |
| [709](#L709) | \* Replace all brackets with a hacky replacement which is meant to be |
| [710](#L710) | \* re-replaced by the add\_shortcode\_markers function. |
| [711](#L711) | \* |
| [712](#L712) | \* @since 4.3 |
| [713](#L713) | \* |
| [714](#L714) | \* @param array $matches The matching regex string. |
| [715](#L715) | \* |
| [716](#L716) | \* @return string The replaced string. |
| [717](#L717) | \*/ |
| [718](#L718) | public function \_add\_shortcode\_markers\_hacky\_brackets( $matches ) { |
| [719](#L719) | $content = $matches[0]; |
| [720](#L720) | $content = preg\_replace( '/\[/', '—–{——', $content ); |
| [721](#L721) | $content = preg\_replace( '/\]/', '—–}——', $content ); |
| [722](#L722) | return $content; |
| [723](#L723) | } |
| [724](#L724) |  |
| [725](#L725) |  |
| [726](#L726) | /\*\* |
| [727](#L727) | \* Wrap all iframe tags so PBS can edit them. |
| [728](#L728) | \* |
| [729](#L729) | \* @since 2.7 |
| [730](#L730) | \* |
| [731](#L731) | \* @param string $content The current post content. |
| [732](#L732) | \* |
| [733](#L733) | \* @return string The modified content. |
| [734](#L734) | \*/ |
| [735](#L735) | public function add\_iframe\_markers( $content ) { |
| [736](#L736) | if ( ! self::is\_editable\_by\_user() ) { |
| [737](#L737) | return $content; |
| [738](#L738) | } |
| [739](#L739) |  |
| [740](#L740) | preg\_match\_all( '/<iframe[^>]+>\s\*<\/iframe\s\*>/', $content, $iframes, PREG\_SET\_ORDER | PREG\_OFFSET\_CAPTURE ); |
| [741](#L741) |  |
| [742](#L742) | // Add markers to all iframes. |
| [743](#L743) | if ( ! empty( $iframes ) ) { |
| [744](#L744) | for ( $i = count( $iframes ) - 1; $i >= 0; $i-- ) { |
| [745](#L745) | $match = $iframes[ $i ]; |
| [746](#L746) |  |
| [747](#L747) | $iframe = substr( $content, $match[0][1], strlen( $match[0][0] ) ); |
| [748](#L748) |  |
| [749](#L749) | $iframe = "\n\n" . $iframe . "\n\n"; |
| [750](#L750) |  |
| [751](#L751) | $content = substr( $content, 0, $match[0][1] ) . $iframe . substr( $content, $match[0][1] + strlen( $match[0][0] ) ); |
| [752](#L752) | } |
| [753](#L753) | } |
| [754](#L754) |  |
| [755](#L755) | return apply\_filters( 'pbs\_add\_iframe\_markers', $content ); |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) |  |
| [759](#L759) | /\*\* |
| [760](#L760) | \* As a fallback, if our builder wrapper cannot be added into the content, |
| [761](#L761) | \* re-create the content for the builder, and add it alongside the |
| [762](#L762) | \* final generated content. When the editor starts, the rendered content |
| [763](#L763) | \* gets hidden, then the original content gets shown for editing. |
| [764](#L764) | \* |
| [765](#L765) | \* @since 4.3 |
| [766](#L766) | \* |
| [767](#L767) | \* @param string $content The post content. |
| [768](#L768) | \* |
| [769](#L769) | \* @return string The modified content. |
| [770](#L770) | \*/ |
| [771](#L771) | public function add\_builder\_wrapper\_fallback( $content ) { |
| [772](#L772) | if ( ! self::is\_editable\_by\_user() ) { |
| [773](#L773) | return $content; |
| [774](#L774) | } |
| [775](#L775) |  |
| [776](#L776) | // Make sure that the wrapper is only added once. |
| [777](#L777) | if ( $this->added\_builder\_wrapper\_fallback\_once ) { |
| [778](#L778) | return $content; |
| [779](#L779) | } |
| [780](#L780) |  |
| [781](#L781) | // Only do this fallback when there's no main wrapper applied. |
| [782](#L782) | if ( preg\_match( '/<div[^>]+data-editable[^>]+pbs-main-wrapper/', $content ) ) { |
| [783](#L783) | return $content; |
| [784](#L784) | } |
| [785](#L785) |  |
| [786](#L786) | $this->added\_builder\_wrapper\_fallback\_once = true; |
| [787](#L787) |  |
| [788](#L788) | // Get the actual content, and then run the default filters to render it. |
| [789](#L789) | $orig\_content = get\_the\_content( null, false ); |
| [790](#L790) |  |
| [791](#L791) | // Run the default the\_content filters on our raw content. |
| [792](#L792) | add\_filter( 'pbs\_run\_content\_filters', 'wptexturize' ); |
| [793](#L793) | add\_filter( 'pbs\_run\_content\_filters', 'convert\_smilies', 20 ); |
| [794](#L794) | add\_filter( 'pbs\_run\_content\_filters', 'wpautop' ); |
| [795](#L795) | add\_filter( 'pbs\_run\_content\_filters', 'shortcode\_unautop' ); |
| [796](#L796) | add\_filter( 'pbs\_run\_content\_filters', 'prepend\_attachment' ); |
| [797](#L797) | add\_filter( 'pbs\_run\_content\_filters', 'wp\_make\_content\_images\_responsive' ); |
| [798](#L798) | add\_filter( 'pbs\_run\_content\_filters', 'do\_shortcode', 11 ); |
| [799](#L799) |  |
| [800](#L800) | if ( $GLOBALS['wp\_embed'] ) { |
| [801](#L801) | add\_filter( 'pbs\_run\_content\_filters', array( $GLOBALS['wp\_embed'], 'run\_shortcode' ), 8 ); |
| [802](#L802) | add\_filter( 'pbs\_run\_content\_filters', array( $GLOBALS['wp\_embed'], 'autoembed' ), 8 ); |
| [803](#L803) | } |
| [804](#L804) |  |
| [805](#L805) | add\_filter( 'pbs\_run\_content\_filters', array( $this, 'escape\_pretext\_shortcodes' ), 0 ); |
| [806](#L806) | add\_filter( 'pbs\_run\_content\_filters', array( $this, 'add\_shortcode\_markers' ), 0 ); |
| [807](#L807) | add\_filter( 'pbs\_run\_content\_filters', array( $this, 'add\_oembed\_markers' ), 0 ); |
| [808](#L808) | add\_filter( 'pbs\_run\_content\_filters', array( $this, 'add\_iframe\_markers' ), 0 ); |
| [809](#L809) |  |
| [810](#L810) | $orig\_content = apply\_filters( 'pbs\_run\_content\_filters', $orig\_content ); |
| [811](#L811) |  |
| [812](#L812) | // Add the wrapper to detect the content area for the builder. |
| [813](#L813) | $this->added\_builder\_wrapper\_once = false; |
| [814](#L814) | $orig\_content = $this->add\_builder\_wrapper( $orig\_content ); |
| [815](#L815) |  |
| [816](#L816) | // This is performed by the\_content, so do it also. |
| [817](#L817) | $orig\_content = str\_replace( ']]>', ']]&gt;', $orig\_content ); |
| [818](#L818) |  |
| [819](#L819) | // Fallback to adding the editor after the content then switching it |
| [820](#L820) | // when about to edit. |
| [821](#L821) | $content = '<div class="pbs-orig-page-content">' . $content . '</div>' . $orig\_content; |
| [822](#L822) |  |
| [823](#L823) | return apply\_filters( 'pbs\_add\_builder\_wrapper', $content ); |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) |  |
| [827](#L827) | /\*\* |
| [828](#L828) | \* Wraps the whole content in a wrapper that PBS will use for editing. |
| [829](#L829) | \* |
| [830](#L830) | \* @since 2.0 |
| [831](#L831) | \* |
| [832](#L832) | \* @param string $content The post content. |
| [833](#L833) | \* |
| [834](#L834) | \* @return string The wrapped content. |
| [835](#L835) | \*/ |
| [836](#L836) | public function add\_builder\_wrapper( $content ) { |
| [837](#L837) |  |
| [838](#L838) | $content = apply\_filters( 'pbs\_add\_builder\_wrapper\_pre', $content ); |
| [839](#L839) |  |
| [840](#L840) | if ( ! self::is\_editable\_by\_user() ) { |
| [841](#L841) | $content = '<div class="pbs-main-wrapper">' . $content . '</div>'; |
| [842](#L842) | } else { |
| [843](#L843) | $content = '<div data-editable data-name="main-content" class="pbs-main-wrapper">' . $content . '</div>'; |
| [844](#L844) | } |
| [845](#L845) | return apply\_filters( 'pbs\_add\_builder\_wrapper', $content ); |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) |  |
| [849](#L849) | /\*\* |
| [850](#L850) | \* Remove shortcode wrappers so we have the normal looking (bracketted) |
| [851](#L851) | \* shortcodes in our content when saving. |
| [852](#L852) | \* |
| [853](#L853) | \* @since 2.7 |
| [854](#L854) | \* |
| [855](#L855) | \* @param string $content The current post content. |
| [856](#L856) | \* |
| [857](#L857) | \* @return string The modified content. |
| [858](#L858) | \*/ |
| [859](#L859) | public function remove\_shortcode\_markers( $content ) { |
| [860](#L860) | if ( ! class\_exists( 'simple\_html\_dom' ) ) { |
| [861](#L861) | require\_once( 'page\_builder\_sandwich/inc/simple\_html\_dom.php' ); |
| [862](#L862) | } |
| [863](#L863) |  |
| [864](#L864) | // Remove all data-shortcode and replace it with the decoded shortcode. Do this from last to first to preserve nesting. |
| [865](#L865) | $html = new simple\_html\_dom(); |
| [866](#L866) | $html->load( $content, true, false ); |
| [867](#L867) |  |
| [868](#L868) | $shortcodes = $html->find( '[data-shortcode]' ); |
| [869](#L869) | for ( $i = count( $shortcodes ) - 1; $i >= 0; $i-- ) { |
| [870](#L870) | $shortcode\_container = $shortcodes[ $i ]; |
| [871](#L871) | $shortcode = base64\_decode( $shortcode\_container->{'data-shortcode'} ); |
| [872](#L872) | if ( ! defined( 'PBS\_DOING\_AUTOSAVE' ) ) { |
| [873](#L873) | $shortcode = addslashes( $shortcode ); |
| [874](#L874) | } |
| [875](#L875) | $shortcodes[ $i ]->outertext = $shortcode; |
| [876](#L876) | } |
| [877](#L877) | $content = (string) $html; |
| [878](#L878) |  |
| [879](#L879) | return apply\_filters( 'pbs\_remove\_shortcode\_markers', $content ); |
| [880](#L880) | } |
| [881](#L881) |  |
| [882](#L882) |  |
| [883](#L883) | /\*\* |
| [884](#L884) | \* If the post has a pbs\_style meta data, it means that pseudo styles are needed |
| [885](#L885) | \* by the post, add the styles to the output. |
| [886](#L886) | \* |
| [887](#L887) | \* @since 2.9 |
| [888](#L888) | \* |
| [889](#L889) | \* @param string $content The html content. |
| [890](#L890) | \* |
| [891](#L891) | \* @return string The cleaned html content. |
| [892](#L892) | \*/ |
| [893](#L893) | public function add\_spec\_style\_tag( $content ) { |
| [894](#L894) | global $post; |
| [895](#L895) | if ( ! $post ) { |
| [896](#L896) | return $content; |
| [897](#L897) | } |
| [898](#L898) | if ( get\_post\_meta( $post->ID, 'pbs\_style', true ) ) { |
| [899](#L899) | $style = get\_post\_meta( $post->ID, 'pbs\_style', true ); |
| [900](#L900) | $style = wp\_strip\_all\_tags( $style ); |
| [901](#L901) |  |
| [902](#L902) | // Compatibility with an error in 4.4.2 |
| [903](#L903) | $style = preg\_replace( '/undefined/', '', $style ); |
| [904](#L904) |  |
| [905](#L905) | $content = '<style id="pbs-style">' . $style . '</style>' . $content; |
| [906](#L906) | } |
| [907](#L907) | return apply\_filters( 'pbs\_add\_spec\_style\_tag', $content ); |
| [908](#L908) | } |
| [909](#L909) |  |
| [910](#L910) |  |
| [911](#L911) | /\*\* |
| [912](#L912) | \* Cleans up the content before saving. This is similar to the REVERSE wpautop |
| [913](#L913) | \* applied by TinyMCE via Javascript. This makes sure that we do not get stray |
| [914](#L914) | \* paragraph tags saved/rendered that mess up the output. |
| [915](#L915) | \* |
| [916](#L916) | \* We're mimicking the behavior seen when clicking 'Visual' then 'Text' in |
| [917](#L917) | \* TinyMCE, then hitting save. The process that cleans up the html during the transition |
| [918](#L918) | \* is what we want to achieve. |
| [919](#L919) | \* |
| [920](#L920) | \* @param string $content The html content. |
| [921](#L921) | \* |
| [922](#L922) | \* @return string The cleaned html content. |
| [923](#L923) | \*/ |
| [924](#L924) | public function cleanup\_content( $content ) { |
| [925](#L925) |  |
| [926](#L926) | // Remove line breaks, except for those inside preformatted tags. |
| [927](#L927) | $content = preg\_replace( '/[\r\n](?![^<]\*<\/pre>)/', ' ', $content ); |
| [928](#L928) |  |
| [929](#L929) | // Separate divs into their own lines. |
| [930](#L930) | $content = preg\_replace( '/(<\/?div[^>]\*>)[\s]+/', "$1\n", $content ); |
| [931](#L931) |  |
| [932](#L932) | // Replace simple p tags with \n\n. |
| [933](#L933) | $content = preg\_replace( '/\s\*<p>\s\*(.\*?)\s\*<\/p>\s\*/', "\n\n$1\n\n", $content ); |
| [934](#L934) |  |
| [935](#L935) | // Cleanup remaining p tags, remove the start and end spaces. |
| [936](#L936) | $content = preg\_replace( '/(<p[^>]\*>)\s\*(.\*?)\s\*(<\/p>)/', '$1$2$3', $content ); |
| [937](#L937) |  |
| [938](#L938) | // Cleanup remaining p tags, remove the trailing spaces. |
| [939](#L939) | $content = preg\_replace( '/(<\/p>)\s\*(<\/\w+>)/', "$1\n\n$2", $content ); |
| [940](#L940) |  |
| [941](#L941) | // Multiple p tags can convert to multiple \n's, just keep to 2 \ns. |
| [942](#L942) | $content = preg\_replace( '/\n\n{2,}/', "\n\n", $content ); |
| [943](#L943) |  |
| [944](#L944) | // Noscripts can sometimes appear because of some plugins, this messes up the content. |
| [945](#L945) | $content = preg\_replace( '/<noscript[^>]\*>.\*?<\/noscript>/', '', $content ); |
| [946](#L946) |  |
| [947](#L947) | return apply\_filters( 'pbs\_cleanup\_content', $content ); |
| [948](#L948) | } |
| [949](#L949) |  |
| [950](#L950) |  |
| [951](#L951) | /\*\* |
| [952](#L952) | \* Ajax save content handler. |
| [953](#L953) | \* |
| [954](#L954) | \* @since 2.0 |
| [955](#L955) | \* |
| [956](#L956) | \* @return void |
| [957](#L957) | \*/ |
| [958](#L958) | public function save\_content() { |
| [959](#L959) |  |
| [960](#L960) | // Check if we have the necessary fields. |
| [961](#L961) | if ( empty( $\_POST['post\_id'] ) ||  // Input var: okay. |
| [962](#L962) | ( ! isset( $\_POST['title'] ) && empty( $\_POST['post\_status'] ) && ! isset( $\_POST['main-content'] ) ) ||  // Input var: okay. |
| [963](#L963) | empty( $\_POST['save\_nonce'] ) ) { // Input var: okay. |
| [964](#L964) | die(); |
| [965](#L965) | } |
| [966](#L966) |  |
| [967](#L967) | // Security check. |
| [968](#L968) | if ( ! wp\_verify\_nonce( sanitize\_key( $\_POST['save\_nonce'] ), 'pbs' ) ) { // Input var: okay. |
| [969](#L969) | die(); |
| [970](#L970) | } |
| [971](#L971) |  |
| [972](#L972) | // Sanitize data. |
| [973](#L973) | $post\_id = intval( $\_POST['post\_id'] ); // Input var: okay. |
| [974](#L974) |  |
| [975](#L975) | $post\_data = array( |
| [976](#L976) | 'ID' => $post\_id, |
| [977](#L977) | ); |
| [978](#L978) |  |
| [979](#L979) | // Check if we just need to update the status. |
| [980](#L980) | if ( ! empty( $\_POST['post\_status'] ) ) { // Input var: okay. |
| [981](#L981) | $post\_data['post\_status'] = sanitize\_text\_field( wp\_unslash( $\_POST['post\_status'] ) ); // Input var: okay. |
| [982](#L982) | } |
| [983](#L983) |  |
| [984](#L984) | do\_action( 'pbs\_pre\_save\_content' ); |
| [985](#L985) |  |
| [986](#L986) | // The new content. |
| [987](#L987) | if ( isset( $\_POST['main-content'] ) ) { // Input var: okay. |
| [988](#L988) | $content = sanitize\_post\_field( 'post\_content', wp\_unslash( $\_POST['main-content'] ), $post\_id, 'db' ); // Input var: okay. WPCS: sanitization ok. |
| [989](#L989) | $content = apply\_filters( 'pbs\_save\_content', $content, $post\_id ); |
| [990](#L990) |  |
| [991](#L991) | $post\_data['post\_content'] = $content; |
| [992](#L992) | $post\_data['post\_content\_filtered'] = ''; // Blank this field to clear cached copies of the content. This is to also support Jetpack's Markdown module. |
| [993](#L993) | } |
| [994](#L994) |  |
| [995](#L995) | $post\_data = apply\_filters( 'pbs\_save\_content\_data', $post\_data, $\_POST, $post\_id ); // Input var: okay. |
| [996](#L996) |  |
| [997](#L997) | // Update the post. |
| [998](#L998) | $post\_id = wp\_update\_post( $post\_data ); |
| [999](#L999) |  |
| [1000](#L1000) | if ( ! empty( $\_POST['style'] ) ) { // Input var: okay. |
| [1001](#L1001) | $style = sanitize\_post\_field( 'post\_content', wp\_unslash( $\_POST['style'] ), $post\_id, 'db' ); // Input var: okay. WPCS: sanitization ok. |
| [1002](#L1002) | $style = wp\_strip\_all\_tags( $style ); |
| [1003](#L1003) | $style = apply\_filters( 'pbs\_save\_style', $style, $post\_id ); |
| [1004](#L1004) | update\_post\_meta( $post\_id, 'pbs\_style', $style ); |
| [1005](#L1005) | } else { |
| [1006](#L1006) | delete\_post\_meta( $post\_id, 'pbs\_style' ); |
| [1007](#L1007) | } |
| [1008](#L1008) |  |
| [1009](#L1009) | do\_action( 'pbs\_saved\_content', $post\_id ); |
| [1010](#L1010) |  |
| [1011](#L1011) | die( esc\_url( get\_permalink( $post\_id ) ) ); |
| [1012](#L1012) | } |
| [1013](#L1013) |  |
| [1014](#L1014) |  |
| [1015](#L1015) | /\*\* |
| [1016](#L1016) | \* Includes admin scripts and styles needed. |
| [1017](#L1017) | \* |
| [1018](#L1018) | \* @since       1.0 |
| [1019](#L1019) | \* |
| [1020](#L1020) | \* @return      void |
| [1021](#L1021) | \*/ |
| [1022](#L1022) | public function enqueue\_admin\_scripts() { |
| [1023](#L1023) |  |
| [1024](#L1024) | // Admin styles. |
| [1025](#L1025) | wp\_enqueue\_style( \_\_CLASS\_\_ . '-admin', plugins\_url( 'page\_builder\_sandwich/css/admin.min.css', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1026](#L1026) |  |
| [1027](#L1027) | $js\_dir = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? 'dev' : 'min'; |
| [1028](#L1028) | $js\_suffix = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? '' : '-min'; |
| [1029](#L1029) |  |
| [1030](#L1030) | global $pbs\_fs; |
| [1031](#L1031) | $localize\_params = array( |
| [1032](#L1032) | 'is\_lite' => PBS\_IS\_LITE || ! $pbs\_fs->can\_use\_premium\_code(), |
| [1033](#L1033) | 'nonce' => wp\_create\_nonce( 'pbs' ), |
| [1034](#L1034) | 'ajax\_url' => admin\_url( 'admin-ajax.php' ), |
| [1035](#L1035) | ); |
| [1036](#L1036) | $localize\_params = apply\_filters( 'pbs\_localize\_admin\_scripts', $localize\_params ); |
| [1037](#L1037) |  |
| [1038](#L1038) | // Admin javascript. |
| [1039](#L1039) | wp\_enqueue\_script( \_\_CLASS\_\_ . '-admin', plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/admin' . $js\_suffix . '.js', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1040](#L1040) | wp\_localize\_script( \_\_CLASS\_\_ . '-admin', 'pbsParams', $localize\_params ); |
| [1041](#L1041) | } |
| [1042](#L1042) |  |
| [1043](#L1043) |  |
| [1044](#L1044) | /\*\* |
| [1045](#L1045) | \* Make the TinyMCE editor content look pretty. |
| [1046](#L1046) | \* |
| [1047](#L1047) | \* @since 1.0 |
| [1048](#L1048) | \* |
| [1049](#L1049) | \* @return void |
| [1050](#L1050) | \*/ |
| [1051](#L1051) | public function add\_editor\_styles() { |
| [1052](#L1052) | add\_editor\_style( plugins\_url( 'page\_builder\_sandwich/css/style.min.css', \_\_FILE\_\_ ) ); |
| [1053](#L1053) | } |
| [1054](#L1054) |  |
| [1055](#L1055) |  |
| [1056](#L1056) | /\*\* |
| [1057](#L1057) | \* Includes frontend scripts needed for non-editors. |
| [1058](#L1058) | \* |
| [1059](#L1059) | \* @since 2.7 |
| [1060](#L1060) | \* |
| [1061](#L1061) | \* @return void |
| [1062](#L1062) | \*/ |
| [1063](#L1063) | public function enqueue\_frontend() { |
| [1064](#L1064) | $js\_dir = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? 'dev' : 'min'; |
| [1065](#L1065) | $js\_suffix = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? '' : '-min'; |
| [1066](#L1066) |  |
| [1067](#L1067) | wp\_enqueue\_style( \_\_CLASS\_\_ , plugins\_url( 'page\_builder\_sandwich/css/style.min.css', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1068](#L1068) |  |
| [1069](#L1069) | wp\_enqueue\_script( \_\_CLASS\_\_, plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/frontend' . $js\_suffix . '.js', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1070](#L1070) |  |
| [1071](#L1071) | $localize\_params = array( |
| [1072](#L1072) | 'theme\_name' => str\_replace( ' ', '-', strtolower( wp\_get\_theme()->Name ) ), |
| [1073](#L1073) | ); |
| [1074](#L1074) | $localize\_params = apply\_filters( 'pbs\_localize\_frontend\_scripts', $localize\_params ); |
| [1075](#L1075) | wp\_localize\_script( \_\_CLASS\_\_, 'pbsFrontendParams', $localize\_params ); |
| [1076](#L1076) | } |
| [1077](#L1077) |  |
| [1078](#L1078) |  |
| [1079](#L1079) | /\*\* |
| [1080](#L1080) | \* Includes frontend scripts needed for editors. |
| [1081](#L1081) | \* |
| [1082](#L1082) | \* @since 1.0 |
| [1083](#L1083) | \* |
| [1084](#L1084) | \* @return void |
| [1085](#L1085) | \*/ |
| [1086](#L1086) | public function enqueue\_editor() { |
| [1087](#L1087) |  |
| [1088](#L1088) | $js\_dir = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? 'dev' : 'min'; |
| [1089](#L1089) | $js\_suffix = defined( 'WP\_DEBUG' ) && WP\_DEBUG ? '' : '-min'; |
| [1090](#L1090) |  |
| [1091](#L1091) | if ( isset( $\_GET['pbsdebug'] ) ) { // Input var okay. |
| [1092](#L1092) | $js\_dir = 'dev'; |
| [1093](#L1093) | $js\_suffix = ''; |
| [1094](#L1094) | } |
| [1095](#L1095) |  |
| [1096](#L1096) | if ( ! self::is\_editable\_by\_user() ) { |
| [1097](#L1097) | return; |
| [1098](#L1098) | } |
| [1099](#L1099) |  |
| [1100](#L1100) | // Load WP Template. |
| [1101](#L1101) | wp\_enqueue\_script( 'wp-util' ); |
| [1102](#L1102) |  |
| [1103](#L1103) | // Used for inspector views and templating. |
| [1104](#L1104) | wp\_enqueue\_script( 'backbone' ); |
| [1105](#L1105) |  |
| [1106](#L1106) | // Used for the media manager modal. |
| [1107](#L1107) | wp\_enqueue\_script( 'media-editor' ); |
| [1108](#L1108) |  |
| [1109](#L1109) | // Requirements for the image editor (replace, edit & crop). |
| [1110](#L1110) | wp\_enqueue\_script( 'image-edit', admin\_url( '/js/image-edit.js' ) ); |
| [1111](#L1111) | wp\_enqueue\_script( 'imgareaselect' ); |
| [1112](#L1112) | wp\_enqueue\_style( 'imgareaselect' ); |
| [1113](#L1113) | wp\_enqueue\_style( 'media' ); |
| [1114](#L1114) | wp\_enqueue\_script( 'media' ); |
| [1115](#L1115) |  |
| [1116](#L1116) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [1117](#L1117) | wp\_enqueue\_script( 'jquery-ui-core' ); |
| [1118](#L1118) | wp\_enqueue\_script( 'jquery-ui-slider' ); |
| [1119](#L1119) |  |
| [1120](#L1120) | // Link dialog modal. |
| [1121](#L1121) | wp\_enqueue\_style( 'editor-buttons' ); |
| [1122](#L1122) | wp\_enqueue\_script( 'wplink' ); |
| [1123](#L1123) |  |
| [1124](#L1124) | do\_action( 'pbs\_enqueue\_scripts' ); |
| [1125](#L1125) |  |
| [1126](#L1126) | // Load WP's color picker. |
| [1127](#L1127) | wp\_enqueue\_style( 'wp-color-picker' ); |
| [1128](#L1128) | wp\_enqueue\_script( 'iris', admin\_url( 'js/iris.min.js' ), array( 'jquery-ui-draggable', 'jquery-ui-slider', 'jquery-touch-punch' ), false, 1 ); |
| [1129](#L1129) |  |
| [1130](#L1130) | // Various icons used in PBS. |
| [1131](#L1131) | wp\_enqueue\_style( 'dashicons' ); |
| [1132](#L1132) | wp\_enqueue\_style( 'genericons', plugins\_url( 'page\_builder\_sandwich/css/inc/genericons/genericons.min.css', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1133](#L1133) | wp\_enqueue\_media(); |
| [1134](#L1134) |  |
| [1135](#L1135) | // wp.hooks is now supported in WP 5.0 |
| [1136](#L1136) | if ( ! function\_exists( 'register\_block\_type' ) ) { |
| [1137](#L1137) | wp\_enqueue\_script( 'event-manager', plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/inc/event-manager/event-manager' . $js\_suffix . '.js', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1138](#L1138) | } |
| [1139](#L1139) |  |
| [1140](#L1140) | // Content Tools. |
| [1141](#L1141) | wp\_enqueue\_style( 'content-tools', plugins\_url( 'page\_builder\_sandwich/css/inc/content-tools/content-tools.min.css', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1142](#L1142) | wp\_enqueue\_script( 'content-tools', plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/inc/content-tools/content-tools' . $js\_suffix . '.js', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1143](#L1143) |  |
| [1144](#L1144) | $deps = array( 'content-tools', 'backbone', 'wp-util', 'media-editor', 'iris' ); |
| [1145](#L1145) | if ( function\_exists( 'register\_block\_type' ) ) { |
| [1146](#L1146) | $deps[] = 'wp-hooks'; |
| [1147](#L1147) | } |
| [1148](#L1148) |  |
| [1149](#L1149) | // Main PBS editor script. |
| [1150](#L1150) | wp\_enqueue\_style( \_\_CLASS\_\_ . '-builder' , plugins\_url( 'page\_builder\_sandwich/css/editor.min.css', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1151](#L1151) | wp\_enqueue\_script( \_\_CLASS\_\_ . '-builder', plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/script' . $js\_suffix . '.js', \_\_FILE\_\_ ), $deps, VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1152](#L1152) |  |
| [1153](#L1153) | // Display error notices with PBS. |
| [1154](#L1154) | wp\_enqueue\_script( \_\_CLASS\_\_ . '-error-notice', plugins\_url( 'page\_builder\_sandwich/js/' . $js\_dir . '/script-error-notice' . $js\_suffix . '.js', \_\_FILE\_\_ ), array(), VERSION\_PAGE\_BUILDER\_SANDWICH ); |
| [1155](#L1155) |  |
| [1156](#L1156) | $error\_notice\_params = array(); |
| [1157](#L1157) | $error\_notice\_params = apply\_filters( 'pbs\_error\_notice\_localize\_scripts', $error\_notice\_params ); |
| [1158](#L1158) |  |
| [1159](#L1159) | wp\_localize\_script( \_\_CLASS\_\_ . '-error-notice', 'errorNoticeParams', $error\_notice\_params ); |
| [1160](#L1160) |  |
| [1161](#L1161) | // We need a dummy image ID for the images in pre-designed sections, |
| [1162](#L1162) | // This is so that the replace/edit buttons appear in the media manager. |
| [1163](#L1163) | $query = new WP\_Query( array( |
| [1164](#L1164) | 'post\_status' => 'any', |
| [1165](#L1165) | 'post\_type' => 'attachment', |
| [1166](#L1166) | 'posts\_per\_page' => 1, |
| [1167](#L1167) | ) ); |
| [1168](#L1168) | $dummy\_image\_id = 0; |
| [1169](#L1169) | if ( $query->have\_posts() ) { |
| [1170](#L1170) | $query->the\_post(); |
| [1171](#L1171) | $dummy\_image\_id = get\_the\_ID(); |
| [1172](#L1172) | } |
| [1173](#L1173) | wp\_reset\_postdata(); |
| [1174](#L1174) |  |
| [1175](#L1175) | // Take note of our post ID, we'll use this to check in various |
| [1176](#L1176) | // places if we are using items from our main post. |
| [1177](#L1177) | self::$main\_post\_id = $GLOBALS['post']->ID; |
| [1178](#L1178) |  |
| [1179](#L1179) | global $pbs\_fs; |
| [1180](#L1180) | $localize\_params = array( |
| [1181](#L1181) | 'is\_lite' => PBS\_IS\_LITE || ! $pbs\_fs->can\_use\_premium\_code(), |
| [1182](#L1182) | 'is\_rtl' => is\_rtl(), |
| [1183](#L1183) | 'ajax\_url' => admin\_url( 'admin-ajax.php' ), |
| [1184](#L1184) | 'admin\_url' => admin\_url( '/' ), |
| [1185](#L1185) | 'post\_id' => $GLOBALS['post']->ID, |
| [1186](#L1186) | 'theme' => wp\_get\_theme()->Name, |
| [1187](#L1187) | 'stylesheet\_directory\_uri' => trailingslashit( get\_stylesheet\_directory\_uri() ), |
| [1188](#L1188) | 'nonce' => wp\_create\_nonce( 'pbs' ), |
| [1189](#L1189) | 'shortcodes' => self::get\_all\_shortcodes(), |
| [1190](#L1190) | 'shortcodes\_to\_hide' => apply\_filters( 'pbs\_shortcodes\_to\_hide\_in\_picker', array() ), |
| [1191](#L1191) | 'default\_icon' => plugins\_url( 'page\_builder\_sandwich/images/shortcode-icon.png', \_\_FILE\_\_ ), |
| [1192](#L1192) | 'additional\_shortcodes' => apply\_filters( 'pbs\_shortcodes', array() ), |
| [1193](#L1193) | 'is\_admin\_bar\_showing' => is\_admin\_bar\_showing(), |
| [1194](#L1194) | 'plugin\_url' => trailingslashit( plugins\_url( '/', \_\_FILE\_\_ ) ), |
| [1195](#L1195) | 'post\_status' => ! empty( $GLOBALS['post']->ID ) ? get\_post\_status( $GLOBALS['post']->ID ) : '', |
| [1196](#L1196) | 'dummy\_image\_id' => $dummy\_image\_id, |
| [1197](#L1197) | 'buy\_url' => admin\_url( '/admin.php?page=page-builder-sandwich-pricing' ), |
| [1198](#L1198) | 'site\_url' => get\_site\_url(), |
| [1199](#L1199) | 'is\_preview' => is\_preview(), |
| [1200](#L1200) | ); |
| [1201](#L1201) | $localize\_params = apply\_filters( 'pbs\_localize\_scripts', $localize\_params ); |
| [1202](#L1202) |  |
| [1203](#L1203) | wp\_localize\_script( \_\_CLASS\_\_ . '-builder', 'pbsParams', $localize\_params ); |
| [1204](#L1204) |  |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) |  |
| [1208](#L1208) | /\*\* |
| [1209](#L1209) | \* Get all ContentTool/ContentEdit tags/elements used in the content, then run |
| [1210](#L1210) | \* filters to enqueue the scripts needed by those used tags/elements. |
| [1211](#L1211) | \* |
| [1212](#L1212) | \* @since 2.7 |
| [1213](#L1213) | \* |
| [1214](#L1214) | \* @param string $content The post content. |
| [1215](#L1215) | \* |
| [1216](#L1216) | \* @return string The original post content. |
| [1217](#L1217) | \*/ |
| [1218](#L1218) | public function gather\_ce\_tags( $content ) { |
| [1219](#L1219) |  |
| [1220](#L1220) | preg\_match\_all( '/data\-ce\-tag=[\'"]([^\'"]+)[\'"]/', $content, $data\_tags, PREG\_PATTERN\_ORDER ); |
| [1221](#L1221) |  |
| [1222](#L1222) | if ( empty( $data\_tags[1] ) ) { |
| [1223](#L1223) | return $content; |
| [1224](#L1224) | } |
| [1225](#L1225) |  |
| [1226](#L1226) | $tags = array\_unique( $data\_tags[1] ); |
| [1227](#L1227) | foreach ( $tags as $tag ) { |
| [1228](#L1228) | $tag = strtolower( $tag ); |
| [1229](#L1229) | do\_action( "pbs\_enqueue\_element\_scripts\_{$tag}", $tag ); |
| [1230](#L1230) | } |
| [1231](#L1231) |  |
| [1232](#L1232) | return $content; |
| [1233](#L1233) | } |
| [1234](#L1234) |  |
| [1235](#L1235) |  |
| [1236](#L1236) | /\*\* |
| [1237](#L1237) | \* Gets all available shortcodes in the site. |
| [1238](#L1238) | \* |
| [1239](#L1239) | \* @since 2.0 |
| [1240](#L1240) | \* |
| [1241](#L1241) | \* @return array The array of available shortcodes. |
| [1242](#L1242) | \*/ |
| [1243](#L1243) | public static function get\_all\_shortcodes() { |
| [1244](#L1244) | $shortcodes = array(); |
| [1245](#L1245) | $ignored\_functions = array( |
| [1246](#L1246) | '\_\_return\_false', |
| [1247](#L1247) | '\_\_return\_null', |
| [1248](#L1248) | ); |
| [1249](#L1249) |  |
| [1250](#L1250) | global $shortcode\_tags; |
| [1251](#L1251) | if ( is\_array( $shortcode\_tags ) ) { |
| [1252](#L1252) | foreach ( $shortcode\_tags as $base => $function ) { |
| [1253](#L1253) | if ( in\_array( $function, $ignored\_functions, true ) ) { |
| [1254](#L1254) | continue; |
| [1255](#L1255) | } |
| [1256](#L1256) | if ( in\_array( $base, $shortcodes, true ) ) { |
| [1257](#L1257) | continue; |
| [1258](#L1258) | } |
| [1259](#L1259) | $shortcodes[] = $base; |
| [1260](#L1260) | } |
| [1261](#L1261) | } |
| [1262](#L1262) |  |
| [1263](#L1263) | /\*\* |
| [1264](#L1264) | \* The embed shortcode isn't included by default in the list |
| [1265](#L1265) | \* UNLESS you have an embed shortcode already in there, |
| [1266](#L1266) | \* add it into the list. |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | if ( array\_search( 'embed', $shortcodes ) === false ) { |
| [1269](#L1269) | if ( ! empty( $GLOBALS['wp\_embed'] ) ) { |
| [1270](#L1270) | $shortcodes[] = 'embed'; |
| [1271](#L1271) | add\_shortcode( 'embed', array( $GLOBALS['wp\_embed'], 'shortcode' ) ); |
| [1272](#L1272) | } |
| [1273](#L1273) | } |
| [1274](#L1274) |  |
| [1275](#L1275) | return apply\_filters( 'pbs\_get\_all\_shortcodes', $shortcodes ); |
| [1276](#L1276) | } |
| [1277](#L1277) |  |
| [1278](#L1278) |  |
| [1279](#L1279) | /\*\* |
| [1280](#L1280) | \* Add the empty placeholder text via CSS styles. |
| [1281](#L1281) | \* |
| [1282](#L1282) | \* @since 4.3 |
| [1283](#L1283) | \*/ |
| [1284](#L1284) | public function add\_empty\_text\_placeholder() { |
| [1285](#L1285) | if ( ! self::is\_editable\_by\_user() ) { |
| [1286](#L1286) | return; |
| [1287](#L1287) | } |
| [1288](#L1288) | ?> |
| [1289](#L1289) | <style> |
| [1290](#L1290) | .ce-element--empty.ce-element--type-text:before { |
| [1291](#L1291) | content: '<?php esc\_attr\_e( 'Click here to add text', 'page-builder-sandwich' ) ?>'; |
| [1292](#L1292) | } |
| [1293](#L1293) | </style> |
| [1294](#L1294) | <?php |
| [1295](#L1295) | } |
| [1296](#L1296) | } |
| [1297](#L1297) |  |
| [1298](#L1298) | PageBuilderSandwich::instance(); |
| [1299](#L1299) |  |
| [1300](#L1300) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php?format=txt)
* [Original Format](/export/3220785/page-builder-sandwich/tags/5.1.0/class-page-builder-sandwich.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


