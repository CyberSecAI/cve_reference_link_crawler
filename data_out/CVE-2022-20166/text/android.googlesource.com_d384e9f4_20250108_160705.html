
Commit Information:
------------------
Author: Joe Perches  1600288839 -0700
Date: Greg Kroah-Hartman  1642320227 +0000
Bug ID: Bug: 182388481
Commit Message:
--------------
UPSTREAM: drivers core: Use sysfs\_emit and sysfs\_emit\_at for show(device \*...) functionscommit aa838896d87af561a33ecefea1caa4c15a68bc47 upstream.Convert the various sprintf fmaily calls in sysfs device show functionsto sysfs\_emit and sysfs\_emit\_at for PAGE\_SIZE buffer safety.Done with:$ spatch -sp-file sysfs\_emit\_dev.cocci --in-place --max-width=80 .And cocci script:$ cat sysfs\_emit\_dev.cocci@@identifier d\_show;identifier dev, attr, buf;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... return- sprintf(buf,+ sysfs\_emit(buf, ...); ...>}@@identifier d\_show;identifier dev, attr, buf;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... return- snprintf(buf, PAGE\_SIZE,+ sysfs\_emit(buf, ...); ...>}@@identifier d\_show;identifier dev, attr, buf;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... return- scnprintf(buf, PAGE\_SIZE,+ sysfs\_emit(buf, ...); ...>}@@identifier d\_show;identifier dev, attr, buf;expression chr;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... return- strcpy(buf, chr);+ sysfs\_emit(buf, chr); ...>}@@identifier d\_show;identifier dev, attr, buf;identifier len;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... len =- sprintf(buf,+ sysfs\_emit(buf, ...); ...> return len;}@@identifier d\_show;identifier dev, attr, buf;identifier len;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... len =- snprintf(buf, PAGE\_SIZE,+ sysfs\_emit(buf, ...); ...> return len;}@@identifier d\_show;identifier dev, attr, buf;identifier len;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <... len =- scnprintf(buf, PAGE\_SIZE,+ sysfs\_emit(buf, ...); ...> return len;}@@identifier d\_show;identifier dev, attr, buf;identifier len;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ <...- len += scnprintf(buf + len, PAGE\_SIZE - len,+ len += sysfs\_emit\_at(buf, len, ...); ...> return len;}@@identifier d\_show;identifier dev, attr, buf;expression chr;@@ssize\_t d\_show(struct device \*dev, struct device\_attribute \*attr, char \*buf){ ...- strcpy(buf, chr);- return strlen(buf);+ return sysfs\_emit(buf, chr);}Signed-off-by: Joe Perches Link: https://lore.kernel.org/r/3d033c33056d88bbe34d4ddb62afd05ee166ab9a.1600285923.git.joe@perches.comCc: Lee Jones Signed-off-by: Greg Kroah-Hartman Bug: 182388481[only the wakeup\_stats.c portion - gregkh](cherry picked from commit aa838896d87af561a33ecefea1caa4c15a68bc47)Signed-off-by: Greg Kroah-Hartman Change-Id: Ib6f1e608caae694532cfef2ab43092274630fb54Signed-off-by: Greg Kroah-Hartman
