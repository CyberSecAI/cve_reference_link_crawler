=== Content from git.kernel.org_41e75c17_20250111_000225.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=111277b881def3153335acfe0d1f43e6cd83ac93)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=111277b881def3153335acfe0d1f43e6cd83ac93)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=111277b881def3153335acfe0d1f43e6cd83ac93)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=111277b881def3153335acfe0d1f43e6cd83ac93)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:23:41 +0200 |
| commit | [111277b881def3153335acfe0d1f43e6cd83ac93](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=111277b881def3153335acfe0d1f43e6cd83ac93) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=111277b881def3153335acfe0d1f43e6cd83ac93)) | |
| tree | [baaacb940bb46098012da8150ec1973012d4b932](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=111277b881def3153335acfe0d1f43e6cd83ac93) | |
| parent | [96f7322e8e9f60741d8269be603c35cba13d30d0](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=96f7322e8e9f60741d8269be603c35cba13d30d0) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=111277b881def3153335acfe0d1f43e6cd83ac93&id2=96f7322e8e9f60741d8269be603c35cba13d30d0)) | |
| download | [linux-111277b881def3153335acfe0d1f43e6cd83ac93.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-111277b881def3153335acfe0d1f43e6cd83ac93.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=111277b881def3153335acfe0d1f43e6cd83ac93)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=111277b881def3153335acfe0d1f43e6cd83ac93) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex 26eaeb7a0301b7..de9b638c207acf 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=96f7322e8e9f60741d8269be603c35cba13d30d0)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=111277b881def3153335acfe0d1f43e6cd83ac93)@@ -477,9 +477,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:02 +0000



=== Content from git.kernel.org_ab6a6e6b_20250111_000226.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:28:29 +0200 |
| commit | [7bb11a75dd4d3612378b90e2a4aa49bdccea28ab](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)) | |
| tree | [dc801235f5339d2dce390631233754fdd386792e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab) | |
| parent | [df2daed5292392588eec2006bbdb82498a12f08a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=df2daed5292392588eec2006bbdb82498a12f08a) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab&id2=df2daed5292392588eec2006bbdb82498a12f08a)) | |
| download | [linux-7bb11a75dd4d3612378b90e2a4aa49bdccea28ab.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-7bb11a75dd4d3612378b90e2a4aa49bdccea28ab.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex 5ce276cb39d0d0..21ff6cbe5e49f0 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=df2daed5292392588eec2006bbdb82498a12f08a)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=7bb11a75dd4d3612378b90e2a4aa49bdccea28ab)@@ -553,9 +553,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:04 +0000



=== Content from git.kernel.org_04861a5e_20250111_000229.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eca3f543f817da87c00d1a5697b473efb548204f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eca3f543f817da87c00d1a5697b473efb548204f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eca3f543f817da87c00d1a5697b473efb548204f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eca3f543f817da87c00d1a5697b473efb548204f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:13:09 +0200 |
| commit | [eca3f543f817da87c00d1a5697b473efb548204f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eca3f543f817da87c00d1a5697b473efb548204f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eca3f543f817da87c00d1a5697b473efb548204f)) | |
| tree | [b186a78da56267641413247a462df0030cfd5c19](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eca3f543f817da87c00d1a5697b473efb548204f) | |
| parent | [9c80a94d388528add073955108a1eeeed4c1c5ea](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9c80a94d388528add073955108a1eeeed4c1c5ea) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eca3f543f817da87c00d1a5697b473efb548204f&id2=9c80a94d388528add073955108a1eeeed4c1c5ea)) | |
| download | [linux-eca3f543f817da87c00d1a5697b473efb548204f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eca3f543f817da87c00d1a5697b473efb548204f.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eca3f543f817da87c00d1a5697b473efb548204f)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=eca3f543f817da87c00d1a5697b473efb548204f) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex b14e06ee831bc7..4002c6790be6e2 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=9c80a94d388528add073955108a1eeeed4c1c5ea)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=eca3f543f817da87c00d1a5697b473efb548204f)@@ -419,9 +419,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:06 +0000



=== Content from git.kernel.org_05c59c80_20250111_000225.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=14e497183df28c006603cc67fd3797a537eef7b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14e497183df28c006603cc67fd3797a537eef7b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14e497183df28c006603cc67fd3797a537eef7b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-22 16:14:24 +0800 |
| commit | [14e497183df28c006603cc67fd3797a537eef7b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14e497183df28c006603cc67fd3797a537eef7b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=14e497183df28c006603cc67fd3797a537eef7b9)) | |
| tree | [bb379286c1793bd01c02f3f279a19760ffae45ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14e497183df28c006603cc67fd3797a537eef7b9) | |
| parent | [6e95097b6bb20f0021180b150f41ad9962dcdcc9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e95097b6bb20f0021180b150f41ad9962dcdcc9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9&id2=6e95097b6bb20f0021180b150f41ad9962dcdcc9)) | |
| download | [linux-14e497183df28c006603cc67fd3797a537eef7b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-14e497183df28c006603cc67fd3797a537eef7b9.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accessThis commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=14e497183df28c006603cc67fd3797a537eef7b9) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex 734de2a8bd212a..ccc3895dbd7f9f 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=6e95097b6bb20f0021180b150f41ad9962dcdcc9)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=14e497183df28c006603cc67fd3797a537eef7b9)@@ -564,9 +564,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:02 +0000



=== Content from git.kernel.org_6c1ce1a1_20250111_000226.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=2189fd13c577d7881f94affc09c950a795064c4b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2189fd13c577d7881f94affc09c950a795064c4b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2189fd13c577d7881f94affc09c950a795064c4b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2189fd13c577d7881f94affc09c950a795064c4b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:25:03 +0200 |
| commit | [2189fd13c577d7881f94affc09c950a795064c4b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2189fd13c577d7881f94affc09c950a795064c4b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=2189fd13c577d7881f94affc09c950a795064c4b)) | |
| tree | [6773c9b029e7499d6d0c3392ddac96690a2634ad](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=2189fd13c577d7881f94affc09c950a795064c4b) | |
| parent | [391179f4e6c9676d81d28866abcc40ac23082ff1](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=391179f4e6c9676d81d28866abcc40ac23082ff1) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2189fd13c577d7881f94affc09c950a795064c4b&id2=391179f4e6c9676d81d28866abcc40ac23082ff1)) | |
| download | [linux-2189fd13c577d7881f94affc09c950a795064c4b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-2189fd13c577d7881f94affc09c950a795064c4b.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=2189fd13c577d7881f94affc09c950a795064c4b)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=2189fd13c577d7881f94affc09c950a795064c4b) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex 4964fa7419efab..5b761a2a87a7fc 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=391179f4e6c9676d81d28866abcc40ac23082ff1)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=2189fd13c577d7881f94affc09c950a795064c4b)@@ -553,9 +553,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:03 +0000



=== Content from git.kernel.org_7e285b87_20250111_000227.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=d2afc2bffec77316b90d530b07695e3f534df914)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d2afc2bffec77316b90d530b07695e3f534df914)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d2afc2bffec77316b90d530b07695e3f534df914)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d2afc2bffec77316b90d530b07695e3f534df914)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:15:04 +0200 |
| commit | [d2afc2bffec77316b90d530b07695e3f534df914](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=d2afc2bffec77316b90d530b07695e3f534df914) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=d2afc2bffec77316b90d530b07695e3f534df914)) | |
| tree | [26a9fc6547fdb5e2ee69c90bacb7bb26323bde78](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=d2afc2bffec77316b90d530b07695e3f534df914) | |
| parent | [1d16ac232f8eff5abe57e3157dbe4a8e0c80575d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d16ac232f8eff5abe57e3157dbe4a8e0c80575d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d2afc2bffec77316b90d530b07695e3f534df914&id2=1d16ac232f8eff5abe57e3157dbe4a8e0c80575d)) | |
| download | [linux-d2afc2bffec77316b90d530b07695e3f534df914.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-d2afc2bffec77316b90d530b07695e3f534df914.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=d2afc2bffec77316b90d530b07695e3f534df914)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=d2afc2bffec77316b90d530b07695e3f534df914) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex cbe475134b3c61..d77092d154df2a 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=1d16ac232f8eff5abe57e3157dbe4a8e0c80575d)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=d2afc2bffec77316b90d530b07695e3f534df914)@@ -438,9 +438,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:05 +0000



=== Content from git.kernel.org_197b1562_20250111_000227.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:17:47 +0200 |
| commit | [b72da4d89b97da71e056cc4d1429b2bc426a9c2f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)) | |
| tree | [954a8c53c3b918725b7a1cec480df94041939891](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f) | |
| parent | [16cc6114c981e8b5e740c016711b9e175be59fbc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=16cc6114c981e8b5e740c016711b9e175be59fbc) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f&id2=16cc6114c981e8b5e740c016711b9e175be59fbc)) | |
| download | [linux-b72da4d89b97da71e056cc4d1429b2bc426a9c2f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b72da4d89b97da71e056cc4d1429b2bc426a9c2f.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex f4497522f929e1..ee7682faa6f3ab 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=16cc6114c981e8b5e740c016711b9e175be59fbc)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=b72da4d89b97da71e056cc4d1429b2bc426a9c2f)@@ -477,9 +477,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:04 +0000



=== Content from git.kernel.org_d1d86611_20250111_000228.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-09-04 13:30:14 +0200 |
| commit | [e23f6ad8d110bf632f7471482e10b43dc174fb72](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)) | |
| tree | [15c6d58c7e35c44fff2dbd406581721b64f52660](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72) | |
| parent | [839ab67f60e46e9e9593f44652fea5ec7a7cec6b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=839ab67f60e46e9e9593f44652fea5ec7a7cec6b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72&id2=839ab67f60e46e9e9593f44652fea5ec7a7cec6b)) | |
| download | [linux-e23f6ad8d110bf632f7471482e10b43dc174fb72.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e23f6ad8d110bf632f7471482e10b43dc174fb72.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accesscommit 14e497183df28c006603cc67fd3797a537eef7b9 upstream.
This commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=e23f6ad8d110bf632f7471482e10b43dc174fb72) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex cb82557678ddd4..31df6fdc233ef0 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=839ab67f60e46e9e9593f44652fea5ec7a7cec6b)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=e23f6ad8d110bf632f7471482e10b43dc174fb72)@@ -559,9 +559,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:05 +0000


