

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=14e497183df28c006603cc67fd3797a537eef7b9)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14e497183df28c006603cc67fd3797a537eef7b9)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14e497183df28c006603cc67fd3797a537eef7b9)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Selvarasu Ganesan <selvarasu.g@samsung.com> | 2024-08-15 12:18:31 +0530 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-22 16:14:24 +0800 |
| commit | [14e497183df28c006603cc67fd3797a537eef7b9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=14e497183df28c006603cc67fd3797a537eef7b9) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=14e497183df28c006603cc67fd3797a537eef7b9)) | |
| tree | [bb379286c1793bd01c02f3f279a19760ffae45ea](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=14e497183df28c006603cc67fd3797a537eef7b9) | |
| parent | [6e95097b6bb20f0021180b150f41ad9962dcdcc9](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6e95097b6bb20f0021180b150f41ad9962dcdcc9) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9&id2=6e95097b6bb20f0021180b150f41ad9962dcdcc9)) | |
| download | [linux-14e497183df28c006603cc67fd3797a537eef7b9.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-14e497183df28c006603cc67fd3797a537eef7b9.tar.gz) | |

usb: dwc3: core: Prevent USB core invalid event buffer address accessThis commit addresses an issue where the USB core could access an
invalid event buffer address during runtime suspend, potentially causing
SMMU faults and other memory issues in Exynos platforms. The problem
arises from the following sequence.
1. In dwc3\_gadget\_suspend, there is a chance of a timeout when
moving the USB core to the halt state after clearing the
run/stop bit by software.
2. In dwc3\_core\_exit, the event buffer is cleared regardless of
the USB core's status, which may lead to an SMMU faults and
other memory issues. if the USB core tries to access the event
buffer address.
To prevent this hardware quirk on Exynos platforms, this commit ensures
that the event buffer address is not cleared by software when the USB
core is active during runtime suspend by checking its status before
clearing the buffer address.
Cc: stable <stable@kernel.org>
Signed-off-by: Selvarasu Ganesan <selvarasu.g@samsung.com>
Acked-by: Thinh Nguyen <Thinh.Nguyen@synopsys.com>
Link: [https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g@samsung.com](https://lore.kernel.org/r/20240815064836.1491-1-selvarasu.g%40samsung.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=14e497183df28c006603cc67fd3797a537eef7b9)

| -rw-r--r-- | [drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/usb/dwc3/core.c?id=14e497183df28c006603cc67fd3797a537eef7b9) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/usb/dwc3/core.c b/drivers/usb/dwc3/core.cindex 734de2a8bd212a..ccc3895dbd7f9f 100644--- a/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=6e95097b6bb20f0021180b150f41ad9962dcdcc9)+++ b/[drivers/usb/dwc3/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/usb/dwc3/core.c?id=14e497183df28c006603cc67fd3797a537eef7b9)@@ -564,9 +564,17 @@ int dwc3\_event\_buffers\_setup(struct dwc3 \*dwc) void dwc3\_event\_buffers\_cleanup(struct dwc3 \*dwc) { struct dwc3\_event\_buffer \*evt;+ u32 reg;  if (!dwc->ev\_buf) return;+ /\*+ \* Exynos platforms may not be able to access event buffer if the+ \* controller failed to halt on dwc3\_core\_exit().+ \*/+ reg = dwc3\_readl(dwc->regs, DWC3\_DSTS);+ if (!(reg & DWC3\_DSTS\_DEVCTRLHLT))+ return;  evt = dwc->ev\_buf; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 00:01:02 +0000

