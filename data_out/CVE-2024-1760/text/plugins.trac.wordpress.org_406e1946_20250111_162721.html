

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3042890%2Fsimply-schedule-appointments%2Ftrunk%2Fincludes%2Fclass-support.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3019567/simply-schedule-appointments/trunk/includes/class-support.php "Changeset 3019567 for simply-schedule-appointments/trunk/includes/class-support.php")
* [Next Change](/changeset/3045923/simply-schedule-appointments/trunk/includes/class-support.php "Changeset 3045923 for simply-schedule-appointments/trunk/includes/class-support.php") →

---

# Changeset [3042890](/changeset/3042890 "Show full changeset") for [simply-schedule-appointments/trunk/includes/class-support.php](/browser/simply-schedule-appointments/trunk/includes/class-support.php?rev=3042890 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
02/29/2024 07:15:06 AM
([11 months](/timeline?from=2024-02-29T07%3A15%3A06Z&precision=second "See timeline at 02/29/2024 07:15:06 AM") ago)

Author:
croixhaug
Message:

Update to version 1.6.6.24 from GitHub

File:

1 edited

* [simply-schedule-appointments/trunk/includes/class-support.php](/browser/simply-schedule-appointments/trunk/includes/class-support.php?rev=3042890 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [simply-schedule-appointments/trunk/includes/class-support.php](/changeset/3042890/simply-schedule-appointments/trunk/includes/class-support.php "Show the changeset 3042890 restricted to simply-schedule-appointments/trunk/includes/class-support.php")

  | [r3019567](/browser/simply-schedule-appointments/trunk/includes/class-support.php?rev=3019567#L40 "Show revision 3019567 of this file in browser") | [r3042890](/browser/simply-schedule-appointments/trunk/includes/class-support.php?rev=3042890#L40 "Show revision 3042890 of this file in browser") |  |
  | --- | --- | --- |
  | 40 | 40 | \*/ |
  | 41 | 41 | public function hooks() { |
  | 42 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_appointment\_durations' ) );~~ |
  | 43 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_appointment\_group\_ids' ) );~~ |
  | 44 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_db\_datetime\_schema' ) );~~ |
  | 45 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_db\_availability\_schema' ) );~~ |
  | 46 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_appointment\_types' ) );~~ |
  | 47 |  | ~~add\_action( 'admin\_init', array( $this, 'fix\_missing\_appointment\_types' ) );~~ |
  | 48 |  | ~~add\_action( 'admin\_init', array( $this, 'purge\_abandoned\_appointments' ) );~~ |
  | 49 |  | ~~add\_action( 'admin\_init', array( $this, 'reset\_settings' ) );~~ |
  | 50 |  | ~~add\_action( 'admin\_init', array( $this, 'ssa\_factory\_reset' ) );~~ |
  | 51 |  | ~~add\_action( 'admin\_init', array( $this, 'rebuild\_db' ) );~~ |
  | 52 |  | ~~add\_action( 'admin\_init', array( $this, 'clear\_google\_cache' ) );~~ |
  | 53 |  | ~~add\_action( 'admin\_init', array( $this, 'set\_google\_query\_limit' ) );~~ |
  | 54 |  | ~~add\_action( 'admin\_init', array( $this, 'clear\_all\_cache' ) );~~ |
  | 55 |  | ~~add\_action( 'admin\_init', array( $this, 'populate\_cache' ) );~~ |
  | 56 |  | ~~add\_action( 'admin\_init', array( $this, 'restore\_plugin\_backup' ) );~~ |
  | 57 |  | ~~add\_action( 'admin\_init', array( $this, 'bulk\_send\_notifications' ) );~~ |
  | 58 | 42 |  |
  | 59 |  | ~~add\_action( 'admin\_init', array( $this, 'set\_display\_capacity\_available' ) );~~ |
  | 60 |  | ~~add\_action( 'admin\_init', array( $this, 'ssa\_set\_license' ) );~~ |
  | 61 |  | ~~add\_action( 'admin\_init',     array( $this, 'set\_beta\_booking\_app\_setting' ) );~~ |
  | 62 |  |  |
  | 63 |  | ~~// Temporary handlers to enable/disable GCAL quick connect feature~~ |
  | 64 |  | ~~add\_action( 'admin\_init', array( $this, 'toggle\_quick\_connect' ) );~~ |
  | 65 |  | ~~}~~ |
  | 66 |  |  |
  | 67 |  | ~~public function toggle\_quick\_connect() {~~ |
  | 68 |  | ~~if ( ! isset ( $\_GET['ssa-gcal-quick-connect'] )) {~~ |
  | 69 |  | ~~return;~~ |
  | 70 |  | ~~}~~ |
  | 71 |  |  |
  | 72 |  | ~~$new\_value = (bool) $\_GET['ssa-gcal-quick-connect'];~~ |
  | 73 |  |  |
  | 74 |  | ~~$this->plugin->developer\_settings->update(~~ |
  | 75 |  | ~~array(~~ |
  | 76 |  | ~~'quick\_connect\_gcal\_mode' => $new\_value~~ |
  | 77 |  | ~~)~~ |
  | 78 |  | ~~);~~ |
  | 79 |  |  |
  | 80 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-gcal-quick-connect' ) );~~ |
  | 81 |  | ~~exit;~~ |
  | 82 |  | ~~}~~ |
  | 83 |  |  |
  | 84 |  | ~~public function ssa\_set\_license() {~~ |
  | 85 |  | ~~if ( empty( $\_GET['ssa-set-license'] )) {~~ |
  | 86 |  | ~~return;~~ |
  | 87 |  | ~~}~~ |
  | 88 |  |  |
  | 89 |  | ~~$license\_key = sanitize\_text\_field( $\_GET['ssa-set-license'] );~~ |
  | 90 |  | ~~$this->plugin->license->activate( $license\_key );~~ |
  | 91 |  |  |
  | 92 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-set-license' ) );~~ |
  | 93 |  | ~~exit;~~ |
  | 94 |  | ~~}~~ |
  | 95 |  |  |
  | 96 |  | ~~public function populate\_cache() {~~ |
  | 97 |  | ~~if ( empty( $\_GET['ssa-populate-cache'] ) ) {~~ |
  | 98 |  | ~~return;~~ |
  | 99 |  | ~~}~~ |
  | 100 |  |  |
  | 101 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 102 |  | ~~return;~~ |
  | 103 |  | ~~}~~ |
  | 104 |  |  |
  | 105 |  | ~~$this->plugin->availability\_cache->populate\_cache();~~ |
  | 106 |  |  |
  | 107 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-populate-cache' ) );~~ |
  | 108 |  | ~~exit;~~ |
  | 109 |  | ~~}~~ |
  | 110 |  |  |
  | 111 |  | ~~public function clear\_google\_cache() {~~ |
  | 112 |  | ~~if ( empty( $\_GET['ssa-clear-google-cache'] ) ) {~~ |
  | 113 |  | ~~return;~~ |
  | 114 |  | ~~}~~ |
  | 115 |  |  |
  | 116 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 117 |  | ~~return;~~ |
  | 118 |  | ~~}~~ |
  | 119 |  |  |
  | 120 |  | ~~$this->plugin->availability\_external\_model->bulk\_delete( array(~~ |
  | 121 |  | ~~'type' => 'appointment\_type',~~ |
  | 122 |  | ~~'service' => 'google',~~ |
  | 123 |  | ~~) );~~ |
  | 124 |  | ~~$this->plugin->google\_calendar->increment\_google\_cache\_version();~~ |
  | 125 |  |  |
  | 126 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-clear-google-cache' ) );~~ |
  | 127 |  | ~~exit;~~ |
  | 128 |  | ~~}~~ |
  | 129 |  |  |
  | 130 |  | ~~public function set\_google\_query\_limit() {~~ |
  | 131 |  | ~~if ( empty( $\_GET['ssa-set-google-query-limit'] ) ) {~~ |
  | 132 |  | ~~return;~~ |
  | 133 |  | ~~}~~ |
  | 134 |  |  |
  | 135 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 136 |  | ~~return;~~ |
  | 137 |  | ~~}~~ |
  | 138 |  |  |
  | 139 |  | ~~$set\_google\_query\_limit = (int)esc\_attr( $\_GET['ssa-set-google-query-limit'] );~~ |
  | 140 |  | ~~if ( empty( $set\_google\_query\_limit ) ) {~~ |
  | 141 |  | ~~return;~~ |
  | 142 |  | ~~}~~ |
  | 143 |  |  |
  | 144 |  | ~~$this->plugin->google\_calendar\_settings->update( array(~~ |
  | 145 |  | ~~'query\_limit' => $set\_google\_query\_limit,~~ |
  | 146 |  | ~~) );~~ |
  | 147 |  |  |
  | 148 |  | ~~$this->plugin->google\_calendar->increment\_google\_cache\_version();~~ |
  | 149 |  |  |
  | 150 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-set-google-query-limit' ) );~~ |
  | 151 |  | ~~exit;~~ |
  | 152 |  | ~~}~~ |
  | 153 |  |  |
  | 154 |  | ~~public function set\_display\_capacity\_available() {~~ |
  | 155 |  | ~~if ( ! isset ( $\_GET['ssa-set-display-capacity-available'] ) ) {~~ |
  | 156 |  | ~~return;~~ |
  | 157 |  | ~~}~~ |
  | 158 |  |  |
  | 159 |  | ~~// if ( ! is\_user\_logged\_in() ) {~~ |
  | 160 |  | ~~//  return;~~ |
  | 161 |  | ~~// }~~ |
  | 162 |  | ~~$new\_value = (bool) $\_GET['ssa-set-display-capacity-available'];~~ |
  | 163 |  | ~~$developer\_settings = $this->plugin->developer\_settings->get();~~ |
  | 164 |  | ~~$developer\_settings['display\_capacity\_available'] = $new\_value;~~ |
  | 165 |  | ~~$this->plugin->developer\_settings->update( $developer\_settings );~~ |
  | 166 |  | ~~$this->plugin->availability\_cache\_invalidation->increment\_cache\_version();~~ |
  | 167 |  |  |
  | 168 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-set-display-capacity-available' ) );~~ |
  | 169 |  | ~~exit;~~ |
  | 170 |  | ~~}~~ |
  | 171 |  |  |
  | 172 |  | ~~public function clear\_all\_cache() {~~ |
  | 173 |  | ~~if ( empty( $\_GET['ssa-clear-all-cache'] ) ) {~~ |
  | 174 |  | ~~return;~~ |
  | 175 |  | ~~}~~ |
  | 176 |  |  |
  | 177 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 178 |  | ~~return;~~ |
  | 179 |  | ~~}~~ |
  | 180 |  |  |
  | 181 |  | ~~$this->plugin->availability\_external\_model->bulk\_delete( array(~~ |
  | 182 |  | ~~'type' => 'appointment\_type',~~ |
  | 183 |  | ~~'service' => 'google',~~ |
  | 184 |  | ~~) );~~ |
  | 185 |  | ~~$this->plugin->google\_calendar->increment\_google\_cache\_version();~~ |
  | 186 |  | ~~$this->plugin->availability\_cache\_invalidation->increment\_cache\_version();~~ |
  | 187 |  |  |
  | 188 |  | ~~wp\_redirect( remove\_query\_arg( 'ssa-clear-all-cache' ) );~~ |
  | 189 |  | ~~exit;~~ |
  | 190 |  | ~~}~~ |
  | 191 |  |  |
  | 192 |  | ~~public function fix\_appointment\_durations() {~~ |
  | 193 |  | ~~if ( empty( $\_GET['ssa-fix-appointment-durations'] ) ) {~~ |
  | 194 |  | ~~return;~~ |
  | 195 |  | ~~}~~ |
  | 196 |  |  |
  | 197 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 198 |  | ~~return;~~ |
  | 199 |  | ~~}~~ |
  | 200 |  |  |
  | 201 |  | ~~$appointments = $this->plugin->appointment\_model->query( array(~~ |
  | 202 |  | ~~'number' => -1,~~ |
  | 203 |  | ~~) );~~ |
  | 204 |  | ~~$now = new DateTimeImmutable();~~ |
  | 205 |  |  |
  | 206 |  | ~~foreach ($appointments as $key => $appointment) {~~ |
  | 207 |  | ~~if ( empty( $appointment['appointment\_type\_id'] ) ) {~~ |
  | 208 |  | ~~continue; // likely an abandoned appointment from a form integration (where an appointment type was never selected)~~ |
  | 209 |  | ~~}~~ |
  | 210 |  | ~~$appointment\_type = new SSA\_Appointment\_Type\_Object( $appointment['appointment\_type\_id'] );~~ |
  | 211 |  | ~~$duration = $appointment\_type->duration;~~ |
  | 212 |  | ~~$start\_date = new DateTimeImmutable( $appointment['start\_date'] );~~ |
  | 213 |  |  |
  | 214 |  | ~~$end\_date = $start\_date->add( new DateInterval( 'PT' .$duration. 'M' ) );~~ |
  | 215 |  | ~~if ( $end\_date->format( 'Y-m-d H:i:s' ) != $appointment['end\_date'] ) {~~ |
  | 216 |  | ~~echo '<pre>'.print\_r($appointment, true).'</pre>'; // phpcs:ignore~~ |
  | 217 |  | ~~$appointment['end\_date'] = $end\_date->format( 'Y-m-d H:i:s' );~~ |
  | 218 |  |  |
  | 219 |  | ~~$this->plugin->appointment\_model->update( $appointment['id'], $appointment );~~ |
  | 220 |  | ~~}~~ |
  | 221 |  | ~~}~~ |
  | 222 |  |  |
  | 223 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 224 |  | ~~exit;~~ |
  | 225 |  | ~~}~~ |
  | 226 |  |  |
  | 227 |  | ~~public function purge\_abandoned\_appointments() {~~ |
  | 228 |  | ~~if ( empty( $\_GET['ssa-purge-abandoned-appointments'] ) ) {~~ |
  | 229 |  | ~~return;~~ |
  | 230 |  | ~~}~~ |
  | 231 |  |  |
  | 232 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 233 |  | ~~return;~~ |
  | 234 |  | ~~}~~ |
  | 235 |  |  |
  | 236 |  | ~~$this->plugin->appointment\_model->delete\_abandoned();~~ |
  | 237 |  |  |
  | 238 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 239 |  | ~~exit;~~ |
  | 240 |  | ~~}~~ |
  | 241 |  |  |
  | 242 |  | ~~public function fix\_db\_availability\_schema() {~~ |
  | 243 |  | ~~if ( empty( $\_GET['ssa-fix-db-availability-schema'] ) ) {~~ |
  | 244 |  | ~~return;~~ |
  | 245 |  | ~~}~~ |
  | 246 |  |  |
  | 247 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 248 |  | ~~return;~~ |
  | 249 |  | ~~}~~ |
  | 250 |  |  |
  | 251 |  |  |
  | 252 |  | ~~$this->plugin->availability\_model->drop();~~ |
  | 253 |  | ~~$this->plugin->availability\_model->create\_table();~~ |
  | 254 |  |  |
  | 255 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 256 |  | ~~exit;~~ |
  | 257 |  | ~~}~~ |
  | 258 |  |  |
  | 259 |  | ~~public function fix\_appointment\_types() {~~ |
  | 260 |  | ~~if ( empty( $\_GET['ssa-fix-appointment-types'] ) ) {~~ |
  | 261 |  | ~~return;~~ |
  | 262 |  | ~~}~~ |
  | 263 |  |  |
  | 264 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 265 |  | ~~return;~~ |
  | 266 |  | ~~}~~ |
  | 267 |  |  |
  | 268 |  | ~~$appointment\_types = $this->plugin->appointment\_type\_model->query( array(~~ |
  | 269 |  | ~~'number' => -1,~~ |
  | 270 |  | ~~) );~~ |
  | 271 |  | ~~foreach ($appointment\_types as $appointment\_type) {~~ |
  | 272 |  | ~~if ( empty( $appointment\_type['custom\_customer\_information'] ) ) {~~ |
  | 273 |  | ~~$appointment\_type['custom\_customer\_information'] = array(~~ |
  | 274 |  | ~~array(~~ |
  | 275 |  | ~~'field' => 'Name',~~ |
  | 276 |  | ~~'display' => true,~~ |
  | 277 |  | ~~'required' => true,~~ |
  | 278 |  | ~~'type' => 'single-text',~~ |
  | 279 |  | ~~'icon' => 'face',~~ |
  | 280 |  | ~~'values' => '',~~ |
  | 281 |  | ~~),~~ |
  | 282 |  | ~~array(~~ |
  | 283 |  | ~~'field' => 'Email',~~ |
  | 284 |  | ~~'display' => true,~~ |
  | 285 |  | ~~'required' => true,~~ |
  | 286 |  | ~~'type' => 'single-text',~~ |
  | 287 |  | ~~'icon' => 'email',~~ |
  | 288 |  | ~~'values' => '',~~ |
  | 289 |  | ~~),~~ |
  | 290 |  | ~~);~~ |
  | 291 |  | ~~}~~ |
  | 292 |  |  |
  | 293 |  | ~~if ( empty( $appointment\_type['customer\_information'] ) ) {~~ |
  | 294 |  | ~~$appointment\_type['custom\_customer\_information'] = array(~~ |
  | 295 |  | ~~array(~~ |
  | 296 |  | ~~'field' => 'Name',~~ |
  | 297 |  | ~~'display' => true,~~ |
  | 298 |  | ~~'required' => true,~~ |
  | 299 |  | ~~'type' => 'single-text',~~ |
  | 300 |  | ~~'icon' => 'face',~~ |
  | 301 |  | ~~'values' => '',~~ |
  | 302 |  | ~~),~~ |
  | 303 |  | ~~array(~~ |
  | 304 |  | ~~'field' => 'Email',~~ |
  | 305 |  | ~~'display' => true,~~ |
  | 306 |  | ~~'required' => true,~~ |
  | 307 |  | ~~'type' => 'single-text',~~ |
  | 308 |  | ~~'icon' => 'email',~~ |
  | 309 |  | ~~'values' => '',~~ |
  | 310 |  | ~~),~~ |
  | 311 |  | ~~);~~ |
  | 312 |  | ~~}~~ |
  | 313 |  |  |
  | 314 |  | ~~$appointment\_type['custom\_customer\_information'] = array\_values( $appointment\_type['custom\_customer\_information'] );~~ |
  | 315 |  | ~~$appointment\_type['customer\_information'] = array\_values( $appointment\_type['customer\_information'] );~~ |
  | 316 |  |  |
  | 317 |  | ~~$appointment\_types = $this->plugin->appointment\_type\_model->update(~~ |
  | 318 |  | ~~$appointment\_type['id'],~~ |
  | 319 |  | ~~$appointment\_type~~ |
  | 320 |  | ~~);~~ |
  | 321 |  | ~~}~~ |
  | 322 |  |  |
  | 323 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 324 |  | ~~exit;~~ |
  | 325 |  | ~~}~~ |
  | 326 |  |  |
  | 327 |  | ~~public function fix\_missing\_appointment\_types() {~~ |
  | 328 |  | ~~if ( empty( $\_GET['ssa-fix-missing-appointment-types'] ) ) {~~ |
  | 329 |  | ~~return;~~ |
  | 330 |  | ~~}~~ |
  | 331 |  |  |
  | 332 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 333 |  | ~~return;~~ |
  | 334 |  | ~~}~~ |
  | 335 |  |  |
  | 336 |  | ~~$this->plugin->upgrade->maybe\_fix\_deleted\_appointment\_types();~~ |
  | 337 |  |  |
  | 338 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 339 |  | ~~exit;~~ |
  | 340 |  | ~~}~~ |
  | 341 |  | ~~public function fix\_db\_datetime\_schema() {~~ |
  | 342 |  | ~~if ( empty( $\_GET['ssa-fix-db-datetime-schema'] ) ) {~~ |
  | 343 |  | ~~return;~~ |
  | 344 |  | ~~}~~ |
  | 345 |  |  |
  | 346 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 347 |  | ~~return;~~ |
  | 348 |  | ~~}~~ |
  | 349 |  |  |
  | 350 |  | ~~global $wpdb;~~ |
  | 351 |  |  |
  | 352 |  | ~~$now = gmdate( 'Y-m-d H:i:s' );~~ |
  | 353 |  |  |
  | 354 |  | ~~$before\_queries = array(~~ |
  | 355 |  | ~~/\* Appointment Types \*/~~ |
  | 356 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `booking\_start\_date`='".SSA\_Constants::EPOCH\_START\_DATE."' WHERE `booking\_start\_date`=0",~~ |
  | 357 |  |  |
  | 358 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `booking\_end\_date`='".SSA\_Constants::EPOCH\_END\_DATE."' WHERE `booking\_end\_date`=0",~~ |
  | 359 |  |  |
  | 360 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `availability\_start\_date`='".SSA\_Constants::EPOCH\_START\_DATE."' WHERE `availability\_start\_date`=0",~~ |
  | 361 |  |  |
  | 362 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `availability\_end\_date`='".SSA\_Constants::EPOCH\_END\_DATE."' WHERE `availability\_end\_date`=0",~~ |
  | 363 |  |  |
  | 364 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `date\_created`='1970-01-01' where `date\_created`=0",~~ |
  | 365 |  |  |
  | 366 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `date\_modified`='1970-01-01' where `date\_modified`=0",~~ |
  | 367 |  |  |
  | 368 |  | ~~/\* Appointments \*/~~ |
  | 369 |  | ~~"UPDATE {$this->plugin->appointment\_model->get\_table\_name()} SET `start\_date`='1970-01-01' where `start\_date`=0",~~ |
  | 370 |  |  |
  | 371 |  | ~~"UPDATE {$this->plugin->appointment\_model->get\_table\_name()} SET `end\_date`='1970-01-01' where `end\_date`=0",~~ |
  | 372 |  |  |
  | 373 |  | ~~"UPDATE {$this->plugin->appointment\_model->get\_table\_name()} SET `date\_created`='1970-01-01' where `date\_created`=0",~~ |
  | 374 |  |  |
  | 375 |  | ~~"UPDATE {$this->plugin->appointment\_model->get\_table\_name()} SET `date\_modified`='1970-01-01' where `date\_modified`=0",~~ |
  | 376 |  |  |
  | 377 |  | ~~);~~ |
  | 378 |  |  |
  | 379 |  | ~~$after\_queries = array(~~ |
  | 380 |  | ~~/\* Appointment Types \*/~~ |
  | 381 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `booking\_start\_date`=NULL where `booking\_start\_date`='".SSA\_Constants::EPOCH\_START\_DATE."'",~~ |
  | 382 |  |  |
  | 383 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `booking\_end\_date`=NULL where `booking\_end\_date`='".SSA\_Constants::EPOCH\_END\_DATE."'",~~ |
  | 384 |  |  |
  | 385 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `availability\_start\_date`=NULL where `availability\_start\_date`='".SSA\_Constants::EPOCH\_START\_DATE."'",~~ |
  | 386 |  |  |
  | 387 |  | ~~"UPDATE {$this->plugin->appointment\_type\_model->get\_table\_name()} SET `availability\_end\_date`=NULL where `availability\_end\_date`='".SSA\_Constants::EPOCH\_END\_DATE."'",~~ |
  | 388 |  | ~~);~~ |
  | 389 |  |  |
  | 390 |  | ~~$has\_failed = false;~~ |
  | 391 |  | ~~foreach ($before\_queries as $query) {~~ |
  | 392 |  | ~~$result = $wpdb->query( $query );~~ |
  | 393 |  | ~~if ( false === $result ) {~~ |
  | 394 |  | ~~$has\_failed = true;~~ |
  | 395 |  | ~~}~~ |
  | 396 |  | ~~}~~ |
  | 397 |  |  |
  | 398 |  | ~~$this->plugin->appointment\_type\_model->create\_table();~~ |
  | 399 |  | ~~$this->plugin->appointment\_model->create\_table();~~ |
  | 400 |  |  |
  | 401 |  | ~~foreach ($after\_queries as $query) {~~ |
  | 402 |  | ~~$result = $wpdb->query( $query );~~ |
  | 403 |  | ~~if ( false === $result ) {~~ |
  | 404 |  | ~~$has\_failed = true;~~ |
  | 405 |  | ~~}~~ |
  | 406 |  | ~~}~~ |
  | 407 |  |  |
  | 408 |  | ~~$this->fix\_appointment\_group\_ids( true );~~ |
  | 409 |  |  |
  | 410 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 411 |  | ~~exit;~~ |
  | 412 |  | ~~}~~ |
  | 413 |  |  |
  | 414 |  | ~~public function fix\_appointment\_group\_ids( $force = false ) {~~ |
  | 415 |  | ~~if ( empty( $force ) && empty( $\_GET['ssa-fix-appointment-group-ids'] ) ) {~~ |
  | 416 |  | ~~return;~~ |
  | 417 |  | ~~}~~ |
  | 418 |  |  |
  | 419 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 420 |  | ~~return;~~ |
  | 421 |  | ~~}~~ |
  | 422 |  |  |
  | 423 |  | ~~$appointments = $this->plugin->appointment\_model->query( array(~~ |
  | 424 |  | ~~'number' => -1,~~ |
  | 425 |  | ~~) );~~ |
  | 426 |  | ~~$now = new DateTimeImmutable();~~ |
  | 427 |  |  |
  | 428 |  | ~~foreach ($appointments as $key => $appointment) {~~ |
  | 429 |  | ~~if ( ! empty( $appointment['group\_id'] ) ) {~~ |
  | 430 |  | ~~continue;~~ |
  | 431 |  | ~~}~~ |
  | 432 |  |  |
  | 433 |  | ~~$appointment\_type = new SSA\_Appointment\_Type\_Object( $appointment['appointment\_type\_id'] );~~ |
  | 434 |  | ~~$capacity\_type = $appointment\_type->capacity\_type;~~ |
  | 435 |  | ~~if ( empty( $capacity\_type ) || $capacity\_type !== 'group' ) {~~ |
  | 436 |  | ~~continue;~~ |
  | 437 |  | ~~}~~ |
  | 438 |  |  |
  | 439 |  | ~~$start\_date = new DateTimeImmutable( $appointment['start\_date'] );~~ |
  | 440 |  |  |
  | 441 |  | ~~$args = array(~~ |
  | 442 |  | ~~'number' => -1,~~ |
  | 443 |  | ~~'orderby' => 'id',~~ |
  | 444 |  | ~~'order' => 'ASC',~~ |
  | 445 |  | ~~'appointment\_type\_id' => $appointment['appointment\_type\_id'],~~ |
  | 446 |  | ~~'start\_date' => $appointment['start\_date'],~~ |
  | 447 |  | ~~'exclude\_ids' => $appointment['id'],~~ |
  | 448 |  | ~~);~~ |
  | 449 |  |  |
  | 450 |  | ~~$new\_group\_id = 0;~~ |
  | 451 |  | ~~$appointment\_arrays = $this->plugin->appointment\_model->query( $args );~~ |
  | 452 |  | ~~foreach ($appointment\_arrays as $appointment\_array) {~~ |
  | 453 |  | ~~if ( ! empty( $appointment\_array['group\_id'] ) ) {~~ |
  | 454 |  | ~~$new\_group\_id = $appointment\_array['group\_id'];~~ |
  | 455 |  | ~~}~~ |
  | 456 |  | ~~}~~ |
  | 457 |  |  |
  | 458 |  | ~~if ( empty( $new\_group\_id ) && empty( $appointment\_arrays[0]['id'] ) ) {~~ |
  | 459 |  | ~~continue;~~ |
  | 460 |  | ~~}~~ |
  | 461 |  |  |
  | 462 |  | ~~$new\_group\_id = $appointment\_arrays[0]['id'];~~ |
  | 463 |  |  |
  | 464 |  | ~~$this->plugin->appointment\_model->update( $appointment['id'], array(~~ |
  | 465 |  | ~~'group\_id' => $new\_group\_id~~ |
  | 466 |  | ~~) );~~ |
  | 467 |  |  |
  | 468 |  | ~~foreach ($appointment\_arrays as $appointment\_array) {~~ |
  | 469 |  | ~~$this->plugin->appointment\_model->update( $appointment\_array['id'], array(~~ |
  | 470 |  | ~~'group\_id' => $new\_group\_id~~ |
  | 471 |  | ~~) );~~ |
  | 472 |  | ~~}~~ |
  | 473 |  | ~~}~~ |
  | 474 |  |  |
  | 475 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 476 |  | ~~exit;~~ |
  | 477 |  | ~~}~~ |
  | 478 |  |  |
  | 479 |  | ~~public function reset\_settings() {~~ |
  | 480 |  | ~~if ( empty( $\_GET['ssa-reset-settings'] ) ) {~~ |
  | 481 |  | ~~return;~~ |
  | 482 |  | ~~}~~ |
  | 483 |  |  |
  | 484 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 485 |  | ~~return;~~ |
  | 486 |  | ~~}~~ |
  | 487 |  |  |
  | 488 |  | ~~$options\_to\_delete = array(~~ |
  | 489 |  | ~~'wp\_ssa\_appointments\_db\_version',~~ |
  | 490 |  | ~~'wp\_ssa\_appointment\_meta\_db\_version',~~ |
  | 491 |  | ~~'wp\_ssa\_appointment\_types\_db\_version',~~ |
  | 492 |  | ~~'wp\_ssa\_availability\_db\_version',~~ |
  | 493 |  | ~~'wp\_ssa\_async\_actions\_db\_version',~~ |
  | 494 |  | ~~'wp\_ssa\_payments\_db\_version',~~ |
  | 495 |  | ~~'ssa\_settings\_json',~~ |
  | 496 |  | ~~'ssa\_versions',~~ |
  | 497 |  | ~~'wp\_ssa\_resource\_appointments\_db\_version',~~ |
  | 498 |  | ~~'wp\_ssa\_resource\_group\_appointment\_types\_db\_version',~~ |
  | 499 |  | ~~'wp\_ssa\_resources\_db\_version',~~ |
  | 500 |  | ~~'wp\_ssa\_resource\_groups\_db\_version',~~ |
  | 501 |  | ~~'wp\_ssa\_resource\_group\_resources\_db\_version',~~ |
  | 502 |  | ~~'wp\_ssa\_appointment\_type\_labels\_db\_version',~~ |
  | 503 |  | ~~'wp\_ssa\_revisions\_db\_version',~~ |
  | 504 |  | ~~'wp\_ssa\_revision\_meta\_db\_version',~~ |
  | 505 |  | ~~'wp\_ssa\_availability\_external\_db\_version',~~ |
  | 506 |  | ~~'wp\_ssa\_staff\_db\_version',~~ |
  | 507 |  | ~~'wp\_ssa\_staff\_appointments\_db\_version',~~ |
  | 508 |  | ~~'wp\_ssa\_staff\_appointment\_types\_db\_version',~~ |
  | 509 |  | ~~);~~ |
  | 510 |  |  |
  | 511 |  | ~~foreach ($options\_to\_delete as $option\_name) {~~ |
  | 512 |  | ~~delete\_option( $option\_name );~~ |
  | 513 |  | ~~}~~ |
  | 514 |  |  |
  | 515 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 516 |  | ~~exit;~~ |
  | 517 |  | ~~}~~ |
  | 518 |  |  |
  | 519 |  |  |
  | 520 |  | ~~/\*\*~~ |
  | 521 |  | ~~\* Deletes all ssa related options from wp\_options table and truncate all ssa database tables.~~ |
  | 522 |  | ~~\*~~ |
  | 523 |  | ~~\* @since 5.4.3~~ |
  | 524 |  | ~~\*~~ |
  | 525 |  | ~~\* @return void~~ |
  | 526 |  | ~~\*/~~ |
  | 527 |  | ~~public function ssa\_factory\_reset() {~~ |
  | 528 |  | ~~if ( empty( $\_GET['ssa-factory-reset'] ) ) { // phpcs:ignore~~ |
  | 529 |  | ~~return;~~ |
  | 530 |  | ~~}~~ |
  | 531 |  |  |
  | 532 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 533 |  | ~~return;~~ |
  | 534 |  | ~~}~~ |
  | 535 |  |  |
  | 536 |  | ~~// Finds and delete all rows from the wp\_options table that contains "ssa\_" in the option\_name column.~~ |
  | 537 |  | ~~global $wpdb;~~ |
  | 538 |  |  |
  | 539 |  | ~~$wpdb->query( "DELETE FROM {$wpdb->options} WHERE option\_name LIKE 'ssa\\_%'" ); // phpcs:ignore WordPress.DB.DirectDatabaseQuery~~ |
  | 540 |  |  |
  | 541 |  | ~~// Truncate all ssa database tables.~~ |
  | 542 |  | ~~$this->plugin->appointment\_model->truncate();~~ |
  | 543 |  | ~~$this->plugin->appointment\_meta\_model->truncate();~~ |
  | 544 |  | ~~$this->plugin->appointment\_type\_model->truncate();~~ |
  | 545 |  | ~~$this->plugin->availability\_model->truncate();~~ |
  | 546 |  | ~~$this->plugin->availability\_external\_model->truncate();~~ |
  | 547 |  | ~~$this->plugin->async\_action\_model->truncate();~~ |
  | 548 |  | ~~$this->plugin->payment\_model->truncate();~~ |
  | 549 |  | ~~$this->plugin->staff\_model->truncate();~~ |
  | 550 |  | ~~$this->plugin->staff\_appointment\_model->truncate();~~ |
  | 551 |  | ~~$this->plugin->staff\_appointment\_type\_model->truncate();~~ |
  | 552 |  | ~~$this->plugin->resource\_model->truncate();~~ |
  | 553 |  | ~~$this->plugin->resource\_group\_model->truncate();~~ |
  | 554 |  | ~~$this->plugin->resource\_group\_resource\_model->truncate();~~ |
  | 555 |  | ~~$this->plugin->resource\_group\_appointment\_type\_model->truncate();~~ |
  | 556 |  | ~~$this->plugin->resource\_appointment\_model->truncate();~~ |
  | 557 |  | ~~$this->plugin->revision\_model->truncate();~~ |
  | 558 |  | ~~$this->plugin->revision\_meta\_model->truncate();~~ |
  | 559 |  |  |
  | 560 |  | ~~wp\_safe\_redirect( $this->plugin->wp\_admin->url(), $status = 302 );~~ |
  | 561 |  | ~~exit;~~ |
  | 562 |  | ~~}~~ |
  | 563 |  |  |
  | 564 |  | ~~public function rebuild\_db() {~~ |
  | 565 |  | ~~if ( empty( $\_GET['ssa-rebuild-db'] ) ) {~~ |
  | 566 |  | ~~return;~~ |
  | 567 |  | ~~}~~ |
  | 568 |  |  |
  | 569 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 570 |  | ~~return;~~ |
  | 571 |  | ~~}~~ |
  | 572 |  |  |
  | 573 |  | ~~$this->plugin->appointment\_model->create\_table();~~ |
  | 574 |  | ~~$this->plugin->appointment\_meta\_model->create\_table();~~ |
  | 575 |  | ~~$this->plugin->appointment\_type\_model->create\_table();~~ |
  | 576 |  | ~~$this->plugin->appointment\_type\_label\_model->create\_table();~~ |
  | 577 |  | ~~$this->plugin->availability\_model->create\_table();~~ |
  | 578 |  | ~~$this->plugin->availability\_external\_model->create\_table();~~ |
  | 579 |  | ~~$this->plugin->async\_action\_model->create\_table();~~ |
  | 580 |  | ~~$this->plugin->payment\_model->create\_table();~~ |
  | 581 |  | ~~$this->plugin->revision\_model->create\_table();~~ |
  | 582 |  | ~~$this->plugin->revision\_meta\_model->create\_table();~~ |
  | 583 |  | ~~$this->plugin->resource\_appointment\_model->create\_table();~~ |
  | 584 |  | ~~$this->plugin->resource\_group\_appointment\_type\_model->create\_table();~~ |
  | 585 |  | ~~$this->plugin->resource\_model->create\_table();~~ |
  | 586 |  | ~~$this->plugin->resource\_group\_model->create\_table();~~ |
  | 587 |  | ~~$this->plugin->resource\_group\_resource\_model->create\_table();~~ |
  | 588 |  | ~~$this->plugin->staff\_model->create\_table();~~ |
  | 589 |  | ~~$this->plugin->staff\_appointment\_model->create\_table();~~ |
  | 590 |  | ~~$this->plugin->staff\_appointment\_type\_model->create\_table();~~ |
  | 591 |  |  |
  | 592 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 593 |  | ~~exit;~~ |
  | 594 |  | ~~}~~ |
  | 595 |  |  |
  | 596 |  | ~~public function restore\_plugin\_backup() {~~ |
  | 597 |  | ~~if ( empty( $\_GET['ssa-restore-backup'] ) ) {~~ |
  | 598 |  | ~~return;~~ |
  | 599 |  | ~~}~~ |
  | 600 |  |  |
  | 601 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 602 |  | ~~return;~~ |
  | 603 |  | ~~}~~ |
  | 604 |  |  |
  | 605 |  | ~~// restore previous backup file~~ |
  | 606 |  | ~~$restore = $this->plugin->support\_status->restore\_settings\_backup();~~ |
  | 607 |  |  |
  | 608 |  | ~~// if something happens, print the errors~~ |
  | 609 |  | ~~if( is\_wp\_error( $restore ) ) {~~ |
  | 610 |  | ~~$string = implode("\n", $restore->get\_error\_messages());~~ |
  | 611 |  | ~~wp\_die($string);~~ |
  | 612 |  | ~~}~~ |
  | 613 |  |  |
  | 614 |  | ~~wp\_redirect( $this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 615 |  | ~~exit;~~ |
  | 616 |  | ~~}~~ |
  | 617 |  |  |
  | 618 |  | ~~/\*\*~~ |
  | 619 |  | ~~\* Given a GET parameter on the url, get a list of future booked appointments and schedule notifications for the ones that are valid.~~ |
  | 620 |  | ~~\*~~ |
  | 621 |  | ~~\* @since 4.8.8~~ |
  | 622 |  | ~~\*~~ |
  | 623 |  | ~~\* @return void~~ |
  | 624 |  | ~~\*/~~ |
  | 625 |  | ~~public function bulk\_send\_notifications() {~~ |
  | 626 |  | ~~if ( empty( $\_GET['ssa-resend-booked-notifications'] ) ) {~~ |
  | 627 |  | ~~return;~~ |
  | 628 |  | ~~}~~ |
  | 629 |  |  |
  | 630 |  | ~~if ( ! current\_user\_can( 'ssa\_manage\_site\_settings' ) ) {~~ |
  | 631 |  | ~~return;~~ |
  | 632 |  | ~~}~~ |
  | 633 |  |  |
  | 634 |  | ~~// Get list of booked appointments.~~ |
  | 635 |  | ~~$appointments = $this->plugin->appointment\_model->query(~~ |
  | 636 |  | ~~array(~~ |
  | 637 |  | ~~'status'         => SSA\_Appointment\_Model::get\_booked\_statuses(),~~ |
  | 638 |  | ~~'start\_date\_min' => gmdate( 'Y-m-d H:i:s' ),~~ |
  | 639 |  | ~~'number'         => -1,~~ |
  | 640 |  | ~~)~~ |
  | 641 |  | ~~);~~ |
  | 642 |  |  |
  | 643 |  | ~~$notifications = $this->plugin->notifications\_settings->get\_notifications();~~ |
  | 644 |  |  |
  | 645 |  | ~~if ( empty( $notifications ) ) {~~ |
  | 646 |  | ~~wp\_safe\_redirect( $this->plugin->wp\_admin->url(), $status = 302 );~~ |
  | 647 |  | ~~exit;~~ |
  | 648 |  | ~~}~~ |
  | 649 |  |  |
  | 650 |  | ~~// filter list of notifications to return only the one to be sent to the customer.~~ |
  | 651 |  | ~~$customer\_booked\_notifications = array\_values(~~ |
  | 652 |  | ~~array\_filter(~~ |
  | 653 |  | ~~$notifications,~~ |
  | 654 |  | ~~function( $notification ) {~~ |
  | 655 |  | ~~return (~~ |
  | 656 |  | ~~! empty( $notification['active'] ) &&~~ |
  | 657 |  | ~~'appointment\_booked' === $notification['trigger'] &&~~ |
  | 658 |  | ~~strpos( implode( ';', $notification['sent\_to'] ), 'customer\_email' ) !== false~~ |
  | 659 |  | ~~);~~ |
  | 660 |  | ~~}~~ |
  | 661 |  | ~~)~~ |
  | 662 |  | ~~);~~ |
  | 663 |  |  |
  | 664 |  | ~~// If notification is found, then send list of appointments to validate the notification and possibly send them.~~ |
  | 665 |  | ~~if ( ! empty( $customer\_booked\_notifications ) ) {~~ |
  | 666 |  | ~~foreach ( $customer\_booked\_notifications as $customer\_booked\_notification ) {~~ |
  | 667 |  | ~~$this->plugin->action\_scheduler->bulk\_schedule\_notifications( $customer\_booked\_notification, $appointments );~~ |
  | 668 |  | ~~}~~ |
  | 669 |  | ~~}~~ |
  | 670 |  |  |
  | 671 |  | ~~wp\_safe\_redirect( $this->plugin->wp\_admin->url(), $status = 302 );~~ |
  | 672 |  | ~~exit();~~ |
  | 673 |  | ~~}~~ |
  | 674 |  |  |
  | 675 |  |  |
  | 676 |  |  |
  | 677 |  | ~~/\*\*~~ |
  | 678 |  | ~~\* Defines the SSA\_DEBUG\_LOG constant to identify if we need to log information specific to the plugin on the~~ |
  | 679 |  | ~~\* ssa\_debug.log file.~~ |
  | 680 |  | ~~\*~~ |
  | 681 |  | ~~\* @return void~~ |
  | 682 |  | ~~\*/~~ |
  | 683 |  | ~~public function set\_beta\_booking\_app\_setting() {~~ |
  | 684 |  | ~~if (!isset($\_GET['ssa-beta-booking-app'])) {~~ |
  | 685 |  | ~~return;~~ |
  | 686 |  | ~~}~~ |
  | 687 |  |  |
  | 688 |  | ~~if (!current\_user\_can('ssa\_manage\_site\_settings')) {~~ |
  | 689 |  | ~~return;~~ |
  | 690 |  | ~~}~~ |
  | 691 |  |  |
  | 692 |  | ~~$developer\_settings = $this->plugin->developer\_settings->get();~~ |
  | 693 |  | ~~$developer\_settings['beta\_booking\_app'] = (int)$\_GET['ssa-beta-booking-app'];~~ |
  | 694 |  | ~~$this->plugin->developer\_settings->update( $developer\_settings );~~ |
  | 695 |  |  |
  | 696 |  | ~~wp\_safe\_redirect($this->plugin->wp\_admin->url(), $status = 302);~~ |
  | 697 |  | ~~exit();~~ |
  | 698 | 43 | } |
  | 699 | 44 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3042890)
* [Zip Archive](?format=zip&new=3042890)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

