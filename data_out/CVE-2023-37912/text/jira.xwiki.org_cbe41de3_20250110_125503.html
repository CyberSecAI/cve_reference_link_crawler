

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXRENDERING-688)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXRENDERING-688)

![Uploaded image for project: 'XWiki Rendering'](https://jira.xwiki.org/secure/projectavatar?pid=10610&avatarId=13604)

1. [XWiki Rendering](/browse/XRENDERING)
2. [XRENDERING-688](/browse/XRENDERING-688)

# Impersonation/privilege escalation via footnotes and display/include/uiextensions macros

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXRENDERING-688 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [14.10.6](/issues/?jql=project+%3D+XRENDERING+AND+fixVersion+%3D+14.10.6 "14.10.6 "), [15.1-rc-1](/issues/?jql=project+%3D+XRENDERING+AND+fixVersion+%3D+15.1-rc-1 "15.1-rc-1 ")
* **Affects Version/s:**
  3.0 M3
* **Component/s:**
  [Macro - Footnotes](/issues/?jql=project+%3D+XRENDERING+AND+component+%3D+%22Macro+-+Footnotes%22 "Macro - Footnotes ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  N/A
* **Documentation in Release Notes:**
  N/A
* **Similar issues:**

#### Description

**Steps to reproduce:**

1. As an admin, create a document "Secret.WebHome" with "Secret content" and restrict access to admins by setting a view right for the admin group.
2. As an admin with programming rights, create a document "Including.WebHome" with content
   ```
   {{display reference="Included.WebHome"/}}

   {{footnote}}Some footnote{{/footnote}}
   ```
3. As user without script or programming right, create a document "Included.WebHome" with content
   ```
   {{footnote}}{{async cache="false"}}{{include reference="Secret.WebHome"/}}{{/async}}

   {{groovy}}println("Hello from Groovy!"){{/groovy}}{{/footnote}}
   ```
4. Open the document "Including.WebHome"

**Expected result:**

There are errors displayed because the user cannot view the "Secret" document and cannot execute a Groovy macro.

**Actual result:**

A footnote with content

```
Secret content.

Hello from Groovy!
```

is displayed.

This demonstrates both a privilege escalation to programming rights as well as a data leak as the footnote macro allows executing macros with the including document author's rights. Using the async macro, we can use the including document's author's view rights to access otherwise inaccessible documents. For this, none of the involved authors needs special rights, in the demo they were just used to demonstrate the privilege escalation to programming rights. This works with any macro that includes the XDOM of another document, in particular these are the include, display and uiextension macros.

The reason for this is that the footnote macro searches the whole XDOM, which includes the included documents, for footnote macro markers and executes their content in the current context. For this to work, there needs to be at least one footnote in the including document.

I haven't found any document in the standard XWiki distribution that contains footnotes so by default there are no exploitable documents but it is not hard to imagine that in a real wiki such documents could exist.

The affected version is just the version where I've reproduced the issue, this is most likely much older.

#### Attachments

#### Issue Links

causes

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XRENDERING-715](/browse/XRENDERING-715)
Footnote macro content cannot reference content outside of the macro

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

is caused by

![New Feature - A new feature of the product, which has yet to be developed.](/secure/viewavatar?size=xsmall&avatarId=13511&avatarType=issuetype "New Feature - A new feature of the product, which has yet to be developed.")
[XWIKI-4065](/browse/XWIKI-4065)
New Footnote macro

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[GitHub Security advisory](https://github.com/xwiki/xwiki-rendering/security/advisories/GHSA-35j5-m29r-xfq5)

#### Activity

#### People

Assignee:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Reporter:

![MichaelHamann](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Michael Hamann

Votes:
0
Vote for this issue

Watchers:
1
Start watching this issue

#### Dates

Created:

21/Nov/22 15:22

Updated:

21/Jul/23 11:00

Resolved:

16/Feb/23 13:47

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

