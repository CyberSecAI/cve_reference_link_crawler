<!doctype html><html lang=en><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><meta name=description content="Vtiger CRM <= 8.1.0 does not correctly check user's privileges. A low-privileged user can interact directly with the `Migration` administrative module to disable arbitrary modules in the instance."><meta name=Copyright content="Copyright &copy; Shielder"><meta property="og:title" content="Shielder - Vtiger CRM (<= 8.1.0) Broken Access Control in Migration module"><meta property="og:type" content="article"><meta property="og:url" content="https://www.shielder.com/advisories/vtiger-migration-bac/"><meta property="og:image" content="https://www.shielder.com//img/advisory.png"><meta property="og:image:type" content="image/png"><meta property="og:image:width" content="225"><meta property="og:image:height" content="225"><meta property="og:image:alt" content="advisory"><meta property="og:locale" content="en_US"><meta property="og:description" content="Vtiger CRM <= 8.1.0 does not correctly check user's privileges. A low-privileged user can interact directly with the `Migration` administrative module to disable arbitrary modules in the instance."><meta property="og:site_name" content="Shielder"><meta property="fb:app_id" content="1651492201761174"><meta name=twitter:card content="summary"><meta name=twitter:site content="@ShielderSec"><meta name=twitter:creator content="@ShielderSec"><meta name=twitter:title content="Shielder - Vtiger CRM (<= 8.1.0) Broken Access Control in Migration module"><meta name=twitter:description content="Vtiger CRM <= 8.1.0 does not correctly check user's privileges. A low-privileged user can interact directly with the `Migration` administrative module to disable arbitrary modules in the instance."><meta name=twitter:image content="https://www.shielder.com//img/advisory.png"><link rel=apple-touch-icon sizes=57x57 href=https://www.shielder.com/favicon/apple-touch-icon-57x57.png><link rel=apple-touch-icon sizes=60x60 href=https://www.shielder.com/favicon/apple-touch-icon-60x60.png><link rel=apple-touch-icon sizes=72x72 href=https://www.shielder.com/favicon/apple-touch-icon-72x72.png><link rel=apple-touch-icon sizes=76x76 href=https://www.shielder.com/favicon/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=114x114 href=https://www.shielder.com/favicon/apple-touch-icon-114x114.png><link rel=apple-touch-icon sizes=120x120 href=https://www.shielder.com/favicon/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=144x144 href=https://www.shielder.com/favicon/apple-touch-icon-144x144.png><link rel=apple-touch-icon sizes=152x152 href=https://www.shielder.com/favicon/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=167x167 href=https://www.shielder.com/favicon/apple-touch-icon-167x167.png><link rel=apple-touch-icon sizes=180x180 href=https://www.shielder.com/favicon/apple-touch-icon-180x180.png><link rel=icon type=image/png href=https://www.shielder.com/favicon/favicon-16x16.png sizes=16x16><link rel=icon type=image/png href=https://www.shielder.com/favicon/favicon-32x32.png sizes=32x32><link rel=icon type=image/png href=https://www.shielder.com/favicon/favicon-96x96.png sizes=96x96><link rel=icon type=image/png href=https://www.shielder.com/favicon/favicon-160x160.png sizes=160x160><link rel=icon type=image/png href=https://www.shielder.com/favicon/favicon-192x192.png sizes=192x192><link rel="shortcut icon" href=https://www.shielder.com/favicon/favicon.ico><link rel=preload href=https://www.shielder.com/fontawesome/webfonts/fa-regular-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.shielder.com/fontawesome/webfonts/fa-solid-900.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.shielder.com/fontawesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><link rel=preload href=https://www.shielder.com/fontawesome/webfonts/fa-brands-400.woff2 as=font type=font/woff2 crossorigin><title>Shielder - Vtiger CRM (&lt;= 8.1.0) Broken Access Control in Migration module
</title><link rel=stylesheet defer href=https://www.shielder.com/css/bootstrap.min.css><link rel=stylesheet defer href=https://www.shielder.com/css/style.css><link rel=stylesheet async href=https://www.shielder.com/fontawesome/css/all.min.css><link rel=stylesheet async href=https://www.shielder.com/css/dracula.css><link rel=alternate type=application/rss+xml title="Shielder Blog" href=https://www.shielder.com/blog/index.xml><link rel=alternate type=application/rss+xml title="Shielder Advisories" href=https://www.shielder.com/advisories/index.xml></head><body><nav class="navbar navbar-expand-lg fixed-top bg-primary p-3 px-md-5 px-lg-3 px-xl-5"><a class=navbar-brand href=https://www.shielder.com/ title=homepage><img src=https://www.shielder.com/img/logoshielder.svg alt="shielder logo homepage" class=w-75></a>
<button class="navbar-toggler text-white p-0" type=button data-toggle=collapse data-target=#navbarNav aria-controls=navbarNav aria-expanded=false aria-label="Toggle navigation">
<i class="fas fa-bars"></i></button><div class="collapse navbar-collapse justify-content-end pt-2" id=navbarNav><ul class=navbar-nav><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/ title=Home>Home</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/company title=Company>Company</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/services title=Services>Services</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/advisories title=Advisories>Advisories</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/blog title=Blog>Blog</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/careers title=Careers>Careers</a></li><li class="nav-item p-2"><a class="nav-link text-white" href=https://www.shielder.com/contacts title=Contacts>Contacts</a></li><li class="nav-item p-2"><button class="nav-link bg-transparent border-0 btn btn-primary dropdown-toggle rounded-0" type=button id=language-selector data-toggle=dropdown aria-haspopup=true aria-expanded=false>
ENG</button><div class="dropdown-menu dropdown-menu-right" aria-labelledby=language-selector><a class=dropdown-item href=https://www.shielder.com/advisories/vtiger-migration-bac/ title=ENG>ENG</a>
<a class=dropdown-item href=https://www.shielder.com/it/advisories/vtiger-migration-bac/ title=ITA>ITA</a></div></li></ul></div></nav><section id=single-advisory class="bg-primary text-white"><div class=container><div class=row><div class="col-12 col-lg-8"><h1 id=vtiger-crm--810-broken-access-control-in-migration-module>Vtiger CRM (&lt;= 8.1.0) Broken Access Control in Migration module</h1><h2 id=summary>Summary</h2><p>Vtiger CRM &lt;= 8.1.0 does not correctly check user&rsquo;s privileges. A low-privileged user can interact directly with the <code>Migration</code> administrative module to disable arbitrary modules in the instance.</p><h2 id=cves>CVE(s)</h2><ul><li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-42995" target=_blank rel="noopener noreferrer">CVE-2024-42995</a></li></ul><h2 id=product-description-from-vendor>Product description (from vendor)</h2><blockquote><p>&ldquo;Vtiger all-in-one CRM empowers you to align your marketing, sales and support teams with unified customer data powered by One View. CRM made easy. Vtiger is built around a Open Source core. We remain committed to growing and nurturing the community&rdquo;</p></blockquote><h2 id=details>Details</h2><h3 id=root-cause-analysis>Root cause analysis</h3><p>Vtiger CRM uses a MVC-like architecture. When Vtiger receives an HTTP POST request, the <code>Vtiger_WebUI</code> class dispatches it to the appropriate controller based on the values of the <code>module</code> and the <code>action</code> parameters by using the <code>Vtiger_Loader::getComponentClassName</code> function.</p><p>This function concatenates the module name, the action name, and the <code>Action</code> string, separating them with underscores, e.g. <code>module=Migration&amp;action=DisableModules</code> becomes <code>Migration_DisableModules_Action</code>.</p><p>Every controller must extend the <code>Vtiger_Action_Controller</code> class, that implements default functions and flags, for example defining <code>loginRequired=true</code> or a <code>checkPermission</code> function that check if users are authenticated and have enough privileges to perform an action. Those controller functions will be called by the <code>Vtiger_WebUI</code> during the handling of a request.</p><p>The <code>DisableModules</code> action in the <code>Migration</code> module allows an administrative user to disable a list of modules currently loaded in the Vtiger CRM instance.</p><p>However, the <code>Migration_DisableModules_Action</code> class does not implement a specific <code>checkPermission</code> function, thus falling back to the default implementation that grants access to every authenticated user.</p><p>The following code shows the patch, implementing a stricter check allowing only actions from admin users:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-php data-lang=php><span class=line><span class=cl><span class=k>class</span> <span class=nc>Migration_DisableModules_Action</span> <span class=k>extends</span> <span class=nx>Vtiger_Action_Controller</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=c1>// ---- START PATCH ----
</span></span></span><span class=line><span class=cl><span class=c1></span>    <span class=k>public</span> <span class=k>function</span> <span class=nf>checkPermission</span><span class=p>(</span><span class=nx>\Vtiger_Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>         <span class=k>parent</span><span class=o>::</span><span class=na>checkPermission</span><span class=p>(</span><span class=nv>$request</span><span class=p>);</span>
</span></span><span class=line><span class=cl>         <span class=nv>$currentUserModel</span> <span class=o>=</span> <span class=nx>Users_Record_Model</span><span class=o>::</span><span class=na>getCurrentUserModel</span><span class=p>();</span>
</span></span><span class=line><span class=cl>         <span class=k>if</span><span class=p>(</span><span class=o>!</span><span class=nv>$currentUserModel</span><span class=o>-&gt;</span><span class=na>isAdminUser</span><span class=p>())</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>              <span class=k>throw</span> <span class=k>new</span> <span class=nx>AppException</span><span class=p>(</span><span class=nx>vtranslate</span><span class=p>(</span><span class=s1>&#39;LBL_PERMISSION_DENIED&#39;</span><span class=p>,</span> <span class=s1>&#39;Vtiger&#39;</span><span class=p>));</span>
</span></span><span class=line><span class=cl>         <span class=p>}</span>
</span></span><span class=line><span class=cl>         <span class=k>return</span> <span class=k>true</span><span class=p>;</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>    <span class=c1>// ---- END PATCH ----
</span></span></span><span class=line><span class=cl><span class=c1></span>
</span></span><span class=line><span class=cl>    <span class=k>public</span> <span class=k>function</span> <span class=nf>process</span><span class=p>(</span><span class=nx>Vtiger_Request</span> <span class=nv>$request</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>        <span class=nv>$modulesList</span> <span class=o>=</span> <span class=nv>$request</span><span class=o>-&gt;</span><span class=na>get</span><span class=p>(</span><span class=s1>&#39;modulesList&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=p>(</span><span class=nv>$modulesList</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=nv>$moduleManagerModel</span> <span class=o>=</span> <span class=k>new</span> <span class=nx>Settings_ModuleManager_Module_Model</span><span class=p>();</span>
</span></span><span class=line><span class=cl>            <span class=k>foreach</span> <span class=p>(</span><span class=nv>$modulesList</span> <span class=k>as</span> <span class=nv>$moduleName</span><span class=p>)</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=nv>$moduleManagerModel</span><span class=o>-&gt;</span><span class=na>disableModule</span><span class=p>(</span><span class=nv>$moduleName</span><span class=p>);</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=nx>header</span><span class=p>(</span><span class=s1>&#39;Location: migrate/index.php&#39;</span><span class=p>);</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=proof-of-concept>Proof-of-concept</h3><ol><li>Log into the portal with low privileges user.</li><li>Copy the <code>PHPSESSID</code> cookie value and the value of the <code>__vtrftk</code> parameter used in the requests.</li><li>Execute the following POST request exporting the target Vtiger CRM domain, the low privileges user cookie and a valid anti-CSRF token:</li></ol><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl><span class=nb>export</span> <span class=nv>RHOST</span><span class=o>=</span>https://TARGET
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>COOKIE</span><span class=o>=</span>&lt;cookie&gt;
</span></span><span class=line><span class=cl><span class=nb>export</span> <span class=nv>TOKEN</span><span class=o>=</span>&lt;csrf-token&gt;
</span></span><span class=line><span class=cl>curl -s --b <span class=s2>&#34;PHPSESSID=</span><span class=si>${</span><span class=nv>COOKIE</span><span class=si>}</span><span class=s2>&#34;</span> --data-binary <span class=s2>&#34;__vtrftk=</span><span class=si>${</span><span class=nv>TOKEN</span><span class=si>}</span><span class=s2>&amp;module=Migration&amp;modulesList[]=Accounts&amp;action=DisableModules&#34;</span> <span class=s2>&#34;</span><span class=si>${</span><span class=nv>RHOST</span><span class=si>}</span><span class=s2>/index.php&#34;</span>
</span></span></code></pre></td></tr></table></div></div><ol start=4><li>Notice the <code>302 Found</code> HTTP response, meaning the module <code>Accounts</code> has been correctly disabled.</li></ol><h3 id=impact>Impact</h3><p>An authenticated attacker could disable arbitrary modules to cause a service disruption.</p><h3 id=remediation>Remediation</h3><p>Upgrade to <a href=https://sourceforge.net/projects/vtigercrm/files/vtiger%20CRM%208.2.0/ target=_blank rel="noopener noreferrer">Vtiger CRM 8.2.0</a> or later.</p><p>Patched in <a href=https://code.vtiger.com/vtiger/vtigercrm/-/commit/c80a3c733758c8aafd3e60af08cb132ef6df6c4f target=_blank rel="noopener noreferrer">commit</a>.</p><h2 id=disclosure-timeline>Disclosure timeline</h2><p>This report was subject to Shielder&rsquo;s <a href=https://shielder.it/research/disclosure_policy target=_blank rel="noopener noreferrer">disclosure policy</a>:</p><ul><li>09/02/2024: initial report is sent to <a href=mailto:support@vtiger.com>support@vtiger.com</a>.</li><li>16/02/2024: Vtiger acknowledges the issue and begins the triage process.</li><li>20/03/2024: Vtiger is able to reproduce the issue and develops a patch.</li><li>15/05/2024: Vtiger publishes the patched version the code.</li><li>28/08/2024: Shielder&rsquo;s advisory is published.</li></ul><h2 id=credits>Credits</h2><ul><li>Mattia `<a href=https://twitter.com/Mindlaess_ target=_blank rel="noopener noreferrer">Mindless</a>` Ricciardi</li><li>Paolo `<a href=https://twitter.com/Paupu_95 target=_blank rel="noopener noreferrer">paupu</a>` CavagliÃ </li><li>Davide `<a href=https://thezero.org target=_blank rel="noopener noreferrer">TheZero</a>` Silvetti</li></ul><p class="font-weight-bold smaller mt-4">This advisory was first published on https://www.shielder.com/advisories/vtiger-migration-bac/</p></div><div class="col-12 col-lg-3 offset-lg-1 order-first order-lg-last mb-5 mb-lg-0"><div class=row><div class="col-12 my-4"><p class=mb-0><i class="fas fa-folder text-primary pr-2"></i>
<span class="badge badge-pill border text-muted border-primary text-uppercase mb-2 mr-1"><a class="smaller text-decoration-none text-muted" href=/types/advisory>Advisory</a></span></p></div><div class="col-12 mb-4"><p class="text-muted text-uppercase smaller mb-1">Date</p><p class="font-weight-bold text-uppercase mb-0">28 August 2024</p></div></div></div></div></div></section><footer class="pt-5 pb-4 px-3 px-md-0"><div class=container><div class="row text-center"><div class="col-12 col-lg-4 text-white border-bottom mb-4 pb-lg-0 mb-lg-0"><p class="text-uppercase font-weight-bold">Info</p><p class=footer-info>Shielder S.p.A.</p><p class=footer-info>P.I. 11435310013</p><p class=footer-info>REA TO - 1213132</p><p class=footer-info>Registered Capital: 81.000,00 â¬</p><p><a class="text-decoration-none text-white" target=_blank rel=noopener href="https://www.google.it/maps/place/Shielder/@44.8833849,7.3303863,17z/data=!3m1!4b1!4m5!3m4!1s0x4788250440849fa5:0x74cf10f2092abc85!8m2!3d44.8833849!4d7.332575" title="corporate headquarters">Via
Palestro, 1/C<br>10064 Pinerolo (TO) Italy</a></p><div class="iso-logos row justify-content-center mb-4 pb-lg-0 mb-lg-0"><div class=col-3><img alt=ISO27001 src=/img/iso27001.png></div><div class=col-3><img alt=ISO9001 src=/img/iso9001.png></div></div></div><div class="col-12 col-lg-4 text-white border-bottom mb-4 pb-lg-0 mb-lg-0"><p class="text-uppercase font-weight-bold">Contacts</p><p class=footer-contact><a class="text-decoration-none text-white" href=mailto:info@shielder.com title="email Shielder">info@shielder.com</a></p><p class=footer-contact>Landline:
<a class="text-decoration-none text-white" href=tel:+390121393642 title=Landline>(+39) 0121 - 39 36 42</a></p><p class=footer-contact>Commercial:
<a class="text-decoration-none text-white" href=tel:+393453031983 title=Commercial>(+39) 345 - 30 31 983</a></p><p class=footer-contact>Technical:
<a class="text-decoration-none text-white" href=tel:+393931666814 title=Technical>(+39) 393 - 16 66 814</a></p><p><span><a href=https://twitter.com/ShielderSec title="Shielder Twitter profile" target=_blank rel="noopener me" class=text-white><i class="fab fa-x-twitter bigger-icon"></i></a>
</span><span class=pl-3><a href=https://infosec.exchange/@Shielder title="Shielder Mastodon profile" target=_blank rel="noopener me" class=text-white><i class="fab fa-mastodon bigger-icon"></i></a>
</span><span class=px-3><a href=https://www.linkedin.com/company/shielder title="Shielder LinkedIn profile" target=_blank rel="noopener me" class=text-white><i class="fab fa-linkedin bigger-icon"></i></a>
</span><span><a href=https://github.com/shieldersec title="Shielder Github profile" target=_blank rel="noopener me" class=text-white><i class="fab fa-github bigger-icon"></i></a></span></p></div><div class="col-12 col-lg-4 text-white mb-4 pb-lg-0 mb-lg-0"><p class="text-uppercase font-weight-bold">Sitemap</p><p><a class="text-decoration-none text-white" title=Home href=https://www.shielder.com/>Home</a></p><p><a class="text-decoration-none text-white" title=Company href=https://www.shielder.com/company>Company</a></p><p><a class="text-decoration-none text-white" title=Services href=https://www.shielder.com/services>Services</a></p><p><a class="text-decoration-none text-white" title=Advisories href=https://www.shielder.com/advisories>Advisories</a></p><p><a class="text-decoration-none text-white" title=Blog href=https://www.shielder.com/blog>Blog</a></p><p><a class="text-decoration-none text-white" title=Careers href=https://www.shielder.com/careers>Careers</a></p><p><a class="text-decoration-none text-white" title=Contacts href=https://www.shielder.com/contacts>Contacts</a></p></div><div class="col-12 mt-5"><span class="mb-2 mb-lg-0 border-md-right pr-2 text-white d-block d-lg-inline">Copyright Â© Shielder 2014 - 2024</span>
<span class="mb-2 mb-lg-0 border-md-right pr-2 pl-1 text-white d-block d-lg-inline"><a class="text-decoration-none text-white" href=/disclosure-policy title="Disclosure Policy">Disclosure policy</a></span>
<span class="mb-2 mb-lg-0 pr-2 pl-1 text-white d-block d-lg-inline"><a class="text-decoration-none text-white" href=/privacy-policy title="Privacy Policy">Privacy policy</a></span></div></div></div></footer><script src=https://www.shielder.com/js/jquery.min.js></script><script src=https://www.shielder.com/js/app.js></script><script src=https://www.shielder.com/js/bootstrap.bundle.min.js></script></body></html>