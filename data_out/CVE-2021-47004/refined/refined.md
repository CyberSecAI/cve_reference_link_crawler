```
{
  "CVE-2021-47004": {
    "description": "In CP disabling mode, there are two issues when using LFS or SSR | AT_SSR mode to select victim:\n1. LFS is set to find source section during GC, the victim should have no checkpointed data, since after GC, section could not be set free for reuse. Previously, we only check valid chpt blocks in current segment rather than section, fix it.\n2. SSR | AT_SSR are set to find target segment for writes which can be fully filled by checkpointed and newly written blocks, we should never select such segment, otherwise it can cause panic or data corruption during allocation. A potential case is described as follows: a) target segment has 'n' (n < 512) ckpt valid blocks; b) GC migrates 'n' valid blocks to other segment (segment is still in dirty list); c) GC migrates '512 - n' blocks to target segment (segment has 'n' cp_vblocks and '512 - n' vblocks); d) If GC selects target segment via {AT,}SSR allocator, however there is no free space in targe segment.",
    "root_cause": "The f2fs garbage collection (GC) mechanism, when checkpoint disabling is enabled, incorrectly selects victim segments for garbage collection, leading to potential data corruption or system panic.",
    "weaknesses": [
      "Incorrect handling of checkpointed data during garbage collection.",
      "Insufficient checks for free space in target segments."
    ],
    "impact": "Data corruption or system panic due to incorrect segment selection during garbage collection in f2fs.",
    "attack_vectors": "Exploitation occurs when the f2fs file system operates with checkpoint disabling enabled and uses either LFS or SSR/AT_SSR modes for segment selection during garbage collection.",
    "required_capabilities": "Attacker needs to have the ability to trigger garbage collection on an f2fs filesystem with checkpoint disabling enabled, and have the ability to control the filesystem operations that lead to the conditions that trigger the vulnerability."
  }
}
```