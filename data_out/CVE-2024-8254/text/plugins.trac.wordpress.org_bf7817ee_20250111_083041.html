

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Femail-subscribers%2Ftags%2F5.7.29%2Flite%2Fincludes%2Fclass-es-common.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3098321 "Revision 3098321")
* [Next Revision](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?rev=3150435 "Revision 3150435") →
* [Blame](/browser/email-subscribers/trunk/lite/includes/class-es-common.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/email-subscribers/tags/5.7.29/lite/includes/class-es-common.php)

---

# [source:](/browser?order=name "Go to repository root") [email-subscribers](/browser/email-subscribers?order=name "View email-subscribers")/[tags](/browser/email-subscribers/tags?order=name "View tags")/[5.7.29](/browser/email-subscribers/tags/5.7.29?order=name "View 5.7.29")/[lite](/browser/email-subscribers/tags/5.7.29/lite?order=name "View lite")/[includes](/browser/email-subscribers/tags/5.7.29/lite/includes?order=name "View includes")/[class-es-common.php](/browser/email-subscribers/tags/5.7.29/lite/includes/class-es-common.php?order=name "View class-es-common.php")

View diff against:

View revision:

| [Last change](/changeset/3104864/email-subscribers/trunk/lite/includes/class-es-common.php "View differences") on this file was [3104864](/changeset/3104864/ "View changeset 3104864"), checked in by Icegram, [7 months ago](/timeline?from=2024-06-20T06%3A12%3A06Z&precision=second "See timeline at 06/20/2024 06:12:06 AM") |
| --- |
| Preparing for 5.7.25 release |
| **File size:** 87.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | // Exit if accessed directly |
| [4](#L4) | if ( ! defined( 'ABSPATH' ) ) { |
| [5](#L5) | exit; |
| [6](#L6) | } |
| [7](#L7) |  |
| [8](#L8) | /\*\* |
| [9](#L9) | \* Class Email\_General. |
| [10](#L10) | \* |
| [11](#L11) | \* @since 4.0 |
| [12](#L12) | \*/ |
| [13](#L13) | class ES\_Common { |
| [14](#L14) | /\*\* |
| [15](#L15) | \* Convert email subscribe templates. |
| [16](#L16) | \* |
| [17](#L17) | \* @param string $template Get email subscribe templates. |
| [18](#L18) | \* @param string $name Get subscriber name. |
| [19](#L19) | \* @param string $email Get subscriber email. |
| [20](#L20) | \* |
| [21](#L21) | \* @return string $convert\_template |
| [22](#L22) | \* |
| [23](#L23) | \* @since 4.0 |
| [24](#L24) | \*/ |
| [25](#L25) | public static function convert\_es\_templates( $template, $name, $email, $es\_templ\_id = 0 ) { |
| [26](#L26) | $convert\_template = str\_replace( '{{NAME}}', $name, $template ); |
| [27](#L27) | $convert\_template = str\_replace( '{{EMAIL}}', $email, $convert\_template ); |
| [28](#L28) |  |
| [29](#L29) | return $convert\_template; |
| [30](#L30) | } |
| [31](#L31) |  |
| [32](#L32) |  |
| [33](#L33) | /\*\* |
| [34](#L34) | \* Collect all emails. |
| [35](#L35) | \* |
| [36](#L36) | \* @return string $all\_admin\_email |
| [37](#L37) | \* |
| [38](#L38) | \* @since 5.3.18 |
| [39](#L39) | \*/ |
| [40](#L40) | public static function get\_admin\_email() { |
| [41](#L41) | $admin\_email     = get\_option( 'ig\_es\_admin\_emails', '' ); |
| [42](#L42) | $all\_admin\_email = explode(',', $admin\_email); |
| [43](#L43) |  |
| [44](#L44) | return $all\_admin\_email[0]; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) |  |
| [48](#L48) | /\*\* |
| [49](#L49) | \* Count sent emails |
| [50](#L50) | \* |
| [51](#L51) | \* @return int $total\_emails\_sent |
| [52](#L52) | \* |
| [53](#L53) | \* @since 5.3.18 |
| [54](#L54) | \*/ |
| [55](#L55) | public static function count\_sent\_emails() { |
| [56](#L56) | $current\_date = ig\_es\_get\_current\_date(); |
| [57](#L57) | $current\_hour = ig\_es\_get\_current\_hour(); |
| [58](#L58) |  |
| [59](#L59) | // Get total emails sent in this hour |
| [60](#L60) | $email\_sent\_data = self::get\_ig\_option( 'email\_sent\_data', array() ); |
| [61](#L61) |  |
| [62](#L62) | $total\_emails\_sent = 0; |
| [63](#L63) | if ( is\_array( $email\_sent\_data ) && ! empty( $email\_sent\_data[ $current\_date ] ) && ! empty( $email\_sent\_data[ $current\_date ][ $current\_hour ] ) ) { |
| [64](#L64) | $total\_emails\_sent = $email\_sent\_data[ $current\_date ][ $current\_hour ]; |
| [65](#L65) | } |
| [66](#L66) |  |
| [67](#L67) | return $total\_emails\_sent; |
| [68](#L68) | } |
| [69](#L69) |  |
| [70](#L70) | /\*\* |
| [71](#L71) | \* Process the email template and get variable fallbacks |
| [72](#L72) | \* |
| [73](#L73) | \* @param $template |
| [74](#L74) | \*/ |
| [75](#L75) | public static function get\_template\_fallbacks( $template ) { |
| [76](#L76) | preg\_match\_all( '/{{(.\*?)}}/', $template, $matches ); |
| [77](#L77) | $default\_keywords = array(); |
| [78](#L78) | if ( 1 < count( $matches ) ) { |
| [79](#L79) | $fallback\_matches = $matches[1]; |
| [80](#L80) | foreach ( $fallback\_matches as $keyword ) { |
| [81](#L81) | if ( strstr( $keyword, '|' ) ) { |
| [82](#L82) | list( $variable\_name, $variable\_params ) = explode( '|', $keyword, 2 ); |
| [83](#L83) | } else { |
| [84](#L84) | $variable\_name   = $keyword; |
| [85](#L85) | $variable\_params = ''; |
| [86](#L86) | } |
| [87](#L87) | $variable\_name = trim( $variable\_name ); |
| [88](#L88) | $variable      = new IG\_ES\_Workflow\_Variable\_Parser(); |
| [89](#L89) | $parameters    = $variable->parse\_parameters\_from\_string( trim( $variable\_params ) ); |
| [90](#L90) | if ( is\_array( $parameters ) && ! empty( $parameters ) ) { |
| [91](#L91) | if ( isset( $parameters['fallback'] ) && ! empty( $parameters['fallback'] ) ) { |
| [92](#L92) | $replace\_with\_fallback = self::un\_quote( $parameters['fallback'] ); |
| [93](#L93) | $is\_nested\_variable    = strpos( $variable\_name, '.' ); // Check if variable has dont(.) in its name |
| [94](#L94) | if ( $is\_nested\_variable ) { |
| [95](#L95) | $variable\_parts = explode( '.', $variable\_name ); |
| [96](#L96) | $variable\_type  = $variable\_parts[0]; |
| [97](#L97) | $variable\_slug  = $variable\_parts[1]; |
| [98](#L98) | /\*\* |
| [99](#L99) | \* For variables like subscribers.name, we need to pass the fallback data as nested array |
| [100](#L100) | \* $default\_keywords['subscribers']['name'] = fallback\_value |
| [101](#L101) | \*\*/ |
| [102](#L102) | $default\_keywords[ $variable\_type ][ $variable\_slug ] = $replace\_with\_fallback; |
| [103](#L103) | } else { |
| [104](#L104) | $default\_keywords[ $variable\_name ] = $replace\_with\_fallback; |
| [105](#L105) | } |
| [106](#L106) | } |
| [107](#L107) | } |
| [108](#L108) | } |
| [109](#L109) | } |
| [110](#L110) | return $default\_keywords; |
| [111](#L111) | } |
| [112](#L112) |  |
| [113](#L113) |  |
| [114](#L114) | /\*\* |
| [115](#L115) | \* Callback to replace keywords |
| [116](#L116) | \* |
| [117](#L117) | \* @param $keyword |
| [118](#L118) | \* @param $search\_and\_replace |
| [119](#L119) | \* |
| [120](#L120) | \* @return mixed|string |
| [121](#L121) | \*/ |
| [122](#L122) | public static function callback\_replace\_keywords( $keyword, $search\_and\_replace ) { |
| [123](#L123) | if ( strstr( $keyword, '|' ) ) { |
| [124](#L124) | list( $variable\_name, $variable\_params ) = explode( '|', $keyword, 2 ); |
| [125](#L125) | } else { |
| [126](#L126) | $variable\_name   = $keyword; |
| [127](#L127) | $variable\_params = ''; |
| [128](#L128) | } |
| [129](#L129) | $variable\_name = trim( $variable\_name ); |
| [130](#L130) |  |
| [131](#L131) | //If there is no key found in replaceable array, then return the keyword |
| [132](#L132) | if ( ! isset( $search\_and\_replace[ $variable\_name ] ) ) { |
| [133](#L133) | return '{{' . $keyword . '}}'; |
| [134](#L134) | } |
| [135](#L135) |  |
| [136](#L136) | $replace\_with          = $search\_and\_replace[ $variable\_name ]; |
| [137](#L137) | $replace\_with\_fallback = ''; |
| [138](#L138) |  |
| [139](#L139) | //Extract fallback content from the keyword |
| [140](#L140) | $variable   = new IG\_ES\_Workflow\_Variable\_Parser(); |
| [141](#L141) | $parameters = $variable->parse\_parameters\_from\_string( trim( $variable\_params ) ); |
| [142](#L142) | if ( is\_array( $parameters ) && ! empty( $parameters ) ) { |
| [143](#L143) | if ( isset( $parameters['fallback'] ) && ! empty( $parameters['fallback'] ) ) { |
| [144](#L144) | $replace\_with\_fallback = self::un\_quote($parameters['fallback']); |
| [145](#L145) | } |
| [146](#L146) | } |
| [147](#L147) |  |
| [148](#L148) | //If replaceable value is contain fallback keyword, then return the replaceable value with fallback value |
| [149](#L149) | if ( strstr( $replace\_with, '%%fallback%%' ) ) { |
| [150](#L150) | return str\_replace( '%%fallback%%', $replace\_with\_fallback, $replace\_with ); |
| [151](#L151) | } |
| [152](#L152) |  |
| [153](#L153) | //If replaceable value is not empty, then return the replaceable value |
| [154](#L154) | if ( ! empty( $replace\_with ) ) { |
| [155](#L155) | return $replace\_with; |
| [156](#L156) | } |
| [157](#L157) |  |
| [158](#L158) | // return fallback value |
| [159](#L159) | return $replace\_with\_fallback; |
| [160](#L160) | } |
| [161](#L161) |  |
| [162](#L162) | /\*\* |
| [163](#L163) | \* Decode the html quotes |
| [164](#L164) | \* |
| [165](#L165) | \* @param $string |
| [166](#L166) | \* |
| [167](#L167) | \* @return string |
| [168](#L168) | \*/ |
| [169](#L169) | public static function decode\_html\_quotes( $string ) { |
| [170](#L170) | $entities\_dictionary = [ |
| [171](#L171) | '&#145;'  => "'", // Opening single quote |
| [172](#L172) | '&#146;'  => "'", // Closing single quote |
| [173](#L173) | '&#147;'  => '"', // Closing double quote |
| [174](#L174) | '&#148;'  => '"', // Opening double quote |
| [175](#L175) | '&#8216;' => "'", // Closing single quote |
| [176](#L176) | '&#8217;' => "'", // Opening single quote |
| [177](#L177) | '&#8218;' => "'", // Single low quote |
| [178](#L178) | '&#8220;' => '"', // Closing double quote |
| [179](#L179) | '&#8221;' => '"', // Opening double quote |
| [180](#L180) | '&#8222;' => '"', // Double low quote |
| [181](#L181) | ]; |
| [182](#L182) |  |
| [183](#L183) | // Decode decimal entities |
| [184](#L184) | $string = str\_replace( array\_keys( $entities\_dictionary ), array\_values( $entities\_dictionary ), $string ); |
| [185](#L185) |  |
| [186](#L186) | return html\_entity\_decode( $string, ENT\_QUOTES | ENT\_HTML5, 'UTF-8' ); |
| [187](#L187) | } |
| [188](#L188) |  |
| [189](#L189) | /\*\* |
| [190](#L190) | \* Remove quotes from string |
| [191](#L191) | \* |
| [192](#L192) | \* @param $string |
| [193](#L193) | \* |
| [194](#L194) | \* @return string |
| [195](#L195) | \*/ |
| [196](#L196) | public static function un\_quote( $string ) { |
| [197](#L197) | $string = self::decode\_html\_quotes( $string ); |
| [198](#L198) |  |
| [199](#L199) | return trim( trim( $string ), "'" ); |
| [200](#L200) | } |
| [201](#L201) |  |
| [202](#L202) | /\*\* |
| [203](#L203) | \* Parse keywords |
| [204](#L204) | \* |
| [205](#L205) | \* @since 5.3.5 |
| [206](#L206) | \* @return false|void |
| [207](#L207) | \*/ |
| [208](#L208) | public static function replace\_keywords\_with\_fallback( $content, $search\_and\_replace ) { |
| [209](#L209) | if ( empty( $content ) || empty( $search\_and\_replace ) ) { |
| [210](#L210) | return $content; |
| [211](#L211) | } |
| [212](#L212) | $replacer = new IG\_ES\_Replace\_Helper( $content, 'ES\_Common::callback\_replace\_keywords', 'variables', $search\_and\_replace ); |
| [213](#L213) |  |
| [214](#L214) | $processed\_content = $replacer->process(); |
| [215](#L215) |  |
| [216](#L216) | if ( $processed\_content ) { |
| [217](#L217) | return $processed\_content; |
| [218](#L218) | } |
| [219](#L219) |  |
| [220](#L220) | return $content; |
| [221](#L221) | } |
| [222](#L222) |  |
| [223](#L223) | /\*\* |
| [224](#L224) | \* Process template body |
| [225](#L225) | \* |
| [226](#L226) | \* @param $content |
| [227](#L227) | \* @param int     $tmpl\_id |
| [228](#L228) | \* @param int     $campaign\_id |
| [229](#L229) | \* |
| [230](#L230) | \* @return mixed|string |
| [231](#L231) | \* |
| [232](#L232) | \* @since 4.0.0 |
| [233](#L233) | \*/ |
| [234](#L234) | public static function es\_process\_template\_body( $content, $tmpl\_id = 0, $campaign\_id = 0 ) { |
| [235](#L235) |  |
| [236](#L236) | $content = convert\_smilies( wptexturize( $content ) ); |
| [237](#L237) | $content = self::handle\_oembed\_content( $content ); |
| [238](#L238) |  |
| [239](#L239) | // Add p tag only if we aren't getting <html> tags inside the content, otherwise html gets marked as invalid. |
| [240](#L240) | if ( false === strpos( $content, '<html' ) ) { |
| [241](#L241) | $content = wpautop( $content ); |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | $content             = do\_shortcode( shortcode\_unautop( $content ) ); |
| [245](#L245) | $data                = array(); |
| [246](#L246) | $data['content']     = $content; |
| [247](#L247) | $data['tmpl\_id']     = $tmpl\_id; |
| [248](#L248) | $data['campaign\_id'] = $campaign\_id; |
| [249](#L249) | $data                = apply\_filters( 'es\_after\_process\_template\_body', $data ); |
| [250](#L250) | $content             = $data['content']; |
| [251](#L251) | // total contacts |
| [252](#L252) | $total\_contacts = ES()->contacts\_db->count\_active\_contacts\_by\_list\_id(); |
| [253](#L253) | $content        = str\_replace( '{{TOTAL-CONTACTS}}', $total\_contacts, $content ); |
| [254](#L254) | $content        = str\_replace( '{{site.total\_contacts}}', $total\_contacts, $content ); |
| [255](#L255) | // blog title |
| [256](#L256) | $blog\_name = get\_option( 'blogname' ); |
| [257](#L257) | $content   = str\_replace( '{{SITENAME}}', $blog\_name, $content ); |
| [258](#L258) | $content   = str\_replace( '{{site.name}}', $blog\_name, $content ); |
| [259](#L259) | // site url |
| [260](#L260) | $site\_url = home\_url( '/' ); |
| [261](#L261) | $content  = str\_replace( '{{SITEURL}}', $site\_url, $content ); |
| [262](#L262) | $content  = str\_replace( '{{site.url}}', $site\_url, $content ); |
| [263](#L263) |  |
| [264](#L264) | /\* |
| [265](#L265) | TODO: Enable it once Pre header issue fix |
| [266](#L266) | $meta = ES()->campaigns\_db->get\_campaign\_meta\_by\_id( $campaign\_id ); |
| [267](#L267) | $meta['pre\_header'] = !empty($meta['pre\_header']) ? $meta['pre\_header'] : ''; |
| [268](#L268) | if( !empty( $meta['pre\_header'] )){ |
| [269](#L269) | $content = '<span class="es\_preheader" style="display: none !important; visibility: hidden; opacity: 0; color: transparent; height: 0; width: 0;">'.$meta['pre\_header'].'</span>'.$content; |
| [270](#L270) | } |
| [271](#L271) | \*/ |
| [272](#L272) |  |
| [273](#L273) | return $content; |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | /\*\* |
| [277](#L277) | \* Method to handle oembed content |
| [278](#L278) | \* |
| [279](#L279) | \* @param string @content Content. |
| [280](#L280) | \* |
| [281](#L281) | \* @return string $content |
| [282](#L282) | \* |
| [283](#L283) | \* @since 4.4.9 |
| [284](#L284) | \*/ |
| [285](#L285) | public static function handle\_oembed\_content( $content = '' ) { |
| [286](#L286) |  |
| [287](#L287) | if ( ! empty( $content ) && isset( $GLOBALS['wp\_embed'] ) ) { |
| [288](#L288) | add\_filter( 'embed\_oembed\_html', array( 'ES\_Common', 'handle\_link\_in\_email\_content' ), 10, 4 ); |
| [289](#L289) | add\_filter( 'embed\_handler\_html', array( 'ES\_Common', 'handle\_link\_in\_email\_content' ), 10, 3 ); |
| [290](#L290) | $content = $GLOBALS['wp\_embed']->autoembed( $content ); |
| [291](#L291) | remove\_filter( 'embed\_oembed\_html', array( 'ES\_Common', 'handle\_link\_in\_email\_content' ), 10, 4 ); |
| [292](#L292) | remove\_filter( 'embed\_handler\_html', array( 'ES\_Common', 'handle\_link\_in\_email\_content' ), 10, 3 ); |
| [293](#L293) | } |
| [294](#L294) |  |
| [295](#L295) | return $content; |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) |  |
| [299](#L299) | /\*\* |
| [300](#L300) | \* Method to handle link in email content |
| [301](#L301) | \* |
| [302](#L302) | \* URL from {{POSTLINK-ONLY}} was being converted to oembed html if it is not wrapped inside <a> tag's href attribute and is on a seperate line in ES template content |
| [303](#L303) | \* resulting in a link html for {{POSTLINK-ONLY}} instead of plain text link. |
| [304](#L304) | \* |
| [305](#L305) | \* Most email clients like GMail, Outlook do not support videos in the email. To handle it, we are replacing the WordPress's oembed generated HTML for video links to their respective thubmnail images which are then linked the original video URL. |
| [306](#L306) | \* |
| [307](#L307) | \* @param string $html HTML for current URL. |
| [308](#L308) | \* @param string $url Current URL. |
| [309](#L309) | \* @param array  $attr Shortcode attribute. |
| [310](#L310) | \* @param int    $post\_ID Current post id. |
| [311](#L311) | \* |
| [312](#L312) | \* @return string $html HTML for current URL. |
| [313](#L313) | \* |
| [314](#L314) | \* @since 4.4.9 |
| [315](#L315) | \*/ |
| [316](#L316) | public static function handle\_link\_in\_email\_content( $html, $url, $attr, $post\_ID = 0 ) { |
| [317](#L317) |  |
| [318](#L318) | $post\_link = ''; |
| [319](#L319) |  |
| [320](#L320) | if ( ! empty( $post\_ID ) ) { |
| [321](#L321) | $post\_link = get\_permalink( $post\_ID ); |
| [322](#L322) | } |
| [323](#L323) |  |
| [324](#L324) | // Check if current URL is same as current post's permalink. |
| [325](#L325) | if ( ! empty( $post\_link ) && $url === $post\_link ) { |
| [326](#L326) | // Convert URL HTML back to URL itself if it a current post URL. |
| [327](#L327) | $html = $url; |
| [328](#L328) | } else { |
| [329](#L329) |  |
| [330](#L330) | if ( ! class\_exists( 'WP\_oEmbed' ) ) { |
| [331](#L331) | require\_once ABSPATH . 'wp-includes/class-wp-oembed.php'; |
| [332](#L332) | } |
| [333](#L333) |  |
| [334](#L334) | $oembed   = new WP\_oEmbed(); |
| [335](#L335) | $provider = $oembed->get\_provider( $url ); |
| [336](#L336) | if ( ! empty( $provider ) ) { |
| [337](#L337) | $oembed\_response = $oembed->fetch( $provider, $url, $attr ); |
| [338](#L338) | if ( is\_object( $oembed\_response ) && ! empty( $oembed\_response->type ) && 'video' === $oembed\_response->type && ! empty( $oembed\_response->thumbnail\_url ) ) { |
| [339](#L339) | $thumbnail\_url = $oembed\_response->thumbnail\_url; |
| [340](#L340) | $title         = $oembed\_response->title; |
| [341](#L341) | $provider\_name = $oembed\_response->provider\_name; |
| [342](#L342) | $play\_icon\_url = ''; |
| [343](#L343) |  |
| [344](#L344) | switch ( $provider\_name ) { |
| [345](#L345) | case 'YouTube': |
| [346](#L346) | $play\_icon\_url = ES\_PLUGIN\_URL . 'lite/public/images/youtube-play-button.png'; |
| [347](#L347) | break; |
| [348](#L348) |  |
| [349](#L349) | case 'Vimeo': |
| [350](#L350) | $play\_icon\_url = ES\_PLUGIN\_URL . 'lite/public/images/vimeo-play-button.png'; |
| [351](#L351) | break; |
| [352](#L352) |  |
| [353](#L353) | default: |
| [354](#L354) | $play\_icon\_url = ES\_PLUGIN\_URL . 'lite/public/images/default-play-button.png'; |
| [355](#L355) | break; |
| [356](#L356) | } |
| [357](#L357) |  |
| [358](#L358) | ob\_start(); |
| [359](#L359) | $thumbnail\_width  = 'auto'; |
| [360](#L360) | $thumbnail\_height = 'auto'; |
| [361](#L361) |  |
| [362](#L362) | if ( ! empty( $oembed\_response->thumbnail\_width ) && ! empty( $oembed\_response->thumbnail\_height ) ) { |
| [363](#L363) | $thumbnail\_width  = $oembed\_response->thumbnail\_width . 'px'; |
| [364](#L364) | $thumbnail\_height = $oembed\_response->thumbnail\_height . 'px'; |
| [365](#L365) | } elseif ( ! empty( $oembed\_response->width ) && ! empty( $oembed\_response->height ) ) { |
| [366](#L366) | $thumbnail\_width  = $oembed\_response->width . 'px'; |
| [367](#L367) | $thumbnail\_height = $oembed\_response->height . 'px'; |
| [368](#L368) | } |
| [369](#L369) | ?> |
| [370](#L370) | <table style="margin-bottom: 1em;"> |
| [371](#L371) | <tbody> |
| [372](#L372) | <tr> |
| [373](#L373) | <td style="background-image: url('<?php echo esc\_url( $thumbnail\_url ); ?>');height:<?php echo esc\_attr( $thumbnail\_height ); ?>;width:<?php echo esc\_attr( $thumbnail\_width ); ?>;background-size: 100% 100%;background-repeat: no-repeat;text-align:center;"> |
| [374](#L374) | <a href="<?php echo esc\_url( $url ); ?>" title="<?php echo esc\_attr( $title ); ?>" |
| [375](#L375) | target="\_blank"> |
| [376](#L376) | <img src="<?php echo esc\_url( $play\_icon\_url ); ?>" |
| [377](#L377) | style="height: 75px; margin: auto;"> |
| [378](#L378) | </a> |
| [379](#L379) | </td> |
| [380](#L380) | </tr> |
| [381](#L381) | </tbody> |
| [382](#L382) | </table> |
| [383](#L383) | <?php |
| [384](#L384) | $html = ob\_get\_clean(); |
| [385](#L385) | } |
| [386](#L386) | } |
| [387](#L387) | } |
| [388](#L388) |  |
| [389](#L389) | return $html; |
| [390](#L390) | } |
| [391](#L391) |  |
| [392](#L392) | /\*\* |
| [393](#L393) | \* Get Statuses key name map |
| [394](#L394) | \* |
| [395](#L395) | \* @param bool $reverse |
| [396](#L396) | \* @param string $page |
| [397](#L397) | \* |
| [398](#L398) | \* @return array |
| [399](#L399) | \* |
| [400](#L400) | \* @since 4.0.0 |
| [401](#L401) | \*/ |
| [402](#L402) | public static function get\_statuses\_key\_name\_map( $reverse = false, $page = '') { |
| [403](#L403) |  |
| [404](#L404) | $statuses = array( |
| [405](#L405) | 'subscribed'   => \_\_( 'Subscribed', 'email-subscribers' ), |
| [406](#L406) | 'unconfirmed'  => \_\_( 'Unconfirmed', 'email-subscribers' ), |
| [407](#L407) | 'unsubscribed' => \_\_( 'Unsubscribed', 'email-subscribers' ), |
| [408](#L408) | ); |
| [409](#L409) |  |
| [410](#L410) | $statuses = apply\_filters( 'ig\_es\_get\_statuses\_key\_name\_map', $statuses, $page ); |
| [411](#L411) | if ( $reverse ) { |
| [412](#L412) | $statuses = array\_flip( $statuses ); |
| [413](#L413) | } |
| [414](#L414) |  |
| [415](#L415) | return $statuses; |
| [416](#L416) | } |
| [417](#L417) |  |
| [418](#L418) | /\*\* |
| [419](#L419) | \* Prepare Statuses dropdown |
| [420](#L420) | \* |
| [421](#L421) | \* @param string $selected |
| [422](#L422) | \* @param string $default\_label |
| [423](#L423) | \* |
| [424](#L424) | \* @return string |
| [425](#L425) | \* |
| [426](#L426) | \* @since 4.0.0 |
| [427](#L427) | \*/ |
| [428](#L428) | public static function prepare\_statuses\_dropdown\_options( $selected = '', $default\_label = '', $page = '' ) { |
| [429](#L429) |  |
| [430](#L430) | if ( empty( $default\_label ) ) { |
| [431](#L431) | $default\_label = \_\_( 'Select Status', 'email-subscribers' ); |
| [432](#L432) | } |
| [433](#L433) |  |
| [434](#L434) | $default\_status[0] = $default\_label; |
| [435](#L435) |  |
| [436](#L436) | $statuses = self::get\_statuses\_key\_name\_map(false, $page); |
| [437](#L437) | $statuses = array\_merge( $default\_status, $statuses ); |
| [438](#L438) |  |
| [439](#L439) | $dropdown = ''; |
| [440](#L440) | foreach ( $statuses as $key => $status ) { |
| [441](#L441) | $dropdown .= '<option class="text-sm" value="' . esc\_attr( $key ) . '" '; |
| [442](#L442) |  |
| [443](#L443) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [444](#L444) | $dropdown .= 'selected = selected'; |
| [445](#L445) | } |
| [446](#L446) |  |
| [447](#L447) | $dropdown .= '>' . esc\_html( $status ) . '</option>'; |
| [448](#L448) | } |
| [449](#L449) |  |
| [450](#L450) | return $dropdown; |
| [451](#L451) | } |
| [452](#L452) |  |
| [453](#L453) | /\*\* |
| [454](#L454) | \* Prepare list dropdown |
| [455](#L455) | \* |
| [456](#L456) | \* @param string $selected |
| [457](#L457) | \* @param string $default\_label |
| [458](#L458) | \* |
| [459](#L459) | \* @return string |
| [460](#L460) | \* |
| [461](#L461) | \* @since 4.0.0 |
| [462](#L462) | \*/ |
| [463](#L463) | public static function prepare\_list\_dropdown\_options( $selected = '', $default\_label = 'Select List' ) { |
| [464](#L464) |  |
| [465](#L465) | $default\_option[0] = \_\_( $default\_label, 'email-subscribers' ); |
| [466](#L466) |  |
| [467](#L467) | $lists    = ES()->lists\_db->get\_list\_id\_name\_map(); |
| [468](#L468) | $lists    = $default\_option + $lists; |
| [469](#L469) | $dropdown = ''; |
| [470](#L470) |  |
| [471](#L471) | if ( is\_string( $selected ) && strpos( $selected, ',' ) > 0 ) { |
| [472](#L472) | $selected = explode( ',', $selected ); |
| [473](#L473) | } |
| [474](#L474) |  |
| [475](#L475) | foreach ( $lists as $key => $list ) { |
| [476](#L476) |  |
| [477](#L477) | $dropdown .= '<option value="' . esc\_attr( $key ) . '" '; |
| [478](#L478) |  |
| [479](#L479) | if ( is\_array( $selected ) ) { |
| [480](#L480) | if ( in\_array( $key, $selected ) ) { |
| [481](#L481) | $dropdown .= 'selected = selected'; |
| [482](#L482) | } |
| [483](#L483) | } else { |
| [484](#L484) | if ( ! empty( $selected ) && $selected == $key ) { |
| [485](#L485) | $dropdown .= 'selected = selected'; |
| [486](#L486) | } |
| [487](#L487) | } |
| [488](#L488) |  |
| [489](#L489) | $dropdown .= '>' . esc\_html( $list ) . '</option>'; |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | return $dropdown; |
| [493](#L493) | } |
| [494](#L494) |  |
| [495](#L495) | /\*\* |
| [496](#L496) | \* Prepare dropdown with form names |
| [497](#L497) | \* |
| [498](#L498) | \* @param string $selected |
| [499](#L499) | \* @param string $default\_label |
| [500](#L500) | \* |
| [501](#L501) | \* @return string |
| [502](#L502) | \* |
| [503](#L503) | \* @since 4.2.0 |
| [504](#L504) | \* @since 4.3.2 Removed $where condition to find forms |
| [505](#L505) | \*/ |
| [506](#L506) | public static function prepare\_form\_dropdown\_options( $selected = '', $default\_label = 'Select Form' ) { |
| [507](#L507) |  |
| [508](#L508) | $forms = ES()->forms\_db->get\_id\_name\_map(); |
| [509](#L509) |  |
| [510](#L510) | if ( ! is\_null( $default\_label ) ) { |
| [511](#L511) | $default\_option[0] = \_\_( $default\_label, 'email-subscribers' ); |
| [512](#L512) | $forms             = $default\_option + $forms; |
| [513](#L513) | } |
| [514](#L514) |  |
| [515](#L515) | $dropdown = ''; |
| [516](#L516) | foreach ( $forms as $key => $form ) { |
| [517](#L517) | $dropdown .= '<option value="' . esc\_attr( $key ) . '" '; |
| [518](#L518) |  |
| [519](#L519) | if ( $selected == $key ) { |
| [520](#L520) | $dropdown .= 'selected = selected'; |
| [521](#L521) | } |
| [522](#L522) |  |
| [523](#L523) | $dropdown .= '>' . esc\_html( $form ) . '</option>'; |
| [524](#L524) | } |
| [525](#L525) |  |
| [526](#L526) | return $dropdown; |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) |  |
| [530](#L530) | /\*\* |
| [531](#L531) | \* Generate GUID |
| [532](#L532) | \* |
| [533](#L533) | \* @param int $length |
| [534](#L534) | \* |
| [535](#L535) | \* @return string |
| [536](#L536) | \* |
| [537](#L537) | \* @since 4.0.0 |
| [538](#L538) | \*/ |
| [539](#L539) | public static function generate\_guid( $length = 6 ) { |
| [540](#L540) |  |
| [541](#L541) | $str        = 'abcdefghijklmnopqrstuvwxyz'; |
| [542](#L542) | $random\_str = array(); |
| [543](#L543) | for ( $i = 1; $i <= 5; $i ++ ) { |
| [544](#L544) | $random\_str[] = substr( str\_shuffle( $str ), 0, $length ); |
| [545](#L545) | } |
| [546](#L546) |  |
| [547](#L547) | $guid = implode( '-', $random\_str ); |
| [548](#L548) |  |
| [549](#L549) | return $guid; |
| [550](#L550) | } |
| [551](#L551) |  |
| [552](#L552) |  |
| [553](#L553) | /\*\* |
| [554](#L554) | \* Generate random string |
| [555](#L555) | \* |
| [556](#L556) | \* @param int $length |
| [557](#L557) | \* |
| [558](#L558) | \* @return string |
| [559](#L559) | \* |
| [560](#L560) | \* @since 4.8.2 |
| [561](#L561) | \*/ |
| [562](#L562) | public static function generate\_random\_string( $length = 6 ) { |
| [563](#L563) | $str = 'abcdefghijklmnopqrstuvwxyz'; |
| [564](#L564) |  |
| [565](#L565) | return substr( str\_shuffle( $str ), 0, $length ); |
| [566](#L566) | } |
| [567](#L567) |  |
| [568](#L568) | /\*\* |
| [569](#L569) | \* Prepare template dropdown options |
| [570](#L570) | \* |
| [571](#L571) | \* @param string $type |
| [572](#L572) | \* @param string $selected |
| [573](#L573) | \* |
| [574](#L574) | \* @return string |
| [575](#L575) | \*/ |
| [576](#L576) | public static function prepare\_templates\_dropdown\_options( $type = 'newsletter', $selected = '', $editor\_type = IG\_ES\_DRAG\_AND\_DROP\_EDITOR ) { |
| [577](#L577) |  |
| [578](#L578) | $default\_template\_option = new stdClass(); |
| [579](#L579) |  |
| [580](#L580) | $default\_template\_option->ID         = ''; |
| [581](#L581) | $default\_template\_option->post\_title = \_\_( 'Select Template', 'email-subscribers' ); |
| [582](#L582) |  |
| [583](#L583) | $default\_template\_option = array( $default\_template\_option ); |
| [584](#L584) |  |
| [585](#L585) | $templates   = self::get\_templates( $type, $editor\_type ); |
| [586](#L586) | $allowedtags = ig\_es\_allowed\_html\_tags\_in\_esc(); |
| [587](#L587) | if ( is\_array( $templates ) ) { |
| [588](#L588) | $templates = array\_merge( $default\_template\_option, $templates ); |
| [589](#L589) | } |
| [590](#L590) |  |
| [591](#L591) | $dropdown = ''; |
| [592](#L592) | foreach ( $templates as $key => $template ) { |
| [593](#L593) | $es\_templ\_thumbnail = ( ! empty( $template->ID ) ) ? get\_the\_post\_thumbnail\_url( |
| [594](#L594) | $template->ID, |
| [595](#L595) | array( |
| [596](#L596) | '200', |
| [597](#L597) | '200', |
| [598](#L598) | ) |
| [599](#L599) | ) : ES\_PLUGIN\_URL . 'images/envelope.png'; |
| [600](#L600) | $dropdown          .= "<option data-img-url='" . $es\_templ\_thumbnail . "' value='" . $template->ID . "'"; |
| [601](#L601) |  |
| [602](#L602) | if ( absint( $selected ) === absint( $template->ID ) ) { |
| [603](#L603) | $dropdown .= ' selected="selected"'; |
| [604](#L604) | } |
| [605](#L605) |  |
| [606](#L606) | $dropdown .= '>' . $template->post\_title . '</option>'; |
| [607](#L607) | } |
| [608](#L608) |  |
| [609](#L609) | return $dropdown; |
| [610](#L610) |  |
| [611](#L611) | } |
| [612](#L612) |  |
| [613](#L613) | /\*\* |
| [614](#L614) | \* Prepare status dropdown options |
| [615](#L615) | \* |
| [616](#L616) | \* @param $selected |
| [617](#L617) | \* |
| [618](#L618) | \* @return string |
| [619](#L619) | \* |
| [620](#L620) | \* @since 4.0.0 |
| [621](#L621) | \*/ |
| [622](#L622) | public static function prepare\_status\_dropdown\_options( $selected ) { |
| [623](#L623) | $statuses = array( |
| [624](#L624) | '1' => \_\_( 'Active', 'email-subscribers' ), |
| [625](#L625) | '0' => \_\_( 'Inactive', 'email-subscribers' ), |
| [626](#L626) | ); |
| [627](#L627) |  |
| [628](#L628) | $dropdown = ''; |
| [629](#L629) | foreach ( $statuses as $key => $status ) { |
| [630](#L630) | $dropdown .= '<option value="' . esc\_attr( $key ) . '" '; |
| [631](#L631) |  |
| [632](#L632) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [633](#L633) | $dropdown .= 'selected = selected'; |
| [634](#L634) | } |
| [635](#L635) |  |
| [636](#L636) | $dropdown .= '>' . esc\_html( $status ) . '</option>'; |
| [637](#L637) | } |
| [638](#L638) |  |
| [639](#L639) | return $dropdown; |
| [640](#L640) | } |
| [641](#L641) |  |
| [642](#L642) | /\*\* |
| [643](#L643) | \* Get ES Templates |
| [644](#L644) | \* |
| [645](#L645) | \* @param string $type |
| [646](#L646) | \* |
| [647](#L647) | \* @return int[]|WP\_Post[] |
| [648](#L648) | \* |
| [649](#L649) | \* @since 4.0.0 |
| [650](#L650) | \*/ |
| [651](#L651) | public static function get\_templates( $type = '', $editor\_type = '' ) { |
| [652](#L652) | // phpcs:diable WordPressVIPMinimum.Performance.WPQueryParams.SuppressFilters\_suppress\_filters |
| [653](#L653) | $es\_args = array( |
| [654](#L654) | 'posts\_per\_page'   => - 1, |
| [655](#L655) | 'post\_type'        => 'es\_template', |
| [656](#L656) | 'orderby'          => 'date', |
| [657](#L657) | 'order'            => 'DESC', |
| [658](#L658) | 'post\_status'      => 'publish', |
| [659](#L659) | 'suppress\_filters' => true, |
| [660](#L660) | ); |
| [661](#L661) | // phpcs:enable |
| [662](#L662) | if ( ! empty( $type ) ) { |
| [663](#L663) | $es\_args['meta\_query'][] = array( |
| [664](#L664) | 'key'     => 'es\_template\_type', |
| [665](#L665) | 'value'   => $type, |
| [666](#L666) | 'compare' => '=', |
| [667](#L667) | ); |
| [668](#L668) | } |
| [669](#L669) |  |
| [670](#L670) | if ( ! empty( $editor\_type ) ) { |
| [671](#L671) | $es\_args['meta\_query'][] = array( |
| [672](#L672) | array( |
| [673](#L673) | 'key'     => 'es\_editor\_type', |
| [674](#L674) | 'value'   => $editor\_type, |
| [675](#L675) | 'compare' => '=', |
| [676](#L676) | ), |
| [677](#L677) | ); |
| [678](#L678) | } |
| [679](#L679) |  |
| [680](#L680) | $es\_templates = get\_posts( $es\_args ); |
| [681](#L681) |  |
| [682](#L682) | return $es\_templates; |
| [683](#L683) |  |
| [684](#L684) | } |
| [685](#L685) |  |
| [686](#L686) | /\*\* |
| [687](#L687) | \* Prepare categories checkboxes |
| [688](#L688) | \* |
| [689](#L689) | \* @param array $category\_names |
| [690](#L690) | \* |
| [691](#L691) | \* @return string |
| [692](#L692) | \* |
| [693](#L693) | \* @since 4.0.0 |
| [694](#L694) | \*/ |
| [695](#L695) | public static function prepare\_categories\_html( $category\_names = array() ) { |
| [696](#L696) | $categories = get\_terms( |
| [697](#L697) | array( |
| [698](#L698) | 'taxonomy'   => 'category', |
| [699](#L699) | 'hide\_empty' => false, |
| [700](#L700) | ) |
| [701](#L701) | ); |
| [702](#L702) | if ( ! is\_array( $category\_names ) ) { |
| [703](#L703) | $category\_names = array(); |
| [704](#L704) | } |
| [705](#L705) |  |
| [706](#L706) | // By default select All Categories option. |
| [707](#L707) | if ( empty( $category\_names ) ) { |
| [708](#L708) | $category\_names = array( 'All' ); |
| [709](#L709) | } |
| [710](#L710) |  |
| [711](#L711) | $checked\_selected = ! array\_intersect( array( 'All', 'None', 'all', 'none' ), $category\_names ) ? "checked='checked'" : ''; |
| [712](#L712) | $category\_html    = '<tr><td style="padding-top:4px;padding-bottom:4px;padding-right:10px;" ><span class="block pr-4 text-sm font-normal text-gray-600 pb-1"><input class="es-note-category-parent form-radio text-indigo-600" type="radio" ' . esc\_attr( $checked\_selected ) . ' value="selected\_cat"  name="data[es\_note\_cat\_parent]">' . \_\_( |
| [713](#L713) | 'Select Categories', |
| [714](#L714) | 'email-subscribers' |
| [715](#L715) | ) . '</td></tr>'; |
| [716](#L716) | foreach ( $categories as $category ) { |
| [717](#L717) |  |
| [718](#L718) | if ( in\_array( $category->term\_id, $category\_names ) ) { |
| [719](#L719) | $checked = "checked='checked'"; |
| [720](#L720) | } else { |
| [721](#L721) | $checked = ''; |
| [722](#L722) | } |
| [723](#L723) |  |
| [724](#L724) | $category\_html .= '<tr class="es-note-child-category"><td style="padding-top:4px;padding-bottom:4px;padding-right:10px;"><span class="block pr-4 text-sm font-normal text-gray-600 pb-1"><input type="checkbox" class="form-checkbox" ' . esc\_attr( $checked ) . ' value="' . esc\_attr( $category->term\_id ) . '" id="es\_note\_cat[]" name="data[es\_note\_cat][]">' . esc\_html( $category->name ) . '</td></tr>'; |
| [725](#L725) | } |
| [726](#L726) | $checked\_all = in\_array( 'All', $category\_names ) || in\_array( 'all', $category\_names ) ? "checked='checked'" : ''; |
| [727](#L727) | $all\_html    = '<tr><td style="padding-top:4px;padding-bottom:4px;padding-right:10px;"><span class="block pr-4 text-sm font-normal text-gray-600 pb-1"><input type="radio" class="form-radio text-indigo-600 es-note-category-parent"  ' . esc\_attr( $checked\_all ) . ' value="{a}All{a}"  name="data[es\_note\_cat\_parent]">' . \_\_( |
| [728](#L728) | 'All Categories (Also include all categories which will create later)', |
| [729](#L729) | 'email-subscribers' |
| [730](#L730) | ) . '</td></tr>'; |
| [731](#L731) |  |
| [732](#L732) | $checked\_none = in\_array( 'None', $category\_names, true ) || in\_array( 'none', $category\_names, true ) ? "checked='checked'" : ''; |
| [733](#L733) | $none\_html    = '<tr><td style="padding-top:4px;padding-bottom:4px;padding-right:10px;"><span class="block pr-4 text-sm font-normal text-gray-600 pb-1"><input type="radio" class="form-radio text-indigo-600 es-note-category-parent"  ' . esc\_attr( $checked\_none ) . ' value="{a}None{a}"  name="data[es\_note\_cat\_parent]">' . \_\_( |
| [734](#L734) | 'None (Don\'t include post from any category)', |
| [735](#L735) | 'email-subscribers' |
| [736](#L736) | ) . '</td></tr>'; |
| [737](#L737) |  |
| [738](#L738) | return $none\_html . $all\_html . $category\_html; |
| [739](#L739) | } |
| [740](#L740) |  |
| [741](#L741) | public static function get\_post\_categories() { |
| [742](#L742) | $categories = get\_terms( |
| [743](#L743) | array( |
| [744](#L744) | 'taxonomy'   => 'category', |
| [745](#L745) | 'hide\_empty' => false, |
| [746](#L746) | ) |
| [747](#L747) | ); |
| [748](#L748) | if ( empty( $categories ) ) { |
| [749](#L749) | return array(); |
| [750](#L750) | } |
| [751](#L751) | $post\_categories = array(); |
| [752](#L752) | foreach ( $categories as $category ) { |
| [753](#L753) | $post\_categories[$category->term\_id ] = $category->name; |
| [754](#L754) | } |
| [755](#L755) | return $post\_categories; |
| [756](#L756) | } |
| [757](#L757) |  |
| [758](#L758) | /\*\* |
| [759](#L759) | \* Get list of default post types |
| [760](#L760) | \* |
| [761](#L761) | \* @since 5.3.17 |
| [762](#L762) | \* |
| [763](#L763) | \* @return array $default\_post\_types List of default post types |
| [764](#L764) | \*/ |
| [765](#L765) | public static function get\_default\_post\_types() { |
| [766](#L766) |  |
| [767](#L767) | $args = array( |
| [768](#L768) | 'public'              => true, |
| [769](#L769) | 'exclude\_from\_search' => false, |
| [770](#L770) | '\_builtin'            => true, |
| [771](#L771) | ); |
| [772](#L772) |  |
| [773](#L773) | $default\_post\_types = get\_post\_types( $args ); |
| [774](#L774) |  |
| [775](#L775) | // remove attachment from the list |
| [776](#L776) | unset( $default\_post\_types['attachment'] ); |
| [777](#L777) |  |
| [778](#L778) | // remove attachment from the list |
| [779](#L779) | unset( $default\_post\_types['post'] ); |
| [780](#L780) |  |
| [781](#L781) | return $default\_post\_types; |
| [782](#L782) | } |
| [783](#L783) |  |
| [784](#L784) |  |
| [785](#L785) | /\*\* |
| [786](#L786) | \* Get list of registered custom post types |
| [787](#L787) | \* |
| [788](#L788) | \* @since 5.4.0 |
| [789](#L789) | \* |
| [790](#L790) | \* @return array $custom\_post\_types List of custom post types |
| [791](#L791) | \*/ |
| [792](#L792) | public static function get\_custom\_post\_types() { |
| [793](#L793) |  |
| [794](#L794) | $args = array( |
| [795](#L795) | 'public'              => true, |
| [796](#L796) | 'exclude\_from\_search' => false, |
| [797](#L797) | '\_builtin'            => false, |
| [798](#L798) | ); |
| [799](#L799) |  |
| [800](#L800) | $custom\_post\_types = get\_post\_types( $args ); |
| [801](#L801) |  |
| [802](#L802) | return $custom\_post\_types; |
| [803](#L803) | } |
| [804](#L804) |  |
| [805](#L805) | public static function get\_post\_types\_name() { |
| [806](#L806) | $default\_post\_types = self::get\_default\_post\_types(); |
| [807](#L807) | $custom\_post\_types  = self::get\_custom\_post\_types(); |
| [808](#L808) | $post\_types         = array\_merge( $default\_post\_types, $custom\_post\_types ); |
| [809](#L809) | $post\_type\_names    = array(); |
| [810](#L810) | if ( ! empty( $post\_types ) ) { |
| [811](#L811) | foreach ( $post\_types as $post\_type ) { |
| [812](#L812) | $post\_type\_name                = self::get\_post\_type\_name( $post\_type ); |
| [813](#L813) | $post\_type\_names[ $post\_type ] = $post\_type\_name; |
| [814](#L814) | } |
| [815](#L815) | } |
| [816](#L816) |  |
| [817](#L817) | return $post\_type\_names; |
| [818](#L818) | } |
| [819](#L819) |  |
| [820](#L820) | public static function get\_post\_type\_name( $post\_type ) { |
| [821](#L821) | $post\_type\_object = get\_post\_type\_object( $post\_type ); |
| [822](#L822) | $post\_type\_name   = $post\_type\_object->labels->singular\_name; |
| [823](#L823) | return $post\_type\_name; |
| [824](#L824) | } |
| [825](#L825) |  |
| [826](#L826) | /\*\* |
| [827](#L827) | \* Prepare custom post types checkboxes |
| [828](#L828) | \* |
| [829](#L829) | \* @param $custom\_post\_types |
| [830](#L830) | \* |
| [831](#L831) | \* @return string |
| [832](#L832) | \* |
| [833](#L833) | \* @since 4.0.0 |
| [834](#L834) | \*/ |
| [835](#L835) | public static function prepare\_custom\_post\_type\_checkbox( $custom\_post\_types ) { |
| [836](#L836) | $args       = array( |
| [837](#L837) | 'public'              => true, |
| [838](#L838) | 'exclude\_from\_search' => false, |
| [839](#L839) | '\_builtin'            => false, |
| [840](#L840) | ); |
| [841](#L841) | $output     = 'names'; |
| [842](#L842) | $operator   = 'and'; |
| [843](#L843) | $post\_types = get\_post\_types( $args, $output, $operator ); |
| [844](#L844) | if ( ! empty( $post\_types ) ) { |
| [845](#L845) | $custom\_post\_type\_html = ''; |
| [846](#L846) | foreach ( $post\_types as $post\_type ) { |
| [847](#L847) | $post\_type\_search = '{T}' . $post\_type . '{T}'; |
| [848](#L848) | if ( is\_array( $custom\_post\_types ) && in\_array( $post\_type\_search, $custom\_post\_types, true ) ) { |
| [849](#L849) | $checked = "checked='checked'"; |
| [850](#L850) | } else { |
| [851](#L851) | $checked = ''; |
| [852](#L852) | } |
| [853](#L853) | $custom\_post\_type\_html .= '<tr><td style="padding-top:4px;padding-bottom:4px;padding-right:10px;"><span class="block pr-4 text-sm font-medium text-gray-600 pb-2"><input type="checkbox" ' . esc\_attr( $checked ) . ' value="{T}' . esc\_html( $post\_type ) . '{T}" class="es\_custom\_post\_type form-checkbox" name="data[es\_note\_cpt][]">' . esc\_html( $post\_type ) . '</td></tr>'; |
| [854](#L854) | } |
| [855](#L855) | } else { |
| [856](#L856) | $custom\_post\_type\_html = '<tr><span class="block pr-4 text-sm font-normal text-gray-600 pb-2">' . \_\_( 'No Custom Post Types Available', 'email-subscribers' ) . '</tr>'; |
| [857](#L857) | } |
| [858](#L858) |  |
| [859](#L859) | return $custom\_post\_type\_html; |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) |  |
| [863](#L863) | /\*\* |
| [864](#L864) | \* Get categories for given post types |
| [865](#L865) | \* |
| [866](#L866) | \* @since 5.3.13 |
| [867](#L867) | \* |
| [868](#L868) | \* @param array $post\_type Post type |
| [869](#L869) | \* |
| [870](#L870) | \* @return array $post\_type\_categories List of categories for given post types |
| [871](#L871) | \*/ |
| [872](#L872) | public static function get\_post\_type\_categories( $post\_type ) { |
| [873](#L873) |  |
| [874](#L874) | $taxonomies = get\_object\_taxonomies( $post\_type, 'objects' ); |
| [875](#L875) | if ( empty( $taxonomies ) ) { |
| [876](#L876) | return array(); |
| [877](#L877) | } |
| [878](#L878) |  |
| [879](#L879) | $post\_type\_categories = array(); |
| [880](#L880) |  |
| [881](#L881) | foreach ( $taxonomies as $taxonomy\_slug => $taxonomy ) { |
| [882](#L882) | $is\_category\_taxonomy = $taxonomy->hierarchical; |
| [883](#L883) | if ( ! $is\_category\_taxonomy ) { |
| [884](#L884) | continue; |
| [885](#L885) | } |
| [886](#L886) | $categories = get\_categories( |
| [887](#L887) | array( |
| [888](#L888) | 'hide\_empty' => false, |
| [889](#L889) | 'taxonomy'   => $taxonomy\_slug, |
| [890](#L890) | 'type'       => $post\_type, |
| [891](#L891) | 'orderby'    => 'id', |
| [892](#L892) | ) |
| [893](#L893) | ); |
| [894](#L894) |  |
| [895](#L895) | if ( empty( $categories ) ) { |
| [896](#L896) | continue; |
| [897](#L897) | } |
| [898](#L898) |  |
| [899](#L899) | foreach ( $categories as $category ) { |
| [900](#L900) | $post\_type\_categories[ $category->term\_id ] = $category->name; |
| [901](#L901) | } |
| [902](#L902) | } |
| [903](#L903) |  |
| [904](#L904) | return $post\_type\_categories; |
| [905](#L905) | } |
| [906](#L906) |  |
| [907](#L907) | /\*\* |
| [908](#L908) | \* Get Opt-in types |
| [909](#L909) | \* |
| [910](#L910) | \* @return array |
| [911](#L911) | \* |
| [912](#L912) | \* @since 4.0.0 |
| [913](#L913) | \*/ |
| [914](#L914) | public static function get\_optin\_types() { |
| [915](#L915) |  |
| [916](#L916) | $types = array( |
| [917](#L917) | 'single\_opt\_in' => \_\_( 'Single Opt-In', 'email-subscribers' ), |
| [918](#L918) | 'double\_opt\_in' => \_\_( 'Double Opt-In', 'email-subscribers' ), |
| [919](#L919) | ); |
| [920](#L920) |  |
| [921](#L921) | return $types; |
| [922](#L922) | } |
| [923](#L923) |  |
| [924](#L924) | /\*\* |
| [925](#L925) | \* Get options to sending mails of weekly summary. |
| [926](#L926) | \* |
| [927](#L927) | \* @return array |
| [928](#L928) | \*/ |
| [929](#L929) | public static function run\_summary\_cron\_on() { |
| [930](#L930) |  |
| [931](#L931) | $types = array( |
| [932](#L932) | 'monday'    => \_\_( 'Monday', 'email-subscribers' ), |
| [933](#L933) | 'tuesday'   => \_\_( 'Tuesday', 'email-subscribers' ), |
| [934](#L934) | 'wednesday' => \_\_( 'Wednesday', 'email-subscribers' ), |
| [935](#L935) | 'thursday'  => \_\_( 'Thursday', 'email-subscribers' ), |
| [936](#L936) | 'friday'    => \_\_( 'Friday', 'email-subscribers' ), |
| [937](#L937) | 'saturday'  => \_\_( 'Saturday', 'email-subscribers' ), |
| [938](#L938) | 'sunday'    => \_\_( 'Sunday', 'email-subscribers' ), |
| [939](#L939) | ); |
| [940](#L940) |  |
| [941](#L941) | return apply\_filters( 'ig\_es\_run\_summary\_cron\_on\_types', $types ); |
| [942](#L942) | } |
| [943](#L943) |  |
| [944](#L944) | /\*\* |
| [945](#L945) | \* Get time options to sending mails of weekly summary. |
| [946](#L946) | \* |
| [947](#L947) | \* @return array |
| [948](#L948) | \*/ |
| [949](#L949) | public static function get\_railway\_hrs\_timings() { |
| [950](#L950) |  |
| [951](#L951) | $timings = array(); |
| [952](#L952) |  |
| [953](#L953) | for ( $i = 1; $i <= 24; $i ++ ) { |
| [954](#L954) | if ( $i <= 12 ) { |
| [955](#L955) | $timings[ "{$i}am" ] = "{$i}:00 AM"; |
| [956](#L956) | } else { |
| [957](#L957) | $time                   = $i - 12; |
| [958](#L958) | $timings[ "{$time}pm" ] = "{$time}:00 PM"; |
| [959](#L959) | } |
| [960](#L960) | } |
| [961](#L961) |  |
| [962](#L962) | return apply\_filters( 'ig\_es\_get\_railway\_hrs\_timings', $timings ); |
| [963](#L963) | } |
| [964](#L964) |  |
| [965](#L965) |  |
| [966](#L966) | /\*\* |
| [967](#L967) | \* Get registered image sizes |
| [968](#L968) | \* |
| [969](#L969) | \* @return array |
| [970](#L970) | \* |
| [971](#L971) | \* @since 5.7.23 |
| [972](#L972) | \*/ |
| [973](#L973) | public static function get\_registered\_image\_sizes() { |
| [974](#L974) | global $\_wp\_additional\_image\_sizes; |
| [975](#L975) |  |
| [976](#L976) | // Get all default and custom image sizes |
| [977](#L977) | $sizes             = array(); |
| [978](#L978) | $default\_sizes = get\_intermediate\_image\_sizes(); |
| [979](#L979) |  |
| [980](#L980) | foreach ( $default\_sizes as $size ) { |
| [981](#L981) | // Check if the size is in the additional image sizes array |
| [982](#L982) | if ( isset( $\_wp\_additional\_image\_sizes[ $size ] ) ) { |
| [983](#L983) | $sizes[ $size ] = array( |
| [984](#L984) | 'width'  => $\_wp\_additional\_image\_sizes[ $size ]['width'], |
| [985](#L985) | 'height' => $\_wp\_additional\_image\_sizes[ $size ]['height'], |
| [986](#L986) | 'crop'   => $\_wp\_additional\_image\_sizes[ $size ]['crop'], |
| [987](#L987) | ); |
| [988](#L988) | } else { |
| [989](#L989) | // Get default sizes |
| [990](#L990) | $sizes[ $size ] = array( |
| [991](#L991) | 'width'  => get\_option( "{$size}\_size\_w" ), |
| [992](#L992) | 'height' => get\_option( "{$size}\_size\_h" ), |
| [993](#L993) | 'crop'   => get\_option( "{$size}\_crop" ), |
| [994](#L994) | ); |
| [995](#L995) | } |
| [996](#L996) | } |
| [997](#L997) |  |
| [998](#L998) | // Create a formatted array with size names => labels |
| [999](#L999) | $formatted\_sizes = array( |
| [1000](#L1000) | 'full'      => \_\_( 'Full Size', 'email-subscribers' ), |
| [1001](#L1001) | 'medium'    => \_\_( 'Medium Size', 'email-subscribers' ), |
| [1002](#L1002) | 'thumbnail' => \_\_( 'Thumbnail', 'email-subscribers' ), |
| [1003](#L1003) | ); |
| [1004](#L1004) |  |
| [1005](#L1005) | foreach ( $sizes as $name => $size ) { |
| [1006](#L1006) | $label                                    = ucfirst( str\_replace( array( '-', '\_' ), ' ', $name) ); |
| [1007](#L1007) | $formatted\_sizes[ $name ] = $label; |
| [1008](#L1008) | } |
| [1009](#L1009) |  |
| [1010](#L1010) | return $formatted\_sizes; |
| [1011](#L1011) | } |
| [1012](#L1012) |  |
| [1013](#L1013) |  |
| [1014](#L1014) | /\*\* |
| [1015](#L1015) | \* Get IG Option |
| [1016](#L1016) | \* |
| [1017](#L1017) | \* @param $option |
| [1018](#L1018) | \* @param null   $default |
| [1019](#L1019) | \* |
| [1020](#L1020) | \* @return mixed|void|null |
| [1021](#L1021) | \* |
| [1022](#L1022) | \* @since 4.0.15 |
| [1023](#L1023) | \*/ |
| [1024](#L1024) | public static function get\_ig\_option( $option, $default = null ) { |
| [1025](#L1025) |  |
| [1026](#L1026) | if ( empty( $option ) ) { |
| [1027](#L1027) | return null; |
| [1028](#L1028) | } |
| [1029](#L1029) |  |
| [1030](#L1030) | $option\_prefix = 'ig\_es\_'; |
| [1031](#L1031) |  |
| [1032](#L1032) | return get\_option( $option\_prefix . $option, $default ); |
| [1033](#L1033) |  |
| [1034](#L1034) | } |
| [1035](#L1035) |  |
| [1036](#L1036) | /\*\* |
| [1037](#L1037) | \* Set ig option |
| [1038](#L1038) | \* |
| [1039](#L1039) | \* @param $option |
| [1040](#L1040) | \* @param $value |
| [1041](#L1041) | \* |
| [1042](#L1042) | \* @return bool|null |
| [1043](#L1043) | \* |
| [1044](#L1044) | \* @since 4.0.15 |
| [1045](#L1045) | \*/ |
| [1046](#L1046) | public static function set\_ig\_option( $option, $value ) { |
| [1047](#L1047) |  |
| [1048](#L1048) | if ( empty( $option ) ) { |
| [1049](#L1049) | return null; |
| [1050](#L1050) | } |
| [1051](#L1051) |  |
| [1052](#L1052) | $option\_prefix = 'ig\_es\_'; |
| [1053](#L1053) |  |
| [1054](#L1054) | return update\_option( $option\_prefix . $option, $value, false ); |
| [1055](#L1055) |  |
| [1056](#L1056) | } |
| [1057](#L1057) |  |
| [1058](#L1058) | /\*\* |
| [1059](#L1059) | \* Delete email subscriber options |
| [1060](#L1060) | \* |
| [1061](#L1061) | \* @param string $option |
| [1062](#L1062) | \* |
| [1063](#L1063) | \* @return bool|null |
| [1064](#L1064) | \* |
| [1065](#L1065) | \* @since 4.0.15 |
| [1066](#L1066) | \*/ |
| [1067](#L1067) | public static function delete\_ig\_option( $option = null ) { |
| [1068](#L1068) | if ( empty( $option ) ) { |
| [1069](#L1069) | return null; |
| [1070](#L1070) | } |
| [1071](#L1071) |  |
| [1072](#L1072) | $option\_prefix = 'ig\_es\_'; |
| [1073](#L1073) |  |
| [1074](#L1074) | return delete\_option( $option\_prefix . $option ); |
| [1075](#L1075) | } |
| [1076](#L1076) |  |
| [1077](#L1077) | /\*\* |
| [1078](#L1078) | \* Convert categories array to string |
| [1079](#L1079) | \* |
| [1080](#L1080) | \* @param array $categories |
| [1081](#L1081) | \* |
| [1082](#L1082) | \* @return string |
| [1083](#L1083) | \* |
| [1084](#L1084) | \* @since 4.0.0 |
| [1085](#L1085) | \*/ |
| [1086](#L1086) | public static function convert\_categories\_array\_to\_string( $categories = array() ) { |
| [1087](#L1087) |  |
| [1088](#L1088) | $categories\_str = ''; |
| [1089](#L1089) |  |
| [1090](#L1090) | if ( is\_array( $categories ) && count( $categories ) > 0 ) { |
| [1091](#L1091) | $categories\_str = '##' . implode( '##', $categories ) . '##'; |
| [1092](#L1092) | $categories\_str = wp\_specialchars\_decode( $categories\_str, ENT\_QUOTES ); |
| [1093](#L1093) | } |
| [1094](#L1094) |  |
| [1095](#L1095) | return $categories\_str; |
| [1096](#L1096) | } |
| [1097](#L1097) |  |
| [1098](#L1098) | public static function onboarding\_convert\_category\_value\_to\_string( $category\_value = array() ) { |
| [1099](#L1099) | $category\_str = ''; |
| [1100](#L1100) |  |
| [1101](#L1101) | if (!empty($category\_value) && is\_array($category\_value)) { |
| [1102](#L1102) | $category\_str = '##post:' . $category\_value[0] . '##'; |
| [1103](#L1103) | $category\_str = wp\_specialchars\_decode( $category\_str, ENT\_QUOTES ); |
| [1104](#L1104) | } |
| [1105](#L1105) |  |
| [1106](#L1106) | return $category\_str; |
| [1107](#L1107) | } |
| [1108](#L1108) |  |
| [1109](#L1109) |  |
| [1110](#L1110) | /\*\* |
| [1111](#L1111) | \* Convert categories string to array |
| [1112](#L1112) | \* |
| [1113](#L1113) | \* @param string $categories\_str |
| [1114](#L1114) | \* @param bool   $keep\_ids |
| [1115](#L1115) | \* |
| [1116](#L1116) | \* @return array|mixed |
| [1117](#L1117) | \* |
| [1118](#L1118) | \* @since 4.0.0 |
| [1119](#L1119) | \*/ |
| [1120](#L1120) | public static function convert\_categories\_string\_to\_array( $categories\_str = '', $keep\_ids = true ) { |
| [1121](#L1121) | $categories = array(); |
| [1122](#L1122) | if ( strlen( $categories\_str ) > 0 ) { |
| [1123](#L1123) | $categories\_str = trim( trim( $categories\_str ), '##' ); |
| [1124](#L1124) | $categories     = explode( '##', $categories\_str ); |
| [1125](#L1125) | $categories     = str\_replace( '{a}', '', $categories ); |
| [1126](#L1126) |  |
| [1127](#L1127) | if ( ! $keep\_ids ) { |
| [1128](#L1128) | $categories = array\_map( array( 'ES\_Common', 'convert\_id\_to\_name' ), $categories ); |
| [1129](#L1129) | } |
| [1130](#L1130) | } |
| [1131](#L1131) |  |
| [1132](#L1132) | return $categories; |
| [1133](#L1133) | } |
| [1134](#L1134) |  |
| [1135](#L1135) | /\*\* |
| [1136](#L1136) | \* Convert Category id to name |
| [1137](#L1137) | \* |
| [1138](#L1138) | \* @param $category |
| [1139](#L1139) | \* |
| [1140](#L1140) | \* @return string |
| [1141](#L1141) | \* |
| [1142](#L1142) | \* @since 4.1.0 |
| [1143](#L1143) | \*/ |
| [1144](#L1144) | public static function convert\_id\_to\_name( $category ) { |
| [1145](#L1145) | if ( ! in\_array( $category, array( 'All', 'None' ), true ) ) { |
| [1146](#L1146) | return get\_cat\_name( $category ); |
| [1147](#L1147) | } else { |
| [1148](#L1148) | return $category; |
| [1149](#L1149) | } |
| [1150](#L1150) | } |
| [1151](#L1151) |  |
| [1152](#L1152) | /\*\* |
| [1153](#L1153) | \* Get category id based on name |
| [1154](#L1154) | \* |
| [1155](#L1155) | \* @param $category |
| [1156](#L1156) | \* |
| [1157](#L1157) | \* @return int|string |
| [1158](#L1158) | \* |
| [1159](#L1159) | \* @since 4.1.0 |
| [1160](#L1160) | \*/ |
| [1161](#L1161) | public static function convert\_name\_to\_id( $category ) { |
| [1162](#L1162) | if ( strpos( $category, '{T}' ) === false ) { |
| [1163](#L1163) | $category = wp\_specialchars\_decode( addslashes( $category ) ); |
| [1164](#L1164) |  |
| [1165](#L1165) | return get\_cat\_ID( $category ); |
| [1166](#L1166) | } else { |
| [1167](#L1167) | return $category; |
| [1168](#L1168) | } |
| [1169](#L1169) | } |
| [1170](#L1170) |  |
| [1171](#L1171) | /\*\* |
| [1172](#L1172) | \* Prepare categories ids string |
| [1173](#L1173) | \* |
| [1174](#L1174) | \* @param string $category |
| [1175](#L1175) | \* |
| [1176](#L1176) | \* @return string |
| [1177](#L1177) | \* |
| [1178](#L1178) | \* @since 4.1.0 |
| [1179](#L1179) | \*/ |
| [1180](#L1180) | public static function prepare\_category\_string( $category = '' ) { |
| [1181](#L1181) | $category\_str = ''; |
| [1182](#L1182) | if ( ! empty( $category ) ) { |
| [1183](#L1183) | $category\_str = '##' . $category . '##'; |
| [1184](#L1184) | } |
| [1185](#L1185) |  |
| [1186](#L1186) | return $category\_str; |
| [1187](#L1187) | } |
| [1188](#L1188) |  |
| [1189](#L1189) | /\*\* |
| [1190](#L1190) | \* Prepare custom post types string |
| [1191](#L1191) | \* |
| [1192](#L1192) | \* @param string $post\_type |
| [1193](#L1193) | \* |
| [1194](#L1194) | \* @return string |
| [1195](#L1195) | \* |
| [1196](#L1196) | \* @since 4.1.0 |
| [1197](#L1197) | \*/ |
| [1198](#L1198) | public static function prepare\_custom\_post\_type\_string( $post\_type = '' ) { |
| [1199](#L1199) | $post\_type\_str = ''; |
| [1200](#L1200) | if ( ! empty( $post\_type ) ) { |
| [1201](#L1201) | $post\_type\_str = '##{T}' . $post\_type . '{T}##'; |
| [1202](#L1202) | } |
| [1203](#L1203) |  |
| [1204](#L1204) | return $post\_type\_str; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | /\*\* |
| [1208](#L1208) | \* Convert categories name string into ids string |
| [1209](#L1209) | \* |
| [1210](#L1210) | \* @param $categories\_str |
| [1211](#L1211) | \* |
| [1212](#L1212) | \* @return string |
| [1213](#L1213) | \* |
| [1214](#L1214) | \* @since 4.1.0 |
| [1215](#L1215) | \*/ |
| [1216](#L1216) | public static function prepare\_categories\_migration\_string( $categories\_str ) { |
| [1217](#L1217) | $categories     = self::convert\_categories\_string\_to\_array( $categories\_str, true ); |
| [1218](#L1218) | $categories     = array\_map( array( 'ES\_Common', 'convert\_name\_to\_id' ), $categories ); |
| [1219](#L1219) | $categories\_str = self::convert\_categories\_array\_to\_string( $categories ); |
| [1220](#L1220) |  |
| [1221](#L1221) | return $categories\_str; |
| [1222](#L1222) |  |
| [1223](#L1223) | } |
| [1224](#L1224) |  |
| [1225](#L1225) | /\*\* |
| [1226](#L1226) | \* Prepare first name & last name from name |
| [1227](#L1227) | \* |
| [1228](#L1228) | \* @param string $name |
| [1229](#L1229) | \* |
| [1230](#L1230) | \* @return array |
| [1231](#L1231) | \* |
| [1232](#L1232) | \* @since 4.0.0 |
| [1233](#L1233) | \*/ |
| [1234](#L1234) | public static function prepare\_first\_name\_last\_name( $name = '' ) { |
| [1235](#L1235) | $result = array( |
| [1236](#L1236) | 'first\_name' => '', |
| [1237](#L1237) | 'last\_name'  => '', |
| [1238](#L1238) | ); |
| [1239](#L1239) |  |
| [1240](#L1240) | if ( ! empty( $name ) ) { |
| [1241](#L1241) | // Find out first name and last name |
| [1242](#L1242) | $name\_parts = explode( ' ', $name ); |
| [1243](#L1243) | $last\_name  = ''; |
| [1244](#L1244) | if ( count( $name\_parts ) > 1 ) { |
| [1245](#L1245) | $first\_name = array\_shift( $name\_parts ); |
| [1246](#L1246) | $last\_name  = implode( ' ', $name\_parts ); |
| [1247](#L1247) | } else { |
| [1248](#L1248) | $first\_name = array\_shift( $name\_parts ); |
| [1249](#L1249) | } |
| [1250](#L1250) |  |
| [1251](#L1251) | $result['first\_name'] = trim( $first\_name ); |
| [1252](#L1252) | $result['last\_name']  = trim( $last\_name ); |
| [1253](#L1253) | } |
| [1254](#L1254) |  |
| [1255](#L1255) | return $result; |
| [1256](#L1256) | } |
| [1257](#L1257) |  |
| [1258](#L1258) | /\*\* |
| [1259](#L1259) | \* Prepare name from first name & last name |
| [1260](#L1260) | \* |
| [1261](#L1261) | \* @param string $first\_name |
| [1262](#L1262) | \* @param string $last\_name |
| [1263](#L1263) | \* |
| [1264](#L1264) | \* @return string |
| [1265](#L1265) | \* |
| [1266](#L1266) | \* @since 4.0.0 |
| [1267](#L1267) | \*/ |
| [1268](#L1268) | public static function prepare\_name\_from\_first\_name\_last\_name( $first\_name = '', $last\_name = '' ) { |
| [1269](#L1269) | $first\_name = trim( $first\_name ); |
| [1270](#L1270) | $last\_name  = trim( $last\_name ); |
| [1271](#L1271) |  |
| [1272](#L1272) | return trim( $first\_name . ' ' . $last\_name ); |
| [1273](#L1273) | } |
| [1274](#L1274) |  |
| [1275](#L1275) | /\*\* |
| [1276](#L1276) | \* Get name from email |
| [1277](#L1277) | \* |
| [1278](#L1278) | \* @param $email |
| [1279](#L1279) | \* |
| [1280](#L1280) | \* @return string |
| [1281](#L1281) | \* |
| [1282](#L1282) | \* @since 4.0.0 |
| [1283](#L1283) | \*/ |
| [1284](#L1284) | public static function get\_name\_from\_email( $email ) { |
| [1285](#L1285) | $name = strstr( $email, '@', true ); |
| [1286](#L1286) |  |
| [1287](#L1287) | return trim( $name ); |
| [1288](#L1288) | } |
| [1289](#L1289) |  |
| [1290](#L1290) | /\*\* |
| [1291](#L1291) | \* Migrate Older wigets into newer one. |
| [1292](#L1292) | \* |
| [1293](#L1293) | \* @since 4.0.5 |
| [1294](#L1294) | \*/ |
| [1295](#L1295) | public static function migrate\_widgets() { |
| [1296](#L1296) | /\*\* |
| [1297](#L1297) | \* Option - 1 -> ES < 3.x email-subscribers |
| [1298](#L1298) | \* Option - 2 -> ES < 4.0.4 email\_subscriber\_widget |
| [1299](#L1299) | \* Option - 3 -> ES > 4.0.5 email-subscribers-form |
| [1300](#L1300) | \* |
| [1301](#L1301) | \*   - Fetch Option 1 from options table |
| [1302](#L1302) | \*   - Create a form |
| [1303](#L1303) | \*   - Set a new option with Option - 3 (title, form\_id) |
| [1304](#L1304) | \* |
| [1305](#L1305) | \*   - Fetch Option 2 from options table |
| [1306](#L1306) | \*   - Create a form with data |
| [1307](#L1307) | \*   - Set a new option with Option - 3 (title, form\_id) |
| [1308](#L1308) | \* |
| [1309](#L1309) | \*   - Fetch sidebar\_widgets option from options table |
| [1310](#L1310) | \*   - Change Option 1 with Option 3 |
| [1311](#L1311) | \*   - Change Option 2 with Option 3 |
| [1312](#L1312) | \*/ |
| [1313](#L1313) | $es\_3\_widget\_option   = 'widget\_email-subscribers'; |
| [1314](#L1314) | $es\_4\_widget\_option   = 'widget\_email\_subscriber\_widget'; |
| [1315](#L1315) | $latest\_widget\_option = 'widget\_email-subscribers-form'; |
| [1316](#L1316) |  |
| [1317](#L1317) | $es\_3\_widget\_option\_data = get\_option( $es\_3\_widget\_option, '' ); |
| [1318](#L1318) | if ( ! empty( $es\_3\_widget\_option\_data ) ) { |
| [1319](#L1319) | $es\_3\_widget\_option\_data = maybe\_unserialize( $es\_3\_widget\_option\_data ); |
| [1320](#L1320) |  |
| [1321](#L1321) | if ( is\_array( $es\_3\_widget\_option\_data ) ) { |
| [1322](#L1322) | foreach ( $es\_3\_widget\_option\_data as $key => $data ) { |
| [1323](#L1323) | if ( is\_array( $data ) && count( $data ) > 0 && isset( $data['es\_title'] ) && isset( $data['es\_desc'] ) && isset( $data['es\_name'] ) && isset( $data['es\_group'] ) ) { |
| [1324](#L1324) | $title        = ! empty( $data['es\_title'] ) ? $data['es\_title'] : ''; |
| [1325](#L1325) | $name\_visible = ( ! empty( $data['es\_name'] ) && 'yes' === strtolower( $data['es\_name'] ) ) ? 'yes' : 'no'; |
| [1326](#L1326) | $desc         = ! empty( $data['es\_desc'] ) ? $data['es\_desc'] : ''; |
| [1327](#L1327) | $group        = ! empty( $data['es\_group'] ) ? $data['es\_group'] : ''; |
| [1328](#L1328) |  |
| [1329](#L1329) | $list = ES()->lists\_db->get\_list\_by\_name( $group ); |
| [1330](#L1330) |  |
| [1331](#L1331) | $list\_id = 1; |
| [1332](#L1332) | if ( ! empty( $list ) ) { |
| [1333](#L1333) | $list\_id = $list['id']; |
| [1334](#L1334) | } |
| [1335](#L1335) |  |
| [1336](#L1336) | $name = 'Widget - ' . $title; |
| [1337](#L1337) |  |
| [1338](#L1338) | $data = array( |
| [1339](#L1339) | 'name'          => $name, |
| [1340](#L1340) | 'desc'          => $desc, |
| [1341](#L1341) | 'name\_visible'  => $name\_visible, |
| [1342](#L1342) | 'name\_required' => 'no', |
| [1343](#L1343) | 'list\_visible'  => 'no', |
| [1344](#L1344) | 'lists'         => array( $list\_id ), |
| [1345](#L1345) | 'af\_id'         => 0, |
| [1346](#L1346) | ); |
| [1347](#L1347) |  |
| [1348](#L1348) | $prepared\_form\_data = ES\_Forms\_Table::prepare\_form\_data( $data ); |
| [1349](#L1349) |  |
| [1350](#L1350) | $inserted\_form\_id = ES()->forms\_db->add\_form( $prepared\_form\_data ); |
| [1351](#L1351) |  |
| [1352](#L1352) | $data\_to\_set = array( |
| [1353](#L1353) | 'title'   => $title, |
| [1354](#L1354) | 'form\_id' => $inserted\_form\_id, |
| [1355](#L1355) | ); |
| [1356](#L1356) |  |
| [1357](#L1357) | $es\_3\_widget\_option\_data[ $key ] = $data\_to\_set; |
| [1358](#L1358) | } |
| [1359](#L1359) | } |
| [1360](#L1360) |  |
| [1361](#L1361) | update\_option( $latest\_widget\_option, $es\_3\_widget\_option\_data ); |
| [1362](#L1362) | } |
| [1363](#L1363) | } |
| [1364](#L1364) |  |
| [1365](#L1365) | $es\_4\_widget\_option\_data = get\_option( $es\_4\_widget\_option, '' ); |
| [1366](#L1366) | if ( ! empty( $es\_4\_widget\_option\_data ) ) { |
| [1367](#L1367) | $es\_4\_widget\_option\_data = maybe\_unserialize( $es\_4\_widget\_option\_data ); |
| [1368](#L1368) |  |
| [1369](#L1369) | if ( is\_array( $es\_4\_widget\_option\_data ) ) { |
| [1370](#L1370) | foreach ( $es\_4\_widget\_option\_data as $key => $data ) { |
| [1371](#L1371) | if ( is\_array( $data ) && count( $data ) > 0 && isset( $data['title'] ) && isset( $data['short\_desc'] ) && isset( $data['display\_name'] ) && isset( $data['subscribers\_group'] ) ) { |
| [1372](#L1372) | $title        = ! empty( $data['title'] ) ? $data['title'] : ''; |
| [1373](#L1373) | $name\_visible = ( ! empty( $data['display\_name'] ) && 'yes' === strtolower( $data['display\_name'] ) ) ? 'yes' : 'no'; |
| [1374](#L1374) | $desc         = ! empty( $data['short\_desc'] ) ? $data['short\_desc'] : ''; |
| [1375](#L1375) | $list\_id      = ! empty( $data['subscribers\_group'] ) ? $data['subscribers\_group'] : ''; |
| [1376](#L1376) |  |
| [1377](#L1377) | if ( empty( $list\_id ) ) { |
| [1378](#L1378) | $list\_id = 1; |
| [1379](#L1379) | } |
| [1380](#L1380) |  |
| [1381](#L1381) | $name = 'Widget - ' . $title; |
| [1382](#L1382) |  |
| [1383](#L1383) | $data = array( |
| [1384](#L1384) | 'name'          => $name, |
| [1385](#L1385) | 'desc'          => $desc, |
| [1386](#L1386) | 'name\_visible'  => $name\_visible, |
| [1387](#L1387) | 'name\_required' => 'no', |
| [1388](#L1388) | 'list\_visible'  => 'no', |
| [1389](#L1389) | 'lists'         => array( $list\_id ), |
| [1390](#L1390) | 'af\_id'         => 0, |
| [1391](#L1391) | ); |
| [1392](#L1392) |  |
| [1393](#L1393) | $prepared\_form\_data = ES\_Forms\_Table::prepare\_form\_data( $data ); |
| [1394](#L1394) |  |
| [1395](#L1395) | $inserted\_form\_id = ES()->forms\_db->add\_form( $prepared\_form\_data ); |
| [1396](#L1396) |  |
| [1397](#L1397) | $data\_to\_set = array( |
| [1398](#L1398) | 'title'   => $title, |
| [1399](#L1399) | 'form\_id' => $inserted\_form\_id, |
| [1400](#L1400) | ); |
| [1401](#L1401) |  |
| [1402](#L1402) | $es\_4\_widget\_option\_data[ $key ] = $data\_to\_set; |
| [1403](#L1403) | } |
| [1404](#L1404) | } |
| [1405](#L1405) |  |
| [1406](#L1406) | update\_option( $latest\_widget\_option, $es\_4\_widget\_option\_data ); |
| [1407](#L1407) | } |
| [1408](#L1408) | } |
| [1409](#L1409) |  |
| [1410](#L1410) | // Update sidebars\_widgets options. |
| [1411](#L1411) | $sidebars\_widgets = get\_option( 'sidebars\_widgets', '' ); |
| [1412](#L1412) | if ( ! empty( $sidebars\_widgets ) ) { |
| [1413](#L1413) | $widgets\_data = maybe\_unserialize( $sidebars\_widgets ); |
| [1414](#L1414) |  |
| [1415](#L1415) | if ( is\_array( $widgets\_data ) && count( $widgets\_data ) > 0 ) { |
| [1416](#L1416) | foreach ( $widgets\_data as $key => $data ) { |
| [1417](#L1417) | if ( is\_array( $data ) && count( $data ) > 0 ) { |
| [1418](#L1418) | foreach ( $data as $k => $v ) { |
| [1419](#L1419) | if ( strstr( $v, 'email-subscribers-' ) ) { |
| [1420](#L1420) | $v                          = str\_replace( 'email-subscribers-', 'email-subscribers-form-', $v ); |
| [1421](#L1421) | $widgets\_data[ $key ][ $k ] = $v; |
| [1422](#L1422) | } |
| [1423](#L1423) |  |
| [1424](#L1424) | if ( strstr( $v, 'email\_subscriber\_widget-' ) ) { |
| [1425](#L1425) | $v                          = str\_replace( 'email\_subscriber\_widget-', 'email-subscribers-form-', $v ); |
| [1426](#L1426) | $widgets\_data[ $key ][ $k ] = $v; |
| [1427](#L1427) | } |
| [1428](#L1428) | } |
| [1429](#L1429) | } |
| [1430](#L1430) | } |
| [1431](#L1431) |  |
| [1432](#L1432) | update\_option( 'sidebars\_widgets', $widgets\_data ); |
| [1433](#L1433) | } |
| [1434](#L1434) | } |
| [1435](#L1435) |  |
| [1436](#L1436) | } |
| [1437](#L1437) |  |
| [1438](#L1438) | /\*\* |
| [1439](#L1439) | \* Filter Category |
| [1440](#L1440) | \* |
| [1441](#L1441) | \* @param $category |
| [1442](#L1442) | \* |
| [1443](#L1443) | \* @return string |
| [1444](#L1444) | \* |
| [1445](#L1445) | \* @sinc 4.1.0 |
| [1446](#L1446) | \*/ |
| [1447](#L1447) | public static function temp\_filter\_category( $category ) { |
| [1448](#L1448) | return trim( trim( $category ), '#' ); |
| [1449](#L1449) | } |
| [1450](#L1450) |  |
| [1451](#L1451) | /\*\* |
| [1452](#L1452) | \* Show Message |
| [1453](#L1453) | \* |
| [1454](#L1454) | \* @param string $message |
| [1455](#L1455) | \* @param string $status |
| [1456](#L1456) | \* @param bool   $is\_dismissible |
| [1457](#L1457) | \* |
| [1458](#L1458) | \* @since 4.1.0 |
| [1459](#L1459) | \*/ |
| [1460](#L1460) | public static function show\_message( $message = '', $status = 'success', $is\_dismissible = true ) { |
| [1461](#L1461) |  |
| [1462](#L1462) | $class = 'notice notice-success'; |
| [1463](#L1463) | if ( 'error' === $status ) { |
| [1464](#L1464) | $class = 'notice notice-error'; |
| [1465](#L1465) | } |
| [1466](#L1466) |  |
| [1467](#L1467) | if ( $is\_dismissible ) { |
| [1468](#L1468) | $class .= ' is-dismissible'; |
| [1469](#L1469) | } |
| [1470](#L1470) | /\* translators: 1: Class name 2: Message \*/ |
| [1471](#L1471) | echo sprintf( '<div class="%s"><p>%s</p></div>', esc\_attr( $class ), wp\_kses\_post( $message ) ); |
| [1472](#L1472) |  |
| [1473](#L1473) | } |
| [1474](#L1474) |  |
| [1475](#L1475) | /\*\* |
| [1476](#L1476) | \* Prepare navigation tabs |
| [1477](#L1477) | \* |
| [1478](#L1478) | \* @param $navigation\_tabs |
| [1479](#L1479) | \* |
| [1480](#L1480) | \* @since 4.1.0 |
| [1481](#L1481) | \*/ |
| [1482](#L1482) | public static function prepare\_main\_header\_navigation( $navigation\_tabs ) { |
| [1483](#L1483) |  |
| [1484](#L1484) | foreach ( $navigation\_tabs as $key => $navigation ) { |
| [1485](#L1485) | $action          = ! empty( $navigation['action'] ) ? $navigation['action'] : ''; |
| [1486](#L1486) | $action\_label    = ! empty( $navigation['label'] ) ? $navigation['label'] : ''; |
| [1487](#L1487) | $url             = ! empty( $navigation['url'] ) ? $navigation['url'] : ''; |
| [1488](#L1488) | $indicator\_class = ! empty( $navigation['indicator\_type'] ) ? 'ig-es-indicator-' . $navigation['indicator\_type'] : 'ig-es-indicator-new'; |
| [1489](#L1489) | $show\_indicator  = ! empty( $navigation['indicator\_option'] ) ? ( ( get\_option( $navigation['indicator\_option'], 'yes' ) === 'yes' ) ? true : false ) : false; |
| [1490](#L1490) | $indicator\_label = ! empty( $navigation['indicator\_label'] ) ? $navigation['indicator\_label'] : ''; |
| [1491](#L1491) | $is\_imp          = ! empty( $navigation['is\_imp'] ) ? $navigation['is\_imp'] : false; |
| [1492](#L1492) | ?> |
| [1493](#L1493) |  |
| [1494](#L1494) | <a href="<?php echo esc\_url( $url ); ?>"> |
| [1495](#L1495) | <button  class=" |
| [1496](#L1496) | <?php |
| [1497](#L1497) | if ( $is\_imp ) { |
| [1498](#L1498) | echo esc\_attr( 'primary' ); |
| [1499](#L1499) | } else { |
| [1500](#L1500) | echo esc\_attr( 'secondary' ); |
| [1501](#L1501) | } |
| [1502](#L1502) | ?> |
| [1503](#L1503) | "><?php echo esc\_html( $action\_label ); ?> |
| [1504](#L1504) | <?php if ( $show\_indicator ) { ?> |
| [1505](#L1505) | <span class="ig-es-indicator <?php echo esc\_attr( $indicator\_class ); ?>"> |
| [1506](#L1506) | <?php echo esc\_html( $indicator\_label ); ?> |
| [1507](#L1507) | </span> |
| [1508](#L1508) |  |
| [1509](#L1509) | <?php } ?> |
| [1510](#L1510) | </button> |
| [1511](#L1511) | </a> |
| [1512](#L1512) | <?php |
| [1513](#L1513) | } |
| [1514](#L1514) | } |
| [1515](#L1515) |  |
| [1516](#L1516) | /\*\* |
| [1517](#L1517) | \* Prepare information box to show different kind of information |
| [1518](#L1518) | \* info | warnings | success | error |
| [1519](#L1519) | \* |
| [1520](#L1520) | \* @param $info |
| [1521](#L1521) | \* @param $content\_html |
| [1522](#L1522) | \* |
| [1523](#L1523) | \* @since 4.1.0 |
| [1524](#L1524) | \*/ |
| [1525](#L1525) | public static function prepare\_information\_box( $info, $content\_html ) { |
| [1526](#L1526) |  |
| [1527](#L1527) | $default\_args = array( |
| [1528](#L1528) | 'type'       => 'info', |
| [1529](#L1529) | 'center'     => true, |
| [1530](#L1530) | 'box\_shadow' => true, |
| [1531](#L1531) | 'show\_icon'  => true, |
| [1532](#L1532) | ); |
| [1533](#L1533) |  |
| [1534](#L1534) | $info = wp\_parse\_args( $info, $default\_args ); |
| [1535](#L1535) |  |
| [1536](#L1536) | $type          = $info['type']; |
| [1537](#L1537) | $show\_icon     = $info['show\_icon']; |
| [1538](#L1538) | $is\_center     = $info['center']; |
| [1539](#L1539) | $is\_box\_shadow = $info['box\_shadow']; |
| [1540](#L1540) |  |
| [1541](#L1541) | $div\_class = 'ig-es-information-box'; |
| [1542](#L1542) | if ( $is\_center ) { |
| [1543](#L1543) | $div\_class .= ' ig-es-center'; |
| [1544](#L1544) | } |
| [1545](#L1545) |  |
| [1546](#L1546) | if ( $is\_box\_shadow ) { |
| [1547](#L1547) | $div\_class .= ' ig-es-box-shadow'; |
| [1548](#L1548) | } |
| [1549](#L1549) |  |
| [1550](#L1550) | if ( $type ) { |
| [1551](#L1551) | $div\_class .= ' ig-es-' . $type; |
| [1552](#L1552) | } |
| [1553](#L1553) |  |
| [1554](#L1554) | ?> |
| [1555](#L1555) |  |
| [1556](#L1556) | <div class="<?php echo esc\_attr( $div\_class ); ?>"> |
| [1557](#L1557) | <div class="ig-vertical-align"> |
| [1558](#L1558) | <?php if ( $show\_icon ) { ?> |
| [1559](#L1559) | <div class="ig-es-icon text-center"> |
| [1560](#L1560) | <span class="dashicons ig-es-icon-<?php echo esc\_attr( $type ); ?>"></span> |
| [1561](#L1561) | </div> |
| [1562](#L1562) | <?php } ?> |
| [1563](#L1563) | <div class="ig-es-info-message"> |
| [1564](#L1564) | <?php echo wp\_kses\_post( $content\_html ); ?> |
| [1565](#L1565) | </div> |
| [1566](#L1566) | </div> |
| [1567](#L1567) | </div> |
| [1568](#L1568) |  |
| [1569](#L1569) | <?php |
| [1570](#L1570) | } |
| [1571](#L1571) |  |
| [1572](#L1572) | /\*\* |
| [1573](#L1573) | \* Render Quick Feedback Widget |
| [1574](#L1574) | \* |
| [1575](#L1575) | \* @param $params |
| [1576](#L1576) | \* |
| [1577](#L1577) | \* @since 4.1.0 |
| [1578](#L1578) | \*/ |
| [1579](#L1579) | public static function render\_feedback\_widget( $params ) { |
| [1580](#L1580) | global $ig\_es\_feedback; |
| [1581](#L1581) |  |
| [1582](#L1582) | $feedback = $ig\_es\_feedback; |
| [1583](#L1583) |  |
| [1584](#L1584) | if ( ! $feedback->can\_show\_feedback\_widget() ) { |
| [1585](#L1585) | return; |
| [1586](#L1586) | } |
| [1587](#L1587) |  |
| [1588](#L1588) | $default\_params = array( |
| [1589](#L1589) | 'set\_transient' => true, |
| [1590](#L1590) | 'force'         => false, |
| [1591](#L1591) | 'show\_once'     => false, |
| [1592](#L1592) | ); |
| [1593](#L1593) |  |
| [1594](#L1594) | $params = wp\_parse\_args( $params, $default\_params ); |
| [1595](#L1595) |  |
| [1596](#L1596) | if ( ! empty( $params['event'] ) ) { |
| [1597](#L1597) |  |
| [1598](#L1598) | $event = $feedback->event\_prefix . $params['event']; |
| [1599](#L1599) | $force = ! empty( $params['force'] ) ? $params['force'] : false; |
| [1600](#L1600) |  |
| [1601](#L1601) | $can\_show = false; |
| [1602](#L1602) |  |
| [1603](#L1603) | if ( $force ) { |
| [1604](#L1604) | $can\_show = true; |
| [1605](#L1605) | } else { |
| [1606](#L1606) | if ( ! $feedback->is\_event\_transient\_set( $event ) ) { |
| [1607](#L1607) | $can\_show = true; |
| [1608](#L1608) |  |
| [1609](#L1609) | $feedback\_data = $feedback->get\_event\_feedback\_data( $feedback->plugin\_abbr, $event ); |
| [1610](#L1610) | if ( count( $feedback\_data ) > 0 ) { |
| [1611](#L1611) | $show\_once              = $params['show\_once']; |
| [1612](#L1612) | $feedback\_data          = array\_reverse( $feedback\_data ); |
| [1613](#L1613) | $last\_feedback\_given\_on = $feedback\_data[0]['created\_on']; |
| [1614](#L1614) |  |
| [1615](#L1615) | // If event feedback given within 45 days or show event only once? |
| [1616](#L1616) | // Don't show now |
| [1617](#L1617) | if ( $show\_once || ( strtotime( $last\_feedback\_given\_on ) > strtotime( '-45 days' ) ) ) { |
| [1618](#L1618) | $can\_show = false; |
| [1619](#L1619) | } |
| [1620](#L1620) | } |
| [1621](#L1621) | } |
| [1622](#L1622) | } |
| [1623](#L1623) |  |
| [1624](#L1624) | if ( $can\_show ) { |
| [1625](#L1625) | if ( 'star' === $params['type'] ) { |
| [1626](#L1626) | $feedback->render\_stars( $params ); |
| [1627](#L1627) | } elseif ( 'emoji' === $params['type'] ) { |
| [1628](#L1628) | $feedback->render\_emoji( $params ); |
| [1629](#L1629) | } elseif ( 'feedback' === $params['type'] ) { |
| [1630](#L1630) | $feedback->render\_general\_feedback( $params ); |
| [1631](#L1631) | } elseif ( 'fb' === $params['type'] ) { |
| [1632](#L1632) | /\*\* |
| [1633](#L1633) | \* We are not calling home for this event and we want to show |
| [1634](#L1634) | \* this Widget only once. So, we are storing feedback data now. |
| [1635](#L1635) | \*/ |
| [1636](#L1636) | $feedback->set\_feedback\_data( 'ig\_es', $event ); |
| [1637](#L1637) | $feedback->render\_fb\_widget( $params ); |
| [1638](#L1638) | } elseif ( 'poll' === $params['type'] ) { |
| [1639](#L1639) | $feedback->set\_feedback\_data( 'ig\_es', $event ); |
| [1640](#L1640) | $feedback->render\_poll\_widget( $params ); |
| [1641](#L1641) | } |
| [1642](#L1642) | } |
| [1643](#L1643) | } |
| [1644](#L1644) |  |
| [1645](#L1645) | } |
| [1646](#L1646) |  |
| [1647](#L1647) | /\*\* |
| [1648](#L1648) | \* Get all restricted settings which we can't share |
| [1649](#L1649) | \* |
| [1650](#L1650) | \* @return array |
| [1651](#L1651) | \* |
| [1652](#L1652) | \* @since 4.6.6 |
| [1653](#L1653) | \*/ |
| [1654](#L1654) | public static function get\_restricted\_settings() { |
| [1655](#L1655) |  |
| [1656](#L1656) | return array( |
| [1657](#L1657) | 'ig\_es\_admin\_new\_contact\_email\_content', |
| [1658](#L1658) | 'ig\_es\_admin\_emails', |
| [1659](#L1659) | 'ig\_es\_admin\_new\_contact\_email\_subject', |
| [1660](#L1660) | 'ig\_es\_admin\_notices', |
| [1661](#L1661) | 'ig\_es\_confirmation\_mail\_content', |
| [1662](#L1662) | 'ig\_es\_confirmation\_mail\_subject', |
| [1663](#L1663) | 'ig\_es\_coupons', |
| [1664](#L1664) | 'ig\_es\_cron\_admin\_email', |
| [1665](#L1665) | 'ig\_es\_cron\_admin\_email\_subject', |
| [1666](#L1666) | 'ig\_es\_cronurl', |
| [1667](#L1667) | 'ig\_es\_current\_version\_date\_details', |
| [1668](#L1668) | 'ig\_es\_custom\_admin\_notice\_bfcm\_2019', |
| [1669](#L1669) | 'ig\_es\_custom\_admin\_notice\_covid\_19', |
| [1670](#L1670) | 'ig\_es\_custom\_admin\_notice\_halloween\_offer\_2020', |
| [1671](#L1671) | 'ig\_es\_db\_update\_history', |
| [1672](#L1672) | 'ig\_es\_default\_subscriber\_imported', |
| [1673](#L1673) | 'ig\_es\_feedback\_data', |
| [1674](#L1674) | 'ig\_es\_form\_submission\_success\_message', |
| [1675](#L1675) | 'ig\_es\_last\_cron\_run', |
| [1676](#L1676) | 'ig\_es\_last\_updated\_blocked\_domains', |
| [1677](#L1677) | 'ig\_es\_mailer\_settings', |
| [1678](#L1678) | 'ig\_es\_ob\_skip\_email\_receive\_error', |
| [1679](#L1679) | 'ig\_es\_offer\_bfcm\_done\_2019', |
| [1680](#L1680) | 'ig\_es\_offer\_covid\_19', |
| [1681](#L1681) | 'ig\_es\_onboarding\_test\_campaign\_error', |
| [1682](#L1682) | 'ig\_es\_opt\_in\_consent\_text', |
| [1683](#L1683) | 'ig\_es\_optin\_link', |
| [1684](#L1684) | 'ig\_es\_optin\_page', |
| [1685](#L1685) | 'ig\_es\_send\_email\_action\_response', |
| [1686](#L1686) | 'ig\_es\_roles\_and\_capabilities', |
| [1687](#L1687) | 'ig\_es\_send\_email\_action\_response', |
| [1688](#L1688) | 'ig\_es\_sent\_report\_content', |
| [1689](#L1689) | 'ig\_es\_sent\_report\_subject', |
| [1690](#L1690) | 'ig\_es\_set\_widget', |
| [1691](#L1691) | 'ig\_es\_show\_opt\_in\_consent', |
| [1692](#L1692) | 'ig\_es\_show\_sync\_tab', |
| [1693](#L1693) | 'ig\_es\_subscription\_error\_messsage', |
| [1694](#L1694) | 'ig\_es\_subscription\_success\_message', |
| [1695](#L1695) | 'ig\_es\_sync\_wp\_users', |
| [1696](#L1696) | 'ig\_es\_unsubscribe\_error\_message', |
| [1697](#L1697) | 'ig\_es\_run\_cron\_on', |
| [1698](#L1698) | 'ig\_es\_run\_cron\_time', |
| [1699](#L1699) | 'ig\_es\_unsubscribe\_link', |
| [1700](#L1700) | 'ig\_es\_unsubscribe\_link\_content', |
| [1701](#L1701) | 'ig\_es\_unsubscribe\_page', |
| [1702](#L1702) | 'ig\_es\_unsubscribe\_success\_message', |
| [1703](#L1703) | 'ig\_es\_update\_processed\_tasks', |
| [1704](#L1704) | 'ig\_es\_update\_tasks\_to\_process', |
| [1705](#L1705) | 'ig\_es\_welcome\_email\_content', |
| [1706](#L1706) | 'ig\_es\_welcome\_email\_subject', |
| [1707](#L1707) | 'ig\_es\_email\_sent\_data', |
| [1708](#L1708) | 'ig\_es\_remote\_gallery\_items', |
| [1709](#L1709) | ); |
| [1710](#L1710) |  |
| [1711](#L1711) | } |
| [1712](#L1712) |  |
| [1713](#L1713) | /\*\* |
| [1714](#L1714) | \* Get coma(,) separated lists name based on list ids |
| [1715](#L1715) | \* |
| [1716](#L1716) | \* @param array $list\_ids |
| [1717](#L1717) | \* |
| [1718](#L1718) | \* @return string |
| [1719](#L1719) | \* |
| [1720](#L1720) | \* @since 4.1.13 |
| [1721](#L1721) | \*/ |
| [1722](#L1722) | public static function prepare\_list\_name\_by\_ids( $list\_ids = array() ) { |
| [1723](#L1723) | $list\_name = ''; |
| [1724](#L1724) | if ( is\_array( $list\_ids ) && count( $list\_ids ) > 0 ) { |
| [1725](#L1725) | $lists\_id\_name\_map = ES()->lists\_db->get\_list\_id\_name\_map(); |
| [1726](#L1726) | $lists\_name        = array(); |
| [1727](#L1727) | foreach ( $list\_ids as $list\_id ) { |
| [1728](#L1728) | if ( ! empty( $lists\_id\_name\_map[ $list\_id ] ) ) { |
| [1729](#L1729) | $lists\_name[] = $lists\_id\_name\_map[ $list\_id ]; |
| [1730](#L1730) | } |
| [1731](#L1731) | } |
| [1732](#L1732) |  |
| [1733](#L1733) | $list\_name = implode( ', ', $lists\_name ); |
| [1734](#L1734) | } |
| [1735](#L1735) |  |
| [1736](#L1736) | return $list\_name; |
| [1737](#L1737) | } |
| [1738](#L1738) |  |
| [1739](#L1739) | /\*\* |
| [1740](#L1740) | \* Update Total Email Sent count |
| [1741](#L1741) | \* |
| [1742](#L1742) | \* @param int $sent\_count Sent emails count |
| [1743](#L1743) | \* |
| [1744](#L1744) | \* @since 4.1.15 |
| [1745](#L1745) | \* |
| [1746](#L1746) | \* @since 4.7.5 Added $sent\_count parameter |
| [1747](#L1747) | \*/ |
| [1748](#L1748) | public static function update\_total\_email\_sent\_count( $sent\_count = 0 ) { |
| [1749](#L1749) |  |
| [1750](#L1750) | $current\_date = ig\_es\_get\_current\_date(); |
| [1751](#L1751) | $current\_hour = ig\_es\_get\_current\_hour(); |
| [1752](#L1752) |  |
| [1753](#L1753) | $email\_sent\_data\_option = 'email\_sent\_data'; |
| [1754](#L1754) |  |
| [1755](#L1755) | // Get total emails sent in this hour |
| [1756](#L1756) | $email\_sent\_data = self::get\_ig\_option( $email\_sent\_data\_option, array() ); |
| [1757](#L1757) |  |
| [1758](#L1758) | $total\_emails\_sent = 0; |
| [1759](#L1759) | $data              = array(); |
| [1760](#L1760) | if ( is\_array( $email\_sent\_data ) && ! empty( $email\_sent\_data[ $current\_date ] ) && ! empty( $email\_sent\_data[ $current\_date ][ $current\_hour ] ) ) { |
| [1761](#L1761) | $total\_emails\_sent = $email\_sent\_data[ $current\_date ][ $current\_hour ]; |
| [1762](#L1762) | } |
| [1763](#L1763) |  |
| [1764](#L1764) | // Add count for sent emails. |
| [1765](#L1765) | $total\_emails\_sent += $sent\_count; |
| [1766](#L1766) |  |
| [1767](#L1767) | // We want to store only current hour data. |
| [1768](#L1768) | $data[ $current\_date ][ $current\_hour ] = $total\_emails\_sent; |
| [1769](#L1769) |  |
| [1770](#L1770) | self::set\_ig\_option( $email\_sent\_data\_option, $data ); |
| [1771](#L1771) |  |
| [1772](#L1772) | } |
| [1773](#L1773) |  |
| [1774](#L1774) | /\*\* |
| [1775](#L1775) | \* Check whether user has access to this page |
| [1776](#L1776) | \* |
| [1777](#L1777) | \* @param $page |
| [1778](#L1778) | \* |
| [1779](#L1779) | \* @return bool|mixed|void |
| [1780](#L1780) | \* |
| [1781](#L1781) | \* @since 4.2.3 |
| [1782](#L1782) | \*/ |
| [1783](#L1783) | public static function ig\_es\_can\_access( $page ) { |
| [1784](#L1784) |  |
| [1785](#L1785) | $user = wp\_get\_current\_user(); |
| [1786](#L1786) |  |
| [1787](#L1787) | if ( ! $user->exists() ) { |
| [1788](#L1788) | return false; |
| [1789](#L1789) | } |
| [1790](#L1790) |  |
| [1791](#L1791) | $default\_permission = 'manage\_options'; |
| [1792](#L1792) |  |
| [1793](#L1793) | $can\_access = $user->has\_cap( $default\_permission ); |
| [1794](#L1794) |  |
| [1795](#L1795) | // Is Admin? Have full access. |
| [1796](#L1796) | if ( $can\_access ) { |
| [1797](#L1797) | return true; |
| [1798](#L1798) | } |
| [1799](#L1799) |  |
| [1800](#L1800) | // We are using this filter in ES Premium to check permission. |
| [1801](#L1801) | return apply\_filters( 'ig\_es\_can\_access', $can\_access, $page ); |
| [1802](#L1802) |  |
| [1803](#L1803) | } |
| [1804](#L1804) |  |
| [1805](#L1805) | /\*\* |
| [1806](#L1806) | \* Get accessible submenus |
| [1807](#L1807) | \* |
| [1808](#L1808) | \* @return array|mixed|void |
| [1809](#L1809) | \* |
| [1810](#L1810) | \* @since 4.2.3 |
| [1811](#L1811) | \*/ |
| [1812](#L1812) | public static function ig\_es\_get\_accessible\_sub\_menus() { |
| [1813](#L1813) |  |
| [1814](#L1814) | $sub\_menus = array(); |
| [1815](#L1815) |  |
| [1816](#L1816) | $user = wp\_get\_current\_user(); |
| [1817](#L1817) |  |
| [1818](#L1818) | if ( ! $user->exists() ) { |
| [1819](#L1819) | return $sub\_menus; |
| [1820](#L1820) | } |
| [1821](#L1821) |  |
| [1822](#L1822) | $default\_permission = 'manage\_options'; |
| [1823](#L1823) | $is\_administrator   = $user->has\_cap( $default\_permission ); |
| [1824](#L1824) |  |
| [1825](#L1825) | // Is user administrator? User has access to all submenus |
| [1826](#L1826) | if ( $is\_administrator ) { |
| [1827](#L1827) | $sub\_menus = array( |
| [1828](#L1828) | 'dashboard', |
| [1829](#L1829) | 'workflows', |
| [1830](#L1830) | 'audience', |
| [1831](#L1831) | 'reports', |
| [1832](#L1832) | 'logs', |
| [1833](#L1833) | 'forms', |
| [1834](#L1834) | 'campaigns', |
| [1835](#L1835) | 'sequences', |
| [1836](#L1836) | 'settings', |
| [1837](#L1837) | 'ig\_redirect', |
| [1838](#L1838) | 'custom\_fields', |
| [1839](#L1839) | 'drag\_drop\_editor', |
| [1840](#L1840) | 'gallery', |
| [1841](#L1841) | 'template', |
| [1842](#L1842) | ); |
| [1843](#L1843) |  |
| [1844](#L1844) | return $sub\_menus; |
| [1845](#L1845) | } |
| [1846](#L1846) |  |
| [1847](#L1847) | // We are using this in ES Premium |
| [1848](#L1848) | $sub\_menus = apply\_filters( 'ig\_es\_accessible\_sub\_menus', $sub\_menus ); |
| [1849](#L1849) |  |
| [1850](#L1850) | return array\_unique( $sub\_menus ); |
| [1851](#L1851) | } |
| [1852](#L1852) |  |
| [1853](#L1853) | /\*\* |
| [1854](#L1854) | \* Generate Hash |
| [1855](#L1855) | \* |
| [1856](#L1856) | \* @param $length |
| [1857](#L1857) | \* |
| [1858](#L1858) | \* @return false|string |
| [1859](#L1859) | \* |
| [1860](#L1860) | \* @since 4.2.4 |
| [1861](#L1861) | \*/ |
| [1862](#L1862) | public static function generate\_hash( $length ) { |
| [1863](#L1863) |  |
| [1864](#L1864) | $length = ( $length ) ? $length : 12; |
| [1865](#L1865) |  |
| [1866](#L1866) | return substr( md5( uniqid() . uniqid() . wp\_rand( $length, 64 ) ), 0, $length ); |
| [1867](#L1867) | } |
| [1868](#L1868) |  |
| [1869](#L1869) | /\*\* |
| [1870](#L1870) | \* Get useful article links |
| [1871](#L1871) | \* |
| [1872](#L1872) | \* @return array |
| [1873](#L1873) | \* |
| [1874](#L1874) | \* @since 4.4.2 |
| [1875](#L1875) | \*/ |
| [1876](#L1876) | public static function get\_useful\_articles( $upsell = true ) { |
| [1877](#L1877) |  |
| [1878](#L1878) | $articles\_upsell = array(); |
| [1879](#L1879) |  |
| [1880](#L1880) | $blog\_articles = array( |
| [1881](#L1881) | array( |
| [1882](#L1882) | 'title' => \_\_( 'Top 10 Tips on How to Build an Email List', 'email-subscribers' ), |
| [1883](#L1883) | 'link'  => 'https://www.icegram.com/email-list/', |
| [1884](#L1884) | ), |
| [1885](#L1885) | array( |
| [1886](#L1886) | 'title' => \_\_( 'Why are Your Email Unsubscribes Increasing and How to Fix Them?', 'email-subscribers' ), |
| [1887](#L1887) | 'link'  => 'https://www.icegram.com/unsubscribes/', |
| [1888](#L1888) | ), |
| [1889](#L1889) | array( |
| [1890](#L1890) | 'title' => \_\_( 'Balance Email Marketing and Social Media Marketing', 'email-subscribers' ), |
| [1891](#L1891) | 'link'  => 'https://www.icegram.com/email-marketing-and-social-media-marketing/', |
| [1892](#L1892) | ), |
| [1893](#L1893) | array( |
| [1894](#L1894) | 'title' => \_\_( 'Use social proof to grow blog traffic through email', 'email-subscribers' ), |
| [1895](#L1895) | 'link'  => 'https://www.icegram.com/social-proof/', |
| [1896](#L1896) | ), |
| [1897](#L1897) | array( |
| [1898](#L1898) | 'title' => \_\_( '5 Simple Tricks to Improve Email Marketing Campaign Results', 'email-subscribers' ), |
| [1899](#L1899) | 'link'  => 'https://www.icegram.com/email-marketing-campaign/', |
| [1900](#L1900) | ), |
| [1901](#L1901) | array( |
| [1902](#L1902) | 'title' => \_\_( '<b>Icegram</b> recommends <b>Kloudbean hosting</b> for best performance of your website', 'email-subscribers' ), |
| [1903](#L1903) | 'link'  => 'https://www.kloudbean.com/?aff=qkn6qxtvcvc4sb', |
| [1904](#L1904) | 'label'       => \_\_( 'Migrate Now', 'email-subscribers' ), |
| [1905](#L1905) | 'label\_class' => 'bg-green-100 text-green-800', |
| [1906](#L1906) | ) |
| [1907](#L1907) | ); |
| [1908](#L1908) |  |
| [1909](#L1909) | if ( $upsell ) { |
| [1910](#L1910) |  |
| [1911](#L1911) | $pricing\_page\_url = admin\_url( 'admin.php?page=es\_pricing' ); |
| [1912](#L1912) |  |
| [1913](#L1913) | $articles\_upsell[] = array( |
| [1914](#L1914) | 'title'       => \_\_( '<b>Icegram Express</b> Secret Club', 'email-subscribers' ), |
| [1915](#L1915) | 'link'        => 'https://www.facebook.com/groups/2298909487017349/', |
| [1916](#L1916) | 'label'       => \_\_( 'Join Now', 'email-subscribers' ), |
| [1917](#L1917) | 'label\_class' => 'bg-green-100 text-green-800', |
| [1918](#L1918) | ); |
| [1919](#L1919) |  |
| [1920](#L1920) | if ( ! ES()->is\_premium() ) { |
| [1921](#L1921) | $articles\_upsell[] = array( |
| [1922](#L1922) | 'title'       => \_\_( 'Unlock all premium features', 'email-subscribers' ), |
| [1923](#L1923) | 'link'        => $pricing\_page\_url, |
| [1924](#L1924) | 'label'       => \_\_( '25% OFF', 'email-subscribers' ), |
| [1925](#L1925) | 'label\_class' => 'bg-green-100 text-green-800', |
| [1926](#L1926) | ); |
| [1927](#L1927) | } |
| [1928](#L1928) | } |
| [1929](#L1929) |  |
| [1930](#L1930) | $articles = array\_merge( $blog\_articles, $articles\_upsell ); |
| [1931](#L1931) |  |
| [1932](#L1932) | return $articles; |
| [1933](#L1933) | } |
| [1934](#L1934) |  |
| [1935](#L1935) | /\*\* |
| [1936](#L1936) | \* Get utm tracking url |
| [1937](#L1937) | \* |
| [1938](#L1938) | \* @param array $utm\_args |
| [1939](#L1939) | \* |
| [1940](#L1940) | \* @return mixed|string |
| [1941](#L1941) | \* |
| [1942](#L1942) | \* @since 4.4.5 |
| [1943](#L1943) | \*/ |
| [1944](#L1944) | public static function get\_utm\_tracking\_url( $utm\_args = array() ) { |
| [1945](#L1945) |  |
| [1946](#L1946) | $url          = ! empty( $utm\_args['url'] ) ? $utm\_args['url'] : 'https://icegram.com/email-subscribers-pricing/'; |
| [1947](#L1947) | $utm\_source   = ! empty( $utm\_args['utm\_source'] ) ? $utm\_args['utm\_source'] : 'in\_app'; |
| [1948](#L1948) | $utm\_medium   = ! empty( $utm\_args['utm\_medium'] ) ? $utm\_args['utm\_medium'] : ''; |
| [1949](#L1949) | $utm\_campaign = ! empty( $utm\_args['utm\_campaign'] ) ? $utm\_args['utm\_campaign'] : 'es\_upsell'; |
| [1950](#L1950) |  |
| [1951](#L1951) | if ( ! empty( $utm\_source ) ) { |
| [1952](#L1952) | $url = add\_query\_arg( 'utm\_source', $utm\_source, $url ); |
| [1953](#L1953) | } |
| [1954](#L1954) |  |
| [1955](#L1955) | if ( ! empty( $utm\_medium ) ) { |
| [1956](#L1956) | $url = add\_query\_arg( 'utm\_medium', $utm\_medium, $url ); |
| [1957](#L1957) | } |
| [1958](#L1958) |  |
| [1959](#L1959) | if ( ! empty( $utm\_campaign ) ) { |
| [1960](#L1960) | $url = add\_query\_arg( 'utm\_campaign', $utm\_campaign, $url ); |
| [1961](#L1961) | } |
| [1962](#L1962) |  |
| [1963](#L1963) | return $url; |
| [1964](#L1964) |  |
| [1965](#L1965) | } |
| [1966](#L1966) |  |
| [1967](#L1967) | /\*\* |
| [1968](#L1968) | \* Get Captcha setting |
| [1969](#L1969) | \* |
| [1970](#L1970) | \* @param $id null|int |
| [1971](#L1971) | \* @param $data array |
| [1972](#L1972) | \* |
| [1973](#L1973) | \* @return bool|mixed|void |
| [1974](#L1974) | \* |
| [1975](#L1975) | \* @since 4.4.7 |
| [1976](#L1976) | \*/ |
| [1977](#L1977) | public static function get\_captcha\_setting( $form\_id = null, $data = array() ) { |
| [1978](#L1978) |  |
| [1979](#L1979) | if ( ! empty( $form\_id ) ) { |
| [1980](#L1980) |  |
| [1981](#L1981) | $form\_id = (int) $form\_id; |
| [1982](#L1982) |  |
| [1983](#L1983) | $form\_data = ES()->forms\_db->get\_form\_by\_id( $form\_id ); |
| [1984](#L1984) |  |
| [1985](#L1985) | $settings = ig\_es\_get\_data( $form\_data, 'settings', array() ); |
| [1986](#L1986) |  |
| [1987](#L1987) | if ( ! empty( $settings ) ) { |
| [1988](#L1988) |  |
| [1989](#L1989) | $settings = maybe\_unserialize( $settings ); |
| [1990](#L1990) |  |
| [1991](#L1991) | if ( isset( $settings['captcha'] ) ) { |
| [1992](#L1992) | return empty( $settings['captcha'] ) ? 'no' : $settings['captcha']; |
| [1993](#L1993) | } |
| [1994](#L1994) | } |
| [1995](#L1995) |  |
| [1996](#L1996) | return get\_option( 'ig\_es\_enable\_captcha', 'no' ); |
| [1997](#L1997) | } |
| [1998](#L1998) |  |
| [1999](#L1999) | if ( ! isset( $data['captcha'] ) || empty( $data['captcha'] ) ) { |
| [2000](#L2000) | $setting = get\_option( 'ig\_es\_enable\_captcha', 'no' ); |
| [2001](#L2001) | } else { |
| [2002](#L2002) | $setting = $data['captcha']; |
| [2003](#L2003) | } |
| [2004](#L2004) |  |
| [2005](#L2005) | return $setting; |
| [2006](#L2006) | } |
| [2007](#L2007) |  |
| [2008](#L2008) | public static function convert\_date\_to\_wp\_date( $date ) { |
| [2009](#L2009) | $convert\_date\_format = get\_option( 'date\_format' ); |
| [2010](#L2010) | $convert\_time\_format = get\_option( 'time\_format' ); |
| [2011](#L2011) |  |
| [2012](#L2012) | return date\_i18n( "$convert\_date\_format $convert\_time\_format", strtotime( $date ) ); |
| [2013](#L2013) | } |
| [2014](#L2014) |  |
| [2015](#L2015) | /\*\* |
| [2016](#L2016) | \* Get next local midnight time |
| [2017](#L2017) | \* |
| [2018](#L2018) | \* @since 5.5.2 |
| [2019](#L2019) | \* |
| [2020](#L2020) | \* @return string $local\_next\_midnight\_time next local midnight time |
| [2021](#L2021) | \*/ |
| [2022](#L2022) | public static function get\_next\_local\_midnight\_time() { |
| [2023](#L2023) | $next\_day\_utc\_time   = time() + DAY\_IN\_SECONDS; |
| [2024](#L2024) | $offset\_in\_seconds   = self::get\_timezone\_offset\_in\_seconds(); |
| [2025](#L2025) | $next\_day\_local\_time = $next\_day\_utc\_time + $offset\_in\_seconds; |
| [2026](#L2026) | $next\_day\_local\_date = date\_i18n( 'Y-m-d H:i:s', $next\_day\_local\_time ); |
| [2027](#L2027) |  |
| [2028](#L2028) | $local\_date\_obj = new DateTime( $next\_day\_local\_date ); |
| [2029](#L2029) | $local\_date\_obj->setTime( 0, 0, 0 ); |
| [2030](#L2030) |  |
| [2031](#L2031) | $local\_next\_midnight\_time = $local\_date\_obj->getTimestamp(); |
| [2032](#L2032) |  |
| [2033](#L2033) | return $local\_next\_midnight\_time; |
| [2034](#L2034) | } |
| [2035](#L2035) |  |
| [2036](#L2036) | /\*\* |
| [2037](#L2037) | \* Convert UTC time for local midnight time |
| [2038](#L2038) | \* |
| [2039](#L2039) | \* @since 5.5.2 |
| [2040](#L2040) | \* |
| [2041](#L2041) | \* @return string $utc\_time\_for\_local\_midnight UTC time local midnight time |
| [2042](#L2042) | \*/ |
| [2043](#L2043) | public static function get\_utc\_time\_for\_local\_midnight\_time() { |
| [2044](#L2044) | $offset\_in\_seconds           = self::get\_timezone\_offset\_in\_seconds(); |
| [2045](#L2045) | $next\_local\_midnight\_time    = self::get\_next\_local\_midnight\_time(); |
| [2046](#L2046) | $utc\_time\_for\_local\_midnight = $next\_local\_midnight\_time - $offset\_in\_seconds; |
| [2047](#L2047) | return $utc\_time\_for\_local\_midnight; |
| [2048](#L2048) | } |
| [2049](#L2049) |  |
| [2050](#L2050) | /\*\* |
| [2051](#L2051) | \* Get site's timezone offset in seconds |
| [2052](#L2052) | \* |
| [2053](#L2053) | \* @since 5.5.2 |
| [2054](#L2054) | \* |
| [2055](#L2055) | \* @return int $offset\_in\_seconds |
| [2056](#L2056) | \*/ |
| [2057](#L2057) | public static function get\_timezone\_offset\_in\_seconds() { |
| [2058](#L2058) | $offset            = get\_option( 'gmt\_offset' ); |
| [2059](#L2059) | $offset\_in\_seconds = $offset \* HOUR\_IN\_SECONDS; |
| [2060](#L2060) | return $offset\_in\_seconds; |
| [2061](#L2061) | } |
| [2062](#L2062) |  |
| [2063](#L2063) | /\*\* |
| [2064](#L2064) | \* Method to convert emojis character into their equivalent HTML entity in the given string if conversion supported |
| [2065](#L2065) | \* else remove them |
| [2066](#L2066) | \* |
| [2067](#L2067) | \* @param string $string String with emojis characters. |
| [2068](#L2068) | \* |
| [2069](#L2069) | \* @return string $string Converted string with equivalent HTML entities |
| [2070](#L2070) | \* |
| [2071](#L2071) | \* @since 4.4.7 |
| [2072](#L2072) | \*/ |
| [2073](#L2073) | public static function handle\_emoji\_characters( $string = '' ) { |
| [2074](#L2074) |  |
| [2075](#L2075) | if ( ! empty( $string ) ) { |
| [2076](#L2076) | if ( function\_exists( 'wp\_encode\_emoji' ) ) { |
| [2077](#L2077) | $string = wp\_encode\_emoji( $string ); |
| [2078](#L2078) | } else { |
| [2079](#L2079) | $string = preg\_replace( |
| [2080](#L2080) | '%(?: |
| [2081](#L2081) | \xF0[\x90-\xBF][\x80-\xBF]{2}      # planes 1-3 |
| [2082](#L2082) | | [\xF1-\xF3][\x80-\xBF]{3}          # planes 4-15 |
| [2083](#L2083) | | \xF4[\x80-\x8F][\x80-\xBF]{2}      # plane 16 |
| [2084](#L2084) | )%xs', |
| [2085](#L2085) | '', |
| [2086](#L2086) | $string |
| [2087](#L2087) | ); |
| [2088](#L2088) | } |
| [2089](#L2089) | } |
| [2090](#L2090) |  |
| [2091](#L2091) | return $string; |
| [2092](#L2092) | } |
| [2093](#L2093) |  |
| [2094](#L2094) | /\*\* |
| [2095](#L2095) | \* Get Campaign type |
| [2096](#L2096) | \* |
| [2097](#L2097) | \* @param bool $reverse |
| [2098](#L2098) | \* |
| [2099](#L2099) | \* @return array |
| [2100](#L2100) | \* |
| [2101](#L2101) | \* @since 4.4.8 |
| [2102](#L2102) | \*/ |
| [2103](#L2103) | public static function get\_campaign\_type\_key\_name\_map( $reverse = false ) { |
| [2104](#L2104) |  |
| [2105](#L2105) | $campaign\_type = self::get\_campaign\_types(); |
| [2106](#L2106) |  |
| [2107](#L2107) | if ( $reverse ) { |
| [2108](#L2108) | $campaign\_type = array\_flip( $campaign\_type ); |
| [2109](#L2109) | } |
| [2110](#L2110) |  |
| [2111](#L2111) | return $campaign\_type; |
| [2112](#L2112) | } |
| [2113](#L2113) |  |
| [2114](#L2114) | /\*\* |
| [2115](#L2115) | \* Get Campaign type |
| [2116](#L2116) | \* |
| [2117](#L2117) | \* @return array |
| [2118](#L2118) | \* |
| [2119](#L2119) | \* @since 4.6.1 |
| [2120](#L2120) | \*/ |
| [2121](#L2121) | public static function get\_campaign\_types( $disallowed\_types = array() ) { |
| [2122](#L2122) |  |
| [2123](#L2123) | $template\_types = apply\_filters( 'es\_template\_type', array() ); |
| [2124](#L2124) |  |
| [2125](#L2125) | if ( ! empty( $disallowed\_types ) ) { |
| [2126](#L2126) | foreach ( $disallowed\_types as $disallowed\_type ) { |
| [2127](#L2127) | if ( isset( $template\_types[ $disallowed\_type ] ) ) { |
| [2128](#L2128) | unset( $template\_types[ $disallowed\_type ] ); |
| [2129](#L2129) | } |
| [2130](#L2130) | } |
| [2131](#L2131) | } |
| [2132](#L2132) |  |
| [2133](#L2133) | return $template\_types; |
| [2134](#L2134) | } |
| [2135](#L2135) |  |
| [2136](#L2136) | /\*\* |
| [2137](#L2137) | \* Prepare Campaign Status dropdown |
| [2138](#L2138) | \* |
| [2139](#L2139) | \* @param string $selected |
| [2140](#L2140) | \* @param string $default\_label |
| [2141](#L2141) | \* |
| [2142](#L2142) | \* @return string |
| [2143](#L2143) | \* |
| [2144](#L2144) | \* @since 4.4.8 |
| [2145](#L2145) | \*/ |
| [2146](#L2146) | public static function prepare\_campaign\_type\_dropdown\_options( $selected = '', $default\_label = '' ) { |
| [2147](#L2147) |  |
| [2148](#L2148) | $campaign\_type = self::get\_campaign\_type\_key\_name\_map(); |
| [2149](#L2149) |  |
| [2150](#L2150) | $dropdown = '<option class="text-sm" value="">' . esc\_html\_\_( 'All Types', 'email-subscribers' ) . '</option>'; |
| [2151](#L2151) | foreach ( $campaign\_type as $key => $type ) { |
| [2152](#L2152) |  |
| [2153](#L2153) | $dropdown .= '<option value="' . esc\_attr( $key ) . '" '; |
| [2154](#L2154) |  |
| [2155](#L2155) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [2156](#L2156) | $dropdown .= 'selected = selected'; |
| [2157](#L2157) | } |
| [2158](#L2158) |  |
| [2159](#L2159) | $dropdown .= '>' . esc\_html( $type ) . '</option>'; |
| [2160](#L2160) | } |
| [2161](#L2161) |  |
| [2162](#L2162) | return $dropdown; |
| [2163](#L2163) | } |
| [2164](#L2164) |  |
| [2165](#L2165) | /\*\* |
| [2166](#L2166) | \* Get Campaign Statuses |
| [2167](#L2167) | \* |
| [2168](#L2168) | \* @param string $campaign\_type |
| [2169](#L2169) | \* @param bool   $reverse |
| [2170](#L2170) | \* |
| [2171](#L2171) | \* @return array |
| [2172](#L2172) | \* |
| [2173](#L2173) | \* @since 4.4.8 |
| [2174](#L2174) | \*/ |
| [2175](#L2175) | public static function get\_campaign\_statuses\_key\_name\_map( $reverse = false ) { |
| [2176](#L2176) |  |
| [2177](#L2177) | $statuses = array( |
| [2178](#L2178) | '0' => \_\_( 'Draft', 'email-subscribers' ), |
| [2179](#L2179) | '1' => \_\_( 'Active', 'email-subscribers' ), |
| [2180](#L2180) | '2' => \_\_( 'Scheduled', 'email-subscribers' ), |
| [2181](#L2181) | '3' => \_\_( 'Sending', 'email-subscribers' ), |
| [2182](#L2182) | '4' => \_\_( 'Paused', 'email-subscribers' ), |
| [2183](#L2183) | '5' => \_\_( 'Sent', 'email-subscribers' ), |
| [2184](#L2184) | ); |
| [2185](#L2185) |  |
| [2186](#L2186) | if ( $reverse ) { |
| [2187](#L2187) | $statuses = array\_flip( $statuses ); |
| [2188](#L2188) | } |
| [2189](#L2189) |  |
| [2190](#L2190) | return $statuses; |
| [2191](#L2191) | } |
| [2192](#L2192) |  |
| [2193](#L2193) | public static function get\_campaign\_status\_code\_map() { |
| [2194](#L2194) | $status\_codes = array( |
| [2195](#L2195) | 'draft'      => IG\_ES\_CAMPAIGN\_STATUS\_IN\_ACTIVE, |
| [2196](#L2196) | 'active'     => IG\_ES\_CAMPAIGN\_STATUS\_ACTIVE, |
| [2197](#L2197) | 'scheduled'  => IG\_ES\_CAMPAIGN\_STATUS\_SCHEDULED, |
| [2198](#L2198) | 'queued'     => IG\_ES\_CAMPAIGN\_STATUS\_QUEUED, |
| [2199](#L2199) | 'paused'     => IG\_ES\_CAMPAIGN\_STATUS\_PAUSED, |
| [2200](#L2200) | 'finished'   => IG\_ES\_CAMPAIGN\_STATUS\_FINISHED, |
| [2201](#L2201) | ); |
| [2202](#L2202) |  |
| [2203](#L2203) | return $status\_codes; |
| [2204](#L2204) | } |
| [2205](#L2205) |  |
| [2206](#L2206) | /\*\* |
| [2207](#L2207) | \* Prepare Campaign Status dropdown |
| [2208](#L2208) | \* |
| [2209](#L2209) | \* @param string $selected |
| [2210](#L2210) | \* @param string $default\_label |
| [2211](#L2211) | \* |
| [2212](#L2212) | \* @return string |
| [2213](#L2213) | \* |
| [2214](#L2214) | \* @since 4.4.8 |
| [2215](#L2215) | \*/ |
| [2216](#L2216) | public static function prepare\_campaign\_statuses\_dropdown\_options( $selected = '', $default\_label = '' ) { |
| [2217](#L2217) |  |
| [2218](#L2218) | $statuses = self::get\_campaign\_statuses\_key\_name\_map(); |
| [2219](#L2219) |  |
| [2220](#L2220) | $dropdown = '<option class="text-sm" value="">' . esc\_html\_\_( 'All Statuses', 'email-subscribers' ) . '</option>'; |
| [2221](#L2221) |  |
| [2222](#L2222) | foreach ( $statuses as $key => $status ) { |
| [2223](#L2223) |  |
| [2224](#L2224) | $dropdown .= '<option class="text-sm" value="' . esc\_attr( $key ) . '" '; |
| [2225](#L2225) |  |
| [2226](#L2226) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [2227](#L2227) | $dropdown .= 'selected = selected'; |
| [2228](#L2228) | } |
| [2229](#L2229) |  |
| [2230](#L2230) | $dropdown .= '>' . esc\_html( $status ) . '</option>'; |
| [2231](#L2231) | } |
| [2232](#L2232) |  |
| [2233](#L2233) | return $dropdown; |
| [2234](#L2234) | } |
| [2235](#L2235) |  |
| [2236](#L2236) | /\*\* |
| [2237](#L2237) | \* Can show coupon code? |
| [2238](#L2238) | \* |
| [2239](#L2239) | \* @param string $coupon\_code |
| [2240](#L2240) | \* |
| [2241](#L2241) | \* @return bool |
| [2242](#L2242) | \* |
| [2243](#L2243) | \* @since 4.4.8 |
| [2244](#L2244) | \*/ |
| [2245](#L2245) | public static function can\_show\_coupon( $coupon = 'PREMIUM10' ) { |
| [2246](#L2246) |  |
| [2247](#L2247) | $can\_show = true; |
| [2248](#L2248) |  |
| [2249](#L2249) | if ( $can\_show ) { |
| [2250](#L2250) | self::update\_coupon\_data( $coupon ); |
| [2251](#L2251) | } |
| [2252](#L2252) |  |
| [2253](#L2253) | return $can\_show; |
| [2254](#L2254) |  |
| [2255](#L2255) | /\* |
| [2256](#L2256) | $coupons = get\_option( 'ig\_es\_coupons', array() ); |
| [2257](#L2257) |  |
| [2258](#L2258) | $can\_show = true; |
| [2259](#L2259) |  |
| [2260](#L2260) | if ( ! empty( $coupons ) ) { |
| [2261](#L2261) |  |
| [2262](#L2262) | if ( isset( $coupons[ $coupon ] ) ) { |
| [2263](#L2263) | $last\_shown\_time = $coupons[ $coupon ]['last\_shown\_time']; |
| [2264](#L2264) |  |
| [2265](#L2265) | if ( $last\_shown\_time <= time() - ( 7 \* 24 \* 60 \* 60 ) ) { |
| [2266](#L2266) | $can\_show = true; |
| [2267](#L2267) | } else { |
| [2268](#L2268) | $can\_show = false; |
| [2269](#L2269) | } |
| [2270](#L2270) | } else { |
| [2271](#L2271) | $can\_show = true; |
| [2272](#L2272) | } |
| [2273](#L2273) | } |
| [2274](#L2274) |  |
| [2275](#L2275) | if ( $can\_show ) { |
| [2276](#L2276) | self::update\_coupon\_data( $coupon ); |
| [2277](#L2277) | } |
| [2278](#L2278) | return $can\_show; |
| [2279](#L2279) | \*/ |
| [2280](#L2280) | } |
| [2281](#L2281) |  |
| [2282](#L2282) | /\*\* |
| [2283](#L2283) | \* Update coupons data |
| [2284](#L2284) | \* |
| [2285](#L2285) | \* @param $coupon |
| [2286](#L2286) | \* |
| [2287](#L2287) | \* @since 4.4.8 |
| [2288](#L2288) | \*/ |
| [2289](#L2289) | public static function update\_coupon\_data( $coupon ) { |
| [2290](#L2290) | $coupons = get\_option( 'ig\_es\_coupons', array() ); |
| [2291](#L2291) |  |
| [2292](#L2292) | $shown\_count = ! empty( $coupons[ $coupon ]['count'] ) ? $coupons[ $coupon ]['count'] : 0; |
| [2293](#L2293) |  |
| [2294](#L2294) | $coupons[ $coupon ] = array( |
| [2295](#L2295) | 'last\_shown\_time' => time(), |
| [2296](#L2296) | 'count'           => $shown\_count + 1, |
| [2297](#L2297) | ); |
| [2298](#L2298) |  |
| [2299](#L2299) | update\_option( 'ig\_es\_coupons', $coupons ); |
| [2300](#L2300) | } |
| [2301](#L2301) |  |
| [2302](#L2302) | /\*\* |
| [2303](#L2303) | \* Method to convert timestamp to date |
| [2304](#L2304) | \* |
| [2305](#L2305) | \* @param array $item an array of DB data |
| [2306](#L2306) | \* |
| [2307](#L2307) | \* @return string |
| [2308](#L2308) | \*/ |
| [2309](#L2309) | public static function convert\_timestamp\_to\_date( $timestamp, $format = '' ) { |
| [2310](#L2310) |  |
| [2311](#L2311) | if ( empty( $format ) ) { |
| [2312](#L2312) | $date\_format = get\_option( 'date\_format' ); |
| [2313](#L2313) | $time\_format = get\_option( 'time\_format' ); |
| [2314](#L2314) | $format      = $date\_format . ' ' . $time\_format; |
| [2315](#L2315) | } |
| [2316](#L2316) |  |
| [2317](#L2317) | return gmdate( $format, $timestamp ); |
| [2318](#L2318) | } |
| [2319](#L2319) |  |
| [2320](#L2320) | /\*\* |
| [2321](#L2321) | \* Generate test mailbox user |
| [2322](#L2322) | \* |
| [2323](#L2323) | \* @return string |
| [2324](#L2324) | \* |
| [2325](#L2325) | \* @since 4.6.0 |
| [2326](#L2326) | \*/ |
| [2327](#L2327) | public static function generate\_test\_mailbox\_user() { |
| [2328](#L2328) |  |
| [2329](#L2329) | $admin\_email = get\_bloginfo( 'admin\_email' ); |
| [2330](#L2330) |  |
| [2331](#L2331) | $parts = explode( '@', $admin\_email ); |
| [2332](#L2332) |  |
| [2333](#L2333) | if ( count( $parts ) > 0 ) { |
| [2334](#L2334) | $user = $parts[0]; |
| [2335](#L2335) | } else { |
| [2336](#L2336) | $user = 'test'; |
| [2337](#L2337) | } |
| [2338](#L2338) |  |
| [2339](#L2339) | $blog\_url = get\_bloginfo( 'url' ); |
| [2340](#L2340) |  |
| [2341](#L2341) | // If URI is like, eg. www.way2tutorial.com/ |
| [2342](#L2342) | $blog\_url = trim( $blog\_url, '/' ); |
| [2343](#L2343) |  |
| [2344](#L2344) | // If not have http:// or https:// then prepend it |
| [2345](#L2345) | if ( ! preg\_match( '#^http(s)?://#', $blog\_url ) ) { |
| [2346](#L2346) | $blog\_url = 'http://' . $blog\_url; |
| [2347](#L2347) | } |
| [2348](#L2348) |  |
| [2349](#L2349) | $url\_parts = parse\_url( $blog\_url ); |
| [2350](#L2350) |  |
| [2351](#L2351) | // Remove www. |
| [2352](#L2352) | $domain = preg\_replace( '/^www\./', '', $url\_parts['host'] ); |
| [2353](#L2353) |  |
| [2354](#L2354) | $hash = self::generate\_hash( 5 ); |
| [2355](#L2355) |  |
| [2356](#L2356) | return $hash . '\_' . $user . '\_' . $domain; |
| [2357](#L2357) | } |
| [2358](#L2358) |  |
| [2359](#L2359) | /\*\* |
| [2360](#L2360) | \* Get mailbox name |
| [2361](#L2361) | \* |
| [2362](#L2362) | \* @return string |
| [2363](#L2363) | \* |
| [2364](#L2364) | \* @since 4.6.0 |
| [2365](#L2365) | \*/ |
| [2366](#L2366) | public static function get\_test\_email() { |
| [2367](#L2367) | $mailbox\_user = get\_option( 'ig\_es\_test\_mailbox\_user', '' ); |
| [2368](#L2368) |  |
| [2369](#L2369) | if ( empty( $mailbox\_user ) ) { |
| [2370](#L2370) | $mailbox\_user = self::generate\_test\_mailbox\_user(); |
| [2371](#L2371) | update\_option( 'ig\_es\_test\_mailbox\_user', $mailbox\_user ); |
| [2372](#L2372) | } |
| [2373](#L2373) |  |
| [2374](#L2374) | return $mailbox\_user . '@box.icegram.com'; |
| [2375](#L2375) | } |
| [2376](#L2376) |  |
| [2377](#L2377) | /\*\* |
| [2378](#L2378) | \* Get upselling information box |
| [2379](#L2379) | \* |
| [2380](#L2380) | \* @since 4.6.2 |
| [2381](#L2381) | \*/ |
| [2382](#L2382) | public static function upsell\_description\_message\_box( $upsell\_info = array(), $echo = true ) { |
| [2383](#L2383) | ob\_start(); |
| [2384](#L2384) | ?> |
| [2385](#L2385) | <div class="inline-flex rounded-md shadow bg-teal-50 px-2 pt-1 my-2 w-full font-sans"> |
| [2386](#L2386) | <div class="px-2 pt-2 pb-2"> |
| [2387](#L2387) | <div class="flex"> |
| [2388](#L2388) | <div class="flex-shrink-0"> |
| [2389](#L2389) | <svg class='h-5 w-5 text-teal-400' fill='currentColor' viewBox='0 0 20 20'> |
| [2390](#L2390) | <path fill-rule='evenodd' |
| [2391](#L2391) | d='M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z' |
| [2392](#L2392) | clip-rule='evenodd'/> |
| [2393](#L2393) | </svg> |
| [2394](#L2394) | </div> |
| [2395](#L2395) | <div class="ml-3"> |
| [2396](#L2396) | <h3 class="text-sm leading-5 font-medium text-blue-800 hover:underline"> |
| [2397](#L2397) | <a href="<?php echo esc\_url( $upsell\_info['pricing\_url'] ); ?>" target="\_blank"> |
| [2398](#L2398) | <?php |
| [2399](#L2399) | echo esc\_html( $upsell\_info['upgrade\_title'] ); |
| [2400](#L2400) | ?> |
| [2401](#L2401) | </a> |
| [2402](#L2402) | </h3> |
| [2403](#L2403) | </div> |
| [2404](#L2404) | </div> |
| [2405](#L2405) | <div class="mt-2 ml-8 text-sm leading-5 text-teal-700"> |
| [2406](#L2406) | <p> |
| [2407](#L2407) | <?php |
| [2408](#L2408) | $allowed\_html\_tags = ig\_es\_allowed\_html\_tags\_in\_esc(); |
| [2409](#L2409) | if ( ! empty( $upsell\_info['upsell\_message'] ) ) { |
| [2410](#L2410) | echo wp\_kses( $upsell\_info['upsell\_message'], $allowed\_html\_tags ); |
| [2411](#L2411) | } |
| [2412](#L2412) |  |
| [2413](#L2413) | $timezone\_format = \_x( 'Y-m-d', 'timezone date format' ); |
| [2414](#L2414) | $ig\_current\_date = strtotime( date\_i18n( $timezone\_format ) ); |
| [2415](#L2415) | if ( ( ( $ig\_current\_date < strtotime( '2020-11-24' ) ) || ( $ig\_current\_date > strtotime( '2020-12-02' ) ) ) && self::can\_show\_coupon( 'PREMIUM10' ) ) { |
| [2416](#L2416) | ?> |
| [2417](#L2417) | <p class="mb-1 mt-3"> |
| [2418](#L2418) | <?php |
| [2419](#L2419) | echo wp\_kses\_post( \_\_( 'Upgrade now & get <b> 10% discount!</b> <br/><br/>Use coupon code:' ), 'email-subscribers' ); |
| [2420](#L2420) | ?> |
| [2421](#L2421) |  |
| [2422](#L2422) | <span class="ml-2 px-1.5 py-1 font-medium bg-yellow-100 rounded-md border-2 border-dotted border-indigo-300 select-all"><?php echo esc\_html( 'PREMIUM10' ); ?> </span> |
| [2423](#L2423) | </p> |
| [2424](#L2424) | <?php |
| [2425](#L2425) | } |
| [2426](#L2426) | if ( $upsell\_info['cta\_html'] ) { |
| [2427](#L2427) | ?> |
| [2428](#L2428) | <div class="pt-6 text-center -ml-6 pb-2"> |
| [2429](#L2429) | <a href="<?php echo esc\_url( $upsell\_info['pricing\_url'] ); ?>" target="\_blank" |
| [2430](#L2430) | class=""> |
| [2431](#L2431) | <button type="button" class="primary"> |
| [2432](#L2432) | <?php |
| [2433](#L2433) | esc\_html\_e( |
| [2434](#L2434) | 'Upgrade', |
| [2435](#L2435) | 'email-subscribers' |
| [2436](#L2436) | ); |
| [2437](#L2437) | ?> |
| [2438](#L2438) | </button> |
| [2439](#L2439) | </a> |
| [2440](#L2440) | </div> |
| [2441](#L2441) | <?php |
| [2442](#L2442) | } |
| [2443](#L2443) | ?> |
| [2444](#L2444) | </div> |
| [2445](#L2445) | </div> |
| [2446](#L2446) | </div> |
| [2447](#L2447) |  |
| [2448](#L2448) | <?php |
| [2449](#L2449) | $message\_html = ob\_get\_clean(); |
| [2450](#L2450) | if ( $echo ) { |
| [2451](#L2451) | echo wp\_kses( $message\_html, $allowed\_html\_tags ); |
| [2452](#L2452) | } else { |
| [2453](#L2453) | return $message\_html; |
| [2454](#L2454) | } |
| [2455](#L2455) | } |
| [2456](#L2456) |  |
| [2457](#L2457) | /\*\* |
| [2458](#L2458) | \* Prepare Campaign Report Status dropdown |
| [2459](#L2459) | \* |
| [2460](#L2460) | \* @param string $selected |
| [2461](#L2461) | \* @param string $default\_label |
| [2462](#L2462) | \* |
| [2463](#L2463) | \* @return string |
| [2464](#L2464) | \* |
| [2465](#L2465) | \* @since 4.6.5 |
| [2466](#L2466) | \*/ |
| [2467](#L2467) | public static function prepare\_campaign\_report\_statuses\_dropdown\_options( $statuses = array(), $selected = '', $default\_label = '' ) { |
| [2468](#L2468) |  |
| [2469](#L2469) | if ( ! empty( $statuses ) ) { |
| [2470](#L2470) | $dropdown = '<option class="text-sm" value="">' . esc\_html\_\_( 'All Status', 'email-subscribers' ) . '</option>'; |
| [2471](#L2471) |  |
| [2472](#L2472) | foreach ( $statuses as $key => $status ) { |
| [2473](#L2473) |  |
| [2474](#L2474) | $dropdown .= '<option class="text-sm" value="' . esc\_attr( $key ) . '" '; |
| [2475](#L2475) |  |
| [2476](#L2476) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [2477](#L2477) | $dropdown .= 'selected = selected'; |
| [2478](#L2478) | } |
| [2479](#L2479) |  |
| [2480](#L2480) | $dropdown .= '>' . esc\_html( $status ) . '</option>'; |
| [2481](#L2481) | } |
| [2482](#L2482) |  |
| [2483](#L2483) | return $dropdown; |
| [2484](#L2484) | } |
| [2485](#L2485) | } |
| [2486](#L2486) |  |
| [2487](#L2487) | /\*\* |
| [2488](#L2488) | \* Check whether the string is a valid JSON or not. |
| [2489](#L2489) | \* |
| [2490](#L2490) | \* @param string $string String we want to test if it's json. |
| [2491](#L2491) | \* |
| [2492](#L2492) | \* @return bool |
| [2493](#L2493) | \* |
| [2494](#L2494) | \* @since 4.6.14 |
| [2495](#L2495) | \*/ |
| [2496](#L2496) | public static function is\_valid\_json( $string ) { |
| [2497](#L2497) |  |
| [2498](#L2498) | return is\_string( $string ) && is\_array( json\_decode( $string, true ) ) && ( json\_last\_error() === JSON\_ERROR\_NONE ) ? true : false; |
| [2499](#L2499) | } |
| [2500](#L2500) |  |
| [2501](#L2501) | /\*\* |
| [2502](#L2502) | \* Get HTML for tooltip |
| [2503](#L2503) | \* |
| [2504](#L2504) | \* @param string $tooltip\_text |
| [2505](#L2505) | \* |
| [2506](#L2506) | \* @return string $tooltip\_html |
| [2507](#L2507) | \* |
| [2508](#L2508) | \* @since 4.7.0 |
| [2509](#L2509) | \*/ |
| [2510](#L2510) | public static function get\_tooltip\_html( $tooltip\_text = '' ) { |
| [2511](#L2511) | $tooltip\_html = ''; |
| [2512](#L2512) | if ( ! empty( $tooltip\_text ) ) { |
| [2513](#L2513) | $tooltip\_html = '<div class="inline-block es-tooltip relative align-middle cursor-pointer"> |
| [2514](#L2514) | <svg class="w-4 h-4 text-gray-600" fill="currentColor" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg"><path fill-rule="evenodd" d="M18 10a8 8 0 11-16 0 8 8 0 0116 0zm-7-4a1 1 0 11-2 0 1 1 0 012 0zM9 9a1 1 0 000 2v3a1 1 0 001 1h1a1 1 0 100-2v-3a1 1 0 00-1-1H9z" clip-rule="evenodd"></path></svg> |
| [2515](#L2515) | <span class="break-words invisible h-auto lg:w-48 xl:w-64 tracking-wide absolute z-70 tooltip-text bg-black text-gray-300 text-xs rounded p-3 py-2"> |
| [2516](#L2516) | ' . $tooltip\_text . ' |
| [2517](#L2517) | <svg class="tooltip-arrow absolute mt-2 text-black text-opacity-100 h-2.5 left-0" x="0px" y="0px" viewBox="0 0 255 255" xml:space="preserve"> |
| [2518](#L2518) | <polygon class="fill-current" points="0,0 127.5,127.5 255,0"/> |
| [2519](#L2519) | </svg> |
| [2520](#L2520) | </span> |
| [2521](#L2521) | </div>'; |
| [2522](#L2522) | } |
| [2523](#L2523) |  |
| [2524](#L2524) | return $tooltip\_html; |
| [2525](#L2525) | } |
| [2526](#L2526) |  |
| [2527](#L2527) | /\*\* |
| [2528](#L2528) | \* Decode HTML entities |
| [2529](#L2529) | \* |
| [2530](#L2530) | \* @param string $string |
| [2531](#L2531) | \* |
| [2532](#L2532) | \* @return string $string |
| [2533](#L2533) | \* |
| [2534](#L2534) | \* @since 4.7.1 |
| [2535](#L2535) | \*/ |
| [2536](#L2536) | public static function decode\_entities( $string ) { |
| [2537](#L2537) |  |
| [2538](#L2538) | preg\_match\_all( '/&#?\w+;/', $string, $entities, PREG\_SET\_ORDER ); |
| [2539](#L2539) | $entities = array\_unique( array\_column( $entities, 0 ) ); |
| [2540](#L2540) |  |
| [2541](#L2541) | if ( ! empty( $entities ) ) { |
| [2542](#L2542) | foreach ( $entities as $entity ) { |
| [2543](#L2543) | $decoded = mb\_convert\_encoding( $entity, 'UTF-8', 'HTML-ENTITIES' ); |
| [2544](#L2544) | $string  = str\_replace( $entity, $decoded, $string ); |
| [2545](#L2545) | } |
| [2546](#L2546) | } |
| [2547](#L2547) |  |
| [2548](#L2548) | return $string; |
| [2549](#L2549) | } |
| [2550](#L2550) |  |
| [2551](#L2551) | /\*\* |
| [2552](#L2552) | \* Override wp editor tinymce formatting options |
| [2553](#L2553) | \* |
| [2554](#L2554) | \* @param array  $init |
| [2555](#L2555) | \* @param string $editor\_id |
| [2556](#L2556) | \* |
| [2557](#L2557) | \* @return array $init |
| [2558](#L2558) | \* |
| [2559](#L2559) | \* @since 4.7.3 |
| [2560](#L2560) | \*/ |
| [2561](#L2561) | public static function override\_tinymce\_formatting\_options( $init, $editor\_id = '' ) { |
| [2562](#L2562) |  |
| [2563](#L2563) | $init['wpautop']      = false; // Disable stripping of p tags in Text mode. |
| [2564](#L2564) | $init['tadv\_noautop'] = true; // Disable stripping of p tags in Text mode. |
| [2565](#L2565) | $init['indent']       = true; |
| [2566](#L2566) |  |
| [2567](#L2567) | // To disable stripping of some HTML elements like span when switching modes in wp editor from text-visual-text. |
| [2568](#L2568) | $opts                            = '\*[\*]'; |
| [2569](#L2569) | $init['valid\_elements']          = $opts; |
| [2570](#L2570) | $init['extended\_valid\_elements'] = $opts; |
| [2571](#L2571) |  |
| [2572](#L2572) | return $init; |
| [2573](#L2573) | } |
| [2574](#L2574) |  |
| [2575](#L2575) | /\*\* |
| [2576](#L2576) | \* Add external plugins for TinyMCE(WordPress classic) editor |
| [2577](#L2577) | \* |
| [2578](#L2578) | \* @param array  $plugin\_array |
| [2579](#L2579) | \* @return array $plugin\_array |
| [2580](#L2580) | \* |
| [2581](#L2581) | \* @since 5.0.6 |
| [2582](#L2582) | \*/ |
| [2583](#L2583) | public static function add\_mce\_external\_plugins( $plugin\_array ) { |
| [2584](#L2584) |  |
| [2585](#L2585) | if ( is\_array( $plugin\_array ) ) { |
| [2586](#L2586) | $plugin\_array['undo\_style\_to\_image'] = ES\_PLUGIN\_URL . 'lite/admin/js/tinymce-plugins/custom/undo-style-to-img-tag-conversion/plugin.js'; |
| [2587](#L2587) | $plugin\_array['fullpage']                        = ES\_PLUGIN\_URL . 'lite/admin/js/tinymce-plugins/pre-built/fullpage/plugin.min.js'; |
| [2588](#L2588) | } |
| [2589](#L2589) |  |
| [2590](#L2590) | return $plugin\_array; |
| [2591](#L2591) | } |
| [2592](#L2592) |  |
| [2593](#L2593) | /\*\* |
| [2594](#L2594) | \* Get current request URL |
| [2595](#L2595) | \* |
| [2596](#L2596) | \* @return string $request\_url |
| [2597](#L2597) | \* |
| [2598](#L2598) | \* @since 4.7.6 |
| [2599](#L2599) | \*/ |
| [2600](#L2600) | public static function get\_current\_request\_url() { |
| [2601](#L2601) | static $request\_url = ''; |
| [2602](#L2602) |  |
| [2603](#L2603) | if ( empty( $request\_url ) ) { |
| [2604](#L2604) | $request\_url = add\_query\_arg( array() ); |
| [2605](#L2605) | } |
| [2606](#L2606) |  |
| [2607](#L2607) | return esc\_url\_raw( $request\_url ); |
| [2608](#L2608) | } |
| [2609](#L2609) |  |
| [2610](#L2610) | public static function get\_campaign\_status\_icon( $status = '' ) { |
| [2611](#L2611) | ob\_start(); |
| [2612](#L2612) | switch ( $status ) { |
| [2613](#L2613) | case 'Sent': |
| [2614](#L2614) | ?> |
| [2615](#L2615) | <svg class="inline-block mt-0.5 ml-2 h-5 w-5 text-green-400" fill="currentColor" viewBox="0 0 20 20"> |
| [2616](#L2616) | <title><?php esc\_attr\_\_( 'Sent', 'email-subscribers' ); ?></title> |
| [2617](#L2617) | <path fill-rule="evenodd" |
| [2618](#L2618) | d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" |
| [2619](#L2619) | clip-rule="evenodd"/> |
| [2620](#L2620) | </svg> |
| [2621](#L2621) | <?php |
| [2622](#L2622) | break; |
| [2623](#L2623) | case 'In Queue': |
| [2624](#L2624) | ?> |
| [2625](#L2625) | <svg class="inline-block mt-0.5 ml-2 h-5 w-5 text-orange-400" fill="currentColor" viewBox="0 0 20 20"> |
| [2626](#L2626) | <title><?php esc\_attr\_\_( 'In Queue', 'email-subscribers' ); ?></title> |
| [2627](#L2627) | <path fill-rule="evenodd" |
| [2628](#L2628) | d="M10 18a8 8 0 100-16 8 8 0 000 16zm1-12a1 1 0 10-2 0v4a1 1 0 00.293.707l2.828 2.829a1 1 0 101.415-1.415L11 9.586V6z" |
| [2629](#L2629) | clip-rule="evenodd"/> |
| [2630](#L2630) | </svg> |
| [2631](#L2631) | <?php |
| [2632](#L2632) | break; |
| [2633](#L2633) | case 'Sending': |
| [2634](#L2634) | ?> |
| [2635](#L2635) | <svg class="inline-block mt-0.5 ml-2 h-4 w-5 text-yellow-400" fill="currentColor" viewBox="0 0 20 20"> |
| [2636](#L2636) | <title><?php esc\_attr\_\_( 'Sending', 'email-subscribers' ); ?></title> |
| [2637](#L2637) | <path fill-rule="evenodd" |
| [2638](#L2638) | d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-8.707l-3-3a1 1 0 00-1.414 1.414L10.586 9H7a1 1 0 100 2h3.586l-1.293 1.293a1 1 0 101.414 1.414l3-3a1 1 0 000-1.414z" |
| [2639](#L2639) | clip-rule="evenodd"/> |
| [2640](#L2640) | </svg> |
| [2641](#L2641) | <?php |
| [2642](#L2642) | break; |
| [2643](#L2643) | case '1': |
| [2644](#L2644) | ?> |
| [2645](#L2645) | <span class="inline-flex px-2 text-green-800 bg-green-100 rounded-full"><?php esc\_html\_\_( 'Active', 'email-subscribers' ); ?></span> |
| [2646](#L2646) | <?php |
| [2647](#L2647) | break; |
| [2648](#L2648) | case '': |
| [2649](#L2649) | ?> |
| [2650](#L2650) | <span class="inline-flex px-2 text-red-800 bg-red-100 rounded-full"><?php esc\_html\_\_( 'Inactive', 'email-subscribers' ); ?></span> |
| [2651](#L2651) | <?php |
| [2652](#L2652) | } |
| [2653](#L2653) |  |
| [2654](#L2654) | $status = ob\_get\_clean(); |
| [2655](#L2655) |  |
| [2656](#L2656) | return $status; |
| [2657](#L2657) | } |
| [2658](#L2658) |  |
| [2659](#L2659) | /\*\* |
| [2660](#L2660) | \* Prepare custom field type dropdown options |
| [2661](#L2661) | \* |
| [2662](#L2662) | \* @param $selected |
| [2663](#L2663) | \* @param $default\_label |
| [2664](#L2664) | \* |
| [2665](#L2665) | \* @return string |
| [2666](#L2666) | \* |
| [2667](#L2667) | \* @since 4.8.4 |
| [2668](#L2668) | \*/ |
| [2669](#L2669) | public static function prepare\_fieldtype\_dropdown\_options( $selected = '', $default\_label = '' ) { |
| [2670](#L2670) |  |
| [2671](#L2671) | $default\_status[0] = \_\_( 'Select field type', 'email-subscribers' ); |
| [2672](#L2672) |  |
| [2673](#L2673) | $cf\_type = array( |
| [2674](#L2674) | 'text'          => \_\_( 'Text', 'email-subscribers' ), |
| [2675](#L2675) | 'textarea'  => \_\_( 'TextArea', 'email-subscribers' ), |
| [2676](#L2676) | 'dropdown'  => \_\_( 'Dropdown', 'email-subscribers' ), |
| [2677](#L2677) | 'radio'         => \_\_( 'Radio', 'email-subscribers' ), |
| [2678](#L2678) | 'number'        => \_\_( 'Number', 'email-subscribers' ), |
| [2679](#L2679) | 'date'          => \_\_( 'Date', 'email-subscribers' ), |
| [2680](#L2680) | ); |
| [2681](#L2681) |  |
| [2682](#L2682) | $field\_types = array\_merge( $default\_status, $cf\_type ); |
| [2683](#L2683) |  |
| [2684](#L2684) | $dropdown = ''; |
| [2685](#L2685) | foreach ( $field\_types as $key => $type ) { |
| [2686](#L2686) | $dropdown .= '<option value="' . esc\_attr( $key ) . '" '; |
| [2687](#L2687) |  |
| [2688](#L2688) | if ( strtolower( $selected ) === strtolower( $key ) ) { |
| [2689](#L2689) | $dropdown .= 'selected = selected'; |
| [2690](#L2690) | } |
| [2691](#L2691) |  |
| [2692](#L2692) | $dropdown .= '>' . esc\_html( $type ) . '</option>'; |
| [2693](#L2693) | } |
| [2694](#L2694) |  |
| [2695](#L2695) | return $dropdown; |
| [2696](#L2696) | } |
| [2697](#L2697) |  |
| [2698](#L2698) | /\*\* |
| [2699](#L2699) | \* Get slug name without prefix |
| [2700](#L2700) | \* |
| [2701](#L2701) | \* @param $selected |
| [2702](#L2702) | \* |
| [2703](#L2703) | \* @return string |
| [2704](#L2704) | \* |
| [2705](#L2705) | \* @since 4.8.4 |
| [2706](#L2706) | \*/ |
| [2707](#L2707) | public static function get\_slug\_without\_prefix( $slug ) { |
| [2708](#L2708) |  |
| [2709](#L2709) | $slug\_name = explode( '\_', $slug ); |
| [2710](#L2710) | unset( $slug\_name[0] ); |
| [2711](#L2711) | unset( $slug\_name[1] ); |
| [2712](#L2712) | return implode( '\_', $slug\_name  ); |
| [2713](#L2713) | } |
| [2714](#L2714) |  |
| [2715](#L2715) | /\*\* |
| [2716](#L2716) | \* Check if the domain is blocked based on email |
| [2717](#L2717) | \* |
| [2718](#L2718) | \* @param $email |
| [2719](#L2719) | \* |
| [2720](#L2720) | \* @return bool |
| [2721](#L2721) | \* |
| [2722](#L2722) | \* @since 4.1.0 |
| [2723](#L2723) | \*/ |
| [2724](#L2724) | public static function is\_domain\_blocked( $email ) { |
| [2725](#L2725) |  |
| [2726](#L2726) | if ( empty( $email ) ) { |
| [2727](#L2727) | return true; |
| [2728](#L2728) | } |
| [2729](#L2729) |  |
| [2730](#L2730) | $domains = trim( get\_option( 'ig\_es\_blocked\_domains', '' ) ); |
| [2731](#L2731) |  |
| [2732](#L2732) | // No domains to block? Return |
| [2733](#L2733) | if ( empty( $domains ) ) { |
| [2734](#L2734) | return false; |
| [2735](#L2735) | } |
| [2736](#L2736) |  |
| [2737](#L2737) | $domains = explode( PHP\_EOL, $domains ); |
| [2738](#L2738) |  |
| [2739](#L2739) | $domains = apply\_filters( 'ig\_es\_blocked\_domains', $domains ); |
| [2740](#L2740) |  |
| [2741](#L2741) | if ( empty( $domains ) ) { |
| [2742](#L2742) | return false; |
| [2743](#L2743) | } |
| [2744](#L2744) |  |
| [2745](#L2745) | $rev\_email = strrev( $email ); |
| [2746](#L2746) | foreach ( $domains as $domain ) { |
| [2747](#L2747) | $domain = trim( $domain ); |
| [2748](#L2748) | if ( ! empty( $domain ) && strpos( $rev\_email, strrev( $domain ) ) === 0 ) { |
| [2749](#L2749) | $email\_parts = explode( '@', $email ); |
| [2750](#L2750) | if ( ! empty( $email\_parts[1] ) ) { |
| [2751](#L2751) | $email\_domain = $email\_parts[1]; |
| [2752](#L2752) | if ( $email\_domain === $domain ) { |
| [2753](#L2753) | return true; |
| [2754](#L2754) | } |
| [2755](#L2755) | } |
| [2756](#L2756) | } |
| [2757](#L2757) | } |
| [2758](#L2758) |  |
| [2759](#L2759) | return false; |
| [2760](#L2760) | } |
| [2761](#L2761) |  |
| [2762](#L2762) | /\*\* |
| [2763](#L2763) | \* Get column datatype for custom field in contacts table |
| [2764](#L2764) | \* |
| [2765](#L2765) | \* @param $selected |
| [2766](#L2766) | \* |
| [2767](#L2767) | \* @return string |
| [2768](#L2768) | \* |
| [2769](#L2769) | \* @since 4.8.4 |
| [2770](#L2770) | \*/ |
| [2771](#L2771) | public static function get\_custom\_field\_col\_datatype( $custom\_field\_type = 'text' ) { |
| [2772](#L2772) |  |
| [2773](#L2773) | switch ( $custom\_field\_type ) { |
| [2774](#L2774) | case 'number': |
| [2775](#L2775) | return 'int(50)'; |
| [2776](#L2776) | case 'date': |
| [2777](#L2777) | return 'date'; |
| [2778](#L2778) | case 'radio': |
| [2779](#L2779) | case 'dropdown': |
| [2780](#L2780) | return 'varchar(100)'; |
| [2781](#L2781) | default: |
| [2782](#L2782) | return 'longtext'; |
| [2783](#L2783) | } |
| [2784](#L2784) |  |
| [2785](#L2785) | } |
| [2786](#L2786) |  |
| [2787](#L2787) | /\*\* |
| [2788](#L2788) | \* Prepare month year date filter dropdown options |
| [2789](#L2789) | \* |
| [2790](#L2790) | \* @param $selected |
| [2791](#L2791) | \* @param $default\_label |
| [2792](#L2792) | \* |
| [2793](#L2793) | \* @return string |
| [2794](#L2794) | \* |
| [2795](#L2795) | \* @since 5.0.5 |
| [2796](#L2796) | \*/ |
| [2797](#L2797) | public static function prepare\_datefilter\_dropdown\_options( $selected = '', $default\_label = '' ) { |
| [2798](#L2798) |  |
| [2799](#L2799) | global $wpdb; |
| [2800](#L2800) | // phpcs:disable |
| [2801](#L2801) | $results = $wpdb->get\_results( "SELECT DISTINCT MONTHNAME(`start\_at`), YEAR(`start\_at`) FROM {$wpdb->prefix}ig\_mailing\_queue;", ARRAY\_A ); |
| [2802](#L2802) | // phpcs:enable |
| [2803](#L2803) | $field\_options = array( |
| [2804](#L2804) | 'default' => $default\_label |
| [2805](#L2805) | ); |
| [2806](#L2806) |  |
| [2807](#L2807) | $field\_key = ''; |
| [2808](#L2808) | $dropdown  = ''; |
| [2809](#L2809) |  |
| [2810](#L2810) | foreach ( $results as $key => $record ) { |
| [2811](#L2811) |  |
| [2812](#L2812) | $month\_name\_value = $record['MONTHNAME(`start\_at`)']; |
| [2813](#L2813) | $year\_value       = $record['YEAR(`start\_at`)']; |
| [2814](#L2814) |  |
| [2815](#L2815) | $field\_key   = $year\_value . gmdate( 'm', strtotime($month\_name\_value)); |
| [2816](#L2816) | $field\_value = $month\_name\_value . ' ' . $year\_value; |
| [2817](#L2817) |  |
| [2818](#L2818) | $field\_options[$field\_key] = $field\_value; |
| [2819](#L2819) |  |
| [2820](#L2820) | } |
| [2821](#L2821) |  |
| [2822](#L2822) | foreach ($field\_options as $key => $option\_value) { |
| [2823](#L2823) |  |
| [2824](#L2824) | $value = ( 'default'  !== $key ) ? esc\_attr($key):''; |
| [2825](#L2825) |  |
| [2826](#L2826) | $dropdown .= '<option value = "' . $value . '" '; |
| [2827](#L2827) | $dropdown .= selected( $selected, $key, false ); |
| [2828](#L2828) | $dropdown .= '>' . esc\_html($option\_value) . '</option>'; |
| [2829](#L2829) |  |
| [2830](#L2830) | } |
| [2831](#L2831) |  |
| [2832](#L2832) | return $dropdown; |
| [2833](#L2833) | } |
| [2834](#L2834) |  |
| [2835](#L2835) | public static function get\_in\_between\_content( $content, $start, $end ) { |
| [2836](#L2836) | $r = explode( $start, $content ); |
| [2837](#L2837) | if ( isset( $r[1] ) ) { |
| [2838](#L2838) | $r = explode( $end, $r[1] ); |
| [2839](#L2839) |  |
| [2840](#L2840) | return $r[0]; |
| [2841](#L2841) | } |
| [2842](#L2842) |  |
| [2843](#L2843) | return ''; |
| [2844](#L2844) | } |
| [2845](#L2845) |  |
| [2846](#L2846) | public static function get\_popular\_domains() { |
| [2847](#L2847) | /\*\* Domains list from https://github.com/mailcheck/mailcheck/wiki/List-of-Popular-Domains \*/ |
| [2848](#L2848) | $popular\_domains = array( |
| [2849](#L2849) | /\* Default domains included \*/ |
| [2850](#L2850) | 'aol.com', 'att.net', 'comcast.net', 'facebook.com', 'gmail.com', 'gmx.com', 'googlemail.com', |
| [2851](#L2851) | 'google.com', 'hotmail.com', 'hotmail.co.uk', 'mac.com', 'me.com', 'mail.com', 'msn.com', |
| [2852](#L2852) | 'live.com', 'sbcglobal.net', 'verizon.net', 'yahoo.com', 'yahoo.co.uk', |
| [2853](#L2853) |  |
| [2854](#L2854) | /\* Other global domains \*/ |
| [2855](#L2855) | 'email.com', 'fastmail.fm', 'games.com' /\* AOL \*/, 'gmx.net', 'hush.com', 'hushmail.com', 'icloud.com', |
| [2856](#L2856) | 'iname.com', 'inbox.com', 'lavabit.com', 'love.com' /\* AOL \*/, 'outlook.com', 'pobox.com', 'protonmail.ch', 'protonmail.com', 'tutanota.de', 'tutanota.com', 'tutamail.com', 'tuta.io', |
| [2857](#L2857) | 'keemail.me', 'rocketmail.com' /\* Yahoo \*/, 'safe-mail.net', 'wow.com' /\* AOL \*/, 'ygm.com' /\* AOL \*/, |
| [2858](#L2858) | 'ymail.com' /\* Yahoo \*/, 'zoho.com', 'yandex.com', |
| [2859](#L2859) |  |
| [2860](#L2860) | /\* United States ISP domains \*/ |
| [2861](#L2861) | 'bellsouth.net', 'charter.net', 'cox.net', 'earthlink.net', 'juno.com', |
| [2862](#L2862) |  |
| [2863](#L2863) | /\* British ISP domains \*/ |
| [2864](#L2864) | 'btinternet.com', 'virginmedia.com', 'blueyonder.co.uk', 'live.co.uk', |
| [2865](#L2865) | 'ntlworld.com', 'orange.net', 'sky.com', 'talktalk.co.uk', 'tiscali.co.uk', |
| [2866](#L2866) | 'virgin.net', 'bt.com', |
| [2867](#L2867) |  |
| [2868](#L2868) | /\* Domains used in Asia \*/ |
| [2869](#L2869) | 'sina.com', 'sina.cn', 'qq.com', 'naver.com', 'hanmail.net', 'daum.net', 'nate.com', 'yahoo.co.jp', 'yahoo.co.kr', 'yahoo.co.id', 'yahoo.co.in', 'yahoo.com.sg', 'yahoo.com.ph', '163.com', 'yeah.net', '126.com', '21cn.com', 'aliyun.com', 'foxmail.com', |
| [2870](#L2870) |  |
| [2871](#L2871) | /\* French ISP domains \*/ |
| [2872](#L2872) | 'hotmail.fr', 'live.fr', 'laposte.net', 'yahoo.fr', 'wanadoo.fr', 'orange.fr', 'gmx.fr', 'sfr.fr', 'neuf.fr', 'free.fr', |
| [2873](#L2873) |  |
| [2874](#L2874) | /\* German ISP domains \*/ |
| [2875](#L2875) | 'gmx.de', 'hotmail.de', 'live.de', 'online.de', 't-online.de' /\* T-Mobile \*/, 'web.de', 'yahoo.de', |
| [2876](#L2876) |  |
| [2877](#L2877) | /\* Italian ISP domains \*/ |
| [2878](#L2878) | 'libero.it', 'virgilio.it', 'hotmail.it', 'aol.it', 'tiscali.it', 'alice.it', 'live.it', 'yahoo.it', 'email.it', 'tin.it', 'poste.it', 'teletu.it', |
| [2879](#L2879) |  |
| [2880](#L2880) | /\* Russian ISP domains \*/ |
| [2881](#L2881) | 'bk.ru', 'inbox.ru', 'list.ru', 'mail.ru', 'rambler.ru', 'yandex.by', 'yandex.com', 'yandex.kz', 'yandex.ru', 'yandex.ua', 'ya.ru', |
| [2882](#L2882) |  |
| [2883](#L2883) | /\* Belgian ISP domains \*/ |
| [2884](#L2884) | 'hotmail.be', 'live.be', 'skynet.be', 'voo.be', 'tvcablenet.be', 'telenet.be', |
| [2885](#L2885) |  |
| [2886](#L2886) | /\* Argentinian ISP domains \*/ |
| [2887](#L2887) | 'hotmail.com.ar', 'live.com.ar', 'yahoo.com.ar', 'fibertel.com.ar', 'speedy.com.ar', 'arnet.com.ar', |
| [2888](#L2888) |  |
| [2889](#L2889) | /\* Domains used in Mexico \*/ |
| [2890](#L2890) | 'yahoo.com.mx', 'live.com.mx', 'hotmail.es', 'hotmail.com.mx', 'prodigy.net.mx', |
| [2891](#L2891) |  |
| [2892](#L2892) | /\* Domains used in Canada \*/ |
| [2893](#L2893) | 'yahoo.ca', 'hotmail.ca', 'bell.net', 'shaw.ca', 'sympatico.ca', 'rogers.com', |
| [2894](#L2894) |  |
| [2895](#L2895) | /\* Domains used in Brazil \*/ |
| [2896](#L2896) | 'yahoo.com.br', 'hotmail.com.br', 'outlook.com.br', 'uol.com.br', 'bol.com.br', 'terra.com.br', 'ig.com.br', 'r7.com', 'zipmail.com.br', 'globo.com', 'globomail.com', 'oi.com.br' |
| [2897](#L2897) | ); |
| [2898](#L2898) |  |
| [2899](#L2899) | return $popular\_domains; |
| [2900](#L2900) | } |
| [2901](#L2901) |  |
| [2902](#L2902) | public static function is\_popular\_domain( $email ) { |
| [2903](#L2903) |  |
| [2904](#L2904) | $is\_email = is\_email( $email ); |
| [2905](#L2905) | if ( ! $is\_email ) { |
| [2906](#L2906) | return false; |
| [2907](#L2907) | } |
| [2908](#L2908) |  |
| [2909](#L2909) | $email\_parts = explode( '@', $email ); |
| [2910](#L2910) | $domain          = end( $email\_parts ); |
| [2911](#L2911) | $$domain     = strtolower( $domain ); |
| [2912](#L2912) |  |
| [2913](#L2913) | $popular\_domains = self::get\_popular\_domains(); |
| [2914](#L2914) |  |
| [2915](#L2915) | return in\_array( $domain, $popular\_domains, true ); |
| [2916](#L2916) | } |
| [2917](#L2917) |  |
| [2918](#L2918) | public static function get\_domain\_from\_url( $url ) { |
| [2919](#L2919) | $pieces = parse\_url($url); |
| [2920](#L2920) | $domain = isset($pieces['host']) ? $pieces['host'] : $pieces['path']; |
| [2921](#L2921) | return $domain; |
| [2922](#L2922) | } |
| [2923](#L2923) |  |
| [2924](#L2924) | public static function get\_engagement\_score\_html( $engagement\_score ) { |
| [2925](#L2925) | if ( is\_numeric( $engagement\_score ) ) { |
| [2926](#L2926) | $score\_class = 'bad'; |
| [2927](#L2927) |  |
| [2928](#L2928) | if ( $engagement\_score > 0 ) { |
| [2929](#L2929) | $score\_text = number\_format\_i18n( $engagement\_score, 1 ); |
| [2930](#L2930) | } else { |
| [2931](#L2931) | $score\_text = 0; |
| [2932](#L2932) | } |
| [2933](#L2933) |  |
| [2934](#L2934) | if ( $engagement\_score >= 4 ) { |
| [2935](#L2935) | $score\_class = 'excellent'; |
| [2936](#L2936) | } elseif ( $engagement\_score >= 3 ) { |
| [2937](#L2937) | $score\_class = 'good'; |
| [2938](#L2938) | } elseif ( $engagement\_score >= 2 ) { |
| [2939](#L2939) | $score\_class = 'low'; |
| [2940](#L2940) | } elseif ( $engagement\_score >= 1 ) { |
| [2941](#L2941) | $score\_class = 'very-low'; |
| [2942](#L2942) | } |
| [2943](#L2943) | } |
| [2944](#L2944) | $engagement\_score\_html = ( is\_numeric( $engagement\_score ) ? '<div class="es-engagement-score ' . $score\_class . '">' . $score\_text . '</div>' : '-' ); |
| [2945](#L2945) |  |
| [2946](#L2946) | return $engagement\_score\_html; |
| [2947](#L2947) | } |
| [2948](#L2948) |  |
| [2949](#L2949) | public static function get\_email\_verify\_mailbox\_user() { |
| [2950](#L2950) | $username = get\_option( 'ig\_es\_test\_mailbox\_user', '' ); |
| [2951](#L2951) | if ( !empty( $username) ) { |
| [2952](#L2952) | $username = 'spam\_check\_' . $username; |
| [2953](#L2953) | } |
| [2954](#L2954) | return( $username ); |
| [2955](#L2955) | } |
| [2956](#L2956) |  |
| [2957](#L2957) | public static function get\_ig\_es\_mailbox\_domain() { |
| [2958](#L2958) | $domain = 'box.icegram.com'; |
| [2959](#L2959) | return( $domain ); |
| [2960](#L2960) | } |
| [2961](#L2961) |  |
| [2962](#L2962) | public static function get\_email\_verify\_test\_email() { |
| [2963](#L2963) | $username = self::get\_email\_verify\_mailbox\_user(); |
| [2964](#L2964) | $domain   = self::get\_ig\_es\_mailbox\_domain(); |
| [2965](#L2965) |  |
| [2966](#L2966) | if ( !empty( $username) ) { |
| [2967](#L2967) | $email = $username . '@' . $domain; |
| [2968](#L2968) | return( $email ); |
| [2969](#L2969) | } |
| [2970](#L2970) | return ''; |
| [2971](#L2971) | } |
| [2972](#L2972) |  |
| [2973](#L2973) | public static function download\_image\_from\_url( $image\_url ) { |
| [2974](#L2974) |  |
| [2975](#L2975) | $attachment\_url = ''; |
| [2976](#L2976) | $upload\_dir     = wp\_upload\_dir(); |
| [2977](#L2977) | $image\_data     = file\_get\_contents( $image\_url ); |
| [2978](#L2978) | $filename       = basename( $image\_url ); |
| [2979](#L2979) | if ( wp\_mkdir\_p( $upload\_dir['path'] ) ) { |
| [2980](#L2980) | $file = $upload\_dir['path'] . '/' . $filename; |
| [2981](#L2981) | } else { |
| [2982](#L2982) | $file = $upload\_dir['basedir'] . '/' . $filename; |
| [2983](#L2983) | } |
| [2984](#L2984) |  |
| [2985](#L2985) | file\_put\_contents( $file, $image\_data ); |
| [2986](#L2986) |  |
| [2987](#L2987) | $wp\_filetype = wp\_check\_filetype( $filename, null ); |
| [2988](#L2988) | $attachment  = array( |
| [2989](#L2989) | 'post\_mime\_type' => $wp\_filetype['type'], |
| [2990](#L2990) | 'post\_title'     => sanitize\_file\_name( $filename ), |
| [2991](#L2991) | 'post\_content'   => '', |
| [2992](#L2992) | 'post\_status'    => 'inherit', |
| [2993](#L2993) | ); |
| [2994](#L2994) | $attach\_id   = wp\_insert\_attachment( $attachment, $file ); |
| [2995](#L2995) | if ( ! empty( $attach\_id ) ) { |
| [2996](#L2996) | $attachment\_url = wp\_get\_attachment\_url( $attach\_id ); |
| [2997](#L2997) | } |
| [2998](#L2998) | return $attachment\_url; |
| [2999](#L2999) | } |
| [3000](#L3000) |  |
| [3001](#L3001) | /\*\* |
| [3002](#L3002) | \* Get list status(subscribed or unconfirmed) based on optin type(single optin or double optin) |
| [3003](#L3003) | \* |
| [3004](#L3004) | \* @since 5.4.18 |
| [3005](#L3005) | \* |
| [3006](#L3006) | \* @return string |
| [3007](#L3007) | \*/ |
| [3008](#L3008) | public static function get\_list\_status\_from\_optin\_type() { |
| [3009](#L3009) | $es\_optin\_type = get\_option( 'ig\_es\_optin\_type' ); |
| [3010](#L3010) |  |
| [3011](#L3011) | if ( in\_array( $es\_optin\_type, array( 'double\_opt\_in', 'double\_optin' ), true ) ) { |
| [3012](#L3012) | $status = 'unconfirmed'; |
| [3013](#L3013) | } else { |
| [3014](#L3014) | $status = 'subscribed'; |
| [3015](#L3015) | } |
| [3016](#L3016) |  |
| [3017](#L3017) | return $status; |
| [3018](#L3018) | } |
| [3019](#L3019) |  |
| [3020](#L3020) | /\*\* |
| [3021](#L3021) | \* Check if WordPress has REST API support or not |
| [3022](#L3022) | \* |
| [3023](#L3023) | \* @since 5.4.18 |
| [3024](#L3024) | \* |
| [3025](#L3025) | \* @return bool |
| [3026](#L3026) | \*/ |
| [3027](#L3027) | public static function is\_rest\_api\_supported() { |
| [3028](#L3028) | global $wp\_version; |
| [3029](#L3029) |  |
| [3030](#L3030) | if ( version\_compare( $wp\_version, '4.4.0', '<' ) ) { |
| [3031](#L3031) | return false; |
| [3032](#L3032) | } |
| [3033](#L3033) |  |
| [3034](#L3034) | return true; |
| [3035](#L3035) | } |
| [3036](#L3036) |  |
| [3037](#L3037) |  |
| [3038](#L3038) |  |
| [3039](#L3039) | public static function is\_positive\_number( $number ) { |
| [3040](#L3040) | return is\_numeric( $number ) && $number > 0; |
| [3041](#L3041) | } |
| [3042](#L3042) |  |
| [3043](#L3043) | /\*\* |
| [3044](#L3044) | \* Get the date when plugin was activated for first time |
| [3045](#L3045) | \* |
| [3046](#L3046) | \* @return string $installation\_date |
| [3047](#L3047) | \* |
| [3048](#L3048) | \* @since 5.6.0 |
| [3049](#L3049) | \*/ |
| [3050](#L3050) | public static function get\_plugin\_installation\_date() { |
| [3051](#L3051) | $installation\_date = get\_option( 'ig\_es\_installed\_on' ); |
| [3052](#L3052) | return $installation\_date; |
| [3053](#L3053) | } |
| [3054](#L3054) |  |
| [3055](#L3055) | public static function get\_gmt\_timestamp\_from\_day\_and\_time( $day\_and\_time ) { |
| [3056](#L3056) | try { |
| [3057](#L3057) | $date                   = new DateTime( $day\_and\_time ); |
| [3058](#L3058) | $scheduled\_datetime     = $date->format( 'Y-m-d h:i:s A' ); |
| [3059](#L3059) | $scheduled\_datetime\_gmt = get\_gmt\_from\_date( $scheduled\_datetime ); |
| [3060](#L3060) |  |
| [3061](#L3061) | return strtotime( $scheduled\_datetime\_gmt ); |
| [3062](#L3062) | } catch ( Exception $e ) { |
| [3063](#L3063) | return null; |
| [3064](#L3064) | } |
| [3065](#L3065) | } |
| [3066](#L3066) |  |
| [3067](#L3067) | public static function replace\_posts\_blocks( $content, $post\_ids ) { |
| [3068](#L3068) | foreach ( $post\_ids as $single\_block\_post\_ids ) { |
| [3069](#L3069) | $content = self::replace\_single\_posts\_block( $content, $single\_block\_post\_ids ); |
| [3070](#L3070) | } |
| [3071](#L3071) | return $content; |
| [3072](#L3072) | } |
| [3073](#L3073) |  |
| [3074](#L3074) | public static function replace\_single\_posts\_block( $content, $single\_block\_post\_ids ) { |
| [3075](#L3075) | $posts\_block\_inner\_content = self::get\_in\_between\_content( $content, '{{campaign.posts}}', '{{/campaign.posts}}' ); |
| [3076](#L3076) | $search\_start = '{{campaign.posts}}'; |
| [3077](#L3077) | $search\_end   = '{{/campaign.posts}}'; |
| [3078](#L3078) | $start\_pos    = strpos($content, $search\_start); |
| [3079](#L3079) | if ( false !== $start\_pos ) { |
| [3080](#L3080) | // Find the corresponding closing tag |
| [3081](#L3081) | $end\_pos = strpos($content, $search\_end, $start\_pos + strlen($search\_start)); |
| [3082](#L3082) | $replace                   = ''; |
| [3083](#L3083) | if ( false !== $end\_pos ) { |
| [3084](#L3084) | if ( ! empty( $single\_block\_post\_ids ) ) { |
| [3085](#L3085) | foreach ( $single\_block\_post\_ids as $post\_id ) { |
| [3086](#L3086) | $replace .= ES\_Handle\_Post\_Notification::prepare\_body( $posts\_block\_inner\_content, $post\_id, 0 ); |
| [3087](#L3087) | } |
| [3088](#L3088) | } |
| [3089](#L3089) | // Replace the entire block with the replacement content |
| [3090](#L3090) | $content = substr\_replace($content, $replace, $start\_pos, $end\_pos + strlen($search\_end) - $start\_pos); |
| [3091](#L3091) | } |
| [3092](#L3092) | } |
| [3093](#L3093) | $content = ES\_Handle\_Post\_Notification::prepare\_body( $content, $post\_id, 0 ); |
| [3094](#L3094) | return $content; |
| [3095](#L3095) | } |
| [3096](#L3096) |  |
| [3097](#L3097) | public static function contains\_posts\_block( $content ) { |
| [3098](#L3098) | return strpos( $content, '{{campaign.posts}}' ) !== false; |
| [3099](#L3099) | } |
| [3100](#L3100) |  |
| [3101](#L3101) | public static function replace\_post\_digest\_keyword\_with\_posts\_keyword( $content ) { |
| [3102](#L3102) | $find = array( '{{post.digest}}', '{{/post.digest}}' ); |
| [3103](#L3103) | $replace = array( '{{campaign.posts}}', '{{/campaign.posts}}' ); |
| [3104](#L3104) | $content = str\_replace( $find, $replace , $content ); |
| [3105](#L3105) |  |
| [3106](#L3106) | $find = array( '{{POSTDIGEST}}', '{{/POSTDIGEST}}' ); |
| [3107](#L3107) | $replace = array( '{{campaign.posts}}', '{{/campaign.posts}}' ); |
| [3108](#L3108) | $content = str\_replace( $find, $replace , $content ); |
| [3109](#L3109) | return $content; |
| [3110](#L3110) | } |
| [3111](#L3111) |  |
| [3112](#L3112) | public static function wrap\_post\_keywords\_between\_campaign\_posts\_keyword( $text ) { |
| [3113](#L3113) | $pattern = '/(<[^>]\*>\s\*\{{(DATE|[Pp][^\{\}]\*)}}\s\*<\/[^>]\*>)|(<[^>]\*?({{(DATE|[Pp][^\{\}]\*)}})[^>]\*>.\*?<\/\w+>)|(<[^>]\*{{(DATE|[Pp][^\{\}]\*)}}[^>]\*>)|(\{\{[PpD][^\}]\*\}\})/'; |
| [3114](#L3114) | preg\_match\_all($pattern, $text, $matches); |
| [3115](#L3115) |  |
| [3116](#L3116) | if (!empty($matches[0])) { |
| [3117](#L3117) | if ( count( $matches[0] ) > 1 ) { |
| [3118](#L3118) | $firstKeyword = $matches[0][0]; |
| [3119](#L3119) | $lastKeyword = $matches[0][count($matches[0]) - 1]; |
| [3120](#L3120) |  |
| [3121](#L3121) | $wrappedText = preg\_replace('/(' . preg\_quote($firstKeyword, '/') . '.\*?' . preg\_quote($lastKeyword, '/') . ')/s', '{{campaign.posts}}$1{{/campaign.posts}}', $text, 1); |
| [3122](#L3122) |  |
| [3123](#L3123) | } else { |
| [3124](#L3124) | $keyword = $matches[0][0]; |
| [3125](#L3125) | $wrappedText = str\_replace( $keyword, '{{campaign.posts}}' . $keyword . '{{/campaign.posts}}', $text ); |
| [3126](#L3126) | } |
| [3127](#L3127) |  |
| [3128](#L3128) | return $wrappedText; |
| [3129](#L3129) | } else { |
| [3130](#L3130) | return $text; |
| [3131](#L3131) | } |
| [3132](#L3132) | } |
| [3133](#L3133) |  |
| [3134](#L3134) | public static function get\_campaign\_default\_data( $campaign\_type ) { |
| [3135](#L3135) | $default\_content = apply\_filters( 'ig\_es\_' . $campaign\_type . '\_default\_content', '' ); |
| [3136](#L3136) | $default\_subject = apply\_filters( 'ig\_es\_' . $campaign\_type . '\_default\_subject', '' ); |
| [3137](#L3137) | return array( |
| [3138](#L3138) | 'subject' => $default\_subject, |
| [3139](#L3139) | 'content' => $default\_content |
| [3140](#L3140) | ); |
| [3141](#L3141) | } |
| [3142](#L3142) |  |
| [3143](#L3143) | public static function get\_tags() { |
| [3144](#L3144) | $subscriber\_tags = self::get\_subscriber\_tags(); |
| [3145](#L3145) | $site\_tags               = self::get\_site\_tags(); |
| [3146](#L3146) | $campaign\_tags   = self::get\_campaign\_tags(); |
| [3147](#L3147) | return array( |
| [3148](#L3148) | 'subscriber\_tags' => $subscriber\_tags, |
| [3149](#L3149) | 'site\_tags' => $site\_tags, |
| [3150](#L3150) | 'campaign\_tags' => $campaign\_tags, |
| [3151](#L3151) | ); |
| [3152](#L3152) | } |
| [3153](#L3153) |  |
| [3154](#L3154) | public static function get\_campaign\_tags() { |
| [3155](#L3155) |  |
| [3156](#L3156) | $post\_notification\_tags = self::get\_post\_notification\_tags(); |
| [3157](#L3157) |  |
| [3158](#L3158) | $campaign\_tags = array( |
| [3159](#L3159) | 'post\_notification' => $post\_notification\_tags, |
| [3160](#L3160) | ); |
| [3161](#L3161) |  |
| [3162](#L3162) | return apply\_filters( 'ig\_es\_campaign\_tags', $campaign\_tags ); |
| [3163](#L3163) | } |
| [3164](#L3164) |  |
| [3165](#L3165) | public static function get\_post\_notification\_tags() { |
| [3166](#L3166) | $post\_notification\_tags = array( |
| [3167](#L3167) | '{{post.date}}', |
| [3168](#L3168) | '{{post.title}}', |
| [3169](#L3169) | '{{post.image}}', |
| [3170](#L3170) | '{{post.excerpt}}', |
| [3171](#L3171) | '{{post.description}}', |
| [3172](#L3172) | '{{post.author}}', |
| [3173](#L3173) | '{{post.link}}', |
| [3174](#L3174) | '{{post.link\_with\_title}}', |
| [3175](#L3175) | '{{post.link\_only}}', |
| [3176](#L3176) | '{{post.full}}', |
| [3177](#L3177) | '{{post.cats}}', |
| [3178](#L3178) | '{{post.more\_tag}}', |
| [3179](#L3179) | '{{post.image\_url}}' |
| [3180](#L3180) | ); |
| [3181](#L3181) | return apply\_filters( 'ig\_es\_post\_notification\_tags', $post\_notification\_tags ); |
| [3182](#L3182) | } |
| [3183](#L3183) |  |
| [3184](#L3184) | public static function get\_subscriber\_tags() { |
| [3185](#L3185) | $subscriber\_tags = array( |
| [3186](#L3186) | '{{subscriber.name}}', |
| [3187](#L3187) | '{{subscriber.first\_name}}', |
| [3188](#L3188) | '{{subscriber.last\_name}}', |
| [3189](#L3189) | '{{subscriber.email}}', |
| [3190](#L3190) | ); |
| [3191](#L3191) | return apply\_filters( 'ig\_es\_subscriber\_tags', $subscriber\_tags ); |
| [3192](#L3192) | } |
| [3193](#L3193) |  |
| [3194](#L3194) | public static function get\_site\_tags() { |
| [3195](#L3195) | $site\_tags = array( |
| [3196](#L3196) | '{{site.total\_contacts}}', |
| [3197](#L3197) | '{{site.url}}', |
| [3198](#L3198) | '{{site.name}}', |
| [3199](#L3199) | ); |
| [3200](#L3200) |  |
| [3201](#L3201) | return apply\_filters( 'ig\_es\_site\_tags', $site\_tags ); |
| [3202](#L3202) | } |
| [3203](#L3203) |  |
| [3204](#L3204) | public static function is\_optimizer\_enabled() { |
| [3205](#L3205) | $send\_time\_optimizer\_enabled = get\_option('ig\_es\_send\_time\_optimizer\_enabled', 'no' ); |
| [3206](#L3206) | return 'yes' === $send\_time\_optimizer\_enabled; |
| [3207](#L3207) | } |
| [3208](#L3208) | public static function get\_optimization\_method() { |
| [3209](#L3209) | $optimization\_method = get\_option('ig\_es\_send\_time\_optimization\_method', 'subscriber\_timezone' ); |
| [3210](#L3210) | return $optimization\_method; |
| [3211](#L3211) | } |
| [3212](#L3212) |  |
| [3213](#L3213) | public static function get\_optimization\_details() { |
| [3214](#L3214) | if (self::is\_optimizer\_enabled()) { |
| [3215](#L3215) | $optimization\_option = self::get\_optimization\_method(); |
| [3216](#L3216) | return $optimization\_option; |
| [3217](#L3217) | } |
| [3218](#L3218) | return ''; |
| [3219](#L3219) | } |
| [3220](#L3220) |  |
| [3221](#L3221) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/email-subscribers/tags/5.7.29/lite/includes/class-es-common.php?format=txt)
* [Original Format](/export/3220628/email-subscribers/tags/5.7.29/lite/includes/class-es-common.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

