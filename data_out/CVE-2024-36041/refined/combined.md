=== Content from github.com_6e156968_20250111_173553.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FKDE%2Fplasma-workspace%2Ftags)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FKDE%2Fplasma-workspace%2Ftags)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Ftag_history&source=header-repo&source_repo=KDE%2Fplasma-workspace)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[KDE](/KDE)
/
**[plasma-workspace](/KDE/plasma-workspace)**
Public

* [Notifications](/login?return_to=%2FKDE%2Fplasma-workspace) You must be signed in to change notification settings
* [Fork
  92](/login?return_to=%2FKDE%2Fplasma-workspace)
* [Star
   220](/login?return_to=%2FKDE%2Fplasma-workspace)

* [Code](/KDE/plasma-workspace)
* [Pull requests
  0](/KDE/plasma-workspace/pulls)
* [Actions](/KDE/plasma-workspace/actions)
* [Security](/KDE/plasma-workspace/security)
* [Insights](/KDE/plasma-workspace/pulse)

Additional navigation options

* [Code](/KDE/plasma-workspace)
* [Pull requests](/KDE/plasma-workspace/pulls)
* [Actions](/KDE/plasma-workspace/actions)
* [Security](/KDE/plasma-workspace/security)
* [Insights](/KDE/plasma-workspace/pulse)

# Tags: KDE/plasma-workspace

[Releases](/KDE/plasma-workspace/releases)
[Tags](/KDE/plasma-workspace/tags)

Tags

## [v6.2.90](/KDE/plasma-workspace/releases/tag/v6.2.90)

Toggle v6.2.90's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.90

```

* Jan 9, 2025
* [052a976](/KDE/plasma-workspace/commit/052a976d94714ad467509ba27799aaa63708fef8)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.90.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.90.tar.gz)

## [v5.27.12](/KDE/plasma-workspace/releases/tag/v5.27.12)

Toggle v5.27.12's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 5.27.12

```

* Jan 6, 2025
* [8bea9ed](/KDE/plasma-workspace/commit/8bea9ed905f190b04f161995c927e7fd096d2016)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v5.27.12.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v5.27.12.tar.gz)

## [v6.2.5](/KDE/plasma-workspace/releases/tag/v6.2.5)

Toggle v6.2.5's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.5

```

* Dec 31, 2024
* [21bd07c](/KDE/plasma-workspace/commit/21bd07c3f2d69be8fa8e80849edb0558f9dd9d99)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.5.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.5.tar.gz)

## [v6.2.4](/KDE/plasma-workspace/releases/tag/v6.2.4)

Toggle v6.2.4's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.4

```

* Nov 26, 2024
* [c6b87a8](/KDE/plasma-workspace/commit/c6b87a8488d9789b94783f6e887aa9067a4ded6c)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.4.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.4.tar.gz)

## [v6.2.3](/KDE/plasma-workspace/releases/tag/v6.2.3)

Toggle v6.2.3's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.3

```

* Nov 5, 2024
* [ab0c03f](/KDE/plasma-workspace/commit/ab0c03f2bcb615c8e3862fc3920a4991ffb99b56)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.3.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.3.tar.gz)

## [v6.2.2](/KDE/plasma-workspace/releases/tag/v6.2.2)

Toggle v6.2.2's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.2

```

* Oct 22, 2024
* [51996a8](/KDE/plasma-workspace/commit/51996a85c6535dffb35044a09ce7622a3e71eae1)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.2.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.2.tar.gz)

## [v6.2.1.1](/KDE/plasma-workspace/releases/tag/v6.2.1.1)

Toggle v6.2.1.1's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.1.1

```

* Oct 16, 2024
* [52bb8da](/KDE/plasma-workspace/commit/52bb8daeccfddde002f6d778433ec282472d3296)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.1.1.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.1.1.tar.gz)

## [v6.2.1](/KDE/plasma-workspace/releases/tag/v6.2.1)

Toggle v6.2.1's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.1

```

* Oct 15, 2024
* [b2b9c19](/KDE/plasma-workspace/commit/b2b9c196b8aa3a78e3847e923f2f53f710ac2806)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.1.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.1.tar.gz)

## [v6.2.0](/KDE/plasma-workspace/releases/tag/v6.2.0)

Toggle v6.2.0's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.2.0

```

* Oct 8, 2024
* [ba67ab3](/KDE/plasma-workspace/commit/ba67ab37fca0ddc1f61b1a06ff748449e6cf3f5b)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.2.0.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.2.0.tar.gz)

## [v6.1.90](/KDE/plasma-workspace/releases/tag/v6.1.90)

Toggle v6.1.90's commit message

Verified

# Verified

This tag was signed with the committer’s **verified signature**.

[![](https://avatars.githubusercontent.com/u/89822?s=64&v=4)](/jriddell)
[jriddell](/jriddell)
Jonathan Riddell

GPG key ID: D7574483BB57B18D

[Learn about vigilant mode](https://docs.github.com/github/authenticating-to-github/displaying-verification-statuses-for-all-of-your-commits)

```
Tagging 6.1.90

```

* Sep 12, 2024
* [d7a1d7f](/KDE/plasma-workspace/commit/d7a1d7fdfa8fb5dbc2f7b58e6449b92fc3f4d05c)
* [zip](/KDE/plasma-workspace/archive/refs/tags/v6.1.90.zip)
* [tar.gz](/KDE/plasma-workspace/archive/refs/tags/v6.1.90.tar.gz)

Previous[Next](/KDE/plasma-workspace/tags?after=v6.1.90)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from kde.org_187b48ad_20250111_173554.html ===
Title: ksmserver: Unauthorized users can access session manager
Risk Rating: High
CVE: CVE-2024-36041
Versions: plasma-workspace <= 6.0.6
Author: David Edmundson
Date: 31/05/2024
Overview
========
KSmserver, KDE's XSMP manager, incorrectly allows connections via ICE
based purely on the host, allowing all local connections. This allows
another user on the same machine to gain access to the session
manager.
A well crafted client could use the session restore feature to execute
arbitrary code as the user on the next boot.
Solution
========
For Plasma 6 Either:
- Update plasma-workspace to 6.0.5.1
- Apply patch https://invent.kde.org/plasma/plasma-workspace/-/commit/8047b93defa4be4c6c1864e93c41fddcef2969bb AND ensure the binary "iceauth" is installed
- Apply patches https://invent.kde.org/plasma/plasma-workspace/-/commit/8047b93defa4be4c6c1864e93c41fddcef2969bb AND https://invent.kde.org/plasma/plasma-workspace/-/commit/a061b08e90ec5554d5ff8c57ae1218130c76e27a
For Plasma 5 Either:
- Update plasma-workspace to 5.27.11.1
- Apply patch https://invent.kde.org/plasma/plasma-workspace/-/commit/da843d3fdb143ed44094c8e6246cfb8305f6f09f AND ensure the binary "iceauth" is installed
- Apply patches https://invent.kde.org/plasma/plasma-workspace/-/commit/da843d3fdb143ed44094c8e6246cfb8305f6f09f AND https://invent.kde.org/plasma/plasma-workspace/-/commit/1d5aa1d27bff87b2d242ed759cfb2ce15a5c3de7
Credits
=======
Thanks to Fabian Vogt for the report and work on the patches.


=== Content from invent.kde.org_f1b00be1_20250111_173554.html ===


[Skip to content](#content-body)
GitLab
[![](data:image/gif;base64...)](/ "Homepage")

* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)

P
# Plasma Workspace

## Project information

Various components needed to run a Plasma-based environment

Read more

* [**17,144** Commits](/plasma/plasma-workspace/-/commits/master)
* [**697** Branches](/plasma/plasma-workspace/-/branches)
* [**234** Tags](/plasma/plasma-workspace/-/tags)

* [README](/plasma/plasma-workspace/-/blob/master/README.md)

Created on

May 16, 2020

Find file

Copy HTTPS clone URL

* [**Copy SSH clone URL**git@invent.kde.org:plasma/plasma-workspace.git](git%40invent.kde.org%3Aplasma/plasma-workspace.git)
* [**Copy HTTPS clone URL**https://invent.kde.org/plasma/plasma-workspace.git](https://invent.kde.org/plasma/plasma-workspace.git)

Loading



=== Content from www.x.org_22393a96_20250111_173555.html ===

# X Session Management Protocol

## X Consortium Standard

### Mike Wexler

Kubota Pacific Computer, Inc

X Version 11, Release 7.7

Version 1.0

Copyright Â© 1992, 1993, 1994, 2002 The Open Group

Permission is hereby granted, free of charge, to any person
obtaining a copy of this software and associated documentation files
(the âSoftwareâ), to deal in the Software without
restriction, including without limitation the rights to use, copy,
modify, merge, publish, distribute, sublicense, and/or sell copies of
the Software, and to permit persons to whom the Software is furnished
to do so, subject to the following conditions:

The above copyright notice and this permission notice shall be
included in all copies or substantial portions of the Software.

THE SOFTWARE IS PROVIDED âAS ISâ, WITHOUT WARRANTY
OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE
WARRANTIES OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND
NONINFRINGEMENT. IN NO EVENT SHALL THE X CONSORTIUM BE LIABLE FOR ANY
CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT,
TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE
SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.

Except as contained in this notice, the name of the X Consortium
shall not be used in advertising or otherwise to promote the sale, use
or other dealings in this Software without prior written authorization
from the X Consortium.

X Window System is a trademark of The Open Group.

This document specifies a protocol that facilitates the management of
groups of client applications by a session manager. The session
manager can cause clients to save their state, to shut down, and to be
restarted into a previously saved state. This protocol is layered on
top of the X.Org ICE protocol.

---

**Table of Contents**

[1. Acknowledgments](#Acknowledgments)[2. Definitions and Goals](#Definitions_and_Goals)[3. Overview of the Protocol](#Overview_of_the_Protocol)[4. Data Types](#Data_Types)[5. Protocol Setup and Message Format](#Protocol_Setup_and_Message_Format)[6. Client Identification String](#Client_Identification_String)[7. Protocol](#Protocol)[8. Errors](#Errors)[9. State Diagrams](#State_Diagrams)[Client State Diagram](#Client_State_Diagram)[Session Manager State Diagram](#Session_Manager_State_Diagram)[10. Protocol Encoding](#Protocol_Encoding)[Types](#Types)[Messages](#Messages)[11. Predefined Properties](#Predefined_Properties)
## ChapterÂ 1.Â Acknowledgments

First I would like to thank the entire ICCCM and Intrinsics
working groups for the comments and suggestions. I would like to make special
thanks to the following people (in alphabetical order), Jordan Brown,
Ellis Cohen, Donna Converse, Vania Joloboff, Stuart Marks, Ralph Mor
and Bob Scheifler.

## ChapterÂ 2.Â Definitions and Goals

The purpose of the X Session Management Protocol (XSMP) is
to provide a uniform mechanism for users to save and restore their sessions.
A *session* is a group of clients, each
of which has a particular state. The session is controlled by a
network service called the *session manager*.
The session manager issues commands to its
clients on behalf of the user. These commands may cause clients to
save their state or to terminate. It is expected that the client will
save its state in such a way that the client can be restarted at a
later time and resume its operation as if it had never been
terminated. A client's state might include information about the file
currently being edited, the current position of the insertion point
within the file, or the start of an uncommitted transaction. The
means by which clients are restarted is unspecified by this
protocol.

For purposes of this protocol, a *client*
of the session manager is defined as a connection to the session
manager. A client is typically, though not necessarily, a process
running an application program connected to an X Window System
display. However, a client may be connected to more than one X
display or not be connected to any X displays at all.

This protocol is layered on top of the X Consortium's ICE protocol and
relies on the ICE protocol to handle connection management and authentication.

## ChapterÂ 3.Â Overview of the Protocol

Clients use XSMP to register themselves with the session manager (SM).
When a client starts up, it should connect to the SM. The client
should remain connected for as long as it runs. A client may resign
from the session by issuing the proper protocol messages before
disconnecting. Termination of the connection without notice will be
taken as an indication that the client died unexpectedly.

Clients are expected to save their state in such a way as to allow
multiple instantiations of themselves to be managed independently. A
unique value called a *client-ID* is
provided by the protocol for the purpose of disambiguating multiple
instantiations of clients. Clients may use this ID, for example, as
part of a filename in which to store the state for a particular
instantiation. The client-ID should be saved as part of the command
used to restart this client
(the RestartCommand) so that the client
will retain the same ID after it is restarted. Certain small pieces
of state might also be stored in the RestartCommand. For example, an
X11 client might place a '-twoWindow' option in its RestartCommand to
indicate that it should start up in two window mode when it is
restarted.

The client finds the network address of the SM in a system-dependent
way. On POSIX systems an environment
variable called `SESSION_MANAGER`
will contain a list of network IDs. Each id will contain the
transport name followed by a slash and the (transport-specific)
address. A TCP/IP address would look like this:

`tcp/`*`hostname`*`:`*`portnumber`*

where the hostname is a fully qualified domain name.
A Unix Domain address looks like this:

`local/`*`hostname`*`:`*`path`*

A DECnet address would look like this:

`decnet/`*`nodename`*`::`*`objname`*

If multiple network IDs are specified, they should be separated by commas.

### Rationale

There was much discussion over whether the XSMP protocol should use X
as the transport protocol or whether it should use its own independent
transport. It was decided that it would use an independent protocol
for several reasons. First, the Session Manager should be able to
manage programs that do not maintain an X connection. Second, the X
protocol is not appropriate to use as a general-purpose transport
protocol. Third, a session might span multiple displays.

The protocol is connection based, because there is no other way for
the SM to determine reliably when clients terminate.

It should be noted that this protocol introduces another single point
of failure into the system. Although it is possible for clients to
continue running after the SM has exited, this will probably not be
the case in normal practice. Normally the program that starts the SM
will consider the session to be terminated when the SM exits (either
normally or abnormally).

To get around this would require some sort of rendezvous server that
would also introduce a single point of failure. In the absence of a
generally available rendezvous server, XSMP is kept simple in the
hopes of making simple reliable SMs.

Some clients may wish to manage the programs they start. For example,
a mail program could start a text editor for editing the text of a
mail message. A client that does this is a session manager itself; it
should supply the clients it starts with the appropriate connection
information (i.e., the `SESSION_MANAGER` environment variable)
that specifies a connection to itself instead of to the top level session
manager.

Each client has associated with it a list of properties. A property
set by one client is not visible to any other client. These
properties are used for the client to inform the SM of the client's
current state. When a client initially connects to the SM, there are
no properties set.

## ChapterÂ 4.Â Data Types

XSMP messages contain several types of data. Both the SM and the
client always send messages in their native byte order. Thus, both
sides may need to byte-swap the messages received. The need to do
byte-swapping is determined at run-time by the ICE protocol.

If an invalid value is specified for a field of any of the enumerated
types, a BadValue error message must be sent by
the receiver of the message to the sender of the message.

| Type Name | Description |
| --- | --- |
| BOOL | `False` or `True` |
| INTERACT\_STYLE | `None` `Errors` or `Any` |
| DIALOG\_TYPE | `Error` or `Normal` |
| SAVE\_TYPE | `Global` `Local` or `Both` |
| CARD8 | a one-byte unsigned integer |
| CARD16 | a two-byte unsigned integer |
| CARD32 | a four-byte unsigned integer |
| ARRAY8 | a sequence of CARD8s |
| LISTofARRAY8 | a sequence of ARRAY8s |
| PROPERTY | a property name (an ARRAY8), a type name, and a value of that type |
| LISTofPROPERTY | a counted collection of Â­PROPERTYs. |

## ChapterÂ 5.Â Protocol Setup and Message Format

To start the XSMP protocol, the client sends the server an
ICE `ProtocolSetup` message. All XSMP messages are
in the standard ICE message format. The message's major opcode is
assigned to XSMP by ICE at run-time. The different parties (client
and SM) may be assigned different major opcodes for XSMP. Once
assigned, all XSMP messages issued by this party will use the same
major opcode. The message's minor opcode specifies which protocol
message this message contains.

## ChapterÂ 6.Â Client Identification String

A client ID is a string of XPCS characters encoded in ISO Latin 1 (ISO
8859-1). No null characters are allowed in this string. The client
ID string is used in the `RegisterÂ­Client`
and `RegisterÂ­ClientReply` messages.

Client IDs consist of the pieces described below. The ID is formed by
concatenating the pieces in sequence, without separator characters.
All pieces are padded on the left with '`0`'
characters so as to fill the specified length. Decimal numbers are
encoded using the characters '`0`' through
'`9`', and hexadecimal numbers using the characters
'`0`' through '`9`' and
'`A`' through '`F`'.

* Version. This is currently the character '`1`'.
* Address type and address. The address type will be one of

  Â Â Â Â Â '`1`'Â Â Â Â Â aÂ 4-byteÂ IPv4Â addressÂ encodedÂ asÂ 8Â hexadecimalÂ digits

  Â Â Â Â Â '`2`'Â Â Â Â Â aÂ 6-byteÂ DECNETÂ addressÂ encodedÂ asÂ 12Â hexadecimalÂ digits

  Â Â Â Â Â '`6`'Â Â Â Â Â aÂ 16-byteÂ IPv6Â addressÂ encodedÂ asÂ 32Â hexadecimalÂ digits

  The address is the one of the network addresses of the machine where
  the session manager (not the client) is running. For example, the IP
  address 198.112.45.11 would be encoded as the string
  "`QC6702D0B`".
* Time stamp. A 13-digit decimal number specifying
  the number of milliseconds since 00:00:00 UTC, January 1, 1970.
* Process-ID type and process-ID. The process-ID type will be one of

  Â Â Â Â Â '`1`' aÂ POSIXÂ process-IDÂ encodedÂ asÂ aÂ 10-digitÂ decimalÂ number.

  The process-ID is the process-ID of the session manager, not of a client.
* Sequence number. This is a four-digit decimal number. It is
  incremented every time the session manager creates an ID. After
  reaching "Q9999" it wraps to "Q0000".

  ### Rationale

  Once a client ID has been assigned to the client, the client keeps
  this ID indefinitely. If the client is terminated and restarted, it
  will be reassigned the same ID. It is desirable to be able to pass
  client IDs around from machine to machine, from user to user, and from
  session manager to session manager, while retaining the identity of
  the client. This, combined with the indefinite persistence of client
  IDs, means that client IDs need to be globally unique. The
  construction specified above will ensure that any client ID created by
  any user, session manager, and machine will be different from any other.
## ChapterÂ 7.Â Protocol

The protocol consists of a sequence of messages as described below.
Each message type is specified by an ICE minor opcode. A given
message type is sent either from a client to the session manager or
from the session manager to a client; the appropriate direction is
listed with each message's description. For each message type, the
set of valid responses and possible error messages are listed. The
ICE severity is given in parentheses following each error class.

```

RegisterClient [Client â SM]

  previous-ID: ARRAY8

  Valid Responses: RegisterClientReply

  Possible Errors: BadValue (CanContinue)

```

The client must send this message to the SM to register the client's
existence. If a client is being restarted from a previous session,
the *`previous-ID`* field must contain the client
ID from the previous session. For new clients,
*`previous-ID`* should be of zero length.

If *`previous-ID`* is not valid,
the SM will send a BadValue
error message to the client. At this point the SM reverts to the
register state and waits for another `RegisterClient`
The client should then send a `RegisterClient` with a
null *`previous-ID`* field.

```

RegisterClientReply [Client â SM]

  client-ID: ARRAY8

```

The *`client-ID`* specifies a unique identification
for this client. If the client had specified an ID in the
*`previous-ID`* field of the
`RegisterClient` message,
*`client-ID`* will be identical to the previously
specified ID. If *`previous-ID`* was null,
*`client-ID`* will be a unique ID freshly generated
by the SM. The *`client-ID`* format is specified in
[section 6](#Client_Identification_String "ChapterÂ 6.Â Client Identification String").

If the client didn't supply a *`previous-ID`* field to
the `RegisterÂ­Client` message, the SM must send
a `SaveYourself` message with type = Local,
shutdown = False, interact-style = None, and fast = False immediately
after the `RegisterClientReply` The client should
respond to this like any other `SaveÂ­Yourself`
message.

```

SaveYourself [Client â SM]

  type: SAVE_TYPE
  shutdown: BOOL
  interact-style: INTERACT_STYLE
  fast: BOOL

  Valid Responses:
    SetProperties
    DeleteProperties
    GetProperties
    SaveYourselfDone
    SaveYourselfPhase2Request
    InteractRequest

```

The SM sends this message to a client to ask it to save its state.
The client writes a state file, if necessary, and, if necessary,
uses `SetProperties` to inform the SM of how to
restart it and how to discard the saved state. During this process it
can, if allowed by *`interact-style`*, request permission
to interact with
the user by sending an `InteractRequest` message.
After the state has been saved, or if it cannot be successfully saved,
and the properties are appropriately set, the client sends
a `SaveYourselfDone` message. If the client wants
to save additional information after all the other clients have
finished changing their own state, the client should
send `SaveYourselfPhase2Request` instead
of `SaveYourselfDone` The client must then freeze
interaction with the user and wait until it receives
a `SaveComplete` `Die` or
a `ShutdownCancelled` message.

If *`interact-style`* is `None` the
client must not interact with the user while saving state. If the
*`interact-style`*
is `Errors` the client may interact with the user
only if an error condition arises. If *`interact-style`*
is `Any` then the client may interact with the user
for any purpose. This is done by sending
an `InteractÂ­Request` message. The SM will
send an `Interact` message to each client that sent
an `InteractÂ­Request` The client must postpone
all interaction until it gets the `Interact`
message. When the client is done interacting it should send the SM
an `InteractÂ­Done` message.
The `InteractÂ­Request` message can be sent any
time after a `SaveÂ­Yourself` and before
a `SaveÂ­YourselfÂ­Done`

Unusual circumstances may dictate multiple interactions. The client
may initiate as many `InteractÂ­Request`
- `Interact` - `InteractDone`
sequences as it needs before it sends `SaveYourselfDone`

When a client receives `SaveÂ­Yourself` and has
not yet responded `SaveÂ­YourselfÂ­Done` to a
previous `SaveÂ­Yourself` it must send
a `SaveÂ­YourselfÂ­Done` and may then begin
responding as appropriate to the newly received
`SaveÂ­Yourself`

The *`type`* field specifies the type of information that
should be saved: `Global` `Local`
or `Both` The `Local` type
indicates that the application must update the properties to reflect
its current state, send
a `SaveÂ­YourselfÂ­Done` and continue.
Specifically it should save enough information to restore the state as
seen by the user of this client. It should not affect the state as
seen by other users. The `Global` type indicates
that the user wants the client to commit all of its data to permanent,
globally-accessible storage. `Both` indicates that
the client should do both of these. If `Both` is
specified, the client should first commit the data to permanent
storage before updating its SM properties.

### Examples

If a word processor was sent a `SaveYourself` with
a type of `Local` it could create a temporary file
that included the current contents of the file, the location of the
cursor, and other aspects of the current editing session. It would
then update its `RestartÂ­Command` property with
enough information to find the temporary file, and
its `DiscardÂ­Command` with enough information
to remove it.

If a word processor was sent a `SaveYourself` with
a type of `Global` it would simply save the
currently edited file.

If a word processor was sent a `SaveYourself` with
a type of `Both` it would first save the currently
edited file. It would then create a temporary file with information
such as the current position of the cursor and what file is being
edited. It would then update
its `RestartÂ­Command` property with enough
information to find the temporary file, and
its `DiscardÂ­Command` with enough information
to remove it.

Once the SM has send `SaveYourself` to a client, it
can't send another `SaveYourself` to that client until
the client either responds with a `SaveYourselfDone` or
the SM sends a `ShutdownCancelled`

### Advice to Implementors

If the client stores local any state in a file or similar "external"
storage, it must create a distinct copy in response to
each `SaveYourself` message.
It *must not* simply refer to a previous
copy, because the SM may discard that previous saved state using
a `DiscardCommand` without knowing that it is
needed for the new checkpoint.

The *`shutdown`* field specifies whether the system is
being shut down.

### Rationale

The interaction may be different depending on whether or not shutdown is set.

The client must save and then must prevent interaction until it
receives a `SaveComplete` `Die`
or a `ShutdownÂ­Cancelled` because anything the
user does after the save will be lost.

The *`fast`* field specifies whether or not the client
should save its state as quickly as possible. For example, if the SM knows
that power is about to fail, it should set the *`fast`*
field to `True`.

```

SaveYourselfPhase2 [Client â SM]

  Valid Responses:
    SetProperties
    DeleteProperties
    GetProperties
    SaveYourselfDone
    InteractRequest

```

The SM sends this message to a client that has previously sent
a `SaveYourselfPhase2Request` message. This
message informs the client that all other clients are in a fixed state
and this client can save state that is associated with other clients.

### Rationale

Clients that manager other clients (window managers, workspace
managers, etc) need to know when all clients they are managing are
idle, so that the manager can save state related to each of the
clients without being concerned with that state changing.

The client writes a state file, if necessary, and, if necessary,
uses `SetProperties` to inform the SM of how to
restart it and how to discard the saved state. During this process it
can request permission to interact with the user by sending
an `InteractRequest` message. This should only be
done if an error occurs that requires user interaction to resolve.
After the state has been saved, or if it cannot be successfully saved,
and the properties are appropriately set, the client sends
a `SaveYourselfDone` message.

```

SaveYourselfRequest [Client â SM]

  type: SAVE_TYPE
  shutdown: BOOL
  interact-style: INTERACT_STYLE
  fast: BOOL
  global: BOOL

  Valid Responses: SaveYourself

```

An application sends this to the SM to request a checkpoint. When the
SM receives this request it may generate a `SaveYourself`
message in response and it may leave the fields intact.

### Example

A vendor of a UPS (Uninterruptible Power Supply)
might include an SM client that would monitor the status of
the UPS and generate a fast shutdown if the power
is about to be lost.

If *`global`* is set to `True` then the
resulting `SaveYourself` should be sent to all
applications. If *`global`* is set to
`False` then the
resulting `SaveYourself` should be sent to the
application that sent the `SaveÂ­YourselfÂ­Request`

```

InteractRequest [Client â SM]

  dialog-type: DIALOG_TYPE

  Valid Responses: Interact ShutdownCancelled

  Possible Errors: BadState (CanContinue)

```

During a checkpoint or session-save operation, only one client at a
time might be granted the privilege of interacting with the user.
The `InteractRequest` message causes the SM to emit
an `Interact` message at some later time if the
shutdown is not cancelled by another client first.

The *`dialog-type`* field specifies either
`Errors` indicating that the client wants to start an
error dialog or `Normal` meaning the client wishes
to start a non-error dialog.

```

Interact [Client â SM]

  Valid Responses: InteractDone

```

This message grants the client the privilege of interacting with the
user. When the client is done interacting with the user it must send
an `InteractDone` message to the SM unless a
shutdown cancel is received.

### Advice to Implementors

If a client receives a ShutdownCancelled
after receiving an `Interact` message, but before
sending a `InteractDone` the client should abort
the interaction and send a `SaveYourselfDone`

```

InteractDone [Client â SM]

  cancel-shutdown: BOOL

  Valid Responses: ShutdownCancelled

```

This message is used by a client to notify the SM that it is done interacting.

Setting the *`cancel-shutdown`* field to `True`
indicates that the user has requested that the entire shutdown be
cancelled. *`Cancel-shutdown`* may only be `True` if
the corresponding `SaveYourself` message
specified `True` for the shutdown field
and `Any` or `Errors` for the
*`interact-style`* field. Otherwise,
*`cancel-shutdown`* must be `False`.

```

SaveYourselfDone [Client â SM]

  success: BOOL

  Valid Responses:
    SaveComplete
    Die
    ShutdownCancelled

```

This message is sent by a client to indicate that all of the
properties representing its state have been updated. After
sending `SaveYourselfDone` the client must wait for
a `SaveComplete` `ShutdownCancelled`
or `Die` message before changing its state. If
the `SaveYourself` operation was successful, then
the client should set the *`success`* field to
`True` otherwise the client should set it to
`False`.

### Example

If a client tries to save its state and runs out of disk space, it
should return `False` in the *`success`*
field of the `SaveYourselfDone` message.

```

SaveYourselfPhase2Request [Client â SM]

  Valid Responses:
    ShutdownCancelled
    SaveYourselfPhase2

```

This message is sent by a client to indicate that it needs to be informed
when all the other clients are quiescent, so it can continue its state.

```

Die [Client â SM]

  Valid Responses: ConnectionClosed

```

When the SM wants a client to die it sends a `Die`
message. Before the client dies it responds by sending
a `ConnectionClosed` message and may then close its
connection to the SM at any time.

```

SaveComplete [Client â SM]

  Valid Responses:

```

When the SM is done with a checkpoint, it will send each of the
clients a `SaveComplete` message. The client is
then free to change its state.

```

ShutdownCancelled [Client â SM]

```

The shutdown currently in process has been aborted. The client can
now continue as if the shutdown had never happened. If the client has
not sent `SaveYourselfDone` yet, the client can
either abort the save and send `SaveYourselfDone`
with the success field set to `False` or it can
continue with the save and send a `SaveYourselfDone`
with the success field set to reflect the outcome of the save.

```

ConnectionClosed [Client â SM]

  reason: LISTofARRAY8

```

Specifies that the client has decided to terminate. It should be
immediately followed by closing the connection.

The *`reason`* field specifies why the client is resigning
from the session. It is encoded as an array of Compound Text strings. If the
resignation is expected by the user, there will typically be zero
ARRAY8s here. But if the client encountered an unexpected fatal
error, the error message (which might otherwise be printed on stderr
on a POSIX system) should be forwarded to the SM here, one ARRAY8 per
line of the message. It is the responsibility of the SM to display
this reason to the user.

After sending this message, the client must not send any additional
XSMP messages to the SM.

### Advice to Implementors

If additional messages are received, they should be discarded.

### Rationale

The reason for sending the `ConnectionClosed`
message before actually closing the connections is that some transport
protocols will not provide immediate notification of connection
closure.

```

SetProperties [Client â SM]

  properties: LISTofPROPERTY

```

Sets the specified *`properties`* to the specified values.
Existing
properties not specified in the `SetÂ­Properties`
message are unaffected. Some properties have predefined semantics.
See [section 11,
âPredefined Properties.â](#Predefined_Properties "ChapterÂ 11.Â Predefined Properties")

The protocol specification recommends that property names used for
properties not defined by the standard should begin with an
underscore. To prevent conflicts among organizations, additional
prefixes should be chosen (for example, \_KPC\_FAST\_SAVE\_OPTION). The
organizational prefixes should be registered with the X Registry. The
XSMP reserves all property names not beginning with an underscore for
future use.

```

DeleteProperties [Client â SM]

  property-names: LISTofARRAY8

```

Removes the named properties.

```

GetProperties [Client â SM]

  Valid Responses: GetPropertiesReply

```

Requests that the SM respond with the values of all the properties for
this client.

```

GetPropertiesReply [Client â SM]

  values: LISTofPROPERTY

```

This message is sent in reply to a `GetProperties`
message and includes the *`values`* of all the properties.

## ChapterÂ 8.Â Errors

When the receiver of a message detects an error condition, the
receiver sends an ICE error message to the sender. There are only two
types of errors that are used by the XSMP:
BadValue and BadState
These are both defined in the ICE protocol.

Any message received out-of-sequence will generate
a BadState error message.

## ChapterÂ 9.Â State Diagrams

**Table of Contents**

[Client State Diagram](#Client_State_Diagram)[Session Manager State Diagram](#Session_Manager_State_Diagram)

These state diagrams are designed to cover all actions of both the
client and the SM.

## Client State Diagram

*start:*

Â Â Â Â Â ICEÂ protocolÂ setupÂ completeÂ âÂ *register*

*register:*

Â Â Â Â Â sendÂ *RegisterClient*Â âÂ *collect-id*

*collect-id:*

Â Â Â Â Â receiveÂ *RegisterClientReply*Â âÂ *idle*

*shutdown-cancelled:*

Â Â Â Â Â sendÂ *SaveYourselfDone*Â âÂ *idle*

*idle:*Â [UndoesÂ anyÂ freezeÂ ofÂ interactionÂ withÂ user.]

Â Â Â Â Â receiveÂ *Die*Â âÂ *die*

Â Â Â Â Â receiveÂ *SaveYourself*Â âÂ *freeze-interaction*

Â Â Â Â Â sendÂ *GetProperties*Â âÂ *idle*

Â Â Â Â Â receiveÂ *GetPropertiesReply*Â âÂ *idle*

Â Â Â Â Â sendÂ *SetProperties*Â âÂ *idle*

Â Â Â Â Â sendÂ *DeleteProperties*Â âÂ *idle*

Â Â Â Â Â sendÂ *ConnectionClosed*Â âÂ *connection-closed*

Â Â Â Â Â sendÂ *SaveYourselfRequest*Â âÂ *idle*

*die:*

Â Â Â Â Â sendÂ *ConnectionClosed*Â âÂ *connection-closed*

*freeze-interaction:*

Â Â Â Â Â freezeÂ interactionÂ withÂ userÂ âÂ *save-yourself*

*save-yourself:*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *shutdown-cancelled*

Â Â Â Â Â sendÂ *SetProperties*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *DeleteProperties*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *GetProperties*Â âÂ *save-yourself*

Â Â Â Â Â receiveÂ *GetPropertiesReply*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *InteractRequest*Â âÂ *interact-request*

Â Â Â Â Â sendÂ *SaveYourselfPhase2Request*Â âÂ waiting-for-phase2

*save-yourself:*

Â Â Â Â Â ifÂ shutdownÂ mode:

Â Â Â Â Â Â Â Â Â Â sendÂ *SaveYourselfDone*Â âÂ *save-yourself-done*

Â Â Â Â Â otherwise:

Â Â Â Â Â Â Â Â Â Â sendÂ *SaveYourselfDone*Â âÂ *idle*

*waiting-for-phase2:*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *shutdown-cancelled*

Â Â Â Â Â receiveÂ *SaveYourselfPhase2*Â âÂ *phase2*

*phase2:*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *shutdown-cancelled*

Â Â Â Â Â sendÂ *SetProperties*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *DeleteProperties*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *GetProperties*Â âÂ *save-yourself*

Â Â Â Â Â receiveÂ *GetPropertiesReply*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *InteractRequest*Â âÂ *interact-request*Â (errorsÂ only)

Â Â Â Â Â ifÂ shutdownÂ mode:

Â Â Â Â Â Â Â Â Â Â sendÂ *SaveYourselfDone*Â âÂ *save-yourself-done*

Â Â Â Â Â otherwise:

Â Â Â Â Â Â Â Â Â Â sendÂ *SaveYourselfDone*Â âÂ *idle*

*interact-request:*

Â Â Â Â Â receiveÂ *Interact*Â âÂ *interact*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *shutdown-cancelled*

*interact:*

Â Â Â Â Â sendÂ *InteractDone*Â âÂ *save-yourself*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *shutdown-cancelled*

*save-yourself-done:*Â (changingÂ stateÂ isÂ forbidden)

Â Â Â Â Â receiveÂ *SaveComplete*Â âÂ *idle*

Â Â Â Â Â receiveÂ *Die*Â âÂ *die*

Â Â Â Â Â receiveÂ *ShutdownCancelled*Â âÂ *idle*

*connection-closed:*

Â Â Â Â Â clientÂ stopsÂ participatingÂ inÂ sessionÂ

## Session Manager State Diagram

*start:*

Â Â Â Â Â receiveÂ *ProtocolSetup*Â âÂ *protocol-setup*

*protocol-setup:*

Â Â Â Â Â sendÂ *ProtocolSetupReply*Â âÂ *register*

*register:*

Â Â Â Â Â receiveÂ *RegisterClient*Â âÂ *acknowledge-register*

*acknowledge-register:*

Â Â Â Â Â sendÂ *RegisterClientReply*Â âÂ *idle*

*idle:*

Â Â Â Â Â receiveÂ *SetProperties*Â âÂ *idle*

Â Â Â Â Â receiveÂ *DeleteProperties*Â âÂ *idle*

Â Â Â Â Â receiveÂ *ConnectionClosed*Â âÂ *start*

Â Â Â Â Â receiveÂ *GetProperties*Â âÂ *get-properties*

Â Â Â Â Â receiveÂ *SaveYourselfRequest*Â âÂ *save-yourself*

Â Â Â Â Â sendÂ *SaveYourself*Â âÂ *saving-yourself*

*save-yourself:*

Â Â Â Â Â sendÂ *SaveYourself*Â âÂ *saving-yourself*

*get-properties:*

Â Â Â Â Â sendÂ *GetPropertiesReply*Â âÂ *idle*

*saving-get-properties:*

Â Â Â Â Â sendÂ *GetPropertiesReply*Â âÂ *saving-yourself*

*saving-yourself:*

Â Â Â Â Â receiveÂ *InteractRequest*Â âÂ *saving-yourself*

Â Â Â Â Â sendÂ *Interact*Â âÂ *saving-yourself*

Â Â Â Â Â sendÂ *ShutdownCancelled*Â âÂ *idle*

Â Â Â Â Â receiveÂ *InteractDone*Â âÂ *saving-yourself*

Â Â Â Â Â receiveÂ *SetProperties*Â âÂ *saving-yourself*

Â Â Â Â Â Â receiveÂ *DeleteProperties*Â âÂ *saving-yourself*

Â Â Â Â Â receiveÂ *GetProperties*Â âÂ *saving-get-properties*

Â Â Â Â Â receiveÂ *SaveYourselfPhase2Request*Â âÂ *start-phase2*

Â Â Â Â Â receiveÂ *SaveYourselfDone*Â âÂ *save-yourself-done*

*start-phase2:*

Â Â Â Â Â IfÂ allÂ clientsÂ haveÂ sentÂ eitherÂ SaveYourselfPhase2RequestÂ orÂ SaveYourselfDone:

Â Â Â Â Â Â Â Â Â Â sendÂ *SaveYourselfPhase2*Â âÂ *phase2*

Â Â Â Â Â else

Â Â Â Â Â Â Â Â Â Â âÂ *saving-yourself*

*phase2:*

Â Â Â Â Â receiveÂ *InteractRequest*Â âÂ *saving-yourself*

Â Â Â Â Â sendÂ *Interact*Â âÂ *saving-yourself*

Â Â Â Â Â sendÂ *ShutdownCancelled*Â âÂ *idle*

Â Â Â Â Â receiveÂ *InteractDone*Â âÂ *saving-yourself*

Â Â Â Â Â receiveÂ *SetProperties*Â âÂ *saving-yourself*

Â Â Â Â Â Â receiveÂ *DeleteProperties*Â âÂ *saving-yourself*

Â Â Â Â Â receiveÂ *GetProperties*Â âÂ *saving-get-properties*

Â Â Â Â Â receiveÂ *SaveYourselfDone*Â âÂ *save-yourself-done*

*save-yourself-done:*

Â Â Â Â Â IfÂ allÂ clientsÂ areÂ saved:

Â Â Â Â Â Â Â Â Â Â IfÂ shuttingÂ down:

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sendÂ *Die*Â âÂ *die*

Â Â Â Â Â Â Â Â Â Â otherwise

Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â sendÂ *SaveComplete*Â âÂ *idle*

Â Â Â Â Â IfÂ someÂ clientsÂ areÂ notÂ saved:

Â Â Â Â Â âÂ *saving-yourself*

*die:*

Â Â Â Â Â SMÂ stopsÂ acceptingÂ connections

## ChapterÂ 10.Â Protocol Encoding

**Table of Contents**

[Types](#Types)[Messages](#Messages)
## Types

| **BOOL** | |
| --- | --- |
| 0 | False |
| 1 | True |

| **INTERACT\_STYLE** | |
| --- | --- |
| 0 | None |
| 1 | Errors |
| 2 | Any |

| **DIALOG\_TYPE** | |
| --- | --- |
| 0 | Error |
| 1 | Normal |

| **SAVE\_TYPE** | |
| --- | --- |
| 0 | Global |
| 1 | Local |
| 2 | Both |

| **ARRAY8** | | Â |
| --- | --- | --- |
| 4 | CARD32 | length |
| n | ListofCARD8, the array | p = pad (4 + n, 8) |
| 2 | Both | Â |

| **LISTofARRAY8** | | Â |
| --- | --- | --- |
| 4 | CARD32 | count |
| 4 | Â | unused |
| a | ARRAY8 | first array |
| b | ARRAY8 | second array |
| . | Â | Â |
| . | Â | Â |
| . | Â | Â |
| q | ARRAY8 | last array |

| **PROPERTY** | | Â |
| --- | --- | --- |
| a | ARRAY8 | name |
| b | ARRAY8 | type (XPCS encoded in Latin-1, case sensitive) |
| c | LISTofARRAY8 | values |

| **LISTofPROPERTY** | | Â |
| --- | --- | --- |
| 4 | CARD32 | count |
| 4 | Â | unused |
| a | PROPERTY | first property |
| b | PROPERTY | second property |
| . | Â | Â |
| . | Â | Â |
| . | Â | Â |
| q | PROPERTY | last property |

## Messages

XSMP is a sub-protocol of ICE. The major opcode is
assigned at run-time by ICE and is represented here
by '`?`'.

To start the XSMP protocol, the client sends the server an
ICE `ProtocolSetup` message.
The protocol-name field should be specified as "`XSMP`",
the major version of the protocol is 1, the minor version is 0. These
values may change if the protocol is revised. The minor version
number will be incremented if the change is compatible, otherwise the
major version number will be incremented.

In `ProtocolReply` message sent by the session
manager, the XSMP protocol defines the vendor parameter as product
identification of the session manager, and defines the release
parameter as the software release identification of the session
manager. The session manager should supply this information in the
ICE `ProtocolReply` message.

| **`RegisterClient`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 1 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | ARRAY8 | previous-ID |

| **`RegisterClientReply`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 2 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | ARRAY8 | client-ID |

| **`SaveYourself`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 3 | opcode |
| 2 | Â | unused |
| 4 | 1 | length of remaining data in 8-byte units |
| 1 | SAVE\_TYPE | type |
| 1 | BOOL | shutdown |
| 1 | INTERACT\_STYLE | interact-style |
| 1 | BOOL | fast |
| 4 | Â | unused |

| **`SaveYourselfRequest`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 4 | opcode |
| 2 | Â | unused |
| 4 | 1 | length of remainning data in 8-byte units |
| 1 | SAVE\_TYPE | type |
| 1 | BOOL | shutdown |
| 1 | INTERACT\_STYLE | interact-style |
| 1 | BOOL | fast |
| 3 | Â | unused |

| **`InteractRequest`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 5 | opcode |
| 1 | DIALOG\_TYPE | dialog type |
| 1 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`Interact`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 6 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`InteractDone`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 7 | opcode |
| 1 | BOOL | cancel-shutdown |
| 1 | Â | unused |

| **`InteractDone`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 7 | opcode |
| 1 | BOOL | cancel-shutdown |
| 1 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`SaveYourselfDone`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 8 | opcode |
| 1 | BOOL | success |
| 1 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`Die`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 9 | opcode |
| 1 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`ShutdownCancelled`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 10 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`ConnectionClosed`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 11 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | LISTofARRAY8 | reason |

| **`SetProperties`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 12 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | LISTofPROPERTY | properties |

| **`DeleteProperties`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 13 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | LISTofPROPERTY | properties |

| **`GetProperties`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 14 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`GetPropertiesReply`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 15 | opcode |
| 2 | Â | unused |
| 4 | a/8 | length of remaining data in 8-byte units |
| a | LISTofPROPERTY | properties |

| **`SaveYourselfPhase2Request`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 16 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`SaveYourselfPhase2`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 17 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

| **`SaveComplete`** | | |
| --- | --- | --- |
| 1 | ? | XSMP |
| 1 | 18 | opcode |
| 2 | Â | unused |
| 4 | 0 | length of remaining data in 8-byte units |

## ChapterÂ 11.Â Predefined Properties

All property values are stored in a LISTofARRAY8. If the type of the
property is CARD8, the value is stored as a LISTofARRAY8 with one
ARRAY8 that is one byte long. That single byte contains the CARD8.
If the type of the property is ARRAY8, the value is stored in the
first element of a single element LISTofARRAY8.

The required properties must be set each time a client connects with
the SM. The properties must be set after the client
sends `RegisterClient` and before the client
sends `SaveYourselfDone` Otherwise, the behavior of
the session manager is not defined.

Clients may set, get, and delete nonstandard properties. The lifetime
of stored properties does not extend into subsequent sessions.

| Name | Type | Posix Type | Required? |
| --- | --- | --- | --- |
| CloneCommand | OS-specific | LISTofARRAY8 | Yes |
| CurrentDirectory | OS-specific | ARRAY8 | No |
| DiscardCommand | OS-specific | LISTofARRAY8 | No\* |
| Environment | OS-specific | LISTofARRAY8 | No |
| ProcessID | OS-specific | ARRAY8 | No |
| Program | OS-specific | ARRAY8 | Yes |
| RestartCommand | OS-specific | LISTofARRAY8 | Yes |
| ResignCommand | OS-specific | LISTofARRAY8 | No |
| RestartStyleHint | CARD8 | CARD8 | No |
| ShutdownCommand | OS-specific | LISTofARRAY8 | No |
| UserID | ARRAY8 | ARRAY8 | Yes |

\* Required if any state is stored in an external repository (e.g., state file).

| CloneCommand | This is like the `RestartCommand` except it restarts a copy of the application. The only difference is that the application doesn't supply its client id at register time. On POSIX systems the type should be a LISTofARRAY8. |
| CurrentDirectory | On POSIX-based systems specifies the value of the current directory that needs to be set up prior to starting the program and should be of type ARRAY8. |
| DiscardCommand | The discard command contains a command that when delivered to the host that the client is running on (determined from the connection), will cause it to discard any information about the current state. If this command is not specified, the SM will assume that all of the client's state is encoded in the `RestartÂ­Command` On POSIX systems the type should be LISTofARRAY8. |
| Environment | On POSIX based systems, this will be of type LISTofARRAY8 where the ARRAY8s alternate between environment variable name and environment variable value. |
| ProcessID | This specifies an OS-specific identifier for the process. On POSIX systems this should of type ARRAY8 and contain the return value of getpid() turned into a Latin-1 (decimal) string. |
| Program | The name of the program that is running. On POSIX systems this should be the first parameter passed to execve and should be of type ARRAY8. |
| RestartCommand | The restart command contains a command that when delivered to the host that the client is running on (determined from the connection), will cause the client to restart in its current state. On POSIX-based systems this is of type LISTofARRAY8 and each of the elements in the array represents an element in the argv array. This restart command should ensure that the client restarts with the specified client-ID. |
| ResignCommand | A client that sets the `RestartStyleHint` to `RestartAnyway` uses this property to specify a command that undoes the effect of the client and removes any saved state. Example A user runs xmodmap. xmodmap registers with the SM, sets `RestartÂ­StyleÂ­Hint` to `RestartÂ­Anyway` and then terminates. In order to allow the SM (at the user's request) to undo this, xmodmap would register a `ResignÂ­Command` that undoes the effects of the xmodmap. |
| RestartStyleHint | If the RestartStyleHint property is present, it will contain the style of restarting the client prefers. If this flag isn't specified, `RestartIfRunning` is assumed. The possible values are as follows:   | Name | Value | | --- | --- | | RestartIfRunning | 0 | | RestartAnyway | 1 | | RestartImmediately | 2 | | RestartNever | 3 |   The `RestartIfRunning` style is used in the usual case. The client should be restarted in the next session if it is connected to the session manager at the end of the current session.  The `RestartAnyway` style is used to tell the SM that the application should be restarted in the next session even if it exits before the current session is terminated. It should be noted that this is only a hint and the SM will follow the policies specified by its users in determining what applications to restart. Rationale This can be specified by a client which supports (as MS-Windows clients do) a means for the user to indicate while exiting that restarting is desired. It can also be used for clients that spawn other clients and then go away, but which want to be restarted.  A client that uses `RestartAnyway` should also set the `ResignCommand` and `ShutdownCommand` properties to commands that undo the state of the client after it exits.  The `RestartImmediately` style is like `RestartAnyway` but in addition, the client is meant to run continuously. If the client exits, the SM should try to restart it in the current session. Advice to Implementors It would be wise to sanity-check the frequency which which `RestartImmediately` clients are restarted, to avoid a sick client being restarted continuously.  The `RestartNever` style specifies that the client does not wish to be restarted in the next session. Advice to Implementors This should be used rarely, if at all. It will cause the client to be silently left out of sessions when they are restarted and will probably be confusing to users. |
| ShutdownCommand | This command is executed at shutdown time to clean up after a client that is no longer running but retained its state by setting `RestartStyleHint` to `RestartAnyway` The command must not remove any saved state as the client is still part of the session. Example A client is run at start up time that turns on a camera. This client then exits. At session shutdown, the user wants the camera turned off. This client would set the `RestartÂ­StyleÂ­Hint` to `RestartÂ­Anyway` and would register a `ShutdownÂ­Command` that would turn off the camera. |
| UserID | Specifies the user's ID. On POSIX-based systems this will contain the the user's name (the *`pw_name`* field of struct passwd). |


