

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Jakub Kicinski <kuba@kernel.org> | 2024-05-08 06:45:04 -0700 |
| --- | --- | --- |
| committer | Jakub Kicinski <kuba@kernel.org> | 2024-05-10 18:15:05 -0700 |
| commit | [ac0a230f719b02432d8c7eba7615ebd691da86f4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)) | |
| tree | [c8283a6281576d91b3a7174c2c686213d7fcc375](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4) | |
| parent | [a2c78977950da00aca83a3f8865d1f54e715770d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a2c78977950da00aca83a3f8865d1f54e715770d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4&id2=a2c78977950da00aca83a3f8865d1f54e715770d)) | |
| download | [linux-ac0a230f719b02432d8c7eba7615ebd691da86f4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ac0a230f719b02432d8c7eba7615ebd691da86f4.tar.gz) | |

eth: sungem: remove .ndo\_poll\_controller to avoid deadlocksErhard reports netpoll warnings from sungem:
netpoll\_send\_skb\_on\_dev(): eth0 enabled interrupts in poll (gem\_start\_xmit+0x0/0x398)
WARNING: CPU: 1 PID: 1 at net/core/netpoll.c:370 netpoll\_send\_skb+0x1fc/0x20c
gem\_poll\_controller() disables interrupts, which may sleep.
We can't sleep in netpoll, it has interrupts disabled completely.
Strangely, gem\_poll\_controller() doesn't even poll the completions,
and instead acts as if an interrupt has fired so it just schedules
NAPI and exits. None of this has been necessary for years, since
netpoll invokes NAPI directly.
Fixes: fe09bb619096 ("sungem: Spring cleaning and GRO support")
Reported-and-tested-by: Erhard Furtner <erhard\_f@mailbox.org>
Link: [https://lore.kernel.org/all/20240428125306.2c3080ef@legion](https://lore.kernel.org/all/20240428125306.2c3080ef%40legion)
Reviewed-by: Eric Dumazet <edumazet@google.com>
Link: [https://lore.kernel.org/r/20240508134504.3560956-1-kuba@kernel.org](https://lore.kernel.org/r/20240508134504.3560956-1-kuba%40kernel.org)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)

| -rw-r--r-- | [drivers/net/ethernet/sun/sungem.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/sun/sungem.c?id=ac0a230f719b02432d8c7eba7615ebd691da86f4) | 14 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 0 insertions, 14 deletions

| diff --git a/drivers/net/ethernet/sun/sungem.c b/drivers/net/ethernet/sun/sungem.cindex 9bd1df8308d24a..d3a2fbb14140e9 100644--- a/[drivers/net/ethernet/sun/sungem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/sun/sungem.c?id=a2c78977950da00aca83a3f8865d1f54e715770d)+++ b/[drivers/net/ethernet/sun/sungem.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/sun/sungem.c?id=ac0a230f719b02432d8c7eba7615ebd691da86f4)@@ -949,17 +949,6 @@ static irqreturn\_t gem\_interrupt(int irq, void \*dev\_id) return IRQ\_HANDLED; } -#ifdef CONFIG\_NET\_POLL\_CONTROLLER-static void gem\_poll\_controller(struct net\_device \*dev)-{- struct gem \*gp = netdev\_priv(dev);-- disable\_irq(gp->pdev->irq);- gem\_interrupt(gp->pdev->irq, dev);- enable\_irq(gp->pdev->irq);-}-#endif- static void gem\_tx\_timeout(struct net\_device \*dev, unsigned int txqueue) { struct gem \*gp = netdev\_priv(dev);@@ -2839,9 +2828,6 @@ static const struct net\_device\_ops gem\_netdev\_ops = { .ndo\_change\_mtu = gem\_change\_mtu, .ndo\_validate\_addr = eth\_validate\_addr, .ndo\_set\_mac\_address = gem\_set\_mac\_address,-#ifdef CONFIG\_NET\_POLL\_CONTROLLER- .ndo\_poll\_controller = gem\_poll\_controller,-#endif };  static int gem\_init\_one(struct pci\_dev \*pdev, const struct pci\_device\_id \*ent) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:28:22 +0000

