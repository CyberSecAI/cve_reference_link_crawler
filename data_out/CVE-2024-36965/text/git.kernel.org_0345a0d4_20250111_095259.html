

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com> | 2024-03-21 09:46:13 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-05-25 16:22:55 +0200 |
| commit | [26c6d7dc8c6a9fde9d362ab2eef6390efeff145e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)) | |
| tree | [8ec9aa1e22f47eeb2e6fbc965a61771252506dd8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e) | |
| parent | [642069561ea52ed61554dfb862f5958613babb33](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=642069561ea52ed61554dfb862f5958613babb33) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e&id2=642069561ea52ed61554dfb862f5958613babb33)) | |
| download | [linux-26c6d7dc8c6a9fde9d362ab2eef6390efeff145e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-26c6d7dc8c6a9fde9d362ab2eef6390efeff145e.tar.gz) | |

remoteproc: mediatek: Make sure IPI buffer fits in L2TCMcommit 331f91d86f71d0bb89a44217cc0b2a22810bbd42 upstream.
The IPI buffer location is read from the firmware that we load to the
System Companion Processor, and it's not granted that both the SRAM
(L2TCM) size that is defined in the devicetree node is large enough
for that, and while this is especially true for multi-core SCP, it's
still useful to check on single-core variants as well.
Failing to perform this check may make this driver perform R/W
operations out of the L2TCM boundary, resulting (at best) in a
kernel panic.
To fix that, check that the IPI buffer fits, otherwise return a
failure and refuse to boot the relevant SCP core (or the SCP at
all, if this is single core).
Fixes: 3efa0ea743b7 ("remoteproc/mediatek: read IPI buffer offset from FW")
Signed-off-by: AngeloGioacchino Del Regno <angelogioacchino.delregno@collabora.com>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240321084614.45253-2-angelogioacchino.delregno@collabora.com](https://lore.kernel.org/r/20240321084614.45253-2-angelogioacchino.delregno%40collabora.com)
Signed-off-by: Mathieu Poirier <mathieu.poirier@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)

| -rw-r--r-- | [drivers/remoteproc/mtk\_scp.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/remoteproc/mtk_scp.c?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e) | 10 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 1 deletions

| diff --git a/drivers/remoteproc/mtk\_scp.c b/drivers/remoteproc/mtk\_scp.cindex dcc94ee2458d8e..c4c535b011812d 100644--- a/[drivers/remoteproc/mtk\_scp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/remoteproc/mtk_scp.c?id=642069561ea52ed61554dfb862f5958613babb33)+++ b/[drivers/remoteproc/mtk\_scp.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/remoteproc/mtk_scp.c?id=26c6d7dc8c6a9fde9d362ab2eef6390efeff145e)@@ -126,7 +126,7 @@ static int scp\_elf\_read\_ipi\_buf\_addr(struct mtk\_scp \*scp, static int scp\_ipi\_init(struct mtk\_scp \*scp, const struct firmware \*fw) { int ret;- size\_t offset;+ size\_t buf\_sz, offset;  /\* read the ipi buf addr from FW itself first \*/ ret = scp\_elf\_read\_ipi\_buf\_addr(scp, fw, &offset);@@ -138,6 +138,14 @@ static int scp\_ipi\_init(struct mtk\_scp \*scp, const struct firmware \*fw) } dev\_info(scp->dev, "IPI buf addr %#010zx\n", offset); + /\* Make sure IPI buffer fits in the L2TCM range assigned to this core \*/+ buf\_sz = sizeof(\*scp->recv\_buf) + sizeof(\*scp->send\_buf);++ if (scp->sram\_size < buf\_sz + offset) {+ dev\_err(scp->dev, "IPI buffer does not fit in SRAM.\n");+ return -EOVERFLOW;+ }+ scp->recv\_buf = (struct mtk\_share\_obj \_\_iomem \*) (scp->sram\_base + offset); scp->send\_buf = (struct mtk\_share\_obj \_\_iomem \*) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 09:51:36 +0000

