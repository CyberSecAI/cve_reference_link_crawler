

[Skip to content](#content-body)
GitLab

* Menu

  + [Why GitLab](https://about.gitlab.com/why-gitlab)
  + [Pricing](https://about.gitlab.com/pricing)
  + [Contact Sales](https://about.gitlab.com/sales)
  + [Explore](/explore)
* [Why GitLab](https://about.gitlab.com/why-gitlab)
* [Pricing](https://about.gitlab.com/pricing)
* [Contact Sales](https://about.gitlab.com/sales)
* [Explore](/explore)

* [Sign in](/users/sign_in?redirect_to_referer=yes)
* [Get free trial](/users/sign_up)

# fix runtime error: applying zero offset to null pointer

Code

* Review changes
* Check out branch
* ---
* Download
* [Patches](/libtiff/libtiff/-/merge_requests/479.patch)
* [Plain diff](/libtiff/libtiff/-/merge_requests/479.diff)

[xiaoxiaoafeifei](/xiaoxiaoafeifei) requested to merge  [xiaoxiaoafeifei/libtiff:mymaster1](/xiaoxiaoafeifei/libtiff/-/tree/mymaster1 "xiaoxiaoafeifei/libtiff:mymaster1")
 into [master](/libtiff/libtiff/-/tree/master "master") Apr 20, 2023

* [Overview
  5](/libtiff/libtiff/-/merge_requests/479)
* [Commits
  1](/libtiff/libtiff/-/merge_requests/479/commits)
* [Pipelines
  2](/libtiff/libtiff/-/merge_requests/479/pipelines)
* [Changes
  1](/libtiff/libtiff/-/merge_requests/479/diffs)

Expand

Hi:

I found a runtime error in file libtiff/tif\_dir.c

USAN:

```
root@iZ2vcadn43p7fjzbhl6zqwZ:~/gitlab/tiffcp/poc# /usr/local/bin/tiffcp -i -s -p separate poc /tmp/foo
TIFFReadDirectoryCheckOrder: Warning, Invalid TIFF directory; tags are not sorted in ascending order.
tif_dir.c:195:24: runtime error: applying zero offset to null pointer
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior tif_dir.c:195:24 in
TIFFSetField: poc: Invalid InkNames value; no NUL at given buffer end location 0, after 0 ink.
poc: Error, can only handle BitsPerSample=8 in cpContig2SeparateByRow.
TIFFWriteDirectoryTagCheckedRational: Negative value is illegal.
```

Steps to reproduce:

* CC=afl-clang-fast CXX=afl-clang-fast++ CFLAGS="-gdwarf-2 -g3 -O0 -fsanitize=address,undefined,leak -fno-omit-frame-pointer" CXXFLAGS="-gdwarf-2 -g3 -O0 -fsanitize=address,undefined,leak -fno-omit-frame-pointer" ./configure --disable-shared
* make & make install
* /usr/local/bin/tiffcp -i -s -p separate poc /tmp/foo

poc: [poc](/-/project/4720790/uploads/66477f53aab998dd40770de43ecc437c/poc)

This modification fixes the problem

Edited Apr 20, 2023 by [xiaoxiaoafeifei](/xiaoxiaoafeifei)

## Merge request reports

Assignee
Loading

Reviewers
Loading

Select reviewersRequest review fromLoading

Time tracking
Loading

Loading

