<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html><head>
<link rel="icon" href="/favicon.png">
<title>#498678 - sigdie must not be called from a signal handler context - Debian Bug report logs</title>
<meta http-equiv="Content-Type" content="text/html;charset=utf-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="/css/bugs.css" type="text/css">

<link rel="canonical" href="&lt;a href=&quot;bugreport.cgi?bug=498678&quot;&gt;498678&lt;/a&gt;">
<script type="text/javascript">
<!--
function toggle_infmessages()
{
        allDivs=document.getElementsByTagName("div");
        for (var i = 0 ; i < allDivs.length ; i++ )
        {
                if (allDivs[i].className == "infmessage")
                {
                        allDivs[i].style.display=(allDivs[i].style.display == 'none' | allDivs[i].style.display == '') ? 'block' : 'none';
                }
        }
}
-->
</script>
</head>
<body>
<h1>Debian Bug report logs - 
<a href="mailto:498678@bugs.debian.org">#498678</a><br>
sigdie must not be called from a signal handler context</h1>
<div class="versiongraph"><a href="version.cgi?info=1;absolute=0;package=openssh-server;fixed=1%3A4.3p2-9etch3;fixed=openssh%2F1%3A4.6p1-1;found=4.3p2-9etch2;collapse=1"><img alt="version graph" src="version.cgi?height=2;collapse=1;found=4.3p2-9etch2;package=openssh-server;fixed=1%3A4.3p2-9etch3;fixed=openssh%2F1%3A4.6p1-1;width=2;absolute=0"></a></div>
<div class="pkginfo">
  <p>Package:
     <a class="submitter" href="pkgreport.cgi?package=openssh-server">openssh-server</a>;
Maintainer for <a href="pkgreport.cgi?package=openssh-server">openssh-server</a> is <a href="pkgreport.cgi?maint=debian-ssh%40lists.debian.org">Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</a>; Source for <a href="pkgreport.cgi?package=openssh-server">openssh-server</a> is <a href="pkgreport.cgi?src=openssh">src:openssh</a> (<a href="https://tracker.debian.org/pkg/openssh">PTS</a>, <a href="https://buildd.debian.org/openssh">buildd</a>, <a href="https://qa.debian.org/popcon.php?package=openssh">popcon</a>). </p>

</div>

<div class="buginfo">
  <p>Reported by: <a href="pkgreport.cgi?submitter=fw%40deneb.enyo.de">Florian Weimer &lt;fw@deneb.enyo.de&gt;</a></p>
  <p>Date: Fri, 12 Sep 2008 09:18:06 UTC</p>

<p>Severity: <em class="severity">grave</em></p>
<p>Tags: etch, security</p>

<p>Found in version 4.3p2-9etch2</p>
<p>Fixed in versions 1:4.3p2-9etch3, openssh/1:4.6p1-1</p>

<p><strong>Done:</strong> Florian Weimer &lt;fw@deneb.enyo.de&gt;</p>

<p>Bug is archived. No further changes may be made.<p></div>

<p><input id="uselessmesages" type="checkbox"><label for="uselessmessages">Display info messages</label></p><div class="msgreceived"><p>View this report as an <a href="bugreport.cgi?bug=498678;mbox=yes">mbox folder</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;mboxstatus=yes">status mbox</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;mboxmaint=yes">maintainer mbox</a></p></div>

<div class="infmessage"><hr><p>
<a name="1"></a>
<strong>Report forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>:<br>
<code>Bug#498678</code>; Package <code>openssh-server</code>.
(<a href="bugreport.cgi?bug=498678;msg=2">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=2">mbox</a>, <a href="#1">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="3"></a>
<strong>Acknowledgement sent</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
New Bug report received and forwarded.  Copy sent to <code>Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=498678;msg=4">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=4">mbox</a>, <a href="#3">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="5"></a><a name="msg5"></a><a href="#5">Message #5</a> received at submit@bugs.debian.org (<a href="bugreport.cgi?bug=498678;msg=5">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=5">mbox</a>, <a href="mailto:498678@bugs.debian.org?subject=Re%3A%20sigdie%20must%20not%20be%20called%20from%20a%20signal%20handler%20context&amp;body=On%20Fri%2C%2012%20Sep%202008%2010%3A37%3A53%20%2B0200%20Florian%20Weimer%20%3Cfw%40deneb.enyo.de%3E%20wrote%3A%0A%3E%20Package%3A%20openssh-server%0A%3E%20Version%3A%204.3p2-9etch2%0A%3E%20%0A%3E%20This%20code%3A%0A%3E%20%0A%3E%20void%0A%3E%20sigdie%28const%20char%20%2Afmt%2C...%29%0A%3E%20%7B%0A%3E%20%20%20%20%20%20%20%20%20va_list%20args%3B%0A%3E%20%0A%3E%20%20%20%20%20%20%20%20%20va_start%28args%2C%20fmt%29%3B%0A%3E%20%20%20%20%20%20%20%20%20do_log%28SYSLOG_LEVEL_FATAL%2C%20fmt%2C%20args%29%3B%0A%3E%20%20%20%20%20%20%20%20%20va_end%28args%29%3B%0A%3E%20%20%20%20%20%20%20%20%20_exit%281%29%3B%0A%3E%20%7D%0A%3E%20%0A%3E%20is%20not%20safe%20to%20call%20from%20signal%20handlers%20%28mainly%20due%20to%20snprintf-type%0A%3E%20formatting%20and%20syslog%20calls%20in%20do_log%29.%20%20However%2C%20it%20is%20called%20from%20a%0A%3E%20signal%20handler%20in%20sshd.c%3A%0A%3E%20%0A%3E%20%2F%2A%0A%3E%20%20%2A%20Signal%20handler%20for%20the%20alarm%20after%20the%20login%20grace%20period%20has%20expired.%0A%3E%20%20%2A%2F%0A%3E%20static%20void%0A%3E%20grace_alarm_handler%28int%20sig%29%0A%3E%20%7B%0A%3E%20%20%20%20%20%20%20%20%20if%20%28use_privsep%20%26%26%20pmonitor%20%21%3D%20NULL%20%26%26%20pmonitor-%3Em_pid%20%3E%200%29%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20kill%28pmonitor-%3Em_pid%2C%20SIGALRM%29%3B%0A%3E%20%0A%3E%20%20%20%20%20%20%20%20%20%2F%2A%20Log%20error%20and%20exit.%20%2A%2F%0A%3E%20%20%20%20%20%20%20%20%20sigdie%28%22Timeout%20before%20authentication%20for%20%25s%22%2C%20get_remote_ipaddr%28%29%29%3B%0A%3E%20%7D%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C87wshh4v4u.fsf%40mid.deneb.enyo.de%3E&amp;In-Reply-To=%3C87wshh4v4u.fsf%40mid.deneb.enyo.de%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=fw%40deneb.enyo.de" alt="">
<div class="header"><span class="headerfield">From:</span> Florian Weimer &lt;fw@deneb.enyo.de&gt;</div>
<div class="header"><span class="headerfield">To:</span> submit@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> sigdie must not be called from a signal handler context</div>
<div class="header"><span class="headerfield">Date:</span> Fri, 12 Sep 2008 10:37:53 +0200</div>
</div>
<pre class="message">Package: openssh-server
Version: 4.3p2-9etch2

This code:

void
sigdie(const char *fmt,...)
{
        va_list args;

        va_start(args, fmt);
        do_log(SYSLOG_LEVEL_FATAL, fmt, args);
        va_end(args);
        _exit(1);
}

is not safe to call from signal handlers (mainly due to snprintf-type
formatting and syslog calls in do_log).  However, it is called from a
signal handler in sshd.c:

/*
 * Signal handler for the alarm after the login grace period has expired.
 */
static void
grace_alarm_handler(int sig)
{
        if (use_privsep &amp;&amp; pmonitor != NULL &amp;&amp; pmonitor-&gt;m_pid &gt; 0)
                kill(pmonitor-&gt;m_pid, SIGALRM);

        /* Log error and exit. */
        sigdie(&quot;Timeout before authentication for %s&quot;, get_remote_ipaddr());
}



</pre>

<div class="msgreceived"><hr><p>
<a name="6"></a>
<!-- time:1221504312 -->
<strong>Severity set to `important&#39; from `normal&#39;</strong>
Request was from <code>Peter Palfrader &lt;weasel@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Mon, 15 Sep 2008 18:45:12 GMT) (<a href="bugreport.cgi?bug=498678;msg=7">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=7">mbox</a>, <a href="#6">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="8"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>:<br>
<code>Bug#498678</code>; Package <code>openssh-server</code>.
(<a href="bugreport.cgi?bug=498678;msg=9">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=9">mbox</a>, <a href="#8">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="10"></a>
<strong>Acknowledgement sent</strong> to <code>Peter Palfrader &lt;weasel@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=498678;msg=11">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=11">mbox</a>, <a href="#10">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="12"></a><a name="msg12"></a><a href="#12">Message #12</a> received at 498678@bugs.debian.org (<a href="bugreport.cgi?bug=498678;msg=12">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=12">mbox</a>, <a href="mailto:498678@bugs.debian.org?References=%3C20080915160527.GT9633%40anguilla.noreply.org%3E&amp;body=On%20Mon%2C%2015%20Sep%202008%2018%3A05%3A27%20%2B0200%20Peter%20Palfrader%20%3Cweasel%40debian.org%3E%20wrote%3A%0A%3E%20Hi%2C%0A%3E%20%0A%3E%20this%20bug%20is%20affecting%20debian.org%20machines%20in%20a%20serious%20way.%0A%3E%20%0A%3E%20Sometimes%20sshd%27s%20privsep%20children%20do%20not%20reap%20their%20own%20children.%20%20After%0A%3E%20MaxStartup%20such%20children%20have%20been%20spawned%20sshd%20will%20not%20accept%20any%20new%0A%3E%20connections.%0A%3E%20%0A%3E%20root%20%20%20%20%20%203960%20%200.0%20%200.0%20%20%204932%20%201100%20%3F%20%20%20%20%20%20%20%20Ss%20%20%20Sep12%20%20%200%3A04%20%2Fusr%2Fsbin%2Fsshd%0A%3E%20root%20%20%20%20%2027129%20%200.0%20%200.0%20%20%207440%20%202728%20%3F%20%20%20%20%20%20%20%20Ss%20%20%2012%3A38%20%20%200%3A00%20%20%5C_%20sshd%3A%20debbugs%20%5Bpriv%5D%0A%3E%20sshd%20%20%20%20%2027130%20%200.0%20%200.0%20%20%20%20%20%200%20%20%20%20%200%20%3F%20%20%20%20%20%20%20%20Z%20%20%20%2012%3A38%20%20%200%3A00%20%20%7C%20%20%20%5C_%20%5Bsshd%5D%20%3Cdefunct%3E%0A%3E%20%0A%3E%20the%2027129%20sshd%20is%20stuck%20here%3A%0A%3E%20%0A%3E%20%28gdb%29%20bt%0A%3E%20%230%20%200xf7c3acd9%20in%20__lll_mutex_lock_wait%20%28%29%20from%20%2Flib%2Ftls%2Flibc.so.6%0A%3E%20%231%20%200xf7c2a73c%20in%20_L_mutex_lock_285%20%28%29%20from%20%2Flib%2Ftls%2Flibc.so.6%0A%3E%20%232%20%200x3694a138%20in%20%3F%3F%20%28%29%0A%3E%20%233%20%200x00000020%20in%20%3F%3F%20%28%29%0A%3E%20%234%20%200x080cd008%20in%20%3F%3F%20%28%29%0A%3E%20%235%20%200x00000400%20in%20%3F%3F%20%28%29%0A%3E%20%236%20%200x0808df77%20in%20__func__.12408%20%28%29%0A%3E%20%237%20%200xff94a55c%20in%20%3F%3F%20%28%29%0A%3E%20%238%20%200xff94a15c%20in%20%3F%3F%20%28%29%0A%3E%20%239%20%200x00000002%20in%20%3F%3F%20%28%29%0A%3E%20%2310%200xff94a968%20in%20%3F%3F%20%28%29%0A%3E%20%2311%200x08075afa%20in%20do_log%20%28level%3D135057416%2C%20fmt%3D0x1%20%3CAddress%200x1%20out%20of%20bounds%3E%2C%20args%3D0x20%20%3CAddress%200x20%20out%20of%20bounds%3E%29%20at%20..%2Flog.c%3A364%0A%3E%20%2312%200x08075afa%20in%20do_log%20%28level%3DSYSLOG_LEVEL_FATAL%2C%20fmt%3D0x8086ae4%20%22Timeout%20before%20authentication%20for%20%25s%22%2C%20args%3D0xff94a9a4%20%22X%C3%85%5Cr%5Cb%40%C2%AD%5C224%C3%BF%22%29%20at%20..%2Flog.c%3A364%0A%3E%20%2313%200x08075ec3%20in%20sigdie%20%28fmt%3D0x8086ae4%20%22Timeout%20before%20authentication%20for%20%25s%22%29%20at%20..%2Flog.c%3A140%0A%3E%20%2314%200x0804ddc6%20in%20grace_alarm_handler%20%28sig%3D14%29%20at%20..%2Fsshd.c%3A317%0A%3E%20%2315%20%3Csignal%20handler%20called%3E%0A%3E%20%2316%200xf7c2ee3c%20in%20send%20%28%29%20from%20%2Flib%2Ftls%2Flibc.so.6%0A%3E%20%2317%200xf7c2a3c2%20in%20vsyslog%20%28%29%20from%20%2Flib%2Ftls%2Flibc.so.6%0A%3E%20%2318%200xf7c2a672%20in%20syslog%20%28%29%20from%20%2Flib%2Ftls%2Flibc.so.6%0A%3E%20%2319%200x08075b0f%20in%20do_log%20%28level%3DSYSLOG_LEVEL_INFO%2C%20fmt%3D0x808a150%20%22%25s%20%25s%20for%20%25s%25.100s%20from%20%25.200s%20port%20%25d%25s%22%2C%20args%3D0xff94b5c4%20%22%C3%9D%5C237%5Cb%5CbI%C3%83%5Cb%5Cbn%C3%9B%5Cb%5Cb%5C020_%5Cr%5CbX%C3%85%5Cr%5Cb~%E2%82%AC%22%29%20at%20..%2Flog.c%3A365%0A%3E%20%2320%200x08075e63%20in%20logit%20%28fmt%3D0x808a150%20%22%25s%20%25s%20for%20%25s%25.100s%20from%20%25.200s%20port%20%25d%25s%22%29%20at%20..%2Flog.c%3A154%0A%3E%20%2321%200x08057280%20in%20auth_log%20%28authctxt%3D0x80d5928%2C%20authenticated%3D1%2C%20method%3D0x808c349%20%22publickey%22%2C%20info%3D0x808a86c%20%22%20ssh2%22%29%20at%20..%2Fauth.c%3A246%0A%3E%20%2322%200x08062f3b%20in%20monitor_child_preauth%20%28_authctxt%3D0x80d5928%2C%20pmonitor%3D0x80d5fc8%29%20at%20..%2Fmonitor.c%3A365%0A%3E%20%2323%200x080508a8%20in%20main%20%28ac%3D2%2C%20av%3D%3Cvalue%20optimized%20out%3E%29%20at%20..%2Fsshd.c%3A605%0A%3E%20%0A%3E%20%0A%3E%20I%20don%27t%20know%20if%20this%20lockup%20condition%20is%20triggerable%20in%20a%20reliable%20way%0A%3E%20by%20%28local%20or%20remote%20and%2For%20unauthenticated%29%20users%20but%20even%20if%20not%20it%0A%3E%20happened%20several%20times%20on%20rietz.d.o%2C%20requiring%20DSA%20intervention%20using%0A%3E%20OOB%20access%20to%20the%20system.%0A%3E%20%0A%3E%20This%20is%20really%20an%20issue%20that%20should%20be%20fixed%20for%20lenny%20%28if%20present%29%2C%20and%0A%3E%20maybe%20even%20for%20etch%2C%20still.%0A%3E%20%0A%3E%20Cheers%2C%0A%3E%20weasel%0A%3E%20--%20%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20.%27%27%60.%20%20%2A%2A%20Debian%20GNU%2FLinux%20%2A%2A%0A%3E%20%20%20%20%20%20%20Peter%20Palfrader%20%20%20%20%20%20%7C%20%3A%20%3A%27%20%3A%20%20%20%20%20%20The%20%20universal%0A%3E%20%20http%3A%2F%2Fwww.palfrader.org%2F%20%7C%20%60.%20%60%27%20%20%20%20%20%20Operating%20System%0A%3E%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%7C%20%20%20%60-%20%20%20%20http%3A%2F%2Fwww.debian.org%2F%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20locks%20up%20sshd%20processes&amp;In-Reply-To=%3C20080915160527.GT9633%40anguilla.noreply.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=weasel%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Peter Palfrader &lt;weasel@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> 498678@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> 498678-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> locks up sshd processes</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 15 Sep 2008 18:05:27 +0200</div>
</div>
<pre class="message">Hi,

this bug is affecting debian.org machines in a serious way.

Sometimes sshd&#39;s privsep children do not reap their own children.  After
MaxStartup such children have been spawned sshd will not accept any new
connections.

root      3960  0.0  0.0   4932  1100 ?        Ss   Sep12   0:04 /usr/sbin/sshd
root     27129  0.0  0.0   7440  2728 ?        Ss   12:38   0:00  \_ sshd: debbugs [priv]
sshd     27130  0.0  0.0      0     0 ?        Z    12:38   0:00  |   \_ [sshd] &lt;defunct&gt;

the 27129 sshd is stuck here:

(gdb) bt
#0  0xf7c3acd9 in __lll_mutex_lock_wait () from /lib/tls/libc.so.6
#1  0xf7c2a73c in _L_mutex_lock_285 () from /lib/tls/libc.so.6
#2  0x3694a138 in ?? ()
#3  0x00000020 in ?? ()
#4  0x080cd008 in ?? ()
#5  0x00000400 in ?? ()
#6  0x0808df77 in __func__.12408 ()
#7  0xff94a55c in ?? ()
#8  0xff94a15c in ?? ()
#9  0x00000002 in ?? ()
#10 0xff94a968 in ?? ()
#11 0x08075afa in do_log (level=135057416, fmt=0x1 &lt;Address 0x1 out of bounds&gt;, args=0x20 &lt;Address 0x20 out of bounds&gt;) at ../log.c:364
#12 0x08075afa in do_log (level=SYSLOG_LEVEL_FATAL, fmt=0x8086ae4 &quot;Timeout before authentication for %s&quot;, args=0xff94a9a4 &quot;XÅ\r\b@­\224ÿ&quot;) at ../log.c:364
#13 0x08075ec3 in sigdie (fmt=0x8086ae4 &quot;Timeout before authentication for %s&quot;) at ../log.c:140
#14 0x0804ddc6 in grace_alarm_handler (sig=14) at ../sshd.c:317
#15 &lt;signal handler called&gt;
#16 0xf7c2ee3c in send () from /lib/tls/libc.so.6
#17 0xf7c2a3c2 in vsyslog () from /lib/tls/libc.so.6
#18 0xf7c2a672 in syslog () from /lib/tls/libc.so.6
#19 0x08075b0f in do_log (level=SYSLOG_LEVEL_INFO, fmt=0x808a150 &quot;%s %s for %s%.100s from %.200s port %d%s&quot;, args=0xff94b5c4 &quot;Ý\237\b\bIÃ\b\bnÛ\b\b\020_\r\bXÅ\r\b~€&quot;) at ../log.c:365
#20 0x08075e63 in logit (fmt=0x808a150 &quot;%s %s for %s%.100s from %.200s port %d%s&quot;) at ../log.c:154
#21 0x08057280 in auth_log (authctxt=0x80d5928, authenticated=1, method=0x808c349 &quot;publickey&quot;, info=0x808a86c &quot; ssh2&quot;) at ../auth.c:246
#22 0x08062f3b in monitor_child_preauth (_authctxt=0x80d5928, pmonitor=0x80d5fc8) at ../monitor.c:365
#23 0x080508a8 in main (ac=2, av=&lt;value optimized out&gt;) at ../sshd.c:605


I don&#39;t know if this lockup condition is triggerable in a reliable way
by (local or remote and/or unauthenticated) users but even if not it
happened several times on rietz.d.o, requiring DSA intervention using
OOB access to the system.

This is really an issue that should be fixed for lenny (if present), and
maybe even for etch, still.

Cheers,
weasel
-- 
                           |  .&#39;&#39;`.  ** Debian GNU/Linux **
      Peter Palfrader      | : :&#39; :      The  universal
 <a href="http://www.palfrader.org/">http://www.palfrader.org/</a> | `. `&#39;      Operating System
                           |   `-    <a href="http://www.debian.org/">http://www.debian.org/</a>



</pre>

<div class="msgreceived"><hr><p>
<a name="13"></a>
<strong>Message sent on</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
Bug#498678.
(<a href="bugreport.cgi?bug=498678;msg=14">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=14">mbox</a>, <a href="#13">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="16"></a>
<!-- time:1221506829 -->
<strong>Severity set to `grave&#39; from `important&#39;</strong>
Request was from <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Mon, 15 Sep 2008 19:27:09 GMT) (<a href="bugreport.cgi?bug=498678;msg=17">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=17">mbox</a>, <a href="#16">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="18"></a>
<!-- time:1221506830 -->
<strong>Tags added: security</strong>
Request was from <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Mon, 15 Sep 2008 19:27:10 GMT) (<a href="bugreport.cgi?bug=498678;msg=19">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=19">mbox</a>, <a href="#18">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="20"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>:<br>
<code>Bug#498678</code>; Package <code>openssh-server</code>.
(<a href="bugreport.cgi?bug=498678;msg=21">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=21">mbox</a>, <a href="#20">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="22"></a>
<strong>Acknowledgement sent</strong> to <code>Colin Watson &lt;cjwatson@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=498678;msg=23">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=23">mbox</a>, <a href="#22">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="24"></a><a name="msg24"></a><a href="#24">Message #24</a> received at 498678@bugs.debian.org (<a href="bugreport.cgi?bug=498678;msg=24">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=24">mbox</a>, <a href="mailto:498678@bugs.debian.org?subject=Re%3A%20Bug%23498678%3A%20locks%20up%20sshd%20processes&amp;body=On%20Mon%2C%2015%20Sep%202008%2021%3A11%3A48%20%2B0100%20Colin%20Watson%20%3Ccjwatson%40debian.org%3E%20wrote%3A%0A%3E%20On%20Mon%2C%20Sep%2015%2C%202008%20at%2006%3A05%3A27PM%20%2B0200%2C%20Peter%20Palfrader%20wrote%3A%0A%3E%20%3E%20This%20is%20really%20an%20issue%20that%20should%20be%20fixed%20for%20lenny%20%28if%20present%29%2C%20and%0A%3E%20%3E%20maybe%20even%20for%20etch%2C%20still.%0A%3E%20%0A%3E%20I%20think%20this%20is%20fixed%20in%20lenny%20already.%20The%20current%20sigdie%20function%0A%3E%20reads%3A%0A%3E%20%0A%3E%20void%0A%3E%20sigdie%28const%20char%20%2Afmt%2C...%29%0A%3E%20%7B%0A%3E%20%23ifdef%20DO_LOG_SAFE_IN_SIGHAND%0A%3E%20%20%20%20%20%20%20%20%20va_list%20args%3B%0A%3E%20%0A%3E%20%20%20%20%20%20%20%20%20va_start%28args%2C%20fmt%29%3B%0A%3E%20%20%20%20%20%20%20%20%20do_log%28SYSLOG_LEVEL_FATAL%2C%20fmt%2C%20args%29%3B%0A%3E%20%20%20%20%20%20%20%20%20va_end%28args%29%3B%0A%3E%20%23endif%0A%3E%20%20%20%20%20%20%20%20%20_exit%281%29%3B%0A%3E%20%7D%0A%3E%20%0A%3E%20defines.h%20has%3A%0A%3E%20%0A%3E%20%23if%20defined%28HAVE_OPENLOG_R%29%20%26%26%20defined%28SYSLOG_DATA_INIT%29%20%26%26%20%5C%0A%3E%20%20%20%20%20defined%28SYSLOG_R_SAFE_IN_SIGHAND%29%0A%3E%20%23%20define%20DO_LOG_SAFE_IN_SIGHAND%0A%3E%20%23endif%0A%3E%20%0A%3E%20The%20easiest%20element%20of%20this%20conjunction%20to%20check%20is%0A%3E%20SYSLOG_R_SAFE_IN_SIGHAND%2C%20which%20configure%20only%20defines%20on%20OpenBSD.%0A%3E%20%0A%3E%20--%20%0A%3E%20Colin%20Watson%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bcjwatson%40debian.org%5D%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;References=%3C20080915160527.GT9633%40anguilla.noreply.org%3E%0A%20%3C20080915201148.GU17016%40riva.ucam.org%3E&amp;In-Reply-To=%3C20080915201148.GU17016%40riva.ucam.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=cjwatson%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Colin Watson &lt;cjwatson@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Peter Palfrader &lt;weasel@debian.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> 498678@bugs.debian.org, 498678-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#498678: locks up sshd processes</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 15 Sep 2008 21:11:48 +0100</div>
</div>
<pre class="message">On Mon, Sep 15, 2008 at 06:05:27PM +0200, Peter Palfrader wrote:
&gt; This is really an issue that should be fixed for lenny (if present), and
&gt; maybe even for etch, still.

I think this is fixed in lenny already. The current sigdie function
reads:

void
sigdie(const char *fmt,...)
{
#ifdef DO_LOG_SAFE_IN_SIGHAND
        va_list args;

        va_start(args, fmt);
        do_log(SYSLOG_LEVEL_FATAL, fmt, args);
        va_end(args);
#endif
        _exit(1);
}

defines.h has:

#if defined(HAVE_OPENLOG_R) &amp;&amp; defined(SYSLOG_DATA_INIT) &amp;&amp; \
    defined(SYSLOG_R_SAFE_IN_SIGHAND)
# define DO_LOG_SAFE_IN_SIGHAND
#endif

The easiest element of this conjunction to check is
SYSLOG_R_SAFE_IN_SIGHAND, which configure only defines on OpenBSD.

-- 
Colin Watson                                       [cjwatson@debian.org]



</pre>

<div class="msgreceived"><hr><p>
<a name="25"></a>
<!-- time:1221509707 -->
<strong>Tags added: etch</strong>
Request was from <code>Colin Watson &lt;cjwatson@debian.org&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Mon, 15 Sep 2008 20:15:07 GMT) (<a href="bugreport.cgi?bug=498678;msg=26">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=26">mbox</a>, <a href="#25">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="27"></a>
<strong>Message sent on</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
Bug#498678.
(<a href="bugreport.cgi?bug=498678;msg=28">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=28">mbox</a>, <a href="#27">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="30"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>:<br>
<code>Bug#498678</code>; Package <code>openssh-server</code>.
(<a href="bugreport.cgi?bug=498678;msg=31">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=31">mbox</a>, <a href="#30">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="32"></a>
<strong>Acknowledgement sent</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=498678;msg=33">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=33">mbox</a>, <a href="#32">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="34"></a><a name="msg34"></a><a href="#34">Message #34</a> received at 498678@bugs.debian.org (<a href="bugreport.cgi?bug=498678;msg=34">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=34">mbox</a>, <a href="mailto:498678@bugs.debian.org?In-Reply-To=%3C87y71tb1gc.fsf%40mid.deneb.enyo.de%3E&amp;body=On%20Mon%2C%2015%20Sep%202008%2022%3A26%3A11%20%2B0200%20Florian%20Weimer%20%3Cfw%40deneb.enyo.de%3E%20wrote%3A%0A%3E%20%2A%20Colin%20Watson%3A%0A%3E%20%0A%3E%20%3E%20On%20Mon%2C%20Sep%2015%2C%202008%20at%2006%3A05%3A27PM%20%2B0200%2C%20Peter%20Palfrader%20wrote%3A%0A%3E%20%3E%3E%20This%20is%20really%20an%20issue%20that%20should%20be%20fixed%20for%20lenny%20%28if%20present%29%2C%20and%0A%3E%20%3E%3E%20maybe%20even%20for%20etch%2C%20still.%0A%3E%20%3E%0A%3E%20%3E%20I%20think%20this%20is%20fixed%20in%20lenny%20already.%20The%20current%20sigdie%20function%0A%3E%20%3E%20reads%3A%0A%3E%20%0A%3E%20Yupp%2C%20the%20problem%20results%20from%20a%20broken%20patch%20which%20attempted%20to%20fix%0A%3E%20CVE-2006-5051.%20%20I%27m%20currently%20preparing%20an%20update%20for%20stable.%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23498678%3A%20locks%20up%20sshd%20processes&amp;References=%3C20080915160527.GT9633%40anguilla.noreply.org%3E%0A%09%3C20080915201148.GU17016%40riva.ucam.org%3E%0A%20%3C87y71tb1gc.fsf%40mid.deneb.enyo.de%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=fw%40deneb.enyo.de" alt="">
<div class="header"><span class="headerfield">From:</span> Florian Weimer &lt;fw@deneb.enyo.de&gt;</div>
<div class="header"><span class="headerfield">To:</span> Colin Watson &lt;cjwatson@debian.org&gt;</div>
<div class="header"><span class="headerfield">Cc:</span> Peter Palfrader &lt;weasel@debian.org&gt;,  498678@bugs.debian.org,  498678-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#498678: locks up sshd processes</div>
<div class="header"><span class="headerfield">Date:</span> Mon, 15 Sep 2008 22:26:11 +0200</div>
</div>
<pre class="message">* Colin Watson:

&gt; On Mon, Sep 15, 2008 at 06:05:27PM +0200, Peter Palfrader wrote:
&gt;&gt; This is really an issue that should be fixed for lenny (if present), and
&gt;&gt; maybe even for etch, still.
&gt;
&gt; I think this is fixed in lenny already. The current sigdie function
&gt; reads:

Yupp, the problem results from a broken patch which attempted to fix
<a href="https://security-tracker.debian.org/tracker/CVE-2006-5051">CVE-2006-5051</a>.  I&#39;m currently preparing an update for stable.



</pre>

<div class="msgreceived"><hr><p>
<a name="35"></a>
<strong>Message sent on</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
Bug#498678.
(<a href="bugreport.cgi?bug=498678;msg=36">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=36">mbox</a>, <a href="#35">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="38"></a>
<strong>Information forwarded</strong> to <code>debian-bugs-dist@lists.debian.org, Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>:<br>
<code>Bug#498678</code>; Package <code>openssh-server</code>.
(<a href="bugreport.cgi?bug=498678;msg=39">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=39">mbox</a>, <a href="#38">link</a>).</p></p></div>

<div class="infmessage"><hr><p>
<a name="40"></a>
<strong>Acknowledgement sent</strong> to <code>Colin Watson &lt;cjwatson@debian.org&gt;</code>:<br>
Extra info received and forwarded to list.  Copy sent to <code>Debian OpenSSH Maintainers &lt;debian-ssh@lists.debian.org&gt;</code>.
(<a href="bugreport.cgi?bug=498678;msg=41">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=41">mbox</a>, <a href="#40">link</a>).</p></p></div>

<hr><p class="msgreceived"><a name="42"></a><a name="msg42"></a><a href="#42">Message #42</a> received at 498678@bugs.debian.org (<a href="bugreport.cgi?bug=498678;msg=42">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=42">mbox</a>, <a href="mailto:498678@bugs.debian.org?body=On%20Tue%2C%2016%20Sep%202008%2001%3A09%3A11%20%2B0100%20Colin%20Watson%20%3Ccjwatson%40debian.org%3E%20wrote%3A%0A%3E%20On%20Mon%2C%20Sep%2015%2C%202008%20at%2010%3A26%3A11PM%20%2B0200%2C%20Florian%20Weimer%20wrote%3A%0A%3E%20%3E%20%2A%20Colin%20Watson%3A%0A%3E%20%3E%20%3E%20On%20Mon%2C%20Sep%2015%2C%202008%20at%2006%3A05%3A27PM%20%2B0200%2C%20Peter%20Palfrader%20wrote%3A%0A%3E%20%3E%20%3E%3E%20This%20is%20really%20an%20issue%20that%20should%20be%20fixed%20for%20lenny%20%28if%20present%29%2C%20and%0A%3E%20%3E%20%3E%3E%20maybe%20even%20for%20etch%2C%20still.%0A%3E%20%3E%20%3E%0A%3E%20%3E%20%3E%20I%20think%20this%20is%20fixed%20in%20lenny%20already.%20The%20current%20sigdie%20function%0A%3E%20%3E%20%3E%20reads%3A%0A%3E%20%3E%20%0A%3E%20%3E%20Yupp%2C%20the%20problem%20results%20from%20a%20broken%20patch%20which%20attempted%20to%20fix%0A%3E%20%3E%20CVE-2006-5051.%20%20I%27m%20currently%20preparing%20an%20update%20for%20stable.%0A%3E%20%0A%3E%20Thanks%2C%20much%20appreciated.%0A%3E%20%0A%3E%20--%20%0A%3E%20Colin%20Watson%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%20%5Bcjwatson%40debian.org%5D%0A%3E%20%0A%3E%20%0A%3E%20%0A&amp;subject=Re%3A%20Bug%23498678%3A%20locks%20up%20sshd%20processes&amp;References=%3C20080915160527.GT9633%40anguilla.noreply.org%3E%20%3C20080915201148.GU17016%40riva.ucam.org%3E%20%3C87y71tb1gc.fsf%40mid.deneb.enyo.de%3E%0A%20%3C20080916000911.GV17016%40riva.ucam.org%3E&amp;In-Reply-To=%3C20080916000911.GV17016%40riva.ucam.org%3E">reply</a>):</p>
<div class="headers">
<img src="/cgi-bin/libravatar.cgi?email=cjwatson%40debian.org" alt="">
<div class="header"><span class="headerfield">From:</span> Colin Watson &lt;cjwatson@debian.org&gt;</div>
<div class="header"><span class="headerfield">To:</span> Florian Weimer &lt;fw@deneb.enyo.de&gt;, 498678@bugs.debian.org</div>
<div class="header"><span class="headerfield">Cc:</span> Peter Palfrader &lt;weasel@debian.org&gt;, 498678-submitter@bugs.debian.org</div>
<div class="header"><span class="headerfield">Subject:</span> Re: Bug#498678: locks up sshd processes</div>
<div class="header"><span class="headerfield">Date:</span> Tue, 16 Sep 2008 01:09:11 +0100</div>
</div>
<pre class="message">On Mon, Sep 15, 2008 at 10:26:11PM +0200, Florian Weimer wrote:
&gt; * Colin Watson:
&gt; &gt; On Mon, Sep 15, 2008 at 06:05:27PM +0200, Peter Palfrader wrote:
&gt; &gt;&gt; This is really an issue that should be fixed for lenny (if present), and
&gt; &gt;&gt; maybe even for etch, still.
&gt; &gt;
&gt; &gt; I think this is fixed in lenny already. The current sigdie function
&gt; &gt; reads:
&gt; 
&gt; Yupp, the problem results from a broken patch which attempted to fix
&gt; <a href="https://security-tracker.debian.org/tracker/CVE-2006-5051">CVE-2006-5051</a>.  I&#39;m currently preparing an update for stable.

Thanks, much appreciated.

-- 
Colin Watson                                       [cjwatson@debian.org]



</pre>

<div class="msgreceived"><hr><p>
<a name="43"></a>
<strong>Message sent on</strong> to <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>:<br>
Bug#498678.
(<a href="bugreport.cgi?bug=498678;msg=44">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=44">mbox</a>, <a href="#43">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="46"></a>
<!-- time:1221642725 -->
<strong>Bug marked as fixed in version 1:4.3p2-9etch3, send any further explanations to Florian Weimer &lt;fw@deneb.enyo.de&gt;</strong>
Request was from <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Wed, 17 Sep 2008 09:12:05 GMT) (<a href="bugreport.cgi?bug=498678;msg=47">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=47">mbox</a>, <a href="#46">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="48"></a>
<!-- time:1221642726 -->
<strong>Bug marked as fixed in version 1:4.6p1-1, send any further explanations to Florian Weimer &lt;fw@deneb.enyo.de&gt;</strong>
Request was from <code>Florian Weimer &lt;fw@deneb.enyo.de&gt;</code>
to <code>control@bugs.debian.org</code>. 
 (Wed, 17 Sep 2008 09:12:06 GMT) (<a href="bugreport.cgi?bug=498678;msg=49">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=49">mbox</a>, <a href="#48">link</a>).</p></p></div>

<div class="msgreceived"><hr><p>
<a name="50"></a>
<!-- time:1224142345 -->
<strong>Bug archived.</strong>
Request was from <code>Debbugs Internal Request &lt;owner@bugs.debian.org&gt;</code>
to <code>internal_control@bugs.debian.org</code>.
 (Thu, 16 Oct 2008 07:32:25 GMT) (<a href="bugreport.cgi?bug=498678;msg=51">full text</a>, <a href="bugreport.cgi?bug=498678;mbox=yes;msg=51">mbox</a>, <a href="#50">link</a>).</p></p></div>

<hr>
<p class="msgreceived">Send a report that <a href="https://bugs.debian.org/cgi-bin/bugspam.cgi?bug=498678">this bug log contains spam</a>.</p>
<hr>
<ADDRESS>Debian bug tracking system administrator &lt;<A HREF="mailto:owner@bugs.debian.org">owner@bugs.debian.org</A>&gt;.
Last modified:
<!--timestamp-->Fri Jan 10 19:35:38 2025<!--end timestamp-->; 
Machine Name:
<!--machinename-->bembo<!--machinename-->
<P>
<A HREF="https://www.debian.org/Bugs/">Debian Bug tracking system</A>
</p>
<p>
  Debbugs is free software and licensed under the terms of the GNU General
  Public License version 2. The current version can be obtained
  from <a href="https://bugs.debian.org/debbugs-source/">https://bugs.debian.org/debbugs-source/</a>.
</p>
<p>
Copyright © 1999 Darren O. Benham,
1997,2003 nCipher Corporation Ltd,
1994-97 Ian Jackson,
2005-2017 Don Armstrong, and many other contributors.
</p>
</ADDRESS>

</body>
</html>
