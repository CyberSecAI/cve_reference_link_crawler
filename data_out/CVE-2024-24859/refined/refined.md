- **Root cause of vulnerability:** A race condition exists in the `sniff_{min,max}_interval_set` function. The function updates `hdev->sniff_{min,max}_interval`. Although there's a check to ensure `sniff_max_interval` is not less than `sniff_min_interval`, this check is performed without holding a lock. This means that another thread can modify the `sniff_{min,max}_interval` values after the check but before the actual update, leading to an invalid state where `sniff_max_interval` becomes less than `sniff_min_interval`.
- **Weaknesses/vulnerabilities present:** Race condition leading to an invalid state of `hdev->sniff_{min,max}_interval`
- **Impact of exploitation:** The invalid `sniff_{min,max}_interval` values can cause the Bluetooth stack to malfunction when entering sniff mode. The `hci_conn_idle` function uses these values to initialize `hci_cp_sniff_subrate`, which determines the sniff interval. Incorrect values can lead to abnormal Bluetooth sniffing, potentially resulting in a denial-of-service (DoS) condition.
- **Attack vectors:** An attacker can exploit the race condition by triggering concurrent calls to the function that sets the sniff interval and another that might modify it. This could lead to the write of invalid values and thus the DoS.
- **Required attacker capabilities/position:** The attacker needs to be able to trigger concurrent updates to the sniff interval parameters which is possible with normal Bluetooth use.