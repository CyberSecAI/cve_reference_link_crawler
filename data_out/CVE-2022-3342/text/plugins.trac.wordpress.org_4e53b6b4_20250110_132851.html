

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F2805282%2Fzero-bs-crm%2Ftrunk%2Fincludes%2FZeroBSCRM.CSVImporter.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2632084/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php "Changeset 2632084 for zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php")
* [Next Change](/changeset/2833903/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php "Changeset 2833903 for zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php") →

---

# Changeset [2805282](/changeset/2805282 "Show full changeset") for [zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/26/2022 06:41:06 PM
([2 years](/timeline?from=2022-10-26T18%3A41%3A06Z&precision=second "See timeline at 10/26/2022 06:41:06 PM") ago)

Author:
jetpackcrmdeploybot
Message:

Update to version 5.4.0 from GitHub

File:

1 edited

* [zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282 "Show entry in browser")
  (modified)
  ([14 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php](/changeset/2805282/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php "Show the changeset 2805282 restricted to zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php")

  | [r2632084](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L94 "Show revision 2632084 of this file in browser") | [r2805282](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L94 "Show revision 2805282 of this file in browser") |  |
  | --- | --- | --- |
  | 94 | 94 |  |
  | 95 | 95 | global $wpdb, $zbs, $zeroBSCRM\_CSVImporterLiteversion;  #} Req |
  | 96 |  |  |
  |  | 96 |  |
  | 97 | 97 | if (!current\_user\_can('admin\_zerobs\_customers'))  { wp\_die( \_\_('You do not have sufficient permissions to access this page.',"zero-bs-crm") ); } |
  | 98 |  |  |
  | 99 |  |  |
  |  | 98 |  |
  | 100 | 99 | ?> |
  | 101 | 100 |  |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L208) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L207) |  |
  | 208 | 207 | } |
  | 209 | 208 |  |
  |  | 209 | // catch errors with nonce or other oddities |
  |  | 210 | function jpcrm\_csvimporter\_lite\_preflight\_checks( $stage ) { |
  |  | 211 |  |
  |  | 212 | if ( ! isset( $\_POST['zbscrmcsvimportnonce'] ) || ! wp\_verify\_nonce( $\_POST['zbscrmcsvimportnonce'], 'zbscrm\_csv\_import' ) ) { |
  |  | 213 | // hard no |
  |  | 214 | zeroBSCRM\_html\_msg( -1, \_\_( 'There was an error processing your CSV file. Please try again.', 'zero-bs-crm' ) ); |
  |  | 215 | exit(); |
  |  | 216 | } |
  |  | 217 |  |
  |  | 218 | // eventually update this to use the zbscrm-store/\_wip replacement |
  |  | 219 | // apparently sys\_get\_temp\_dir() isn't consistent on whether it has a trailing slash |
  |  | 220 | $tmp\_dir = untrailingslashit( sys\_get\_temp\_dir() ); |
  |  | 221 | $tmp\_dir = realpath( $tmp\_dir ) . '/'; |
  |  | 222 |  |
  |  | 223 | $field\_map = array(); |
  |  | 224 |  |
  |  | 225 | if ( $stage == 1 ) { |
  |  | 226 |  |
  |  | 227 | if ( empty( $\_FILES['zbscrmcsvfile'] ) || empty( $\_FILES['zbscrmcsvfile']['name'] ) ) { |
  |  | 228 | throw new Exception( \_\_( 'No CSV file was provided. Please choose the CSV file you want to upload.', 'zero-bs-crm' ) ); |
  |  | 229 | } |
  |  | 230 |  |
  |  | 231 | $csv\_file\_data = $\_FILES['zbscrmcsvfile']; |
  |  | 232 |  |
  |  | 233 | // error uploading |
  |  | 234 | if ( $csv\_file\_data['error'] !== UPLOAD\_ERR\_OK ) { |
  |  | 235 | throw new Exception( \_\_( 'There was an error processing your CSV file. Please try again.', 'zero-bs-crm' ) ); |
  |  | 236 | } |
  |  | 237 |  |
  |  | 238 | // basic MIME/extension check |
  |  | 239 | if ( |
  |  | 240 | ( $csv\_file\_data['type'] !== 'text/csv' && $csv\_file\_data['type'] !== 'text/plain' ) |
  |  | 241 | || pathinfo( $csv\_file\_data['name'], PATHINFO\_EXTENSION ) !== 'csv' |
  |  | 242 | ) { |
  |  | 243 | throw new Exception( \_\_( 'Your file is not a correctly-formatted CSV file. Please check your file format. If you continue to have issues please contact support.', 'zero-bs-crm' ) ); |
  |  | 244 | } |
  |  | 245 |  |
  |  | 246 | /\* |
  |  | 247 | The main goal below is to have a file that can be read in future steps, but also that is unreadable to the public. |
  |  | 248 |  |
  |  | 249 | Things to be aware of: |
  |  | 250 | - If we don't move/rename the file, PHP automatically deletes it at the end of the process. |
  |  | 251 | - The hash/encryption is overkill at the moment but exists in case the destination folder is publicly available (see 2435-gh). |
  |  | 252 | - For now, we just rename the file and leave it in the system tmp folder, but eventually we can move it to the zbscrm-store replacement. |
  |  | 253 | \*/ |
  |  | 254 |  |
  |  | 255 | $public\_name = basename( $csv\_file\_data['tmp\_name'] ); |
  |  | 256 |  |
  |  | 257 | $hashed\_filename = jpcrm\_get\_hashed\_filename( $public\_name, '.csv' ); |
  |  | 258 | $file\_path = $tmp\_dir . $hashed\_filename; |
  |  | 259 |  |
  |  | 260 | // try to move file to destination for future processing |
  |  | 261 | if ( !move\_uploaded\_file( $csv\_file\_data['tmp\_name'], $file\_path ) ) { |
  |  | 262 | throw new Exception( \_\_( 'Unable to upload CSV file.', 'zero-bs-crm' ) ); |
  |  | 263 | } |
  |  | 264 |  |
  |  | 265 | } |
  |  | 266 |  |
  |  | 267 | // Check stage 2 and 3 |
  |  | 268 | if ( $stage === 2 || $stage === 3 ) { |
  |  | 269 |  |
  |  | 270 | // (carefully) check for file presence |
  |  | 271 | $public\_name = ( isset( $\_POST['zbscrmcsvimpf'] ) ? sanitize\_file\_name( $\_POST['zbscrmcsvimpf'] ) : '' ); |
  |  | 272 |  |
  |  | 273 | if ( empty( $public\_name ) ) { |
  |  | 274 | throw new Exception( \_\_( 'There was an error processing your CSV file. Please try again.', 'zero-bs-crm' ) ); |
  |  | 275 | } |
  |  | 276 |  |
  |  | 277 | $hashed\_filename = jpcrm\_get\_hashed\_filename( $public\_name, '.csv' ); |
  |  | 278 | $file\_path = $tmp\_dir . $hashed\_filename; |
  |  | 279 |  |
  |  | 280 | // Retrieve fields |
  |  | 281 | $field\_map = array(); |
  |  | 282 | $mapped\_field\_count = 0; |
  |  | 283 | for ( $fieldI = 1; $fieldI <= 30; $fieldI++ ) { |
  |  | 284 |  |
  |  | 285 | // Default to ignore |
  |  | 286 | $map\_to = 'ignorezbs'; |
  |  | 287 |  |
  |  | 288 | // Map :) |
  |  | 289 | if ( !empty( $\_POST['zbscrm-csv-fieldmap-'.$fieldI] ) && $\_POST['zbscrm-csv-fieldmap-'.$fieldI] !== -1 ) { |
  |  | 290 |  |
  |  | 291 | $map\_to = sanitize\_text\_field( $\_POST['zbscrm-csv-fieldmap-'.$fieldI] ); |
  |  | 292 |  |
  |  | 293 | // Count actual mapped fields |
  |  | 294 | if ( $map\_to != 'ignorezbs' ) { |
  |  | 295 | $mapped\_field\_count++; |
  |  | 296 | } |
  |  | 297 |  |
  |  | 298 | // Pass it. |
  |  | 299 | $field\_map[$fieldI] = $map\_to; |
  |  | 300 |  |
  |  | 301 | } |
  |  | 302 |  |
  |  | 303 | } |
  |  | 304 |  |
  |  | 305 | // no fields were mapped |
  |  | 306 | if ( $mapped\_field\_count === 0 ) { |
  |  | 307 | // delete the file |
  |  | 308 | unlink( $file\_path ); |
  |  | 309 | throw new Exception( \_\_( 'No fields were mapped. You cannot import customers without at least one field mapped to a customer attribute.', 'zero-bs-crm' ) ); |
  |  | 310 | } |
  |  | 311 |  |
  |  | 312 | } |
  |  | 313 |  |
  |  | 314 | // Now that we only pass the filename via POST, and we encrypt+hash it, the following few lines are probably |
  |  | 315 | // no longer needed, but leaving for now |
  |  | 316 | $file\_path = realpath( $file\_path ); |
  |  | 317 | // This ensures that the provided file exists and is inside the upload folder or one of its subdirs (ie `/wp-content/uploads/\*`) |
  |  | 318 | // and not somewhere else, also prevent traversal attacks, and usage of wrappers like phar:// etc |
  |  | 319 | if ( $file\_path === false || strpos( $file\_path, $tmp\_dir ) !== 0) { |
  |  | 320 | //Traversal attempt, file does not exist, invalid wrapper |
  |  | 321 | throw new Exception( \_\_( 'There was an error processing your CSV file. Please try again.', 'zero-bs-crm' ) ); |
  |  | 322 | } |
  |  | 323 |  |
  |  | 324 | // Get CSV data |
  |  | 325 | $csv\_data = file\_get\_contents( $file\_path ); |
  |  | 326 |  |
  |  | 327 | // no lines or empty first line |
  |  | 328 | if ( empty( $csv\_data ) ) { |
  |  | 329 | // delete the file |
  |  | 330 | unlink( $file\_path ); |
  |  | 331 | throw new Exception( \_\_( 'We did not find any usable lines in the provided file. If you are having continued problems please contact support.', 'zero-bs-crm' ) ); |
  |  | 332 | } |
  |  | 333 |  |
  |  | 334 | $csv\_data = strip\_tags( $csv\_data ); |
  |  | 335 | $csv\_data = preg\_split("/\\r\\n|\\r|\\n/", $csv\_data); |
  |  | 336 |  |
  |  | 337 | // Count lines |
  |  | 338 | $num\_lines = count( $csv\_data ); |
  |  | 339 | $ignore\_first\_line = isset( $\_POST['zbscrmcsvimpignorefirst'] ); |
  |  | 340 | if ($ignore\_first\_line) $num\_lines--; |
  |  | 341 |  |
  |  | 342 | $file\_details = array( |
  |  | 343 | 'public\_name'       => $public\_name, |
  |  | 344 | 'filename'          => $hashed\_filename, |
  |  | 345 | 'file\_path'         => $file\_path, |
  |  | 346 | 'csv\_data'          => $csv\_data, |
  |  | 347 | 'num\_lines'         => $num\_lines, |
  |  | 348 | 'ignore\_first\_line' => $ignore\_first\_line, |
  |  | 349 | 'field\_map'         => $field\_map, |
  |  | 350 | ); |
  |  | 351 |  |
  |  | 352 | return $file\_details; |
  |  | 353 | } |
  |  | 354 |  |
  | 210 | 355 |  |
  | 211 | 356 | #} HTML for main app |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L224) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L369) |  |
  | 224 | 369 | #} - Complete (button) |
  | 225 | 370 | #} - Process |
  | 226 |  | $stage = 0; if (isset($\_POST['zbscrmcsvimpstage']) && !empty($\_POST['zbscrmcsvimpstage']) && in\_array($\_POST['zbscrmcsvimpstage'],array(1,2,3))){ $stage = (int)sanitize\_text\_field($\_POST['zbscrmcsvimpstage']); } |
  | 227 |  | $nonceOkay = true; |
  | 228 |  |  |
  | 229 |  | #} Validation (pre stage load) |
  | 230 |  |  |
  | 231 |  | #} Check nonce |
  | 232 |  | if (! isset( $\_POST['zbscrmcsvimportnonce'] ) || ! wp\_verify\_nonce( $\_POST['zbscrmcsvimportnonce'], 'zbscrm\_csv\_import' )) { |
  | 233 |  | $nonceOkay = false; |
  | 234 |  | } |
  | 235 |  |  |
  | 236 |  | #} Catch file or nonce errors (back to beginning) |
  | 237 |  | if ($stage == 1){ |
  | 238 |  |  |
  | 239 |  | #} Nonce? |
  | 240 |  | if (!$nonceOkay) { |
  | 241 |  |  |
  | 242 |  | #} Send back to start |
  | 243 |  | $stage = 0; |
  | 244 |  | $stageError = \_\_( 'There was an error uploading your CSV file. Please try again.', 'zero-bs-crm' ); |
  | 245 |  | } |
  | 246 |  |  |
  | 247 |  | #} File uploads |
  | 248 |  | #} https://codex.wordpress.org/Function\_Reference/wp\_handle\_upload |
  | 249 |  | if ( ! function\_exists( 'wp\_handle\_upload' ) ) { |
  | 250 |  | require\_once( ABSPATH . 'wp-admin/includes/file.php' ); |
  | 251 |  | } |
  | 252 |  |  |
  | 253 |  | $uploadedfile = $\_FILES['zbscrmcsvfile']; |
  | 254 |  |  |
  | 255 |  | $upload\_overrides = array( 'test\_form' => false ); |
  | 256 |  |  |
  | 257 |  | $movefile = wp\_handle\_upload( $uploadedfile, $upload\_overrides ); # |
  | 258 |  |  |
  | 259 |  | if ( $movefile && ! isset( $movefile['error'] ) ) { |
  | 260 |  | #echo "File is valid, and was successfully uploaded.\n"; |
  | 261 |  | #var\_dump( $movefile ); |
  | 262 |  |  |
  | 263 |  | #} All good. Set var |
  | 264 |  | $fileDetails = $movefile; |
  | 265 |  |  |
  | 266 |  | #} Check valid filetype: |
  | 267 |  |  |
  | 268 |  | #} Extension |
  | 269 |  | $fileName = basename($fileDetails['file']); |
  | 270 |  | $fileURL = $fileDetails['url']; #} Just passed through for later use |
  | 271 |  | $extension = pathinfo($fileName, PATHINFO\_EXTENSION); |
  | 272 |  | if (strtolower($extension) != "csv"){ |
  | 273 |  |  |
  | 274 |  | #} Del file |
  | 275 |  | unlink( $fileDetails['file'] ); |
  | 276 |  |  |
  | 277 |  | #} Send back to start |
  | 278 |  | $stage = 0; |
  | 279 |  | $stageError = \_\_( 'Your file is not a ".csv" file. If you are having continued problems please email support with a copy of your CSV file attached.', 'zero-bs-crm' ); |
  | 280 |  |  |
  | 281 |  | } |
  | 282 |  |  |
  | 283 |  | #} MIME |
  | 284 |  | if ($fileDetails['type'] != "text/csv" && $fileDetails['type'] != "text/plain") { |
  | 285 |  |  |
  | 286 |  | #} Del file |
  | 287 |  | unlink( $fileDetails['file'] ); |
  | 288 |  |  |
  | 289 |  | #} Send back to start |
  | 290 |  | $stage = 0; |
  | 291 |  | $stageError = \_\_( 'Your file is not a correctly formatted CSV, please check your file format. If you are having continued problems please email support with a copy of your CSV file attached.', 'zero-bs-crm' ); |
  | 292 |  |  |
  | 293 |  | } |
  | 294 |  |  |
  | 295 |  | // Check format |
  | 296 |  | $fullCSV = file\_get\_contents($fileDetails['file']); |
  | 297 |  | $fullCSV = strip\_tags($fullCSV); |
  | 298 |  |  |
  | 299 |  | #$csvLines = explode("\n",$fullCSV) |
  | 300 |  | $csvLines = preg\_split("/\\r\\n|\\r|\\n/", $fullCSV); |
  | 301 |  | if (count($csvLines) <= 0){ |
  | 302 |  |  |
  | 303 |  | #} Send back to start |
  | 304 |  | $stage = 0; |
  | 305 |  | $stageError = \_\_( 'Your file does not appear to be a correctly formatted CSV File. We did not find any usable lines to import. If you are having continued problems please email support with a copy of your CSV file attached.', 'zero-bs-crm' ); |
  | 306 |  |  |
  | 307 |  | } |
  | 308 |  |  |
  | 309 |  |  |
  | 310 |  | } else { |
  | 311 |  | /\*\* |
  | 312 |  | \* Error generated by \_wp\_handle\_upload() |
  | 313 |  | \* @see \_wp\_handle\_upload() in wp-admin/includes/file.php |
  | 314 |  | \*/ |
  | 315 |  | #echo $movefile['error']; |
  | 316 |  |  |
  | 317 |  | #} Send back to start |
  | 318 |  | $stage = 0; |
  | 319 |  | $stageError = $movefile['error']; |
  | 320 |  | } |
  | 321 |  |  |
  |  | 371 | $stage = 0; |
  |  | 372 | if ( !empty( $\_POST['zbscrmcsvimpstage'] ) ) { |
  |  | 373 | $stage = (int)$\_POST['zbscrmcsvimpstage']; |
  |  | 374 | } |
  |  | 375 |  |
  |  | 376 | if ( in\_array( $stage, array( 1, 2, 3 ) ) ) { |
  |  | 377 | try { |
  |  | 378 | // check nonce and other things |
  |  | 379 | $file\_details = jpcrm\_csvimporter\_lite\_preflight\_checks( $stage ); |
  |  | 380 | } catch (Exception $e) { |
  |  | 381 | // send back to beginning and show error |
  |  | 382 | $stage = 0; |
  |  | 383 | $stageError = $e->getMessage(); |
  | 322 | 384 | } |
  | 323 |  |  |
  | 324 |  | #} Check stage 2 |
  | 325 |  | if ($stage == 2){ |
  | 326 |  |  |
  | 327 |  | #} Grab zbscrmcsvimpignorefirst |
  | 328 |  | $ignoreFirstLine = false; if (isset($\_POST['zbscrmcsvimpignorefirst'])) $ignoreFirstLine = true; |
  | 329 |  |  |
  | 330 |  | #} No record of file |
  | 331 |  | if (!isset($\_POST['zbscrmcsvimpf']) || !file\_exists($\_POST['zbscrmcsvimpf'])){ |
  | 332 |  |  |
  | 333 |  | #} Send back to start |
  | 334 |  | $stage = 0; |
  | 335 |  | $stageError = \_\_( 'There was an error maintaining a link to your uploaded CSV file. Please contact support if this error persists, quoting error code #457', 'zero-bs-crm' ); #} lol. |
  | 336 |  |  |
  | 337 |  | } else { |
  | 338 |  |  |
  | 339 |  | #} set csv file var |
  | 340 |  | $csvFileLoca = sanitize\_text\_field($\_POST['zbscrmcsvimpf']); |
  | 341 |  | $csvFileURL = sanitize\_text\_field($\_POST['zbscrmcsvimpfurl']); |
  | 342 |  |  |
  | 343 |  | #} Get line count |
  | 344 |  | $fullCSV = file\_get\_contents($csvFileLoca); |
  | 345 |  | #$csvLines = explode("\n",$fullCSV) |
  | 346 |  | $csvLines = preg\_split("/\\r\\n|\\r|\\n/", $fullCSV); |
  | 347 |  |  |
  | 348 |  | #} Count total |
  | 349 |  | $totalCSVLines = count($csvLines); |
  | 350 |  | if ($ignoreFirstLine) $totalCSVLines--; |
  | 351 |  |  |
  | 352 |  | } |
  | 353 |  |  |
  | 354 |  | #} Retrieve fields |
  | 355 |  | $fieldMap = array(); $realFields = 0; |
  | 356 |  | for ($fieldI = 1; $fieldI <= 30; $fieldI++){ |
  | 357 |  |  |
  | 358 |  | #} Default to ignore |
  | 359 |  | $mapTo = 'ignorezbs'; |
  | 360 |  |  |
  | 361 |  | #} Map :) |
  | 362 |  | if (isset($\_POST['zbscrm-csv-fieldmap-'.$fieldI]) && !empty($\_POST['zbscrm-csv-fieldmap-'.$fieldI]) && $\_POST['zbscrm-csv-fieldmap-'.$fieldI] !== -1){ |
  | 363 |  |  |
  | 364 |  | $mapTo = sanitize\_text\_field($\_POST['zbscrm-csv-fieldmap-'.$fieldI]); |
  | 365 |  |  |
  | 366 |  | #} Count actual mapped fields |
  | 367 |  | if ($mapTo != 'ignorezbs') $realFields++; |
  | 368 |  |  |
  | 369 |  | #} Pass it. |
  | 370 |  | $fieldMap[$fieldI] = $mapTo; |
  | 371 |  |  |
  | 372 |  | } |
  | 373 |  |  |
  | 374 |  | } |
  | 375 |  |  |
  | 376 |  | if ($realFields == 0) $stageError = \_\_( 'No fields were matched. You cannot import customers without at least one field mapped to a customer attribute.', 'zero-bs-crm' ); |
  | 377 |  |  |
  | 378 |  |  |
  | 379 |  | } |
  | 380 |  |  |
  | 381 |  | #} Check stage 3 |
  | 382 |  | if ($stage == 3){ |
  | 383 |  |  |
  | 384 |  | #} Grab zbscrmcsvimpignorefirst |
  | 385 |  | $ignoreFirstLine = false; if (isset($\_POST['zbscrmcsvimpignorefirst'])) $ignoreFirstLine = true; |
  | 386 |  |  |
  | 387 |  | #} No record of file |
  | 388 |  | if (!isset($\_POST['zbscrmcsvimpf']) || !file\_exists($\_POST['zbscrmcsvimpf'])){ |
  | 389 |  |  |
  | 390 |  | #} Send back to start |
  | 391 |  | $stage = 0; |
  | 392 |  | $stageError = \_\_( 'There was an error maintaining a link to your uploaded CSV file. Please contact support if this error persists, quoting error code #457', 'zero-bs-crm' ); #} lol. |
  | 393 |  |  |
  | 394 |  | } else { |
  | 395 |  |  |
  | 396 |  | #} set csv file var |
  | 397 |  | $csvFileLoca = sanitize\_text\_field($\_POST['zbscrmcsvimpf']); |
  | 398 |  | $csvFileURL = sanitize\_text\_field($\_POST['zbscrmcsvimpfurl']); |
  | 399 |  | $csvFileName = basename($csvFileLoca); |
  | 400 |  |  |
  | 401 |  | #} Get line count |
  | 402 |  | $fullCSV = file\_get\_contents($csvFileLoca); |
  | 403 |  | #$csvLines = explode("\n",$fullCSV) |
  | 404 |  | $csvLines = preg\_split("/\\r\\n|\\r|\\n/", $fullCSV); |
  | 405 |  |  |
  | 406 |  | } |
  | 407 |  |  |
  | 408 |  | #} Retrieve fields |
  | 409 |  | $fieldMap = array(); $realFields = 0; |
  | 410 |  | for ($fieldI = 0; $fieldI <= 30; $fieldI++){ |
  | 411 |  |  |
  | 412 |  | #} Default to ignore |
  | 413 |  | $mapTo = 'ignorezbs'; |
  | 414 |  |  |
  | 415 |  | #} Map :) |
  | 416 |  | if (isset($\_POST['zbscrm-csv-fieldmap-'.$fieldI]) && !empty($\_POST['zbscrm-csv-fieldmap-'.$fieldI]) && $\_POST['zbscrm-csv-fieldmap-'.$fieldI] !== -1){ |
  | 417 |  |  |
  | 418 |  | #} NO validation?! #validationtodo |
  | 419 |  | $mapTo = sanitize\_text\_field($\_POST['zbscrm-csv-fieldmap-'.$fieldI]); |
  | 420 |  |  |
  | 421 |  | #} Count actual mapped fields |
  | 422 |  | if ($mapTo != 'ignorezbs') $realFields++; |
  | 423 |  |  |
  | 424 |  | #} Pass it. |
  | 425 |  | $fieldMap[$fieldI] = $mapTo; |
  | 426 |  |  |
  | 427 |  | } |
  | 428 |  |  |
  | 429 |  | } |
  | 430 |  |  |
  | 431 |  | if ($realFields == 0) { |
  | 432 |  |  |
  | 433 |  | #} Back |
  | 434 |  | $stage = 0; |
  | 435 |  | $stageError = \_\_( 'No fields were matched. You cannot import customers without at least one field mapped to a customer attribute.', 'zero-bs-crm' ); |
  | 436 |  |  |
  | 437 |  | } |
  | 438 |  |  |
  | 439 |  |  |
  | 440 |  | } |
  | 441 |  |  |
  | 442 |  |  |
  |  | 385 | } |
  | 443 | 386 |  |
  | 444 | 387 | switch ($stage){ |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L456) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L399) |  |
  | 456 | 399 | <form method="post" class="zbscrm-csv-map-form"> |
  | 457 | 400 | <input type="hidden" id="zbscrmcsvimpstage" name="zbscrmcsvimpstage" value="2" /> |
  | 458 |  | <input type="hidden" id="zbscrmcsvimpf" name="zbscrmcsvimpf" value="<?php echo $fileDetails['file']; ?>" /> |
  | 459 |  | <input type="hidden" id="zbscrmcsvimpfurl" name="zbscrmcsvimpfurl" value="<?php echo $fileDetails['url']; ?>" /> |
  |  | 401 | <input type="hidden" id="zbscrmcsvimpf" name="zbscrmcsvimpf" value="<?php echo esc\_attr( $file\_details['public\_name'] ); ?>" /> |
  | 460 | 402 | <?php wp\_nonce\_field( 'zbscrm\_csv\_import', 'zbscrmcsvimportnonce' ); ?> |
  | 461 | 403 |  |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L463) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L405) |  |
  | 463 | 405 | <div class="zbscrm-csv-map-ignorefirst"> |
  | 464 | 406 | <input type="checkbox" id="zbscrmcsvimpignorefirst" name="zbscrmcsvimpignorefirst" value="1" /> |
  | 465 |  | <label><?php \_e('Ignore first line of CSV file when running import.<br />(Use this if you have a "header line" in your CSV file.)','zero-bs-crm'); ?></label> |
  |  | 407 | <label for="zbscrmcsvimpignorefirst" ><?php \_e('Ignore first line of CSV file when running import.<br />(Use this if you have a "header line" in your CSV file.)','zero-bs-crm'); ?></label> |
  | 466 | 408 | </div> |
  | 467 | 409 | <hr /> |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L471) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L413) |  |
  | 471 | 413 | #} Cycle through each field and display a mapping option |
  | 472 | 414 | #} Using first line of import |
  | 473 |  | $firstLine = $~~csvLines~~[0]; |
  |  | 415 | $firstLine = $file\_details['csv\_data'][0]; |
  | 474 | 416 | $firstLineParts = explode(",",$firstLine); |
  | 475 | 417 |  |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L534) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L476) |  |
  | 534 | 476 | case 2: |
  | 535 | 477 |  |
  | 536 |  | ~~#}~~ Title |
  |  | 478 | // Title |
  | 537 | 479 | zeroBSCRM\_CSVImporterLitepages\_header('3. Run Import'); |
  | 538 | 480 |  |
  | 539 |  | ~~#}~~ Stolen from plugin-install.php?tab=upload |
  |  | 481 | // Stolen from plugin-install.php?tab=upload |
  | 540 | 482 | ?><div class="zbscrm-csvimport-wrap"> |
  | 541 | 483 | <h2>Complete Customer Import</h2> |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L546) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L488) |  |
  | 546 | 488 | <form method="post" enctype="multipart/form-data" class="zbscrm-csv-import-form"> |
  | 547 | 489 | <input type="hidden" id="zbscrmcsvimpstage" name="zbscrmcsvimpstage" value="3" /> |
  | 548 |  | <input type="hidden" id="zbscrmcsvimpf" name="zbscrmcsvimpf" value="<?php echo $csvFileLoca; ?>" /> |
  | 549 |  | <input type="hidden" id="zbscrmcsvimpfurl" name="zbscrmcsvimpfurl" value="<?php echo $csvFileURL; ?>" /> |
  | 550 |  | <?php wp\_nonce\_field( 'zbscrm\_csv\_import', 'zbscrmcsvimportnonce' ); ?> |
  | 551 |  | <h3>Import <?php echo zeroBSCRM\_prettifyLongInts($totalCSVLines); ?> Customers</h3> |
  | 552 |  | <hr /> |
  | 553 |  | <?php if ($ignoreFirstLine){ ?> |
  | 554 |  | <p style="font-size:16px;text-align:center;">Ignore first line of CSV <i class="fa fa-check"></i></p> |
  | 555 |  | <hr /> |
  | 556 |  | <input type="hidden" id="zbscrmcsvimpignorefirst" name="zbscrmcsvimpignorefirst" value="1" /> |
  | 557 |  | <?php } ?> |
  | 558 |  | <?php if ($realFields > 0){ ?> |
  | 559 |  | <p style="font-size:16px;text-align:center;">Map the following fields:</p> |
  | 560 |  | <?php |
  | 561 |  |  |
  | 562 |  | #} Cycle through each field |
  | 563 |  | #} Using first line of import |
  | 564 |  | $firstLine = $csvLines[0]; |
  | 565 |  | $firstLineParts = explode(",",$firstLine); |
  | 566 |  |  |
  | 567 |  | foreach ($fieldMap as $fieldID => $fieldTarget){ |
  | 568 |  |  |
  | 569 |  | $fieldTargetName = $fieldTarget; if (isset($zbsCustomerFields[$fieldTarget]) && isset($zbsCustomerFields[$fieldTarget][1]) && !empty($zbsCustomerFields[$fieldTarget][1])) $fieldTargetName = \_\_($zbsCustomerFields[$fieldTarget][1],'zero-bs-crm'); |
  | 570 |  |  |
  | 571 |  | if (in\_array($fieldTarget, array('secaddr1', 'secaddr2', 'seccity', 'seccounty', 'seccountry', 'secpostcode'))) $fieldTargetName .= ' ('.\_\_('2nd Address','zero-bs-crm').')'; |
  | 572 |  |  |
  | 573 |  | $fromStr = ''; |
  | 574 |  | if (isset($firstLineParts[$fieldID-1])) $fromStr = $firstLineParts[$fieldID-1]; |
  | 575 |  |  |
  | 576 |  | #} Clean user field - "" |
  | 577 |  | if (substr($fromStr,0,1) == '"' && substr($fromStr,-1) == '"'){ |
  | 578 |  | $fromStr = substr($fromStr,1,strlen($fromStr)-2); |
  | 579 |  | } |
  | 580 |  | #} Clean user field - '' |
  | 581 |  | if (substr($fromStr,0,1) == "'" && substr($fromStr,-1) == "'"){ |
  | 582 |  | $fromStr = substr($fromStr,1,strlen($fromStr)-2); |
  | 583 |  | } |
  | 584 |  |  |
  | 585 |  |  |
  | 586 |  |  |
  | 587 |  | ?> |
  | 588 |  | <input type="hidden" id="zbscrm-csv-fieldmap-<?php echo ($fieldID-1); ?>" name="zbscrm-csv-fieldmap-<?php echo ($fieldID-1); ?>" value="<?php echo $fieldTarget; ?>" /> |
  | 589 |  | <div class="zbscrm-impcsv-map"> |
  | 590 |  | <div class="zbscrm-impcsv-from"><?php if (!empty($fromStr)) echo '"'.$fromStr.'"'; else echo sprintf( \_\_( 'Field #%s', 'zero-bs-crm' ), $fieldID ); ?></div> |
  | 591 |  | <div class="zbscrm-impcsv-arrow"><?php if ($fieldTarget != "ignorezbs") echo '<i class="fa fa-long-arrow-right"></i>'; else echo '-'; ?></div> |
  | 592 |  | <div class="zbscrm-impcsv-to"><?php if ($fieldTarget != "ignorezbs") echo '"'.$fieldTargetName.'"'; else \_e( 'Ignore', 'zero-bs-crm' ); ?></div> |
  | 593 |  | </div><?php |
  | 594 |  |  |
  | 595 |  | } |
  | 596 |  |  |
  | 597 |  | ?> |
  | 598 |  | <hr /> |
  |  | 490 | <input type="hidden" id="zbscrmcsvimpf" name="zbscrmcsvimpf" value="<?php echo esc\_attr( $file\_details['public\_name'] ); ?>" /> |
  |  | 491 | <?php wp\_nonce\_field( 'zbscrm\_csv\_import', 'zbscrmcsvimportnonce' ); ?> |
  |  | 492 | <h3>Import <?php echo zeroBSCRM\_prettifyLongInts( $file\_details['num\_lines'] ); ?> Customers</h3> |
  |  | 493 | <hr /> |
  |  | 494 | <?php if ( $file\_details['ignore\_first\_line'] ){ ?> |
  |  | 495 | <p style="font-size:16px;text-align:center;">Ignore first line of CSV <i class="fa fa-check"></i></p> |
  |  | 496 | <hr /> |
  |  | 497 | <input type="hidden" id="zbscrmcsvimpignorefirst" name="zbscrmcsvimpignorefirst" value="1" /> |
  |  | 498 | <?php } ?> |
  |  | 499 | <p style="font-size:16px;text-align:center;">Map the following fields:</p> |
  |  | 500 | <?php |
  |  | 501 |  |
  |  | 502 | // Cycle through each field |
  |  | 503 | // Using first line of import |
  |  | 504 | $firstLine = $file\_details['csv\_data'][0]; |
  |  | 505 | $firstLineParts = explode(",",$firstLine); |
  |  | 506 |  |
  |  | 507 | foreach ( $file\_details['field\_map'] as $fieldID => $fieldTarget ) { |
  |  | 508 |  |
  |  | 509 | $fieldTargetName = $fieldTarget; if (isset($zbsCustomerFields[$fieldTarget]) && isset($zbsCustomerFields[$fieldTarget][1]) && !empty($zbsCustomerFields[$fieldTarget][1])) $fieldTargetName = \_\_($zbsCustomerFields[$fieldTarget][1],'zero-bs-crm'); |
  |  | 510 |  |
  |  | 511 | if (in\_array($fieldTarget, array('secaddr1', 'secaddr2', 'seccity', 'seccounty', 'seccountry', 'secpostcode'))) $fieldTargetName .= ' ('.\_\_('2nd Address','zero-bs-crm').')'; |
  |  | 512 |  |
  |  | 513 | $fromStr = ''; |
  |  | 514 | if (isset($firstLineParts[$fieldID-1])) $fromStr = $firstLineParts[$fieldID-1]; |
  |  | 515 |  |
  |  | 516 | // Clean user field - "" |
  |  | 517 | if (substr($fromStr,0,1) == '"' && substr($fromStr,-1) == '"'){ |
  |  | 518 | $fromStr = substr($fromStr,1,strlen($fromStr)-2); |
  |  | 519 | } |
  |  | 520 | // Clean user field - '' |
  |  | 521 | if (substr($fromStr,0,1) == "'" && substr($fromStr,-1) == "'"){ |
  |  | 522 | $fromStr = substr($fromStr,1,strlen($fromStr)-2); |
  |  | 523 | } |
  |  | 524 |  |
  |  | 525 | ?> |
  |  | 526 | <input type="hidden" id="zbscrm-csv-fieldmap-<?php echo ($fieldID-1); ?>" name="zbscrm-csv-fieldmap-<?php echo ($fieldID-1); ?>" value="<?php echo esc\_attr( $fieldTarget ); ?>" /> |
  |  | 527 | <div class="zbscrm-impcsv-map"> |
  |  | 528 | <div class="zbscrm-impcsv-from"><?php if (!empty($fromStr)) echo '"'.$fromStr.'"'; else echo sprintf( \_\_( 'Field #%s', 'zero-bs-crm' ), $fieldID ); ?></div> |
  |  | 529 | <div class="zbscrm-impcsv-arrow"><?php if ($fieldTarget != "ignorezbs") echo '<i class="fa fa-long-arrow-right"></i>'; else echo '-'; ?></div> |
  |  | 530 | <div class="zbscrm-impcsv-to"><?php if ($fieldTarget != "ignorezbs") echo '"'.$fieldTargetName.'"'; else \_e( 'Ignore', 'zero-bs-crm' ); ?></div> |
  |  | 531 | </div> |
  |  | 532 | <?php |
  |  | 533 |  |
  |  | 534 | } |
  |  | 535 |  |
  |  | 536 | ?> |
  |  | 537 | <hr /> |
  | 599 | 538 | <div style="text-align:center"> |
  | 600 | 539 | <button type="submit" name="csv-map-submit" id="csv-map-submit" class="button button-primary button-large" type="submit"><?php \_e( 'Run Import', 'zero-bs-crm' ); ?></button> |
  | 601 | 540 | </div> |
  | 602 |  | ~~<?php } else {~~ |
  | 603 |  | ~~#} No fields? wtf?~~ |
  | 604 |  | ~~?><button type="button" class="button button-primary button-large" onclick="javascript:window.location='?page=<?php echo $zbs->slugs['csvlite']; ?>';"><?php \_e('Back',"zero-bs-crm"); ?></button><?php~~ |
  | 605 |  | ~~} ?>~~ |
  | 606 | 541 | </form> |
  | 607 | 542 | </div> |
  | 608 |  | </div><?php |
  |  | 543 | </div> |
  |  | 544 | <?php |
  | 609 | 545 |  |
  | 610 | 546 | break; |
  |  | 547 |  |
  | 611 | 548 | case 3: |
  | 612 | 549 |  |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L620) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L557) |  |
  | 620 | 557 | <div class="zbscrm-final-stage"> |
  | 621 | 558 | <div class="zbscrm-import-log"> |
  | 622 |  | <div class="zbscrm-import-log-line"><?php \_e(~~"Loading CSV File: ","zero-bs-crm"); ?> <?php echo $csvFileName; ?> ...~~ <i class="fa fa-check"></i></div> |
  | 623 |  | <div class="zbscrm-import-log-line"><?php \_e(~~"Parsing rows...","zero-bs-crm"~~);?> <i class="fa fa-check"></i></div> |
  | 624 |  | <div class="zbscrm-import-log-line"><?php echo sprintf( \_\_(~~"Beginning Import of %s rows...","zero-bs-crm"), zeroBSCRM\_prettifyLongInts( count( $csvLines )~~ ) );?></div> |
  |  | 559 | <div class="zbscrm-import-log-line"><?php \_e( 'Loading CSV File...', 'zero-bs-crm' ); ?> <i class="fa fa-check"></i></div> |
  |  | 560 | <div class="zbscrm-import-log-line"><?php \_e( 'Parsing rows...', 'zero-bs-crm' );?> <i class="fa fa-check"></i></div> |
  |  | 561 | <div class="zbscrm-import-log-line"><?php echo sprintf( \_\_( 'Beginning Import of %s rows...', 'zero-bs-crm' ), zeroBSCRM\_prettifyLongInts( $file\_details['num\_lines'] ) );?></div> |
  | 625 | 562 | <?php |
  | 626 | 563 |  |
  | 627 | 564 | #} Cycle through |
  | 628 | 565 | $lineIndx = 0; $linesAdded = 0; $existingOverwrites = array(); $brStrs = array('<br>','<BR>','<br />','<BR />','<br/>','<BR/>'); |
  | 629 |  | ~~if (count($csvLines) > 0) foreach ($csvLines as $line)~~{ |
  |  | 566 | foreach ( $file\_details['csv\_data'] as $line ) { |
  | 630 | 567 |  |
  | 631 | 568 | #} Check line |
  | 632 |  | if (~~$lineIndx == 0 && $ignoreFirstLine~~){ |
  |  | 569 | if ( $lineIndx === 0 && $file\_details['ignore\_first\_line'] ){ |
  | 633 | 570 |  |
  | 634 | 571 | echo '<div class="zbscrm-import-log-line">' . \_\_( 'Skipping header row...', 'zero-bs-crm' ) . '<i class="fa fa-check"></i></div>'; |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L644) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L581) |  |
  | 644 | 581 | #} Catch first if there |
  | 645 | 582 |  |
  | 646 |  | foreach (~~$fieldMap as $fieldID => $fieldTarget)~~{ |
  |  | 583 | foreach ( $file\_details['field\_map'] as $fieldID => $fieldTarget ) { |
  | 647 | 584 |  |
  | 648 | 585 | #} id |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L691) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L628) |  |
  | 691 | 628 |  |
  | 692 | 629 | #} Try and find a unique id for this user |
  | 693 |  | $userUniqueID = md5($line.'#'.$~~csvFileName~~); |
  |  | 630 | $userUniqueID = md5($line.'#'.$file\_details['public\_name']); |
  | 694 | 631 |  |
  | 695 | 632 | #} 1st use email if there |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L727) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L664) |  |
  | 727 | 664 |  |
  | 728 | 665 | #} Line |
  | 729 |  | echo '<div class="zbscrm-import-log-line">'.~~esc\_html(~~ |
  |  | 666 | echo '<div class="zbscrm-import-log-line">'. |
  | 730 | 667 | sprintf( |
  | 731 | 668 | \_\_( 'Successfully added contact #<a href="%s" target="\_blank">%d</a>... <i class="fa fa-user"></i><span>+1</span>', 'zero-bs-crm' ), |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L733) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L670) |  |
  | 733 | 670 | $newCustID |
  | 734 | 671 | ) |
  | 735 |  | ~~)~~.'</div>'; |
  |  | 672 | .'</div>'; |
  | 736 | 673 |  |
  | 737 | 674 | } else { |
  | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2632084#L771) | […](/browser/zero-bs-crm/trunk/includes/ZeroBSCRM.CSVImporter.php?rev=2805282#L708) |  |
  | 771 | 708 | } |
  | 772 | 709 |  |
  | 773 |  |  |
  | 774 |  |  |
  | 775 |  | #} Delete file if flagged |
  | 776 |  | if (!$saveCopyOfCSVFile){ |
  | 777 |  |  |
  | 778 |  | if (file\_exists($csvFileLoca)) unlink($csvFileLoca); |
  | 779 |  | echo '<div class="zbscrm-import-log-line">' . \_\_( 'CSV Upload File Deleted...', 'zero-bs-crm' ) . '<i class="fa fa-check"></i></div>'; |
  | 780 |  |  |
  | 781 |  | } else { |
  | 782 |  | /\* not in lite |
  | 783 |  | #} Leave in place. |
  | 784 |  | #} In fact add to log :) |
  | 785 |  | if (isset($settings['csvimportlog']) && is\_array($settings['csvimportlog'])){ |
  | 786 |  | $existingLog = $settings['csvimportlog']; |
  | 787 |  | } else { |
  | 788 |  | $existingLog = array(); |
  | 789 |  | } |
  | 790 |  | array\_unshift($existingLog,array($csvFileLoca,$csvFileURL,$linesAdded.' lines imported '.date('F jS Y',time()).' at '.date('g:i a',time()))); |
  | 791 |  | $zeroBSCRM\_CSVImporterSettings->update('csvimportlog',$existingLog); |
  | 792 |  |  |
  | 793 |  | echo '<div class="zbscrm-import-log-line">Skipping deletion of CSV File (as per settings)... <i class="fa fa-check"></i></div>'; |
  | 794 |  | echo '<div class="zbscrm-import-log-line">Added CSV Import to log... <i class="fa fa-check"></i></div>'; |
  | 795 |  | \*/ |
  | 796 |  |  |
  |  | 710 | if ( $file\_details['file\_path'] ) { |
  |  | 711 | unlink($file\_details['file\_path']); |
  | 797 | 712 | } |
  |  | 713 | echo '<div class="zbscrm-import-log-line">' . \_\_( 'CSV Upload File Deleted...', 'zero-bs-crm' ) . '<i class="fa fa-check"></i></div>'; |
  | 798 | 714 |  |
  | 799 | 715 | ?> |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=2805282)
* [Zip Archive](?format=zip&new=2805282)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

