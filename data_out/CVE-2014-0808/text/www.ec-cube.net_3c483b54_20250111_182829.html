

JavaScript を有効にしてご利用下さい.

# [EC-CUBE®](/)

* [選ばれる理由](/reason/)
* [機能](/functions/)
* [決済](/alliance/)
* [導入事例](/cases/)
* [セキュリティ](/security/)
* [ストア](https://www.ec-cube.net/owners/)

[まずは相談する](/advisor/)

[ご利用中の方のお問い合わせはこちら](/support/)

* [資料請求](/document/)
* [ダウンロード](/download/)

# 脆弱性

## 認可回避の脆弱性

* 情報公開日：2014年 01月 21日
* 危険度：高
* 対象：Ver 2.11.0～2.12.2

```
-------------------------------------------------------------------
■脆弱性の種類
-------------------------------------------------------------------
認可回避の脆弱性

-------------------------------------------------------------------
■不具合が存在するEC-CUBEのバージョン
-------------------------------------------------------------------
EC-CUBE　2.11.0～2.12.2
	 2.11.0
	 2.11.1
	 2.11.2
	 2.11.3
	 2.11.4
	 2.11.5
	 2.12.0
	 2.12.1
	 2.12.2

-------------------------------------------------------------------
■修正方法について
-------------------------------------------------------------------

/data/class/pages/shopping/LC_Page_Shopping_Multiple.php::lfCheckError
に以下の変更を加えます。

━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
=================================================================================================================
▽2.12.0以上のバージョンは以下を参考下さい
-----------------------------------------------------------------------------------------------------------------
▽LC_Page_Shopping_Multiple.php::lfCheckError
221行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objCartSess = new SC_CartSession_Ex();

    $objFormParam->convParam();
    // 数量未入力は0に置換
    $objFormParam->setValue('quantity', $objFormParam->getValue('quantity', 0));

    $arrErr = $objFormParam->checkError();

    $arrParams = $objFormParam->getSwapArray();

    if (empty($arrErr)) {
        foreach ($arrParams as $index => $arrParam) {
            // 数量0で、お届け先を選択している場合
            if ($arrParam['quantity'] == 0 && !SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ 数量が0の場合、お届け先を入力できません。';;
            }
            // 数量の入力があり、お届け先を選択していない場合
            if ($arrParam['quantity'] > 0 && SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ お届け先が入力されていません。';
            }
        }
    }
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objCartSess = new SC_CartSession_Ex();
    $objQuery    =& SC_Query_Ex::getSingletonInstance();
    $objCustomer = new SC_Customer_Ex();

    $objFormParam->convParam();
    // 数量未入力は0に置換
    $objFormParam->setValue('quantity', $objFormParam->getValue('quantity', 0));

    $arrErr = $objFormParam->checkError();

    $arrParams = $objFormParam->getSwapArray();

    if (empty($arrErr)) {
        foreach ($arrParams as $index => $arrParam) {
            // 数量0で、お届け先を選択している場合
            if ($arrParam['quantity'] == 0 && !SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ 数量が0の場合、お届け先を入力できません。';;
            }
            // 数量の入力があり、お届け先を選択していない場合
            if ($arrParam['quantity'] > 0 && SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ お届け先が入力されていません。';
            }
        }
    }

    if ($objCustomer->isLoginSuccess(true) && SC_Utils_Ex::isBlank($arrErr)) {
        $deliv_check_flg = true;
        foreach ($arrParams as $index => $arrParam) {
            if ($arrParam['shipping'] != 0) {
                $deliv_check = $objQuery->count('dtb_other_deliv','other_deliv_id = ? AND customer_id = ?', array($arrParam['shipping'], $objCustomer->getValue('customer_id')));
                if ($deliv_check < 1) {
                    $deliv_check_flg = false;
                    break;
                }
            }
        }

        if (!$deliv_check_flg) {
            SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);
            SC_Response_Ex::actionExit();
        }
    }
=================================================================================================================
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
=================================================================================================================
▽2.11.2～2.11.5のバージョンは以下を参考下さい
-----------------------------------------------------------------------------------------------------------------
▽LC_Page_Shopping_Multiple.php::lfCheckError
210行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objCartSess = new SC_CartSession_Ex();

    $objFormParam->convParam();
    // 数量未入力は0に置換
    $objFormParam->setValue('quantity', $objFormParam->getValue('quantity', 0));

    $arrErr = $objFormParam->checkError();

    $arrParams = $objFormParam->getSwapArray();

    if (empty($arrErr)) {
        foreach ($arrParams as $index => $arrParam) {
            // 数量0で、お届け先を選択している場合
            if ($arrParam['quantity'] == 0 && !SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ 数量が0の場合、お届け先を入力できません。';;
            }
            // 数量の入力があり、お届け先を選択していない場合
            if ($arrParam['quantity'] > 0 && SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ お届け先が入力されていません。';
            }
        }
    }
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objCartSess = new SC_CartSession_Ex();
    $objQuery    =& SC_Query_Ex::getSingletonInstance();
    $objCustomer = new SC_Customer_Ex();

    $objFormParam->convParam();
    // 数量未入力は0に置換
    $objFormParam->setValue('quantity', $objFormParam->getValue('quantity', 0));

    $arrErr = $objFormParam->checkError();

    $arrParams = $objFormParam->getSwapArray();

    if (empty($arrErr)) {
        foreach ($arrParams as $index => $arrParam) {
            // 数量0で、お届け先を選択している場合
            if ($arrParam['quantity'] == 0 && !SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ 数量が0の場合、お届け先を入力できません。';;
            }
            // 数量の入力があり、お届け先を選択していない場合
            if ($arrParam['quantity'] > 0 && SC_Utils_Ex::isBlank($arrParam['shipping'])) {
                $arrErr['shipping'][$index] = '※ お届け先が入力されていません。';
            }
        }
    }

    if ($objCustomer->isLoginSuccess(true) && SC_Utils_Ex::isBlank($arrErr)) {
        $deliv_check_flg = true;
        foreach ($arrParams as $index => $arrParam) {
            if ($arrParam['shipping'] != 0) {
                $deliv_check = $objQuery->count('dtb_other_deliv','other_deliv_id = ? AND customer_id = ?', array($arrParam['shipping'], $objCustomer->getValue('customer_id')));
                if ($deliv_check < 1) {
                    $deliv_check_flg = false;
                    break;
                }
            }
        }

        if (!$deliv_check_flg) {
            SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);
            exit;
        }
    }
=================================================================================================================
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
=================================================================================================================
▽2.11.0～2.11.1のバージョンは以下を参考下さい
-----------------------------------------------------------------------------------------------------------------
▽LC_Page_Shopping_Multiple.php::lfCheckError
209行目付近を変更下さい。
-----------------------------------------------------------------------------------------------------------------
 変更前
-----------------------------------------------------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objFormParam->convParam();
    return $objFormParam->checkError();
}
-------------------------------------------------------------------

-------------------------------------------------------------------
 変更後
-------------------------------------------------------------------
function lfCheckError(&$objFormParam) {
    $objQuery    =& SC_Query_Ex::getSingletonInstance();
    $objCustomer = new SC_Customer_Ex();
    $objFormParam->convParam();
    $arrErr = $objFormParam->checkError();

    $arrParams = $objFormParam->getSwapArray(array('shipping'));

    if ($objCustomer->isLoginSuccess(true) && SC_Utils_Ex::isBlank($arrErr)) {
        $deliv_check_flg = true;
        foreach ($arrParams as $index => $arrParam) {
            if ($arrParam['shipping'] != 0) {
                $deliv_check = $objQuery->count('dtb_other_deliv','other_deliv_id = ? AND customer_id = ?', array($arrParam['shipping'], $objCustomer->getValue('customer_id')));
                if ($deliv_check < 1) {
                    $deliv_check_flg = false;
                    break;
                }
            }
        }

        if (!$deliv_check_flg) {
            SC_Utils_Ex::sfDispSiteError(PAGE_ERROR, '', true);
            exit;
        }
    }

    return $arrErr;
}
=================================================================================================================
```

1. [ホーム](/)
3. 脆弱性

 [PageTop](#wrap)

## EC-CUBE公式アドバイザーご相談窓口

* 他社のASPやパッケージとの違いを知りたい
* BtoCのサイトにBtoB機能を追加したい
* 何から手をつければよいかわからない
* オープンソースならではの注意事項を知りたい
* 自社にマッチした制作会社を探したい
* サイト制作だけでなく運営もサポートしてほしい

新規構築・リニューアル・取引先向けのWeb受発注システム（BtoB）や事業の拡大など、
今抱えている課題を解決する最適な業者探しを、アドバイザーがお手伝いします。

* [まずは相談する](/advisor/)
* [資料請求する](/document/)
* [ご利用中の方のお問い合わせはこちら](/support/)

* ## EC-CUBE導入をお考えの方

  + [選ばれる理由](/reason/)
  + [導入事例](/cases/)
  + [デモサイト](/demo/)
  + [機能一覧](/functions/)
  + [マニュアル](https://www.ec-cube.net/manual/ec-cube4/)
  + [ライセンス](/license/)
  + [メールマガジン登録](https://www.ec-cube.net/mail/)
  + [EC開業・運営ノウハウ](/know-how/)
* ## EC-CUBEをインストールしたい

  + [最新版ダウンロード](/download/)
  + [機能一覧](/functions/)
  + [開発情報](/developers/)
  + [レンタルサーバ](/server/)
* ## EC-CUBEをご利用中の方

  + [EC-CUBEメンバー登録](https://www.ec-cube.net/entry/)
  + [メンバーページログイン](https://www.ec-cube.net/mypage/login.php)
  + [オーナーズストア](https://www.ec-cube.net/owners/)
  + [セキュリティ対策](/security/)
  + [開発コミュニティ](https://xoops.ec-cube.net/)
* ## お問い合わせ

  + [サポート](/support/)
  + [よくあるご質問](https://support.ec-cube.net/hc/ja)
  + [お問い合わせ](https://www.ec-cube.net/contact/)
  + [ec-cube.coに関するお問い合わせ](https://www.ec-cube.net/product/co/support.php)
* ## ニュース・イベント

  + [ニュースリリース](https://www.ec-cube.net/newsrelease/)
  + [イベント](https://www.ec-cube.net/event/)
  + [X（旧Twitter）](https://x.com/EC_CUBE)
  + [Facebook](https://www.facebook.com/eccube/)
* ## パートナーについて

  + [パートナー登録（無料）](https://www.ec-cube.net/entry/partner.php)
  + [パートナーページログイン](https://www.ec-cube.net/partnerpage/login.php)
  + [パートナー制度のご案内](https://www.ec-cube.net/partnerpage/top.php)
  + [インテグレートパートナー 一覧](https://www.ec-cube.net/integrate/partner/)
  + [エバンジェリスト紹介](/evangelist/)
  + [EC-CUBEのロゴ](/brand-assets/)
* ## 決済サービス

  + [決済サービス一覧](/alliance/)
  + [EC-CUBEペイメントPlus](/lp/payment/)
  + [EC-CUBEペイメントPlus・BtoB向けプラン](/lp/epsilon-btob/)
  + [Amazon Pay](https://www.ec-cube.net/products/detail.php?product_id=2490)
* ## その他サービス

  + [基幹システム](/lp/core-system/)
  + [物流サービス一覧](/logistics/)
  + [サイトマップ](/sitemap/)

## [EC-CUBE®](/)

* [X](https://x.com/EC_CUBE)
* [Facebook](https://www.facebook.com/eccube/)
* [Wantedly](https://www.wantedly.com/companies/ec-cube)

* [個人情報の取扱いについて](/policy/)
* [個人情報保護方針](/policy/privacy/)
* [Cookieによる情報収集について](/policy/cookie/)
* [外的環境の把握](/policy/foreign-corporation/)
* [情報セキュリティ方針](/policy/security-policy/)

* [サイトマップ](/sitemap/)
* [運営会社](https://www.ec-cube.co.jp/)

© EC-CUBE CO.,LTD.

![](https://www.facebook.com/tr?id=736682659717992&ev=NoScript)

