<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Strict//EN"
    "http://www.w3.org/TR/xhtml1/DTD/xhtml1-strict.dtd">
<html xmlns="http://www.w3.org/1999/xhtml" xml:lang="en" lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
<meta name="description" content="Netatalk - Networking Apple Macintosh through Open Source" />
<meta
  name="keywords"
  content="Netatalk, AFP, AFP Server, AppleShare, File Server, PAP, Print Server, AppleTalk, Macintosh, Mac, OSX, OS X, OS9, OS 9, macOS, Apple II, IIGS, GS/OS, IIe" />
<meta name="language" content="EN" />
<meta name="publisher" content="netatalk.io" />
<meta name="robots" content="index,follow" />
<meta name="audience" content="all" />

<link rel="stylesheet" type="text/css" href="/css/site.css" />
<link rel="stylesheet" type="text/css" href="/css/printer.css" media="print" />
<link rel="alternate stylesheet" type="text/css" href="/css/printer.css" title="Printer" />
<link
  rel="copyright"
  title="GNU General Public License, version 2"
  href="https://www.gnu.org/licenses/old-licenses/gpl-2.0.html" />
<link rel="author" title="The Netatalk Development Team" href="http://netatalk.io" />
<link rel="help" href="/stable/htmldocs/" title="Documentation" />
<link rel="home" href="index.html" title="Netatalk Home" />
<link rel="home" href="https://github.com/Netatalk/netatalk" title="Netatalk GitHub" />
<link rel="bookmark" href="/stable/htmldocs/" title="Netatalk Documentation" />
<link rel="bookmark" href="https://github.com/Netatalk/netatalk/wiki" title="wiki" />
<link rel="bookmark" href="https://sourceforge.net/projects/netatalk/files/" title="Downloads" />
<link rel="icon" type="image/x-icon" href="/gfx/favicon.ico" />

<title>Netatalk - CVE-2024-38441</title>
</head>
<body>
<div id="header">
    <div id="logo"></div>
    <div id="menlinks">
        <a href="/" title="Return to Netatalk home">[main]</a>
        <a href="/docs" title="Netatalk Wiki">[wiki]</a>
        <a href="/documentation.html" title="Netatalk Manual">[documentation]</a>
        <a href="/download.html" title="Download Netatalk">[downloads]</a>
        <a href="/support.html" title="Support">[support]</a>
        <a href="/links.html" title="Netatalk related links">[links]</a>
        <img src="/gfx/end.gif" alt="" width="125" height="7" />
    </div>
</div>

<div id="header-print">
    <h1>netatalk.io</h1>
</div>

<div class="search">
    <h2>search netatalk.io</h2>
    <form method="get" action="https://www.google.com/search">
        <p>
            <input type="text" name="q" size="10" maxlength="255" value="" title="enter search text" />
            <input type="hidden" name="sitesearch" value="netatalk.io" />
            <input type="submit" name="btnG" value="Go" title="search netatalk.io" />
        </p>
    </form>
    <span class="italic">powered by Google</span>
</div>

<div id="navbars">
  <div class="navbar">
    <h2>current releases</h2>
    <ul>
      <li>
        <a
        title="download 4.0.8 xz compressed source code"
        href="https://github.com/Netatalk/netatalk/releases/download/netatalk-4-0-8/netatalk-4.0.8.tar.xz">
        Netatalk 4.0.8 (source code)
        </a>
      </li>
      <li>
        <a
        title="download 4.0.8 checksum"
        href="https://github.com/Netatalk/netatalk/releases/download/netatalk-4-0-8/netatalk-4.0.8.tar.xz.sha256sum">
        Netatalk 4.0.8 (sha256sum)
        </a>
      </li>
      <li>
        <a
        title="download 4.0.8 Webmin module"
        href="https://github.com/Netatalk/netatalk/releases/download/netatalk-4-0-8/netatalk-4.0.8.wbm.gz">
        Webmin Module
        </a>
      </li>
      <li>
        <a
        title="view 4.0.8 Release Notes"
        href="/4.0/ReleaseNotes4.0.8.html">
        Release Notes
        </a>
      </li>
    </ul>
  </div>
  <div class="navbar">
    <h2>netatalk manual</h2>
    <div><a href="/stable/htmldocs">Table of Contents</a></div>
    <ol>
      <li><a href="/stable/htmldocs/intro">Introduction</a></li>
      <li><a href="/stable/htmldocs/installation">Installation</a></li>
      <li><a href="/stable/htmldocs/configuration">Configuration</a></li>
      <li><a href="/stable/htmldocs/appletalk">AppleTalk</a></li>
      <li><a href="/stable/htmldocs/upgrade">Upgrading</a></li>
      <li><a href="/stable/htmldocs/man-pages">List of Manual Pages</a></li>
    </ol>
    <ol class="alpha">
      <li><a href="/stable/htmldocs/compile">Appendix: Compile</a></li>
      <li><a href="/stable/htmldocs/gpl">Appendix: License</a></li>
    </ol>
  </div>
  <div class="navbar">
    <h2>community</h2>
    <ul>
       <li><a title="Wiki" href="https://github.com/Netatalk/netatalk/wiki">Contribute to Wiki Pages</a></li>
       <li><a title="Discussions" href="https://github.com/Netatalk/netatalk/discussions">Participate in Discussions</a></li>
       <li><a title="Mailing Lists" href="https://sourceforge.net/p/netatalk/mailman/">Subscribe to Mailing Lists</a></li>
    </ul>
  </div>
  <div class="navbar">
    <h2>development</h2>
    <ul>
      <li><a title="Code Repository, GitHub" href="https://github.com/Netatalk/netatalk">Code Repository</a></li>
      <li><a title="Code Repository, GitLab" href="https://gitlab.com/netatalk-team/netatalk">GitLab Mirror</a></li>
      <li><a title="How to Contribute" href="https://netatalk.io/docs/Developer-Notes.html">
        How to Contribute</a></li>
      <li><a title="Static Analysis" href="https://sonarcloud.io/summary/overall?id=Netatalk_netatalk">
        Static Analysis by SonarQube</a></li>
    </ul>
  </div>
  <div class="navbar">
    <h2>continuous integration</h2>
    <p><a href="https://github.com/Netatalk/netatalk/actions/workflows/build.yml">
      <img alt="GitHub Continuous Integration Status" height="22"
         src="https://github.com/Netatalk/netatalk/actions/workflows/build.yml/badge.svg"/>
    </a></p>
    <p><a href="https://github.com/Netatalk/netatalk/actions/workflows/containers.yml">
      <img alt="GitHub Continuous Integration Status" height="22"
         src="https://github.com/Netatalk/netatalk/actions/workflows/containers.yml/badge.svg"/>
    </a></p>
  </div>
</div>
<div id="content">
<h1>Netatalk Security Advisory</h1>

<dl>
<dt><strong>Subject</strong></dt>
<dd>Heap out-of-bounds write in directory.c</dd>
<dt><strong>CVE ID</strong></dt>
<dd><a href="https://www.cve.org/CVERecord?id=CVE-2024-38441">CVE-2024-38441</a></dd>
<dt><strong>Date of Publishing</strong></dt>
<dd>2024/06/28</dd>
<dt><strong>Affected Netatalk Versions</strong></dt>
<dd>3.2.0<br>3.0.0 - 3.1.18<br>2.0.0 - 2.4.0</dd>
<dt><strong>Summary</strong></dt>
<dd>Lack of user input validation can lead to an out-of-bounds heap write</dd>
</dl>
<h2>Description</h2>
<p>This vulnerability arises due to a lack of validation for the length field after parsing user-provided data,
leading to an out-of-bounds heap write of one byte (\0). Under specific configurations,
this can result in an out-of-bounds write to the metadata of the next heap block,
potentially allowing an attacker to execute code in the root context.</p>

<p>The vulnerability is located in the FPMapName operation of Netatalk's afpd daemon,
in the afp_mapname function found in /etc/afp/directory.c. It may be triggered
when logging in with the Guest user authentication module.</p>

<p>The vulnerable code paths are thought to have been added leading up to the 2.0.0 release of Netatalk,
when the user login flow was rewritten to accommodate the AFP v3 protocol specification.</p>

<h2>Patch Availability</h2>
<p>Apply the patch with git hash
<a href="https://github.com/Netatalk/netatalk/commit/77b5d99007cfef4d73d76fd6f0c26584891608e5.diff">
77b5d99</a> to hotfix your local Netatalk deployment.</p>

<p>Additionally, Netatalk 2.4.1, 3.1.19, and 3.2.1 have been released which include the security patch.
Netatalk administrators are advised to upgrade to this version or apply the patch as soon as possible.</p>

<h2>CVSS Calculation</h2>
<p>CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L (7.3)</p>

<h2>Workaround</h2>
<p>Disable the uams_guest.so authentication module in your afp.conf file.</p>

<h2>Credits</h2>
<dl>
<dt>Vulnerability found and reported by:</dt>
<dd>flysoar</dd>
<dt>Patch developed by:</dt>
<dd>Daniel Markstedt of the Netatalk team</dd>
</dl>

<p>
<a href="../support.html">Go back to Support</a>
</p>

</div>
<div class="footer">
    <a href="https://validator.w3.org/check?uri=referer">
      <img src="https://www.w3.org/Icons/valid-xhtml10" alt="Valid XHTML 1.0 Strict" height="31" width="88" />
    </a>
    <a href="https://jigsaw.w3.org/css-validator/check?uri=referer">
      <img style="border:0;width:88px;height:31px"
      src="https://jigsaw.w3.org/css-validator/images/vcss" alt="Valid CSS!" />
    </a>
    <p>Netatalk and the Netatalk website are licensed under the <a href="/stable/htmldocs/gpl">GNU
    General Public License 2.0</a>.</p>
</div>
</body>
</html>
