=== Content from github.com_50642ec3_20250110_181850.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxibosignage%2Fxibo-cms%2Fsecurity%2Fadvisories%2FGHSA-xchw-pf2w-rpgq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fxibosignage%2Fxibo-cms%2Fsecurity%2Fadvisories%2FGHSA-xchw-pf2w-rpgq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=xibosignage%2Fxibo-cms)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[xibosignage](/xibosignage)
/
**[xibo-cms](/xibosignage/xibo-cms)**
Public

* [Notifications](/login?return_to=%2Fxibosignage%2Fxibo-cms) You must be signed in to change notification settings
* [Fork
  284](/login?return_to=%2Fxibosignage%2Fxibo-cms)
* [Star
   394](/login?return_to=%2Fxibosignage%2Fxibo-cms)

* [Code](/xibosignage/xibo-cms)
* [Pull requests
  6](/xibosignage/xibo-cms/pulls)
* [Actions](/xibosignage/xibo-cms/actions)
* [Security](/xibosignage/xibo-cms/security)
* [Insights](/xibosignage/xibo-cms/pulse)

Additional navigation options

* [Code](/xibosignage/xibo-cms)
* [Pull requests](/xibosignage/xibo-cms/pulls)
* [Actions](/xibosignage/xibo-cms/actions)
* [Security](/xibosignage/xibo-cms/security)
* [Insights](/xibosignage/xibo-cms/pulse)

# Session Hijacking via XSS attack in header and session grid

High

[dasgarner](/dasgarner)
published
GHSA-xchw-pf2w-rpgq
Apr 11, 2024

## Package

composer

Xibo CMS
([Composer](/advisories?query=ecosystem%3Acomposer))

## Affected versions

>=1.8.0, <=4.0.8

## Patched versions

>=3.3.10, >=4.0.9

## Description

### Impact

Some request headers are not correctly sanitised when stored in the session and display tables.

These headers can be used to inject a malicious script into the session page to exfiltrate session IDs and User Agents. These session IDs / User Agents can subsequently be used to hijack active sessions.

A malicious script can be injected into the display grid to exfiltrate information related to displays.

### Patches

**Users should upgrade to version 3.3.10 or 4.0.9 which fix this issue**. Customers who host their CMS with Xibo Signage have already received an upgrade or patch to resolve this issue regardless of the CMS version that they are running.

### Workarounds

Upgrading to a fixed version is necessary to remediate.

Patches are available for earlier versions of Xibo CMS that are out of security support:

* [2.3 patch](https://github.com/xibosignage/xibo-cms/commit/ebeccd000b51f00b9a25f56a2f252d6812ebf850.diff)
* [1.8 patch](https://github.com/dasgarner/xibo-cms/commit/a81044e6ccdd92cc967e34c125bd8162432e51bc.diff)

### References

[Xibo Signage Security Advisory](https://xibosignage.com/blog/security-advisory-2024-04)

### Credit

Thanks to [@Saadet-T](https://github.com/Saadet-T) (Saadet Elif Tokuoğlu) who discovered this issue.

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-29022

### Weaknesses

[CWE-80](/advisories?query=cwe%3A80) [CWE-117](/advisories?query=cwe%3A117)

### Credits

* [![@Saadet-T](https://avatars.githubusercontent.com/u/68515706?s=40&v=4)](/Saadet-T)
  [Saadet-T](/Saadet-T)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_197c0d47_20250110_181849.html ===
diff --git a/lib/Controller/Sessions.php b/lib/Controller/Sessions.php
index 2077860ab1..cd7d2e50dd 100644
--- a/lib/Controller/Sessions.php
+++ b/lib/Controller/Sessions.php
@@ -88,11 +88,11 @@ function grid()
$row->includeProperty('buttons');
// Edit
- $row->buttons[] = array(
+ /\*$row->buttons[] = array(
'id' => 'sessions\_button\_logout',
'url' => $this->urlFor('sessions.confirm.logout.form', ['id' => $row->sessionId]),
'text' => \_\_('Logout')
- );
+ );\*/
}
}
diff --git a/lib/Factory/SessionFactory.php b/lib/Factory/SessionFactory.php
index 96bb38ecb5..abc22c5bcc 100644
--- a/lib/Factory/SessionFactory.php
+++ b/lib/Factory/SessionFactory.php
@@ -150,7 +150,14 @@ public function query($sortOrder = null, $filterBy = [])
foreach ($this->getStore()->select($sql, $params) as $row) {
- $entries[] = $this->createEmpty()->hydrate($row, ['stringProperties' => ['sessionId']]);
+ $session = $this->createEmpty()->hydrate($row, [
+ 'stringProperties' => ['sessionId'],
+ 'intProperties' => ['isExpired']
+ ]);
+ $session->userAgent = htmlspecialchars($session->userAgent);
+ $session->remoteAddress = filter\_var($session->remoteAddress, FILTER\_VALIDATE\_IP);
+ $session->excludeProperty('sessionId');
+ $entries[] = $session;
}
// Paging
diff --git a/lib/Helper/Session.php b/lib/Helper/Session.php
index b977b82425..4632eecaef 100644
--- a/lib/Helper/Session.php
+++ b/lib/Helper/Session.php
@@ -170,7 +170,7 @@ function read($key)
$data = '';
$this->key = $key;
- $userAgent = substr($\_SERVER['HTTP\_USER\_AGENT'], 0, 253);
+ $userAgent = substr(htmlspecialchars($\_SERVER['HTTP\_USER\_AGENT']), 0, 253);
try {
$dbh = $this->getDb();
@@ -420,7 +420,7 @@ private function insertSession($key, $data, $lastAccessed, $expiry)
'lastAccessed' => date('Y-m-d H:i:s', $lastAccessed),
'userId' => $this->userId,
'expired' => ($this->expired) ? 1 : 0,
- 'useragent' => substr($\_SERVER['HTTP\_USER\_AGENT'], 0, 253),
+ 'useragent' => substr(htmlspecialchars($\_SERVER['HTTP\_USER\_AGENT']), 0, 253),
'remoteaddr' => $this->getIp()
];
@@ -469,7 +469,7 @@ private function getIp()
$clientIp = '';
$keys = array('X\_FORWARDED\_FOR', 'HTTP\_X\_FORWARDED\_FOR', 'CLIENT\_IP', 'REMOTE\_ADDR');
foreach ($keys as $key) {
- if (isset($\_SERVER[$key])) {
+ if (isset($\_SERVER[$key]) && filter\_var($\_SERVER[$key], FILTER\_VALIDATE\_IP) !== false) {
$clientIp = $\_SERVER[$key];
break;
}
diff --git a/lib/Xmds/Soap.php b/lib/Xmds/Soap.php
index 6e351fd447..b4716570d4 100644
--- a/lib/Xmds/Soap.php
+++ b/lib/Xmds/Soap.php
@@ -1772,7 +1772,7 @@ protected function getIp()
$keys = array('X\_FORWARDED\_FOR', 'HTTP\_X\_FORWARDED\_FOR', 'CLIENT\_IP', 'REMOTE\_ADDR');
foreach ($keys as $key) {
- if (isset($\_SERVER[$key])) {
+ if (isset($\_SERVER[$key]) && filter\_var($\_SERVER[$key], FILTER\_VALIDATE\_IP) !== false) {
$clientIp = $\_SERVER[$key];
break;
}


=== Content from xibosignage.com_71b4a93d_20250110_181850.html ===


[![Xibo Logo](/dist/img/header-logo.svg)](/)
[![Xibo Logo](/dist/img/header-logo.svg)](/)

* [Open Source](/open-source)
* [Pricing](/pricing)
  + [Pricing](/pricing)
  + [Free Trial](/free-trial)
* Solutions
  + [Content Management System](/cms)
  + [Xibo Cloud Hosting](/hosting)
  + [Xibo for Android](/xibo-for-android)
  + [Xibo for Linux](/xibo-for-linux)
  + [Xibo for Tizen](/xibo-for-tizen)
  + [Xibo for webOS](/xibo-for-webos)
  + [Xibo for Windows](/xibo-for-windows)
  + [Hardware](/hardware)
  + [Advertising](/advertising)
  + [Audience Reporting](/audience-reporting)
  + [Professional Services](/services)
* Industries
  + [Hospitality](/hospitality)
  + [Retail](/retail)
  + [Education](/education)
  + [Healthcare](/healthcare)
  + [Corporate](/corporate)
  + [Transport](/transport)
  + [Out of Home](/ooh)
* Resources
  + [Case Studies](/case-studies)
  + [Documentation](/docs)
  + [Features](/features)
  + [Help / FAQs](/help)
  + [Downloads](/downloads)
  + [About](/about-us)
  + [Training](/training)
* [Blog](/blog)
* [Partners](/become-a-partner)

pending changes

[Login](/login)
[Free Trial](/free-trial)

![Close](/dist/img/menu-close.svg)

pending changes

[Login](/login)
[Get your free trial](/free-trial)
![Search](/dist/img/header-search.svg)

![Search](/dist/img/header-search.svg)

![Search Close](/dist/img/search-close.svg)

[Back](/blog)

![Feature image](/img/blog/features/239f3ac7-2c65-48c6-8794-1d3e7667a167_CMS-blog-banner.png)
# Security Advisory - 2 issues affecting the CMS

* Dan
* 11 Apr 24

Share

We recommend everyone upgrade to 3.3.10 or 4.0.9 or latest release as soon as possible. All affected CMS instances on our Cloud platform have been fully patched. For further information on each advisory please see the CVE link below.

Thanks to [@Saadet-T](https://github.com/Saadet-T) (Saadet Elif Tokuoğlu) for responsibly disclosing these vulnerabilities and allowing us time to release 3.3.10/4.0.9.

Disclosure Timeline

16th March 16:00 - A draft security advisory was submitted by Saadet
17th March 16:00 - The issue was acknowledged and confirmed by Xibo
18th March 11:40 - Patches produced and applied to Xibo Cloud Hosting
18th March 13:38 - 3.3.10 released
18th March 15:01 - 4.0.9 released
11th April - Public disclosure

Issue #1 - Session Hijacking via XSS attack in header and session grid
Some request headers are not correctly sanitised when stored in the session and display tables.

These headers can be used to inject a malicious script into the session page to exfiltrate session IDs and User Agents. These session IDs / User Agents can subsequently be used to hijack active sessions.

A malicious script can be injected into the display grid to exfiltrate information related to displays.

Versions affected: **1.8.0 and later. Fixed in 3.3.10 and 4.0.9**

After extensive research we have determined that CMS instances hosted via our Cloud platform have not been exploited. All CMS instances hosted by Xibo of any version have been patched.

[CVE-2024-29022](https://github.com/xibosignage/xibo-cms/security/advisories/GHSA-xchw-pf2w-rpgq)

Issue #2 - Session Hijacking via token exposure on the session page
Session tokens are exposed in the return of session search API call on the sessions page. Subsequently they can be exfiltrated and used to hijack a session.

Users must be granted access to the session page, or be a super admin.

Versions affected: **1.8.0 and later. Fixed in 3.3.10 and 4.0.9**

After extensive research we have determined that CMS instances hosted via our Cloud platform have not been exploited. All CMS instances hosted by Xibo of any version have been patched.

[CVE-2024-29023](https://github.com/xibosignage/xibo-cms/security/advisories/GHSA-xmc6-cfq5-hg39)

## More

Read more from the blog

[![View Post](/img/blog/features/8b85b5d3-d9ed-4c57-9936-c3e2c9cc063f_Android-Blog-Banner.png)](/blog/xibo-for-android-v4-r406)

#### [Xibo for Android v4 R406](/blog/xibo-for-android-v4-r406)

We are pleased to announce Xibo for Android v4 R405. This release fixes 2 issues.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/xibo-for-android-v4-r406)

[![View Post](/img/blog/features/3acedf1c-2cc4-4ce1-868a-609ae416ed67_Windows-Blog-Banner.png)](/blog/xibo-for-windows-v4-r404)

#### [Xibo for Windows v4 R404](/blog/xibo-for-windows-v4-r404)

We are pleased to announce Xibo for Windows v4 R404. This release fixes 2 issues.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/xibo-for-windows-v4-r404)

[![View Post](/img/blog/features/24279f5a-6390-41a6-80a1-79cd86f0475c_Advertise-Here---2-.png)](/blog/top-7-retail-digital-signage-trends-in-2025)

#### [Top 7 Retail Digital Signage Trends in 2025](/blog/top-7-retail-digital-signage-trends-in-2025)

Learn more about 2025âs retail digital signage trends. Whether retail media networks or AI-driven retail media planning, the upcoming year has a lot in store for retailers.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/top-7-retail-digital-signage-trends-in-2025)

## More

Read more from the blog

[![View Post](/img/blog/features/8b85b5d3-d9ed-4c57-9936-c3e2c9cc063f_Android-Blog-Banner.png)](/blog/xibo-for-android-v4-r406)

#### [Xibo for Android v4 R406](/blog/xibo-for-android-v4-r406)

We are pleased to announce Xibo for Android v4 R405. This release fixes 2 issues.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/xibo-for-android-v4-r406)

[![View Post](/img/blog/features/3acedf1c-2cc4-4ce1-868a-609ae416ed67_Windows-Blog-Banner.png)](/blog/xibo-for-windows-v4-r404)

#### [Xibo for Windows v4 R404](/blog/xibo-for-windows-v4-r404)

We are pleased to announce Xibo for Windows v4 R404. This release fixes 2 issues.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/xibo-for-windows-v4-r404)

[![View Post](/img/blog/features/24279f5a-6390-41a6-80a1-79cd86f0475c_Advertise-Here---2-.png)](/blog/top-7-retail-digital-signage-trends-in-2025)

#### [Top 7 Retail Digital Signage Trends in 2025](/blog/top-7-retail-digital-signage-trends-in-2025)

Learn more about 2025âs retail digital signage trends. Whether retail media networks or AI-driven retail media planning, the upcoming year has a lot in store for retailers.

[![View Post](/dist/img/btn-arrow-right.svg)](/blog/top-7-retail-digital-signage-trends-in-2025)

[![Xibo Logo](/dist/img/footer-logo.svg)](/)

#### Solutions

* [Free Trial](/free-trial)
* [Content Management System](/cms)
* [Xibo Cloud Hosting](/hosting)
* [Xibo for Android](/xibo-for-android)
* [Xibo for Linux](/xibo-for-linux)
* [Xibo for Tizen](/xibo-for-tizen)
* [Xibo for webOS](/xibo-for-webos)
* [Xibo for Windows](/xibo-for-windows)
* [Advertising](/advertising)
* [Hardware](/hardware)
* [Professional Services](/services)
* [Pricing](/pricing)
* [Feature list](/features)

#### Help & Resources

* [Help / FAQs](/help)
* [User Manual](/manual/en/)
* [Downloads](/downloads)
* [Knowledge Base](https://community.xibo.org.uk/c/kb)
* [Community](https://community.xibo.org.uk)
* [My Account](/login)
* [Blog](/blog)
* [Case Studies](/case-studies)
* [Service Status](https://xibosignage.github.io/status-page/)
* [Training](/training)
* [Contact Us](/contact)

#### Company

* [About us](/about-us)
* [Become a partner](/become-a-partner)
* [Terms](/terms)
* [EULA](/eula)
* [Privacy Policy](/privacy)
* [Data Processing Agreement](/dpa)

Â©  [Xibo Signage](https://xibosignage.com)&nbsp2025 |
Xibo Signage Ltd, Curtis House, 34 Third Avenue, Hove, England, BN3 2PD |
Company number: 07811749 |
VAT number: GB201808739

Xibo Signage Netherlands BV, Blaak 520, 3011TA, Rotterdam, Netherlands |
Kvk: 80891101 |
VAT number: NL861840586B01

##### Search Results

![Xibo Logo](/dist/img/header-logo.svg)
![Close](/dist/img/signup-close.svg)



=== Content from github.com_1e33102f_20250110_181849.html ===
diff --git a/lib/Controller/Sessions.php b/lib/Controller/Sessions.php
index 2077860ab1..cd7d2e50dd 100644
--- a/lib/Controller/Sessions.php
+++ b/lib/Controller/Sessions.php
@@ -88,11 +88,11 @@ function grid()
$row->includeProperty('buttons');
// Edit
- $row->buttons[] = array(
+ /\*$row->buttons[] = array(
'id' => 'sessions\_button\_logout',
'url' => $this->urlFor('sessions.confirm.logout.form', ['id' => $row->sessionId]),
'text' => \_\_('Logout')
- );
+ );\*/
}
}
diff --git a/lib/Factory/SessionFactory.php b/lib/Factory/SessionFactory.php
index 96bb38ecb5..abc22c5bcc 100644
--- a/lib/Factory/SessionFactory.php
+++ b/lib/Factory/SessionFactory.php
@@ -150,7 +150,14 @@ public function query($sortOrder = null, $filterBy = [])
foreach ($this->getStore()->select($sql, $params) as $row) {
- $entries[] = $this->createEmpty()->hydrate($row, ['stringProperties' => ['sessionId']]);
+ $session = $this->createEmpty()->hydrate($row, [
+ 'stringProperties' => ['sessionId'],
+ 'intProperties' => ['isExpired']
+ ]);
+ $session->userAgent = htmlspecialchars($session->userAgent);
+ $session->remoteAddress = filter\_var($session->remoteAddress, FILTER\_VALIDATE\_IP);
+ $session->excludeProperty('sessionId');
+ $entries[] = $session;
}
// Paging
diff --git a/lib/Helper/Session.php b/lib/Helper/Session.php
index 4aad4e3138..ef6038ba7f 100644
--- a/lib/Helper/Session.php
+++ b/lib/Helper/Session.php
@@ -170,7 +170,7 @@ function read($key)
$data = '';
$this->key = $key;
- $userAgent = substr($\_SERVER['HTTP\_USER\_AGENT'], 0, 253);
+ $userAgent = substr(htmlspecialchars($\_SERVER['HTTP\_USER\_AGENT']), 0, 253);
try {
$dbh = $this->getDb();
@@ -420,7 +420,7 @@ private function insertSession($key, $data, $lastAccessed, $expiry)
'lastAccessed' => date('Y-m-d H:i:s', $lastAccessed),
'userId' => $this->userId,
'expired' => ($this->expired) ? 1 : 0,
- 'useragent' => substr($\_SERVER['HTTP\_USER\_AGENT'], 0, 253),
+ 'useragent' => substr(htmlspecialchars($\_SERVER['HTTP\_USER\_AGENT']), 0, 253),
'remoteaddr' => $this->getIp()
];
@@ -469,7 +469,7 @@ private function getIp()
$clientIp = '';
$keys = array('X\_FORWARDED\_FOR', 'HTTP\_X\_FORWARDED\_FOR', 'CLIENT\_IP', 'REMOTE\_ADDR');
foreach ($keys as $key) {
- if (isset($\_SERVER[$key])) {
+ if (isset($\_SERVER[$key]) && filter\_var($\_SERVER[$key], FILTER\_VALIDATE\_IP) !== false) {
$clientIp = $\_SERVER[$key];
break;
}
diff --git a/lib/Xmds/Soap.php b/lib/Xmds/Soap.php
index 7f7d225c2e..4efb8bcd2a 100644
--- a/lib/Xmds/Soap.php
+++ b/lib/Xmds/Soap.php
@@ -2068,7 +2068,7 @@ protected function getIp()
$keys = array('X\_FORWARDED\_FOR', 'HTTP\_X\_FORWARDED\_FOR', 'CLIENT\_IP', 'REMOTE\_ADDR');
foreach ($keys as $key) {
- if (isset($\_SERVER[$key])) {
+ if (isset($\_SERVER[$key]) && filter\_var($\_SERVER[$key], FILTER\_VALIDATE\_IP) !== false) {
$clientIp = $\_SERVER[$key];
break;
}

