

| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [mupdf.git](/cgi-bin/cgit.cgi/mupdf.git/ "mupdf.git") | 1.18.x 1.19.x 1.20.x 1.21.x 1.22.x 1.23.x 1.24.x 1.25.x android-muso android-muso-signing android-openjpeg-2.3.1 css fontconfig java-empty-store lcms lcms2 line\_art\_filter master muso muso-3.9-release muso-temporary-hack objc-openjpeg-2.3.1 release-1.10a release\_1.8 so so-tess2 stext-flags win-openjpeg-2.3.1 winRT winphone |
| --- | --- | --- |
| MuPDF library | Chris Liddell |

| [summary](/cgi-bin/cgit.cgi/mupdf.git/)[refs](/cgi-bin/cgit.cgi/mupdf.git/refs/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)[log](/cgi-bin/cgit.cgi/mupdf.git/log/)[tree](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)[commit](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)[diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sebastian Rasmussen <sebras@gmail.com> | 2012-08-04 14:11:20 +0200 |
| --- | --- | --- |
| committer | Sebastian Rasmussen <sebras@gmail.com> | 2012-08-06 13:53:57 +0200 |
| commit | [f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9) ([patch](/cgi-bin/cgit.cgi/mupdf.git/patch/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)) | |
| tree | [53373f0b4a0dc9efa35620fb39be15b63be96d2d](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9) | |
| parent | [171deea598ec88f370e31b0d1b58d841277eceb1](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=171deea598ec88f370e31b0d1b58d841277eceb1) ([diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9&id2=171deea598ec88f370e31b0d1b58d841277eceb1)) | |

Handle invalid obj/gen numbers when repairing pdfsOut of range object numbers cause the repaired object to be
ignored. Out of range generation numbers are clamped to the
permitted range.
[Diffstat](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)

| -rw-r--r-- | [pdf/pdf\_repair.c](/cgi-bin/cgit.cgi/mupdf.git/diff/pdf/pdf_repair.c?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9) | 26 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 26 insertions, 0 deletions

| diff --git a/pdf/pdf\_repair.c b/pdf/pdf\_repair.cindex 0874c2f8c..df8d81f96 100644--- a/[pdf/pdf\_repair.c](/cgi-bin/cgit.cgi/mupdf.git/tree/pdf/pdf_repair.c?id=171deea598ec88f370e31b0d1b58d841277eceb1)+++ b/[pdf/pdf\_repair.c](/cgi-bin/cgit.cgi/mupdf.git/tree/pdf/pdf_repair.c?id=f919270b6a732ff45c3ba2d0c105e2b39e9c9bc9)@@ -3,6 +3,9 @@  /\* Scan file for objects and reconstruct xref table \*/ +/\* Define in PDF 1.7 to be 8388607, but mupdf is more lenient. \*/+#define MAX\_OBJECT\_NUMBER (10 << 20)+ struct entry { int num;@@ -170,6 +173,16 @@ pdf\_repair\_obj\_stm(pdf\_document \*xref, int num, int gen) fz\_throw(ctx, "corrupt object stream (%d %d R)", num, gen);  n = buf.i;+ if (n < 0)+ {+ fz\_warn(ctx, "ignoring object with invalid object number (%d %d R)", n, i);+ continue;+ }+ else if (n > MAX\_OBJECT\_NUMBER)+ {+ fz\_warn(ctx, "ignoring object with invalid object number (%d %d R)", n, i);+ continue;+ } if (n >= xref->len) pdf\_resize\_xref(xref, n + 1); @@ -299,6 +312,19 @@ pdf\_repair\_xref(pdf\_document \*xref, pdf\_lexbuf \*buf) break; } + if (num < 0)+ {+ fz\_warn(ctx, "ignoring object with invalid object number (%d %d R)", num, gen);+ continue;+ }+ else if (num > MAX\_OBJECT\_NUMBER)+ {+ fz\_warn(ctx, "ignoring object with invalid object number (%d %d R)", num, gen);+ continue;+ }++ gen = fz\_clampi(gen, 0, 65535);+ if (listlen + 1 == listcap) { listcap = (listcap \* 3) / 2; |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 11:38:30 +0000

