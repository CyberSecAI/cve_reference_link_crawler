=== Content from github.com_dc6cdf15_20250108_110643.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2FOpenSearch%2Fsecurity%2Fadvisories%2FGHSA-w3rx-m34v-wrqx)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2FOpenSearch%2Fsecurity%2Fadvisories%2FGHSA-w3rx-m34v-wrqx)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=opensearch-project%2FOpenSearch)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensearch-project](/opensearch-project)
/
**[OpenSearch](/opensearch-project/OpenSearch)**
Public

* [Notifications](/login?return_to=%2Fopensearch-project%2FOpenSearch) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fopensearch-project%2FOpenSearch)
* [Star
   10k](/login?return_to=%2Fopensearch-project%2FOpenSearch)

* [Code](/opensearch-project/OpenSearch)
* [Issues
  1.8k](/opensearch-project/OpenSearch/issues)
* [Pull requests
  179](/opensearch-project/OpenSearch/pulls)
* [Actions](/opensearch-project/OpenSearch/actions)
* [Projects
  3](/opensearch-project/OpenSearch/projects)
* [Wiki](/opensearch-project/OpenSearch/wiki)
* [Security](/opensearch-project/OpenSearch/security)
* [Insights](/opensearch-project/OpenSearch/pulse)

Additional navigation options

* [Code](/opensearch-project/OpenSearch)
* [Issues](/opensearch-project/OpenSearch/issues)
* [Pull requests](/opensearch-project/OpenSearch/pulls)
* [Actions](/opensearch-project/OpenSearch/actions)
* [Projects](/opensearch-project/OpenSearch/projects)
* [Wiki](/opensearch-project/OpenSearch/wiki)
* [Security](/opensearch-project/OpenSearch/security)
* [Insights](/opensearch-project/OpenSearch/pulse)

# Incorrect Error Handling Allowed Partial File Reads Over REST API

Moderate

[CEHENKLE](/CEHENKLE)
published
GHSA-w3rx-m34v-wrqx
Nov 15, 2022

## Package

OpenSearch

## Affected versions

<1.3.7; <2.4.0

## Patched versions

>=1.3.7; >=2.4.0

## Description

Affected versions

1.0.0-1.3.6 and 2.0.0-2.3.0

Patched versions

OpenSearch 2.4.0 and 1.3.7

Impact

OpenSearch allows users to specify a local file when defining text analyzers to process data for text analysis. An issue in the implementation of this feature allows certain specially crafted queries to return a response containing the first line of text from arbitrary files. The list of potentially impacted files is limited to text files with read permissions allowed in the Java Security Manager policy configuration.

Patches

OpenSearch version 1.3.7 and 2.4.0 contain a fix for this issue.

For more information

If you have any questions or comments about this advisory, please contact AWS/Amazon Security via our issue reporting page (<https://aws.amazon.com/security/vulnerability-reporting/>) or directly via email to aws-security@amazon.com. Please do not create a public GitHub issue.

### Severity

Moderate

5.7

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
Low

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
None

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.0/AV:N/AC:L/PR:L/UI:R/S:U/C:H/I:N/A:N

### CVE ID

CVE-2022-41917

### Weaknesses

No CWEs

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_477b7644_20250108_110643.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2FOpenSearch%2Fcommit%2F6d20423f5920745463b1abc5f1daf6a786c41aa0)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2FOpenSearch%2Fcommit%2F6d20423f5920745463b1abc5f1daf6a786c41aa0)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=opensearch-project%2FOpenSearch)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[opensearch-project](/opensearch-project)
/
**[OpenSearch](/opensearch-project/OpenSearch)**
Public

* [Notifications](/login?return_to=%2Fopensearch-project%2FOpenSearch) You must be signed in to change notification settings
* [Fork
  1.9k](/login?return_to=%2Fopensearch-project%2FOpenSearch)
* [Star
   10k](/login?return_to=%2Fopensearch-project%2FOpenSearch)

* [Code](/opensearch-project/OpenSearch)
* [Issues
  1.8k](/opensearch-project/OpenSearch/issues)
* [Pull requests
  179](/opensearch-project/OpenSearch/pulls)
* [Actions](/opensearch-project/OpenSearch/actions)
* [Projects
  3](/opensearch-project/OpenSearch/projects)
* [Wiki](/opensearch-project/OpenSearch/wiki)
* [Security](/opensearch-project/OpenSearch/security)
* [Insights](/opensearch-project/OpenSearch/pulse)

Additional navigation options

* [Code](/opensearch-project/OpenSearch)
* [Issues](/opensearch-project/OpenSearch/issues)
* [Pull requests](/opensearch-project/OpenSearch/pulls)
* [Actions](/opensearch-project/OpenSearch/actions)
* [Projects](/opensearch-project/OpenSearch/projects)
* [Wiki](/opensearch-project/OpenSearch/wiki)
* [Security](/opensearch-project/OpenSearch/security)
* [Insights](/opensearch-project/OpenSearch/pulse)

## Commit

[Permalink](/opensearch-project/OpenSearch/commit/6d20423f5920745463b1abc5f1daf6a786c41aa0)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request from [GHSA-w3rx-m34v-wrqx](https://github.com/opensearch-project/OpenSearch/security/advisories/GHSA-w3rx-m34v-wrqx "GHSA-w3rx-m34v-wrqx")

[Browse files](/opensearch-project/OpenSearch/tree/6d20423f5920745463b1abc5f1daf6a786c41aa0)
Browse the repository at this point in the history

```
* Fix error handling while reading analyzer mapping rules

Add new parseWordList method that takes a parser as a parameter. It reads custom rules from settings or a file, parses and handles errors. Make error messages less verbose for rules files outside config directory.

Signed-off-by: Rabi Panda <adnapibar@gmail.com>

* Add CHANGELOG.md

Signed-off-by: Rabi Panda <adnapibar@gmail.com>

Signed-off-by: Rabi Panda <adnapibar@gmail.com>
```

* Loading branch information

[![@adnapibar](https://avatars.githubusercontent.com/u/2838888?s=40&v=4)](/adnapibar)

[adnapibar](/opensearch-project/OpenSearch/commits?author=adnapibar "View all commits by adnapibar")
authored
Nov 8, 2022

1 parent
[3ffa46a](/opensearch-project/OpenSearch/commit/3ffa46ac3fc149b13490de6bc1b01413530a2791)

commit 6d20423

 Show file tree

 Hide file tree

Showing
**25 changed files**
with
**393 additions**
and
**154 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* CHANGELOG.md
  [CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed)
* modules/analysis-common/src

  + main/java/org/opensearch/analysis/common

    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/HyphenationCompoundWordTokenFilterFactory.java
      [HyphenationCompoundWordTokenFilterFactory.java](#diff-2a666be1df70c88aa91f0d239e8b7dfaf7345460bf859945e61e00836631b0d8)
    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/MappingCharFilterFactory.java
      [MappingCharFilterFactory.java](#diff-48415811b2148d666c95d55d1aa537cd55830f1fcafe26598119ac651b98ba6a)
    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/StemmerOverrideTokenFilterFactory.java
      [StemmerOverrideTokenFilterFactory.java](#diff-5dffb53dbe0993fbb701220a2b04e3448ade02e109754307815cfda6d66fcbd6)
    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/SynonymTokenFilterFactory.java
      [SynonymTokenFilterFactory.java](#diff-3a7a8192224bf414564936feb95e752cab2e2291ca02b9e2cb75195552a1d10b)
    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java
      [WordDelimiterGraphTokenFilterFactory.java](#diff-36065d6b7dc55ec47b2816e6b3f0a3b2300ff0d0a9f72fda01ea7b597c049340)
    - modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterTokenFilterFactory.java
      [WordDelimiterTokenFilterFactory.java](#diff-c9e58e0a10323156a89196e64edc5ed3902e4a3273502db9948f2fa7b49d0bb0)
  + test/java/org/opensearch/analysis/common

    - modules/analysis-common/src/test/java/org/opensearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java
      [BaseWordDelimiterTokenFilterFactoryTestCase.java](#diff-d018d6a6fb9d05275dcd9a0f73adc5645034d2302babe71eb1751fc4e9f06061)
    - modules/analysis-common/src/test/java/org/opensearch/analysis/common/MappingCharFilterFactoryTests.java
      [MappingCharFilterFactoryTests.java](#diff-3813d74bb843d4c7ebe1f5954a338b13539b3fab1238b5c264ea19cea51fce71)
    - modules/analysis-common/src/test/java/org/opensearch/analysis/common/StemmerOverrideTokenFilterFactoryTests.java
      [StemmerOverrideTokenFilterFactoryTests.java](#diff-cf94b5ede4564afe2fb02cf6e043168ef40ae71229198f9f544541ad33fc6988)
    - modules/analysis-common/src/test/java/org/opensearch/analysis/common/SynonymsAnalysisTests.java
      [SynonymsAnalysisTests.java](#diff-797b44fe75dc5aeac45271c7f7906eab6386d6fca635df087eacc9b7a8d4d699)
* plugins

  + analysis-icu/src/main/java/org/opensearch/index/analysis

    - plugins/analysis-icu/src/main/java/org/opensearch/index/analysis/IcuCollationTokenFilterFactory.java
      [IcuCollationTokenFilterFactory.java](#diff-198c11ac18b22003ea05e7962d7aac9ec1c2325566a673c0ca054b3bed8a3fff)
  + analysis-kuromoji/src

    - main/java/org/opensearch/index/analysis

      * plugins/analysis-kuromoji/src/main/java/org/opensearch/index/analysis/KuromojiPartOfSpeechFilterFactory.java
        [KuromojiPartOfSpeechFilterFactory.java](#diff-5f709ae07e85a1a41e5a1a9eb62c654e9e5f8a8229621c0e11a930cce3daa13e)
      * plugins/analysis-kuromoji/src/main/java/org/opensearch/index/analysis/KuromojiTokenizerFactory.java
        [KuromojiTokenizerFactory.java](#diff-581b8486162b77c792e4e9b364408ad847dde9db01214eefc628968537060e01)
    - test/java/org/opensearch/index/analysis

      * plugins/analysis-kuromoji/src/test/java/org/opensearch/index/analysis/KuromojiAnalysisTests.java
        [KuromojiAnalysisTests.java](#diff-33762bd4533f491b49d40c27f546b3c5f1c55701b120b31acf1e1f7874171416)
  + analysis-nori/src/main/java/org/opensearch/index/analysis

    - plugins/analysis-nori/src/main/java/org/opensearch/index/analysis/NoriAnalyzerProvider.java
      [NoriAnalyzerProvider.java](#diff-e20be2c846ad90e648974bd5c03951c076218e844d1d7b648facc48ff6449627)
    - plugins/analysis-nori/src/main/java/org/opensearch/index/analysis/NoriPartOfSpeechStopFilterFactory.java
      [NoriPartOfSpeechStopFilterFactory.java](#diff-e43aba8390837b6a1e05482070236136a4cf7a2599e3fc353bb3b16ec35155c4)
    - plugins/analysis-nori/src/main/java/org/opensearch/index/analysis/NoriTokenizerFactory.java
      [NoriTokenizerFactory.java](#diff-083f5183e6d632b7e0538549090887b5258bcffd4a0382b234976a0f2e283ad7)
* server/src

  + main/java/org/opensearch

    - index/analysis

      * server/src/main/java/org/opensearch/index/analysis/Analysis.java
        [Analysis.java](#diff-66fd0e899323a3fc67dbde5481aa5a36c98cb683f8b1f642252217ab44c0a13d)
      * server/src/main/java/org/opensearch/index/analysis/CustomMappingRuleParser.java
        [CustomMappingRuleParser.java](#diff-00fd59f3795dce97cc61a191d1d66df83ab4c2141c02911d409ea79d586c6ebf)
      * server/src/main/java/org/opensearch/index/analysis/MappingRule.java
        [MappingRule.java](#diff-b0773e2002bca75e1713b02797e519a37f4b5a7d92a090d89cab99eeb7040671)
    - indices/analysis

      * server/src/main/java/org/opensearch/indices/analysis/HunspellService.java
        [HunspellService.java](#diff-7cabcd152e9c42550280358bc68ebd3effd5e148a25552bc8d710ed375e8ddaf)
  + test/java/org/opensearch

    - index/analysis

      * server/src/test/java/org/opensearch/index/analysis/AnalysisTests.java
        [AnalysisTests.java](#diff-032b5654ecb28d97726c7df5ea7b67014e5824f48413a33e9500db3251561f1b)
    - indices

      * analysis

        + server/src/test/java/org/opensearch/indices/analysis/AnalysisModuleTests.java
          [AnalysisModuleTests.java](#diff-2792ebf36c08755a10b46e4a2fecb9994533d01d7a76b9959630797e6d5e2a68)
      * analyze

        + server/src/test/java/org/opensearch/indices/analyze/HunspellServiceTests.java
          [HunspellServiceTests.java](#diff-1878b44a67a5dd601339582f701f4d2f11dac662aaedd3a549e5f0c84ec579e0)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[CHANGELOG.md](#diff-06572a96a58dc510037d5efa622f9bec8519bc1beab13c9f251e97e657a9d4ed "CHANGELOG.md")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/CHANGELOG.md)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |

| Expand Up | | @@ -212,6 +212,7 @@ Inspired from [Keep a Changelog](https://keepachangelog.com/en/1.0.0/) |
|  |  | - Fix flaky test ResourceAwareTasksTests on Windows ([#5077](https://github.com/opensearch-project/OpenSearch/pull/5077)) |
|  |  | - Length calculation for block based fetching ([#5055](https://github.com/opensearch-project/OpenSearch/pull/5055)) |
|  |  | - [Segment Replication] Fix for AlreadyClosedException for engine ([#4743](https://github.com/opensearch-project/OpenSearch/pull/4743)) |
|  |  | - Fix error handling while reading analyzer mapping rules |
|  |  | ### Security |
|  |  | - CVE-2022-25857 org.yaml:snakeyaml DOS vulnerability ([#4341](https://github.com/opensearch-project/OpenSearch/pull/4341)) |
|  |  |  |
| Expand Down | |  |

8 changes: 6 additions & 2 deletions

8
[...c/main/java/org/opensearch/analysis/common/HyphenationCompoundWordTokenFilterFactory.java](#diff-2a666be1df70c88aa91f0d239e8b7dfaf7345460bf859945e61e00836631b0d8 "modules/analysis-common/src/main/java/org/opensearch/analysis/common/HyphenationCompoundWordTokenFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/HyphenationCompoundWordTokenFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,12 +32,14 @@ |
|  |  |  |
|  |  | package org.opensearch.analysis.common; |
|  |  |  |
|  |  | import org.apache.logging.log4j.LogManager; |
|  |  | import org.apache.lucene.analysis.TokenStream; |
|  |  | import org.apache.lucene.analysis.compound.HyphenationCompoundWordTokenFilter; |
|  |  | import org.apache.lucene.analysis.compound.hyphenation.HyphenationTree; |
|  |  | import org.opensearch.common.settings.Settings; |
|  |  | import org.opensearch.env.Environment; |
|  |  | import org.opensearch.index.IndexSettings; |
|  |  | import org.opensearch.index.analysis.Analysis; |
|  |  | import org.xml.sax.InputSource; |
|  |  |  |
|  |  | import java.io.InputStream; |
| Expand All | | @@ -61,13 +63,15 @@ public class HyphenationCompoundWordTokenFilterFactory extends AbstractCompoundW |
|  |  | throw new IllegalArgumentException("hyphenation\_patterns\_path is a required setting."); |
|  |  | } |
|  |  |  |
|  |  | Path hyphenationPatternsFile = env.configDir().resolve(hyphenationPatternsPath); |
|  |  | Path hyphenationPatternsFile = Analysis.resolveAnalyzerPath(env, hyphenationPatternsPath); |
|  |  |  |
|  |  | try { |
|  |  | InputStream in = Files.newInputStream(hyphenationPatternsFile); |
|  |  | hyphenationTree = HyphenationCompoundWordTokenFilter.getHyphenationTree(new InputSource(in)); |
|  |  | } catch (Exception e) { |
|  |  | throw new IllegalArgumentException("Exception while reading hyphenation\_patterns\_path.", e); |
|  |  | LogManager.getLogger(HyphenationCompoundWordTokenFilterFactory.class) |
|  |  | .error("Exception while reading hyphenation\_patterns\_path ", e); |
|  |  | throw new IllegalArgumentException("Exception while reading hyphenation\_patterns\_path."); |
|  |  | } |
|  |  | } |
|  |  |  |
| Expand Down | |  |

24 changes: 10 additions & 14 deletions

24
[...nalysis-common/src/main/java/org/opensearch/analysis/common/MappingCharFilterFactory.java](#diff-48415811b2148d666c95d55d1aa537cd55830f1fcafe26598119ac651b98ba6a "modules/analysis-common/src/main/java/org/opensearch/analysis/common/MappingCharFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/MappingCharFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -39,6 +39,7 @@ |
|  |  | import org.opensearch.index.IndexSettings; |
|  |  | import org.opensearch.index.analysis.AbstractCharFilterFactory; |
|  |  | import org.opensearch.index.analysis.Analysis; |
|  |  | import org.opensearch.index.analysis.MappingRule; |
|  |  | import org.opensearch.index.analysis.NormalizingCharFilterFactory; |
|  |  |  |
|  |  | import java.io.Reader; |
| Expand All | | @@ -53,13 +54,13 @@ public class MappingCharFilterFactory extends AbstractCharFilterFactory implemen |
|  |  | MappingCharFilterFactory(IndexSettings indexSettings, Environment env, String name, Settings settings) { |
|  |  | super(indexSettings, name); |
|  |  |  |
|  |  | List<String> rules = Analysis.getWordList(env, settings, "mappings"); |
|  |  | List<MappingRule<String, String>> rules = Analysis.parseWordList(env, settings, "mappings", this::parse); |
|  |  | if (rules == null) { |
|  |  | throw new IllegalArgumentException("mapping requires either `mappings` or `mappings\_path` to be configured"); |
|  |  | } |
|  |  |  |
|  |  | NormalizeCharMap.Builder normMapBuilder = new NormalizeCharMap.Builder(); |
|  |  | parseRules(rules, normMapBuilder); |
|  |  | rules.forEach(rule -> normMapBuilder.add(rule.getLeft(), rule.getRight())); |
|  |  | normMap = normMapBuilder.build(); |
|  |  | } |
|  |  |  |
| Expand All | | @@ -71,18 +72,13 @@ public Reader create(Reader tokenStream) { |
|  |  | // source => target |
|  |  | private static Pattern rulePattern = Pattern.compile("(.\*)\\s\*=>\\s\*(.\*)\\s\*$"); |
|  |  |  |
|  |  | /\*\* |
|  |  | \* parses a list of MappingCharFilter style rules into a normalize char map |
|  |  | \*/ |
|  |  | private void parseRules(List<String> rules, NormalizeCharMap.Builder map) { |
|  |  | for (String rule : rules) { |
|  |  | Matcher m = rulePattern.matcher(rule); |
|  |  | if (!m.find()) throw new RuntimeException("Invalid Mapping Rule : [" + rule + "]"); |
|  |  | String lhs = parseString(m.group(1).trim()); |
|  |  | String rhs = parseString(m.group(2).trim()); |
|  |  | if (lhs == null || rhs == null) throw new RuntimeException("Invalid Mapping Rule : [" + rule + "]. Illegal mapping."); |
|  |  | map.add(lhs, rhs); |
|  |  | } |
|  |  | private MappingRule<String, String> parse(String rule) { |
|  |  | Matcher m = rulePattern.matcher(rule); |
|  |  | if (!m.find()) throw new RuntimeException("Invalid mapping rule : [" + rule + "]"); |
|  |  | String lhs = parseString(m.group(1).trim()); |
|  |  | String rhs = parseString(m.group(2).trim()); |
|  |  | if (lhs == null || rhs == null) throw new RuntimeException("Invalid mapping rule: [" + rule + "]. Illegal mapping."); |
|  |  | return new MappingRule<>(lhs, rhs); |
|  |  | } |
|  |  |  |
|  |  | char[] out = new char[256]; |
| Expand Down | |  |

46 changes: 26 additions & 20 deletions

46
[...ommon/src/main/java/org/opensearch/analysis/common/StemmerOverrideTokenFilterFactory.java](#diff-5dffb53dbe0993fbb701220a2b04e3448ade02e109754307815cfda6d66fcbd6 "modules/analysis-common/src/main/java/org/opensearch/analysis/common/StemmerOverrideTokenFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/StemmerOverrideTokenFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -40,24 +40,31 @@ |
|  |  | import org.opensearch.index.IndexSettings; |
|  |  | import org.opensearch.index.analysis.AbstractTokenFilterFactory; |
|  |  | import org.opensearch.index.analysis.Analysis; |
|  |  | import org.opensearch.index.analysis.MappingRule; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.util.ArrayList; |
|  |  | import java.util.List; |
|  |  |  |
|  |  | public class StemmerOverrideTokenFilterFactory extends AbstractTokenFilterFactory { |
|  |  |  |
|  |  | private static final String MAPPING\_SEPARATOR = "=>"; |
|  |  | private final StemmerOverrideMap overrideMap; |
|  |  |  |
|  |  | StemmerOverrideTokenFilterFactory(IndexSettings indexSettings, Environment env, String name, Settings settings) throws IOException { |
|  |  | super(indexSettings, name, settings); |
|  |  |  |
|  |  | List<String> rules = Analysis.getWordList(env, settings, "rules"); |
|  |  | List<MappingRule<List<String>, String>> rules = Analysis.parseWordList(env, settings, "rules", this::parse); |
|  |  | if (rules == null) { |
|  |  | throw new IllegalArgumentException("stemmer override filter requires either `rules` or `rules\_path` to be configured"); |
|  |  | } |
|  |  |  |
|  |  | StemmerOverrideFilter.Builder builder = new StemmerOverrideFilter.Builder(false); |
|  |  | parseRules(rules, builder, "=>"); |
|  |  | for (MappingRule<List<String>, String> rule : rules) { |
|  |  | for (String key : rule.getLeft()) { |
|  |  | builder.add(key, rule.getRight()); |
|  |  | } |
|  |  | } |
|  |  | overrideMap = builder.build(); |
|  |  |  |
|  |  | } |
| Expand All | | @@ -67,27 +74,26 @@ public TokenStream create(TokenStream tokenStream) { |
|  |  | return new StemmerOverrideFilter(tokenStream, overrideMap); |
|  |  | } |
|  |  |  |
|  |  | static void parseRules(List<String> rules, StemmerOverrideFilter.Builder builder, String mappingSep) { |
|  |  | for (String rule : rules) { |
|  |  | String[] sides = rule.split(mappingSep, -1); |
|  |  | if (sides.length != 2) { |
|  |  | throw new RuntimeException("Invalid Keyword override Rule:" + rule); |
|  |  | } |
|  |  | private MappingRule<List<String>, String> parse(String rule) { |
|  |  | String[] sides = rule.split(MAPPING\_SEPARATOR, -1); |
|  |  | if (sides.length != 2) { |
|  |  | throw new RuntimeException("Invalid keyword override rule: " + rule); |
|  |  | } |
|  |  |  |
|  |  | String[] keys = sides[0].split(",", -1); |
|  |  | String override = sides[1].trim(); |
|  |  | if (override.isEmpty() || override.indexOf(',') != -1) { |
|  |  | throw new RuntimeException("Invalid Keyword override Rule:" + rule); |
|  |  | } |
|  |  | String[] keys = sides[0].split(",", -1); |
|  |  | String override = sides[1].trim(); |
|  |  | if (override.isEmpty() || override.indexOf(',') != -1) { |
|  |  | throw new RuntimeException("Invalid keyword override rule: " + rule); |
|  |  | } |
|  |  |  |
|  |  | for (String key : keys) { |
|  |  | String trimmedKey = key.trim(); |
|  |  | if (trimmedKey.isEmpty()) { |
|  |  | throw new RuntimeException("Invalid Keyword override Rule:" + rule); |
|  |  | } |
|  |  | builder.add(trimmedKey, override); |
|  |  | List<String> trimmedKeys = new ArrayList<>(); |
|  |  | for (String key : keys) { |
|  |  | String trimmedKey = key.trim(); |
|  |  | if (trimmedKey.isEmpty()) { |
|  |  | throw new RuntimeException("Invalid keyword override rule: " + rule); |
|  |  | } |
|  |  | trimmedKeys.add(trimmedKey); |
|  |  | } |
|  |  | return new MappingRule<>(trimmedKeys, override); |
|  |  | } |
|  |  |  |
|  |  | } |

6 changes: 4 additions & 2 deletions

6
[...alysis-common/src/main/java/org/opensearch/analysis/common/SynonymTokenFilterFactory.java](#diff-3a7a8192224bf414564936feb95e752cab2e2291ca02b9e2cb75195552a1d10b "modules/analysis-common/src/main/java/org/opensearch/analysis/common/SynonymTokenFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/SynonymTokenFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ |
|  |  |  |
|  |  | package org.opensearch.analysis.common; |
|  |  |  |
|  |  | import org.apache.logging.log4j.LogManager; |
|  |  | import org.apache.lucene.analysis.Analyzer; |
|  |  | import org.apache.lucene.analysis.TokenStream; |
|  |  | import org.apache.lucene.analysis.synonym.SynonymFilter; |
| Expand Down  Expand Up | | @@ -155,14 +156,15 @@ SynonymMap buildSynonyms(Analyzer analyzer, Reader rules) { |
|  |  | } |
|  |  | return parser.build(); |
|  |  | } catch (Exception e) { |
|  |  | throw new IllegalArgumentException("failed to build synonyms", e); |
|  |  | LogManager.getLogger(SynonymTokenFilterFactory.class).error("Failed to build synonyms: ", e); |
|  |  | throw new IllegalArgumentException("Failed to build synonyms"); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | Reader getRulesFromSettings(Environment env) { |
|  |  | Reader rulesReader; |
|  |  | if (settings.getAsList("synonyms", null) != null) { |
|  |  | List<String> rulesList = Analysis.getWordList(env, settings, "synonyms"); |
|  |  | List<String> rulesList = Analysis.parseWordList(env, settings, "synonyms", s -> s); |
|  |  | StringBuilder sb = new StringBuilder(); |
|  |  | for (String line : rulesList) { |
|  |  | sb.append(line).append(System.lineSeparator()); |
| Expand Down | |  |

8 changes: 7 additions & 1 deletion

8
[...on/src/main/java/org/opensearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java](#diff-36065d6b7dc55ec47b2816e6b3f0a3b2300ff0d0a9f72fda01ea7b597c049340 "modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterGraphTokenFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,6 +41,7 @@ |
|  |  | import org.opensearch.index.IndexSettings; |
|  |  | import org.opensearch.index.analysis.AbstractTokenFilterFactory; |
|  |  | import org.opensearch.index.analysis.Analysis; |
|  |  | import org.opensearch.index.analysis.MappingRule; |
|  |  | import org.opensearch.index.analysis.TokenFilterFactory; |
|  |  |  |
|  |  | import java.util.List; |
| Expand Down  Expand Up | | @@ -73,7 +74,12 @@ public WordDelimiterGraphTokenFilterFactory(IndexSettings indexSettings, Environ |
|  |  | // . => DIGIT |
|  |  | // \u002C => DIGIT |
|  |  | // \u200D => ALPHANUM |
|  |  | List<String> charTypeTableValues = Analysis.getWordList(env, settings, "type\_table"); |
|  |  | List<MappingRule<Character, Byte>> charTypeTableValues = Analysis.parseWordList( |
|  |  | env, |
|  |  | settings, |
|  |  | "type\_table", |
|  |  | WordDelimiterTokenFilterFactory::parse |
|  |  | ); |
|  |  | if (charTypeTableValues == null) { |
|  |  | this.charTypeTable = WordDelimiterIterator.DEFAULT\_WORD\_DELIM\_TABLE; |
|  |  | } else { |
| Expand Down | |  |

30 changes: 20 additions & 10 deletions

30
[...-common/src/main/java/org/opensearch/analysis/common/WordDelimiterTokenFilterFactory.java](#diff-c9e58e0a10323156a89196e64edc5ed3902e4a3273502db9948f2fa7b49d0bb0 "modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterTokenFilterFactory.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/main/java/org/opensearch/analysis/common/WordDelimiterTokenFilterFactory.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,6 +41,7 @@ |
|  |  | import org.opensearch.index.IndexSettings; |
|  |  | import org.opensearch.index.analysis.AbstractTokenFilterFactory; |
|  |  | import org.opensearch.index.analysis.Analysis; |
|  |  | import org.opensearch.index.analysis.MappingRule; |
|  |  | import org.opensearch.index.analysis.TokenFilterFactory; |
|  |  |  |
|  |  | import java.util.Collection; |
| Expand Down  Expand Up | | @@ -76,7 +77,12 @@ public WordDelimiterTokenFilterFactory(IndexSettings indexSettings, Environment |
|  |  | // . => DIGIT |
|  |  | // \u002C => DIGIT |
|  |  | // \u200D => ALPHANUM |
|  |  | List<String> charTypeTableValues = Analysis.getWordList(env, settings, "type\_table"); |
|  |  | List<MappingRule<Character, Byte>> charTypeTableValues = Analysis.parseWordList( |
|  |  | env, |
|  |  | settings, |
|  |  | "type\_table", |
|  |  | WordDelimiterTokenFilterFactory::parse |
|  |  | ); |
|  |  | if (charTypeTableValues == null) { |
|  |  | this.charTypeTable = WordDelimiterIterator.DEFAULT\_WORD\_DELIM\_TABLE; |
|  |  | } else { |
| Expand Down  Expand Up | | @@ -127,19 +133,23 @@ public int getFlag(int flag, Settings settings, String key, boolean defaultValue |
|  |  | // source => type |
|  |  | private static Pattern typePattern = Pattern.compile("(.\*)\\s\*=>\\s\*(.\*)\\s\*$"); |
|  |  |  |
|  |  | static MappingRule<Character, Byte> parse(String rule) { |
|  |  | Matcher m = typePattern.matcher(rule); |
|  |  | if (!m.find()) throw new RuntimeException("Invalid mapping rule: [" + rule + "]"); |
|  |  | String lhs = parseString(m.group(1).trim()); |
|  |  | Byte rhs = parseType(m.group(2).trim()); |
|  |  | if (lhs.length() != 1) throw new RuntimeException("Invalid mapping rule: [" + rule + "]. Only a single character is allowed."); |
|  |  | if (rhs == null) throw new RuntimeException("Invalid mapping rule: [" + rule + "]. Illegal type."); |
|  |  | return new MappingRule<>(lhs.charAt(0), rhs); |
|  |  | } |
|  |  |  |
|  |  | /\*\* |
|  |  | \* parses a list of MappingCharFilter style rules into a custom byte[] type table |
|  |  | \*/ |
|  |  | static byte[] parseTypes(Collection<String> rules) { |
|  |  | static byte[] parseTypes(Collection<MappingRule<Character, Byte>> rules) { |
|  |  | SortedMap<Character, Byte> typeMap = new TreeMap<>(); |
|  |  | for (String rule : rules) { |
|  |  | Matcher m = typePattern.matcher(rule); |
|  |  | if (!m.find()) throw new RuntimeException("Invalid Mapping Rule : [" + rule + "]"); |
|  |  | String lhs = parseString(m.group(1).trim()); |
|  |  | Byte rhs = parseType(m.group(2).trim()); |
|  |  | if (lhs.length() != 1) throw new RuntimeException("Invalid Mapping Rule : [" + rule + "]. Only a single character is allowed."); |
|  |  | if (rhs == null) throw new RuntimeException("Invalid Mapping Rule : [" + rule + "]. Illegal type."); |
|  |  | typeMap.put(lhs.charAt(0), rhs); |
|  |  | for (MappingRule<Character, Byte> rule : rules) { |
|  |  | typeMap.put(rule.getLeft(), rule.getRight()); |
|  |  | } |
|  |  |  |
|  |  | // ensure the table is always at least as big as DEFAULT\_WORD\_DELIM\_TABLE for performance |
| Expand Down | |  |

20 changes: 20 additions & 0 deletions

20
[...test/java/org/opensearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java](#diff-d018d6a6fb9d05275dcd9a0f73adc5645034d2302babe71eb1751fc4e9f06061 "modules/analysis-common/src/test/java/org/opensearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/test/java/org/opensearch/analysis/common/BaseWordDelimiterTokenFilterFactoryTestCase.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -195,4 +195,24 @@ public void testStemEnglishPossessive() throws IOException { |
|  |  | tokenizer.setReader(new StringReader(source)); |
|  |  | assertTokenStreamContents(tokenFilter.create(tokenizer), expected); |
|  |  | } |
|  |  |  |
|  |  | private void createTokenFilterFactoryWithTypeTable(String[] rules) throws IOException { |
|  |  | OpenSearchTestCase.TestAnalysis analysis = AnalysisTestsHelper.createTestAnalysisFromSettings( |
|  |  | Settings.builder() |
|  |  | .put(Environment.PATH\_HOME\_SETTING.getKey(), createTempDir().toString()) |
|  |  | .put("index.analysis.filter.my\_word\_delimiter.type", type) |
|  |  | .putList("index.analysis.filter.my\_word\_delimiter.type\_table", rules) |
|  |  | .put("index.analysis.filter.my\_word\_delimiter.catenate\_words", "true") |
|  |  | .put("index.analysis.filter.my\_word\_delimiter.generate\_word\_parts", "true") |
|  |  | .build(), |
|  |  | new CommonAnalysisModulePlugin() |
|  |  | ); |
|  |  | analysis.tokenFilter.get("my\_word\_delimiter"); |
|  |  | } |
|  |  |  |
|  |  | public void testTypeTableParsingError() { |
|  |  | String[] rules = { "# This is a comment", "$ => DIGIT", "\\u200D => ALPHANUM", "abc => ALPHA" }; |
|  |  | RuntimeException ex = expectThrows(RuntimeException.class, () -> createTokenFilterFactoryWithTypeTable(rules)); |
|  |  | assertEquals("Line [4]: Invalid mapping rule: [abc => ALPHA]. Only a single character is allowed.", ex.getMessage()); |
|  |  | } |
|  |  | } |

70 changes: 70 additions & 0 deletions

70
[...is-common/src/test/java/org/opensearch/analysis/common/MappingCharFilterFactoryTests.java](#diff-3813d74bb843d4c7ebe1f5954a338b13539b3fab1238b5c264ea19cea51fce71 "modules/analysis-common/src/test/java/org/opensearch/analysis/common/MappingCharFilterFactoryTests.java")

Show comments

[View file](/opensearch-project/OpenSearch/blob/6d20423f5920745463b1abc5f1daf6a786c41aa0/modules/analysis-common/src/test/java/org/opensearch/analysis/common/MappingCharFilterFactoryTests.java)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,70 @@ |
|  |  | /\* |
|  |  | \* SPDX-License-Identifier: Apache-2.0 |
|  |  | \* |
|  |  | \* The OpenSearch Contributors require contributions made to |
|  |  | \* this file be licensed under the Apache-2.0 license or a |
|  |  | \* compatible open source license. |
|  |  | \*/ |
|  |  |  |
|  |  | package org.opensearch.analysis.common; |
|  |  |  |
|  |  | import org.apache.lucene.analysis.CharFilter; |
|  |  | import org.opensearch.common.settings.Settings; |
|  |  | import org.opensearch.env.Environment; |
|  |  | import org.opensearch.index.analysis.AnalysisTestsHelper; |
|  |  | import org.opensearch.index.analysis.CharFilterFactory; |
|  |  | import org.opensearch.test.OpenSearchTestCase; |
|  |  |  |
|  |  | import java.io.IOException; |
|  |  | import java.io.StringReader; |
|  |  | import java.util.Arrays; |
|  |  |  |
|  |  | public class MappingCharFilterFactoryTests extends OpenSearchTestCase { |
|  |  | public static CharFilterFactory create(String... rules) throws IOException { |
|  |  | OpenSearchTestCase.TestAnalysis analysis = AnalysisTestsHelper.createTestAnalysisFromSettings( |
|  |  | Settings.builder() |
|  |  | .put(Environment.PATH\_HOME\_SETTING.getKey(), createTempDir().toString()) |
|  |  | .put("index.analysis.analyzer.my\_analyzer.tokenizer", "standard") |
|  |  | .put("index.analysis.analyzer.my\_analyzer.char\_filter", "my\_mappings\_char\_filter") |
|  |  | .put("index.analysis.char\_filter.my\_mappings\_char\_filter.type", "mapping") |
|  |  | .putList("index.analysis.char\_filter.my\_mappings\_char\_filter.mappings", rules) |
|  |  | .build(), |
|  |  | new CommonAnalysisModulePlugin() |
|  |  | ); |
|  |  |  |
|  |  | return analysis.charFilter.get("my\_mappings\_char\_filter"); |
|  |  | } |
|  |  |  |
|  |  | public void testRulesOk() throws IOException { |
|  |  | MappingCharFilterFactory mappingCharFilterFactory = (MappingCharFilterFactory) create( |
|  |  | "# This is a comment", |
|  |  | ":) => \_happy\_", |
|  |  | ":( => \_sad\_" |
|  |  | ); |
|  |  | CharFilter inputReader = (CharFilter) mappingCharFilterFactory.create(new StringReader("I'm so :)")); |
|  |  | char[] tempBuff = new char[14]; |
|  |  | StringBuilder output = new StringBuilder(); |
|  |  | while (true) { |
|  |  | int length = inputReader.read(tempBuff); |
|  |  | if (length == -1) break; |
|  |  | output.append(tempBuff, 0, length); |
|  |  | } |
|  |  | assertEquals("I'm so \_happy\_", output.toString()); |
|  |  | } |
|  |  |  |
|  |  | public void testRuleError() { |
|  |  | for (String rule : Arrays.asList( |
|  |  | "", // empty |
|  |  | "a", // no arrow |
|  |  | "a:>b" // invalid delimiter |
|  |  | )) { |
|  |  | RuntimeException ex = expectThrows(RuntimeException.class, () -> create(rule)); |
|  |  | assertEquals("Line [1]: Invalid mapping rule : [" + rule + "]", ex.getMessage()); |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | public void testRulePartError() { |
|  |  | RuntimeException ex = expectThrows(RuntimeException.class, () -> create("# This is a comment", ":) => \_happy\_", "a:b")); |
|  |  | assertEquals("Line [3]: Invalid mapping rule : [a:b]", ex.getMessage()); |
|  |  | } |
|  |  | } |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `6d20423`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopensearch-project%2FOpenSearch%2Fcommit%2F6d20423f5920745463b1abc5f1daf6a786c41aa0) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


