

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3081436%2Fclickcease-click-fraud-protection%2Ftrunk%2Fclasses%2Froutes.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2921498/clickcease-click-fraud-protection/trunk/classes/routes.php "Changeset 2921498 for clickcease-click-fraud-protection/trunk/classes/routes.php")
* [Next Change](/changeset/3148129/clickcease-click-fraud-protection/trunk/classes/routes.php "Changeset 3148129 for clickcease-click-fraud-protection/trunk/classes/routes.php") →

---

# Changeset [3081436](/changeset/3081436 "Show full changeset") for [clickcease-click-fraud-protection/trunk/classes/routes.php](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
05/05/2024 08:55:01 AM
([8 months](/timeline?from=2024-05-05T08%3A55%3A01Z&precision=second "See timeline at 05/05/2024 08:55:01 AM") ago)

Author:
barpachuk
Message:

Fixed security issue for improved data protection

File:

1 edited

* [clickcease-click-fraud-protection/trunk/classes/routes.php](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436 "Show entry in browser")
  (modified)
  ([8 diffs](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [clickcease-click-fraud-protection/trunk/classes/routes.php](/changeset/3081436/clickcease-click-fraud-protection/trunk/classes/routes.php "Show the changeset 3081436 restricted to clickcease-click-fraud-protection/trunk/classes/routes.php")

  | [r2921498](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L5 "Show revision 2921498 of this file in browser") | [r3081436](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L5 "Show revision 3081436 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | \*/ |
  | 6 | 6 | const CC\_MAX\_IPS = 5; |
  |  | 7 |  |
  | 7 | 8 | class WP\_Rest\_Route |
  | 8 | 9 | { |
  | 9 |  |  |
  | 10 | 10 | public function \_\_construct() |
  | 11 | 11 | { |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L26) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L26) |  |
  | 26 | 26 | $whitelist = get\_option('clickcease\_whitelist', []); |
  | 27 | 27 | $clientId = get\_option('clickcease\_client\_id', null); |
  |  | 28 |  |
  | 28 | 29 | if (!$clientId) { |
  | 29 | 30 | $rtiService = new RTI\_Service(); |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L32) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L33) |  |
  | 32 | 33 | update\_option('clickcease\_client\_id', $clientId); |
  | 33 | 34 | } |
  |  | 35 |  |
  | 34 | 36 | $response = [ |
  | 35 | 37 | 'authKey' => $clickcease\_api\_key, |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L52) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L54) |  |
  | 52 | 54 | } |
  | 53 | 55 |  |
  | 54 |  |  |
  | 55 |  |  |
  | 56 | 56 | public function save\_settings() |
  | 57 | 57 | { |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L59) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L59) |  |
  | 59 | 59 | $res = Utils::getHttpSuccessResponse(); |
  | 60 | 60 | $deactivate = sanitize\_text\_field($\_POST['deactivate']); |
  |  | 61 |  |
  | 61 | 62 | if (!$deactivate || $deactivate === "undefined") { |
  | 62 | 63 | $formService = new FormService(); |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L67) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L68) |  |
  | 67 | 68 | $formService->validateDomainKey($tag\_hash\_key); |
  | 68 | 69 |  |
  |  | 70 | $clientId = $formService->validateBotzappingAuth($api\_key, $tag\_hash\_key, $secret\_key); |
  | 69 | 71 |  |
  | 70 |  | ~~$clientId = $formService->validateBotzappingAuth($api\_key, $tag\_hash\_key, $secret\_key);~~ |
  | 71 | 72 | if (!$clientId) { |
  | 72 | 73 | header('Status: ' . HTTPCode::BAD\_REQUEST); |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L113) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L114) |  |
  | 113 | 114 | array\_push($accumulator, $item); |
  | 114 | 115 | } |
  |  | 116 |  |
  | 115 | 117 | return $accumulator; |
  | 116 | 118 | } |
  | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=2921498#L140) | […](/browser/clickcease-click-fraud-protection/trunk/classes/routes.php?rev=3081436#L142) |  |
  | 140 | 142 | public function save\_settings\_permission() |
  | 141 | 143 | { |
  | 142 |  | return current\_user\_can('~~publish\_post~~s'); |
  |  | 144 | return current\_user\_can('manage\_options'); |
  | 143 | 145 | } |
  | 144 | 146 | } |
  |  | 147 |  |
  | 145 | 148 | new WP\_Rest\_Route(); |
  | 146 | 149 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3081436)
* [Zip Archive](?format=zip&new=3081436)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

