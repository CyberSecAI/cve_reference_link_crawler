=== Content from git.kernel.org_de727b84_20250110_174726.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-14 13:58:57 +0200 |
| commit | [e3ad503876283ac3fcca922a1bf243ef9eb0b0e2](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)) | |
| tree | [30bf714742e6bb7b6668c381fd9e23eb6e5c2124](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2) | |
| parent | [65d76c0aa2b7c79de2e39cb1daa76df92b6fe3fa](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=65d76c0aa2b7c79de2e39cb1daa76df92b6fe3fa) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2&id2=65d76c0aa2b7c79de2e39cb1daa76df92b6fe3fa)) | |
| download | [linux-e3ad503876283ac3fcca922a1bf243ef9eb0b0e2.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e3ad503876283ac3fcca922a1bf243ef9eb0b0e2.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 2eceef54e0b308..ed8798fdf522ad 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=65d76c0aa2b7c79de2e39cb1daa76df92b6fe3fa)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=e3ad503876283ac3fcca922a1bf243ef9eb0b0e2)@@ -876,6 +876,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:04 +0000



=== Content from git.kernel.org_5930f852_20250110_174722.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:32:16 +0200 |
| commit | [3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)) | |
| tree | [e002124c04573f0480d72ab382c35c65d7e1649e](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba) | |
| parent | [a13f8b269b6f4c9371ab149ecb65d2edb52e9669](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a13f8b269b6f4c9371ab149ecb65d2edb52e9669) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba&id2=a13f8b269b6f4c9371ab149ecb65d2edb52e9669)) | |
| download | [linux-3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex eb1b95522c8f25..148ae2882a63ce 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=a13f8b269b6f4c9371ab149ecb65d2edb52e9669)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=3bbd90fca824e6fd61fb20f6dd2b0fa5f8b14bba)@@ -857,6 +857,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:45:59 +0000



=== Content from git.kernel.org_4346c876_20250110_174725.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:45:46 +0200 |
| commit | [9196e42a3b8eeff1707e6ef769112b4b6096be49](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)) | |
| tree | [b210433d4eec586510baf4910c3d7a67d29ef4c1](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49) | |
| parent | [eb044b9c234f9af51cdd72e70900fd1b6a5af8f7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb044b9c234f9af51cdd72e70900fd1b6a5af8f7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49&id2=eb044b9c234f9af51cdd72e70900fd1b6a5af8f7)) | |
| download | [linux-9196e42a3b8eeff1707e6ef769112b4b6096be49.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-9196e42a3b8eeff1707e6ef769112b4b6096be49.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=9196e42a3b8eeff1707e6ef769112b4b6096be49) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex b638b2fd2d3d24..7cd12ea88c0b00 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=eb044b9c234f9af51cdd72e70900fd1b6a5af8f7)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=9196e42a3b8eeff1707e6ef769112b4b6096be49)@@ -836,6 +836,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:02 +0000



=== Content from git.kernel.org_61ca6053_20250110_174724.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-14 15:34:30 +0200 |
| commit | [68dc02f319b9ee54dc23caba742a5c754d1cccc8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)) | |
| tree | [f8479188f28b5597b5a0c334f5c604c82f59af40](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8) | |
| parent | [e689fcf08f3e5d383df5759ee6f64ffc173d2143](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e689fcf08f3e5d383df5759ee6f64ffc173d2143) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8&id2=e689fcf08f3e5d383df5759ee6f64ffc173d2143)) | |
| download | [linux-68dc02f319b9ee54dc23caba742a5c754d1cccc8.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-68dc02f319b9ee54dc23caba742a5c754d1cccc8.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 2a8006e3d68786..9967444eae10cb 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=e689fcf08f3e5d383df5759ee6f64ffc173d2143)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=68dc02f319b9ee54dc23caba742a5c754d1cccc8)@@ -881,6 +881,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:01 +0000



=== Content from git.kernel.org_30f45460_20250110_174726.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-14 13:52:58 +0200 |
| commit | [e13ba3fe5ee070f8a9dab60029d52b1f61da5051](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)) | |
| tree | [d2e4fc7de66d6506ec2aecf27e06b061d488382c](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051) | |
| parent | [026e1f6903b41be32fab57a3cc66747b22670434](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=026e1f6903b41be32fab57a3cc66747b22670434) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051&id2=026e1f6903b41be32fab57a3cc66747b22670434)) | |
| download | [linux-e13ba3fe5ee070f8a9dab60029d52b1f61da5051.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-e13ba3fe5ee070f8a9dab60029d52b1f61da5051.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex fe3f1d655dfe24..58e857fb8deebc 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=026e1f6903b41be32fab57a3cc66747b22670434)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=e13ba3fe5ee070f8a9dab60029d52b1f61da5051)@@ -846,6 +846,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:03 +0000



=== Content from git.kernel.org_ea30011f_20250110_174723.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:33:52 +0200 |
| commit | [55b2a5d331a6ceb1c4372945fdb77181265ba24f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)) | |
| tree | [2fb0387ef1cfb59461440310cc3c5875cede2fa0](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f) | |
| parent | [881058e07b8bbb20906ec1c38b83716b909700ae](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=881058e07b8bbb20906ec1c38b83716b909700ae) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f&id2=881058e07b8bbb20906ec1c38b83716b909700ae)) | |
| download | [linux-55b2a5d331a6ceb1c4372945fdb77181265ba24f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-55b2a5d331a6ceb1c4372945fdb77181265ba24f.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 7cc7bd8aca0f56..7e90139df4d82b 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=881058e07b8bbb20906ec1c38b83716b909700ae)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=55b2a5d331a6ceb1c4372945fdb77181265ba24f)@@ -854,6 +854,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:01 +0000



=== Content from git.kernel.org_07f2c629_20250110_174725.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-31 12:30:06 +0200 |
| commit | [6eabce6608d6f3440f4c03aa3d3ef50a47a3d193](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)) | |
| tree | [1affb420555b9d1062f46a460719aaabde29564d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) | |
| parent | [8400291e289ee6b2bf9779ff1c83a291501f017b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8400291e289ee6b2bf9779ff1c83a291501f017b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193&id2=8400291e289ee6b2bf9779ff1c83a291501f017b)) | |
| download | [linux-6eabce6608d6f3440f4c03aa3d3ef50a47a3d193.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6eabce6608d6f3440f4c03aa3d3ef50a47a3d193.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zeroCalling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 9a18d0b95a4190..5bea3af46abcef 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=8400291e289ee6b2bf9779ff1c83a291501f017b)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)@@ -881,6 +881,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:02 +0000



=== Content from git.kernel.org_f5071bd1_20250110_174723.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:41:19 +0200 |
| commit | [52b138f1021113e593ee6ad258ce08fe90693a9e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=52b138f1021113e593ee6ad258ce08fe90693a9e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)) | |
| tree | [61d69d6d581486389d7bfc7dd62cd52c84e0b761](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=52b138f1021113e593ee6ad258ce08fe90693a9e) | |
| parent | [227d455e6cec2404fec6b4e3a8c6a37c4120d187](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=227d455e6cec2404fec6b4e3a8c6a37c4120d187) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52b138f1021113e593ee6ad258ce08fe90693a9e&id2=227d455e6cec2404fec6b4e3a8c6a37c4120d187)) | |
| download | [linux-52b138f1021113e593ee6ad258ce08fe90693a9e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-52b138f1021113e593ee6ad258ce08fe90693a9e.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zerocommit 6eabce6608d6f3440f4c03aa3d3ef50a47a3d193 upstream.
Calling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=52b138f1021113e593ee6ad258ce08fe90693a9e)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=52b138f1021113e593ee6ad258ce08fe90693a9e) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 10b8785b998279..c7adcf97e2a33a 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=227d455e6cec2404fec6b4e3a8c6a37c4120d187)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=52b138f1021113e593ee6ad258ce08fe90693a9e)@@ -862,6 +862,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:00 +0000


