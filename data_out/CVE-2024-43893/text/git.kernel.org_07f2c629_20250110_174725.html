

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | George Kennedy <george.kennedy@oracle.com> | 2024-07-17 07:24:38 -0500 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-07-31 12:30:06 +0200 |
| commit | [6eabce6608d6f3440f4c03aa3d3ef50a47a3d193](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)) | |
| tree | [1affb420555b9d1062f46a460719aaabde29564d](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) | |
| parent | [8400291e289ee6b2bf9779ff1c83a291501f017b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8400291e289ee6b2bf9779ff1c83a291501f017b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193&id2=8400291e289ee6b2bf9779ff1c83a291501f017b)) | |
| download | [linux-6eabce6608d6f3440f4c03aa3d3ef50a47a3d193.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6eabce6608d6f3440f4c03aa3d3ef50a47a3d193.tar.gz) | |

serial: core: check uartclk for zero to avoid divide by zeroCalling ioctl TIOCSSERIAL with an invalid baud\_base can
result in uartclk being zero, which will result in a
divide by zero error in uart\_get\_divisor(). The check for
uartclk being zero in uart\_set\_info() needs to be done
before other settings are made as subsequent calls to
ioctl TIOCSSERIAL for the same port would be impacted if
the uartclk check was done where uartclk gets set.
Oops: divide error: 0000 PREEMPT SMP KASAN PTI
RIP: 0010:uart\_get\_divisor (drivers/tty/serial/serial\_core.c:580)
Call Trace:
<TASK>
serial8250\_get\_divisor (drivers/tty/serial/8250/8250\_port.c:2576
drivers/tty/serial/8250/8250\_port.c:2589)
serial8250\_do\_set\_termios (drivers/tty/serial/8250/8250\_port.c:502
drivers/tty/serial/8250/8250\_port.c:2741)
serial8250\_set\_termios (drivers/tty/serial/8250/8250\_port.c:2862)
uart\_change\_line\_settings (./include/linux/spinlock.h:376
./include/linux/serial\_core.h:608 drivers/tty/serial/serial\_core.c:222)
uart\_port\_startup (drivers/tty/serial/serial\_core.c:342)
uart\_startup (drivers/tty/serial/serial\_core.c:368)
uart\_set\_info (drivers/tty/serial/serial\_core.c:1034)
uart\_set\_info\_user (drivers/tty/serial/serial\_core.c:1059)
tty\_set\_serial (drivers/tty/tty\_io.c:2637)
tty\_ioctl (drivers/tty/tty\_io.c:2647 drivers/tty/tty\_io.c:2791)
\_\_x64\_sys\_ioctl (fs/ioctl.c:52 fs/ioctl.c:907
fs/ioctl.c:893 fs/ioctl.c:893)
do\_syscall\_64 (arch/x86/entry/common.c:52
(discriminator 1) arch/x86/entry/common.c:83 (discriminator 1))
entry\_SYSCALL\_64\_after\_hwframe (arch/x86/entry/entry\_64.S:130)
Reported-by: syzkaller <syzkaller@googlegroups.com>
Cc: stable@vger.kernel.org
Signed-off-by: George Kennedy <george.kennedy@oracle.com>
Rule: add
Link: <https://lore.kernel.org/stable/1721148848-9784-1-git-send-email-george.kennedy%40oracle.com>
Link: [https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy@oracle.com](https://lore.kernel.org/r/1721219078-3209-1-git-send-email-george.kennedy%40oracle.com)
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)

| -rw-r--r-- | [drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/tty/serial/serial_core.c?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193) | 8 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 0 deletions

| diff --git a/drivers/tty/serial/serial\_core.c b/drivers/tty/serial/serial\_core.cindex 9a18d0b95a4190..5bea3af46abcef 100644--- a/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=8400291e289ee6b2bf9779ff1c83a291501f017b)+++ b/[drivers/tty/serial/serial\_core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/tty/serial/serial_core.c?id=6eabce6608d6f3440f4c03aa3d3ef50a47a3d193)@@ -881,6 +881,14 @@ static int uart\_set\_info(struct tty\_struct \*tty, struct tty\_port \*port, new\_flags = (\_\_force upf\_t)new\_info->flags; old\_custom\_divisor = uport->custom\_divisor; + if (!(uport->flags & UPF\_FIXED\_PORT)) {+ unsigned int uartclk = new\_info->baud\_base \* 16;+ /\* check needs to be done here before other settings made \*/+ if (uartclk == 0) {+ retval = -EINVAL;+ goto exit;+ }+ } if (!capable(CAP\_SYS\_ADMIN)) { retval = -EPERM; if (change\_irq || change\_port || |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 17:46:02 +0000

