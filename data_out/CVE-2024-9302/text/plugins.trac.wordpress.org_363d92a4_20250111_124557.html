

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3161215)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Changeset](/changeset/3161214 "Changeset 3161214")
* [Next Changeset](/changeset/3161216 "Changeset 3161216") →

---

# Changeset 3161215

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/02/2024 04:30:30 AM
([3 months](/timeline?from=2024-10-02T04%3A30%3A30Z&precision=second "See timeline at 10/02/2024 04:30:30 AM") ago)

Author:
appcheap
Message:

Update to version 5.3.8 from GitHub

Location:
[app-builder](/browser/app-builder?rev=3161215)
Files:

10 added
14 edited
1 copied

* [tags/5.3.8](/browser/app-builder/tags/5.3.8?rev=3161215 "Show entry in browser")
  (copied)
  *(copied from [app-builder/trunk](/browser/app-builder/trunk?rev=3159027 "Show original file (revision 3161214)"))*
* [tags/5.3.8/README.txt](/browser/app-builder/tags/5.3.8/README.txt?rev=3161215 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [tags/5.3.8/app-builder.php](/browser/app-builder/tags/5.3.8/app-builder.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file2 "Show differences"))
* [tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215 "Show entry in browser")
  (modified)
  ([5 diffs](#file3 "Show differences"))
* [tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file4 "Show differences"))
* [tags/5.3.8/includes/Di/Service/Feature/ForgotPassword.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Feature/ForgotPassword.php?rev=3161215 "Show entry in browser")
  (added)
* [tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file6 "Show differences"))
* [tags/5.3.8/includes/Di/Service/Integration/WooCommerceBrandsIntegration.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Integration/WooCommerceBrandsIntegration.php?rev=3161215 "Show entry in browser")
  (added)
* [tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file8 "Show differences"))
* [tags/5.3.8/includes/Di/Service/Integration/YiWooCommerceBrandsAddOnIntegration.php](/browser/app-builder/tags/5.3.8/includes/Di/Service/Integration/YiWooCommerceBrandsAddOnIntegration.php?rev=3161215 "Show entry in browser")
  (added)
* [tags/5.3.8/includes/Main.php](/browser/app-builder/tags/5.3.8/includes/Main.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file10 "Show differences"))
* [tags/5.3.8/rest-api](/browser/app-builder/tags/5.3.8/rest-api?rev=3161215 "Show entry in browser")
  (added)
* [tags/5.3.8/rest-api/class-yith-brands-rest-api-v2-controller.php](/browser/app-builder/tags/5.3.8/rest-api/class-yith-brands-rest-api-v2-controller.php?rev=3161215 "Show entry in browser")
  (added)
* [trunk/README.txt](/browser/app-builder/trunk/README.txt?rev=3161215 "Show entry in browser")
  (modified)
  ([2 diffs](#file13 "Show differences"))
* [trunk/app-builder.php](/browser/app-builder/trunk/app-builder.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file14 "Show differences"))
* [trunk/includes/Di/Service/Auth/ForgotPassword.php](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215 "Show entry in browser")
  (modified)
  ([5 diffs](#file15 "Show differences"))
* [trunk/includes/Di/Service/Feature/FeatureFactory.php](/browser/app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file16 "Show differences"))
* [trunk/includes/Di/Service/Feature/ForgotPassword.php](/browser/app-builder/trunk/includes/Di/Service/Feature/ForgotPassword.php?rev=3161215 "Show entry in browser")
  (added)
* [trunk/includes/Di/Service/Feature/JwtAuthentication.php](/browser/app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file18 "Show differences"))
* [trunk/includes/Di/Service/Integration/WooCommerceBrandsIntegration.php](/browser/app-builder/trunk/includes/Di/Service/Integration/WooCommerceBrandsIntegration.php?rev=3161215 "Show entry in browser")
  (added)
* [trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php](/browser/app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file20 "Show differences"))
* [trunk/includes/Di/Service/Integration/YiWooCommerceBrandsAddOnIntegration.php](/browser/app-builder/trunk/includes/Di/Service/Integration/YiWooCommerceBrandsAddOnIntegration.php?rev=3161215 "Show entry in browser")
  (added)
* [trunk/includes/Main.php](/browser/app-builder/trunk/includes/Main.php?rev=3161215 "Show entry in browser")
  (modified)
  ([1 diff](#file22 "Show differences"))
* [trunk/rest-api](/browser/app-builder/trunk/rest-api?rev=3161215 "Show entry in browser")
  (added)
* [trunk/rest-api/class-yith-brands-rest-api-v2-controller.php](/browser/app-builder/trunk/rest-api/class-yith-brands-rest-api-v2-controller.php?rev=3161215 "Show entry in browser")
  (added)

### Legend:

Unmodified
Added
Removed

* ## [app-builder/tags/5.3.8/README.txt](/changeset/3161215/app-builder/tags/5.3.8/README.txt "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/README.txt")

  | [r3159027](/browser/app-builder/trunk/README.txt?rev=3159027#L5 "Show revision 3159027 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/README.txt?rev=3161215#L5 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 5.6 |
  | 6 | 6 | Tested up to: 6.6 |
  | 7 |  | Stable tag: 5.3.~~6~~ |
  |  | 7 | Stable tag: 5.3.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/app-builder/trunk/README.txt?rev=3159027#L152) | […](/browser/app-builder/tags/5.3.8/README.txt?rev=3161215#L152) |  |
  | 152 | 152 |  |
  | 153 | 153 | == Changelog == |
  |  | 154 |  |
  |  | 155 | = 5.3.8 - 30-Sep-2024 = |
  |  | 156 | \* Added: "Max OTP Attempts," "OTP Expiration Time," and "OTP Verification Block Duration" for managing OTP limits and blocking times in the forgot password feature. |
  |  | 157 |  |
  |  | 158 | = 5.3.7 - 30-Sep-2024 = |
  |  | 159 | \* Add: Yith woocommerce Brands Add-on Integration |
  |  | 160 |  |
  | 154 | 161 | = 5.3.6 - 28-Sep-2024 = |
  | 155 | 162 | \* Fixed: Save login Firebase phone number |
  | 156 | 163 |  |
  | 157 |  | ~~== Changelog ==~~ |
  | 158 | 164 | = 5.3.5 - 24-Sep-2024 = |
  | 159 | 165 | \* Update: Change CDN awesome font data to CDN |
* ## [app-builder/tags/5.3.8/app-builder.php](/changeset/3161215/app-builder/tags/5.3.8/app-builder.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/app-builder.php")

  | [r3159027](/browser/app-builder/trunk/app-builder.php?rev=3159027#L11 "Show revision 3159027 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/app-builder.php?rev=3161215#L11 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | \* Plugin URI:        https://appcheap.io/docs |
  | 12 | 12 | \* Description:       The App Builder has it all: drag and drop mobile app, power and control over your app. Get started now!. |
  | 13 |  | \* Version:           5.3.~~6~~ |
  |  | 13 | \* Version:           5.3.8 |
  | 14 | 14 | \* Author:            Appcheap.io |
  | 15 | 15 | \* License:           GPL-2.0-or-later |
* ## [app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php](/changeset/3161215/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php")

  | [r3144533](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L107 "Show revision 3144533 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L107 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 107 | 107 | } |
  | 108 | 108 |  |
  |  | 109 | /\*\* |
  |  | 110 | \* Get settings. |
  |  | 111 | \* |
  |  | 112 | \* @return array settings. |
  |  | 113 | \*/ |
  |  | 114 | private function settings() { |
  |  | 115 | $default\_settings = array( |
  |  | 116 | 'status'     => 0, |
  |  | 117 | 'otp\_expiration\_time' => 1, |
  |  | 118 | 'otp\_attempt\_limit' => 3, |
  |  | 119 | 'otp\_verification\_block\_duration' => 15, |
  |  | 120 | ); |
  |  | 121 | $settings = app\_builder()->get( 'settings' )->feature( 'forgot\_password' ); |
  |  | 122 | return wp\_parse\_args( $settings, $default\_settings ); |
  |  | 123 | } |
  |  | 124 |  |
  |  | 125 | /\*\* |
  |  | 126 | \* Check if the feature is disabled. |
  |  | 127 | \* |
  |  | 128 | \* @return bool |
  |  | 129 | \*/ |
  |  | 130 | private function is\_feature\_disabled() { |
  |  | 131 | $settings = $this->settings(); |
  |  | 132 | return ! $settings['status']; |
  |  | 133 | } |
  |  | 134 |  |
  |  | 135 | /\*\* |
  |  | 136 | \* Get OTP expiration time. |
  |  | 137 | \* |
  |  | 138 | \* @return int |
  |  | 139 | \*/ |
  |  | 140 | private function get\_otp\_expiration\_time() { |
  |  | 141 | $settings = $this->settings(); |
  |  | 142 | return (int)$settings['otp\_expiration\_time'] \* MINUTE\_IN\_SECONDS; |
  |  | 143 | } |
  |  | 144 |  |
  |  | 145 | /\*\* |
  |  | 146 | \* Get OTP attempt limit. |
  |  | 147 | \* |
  |  | 148 | \* @return int |
  |  | 149 | \*/ |
  |  | 150 | private function get\_otp\_attempt\_limit() { |
  |  | 151 | $settings = $this->settings(); |
  |  | 152 | return (int)$settings['otp\_attempt\_limit']; |
  |  | 153 | } |
  |  | 154 |  |
  |  | 155 | /\*\* |
  |  | 156 | \* Get OTP verification block duration. |
  |  | 157 | \* |
  |  | 158 | \* @return int |
  |  | 159 | \*/ |
  |  | 160 | private function get\_otp\_verification\_block\_duration() { |
  |  | 161 | $settings = $this->settings(); |
  |  | 162 | return (int)$settings['otp\_verification\_block\_duration'] \* MINUTE\_IN\_SECONDS; |
  |  | 163 | } |
  |  | 164 |  |
  |  | 165 | /\*\* |
  |  | 166 | \* Verify OTP attempt limit. |
  |  | 167 | \* |
  |  | 168 | \* @param int $user\_id user id. |
  |  | 169 | \* |
  |  | 170 | \* @return WP\_Error|bool |
  |  | 171 | \*/ |
  |  | 172 | private function verify\_attempt\_limit( $user\_id ) { |
  |  | 173 | $otp\_attempt = get\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_id ); |
  |  | 174 | $otp\_attempt = $otp\_attempt ? (int) $otp\_attempt : 0; |
  |  | 175 |  |
  |  | 176 | if ( $otp\_attempt >= $this->get\_otp\_attempt\_limit() ) { |
  |  | 177 | return new WP\_Error( |
  |  | 178 | 'otp\_attempt\_limit', |
  |  | 179 | \_\_( 'OTP attempt limit exceeded', 'mobile-builder' ), |
  |  | 180 | array( |
  |  | 181 | 'status' => 403, |
  |  | 182 | ) |
  |  | 183 | ); |
  |  | 184 | } |
  |  | 185 |  |
  |  | 186 | return $otp\_attempt; |
  |  | 187 | } |
  |  | 188 |  |
  | 109 | 189 | /\*\* |
  | 110 | 190 | \* Forgot password. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L115) | […](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L195) |  |
  | 115 | 195 | \*/ |
  | 116 | 196 | public function forgot\_password( WP\_REST\_Request $request ) { |
  |  | 197 |  |
  |  | 198 | if ( $this->is\_feature\_disabled() ) { |
  |  | 199 | return new WP\_Error( |
  |  | 200 | 'feature\_disabled', |
  |  | 201 | \_\_( 'Forgot password is disabled', 'mobile-builder' ), |
  |  | 202 | array( |
  |  | 203 | 'status' => 403, |
  |  | 204 | ) |
  |  | 205 | ); |
  |  | 206 | } |
  |  | 207 |  |
  | 117 | 208 | $user\_login = $request->get\_param( 'user\_login' ); |
  | 118 | 209 |  |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L122) | […](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L213) |  |
  | 122 | 213 | return $user\_data; |
  | 123 | 214 | } |
  |  | 215 |  |
  |  | 216 | // Verify OTP attempt limit. |
  |  | 217 | $verify\_attempt\_limit = $this->verify\_attempt\_limit( $user\_data->ID ); |
  |  | 218 | if ( is\_wp\_error( $verify\_attempt\_limit ) ) { |
  |  | 219 | return $verify\_attempt\_limit; |
  |  | 220 | } |
  | 124 | 221 |  |
  | 125 | 222 | // Redefining user\_login ensures we return the right case in the email. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L180) | […](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L277) |  |
  | 180 | 277 | } |
  | 181 | 278 |  |
  | 182 |  | // Update OTP to user meta expire after 30 minutes. |
  | 183 |  | set\_transient( 'app\_builder\_forgot\_password\_' . $user\_data->ID, $key, 1800 ); |
  |  | 279 | // Update OTP to user meta expire after [otp\_expiration\_time] minutes setting. |
  |  | 280 | set\_transient( 'app\_builder\_forgot\_password\_' . $user\_data->ID, $key, $this->get\_otp\_expiration\_time() ); |
  |  | 281 | set\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_data->ID, $verify\_attempt\_limit, $this->get\_otp\_verification\_block\_duration() ); |
  | 184 | 282 |  |
  | 185 | 283 | // Response. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L203) | […](/browser/app-builder/tags/5.3.8/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L301) |  |
  | 203 | 301 | return $user\_data; |
  | 204 | 302 | } |
  |  | 303 |  |
  |  | 304 | // Verify OTP attempt limit. |
  |  | 305 | $verify\_attempt\_limit = $this->verify\_attempt\_limit( $user\_data->ID ); |
  |  | 306 | if ( is\_wp\_error( $verify\_attempt\_limit ) ) { |
  |  | 307 | return $verify\_attempt\_limit; |
  |  | 308 | } |
  |  | 309 | set\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_data->ID, $verify\_attempt\_limit + 1, $this->get\_otp\_verification\_block\_duration() ); |
  | 205 | 310 |  |
  | 206 | 311 | // Redefining user\_login ensures we return the right case in the email. |
* ## [app-builder/tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php](/changeset/3161215/app-builder/tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php")

  | [r3156575](/browser/app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php?rev=3156575#L45 "Show revision 3156575 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/includes/Di/Service/Feature/FeatureFactory.php?rev=3161215#L45 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 45 | 45 | UpgraderFeature::META\_KEY          => UpgraderFeature::class, |
  | 46 | 46 | ShoppingVideo::META\_KEY            => ShoppingVideo::class, |
  |  | 47 | ForgotPassword::META\_KEY           => ForgotPassword::class, |
  | 47 | 48 | ); |
  | 48 | 49 | } |
* ## [app-builder/tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php](/changeset/3161215/app-builder/tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php")

  | [r3144525](/browser/app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php?rev=3144525#L85 "Show revision 3144525 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/includes/Di/Service/Feature/JwtAuthentication.php?rev=3161215#L85 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 | 'name'  => 'exp', |
  | 86 | 86 | 'label' => 'Expiration Time', |
  | 87 |  | 'hint'  => 'The expiration time of the JWT in ~~minutes. The default is 30 minute~~s.', |
  |  | 87 | 'hint'  => 'The expiration time of the JWT in days. The default is 30 days.', |
  | 88 | 88 | 'type'  => 'number', |
  | 89 | 89 | 'value' => isset( $data['exp'] ) ? $data['exp'] : 30, |
* ## [app-builder/tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php](/changeset/3161215/app-builder/tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php")

  | [r3156575](/browser/app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3156575#L55 "Show revision 3156575 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3161215#L55 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 | public function rest\_api\_init() |
  | 56 | 56 | { |
  | 57 |  | ~~error\_log('rest\_api\_init');~~ |
  | 58 | 57 | if (! class\_exists('WooCommerce', false)) { |
  | 59 | 58 | return; |
* ## [app-builder/tags/5.3.8/includes/Main.php](/changeset/3161215/app-builder/tags/5.3.8/includes/Main.php "Show the changeset 3161215 restricted to app-builder/tags/5.3.8/includes/Main.php")

  | [r3151692](/browser/app-builder/trunk/includes/Main.php?rev=3151692#L87 "Show revision 3151692 of this file in browser") | [r3161215](/browser/app-builder/tags/5.3.8/includes/Main.php?rev=3161215#L87 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 87 | 87 | \* @static |
  | 88 | 88 | \*/ |
  | 89 |  | public static function instance()~~: ?Main~~ { |
  |  | 89 | public static function instance() { |
  | 90 | 90 | if ( is\_null( self::$instance ) ) { |
  | 91 | 91 | self::$instance = new self(); |
* ## [app-builder/trunk/README.txt](/changeset/3161215/app-builder/trunk/README.txt "Show the changeset 3161215 restricted to app-builder/trunk/README.txt")

  | [r3159027](/browser/app-builder/trunk/README.txt?rev=3159027#L5 "Show revision 3159027 of this file in browser") | [r3161215](/browser/app-builder/trunk/README.txt?rev=3161215#L5 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 5 | 5 | Requires at least: 5.6 |
  | 6 | 6 | Tested up to: 6.6 |
  | 7 |  | Stable tag: 5.3.~~6~~ |
  |  | 7 | Stable tag: 5.3.8 |
  | 8 | 8 | License: GPLv2 or later |
  | 9 | 9 | License URI: http://www.gnu.org/licenses/gpl-2.0.html |
  | […](/browser/app-builder/trunk/README.txt?rev=3159027#L152) | […](/browser/app-builder/trunk/README.txt?rev=3161215#L152) |  |
  | 152 | 152 |  |
  | 153 | 153 | == Changelog == |
  |  | 154 |  |
  |  | 155 | = 5.3.8 - 30-Sep-2024 = |
  |  | 156 | \* Added: "Max OTP Attempts," "OTP Expiration Time," and "OTP Verification Block Duration" for managing OTP limits and blocking times in the forgot password feature. |
  |  | 157 |  |
  |  | 158 | = 5.3.7 - 30-Sep-2024 = |
  |  | 159 | \* Add: Yith woocommerce Brands Add-on Integration |
  |  | 160 |  |
  | 154 | 161 | = 5.3.6 - 28-Sep-2024 = |
  | 155 | 162 | \* Fixed: Save login Firebase phone number |
  | 156 | 163 |  |
  | 157 |  | ~~== Changelog ==~~ |
  | 158 | 164 | = 5.3.5 - 24-Sep-2024 = |
  | 159 | 165 | \* Update: Change CDN awesome font data to CDN |
* ## [app-builder/trunk/app-builder.php](/changeset/3161215/app-builder/trunk/app-builder.php "Show the changeset 3161215 restricted to app-builder/trunk/app-builder.php")

  | [r3159027](/browser/app-builder/trunk/app-builder.php?rev=3159027#L11 "Show revision 3159027 of this file in browser") | [r3161215](/browser/app-builder/trunk/app-builder.php?rev=3161215#L11 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 11 | 11 | \* Plugin URI:        https://appcheap.io/docs |
  | 12 | 12 | \* Description:       The App Builder has it all: drag and drop mobile app, power and control over your app. Get started now!. |
  | 13 |  | \* Version:           5.3.~~6~~ |
  |  | 13 | \* Version:           5.3.8 |
  | 14 | 14 | \* Author:            Appcheap.io |
  | 15 | 15 | \* License:           GPL-2.0-or-later |
* ## [app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php](/changeset/3161215/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php "Show the changeset 3161215 restricted to app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php")

  | [r3144533](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L107 "Show revision 3144533 of this file in browser") | [r3161215](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L107 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 107 | 107 | } |
  | 108 | 108 |  |
  |  | 109 | /\*\* |
  |  | 110 | \* Get settings. |
  |  | 111 | \* |
  |  | 112 | \* @return array settings. |
  |  | 113 | \*/ |
  |  | 114 | private function settings() { |
  |  | 115 | $default\_settings = array( |
  |  | 116 | 'status'     => 0, |
  |  | 117 | 'otp\_expiration\_time' => 1, |
  |  | 118 | 'otp\_attempt\_limit' => 3, |
  |  | 119 | 'otp\_verification\_block\_duration' => 15, |
  |  | 120 | ); |
  |  | 121 | $settings = app\_builder()->get( 'settings' )->feature( 'forgot\_password' ); |
  |  | 122 | return wp\_parse\_args( $settings, $default\_settings ); |
  |  | 123 | } |
  |  | 124 |  |
  |  | 125 | /\*\* |
  |  | 126 | \* Check if the feature is disabled. |
  |  | 127 | \* |
  |  | 128 | \* @return bool |
  |  | 129 | \*/ |
  |  | 130 | private function is\_feature\_disabled() { |
  |  | 131 | $settings = $this->settings(); |
  |  | 132 | return ! $settings['status']; |
  |  | 133 | } |
  |  | 134 |  |
  |  | 135 | /\*\* |
  |  | 136 | \* Get OTP expiration time. |
  |  | 137 | \* |
  |  | 138 | \* @return int |
  |  | 139 | \*/ |
  |  | 140 | private function get\_otp\_expiration\_time() { |
  |  | 141 | $settings = $this->settings(); |
  |  | 142 | return (int)$settings['otp\_expiration\_time'] \* MINUTE\_IN\_SECONDS; |
  |  | 143 | } |
  |  | 144 |  |
  |  | 145 | /\*\* |
  |  | 146 | \* Get OTP attempt limit. |
  |  | 147 | \* |
  |  | 148 | \* @return int |
  |  | 149 | \*/ |
  |  | 150 | private function get\_otp\_attempt\_limit() { |
  |  | 151 | $settings = $this->settings(); |
  |  | 152 | return (int)$settings['otp\_attempt\_limit']; |
  |  | 153 | } |
  |  | 154 |  |
  |  | 155 | /\*\* |
  |  | 156 | \* Get OTP verification block duration. |
  |  | 157 | \* |
  |  | 158 | \* @return int |
  |  | 159 | \*/ |
  |  | 160 | private function get\_otp\_verification\_block\_duration() { |
  |  | 161 | $settings = $this->settings(); |
  |  | 162 | return (int)$settings['otp\_verification\_block\_duration'] \* MINUTE\_IN\_SECONDS; |
  |  | 163 | } |
  |  | 164 |  |
  |  | 165 | /\*\* |
  |  | 166 | \* Verify OTP attempt limit. |
  |  | 167 | \* |
  |  | 168 | \* @param int $user\_id user id. |
  |  | 169 | \* |
  |  | 170 | \* @return WP\_Error|bool |
  |  | 171 | \*/ |
  |  | 172 | private function verify\_attempt\_limit( $user\_id ) { |
  |  | 173 | $otp\_attempt = get\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_id ); |
  |  | 174 | $otp\_attempt = $otp\_attempt ? (int) $otp\_attempt : 0; |
  |  | 175 |  |
  |  | 176 | if ( $otp\_attempt >= $this->get\_otp\_attempt\_limit() ) { |
  |  | 177 | return new WP\_Error( |
  |  | 178 | 'otp\_attempt\_limit', |
  |  | 179 | \_\_( 'OTP attempt limit exceeded', 'mobile-builder' ), |
  |  | 180 | array( |
  |  | 181 | 'status' => 403, |
  |  | 182 | ) |
  |  | 183 | ); |
  |  | 184 | } |
  |  | 185 |  |
  |  | 186 | return $otp\_attempt; |
  |  | 187 | } |
  |  | 188 |  |
  | 109 | 189 | /\*\* |
  | 110 | 190 | \* Forgot password. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L115) | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L195) |  |
  | 115 | 195 | \*/ |
  | 116 | 196 | public function forgot\_password( WP\_REST\_Request $request ) { |
  |  | 197 |  |
  |  | 198 | if ( $this->is\_feature\_disabled() ) { |
  |  | 199 | return new WP\_Error( |
  |  | 200 | 'feature\_disabled', |
  |  | 201 | \_\_( 'Forgot password is disabled', 'mobile-builder' ), |
  |  | 202 | array( |
  |  | 203 | 'status' => 403, |
  |  | 204 | ) |
  |  | 205 | ); |
  |  | 206 | } |
  |  | 207 |  |
  | 117 | 208 | $user\_login = $request->get\_param( 'user\_login' ); |
  | 118 | 209 |  |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L122) | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L213) |  |
  | 122 | 213 | return $user\_data; |
  | 123 | 214 | } |
  |  | 215 |  |
  |  | 216 | // Verify OTP attempt limit. |
  |  | 217 | $verify\_attempt\_limit = $this->verify\_attempt\_limit( $user\_data->ID ); |
  |  | 218 | if ( is\_wp\_error( $verify\_attempt\_limit ) ) { |
  |  | 219 | return $verify\_attempt\_limit; |
  |  | 220 | } |
  | 124 | 221 |  |
  | 125 | 222 | // Redefining user\_login ensures we return the right case in the email. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L180) | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L277) |  |
  | 180 | 277 | } |
  | 181 | 278 |  |
  | 182 |  | // Update OTP to user meta expire after 30 minutes. |
  | 183 |  | set\_transient( 'app\_builder\_forgot\_password\_' . $user\_data->ID, $key, 1800 ); |
  |  | 279 | // Update OTP to user meta expire after [otp\_expiration\_time] minutes setting. |
  |  | 280 | set\_transient( 'app\_builder\_forgot\_password\_' . $user\_data->ID, $key, $this->get\_otp\_expiration\_time() ); |
  |  | 281 | set\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_data->ID, $verify\_attempt\_limit, $this->get\_otp\_verification\_block\_duration() ); |
  | 184 | 282 |  |
  | 185 | 283 | // Response. |
  | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3144533#L203) | […](/browser/app-builder/trunk/includes/Di/Service/Auth/ForgotPassword.php?rev=3161215#L301) |  |
  | 203 | 301 | return $user\_data; |
  | 204 | 302 | } |
  |  | 303 |  |
  |  | 304 | // Verify OTP attempt limit. |
  |  | 305 | $verify\_attempt\_limit = $this->verify\_attempt\_limit( $user\_data->ID ); |
  |  | 306 | if ( is\_wp\_error( $verify\_attempt\_limit ) ) { |
  |  | 307 | return $verify\_attempt\_limit; |
  |  | 308 | } |
  |  | 309 | set\_transient( 'app\_builder\_forgot\_password\_attempt\_' . $user\_data->ID, $verify\_attempt\_limit + 1, $this->get\_otp\_verification\_block\_duration() ); |
  | 205 | 310 |  |
  | 206 | 311 | // Redefining user\_login ensures we return the right case in the email. |
* ## [app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php](/changeset/3161215/app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php "Show the changeset 3161215 restricted to app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php")

  | [r3156575](/browser/app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php?rev=3156575#L45 "Show revision 3156575 of this file in browser") | [r3161215](/browser/app-builder/trunk/includes/Di/Service/Feature/FeatureFactory.php?rev=3161215#L45 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 45 | 45 | UpgraderFeature::META\_KEY          => UpgraderFeature::class, |
  | 46 | 46 | ShoppingVideo::META\_KEY            => ShoppingVideo::class, |
  |  | 47 | ForgotPassword::META\_KEY           => ForgotPassword::class, |
  | 47 | 48 | ); |
  | 48 | 49 | } |
* ## [app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php](/changeset/3161215/app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php "Show the changeset 3161215 restricted to app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php")

  | [r3144525](/browser/app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php?rev=3144525#L85 "Show revision 3144525 of this file in browser") | [r3161215](/browser/app-builder/trunk/includes/Di/Service/Feature/JwtAuthentication.php?rev=3161215#L85 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 85 | 85 | 'name'  => 'exp', |
  | 86 | 86 | 'label' => 'Expiration Time', |
  | 87 |  | 'hint'  => 'The expiration time of the JWT in ~~minutes. The default is 30 minute~~s.', |
  |  | 87 | 'hint'  => 'The expiration time of the JWT in days. The default is 30 days.', |
  | 88 | 88 | 'type'  => 'number', |
  | 89 | 89 | 'value' => isset( $data['exp'] ) ? $data['exp'] : 30, |
* ## [app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php](/changeset/3161215/app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php "Show the changeset 3161215 restricted to app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php")

  | [r3156575](/browser/app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3156575#L55 "Show revision 3156575 of this file in browser") | [r3161215](/browser/app-builder/trunk/includes/Di/Service/Integration/WpcLinkedVariationForWooCommerceIntegration.php?rev=3161215#L55 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 55 | 55 | public function rest\_api\_init() |
  | 56 | 56 | { |
  | 57 |  | ~~error\_log('rest\_api\_init');~~ |
  | 58 | 57 | if (! class\_exists('WooCommerce', false)) { |
  | 59 | 58 | return; |
* ## [app-builder/trunk/includes/Main.php](/changeset/3161215/app-builder/trunk/includes/Main.php "Show the changeset 3161215 restricted to app-builder/trunk/includes/Main.php")

  | [r3151692](/browser/app-builder/trunk/includes/Main.php?rev=3151692#L87 "Show revision 3151692 of this file in browser") | [r3161215](/browser/app-builder/trunk/includes/Main.php?rev=3161215#L87 "Show revision 3161215 of this file in browser") |  |
  | --- | --- | --- |
  | 87 | 87 | \* @static |
  | 88 | 88 | \*/ |
  | 89 |  | public static function instance()~~: ?Main~~ { |
  |  | 89 | public static function instance() { |
  | 90 | 90 | if ( is\_null( self::$instance ) ) { |
  | 91 | 91 | self::$instance = new self(); |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3161215)
* [Zip Archive](?format=zip&new=3161215)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

