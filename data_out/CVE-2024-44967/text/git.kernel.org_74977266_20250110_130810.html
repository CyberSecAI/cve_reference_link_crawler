

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Thomas Zimmermann <tzimmermann@suse.de> | 2024-05-13 14:51:07 +0200 |
| --- | --- | --- |
| committer | Thomas Zimmermann <tzimmermann@suse.de> | 2024-05-17 17:20:01 +0200 |
| commit | [eb1ae34e48a09b7a1179c579aed042b032e408f4](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)) | |
| tree | [e2c401da8ae29d4a6c30a4bf270a17baa15e6cb5](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4) | |
| parent | [ecde5db1598aecab54cc392282c15114f526f05f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ecde5db1598aecab54cc392282c15114f526f05f) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4&id2=ecde5db1598aecab54cc392282c15114f526f05f)) | |
| download | [linux-eb1ae34e48a09b7a1179c579aed042b032e408f4.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-eb1ae34e48a09b7a1179c579aed042b032e408f4.tar.gz) | |

drm/mgag200: Bind I2C lifetime to DRM deviceManaged cleanup with devm\_add\_action\_or\_reset() will release the I2C
adapter when the underlying Linux device goes away. But the connector
still refers to it, so this cleanup leaves behind a stale pointer
in struct drm\_connector.ddc.
Bind the lifetime of the I2C adapter to the connector's lifetime by
using DRM's managed release. When the DRM device goes away (after
the Linux device) DRM will first clean up the connector and then
clean up the I2C adapter.
Signed-off-by: Thomas Zimmermann <tzimmermann@suse.de>
Reviewed-by: Jocelyn Falempe <jfalempe@redhat.com>
Fixes: b279df242972 ("drm/mgag200: Switch I2C code to managed cleanup")
Cc: Thomas Zimmermann <tzimmermann@suse.de>
Cc: Jocelyn Falempe <jfalempe@redhat.com>
Cc: Dave Airlie <airlied@redhat.com>
Cc: dri-devel@lists.freedesktop.org
Cc: <stable@vger.kernel.org> # v6.0+
Link: [https://patchwork.freedesktop.org/patch/msgid/20240513125620.6337-3-tzimmermann@suse.de](https://patchwork.freedesktop.org/patch/msgid/20240513125620.6337-3-tzimmermann%40suse.de)
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)

| -rw-r--r-- | [drivers/gpu/drm/mgag200/mgag200\_i2c.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/gpu/drm/mgag200/mgag200_i2c.c?id=eb1ae34e48a09b7a1179c579aed042b032e408f4) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 2 deletions

| diff --git a/drivers/gpu/drm/mgag200/mgag200\_i2c.c b/drivers/gpu/drm/mgag200/mgag200\_i2c.cindex 1029fef590f9bb..4caeb68f3010c9 100644--- a/[drivers/gpu/drm/mgag200/mgag200\_i2c.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/mgag200/mgag200_i2c.c?id=ecde5db1598aecab54cc392282c15114f526f05f)+++ b/[drivers/gpu/drm/mgag200/mgag200\_i2c.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/gpu/drm/mgag200/mgag200_i2c.c?id=eb1ae34e48a09b7a1179c579aed042b032e408f4)@@ -31,6 +31,8 @@ #include <linux/i2c.h> #include <linux/pci.h> +#include <drm/drm\_managed.h>+ #include "mgag200\_drv.h"  static int mga\_i2c\_read\_gpio(struct mga\_device \*mdev)@@ -86,7 +88,7 @@ static int mga\_gpio\_getscl(void \*data) return (mga\_i2c\_read\_gpio(mdev) & i2c->clock) ? 1 : 0; } -static void mgag200\_i2c\_release(void \*res)+static void mgag200\_i2c\_release(struct drm\_device \*dev, void \*res) { struct mga\_i2c\_chan \*i2c = res; @@ -125,5 +127,5 @@ int mgag200\_i2c\_init(struct mga\_device \*mdev, struct mga\_i2c\_chan \*i2c) if (ret) return ret; - return devm\_add\_action\_or\_reset(dev->dev, mgag200\_i2c\_release, i2c);+ return drmm\_add\_action\_or\_reset(dev, mgag200\_i2c\_release, i2c); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 12:50:04 +0000

