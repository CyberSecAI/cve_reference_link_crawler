

[Log in](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20331)[Skip to main content](#main)[Skip to sidebar](#sidebar)Linked ApplicationsLoadingâ€¦[![XWiki.org JIRA](/s/-65z3d2/930000/8ws80b/_/jira-logo-scaled.png)](https://jira.xwiki.org/secure/MyJiraHome.jspa)

* [Dashboards](/secure/Dashboard.jspa "View and manage your dashboards")
* [Projects](/secure/BrowseProjects.jspa "View recent projects and browse a list of projects")
* [Issues](/issues/ "Search for issues and view recent issues")

* Give feedback to Atlassian
* [Help](https://docs.atlassian.com/jira/jcore-docs-093/ "Help")
  + [Jira Core help](https://docs.atlassian.com/jira/jcore-docs-093/ "Go to the online documentation for Jira Core")
  + [Keyboard Shortcuts](/secure/ViewKeyboardShortcuts%21default.jspa "Get more information about Jira's Keyboard Shortcuts")
  + [About Jira](/secure/AboutPage.jspa "Get more information about Jira")
  + [Jira Credits](/secure/credits/AroundTheWorld%21default.jspa "See who did what")
* [Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20331)

![Uploaded image for project: 'XWiki Platform'](https://jira.xwiki.org/secure/projectavatar?pid=10010&avatarId=13602)

1. [XWiki Platform](/browse/XWIKI)
2. [XWIKI-20331](/browse/XWIKI-20331)

# RCE payloads stored in comments and profile are executed when admin user edits them.

[Log In](/login.jsp?os_destination=%2Fbrowse%2FXWIKI-20331 "Log In")ClosedExportnull

XMLWordPrintable
#### Details

* **Type:**
  ![](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.") Bug
* **Resolution:**
  Fixed
* **Priority:**
  ![](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.") Blocker
* **Fix Version/s:**
  [15.10-rc-1](/issues/?jql=project+%3D+XWIKI+AND+fixVersion+%3D+15.10-rc-1 "15.10-rc-1 ")
* **Affects Version/s:**
  2.6
* **Component/s:**
  [CKEditor](/issues/?jql=project+%3D+XWIKI+AND+component+%3D+CKEditor "CKEditor ")
* **Labels:**
  + [attack\_escalation](/issues/?jql=labels+%3D+attack_escalation "attack_escalation")
  + [attacker\_account](/issues/?jql=labels+%3D+attacker_account "attacker_account")
  + [intigriti](/issues/?jql=labels+%3D+intigriti "intigriti")
  + [security](/issues/?jql=labels+%3D+security "security")

* **Difficulty:**
  Unknown
* **Documentation:**
  <https://extensions.xwiki.org/xwiki/bin/view/Extension/Security/RequiredRights/Default/>
* **Documentation in Release Notes:**
  <https://www.xwiki.org/xwiki/bin/view/ReleaseNotes/Data/XWiki/15.10RC1/#HForAdmins>
* **Similar issues:**

#### Description

**SUBMISSION REFERENCES**

* **Submission code**: XWIKI-E5JJ0KPS
* **Submission URL**: <https://www.intigriti.com/auth/dashboard?redirect=/submissions/e95a7ad5-7029-4627-abf0-3e3e3ea0b4ce/XWIKI-E5JJ0KPS>

**RESEARCHER INFORMATION**

* **Submitter**: floerer

**SUBMISSION INFORMATION**

* **Created at**: Fri, 04 Nov 2022 12:53:00 GMT
* **Submission status**: Archived

**REPORT CONTENT**

* **Severity**: Critical (9.0)
* **Domain**: <https://intigriti.xwiki.com/> (Url)
* **Proof of concept**: XWiki allows users to use scripts like Python, Groovy and Velocity.

  Normally only users with a lot of permissions are able to use these scripts since this is RCE by design.

  However I think there is something really dangerous about this feature because any user is able to enter scripts into their own profile or in comments.

  The user that places the payload will see an error like this:
  {883163}

  However when the admin want so edit the comment or the user profile the script is immediately executed when the inline editor is loaded.

  So without knowing the admin can execute a very dangerous script.

\***Steps to reproduce**\*

1. Login on your <https://intigriti.xwiki.com> account.

2. Go to your profile (by clicking in the top right corner on your profile picture) and then on this page click on the edit pencil of you `personal details`

3. In the `about` section click on `Source` and then paste the following payload:

```

groovy

def cmd = "id".execute();

println("${cmd.text}");

/groovy

```

4. Click on `Save & View` at the bottom and you will see that you will get an error message since you are not allowed to execute this script.

5. You can also paste these scripts in comments, basically in al places where you have such an text editor. Once an admin tries to edit your page the script will execute automatically and the following will be shown:

{292253}

This means that the CMD command succesfully executed.

PS. I tested this on my local instance but for the `intigriti.xwiki.com` instance you need to get admin permissions to test this or you need someone from the xWiki team to check this out.

* **Impact**: Store RCE payloads in comments and in your profile. Whenever an admin tries to edit your comments or profile the RCE will execute.
* **Personal data involved**: No
* **Endpoint**: <https://intigriti.xwiki.com/bin/edit/XWiki/><user>?editor=inline&category=profile
* **Type**: Remote Code Execution
* **Attachments**: Knipsel.jpg, RCE.jpg

#### Attachments

#### Attachments

* Options
  + [Sort By Name](/browse/XWIKI-20331?attachmentSortBy=fileName#attachmentmodule "viewissue.subtasks.tab.show.all.name")
  + [Sort By Date](/browse/XWIKI-20331?attachmentSortBy=dateTime#attachmentmodule "Sort By Date")
  + [Ascending](/browse/XWIKI-20331?attachmentOrder=asc#attachmentmodule "Ascending")
  + [Descending](/browse/XWIKI-20331?attachmentOrder=desc#attachmentmodule "Descending")
  + [Thumbnails](/browse/XWIKI-20331?attachmentViewMode=gallery#attachmentmodule "Thumbnails")
  + [List](/browse/XWIKI-20331?attachmentViewMode=list#attachmentmodule "List")
  + [Download All](/secure/attachmentzip/69972.zip "Download all attachments as a ZIP file")

1. [![292253_RCE.jpg](https://jira.xwiki.org/secure/thumbnail/40852/_thumb_40852.png)](/secure/attachment/40852/292253_RCE.jpg "292253_RCE.jpg - Latest 08/Nov/22 10:38 - Intigriti Integration")[292253\_RCE.jpg](/secure/attachment/40852/292253_RCE.jpg "292253_RCE.jpg - Latest 08/Nov/22 10:38 - Intigriti Integration")31 kB08/Nov/22 10:38
2. [![883163_Knipsel.jpg](https://jira.xwiki.org/secure/thumbnail/40851/_thumb_40851.png)](/secure/attachment/40851/883163_Knipsel.jpg "883163_Knipsel.jpg - Latest 08/Nov/22 10:38 - Intigriti Integration")[883163\_Knipsel.jpg](/secure/attachment/40851/883163_Knipsel.jpg "883163_Knipsel.jpg - Latest 08/Nov/22 10:38 - Intigriti Integration")34 kB08/Nov/22 10:38
#### Issue Links

depends on

![Improvement - An improvement or enhancement to an existing feature or task.](/secure/viewavatar?size=xsmall&avatarId=13510&avatarType=issuetype "Improvement - An improvement or enhancement to an existing feature or task.")
[XWIKI-21311](/browse/XWIKI-21311)
Introduce a required rights analyzer

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

![Improvement - An improvement or enhancement to an existing feature or task.](/secure/viewavatar?size=xsmall&avatarId=13510&avatarType=issuetype "Improvement - An improvement or enhancement to an existing feature or task.")
[XWIKI-21573](/browse/XWIKI-21573)
Enable the required rights analysis by default

* ![Major - Major loss of function.](/images/icons/priorities/major.svg "Major - Major loss of function.")
* Closed

relates to

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20385](/browse/XWIKI-20385)
Privilege escalation/RCE via the edit action

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

![Bug - A problem which impairs or prevents the functions of the product.](/secure/viewavatar?size=xsmall&avatarId=13503&avatarType=issuetype "Bug - A problem which impairs or prevents the functions of the product.")
[XWIKI-20386](/browse/XWIKI-20386)
CSRF privilege escalation/RCE via the edit action

* ![Blocker - Blocks development and/or testing work, production could not run.](/images/icons/priorities/blocker.svg "Blocker - Blocks development and/or testing work, production could not run.")
* Closed

links to

![Web Link](https://github.com/favicon.ico "Web Link")
[Github Advisory](https://github.com/xwiki/xwiki-platform/security/advisories/GHSA-f963-4cq8-2gw7)

#### Activity

#### People

Assignee:

![mleduc](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Manuel Leduc

Reporter:

![intigriti](https://jira.xwiki.org/secure/useravatar?size=small&avatarId=10222)
Intigriti Integration

Votes:
0
Vote for this issue

Watchers:
4
Start watching this issue

#### Dates

Created:

08/Nov/22 10:38

Updated:

10/Dec/24 17:10

Resolved:

24/Nov/23 17:00

Date of First Response:

08/Nov/22 10:50 AM

* Atlassian Jira [Project Management Software](https://www.atlassian.com/software/jira)
* [About Jira](/secure/AboutPage.jspa/secure/AboutPage.jspa)
* [Report a problem](/secure/CreateIssue%21default.jspa)

Powered by a free Atlassian [Jira](http://www.atlassian.com/software/jira) open source license for XWiki.org. Try Jira - [bug tracking software](http://www.atlassian.com/software/jira) for *your* team.

[Atlassian](http://www.atlassian.com/)

