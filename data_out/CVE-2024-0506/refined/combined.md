=== Content from plugins.trac.wordpress.org_633a319a_20250111_061937.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Felementor%2Ftags%2F3.18.3%2Fincludes%2Fcontrols%2Fmedia.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/elementor/trunk/includes/controls/media.php?rev=2923360 "Revision 2923360")
* [Next Revision](/browser/elementor/trunk/includes/controls/media.php?rev=3018553 "Revision 3018553") →
* [Blame](/browser/elementor/trunk/includes/controls/media.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/elementor/tags/3.18.3/includes/controls/media.php)

---

# [source:](/browser?order=name "Go to repository root") [elementor](/browser/elementor?order=name "View elementor")/[tags](/browser/elementor/tags?order=name "View tags")/[3.18.3](/browser/elementor/tags/3.18.3?order=name "View 3.18.3")/[includes](/browser/elementor/tags/3.18.3/includes?order=name "View includes")/[controls](/browser/elementor/tags/3.18.3/includes/controls?order=name "View controls")/[media.php](/browser/elementor/tags/3.18.3/includes/controls/media.php?order=name "View media.php")

View diff against:

View revision:

| [Last change](/changeset/2995350/elementor/trunk/includes/controls/media.php "View differences") on this file was [2995350](/changeset/2995350/ "View changeset 2995350"), checked in by KingYes, [14 months ago](/timeline?from=2023-11-13T17%3A19%3A04Z&precision=second "See timeline at 11/13/2023 05:19:04 PM") |
| --- |
| Upload v3.18.0-beta1 |
| **File size:** 11.4 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace Elementor; |
| [3](#L3) |  |
| [4](#L4) | use Elementor\Core\Files\Uploads\_Manager; |
| [5](#L5) | use Elementor\Modules\DynamicTags\Module as TagsModule; |
| [6](#L6) |  |
| [7](#L7) | if ( ! defined( 'ABSPATH' ) ) { |
| [8](#L8) | exit; // Exit if accessed directly. |
| [9](#L9) | } |
| [10](#L10) |  |
| [11](#L11) | /\*\* |
| [12](#L12) | \* Elementor media control. |
| [13](#L13) | \* |
| [14](#L14) | \* A base control for creating a media chooser control. Based on the WordPress |
| [15](#L15) | \* media library. Used to select an image from the WordPress media library. |
| [16](#L16) | \* |
| [17](#L17) | \* @since 1.0.0 |
| [18](#L18) | \*/ |
| [19](#L19) | class Control\_Media extends Control\_Base\_Multiple { |
| [20](#L20) |  |
| [21](#L21) | /\*\* |
| [22](#L22) | \* Get media control type. |
| [23](#L23) | \* |
| [24](#L24) | \* Retrieve the control type, in this case `media`. |
| [25](#L25) | \* |
| [26](#L26) | \* @since 1.0.0 |
| [27](#L27) | \* @access public |
| [28](#L28) | \* |
| [29](#L29) | \* @return string Control type. |
| [30](#L30) | \*/ |
| [31](#L31) | public function get\_type() { |
| [32](#L32) | return 'media'; |
| [33](#L33) | } |
| [34](#L34) |  |
| [35](#L35) | /\*\* |
| [36](#L36) | \* Get media control default values. |
| [37](#L37) | \* |
| [38](#L38) | \* Retrieve the default value of the media control. Used to return the default |
| [39](#L39) | \* values while initializing the media control. |
| [40](#L40) | \* |
| [41](#L41) | \* @since 1.0.0 |
| [42](#L42) | \* @access public |
| [43](#L43) | \* |
| [44](#L44) | \* @return array Control default value. |
| [45](#L45) | \*/ |
| [46](#L46) | public function get\_default\_value() { |
| [47](#L47) | return [ |
| [48](#L48) | 'url' => '', |
| [49](#L49) | 'id' => '', |
| [50](#L50) | 'size' => '', |
| [51](#L51) | ]; |
| [52](#L52) | } |
| [53](#L53) |  |
| [54](#L54) | /\*\* |
| [55](#L55) | \* Import media images. |
| [56](#L56) | \* |
| [57](#L57) | \* Used to import media control files from external sites while importing |
| [58](#L58) | \* Elementor template JSON file, and replacing the old data. |
| [59](#L59) | \* |
| [60](#L60) | \* @since 1.0.0 |
| [61](#L61) | \* @access public |
| [62](#L62) | \* |
| [63](#L63) | \* @param array $settings Control settings |
| [64](#L64) | \* |
| [65](#L65) | \* @return array Control settings. |
| [66](#L66) | \*/ |
| [67](#L67) | public function on\_import( $settings ) { |
| [68](#L68) | if ( empty( $settings['url'] ) ) { |
| [69](#L69) | return $settings; |
| [70](#L70) | } |
| [71](#L71) |  |
| [72](#L72) | $settings = Plugin::$instance->templates\_manager->get\_import\_images\_instance()->import( $settings ); |
| [73](#L73) |  |
| [74](#L74) | if ( ! $settings ) { |
| [75](#L75) | $settings = [ |
| [76](#L76) | 'id' => '', |
| [77](#L77) | 'url' => Utils::get\_placeholder\_image\_src(), |
| [78](#L78) | ]; |
| [79](#L79) | } |
| [80](#L80) |  |
| [81](#L81) | return $settings; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | /\*\* |
| [85](#L85) | \* Support SVG and JSON Import |
| [86](#L86) | \* |
| [87](#L87) | \* Called by the 'upload\_mimes' filter. Adds SVG and JSON mime types to the list of WordPress' allowed mime types. |
| [88](#L88) | \* |
| [89](#L89) | \* @since 3.4.6 |
| [90](#L90) | \* @deprecated 3.5.0 |
| [91](#L91) | \* |
| [92](#L92) | \* @param $mimes |
| [93](#L93) | \* @return mixed |
| [94](#L94) | \*/ |
| [95](#L95) | public function support\_svg\_and\_json\_import( $mimes ) { |
| [96](#L96) | Plugin::$instance->modules\_manager->get\_modules( 'dev-tools' )->deprecation->deprecated\_function( \_\_METHOD\_\_, '3.5.0' ); |
| [97](#L97) |  |
| [98](#L98) | return $mimes; |
| [99](#L99) | } |
| [100](#L100) |  |
| [101](#L101) | /\*\* |
| [102](#L102) | \* Enqueue media control scripts and styles. |
| [103](#L103) | \* |
| [104](#L104) | \* Used to register and enqueue custom scripts and styles used by the media |
| [105](#L105) | \* control. |
| [106](#L106) | \* |
| [107](#L107) | \* @since 1.0.0 |
| [108](#L108) | \* @access public |
| [109](#L109) | \*/ |
| [110](#L110) | public function enqueue() { |
| [111](#L111) | global $wp\_version; |
| [112](#L112) |  |
| [113](#L113) | $suffix = defined( 'SCRIPT\_DEBUG' ) && SCRIPT\_DEBUG ? '' : '.min'; |
| [114](#L114) | wp\_enqueue\_media(); |
| [115](#L115) |  |
| [116](#L116) | wp\_enqueue\_style( |
| [117](#L117) | 'media', |
| [118](#L118) | admin\_url( '/css/media' . $suffix . '.css' ), |
| [119](#L119) | [], |
| [120](#L120) | $wp\_version |
| [121](#L121) | ); |
| [122](#L122) |  |
| [123](#L123) | wp\_register\_script( |
| [124](#L124) | 'image-edit', |
| [125](#L125) | '/wp-admin/js/image-edit' . $suffix . '.js', |
| [126](#L126) | [ |
| [127](#L127) | 'jquery', |
| [128](#L128) | 'json2', |
| [129](#L129) | 'imgareaselect', |
| [130](#L130) | ], |
| [131](#L131) | $wp\_version, |
| [132](#L132) | true |
| [133](#L133) | ); |
| [134](#L134) |  |
| [135](#L135) | wp\_enqueue\_script( 'image-edit' ); |
| [136](#L136) | } |
| [137](#L137) |  |
| [138](#L138) | /\*\* |
| [139](#L139) | \* Render media control output in the editor. |
| [140](#L140) | \* |
| [141](#L141) | \* Used to generate the control HTML in the editor using Underscore JS |
| [142](#L142) | \* template. The variables for the class are available using `data` JS |
| [143](#L143) | \* object. |
| [144](#L144) | \* |
| [145](#L145) | \* @since 1.0.0 |
| [146](#L146) | \* @access public |
| [147](#L147) | \*/ |
| [148](#L148) | public function content\_template() { |
| [149](#L149) | ?> |
| [150](#L150) | <# |
| [151](#L151) | // For BC. |
| [152](#L152) | if ( data.media\_type ) { |
| [153](#L153) | data.media\_types = [ data.media\_type ]; |
| [154](#L154) | } |
| [155](#L155) |  |
| [156](#L156) | if ( data.should\_include\_svg\_inline\_option ) { |
| [157](#L157) | data.media\_types.push( 'svg' ); |
| [158](#L158) | } |
| [159](#L159) |  |
| [160](#L160) | // Determine if the current media type is viewable. |
| [161](#L161) | const isViewable = () => { |
| [162](#L162) | const viewable = [ |
| [163](#L163) | 'image', |
| [164](#L164) | 'video', |
| [165](#L165) | 'svg', |
| [166](#L166) | ]; |
| [167](#L167) |  |
| [168](#L168) | // Make sure that all media types are viewable. |
| [169](#L169) | return data.media\_types.every( ( type ) => viewable.includes( type ) ); |
| [170](#L170) | }; |
| [171](#L171) |  |
| [172](#L172) | // Get the preview type for the current media type. |
| [173](#L173) | const getPreviewType = () => { |
| [174](#L174) | if ( data.media\_types.includes( 'video' ) ) { |
| [175](#L175) | return 'video'; |
| [176](#L176) | } |
| [177](#L177) |  |
| [178](#L178) | if ( data.media\_types.includes( 'image' ) || data.media\_types.includes( 'svg' ) ) { |
| [179](#L179) | return 'image'; |
| [180](#L180) | } |
| [181](#L181) |  |
| [182](#L182) | return 'none'; |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | // Retrieve a button label by media type. |
| [186](#L186) | const getButtonLabel = ( mediaType ) => { |
| [187](#L187) | switch( mediaType ) { |
| [188](#L188) | case 'image': |
| [189](#L189) | return '<?php esc\_html\_e( 'Choose Image', 'elementor' ); ?>'; |
| [190](#L190) |  |
| [191](#L191) | case 'video': |
| [192](#L192) | return '<?php esc\_html\_e( 'Choose Video', 'elementor' ); ?>'; |
| [193](#L193) |  |
| [194](#L194) | case 'svg': |
| [195](#L195) | return '<?php esc\_html\_e( 'Choose SVG', 'elementor' ); ?>'; |
| [196](#L196) |  |
| [197](#L197) | default: |
| [198](#L198) | return '<?php esc\_html\_e( 'Choose File', 'elementor' ); ?>'; |
| [199](#L199) | } |
| [200](#L200) | } |
| [201](#L201) | #> |
| [202](#L202) | <div class="elementor-control-field elementor-control-media"> |
| [203](#L203) | <label class="elementor-control-title">{{{ data.label }}}</label> |
| [204](#L204) | <# |
| [205](#L205) | if ( isViewable() ) { |
| [206](#L206) | let inputWrapperClasses = 'elementor-control-input-wrapper'; |
| [207](#L207) |  |
| [208](#L208) | if ( ! data.label\_block ) { |
| [209](#L209) | inputWrapperClasses += ' elementor-control-unit-5'; |
| [210](#L210) | } |
| [211](#L211) | #> |
| [212](#L212) | <div class="{{{ inputWrapperClasses }}}"> |
| [213](#L213) | <div class="elementor-control-media\_\_content elementor-control-tag-area elementor-control-preview-area"> |
| [214](#L214) | <div class="elementor-control-media-area"> |
| [215](#L215) | <div class="elementor-control-media\_\_remove elementor-control-media\_\_content\_\_remove" title="<?php echo esc\_attr\_\_( 'Remove', 'elementor' ); ?>"> |
| [216](#L216) | <i class="eicon-trash-o" aria-hidden="true"></i> |
| [217](#L217) | <span class="elementor-screen-only"><?php echo esc\_html\_\_( 'Remove', 'elementor' ); ?></span> |
| [218](#L218) | </div> |
| [219](#L219) | <# |
| [220](#L220) | switch( getPreviewType() ) { |
| [221](#L221) | case 'image': |
| [222](#L222) | #> |
| [223](#L223) | <div class="elementor-control-media\_\_preview"></div> |
| [224](#L224) | <# |
| [225](#L225) | break; |
| [226](#L226) |  |
| [227](#L227) | case 'video': |
| [228](#L228) | #> |
| [229](#L229) | <video class="elementor-control-media-video" preload="metadata"></video> |
| [230](#L230) | <i class="eicon-video-camera" aria-hidden="true"></i> |
| [231](#L231) | <# |
| [232](#L232) | break; |
| [233](#L233) | } |
| [234](#L234) | #> |
| [235](#L235) | </div> |
| [236](#L236) | <div class="elementor-control-media-upload-button elementor-control-media\_\_content\_\_upload-button"> |
| [237](#L237) | <i class="eicon-plus-circle" aria-hidden="true"></i> |
| [238](#L238) | <span class="elementor-screen-only"><?php echo esc\_html\_\_( 'Add', 'elementor' ); ?></span> |
| [239](#L239) | </div> |
| [240](#L240) | <div class="elementor-control-media\_\_tools elementor-control-dynamic-switcher-wrapper"> |
| [241](#L241) | <# |
| [242](#L242) | data.media\_types.forEach( ( type ) => { |
| [243](#L243) | #> |
| [244](#L244) | <div class="elementor-control-media\_\_tool elementor-control-media\_\_replace" data-media-type="{{{ type }}}">{{{ getButtonLabel( type ) }}}</div> |
| [245](#L245) | <# |
| [246](#L246) | } ); |
| [247](#L247) | #> |
| [248](#L248) | </div> |
| [249](#L249) | </div> |
| [250](#L250) | </div> |
| [251](#L251) | <# } /\* endif isViewable() \*/ else { #> |
| [252](#L252) | <div class="elementor-control-media\_\_file elementor-control-preview-area"> |
| [253](#L253) | <div class="elementor-control-media\_\_file\_\_content"> |
| [254](#L254) | <div class="elementor-control-media\_\_file\_\_content\_\_label"><?php echo esc\_html\_\_( 'Click the media icon to upload file', 'elementor' ); ?></div> |
| [255](#L255) | <div class="elementor-control-media\_\_file\_\_content\_\_info"> |
| [256](#L256) | <div class="elementor-control-media\_\_file\_\_content\_\_info\_\_icon"> |
| [257](#L257) | <i class="eicon-document-file"></i> |
| [258](#L258) | </div> |
| [259](#L259) | <div class="elementor-control-media\_\_file\_\_content\_\_info\_\_name"></div> |
| [260](#L260) | </div> |
| [261](#L261) | </div> |
| [262](#L262) | <div class="elementor-control-media\_\_file\_\_controls"> |
| [263](#L263) | <div class="elementor-control-media\_\_remove elementor-control-media\_\_file\_\_controls\_\_remove" title="<?php echo esc\_attr\_\_( 'Remove', 'elementor' ); ?>"> |
| [264](#L264) | <i class="eicon-trash-o" aria-hidden="true"></i> |
| [265](#L265) | <span class="elementor-screen-only"><?php echo esc\_html\_\_( 'Remove', 'elementor' ); ?></span> |
| [266](#L266) | </div> |
| [267](#L267) | <div class="elementor-control-media\_\_file\_\_controls\_\_upload-button elementor-control-media-upload-button" title="<?php echo esc\_attr\_\_( 'Upload', 'elementor' ); ?>"> |
| [268](#L268) | <i class="eicon-upload" aria-hidden="true"></i> |
| [269](#L269) | <span class="elementor-screen-only"><?php echo esc\_html\_\_( 'Upload', 'elementor' ); ?></span> |
| [270](#L270) | </div> |
| [271](#L271) | </div> |
| [272](#L272) | </div> |
| [273](#L273) | <# } #> |
| [274](#L274) | <# if ( data.description ) { #> |
| [275](#L275) | <div class="elementor-control-field-description">{{{ data.description }}}</div> |
| [276](#L276) | <# } #> |
| [277](#L277) |  |
| [278](#L278) | <# if ( data.has\_sizes ) { #> |
| [279](#L279) | <div class="elementor-control-type-select e-control-image-size"> |
| [280](#L280) | <div class="elementor-control-field"> |
| [281](#L281) | <label class="elementor-control-title" data-e-responsive-switcher-sibling="false" for="<?php $this->print\_control\_uid( 'size' ); ?>"><?php echo esc\_html\_\_( 'Image Resolution', 'elementor' ); ?></label> |
| [282](#L282) | <div class="elementor-control-input-wrapper elementor-control-unit-5"> |
| [283](#L283) | <select class="e-image-size-select" id="<?php $this->print\_control\_uid( 'size' ); ?>" data-setting="size"> |
| [284](#L284) | <?php foreach ( $this->get\_image\_sizes() as $size\_key => $size\_title ) : ?> |
| [285](#L285) | <option value="<?php echo esc\_attr( $size\_key ); ?>"><?php echo esc\_html( $size\_title ); ?></option> |
| [286](#L286) | <?php endforeach; ?> |
| [287](#L287) | </select> |
| [288](#L288) | </div> |
| [289](#L289) | </div> |
| [290](#L290) | </div> |
| [291](#L291) | <# } #> |
| [292](#L292) |  |
| [293](#L293) | <input type="hidden" data-setting="{{ data.name }}"/> |
| [294](#L294) | </div> |
| [295](#L295) | <?php |
| [296](#L296) | } |
| [297](#L297) |  |
| [298](#L298) | private function get\_image\_sizes() : array { |
| [299](#L299) | $wp\_image\_sizes = Group\_Control\_Image\_Size::get\_all\_image\_sizes(); |
| [300](#L300) |  |
| [301](#L301) | $image\_sizes = []; |
| [302](#L302) |  |
| [303](#L303) | foreach ( $wp\_image\_sizes as $size\_key => $size\_attributes ) { |
| [304](#L304) | $control\_title = ucwords( str\_replace( '\_', ' ', $size\_key ) ); |
| [305](#L305) | if ( is\_array( $size\_attributes ) ) { |
| [306](#L306) | $control\_title .= sprintf( ' - %d x %d', $size\_attributes['width'], $size\_attributes['height'] ); |
| [307](#L307) | } |
| [308](#L308) |  |
| [309](#L309) | $image\_sizes[ $size\_key ] = $control\_title; |
| [310](#L310) | } |
| [311](#L311) |  |
| [312](#L312) | $image\_sizes[''] = esc\_html\_x( 'Full', 'Image Size Control', 'elementor' ); |
| [313](#L313) |  |
| [314](#L314) | return $image\_sizes; |
| [315](#L315) | } |
| [316](#L316) |  |
| [317](#L317) | /\*\* |
| [318](#L318) | \* Get media control default settings. |
| [319](#L319) | \* |
| [320](#L320) | \* Retrieve the default settings of the media control. Used to return the default |
| [321](#L321) | \* settings while initializing the media control. |
| [322](#L322) | \* |
| [323](#L323) | \* @since 1.0.0 |
| [324](#L324) | \* @access protected |
| [325](#L325) | \* |
| [326](#L326) | \* @return array Control default settings. |
| [327](#L327) | \*/ |
| [328](#L328) | protected function get\_default\_settings() { |
| [329](#L329) | return [ |
| [330](#L330) | 'label\_block' => true, |
| [331](#L331) | 'has\_sizes' => false, |
| [332](#L332) | 'ai' => [ |
| [333](#L333) | 'active' => true, |
| [334](#L334) | 'type' => 'media', |
| [335](#L335) | 'category' => 'photographic', |
| [336](#L336) | ], |
| [337](#L337) | 'media\_types' => [ |
| [338](#L338) | 'image', |
| [339](#L339) | ], |
| [340](#L340) | 'dynamic' => [ |
| [341](#L341) | 'categories' => [ TagsModule::IMAGE\_CATEGORY ], |
| [342](#L342) | 'returnType' => 'object', |
| [343](#L343) | ], |
| [344](#L344) | ]; |
| [345](#L345) | } |
| [346](#L346) |  |
| [347](#L347) | /\*\* |
| [348](#L348) | \* Get media control image title. |
| [349](#L349) | \* |
| [350](#L350) | \* Retrieve the `title` of the image selected by the media control. |
| [351](#L351) | \* |
| [352](#L352) | \* @since 1.0.0 |
| [353](#L353) | \* @access public |
| [354](#L354) | \* @static |
| [355](#L355) | \* |
| [356](#L356) | \* @param array $attachment Media attachment. |
| [357](#L357) | \* |
| [358](#L358) | \* @return string Image title. |
| [359](#L359) | \*/ |
| [360](#L360) | public static function get\_image\_title( $attachment ) { |
| [361](#L361) | if ( empty( $attachment['id'] ) ) { |
| [362](#L362) | return ''; |
| [363](#L363) | } |
| [364](#L364) |  |
| [365](#L365) | return get\_the\_title( $attachment['id'] ); |
| [366](#L366) | } |
| [367](#L367) |  |
| [368](#L368) | /\*\* |
| [369](#L369) | \* Get media control image alt. |
| [370](#L370) | \* |
| [371](#L371) | \* Retrieve the `alt` value of the image selected by the media control. |
| [372](#L372) | \* |
| [373](#L373) | \* @since 1.0.0 |
| [374](#L374) | \* @access public |
| [375](#L375) | \* @static |
| [376](#L376) | \* |
| [377](#L377) | \* @param array $instance Media attachment. |
| [378](#L378) | \* |
| [379](#L379) | \* @return string Image alt. |
| [380](#L380) | \*/ |
| [381](#L381) | public static function get\_image\_alt( $instance ) { |
| [382](#L382) | if ( empty( $instance['id'] ) ) { |
| [383](#L383) | // For `Insert From URL` images. |
| [384](#L384) | return isset( $instance['alt'] ) ? trim( strip\_tags( $instance['alt'] ) ) : ''; |
| [385](#L385) | } |
| [386](#L386) |  |
| [387](#L387) | $attachment\_id = $instance['id']; |
| [388](#L388) | if ( ! $attachment\_id ) { |
| [389](#L389) | return ''; |
| [390](#L390) | } |
| [391](#L391) |  |
| [392](#L392) | $attachment = get\_post( $attachment\_id ); |
| [393](#L393) | if ( ! $attachment ) { |
| [394](#L394) | return ''; |
| [395](#L395) | } |
| [396](#L396) |  |
| [397](#L397) | $alt = get\_post\_meta( $attachment\_id, '\_wp\_attachment\_image\_alt', true ); |
| [398](#L398) | if ( ! $alt ) { |
| [399](#L399) | $alt = $attachment->post\_excerpt; |
| [400](#L400) | if ( ! $alt ) { |
| [401](#L401) | $alt = $attachment->post\_title; |
| [402](#L402) | } |
| [403](#L403) | } |
| [404](#L404) | return trim( strip\_tags( $alt ) ); |
| [405](#L405) | } |
| [406](#L406) |  |
| [407](#L407) | public function get\_style\_value( $css\_property, $control\_value, array $control\_data ) { |
| [408](#L408) | if ( 'URL' !== $css\_property || empty( $control\_value['id'] ) ) { |
| [409](#L409) | return parent::get\_style\_value( $css\_property, $control\_value, $control\_data ); |
| [410](#L410) | } |
| [411](#L411) |  |
| [412](#L412) | if ( empty( $control\_value['size'] ) ) { |
| [413](#L413) | $control\_value['size'] = 'full'; |
| [414](#L414) | } |
| [415](#L415) |  |
| [416](#L416) | return wp\_get\_attachment\_image\_url( $control\_value['id'], $control\_value['size'] ); |
| [417](#L417) | } |
| [418](#L418) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/elementor/tags/3.18.3/includes/controls/media.php?format=txt)
* [Original Format](/export/3220585/elementor/tags/3.18.3/includes/controls/media.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from plugins.trac.wordpress.org_c1bf7dc3_20250111_061938.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%2F3024999%2Felementor%2Ftrunk%2Fincludes%2Fcontrols%2Fgroups%2Fimage-size.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/2995350/elementor/trunk/includes/controls/groups/image-size.php "Changeset 2995350 for elementor/trunk/includes/controls/groups/image-size.php")
* [Next Change](/changeset/3037882/elementor/trunk/includes/controls/groups/image-size.php "Changeset 3037882 for elementor/trunk/includes/controls/groups/image-size.php") →

---

# Changeset [3024999](/changeset/3024999 "Show full changeset") for [elementor/trunk/includes/controls/groups/image-size.php](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=3024999 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
01/22/2024 09:24:30 AM
([12 months](/timeline?from=2024-01-22T09%3A24%3A30Z&precision=second "See timeline at 01/22/2024 09:24:30 AM") ago)

Author:
KingYes
Message:

Upload v3.19.0-beta5

File:

1 edited

* [elementor/trunk/includes/controls/groups/image-size.php](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=3024999 "Show entry in browser")
  (modified)
  ([1 diff](#file0 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [elementor/trunk/includes/controls/groups/image-size.php](/changeset/3024999/elementor/trunk/includes/controls/groups/image-size.php "Show the changeset 3024999 restricted to elementor/trunk/includes/controls/groups/image-size.php")

  | [r2995350](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=2995350#L115 "Show revision 2995350 of this file in browser") | [r3024999](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=3024999#L115 "Show revision 3024999 of this file in browser") |  |
  | --- | --- | --- |
  | 115 | 115 |  |
  | 116 | 116 | if ( ! empty( $image\_src ) ) { |
  | 117 |  | $image\_class\_html = ! empty( $image\_class ) ? ' class="' . $image\_class . '"' : ''; |
  | 118 |  |  |
  | 119 |  | $html .= sprintf( '<img src="%s" title="%s" alt="%s"%s loading="lazy" />', esc\_attr( $image\_src ), Control\_Media::get\_image\_title( $image ), Control\_Media::get\_image\_alt( $image ), $image\_class\_html ); |
  |  | 117 | $image\_class\_html = ! empty( $image\_class ) ? ' class="' . esc\_attr( $image\_class ) . '"' : ''; |
  |  | 118 |  |
  |  | 119 | $html .= sprintf( |
  |  | 120 | '<img src="%1$s" title="%2$s" alt="%3$s"%4$s loading="lazy" />', |
  |  | 121 | esc\_url( $image\_src ), |
  |  | 122 | esc\_attr( Control\_Media::get\_image\_title( $image ) ), |
  |  | 123 | esc\_attr( Control\_Media::get\_image\_alt( $image ) ), |
  |  | 124 | $image\_class\_html |
  |  | 125 | ); |
  | 120 | 126 | } |
  | 121 | 127 | } |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3024999)
* [Zip Archive](?format=zip&new=3024999)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_93b93600_20250111_061939.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# Elementor Website Builder – More than Just a Page Builder <= 3.18.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via get\_image\_alt

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   Elementor Website Builder – More than Just a Page Builder <= 3.18.3 - Authenticated (Contributor+) Stored Cross-Site Scripting via get\_image\_alt

6.4

**Improper Neutralization of Input During Web Page Generation ('Cross-site Scripting')**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:L/UI:N/S:C/C:L/I:L/A:N)

| CVE | [CVE-2024-0506](https://www.cve.org/CVERecord?id=CVE-2024-0506) |
| --- | --- |
| CVSS | 6.4 (Medium) |
| Publicly Published | February 7, 2024 |
| Last Updated | May 31, 2024 |
| Researcher | [wesley (wcraft)](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/wesley-jhon) |

### Description

The Elementor Website Builder – More than Just a Page Builder plugin for WordPress is vulnerable to Reflected Cross-Site Scripting via the $instance[alt] parameter in the get\_image\_alt function in all versions up to, and including, 3.18.3 due to insufficient input sanitization and output escaping. This makes it possible for authenticated attackers with contributor access or higher to inject arbitrary web scripts in pages that execute if they can successfully trick a user into performing an action such as clicking on a link.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/elementor/tags/3.18.3/includes/controls/groups/image-size.php#L119)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/elementor/tags/3.18.3/includes/controls/media.php#L381)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3024999/elementor/trunk/includes/controls/groups/image-size.php)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felementor%2Felementor-website-builder-more-than-just-a-page-builder-3183-authenticated-contributor-stored-cross-site-scripting-via-get-image-alt&t=Elementor%20Website%20Builder%20%E2%80%93%20More%20than%20Just%20a%20Page%20Builder%20%3C%3D%203.18.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20get_image_alt "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felementor%2Felementor-website-builder-more-than-just-a-page-builder-3183-authenticated-contributor-stored-cross-site-scripting-via-get-image-alt&text=Elementor%20Website%20Builder%20%E2%80%93%20More%20than%20Just%20a%20Page%20Builder%20%3C%3D%203.18.3%20-%20Authenticated%20%28Contributor%2B%29%20Stored%20Cross-Site%20Scripting%20via%20get_image_alt "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Felementor%2Felementor-website-builder-more-than-just-a-page-builder-3183-authenticated-contributor-stored-cross-site-scripting-via-get-image-alt "LinkedIn")
Email

## Vulnerability Details for Elementor Website Builder – More Than Just a Page Builder

#### [Elementor Website Builder – More Than Just a Page Builder](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/elementor)

| Software Type | Plugin |
| --- | --- |
| Software Slug | elementor [(view on wordpress.org)](https://wordpress.org/plugins/elementor) |
| Patched? | Yes |
| Remediation | Update to version 3.19.0, or a newer patched version |
| Affected Version | * <= 3.18.3 |
| Patched Version | * 3.19.0 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation



=== Content from plugins.trac.wordpress.org_f47a739d_20250111_061935.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Felementor%2Ftags%2F3.18.3%2Fincludes%2Fcontrols%2Fgroups%2Fimage-size.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=2980776 "Revision 2980776")
* [Next Revision](/browser/elementor/trunk/includes/controls/groups/image-size.php?rev=3024999 "Revision 3024999") →
* [Blame](/browser/elementor/trunk/includes/controls/groups/image-size.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/elementor/tags/3.18.3/includes/controls/groups/image-size.php)

---

# [source:](/browser?order=name "Go to repository root") [elementor](/browser/elementor?order=name "View elementor")/[tags](/browser/elementor/tags?order=name "View tags")/[3.18.3](/browser/elementor/tags/3.18.3?order=name "View 3.18.3")/[includes](/browser/elementor/tags/3.18.3/includes?order=name "View includes")/[controls](/browser/elementor/tags/3.18.3/includes/controls?order=name "View controls")/[groups](/browser/elementor/tags/3.18.3/includes/controls/groups?order=name "View groups")/[image-size.php](/browser/elementor/tags/3.18.3/includes/controls/groups/image-size.php?order=name "View image-size.php")

View diff against:

View revision:

| [Last change](/changeset/2995350/elementor/trunk/includes/controls/groups/image-size.php "View differences") on this file was [2995350](/changeset/2995350/ "View changeset 2995350"), checked in by KingYes, [14 months ago](/timeline?from=2023-11-13T17%3A19%3A04Z&precision=second "See timeline at 11/13/2023 05:19:04 PM") |
| --- |
| Upload v3.18.0-beta1 |
| **File size:** 11.0 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) | namespace Elementor; |
| [3](#L3) |  |
| [4](#L4) | if ( ! defined( 'ABSPATH' ) ) { |
| [5](#L5) | exit; // Exit if accessed directly. |
| [6](#L6) | } |
| [7](#L7) |  |
| [8](#L8) | /\*\* |
| [9](#L9) | \* Elementor image size control. |
| [10](#L10) | \* |
| [11](#L11) | \* A base control for creating image size control. Displays input fields to define |
| [12](#L12) | \* one of the default image sizes (thumbnail, medium, medium\_large, large) or custom |
| [13](#L13) | \* image dimensions. |
| [14](#L14) | \* |
| [15](#L15) | \* @since 1.0.0 |
| [16](#L16) | \*/ |
| [17](#L17) | class Group\_Control\_Image\_Size extends Group\_Control\_Base { |
| [18](#L18) |  |
| [19](#L19) | /\*\* |
| [20](#L20) | \* Fields. |
| [21](#L21) | \* |
| [22](#L22) | \* Holds all the image size control fields. |
| [23](#L23) | \* |
| [24](#L24) | \* @since 1.2.2 |
| [25](#L25) | \* @access protected |
| [26](#L26) | \* @static |
| [27](#L27) | \* |
| [28](#L28) | \* @var array Image size control fields. |
| [29](#L29) | \*/ |
| [30](#L30) | protected static $fields; |
| [31](#L31) |  |
| [32](#L32) | /\*\* |
| [33](#L33) | \* Get image size control type. |
| [34](#L34) | \* |
| [35](#L35) | \* Retrieve the control type, in this case `image-size`. |
| [36](#L36) | \* |
| [37](#L37) | \* @since 1.0.0 |
| [38](#L38) | \* @access public |
| [39](#L39) | \* @static |
| [40](#L40) | \* |
| [41](#L41) | \* @return string Control type. |
| [42](#L42) | \*/ |
| [43](#L43) | public static function get\_type() { |
| [44](#L44) | return 'image-size'; |
| [45](#L45) | } |
| [46](#L46) |  |
| [47](#L47) | /\*\* |
| [48](#L48) | \* Get attachment image HTML. |
| [49](#L49) | \* |
| [50](#L50) | \* Retrieve the attachment image HTML code. |
| [51](#L51) | \* |
| [52](#L52) | \* Note that some widgets use the same key for the media control that allows |
| [53](#L53) | \* the image selection and for the image size control that allows the user |
| [54](#L54) | \* to select the image size, in this case the third parameter should be null |
| [55](#L55) | \* or the same as the second parameter. But when the widget uses different |
| [56](#L56) | \* keys for the media control and the image size control, when calling this |
| [57](#L57) | \* method you should pass the keys. |
| [58](#L58) | \* |
| [59](#L59) | \* @since 1.0.0 |
| [60](#L60) | \* @access public |
| [61](#L61) | \* @static |
| [62](#L62) | \* |
| [63](#L63) | \* @param array  $settings       Control settings. |
| [64](#L64) | \* @param string $image\_size\_key Optional. Settings key for image size. |
| [65](#L65) | \*                               Default is `image`. |
| [66](#L66) | \* @param string $image\_key      Optional. Settings key for image. Default |
| [67](#L67) | \*                               is null. If not defined uses image size key |
| [68](#L68) | \*                               as the image key. |
| [69](#L69) | \* |
| [70](#L70) | \* @return string Image HTML. |
| [71](#L71) | \*/ |
| [72](#L72) | public static function get\_attachment\_image\_html( $settings, $image\_size\_key = 'image', $image\_key = null ) { |
| [73](#L73) | if ( ! $image\_key ) { |
| [74](#L74) | $image\_key = $image\_size\_key; |
| [75](#L75) | } |
| [76](#L76) |  |
| [77](#L77) | $image = $settings[ $image\_key ]; |
| [78](#L78) |  |
| [79](#L79) | // Old version of image settings. |
| [80](#L80) | if ( ! isset( $settings[ $image\_size\_key . '\_size' ] ) ) { |
| [81](#L81) | $settings[ $image\_size\_key . '\_size' ] = ''; |
| [82](#L82) | } |
| [83](#L83) |  |
| [84](#L84) | $size = $settings[ $image\_size\_key . '\_size' ]; |
| [85](#L85) |  |
| [86](#L86) | $image\_class = ! empty( $settings['hover\_animation'] ) ? 'elementor-animation-' . $settings['hover\_animation'] : ''; |
| [87](#L87) |  |
| [88](#L88) | $html = ''; |
| [89](#L89) |  |
| [90](#L90) | // If is the new version - with image size. |
| [91](#L91) | $image\_sizes = get\_intermediate\_image\_sizes(); |
| [92](#L92) |  |
| [93](#L93) | $image\_sizes[] = 'full'; |
| [94](#L94) |  |
| [95](#L95) | if ( ! empty( $image['id'] ) && ! wp\_attachment\_is\_image( $image['id'] ) ) { |
| [96](#L96) | $image['id'] = ''; |
| [97](#L97) | } |
| [98](#L98) |  |
| [99](#L99) | $is\_static\_render\_mode = Plugin::$instance->frontend->is\_static\_render\_mode(); |
| [100](#L100) |  |
| [101](#L101) | // On static mode don't use WP responsive images. |
| [102](#L102) | if ( ! empty( $image['id'] ) && in\_array( $size, $image\_sizes ) && ! $is\_static\_render\_mode ) { |
| [103](#L103) | $image\_class .= " attachment-$size size-$size wp-image-{$image['id']}"; |
| [104](#L104) | $image\_attr = [ |
| [105](#L105) | 'class' => trim( $image\_class ), |
| [106](#L106) | ]; |
| [107](#L107) |  |
| [108](#L108) | $html .= wp\_get\_attachment\_image( $image['id'], $size, false, $image\_attr ); |
| [109](#L109) | } else { |
| [110](#L110) | $image\_src = self::get\_attachment\_image\_src( $image['id'], $image\_size\_key, $settings ); |
| [111](#L111) |  |
| [112](#L112) | if ( ! $image\_src && isset( $image['url'] ) ) { |
| [113](#L113) | $image\_src = $image['url']; |
| [114](#L114) | } |
| [115](#L115) |  |
| [116](#L116) | if ( ! empty( $image\_src ) ) { |
| [117](#L117) | $image\_class\_html = ! empty( $image\_class ) ? ' class="' . $image\_class . '"' : ''; |
| [118](#L118) |  |
| [119](#L119) | $html .= sprintf( '<img src="%s" title="%s" alt="%s"%s loading="lazy" />', esc\_attr( $image\_src ), Control\_Media::get\_image\_title( $image ), Control\_Media::get\_image\_alt( $image ), $image\_class\_html ); |
| [120](#L120) | } |
| [121](#L121) | } |
| [122](#L122) |  |
| [123](#L123) | /\*\* |
| [124](#L124) | \* Get Attachment Image HTML |
| [125](#L125) | \* |
| [126](#L126) | \* Filters the Attachment Image HTML |
| [127](#L127) | \* |
| [128](#L128) | \* @since 2.4.0 |
| [129](#L129) | \* @param string $html the attachment image HTML string |
| [130](#L130) | \* @param array  $settings       Control settings. |
| [131](#L131) | \* @param string $image\_size\_key Optional. Settings key for image size. |
| [132](#L132) | \*                               Default is `image`. |
| [133](#L133) | \* @param string $image\_key      Optional. Settings key for image. Default |
| [134](#L134) | \*                               is null. If not defined uses image size key |
| [135](#L135) | \*                               as the image key. |
| [136](#L136) | \*/ |
| [137](#L137) | return apply\_filters( 'elementor/image\_size/get\_attachment\_image\_html', $html, $settings, $image\_size\_key, $image\_key ); |
| [138](#L138) | } |
| [139](#L139) |  |
| [140](#L140) | /\*\* |
| [141](#L141) | \* Safe print attachment image HTML. |
| [142](#L142) | \* |
| [143](#L143) | \* @uses get\_attachment\_image\_html. |
| [144](#L144) | \* |
| [145](#L145) | \* @access public |
| [146](#L146) | \* @static |
| [147](#L147) | \* |
| [148](#L148) | \* @param array  $settings       Control settings. |
| [149](#L149) | \* @param string $image\_size\_key Optional. Settings key for image size. |
| [150](#L150) | \*                               Default is `image`. |
| [151](#L151) | \* @param string $image\_key      Optional. Settings key for image. Default |
| [152](#L152) | \*                               is null. If not defined uses image size key |
| [153](#L153) | \*                               as the image key. |
| [154](#L154) | \*/ |
| [155](#L155) | public static function print\_attachment\_image\_html( array $settings, $image\_size\_key = 'image', $image\_key = null ) { |
| [156](#L156) | Utils::print\_wp\_kses\_extended( self::get\_attachment\_image\_html( $settings, $image\_size\_key, $image\_key ), [ 'image' ] ); |
| [157](#L157) | } |
| [158](#L158) |  |
| [159](#L159) | /\*\* |
| [160](#L160) | \* Get all image sizes. |
| [161](#L161) | \* |
| [162](#L162) | \* Retrieve available image sizes with data like `width`, `height` and `crop`. |
| [163](#L163) | \* |
| [164](#L164) | \* @since 1.0.0 |
| [165](#L165) | \* @access public |
| [166](#L166) | \* @static |
| [167](#L167) | \* |
| [168](#L168) | \* @return array An array of available image sizes. |
| [169](#L169) | \*/ |
| [170](#L170) | public static function get\_all\_image\_sizes() { |
| [171](#L171) | global $\_wp\_additional\_image\_sizes; |
| [172](#L172) |  |
| [173](#L173) | $default\_image\_sizes = [ 'thumbnail', 'medium', 'medium\_large', 'large' ]; |
| [174](#L174) |  |
| [175](#L175) | $image\_sizes = []; |
| [176](#L176) |  |
| [177](#L177) | foreach ( $default\_image\_sizes as $size ) { |
| [178](#L178) | $image\_sizes[ $size ] = [ |
| [179](#L179) | 'width' => (int) get\_option( $size . '\_size\_w' ), |
| [180](#L180) | 'height' => (int) get\_option( $size . '\_size\_h' ), |
| [181](#L181) | 'crop' => (bool) get\_option( $size . '\_crop' ), |
| [182](#L182) | ]; |
| [183](#L183) | } |
| [184](#L184) |  |
| [185](#L185) | if ( $\_wp\_additional\_image\_sizes ) { |
| [186](#L186) | $image\_sizes = array\_merge( $image\_sizes, $\_wp\_additional\_image\_sizes ); |
| [187](#L187) | } |
| [188](#L188) |  |
| [189](#L189) | /\*\* This filter is documented in wp-admin/includes/media.php \*/ |
| [190](#L190) | return apply\_filters( 'image\_size\_names\_choose', $image\_sizes ); |
| [191](#L191) | } |
| [192](#L192) |  |
| [193](#L193) | /\*\* |
| [194](#L194) | \* Get attachment image src. |
| [195](#L195) | \* |
| [196](#L196) | \* Retrieve the attachment image source URL. |
| [197](#L197) | \* |
| [198](#L198) | \* @since 1.0.0 |
| [199](#L199) | \* @access public |
| [200](#L200) | \* @static |
| [201](#L201) | \* |
| [202](#L202) | \* @param string $attachment\_id  The attachment ID. |
| [203](#L203) | \* @param string $image\_size\_key Settings key for image size. |
| [204](#L204) | \* @param array  $settings       Control settings. |
| [205](#L205) | \* |
| [206](#L206) | \* @return string Attachment image source URL. |
| [207](#L207) | \*/ |
| [208](#L208) | public static function get\_attachment\_image\_src( $attachment\_id, $image\_size\_key, array $settings ) { |
| [209](#L209) | if ( empty( $attachment\_id ) ) { |
| [210](#L210) | return false; |
| [211](#L211) | } |
| [212](#L212) |  |
| [213](#L213) | $size = $settings[ $image\_size\_key . '\_size' ]; |
| [214](#L214) |  |
| [215](#L215) | if ( 'custom' !== $size ) { |
| [216](#L216) | $attachment\_size = $size; |
| [217](#L217) | } else { |
| [218](#L218) | // Use BFI\_Thumb script |
| [219](#L219) | // TODO: Please rewrite this code. |
| [220](#L220) | require\_once ELEMENTOR\_PATH . 'includes/libraries/bfi-thumb/bfi-thumb.php'; |
| [221](#L221) |  |
| [222](#L222) | $custom\_dimension = $settings[ $image\_size\_key . '\_custom\_dimension' ]; |
| [223](#L223) |  |
| [224](#L224) | $attachment\_size = [ |
| [225](#L225) | // Defaults sizes |
| [226](#L226) | 0 => null, // Width. |
| [227](#L227) | 1 => null, // Height. |
| [228](#L228) |  |
| [229](#L229) | 'bfi\_thumb' => true, |
| [230](#L230) | 'crop' => true, |
| [231](#L231) | ]; |
| [232](#L232) |  |
| [233](#L233) | $has\_custom\_size = false; |
| [234](#L234) | if ( ! empty( $custom\_dimension['width'] ) ) { |
| [235](#L235) | $has\_custom\_size = true; |
| [236](#L236) | $attachment\_size[0] = $custom\_dimension['width']; |
| [237](#L237) | } |
| [238](#L238) |  |
| [239](#L239) | if ( ! empty( $custom\_dimension['height'] ) ) { |
| [240](#L240) | $has\_custom\_size = true; |
| [241](#L241) | $attachment\_size[1] = $custom\_dimension['height']; |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) | if ( ! $has\_custom\_size ) { |
| [245](#L245) | $attachment\_size = 'full'; |
| [246](#L246) | } |
| [247](#L247) | } |
| [248](#L248) |  |
| [249](#L249) | $image\_src = wp\_get\_attachment\_image\_src( $attachment\_id, $attachment\_size ); |
| [250](#L250) |  |
| [251](#L251) | if ( empty( $image\_src[0] ) && 'thumbnail' !== $attachment\_size ) { |
| [252](#L252) | $image\_src = wp\_get\_attachment\_image\_src( $attachment\_id ); |
| [253](#L253) | } |
| [254](#L254) |  |
| [255](#L255) | return ! empty( $image\_src[0] ) ? $image\_src[0] : ''; |
| [256](#L256) | } |
| [257](#L257) |  |
| [258](#L258) | /\*\* |
| [259](#L259) | \* Get child default arguments. |
| [260](#L260) | \* |
| [261](#L261) | \* Retrieve the default arguments for all the child controls for a specific group |
| [262](#L262) | \* control. |
| [263](#L263) | \* |
| [264](#L264) | \* @since 1.2.2 |
| [265](#L265) | \* @access protected |
| [266](#L266) | \* |
| [267](#L267) | \* @return array Default arguments for all the child controls. |
| [268](#L268) | \*/ |
| [269](#L269) | protected function get\_child\_default\_args() { |
| [270](#L270) | return [ |
| [271](#L271) | 'include' => [], |
| [272](#L272) | 'exclude' => [], |
| [273](#L273) | ]; |
| [274](#L274) | } |
| [275](#L275) |  |
| [276](#L276) | /\*\* |
| [277](#L277) | \* Init fields. |
| [278](#L278) | \* |
| [279](#L279) | \* Initialize image size control fields. |
| [280](#L280) | \* |
| [281](#L281) | \* @since 1.2.2 |
| [282](#L282) | \* @access protected |
| [283](#L283) | \* |
| [284](#L284) | \* @return array Control fields. |
| [285](#L285) | \*/ |
| [286](#L286) | protected function init\_fields() { |
| [287](#L287) | $fields = []; |
| [288](#L288) |  |
| [289](#L289) | $fields['size'] = [ |
| [290](#L290) | 'label' => esc\_html\_\_( 'Image Resolution', 'elementor' ), |
| [291](#L291) | 'type' => Controls\_Manager::SELECT, |
| [292](#L292) | ]; |
| [293](#L293) |  |
| [294](#L294) | $fields['custom\_dimension'] = [ |
| [295](#L295) | 'label' => esc\_html\_\_( 'Image Dimension', 'elementor' ), |
| [296](#L296) | 'type' => Controls\_Manager::IMAGE\_DIMENSIONS, |
| [297](#L297) | 'description' => esc\_html\_\_( 'You can crop the original image size to any custom size. You can also set a single value for height or width in order to keep the original size ratio.', 'elementor' ), |
| [298](#L298) | 'condition' => [ |
| [299](#L299) | 'size' => 'custom', |
| [300](#L300) | ], |
| [301](#L301) | 'separator' => 'none', |
| [302](#L302) | ]; |
| [303](#L303) |  |
| [304](#L304) | return $fields; |
| [305](#L305) | } |
| [306](#L306) |  |
| [307](#L307) | /\*\* |
| [308](#L308) | \* Prepare fields. |
| [309](#L309) | \* |
| [310](#L310) | \* Process image size control fields before adding them to `add\_control()`. |
| [311](#L311) | \* |
| [312](#L312) | \* @since 1.2.2 |
| [313](#L313) | \* @access protected |
| [314](#L314) | \* |
| [315](#L315) | \* @param array $fields Image size control fields. |
| [316](#L316) | \* |
| [317](#L317) | \* @return array Processed fields. |
| [318](#L318) | \*/ |
| [319](#L319) | protected function prepare\_fields( $fields ) { |
| [320](#L320) | $image\_sizes = $this->get\_image\_sizes(); |
| [321](#L321) |  |
| [322](#L322) | $args = $this->get\_args(); |
| [323](#L323) |  |
| [324](#L324) | if ( ! empty( $args['default'] ) && isset( $image\_sizes[ $args['default'] ] ) ) { |
| [325](#L325) | $default\_value = $args['default']; |
| [326](#L326) | } else { |
| [327](#L327) | // Get the first item for default value. |
| [328](#L328) | $default\_value = array\_keys( $image\_sizes ); |
| [329](#L329) | $default\_value = array\_shift( $default\_value ); |
| [330](#L330) | } |
| [331](#L331) |  |
| [332](#L332) | $fields['size']['options'] = $image\_sizes; |
| [333](#L333) |  |
| [334](#L334) | $fields['size']['default'] = $default\_value; |
| [335](#L335) |  |
| [336](#L336) | if ( ! isset( $image\_sizes['custom'] ) ) { |
| [337](#L337) | unset( $fields['custom\_dimension'] ); |
| [338](#L338) | } |
| [339](#L339) |  |
| [340](#L340) | return parent::prepare\_fields( $fields ); |
| [341](#L341) | } |
| [342](#L342) |  |
| [343](#L343) | /\*\* |
| [344](#L344) | \* Get image sizes. |
| [345](#L345) | \* |
| [346](#L346) | \* Retrieve available image sizes after filtering `include` and `exclude` arguments. |
| [347](#L347) | \* |
| [348](#L348) | \* @since 2.0.0 |
| [349](#L349) | \* @access private |
| [350](#L350) | \* |
| [351](#L351) | \* @return array Filtered image sizes. |
| [352](#L352) | \*/ |
| [353](#L353) | private function get\_image\_sizes() { |
| [354](#L354) | $wp\_image\_sizes = self::get\_all\_image\_sizes(); |
| [355](#L355) |  |
| [356](#L356) | $args = $this->get\_args(); |
| [357](#L357) |  |
| [358](#L358) | if ( $args['include'] ) { |
| [359](#L359) | $wp\_image\_sizes = array\_intersect\_key( $wp\_image\_sizes, array\_flip( $args['include'] ) ); |
| [360](#L360) | } elseif ( $args['exclude'] ) { |
| [361](#L361) | $wp\_image\_sizes = array\_diff\_key( $wp\_image\_sizes, array\_flip( $args['exclude'] ) ); |
| [362](#L362) | } |
| [363](#L363) |  |
| [364](#L364) | $image\_sizes = []; |
| [365](#L365) |  |
| [366](#L366) | foreach ( $wp\_image\_sizes as $size\_key => $size\_attributes ) { |
| [367](#L367) | $control\_title = ucwords( str\_replace( '\_', ' ', $size\_key ) ); |
| [368](#L368) | if ( is\_array( $size\_attributes ) ) { |
| [369](#L369) | $control\_title .= sprintf( ' - %d x %d', $size\_attributes['width'], $size\_attributes['height'] ); |
| [370](#L370) | } |
| [371](#L371) |  |
| [372](#L372) | $image\_sizes[ $size\_key ] = $control\_title; |
| [373](#L373) | } |
| [374](#L374) |  |
| [375](#L375) | $image\_sizes['full'] = esc\_html\_\_( 'Full', 'elementor' ); |
| [376](#L376) |  |
| [377](#L377) | if ( ! empty( $args['include']['custom'] ) || ! in\_array( 'custom', $args['exclude'] ) ) { |
| [378](#L378) | $image\_sizes['custom'] = esc\_html\_\_( 'Custom', 'elementor' ); |
| [379](#L379) | } |
| [380](#L380) |  |
| [381](#L381) | return $image\_sizes; |
| [382](#L382) | } |
| [383](#L383) |  |
| [384](#L384) | /\*\* |
| [385](#L385) | \* Get default options. |
| [386](#L386) | \* |
| [387](#L387) | \* Retrieve the default options of the image size control. Used to return the |
| [388](#L388) | \* default options while initializing the image size control. |
| [389](#L389) | \* |
| [390](#L390) | \* @since 1.9.0 |
| [391](#L391) | \* @access protected |
| [392](#L392) | \* |
| [393](#L393) | \* @return array Default image size control options. |
| [394](#L394) | \*/ |
| [395](#L395) | protected function get\_default\_options() { |
| [396](#L396) | return [ |
| [397](#L397) | 'popover' => false, |
| [398](#L398) | ]; |
| [399](#L399) | } |
| [400](#L400) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/elementor/tags/3.18.3/includes/controls/groups/image-size.php?format=txt)
* [Original Format](/export/3220585/elementor/tags/3.18.3/includes/controls/groups/image-size.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)


