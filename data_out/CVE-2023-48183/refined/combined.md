=== Content from github.com_6ac09e7d_20250111_171028.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fissues%2F192)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fissues%2F192)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=bellard%2Fquickjs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bellard](/bellard)
/
**[quickjs](/bellard/quickjs)**
Public

* [Notifications](/login?return_to=%2Fbellard%2Fquickjs) You must be signed in to change notification settings
* [Fork
  916](/login?return_to=%2Fbellard%2Fquickjs)
* [Star
   8.7k](/login?return_to=%2Fbellard%2Fquickjs)

* [Code](/bellard/quickjs)
* [Issues
  88](/bellard/quickjs/issues)
* [Pull requests
  39](/bellard/quickjs/pulls)
* [Actions](/bellard/quickjs/actions)
* [Projects
  0](/bellard/quickjs/projects)
* [Security](/bellard/quickjs/security)
* [Insights](/bellard/quickjs/pulse)

Additional navigation options

* [Code](/bellard/quickjs)
* [Issues](/bellard/quickjs/issues)
* [Pull requests](/bellard/quickjs/pulls)
* [Actions](/bellard/quickjs/actions)
* [Projects](/bellard/quickjs/projects)
* [Security](/bellard/quickjs/security)
* [Insights](/bellard/quickjs/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fbellard%2Fquickjs%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fbellard%2Fquickjs%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Null Pointer Dereference in build\_for\_in\_iterator #192

Closed

[anbu1024](/anbu1024) opened this issue
Sep 1, 2023
· 1 comment

Closed

# [Null Pointer Dereference in build\_for\_in\_iterator](#top) #192

[anbu1024](/anbu1024) opened this issue
Sep 1, 2023
· 1 comment

## Comments

[![@anbu1024](https://avatars.githubusercontent.com/u/54770089?s=80&v=4)](/anbu1024)

Copy link

### **[anbu1024](/anbu1024)** commented [Sep 1, 2023](#issue-1876578923)

| QuickJS version: [2788d71](https://github.com/bellard/quickjs/commit/2788d71e823b522b178db3b3660ce93689534e6d)  Test case:  ``` function foo() {          function Bar() {     }          class Apple extends Bar {         constructor(a) {             (() => {             	for (const i in this) {}                 eval(a);                 return 0;             })();         }     }     const y = new Apple();     return y; }  let x = new Promise(foo); ```  Error: crashed due to null pointer deference,  In function `JSValue build_for_in_iterator(JSContext *ctx, JSValue obj)`, line 15129, the  ``` p = JS_VALUE_GET_OBJ(obj);  ```  returns 0. |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@dchest](https://avatars.githubusercontent.com/u/52677?s=80&u=08c5b691301866502aa76628e0cfa955468fa2b1&v=4)](/dchest)

Copy link

### **[dchest](/dchest)** commented [Sep 1, 2023](#issuecomment-1703033500) • edited Loading

| I believe this is caused by `eval` appearing in the function causing the function to close over `this`, but not keeping the `is_lexical` status here :  <https://github.com/bellard/quickjs/blob/2788d71e823b522b178db3b3660ce93689534e6d/quickjs.c#L30312-L30320>  ```                 vd = &fd->vars[i];                 /* do not close top level last result */                 if (vd->scope_level == 0 &&                     vd->var_name != JS_ATOM__ret_ &&                     vd->var_name != JS_ATOM_NULL) {                     get_closure_var(ctx, s, fd,                                     FALSE, i, vd->var_name, FALSE, FALSE,                                     JS_VAR_NORMAL);                 } ```  `is_lexical` is added in order to emit opcode that checks that variable is initialized:  <https://github.com/bellard/quickjs/blob/master/quickjs.c#L29514-L29515>  without it, accessing an uninitialized variable is done without checking, so it crashes.  Possible fix: add `vd->var_name != JS_ATOM_this` to the above construction inside `add_eval_variables` to skip adding `this` (since it's already added earlier), but I'm not sure if it's correct. |
| --- |

All reactions

Sorry, something went wrong.

[bellard](/bellard)
pushed a commit
that referenced
this issue
[Dec 9, 2023](#ref-commit-c4cdd61)

`[fixed lexical scope of 'this' with eval (github issue](/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077 "fixed lexical scope of 'this' with eval (github issue #192)") [#192](https://github.com/bellard/quickjs/issues/192)[)](/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077 "fixed lexical scope of 'this' with eval (github issue #192)")`

`[c4cdd61](/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077)`

[![@bellard](https://avatars.githubusercontent.com/u/6490144?s=40&v=4)](/bellard)
[bellard](/bellard)
closed this as [completed](/bellard/quickjs/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
[Dec 9, 2023](#event-11200484099)

[TooTallNate](/TooTallNate)
pushed a commit
to TooTallNate/quickjs
that referenced
this issue
[Dec 18, 2023](#ref-commit-4c1b9f8)
[![@bnoordhuis](https://avatars.githubusercontent.com/u/275871?s=40&v=4)](/bnoordhuis)

`[Fix OP_FMT_none_loc bytecode dumping (](/TooTallNate/quickjs/commit/4c1b9f8c7f0619f0f5af8af5171279e049153ecc "Fix OP_FMT_none_loc bytecode dumping (#192)

Commit f404980 (\"Add fused get_loc0_loc1 opcode\") introduced an
off-by-one (sometimes negative) array index bug because OP_get_loc1_loc1
replaced OP_get_loc0 as the first OP_FMT_none_loc opcode.")[bellard#192](https://github.com/bellard/quickjs/issues/192)[)](/TooTallNate/quickjs/commit/4c1b9f8c7f0619f0f5af8af5171279e049153ecc "Fix OP_FMT_none_loc bytecode dumping (#192)

Commit f404980 (\"Add fused get_loc0_loc1 opcode\") introduced an
off-by-one (sometimes negative) array index bug because OP_get_loc1_loc1
replaced OP_get_loc0 as the first OP_FMT_none_loc opcode.")`
…

`[4c1b9f8](/TooTallNate/quickjs/commit/4c1b9f8c7f0619f0f5af8af5171279e049153ecc)`

```
Commit [f404980](https://github.com/TooTallNate/quickjs/commit/f404980ec0128e685a35fe8c9a7d746bab4ff030) ("Add fused get_loc0_loc1 opcode") introduced an
off-by-one (sometimes negative) array index bug because OP_get_loc1_loc1
replaced OP_get_loc0 as the first OP_FMT_none_loc opcode.
```

[TooTallNate](/TooTallNate)
pushed a commit
to TooTallNate/quickjs
that referenced
this issue
[Dec 18, 2023](#ref-commit-30e4767)
[![@bnoordhuis](https://avatars.githubusercontent.com/u/275871?s=40&v=4)](/bnoordhuis)

`[fixed lexical scope of 'this' with eval (github issue](/TooTallNate/quickjs/commit/30e4767e67adbe69f772fd8306107aa951e44e50 "fixed lexical scope of 'this' with eval (github issue #192)") [bellard#192](https://github.com/bellard/quickjs/issues/192)[)](/TooTallNate/quickjs/commit/30e4767e67adbe69f772fd8306107aa951e44e50 "fixed lexical scope of 'this' with eval (github issue #192)")`

`[30e4767](/TooTallNate/quickjs/commit/30e4767e67adbe69f772fd8306107aa951e44e50)`

[GerHobbelt](/GerHobbelt)
pushed a commit
to GerHobbelt/quickjs
that referenced
this issue
[Jan 26, 2024](#ref-commit-df7887a)
[![@justjake](https://avatars.githubusercontent.com/u/296279?s=40&u=bed8a4153891440b13a6348ff4c7a85e7fbc0576&v=4)](/justjake)

`[Squashed 'quickjs/' changes from](/GerHobbelt/quickjs/commit/df7887abe563a081117936996ba3f60f145cb793 "Squashed 'quickjs/' changes from b5e6289..daa35bc

daa35bc new release
a057008 added Array.prototype.findLast{Index} and TypeArray.prototype.findLast{index} (initial patch by bnoordhuis)
177af41 fixed duplicate static private setter/getter test
b180cd2 Symbol.species is no longer used in TypedArray constructor from a TypedArray
e182050 fixed delete super.x error
58f374e reworked set property and fixed corner cases of typed array set property
20a57f9 Implement extended named capture group identifiers (bnoordhuis)
4949d75 Retrieve RegExp 'g' flag in spec conformant way (original patch by bnoordhuis)
c4cdd61 fixed lexical scope of 'this' with eval (github issue #192)
26fdf65 Make Date methods argument coercion spec compliant (bnoordhuis)
b14d77b fixed negative zero date
55a4878 fixed private field setters (github issue #194)
321dbfa added missing bignum error tests (github issue #159)
f87cab0 added String.prototype.at, Array.prototype.at and TypedArray.prototype.at
3106401 keep LTO
cdeca4d updated to unicode 15.0.0
94010ed the BigInt support is now always included
03cc5ec fixed js_proxy_isArray stack overflow (github issue #178)
6de52d8 bf_set_ui() fix (github issue #133)
2788d71 updated to Unicode 14.0.0
8516959 updated test262.conf
446099a added Object.hasOwn()
b9f5880 fixed invalid Array.prototype.push/unshift optimization

git-subtree-dir: quickjs
git-subtree-split: daa35bc1e5d43192098af9b51caeb4f18f73f9f9") [b5e6289](https://github.com/GerHobbelt/quickjs/commit/b5e62895c619d4ffc75c9d822c8d85f1ece77e5b)[..](/GerHobbelt/quickjs/commit/df7887abe563a081117936996ba3f60f145cb793 "Squashed 'quickjs/' changes from b5e6289..daa35bc

daa35bc new release
a057008 added Array.prototype.findLast{Index} and TypeArray.prototype.findLast{index} (initial patch by bnoordhuis)
177af41 fixed duplicate static private setter/getter test
b180cd2 Symbol.species is no longer used in TypedArray constructor from a TypedArray
e182050 fixed delete super.x error
58f374e reworked set property and fixed corner cases of typed array set property
20a57f9 Implement extended named capture group identifiers (bnoordhuis)
4949d75 Retrieve RegExp 'g' flag in spec conformant way (original patch by bnoordhuis)
c4cdd61 fixed lexical scope of 'this' with eval (github issue #192)
26fdf65 Make Date methods argument coercion spec compliant (bnoordhuis)
b14d77b fixed negative zero date
55a4878 fixed private field setters (github issue #194)
321dbfa added missing bignum error tests (github issue #159)
f87cab0 added String.prototype.at, Array.prototype.at and TypedArray.prototype.at
3106401 keep LTO
cdeca4d updated to unicode 15.0.0
94010ed the BigInt support is now always included
03cc5ec fixed js_proxy_isArray stack overflow (github issue #178)
6de52d8 bf_set_ui() fix (github issue #133)
2788d71 updated to Unicode 14.0.0
8516959 updated test262.conf
446099a added Object.hasOwn()
b9f5880 fixed invalid Array.prototype.push/unshift optimization

git-subtree-dir: quickjs
git-subtree-split: daa35bc1e5d43192098af9b51caeb4f18f73f9f9")[daa35bc](https://github.com/GerHobbelt/quickjs/commit/daa35bc1e5d43192098af9b51caeb4f18f73f9f9)`
…

`[df7887a](/GerHobbelt/quickjs/commit/df7887abe563a081117936996ba3f60f145cb793)`

```
[daa35bc](https://github.com/GerHobbelt/quickjs/commit/daa35bc1e5d43192098af9b51caeb4f18f73f9f9) new release
[a057008](https://github.com/GerHobbelt/quickjs/commit/a0570086c698f78ec829cafd7d8d7ac3906abbc1) added Array.prototype.findLast{Index} and TypeArray.prototype.findLast{index} (initial patch by bnoordhuis)
[177af41](https://github.com/GerHobbelt/quickjs/commit/177af416659188e114545d1194b23463baef2598) fixed duplicate static private setter/getter test
[b180cd2](https://github.com/GerHobbelt/quickjs/commit/b180cd2c439731d2fba39274f74c12ea9793dfd0) Symbol.species is no longer used in TypedArray constructor from a TypedArray
[e182050](https://github.com/GerHobbelt/quickjs/commit/e182050771b5971643be4e2391e2ba6f05eb1665) fixed delete super.x error
[58f374e](https://github.com/GerHobbelt/quickjs/commit/58f374ef424f02bde22dbc844f2e6f6c4fb6e1a6) reworked set property and fixed corner cases of typed array set property
[20a57f9](https://github.com/GerHobbelt/quickjs/commit/20a57f90d7c3b9916424d7db55d17dc354f3a636) Implement extended named capture group identifiers (bnoordhuis)
[4949d75](https://github.com/GerHobbelt/quickjs/commit/4949d75dafcd3401aac4cc75e76bbd680fc67b47) Retrieve RegExp 'g' flag in spec conformant way (original patch by bnoordhuis)
[c4cdd61](https://github.com/GerHobbelt/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077) fixed lexical scope of 'this' with eval (github issue [bellard#192](https://github.com/bellard/quickjs/issues/192))
[26fdf65](https://github.com/GerHobbelt/quickjs/commit/26fdf659e379a29afb47f1fd46e709b3576645fd) Make Date methods argument coercion spec compliant (bnoordhuis)
[b14d77b](https://github.com/GerHobbelt/quickjs/commit/b14d77be5b993fea6000d78a7e83c41f465b9611) fixed negative zero date
[55a4878](https://github.com/GerHobbelt/quickjs/commit/55a4878a605a6707b1754b4b807deec62c8fc895) fixed private field setters (github issue [bellard#194](https://github.com/bellard/quickjs/issues/194))
[321dbfa](https://github.com/GerHobbelt/quickjs/commit/321dbfa770463b8867d8ac90493c7cec015a9c3a) added missing bignum error tests (github issue [bellard#159](https://github.com/bellard/quickjs/issues/159))
[f87cab0](https://github.com/GerHobbelt/quickjs/commit/f87cab0fc62866f4d4dfff0526adebe4fda364e2) added String.prototype.at, Array.prototype.at and TypedArray.prototype.at
[3106401](https://github.com/GerHobbelt/quickjs/commit/310640199114db44af579b5c7164c8f331dd5815) keep LTO
[cdeca4d](https://github.com/GerHobbelt/quickjs/commit/cdeca4de42e04a2527dc5b8a299b5ad87c6f1a1d) updated to unicode 15.0.0
[94010ed](https://github.com/GerHobbelt/quickjs/commit/94010edb5794b06e122cfb9ea6ed9c6be9db6c03) the BigInt support is now always included
[03cc5ec](https://github.com/GerHobbelt/quickjs/commit/03cc5ecc88f8534a5db5c911df4b712a21d08fb8) fixed js_proxy_isArray stack overflow (github issue [bellard#178](https://github.com/bellard/quickjs/issues/178))
[6de52d8](https://github.com/GerHobbelt/quickjs/commit/6de52d878ae8ee06e4a59cbd2e77d84704c9f602) bf_set_ui() fix (github issue [bellard#133](https://github.com/bellard/quickjs/issues/133))
[2788d71](https://github.com/GerHobbelt/quickjs/commit/2788d71e823b522b178db3b3660ce93689534e6d) updated to Unicode 14.0.0
[8516959](https://github.com/GerHobbelt/quickjs/commit/851695958a224decffa65ea0c8b6622d19a971ba) updated test262.conf
[446099a](https://github.com/GerHobbelt/quickjs/commit/446099aa9ebd7fcd54d3fdc6f6b25ee8c8c97a7d) added Object.hasOwn()
[b9f5880](https://github.com/GerHobbelt/quickjs/commit/b9f58802dc8d3e6d8dfb65434dee63c7611c05e8) fixed invalid Array.prototype.push/unshift optimization

git-subtree-dir: quickjs
git-subtree-split: [daa35bc](https://github.com/GerHobbelt/quickjs/commit/daa35bc1e5d43192098af9b51caeb4f18f73f9f9)
```

[xplshn](/xplshn)
pushed a commit
to xplshn/Mirror-of-the-Chawan-web-browser
that referenced
this issue
[Apr 9, 2024](#ref-commit-9ff482d)
[![@bptato](https://avatars.githubusercontent.com/u/60043228?s=40&v=4)](/bptato)

`[add_eval_variables: do not close over `this' twice](/xplshn/Mirror-of-the-Chawan-web-browser/commit/9ff482dd8d5b1b252e77712e9418b5b253f4bbf8 "add_eval_variables: do not close over `this' twice

See https://github.com/bellard/quickjs/issues/192. (Thanks to @dchest
for the proposed fix.)")`
…

`[9ff482d](/xplshn/Mirror-of-the-Chawan-web-browser/commit/9ff482dd8d5b1b252e77712e9418b5b253f4bbf8)`

```
See [bellard/quickjs#192](https://github.com/bellard/quickjs/issues/192). (Thanks to [@dchest](https://github.com/dchest)
for the proposed fix.)
```

[aureliendavid](/aureliendavid)
added a commit
to gpac/gpac
that referenced
this issue
[Sep 24, 2024](#ref-commit-da5a086)
[![@aureliendavid](https://avatars.githubusercontent.com/u/7168263?s=40&u=6769abc5948f9e1e3d5c88c6cd492a7eca0f7532&v=4)](/aureliendavid)

`[quickjs: backport fix to](/gpac/gpac/commit/da5a086d095d6bf931012b489d181653d48df128 "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183") [CVE-2023-48183](https://github.com/advisories/GHSA-2c9q-jgx6-2qx7 "CVE-2023-48183") [(](/gpac/gpac/commit/da5a086d095d6bf931012b489d181653d48df128 "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183")[#2951](https://github.com/gpac/gpac/issues/2951)[), details:](/gpac/gpac/commit/da5a086d095d6bf931012b489d181653d48df128 "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183")`
…

`[da5a086](/gpac/gpac/commit/da5a086d095d6bf931012b489d181653d48df128)`

```
original issue: [bellard/quickjs#192](https://github.com/bellard/quickjs/issues/192)
fix backported from commit: [bellard/quickjs@c4cdd61](https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077)
CVE record: <https://www.cve.org/CVERecord?id=CVE-2023-48183>
```

[![@aureliendavid](https://avatars.githubusercontent.com/u/7168263?s=40&u=6769abc5948f9e1e3d5c88c6cd492a7eca0f7532&v=4)](/aureliendavid)
[aureliendavid](/aureliendavid)
mentioned this issue
[Sep 24, 2024](#ref-issue-2506803965)

[Security Vulnerability - Action Required: NULL Pointer Dereference vulnerability may in your project
gpac/gpac#2951](/gpac/gpac/issues/2951)

Closed

[jwcullen](/jwcullen)
pushed a commit
to jwcullen/gpac
that referenced
this issue
[Oct 4, 2024](#ref-commit-11876ed)
[![@aureliendavid](https://avatars.githubusercontent.com/u/7168263?s=40&u=6769abc5948f9e1e3d5c88c6cd492a7eca0f7532&v=4)](/aureliendavid) [![@jwcullen](https://avatars.githubusercontent.com/u/11685079?s=40&v=4)](/jwcullen)

`[quickjs: backport fix to](/jwcullen/gpac/commit/11876ede44aa1691d36e0e09c673cb3ea0d8828d "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183") [CVE-2023-48183](https://github.com/advisories/GHSA-2c9q-jgx6-2qx7 "CVE-2023-48183") [(](/jwcullen/gpac/commit/11876ede44aa1691d36e0e09c673cb3ea0d8828d "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183")[gpac#2951](https://github.com/gpac/gpac/issues/2951)[), details:](/jwcullen/gpac/commit/11876ede44aa1691d36e0e09c673cb3ea0d8828d "quickjs: backport fix to CVE-2023-48183 (#2951), details:

original issue: https://github.com/bellard/quickjs/issues/192
fix backported from commit: https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077
CVE record: https://www.cve.org/CVERecord?id=CVE-2023-48183")`
…

`[11876ed](/jwcullen/gpac/commit/11876ede44aa1691d36e0e09c673cb3ea0d8828d)`

```
original issue: [bellard/quickjs#192](https://github.com/bellard/quickjs/issues/192)
fix backported from commit: [bellard/quickjs@c4cdd61](https://github.com/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077)
CVE record: <https://www.cve.org/CVERecord?id=CVE-2023-48183>
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fissues%2F192)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

3 participants

[![@dchest](https://avatars.githubusercontent.com/u/52677?s=52&v=4)](/dchest) [![@bellard](https://avatars.githubusercontent.com/u/6490144?s=52&v=4)](/bellard) [![@anbu1024](https://avatars.githubusercontent.com/u/54770089?s=52&v=4)](/anbu1024)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1733432f_20250111_171026.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fcommit%2Fc4cdd61a3ed284cd760faf6b00bbf0cb908da077)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fcommit%2Fc4cdd61a3ed284cd760faf6b00bbf0cb908da077)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=bellard%2Fquickjs)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[bellard](/bellard)
/
**[quickjs](/bellard/quickjs)**
Public

* [Notifications](/login?return_to=%2Fbellard%2Fquickjs) You must be signed in to change notification settings
* [Fork
  916](/login?return_to=%2Fbellard%2Fquickjs)
* [Star
   8.7k](/login?return_to=%2Fbellard%2Fquickjs)

* [Code](/bellard/quickjs)
* [Issues
  88](/bellard/quickjs/issues)
* [Pull requests
  39](/bellard/quickjs/pulls)
* [Actions](/bellard/quickjs/actions)
* [Projects
  0](/bellard/quickjs/projects)
* [Security](/bellard/quickjs/security)
* [Insights](/bellard/quickjs/pulse)

Additional navigation options

* [Code](/bellard/quickjs)
* [Issues](/bellard/quickjs/issues)
* [Pull requests](/bellard/quickjs/pulls)
* [Actions](/bellard/quickjs/actions)
* [Projects](/bellard/quickjs/projects)
* [Security](/bellard/quickjs/security)
* [Insights](/bellard/quickjs/pulse)

## Commit

[Permalink](/bellard/quickjs/commit/c4cdd61a3ed284cd760faf6b00bbf0cb908da077)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

fixed lexical scope of 'this' with eval (github issue [#192](https://github.com/bellard/quickjs/issues/192))

[Browse files](/bellard/quickjs/tree/c4cdd61a3ed284cd760faf6b00bbf0cb908da077)
Browse the repository at this point in the history

* Loading branch information

Fabrice Bellard
committed
Dec 9, 2023

1 parent
[26fdf65](/bellard/quickjs/commit/26fdf659e379a29afb47f1fd46e709b3576645fd)

commit c4cdd61

Showing
**1 changed file**
with
**7 additions**
and
**6 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

13 changes: 7 additions & 6 deletions

13
[quickjs.c](#diff-45f1ae674139f993bf8a99c382c1ba4863272a6fec2f492d76d7ff1b2cfcfbe2 "quickjs.c")

Show comments

[View file](/bellard/quickjs/blob/c4cdd61a3ed284cd760faf6b00bbf0cb908da077/quickjs.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29993,12 +29993,13 @@ static void add\_eval\_variables(JSContext \*ctx, JSFunctionDef \*s) |
|  |  | is\_arg\_scope = (scope\_idx == ARG\_SCOPE\_END); |
|  |  | if (!is\_arg\_scope) { |
|  |  | /\* add unscoped variables \*/ |
|  |  | /\* XXX: propagate is\_const and var\_kind too ? \*/ |
|  |  | for(i = 0; i < fd->arg\_count; i++) { |
|  |  | vd = &fd->args[i]; |
|  |  | if (vd->var\_name != JS\_ATOM\_NULL) { |
|  |  | get\_closure\_var(ctx, s, fd, |
|  |  | TRUE, i, vd->var\_name, FALSE, FALSE, |
|  |  | JS\_VAR\_NORMAL); |
|  |  | TRUE, i, vd->var\_name, FALSE, |
|  |  | vd->is\_lexical, JS\_VAR\_NORMAL); |
|  |  | } |
|  |  | } |
|  |  | for(i = 0; i < fd->var\_count; i++) { |
| Expand All | | @@ -30008,8 +30009,8 @@ static void add\_eval\_variables(JSContext \*ctx, JSFunctionDef \*s) |
|  |  | vd->var\_name != JS\_ATOM\_\_ret\_ && |
|  |  | vd->var\_name != JS\_ATOM\_NULL) { |
|  |  | get\_closure\_var(ctx, s, fd, |
|  |  | FALSE, i, vd->var\_name, FALSE, FALSE, |
|  |  | JS\_VAR\_NORMAL); |
|  |  | FALSE, i, vd->var\_name, FALSE, |
|  |  | vd->is\_lexical, JS\_VAR\_NORMAL); |
|  |  | } |
|  |  | } |
|  |  | } else { |
| Expand All | | @@ -30018,8 +30019,8 @@ static void add\_eval\_variables(JSContext \*ctx, JSFunctionDef \*s) |
|  |  | /\* do not close top level last result \*/ |
|  |  | if (vd->scope\_level == 0 && is\_var\_in\_arg\_scope(vd)) { |
|  |  | get\_closure\_var(ctx, s, fd, |
|  |  | FALSE, i, vd->var\_name, FALSE, FALSE, |
|  |  | JS\_VAR\_NORMAL); |
|  |  | FALSE, i, vd->var\_name, FALSE, |
|  |  | vd->is\_lexical, JS\_VAR\_NORMAL); |
|  |  | } |
|  |  | } |
|  |  | } |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `c4cdd61`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fbellard%2Fquickjs%2Fcommit%2Fc4cdd61a3ed284cd760faf6b00bbf0cb908da077) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


