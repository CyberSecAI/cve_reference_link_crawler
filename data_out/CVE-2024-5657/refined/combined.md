=== Content from github.com_108abff5_20250110_201234.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fborn05%2Fcraft-twofactorauthentication%2Freleases%2Ftag%2F3.3.4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fborn05%2Fcraft-twofactorauthentication%2Freleases%2Ftag%2F3.3.4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Freleases%2Fshow&source=header-repo&source_repo=born05%2Fcraft-twofactorauthentication)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[born05](/born05)
/
**[craft-twofactorauthentication](/born05/craft-twofactorauthentication)**
Public

* [Notifications](/login?return_to=%2Fborn05%2Fcraft-twofactorauthentication) You must be signed in to change notification settings
* [Fork
  26](/login?return_to=%2Fborn05%2Fcraft-twofactorauthentication)
* [Star
   36](/login?return_to=%2Fborn05%2Fcraft-twofactorauthentication)

* [Code](/born05/craft-twofactorauthentication/tree/3.3.4)
* [Issues
  2](/born05/craft-twofactorauthentication/issues)
* [Pull requests
  0](/born05/craft-twofactorauthentication/pulls)
* [Actions](/born05/craft-twofactorauthentication/actions)
* [Projects
  0](/born05/craft-twofactorauthentication/projects)
* [Security](/born05/craft-twofactorauthentication/security)
* [Insights](/born05/craft-twofactorauthentication/pulse)

Additional navigation options

* [Code](/born05/craft-twofactorauthentication/tree/3.3.4)
* [Issues](/born05/craft-twofactorauthentication/issues)
* [Pull requests](/born05/craft-twofactorauthentication/pulls)
* [Actions](/born05/craft-twofactorauthentication/actions)
* [Projects](/born05/craft-twofactorauthentication/projects)
* [Security](/born05/craft-twofactorauthentication/security)
* [Insights](/born05/craft-twofactorauthentication/pulse)

1. [Releases](/born05/craft-twofactorauthentication/releases)
2. [3.3.4](/born05/craft-twofactorauthentication/releases/tag/3.3.4)

# 3.3.4

 Compare

Choose a tag to compare

Could not load tags

Nothing to show

[{{ refName }}
default](/born05/craft-twofactorauthentication/compare/%7B%7B%20urlEncodedRefName%20%7D%7D...3.3.4)

 Loading

[View all tags](/born05/craft-twofactorauthentication/tags)

![@roelvanhintum](https://avatars.githubusercontent.com/u/1023734?s=40&v=4)
[roelvanhintum](/roelvanhintum)
released this
08 Feb 15:40

·
[6 commits](/born05/craft-twofactorauthentication/compare/3.3.4...craft-4)
to craft-4
since this release

[3.3.4](/born05/craft-twofactorauthentication/tree/3.3.4)

[`95af537`](/born05/craft-twofactorauthentication/commit/95af537ff3de0fe699d7f9a16a349fa870089387)

### Fixed

* fix: Exposure of Sensitive Attributes
* fix: Corrected the single use token time window

 Assets
2

 Loading

All reactions

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from plugins.craftcms.com_42d60e4a_20250110_201236.html ===
 Craft CMS Version Craft 5 Plugin StoreCraft 4 Plugin StoreCraft 3 Plugin Store

* [Discover](/?craft4 "Discover Craft CMS plugins")
* [![SEO & Accessibility icon](https://pluginicons.craft-cdn.com/seomatic.svg?1520963488) SEO & Accessibility](/categories/seo?craft4 "SEO & Accessibility plugins for Craft CMS")
* [![Localization icon](https://pluginicons.craft-cdn.com/translations-admin.svg?1575487729) Localization](/categories/localization?craft4 "Localization plugins for Craft CMS")
* [![Ecommerce icon](https://pluginicons.craft-cdn.com/commerce.svg?1714501520) Ecommerce](/categories/ecommerce?craft4 "Ecommerce plugins for Craft CMS")
* [![Forms icon](https://pluginicons.craft-cdn.com/formie.svg?1595214200) Forms](/categories/forms?craft4 "Forms plugins for Craft CMS")
* [![Fields icon](https://pluginicons.craft-cdn.com/ckeditor.svg?1681327733) Fields](/categories/fields?craft4 "Fields plugins for Craft CMS")
* [![Development icon](https://pluginicons.craft-cdn.com/dumper.svg?1691090485) Development](/categories/development?craft4 "Development plugins for Craft CMS")
* [![Security icon](https://pluginicons.craft-cdn.com/sherlock.svg?1611155143) Security](/categories/security?craft4 "Security plugins for Craft CMS")
* [![Templating icon](https://pluginicons.craft-cdn.com/blitz.svg?1699016019) Templating](/categories/templating?craft4 "Templating plugins for Craft CMS")
* [![Performance icon](https://pluginicons.craft-cdn.com/imager-x.svg?1581424127) Performance](/categories/performance?craft4 "Performance plugins for Craft CMS")
* [![Control Panel icon](https://pluginicons.craft-cdn.com/expanded-singles.svg?1542840586) Control Panel](/categories/control-panel?craft4 "Control Panel plugins for Craft CMS")
* [![Widgets icon](https://pluginicons.craft-cdn.com/diy-widgetypcrCWIgwKaaMXcGJ61KEDb5WivDhVDvbkGt.svg?1527589840) Widgets](/categories/widgets?craft4 "Widgets plugins for Craft CMS")
* [![Assets icon](https://pluginicons.craft-cdn.com/aws-s3.svg?1511197212) Assets](/categories/assets?craft4 "Assets plugins for Craft CMS")
* [![Utilities icon](https://pluginicons.craft-cdn.com/feed-me.svg?1554833500) Utilities](/categories/utilities?craft4 "Utilities plugins for Craft CMS")
* [![Mailer Adapters icon](https://pluginicons.craft-cdn.com/mailgun.svg?1511197213) Mailer Adapters](/categories/mailer-adapters?craft4 "Mailer Adapters plugins for Craft CMS")
* [![Social Networking icon](https://pluginicons.craft-cdn.com/craftagram.svg?1583943893) Social Networking](/categories/social-networking?craft4 "Social Networking plugins for Craft CMS")
* [![Integrations icon](https://pluginicons.craft-cdn.com/shopify.svg?1667939687) Integrations](/categories/integrations?craft4 "Integrations plugins for Craft CMS")

* [craftcms.com](https://craftcms.com/ "Craft CMS")
* [Craft Console](https://console.craftcms.com/ "Craft Console")
![Two-Factor Authentication icon](https://pluginicons.craft-cdn.com/two-factor-authenticationEBWSdBvsyCIGRhNPLMgs1P3fNBRLCU4aQDXa.svg?1530274233)
# Two-Factor Authentication

[Born05](/developer/born05?craft4 "Born05")

* [Overview](/two-factor-authentication?craft4)
* [Reviews](/two-factor-authentication/reviews?craft4)
* [Changelog](/two-factor-authentication/changelog?craft4)

**This plugin is no longer maintained.**![Plugin screenshot thumbnail 1/3](https://pluginscreenshots.craft-cdn.com/two-factor-authentication/_550xAUTO_crop_center-center_none/settings-turn-on.png?1530274329)![Plugin screenshot thumbnail 2/3](https://pluginscreenshots.craft-cdn.com/two-factor-authentication/_550xAUTO_crop_center-center_none/settings-turn-off.png?1530274330)![Plugin screenshot thumbnail 3/3](https://pluginscreenshots.craft-cdn.com/two-factor-authentication/_550xAUTO_crop_center-center_none/login-verification.png?1530274332)

Abandoned as of Craft 5. Please use Craft's native 2FA instead of this plugin.

Plugin for two-factor or two-step login using Time Based OTP (TOTP, like Google Authenticator). Every user can setup TOTP themselves, the plugin does not force users. Admins can list usage in user tables.

* [Documentation](https://github.com/born05/craft-twofactorauthentication "Two-Factor Authentication Documentation")
* [Repository](https://github.com/born05/craft-twofactorauthentication "Two-Factor Authentication Repository")

 Installation Instructions

* Shell
* DDEV
Installation instructions

To install this plugin, copy the command above to your terminal.

Reviews

This plugin doesn't have any reviews.

 [Leave a review](https://console.craftcms.com/accounts/me/plugin-store/reviews/two-factor-authentication)  Active Installs 1,262 Version 3.4.0 License MIT Compatibility

Craft 3, Craft 4 Last release June 27, 2024 Categories

* [Security](/categories/security?craft4 "Security plugins for Craft CMS")

 Activity (30 days)0 Closed Issues 1 Open Issues 0 Merged PRs 0 Open PRs

* Report plugin



=== Content from github.com_72366f70_20250110_201234.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsbaresearch%2Fadvisories%2Ftree%2Fpublic%2F2024%2FSBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsbaresearch%2Fadvisories%2Ftree%2Fpublic%2F2024%2FSBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Ffiles%2Fdisambiguate&source=header-repo&source_repo=sbaresearch%2Fadvisories)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[sbaresearch](/sbaresearch)
/
**[advisories](/sbaresearch/advisories)**
Public

* [Notifications](/login?return_to=%2Fsbaresearch%2Fadvisories) You must be signed in to change notification settings
* [Fork
  4](/login?return_to=%2Fsbaresearch%2Fadvisories)
* [Star
   22](/login?return_to=%2Fsbaresearch%2Fadvisories)

* [Code](/sbaresearch/advisories)
* [Issues
  0](/sbaresearch/advisories/issues)
* [Pull requests
  0](/sbaresearch/advisories/pulls)
* [Actions](/sbaresearch/advisories/actions)
* [Projects
  0](/sbaresearch/advisories/projects)
* [Security](/sbaresearch/advisories/security)
* [Insights](/sbaresearch/advisories/pulse)

Additional navigation options

* [Code](/sbaresearch/advisories)
* [Issues](/sbaresearch/advisories/issues)
* [Pull requests](/sbaresearch/advisories/pulls)
* [Actions](/sbaresearch/advisories/actions)
* [Projects](/sbaresearch/advisories/projects)
* [Security](/sbaresearch/advisories/security)
* [Insights](/sbaresearch/advisories/pulse)

## Files

 public
## Breadcrumbs

1. [advisories](/sbaresearch/advisories/tree/public)
2. /[2024](/sbaresearch/advisories/tree/public/2024)
/
# SBA-ADV-20240202-01\_CraftCMS\_Plugin\_Two-Factor\_Authentication\_Password\_Hash\_Disclosure

/Copy path
## Directory actions

## More options

## Directory actions

## More options

## Latest commit

## History

[History](/sbaresearch/advisories/commits/public/2024/SBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure) public
## Breadcrumbs

1. [advisories](/sbaresearch/advisories/tree/public)
2. /[2024](/sbaresearch/advisories/tree/public/2024)
/
# SBA-ADV-20240202-01\_CraftCMS\_Plugin\_Two-Factor\_Authentication\_Password\_Hash\_Disclosure

/Top
## Folders and files

| Name | | Name | Last commit message | Last commit date |
| --- | --- | --- | --- | --- |
| parent directory[..](/sbaresearch/advisories/tree/public/2024) | | |
| [README.md](/sbaresearch/advisories/blob/public/2024/SBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure/README.md "README.md") | | [README.md](/sbaresearch/advisories/blob/public/2024/SBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure/README.md "README.md") |  |  |
| View all files | | |

## [README.md](#readme)

# CraftCMS Plugin - Two-Factor Authentication - Password Hash Disclosure

## Vulnerability Overview

The CraftCMS plugin Two-Factor Authentication in versions 3.3.1, 3.3.2 and
3.3.3 discloses the password hash of the currently authenticated user after
submitting a valid TOTP.

* **Identifier** : SBA-ADV-20240202-01
* **Type of Vulnerability** : Exposure of Sensitive Attributes
* **Software/Product Name** : [Two-Factor Authentication](https://plugins.craftcms.com/two-factor-authentication?craft4)
* **Vendor** : [Born05](https://www.born05.com/en/)
* **Affected Versions** : 3.3.1, 3.3.2 and 3.3.3
* **Fixed in Version** : 3.3.4
* **CVE ID** : CVE-2024-5657
* **CVSS Vector** : CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N
* **CVSS Base Score** : 3.7 (Low)

## Vendor Description

> Craft 4 plugin for two-factor or two-step login using Time Based OTP (TOTP,
> like Google Authenticator).

Source: <https://github.com/born05/craft-twofactorauthentication>

## Impact

Assuming that an attacker obtains the session of a victim. Then, the attacker
is able to retrieve the password-hash of the victim, which constitues an
authorization vulnerability. In general, users should not even be able to
read their own password hashes. In the worst case the attacker is able to
obtain the cleartext password by cracking the password hash. Then, the
attacker can disable MFA from within the hijacked session and consecutively
establish new sessions in the context of the victim.

## Vulnerability Description

After submitting the `authenticationCode`, the server responds in case of
success, with the password hash of the authenticated user. The
`authenticationCode` is the time-based one-time password associated with the
authenticatd user. This `authenticationCode` can be submitted on at least the
following endpoints:

1. `/index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fsettings%2Fturn-on`
2. `/index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fverify%2Flogin-process`

The first endpoint is used to enroll a second factor, while the second
endpoint is used in the authentication process to verify the second factor.

A user who has two factor authentication enabled is not protected from this
attack, since two factor authentication can be disabled and re-enrolled
without entering a password. After re-enrolling the attack will obtain the
password-hash. The HTTP response that contains the password-hash has the HTTP
header `Cache-Control: no-cache, no-store, must-revalidate` set, meaning, the
browser does not cache the response.

Due to the disclosure of the password hash, there is the possibility that the
attacker is able to prolong the access to the account beyond the lifetime of
a single session obtained from the victim. Furthermore, the attacker might
use the password in credential stuffing attacks against other services.

## Proof of Concept

Assuming that an attacker is in control of the session of a victim.

If the victim has two factor authentication enabled, the attacker can disable
it. The plugin then reveals a newly generated shared secret which the
attacker can use to calculate the current one-time password. With the
following request the attacker reenables two factor authentication.

```
POST /index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fsettings%2Fturn-on HTTP/1.1
Host: example.com
Cookie: CraftSessionId=[...];
[...]

{
    "authenticationCode": "123456"
}
```

If the `authenticationCode` is a valid TOTP, the server returns a response
containing the password hash of the victim.

```
HTTP/1.1 200 OK
[...]

{
    [...]
    "user": {
        "password": "$2y$13$[...]",
        [...]
    }
}
```

## Recommended Countermeasures

We recommend to update to version 3.3.4 or later, which applies the following
countermeasure.

We suggest to never disclose the password hash to the user.

## Timeline

* `2024-02-02`: Identified the vulnerability in version 3.3.2
* `2024-02-04`: Contacted the Maintainer
* `2024-02-05`: Vulnerability disclosed to the Maintainer
* `2024-02-07`: Requested CVE from MITRE
* `2024-02-08`: Maintainer released version 3.3.3 which is still vulnerable
* `2024-02-08`: Maintainer fixed the vulnerability in version 3.3.4
* `2024-06-04`: SBA Research becomes a CNA
* `2024-06-05`: SBA Research assigned CVE-2024-5657
* `2024-06-06`: Public disclosure

## References

* Advisory regarding a similar vulnerability in CraftCMS (CVE-2022-37783): <https://at-trustit.tuvaustria.com/tuev-trust-it-cves/cve-disclosure-of-password-hashes/>

## Credits

* Fabian Funder ([SBA Research](https://www.sba-research.org/))
* Jakob Pachmann ([SBA Research](https://www.sba-research.org/))

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from www.openwall.com_7502aa17_20250110_201233.html ===


| [Openwall](/) * [Products](/)   + [Openwall GNU/\*/Linux   *server OS*](/Owl/)+ [Linux Kernel Runtime Guard](/lkrg/)+ [John the Ripper   *password cracker*](/john/)         - [Free & Open Source for any platform](/john/)- [in the cloud](/john/cloud/)- [Pro for Linux](/john/pro/linux/)- [Pro for macOS](/john/pro/macosx/)+ [Wordlists   *for password cracking*](/wordlists/)+ [passwdqc   *policy enforcement*](/passwdqc/)             - [Free & Open Source for Unix](/passwdqc/)- [Pro for Windows (Active Directory)](/passwdqc/windows/)+ [yescrypt   *KDF & password hashing*](/yescrypt/)+ [yespower   *Proof-of-Work (PoW)*](/yespower/)+ [crypt\_blowfish   *password hashing*](/crypt/)+ [phpass   *ditto in PHP*](/phpass/)+ [tcb   *better password shadowing*](/tcb/)+ [Pluggable Authentication Modules](/pam/)+ [scanlogd   *port scan detector*](/scanlogd/)+ [popa3d   *tiny POP3 daemon*](/popa3d/)+ [blists   *web interface to mailing lists*](/blists/)+ [msulogin   *single user mode login*](/msulogin/)+ [php\_mt\_seed   *mt\_rand() cracker*](/php_mt_seed/)* [Services](/services/)* Publications       + [Articles](/articles/)+ [Presentations](/presentations/)* Resources         + [Mailing lists](/lists/)+ [Community wiki](https://openwall.info/wiki/)+ [Source code repositories (GitHub)](https://github.com/openwall)+ [Source code repositories (CVSweb)](https://cvsweb.openwall.com)+ [File archive & mirrors](/mirrors/)+ [How to verify digital signatures](/signatures/)+ [OVE IDs](/ove/)* [What's new](/news) | |
| --- | --- |

| | [Hash Suite - Windows password security audit tool. GUI, reports in PDF.](https://hashsuite.openwall.net) | | --- | |
| --- | --- |

[[<prev]](../../../2024/06/05/1) [[next>]](2) [[day]](.) [[month]](..) [[year]](../..) [[list]](../../..)
```

Message-ID: <92dbfa1d939d4940b121deed26f1e2f4@sba-research.org>
Date: Thu, 6 Jun 2024 10:44:13 +0000
From: SBA Research Security Advisory <advisory@...-research.org>
To: "oss-security@...ts.openwall.com" <oss-security@...ts.openwall.com>
Subject: [SBA-ADV-20240202-01] CVE-2024-5657: CraftCMS Plugin - Two-Factor
 Authentication 3.3.1 to 3.3.3 - Password Hash Disclosure

-----BEGIN PGP SIGNED MESSAGE-----
Hash: SHA256

# CraftCMS Plugin - Two-Factor Authentication - Password Hash Disclosure #

Link: <https://github.com/sbaresearch/advisories/tree/public/2024/SBA-ADV-20240202-01_CraftCMS_Plugin_Two-Factor_Authentication_Password_Hash_Disclosure>

## Vulnerability Overview ##

The CraftCMS plugin Two-Factor Authentication in versions 3.3.1, 3.3.2 and
3.3.3 discloses the password hash of the currently authenticated user after
submitting a valid TOTP.

* **Identifier**            : SBA-ADV-20240202-01
* **Type of Vulnerability** : Exposure of Sensitive Attributes
* **Software/Product Name** : [Two-Factor Authentication](<https://plugins.craftcms.com/two-factor-authentication?craft4>)
* **Vendor**                : [Born05](<https://www.born05.com/en/>)
* **Affected Versions**     : 3.3.1, 3.3.2 and 3.3.3
* **Fixed in Version**      : 3.3.4
* **CVE ID**                : CVE-2024-5657
* **CVSS Vector**           : CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:L/I:N/A:N
* **CVSS Base Score**       : 3.7 (Low)

## Vendor Description ##

> Craft 4 plugin for two-factor or two-step login using Time Based OTP (TOTP,
> like Google Authenticator).

Source: <<https://github.com/born05/craft-twofactorauthentication>>

## Impact ##

Assuming that an attacker obtains the session of a victim. Then, the attacker
is able to retrieve the password-hash of the victim, which constitues an
authorization vulnerability. In general, users should not even be able to
read their own password hashes. In the worst case the attacker is able to
obtain the cleartext password by cracking the password hash. Then, the
attacker can disable MFA from within the hijacked session and consecutively
establish new sessions in the context of the victim.

## Vulnerability Description ##

After submitting the `authenticationCode`, the server responds in case of
success, with the password hash of the authenticated user. The
`authenticationCode` is the time-based one-time password associated with the
authenticatd user. This `authenticationCode` can be submitted on at least the
following endpoints:

1. `/index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fsettings%2Fturn-on`
2. `/index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fverify%2Flogin-process`

The first endpoint is used to enroll a second factor, while the second
endpoint is used in the authentication process to verify the second factor.

A user who has two factor authentication enabled is not protected from this
attack, since two factor authentication can be disabled and re-enrolled
without entering a password. After re-enrolling the attack will obtain the
password-hash. The HTTP response that contains the password-hash has the HTTP
header `Cache-Control: no-cache, no-store, must-revalidate` set, meaning, the
browser does not cache the response.

Due to the disclosure of the password hash, there is the possibility that the
attacker is able to prolong the access to the account beyond the lifetime of
a single session obtained from the victim. Furthermore, the attacker might
use the password in credential stuffing attacks against other services.

## Proof of Concept ##

Assuming that an attacker is in control of the session of a victim.

If the victim has two factor authentication enabled, the attacker can disable
it. The plugin then reveals a newly generated shared secret which the
attacker can use to calculate the current one-time password. With the
following request the attacker reenables two factor authentication.

```http
POST /index.php?p=admin%2Factions%2Ftwo-factor-authentication%2Fsettings%2Fturn-on HTTP/1.1
Host: example.com
Cookie: CraftSessionId=[...];
[...]

{
    "authenticationCode": "123456"
}
```

If the `authenticationCode` is a valid TOTP, the server returns a response
containing the password hash of the victim.

```http
HTTP/1.1 200 OK
[...]

{
    [...]
    "user": {
        "password": "$2y$13$[...]",
        [...]
    }
}
```

## Recommended Countermeasures ##

We recommend to update to version 3.3.4 or later, which applies the following
countermeasure.

We suggest to never disclose the password hash to the user.

## Timeline ##

* `2024-02-02`: Identified the vulnerability in version 3.3.2
* `2024-02-04`: Contacted the Maintainer
* `2024-02-05`: Vulnerability disclosed to the Maintainer
* `2024-02-07`: Requested CVE from MITRE
* `2024-02-08`: Maintainer released version 3.3.3 which is still vulnerable
* `2024-02-08`: Maintainer fixed the vulnerability in version 3.3.4
* `2024-06-04`: SBA Research becomes a CNA
* `2024-06-05`: SBA Research assigned CVE-2024-5657
* `2024-06-06`: Public disclosure

## References ##

* Advisory regarding a similar vulnerability in CraftCMS (CVE-2022-37783): <<https://at-trustit.tuvaustria.com/tuev-trust-it-cves/cve-disclosure-of-password-hashes/>>

## Credits ##

* Fabian Funder ([SBA Research](<https://www.sba-research.org/>))
* Jakob Pachmann ([SBA Research](<https://www.sba-research.org/>))
-----BEGIN PGP SIGNATURE-----

iQIzBAEBCAAdFiEEL9Wp/yZWFD9OpIt6+7iGL1j3dbIFAmZhkvgACgkQ+7iGL1j3
dbLpig//foQUBAbmK0YJahf/LLBJDIQ6l7/nt/OlJotWhkfEG/3kxmGlf/BXZ1V4
Yh1NPMWTMX1pMYA0xRGI8s0OUG51OEfEBpXEPYDYPo/G/Zx1qBBlp8UDJZ+1wwIu
sUqc+lg/i3QicRB6ZvFF88yac4/BItMn2guUuDMqPHeMuIuwBuM9FZuFazg2syOY
7y5hc3X8OxhTuVRbXYfVVFMpj2/Y96OtRV7j/5cCH2LeJi2k5pCCycZbU92yb/HQ
SnKW0HhXNXAzGdlSIq/kF/5AjNZVMumRbpjS1HvLnxE7Wu/2HzFK9EP9MtzpqzB+
6hFnxQjfOM+jVsG9Rwe6sQW+2JLof8JcVdiYVTEPgE0yjo0LmAXsi4oD6VJcnwNM
qrmTG/HZ8T9+nrhLKbzIsiGhlRaDxkVECesUvY0C6mp+9Wvppd7xIMhd+coEEPM8
4w64vaW7up1gFzN4lAxutaTg8obWW8H6QER/RKWRRqVcQh93By9vvG0dXqS/WkXx
eEG+radMCzGEq/9ntVpSAS2OAMxpFEr7Bz92QdUZeVYbyG/l+5oM9MiZJoRCBffY
BTJhl06jENKZ1ysIaAzgYLAhOZbjlmaAvvJQuLZlUdX4eSmPV49zacs97eFZi3oU
2V//0QH8EUGWQk7oa0I11pyuEjZ2E913o3jK7gFUHZEF21nqe2E=
=7rI1
-----END PGP SIGNATURE-----

```

[Powered by blists](https://www.openwall.com/blists/) - [more mailing lists](https://lists.openwall.net)

Please check out the
[Open Source Software Security Wiki](https://oss-security.openwall.org/wiki/), which is counterpart to this
[mailing list](https://oss-security.openwall.org/wiki/mailing-lists/oss-security).

Confused about [mailing lists](/lists/) and their use?
[Read about mailing lists on Wikipedia](https://en.wikipedia.org/wiki/Electronic_mailing_list)
and check out these
[guidelines on proper formatting of your messages](https://www.complang.tuwien.ac.at/anton/mail-news-errors.html).


