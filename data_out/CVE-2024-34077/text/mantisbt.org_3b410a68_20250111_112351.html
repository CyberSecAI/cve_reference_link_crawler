
Toggle sidebar [MantisBT](/bugs//) Toggle user menu

* mantisbt

  + - [All Projects](/bugs/set_project.php?project_id=0)
    - [mantisbt](/bugs/set_project.php?project_id=1)
    - [Mylyn Connector](/bugs/set_project.php?project_id=20)
    - [Plugin - agileMantis](/bugs/set_project.php?project_id=25)
    - [Plugin - CsvImport](/bugs/set_project.php?project_id=11)
    - [Plugin - CustomerManagement](/bugs/set_project.php?project_id=21)
    - [Plugin - EmailReporting](/bugs/set_project.php?project_id=10)
    - [Plugin - FilterPageEdit](/bugs/set_project.php?project_id=15)
    - [Plugin - InlineColumnConfiguration](/bugs/set_project.php?project_id=14)
    - [Plugin - LinkedCustomFields](/bugs/set_project.php?project_id=16)
    - [Plugin - MantisTouchRedirect](/bugs/set_project.php?project_id=22)
    - [Plugin - RecurrCall](/bugs/set_project.php?project_id=6)
    - [Plugin - RelatedIssuesExport](/bugs/set_project.php?project_id=13)
    - [Plugin - Reminder](/bugs/set_project.php?project_id=7)
    - [Plugin - Tasks](/bugs/set_project.php?project_id=8)
    - [Plugin - Time Tracking](/bugs/set_project.php?project_id=18)
* anonymous
  + [RSS](https://mantisbt.org/bugs/issues_rss.php)
  + [Logout](/bugs/logout_page.php)

* [My View](/bugs/my_view_page.php)
* [View Issues](/bugs/view_all_bug_page.php)
* [Change Log](/bugs/changelog_page.php)
* [Roadmap](/bugs/roadmap_page.php)
* [Wiki](/bugs/wiki.php?type=project&id=1)
* [Repositories](/bugs/plugin.php?page=Source/index)

* Anonymous
[Login](/bugs/login_page.php?return=%2Fbugs%2Fview.php%3Fid%3D34433)
[Signup for a new account](/bugs/signup_page.php)

#### View Issue Details

[Wiki](wiki.php?id=34433)[Related Changesets](#changesets)[Jump to Notes](#bugnotes)

|  | | | | | |
| --- | --- | --- | --- | --- | --- |
| ID | Project | Category | View Status | Date Submitted | Last Update |
| --- | --- | --- | --- | --- | --- |
| 0034433 | mantisbt | security | public | 2024-05-05 04:30 | 2024-05-12 12:34 |
|  | | | | | |
|
| Reporter | [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929) | Assigned To | [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) |  | |
| Priority | normal | Severity | major | Reproducibility | sometimes |
| Status | closed | Resolution | fixed |  | |
| OS | Debian GNU/Linux | OS Version | 12 (Bookworm) |  | |
| Product Version | 2.26.1 |  | | | |
| Target Version | 2.26.2 | Fixed in Version | 2.26.2 |  | |
|  | | | | | |
|
| Summary | 0034433: CVE-2024-34077: Account Takeover in Password Reset and Account Registration Feature | | | | |
| Description | The password reset and account registration feature is vulnerable to broken access control, it's possible to send HTTP request to /account\_update.php with verify\_user\_id that belongs to another user account. However, this exploit only works when the following criterial is met:   1. For password reset, target username and email must be known. 2. Link in the email must be clicked / opened, either by the user or "checked" automatically by some sort of security feature within the email. When the link is clicked / opened, data type 6 and value of 1 will be updated to the mantis\_tokens\_table. 3. Target user have not sent request to the /account\_update.php to change the password. | | | | |
| Steps To Reproduce | 1. Reset both user 1 (current user) and user 2 (target user) password or register two new users (e.g. user 1 and user 2). 2. Click the reset password link that belongs to user 2 (target user). In a real scenario, attack with user interaction (for example by tempting the target user to click the link using "phising" email) or security feature within email that will automatically "check" the link will be needed. 3. Open the reset password link received within email that belongs to user 1 (current user). 4. Follow the link until the edit account page is being shown. 5. Fill the form, submit it, intercept the request, tamper the value of verify\_user\_id parameter (e.g. from 2 to 3), and send the request. 6. Login using to an account which identified by the verify\_user\_id.   ===  Note: If the user 2 (target) previously have used either the password reset or user registration feature, and somehow the link has been clicked without the user performing actual password change to the /account\_update.php, then step 1 is not needed.  Since normal user won't be able to know which registration link has been clicked and which registration link belong to whom (don't have database access), brute force attack can be performed within the value of the verify\_user\_id parameter when sending request to the /account\_update.php | | | | |
| Additional Information | <https://github.com/mantisbt/mantisbt/security/advisories/GHSA-93x3-m7pw-ppqm>  I would like to be credited for the finding. Name: Alexander Christian Company: Vantage Point Security Indonesia | | | | |
| Tags | No tags attached. | | | | |
| Attached Files | [1 - user 1 reset password.png](file_download.php?file_id=12589&type=bug) (189,464 bytes)      [1 - user 1 reset password.png](file_download.php?file_id=12589&type=bug) (189,464 bytes)     [1.2 - user 2 reset password.png](file_download.php?file_id=12590&type=bug) (186,691 bytes)      [1.2 - user 2 reset password.png](file_download.php?file_id=12590&type=bug) (186,691 bytes)     [2 - data in mantis\_token\_table.png](file_download.php?file_id=12591&type=bug) (33,034 bytes)      [2 - data in mantis\_token\_table.png](file_download.php?file_id=12591&type=bug) (33,034 bytes)     [3 - reset password link.png](file_download.php?file_id=12592&type=bug) (17,670 bytes)      [3 - reset password link.png](file_download.php?file_id=12592&type=bug) (17,670 bytes)     [4 - open the reset password link that belong to user 1.png](file_download.php?file_id=12593&type=bug) (43,313 bytes)      [4 - open the reset password link that belong to user 1.png](file_download.php?file_id=12593&type=bug) (43,313 bytes)     [5.1 - data in the user table before submission.png](file_download.php?file_id=12594&type=bug) (7,691 bytes)      [5.1 - data in the user table before submission.png](file_download.php?file_id=12594&type=bug) (7,691 bytes)     [5.2 - original request.png](file_download.php?file_id=12595&type=bug) (107,444 bytes)      [5.2 - original request.png](file_download.php?file_id=12595&type=bug) (107,444 bytes)     [5.3 - tampered request.png](file_download.php?file_id=12596&type=bug) (174,651 bytes)      [5.3 - tampered request.png](file_download.php?file_id=12596&type=bug) (174,651 bytes)     [5.4 - data in the user table after submission.png](file_download.php?file_id=12597&type=bug) (7,225 bytes)      [5.4 - data in the user table after submission.png](file_download.php?file_id=12597&type=bug) (7,225 bytes)     [6 - login using user 2 with new creds.png](file_download.php?file_id=12598&type=bug) (189,778 bytes)      [6 - login using user 2 with new creds.png](file_download.php?file_id=12598&type=bug) (189,778 bytes)     [7 - login successful.png](file_download.php?file_id=12599&type=bug) (31,719 bytes)      [7 - login successful.png](file_download.php?file_id=12599&type=bug) (31,719 bytes)     [8.1 - brute force attempt.png](file_download.php?file_id=12600&type=bug) (134,193 bytes)      [8.1 - brute force attempt.png](file_download.php?file_id=12600&type=bug) (134,193 bytes)     [8.2 - brute force result.png](file_download.php?file_id=12601&type=bug) (241,922 bytes)      [8.2 - brute force result.png](file_download.php?file_id=12601&type=bug) (241,922 bytes) | | | | |
|  | | | | | |
|

#### Activities

| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-05 05:39  developer    [~0068885](view.php?id=34433#c68885 "Direct link to note") | Many thanks for the detailed report, I'm looking into it. |
| --- | --- |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-05 11:15  developer    [~0068886](view.php?id=34433#c68886 "Direct link to note")  Last edited: 2024-05-05 11:16 | I had a look and can confirm the issue.  In fact it's even worse than you describe, because it is actually possible to reset the password of any user that has a pending TOKEN\_ACCOUNT\_VERIFY, without the attacker even owning an account, using a brute-force approach calling account\_update.php with increasing user IDs with a simple request like so:  ``` curl -X POST http://example.com/mantisbt/account_update.php --data 'verify_user_id=XXX&password=NEW_PWD&password_confirm= NEW_PWD' ```  For the record, even after this vulnerability is fixed, it will not be possible to be 100% bulletproof in a password reset/account creation scenario - if the attacker somehow obtains the confirmation hash, they will be able to reset the target user's password and there is nothing we can do about it (referring to point 2 of your steps to reproduce). |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-05 12:36  reporter    [~0068887](view.php?id=34433#c68887 "Direct link to note") | I agree with you, if the attacker gains access to the confirmation\_hash, then the account is highly likely to be compromised. What I'm concerned about in the 2nd step of step to reproduce is if the link got "accidentally opened" without changing the actual password, then the account will have the pending TOKEN\_ACCOUNT\_VERIFY.  However, I believe it should be sufficient to include the confirmation\_hash or a similar validation during password reset / registration, it can help to determine whether the current request is authorized to perform password changes for the given user\_id. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-05 12:59  developer    [~0068888](view.php?id=34433#c68888 "Direct link to note") | I believe it should be sufficient to include the confirmation\_hash or a similar validation during password reset / registration  Yep, this is precisely how I was planning to address this issue.  We use Github advisories to handle CVE requests and code review for security fixes. Please let me know your Github user id, so I can grant you access to a private fork for you to review and test the patch. |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-05 21:47  reporter    [~0068892](view.php?id=34433#c68892 "Direct link to note")  Last edited: 2024-05-06 01:51 | Sure, my Github user id is 54769255 (<https://github.com/redna-xela>) |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 04:07  developer    [~0068893](view.php?id=34433#c68893 "Direct link to note") | my Github user id is 54769255  Thanks, I actually meant username, not id, sorry ;-)  I added you to the Github Advisory [GHSA-93x3-m7pw-ppqm](https://github.com/mantisbt/mantisbt/security/advisories/GHSA-93x3-m7pw-ppqm). You will also find a proposed patch there. Please review, feedback is welcome. |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-06 05:20  reporter    [~0068894](view.php?id=34433#c68894 "Direct link to note")  Last edited: 2024-05-06 05:22 | Thank you, I'll look into this and get back to you as soon as possible. |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-06 06:10  reporter    [~0068895](view.php?id=34433#c68895 "Direct link to note") | Thanks for waiting! I've reviewed the patches, and everything looks good. I've also confirmed that the previous vulnerability is no longer exploitable. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 06:26  developer    [~0068897](view.php?id=34433#c68897 "Direct link to note") | Thanks for the feedback, that was quick :-) Are you also happy with the advisory's wording, CVSS evaluation and selected CWE ?  I'm now waiting for a CVE ID to be assigned. |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-06 07:55  reporter    [~0068898](view.php?id=34433#c68898 "Direct link to note") | Thanks for asking. The advisory's wording, CVSS evaluation and selected CWE already looks good to me, but I would like to suggest the following if possible:   * Impact: "A successful attack could grant the attacker full access to the compromised account, including sensitive information or functionalities associated with the account" or something similar. * CVSS Scoring: CVSS:3.1/AV:N/AC:H/PR:N/UI:N/S:U/C:H/I:H/A:L * Workarounds: I think it's better if we provide the workaround according to what has been done, which is by adding additional validation to the /account\_update.php   For the CVSS scoring, I believe the impact could be worse depending on who uses it and what kind of data is being stored, hence the C:H and I:H. Attack Complexity changed to High because successful attack cannot be accomplished at will, but rather need some perquisites to be fulfilled.  I appreciate any feedback you may have. |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 08:31  developer    [~0068899](view.php?id=34433#c68899 "Direct link to note")  Last edited: 2024-05-06 08:36 | Impact: "A successful attack could grant the attacker full access to the compromised account, including sensitive information or functionalities associated with the account"  OK sounds good.  C:H and I:H  This is somewhat subjective, and as you say depends on external factors, in particular the access level of the account that gets hijacked. I did not want to paint things too black considering that the probability of a successful attack is quite low  Attack Complexity changed to High because successful attack cannot be accomplished at will, but rather need some perquisites to be fulfilled.  I set it to low initially, because a brute-force attack *can* be launched at will and very easily, as explained in [0034433:0068886](/bugs/view.php?id=34433#c68886 "0034433: [2024-05-05 11:16] dregad"), even if the probability of success would be very low without some preparation work (e.g. social engineering to trick users so there are actual requests pending). Someone could just get lucky...  provide the workaround according to what has been done, which is by adding additional validation  The idea was to have a quick and simple to implement option to reduce the risk, until a patch was available.  I guess the point is kind of moot, as I would make the Advisory public together with the patch and 2.26.2 release, so anyone could either a) upgrade or b) apply the patch. |
|  | |
| [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)   [rednaxela](https://mantisbt.org/bugs/view_user_page.php?id=80929)  2024-05-06 09:34  reporter    [~0068900](view.php?id=34433#c68900 "Direct link to note") | Thanks for your input! I'm on board with you regarding the CVSS Scoring, I guess it would be better to use the previous score you've provided to avoid inflating the perceived risk. I also see your point about the workaround section, we can leave it as is.  I think that's all, no further feedback from me based on what we've discussed :) |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 10:16  developer    [~0068901](view.php?id=34433#c68901 "Direct link to note") | Great, thanks for your collaboration. I reverted the CVSS change, now back to 7.3 - `CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:L/I:L/A:L` |
|  | |
| [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)   [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784)  2024-05-06 10:37  developer    [~0068902](view.php?id=34433#c68902 "Direct link to note") | CVE-2024-34077 assigned |
|  | |

#### Related Changesets

| MantisBT: master-2.26 92d11a01  2024-05-05 20:09  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) [Details](/bugs/plugin.php?page=Source/view&id=27067) [Diff](https://github.com/mantisbt/mantisbt/commit/92d11a01b195a1b6717a2f205218089158ea6d00) | Validate confirm hash when updating account | | Affected Issues[0034433](/bugs/view.php?id=34433 "[closed] CVE-2024-34077: Account Takeover in Password Reset and Account Registration Feature") |
| --- | --- | --- | --- |
| mod - account\_update.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/92d11a01b195a1b6717a2f205218089158ea6d00) [File](https://github.com/mantisbt/mantisbt/blob/92d11a01b195a1b6717a2f205218089158ea6d00/account_update.php) |
| mod - verify.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/92d11a01b195a1b6717a2f205218089158ea6d00) [File](https://github.com/mantisbt/mantisbt/blob/92d11a01b195a1b6717a2f205218089158ea6d00/verify.php) |
| MantisBT: master-2.26 b12b1f8b  2024-05-05 20:18  [dregad](https://mantisbt.org/bugs/view_user_page.php?id=17784) [Details](/bugs/plugin.php?page=Source/view&id=27068) [Diff](https://github.com/mantisbt/mantisbt/commit/b12b1f8b4b68da663b3690e83b98b5e9c8f39a7a) | Use g\_reauthentication\_expiry to set token timeout | | Affected Issues[0034433](/bugs/view.php?id=34433 "[closed] CVE-2024-34077: Account Takeover in Password Reset and Account Registration Feature") |
| mod - verify.php | | [Diff](https://github.com/mantisbt/mantisbt/commit/b12b1f8b4b68da663b3690e83b98b5e9c8f39a7a) [File](https://github.com/mantisbt/mantisbt/blob/b12b1f8b4b68da663b3690e83b98b5e9c8f39a7a/verify.php) |

**Powered by [MantisBT 2.28.0-dev-master-a94bae75d](https://www.mantisbt.org "bug tracking software")**

Copyright © 2000 - 2025 MantisBT Team
Contact administrator for assistance

[![Powered by Mantis Bug Tracker: a free and open source web based bug tracking system.](/bugs/images/mantis_logo.png)](https://www.mantisbt.org "Mantis Bug Tracker: a free and open source web based bug tracking system.")

 Page execution time: 0.1929 seconds

