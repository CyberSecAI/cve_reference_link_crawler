
# [Blog zaměstnanců CZ.NIC](https://en.blog.nic.cz/)

## @ IN SOA domains.dns.enum.mojeid.internet. nic.cz.

# Menu

[Přeskočit na obsah](#content)

* Archiv
  + [December 2024](https://en.blog.nic.cz/2024/12/)
  + [September 2024](https://en.blog.nic.cz/2024/09/)
  + [July 2024](https://en.blog.nic.cz/2024/07/)
  + [May 2024](https://en.blog.nic.cz/2024/05/)
  + [April 2024](https://en.blog.nic.cz/2024/04/)
  + [February 2024](https://en.blog.nic.cz/2024/02/)
  + [January 2024](https://en.blog.nic.cz/2024/01/)
  + [December 2023](https://en.blog.nic.cz/2023/12/)
  + [November 2023](https://en.blog.nic.cz/2023/11/)
  + [October 2023](https://en.blog.nic.cz/2023/10/)
  + [September 2023](https://en.blog.nic.cz/2023/09/)
  + [August 2023](https://en.blog.nic.cz/2023/08/)
  + [July 2023](https://en.blog.nic.cz/2023/07/)
  + [June 2023](https://en.blog.nic.cz/2023/06/)
  + [May 2023](https://en.blog.nic.cz/2023/05/)
  + [April 2023](https://en.blog.nic.cz/2023/04/)
  + [March 2023](https://en.blog.nic.cz/2023/03/)
  + [February 2023](https://en.blog.nic.cz/2023/02/)
  + [December 2022](https://en.blog.nic.cz/2022/12/)
  + [October 2022](https://en.blog.nic.cz/2022/10/)
  + [September 2022](https://en.blog.nic.cz/2022/09/)
  + [April 2022](https://en.blog.nic.cz/2022/04/)
  + [March 2022](https://en.blog.nic.cz/2022/03/)
  + [February 2022](https://en.blog.nic.cz/2022/02/)
  + [December 2021](https://en.blog.nic.cz/2021/12/)
  + [November 2021](https://en.blog.nic.cz/2021/11/)
  + [October 2021](https://en.blog.nic.cz/2021/10/)
  + [June 2021](https://en.blog.nic.cz/2021/06/)
  + [May 2021](https://en.blog.nic.cz/2021/05/)
  + [March 2021](https://en.blog.nic.cz/2021/03/)
  + [February 2021](https://en.blog.nic.cz/2021/02/)
  + [December 2020](https://en.blog.nic.cz/2020/12/)
  + [November 2020](https://en.blog.nic.cz/2020/11/)
  + [October 2020](https://en.blog.nic.cz/2020/10/)
  + [September 2020](https://en.blog.nic.cz/2020/09/)
  + [July 2020](https://en.blog.nic.cz/2020/07/)
  + [June 2020](https://en.blog.nic.cz/2020/06/)
  + [May 2020](https://en.blog.nic.cz/2020/05/)
  + [April 2020](https://en.blog.nic.cz/2020/04/)
  + [March 2020](https://en.blog.nic.cz/2020/03/)
  + [January 2020](https://en.blog.nic.cz/2020/01/)
  + [December 2019](https://en.blog.nic.cz/2019/12/)
  + [November 2019](https://en.blog.nic.cz/2019/11/)
  + [October 2019](https://en.blog.nic.cz/2019/10/)
  + [September 2019](https://en.blog.nic.cz/2019/09/)
  + [August 2019](https://en.blog.nic.cz/2019/08/)
  + [July 2019](https://en.blog.nic.cz/2019/07/)
  + [May 2019](https://en.blog.nic.cz/2019/05/)
  + [April 2019](https://en.blog.nic.cz/2019/04/)
  + [March 2019](https://en.blog.nic.cz/2019/03/)
  + [February 2019](https://en.blog.nic.cz/2019/02/)
  + [January 2019](https://en.blog.nic.cz/2019/01/)
  + [December 2018](https://en.blog.nic.cz/2018/12/)
  + [November 2018](https://en.blog.nic.cz/2018/11/)
  + [October 2018](https://en.blog.nic.cz/2018/10/)
  + [September 2018](https://en.blog.nic.cz/2018/09/)
  + [August 2018](https://en.blog.nic.cz/2018/08/)
  + [June 2018](https://en.blog.nic.cz/2018/06/)
  + [May 2018](https://en.blog.nic.cz/2018/05/)
  + [April 2018](https://en.blog.nic.cz/2018/04/)
  + [March 2018](https://en.blog.nic.cz/2018/03/)
  + [February 2018](https://en.blog.nic.cz/2018/02/)
  + [January 2018](https://en.blog.nic.cz/2018/01/)
  + [December 2017](https://en.blog.nic.cz/2017/12/)
  + [November 2017](https://en.blog.nic.cz/2017/11/)
  + [August 2017](https://en.blog.nic.cz/2017/08/)
  + [July 2017](https://en.blog.nic.cz/2017/07/)
  + [June 2017](https://en.blog.nic.cz/2017/06/)
  + [May 2017](https://en.blog.nic.cz/2017/05/)
  + [April 2017](https://en.blog.nic.cz/2017/04/)
  + [March 2017](https://en.blog.nic.cz/2017/03/)
  + [January 2017](https://en.blog.nic.cz/2017/01/)
  + [December 2016](https://en.blog.nic.cz/2016/12/)
  + [October 2016](https://en.blog.nic.cz/2016/10/)
  + [September 2016](https://en.blog.nic.cz/2016/09/)
  + [August 2016](https://en.blog.nic.cz/2016/08/)
  + [July 2016](https://en.blog.nic.cz/2016/07/)
  + [June 2016](https://en.blog.nic.cz/2016/06/)
  + [April 2016](https://en.blog.nic.cz/2016/04/)
  + [February 2016](https://en.blog.nic.cz/2016/02/)
  + [January 2016](https://en.blog.nic.cz/2016/01/)
  + [November 2015](https://en.blog.nic.cz/2015/11/)
  + [October 2015](https://en.blog.nic.cz/2015/10/)
  + [September 2015](https://en.blog.nic.cz/2015/09/)
  + [August 2015](https://en.blog.nic.cz/2015/08/)
  + [July 2015](https://en.blog.nic.cz/2015/07/)
  + [June 2015](https://en.blog.nic.cz/2015/06/)
  + [May 2015](https://en.blog.nic.cz/2015/05/)
  + [March 2015](https://en.blog.nic.cz/2015/03/)
  + [February 2015](https://en.blog.nic.cz/2015/02/)
  + [January 2015](https://en.blog.nic.cz/2015/01/)
  + [December 2014](https://en.blog.nic.cz/2014/12/)
  + [November 2014](https://en.blog.nic.cz/2014/11/)
  + [October 2014](https://en.blog.nic.cz/2014/10/)
  + [September 2014](https://en.blog.nic.cz/2014/09/)
  + [August 2014](https://en.blog.nic.cz/2014/08/)
* Rubrika
  + [ADAM](https://en.blog.nic.cz/category/adam/)
  + [BIRD](https://en.blog.nic.cz/category/bird/)
  + [Censoring](https://en.blog.nic.cz/category/censoring/)
  + [DNS](https://en.blog.nic.cz/category/dns/)
  + [DNSSEC](https://en.blog.nic.cz/category/dnssec/)
  + [Domains](https://en.blog.nic.cz/category/domains/)
  + [Edice CZ.NIC](https://en.blog.nic.cz/category/edice-cz-nic/)
  + [Education](https://en.blog.nic.cz/category/education/)
  + [ENUM](https://en.blog.nic.cz/category/enum/)
  + [FRED](https://en.blog.nic.cz/category/fred/)
  + [IPv6](https://en.blog.nic.cz/category/ipv6/)
  + [Knot DNS](https://en.blog.nic.cz/category/knot-dns/)
  + [Knot Resolver](https://en.blog.nic.cz/category/knot-resolver/)
  + [Meetings](https://en.blog.nic.cz/category/meetings/)
  + [mojeID](https://en.blog.nic.cz/category/mojeid/)
  + [Open Data](https://en.blog.nic.cz/category/open-data/)
  + [Programming](https://en.blog.nic.cz/category/programming/)
  + [Security](https://en.blog.nic.cz/category/security/)
  + [Tablexia](https://en.blog.nic.cz/category/tablexia/)
  + [Turris](https://en.blog.nic.cz/category/turris/)
  + [Unclassified](https://en.blog.nic.cz/category/unclassified/)

* [Archiv](/archiv)
* [Rubrika](/rubriky)

* [Čeština](//blog.nic.cz/)

Hledat:

# [NXNSAttack: upgrade resolvers to stop new kind of random subdomain attack](https://en.blog.nic.cz/2020/05/19/nxnsattack-upgrade-resolvers-to-stop-new-kind-of-random-subdomain-attack/)

19.5.

This article describes [NXNSAttack](http://cyber-security-group.cs.tau.ac.il/), a newly discovered DNS protocol vulnerability which affects most recursive DNS resolvers. It allows to execute random subdomain attack using DNS delegation mechanism, resulting in big packet amplification factor.

## First things first

If you operate your own DNS resolver, no matter what brand it is, please upgrade to the latest version now. (Also, if you are disappointed you have to rush with upgrade now, talk to your vendor and ask about early notification for security releases.)

If you want to know how the attack works and how you can protect your systems next time read on.

## NXNSAttack principle

The newly discovered vulnerability abuses DNS delegation mechanism to force DNS resolvers to generate more DNS queries to authoritative servers of attacker’s choice. How is that possible?

The whole DNS is built on delegation principle, where authoritative DNS servers responsible for upper levels of DNS hierarchy delegate (we could also say *redirect*) questions for lower level domains to different servers, thus obviating the need to maintain one huge database with DNS data for the whole Internet.

For example, this is how authoritative DNS server named “a.gtld-servers.com.”, which is responsible for “com.” domain, delegates questions “example.com. A” to different set of servers:

```
$ kdig @a.gtld-servers.com example.com A
;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 10976
;; flags: qr rd; QUERY: 1, ANSWER: 0, AUTHORITY: 2, ADDITIONAL: 0

;; QUESTION SECTION:
;example.com. IN A

;; AUTHORITY SECTION:
example.com. 172800 IN NS a.iana-servers.net.
example.com. 172800 IN NS b.iana-servers.net.
;; From 2001:503:a83e::2:30@53(UDP) in 46.9 ms

```

Here we can see that even though we asked for name “example.com. type A” the server authoritative for “com.” domain sent us delegation to “example.com.”, which contains names of two **other** authoritative DNS servers, but does not contain answer for our original question.

This is so-called glueless delegation, i.e. a delegation which contains only names of authoritative DNS servers (a.iana-servers.net. and b.iana-servers.net.), but does not contain their IP addresses. Obviously DNS resolver cannot send a query to “name”, so the resolver first needs to obtain IPv4 or IPv6 address of authoritative server “a.iana-servers.net.” or “b.iana-servers.net.” and only then it can continue resolving the original query “example.com. A”.

This glueless delegation is the basic principle of the NXNSAttack: Attacker simply sends back delegation with fake (random) server names pointing to victim DNS domain, thus forcing the resolver to generate queries towards victim DNS servers (in a futile attempt to resolve fake authoritative server names).

![NXNSAttack principle](https://en.blog.nic.cz/wp-content/uploads/sites/2/2020/05/nxnsattack-obrazek.svg)

## Impact

The main discovery in the [NXNSAttack paper](http://cyber-security-group.cs.tau.ac.il/) is that attackers are able to amplify a single DNS query toward DNS resolver + single DNS answer with fake delegations (i.e. 2 packets) to fire multiple random queries at victim authoritative servers, effectively using standard-compliant DNS resolver as an amplifier for random subdomain attack. In practice packet amplification factor (PAF) very much depends on strategy employed by DNS resolver implementation involved in the attack. For example:

* BIND 9.12.3 resolver resolves IPv4 and IPv6 addresses for all NS names obtained from delegation in parallel, leading to packet amplification factor 1000x.
* Knot Resolver 5.1.0 resolves NS names one at a time and placesother limits on number of resolution steps generated by single client query, limiting PAF to the order of tens. In fact half of packet amplification factor 48x is caused by workaround for non-compliant authoritative servers. Without workarounds for [RFC8020](https://tools.ietf.org/html/rfc8020) and [RFC7816](https://tools.ietf.org/html/rfc7816) non-compliance PAF of Knot Resolver would be only 24x. (Yet another example that workarounds are bad, but that’s another story.)

None of these strategies is inherently wrong, they just represent different trade-offs between resources invested into single client query vs. processing multiple client queries in parallel.

In the end spare capacity on the resolver and authoritative servers determines which party will be the “victim” of NXNSAttack because one of them gets overloaded first. As long as the capacity is sufficient servers will continue to operate just fine, possibly making one of the parties virtually unaffected and in absence of appropriate monitoring oblivious to the attack.

Unfortunately NXNSAttack abuses the very basic principle of DNS protocol, which practically means there is no fix, only mitigation. Luckily [researchers](http://cyber-security-group.cs.tau.ac.il/) followed [responsible disclosure](https://en.wikipedia.org/wiki/Responsible_disclosure) protocol and allowed vendors to implement and release mitigation before making the attack public.

NXNSAttack is special case of well-known random subdomain attack, so mitigation approaches fall into two categories: Specific for NXNSAttack and generic for random subdomain attacks.

## NXNSAttack mitigation

Unlike traditional random subdomain attacks, in case of NXNSAttack queries are generated by resolver itself. This difference allows vendors to implement simple mitigation techniques like limiting number names resolved when processing a single delegation etc.

Obvious advantage is that it is simple, at least in theory.

Disadvantage of mitigation based on counters is that it requires vendors to invent arbitrary limits not based in the DNS protocol specification, basically determining maximum packet amplification factor. At the same time these arbitrary limits might break resolution for some domains because they put additional limits on the resolution process.

This is a very practical problem because [recently published research](https://www.sidnlabs.nl/downloads/53BNt9EPxZQOCHYjqWhYfR/7295d79a207afc79cab6309d40a15a76/When_parents_and_children_disagree_Diving_into_DNS_delegation_inconsistency.pdf) estimates that 4 % of second-level domains (example.com.) have a problem in their delegation from top-level (com.), so any change which adds arbitrary limits to retries during resolution process has to be weighted very carefully.

In upcoming days we will see how successful vendors were in determining their magic numbers and if they get away without breaking any major domains.

## Generic Random Subdomain Attack mitigation

Any random subdomain attack, NXNSAttack included, generates random query names to bypass DNS cache. It follows that generic mitigation has to prevent attackers from bypassing the cache – and luckily we already have technology to do that!

[Aggressive Use of DNSSEC-Validated Cache (RFC 8198)](https://tools.ietf.org/html/rfc8198) uses DNSSEC “metadata” in form of NSEC(3) and RRSIG records to generate negative answers without need to contact authoritative servers. How does that work? First let’s have a look at example NSEC records:

```
$ kdig +dnssec @l.root-servers.net example.
;; ->>HEADER<<- opcode: QUERY; status: NXDOMAIN; id: 55933
;; Flags: qr aa rd; QUERY: 1; ANSWER: 0; AUTHORITY: 6; ADDITIONAL: 1

;; EDNS PSEUDOSECTION:
;; Version: 0; flags: do; UDP size: 4096 B; ext-rcode: NOERROR

;; QUESTION SECTION:
;; example. IN A

;; AUTHORITY SECTION:
events. 86400 IN NSEC exchange. NS DS RRSIG NSEC
events. 86400 IN RRSIG NSEC 8 1 86400 20200531170000 20200518160000 48903 . bWcSkQHURJGO...
. 86400 IN NSEC aaa. NS SOA RRSIG NSEC DNSKEY
. 86400 IN RRSIG NSEC 8 0 86400 20200531170000 20200518160000 48903 . Ru23msHh23...
. 86400 IN SOA a.root-servers.net. nstld.verisign-grs.com. 2020051801 1800 900 604800 86400
. 86400 IN RRSIG SOA 8 0 86400 20200531170000 20200518160000 48903 . pIolh2KxjZbgtwuePLA4...

```

We sent DNS query example. A to one of root DNS servers, and it answered back with NXDOMAIN answer, indicating the name does not exist. At the same time we received two proofs-of-nonexistence in form of NSEC records (and their DNSSEC signatures in RRSIG records).

The first NSEC record events. 86400 IN NSEC exchange. NS DS RRSIG NSEC means that root zone contains domain events. with record types NS DS RRSIG NSEC, and more importantly, there are no domains in between names events. and exchange.

The second NSEC record . 86400 IN NSEC aaa. NS SOA RRSIG NSEC DNSKEY means that root zone contains DNS root . (surprise!) with records types NS SOA RRSIG NSEC DNSKEY, and also that there are no domains in between names . and aaa.. This proves there is no wildcard record \*. and thus NXDOMAIN is really the correct answer to query example. A.

Each of the records has time-to-live specified as 86400 seconds. This allows resolvers to synthesize NXDOMAIN answers for any queries falling into indicated ranges (. – aaa., events. – exchange.) for one full day, effectively cutting traffic towards authoritative servers.

As a consequence, querying DNS zone which contains N names at random will populate resolver’s cache in roughly O(N) answers. In other words, cost of eliminating random subdomain attack between DNSSEC-validating resolver and authoritative servers for duration of TTL is linear with number of names in target DNS zone. It works surprisingly well even for large zones with 1 million domains in them – pretty charts about this setup can be found in [my older presentation (from 2018)](https://indico.dns-oarc.net/event/28/contributions/509/attachments/479/786/DNS-OARC-28-presentation-RFC8198.pdf).

## What next?

First of all upgrade your DNS resolvers to get at least some NXNSAttack mitigation.

Once the dust settles please consider deploying DNSSEC on authoritative servers, and also on DNS resolvers.

Aggressive Use of DNSSEC-Validated Cache limits impact of random subdomain attacks. It is already implemented in Knot Resolver. Unbound also has partial support (NSEC only) and BIND have a prototype as well. If your DNS resolver vendor does not offer it at the moment ask for the feature and stop random subdomain attacks once and for good!

If you are not used to speaking to your DNS software vendor, please fill in cross-vendor [survey](https://docs.google.com/forms/d/e/1FAIpQLSe7fRMakVPVEwfHKJwin8a0s74bBDqEqlPkVFXWH_9Kt7JLfw/viewform).

*Attribution: Icons by Bernar Novalyi from the Noun Project*

**Autor:** [Petr Špaček](https://en.blog.nic.cz/author/spacek-petr/ "Posts by Petr Špaček")

**Publikováno:** 19.5.2020 v 10:08
**Autor:** [Petr Špaček](https://en.blog.nic.cz/author/spacek-petr/ "Posts by Petr Špaček")
**Kategorie:** [DNS](https://en.blog.nic.cz/category/dns/), [Knot Resolver](https://en.blog.nic.cz/category/knot-resolver/), [Security](https://en.blog.nic.cz/category/security/)
Sdílet

Sdílet

Sdílet

## Komentáře (2)

1. Georges-Keny Paul říká:
   23.5.2020 v 3:31

   Hi,

   Great article. Can I post it on my LinkedIn ?

   Thanks and regards,

   Georges-Keny Paul

   [Reply](https://en.blog.nic.cz/2020/05/19/nxnsattack-upgrade-resolvers-to-stop-new-kind-of-random-subdomain-attack/?replytocom=5986#respond)
3. Petr Špaček říká:
   25.5.2020 v 10:21

   Hi,

   posting a link to the article here is certainly fine.

   Petr Špaček @ CZ.NIC

   [Reply](https://en.blog.nic.cz/2020/05/19/nxnsattack-upgrade-resolvers-to-stop-new-kind-of-random-subdomain-attack/?replytocom=6010#respond)

### Zanechte komentář [Cancel reply](/2020/05/19/nxnsattack-upgrade-resolvers-to-stop-new-kind-of-random-subdomain-attack/#respond)

Váš komentář:

Jméno:

E-mail:

Všechny údaje jsou povinné. E-mail nebude zobrazen.

Δ

[**Předchozí:** WireGuard on Turris](https://en.blog.nic.cz/2020/05/14/wireguard-on-turris/)
[**Další:** Launching DNS Crawler](https://en.blog.nic.cz/2020/06/01/launching-dns-crawler/)

[Facebook](https://www.facebook.com/CZ.NIC)
[Twitter](https://twitter.com/CZ_NIC)
[LinkedIn](https://www.linkedin.com/company/cz.nic-z.s.p.o./)
[RSS](https://en.blog.nic.cz/feed/%20)

---

[![Creative Commons Attribution-ShareAlike 3.0](/wp-content/themes/nic-responsive/img/cc-by-sa.png)](https://creativecommons.org/licenses/by-sa/3.0/)

**Blog** je poháněn Wordpressem.

**Blog** je archivován na WebArchivu Národní knihovny ČR.

**ISSN**: 2533-4727

Vybrané články na blogu byly publikovány v rámci řešení [projektů spolufinancovaných nástrojem Evropské unie pro propojení Evropy](https://www.nic.cz/page/1515/grantove-projekty/) (CEF).

---

[![Logo CZ.nic](https://en.blog.nic.cz/wp-content/themes/nic-responsive/img/footer-logo.png)](http://www.nic.cz)

