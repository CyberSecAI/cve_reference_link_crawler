

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Uwe Kleine-König <u.kleine-koenig@pengutronix.de> | 2024-03-24 12:40:17 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-21 14:35:40 +0200 |
| commit | [5ee241f72edc6dce5051a5f100eab6cc019d873e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)) | |
| tree | [fd4e801dca6e34f2258de63ecd1543ea4bfadaab](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e) | |
| parent | [c3d39fdc337b3cdaa116740cd631c5b27211d8ec](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=c3d39fdc337b3cdaa116740cd631c5b27211d8ec) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e&id2=c3d39fdc337b3cdaa116740cd631c5b27211d8ec)) | |
| download | [linux-5ee241f72edc6dce5051a5f100eab6cc019d873e.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5ee241f72edc6dce5051a5f100eab6cc019d873e.tar.gz) | |

mmc: davinci: Don't strip remove function when driver is builtin[ Upstream commit 55c421b364482b61c4c45313a535e61ed5ae4ea3 ]
Using \_\_exit for the remove function results in the remove callback being
discarded with CONFIG\_MMC\_DAVINCI=y. When such a device gets unbound (e.g.
using sysfs or hotplug), the driver is just removed without the cleanup
being performed. This results in resource leaks. Fix it by compiling in the
remove callback unconditionally.
This also fixes a W=1 modpost warning:
WARNING: modpost: drivers/mmc/host/davinci\_mmc: section mismatch in
reference: davinci\_mmcsd\_driver+0x10 (section: .data) ->
davinci\_mmcsd\_remove (section: .exit.text)
Fixes: b4cff4549b7a ("DaVinci: MMC: MMC/SD controller driver for DaVinci family")
Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240324114017.231936-2-u.kleine-koenig@pengutronix.de](https://lore.kernel.org/r/20240324114017.231936-2-u.kleine-koenig%40pengutronix.de)
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)

| -rw-r--r-- | [drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/davinci_mmc.c?id=5ee241f72edc6dce5051a5f100eab6cc019d873e) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/davinci\_mmc.c b/drivers/mmc/host/davinci\_mmc.cindex 7138dfa065bfa6..e89a97b4151549 100644--- a/[drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/davinci_mmc.c?id=c3d39fdc337b3cdaa116740cd631c5b27211d8ec)+++ b/[drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/davinci_mmc.c?id=5ee241f72edc6dce5051a5f100eab6cc019d873e)@@ -1345,7 +1345,7 @@ ioremap\_fail: return ret; } -static int \_\_exit davinci\_mmcsd\_remove(struct platform\_device \*pdev)+static int davinci\_mmcsd\_remove(struct platform\_device \*pdev) { struct mmc\_davinci\_host \*host = platform\_get\_drvdata(pdev); @@ -1402,7 +1402,7 @@ static struct platform\_driver davinci\_mmcsd\_driver = { .of\_match\_table = davinci\_mmc\_dt\_ids, }, .probe = davinci\_mmcsd\_probe,- .remove = \_\_exit\_p(davinci\_mmcsd\_remove),+ .remove = davinci\_mmcsd\_remove, .id\_table = davinci\_mmc\_devtype, }; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:52 +0000

