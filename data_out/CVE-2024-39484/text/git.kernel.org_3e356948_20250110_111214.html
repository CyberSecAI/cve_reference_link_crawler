

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Uwe Kleine-König <u.kleine-koenig@pengutronix.de> | 2024-03-24 12:40:17 +0100 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-06-16 13:51:00 +0200 |
| commit | [1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)) | |
| tree | [8d6bb8f5753848dddfba2ee720c35a0696640172](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584) | |
| parent | [44f6d619c30f0c65fcdd2b6eba70fdb4460d87ad](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=44f6d619c30f0c65fcdd2b6eba70fdb4460d87ad) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584&id2=44f6d619c30f0c65fcdd2b6eba70fdb4460d87ad)) | |
| download | [linux-1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584.tar.gz) | |

mmc: davinci: Don't strip remove function when driver is builtincommit 55c421b364482b61c4c45313a535e61ed5ae4ea3 upstream.
Using \_\_exit for the remove function results in the remove callback being
discarded with CONFIG\_MMC\_DAVINCI=y. When such a device gets unbound (e.g.
using sysfs or hotplug), the driver is just removed without the cleanup
being performed. This results in resource leaks. Fix it by compiling in the
remove callback unconditionally.
This also fixes a W=1 modpost warning:
WARNING: modpost: drivers/mmc/host/davinci\_mmc: section mismatch in
reference: davinci\_mmcsd\_driver+0x10 (section: .data) ->
davinci\_mmcsd\_remove (section: .exit.text)
Fixes: b4cff4549b7a ("DaVinci: MMC: MMC/SD controller driver for DaVinci family")
Signed-off-by: Uwe Kleine-König <u.kleine-koenig@pengutronix.de>
Cc: stable@vger.kernel.org
Link: [https://lore.kernel.org/r/20240324114017.231936-2-u.kleine-koenig@pengutronix.de](https://lore.kernel.org/r/20240324114017.231936-2-u.kleine-koenig%40pengutronix.de)
Signed-off-by: Ulf Hansson <ulf.hansson@linaro.org>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)

| -rw-r--r-- | [drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/mmc/host/davinci_mmc.c?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/drivers/mmc/host/davinci\_mmc.c b/drivers/mmc/host/davinci\_mmc.cindex 8bd938919687b7..d7427894e0bc9f 100644--- a/[drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/davinci_mmc.c?id=44f6d619c30f0c65fcdd2b6eba70fdb4460d87ad)+++ b/[drivers/mmc/host/davinci\_mmc.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/mmc/host/davinci_mmc.c?id=1d5ed0efe51d36b9ae9b64f133bf41cdbf56f584)@@ -1337,7 +1337,7 @@ ioremap\_fail: return ret; } -static void \_\_exit davinci\_mmcsd\_remove(struct platform\_device \*pdev)+static void davinci\_mmcsd\_remove(struct platform\_device \*pdev) { struct mmc\_davinci\_host \*host = platform\_get\_drvdata(pdev); @@ -1392,7 +1392,7 @@ static struct platform\_driver davinci\_mmcsd\_driver = { .of\_match\_table = davinci\_mmc\_dt\_ids, }, .probe = davinci\_mmcsd\_probe,- .remove\_new = \_\_exit\_p(davinci\_mmcsd\_remove),+ .remove\_new = davinci\_mmcsd\_remove, .id\_table = davinci\_mmc\_devtype, }; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 11:10:51 +0000

