

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Fugang Duan <fugang.duan@nxp.com> | 2021-05-12 10:43:59 +0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-06-03 08:38:11 +0200 |
| commit | [15102886bc8f5f29daaadf2d925591d564c17e9f](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=15102886bc8f5f29daaadf2d925591d564c17e9f) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)) | |
| tree | [e2f97ac6f272872e458fa178b40725b2efa7b3f8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=15102886bc8f5f29daaadf2d925591d564c17e9f) | |
| parent | [3b985e4dce4d83f03f3d025ca15d36e432e88f2b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3b985e4dce4d83f03f3d025ca15d36e432e88f2b) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15102886bc8f5f29daaadf2d925591d564c17e9f&id2=3b985e4dce4d83f03f3d025ca15d36e432e88f2b)) | |
| download | [linux-15102886bc8f5f29daaadf2d925591d564c17e9f.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-15102886bc8f5f29daaadf2d925591d564c17e9f.tar.gz) | |

net: fec: fix the potential memory leak in fec\_enet\_init()[ Upstream commit 619fee9eb13b5d29e4267cb394645608088c28a8 ]
If the memory allocated for cbd\_base is failed, it should
free the memory allocated for the queues, otherwise it causes
memory leak.
And if the memory allocated for the queues is failed, it can
return error directly.
Fixes: 59d0f7465644 ("net: fec: init multi queue date structure")
Signed-off-by: Fugang Duan <fugang.duan@nxp.com>
Signed-off-by: Joakim Zhang <qiangqing.zhang@nxp.com>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=15102886bc8f5f29daaadf2d925591d564c17e9f)

| -rw-r--r-- | [drivers/net/ethernet/freescale/fec\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/net/ethernet/freescale/fec_main.c?id=15102886bc8f5f29daaadf2d925591d564c17e9f) | 11 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 9 insertions, 2 deletions

| diff --git a/drivers/net/ethernet/freescale/fec\_main.c b/drivers/net/ethernet/freescale/fec\_main.cindex 7d1a669416f204..6b9eada1feb215 100644--- a/[drivers/net/ethernet/freescale/fec\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/fec_main.c?id=3b985e4dce4d83f03f3d025ca15d36e432e88f2b)+++ b/[drivers/net/ethernet/freescale/fec\_main.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/net/ethernet/freescale/fec_main.c?id=15102886bc8f5f29daaadf2d925591d564c17e9f)@@ -3221,7 +3221,9 @@ static int fec\_enet\_init(struct net\_device \*ndev) return ret; } - fec\_enet\_alloc\_queue(ndev);+ ret = fec\_enet\_alloc\_queue(ndev);+ if (ret)+ return ret;  bd\_size = (fep->total\_tx\_ring\_size + fep->total\_rx\_ring\_size) \* dsize; @@ -3229,7 +3231,8 @@ static int fec\_enet\_init(struct net\_device \*ndev) cbd\_base = dmam\_alloc\_coherent(&fep->pdev->dev, bd\_size, &bd\_dma, GFP\_KERNEL); if (!cbd\_base) {- return -ENOMEM;+ ret = -ENOMEM;+ goto free\_queue\_mem; }  memset(cbd\_base, 0, bd\_size);@@ -3309,6 +3312,10 @@ static int fec\_enet\_init(struct net\_device \*ndev) fec\_enet\_update\_ethtool\_stats(ndev);  return 0;++free\_queue\_mem:+ fec\_enet\_free\_queue(ndev);+ return ret; }  #ifdef CONFIG\_OF |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 08:17:41 +0000

