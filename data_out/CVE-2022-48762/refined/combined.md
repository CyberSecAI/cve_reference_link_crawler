=== Content from git.kernel.org_58bfc4e2_20250111_133635.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Evgenii Stepanov <eugenis@google.com> | 2022-01-25 10:22:17 -0800 |
| --- | --- | --- |
| committer | Catalin Marinas <catalin.marinas@arm.com> | 2022-01-26 18:58:12 +0000 |
| commit | [3758a6c74e08bdc15ccccd6872a6ad37d165239a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)) | |
| tree | [5080cd205c46c2dbf2f9293b91726d2fe30234df](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a) | |
| parent | [1e0924bd09916fab795fc2a21ec1d148f24299fd](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1e0924bd09916fab795fc2a21ec1d148f24299fd) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a&id2=1e0924bd09916fab795fc2a21ec1d148f24299fd)) | |
| download | [linux-3758a6c74e08bdc15ccccd6872a6ad37d165239a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-3758a6c74e08bdc15ccccd6872a6ad37d165239a.tar.gz) | |

arm64: extable: fix load\_unaligned\_zeropad() reg indicesIn ex\_handler\_load\_unaligned\_zeropad() we erroneously extract the data and
addr register indices from ex->type rather than ex->data. As ex->type will
contain EX\_TYPE\_LOAD\_UNALIGNED\_ZEROPAD (i.e. 4):
\* We'll always treat X0 as the address register, since EX\_DATA\_REG\_ADDR is
extracted from bits [9:5]. Thus, we may attempt to dereference an
arbitrary address as X0 may hold an arbitrary value.
\* We'll always treat X4 as the data register, since EX\_DATA\_REG\_DATA is
extracted from bits [4:0]. Thus we will corrupt X4 and cause arbitrary
behaviour within load\_unaligned\_zeropad() and its caller.
Fix this by extracting both values from ex->data as originally intended.
On an MTE-enabled QEMU image we are hitting the following crash:
Unable to handle kernel NULL pointer dereference at virtual address 0000000000000000
Call trace:
fixup\_exception+0xc4/0x108
\_\_do\_kernel\_fault+0x3c/0x268
do\_tag\_check\_fault+0x3c/0x104
do\_mem\_abort+0x44/0xf4
el1\_abort+0x40/0x64
el1h\_64\_sync\_handler+0x60/0xa0
el1h\_64\_sync+0x7c/0x80
link\_path\_walk+0x150/0x344
path\_openat+0xa0/0x7dc
do\_filp\_open+0xb8/0x168
do\_sys\_openat2+0x88/0x17c
\_\_arm64\_sys\_openat+0x74/0xa0
invoke\_syscall+0x48/0x148
el0\_svc\_common+0xb8/0xf8
do\_el0\_svc+0x28/0x88
el0\_svc+0x24/0x84
el0t\_64\_sync\_handler+0x88/0xec
el0t\_64\_sync+0x1b4/0x1b8
Code: f8695a69 71007d1f 540000e0 927df12a (f940014a)
Fixes: 753b32368705 ("arm64: extable: add load\_unaligned\_zeropad() handler")
Cc: <stable@vger.kernel.org> # 5.16.x
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Signed-off-by: Evgenii Stepanov <eugenis@google.com>
Link: [https://lore.kernel.org/r/20220125182217.2605202-1-eugenis@google.com](https://lore.kernel.org/r/20220125182217.2605202-1-eugenis%40google.com)
Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)

| -rw-r--r-- | [arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/mm/extable.c?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/arch/arm64/mm/extable.c b/arch/arm64/mm/extable.cindex c0181e60cc98e8..4894553096951f 100644--- a/[arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/mm/extable.c?id=1e0924bd09916fab795fc2a21ec1d148f24299fd)+++ b/[arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/mm/extable.c?id=3758a6c74e08bdc15ccccd6872a6ad37d165239a)@@ -40,8 +40,8 @@ static bool ex\_handler\_load\_unaligned\_zeropad(const struct exception\_table\_entry \*ex, struct pt\_regs \*regs) {- int reg\_data = FIELD\_GET(EX\_DATA\_REG\_DATA, ex->type);- int reg\_addr = FIELD\_GET(EX\_DATA\_REG\_ADDR, ex->type);+ int reg\_data = FIELD\_GET(EX\_DATA\_REG\_DATA, ex->data);+ int reg\_addr = FIELD\_GET(EX\_DATA\_REG\_ADDR, ex->data); unsigned long data, addr, offset;  addr = pt\_regs\_read\_reg(regs, reg\_addr); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:35:12 +0000



=== Content from git.kernel.org_955cebcd_20250111_133636.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Evgenii Stepanov <eugenis@google.com> | 2022-01-25 10:22:17 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2022-02-01 17:29:06 +0100 |
| commit | [47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)) | |
| tree | [5b9b1add88f89a458a8f4ba3b35323e3c61f0a37](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb) | |
| parent | [b830fd118fddf4af0a41027dfc2a3dfb85b62e25](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b830fd118fddf4af0a41027dfc2a3dfb85b62e25) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb&id2=b830fd118fddf4af0a41027dfc2a3dfb85b62e25)) | |
| download | [linux-47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb.tar.gz) | |

arm64: extable: fix load\_unaligned\_zeropad() reg indicescommit 3758a6c74e08bdc15ccccd6872a6ad37d165239a upstream.
In ex\_handler\_load\_unaligned\_zeropad() we erroneously extract the data and
addr register indices from ex->type rather than ex->data. As ex->type will
contain EX\_TYPE\_LOAD\_UNALIGNED\_ZEROPAD (i.e. 4):
\* We'll always treat X0 as the address register, since EX\_DATA\_REG\_ADDR is
extracted from bits [9:5]. Thus, we may attempt to dereference an
arbitrary address as X0 may hold an arbitrary value.
\* We'll always treat X4 as the data register, since EX\_DATA\_REG\_DATA is
extracted from bits [4:0]. Thus we will corrupt X4 and cause arbitrary
behaviour within load\_unaligned\_zeropad() and its caller.
Fix this by extracting both values from ex->data as originally intended.
On an MTE-enabled QEMU image we are hitting the following crash:
Unable to handle kernel NULL pointer dereference at virtual address 0000000000000000
Call trace:
fixup\_exception+0xc4/0x108
\_\_do\_kernel\_fault+0x3c/0x268
do\_tag\_check\_fault+0x3c/0x104
do\_mem\_abort+0x44/0xf4
el1\_abort+0x40/0x64
el1h\_64\_sync\_handler+0x60/0xa0
el1h\_64\_sync+0x7c/0x80
link\_path\_walk+0x150/0x344
path\_openat+0xa0/0x7dc
do\_filp\_open+0xb8/0x168
do\_sys\_openat2+0x88/0x17c
\_\_arm64\_sys\_openat+0x74/0xa0
invoke\_syscall+0x48/0x148
el0\_svc\_common+0xb8/0xf8
do\_el0\_svc+0x28/0x88
el0\_svc+0x24/0x84
el0t\_64\_sync\_handler+0x88/0xec
el0t\_64\_sync+0x1b4/0x1b8
Code: f8695a69 71007d1f 540000e0 927df12a (f940014a)
Fixes: 753b32368705 ("arm64: extable: add load\_unaligned\_zeropad() handler")
Cc: <stable@vger.kernel.org> # 5.16.x
Reviewed-by: Mark Rutland <mark.rutland@arm.com>
Signed-off-by: Evgenii Stepanov <eugenis@google.com>
Link: [https://lore.kernel.org/r/20220125182217.2605202-1-eugenis@google.com](https://lore.kernel.org/r/20220125182217.2605202-1-eugenis%40google.com)
Signed-off-by: Catalin Marinas <catalin.marinas@arm.com>
Signed-off-by: Greg Kroah-Hartman <gregkh@linuxfoundation.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)

| -rw-r--r-- | [arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/arch/arm64/mm/extable.c?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 2 insertions, 2 deletions

| diff --git a/arch/arm64/mm/extable.c b/arch/arm64/mm/extable.cindex c3d53811a15e11..5d1a3125fd2b06 100644--- a/[arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/mm/extable.c?id=b830fd118fddf4af0a41027dfc2a3dfb85b62e25)+++ b/[arch/arm64/mm/extable.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/arch/arm64/mm/extable.c?id=47fe7a1c5e3e011eeb4ab79f2d54a794fdd1c3eb)@@ -43,8 +43,8 @@ static bool ex\_handler\_load\_unaligned\_zeropad(const struct exception\_table\_entry \*ex, struct pt\_regs \*regs) {- int reg\_data = FIELD\_GET(EX\_DATA\_REG\_DATA, ex->type);- int reg\_addr = FIELD\_GET(EX\_DATA\_REG\_ADDR, ex->type);+ int reg\_data = FIELD\_GET(EX\_DATA\_REG\_DATA, ex->data);+ int reg\_addr = FIELD\_GET(EX\_DATA\_REG\_ADDR, ex->data); unsigned long data, addr, offset;  addr = pt\_regs\_read\_reg(regs, reg\_addr); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 13:35:13 +0000


