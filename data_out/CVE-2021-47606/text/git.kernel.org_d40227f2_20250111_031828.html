

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com> | 2021-11-29 09:53:27 -0800 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2021-12-17 10:30:15 +0100 |
| commit | [4c986072a8c9249b9398c7a18f216dc26a9f0e35](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)) | |
| tree | [c0dd691aa37626388b04b91d6a499f0b06ae2bb2](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35) | |
| parent | [2d5ba2f40e73de50bba373715c11aac7c91cc75e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=2d5ba2f40e73de50bba373715c11aac7c91cc75e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35&id2=2d5ba2f40e73de50bba373715c11aac7c91cc75e)) | |
| download | [linux-4c986072a8c9249b9398c7a18f216dc26a9f0e35.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4c986072a8c9249b9398c7a18f216dc26a9f0e35.tar.gz) | |

net: netlink: af\_netlink: Prevent empty skb by adding a check on len.[ Upstream commit f123cffdd8fe8ea6c7fded4b88516a42798797d0 ]
Adding a check on len parameter to avoid empty skb. This prevents a
division error in netem\_enqueue function which is caused when skb->len=0
and skb->data\_len=0 in the randomized corruption step as shown below.
skb->data[prandom\_u32() % skb\_headlen(skb)] ^= 1<<(prandom\_u32() % 8);
Crash Report:
[ 343.170349] netdevsim netdevsim0 netdevsim3: set [1, 0] type 2 family
0 port 6081 - 0
[ 343.216110] netem: version 1.3
[ 343.235841] divide error: 0000 [#1] PREEMPT SMP KASAN NOPTI
[ 343.236680] CPU: 3 PID: 4288 Comm: reproducer Not tainted 5.16.0-rc1+
[ 343.237569] Hardware name: QEMU Standard PC (i440FX + PIIX, 1996),
BIOS 1.11.0-2.el7 04/01/2014
[ 343.238707] RIP: 0010:netem\_enqueue+0x1590/0x33c0 [sch\_netem]
[ 343.239499] Code: 89 85 58 ff ff ff e8 5f 5d e9 d3 48 8b b5 48 ff ff
ff 8b 8d 50 ff ff ff 8b 85 58 ff ff ff 48 8b bd 70 ff ff ff 31 d2 2b 4f
74 <f7> f1 48 b8 00 00 00 00 00 fc ff df 49 01 d5 4c 89 e9 48 c1 e9 03
[ 343.241883] RSP: 0018:ffff88800bcd7368 EFLAGS: 00010246
[ 343.242589] RAX: 00000000ba7c0a9c RBX: 0000000000000001 RCX:
0000000000000000
[ 343.243542] RDX: 0000000000000000 RSI: ffff88800f8edb10 RDI:
ffff88800f8eda40
[ 343.244474] RBP: ffff88800bcd7458 R08: 0000000000000000 R09:
ffffffff94fb8445
[ 343.245403] R10: ffffffff94fb8336 R11: ffffffff94fb8445 R12:
0000000000000000
[ 343.246355] R13: ffff88800a5a7000 R14: ffff88800a5b5800 R15:
0000000000000020
[ 343.247291] FS: 00007fdde2bd7700(0000) GS:ffff888109780000(0000)
knlGS:0000000000000000
[ 343.248350] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 343.249120] CR2: 00000000200000c0 CR3: 000000000ef4c000 CR4:
00000000000006e0
[ 343.250076] Call Trace:
[ 343.250423] <TASK>
[ 343.250713] ? memcpy+0x4d/0x60
[ 343.251162] ? netem\_init+0xa0/0xa0 [sch\_netem]
[ 343.251795] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.252443] netem\_enqueue+0xe28/0x33c0 [sch\_netem]
[ 343.253102] ? stack\_trace\_save+0x87/0xb0
[ 343.253655] ? filter\_irq\_stacks+0xb0/0xb0
[ 343.254220] ? netem\_init+0xa0/0xa0 [sch\_netem]
[ 343.254837] ? \_\_kasan\_check\_write+0x14/0x20
[ 343.255418] ? \_raw\_spin\_lock+0x88/0xd6
[ 343.255953] dev\_qdisc\_enqueue+0x50/0x180
[ 343.256508] \_\_dev\_queue\_xmit+0x1a7e/0x3090
[ 343.257083] ? netdev\_core\_pick\_tx+0x300/0x300
[ 343.257690] ? check\_kcov\_mode+0x10/0x40
[ 343.258219] ? \_raw\_spin\_unlock\_irqrestore+0x29/0x40
[ 343.258899] ? \_\_kasan\_init\_slab\_obj+0x24/0x30
[ 343.259529] ? setup\_object.isra.71+0x23/0x90
[ 343.260121] ? new\_slab+0x26e/0x4b0
[ 343.260609] ? kasan\_poison+0x3a/0x50
[ 343.261118] ? kasan\_unpoison+0x28/0x50
[ 343.261637] ? \_\_kasan\_slab\_alloc+0x71/0x90
[ 343.262214] ? memcpy+0x4d/0x60
[ 343.262674] ? write\_comp\_data+0x2f/0x90
[ 343.263209] ? \_\_kasan\_check\_write+0x14/0x20
[ 343.263802] ? \_\_skb\_clone+0x5d6/0x840
[ 343.264329] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.264958] dev\_queue\_xmit+0x1c/0x20
[ 343.265470] netlink\_deliver\_tap+0x652/0x9c0
[ 343.266067] netlink\_unicast+0x5a0/0x7f0
[ 343.266608] ? netlink\_attachskb+0x860/0x860
[ 343.267183] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.267820] ? write\_comp\_data+0x2f/0x90
[ 343.268367] netlink\_sendmsg+0x922/0xe80
[ 343.268899] ? netlink\_unicast+0x7f0/0x7f0
[ 343.269472] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.270099] ? write\_comp\_data+0x2f/0x90
[ 343.270644] ? netlink\_unicast+0x7f0/0x7f0
[ 343.271210] sock\_sendmsg+0x155/0x190
[ 343.271721] \_\_\_\_sys\_sendmsg+0x75f/0x8f0
[ 343.272262] ? kernel\_sendmsg+0x60/0x60
[ 343.272788] ? write\_comp\_data+0x2f/0x90
[ 343.273332] ? write\_comp\_data+0x2f/0x90
[ 343.273869] \_\_\_sys\_sendmsg+0x10f/0x190
[ 343.274405] ? sendmsg\_copy\_msghdr+0x80/0x80
[ 343.274984] ? slab\_post\_alloc\_hook+0x70/0x230
[ 343.275597] ? futex\_wait\_setup+0x240/0x240
[ 343.276175] ? security\_file\_alloc+0x3e/0x170
[ 343.276779] ? write\_comp\_data+0x2f/0x90
[ 343.277313] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.277969] ? write\_comp\_data+0x2f/0x90
[ 343.278515] ? \_\_fget\_files+0x1ad/0x260
[ 343.279048] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.279685] ? write\_comp\_data+0x2f/0x90
[ 343.280234] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.280874] ? sockfd\_lookup\_light+0xd1/0x190
[ 343.281481] \_\_sys\_sendmsg+0x118/0x200
[ 343.281998] ? \_\_sys\_sendmsg\_sock+0x40/0x40
[ 343.282578] ? alloc\_fd+0x229/0x5e0
[ 343.283070] ? write\_comp\_data+0x2f/0x90
[ 343.283610] ? write\_comp\_data+0x2f/0x90
[ 343.284135] ? \_\_sanitizer\_cov\_trace\_pc+0x21/0x60
[ 343.284776] ? ktime\_get\_coarse\_real\_ts64+0xb8/0xf0
[ 343.285450] \_\_x64\_sys\_sendmsg+0x7d/0xc0
[ 343.285981] ? syscall\_enter\_from\_user\_mode+0x4d/0x70
[ 343.286664] do\_syscall\_64+0x3a/0x80
[ 343.287158] entry\_SYSCALL\_64\_after\_hwframe+0x44/0xae
[ 343.287850] RIP: 0033:0x7fdde24cf289
[ 343.288344] Code: 01 00 48 81 c4 80 00 00 00 e9 f1 fe ff ff 0f 1f 00
48 89 f8 48 89 f7 48 89 d6 48 89 ca 4d 89 c2 4d 89 c8 4c 8b 4c 24 08 0f
05 <48> 3d 01 f0 ff ff 73 01 c3 48 8b 0d b7 db 2c 00 f7 d8 64 89 01 48
[ 343.290729] RSP: 002b:00007fdde2bd6d98 EFLAGS: 00000246 ORIG\_RAX:
000000000000002e
[ 343.291730] RAX: ffffffffffffffda RBX: 0000000000000000 RCX:
00007fdde24cf289
[ 343.292673] RDX: 0000000000000000 RSI: 00000000200000c0 RDI:
0000000000000004
[ 343.293618] RBP: 00007fdde2bd6e20 R08: 0000000100000001 R09:
0000000000000000
[ 343.294557] R10: 0000000100000001 R11: 0000000000000246 R12:
0000000000000000
[ 343.295493] R13: 0000000000021000 R14: 0000000000000000 R15:
00007fdde2bd7700
[ 343.296432] </TASK>
[ 343.296735] Modules linked in: sch\_netem ip6\_vti ip\_vti ip\_gre ipip
sit ip\_tunnel geneve macsec macvtap tap ipvlan macvlan 8021q garp mrp
hsr wireguard libchacha20poly1305 chacha\_x86\_64 poly1305\_x86\_64
ip6\_udp\_tunnel udp\_tunnel libblake2s blake2s\_x86\_64 libblake2s\_generic
curve25519\_x86\_64 libcurve25519\_generic libchacha xfrm\_interface
xfrm6\_tunnel tunnel4 veth netdevsim psample batman\_adv nlmon dummy team
bonding tls vcan ip6\_gre ip6\_tunnel tunnel6 gre tun ip6t\_rpfilter
ipt\_REJECT nf\_reject\_ipv4 ip6t\_REJECT nf\_reject\_ipv6 xt\_conntrack ip\_set
ebtable\_nat ebtable\_broute ip6table\_nat ip6table\_mangle
ip6table\_security ip6table\_raw iptable\_nat nf\_nat nf\_conntrack
nf\_defrag\_ipv6 nf\_defrag\_ipv4 iptable\_mangle iptable\_security
iptable\_raw ebtable\_filter ebtables rfkill ip6table\_filter ip6\_tables
iptable\_filter ppdev bochs drm\_vram\_helper drm\_ttm\_helper ttm
drm\_kms\_helper cec parport\_pc drm joydev floppy parport sg syscopyarea
sysfillrect sysimgblt i2c\_piix4 qemu\_fw\_cfg fb\_sys\_fops pcspkr
[ 343.297459] ip\_tables xfs virtio\_net net\_failover failover sd\_mod
sr\_mod cdrom t10\_pi ata\_generic pata\_acpi ata\_piix libata virtio\_pci
virtio\_pci\_legacy\_dev serio\_raw virtio\_pci\_modern\_dev dm\_mirror
dm\_region\_hash dm\_log dm\_mod
[ 343.311074] Dumping ftrace buffer:
[ 343.311532] (ftrace buffer empty)
[ 343.312040] ---[ end trace a2e3db5a6ae05099 ]---
[ 343.312691] RIP: 0010:netem\_enqueue+0x1590/0x33c0 [sch\_netem]
[ 343.313481] Code: 89 85 58 ff ff ff e8 5f 5d e9 d3 48 8b b5 48 ff ff
ff 8b 8d 50 ff ff ff 8b 85 58 ff ff ff 48 8b bd 70 ff ff ff 31 d2 2b 4f
74 <f7> f1 48 b8 00 00 00 00 00 fc ff df 49 01 d5 4c 89 e9 48 c1 e9 03
[ 343.315893] RSP: 0018:ffff88800bcd7368 EFLAGS: 00010246
[ 343.316622] RAX: 00000000ba7c0a9c RBX: 0000000000000001 RCX:
0000000000000000
[ 343.317585] RDX: 0000000000000000 RSI: ffff88800f8edb10 RDI:
ffff88800f8eda40
[ 343.318549] RBP: ffff88800bcd7458 R08: 0000000000000000 R09:
ffffffff94fb8445
[ 343.319503] R10: ffffffff94fb8336 R11: ffffffff94fb8445 R12:
0000000000000000
[ 343.320455] R13: ffff88800a5a7000 R14: ffff88800a5b5800 R15:
0000000000000020
[ 343.321414] FS: 00007fdde2bd7700(0000) GS:ffff888109780000(0000)
knlGS:0000000000000000
[ 343.322489] CS: 0010 DS: 0000 ES: 0000 CR0: 0000000080050033
[ 343.323283] CR2: 00000000200000c0 CR3: 000000000ef4c000 CR4:
00000000000006e0
[ 343.324264] Kernel panic - not syncing: Fatal exception in interrupt
[ 343.333717] Dumping ftrace buffer:
[ 343.334175] (ftrace buffer empty)
[ 343.334653] Kernel Offset: 0x13600000 from 0xffffffff81000000
(relocation range: 0xffffffff80000000-0xffffffffbfffffff)
[ 343.336027] Rebooting in 86400 seconds..
Reported-by: syzkaller <syzkaller@googlegroups.com>
Signed-off-by: Harshit Mogalapalli <harshit.m.mogalapalli@oracle.com>
Link: [https://lore.kernel.org/r/20211129175328.55339-1-harshit.m.mogalapalli@oracle.com](https://lore.kernel.org/r/20211129175328.55339-1-harshit.m.mogalapalli%40oracle.com)
Signed-off-by: Jakub Kicinski <kuba@kernel.org>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)

| -rw-r--r-- | [net/netlink/af\_netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/netlink/af_netlink.c?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35) | 5 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 0 deletions

| diff --git a/net/netlink/af\_netlink.c b/net/netlink/af\_netlink.cindex ada47e59647a03..81ba8e51e01ffd 100644--- a/[net/netlink/af\_netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netlink/af_netlink.c?id=2d5ba2f40e73de50bba373715c11aac7c91cc75e)+++ b/[net/netlink/af\_netlink.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/netlink/af_netlink.c?id=4c986072a8c9249b9398c7a18f216dc26a9f0e35)@@ -1871,6 +1871,11 @@ static int netlink\_sendmsg(struct socket \*sock, struct msghdr \*msg, size\_t len) if (msg->msg\_flags & MSG\_OOB) return -EOPNOTSUPP; + if (len == 0) {+ pr\_warn\_once("Zero length message leads to an empty skb\n");+ return -ENODATA;+ }+ err = scm\_send(sock, msg, &scm, true); if (err < 0) return err; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 03:17:05 +0000

