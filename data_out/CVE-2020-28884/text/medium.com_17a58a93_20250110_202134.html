[Open in app](https://rsci.app.link/?%24canonical_url=https%3A%2F%2Fmedium.com%2Fp%2F84498bde18d3&%7Efeature=LoOpenInAppButton&%7Echannel=ShowPostUnderUser&source=---top_nav_layout_nav----------------------------------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40tranpdanh%2Fsome-way-to-execute-os-command-in-liferay-portal-84498bde18d3&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

[Write](/m/signin?operation=register&redirect=https%3A%2F%2Fmedium.com%2Fnew-story&source=---top_nav_layout_nav-----------------------new_post_topnav-----------)

Sign up

[Sign in](/m/signin?operation=login&redirect=https%3A%2F%2Fmedium.com%2F%40tranpdanh%2Fsome-way-to-execute-os-command-in-liferay-portal-84498bde18d3&source=post_page---top_nav_layout_nav-----------------------global_nav-----------)

![](https://miro.medium.com/v2/resize:fill:64:64/1*dmbNkD5D-u45r44go_cf0g.png)
# Some way to execute OS command in Liferay Portal

[![TPDanh](https://miro.medium.com/v2/resize:fill:88:88/0*dpUI7w3rpCPYVGRq.jpg)](/%40tranpdanh?source=post_page---byline--84498bde18d3--------------------------------)

[TPDanh](/%40tranpdanh?source=post_page---byline--84498bde18d3--------------------------------)

·

[Follow](/m/signin?actionUrl=https%3A%2F%2Fmedium.com%2F_%2Fsubscribe%2Fuser%2Ffb70136f517e&operation=register&redirect=https%3A%2F%2Fmedium.com%2F%40tranpdanh%2Fsome-way-to-execute-os-command-in-liferay-portal-84498bde18d3&user=TPDanh&userId=fb70136f517e&source=post_page-fb70136f517e--byline--84498bde18d3---------------------post_header-----------)

3 min read·Nov 15, 2020

--

Listen

Share

Recently, I have a chance to work with Liferay CE Portal and explore some attack vectors to execute OS command on it.

**What is Liferay Portal?**

Liferay Portal is a portal solution designed in accordance with application models in agencies, organizations and businesses wishing to develop information systems on the web environment to perform online transactions and use the Intranet / Internet as an essential tool in operations, information provision, communication, management, and administration, with a variety of utilities, exchange and collaboration.

![]()

Deployment diagram for a Liferay Portal instance

**The journey to discover Vulnerabilitiess**

When try to exploit the target (Liferay Portal Server), I found that I can access with admin privilage with default account **test@liferay.com**/**test**(critical bug)**.** With admin privilage, I can do many thing but my purpose is Remote Code Execution (RCE) the target. That’s why I found 2 way to execute OS command in Liferay Portal Server.

**First vulnerability**: Admin user can execute any OS command on Liferay Portal Server via Groovy Script.

Try to find the way to execute command on the target server, I read lots about Liferay Portal and found out Administrator can execute Groovy Script. [The document](https://learn.liferay.com/dxp/7.x/en/system-administration/using-the-script-engine/running-scripts-from-the-script-console.html) about Groovy Script shows that this module has predefined variables that facilitate working with widgets and users. That sound like a box, what happend if I can escape the box ? I can execute OS command on the Sever. That is my purpose.

Let’s go ahead. Access this path, I can run Groovy Script.

> https://[domain]/group/control\_panel/manage?p\_p\_id=com\_liferay\_server\_admin\_web\_portlet\_ServerAdminPortlet&p\_p\_lifecycle=0&p\_p\_state=maximized&p\_p\_mode=view&\_com\_liferay\_server\_admin\_web\_portlet\_ServerAdminPortlet\_mvcRenderCommandName=%2Fserver\_admin%2Fview&\_com\_liferay\_server\_admin\_web\_portlet\_ServerAdminPortlet\_tabs1=script

![]()

After a while I searched for the script can help my purpose, I found this one. Inject the script below to the Script box to execute any OS command.

```
def sout = new StringBuilder(), serr = new StringBuilder()
def proc = '[command]'.execute()
proc.consumeProcessOutput(sout, serr)
proc.waitForOrKill(1000)
println "out> $sout err> $serr"
```

Replace [command] with any OS command, I tested on Linux server with command “ls -la”.

![]()

The script get the command, execute it on the server and get standard output, standard error then print to browser.

**Second vulnerability**: Admin user can execute any OS command on Liferay Portal Server via Gogo Shell module.

When access Liferay Portal control panel, I saw the module named “Gogo shell”. The name is very promising for my purposes. I found and read [the document](https://learn.liferay.com/dxp/7.x/en/liferay-internals/fundamentals/using-the-gogo-shell/using-the-gogo-shell.html) about this module. The Gogo shell provides a way to interact with the module framework. There a [list command](https://learn.liferay.com/dxp/7.x/en/liferay-internals/fundamentals/using-the-gogo-shell/gogo-shell-commands.html) that were defined. Example run “help” to show list command, “lb” to list all of the bundles installed in Liferay’s module framework. That like a box same with first vulnerability. I must figure out the way to escape that box.
The URL to access Gogo Shell module:

> https://[domain]/group/control\_panel/manage?p\_p\_id=com\_liferay\_gogo\_shell\_web\_internal\_portlet\_GogoShellPortlet&p\_p\_lifecycle=0&p\_p\_state=maximized&p\_p\_mode=view&\_com\_liferay\_gogo\_shell\_web\_internal\_portlet\_GogoShellPortlet\_javax.portlet.action=executeCommand&p\_p\_auth=GQ1fDPiH

I try to insert command not in list command defined. And success, the OS command run on the target server and print the result on the browser.

![]()

I think Liferay Portal need more mechanisms to check which script/command can be executed via Groovy Script and Gogo Shell module.

Both vulnerabilities were tested on Liferay Portal CE 7.3.5 GA6 and Liferay Portal CE 7.2.0 GA1.

I am @[babywolf](https://www.linkedin.com/in/tran-phu-danh-51a4b0135/). Thank @[ledz1996](https://hackerone.com/ledz1996?type=user) for suppoting me to find out these vulneratbilities.

[Liferay](/tag/liferay?source=post_page-----84498bde18d3--------------------------------)[Rce](/tag/rce?source=post_page-----84498bde18d3--------------------------------)[Exploit](/tag/exploit?source=post_page-----84498bde18d3--------------------------------)

--

--

[![TPDanh](https://miro.medium.com/v2/resize:fill:96:96/0*dpUI7w3rpCPYVGRq.jpg)](/%40tranpdanh?source=post_page---post_author_info--84498bde18d3--------------------------------)[![TPDanh](https://miro.medium.com/v2/resize:fill:128:128/0*dpUI7w3rpCPYVGRq.jpg)](/%40tranpdanh?source=post_page---post_author_info--84498bde18d3--------------------------------)Follow[## Written by TPDanh](/%40tranpdanh?source=post_page---post_author_info--84498bde18d3--------------------------------)[1 Follower](/%40tranpdanh/followers?source=post_page---post_author_info--84498bde18d3--------------------------------)·[7 Following](/%40tranpdanh/following?source=post_page---post_author_info--84498bde18d3--------------------------------)Follow
## No responses yet

[Help](https://help.medium.com/hc/en-us?source=post_page-----84498bde18d3--------------------------------)[Status](https://medium.statuspage.io/?source=post_page-----84498bde18d3--------------------------------)[About](/about?autoplay=1&source=post_page-----84498bde18d3--------------------------------)[Careers](/jobs-at-medium/work-at-medium-959d1a85284e?source=post_page-----84498bde18d3--------------------------------)[Press](pressinquiries%40medium.com?source=post_page-----84498bde18d3--------------------------------)[Blog](https://blog.medium.com/?source=post_page-----84498bde18d3--------------------------------)[Privacy](https://policy.medium.com/medium-privacy-policy-f03bf92035c9?source=post_page-----84498bde18d3--------------------------------)[Terms](https://policy.medium.com/medium-terms-of-service-9db0094a1e0f?source=post_page-----84498bde18d3--------------------------------)[Text to speech](https://speechify.com/medium?source=post_page-----84498bde18d3--------------------------------)[Teams](/business?source=post_page-----84498bde18d3--------------------------------)

