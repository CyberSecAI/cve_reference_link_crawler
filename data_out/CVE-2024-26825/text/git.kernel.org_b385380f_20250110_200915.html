

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Fedor Pchelkin <pchelkin@ispras.ru> | 2024-01-25 12:53:09 +0300 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-01-29 12:05:31 +0000 |
| commit | [bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)) | |
| tree | [a3064cdd2bb98ec2dbc5b345056a18cfc738c67f](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c) | |
| parent | [37e8c97e539015637cb920d3e6f1e404f707a06e](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=37e8c97e539015637cb920d3e6f1e404f707a06e) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c&id2=37e8c97e539015637cb920d3e6f1e404f707a06e)) | |
| download | [linux-bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c.tar.gz) | |

nfc: nci: free rx\_data\_reassembly skb on NCI device cleanuprx\_data\_reassembly skb is stored during NCI data exchange for processing
fragmented packets. It is dropped only when the last fragment is processed
or when an NTF packet with NCI\_OP\_RF\_DEACTIVATE\_NTF opcode is received.
However, the NCI device may be deallocated before that which leads to skb
leak.
As by design the rx\_data\_reassembly skb is bound to the NCI device and
nothing prevents the device to be freed before the skb is processed in
some way and cleaned, free it on the NCI device cleanup.
Found by Linux Verification Center (linuxtesting.org) with Syzkaller.
Fixes: 6a2968aaf50c ("NFC: basic NCI protocol implementation")
Cc: stable@vger.kernel.org
Reported-by: syzbot+6b7c68d9c21e4ee4251b@syzkaller.appspotmail.com
Closes: https://lore.kernel.org/lkml/000000000000f43987060043da7b@google.com/
Signed-off-by: Fedor Pchelkin <pchelkin@ispras.ru>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)

| -rw-r--r-- | [net/nfc/nci/core.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/nfc/nci/core.c?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 4 insertions, 0 deletions

| diff --git a/net/nfc/nci/core.c b/net/nfc/nci/core.cindex 97348cedb16b30..cdad47b140fa4b 100644--- a/[net/nfc/nci/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/nfc/nci/core.c?id=37e8c97e539015637cb920d3e6f1e404f707a06e)+++ b/[net/nfc/nci/core.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/nfc/nci/core.c?id=bfb007aebe6bff451f7f3a4be19f4f286d0d5d9c)@@ -1208,6 +1208,10 @@ void nci\_free\_device(struct nci\_dev \*ndev) { nfc\_free\_device(ndev->nfc\_dev); nci\_hci\_deallocate(ndev);++ /\* drop partial rx data packet if present \*/+ if (ndev->rx\_data\_reassembly)+ kfree\_skb(ndev->rx\_data\_reassembly); kfree(ndev); } EXPORT\_SYMBOL(nci\_free\_device); |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 20:07:52 +0000

