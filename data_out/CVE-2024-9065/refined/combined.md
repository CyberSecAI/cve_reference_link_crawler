=== Content from plugins.trac.wordpress.org_de4b0158_20250111_161543.html ===


[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fbrowser%2Fwp-helper-lite%2Ftrunk%2Ffunctions%2Fclass.wps-frontend-setup-function.php)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Revision](/browser/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php?rev=3127087 "Revision 3127087")
* Next Revision →
* [Blame](/browser/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php?annotate=blame "Annotate each line with the last changed revision (this can be time consuming...)")
* [Revision Log](/log/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php)

---

# [source:](/browser?order=name "Go to repository root") [wp-helper-lite](/browser/wp-helper-lite?order=name "View wp-helper-lite")/[trunk](/browser/wp-helper-lite/trunk?order=name "View trunk")/[functions](/browser/wp-helper-lite/trunk/functions?order=name "View functions")/[class.wps-frontend-setup-function.php](/browser/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php?order=name "View class.wps-frontend-setup-function.php")

View diff against:

View revision:

| [Last change](/changeset/3167825/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php "View differences") on this file was [3167825](/changeset/3167825/ "View changeset 3167825"), checked in by matbao, [3 months ago](/timeline?from=2024-10-13T01%3A31%3A46Z&precision=second "See timeline at 10/13/2024 01:31:46 AM") |
| --- |
| check permission user send mail test |
| **File size:** 58.1 KB | |

| Line |  |
| --- | --- |
| [1](#L1) | <?php |
| [2](#L2) |  |
| [3](#L3) | use Symfony\Component\CssSelector\XPath\XPathExpr; |
| [4](#L4) |  |
| [5](#L5) | if (!class\_exists('MB\_WHP\_Frontend\_Setup\_Function')) { |
| [6](#L6) | class MB\_WHP\_Frontend\_Setup\_Function |
| [7](#L7) | { |
| [8](#L8) | private $pathView = MB\_WHP\_PATH\_VIEW . 'frontend/pages/'; |
| [9](#L9) | private $pathViewAdmin = MB\_WHP\_PATH\_VIEW . 'admin/pages/'; |
| [10](#L10) | private $pathViewElement = MB\_WHP\_PATH\_VIEW . 'frontend/elements/'; |
| [11](#L11) | private $pathViewPages = MB\_WHP\_PATH\_VIEW . 'frontend/pages/'; |
| [12](#L12) | private $pathViewLayout = MB\_WHP\_PATH\_VIEW . 'layout/'; |
| [13](#L13) | private $pathAsset = MB\_WHP\_URL . 'assets/frontend/'; |
| [14](#L14) | private $pathSidebar = MB\_WHP\_PATH\_SIDEBAR; |
| [15](#L15) | function \_\_construct() |
| [16](#L16) | { |
| [17](#L17) |  |
| [18](#L18) | add\_action('wp\_enqueue\_scripts', [$this, 'include\_style']); |
| [19](#L19) | add\_action('wp\_enqueue\_scripts', [$this, 'include\_script']); |
| [20](#L20) | $this->include\_header(); |
| [21](#L21) | $this->include\_body(); |
| [22](#L22) | $this->include\_footer(); |
| [23](#L23) | $this->whp\_smtp(); |
| [24](#L24) | $this->whp\_security(); |
| [25](#L25) | $this->whp\_woo\_cta(); |
| [26](#L26) | $this->whp\_ecommerce(); |
| [27](#L27) | $this->whp\_advance(); |
| [28](#L28) | $this->whp\_extention(); |
| [29](#L29) | $this->whp\_woo\_admin\_ecommerce(); |
| [30](#L30) | $this->whp\_checkout(); |
| [31](#L31) | $this->whp\_gateway\_wallet(); |
| [32](#L32) | // $this->whp\_maintenance(); |
| [33](#L33) | $this->whp\_popup(); |
| [34](#L34) | $this->whp\_reponsive(); |
| [35](#L35) |  |
| [36](#L36) | add\_action('wp\_ajax\_whp\_smtp\_send\_mail\_test', [$this, 'whp\_smtp\_send\_mail\_test']); |
| [37](#L37) | add\_action('wp\_ajax\_nopriv\_whp\_smtp\_send\_mail\_test', [$this, 'whp\_smtp\_send\_mail\_test']); |
| [38](#L38) | //  add\_filter('template\_include', [$this, 'whp\_wallet\_thanhyou\_page'], 10, 2); |
| [39](#L39) | //  add\_action('get\_header', [$this, 'whp\_maintenance']); |
| [40](#L40) | add\_action('wp', [$this, 'whp\_maintenance']); |
| [41](#L41) | } |
| [42](#L42) | public function whp\_wallet\_thanhyou\_page($template) |
| [43](#L43) | { |
| [44](#L44) | global $wp; |
| [45](#L45) | if (!empty($wp->query\_vars['order-received'])) { |
| [46](#L46) |  |
| [47](#L47) | $new\_template =    $this->pathViewPages . 'thank\_you.php'; |
| [48](#L48) | if (file\_exists($new\_template)) { |
| [49](#L49) |  |
| [50](#L50) | return $new\_template; |
| [51](#L51) | } |
| [52](#L52) | } |
| [53](#L53) | return $template; |
| [54](#L54) | } |
| [55](#L55) | public function whp\_smtp\_send\_mail\_test() |
| [56](#L56) | { |
| [57](#L57) | // Kiểm tra quyền hạn |
| [58](#L58) | if (!current\_user\_can('manage\_options')) { |
| [59](#L59) | echo json\_encode(['status' => 403, 'message' => 'Unauthorized']); |
| [60](#L60) | exit(); |
| [61](#L61) | } |
| [62](#L62) |  |
| [63](#L63) | // Kiểm tra xác thực nonce |
| [64](#L64) | if (!isset($\_POST['nonce']) || !wp\_verify\_nonce($\_POST['nonce'], 'whp\_smtp\_send\_mail\_test\_nonce')) { |
| [65](#L65) | echo json\_encode(['status' => 400, 'message' => 'Invalid nonce']); |
| [66](#L66) | exit(); |
| [67](#L67) | } |
| [68](#L68) |  |
| [69](#L69) | $to = sanitize\_text\_field($\_POST['email']); |
| [70](#L70) | $message = sanitize\_text\_field($\_POST['content']); |
| [71](#L71) | $subject = 'WP Helper - Cấu hình SMTP thành công'; |
| [72](#L72) | $mail = wp\_mail($to, $subject, $message); |
| [73](#L73) |  |
| [74](#L74) | if ($mail) { |
| [75](#L75) | echo json\_encode(['status' => 200, 'message' => 'Email sent successfully']); |
| [76](#L76) | } else { |
| [77](#L77) | echo json\_encode(['status' => 500, 'message' => 'Failed to send email']); |
| [78](#L78) | } |
| [79](#L79) | exit(); |
| [80](#L80) | } |
| [81](#L81) | public function include\_style() |
| [82](#L82) | { |
| [83](#L83) | wp\_enqueue\_style('app', $this->pathAsset . 'css/app.css', array(), time(), 'all'); |
| [84](#L84) | wp\_enqueue\_style('app', $this->pathAsset . 'css/popup.css', array(), time(), 'all'); |
| [85](#L85) | $whp\_contact\_design\_position\_y = whp\_get\_setting('whp\_contact\_design\_position\_y'); |
| [86](#L86) | $whp\_contact\_design\_color = whp\_get\_setting('whp\_contact\_design\_color'); |
| [87](#L87) | $custom\_css = " |
| [88](#L88) | #mb-whp-contact{ |
| [89](#L89) | bottom: {$whp\_contact\_design\_position\_y}px; |
| [90](#L90) | } |
| [91](#L91) | .whp-contact-icon, .whp-contact-icon:before, .whp-contact-icon:after, .whp-contact-icon:before, .whp-contact-icon:before, .whp-contact-content-head { |
| [92](#L92) | background: {$whp\_contact\_design\_color} |
| [93](#L93) | } |
| [94](#L94) | "; |
| [95](#L95) | wp\_add\_inline\_style('app', $custom\_css); |
| [96](#L96) | } |
| [97](#L97) |  |
| [98](#L98) | public function include\_script() |
| [99](#L99) | { |
| [100](#L100) | wp\_enqueue\_script('app', $this->pathAsset . 'js/app.js', array('jquery'), time(), true); |
| [101](#L101) | } |
| [102](#L102) | public function include\_header() |
| [103](#L103) | { |
| [104](#L104) | add\_action('wp\_head', [$this, 'whp\_header\_code']); |
| [105](#L105) | } |
| [106](#L106) | public function include\_body() |
| [107](#L107) | { |
| [108](#L108) | add\_action('wp\_body\_open', [$this, 'whp\_body\_code']); |
| [109](#L109) | } |
| [110](#L110) | public function include\_footer() |
| [111](#L111) | { |
| [112](#L112) | add\_action('wp\_footer', [$this, 'whp\_contact']); |
| [113](#L113) | add\_action('wp\_footer', [$this, 'whp\_footer\_code']); |
| [114](#L114) | } |
| [115](#L115) | public function whp\_header\_code() |
| [116](#L116) | { |
| [117](#L117) | $code = whp\_get\_setting('whp\_code\_header'); |
| [118](#L118) | echo stripslashes($code); |
| [119](#L119) | } |
| [120](#L120) | public function whp\_body\_code() |
| [121](#L121) | { |
| [122](#L122) | $code = whp\_get\_setting('whp\_code\_body'); |
| [123](#L123) | echo stripslashes($code); |
| [124](#L124) | } |
| [125](#L125) | public function whp\_footer\_code() |
| [126](#L126) | { |
| [127](#L127) | $code = whp\_get\_setting('whp\_code\_footer'); |
| [128](#L128) | echo stripslashes($code); |
| [129](#L129) | } |
| [130](#L130) | // start contact |
| [131](#L131) | public function whp\_contact() |
| [132](#L132) | { |
| [133](#L133) | $whp\_contact\_active = whp\_get\_setting('whp\_contact\_active'); |
| [134](#L134) | $whp\_contact\_phone\_only = null; |
| [135](#L135) | $whp\_contact\_phone\_class = null; |
| [136](#L136) | $whp\_contact\_phone\_data\_number = null; |
| [137](#L137) | if ($whp\_contact\_active) { |
| [138](#L138) | $fields = whp\_get\_contact\_fields(); |
| [139](#L139) | foreach ($fields as $field) { |
| [140](#L140) | $$field = whp\_get\_setting($field); |
| [141](#L141) | } |
| [142](#L142) | $whp\_contact\_phone\_data\_number = is\_array($whp\_contact\_phone\_data) ? count($whp\_contact\_phone\_data) : 0; |
| [143](#L143) | $whp\_contact\_phone\_class = $whp\_contact\_phone\_data\_number == 1 ? "only-call" : ""; |
| [144](#L144) | $whp\_contact\_phone\_first = $whp\_contact\_phone\_data\_number == 1 ? array\_shift($whp\_contact\_phone\_data) : []; |
| [145](#L145) | $whp\_contact\_phone\_only = $whp\_contact\_phone\_first['phone'] ?? ""; |
| [146](#L146) | global $field; |
| [147](#L147) | require\_once($this->pathViewElement . "contact.php"); |
| [148](#L148) | } |
| [149](#L149) | } |
| [150](#L150) | // end contact |
| [151](#L151) |  |
| [152](#L152) | // start smtp |
| [153](#L153) | public function whp\_smtp() |
| [154](#L154) | { |
| [155](#L155) | add\_action('phpmailer\_init', [$this, 'whp\_smtp\_send\_mail']); |
| [156](#L156) | add\_filter('wp\_mail\_content\_type', [$this, 'whp\_mail\_content\_type']); |
| [157](#L157) | } |
| [158](#L158) | public function whp\_smtp\_send\_mail($phpmailer) |
| [159](#L159) | { |
| [160](#L160) | $fields = whp\_get\_smtp\_fields(); |
| [161](#L161) | foreach ($fields as $field) { |
| [162](#L162) | $$field = whp\_get\_setting($field); |
| [163](#L163) | } |
| [164](#L164) | if ($whp\_smtp\_active) { |
| [165](#L165) | $phpmailer->isSMTP(); |
| [166](#L166) | $phpmailer->FromName = $whp\_smtp\_from\_name ?? ""; |
| [167](#L167) | $phpmailer->Host = $whp\_smtp\_host ?? ""; |
| [168](#L168) | $phpmailer->Port = $whp\_smtp\_port ?? ""; |
| [169](#L169) | $phpmailer->SMTPSecure = $whp\_smtp\_security ?? ""; |
| [170](#L170) | $phpmailer->From = $whp\_smtp\_email ?? ""; |
| [171](#L171) | $phpmailer->SMTPAuth = true; |
| [172](#L172) | $phpmailer->Username = $whp\_smtp\_user ?? ""; |
| [173](#L173) | $phpmailer->Password = $whp\_smtp\_password ?? ""; |
| [174](#L174) | $phpmailer->AddReplyTo($phpmailer->From, $phpmailer->FromName); |
| [175](#L175) | } |
| [176](#L176) | } |
| [177](#L177) | public function whp\_mail\_content\_type() |
| [178](#L178) | { |
| [179](#L179) | return 'text/html'; |
| [180](#L180) | } |
| [181](#L181) | // end smtp |
| [182](#L182) | // start security |
| [183](#L183) | public function whp\_security() |
| [184](#L184) | { |
| [185](#L185) | $fields = whp\_get\_security\_fields(); |
| [186](#L186) | foreach ($fields as $field) { |
| [187](#L187) | $$field = whp\_get\_setting($field); |
| [188](#L188) | } |
| [189](#L189) |  |
| [190](#L190) | if ($whp\_security\_remove\_xmlrpc) { |
| [191](#L191) | add\_filter('xmlrpc\_enabled', '\_\_return\_false'); |
| [192](#L192) | } |
| [193](#L193) | if ($whp\_security\_disable\_copy) { |
| [194](#L194) | add\_action('wp\_enqueue\_scripts', [$this, 'whp\_security\_disable\_copy']); |
| [195](#L195) | } |
| [196](#L196) | if ($whp\_security\_delete\_wphead) { |
| [197](#L197) | $this->whp\_security\_remove\_wphead(); |
| [198](#L198) | } |
| [199](#L199) | if ($whp\_security\_hide\_wp\_version) { |
| [200](#L200) | $this->whp\_security\_hide\_wp\_version(); |
| [201](#L201) | } |
| [202](#L202) | if ($whp\_security\_hide\_theme\_plugin) { |
| [203](#L203) | $this->whp\_security\_hide\_theme\_plugin(); |
| [204](#L204) | } |
| [205](#L205) |  |
| [206](#L206) | if ($whp\_new\_login\_url) { |
| [207](#L207) |  |
| [208](#L208) | $site\_url = site\_url(); |
| [209](#L209) |  |
| [210](#L210) | define('site\_url', $site\_url); |
| [211](#L211) |  |
| [212](#L212) | add\_action('init', function () use ($whp\_new\_login\_url) { |
| [213](#L213) |  |
| [214](#L214) | $current\_url   = str\_replace('/', '', $\_SERVER['REQUEST\_URI']); |
| [215](#L215) |  |
| [216](#L216) | $url\_new = $whp\_new\_login\_url; |
| [217](#L217) |  |
| [218](#L218) | $redirectNaTo  = site\_url . '/wp-admin/'; |
| [219](#L219) | $adminToCheck = [ |
| [220](#L220) | 'wp-admin', |
| [221](#L221) | 'login', |
| [222](#L222) | 'wp-admin.php', |
| [223](#L223) | 'wp-login.php' |
| [224](#L224) | ]; |
| [225](#L225) | if (!is\_user\_logged\_in()) { |
| [226](#L226) | if ($current\_url == $url\_new) { |
| [227](#L227) | wp\_redirect('/wp-login.php?redirect\_to=' . $redirectNaTo); |
| [228](#L228) | exit; |
| [229](#L229) | } |
| [230](#L230) | if (in\_array($current\_url, $adminToCheck) && $current\_url  !== 'wp-login.php') { |
| [231](#L231) | wp\_redirect(site\_url); |
| [232](#L232) | exit; |
| [233](#L233) | } |
| [234](#L234) | } else { |
| [235](#L235) | if ($current\_url == $url\_new || $current\_url == 'wp-login.php') { |
| [236](#L236) | wp\_redirect($redirectNaTo); |
| [237](#L237) | exit; |
| [238](#L238) | } |
| [239](#L239) | } |
| [240](#L240) | }); |
| [241](#L241) | } |
| [242](#L242) | } |
| [243](#L243) |  |
| [244](#L244) |  |
| [245](#L245) | public function whp\_security\_disable\_copy() |
| [246](#L246) | { |
| [247](#L247) | wp\_enqueue\_script('disableCopy', $this->pathAsset . 'js/disableCopy.js', array('jquery'), time(), true); |
| [248](#L248) | } |
| [249](#L249) | public function whp\_security\_remove\_wphead() |
| [250](#L250) | { |
| [251](#L251) | remove\_action('wp\_head', 'wp\_generator'); |
| [252](#L252) | remove\_action('wp\_head', 'rsd\_link'); |
| [253](#L253) | remove\_action('wp\_head', 'wlwmanifest\_link'); |
| [254](#L254) | remove\_action('wp\_head', 'wp\_shortlink\_wp\_head', 10, 0); |
| [255](#L255) | remove\_action('wp\_head', 'feed\_links', 2); |
| [256](#L256) | remove\_action('wp\_head', 'feed\_links\_extra', 3); |
| [257](#L257) | remove\_action('wp\_head', 'start\_post\_rel\_link', 10, 0); |
| [258](#L258) | remove\_action('wp\_head', 'parent\_post\_rel\_link', 10, 0); |
| [259](#L259) | remove\_action('wp\_head', 'index\_rel\_link'); |
| [260](#L260) | remove\_action('wp\_head', 'adjacent\_posts\_rel\_link', 10, 0); |
| [261](#L261) | remove\_action('wp\_head', 'adjacent\_posts\_rel\_link\_wp\_head, 10, 0'); |
| [262](#L262) | } |
| [263](#L263) | public function whp\_security\_hide\_wp\_version() |
| [264](#L264) | { |
| [265](#L265) | function remove\_version\_info() |
| [266](#L266) | { |
| [267](#L267) | return ''; |
| [268](#L268) | } |
| [269](#L269) | add\_filter('the\_generator', 'remove\_version\_info'); |
| [270](#L270) | function change\_footer\_admin() |
| [271](#L271) | { |
| [272](#L272) | return ' '; |
| [273](#L273) | } |
| [274](#L274) | add\_filter('admin\_footer\_text', 'change\_footer\_admin', 9999); |
| [275](#L275) | function change\_footer\_version() |
| [276](#L276) | { |
| [277](#L277) | return ' '; |
| [278](#L278) | } |
| [279](#L279) | add\_filter('update\_footer', 'change\_footer\_version', 9999); |
| [280](#L280) | } |
| [281](#L281) | public function whp\_security\_hide\_theme\_plugin() |
| [282](#L282) | { |
| [283](#L283) | if (is\_admin()) { |
| [284](#L284) | add\_filter('auto\_update\_core', '\_\_return\_false'); |
| [285](#L285) | add\_filter('auto\_update\_translation', '\_\_return\_false'); |
| [286](#L286) | add\_action('admin\_menu', [$this, 'whp\_security\_hide\_admin\_menu']); |
| [287](#L287) | if (!defined('DISALLOW\_FILE\_EDIT')) |
| [288](#L288) | define('DISALLOW\_FILE\_EDIT', true); |
| [289](#L289) | if (!defined('DISALLOW\_FILE\_MODS')) |
| [290](#L290) | define('DISALLOW\_FILE\_MODS', true); |
| [291](#L291) | add\_action('admin\_menu', [$this, 'whp\_security\_hide\_admin\_menu']); |
| [292](#L292) | } |
| [293](#L293) | } |
| [294](#L294) | public function whp\_security\_hide\_admin\_menu() |
| [295](#L295) | { |
| [296](#L296) | remove\_menu\_page('theme-editor.php'); |
| [297](#L297) | remove\_menu\_page('plugins.php'); |
| [298](#L298) | remove\_menu\_page('themes.php'); |
| [299](#L299) | } |
| [300](#L300) |  |
| [301](#L301) | // start woocommerce cta |
| [302](#L302) | public function whp\_woo\_cta() |
| [303](#L303) | { |
| [304](#L304) | $fields = whp\_get\_woo\_cta\_fields(); |
| [305](#L305) |  |
| [306](#L306) | foreach ($fields as $field) { |
| [307](#L307) | $$field = whp\_get\_setting($field); |
| [308](#L308) | } |
| [309](#L309) | if ($whp\_woocommerce\_cta\_text) { |
| [310](#L310) | add\_filter( |
| [311](#L311) | 'woocommerce\_product\_single\_add\_to\_cart\_text', |
| [312](#L312) | function () use ($whp\_woocommerce\_cta\_text) { |
| [313](#L313) | return $whp\_woocommerce\_cta\_text; |
| [314](#L314) | }, |
| [315](#L315) | 10, |
| [316](#L316) | 2 |
| [317](#L317) | ); |
| [318](#L318) | add\_filter('woocommerce\_product\_add\_to\_cart\_text', function () use ($whp\_woocommerce\_cta\_text) { |
| [319](#L319) | return $whp\_woocommerce\_cta\_text; |
| [320](#L320) | }, 10, 2); |
| [321](#L321) | } |
| [322](#L322) | if ($whp\_woocommerce\_cta\_convert\_zero\_to\_contact) { |
| [323](#L323) |  |
| [324](#L324) | add\_filter('woocommerce\_get\_price\_html', [$this, 'whp\_woo\_cta\_convert\_zero\_to\_contact'], 99, 2); |
| [325](#L325) | } |
| [326](#L326) | if ($whp\_woocommerce\_cta\_show\_buynow\_button) { |
| [327](#L327) |  |
| [328](#L328) | add\_action('woocommerce\_after\_add\_to\_cart\_button', [$this, 'whp\_woo\_cta\_show\_buynow\_button']); |
| [329](#L329) | } |
| [330](#L330) | } |
| [331](#L331) | public  function whp\_woo\_cta\_show\_buynow\_button() |
| [332](#L332) | { |
| [333](#L333) |  |
| [334](#L334) | $current\_product\_id = get\_the\_ID(); |
| [335](#L335) |  |
| [336](#L336) | $product = wc\_get\_product($current\_product\_id); |
| [337](#L337) |  |
| [338](#L338) | $checkout\_url = WC()->cart->get\_checkout\_url(); |
| [339](#L339) |  |
| [340](#L340) | if ($product->is\_type('simple')) { |
| [341](#L341) | $url =   esc\_url($checkout\_url . '?add-to-cart=' . $current\_product\_id); |
| [342](#L342) | $title = esc\_html('Mua ngay'); |
| [343](#L343) | $class = esc\_html('buy-now button'); |
| [344](#L344) | $xhtml = sprintf('<a href="%s" class="%s">%s</a>', $url, $class, $title); |
| [345](#L345) | $allowed\_html = [ |
| [346](#L346) | 'a' => [ |
| [347](#L347) | 'href' => [], |
| [348](#L348) | 'class' => [] |
| [349](#L349) | ] |
| [350](#L350) | ]; |
| [351](#L351) |  |
| [352](#L352) | echo wp\_kses($xhtml, $allowed\_html); |
| [353](#L353) | } |
| [354](#L354) | } |
| [355](#L355) | public function whp\_woo\_cta\_convert\_zero\_to\_contact($price, $product) |
| [356](#L356) | { |
| [357](#L357) | if (!is\_admin() && $product->get\_price() == 0) { |
| [358](#L358) | $price = '<span class="amount">' . 'Liên hệ' . '</span>'; |
| [359](#L359) | } |
| [360](#L360) | return $price; |
| [361](#L361) | } |
| [362](#L362) |  |
| [363](#L363) | // end woocommerce cta |
| [364](#L364) |  |
| [365](#L365) |  |
| [366](#L366) | // start extenttion |
| [367](#L367) | public function whp\_extention() |
| [368](#L368) | { |
| [369](#L369) | $fields = whp\_get\_extention\_fields(); |
| [370](#L370) | foreach ($fields as $key => $field) { |
| [371](#L371) | $$field = whp\_get\_setting($field); |
| [372](#L372) | } |
| [373](#L373) |  |
| [374](#L374) | if ($whp\_extention\_editor\_type) { |
| [375](#L375) | add\_filter('use\_block\_editor\_for\_post', '\_\_return\_false'); |
| [376](#L376) | } |
| [377](#L377) | if ($whp\_extention\_duplicate\_menu) { |
| [378](#L378) | add\_action('admin\_menu', array($this, 'whp\_extention\_duplicate\_menu\_add\_menu')); |
| [379](#L379) | } |
| [380](#L380) |  |
| [381](#L381) | if ($whp\_extention\_duplicate\_page\_post) { |
| [382](#L382) |  |
| [383](#L383) | add\_filter('post\_row\_actions', array($this, 'whp\_extention\_duplicate'), 10, 2); |
| [384](#L384) | add\_filter('page\_row\_actions', array($this, 'whp\_extention\_duplicate'), 10, 2); |
| [385](#L385) | add\_action('admin\_action\_whp\_extention\_duplicate\_action', array($this, 'whp\_extention\_duplicate\_action')); |
| [386](#L386) | } |
| [387](#L387) | if ($whp\_extention\_enable\_404\_redirect) { |
| [388](#L388) |  |
| [389](#L389) | add\_action('wp', [$this, 'whp\_extention\_redirect\_404\_to\_homepage'], 1); |
| [390](#L390) | } |
| [391](#L391) | if ($whp\_extention\_disable\_emojis) { |
| [392](#L392) | add\_action('init', [$this, 'whp\_extention\_disable\_emojis']); |
| [393](#L393) | } |
| [394](#L394) | if ($whp\_extention\_remove\_query\_string) { |
| [395](#L395) | add\_filter('script\_loader\_src', [$this, 'whp\_extention\_remove\_query'], 999); |
| [396](#L396) | add\_filter('style\_loader\_src', [$this, 'whp\_extention\_remove\_query'], 999); |
| [397](#L397) | } |
| [398](#L398) | if ($whp\_extention\_disbale\_wp\_embeds) { |
| [399](#L399) | add\_action('init', [$this, 'whp\_extention\_disable\_embeds\_code\_init'], 9999); |
| [400](#L400) | } |
| [401](#L401) | if ($whp\_extention\_disbale\_google\_fonts) { |
| [402](#L402) | add\_filter('style\_loader\_src', function ($href) { |
| [403](#L403) | if (strpos($href, "//fonts.googleapis.com/") === false) { |
| [404](#L404) | return $href; |
| [405](#L405) | } |
| [406](#L406) | return false; |
| [407](#L407) | }); |
| [408](#L408) |  |
| [409](#L409) | // Remove dns-prefetch for fonts.googleapis |
| [410](#L410) | add\_filter('wp\_resource\_hints', function ($urls) { |
| [411](#L411) |  |
| [412](#L412) | foreach ($urls as $key => $url) { |
| [413](#L413) | if ('fonts.googleapis.com' === $url) { |
| [414](#L414) | unset($urls[$key]); |
| [415](#L415) | } |
| [416](#L416) | } |
| [417](#L417) | return $urls; |
| [418](#L418) | }); |
| [419](#L419) | } |
| [420](#L420) |  |
| [421](#L421) | if ($whp\_extention\_custom\_login\_theme) { |
| [422](#L422) |  |
| [423](#L423) | if ($whp\_extention\_custom\_login\_logo) { |
| [424](#L424) |  |
| [425](#L425) | add\_action('login\_head', function () use ($whp\_extention\_custom\_login\_logo) { |
| [426](#L426) | $url = esc\_url($whp\_extention\_custom\_login\_logo); |
| [427](#L427) | $custom\_css = "#login h1 a { |
| [428](#L428) |  |
| [429](#L429) | background: url('" . $url . "') ; |
| [430](#L430) | }"; |
| [431](#L431) |  |
| [432](#L432) | echo '<style type="text/css"> ' . $custom\_css . ' </style>'; |
| [433](#L433) | }); |
| [434](#L434) | } |
| [435](#L435) | if ($whp\_extention\_custom\_link) { |
| [436](#L436) | add\_filter('login\_headerurl', function () use ($whp\_extention\_custom\_link) { |
| [437](#L437) | //  echo esc\_url($whp\_extention\_custom\_link); |
| [438](#L438) | }); |
| [439](#L439) | } |
| [440](#L440) | } |
| [441](#L441) |  |
| [442](#L442) | if ($whp\_extention\_disbale\_dashicons) { |
| [443](#L443) | add\_action('wp\_enqueue\_scripts', function () { |
| [444](#L444) | if (!is\_user\_logged\_in()) { |
| [445](#L445) | wp\_dequeue\_style('dashicons'); |
| [446](#L446) | wp\_deregister\_style('dashicons'); |
| [447](#L447) | } |
| [448](#L448) | }); |
| [449](#L449) | } |
| [450](#L450) |  |
| [451](#L451) | if ($whp\_extention\_notification) { |
| [452](#L452) | add\_action('admin\_init', [$this, 'whp\_disable\_notification']); |
| [453](#L453) | } |
| [454](#L454) |  |
| [455](#L455) | if ($whp\_extention\_filter\_order\_by\_phone) { |
| [456](#L456) | add\_filter('manage\_edit-shop\_order\_columns', [$this, 'whp\_extention\_field\_filter\_order'], 10, 1); |
| [457](#L457) | add\_action('pre\_get\_posts', [$this, 'whp\_extention\_filter\_order\_in\_table'], 99, 1); |
| [458](#L458) | add\_action('manage\_shop\_order\_posts\_custom\_column', [$this, 'whp\_extention\_display\_order'], 10, 1); |
| [459](#L459) | add\_action('restrict\_manage\_posts', [$this, 'whp\_extention\_show\_field\_order']); |
| [460](#L460) | } |
| [461](#L461) |  |
| [462](#L462) | if ($whp\_extention\_svg) { |
| [463](#L463) |  |
| [464](#L464) | add\_filter('upload\_mimes', [$this, 'whp\_extention\_allow\_svg\_upload']); |
| [465](#L465) |  |
| [466](#L466) | add\_filter('wp\_handle\_upload\_prefilter', [$this, 'whp\_validate\_uploaded\_svg']); |
| [467](#L467) |  |
| [468](#L468) | add\_action('admin\_head', function () { |
| [469](#L469) | echo '<style type="text/css"> |
| [470](#L470) | .media-icon img[src$=".svg"], img[src$=".svg"].attachment-post-thumbnail { |
| [471](#L471) | width: 100% !important; |
| [472](#L472) | height: auto !important; |
| [473](#L473) | }</style>'; |
| [474](#L474) | }); |
| [475](#L475) | } |
| [476](#L476) | } |
| [477](#L477) | function whp\_validate\_uploaded\_svg($file) |
| [478](#L478) | { |
| [479](#L479) |  |
| [480](#L480) | $file\_content = file\_get\_contents($file['tmp\_name']); |
| [481](#L481) |  |
| [482](#L482) | if (empty($file\_content)) { |
| [483](#L483) | return false; |
| [484](#L484) | } |
| [485](#L485) | if (strpos($file\_content, '<?xml') !== 0) { |
| [486](#L486) | return false; |
| [487](#L487) | } |
| [488](#L488) | if (strpos($file\_content, '<script') !== false) { |
| [489](#L489) | return false; |
| [490](#L490) | } |
| [491](#L491) |  |
| [492](#L492) | if (strpos($file\_content, '</svg>') !== (strlen($file\_content) - strlen('</svg>'))) { |
| [493](#L493) | return false; |
| [494](#L494) | } |
| [495](#L495) | return $file; |
| [496](#L496) | } |
| [497](#L497) | public function whp\_extention\_allow\_svg\_upload($mimes) |
| [498](#L498) | { |
| [499](#L499) | $mimes['svg'] = 'image/svg+xml'; |
| [500](#L500) | return $mimes; |
| [501](#L501) | } |
| [502](#L502) |  |
| [503](#L503) | public function whp\_extention\_field\_filter\_order($field) |
| [504](#L504) | { |
| [505](#L505) | // Đổi "Số điện thoại" thành "Phone Number" để hiển thị trên trang quản lý đơn hàng |
| [506](#L506) | $field['phone'] = \_\_('Phone Number', 'text-domain'); |
| [507](#L507) | return $field; |
| [508](#L508) | } |
| [509](#L509) |  |
| [510](#L510) | public function whp\_extention\_filter\_order\_in\_table($query) |
| [511](#L511) | { |
| [512](#L512) | if (!is\_admin() || !isset($\_GET['post\_type']) || $\_GET['post\_type'] !== 'shop\_order') { |
| [513](#L513) | return; |
| [514](#L514) | } |
| [515](#L515) |  |
| [516](#L516) | if (isset($\_GET['phone']) && $\_GET['phone'] !== '') { |
| [517](#L517) | $phone = sanitize\_text\_field($\_GET['phone']); |
| [518](#L518) | $meta\_query = array( |
| [519](#L519) | array( |
| [520](#L520) | 'key' => '\_billing\_phone', |
| [521](#L521) | 'value' => $phone, |
| [522](#L522) | 'compare' => 'LIKE', |
| [523](#L523) | ), |
| [524](#L524) | ); |
| [525](#L525) | $query->set('meta\_query', $meta\_query); |
| [526](#L526) | } |
| [527](#L527) | } |
| [528](#L528) |  |
| [529](#L529) | public function whp\_extention\_display\_order($column) |
| [530](#L530) | { |
| [531](#L531) | global $post; |
| [532](#L532) |  |
| [533](#L533) | if ('phone' === $column && 'shop\_order' === get\_post\_type($post)) { |
| [534](#L534) | $billing\_phone = get\_post\_meta($post->ID, '\_billing\_phone', true); |
| [535](#L535) |  |
| [536](#L536) | if ($billing\_phone && strlen($billing\_phone) > 0) { |
| [537](#L537) | echo esc\_html($billing\_phone); |
| [538](#L538) | } |
| [539](#L539) | } |
| [540](#L540) | } |
| [541](#L541) |  |
| [542](#L542) | public function whp\_extention\_show\_field\_order() |
| [543](#L543) | { |
| [544](#L544) | if (!isset($\_GET['post\_type']) || $\_GET['post\_type'] !== 'shop\_order') { |
| [545](#L545) | return; |
| [546](#L546) | } |
| [547](#L547) |  |
| [548](#L548) | $phone = ''; |
| [549](#L549) |  |
| [550](#L550) | if (isset($\_GET['phone']) && $\_GET['phone'] !== '') { |
| [551](#L551) | // Làm sạch giá trị số điện thoại trước khi hiển thị trong trường nhập |
| [552](#L552) | $phone = sanitize\_text\_field($\_GET['phone']); |
| [553](#L553) | } |
| [554](#L554) |  |
| [555](#L555) | ?> |
| [556](#L556) | <input type="text" name="phone" value="<?php echo esc\_attr($phone); ?>" placeholder="<?php esc\_attr\_e('Tìm kiếm bằng số điện thoại', 'text-domain'); ?>"> |
| [557](#L557) | <?php |
| [558](#L558) | } |
| [559](#L559) |  |
| [560](#L560) |  |
| [561](#L561) | // start extention duplicate menu |
| [562](#L562) | public function whp\_extention\_duplicate\_menu\_add\_menu() |
| [563](#L563) | { |
| [564](#L564) | add\_theme\_page( |
| [565](#L565) | 'Nhân bản Menu', |
| [566](#L566) | 'Nhân bản Menu', |
| [567](#L567) | 'edit\_theme\_options', |
| [568](#L568) | 'duplicate-menu', |
| [569](#L569) | array($this, 'whp\_extention\_duplicate\_menu') |
| [570](#L570) | ); |
| [571](#L571) | } |
| [572](#L572) |  |
| [573](#L573) | public function whp\_extention\_duplicate\_menu() |
| [574](#L574) | { |
| [575](#L575) |  |
| [576](#L576) | $nav\_menus = wp\_get\_nav\_menus(); |
| [577](#L577) | require\_once($this->pathViewAdmin . 'duplicate-menu.php'); |
| [578](#L578) | } |
| [579](#L579) |  |
| [580](#L580) | function whp\_extention\_duplicate\_menu\_action($id = null, $name = null) |
| [581](#L581) | { |
| [582](#L582) |  |
| [583](#L583) | // sanity check |
| [584](#L584) | if (empty($id) || empty($name)) { |
| [585](#L585) | return false; |
| [586](#L586) | } |
| [587](#L587) |  |
| [588](#L588) | $id = intval($id); |
| [589](#L589) | $name = sanitize\_text\_field($name); |
| [590](#L590) | $source = wp\_get\_nav\_menu\_object($id); |
| [591](#L591) | $source\_items = wp\_get\_nav\_menu\_items($id); |
| [592](#L592) | $new\_id = wp\_create\_nav\_menu($name); |
| [593](#L593) |  |
| [594](#L594) | if (!$new\_id) { |
| [595](#L595) | return false; |
| [596](#L596) | } |
| [597](#L597) |  |
| [598](#L598) | // key is the original db ID, val is the new |
| [599](#L599) | $rel = array(); |
| [600](#L600) |  |
| [601](#L601) | $i = 1; |
| [602](#L602) | foreach ($source\_items as $menu\_item) { |
| [603](#L603) | $args = array( |
| [604](#L604) | 'menu-item-db-id'       => $menu\_item->db\_id, |
| [605](#L605) | 'menu-item-object-id'   => $menu\_item->object\_id, |
| [606](#L606) | 'menu-item-object'      => $menu\_item->object, |
| [607](#L607) | 'menu-item-position'    => $i, |
| [608](#L608) | 'menu-item-type'        => $menu\_item->type, |
| [609](#L609) | 'menu-item-title'       => $menu\_item->title, |
| [610](#L610) | 'menu-item-url'         => $menu\_item->url, |
| [611](#L611) | 'menu-item-description' => $menu\_item->description, |
| [612](#L612) | 'menu-item-attr-title'  => $menu\_item->attr\_title, |
| [613](#L613) | 'menu-item-target'      => $menu\_item->target, |
| [614](#L614) | 'menu-item-classes'     => implode(' ', $menu\_item->classes), |
| [615](#L615) | 'menu-item-xfn'         => $menu\_item->xfn, |
| [616](#L616) | 'menu-item-status'      => $menu\_item->post\_status |
| [617](#L617) | ); |
| [618](#L618) |  |
| [619](#L619) | $parent\_id = wp\_update\_nav\_menu\_item($new\_id, 0, $args); |
| [620](#L620) |  |
| [621](#L621) | $rel[$menu\_item->db\_id] = $parent\_id; |
| [622](#L622) |  |
| [623](#L623) | // did it have a parent? if so, we need to update with the NEW ID |
| [624](#L624) | if ($menu\_item->menu\_item\_parent) { |
| [625](#L625) | $args['menu-item-parent-id'] = $rel[$menu\_item->menu\_item\_parent]; |
| [626](#L626) | $parent\_id = wp\_update\_nav\_menu\_item($new\_id, $parent\_id, $args); |
| [627](#L627) | } |
| [628](#L628) |  |
| [629](#L629) | // allow developers to run any custom functionality they'd like |
| [630](#L630) | do\_action('duplicate\_menu\_item', $menu\_item, $args); |
| [631](#L631) |  |
| [632](#L632) | $i++; |
| [633](#L633) | } |
| [634](#L634) |  |
| [635](#L635) | return $new\_id; |
| [636](#L636) | } |
| [637](#L637) | // end extention duplicate menu |
| [638](#L638) |  |
| [639](#L639) |  |
| [640](#L640) | // start extention disable emojis |
| [641](#L641) | function whp\_extention\_disable\_emojis() |
| [642](#L642) | { |
| [643](#L643) | remove\_action('wp\_head', 'print\_emoji\_detection\_script', 7); |
| [644](#L644) | remove\_action('admin\_print\_scripts', 'print\_emoji\_detection\_script'); |
| [645](#L645) | remove\_action('wp\_print\_styles', 'print\_emoji\_styles'); |
| [646](#L646) | remove\_action('admin\_print\_styles', 'print\_emoji\_styles'); |
| [647](#L647) | remove\_filter('the\_content\_feed', 'wp\_staticize\_emoji'); |
| [648](#L648) | remove\_filter('comment\_text\_rss', 'wp\_staticize\_emoji'); |
| [649](#L649) | remove\_filter('wp\_mail', 'wp\_staticize\_emoji\_for\_email'); |
| [650](#L650) | add\_filter('tiny\_mce\_plugins', [$this, 'whp\_extention\_disable\_emojis\_tinymce']); |
| [651](#L651) | add\_filter('wp\_resource\_hints', [$this, 'whp\_extention\_disable\_emojis\_prefetch'], 10, 2); |
| [652](#L652) | } |
| [653](#L653) |  |
| [654](#L654) | function whp\_extention\_disable\_emojis\_tinymce($plugins) |
| [655](#L655) | { |
| [656](#L656) | if (is\_array($plugins)) { |
| [657](#L657) | return array\_diff($plugins, array('wpemoji')); |
| [658](#L658) | } else { |
| [659](#L659) | return array(); |
| [660](#L660) | } |
| [661](#L661) | } |
| [662](#L662) |  |
| [663](#L663) | function whp\_extention\_disable\_emojis\_prefetch($urls, $relation\_type) |
| [664](#L664) | { |
| [665](#L665) | if ('dns-prefetch' == $relation\_type) { |
| [666](#L666) | /\*\* This filter is documented in wp-includes/formatting.php \*/ |
| [667](#L667) | $emoji\_svg\_url = apply\_filters('emoji\_svg\_url', 'https://s.w.org/images/core/emoji/2/svg/'); |
| [668](#L668) | $urls = array\_diff($urls, array($emoji\_svg\_url)); |
| [669](#L669) | } |
| [670](#L670) |  |
| [671](#L671) | return $urls; |
| [672](#L672) | } |
| [673](#L673) |  |
| [674](#L674) | function whp\_extention\_disable\_embeds\_code\_init() |
| [675](#L675) | { |
| [676](#L676) |  |
| [677](#L677) | remove\_action('rest\_api\_init', 'wp\_oembed\_register\_route'); |
| [678](#L678) |  |
| [679](#L679) | add\_filter('embed\_oembed\_discover', '\_\_return\_false'); |
| [680](#L680) |  |
| [681](#L681) | remove\_filter('oembed\_dataparse', 'wp\_filter\_oembed\_result', 10); |
| [682](#L682) |  |
| [683](#L683) | remove\_action('wp\_head', 'wp\_oembed\_add\_discovery\_links'); |
| [684](#L684) |  |
| [685](#L685) | remove\_action('wp\_head', 'wp\_oembed\_add\_host\_js'); |
| [686](#L686) |  |
| [687](#L687) | add\_filter('tiny\_mce\_plugins', [$this, 'whp\_extention\_disable\_embeds\_tiny']); |
| [688](#L688) |  |
| [689](#L689) | add\_filter('rewrite\_rules\_array', [$this, 'whp\_extention\_disable\_embeds\_rewrites']); |
| [690](#L690) |  |
| [691](#L691) | remove\_filter('pre\_oembed\_result', 'wp\_filter\_pre\_oembed\_result', 10); |
| [692](#L692) | } |
| [693](#L693) |  |
| [694](#L694) | function whp\_extention\_disable\_embeds\_rewrites($rules) |
| [695](#L695) | { |
| [696](#L696) | foreach ($rules as $rule => $rewrite) { |
| [697](#L697) | if (false !== strpos($rewrite, 'embed=true')) { |
| [698](#L698) | unset($rules[$rule]); |
| [699](#L699) | } |
| [700](#L700) | } |
| [701](#L701) | return $rules; |
| [702](#L702) | } |
| [703](#L703) | function whp\_extention\_disable\_embeds\_tiny($plugins) |
| [704](#L704) | { |
| [705](#L705) | return array\_diff($plugins, array('wpembed')); |
| [706](#L706) | } |
| [707](#L707) | // end extention disable emojis |
| [708](#L708) |  |
| [709](#L709) | // start  extention rediriect 404 to homepage |
| [710](#L710) | function whp\_extention\_redirect\_404\_to\_homepage() |
| [711](#L711) | { |
| [712](#L712) | global $wp\_query; |
| [713](#L713) | if ($wp\_query->is\_404) { |
| [714](#L714) | wp\_redirect(get\_bloginfo('url'), 301); |
| [715](#L715) | exit; |
| [716](#L716) | } |
| [717](#L717) | } |
| [718](#L718) | // end  extention rediriect 404 to homepage |
| [719](#L719) |  |
| [720](#L720) |  |
| [721](#L721) | // start extention remove query |
| [722](#L722) | function whp\_extention\_remove\_query($src) |
| [723](#L723) | { |
| [724](#L724) | if (strpos($src, '?v=')) { |
| [725](#L725) | $src = remove\_query\_arg('v', $src); |
| [726](#L726) | } |
| [727](#L727) | if (strpos($src, '?ver=')) { |
| [728](#L728) | $src = remove\_query\_arg('ver', $src); |
| [729](#L729) | } |
| [730](#L730) |  |
| [731](#L731) | return $src; |
| [732](#L732) | } |
| [733](#L733) | // end extention remove query |
| [734](#L734) |  |
| [735](#L735) |  |
| [736](#L736) | // start extention logo |
| [737](#L737) | public function whp\_extention\_logo($url) |
| [738](#L738) | { |
| [739](#L739) |  |
| [740](#L740) | $url = esc\_url($url); |
| [741](#L741) | $custom\_css = "#login h1 a { |
| [742](#L742) |  |
| [743](#L743) | background: url('" + $url + "') no-repeat !important; |
| [744](#L744) | }"; |
| [745](#L745) | wp\_add\_inline\_style('login\_css', $custom\_css); |
| [746](#L746) | } |
| [747](#L747) | // end extention logo |
| [748](#L748) |  |
| [749](#L749) | // start extention duplicate post and page |
| [750](#L750) | public function whp\_extention\_duplicate\_action() |
| [751](#L751) | { |
| [752](#L752) |  |
| [753](#L753) | $nonce = sanitize\_text\_field($\_REQUEST['nonce']); |
| [754](#L754) |  |
| [755](#L755) | $post\_id = (isset($\_GET['post']) ? intval($\_GET['post']) : intval($\_POST['post'])); |
| [756](#L756) |  |
| [757](#L757) | $post = get\_post($post\_id); |
| [758](#L758) | $current\_user\_id = get\_current\_user\_id(); |
| [759](#L759) | if (wp\_verify\_nonce($nonce, 'dt-duplicate-page-' . $post\_id)) { |
| [760](#L760) | if (current\_user\_can('manage\_options') || current\_user\_can('edit\_others\_posts')) { |
| [761](#L761) | $this->whp\_extention\_duplicate\_edit\_post\_and\_page($post\_id); |
| [762](#L762) | } else if (current\_user\_can('contributor') && $current\_user\_id == $post->post\_author) { |
| [763](#L763) | $this->whp\_extention\_duplicate\_edit\_post\_and\_page($post\_id, 'pending'); |
| [764](#L764) | } else if (current\_user\_can('edit\_posts') && $current\_user\_id == $post->post\_author) { |
| [765](#L765) | $this->whp\_extention\_duplicate\_edit\_post\_and\_page($post\_id); |
| [766](#L766) | } else { |
| [767](#L767) | wp\_die(\_\_('Bạn không có quyền truy cập.', 'duplicate-page')); |
| [768](#L768) | } |
| [769](#L769) | } else { |
| [770](#L770) | wp\_die(\_\_('Đã xảy ra lỗi vui lòng thử lại!!!', 'duplicate-page')); |
| [771](#L771) | } |
| [772](#L772) | } |
| [773](#L773) | // end extention duplicate post and page |
| [774](#L774) | public function whp\_extention\_duplicate\_edit\_post\_and\_page($post\_id, $post\_status\_update = '') |
| [775](#L775) | { |
| [776](#L776) |  |
| [777](#L777) | global $wpdb; |
| [778](#L778) | $opt = get\_option('duplicate\_page\_options'); |
| [779](#L779) | $suffix = isset($opt['duplicate\_post\_suffix']) && !empty($opt['duplicate\_post\_suffix']) ? ' -- ' . esc\_attr($opt['duplicate\_post\_suffix']) : ''; |
| [780](#L780) | if ($post\_status\_update == '') { |
| [781](#L781) | $post\_status = !empty($opt['duplicate\_post\_status']) ? esc\_attr($opt['duplicate\_post\_status']) : 'draft'; |
| [782](#L782) | } else { |
| [783](#L783) | $post\_status =  $post\_status\_update; |
| [784](#L784) | } |
| [785](#L785) | $redirectit = !empty($opt['duplicate\_post\_redirect']) ? esc\_attr($opt['duplicate\_post\_redirect']) : 'to\_list'; |
| [786](#L786) | if (!(isset($\_GET['post']) || isset($\_POST['post']) || (isset($\_REQUEST['action']) && 'dt\_duplicate\_post\_as\_draft' == sanitize\_text\_field($\_REQUEST['action'])))) { |
| [787](#L787) | wp\_die(\_\_('No post to duplicate has been supplied!', 'duplicate-page')); |
| [788](#L788) | } |
| [789](#L789) |  |
| [790](#L790) | $returnpage = ''; |
| [791](#L791) |  |
| [792](#L792) | $post = get\_post($post\_id); |
| [793](#L793) |  |
| [794](#L794) | $current\_user = wp\_get\_current\_user(); |
| [795](#L795) |  |
| [796](#L796) | $new\_post\_author = $current\_user->ID; |
| [797](#L797) |  |
| [798](#L798) | if (isset($post) && $post != null) { |
| [799](#L799) | /\* |
| [800](#L800) | \* new post data array |
| [801](#L801) | \*/ |
| [802](#L802) | $args = array( |
| [803](#L803) | 'comment\_status' => $post->comment\_status, |
| [804](#L804) | 'ping\_status' => $post->ping\_status, |
| [805](#L805) | 'post\_author' => $new\_post\_author, |
| [806](#L806) | 'post\_content' => (isset($opt['duplicate\_post\_editor']) && $opt['duplicate\_post\_editor'] == 'gutenberg') ? wp\_slash($post->post\_content) : $post->post\_content, |
| [807](#L807) | 'post\_excerpt' => $post->post\_excerpt, |
| [808](#L808) | 'post\_parent' => $post->post\_parent, |
| [809](#L809) | 'post\_password' => $post->post\_password, |
| [810](#L810) | 'post\_status' => $post\_status, |
| [811](#L811) | 'post\_title' => $post->post\_title . $suffix, |
| [812](#L812) | 'post\_type' => $post->post\_type, |
| [813](#L813) | 'to\_ping' => $post->to\_ping, |
| [814](#L814) | 'menu\_order' => $post->menu\_order, |
| [815](#L815) | ); |
| [816](#L816) | /\* |
| [817](#L817) | \* insert the post by wp\_insert\_post() function |
| [818](#L818) | \*/ |
| [819](#L819) | $new\_post\_id = wp\_insert\_post($args); |
| [820](#L820) | if (is\_wp\_error($new\_post\_id)) { |
| [821](#L821) | wp\_die(\_\_($new\_post\_id->get\_error\_message(), 'duplicate-page')); |
| [822](#L822) | } |
| [823](#L823) |  |
| [824](#L824) | /\* |
| [825](#L825) | \* get all current post terms ad set them to the new post draft |
| [826](#L826) | \*/ |
| [827](#L827) | $taxonomies = array\_map('sanitize\_text\_field', get\_object\_taxonomies($post->post\_type)); |
| [828](#L828) | if (!empty($taxonomies) && is\_array($taxonomies)) : |
| [829](#L829) | foreach ($taxonomies as $taxonomy) { |
| [830](#L830) | $post\_terms = wp\_get\_object\_terms($post\_id, $taxonomy, array('fields' => 'slugs')); |
| [831](#L831) | wp\_set\_object\_terms($new\_post\_id, $post\_terms, $taxonomy, false); |
| [832](#L832) | } |
| [833](#L833) | endif; |
| [834](#L834) | /\* |
| [835](#L835) | \* duplicate all post meta |
| [836](#L836) | \*/ |
| [837](#L837) | $post\_meta\_keys = get\_post\_custom\_keys($post\_id); |
| [838](#L838) | if (!empty($post\_meta\_keys)) { |
| [839](#L839) | foreach ($post\_meta\_keys as $meta\_key) { |
| [840](#L840) | $meta\_values = get\_post\_custom\_values($meta\_key, $post\_id); |
| [841](#L841) | foreach ($meta\_values as $meta\_value) { |
| [842](#L842) | $meta\_value = maybe\_unserialize($meta\_value); |
| [843](#L843) | update\_post\_meta($new\_post\_id, $meta\_key, wp\_slash($meta\_value)); |
| [844](#L844) | } |
| [845](#L845) | } |
| [846](#L846) | } |
| [847](#L847) |  |
| [848](#L848) | /\*\* |
| [849](#L849) | \* Elementor compatibility fixes |
| [850](#L850) | \*/ |
| [851](#L851) | if (is\_plugin\_active('elementor/elementor.php')) { |
| [852](#L852) | $css = Elementor\Core\Files\CSS\Post::create($new\_post\_id); |
| [853](#L853) | $css->update(); |
| [854](#L854) | } |
| [855](#L855) | /\* |
| [856](#L856) | \* finally, redirecting to your choice |
| [857](#L857) | \*/ |
| [858](#L858) | if ($post->post\_type != 'post') { |
| [859](#L859) | $returnpage = '?post\_type=' . $post->post\_type; |
| [860](#L860) | } |
| [861](#L861) |  |
| [862](#L862) | if (!empty($redirectit) && $redirectit == 'to\_list') { |
| [863](#L863) | wp\_redirect(esc\_url\_raw(admin\_url('edit.php' . $returnpage))); |
| [864](#L864) | } elseif (!empty($redirectit) && $redirectit == 'to\_page') { |
| [865](#L865) | wp\_redirect(esc\_url\_raw(admin\_url('post.php?action=edit&post=' . $new\_post\_id))); |
| [866](#L866) | } else { |
| [867](#L867) | wp\_redirect(esc\_url\_raw(admin\_url('edit.php' . $returnpage))); |
| [868](#L868) | } |
| [869](#L869) | exit; |
| [870](#L870) | } else { |
| [871](#L871) | wp\_die(\_\_('Lỗi! Thao tác thất bại: ', 'duplicate-page') . $post\_id); |
| [872](#L872) | } |
| [873](#L873) | } |
| [874](#L874) |  |
| [875](#L875) | public function whp\_disable\_notification() |
| [876](#L876) | { |
| [877](#L877) |  |
| [878](#L878) | global $wp\_filter; |
| [879](#L879) |  |
| [880](#L880) | if (isset($wp\_filter['admin\_notices'])) { |
| [881](#L881) | unset($wp\_filter['admin\_notices']); |
| [882](#L882) | } |
| [883](#L883) |  |
| [884](#L884) | if (isset($wp\_filter['all\_admin\_notices'])) { |
| [885](#L885) | unset($wp\_filter['all\_admin\_notices']); |
| [886](#L886) | } |
| [887](#L887) | } |
| [888](#L888) | // end extenttion |
| [889](#L889) |  |
| [890](#L890) |  |
| [891](#L891) | // start ecommerce |
| [892](#L892) | function whp\_ecommerce() |
| [893](#L893) | { |
| [894](#L894) | add\_action('woocommerce\_product\_meta\_end', [$this, 'whp\_ecommerce\_show']); |
| [895](#L895) | } |
| [896](#L896) | public function whp\_ecommerce\_show() |
| [897](#L897) | { |
| [898](#L898) | global $product; |
| [899](#L899) | $product\_id = $product->get\_id(); |
| [900](#L900) | $fields = whp\_get\_woo\_ecommerce\_fields(); |
| [901](#L901) | $arr = []; |
| [902](#L902) | foreach ($fields as $key => $field) { |
| [903](#L903) | $value = whp\_get\_setting($field); |
| [904](#L904) | if ($value) { |
| [905](#L905) | array\_push($arr, $field); |
| [906](#L906) | } |
| [907](#L907) | } |
| [908](#L908) | $xhtml = "<span class='tagged\_as'><span class='sub\_title'>Xem trên: </span>"; |
| [909](#L909) | $xhtml .= "<ul class = 'mb-ecommerce-buttons lst-n'>"; |
| [910](#L910) |  |
| [911](#L911) | foreach ($arr as $key => $item) { |
| [912](#L912) | $brand = explode('\_', $item); |
| [913](#L913) | $brand\_uc = ucfirst($brand[3]); |
| [914](#L914) | $icon = whp\_get\_image\_url($brand\_uc) . '.svg'; |
| [915](#L915) | $icon = esc\_url($icon); |
| [916](#L916) | if (!empty($product\_meta = get\_post\_meta($product\_id, 'product-ecommerce-' . $item, true))) { |
| [917](#L917) | $link = esc\_url($product\_meta); |
| [918](#L918) | $name = esc\_html($brand\_uc); |
| [919](#L919) | $xhtml .= sprintf('<li><a href = "%s" target = "\_blank"><img src="%s" alt="%s"></a></li>', $link, $icon, $name,  $name,); |
| [920](#L920) | } |
| [921](#L921) | } |
| [922](#L922) | $xhtml .= ' </ul></span>'; |
| [923](#L923) | $allowed\_html = array( |
| [924](#L924) | 'span' => array( |
| [925](#L925) | 'class' => 'tagged\_as' |
| [926](#L926) | ), |
| [927](#L927) | 'ul' => array( |
| [928](#L928) | 'class' => 'mb-ecommerce-buttons lst-n', |
| [929](#L929) | 'style' => 'list-style: none !important' |
| [930](#L930) | ), |
| [931](#L931) | 'li' => array(), |
| [932](#L932) | 'a' => array( |
| [933](#L933) | 'href' => array(), |
| [934](#L934) | 'target' => array() |
| [935](#L935) | ), |
| [936](#L936) | 'img' => array( |
| [937](#L937) | 'src' => array(), |
| [938](#L938) | 'alt' => array() |
| [939](#L939) | ) |
| [940](#L940) |  |
| [941](#L941) | ); |
| [942](#L942) | echo wp\_kses($xhtml, $allowed\_html); |
| [943](#L943) | } |
| [944](#L944) | // set up in admim |
| [945](#L945) | public function whp\_woo\_admin\_ecommerce() |
| [946](#L946) | { |
| [947](#L947) | $arr = []; |
| [948](#L948) | $fields = whp\_get\_woo\_ecommerce\_fields(); |
| [949](#L949) | foreach ($fields  as $key => $item) { |
| [950](#L950) | $title = ucfirst($item); |
| [951](#L951) |  |
| [952](#L952) | $value = whp\_get\_setting($item); |
| [953](#L953) | if ($value) { |
| [954](#L954) | $arr += [$title => $item]; |
| [955](#L955) | } |
| [956](#L956) | } |
| [957](#L957) | if (count($arr)) { |
| [958](#L958) | add\_action('add\_meta\_boxes',  function () use ($arr) { |
| [959](#L959) | add\_meta\_box('ecommerce', 'Liên kết sàn thương mại', function () use ($arr) { |
| [960](#L960) | foreach ($arr as $key => $item) { |
| [961](#L961) | $brand = explode('\_', $item); |
| [962](#L962) | $brand\_uc = ucfirst($brand[3]); |
| [963](#L963) | woocommerce\_wp\_text\_input( |
| [964](#L964) | array( |
| [965](#L965) | 'id' => "product-ecommerce-{$item}", |
| [966](#L966) | 'placeholder' => \_\_("Nhập link sản phẩm sàn {$brand\_uc}", 'wphp-wc'), |
| [967](#L967) | 'label' => \_\_("Link sàn {$brand\_uc}", 'wphp-wc') |
| [968](#L968) | ) |
| [969](#L969) | ); |
| [970](#L970) | } |
| [971](#L971) | }, 'product'); |
| [972](#L972) | }); |
| [973](#L973) | } |
| [974](#L974) | add\_action('woocommerce\_process\_product\_meta', [$this, 'whp\_woocommerce\_ecommerce\_setting\_update']); |
| [975](#L975) | } |
| [976](#L976) |  |
| [977](#L977) | public function whp\_woocommerce\_ecommerce\_setting\_update() |
| [978](#L978) | { |
| [979](#L979) | global $post; |
| [980](#L980) | $postID = $post->ID; |
| [981](#L981) | $fields  = whp\_get\_woo\_ecommerce\_fields(); |
| [982](#L982) | foreach ($fields as $key) { |
| [983](#L983) | $name = "product-ecommerce-{$key}"; |
| [984](#L984) | $value = sanitize\_text\_field($\_POST[$name]); |
| [985](#L985) | if ($value) { |
| [986](#L986) | update\_post\_meta($postID, $name, esc\_attr($value)); |
| [987](#L987) | } |
| [988](#L988) | } |
| [989](#L989) | } |
| [990](#L990) | // end ecommerce |
| [991](#L991) |  |
| [992](#L992) |  |
| [993](#L993) | // start checkout |
| [994](#L994) | public function whp\_checkout() |
| [995](#L995) | { |
| [996](#L996) | add\_filter('woocommerce\_checkout\_fields', [$this, 'whp\_checkout\_setting'], 30, 1); |
| [997](#L997) | } |
| [998](#L998) | public function whp\_checkout\_setting($fields) |
| [999](#L999) | { |
| [1000](#L1000) | $removeFields = []; |
| [1001](#L1001) | $settingFields = whp\_get\_woo\_payment\_fields(); |
| [1002](#L1002) | foreach ($settingFields as $key => $field) { |
| [1003](#L1003) | $$field = whp\_get\_option($field); |
| [1004](#L1004) | } |
| [1005](#L1005) | if ($whp\_woocommerce\_payment\_fullname) { |
| [1006](#L1006) | array\_push($removeFields, 'first\_name'); |
| [1007](#L1007) | $fields['billing']['billing\_last\_name'] = array( |
| [1008](#L1008) | 'label'         => \_\_('Họ và tên', 'wphp-wc'), |
| [1009](#L1009) | 'placeholder'   => \_\_('Nhập đầy đủ họ và tên của bạn', 'wphp-wc'), |
| [1010](#L1010) | 'required'      => true, |
| [1011](#L1011) | 'class'         => array('form-row-wide'), |
| [1012](#L1012) | 'clear'         => true |
| [1013](#L1013) | ); |
| [1014](#L1014) | $fields['shipping']['shipping\_last\_name'] = array( |
| [1015](#L1015) | 'label'         => \_\_('Họ và tên', 'wphp-wc'), |
| [1016](#L1016) | 'placeholder'   => \_\_('Nhập đầy đủ họ và tên của người nhận', 'wphp-wc'), |
| [1017](#L1017) | 'required'      => true, |
| [1018](#L1018) | 'class'         => array('form-row-wide'), |
| [1019](#L1019) | 'clear'         => true |
| [1020](#L1020) | ); |
| [1021](#L1021) | } |
| [1022](#L1022) | if ($whp\_woocommerce\_payment\_address) { |
| [1023](#L1023) | array\_push($removeFields, 'address\_2'); |
| [1024](#L1024) | } |
| [1025](#L1025) | if ($whp\_woocommerce\_payment\_country) { |
| [1026](#L1026) | array\_push($removeFields, 'country'); |
| [1027](#L1027) | } |
| [1028](#L1028) | if ($whp\_woocommerce\_payment\_company) { |
| [1029](#L1029) | array\_push($removeFields, 'company'); |
| [1030](#L1030) | } |
| [1031](#L1031) | if ($whp\_woocommerce\_payment\_zipcode) { |
| [1032](#L1032) | array\_push($removeFields, 'postcode'); |
| [1033](#L1033) | } |
| [1034](#L1034) | if ($whp\_woocommerce\_payment\_province) { |
| [1035](#L1035) | array\_push($removeFields, 'city'); |
| [1036](#L1036) | } |
| [1037](#L1037) | array\_push($removeFields, 'state'); |
| [1038](#L1038) | foreach ($removeFields as $field) { |
| [1039](#L1039) | unset($fields['billing']['billing\_' . $field]); |
| [1040](#L1040) | unset($fields['shipping']['shipping\_' . $field]); |
| [1041](#L1041) | } |
| [1042](#L1042) | $fields['billing']['billing\_phone']['placeholder'] = \_\_('Nhập số điện thoại', 'wp-helper-premium'); |
| [1043](#L1043) | $fields['billing']['billing\_email']['placeholder'] = \_\_('Nhập email', 'wp-helper-premium'); |
| [1044](#L1044) | // Tỉnh thành quận huyện |
| [1045](#L1045) | $fields['billing']['billing\_last\_name']['priority'] = 10; |
| [1046](#L1046) | $fields['billing']['billing\_phone']['priority'] = 20; |
| [1047](#L1047) | $fields['billing']['billing\_email']['priority'] = 30; |
| [1048](#L1048) | $fields['billing']['billing\_address\_1']['priority'] = 70; |
| [1049](#L1049) | return $fields; |
| [1050](#L1050) | } |
| [1051](#L1051) | // end checkout |
| [1052](#L1052) |  |
| [1053](#L1053) |  |
| [1054](#L1054) | // start advance |
| [1055](#L1055) | public function whp\_advance() |
| [1056](#L1056) | { |
| [1057](#L1057) | $fields = whp\_get\_woo\_advance\_fields(); |
| [1058](#L1058) | // unset($fields, [4, 5]); |
| [1059](#L1059) | foreach ($fields as $key => $field) { |
| [1060](#L1060) | $$field = whp\_get\_setting($field); |
| [1061](#L1061) | } |
| [1062](#L1062) |  |
| [1063](#L1063) | if ($whp\_woocommerce\_advance\_enable\_notice) { |
| [1064](#L1064) | add\_action('wp\_enqueue\_scripts', [$this, 'whp\_notice']); |
| [1065](#L1065) | add\_action('wp\_footer', [$this, 'whp\_show\_notice'], 0); |
| [1066](#L1066) | } |
| [1067](#L1067) | if ($whp\_woocommerce\_advance\_enable\_vat) { |
| [1068](#L1068) |  |
| [1069](#L1069) | add\_action('woocommerce\_after\_checkout\_billing\_form', [$this, 'whp\_create\_vat']); |
| [1070](#L1070) | add\_action('woocommerce\_checkout\_process', [$this, 'whp\_validate\_vat']); |
| [1071](#L1071) | add\_action('woocommerce\_checkout\_update\_order\_meta', [$this, 'whp\_update\_vat']); |
| [1072](#L1072) | } |
| [1073](#L1073) | if ($whp\_woocommerce\_advance\_enable\_compact\_desc) { |
| [1074](#L1074) | add\_action('wp\_footer', [$this, 'whp\_compact\_desc'], 0); |
| [1075](#L1075) | add\_filter('the\_content', [$this, 'the\_content\_product'], 100); |
| [1076](#L1076) | } |
| [1077](#L1077) | if ($whp\_woocommerce\_advance\_enable\_notify\_telegram) { |
| [1078](#L1078) |  |
| [1079](#L1079) | add\_action('woocommerce\_checkout\_order\_processed', [$this, 'whp\_send\_message\_telegram']); |
| [1080](#L1080) | } |
| [1081](#L1081) | } |
| [1082](#L1082) |  |
| [1083](#L1083) |  |
| [1084](#L1084) | public function whp\_send\_message\_telegram($order\_id) |
| [1085](#L1085) | { |
| [1086](#L1086) |  |
| [1087](#L1087) | if (!$order\_id) return; |
| [1088](#L1088) | $order = wc\_get\_order($order\_id); |
| [1089](#L1089) | $order\_data = $order->get\_data(); |
| [1090](#L1090) | $last\_name = $order\_data['billing']['last\_name']; |
| [1091](#L1091) | $phone = (isset($order\_data['billing']['phone'])) ? $order\_data['billing']['phone'] : "Chưa nhập số điện thoại"; |
| [1092](#L1092) | $paymentMethod = $order->get\_payment\_method\_title(); |
| [1093](#L1093) | $msg = "<strong>Thông báo đơn hàng mới : #{$order\_id} </strong> " . "\n"; |
| [1094](#L1094) | $msg .= "Họ tên: {$last\_name}" . "\n"; |
| [1095](#L1095) | $msg .= "Số điện thoại: {$phone}" . "\n"; |
| [1096](#L1096) | $msg .= "Phương thức thanh toán: {$paymentMethod}" . "\n"; |
| [1097](#L1097) | $msg .= "<strong>Thông tin đơn hàng</strong>" . "\n"; |
| [1098](#L1098) | foreach ($order->get\_items() as $item\_id => $item) { |
| [1099](#L1099) | $product\_name = $item->get\_name(); |
| [1100](#L1100) | $quantity = $item->get\_quantity(); |
| [1101](#L1101) | $subtotal = $item->get\_subtotal(); |
| [1102](#L1102) | $total =    $item->get\_total(); |
| [1103](#L1103) | $subtotal = whp\_format\_currency\_vnd($subtotal); |
| [1104](#L1104) | $msg .= " - {$product\_name} ({$quantity}) x {$subtotal}"  . "\n"; |
| [1105](#L1105) | } |
| [1106](#L1106) | $total = $order->get\_total(); |
| [1107](#L1107) | $total = number\_format($total) . "đ"; |
| [1108](#L1108) | $msg .= "——————————————————————————" . "\n"; |
| [1109](#L1109) | $msg .= "Tổng đơn hàng: {$total}"; |
| [1110](#L1110) | $chatID = whp\_get\_setting('whp\_woocommerce\_advance\_telegram\_chatid'); // ID của Group trong Telegram |
| [1111](#L1111) | $token = whp\_get\_setting('whp\_woocommerce\_advance\_telegram\_token'); // Token của con Bot gửi thông báo |
| [1112](#L1112) | $url = "https://api.telegram.org/bot" . $token . "/sendMessage?parse\_mode=html&chat\_id=" . $chatID; |
| [1113](#L1113) | $url = $url . "&text=" . urlencode($msg); |
| [1114](#L1114) | wp\_remote\_get($url); |
| [1115](#L1115) | $whp\_woocommerce\_advance\_enable\_notify\_telegram = false; |
| [1116](#L1116) | } |
| [1117](#L1117) |  |
| [1118](#L1118) | public function whp\_notice() |
| [1119](#L1119) | { |
| [1120](#L1120) | wp\_enqueue\_style('wp-hp-wc-notification-style', $this->pathAsset . 'css/mb-hp-wc-notification.css', [], time()); |
| [1121](#L1121) | wp\_enqueue\_script('wp-hp-wc-notification-js', $this->pathAsset . 'js/mb-hp-wc-notification.js', array(), time(), true); |
| [1122](#L1122) | $args = array( |
| [1123](#L1123) | 'post\_type' => 'product', |
| [1124](#L1124) | 'posts\_per\_page' => 10, |
| [1125](#L1125) | 'ignore\_sticky\_posts' => 1, |
| [1126](#L1126) | ); |
| [1127](#L1127) | $ids = array(); |
| [1128](#L1128) | $loop = new WP\_Query($args); |
| [1129](#L1129) | if ($loop->have\_posts()) { |
| [1130](#L1130) | while ($loop->have\_posts()) : $loop->the\_post(); |
| [1131](#L1131) | global $product; |
| [1132](#L1132) | array\_push($ids, get\_the\_ID()); |
| [1133](#L1133) | endwhile; |
| [1134](#L1134) | wp\_reset\_query(); |
| [1135](#L1135) | } |
| [1136](#L1136) | $data\_notification = []; |
| [1137](#L1137) | foreach ($ids as $item) : |
| [1138](#L1138) | $product =  wc\_get\_product($item); |
| [1139](#L1139) | $product\_name = $product->get\_name(); |
| [1140](#L1140) | $permalink = $product->get\_permalink(); |
| [1141](#L1141) | $image = wp\_get\_attachment\_url($product->get\_image\_id()); |
| [1142](#L1142) | $image = ($image) ? $image : whp\_get\_image\_url('assets/fe/img/placeholder-image.jpg'); |
| [1143](#L1143) | $obj = [ |
| [1144](#L1144) | 'product\_name'  =>  $product\_name, |
| [1145](#L1145) | 'permalink'     =>  $permalink, |
| [1146](#L1146) | 'images'        =>  $image |
| [1147](#L1147) | ]; |
| [1148](#L1148) | array\_push($data\_notification, $obj); |
| [1149](#L1149) | endforeach; |
| [1150](#L1150) | wp\_localize\_script('wp-hp-wc-notification-js', 'notification', $data\_notification); |
| [1151](#L1151) | } |
| [1152](#L1152) |  |
| [1153](#L1153) | public function whp\_show\_notice() |
| [1154](#L1154) | { |
| [1155](#L1155) | $result =  '<div id="mbwp-message-purchased"></div>'; |
| [1156](#L1156) | $allowed\_html = array( |
| [1157](#L1157) | 'div' => array('id' => 'mbwp-message-purchased') |
| [1158](#L1158) | ); |
| [1159](#L1159) | echo wp\_kses($result, $allowed\_html); |
| [1160](#L1160) | } |
| [1161](#L1161) |  |
| [1162](#L1162) | public function whp\_create\_vat() |
| [1163](#L1163) | { |
| [1164](#L1164) | require\_once($this->pathViewElement . "vat.php"); |
| [1165](#L1165) | } |
| [1166](#L1166) |  |
| [1167](#L1167) | public function whp\_validate\_vat() |
| [1168](#L1168) | { |
| [1169](#L1169) | if (isset($\_POST['mb\_hpwc\_invoice\_vat\_input']) && !empty($\_POST['mb\_hpwc\_invoice\_vat\_input'])) { |
| [1170](#L1170) | if (empty($\_POST['billing\_vat\_company'])) { |
| [1171](#L1171) | wc\_add\_notice(\_\_('Hãy nhập tên công ty'), 'error'); |
| [1172](#L1172) | } |
| [1173](#L1173) | if (empty($\_POST['billing\_vat\_tax\_code'])) { |
| [1174](#L1174) | wc\_add\_notice(\_\_('Hãy nhập mã số thuế'), 'error'); |
| [1175](#L1175) | } |
| [1176](#L1176) | if (empty($\_POST['billing\_vat\_company\_address'])) { |
| [1177](#L1177) | wc\_add\_notice(\_\_('Hãy nhập địa chỉ công ty'), 'error'); |
| [1178](#L1178) | } |
| [1179](#L1179) | } |
| [1180](#L1180) | } |
| [1181](#L1181) |  |
| [1182](#L1182) | public function whp\_update\_vat($order\_id) |
| [1183](#L1183) | { |
| [1184](#L1184) | if (isset($\_POST['mb\_hpwc\_invoice\_vat\_input']) && !empty($\_POST['mb\_hpwc\_invoice\_vat\_input'])) { |
| [1185](#L1185) | update\_post\_meta($order\_id, 'mb\_hpwc\_invoice\_vat\_input', intval($\_POST['mb\_hpwc\_invoice\_vat\_input'])); |
| [1186](#L1186) | if (isset($\_POST['billing\_vat\_company']) && !empty($\_POST['billing\_vat\_company'])) { |
| [1187](#L1187) | update\_post\_meta($order\_id, 'billing\_vat\_company', sanitize\_text\_field($\_POST['billing\_vat\_company'])); |
| [1188](#L1188) | } |
| [1189](#L1189) | if (isset($\_POST['billing\_vat\_tax\_code']) && !empty($\_POST['billing\_vat\_tax\_code'])) { |
| [1190](#L1190) | update\_post\_meta($order\_id, 'billing\_vat\_tax\_code', sanitize\_text\_field($\_POST['billing\_vat\_tax\_code'])); |
| [1191](#L1191) | } |
| [1192](#L1192) | if (isset($\_POST['billing\_vat\_company\_address']) && !empty($\_POST['billing\_vat\_company\_address'])) { |
| [1193](#L1193) | update\_post\_meta($order\_id, 'billing\_vat\_company\_address', sanitize\_text\_field($\_POST['billing\_vat\_company\_address'])); |
| [1194](#L1194) | } |
| [1195](#L1195) | } |
| [1196](#L1196) | } |
| [1197](#L1197) |  |
| [1198](#L1198) | //wc\_enqueue\_js("jQuery('#tab-description').addClass('compact-active')"); |
| [1199](#L1199) | public function the\_content\_product($content) |
| [1200](#L1200) | { |
| [1201](#L1201) | if (is\_product()) { |
| [1202](#L1202) | $content .= '<div class="whp\_readmore\_producu\_desc"><span title="Xem thêm">Xem thêm</span></div>'; |
| [1203](#L1203) | } |
| [1204](#L1204) | return $content; |
| [1205](#L1205) | } |
| [1206](#L1206) |  |
| [1207](#L1207) | public function whp\_compact\_desc() |
| [1208](#L1208) | { |
| [1209](#L1209) | if (is\_product()) { |
| [1210](#L1210) |  |
| [1211](#L1211) |  |
| [1212](#L1212) | ?> |
| [1213](#L1213) |  |
| [1214](#L1214) | <style> |
| [1215](#L1215) | #tab-description { |
| [1216](#L1216) | max-height: 200px; |
| [1217](#L1217) | overflow: hidden; |
| [1218](#L1218) | position: relative; |
| [1219](#L1219) | } |
| [1220](#L1220) |  |
| [1221](#L1221) | .whp\_readmore\_producu\_desc { |
| [1222](#L1222) | text-align: center; |
| [1223](#L1223) | cursor: pointer; |
| [1224](#L1224) | position: absolute; |
| [1225](#L1225) | z-index: 9999; |
| [1226](#L1226) | bottom: 0; |
| [1227](#L1227) | width: 100%; |
| [1228](#L1228) | background: #fff; |
| [1229](#L1229) | } |
| [1230](#L1230) |  |
| [1231](#L1231) | .whp\_readmore\_producu\_desc:before { |
| [1232](#L1232) | height: 55px; |
| [1233](#L1233) | margin-top: -45px; |
| [1234](#L1234) | content: ""; |
| [1235](#L1235) | background: -moz-linear-gradient(top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%); |
| [1236](#L1236) | background: -webkit-linear-gradient(top, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%); |
| [1237](#L1237) | background: linear-gradient(to bottom, rgba(255, 255, 255, 0) 0%, rgba(255, 255, 255, 1) 100%); |
| [1238](#L1238) | filter: progid:DXImageTransform.Microsoft.gradient(startColorstr='#ffffff00', endColorstr='#ffffff', GradientType=0); |
| [1239](#L1239) | display: block; |
| [1240](#L1240) | } |
| [1241](#L1241) |  |
| [1242](#L1242) | .whp\_readmore\_producu\_desc span { |
| [1243](#L1243) | color: #6c6d70; |
| [1244](#L1244) | display: block; |
| [1245](#L1245) | border: 1px solid; |
| [1246](#L1246) | margin-left: auto; |
| [1247](#L1247) | display: flex; |
| [1248](#L1248) | width: 130px; |
| [1249](#L1249) | margin-right: auto; |
| [1250](#L1250) | text-transform: uppercase; |
| [1251](#L1251) | text-align: center; |
| [1252](#L1252) | justify-content: center; |
| [1253](#L1253) | } |
| [1254](#L1254) | </style> |
| [1255](#L1255) |  |
| [1256](#L1256) | <script> |
| [1257](#L1257) | jQuery('.whp\_readmore\_producu\_desc').click(function() { |
| [1258](#L1258) | if (jQuery('#tab-description').css('max-height') == 'none') { |
| [1259](#L1259) | jQuery('#tab-description').css('max-height', '200px') |
| [1260](#L1260) | jQuery(this).html('<span title="Xem thêm">Xem thêm</span>') |
| [1261](#L1261) | } else { |
| [1262](#L1262) | jQuery('#tab-description').css('max-height', 'none') |
| [1263](#L1263) | jQuery(this).html('<span title="Thu gọn">Thu gọn</span>') |
| [1264](#L1264) | } |
| [1265](#L1265) |  |
| [1266](#L1266) | }) |
| [1267](#L1267) | </script> |
| [1268](#L1268) |  |
| [1269](#L1269) |  |
| [1270](#L1270) | <?php    } |
| [1271](#L1271) | } |
| [1272](#L1272) |  |
| [1273](#L1273) | public function whp\_extention\_duplicate($actions, $post) |
| [1274](#L1274) | { |
| [1275](#L1275) |  |
| [1276](#L1276) | if ($post->post\_type == 'acf-field-group') { |
| [1277](#L1277) | return $actions; |
| [1278](#L1278) | } |
| [1279](#L1279) |  |
| [1280](#L1280) | if (current\_user\_can('edit\_posts')) { |
| [1281](#L1281) | $actions['duplicate'] = |
| [1282](#L1282) | isset($post) ? '<a href="admin.php?action=whp\_extention\_duplicate\_action&amp;post=' . intval($post->ID) . '&amp;nonce=' . wp\_create\_nonce('dt-duplicate-page-' . intval($post->ID)) . '" title="' . \_\_('Sao chép', 'duplicate-page') . '" rel="permalink">' . \_\_('Sao chép', 'duplicate-page') . '</a>' : ''; |
| [1283](#L1283) | } |
| [1284](#L1284) |  |
| [1285](#L1285) | return $actions; |
| [1286](#L1286) | } |
| [1287](#L1287) |  |
| [1288](#L1288) | // end advance |
| [1289](#L1289) |  |
| [1290](#L1290) |  |
| [1291](#L1291) | // start gateway wallet |
| [1292](#L1292) | public function whp\_gateway\_wallet() |
| [1293](#L1293) | { |
| [1294](#L1294) | add\_filter('woocommerce\_payment\_gateways', [$this, 'whp\_gateway\_wallet\_setting']); |
| [1295](#L1295) | } |
| [1296](#L1296) | public function whp\_gateway\_wallet\_setting($gateways) |
| [1297](#L1297) | { |
| [1298](#L1298) |  |
| [1299](#L1299) | $fields = whp\_get\_woo\_wallet\_fields(); |
| [1300](#L1300) |  |
| [1301](#L1301) | foreach ($fields as $key => $field) { |
| [1302](#L1302) |  |
| [1303](#L1303) | $$field = whp\_get\_setting($field); |
| [1304](#L1304) | } |
| [1305](#L1305) | if ($whp\_woocommerce\_wallet\_momo) { |
| [1306](#L1306) | $name =  "class.wps-wallet-momo"; |
| [1307](#L1307) | $fileURL = plugin\_dir\_path(\_\_FILE\_\_) . "wallet/{$name}.php"; |
| [1308](#L1308) | if (file\_exists($fileURL)) { |
| [1309](#L1309) | require\_once($fileURL); |
| [1310](#L1310) | $gateways[] = 'MB\_WHP\_Wallet\_MoMo'; |
| [1311](#L1311) | } |
| [1312](#L1312) | } |
| [1313](#L1313) | if ($whp\_woocommerce\_wallet\_zalopay) { |
| [1314](#L1314) |  |
| [1315](#L1315) | $name =  "class.wps-wallet-zalopay"; |
| [1316](#L1316) | $fileURL = plugin\_dir\_path(\_\_FILE\_\_) . "wallet/{$name}.php"; |
| [1317](#L1317) | if (file\_exists($fileURL)) { |
| [1318](#L1318) | require\_once($fileURL); |
| [1319](#L1319) | $gateways[] = 'MB\_WHP\_Wallet\_ZaloPay'; |
| [1320](#L1320) | } |
| [1321](#L1321) | } |
| [1322](#L1322) | if ($whp\_woocommerce\_wallet\_vnpay) { |
| [1323](#L1323) | $name =  "class.wps-wallet-vnpay"; |
| [1324](#L1324) | $fileURL = plugin\_dir\_path(\_\_FILE\_\_) . "wallet/{$name}.php"; |
| [1325](#L1325) | if (file\_exists($fileURL)) { |
| [1326](#L1326) | require\_once($fileURL); |
| [1327](#L1327) | $gateways[] = 'MB\_WHP\_Wallet\_VNPAY'; |
| [1328](#L1328) | } |
| [1329](#L1329) | } |
| [1330](#L1330) | if ($whp\_woocommerce\_wallet\_shopeepay) { |
| [1331](#L1331) | $name =  "class.wps-wallet-shopeepay"; |
| [1332](#L1332) | $fileURL = plugin\_dir\_path(\_\_FILE\_\_) . "wallet/{$name}.php"; |
| [1333](#L1333) | if (file\_exists($fileURL)) { |
| [1334](#L1334) | require\_once($fileURL); |
| [1335](#L1335) | $gateways[] = 'MB\_WHP\_Wallet\_ShopeePay'; |
| [1336](#L1336) | } |
| [1337](#L1337) | } |
| [1338](#L1338) | return $gateways; |
| [1339](#L1339) | } |
| [1340](#L1340) | // end gateway wallet |
| [1341](#L1341) |  |
| [1342](#L1342) | // maintenance |
| [1343](#L1343) |  |
| [1344](#L1344) | public function whp\_maintenance() |
| [1345](#L1345) | { |
| [1346](#L1346) |  |
| [1347](#L1347) | $fields = whp\_get\_maintenance\_fields(); |
| [1348](#L1348) | foreach ($fields as $key => $field) { |
| [1349](#L1349) | $$field = whp\_get\_setting($field); |
| [1350](#L1350) | } |
| [1351](#L1351) |  |
| [1352](#L1352) | if ($whp\_maintenance\_active) { |
| [1353](#L1353) |  |
| [1354](#L1354) | global $pagenow; |
| [1355](#L1355) |  |
| [1356](#L1356) | // Kiểm tra xem trang hiện tại không phải là trang quản trị và kích hoạt chế độ bảo trì |
| [1357](#L1357) | if ($pagenow !== 'wp-login.php' && !is\_admin()) { |
| [1358](#L1358) |  |
| [1359](#L1359) | wp\_die('<h1>Bảo trì</h1><p> |
| [1360](#L1360) | Xin lỗi, chúng tôi đang bảo trì website. Vui lòng truy cập lại sau.</p>', 'Maintenance Mode'); |
| [1361](#L1361) | } |
| [1362](#L1362) | } |
| [1363](#L1363) | } |
| [1364](#L1364) | // popup |
| [1365](#L1365) | public function whp\_popup() |
| [1366](#L1366) | { |
| [1367](#L1367) | $fields = whp\_get\_popup\_fields(); |
| [1368](#L1368) |  |
| [1369](#L1369) | foreach ($fields as $key => $field) { |
| [1370](#L1370) | $$field = whp\_get\_option($field); |
| [1371](#L1371) | } |
| [1372](#L1372) | $whp\_maintenance\_active = whp\_get\_option('whp\_maintenance\_active'); |
| [1373](#L1373) | if ($whp\_popup\_active && !is\_admin() && !is\_login() && !$whp\_maintenance\_active) { |
| [1374](#L1374) | add\_action('wp\_enqueue\_scripts', function () { |
| [1375](#L1375) | wp\_enqueue\_script('cookie', $this->pathAsset . 'js/cookie.js', array('jquery'), time(), true); |
| [1376](#L1376) | }); |
| [1377](#L1377) | add\_action('wp\_enqueue\_scripts', function () { |
| [1378](#L1378) | wp\_enqueue\_script('ajax', $this->pathAsset . 'js/ajax.js', array('jquery'), time(), true); |
| [1379](#L1379) | wp\_localize\_script('ajax', 'whp\_popup\_ajax', ['url' =>  admin\_url('admin-ajax.php')]); |
| [1380](#L1380) | wp\_enqueue\_style('font-awesome', 'https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css', array(), null); |
| [1381](#L1381) | }); |
| [1382](#L1382) | // pop up newsletter |
| [1383](#L1383) | if ($whp\_popup\_type == 0) { |
| [1384](#L1384) |  |
| [1385](#L1385) | add\_action('wp\_head', function () use ($fields) { |
| [1386](#L1386) | foreach ($fields as $key => $field) { |
| [1387](#L1387) | $$field = whp\_get\_option($field); |
| [1388](#L1388) | } |
| [1389](#L1389) | require($this->pathViewPages . 'popup-newsletter.php'); |
| [1390](#L1390) | }); |
| [1391](#L1391) | } |
| [1392](#L1392) | // pop up banner |
| [1393](#L1393) | if ($whp\_popup\_type == 1) { |
| [1394](#L1394) | require\_once($this->pathViewPages . 'popup-banner.php'); |
| [1395](#L1395) | } |
| [1396](#L1396) | } |
| [1397](#L1397) | } |
| [1398](#L1398) |  |
| [1399](#L1399) | // reponsive |
| [1400](#L1400) |  |
| [1401](#L1401) | public function whp\_reponsive() |
| [1402](#L1402) | { |
| [1403](#L1403) | $fields = whp\_get\_responsive\_fields(); |
| [1404](#L1404) |  |
| [1405](#L1405) | foreach ($fields as $key => $field) { |
| [1406](#L1406) | $$field = whp\_get\_option($field); |
| [1407](#L1407) | } |
| [1408](#L1408) | $content = '<style>'; |
| [1409](#L1409) | if ($whp\_reponsive\_mobile) { |
| [1410](#L1410) | $content .= $whp\_reponsive\_mobile; |
| [1411](#L1411) | //die($content); |
| [1412](#L1412) | } |
| [1413](#L1413) | if ($whp\_reponsive\_desktop) { |
| [1414](#L1414) | $content .= $whp\_reponsive\_desktop; |
| [1415](#L1415) | } |
| [1416](#L1416) | if ($whp\_reponsive\_tablet) { |
| [1417](#L1417) | $content .= $whp\_reponsive\_tablet; |
| [1418](#L1418) | } |
| [1419](#L1419) | $content .= ' </style>'; |
| [1420](#L1420) | add\_action('wp\_head', function () use ($content) { |
| [1421](#L1421) | echo $content; |
| [1422](#L1422) | }); |
| [1423](#L1423) | } |
| [1424](#L1424) | } |
| [1425](#L1425) | } |

**Note:** See [TracBrowser](/wiki/TracBrowser)
for help on using the repository browser.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Plain Text](/browser/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php?format=txt)
* [Original Format](/export/3220774/wp-helper-lite/trunk/functions/class.wps-frontend-setup-function.php)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)



=== Content from www.wordfence.com_ad3bb5ee_20250111_161545.html ===


[![](https://www.wordfence.com/img/wordfence-intelligence-logo.svg)](/threat-intel/)

Have you found a vulnerability in a WordPress plugin or theme? Report vulnerabilities in WordPress plugins and themes through our [bug bounty program](https://www.wordfence.com/threat-intel/bug-bounty-program) and earn a bounty on all in-scope submissions, while we handle the responsible disclosure process on your behalf.

As a reminder, the Wordfence Intelligence Vulnerability Database API is completely free to query and utilize, both personally and commercially, and contains all the same vulnerability data as the user interface. Please review the API documentation and Webhook documentation for more information on how to query the vulnerability API endpoints and configure webhooks utilizing all the same data present in the Wordfence Intelligence user interface.

# WP Helper Premium <= 4.6.1 - Missing Authorization in whp\_smtp\_send\_mail\_test

 [Wordfence Intelligence](https://www.wordfence.com/threat-intel)   >    [Vulnerability Database](https://www.wordfence.com/threat-intel/vulnerabilities)   >   WP Helper Premium <= 4.6.1 - Missing Authorization in whp\_smtp\_send\_mail\_test

5.3

**Missing Authorization**
**CVSS Vector**
[CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N](https://www.first.org/cvss/calculator/3.1#CVSS:3.1/AV:N/AC:L/PR:N/UI:N/S:U/C:N/I:L/A:N)

| CVE | [CVE-2024-9065](https://www.cve.org/CVERecord?id=CVE-2024-9065) |
| --- | --- |
| CVSS | 5.3 (Medium) |
| Publicly Published | October 9, 2024 |
| Last Updated | October 16, 2024 |
| Researcher | [Francesco Carlucci](https://www.wordfence.com/threat-intel/vulnerabilities/researchers/francesco-carlucci) |

### Description

The WP Helper Premium plugin for WordPress is vulnerable to unauthorized modification of data due to a missing capability check on the 'whp\_smtp\_send\_mail\_test' function in all versions up to, and including, 4.6.1. This makes it possible for unauthenticated attackers to send emails containing any content and originating from the vulnerable WordPress instance to any recipient.

#### References

* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/browser/wp-helper-lite/tags/4.6.1/functions/class.wps-frontend-setup-function.php#L55)
* [plugins.trac.wordpress.org](https://plugins.trac.wordpress.org/changeset/3167825/)

#### Share

[Facebook](https://www.facebook.com/sharer/sharer.php?u=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-helper-lite%2Fwp-helper-premium-461-missing-authorization-in-whp-smtp-send-mail-test&t=WP%20Helper%20Premium%20%3C%3D%204.6.1%20-%20Missing%20Authorization%20in%20whp_smtp_send_mail_test "Facebook")
[Twitter](https://twitter.com/share?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-helper-lite%2Fwp-helper-premium-461-missing-authorization-in-whp-smtp-send-mail-test&text=WP%20Helper%20Premium%20%3C%3D%204.6.1%20-%20Missing%20Authorization%20in%20whp_smtp_send_mail_test "Twitter")
[LinkedIn](https://www.linkedin.com/shareArticle?url=http%3A%2F%2Fwww.wordfence.com%2Fthreat-intel%2Fvulnerabilities%2Fwordpress-plugins%2Fwp-helper-lite%2Fwp-helper-premium-461-missing-authorization-in-whp-smtp-send-mail-test "LinkedIn")
Email

## Vulnerability Details for WP Helper Premium

#### [WP Helper Premium](https://www.wordfence.com/threat-intel/vulnerabilities/wordpress-plugins/wp-helper-lite)

| Software Type | Plugin |
| --- | --- |
| Software Slug | wp-helper-lite [(view on wordpress.org)](https://wordpress.org/plugins/wp-helper-lite) |
| Patched? | Yes |
| Remediation | Update to version 4.6.2, or a newer patched version |
| Affected Version | * <= 4.6.1 |
| Patched Version | * 4.6.2 |

This record contains material that is subject to copyright.

**Copyright 2012-2025 Defiant Inc.**

**License:**
Defiant hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute this software vulnerability information. Any copy of the software vulnerability information you make for such purposes is authorized provided that you include a hyperlink to this vulnerability record and reproduce Defiant's copyright designation and this license in any such copy.
**[Read more.](https://www.wordfence.com/wordfence-intelligence-terms-and-conditions/)**

**Copyright 1999-2025 The MITRE Corporation**

**License:**
CVE Usage: MITRE hereby grants you a perpetual, worldwide, non-exclusive, no-charge, royalty-free, irrevocable copyright license to reproduce, prepare derivative works of, publicly display, publicly perform, sublicense, and distribute Common Vulnerabilities and Exposures (CVE®). Any copy you make for such purposes is authorized provided that you reproduce MITRE's copyright designation and this license in any such copy.
**[Read more.](https://www.cve.org/Legal/TermsOfUse)**

Have information to add, or spot any errors? Contact us at wfi-support@wordfence.com so we can make any appropriate adjustments.

Did you know Wordfence Intelligence provides free personal and commercial API access to our comprehensive WordPress vulnerability database, along with a free webhook integration to stay on top of the latest vulnerabilities added and updated in the database? Get started today!

Learn more

Want to get notified of the latest vulnerabilities that may affect your WordPress site?
 Install Wordfence on your site today to get notified immediately if your site is affected by a vulnerability that has been added to our database.

Get Wordfence

The Wordfence Intelligence WordPress vulnerability database is completely free to access and query via API. Please review the documentation on how to access and consume the vulnerability data via API.

Documentation


