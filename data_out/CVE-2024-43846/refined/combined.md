=== Content from git.kernel.org_6a40f412_20250110_153832.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:59:36 +0200 |
| commit | [499f742fed42e74f1321f4b12ca196a66a2b49fc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)) | |
| tree | [53027b6bcf60fbdc894071445fde45cd2d3adbe3](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc) | |
| parent | [a1cf0f193db577a8d682ec54ff9e3cf1e134b96d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a1cf0f193db577a8d682ec54ff9e3cf1e134b96d) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc&id2=a1cf0f193db577a8d682ec54ff9e3cf1e134b96d)) | |
| download | [linux-499f742fed42e74f1321f4b12ca196a66a2b49fc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-499f742fed42e74f1321f4b12ca196a66a2b49fc.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=499f742fed42e74f1321f4b12ca196a66a2b49fc) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 1e248629ed6431..90f3aa68c30a0e 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=a1cf0f193db577a8d682ec54ff9e3cf1e134b96d)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=499f742fed42e74f1321f4b12ca196a66a2b49fc)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:09 +0000



=== Content from git.kernel.org_5a8c47a7_20250110_153833.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=8161263362154cbebfbf4808097b956a6a8cb98a)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8161263362154cbebfbf4808097b956a6a8cb98a)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8161263362154cbebfbf4808097b956a6a8cb98a)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8161263362154cbebfbf4808097b956a6a8cb98a)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:33:28 +0200 |
| commit | [8161263362154cbebfbf4808097b956a6a8cb98a](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=8161263362154cbebfbf4808097b956a6a8cb98a) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=8161263362154cbebfbf4808097b956a6a8cb98a)) | |
| tree | [27447d2f8884b10cad50022e7fc6071a6a334eb7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=8161263362154cbebfbf4808097b956a6a8cb98a) | |
| parent | [32e4baeaae7e33a77596398062374124f0508ae7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=32e4baeaae7e33a77596398062374124f0508ae7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8161263362154cbebfbf4808097b956a6a8cb98a&id2=32e4baeaae7e33a77596398062374124f0508ae7)) | |
| download | [linux-8161263362154cbebfbf4808097b956a6a8cb98a.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-8161263362154cbebfbf4808097b956a6a8cb98a.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=8161263362154cbebfbf4808097b956a6a8cb98a)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=8161263362154cbebfbf4808097b956a6a8cb98a) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 55621fb82e0a32..e380e95de77027 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=32e4baeaae7e33a77596398062374124f0508ae7)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=8161263362154cbebfbf4808097b956a6a8cb98a)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:11 +0000



=== Content from git.kernel.org_48425a64_20250110_153833.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:49:05 +0200 |
| commit | [5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)) | |
| tree | [b7f57f003c5670a648083ca735b18cf9fae3bab8](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7) | |
| parent | [0340b8f1a14dc40ce3a26d62d55a803896d9ad80](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=0340b8f1a14dc40ce3a26d62d55a803896d9ad80) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7&id2=0340b8f1a14dc40ce3a26d62d55a803896d9ad80)) | |
| download | [linux-5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 1e248629ed6431..90f3aa68c30a0e 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=0340b8f1a14dc40ce3a26d62d55a803896d9ad80)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=5adc61d29bbb461d7f7c2b48dceaa90ecd182eb7)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:10 +0000



=== Content from git.kernel.org_31e99912_20250110_153832.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=565213e005557eb6cc4e42189d26eb300e02f170)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=565213e005557eb6cc4e42189d26eb300e02f170)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=565213e005557eb6cc4e42189d26eb300e02f170)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=565213e005557eb6cc4e42189d26eb300e02f170)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:44:56 +0200 |
| commit | [565213e005557eb6cc4e42189d26eb300e02f170](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=565213e005557eb6cc4e42189d26eb300e02f170) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=565213e005557eb6cc4e42189d26eb300e02f170)) | |
| tree | [7d8495619ba46abf540ceacf8666ddce0afb9741](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=565213e005557eb6cc4e42189d26eb300e02f170) | |
| parent | [4f44cb495c2b85dc4bc0e88a539c8c919cfbc645](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4f44cb495c2b85dc4bc0e88a539c8c919cfbc645) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=565213e005557eb6cc4e42189d26eb300e02f170&id2=4f44cb495c2b85dc4bc0e88a539c8c919cfbc645)) | |
| download | [linux-565213e005557eb6cc4e42189d26eb300e02f170.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-565213e005557eb6cc4e42189d26eb300e02f170.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=565213e005557eb6cc4e42189d26eb300e02f170)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=565213e005557eb6cc4e42189d26eb300e02f170) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 5e1676ccdaddd0..73d7116025736a 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=4f44cb495c2b85dc4bc0e88a539c8c919cfbc645)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=565213e005557eb6cc4e42189d26eb300e02f170)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:09 +0000



=== Content from git.kernel.org_855a1313_20250110_153831.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-19 05:40:45 +0200 |
| commit | [22ae17a267f4812861f0c644186c3421ff97dbfc](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=22ae17a267f4812861f0c644186c3421ff97dbfc) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)) | |
| tree | [3665b3d002b4763e97635e742b7ec6911455be2a](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=22ae17a267f4812861f0c644186c3421ff97dbfc) | |
| parent | [ada0c319253a6aad4f82dd2c29bf15d8feecbcf8](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ada0c319253a6aad4f82dd2c29bf15d8feecbcf8) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22ae17a267f4812861f0c644186c3421ff97dbfc&id2=ada0c319253a6aad4f82dd2c29bf15d8feecbcf8)) | |
| download | [linux-22ae17a267f4812861f0c644186c3421ff97dbfc.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-22ae17a267f4812861f0c644186c3421ff97dbfc.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=22ae17a267f4812861f0c644186c3421ff97dbfc)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=22ae17a267f4812861f0c644186c3421ff97dbfc) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 5e1676ccdaddd0..73d7116025736a 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=ada0c319253a6aad4f82dd2c29bf15d8feecbcf8)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=22ae17a267f4812861f0c644186c3421ff97dbfc)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:08 +0000



=== Content from git.kernel.org_bca2cc80_20250110_153830.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | Greg Kroah-Hartman <gregkh@linuxfoundation.org> | 2024-08-03 08:53:38 +0200 |
| commit | [1936fa05a180834c3b52e0439a6bddc07814d3eb](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)) | |
| tree | [d449c42cb51dd299162d47ee42d9edbb5d2e69fd](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb) | |
| parent | [e382588b8d1493136a168bbc4a698d25d0b79c94](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=e382588b8d1493136a168bbc4a698d25d0b79c94) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb&id2=e382588b8d1493136a168bbc4a698d25d0b79c94)) | |
| download | [linux-1936fa05a180834c3b52e0439a6bddc07814d3eb.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-1936fa05a180834c3b52e0439a6bddc07814d3eb.tar.gz) | |

lib: objagg: Fix general protection fault[ Upstream commit b4a3a89fffcdf09702b1f161b914e52abca1894d ]
The library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
Signed-off-by: Sasha Levin <sashal@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=1936fa05a180834c3b52e0439a6bddc07814d3eb) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 1e248629ed6431..90f3aa68c30a0e 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=e382588b8d1493136a168bbc4a698d25d0b79c94)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=1936fa05a180834c3b52e0439a6bddc07814d3eb)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:08 +0000



=== Content from git.kernel.org_6d689b67_20250110_153834.html ===


| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Ido Schimmel <idosch@nvidia.com> | 2024-06-06 16:49:41 +0200 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2024-06-10 11:14:52 +0100 |
| commit | [b4a3a89fffcdf09702b1f161b914e52abca1894d](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)) | |
| tree | [7da8c1caefc7e803b60c0f7c834938461cbdafdf](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d) | |
| parent | [06fcdf2494068ceb29686657f8e5d15084e6e0c3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=06fcdf2494068ceb29686657f8e5d15084e6e0c3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d&id2=06fcdf2494068ceb29686657f8e5d15084e6e0c3)) | |
| download | [linux-b4a3a89fffcdf09702b1f161b914e52abca1894d.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-b4a3a89fffcdf09702b1f161b914e52abca1894d.tar.gz) | |

lib: objagg: Fix general protection faultThe library supports aggregation of objects into other objects only if
the parent object does not have a parent itself. That is, nesting is not
supported.
Aggregation happens in two cases: Without and with hints, where hints
are a pre-computed recommendation on how to aggregate the provided
objects.
Nesting is not possible in the first case due to a check that prevents
it, but in the second case there is no check because the assumption is
that nesting cannot happen when creating objects based on hints. The
violation of this assumption leads to various warnings and eventually to
a general protection fault [1].
Before fixing the root cause, error out when nesting happens and warn.
[1]
general protection fault, probably for non-canonical address 0xdead000000000d90: 0000 [#1] PREEMPT SMP PTI
CPU: 1 PID: 1083 Comm: kworker/1:9 Tainted: G W 6.9.0-rc6-custom-gd9b4f1cca7fb #7
Hardware name: Mellanox Technologies Ltd. MSN3700/VMOD0005, BIOS 5.11 01/06/2019
Workqueue: mlxsw\_core mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work
RIP: 0010:mlxsw\_sp\_acl\_erp\_bf\_insert+0x25/0x80
[...]
Call Trace:
<TASK>
mlxsw\_sp\_acl\_atcam\_entry\_add+0x256/0x3c0
mlxsw\_sp\_acl\_tcam\_entry\_create+0x5e/0xa0
mlxsw\_sp\_acl\_tcam\_vchunk\_migrate\_one+0x16b/0x270
mlxsw\_sp\_acl\_tcam\_vregion\_rehash\_work+0xbe/0x510
process\_one\_work+0x151/0x370
worker\_thread+0x2cb/0x3e0
kthread+0xd0/0x100
ret\_from\_fork+0x34/0x50
ret\_from\_fork\_asm+0x1a/0x30
</TASK>
Fixes: 9069a3817d82 ("lib: objagg: implement optimization hints assembly and use hints for object creation")
Reported-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Ido Schimmel <idosch@nvidia.com>
Reviewed-by: Amit Cohen <amcohen@nvidia.com>
Tested-by: Alexander Zubkov <green@qrator.net>
Signed-off-by: Petr Machata <petrm@nvidia.com>
Reviewed-by: Simon Horman <horms@kernel.org>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)

| -rw-r--r-- | [lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/lib/objagg.c?id=b4a3a89fffcdf09702b1f161b914e52abca1894d) | 3 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 3 insertions, 0 deletions

| diff --git a/lib/objagg.c b/lib/objagg.cindex 955538c902236b..0f99ea5f53717c 100644--- a/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=06fcdf2494068ceb29686657f8e5d15084e6e0c3)+++ b/[lib/objagg.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/lib/objagg.c?id=b4a3a89fffcdf09702b1f161b914e52abca1894d)@@ -167,6 +167,9 @@ static int objagg\_obj\_parent\_assign(struct objagg \*objagg, { void \*delta\_priv; + if (WARN\_ON(!objagg\_obj\_is\_root(parent)))+ return -EINVAL;+ delta\_priv = objagg->ops->delta\_create(objagg->priv, parent->obj, objagg\_obj->obj); if (IS\_ERR(delta\_priv)) |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 15:37:11 +0000


