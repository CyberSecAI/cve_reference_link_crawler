

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Maxim Mikityanskiy <maximmi@nvidia.com> | 2021-06-10 19:40:31 +0300 |
| --- | --- | --- |
| committer | David S. Miller <davem@davemloft.net> | 2021-06-10 14:26:18 -0700 |
| commit | [ba91c49dedbde758ba0b72f57ac90b06ddf8e548](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)) | |
| tree | [747752d7c9d0866bd600032a7e6fcadf4b403215](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548) | |
| parent | [07718be265680dcf496347d475ce1a5442f55ad7](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=07718be265680dcf496347d475ce1a5442f55ad7) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548&id2=07718be265680dcf496347d475ce1a5442f55ad7)) | |
| download | [linux-ba91c49dedbde758ba0b72f57ac90b06ddf8e548.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-ba91c49dedbde758ba0b72f57ac90b06ddf8e548.tar.gz) | |

sch\_cake: Fix out of bounds when parsing TCP options and headerThe TCP option parser in cake qdisc (cake\_get\_tcpopt and
cake\_tcph\_may\_drop) could read one byte out of bounds. When the length
is 1, the execution flow gets into the loop, reads one byte of the
opcode, and if the opcode is neither TCPOPT\_EOL nor TCPOPT\_NOP, it reads
one more byte, which exceeds the length of 1.
This fix is inspired by commit 9609dad263f8 ("ipv4: tcp\_input: fix stack
out of bounds when parsing TCP options.").
v2 changes:
Added doff validation in cake\_get\_tcphdr to avoid parsing garbage as TCP
header. Although it wasn't strictly an out-of-bounds access (memory was
allocated), garbage values could be read where CAKE expected the TCP
header if doff was smaller than 5.
Cc: Young Xiao <92siuyang@gmail.com>
Fixes: 8b7138814f29 ("sch\_cake: Add optional ACK filter")
Signed-off-by: Maxim Mikityanskiy <maximmi@nvidia.com>
Acked-by: Toke Høiland-Jørgensen <toke@toke.dk>
Signed-off-by: David S. Miller <davem@davemloft.net>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)

| -rw-r--r-- | [net/sched/sch\_cake.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/net/sched/sch_cake.c?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548) | 6 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 5 insertions, 1 deletions

| diff --git a/net/sched/sch\_cake.c b/net/sched/sch\_cake.cindex 7d37638ee1c7a9..5c15968b5155b6 100644--- a/[net/sched/sch\_cake.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sched/sch_cake.c?id=07718be265680dcf496347d475ce1a5442f55ad7)+++ b/[net/sched/sch\_cake.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/net/sched/sch_cake.c?id=ba91c49dedbde758ba0b72f57ac90b06ddf8e548)@@ -943,7 +943,7 @@ static struct tcphdr \*cake\_get\_tcphdr(const struct sk\_buff \*skb, }  tcph = skb\_header\_pointer(skb, offset, sizeof(\_tcph), &\_tcph);- if (!tcph)+ if (!tcph || tcph->doff < 5) return NULL;  return skb\_header\_pointer(skb, offset,@@ -967,6 +967,8 @@ static const void \*cake\_get\_tcpopt(const struct tcphdr \*tcph, length--; continue; }+ if (length < 2)+ break; opsize = \*ptr++; if (opsize < 2 || opsize > length) break;@@ -1104,6 +1106,8 @@ static bool cake\_tcph\_may\_drop(const struct tcphdr \*tcph, length--; continue; }+ if (length < 2)+ break; opsize = \*ptr++; if (opsize < 2 || opsize > length) break; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 18:08:53 +0000

