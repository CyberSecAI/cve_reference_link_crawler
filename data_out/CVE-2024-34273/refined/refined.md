- **Root cause of vulnerability**: The `nJwt` library is vulnerable to prototype pollution due to the lack of validation in `JwtHeader` and `JwtBody` objects within the `Parser.prototype.parse` method. This allows an attacker to modify the prototype of these objects by injecting `__proto__` attributes.
- **Weaknesses/vulnerabilities present**: The library does not prevent the setting of properties like `__proto__` within the JWT header or body. This leads to the possibility of modifying object prototypes, which can have far-reaching consequences. The `JwtHeader` object attempts to prevent re-assignment of reserved keys, but this can be bypassed by modifying the prototype's `reservedKeys` array.
- **Impact of exploitation**:
    - Modification of existing attributes with incompatible types, potentially causing crashes.
    - Bypassing checks and validation mechanisms that rely on the presence or absence of specific attributes.
    - Creation of polluted attributes on all objects inheriting from `JwtBody` and `JwtHeader`, affecting broader application behavior.
- **Attack vectors**: An attacker can create a malicious JWT token with a crafted header and body, embedding `__proto__` attributes to modify the prototypes of `JwtHeader` and `JwtBody`. When the `nJwt.verify()` method is used to parse and verify the manipulated token, the prototypes get polluted, impacting the applicationâ€™s behavior.
- **Required attacker capabilities/position**: The attacker needs the ability to create and submit a JWT token to an application that uses the vulnerable `nJwt` library and the `nJwt.verify()` function.