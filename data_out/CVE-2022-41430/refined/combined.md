=== Content from github.com_a54a4978_20250108_112211.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxiomatic-systems%2FBento4%2Fissues%2F773)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Faxiomatic-systems%2FBento4%2Fissues%2F773)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=axiomatic-systems%2FBento4)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[axiomatic-systems](/axiomatic-systems)
/
**[Bento4](/axiomatic-systems/Bento4)**
Public

* [Notifications](/login?return_to=%2Faxiomatic-systems%2FBento4) You must be signed in to change notification settings
* [Fork
  493](/login?return_to=%2Faxiomatic-systems%2FBento4)
* [Star
   2.1k](/login?return_to=%2Faxiomatic-systems%2FBento4)

* [Code](/axiomatic-systems/Bento4)
* [Issues
  514](/axiomatic-systems/Bento4/issues)
* [Pull requests
  31](/axiomatic-systems/Bento4/pulls)
* [Actions](/axiomatic-systems/Bento4/actions)
* [Projects
  0](/axiomatic-systems/Bento4/projects)
* [Wiki](/axiomatic-systems/Bento4/wiki)
* [Security](/axiomatic-systems/Bento4/security)
* [Insights](/axiomatic-systems/Bento4/pulse)

Additional navigation options

* [Code](/axiomatic-systems/Bento4)
* [Issues](/axiomatic-systems/Bento4/issues)
* [Pull requests](/axiomatic-systems/Bento4/pulls)
* [Actions](/axiomatic-systems/Bento4/actions)
* [Projects](/axiomatic-systems/Bento4/projects)
* [Wiki](/axiomatic-systems/Bento4/wiki)
* [Security](/axiomatic-systems/Bento4/security)
* [Insights](/axiomatic-systems/Bento4/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Faxiomatic-systems%2FBento4%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Faxiomatic-systems%2FBento4%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Some heap-buffer-overflow bugs in Bento4 #773

Open

[DerekXC](/DerekXC) opened this issue
Sep 23, 2022
· 0 comments

Open

# [Some heap-buffer-overflow bugs in Bento4](#top) #773

[DerekXC](/DerekXC) opened this issue
Sep 23, 2022
· 0 comments

Labels
[fuzzing](/axiomatic-systems/Bento4/labels/fuzzing)

## Comments

[![@DerekXC](https://avatars.githubusercontent.com/u/113953345?s=80&u=f1ad8d21a1e6db0dc2b6f59e1e5398c32c6e8e09&v=4)](/DerekXC)

Copy link

### **[DerekXC](/DerekXC)** commented [Sep 23, 2022](#issue-1384054185) • edited Loading

| Summary Hello, I found three heap buffer overflow bugs in AP4\_Atom::TypeFromString(char const\*), AP4\_BitReader::ReadBit() and AP4\_BitReader::ReadBits(unsigned int). They come from mp4tag and mp4mux, respectively. Bug1 Heap-buffer-overflow on address 0x602000000332 in mp4tag:  ``` root@728d9sls452:/fuzz-mp4tag/mp4tag# ./mp4tag --remove 1 ../out/crashes/mp4tag_poc_1 /dev/null ================================================================= ==1647110==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000332 at pc 0x000000468f25 bp 0x7fff3510c600 sp 0x7fff3510c5f8 READ of size 1 at 0x602000000332 thread T0     #0 0x468f24 in AP4_Atom::TypeFromString(char const*) (/fuzz-mp4tag/mp4tag/mp4tag+0x468f24)     #1 0x755566 in AP4_MetaData::Entry::FindInIlst(AP4_ContainerAtom*) const (/fuzz-mp4tag/mp4tag/mp4tag+0x755566)     #2 0x75a3f2 in AP4_MetaData::Entry::RemoveFromFileIlst(AP4_File&, unsigned int) (/fuzz-mp4tag/mp4tag/mp4tag+0x75a3f2)     #3 0x42fc2c in RemoveTag(AP4_File*, AP4_String&, bool) (/fuzz-mp4tag/mp4tag/mp4tag+0x42fc2c)     #4 0x418531 in main (/fuzz-mp4tag/mp4tag/mp4tag+0x418531)     #5 0x7fdb89b2ec86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)     #6 0x407f09 in _start (/fuzz-mp4tag/mp4tag/mp4tag+0x407f09)  0x602000000332 is located 0 bytes to the right of 2-byte region [0x602000000330,0x602000000332) allocated by thread T0 here:     #0 0x996920 in malloc /llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:145     #1 0x7fdb8a1a9297 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0x93297)     #2 0x418531 in main (/fuzz-mp4tag/mp4tag/mp4tag+0x418531)     #3 0x7fdb89b2ec86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)  SUMMARY: AddressSanitizer: heap-buffer-overflow (/fuzz-mp4tag/mp4tag/mp4tag+0x468f24) in AP4_Atom::TypeFromString(char const*) Shadow bytes around the buggy address:   0x0c047fff8010: fa fa fd fd fa fa 04 fa fa fa fd fd fa fa 00 05   0x0c047fff8020: fa fa 01 fa fa fa 01 fa fa fa fd fa fa fa 03 fa   0x0c047fff8030: fa fa fd fa fa fa 06 fa fa fa 00 fa fa fa fd fa   0x0c047fff8040: fa fa 04 fa fa fa fd fd fa fa fd fa fa fa 01 fa   0x0c047fff8050: fa fa fd fa fa fa 00 00 fa fa 05 fa fa fa 00 00 =>0x0c047fff8060: fa fa 02 fa fa fa[02]fa fa fa 05 fa fa fa fa fa   0x0c047fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8080: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8090: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff80a0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff80b0: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==1647110==ABORTING   ``` Bug2 Heap-buffer-overflow on address 0x6020000000f8 in mp4mux (AP4\_BitReader::ReadBits):  ``` root@23iq42wasf35:/fuzz-mp4mux/mp4mux# \./mp4mux --track h264:../out/crashes/id\:000045\,sig\:06\,src\:000002\,op\:int32\,pos\:33\,val\:\+0\,470985 /dev/null ================================================================= ==2473731==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x6020000000f8 at pc 0x000000649cb8 bp 0x7ffced185f90 sp 0x7ffced185f88 READ of size 1 at 0x6020000000f8 thread T0     #0 0x649cb7 in AP4_BitReader::ReadBits(unsigned int) (/fuzz-mp4mux/mp4mux/mp4mux+0x649cb7)     #1 0x4d6040 in ReadGolomb(AP4_BitReader&) (/fuzz-mp4mux/mp4mux/mp4mux+0x4d6040)     #2 0x4d6ef9 in AP4_AvcFrameParser::ParsePPS(unsigned char const*, unsigned int, AP4_AvcPictureParameterSet&) (/fuzz-mp4mux/mp4mux/mp4mux+0x4d6ef9)     #3 0x4f01dd in AP4_AvcFrameParser::Feed(unsigned char const*, unsigned int, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4f01dd)     #4 0x4ecbf1 in AP4_AvcFrameParser::Feed(void const*, unsigned int, unsigned int&, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4ecbf1)     #5 0x4349a5 in main (/fuzz-mp4mux/mp4mux/mp4mux+0x4349a5)     #6 0x7fb87db03c86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)     #7 0x407df9 in _start (/fuzz-mp4mux/mp4mux/mp4mux+0x407df9)  0x6020000000f8 is located 0 bytes to the right of 8-byte region [0x6020000000f0,0x6020000000f8) allocated by thread T0 here:     #0 0xa84ba0 in malloc /llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:145     #1 0x7fb87e17e297 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0x93297)     #2 0x4f01dd in AP4_AvcFrameParser::Feed(unsigned char const*, unsigned int, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4f01dd)     #3 0x4349a5 in main (/fuzz-mp4mux/mp4mux/mp4mux+0x4349a5)     #4 0x7fb87db03c86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)  SUMMARY: AddressSanitizer: heap-buffer-overflow (/fuzz-mp4mux/mp4mux/mp4mux+0x649cb7) in AP4_BitReader::ReadBits(unsigned int) Shadow bytes around the buggy address:   0x0c047fff7fc0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff8000: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa fd fd =>0x0c047fff8010: fa fa 00 03 fa fa 06 fa fa fa 06 fa fa fa 00[fa]   0x0c047fff8020: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==2473731==ABORTING   ``` Bug3 Heap-buffer-overflow on address 0x602000000158 in mp4mux (AP4\_BitReader::ReadBit):  ``` root@345sadsf12w332:/fuzz-mp4mux/mp4mux# ./mp4mux --track h264:../out/crashes/id\:000001\,sig\:06\,src\:000002\,op\:flip1\,pos\:8\,10085 /dev/null ================================================================= ==1606856==ERROR: AddressSanitizer: heap-buffer-overflow on address 0x602000000158 at pc 0x00000064a882 bp 0x7ffd08428400 sp 0x7ffd084283f8 READ of size 1 at 0x602000000158 thread T0     #0 0x64a881 in AP4_BitReader::ReadBit() (/fuzz-mp4mux/mp4mux/mp4mux+0x64a881)     #1 0x4d6456 in ReadGolomb(AP4_BitReader&) (/fuzz-mp4mux/mp4mux/mp4mux+0x4d6456)     #2 0x4dcd9e in AP4_AvcFrameParser::ParseSliceHeader(unsigned char const*, unsigned int, unsigned int, unsigned int, AP4_AvcSliceHeader&) (/fuzz-mp4mux/mp4mux/mp4mux+0x4dcd9e)     #3 0x4ed906 in AP4_AvcFrameParser::Feed(unsigned char const*, unsigned int, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4ed906)     #4 0x4ecbf1 in AP4_AvcFrameParser::Feed(void const*, unsigned int, unsigned int&, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4ecbf1)     #5 0x4349a5 in main (/fuzz-mp4mux/mp4mux/mp4mux+0x4349a5)     #6 0x7fd9e3df9c86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)     #7 0x407df9 in _start (/fuzz-mp4mux/mp4mux/mp4mux+0x407df9)  0x602000000158 is located 0 bytes to the right of 8-byte region [0x602000000150,0x602000000158) allocated by thread T0 here:     #0 0xa84ba0 in malloc /llvm-project/compiler-rt/lib/asan/asan_malloc_linux.cpp:145     #1 0x7fd9e4474297 in operator new(unsigned long) (/usr/lib/x86_64-linux-gnu/libstdc++.so.6+0x93297)     #2 0x4ed906 in AP4_AvcFrameParser::Feed(unsigned char const*, unsigned int, AP4_AvcFrameParser::AccessUnitInfo&, bool) (/fuzz-mp4mux/mp4mux/mp4mux+0x4ed906)     #3 0x4349a5 in main (/fuzz-mp4mux/mp4mux/mp4mux+0x4349a5)     #4 0x7fd9e3df9c86 in __libc_start_main (/lib/x86_64-linux-gnu/libc.so.6+0x21c86)  SUMMARY: AddressSanitizer: heap-buffer-overflow (/fuzz-mp4mux/mp4mux/mp4mux+0x64a881) in AP4_BitReader::ReadBit() Shadow bytes around the buggy address:   0x0c047fff7fd0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff7fe0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff7ff0: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00   0x0c047fff8000: fa fa 00 00 fa fa 00 00 fa fa 00 00 fa fa fd fd   0x0c047fff8010: fa fa 00 03 fa fa 06 fa fa fa fd fa fa fa fd fa =>0x0c047fff8020: fa fa 06 fa fa fa 07 fa fa fa 00[fa]fa fa fa fa   0x0c047fff8030: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8040: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8050: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8060: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa   0x0c047fff8070: fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa fa Shadow byte legend (one shadow byte represents 8 application bytes):   Addressable:           00   Partially addressable: 01 02 03 04 05 06 07    Heap left redzone:       fa   Freed heap region:       fd   Stack left redzone:      f1   Stack mid redzone:       f2   Stack right redzone:     f3   Stack after return:      f5   Stack use after scope:   f8   Global redzone:          f9   Global init order:       f6   Poisoned by user:        f7   Container overflow:      fc   Array cookie:            ac   Intra object redzone:    bb   ASan internal:           fe   Left alloca redzone:     ca   Right alloca redzone:    cb   Shadow gap:              cc ==1606856==ABORTING  ``` POC [Bug\_1\_POC.zip](https://github.com/axiomatic-systems/Bento4/files/9635523/Bug_1_POC.zip) [Bug-2-POC.zip](https://github.com/axiomatic-systems/Bento4/files/9635529/Bug-2-POC.zip) [Bug-3-POC.zip](https://github.com/axiomatic-systems/Bento4/files/9635530/Bug-3-POC.zip) Environment Ubuntu 18.04.6 LTS (docker) clang 12.0.1 clang++ 12.0.1 Bento4 master branch([5b7cc25](https://github.com/axiomatic-systems/Bento4/commit/5b7cc2500d514717a64675fcf631939494c074ce)) && Bento4 release version([1.6.0-639](https://www.bok.net/Bento4/binaries/Bento4-SDK-1-6-0-639.x86_64-unknown-linux.zip)) Credit Xudong Cao ([NCNIPC of China](http://www.nipc.org.cn/)), (Zhongguancun Laboratory) Han Zheng ([NCNIPC of China](http://www.nipc.org.cn/), [Hexhive](http://hexhive.epfl.ch/)), (Zhongguancun Laboratory) Yuhang Huang ([NCNIPC of China](http://www.nipc.org.cn/)), (Zhongguancun Laboratory) Jiayuan Zhang ([NCNIPC of China](http://www.nipc.org.cn/)), (Zhongguancun Laboratory) Hao Zhang ([NCNIPC of China](http://www.nipc.org.cn/)), ([Xidian University](https://www.xidian.edu.cn/))  Thank you for your time! |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@barbibulle](https://avatars.githubusercontent.com/u/2460045?s=40&u=908c826c239ec820fc32de5c47139285ba499f39&v=4)](/barbibulle)
[barbibulle](/barbibulle)
added
the
[fuzzing](/axiomatic-systems/Bento4/labels/fuzzing)
label
[May 29, 2023](#event-9364534162)

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Faxiomatic-systems%2FBento4%2Fissues%2F773)

Assignees

No one assigned

Labels

[fuzzing](/axiomatic-systems/Bento4/labels/fuzzing)

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

2 participants

[![@barbibulle](https://avatars.githubusercontent.com/u/2460045?s=52&v=4)](/barbibulle) [![@DerekXC](https://avatars.githubusercontent.com/u/113953345?s=52&v=4)](/DerekXC)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


