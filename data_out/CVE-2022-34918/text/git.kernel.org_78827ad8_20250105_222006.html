

| [cgit logo](/) | [index](/) : [kernel/git/netdev/net.git](/pub/scm/linux/kernel/git/netdev/net.git/) | main |
| --- | --- | --- |
| Netdev Group's networking tree | Netdev Group |

| [about](/pub/scm/linux/kernel/git/netdev/net.git/about/)[summary](/pub/scm/linux/kernel/git/netdev/net.git/)[refs](/pub/scm/linux/kernel/git/netdev/net.git/refs/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)[log](/pub/scm/linux/kernel/git/netdev/net.git/log/)[tree](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)[commit](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)[diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)[stats](/pub/scm/linux/kernel/git/netdev/net.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Pablo Neira Ayuso <pablo@netfilter.org> | 2022-07-02 04:16:30 +0200 |
| --- | --- | --- |
| committer | Pablo Neira Ayuso <pablo@netfilter.org> | 2022-07-02 21:04:10 +0200 |
| commit | [7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6) ([patch](/pub/scm/linux/kernel/git/netdev/net.git/patch/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)) | |
| tree | [a4418248c8ef89042ae48ab8e2cb11da4f59da2c](/pub/scm/linux/kernel/git/netdev/net.git/tree/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6) | |
| parent | [f8ebb3ac881b17712e1d5967c97ab1806b16d3d6](/pub/scm/linux/kernel/git/netdev/net.git/commit/?id=f8ebb3ac881b17712e1d5967c97ab1806b16d3d6) ([diff](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6&id2=f8ebb3ac881b17712e1d5967c97ab1806b16d3d6)) | |
| download | [net-7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6.tar.gz](/pub/scm/linux/kernel/git/netdev/net.git/snapshot/net-7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6.tar.gz) | |

netfilter: nf\_tables: stricter validation of element dataMake sure element data type and length do not mismatch the one specified
by the set declaration.
Fixes: 7d7402642eaf ("netfilter: nf\_tables: variable sized set element keys / data")
Reported-by: Hugues ANGUELKOV <hanguelkov@randorisec.fr>
Signed-off-by: Pablo Neira Ayuso <pablo@netfilter.org>
[Diffstat](/pub/scm/linux/kernel/git/netdev/net.git/diff/?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)

| -rw-r--r-- | [net/netfilter/nf\_tables\_api.c](/pub/scm/linux/kernel/git/netdev/net.git/diff/net/netfilter/nf_tables_api.c?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6) | 9 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 8 insertions, 1 deletions

| diff --git a/net/netfilter/nf\_tables\_api.c b/net/netfilter/nf\_tables\_api.cindex 51144fc66889b5..d6b59beab3a986 100644--- a/[net/netfilter/nf\_tables\_api.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/net/netfilter/nf_tables_api.c?id=f8ebb3ac881b17712e1d5967c97ab1806b16d3d6)+++ b/[net/netfilter/nf\_tables\_api.c](/pub/scm/linux/kernel/git/netdev/net.git/tree/net/netfilter/nf_tables_api.c?id=7e6bc1f6cabcd30aba0b11219d8e01b952eacbb6)@@ -5213,13 +5213,20 @@ static int nft\_setelem\_parse\_data(struct nft\_ctx \*ctx, struct nft\_set \*set, struct nft\_data \*data, struct nlattr \*attr) {+ u32 dtype; int err;  err = nft\_data\_init(ctx, data, NFT\_DATA\_VALUE\_MAXLEN, desc, attr); if (err < 0) return err; - if (desc->type != NFT\_DATA\_VERDICT && desc->len != set->dlen) {+ if (set->dtype == NFT\_DATA\_VERDICT)+ dtype = NFT\_DATA\_VERDICT;+ else+ dtype = NFT\_DATA\_VALUE;++ if (dtype != desc->type ||+ set->dlen != desc->len) { nft\_data\_release(data, desc->type); return -EINVAL; } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-05 22:18:43 +0000

