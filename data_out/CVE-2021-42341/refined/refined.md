```
{
  "vulnerability": {
    "root_cause": "The `clean_path` function in `src/rc/checkpath.c` allocates memory for a string using `xmalloc(strlen(path))` which doesn't account for the null terminator, leading to a heap buffer overflow.",
    "weaknesses": [
      "Heap buffer overflow due to incorrect memory allocation size"
    ],
    "impact": "The `checkpath` utility crashes with `free(): invalid pointer` due to memory corruption.",
    "attack_vectors": "The vulnerability is triggered when `checkpath` is invoked with an argument. For example: `/lib/rc/bin/checkpath -d /tmp/tmp`",
    "required_capabilities": "No special privileges are needed besides the ability to execute the `checkpath` program with a path argument."
  },
  "fix": {
    "description": "The fix modifies the `clean_path` function to allocate `strlen(path) + 1` bytes for the string, accounting for the null terminator.",
    "commit_details": [
      {
        "commit_hash": "bb8334104baf4d5a4a442a8647fb9204738f2204",
        "fix_type": "Code fix",
          "file_changes": [
            {
              "file_path": "src/rc/checkpath.c",
              "original_line": "str = xmalloc(strlen(path));",
              "fixed_line": "str = xmalloc(strlen(path) + 1);"
            }
        ]
    },
        {
        "commit_hash": "cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7",
        "fix_type": "Code fix",
          "file_changes": [
            {
              "file_path": "src/rc/checkpath.c",
               "original_line": "str = xmalloc(strlen(path));",
               "fixed_line": "str = xmalloc(strlen(path) + 1);"
            }
        ]
      }
    ]
  },
  "additional_notes": "The issue was originally reported in Gentoo bug #816900. The fix was backported to older versions of OpenRC in Gentoo."
}
```