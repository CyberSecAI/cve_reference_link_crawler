=== Content from github.com_0f74e2d2_20250108_164053.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# checkpath -- free(): invalid pointer #459

Closed

[garyemiller](/garyemiller) opened this issue
Oct 8, 2021
¬∑ 2 comments

Closed

# [checkpath -- free(): invalid pointer](#top) #459

[garyemiller](/garyemiller) opened this issue
Oct 8, 2021
¬∑ 2 comments

## Comments

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=80&v=4)](/garyemiller)

Copy link

### **[garyemiller](/garyemiller)** commented [Oct 8, 2021](#issue-1020593989)

| I am a long time Gentoo user. I run Gentoo stable and unstable on a wide range of machines.  On just one, a Gentoo unstable, running on a znver2 CPU, I get this error:  ``` # /lib/rc/bin/checkpath -d /tmp/tmp free(): invalid pointer Aborted  ```  This has persisted for months. I have done "emerge -e world" many times, with various -mtune, -march, etc. and nothing affects the result.  So I did a "git pull, and looked at src/rc/checkpath.c. Then make this one change:  ``` diff --git a/src/rc/checkpath.c b/src/rc/checkpath.c index bab22692..df93d7d3 100644 --- a/src/rc/checkpath.c +++ b/src/rc/checkpath.c @@ -151,7 +151,8 @@ static char *clean_path(char *path)         char *ch;         char *ch2;         char *str; -       str = xmalloc(strlen(path)); +       str = xmalloc(strlen(path) + 1);         ch = path;         ch2 = str;         while (true) {  ```  The problem goes away. Looks like xmalloc() is just a wrapper on malloc().  According to "man strlen"  ```        The strlen() function calculates the length of the string pointed to by        s, excluding the terminating null byte ('\0').  ```  Looks to me like "str" is not big enough to hold "path" incuding its trailikng '\0'  No idea how that makes "free(path);" fail. But I'm glad it does.  . |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=80&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

Copy link

Contributor

### **[thesamesam](/thesamesam)** commented [Oct 8, 2021](#issuecomment-938286778)

| ... I was just about to look into this because I saw [this](https://bugs.gentoo.org/816900) bug.  Thank you for doing the work! |
| --- |

All reactions

Sorry, something went wrong.

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=80&v=4)](/garyemiller)

Copy link

Author

### **[garyemiller](/garyemiller)** commented [Oct 8, 2021](#issuecomment-938288515)

| Geez, I only had to wait one more day for someone else to do it... |
| --- |

 üòÑ
1
 thesamesam reacted with laugh emoji

All reactions

* üòÑ
  1 reaction

Sorry, something went wrong.

[thesamesam](/thesamesam)
added a commit
to thesamesam/openrc
that referenced
this issue
[Oct 8, 2021](#ref-commit-89ec8a8)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

`[checkpath: fix allocation size of string buffer](/thesamesam/openrc/commit/89ec8a86d6f87244f9559b35244a28401d906e14 "checkpath: fix allocation size of string buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: #459
Reported-by: Gary E. Miller
X-Gentoo-Bug: https://bugs.gentoo.org/816900
Signed-off-by: Sam James <sam@gentoo.org>")`
‚Ä¶

`[89ec8a8](/thesamesam/openrc/commit/89ec8a86d6f87244f9559b35244a28401d906e14)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: [OpenRC#459](https://github.com/OpenRC/openrc/issues/459)
Reported-by: Gary E. Miller
X-Gentoo-Bug: <https://bugs.gentoo.org/816900>
Signed-off-by: Sam James <sam@gentoo.org>
```

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)
[thesamesam](/thesamesam)
mentioned this issue
[Oct 8, 2021](#ref-pullrequest-1020669654)

[checkpath: fix allocation size of string buffer
#462](/OpenRC/openrc/pull/462)
 Closed

[thesamesam](/thesamesam)
added a commit
to thesamesam/openrc
that referenced
this issue
[Oct 8, 2021](#ref-commit-14360b3)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

`[checkpath: fix allocation size of path buffer](/thesamesam/openrc/commit/14360b36da52accb63326f8e15705e9531e8af0f "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: #459
Reported-by: Gary E. Miller
X-Gentoo-Bug: https://bugs.gentoo.org/816900
Signed-off-by: Sam James <sam@gentoo.org>")`
‚Ä¶

`[14360b3](/thesamesam/openrc/commit/14360b36da52accb63326f8e15705e9531e8af0f)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: [OpenRC#459](https://github.com/OpenRC/openrc/issues/459)
Reported-by: Gary E. Miller
X-Gentoo-Bug: <https://bugs.gentoo.org/816900>
Signed-off-by: Sam James <sam@gentoo.org>
```

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)
[williamh](/williamh)
closed this as [completed](/OpenRC/openrc/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[bb83341](/OpenRC/openrc/commit/bb8334104baf4d5a4a442a8647fb9204738f2204)`
[Oct 8, 2021](#event-5432248685)

[williamh](/williamh)
pushed a commit
that referenced
this issue
[Oct 8, 2021](#ref-commit-cc45b55)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam) [![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

`[checkpath: fix allocation size of path buffer](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7 "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: https://bugs.gentoo.org/816900
Fixes: #459
Fixes: #462")`
‚Ä¶

`[cc45b55](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: <https://bugs.gentoo.org/816900>
Fixes: [#459](https://github.com/OpenRC/openrc/issues/459)
Fixes: [#462](https://github.com/OpenRC/openrc/pull/462)
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [checkpath: fix allocation size of string buffer](/OpenRC/openrc/pull/462)
 [thesamesam/openrc](/thesamesam/openrc)

2 participants

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=52&v=4)](/garyemiller) [![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=52&v=4)](/thesamesam)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_88840d27_20250108_144102.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2Fbb8334104baf4d5a4a442a8647fb9204738f2204)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2Fbb8334104baf4d5a4a442a8647fb9204738f2204)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

## Commit

[Permalink](/OpenRC/openrc/commit/bb8334104baf4d5a4a442a8647fb9204738f2204)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

checkpath: fix allocation size of path buffer

[Browse files](/OpenRC/openrc/tree/bb8334104baf4d5a4a442a8647fb9204738f2204)
Browse the repository at this point in the history

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: <https://bugs.gentoo.org/816900>
Fixes: [#459](https://github.com/OpenRC/openrc/issues/459)
Fixes: [#462](https://github.com/OpenRC/openrc/pull/462)
```

* Loading branch information

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&v=4)](/thesamesam) [![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

[thesamesam](/OpenRC/openrc/commits?author=thesamesam "View all commits by thesamesam")
authored and
[williamh](/OpenRC/openrc/commits?author=williamh "View all commits by williamh")
committed
Oct 8, 2021

1 parent
[6b9a5b8](/OpenRC/openrc/commit/6b9a5b8271a4880a3b1f94d122a66e0c2cc95c93)

commit bb83341

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[src/rc/checkpath.c](#diff-1362380b076ae1f2d89bdc6227fe5076d33488e5199f17b5b99d6b591e6fc6fc "src/rc/checkpath.c")

Show comments

[View file](/OpenRC/openrc/blob/bb8334104baf4d5a4a442a8647fb9204738f2204/src/rc/checkpath.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -151,7 +151,7 @@ static char \*clean\_path(char \*path) |
|  |  | char \*ch; |
|  |  | char \*ch2; |
|  |  | char \*str; |
|  |  | str = xmalloc(strlen(path)); |
|  |  | str = xmalloc(strlen(path) + 1); |
|  |  | ch = path; |
|  |  | ch2 = str; |
|  |  | while (true) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `bb83341`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2Fbb8334104baf4d5a4a442a8647fb9204738f2204) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_f6e136dc_20250108_144103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F418)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F418)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# /lib/rc/bin/checkpath is broken in most recent release #418

Closed

[klausman](/klausman) opened this issue
Apr 7, 2021
¬∑ 5 comments

Closed

# [/lib/rc/bin/checkpath is broken in most recent release](#top) #418

[klausman](/klausman) opened this issue
Apr 7, 2021
¬∑ 5 comments

## Comments

[![@klausman](https://avatars.githubusercontent.com/u/4527946?s=80&v=4)](/klausman)

Copy link

### **[klausman](/klausman)** commented [Apr 7, 2021](#issue-852631848)

| ``` # ls -ld /var/lib/powerdns/ drwxr-xr-x 1 root root 88 Apr  7 19:21 /var/lib/powerdns/  # /lib/rc/bin/checkpath --directory --mode 750 /var/lib/powerdns/  * /var/lib/powerdns/: creating directory  * checkpath: mkdirat: No such file or directory #  ```  Not sure what's going on here, so I straced it:  ``` geteuid()                               = 0 getgid()                                = 0 brk(NULL)                               = 0x558e51af7000 brk(0x558e51b18000)                     = 0x558e51b18000 openat(0, "/", O_RDONLY)                = 3 openat(3, "var", O_RDONLY|O_NOFOLLOW|O_PATH) = 4 newfstatat(4, "", {st_mode=S_IFDIR|0755, st_size=132, ...}, AT_EMPTY_PATH) = 0 close(3)                                = 0 openat(4, "lib", O_RDONLY|O_NOFOLLOW|O_PATH) = 3 newfstatat(3, "", {st_mode=S_IFDIR|0755, st_size=648, ...}, AT_EMPTY_PATH) = 0 close(4)                                = 0 openat(3, "powerdns", O_RDONLY|O_NOFOLLOW|O_PATH) = 4 newfstatat(4, "", {st_mode=S_IFDIR|0755, st_size=88, ...}, AT_EMPTY_PATH) = 0 close(3)                                = 0 openat(4, "", O_RDONLY|O_NOCTTY|O_NONBLOCK|O_NOFOLLOW|O_CLOEXEC) = -1 ENOENT (No such file or directory)  ```  ltrace:  ``` geteuid()                                                     = 0 getgid()                                                      = 0 strrchr("/lib/rc/bin/checkpath", '/')                         = "/checkpath" getopt_long(5, 0x7fff76217098, "dDfFpm:o:sWChqVv", 0x55bbe0233ae0, nil) = 100 getopt_long(5, 0x7fff76217098, "dDfFpm:o:sWChqVv", 0x55bbe0233ae0, nil) = 109 strtoul(0x7fff762192d3, 0x7fff76216db0, 8, 0)                 = 488 getopt_long(5, 0x7fff76217098, "dDfFpm:o:sWChqVv", 0x55bbe0233ae0, nil) = -1 strrchr("/var/lib/powerdns/", '/')                            = "/" malloc(4096)                                                  = 0x55bbe02352a0 vsnprintf("", 4096, "%s", 0x7fff76216cd0)                     = 0 openat(0, 0x55bbe0231081, 0, 1)                               = 3 strdup("/var/lib/powerdns/")                                  = 0x55bbe02362b0 strtok("/var/lib/powerdns/", "/")                             = "var" strdup("var")                                                 = 0x55bbe02362d0 openat(3, 0x55bbe02362d0, 0x220000, 0x726176)                 = 4 fstat(4, 0x7fff76216ed0, 0x220000, 0)                         = 0 close(3)                                                      = 0 free(0)                                                       = <void> strtok(nil, "/")                                              = "lib" strdup("lib")                                                 = 0x55bbe02362f0 openat(4, 0x55bbe02362f0, 0x220000, 0x62696c)                 = 3 fstat(3, 0x7fff76216ed0, 0x220000, 0)                         = 0 close(4)                                                      = 0 free(0)                                                       = <void> strtok(nil, "/")                                              = "powerdns" strdup("powerdns")                                            = 0x55bbe0236310 openat(3, 0x55bbe0236310, 0x220000, 0x736e647265776f)         = 4 fstat(4, 0x7fff76216ed0, 0x220000, 0)                         = 0 close(3)                                                      = 0 free(0)                                                       = <void> strtok(nil, "/")                                              = nil free(0x55bbe02362b0)                                          = <void> openat(4, 0x55bbe02352a0, 0xa0900, 1)                         = 0xffffffff einfo(0x55bbe02310de, 0x7fff762192d7, -120, 0 * /var/lib/powerdns/: creating directory )                = 42 umask(00)                                                     = 022 mkdirat(4, 0x55bbe02352a0, 488, 0x7f578884d277)               = -1 umask(022)                                                    = 00 __errno_location()                                            = 0x7f5788717b08 strerror(2)                                                   = "No such file or directory" eerror(0x55bbe02310f5, 0x7fff762192b6, 0x7f57888e4b8c, -104 * checkpath: mkdirat: No such file or directory )  = 49 +++ exited (status 1) +++  ``` |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@klausman](https://avatars.githubusercontent.com/u/4527946?s=80&v=4)](/klausman)

Copy link

Author

### **[klausman](/klausman)** commented [Apr 7, 2021](#issuecomment-815090901)

| It's the trailing slash:  ``` # /lib/rc/bin/checkpath --directory --mode 750 /var/lib/powerdns  * /var/lib/powerdns: correcting mode  ```  vs.  ``` # /lib/rc/bin/checkpath --directory --mode 750 /var/lib/powerdns/  * /var/lib/powerdns/: creating directory  * checkpath: mkdirat: No such file or directory  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=80&v=4)](/williamh)

Copy link

Contributor

### **[williamh](/williamh)** commented [Apr 8, 2021](#issuecomment-815369006)

| [@orlitzky](https://github.com/orlitzky) Can you offer any suggestions that will work here? |
| --- |

All reactions

Sorry, something went wrong.

[![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=80&v=4)](/orlitzky)

Copy link

Contributor

### **[orlitzky](/orlitzky)** commented [Apr 8, 2021](#issuecomment-815387064)

| It's the `strtok` that's causing a problem with the trailing slash, right?  POSIX actually says that we have to support that:  A pathname that contains at least one non-`<slash>` character and that ends with one or more trailing `<slash>` characters shall not be resolved successfully unless the last pathname component before the trailing `<slash>` characters names an existing directory *or a directory entry that is to be created for a directory immediately after the pathname is resolved*.  (emphasis mine)  Maybe the simplest thing to do is strip any trailing slashes off of the path if `type == inode_dir` and if the path contains at least one non-slash character. |
| --- |

All reactions

Sorry, something went wrong.

[![@klausman](https://avatars.githubusercontent.com/u/4527946?s=80&v=4)](/klausman)

Copy link

Author

### **[klausman](/klausman)** commented [Apr 8, 2021](#issuecomment-815695914)

| Found another corner case:  ``` # mkdir /tmp/foo # cd /tmp/foo # /lib/rc/bin/checkpath --directory /$(pwd)  * //tmp/foo: creating directory # /lib/rc/bin/checkpath --directory /$(pwd) # ls foo # pwd /tmp/foo #   ```  Note how two leading `/` result in `/tmp/foo/foo` being created, despite the argument being just `/tmp/foo` |
| --- |

All reactions

Sorry, something went wrong.

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)
[williamh](/williamh)
closed this as [completed](/OpenRC/openrc/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[63db2d9](/OpenRC/openrc/commit/63db2d99e730547339d1bdd28e8437999c380cae)`
[Apr 13, 2021](#event-4590510785)

[williamh](/williamh)
added a commit
that referenced
this issue
[Apr 13, 2021](#ref-commit-6219d87)
[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

`[checkpath: remove extra slashes from paths](/OpenRC/openrc/commit/6219d87071d07acf4d6b3e99ec58134acf129d8e "checkpath: remove extra slashes from paths

This fixes #418.")`
‚Ä¶

`[6219d87](/OpenRC/openrc/commit/6219d87071d07acf4d6b3e99ec58134acf129d8e)`

```
This fixes [#418](https://github.com/OpenRC/openrc/issues/418).
```

[![@Whissi](https://avatars.githubusercontent.com/u/729436?s=80&v=4)](/Whissi)

Copy link

Contributor

### **[Whissi](/Whissi)** commented [Apr 14, 2021](#issuecomment-819527628)

| The bugfix for this regression caused an even bigger regression, see <https://bugs.gentoo.org/782808>.  My suggestion:   1. Revert any checkpath changes since (and including commit [b6fef59](https://github.com/OpenRC/openrc/commit/b6fef599bf8493480664b766040fa9b0d4b1e335), i.e. revert basically all changes to `src/rc/checkpath.c` since 2020+ (see <https://www.gentoofan.org/gentoo/misc/openrc-0.43.2-revert_checkpath_changes.patch>) and release new OpenRC 0.43 without any of these checkpath fixes to not hold back any other improvements. 2. Create a test suite and write tests for checkpath. 3. Resume working on the checkpath fix. 4. Once we have a checkpath which is passing tests, tag a new release with these changes.   PS: I am also wondering why commit [6219d87](https://github.com/OpenRC/openrc/commit/6219d87071d07acf4d6b3e99ec58134acf129d8e) doesn't show up for 0.43.2 tag but it was included in 0.43.2 release tarball... |
| --- |

All reactions

Sorry, something went wrong.

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F418)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

No branches or pull requests

4 participants

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=52&v=4)](/williamh) [![@Whissi](https://avatars.githubusercontent.com/u/729436?s=52&v=4)](/Whissi) [![@orlitzky](https://avatars.githubusercontent.com/u/1432135?s=52&v=4)](/orlitzky) [![@klausman](https://avatars.githubusercontent.com/u/4527946?s=52&v=4)](/klausman)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from bugs.gentoo.org_1e39e84e_20250108_144101.html ===

[![Gentoo Websites Logo](extensions/Gentoo/web/gentoo_org.png)](/ "Go to the Gentoo Bugzilla homepage")
Go to:
[Gentoo Home](https://www.gentoo.org/)
[Documentation](https://www.gentoo.org/support/documentation/)
[Forums](https://forums.gentoo.org/)
[Lists](https://www.gentoo.org/get-involved/mailing-lists/)
[Bugs](/)
[Planet](https://planet.gentoo.org/)
[Store](https://www.gentoo.org/inside-gentoo/stores/)
[Wiki](https://wiki.gentoo.org/)
**[Get Gentoo!](https://www.gentoo.org/downloads/)**

Gentoo's Bugzilla ‚Äì Bug¬†816900
sys-apps/openrc: checkpath exits with 'free(): invalid pointer' when launching www-apps/grafana-bin with init scripts
Last modified: 2021-10-14 06:32:12 UTC node [vulture]

* [Home](./)
* | [New](enter_bug.cgi?format=guided)‚Äì[[Ex]](enter_bug.cgi)
* | [Browse](describecomponents.cgi)
* | [Search](query.cgi)
* | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
* |

  [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
* | [Reports](report.cgi)
* |
  [Requests](request.cgi)
* |
  [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
* |
  [New¬†Account](createaccount.cgi)
* |
  [Log In](show_bug.cgi?id=816900&GoAheadAndLogIn=1)

  [x]
* |
  [Forgot Password](show_bug.cgi?id=816900&GoAheadAndLogIn=1#forgot)
  Login:

  [x]

[**Bug¬†816900**](show_bug.cgi?id=816900)
- sys-apps/openrc: checkpath exits with 'free(): invalid pointer' when launching www-apps/grafana-bin with init scripts

[Summary:](page.cgi?id=fields.html#short_desc "The bug summary is a short sentence which succinctly describes what the bug is about.")
sys-apps/openrc: checkpath exits with 'free(): invalid pointer' when launchin...

| | [Status](page.cgi?id=fields.html#bug_status): | RESOLVED FIXED | | --- | --- | |  | | | [Alias:](page.cgi?id=fields.html#alias "A short, unique name assigned to a bug in order to assist with looking it up and referring to it in other places in Bugzilla.") | None | |  | | | [Product:](describecomponents.cgi "Bugs are categorised into Products and Components.") | Gentoo Linux | | [Classification:](page.cgi?id=fields.html#classification "Bugs are categorised into Classifications, Products and Components. classifications is the top-level categorisation.") | Unclassified | | [Component:](describecomponents.cgi?product=Gentoo Linux "Components are second-level categories; each belongs to a particular Product. Select a Product to narrow down this list.") | Stabilization ([show other bugs](buglist.cgi?component=Stabilization&product=Gentoo%20Linux&bug_status=__open__)) | | [Hardware:](page.cgi?id=fields.html#rep_platform "The hardware platform the bug was observed on. Note: When searching, selecting the option \"All\" only finds bugs whose value for this field is literally the word \"All\".") | All Linux | |  | | | [Importance](page.cgi?id=fields.html#importance): | Normal critical | | [Assignee:](page.cgi?id=fields.html#assigned_to "The person in charge of resolving the bug.") | OpenRC Team | |  | | | [URL:](page.cgi?id=fields.html#bug_file_loc "Bugs can have a URL associated with them - for example, a pointer to a web site where the problem is seen.") | [https://github.com/OpenRC/openrc/comm...](https://github.com/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7) | | [Whiteboard:](page.cgi?id=fields.html#status_whiteboard "Each bug has a free-form single line text entry box for adding tags and status information.") |  | | [Keywords:](describekeywords.cgi "You can add keywords from a defined list to bugs, in order to easily identify and group them.") | PATCH | |  | | | Duplicates (1): | [818049](show_bug.cgi?id=818049 "RESOLVED DUPLICATE - sys-apps/openrc-0.44.6: checkpath segfault: malloc(): invalid next size (unsorted)")  ([view as bug list](buglist.cgi?bug_id=818049)) | | [Depends on:](page.cgi?id=fields.html#dependson "The bugs listed here must be resolved before this bug can be resolved.") |  | | [Blocks:](page.cgi?id=fields.html#blocked "This bug must be resolved before the bugs listed in this field can be resolved.") | [CVE-2021-42341](show_bug.cgi?id=818085 "IN_PROGRESS - <sys-apps/openrc-{0.43.5-r1,0.44.6-r1}: Buffer overflow in checkpath (CVE-2021-42341)") | |  | Show dependency [tree](showdependencytree.cgi?id=816900&hide_resolved=1) | |  | | Reported: | 2021-10-08 01:41 UTC by techno | | --- | --- | | Modified: | 2021-10-14 06:32 UTC ([History](show_activity.cgi?id=816900)) | | CC List: | 4 users (show)  gem patrick robbat2 sam | |  | | | [See Also:](page.cgi?id=fields.html#see_also "This allows you to refer to bugs in other installations. You can enter a URL to a bug in the 'Add Bug URLs' field to note that that bug is related to this one. You can enter multiple URLs at once by separating them with whitespace. You should normally use this field to refer to bugs in other installations. For bugs in this installation, it is better to use the Depends on and Blocks fields.") | * <https://github.com/OpenRC/openrc/issues/459> * [818049](show_bug.cgi?id=818049 "RESOLVED DUPLICATE - sys-apps/openrc-0.44.6: checkpath segfault: malloc(): invalid next size (unsorted)") * [818088](show_bug.cgi?id=818088 "RESOLVED FIXED - sys-apps/openrc-0.43.5-r1: stabilisation (fixes checkpath free() issue)") | | [Package list:](page.cgi?id=fields.html#cf_stabilisation_atoms "Contains a list of packages (and optionally, architectures) to keyword or stabilize. One fully qualified package per line, optionally followed by a space-delimited list of architectures for that package.") |  | | [Runtime testing required:](page.cgi?id=fields.html#cf_runtime_testing_required "Indicate what level of testing is required. For manual testing following instructions in the bug, choose \"Manual\". For only compile-testing, choose \"No\". For where tests must pass, choose \"Yes\".") | --- | |  | | |
| --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- | --- |
| --- | | |

| | Attachments | | | | --- | --- | --- | | [Add an attachment](attachment.cgi?bugid=816900&action=enter) (proposed patch, testcase, etc.) | | |   | Note You need to [log in](show_bug.cgi?id=816900&GoAheadAndLogIn=1) before you can comment on or make changes to this bug. | | --- | |  |
| --- | --- | --- | --- | --- | --- | --- | --- | --- |

| [Description](#c0)  techno    2021-10-08 01:41:51 UTC  ``` Portage 3.0.20 (python 3.9.6-final-0, default/linux/amd64/17.1/hardened/selinux, gcc-10.3.0, glibc-2.33-r7, 5.10.69-hardened1 x86_64) =================================================================                          System Settings ================================================================= System uname: Linux-5.10.69-hardened1-x86_64-Intel-R-_Xeon-R-_E-2276G_CPU_@_3.80GHz-with-glibc2.33 KiB Mem:    16248508 total,    348320 free KiB Swap:          0 total,         0 free Timestamp of repository gentoo: Thu, 07 Oct 2021 00:45:01 +0000 Timestamp of repository go-overlay: Mon, 27 Sep 2021 17:07:13 +0000 Head commit of repository go-overlay: f2750feebdd1ff576942cb8463675116b1abed78  Timestamp of repository monero: Sun, 19 Sep 2021 21:52:08 +0000 Head commit of repository monero: bd4ab930856ad9e022f08d24c7636d3d96c5331f  Head commit of repository sakaki-tools: 571e34870d665e98677caecbd56cf0d399ee4b3c  sh bash 5.1_p8 ld GNU ld (Gentoo 2.37_p1 p0) 2.37 app-shells/bash:          5.1_p8::gentoo dev-java/java-config:     2.3.1::gentoo dev-lang/perl:            5.34.0-r2::gentoo dev-lang/python:          3.8.12::gentoo, 3.9.6_p2::gentoo dev-lang/rust:            1.53.0::gentoo dev-util/cmake:           3.20.5::gentoo sys-apps/baselayout:      2.7::gentoo sys-apps/openrc:          0.43.5::gentoo sys-apps/sandbox:         2.24::gentoo sys-devel/autoconf:       2.69-r5::gentoo, 2.71-r1::gentoo sys-devel/automake:       1.16.4::gentoo sys-devel/binutils:       2.37_p1::gentoo sys-devel/gcc:            10.3.0-r2::gentoo sys-devel/gcc-config:     2.4::gentoo sys-devel/libtool:        2.4.6-r6::gentoo sys-devel/make:           4.3::gentoo sys-kernel/linux-headers: 5.10::gentoo (virtual/os-headers) sys-libs/glibc:           2.33-r7::gentoo Repositories:  gentoo     location: /var/db/repos/gentoo     sync-type: webrsync     sync-uri: rsync://rsync.gentoo.org/gentoo-portage     priority: -1000     sync-webrsync-verify-signature: yes  go-overlay     location: /var/db/repos/go-overlay     sync-type: git     sync-uri: <https://github.com/gentoo-mirror/go-overlay.git>     masters: gentoo  monero     location: /var/db/repos/monero     sync-type: git     sync-uri: <https://github.com/gentoo-mirror/monero.git>     masters: gentoo  bitcoin     location: /var/lib/layman/bitcoin     sync-type: laymansync     sync-uri: <https://gitlab.com/bitcoin/gentoo.git>     masters: gentoo     priority: 50  sakaki-tools     location: /var/db/repos/sakaki-tools     sync-type: git     sync-uri: <https://github.com/sakaki-/sakaki-tools.git>     masters: gentoo     priority: 50  ACCEPT_KEYWORDS="amd64" ACCEPT_LICENSE="@FREE" CBUILD="x86_64-pc-linux-gnu" CFLAGS="-march=native -O2 -pipe -falign-functions=32" CHOST="x86_64-pc-linux-gnu" CONFIG_PROTECT="/etc /usr/share/easy-rsa /usr/share/gnupg/qualified.txt /usr/share/maven-bin-3.8/conf /var/lib/i2pd/certificates" CONFIG_PROTECT_MASK="/etc/ca-certificates.conf /etc/env.d /etc/fonts/fonts.conf /etc/gconf /etc/gentoo-release /etc/php/apache2-php7.4/ext-active/ /etc/php/apache2-php8.0/ext-active/ /etc/php/cgi-php7.4/ext-active/ /etc/php/cgi-php8.0/ext-active/ /etc/php/cli-php7.4/ext-active/ /etc/php/cli-php8.0/ext-active/ /etc/revdep-rebuild /etc/sandbox.d /etc/terminfo" CXXFLAGS="-march=native -O2 -pipe -falign-functions=32" DISTDIR="/var/cache/distfiles" EMERGE_DEFAULT_OPTS="--jobs=13 --load-average=12" ENV_UNSET="CARGO_HOME DBUS_SESSION_BUS_ADDRESS DISPLAY GOBIN GOPATH PERL5LIB PERL5OPT PERLPREFIX PERL_CORE PERL_MB_OPT PERL_MM_OPT XAUTHORITY XDG_CACHE_HOME XDG_CONFIG_HOME XDG_DATA_HOME XDG_RUNTIME_DIR" FCFLAGS="-march=native -O2 -pipe -falign-functions=32" FEATURES="assume-digests binpkg-docompress binpkg-dostrip binpkg-logs config-protect-if-modified distlocks ebuild-locks fixlafiles ipc-sandbox merge-sync multilib-strict network-sandbox news nostrip parallel-fetch preserve-libs protect-owned qa-unresolved-soname-deps sandbox selinux sesandbox sfperms strict unknown-features-warn unmerge-logs unmerge-orphans userfetch userpriv usersandbox usersync xattr" FFLAGS="-march=native -O2 -pipe -falign-functions=32" GENTOO_MIRRORS="<https://gentoo.osuosl.org/> <https://mirrors.rit.edu/gentoo/>" LANG="en_US.utf8" LDFLAGS="-Wl,-O1 -Wl,--as-needed" MAKEOPTS="-j13 -l12" PKGDIR="/var/cache/binpkgs" PORTAGE_CONFIGROOT="/" PORTAGE_RSYNC_OPTS="--recursive --links --safe-links --perms --times --omit-dir-times --compress --force --whole-file --delete --stats --human-readable --timeout=180 --exclude=/distfiles --exclude=/local --exclude=/packages --exclude=/.git" PORTAGE_TMPDIR="/var/tmp" USE="acl amd64 audit btrfs bzip2 caps crypt hardened http2 iconv idn ipv6 jpeg libglvnd libtirpc multilib ncurses nls nptl openmp pam pcre pie png postgres python readline seccomp selinux socks5 split-usr ssl ssp tiff unicode webp xattr xtpax zlib zstd" ABI_X86="64" ADA_TARGET="gnat_2019" ALSA_CARDS="ali5451 als4000 atiixp atiixp-modem bt87x ca0106 cmipci emu10k1x ens1370 ens1371 es1938 es1968 fm801 hda-intel intel8x0 intel8x0m maestro3 trident usb-audio via82xx via82xx-modem ymfpci" APACHE2_MODULES="authn_core authz_core socache_shmcb unixd actions alias auth_basic authn_alias authn_anon authn_dbm authn_default authn_file authz_dbm authz_default authz_groupfile authz_host authz_owner authz_user autoindex cache cgi cgid dav dav_fs dav_lock deflate dir disk_cache env expires ext_filter file_cache filter headers include info log_config logio mem_cache mime mime_magic negotiation rewrite setenvif speling status unique_id userdir usertrack vhost_alias" CALLIGRA_FEATURES="karbon sheets words" COLLECTD_PLUGINS="df interface irq load memory rrdtool swap syslog" CPU_FLAGS_X86="aes avx avx2 f16c fma3 mmx mmxext pclmul popcnt sse sse2 sse3 sse4_1 sse4_2 ssse3" ELIBC="glibc" GPSD_PROTOCOLS="ashtech aivdm earthmate evermore fv18 garmin garmintxt gpsclock greis isync itrax mtk3301 nmea ntrip navcom oceanserver oldstyle oncore rtcm104v2 rtcm104v3 sirf skytraq superstar2 timing tsip tripmate tnt ublox ubx" GRUB_PLATFORMS="efi-64" INPUT_DEVICES="libinput" KERNEL="linux" L10N="en" LCD_DEVICES="bayrad cfontz cfontz633 glk hd44780 lb216 lcdm001 mtxorb ncurses text" LIBREOFFICE_EXTENSIONS="presenter-console presenter-minimizer" LUA_SINGLE_TARGET="lua5-1" LUA_TARGETS="lua5-1 lua5-4 luajit" NGINX_MODULES_STREAM="access geoip2 realip javascript ssl_preread upstream_zone return map" OFFICE_IMPLEMENTATION="libreoffice" PHP_TARGETS="php7-3 php7-4" POSTGRES_TARGETS="postgres12 postgres13" PYTHON_SINGLE_TARGET="python3_9" PYTHON_TARGETS="python3_8 python3_9" RUBY_TARGETS="ruby26" USERLAND="GNU" VIDEO_CARDS="intel i965" XTABLES_ADDONS="quota2 psd pknock lscan length2 ipv4options ipset ipp2p iface geoip fuzzy condition tee tarpit sysrq proto steal rawnat logmark ipmark dhcpmac delude chaos account" Unset:  CC, CPPFLAGS, CTARGET, CXX, INSTALL_MASK, LC_ALL, LINGUAS, PORTAGE_BINHOST, PORTAGE_BUNZIP2_COMMAND, PORTAGE_COMPRESS, PORTAGE_COMPRESS_FLAGS, PORTAGE_RSYNC_EXTRA_OPTS, RUSTFLAGS  =================================================================                         Package Settings =================================================================  www-apps/grafana-bin-8.1.5::gentoo was built with the following: USE="" ABI_X86="(64)"   # /etc/init.d/grafana -v -d start [snip] ++ command -v start_pre + '[' start_pre = start_pre ']' + start_pre + checkpath -d -o grafana:grafana -m750 /var/lib/grafana + checkpath -d -o grafana:grafana -m750 /var/lib/grafana/dashboards + checkpath -d -o grafana:grafana -m750 /var/lib/grafana/plugins free(): invalid pointer /etc/init.d/grafana: line 32: 43373 Aborted                 checkpath -d -o "${GRAFANA_USER}:${GRAFANA_GROUP}" -m750 "${GRAFANA_DATADIR}/plugins" + return 1 + exit 1  * ERROR: grafana failed to start  # go version go version go1.17.1 linux/amd64  grafana.ini http_addr = 127.0.0.1 http_port = 3001 domain = dash.domain.tld root_url = %(protocol)s://%(domain)s:%(http_port)s/grafana serve_from_sub_path = true router_logging = true ssl_mode = require url = postgres://grafana:password@127.0.0.1:5432/grafana   I can start it manually   # sudo -u grafana grafana-server -config=/etc/grafana/grafana.ini -homepath=/usr/share/grafana cfg:default.paths.data=/var/lib/grafana cfg:default.paths.logs=/var/log/grafana INFO[10-07|20:50:17] Starting Grafana                         logger=server version=8.1.5 commit=c725a4259a branch=HEAD compiled=2021-09-21T04:54:08-0400 ```  [Comment 1](#c1)  Gary E. Miller    2021-10-08 02:27:36 UTC  ``` I've had this problem for months!  If I had only waited another day... ```  [Comment 2](#c2)  Robin Johnson   archtester Gentoo Infrastructure gentoo-dev Security  2021-10-14 05:07:45 UTC  ``` *** [Bug 818049](show_bug.cgi?id=818049 "RESOLVED DUPLICATE - sys-apps/openrc-0.44.6: checkpath segfault: malloc(): invalid next size (unsorted)") has been marked as a duplicate of this bug. *** ```  [Comment 3](#c3)  Larry the Git Cow   gentoo-dev  2021-10-14 05:32:12 UTC  ``` The bug has been closed via the following commit(s):  <https://gitweb.gentoo.org/repo/gentoo.git/commit/?id=c6e45be273accf314fb925d977597adde67ba825>  commit c6e45be273accf314fb925d977597adde67ba825 Author:     William Hubbs <williamh@gentoo.org> AuthorDate: 2021-10-14 05:31:29 +0000 Commit:     William Hubbs <williamh@gentoo.org> CommitDate: 2021-10-14 05:32:00 +0000      sys-apps/openrc:  0.44.6-r1 bump          Closes: <https://bugs.gentoo.org/816900>     Package-Manager: Portage-3.0.20, Repoman-3.0.3     Signed-off-by: William Hubbs <williamh@gentoo.org>   .../openrc/files/openrc-0.44.6-fix-checkpath.patch |  33 ++++  sys-apps/openrc/openrc-0.44.6-r1.ebuild            | 168 +++++++++++++++++++++  2 files changed, 201 insertions(+) ``` |  |
| --- | --- |

---

* [Format For Printing](show_bug.cgi?format=multiple&id=816900)
* -¬†[XML](show_bug.cgi?ctype=xml&id=816900)
* -¬†[Clone This Bug](enter_bug.cgi?cloned_bug_id=816900)
* -¬†[Clone In The Same
  Product](enter_bug.cgi?cloned_bug_id=816900&product=Gentoo%20Linux)
* -¬†Top of page

* + [Home](./)
  + | [New](enter_bug.cgi?format=guided)‚Äì[[Ex]](enter_bug.cgi)
  + | [Browse](describecomponents.cgi)
  + | [Search](query.cgi)
  + | [Privacy Policy](https://wiki.gentoo.org/wiki/Foundation%3APrivacy_Policy)
  + |

    [[?]](page.cgi?id=quicksearch.html "Quicksearch Help")
  + | [Reports](report.cgi)
  + |
    [Requests](request.cgi)
  + |
    [Help](https://bugzilla.readthedocs.org/en/5.0/using/understanding.html)
  + |
    [New¬†Account](createaccount.cgi)
  + |
    [Log In](show_bug.cgi?id=816900&GoAheadAndLogIn=1)

    [x]
  + |
    [Forgot Password](show_bug.cgi?id=816900&GoAheadAndLogIn=1#forgot)
    Login:

    [x]



=== Content from github.com_0f74e2d2_20250108_144103.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fissues_fragments%2Fissue_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# checkpath -- free(): invalid pointer #459

Closed

[garyemiller](/garyemiller) opened this issue
Oct 8, 2021
¬∑ 2 comments

Closed

# [checkpath -- free(): invalid pointer](#top) #459

[garyemiller](/garyemiller) opened this issue
Oct 8, 2021
¬∑ 2 comments

## Comments

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=80&v=4)](/garyemiller)

Copy link

### **[garyemiller](/garyemiller)** commented [Oct 8, 2021](#issue-1020593989)

| I am a long time Gentoo user. I run Gentoo stable and unstable on a wide range of machines.  On just one, a Gentoo unstable, running on a znver2 CPU, I get this error:  ``` # /lib/rc/bin/checkpath -d /tmp/tmp free(): invalid pointer Aborted  ```  This has persisted for months. I have done "emerge -e world" many times, with various -mtune, -march, etc. and nothing affects the result.  So I did a "git pull, and looked at src/rc/checkpath.c. Then make this one change:  ``` diff --git a/src/rc/checkpath.c b/src/rc/checkpath.c index bab22692..df93d7d3 100644 --- a/src/rc/checkpath.c +++ b/src/rc/checkpath.c @@ -151,7 +151,8 @@ static char *clean_path(char *path)         char *ch;         char *ch2;         char *str; -       str = xmalloc(strlen(path)); +       str = xmalloc(strlen(path) + 1);         ch = path;         ch2 = str;         while (true) {  ```  The problem goes away. Looks like xmalloc() is just a wrapper on malloc().  According to "man strlen"  ```        The strlen() function calculates the length of the string pointed to by        s, excluding the terminating null byte ('\0').  ```  Looks to me like "str" is not big enough to hold "path" incuding its trailikng '\0'  No idea how that makes "free(path);" fail. But I'm glad it does.  . |
| --- |
| The text was updated successfully, but these errors were encountered: |

All reactions

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=80&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

Copy link

Contributor

### **[thesamesam](/thesamesam)** commented [Oct 8, 2021](#issuecomment-938286778)

| ... I was just about to look into this because I saw [this](https://bugs.gentoo.org/816900) bug.  Thank you for doing the work! |
| --- |

All reactions

Sorry, something went wrong.

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=80&v=4)](/garyemiller)

Copy link

Author

### **[garyemiller](/garyemiller)** commented [Oct 8, 2021](#issuecomment-938288515)

| Geez, I only had to wait one more day for someone else to do it... |
| --- |

 üòÑ
1
 thesamesam reacted with laugh emoji

All reactions

* üòÑ
  1 reaction

Sorry, something went wrong.

[thesamesam](/thesamesam)
added a commit
to thesamesam/openrc
that referenced
this issue
[Oct 8, 2021](#ref-commit-89ec8a8)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

`[checkpath: fix allocation size of string buffer](/thesamesam/openrc/commit/89ec8a86d6f87244f9559b35244a28401d906e14 "checkpath: fix allocation size of string buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: #459
Reported-by: Gary E. Miller
X-Gentoo-Bug: https://bugs.gentoo.org/816900
Signed-off-by: Sam James <sam@gentoo.org>")`
‚Ä¶

`[89ec8a8](/thesamesam/openrc/commit/89ec8a86d6f87244f9559b35244a28401d906e14)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: [OpenRC#459](https://github.com/OpenRC/openrc/issues/459)
Reported-by: Gary E. Miller
X-Gentoo-Bug: <https://bugs.gentoo.org/816900>
Signed-off-by: Sam James <sam@gentoo.org>
```

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)
[thesamesam](/thesamesam)
mentioned this issue
[Oct 8, 2021](#ref-pullrequest-1020669654)

[checkpath: fix allocation size of string buffer
#462](/OpenRC/openrc/pull/462)
 Closed

[thesamesam](/thesamesam)
added a commit
to thesamesam/openrc
that referenced
this issue
[Oct 8, 2021](#ref-commit-14360b3)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)

`[checkpath: fix allocation size of path buffer](/thesamesam/openrc/commit/14360b36da52accb63326f8e15705e9531e8af0f "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: #459
Reported-by: Gary E. Miller
X-Gentoo-Bug: https://bugs.gentoo.org/816900
Signed-off-by: Sam James <sam@gentoo.org>")`
‚Ä¶

`[14360b3](/thesamesam/openrc/commit/14360b36da52accb63326f8e15705e9531e8af0f)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: [OpenRC#459](https://github.com/OpenRC/openrc/issues/459)
Reported-by: Gary E. Miller
X-Gentoo-Bug: <https://bugs.gentoo.org/816900>
Signed-off-by: Sam James <sam@gentoo.org>
```

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)
[williamh](/williamh)
closed this as [completed](/OpenRC/openrc/issues?q=is%3Aissue+is%3Aclosed+archived%3Afalse+reason%3Acompleted)
in
`[bb83341](/OpenRC/openrc/commit/bb8334104baf4d5a4a442a8647fb9204738f2204)`
[Oct 8, 2021](#event-5432248685)

[williamh](/williamh)
pushed a commit
that referenced
this issue
[Oct 8, 2021](#ref-commit-cc45b55)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam) [![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

`[checkpath: fix allocation size of path buffer](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7 "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: https://bugs.gentoo.org/816900
Fixes: #459
Fixes: #462")`
‚Ä¶

`[cc45b55](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: <https://bugs.gentoo.org/816900>
Fixes: [#459](https://github.com/OpenRC/openrc/issues/459)
Fixes: [#462](https://github.com/OpenRC/openrc/pull/462)
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fissues%2F459)

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging a pull request may close this issue.

 [checkpath: fix allocation size of string buffer](/OpenRC/openrc/pull/462)
 [thesamesam/openrc](/thesamesam/openrc)

2 participants

[![@garyemiller](https://avatars.githubusercontent.com/u/1270340?s=52&v=4)](/garyemiller) [![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=52&v=4)](/thesamesam)

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_24874a5e_20250108_144101.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2F63db2d99e730547339d1bdd28e8437999c380cae)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2F63db2d99e730547339d1bdd28e8437999c380cae)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

## Commit

[Permalink](/OpenRC/openrc/commit/63db2d99e730547339d1bdd28e8437999c380cae)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

checkpath: remove extra slashes from paths

[Browse files](/OpenRC/openrc/tree/63db2d99e730547339d1bdd28e8437999c380cae)
Browse the repository at this point in the history

```
This fixes [#418](https://github.com/OpenRC/openrc/issues/418).
```

* Loading branch information

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

[williamh](/OpenRC/openrc/commits?author=williamh "View all commits by williamh")
committed
Apr 13, 2021

1 parent
[8400e7d](/OpenRC/openrc/commit/8400e7d3025a2957960e3f4ee3cb37a376235886)

commit 63db2d9

Showing
**1 changed file**
with
**39 additions**
and
**10 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

49 changes: 39 additions & 10 deletions

49
[src/rc/checkpath.c](#diff-1362380b076ae1f2d89bdc6227fe5076d33488e5199f17b5b99d6b591e6fc6fc "src/rc/checkpath.c")

Show comments

[View file](/OpenRC/openrc/blob/63db2d99e730547339d1bdd28e8437999c380cae/src/rc/checkpath.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -93,13 +93,13 @@ static int get\_dirfd(char \*path, bool symlinks) |
|  |  | if (dirfd == -1) |
|  |  | eerrorx("%s: unable to open the root directory: %s", |
|  |  | applet, strerror(errno)); |
|  |  | path\_dupe = xstrdup(path); |
|  |  | ch = path\_dupe; |
|  |  | ch = path; |
|  |  | while (\*ch) { |
|  |  | if (\*ch == '/') |
|  |  | components++; |
|  |  | ch++; |
|  |  | } |
|  |  | path\_dupe = xstrdup(path); |
|  |  | item = strtok(path\_dupe, "/"); |
|  |  | #ifdef O\_PATH |
|  |  | flags |= O\_PATH; |
| Expand Down  Expand Up | | @@ -136,18 +136,44 @@ static int get\_dirfd(char \*path, bool symlinks) |
|  |  | dirfd = new\_dirfd; |
|  |  | free(linkpath); |
|  |  | linkpath = NULL; |
|  |  | item = strtok(NULL, "/"); |
|  |  | components--; |
|  |  | } |
|  |  | item = strtok(NULL, "/"); |
|  |  | components--; |
|  |  | } |
|  |  | free(path\_dupe); |
|  |  | if (linkpath) { |
|  |  | free(linkpath); |
|  |  | linkpath = NULL; |
|  |  | } |
|  |  | free(linkpath); |
|  |  | return dirfd; |
|  |  | } |
|  |  |  |
|  |  | static char \*clean\_path(char \*path) |
|  |  | { |
|  |  | char \*ch; |
|  |  | char \*ch2; |
|  |  | char \*str; |
|  |  | str = xmalloc(strlen(path)); |
|  |  | ch = path; |
|  |  | ch2 = str; |
|  |  | while (true) { |
|  |  | \*ch2 = \*ch; |
|  |  | ch++; |
|  |  | ch2++; |
|  |  | if (!\*(ch-1)) |
|  |  | break; |
|  |  | while (\*(ch - 1) == '/' && \*ch == '/') |
|  |  | ch++; |
|  |  | } |
|  |  | /\* get rid of trailing / characters \*/ |
|  |  | while ((ch = strrchr(str, '/'))) { |
|  |  | if (ch == str) |
|  |  | break; |
|  |  | if (!\*(ch+1)) |
|  |  | \*ch = 0; |
|  |  | else |
|  |  | break; |
|  |  | } |
|  |  | return str; |
|  |  | } |
|  |  |  |
|  |  | static int do\_check(char \*path, uid\_t uid, gid\_t gid, mode\_t mode, |
|  |  | inode\_t type, bool trunc, bool chowner, bool symlinks, bool selinux\_on) |
|  |  | { |
| Expand Down  Expand Up | | @@ -345,6 +371,7 @@ int main(int argc, char \*\*argv) |
|  |  | bool symlinks = false; |
|  |  | bool writable = false; |
|  |  | bool selinux\_on = false; |
|  |  | char \*path = NULL; |
|  |  |  |
|  |  | applet = basename\_c(argv[0]); |
|  |  | while ((opt = getopt\_long(argc, argv, getoptstring, |
| Expand Down  Expand Up | | @@ -407,12 +434,14 @@ int main(int argc, char \*\*argv) |
|  |  | selinux\_on = true; |
|  |  |  |
|  |  | while (optind < argc) { |
|  |  | path = clean\_path(argv[optind]); |
|  |  | if (writable) |
|  |  | exit(!is\_writable(argv[optind])); |
|  |  | if (do\_check(argv[optind], uid, gid, mode, type, trunc, chowner, |
|  |  | exit(!is\_writable(path)); |
|  |  | if (do\_check(path, uid, gid, mode, type, trunc, chowner, |
|  |  | symlinks, selinux\_on)) |
|  |  | retval = EXIT\_FAILURE; |
|  |  | optind++; |
|  |  | free(path); |
|  |  | } |
|  |  |  |
|  |  | if (selinux\_on) |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `63db2d9`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fcommit%2F63db2d99e730547339d1bdd28e8437999c380cae) to comment.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.



=== Content from github.com_6ebad6ec_20250108_144104.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fpull%2F462)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fpull%2F462)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=OpenRC%2Fopenrc)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[OpenRC](/OpenRC)
/
**[openrc](/OpenRC/openrc)**
Public

* [Notifications](/login?return_to=%2FOpenRC%2Fopenrc) You must be signed in to change notification settings
* [Fork
  248](/login?return_to=%2FOpenRC%2Fopenrc)
* [Star
   1.5k](/login?return_to=%2FOpenRC%2Fopenrc)

* [Code](/OpenRC/openrc)
* [Issues
  113](/OpenRC/openrc/issues)
* [Pull requests
  44](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

Additional navigation options

* [Code](/OpenRC/openrc)
* [Issues](/OpenRC/openrc/issues)
* [Pull requests](/OpenRC/openrc/pulls)
* [Discussions](/OpenRC/openrc/discussions)
* [Actions](/OpenRC/openrc/actions)
* [Security](/OpenRC/openrc/security)
* [Insights](/OpenRC/openrc/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)

By clicking ‚ÄúSign up for GitHub‚Äù, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We‚Äôll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2FOpenRC%2Fopenrc%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# checkpath: fix allocation size of string buffer #462

 Closed

[thesamesam](/thesamesam)
wants to merge
1
commit into
[OpenRC:master](/OpenRC/openrc/tree/master "OpenRC/openrc:master")
from
[thesamesam:checkpath-malloc](/thesamesam/openrc/tree/checkpath-malloc "thesamesam/openrc:checkpath-malloc")

 Closed

# [checkpath: fix allocation size of string buffer](#top) #462

[thesamesam](/thesamesam)
wants to merge
1
commit into
[OpenRC:master](/OpenRC/openrc/tree/master "OpenRC/openrc:master")
from
[thesamesam:checkpath-malloc](/thesamesam/openrc/tree/checkpath-malloc "thesamesam/openrc:checkpath-malloc")

[Conversation
0](/OpenRC/openrc/pull/462)
[Commits
1](/OpenRC/openrc/pull/462/commits)
[Checks
0](/OpenRC/openrc/pull/462/checks)
[Files changed](/OpenRC/openrc/pull/462/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![thesamesam](https://avatars.githubusercontent.com/u/11667869?s=60&v=4)](/thesamesam)

Copy link

Contributor

### @thesamesam **[thesamesam](/thesamesam)** commented [Oct 8, 2021](#issue-1020669654)

strlen's return value isn't enough to be used

directly for (x)malloc; it doesn't include

the null byte at the end of the string.

Fixes: [#459](https://github.com/OpenRC/openrc/issues/459)

Reported-by: Gary E. Miller

X-Gentoo-Bug: <https://bugs.gentoo.org/816900>

Signed-off-by: Sam James sam@gentoo.org

Sorry, something went wrong.

All reactions

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&v=4)](/thesamesam)

`[checkpath: fix allocation size of path buffer](/OpenRC/openrc/pull/462/commits/14360b36da52accb63326f8e15705e9531e8af0f "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: #459
Reported-by: Gary E. Miller
X-Gentoo-Bug: https://bugs.gentoo.org/816900
Signed-off-by: Sam James <sam@gentoo.org>")`
 ‚Ä¶

`[14360b3](/OpenRC/openrc/pull/462/commits/14360b36da52accb63326f8e15705e9531e8af0f)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

Fixes: [OpenRC#459](https://github.com/OpenRC/openrc/issues/459)
Reported-by: Gary E. Miller
X-Gentoo-Bug: <https://bugs.gentoo.org/816900>
Signed-off-by: Sam James <sam@gentoo.org>
```

 [![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam)
[thesamesam](/thesamesam)
[force-pushed](/OpenRC/openrc/compare/89ec8a86d6f87244f9559b35244a28401d906e14..14360b36da52accb63326f8e15705e9531e8af0f)
the
checkpath-malloc

branch
from
[`89ec8a8`](/OpenRC/openrc/commit/89ec8a86d6f87244f9559b35244a28401d906e14) to
[`14360b3`](/OpenRC/openrc/commit/14360b36da52accb63326f8e15705e9531e8af0f)  [Compare](/OpenRC/openrc/compare/89ec8a86d6f87244f9559b35244a28401d906e14..14360b36da52accb63326f8e15705e9531e8af0f)
[October 8, 2021 03:54](#event-5432177898)

[![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)
[williamh](/williamh)
closed this
in
`[bb83341](/OpenRC/openrc/commit/bb8334104baf4d5a4a442a8647fb9204738f2204)`
[Oct 8, 2021](#event-5432248699)

[williamh](/williamh)
pushed a commit
that referenced
this pull request
[Oct 8, 2021](#ref-commit-cc45b55)
[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=40&u=f2fd8b8e54abb2f4cb97222f8c4762ae076e3847&v=4)](/thesamesam) [![@williamh](https://avatars.githubusercontent.com/u/64355?s=40&v=4)](/williamh)

`[checkpath: fix allocation size of path buffer](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7 "checkpath: fix allocation size of path buffer

strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: https://bugs.gentoo.org/816900
Fixes: #459
Fixes: #462")`
‚Ä¶

`[cc45b55](/OpenRC/openrc/commit/cc45b55f895d0c21b5ac3e5a65b0bf00f76adeb7)`

```
strlen's return value isn't enough to be used
directly for (x)malloc; it doesn't include
the null byte at the end of the string.

X-Gentoo-Bug: 816900
X-Gentoo-Bug-URL: <https://bugs.gentoo.org/816900>
Fixes: [#459](https://github.com/OpenRC/openrc/issues/459)
Fixes: [#462](https://github.com/OpenRC/openrc/pull/462)
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2FOpenRC%2Fopenrc%2Fpull%2F462)

Reviewers

No reviews

Assignees

No one assigned

Labels

None yet

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

 [checkpath -- free(): invalid pointer](https://github.com/OpenRC/openrc/issues/459)

1 participant

[![@thesamesam](https://avatars.githubusercontent.com/u/11667869?s=52&v=4)](/thesamesam)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

¬© 2025 GitHub,¬†Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can‚Äôt perform that action at this time.


