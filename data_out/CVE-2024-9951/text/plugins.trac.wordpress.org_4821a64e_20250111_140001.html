

[Skip to content](#main)

[WordPress.org](https://wordpress.org/)

* [News](https://wordpress.org/news/)
* [Download & Extend](https://wordpress.org/download/)
  + [Get WordPress](https://wordpress.org/download/)
  + [Themes](https://wordpress.org/themes/)
  + [Patterns](https://wordpress.org/patterns/)
  + [Plugins](https://wordpress.org/plugins/)
  + [Mobile](https://wordpress.org/mobile/)
  + [Hosting](https://wordpress.org/hosting/)
  + [Openverse ↗︎](https://openverse.org/)
* [Learn](https://learn.wordpress.org/)
  + [Learn WordPress](https://learn.wordpress.org/)
  + [Documentation](https://wordpress.org/documentation/)
  + [Forums](https://wordpress.org/support/forums/)
  + [Developers](https://developer.wordpress.org/)
  + [WordPress.tv ↗︎](https://wordpress.tv/)
* [Community](https://make.wordpress.org/)
  + [Make WordPress](https://make.wordpress.org/)
  + [Photo Directory](https://wordpress.org/photos/)
  + [Five for the Future](https://wordpress.org/five-for-the-future/)
  + [WordCamp ↗︎](https://central.wordcamp.org/)
  + [Meetups ↗︎](https://www.meetup.com/pro/wordpress/)
  + [Job Board ↗︎](https://jobs.wordpress.net/)
* [About](https://wordpress.org/about/)
  + [About WordPress](https://wordpress.org/about/)
  + [Showcase](https://wordpress.org/showcase/)
  + [Enterprise](https://wordpress.org/enterprise/)
  + [Gutenberg ↗︎](https://wordpress.org/gutenberg/)
  + [WordPress Swag Store ↗︎](https://mercantile.wordpress.org/)
* [Get WordPress](https://wordpress.org/download/)

Search Trac

[Get WordPress](https://wordpress.org/download/)

## [Plugin Directory](//wordpress.org/plugins/)

Search:

* [Login](https://login.wordpress.org/?redirect_to=http%3A%2F%2Fplugins.trac.wordpress.org%2Fchangeset%3Fnew%3D3170202%2540wp-photo-album-plus%26old%3D3170202%2540wp-photo-album-plus)

* [Timeline](/timeline)
* [View Tickets](/report)
* [Browse Source](/browser)

## Context Navigation

* ← [Previous Change](/changeset/3167614/wp-photo-album-plus "Changeset 3167614 for wp-photo-album-plus")
* [Next Change](/changeset/3170203/wp-photo-album-plus "Changeset 3170203 for wp-photo-album-plus") →

---

# Changeset [3170202](/changeset/3170202 "Show full changeset") for [wp-photo-album-plus](/browser/wp-photo-album-plus?rev=3170202 "Show entry in browser")

View differences
inline
side by side

Show
lines around each change

Show the changes in full context

Ignore:

Blank lines

Case changes

White space changes

Timestamp:
10/16/2024 03:02:25 PM
([3 months](/timeline?from=2024-10-16T15%3A02%3A25Z&precision=second "See timeline at 10/16/2024 03:02:25 PM") ago)

Author:
opajaap
Message:

8.8.07.004

Location:
[wp-photo-album-plus/trunk](/browser/wp-photo-album-plus/trunk?rev=3170202)
Files:

6 edited

* [wppa-input.php](/browser/wp-photo-album-plus/trunk/wppa-input.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file0 "Show differences"))
* [wppa-settings-autosave.php](/browser/wp-photo-album-plus/trunk/wppa-settings-autosave.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file1 "Show differences"))
* [wppa-stereo-widget.php](/browser/wp-photo-album-plus/trunk/wppa-stereo-widget.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file2 "Show differences"))
* [wppa-utils.php](/browser/wp-photo-album-plus/trunk/wppa-utils.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file3 "Show differences"))
* [wppa-wpdb-insert.php](/browser/wp-photo-album-plus/trunk/wppa-wpdb-insert.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file4 "Show differences"))
* [wppa.php](/browser/wp-photo-album-plus/trunk/wppa.php?rev=3170202 "Show entry in browser")
  (modified)
  ([2 diffs](#file5 "Show differences"))

### Legend:

Unmodified
Added
Removed

* ## [wp-photo-album-plus/trunk/wppa-input.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa-input.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa-input.php")

  | [r3149933](/browser/wp-photo-album-plus/trunk/wppa-input.php?rev=3149933#L4 "Show revision 3149933 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa-input.php?rev=3170202#L4 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* |
  | 5 | 5 | \* Contains functions for sanitizing and formatting user input |
  | 6 |  | \* Version: 8.8.0~~5.003~~ |
  |  | 6 | \* Version: 8.8.07.004 |
  | 7 | 7 | \* |
  | 8 | 8 | \*/ |
  | […](/browser/wp-photo-album-plus/trunk/wppa-input.php?rev=3149933#L233) | […](/browser/wp-photo-album-plus/trunk/wppa-input.php?rev=3170202#L233) |  |
  | 233 | 233 |  |
  | 234 | 234 | default: |
  | 235 |  | $result = '~~raw~~'; |
  |  | 235 | $result = 'text'; |
  | 236 | 236 | break; |
  | 237 | 237 | } |
* ## [wp-photo-album-plus/trunk/wppa-settings-autosave.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa-settings-autosave.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa-settings-autosave.php")

  | [r3153413](/browser/wp-photo-album-plus/trunk/wppa-settings-autosave.php?rev=3153413#L4 "Show revision 3153413 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa-settings-autosave.php?rev=3170202#L4 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* |
  | 5 | 5 | \* manage all options |
  | 6 |  | \* Version: 8.8.0~~6.005~~ |
  |  | 6 | \* Version: 8.8.07.004 |
  | 7 | 7 | \* |
  | 8 | 8 | \*/ |
  | […](/browser/wp-photo-album-plus/trunk/wppa-settings-autosave.php?rev=3153413#L488) | […](/browser/wp-photo-album-plus/trunk/wppa-settings-autosave.php?rev=3170202#L488) |  |
  | 488 | 488 |  |
  | 489 | 489 | // Any tab set? else default general |
  | 490 |  | $tab = wppa\_get( 'tab', 'general' ); |
  | 491 |  | $subtab = wppa\_get( 'subtab', '0' ); |
  |  | 490 | $tab = wppa\_get( 'tab', 'general', 'text' ); |
  |  | 491 | if ( ! isset( $wppa\_tab\_names[$tab] ) ) { |
  |  | 492 | $tab = 'general'; |
  |  | 493 | } |
  |  | 494 | $subtab = wppa\_get( 'subtab', '0', 'int' ); |
  | 492 | 495 |  |
  | 493 | 496 | // Get the linkpages dependant of tab (if we need them) |
* ## [wp-photo-album-plus/trunk/wppa-stereo-widget.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa-stereo-widget.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa-stereo-widget.php")

  | [r3086532](/browser/wp-photo-album-plus/trunk/wppa-stereo-widget.php?rev=3086532#L4 "Show revision 3086532 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa-stereo-widget.php?rev=3170202#L4 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* |
  | 5 | 5 | \* display the top rated photos |
  | 6 |  | \* Version: 8.~~7.03.006~~ |
  |  | 6 | \* Version: 8.8.07.004 |
  | 7 | 7 | \*/ |
  | 8 | 8 |  |
  | […](/browser/wp-photo-album-plus/trunk/wppa-stereo-widget.php?rev=3086532#L79) | […](/browser/wp-photo-album-plus/trunk/wppa-stereo-widget.php?rev=3170202#L79) |  |
  | 79 | 79 | function get\_defaults() { |
  | 80 | 80 |  |
  | 81 |  | $defaults = array(  'title'     => \_\_( 'Stereo Photo Settings', 'wp-photo-album-plus' ), |
  |  | 81 | $defaults = array(  'title'     => \_\_( 'Stereo Photo Settings', 'wp-photo-album-plus' ), |
  | 82 | 82 | 'logonly'   => 'no', |
  | 83 | 83 | ); |
* ## [wp-photo-album-plus/trunk/wppa-utils.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa-utils.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa-utils.php")

  | [r3150187](/browser/wp-photo-album-plus/trunk/wppa-utils.php?rev=3150187#L4 "Show revision 3150187 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa-utils.php?rev=3170202#L4 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* |
  | 5 | 5 | \* Contains low-level utility routines |
  | 6 |  | \* Version: 8.8.0~~5.003~~ |
  |  | 6 | \* Version: 8.8.07.004 |
  | 7 | 7 | \* |
  | 8 | 8 | \*/ |
  | […](/browser/wp-photo-album-plus/trunk/wppa-utils.php?rev=3150187#L5989) | […](/browser/wp-photo-album-plus/trunk/wppa-utils.php?rev=3170202#L5989) |  |
  | 5989 | 5989 | } |
  | 5990 | 5990 |  |
  | 5991 |  |  |
  |  | 5991 | // Fix sequence numnbers after adding an Item |
  |  | 5992 | // Works only when sequence order is set to order# or order# desc |
  |  | 5993 | // @1: text 'album' or 'media' |
  |  | 5994 | // @2: int id of the just added item |
  |  | 5995 | function wppa\_fix\_seq\_nums( $what, $last ) { |
  |  | 5996 | global $wpdb; |
  |  | 5997 |  |
  |  | 5998 | // Sanitize input |
  |  | 5999 | if ( $what !== 'album' && $what !== 'media' ) { |
  |  | 6000 | wppa\_log( 'err', 'Inbvalid arg 1 in wppa\_fix\_seq\_nums(): ' . sanitize\_text\_field( $what ) ); |
  |  | 6001 | return; |
  |  | 6002 | } |
  |  | 6003 | if ( ! wppa\_is\_posint( $last ) ) { |
  |  | 6004 | wppa\_log( 'err', 'Inbvalid arg 2 in wppa\_fix\_seq\_nums(): ' . sanitize\_text\_field( $last ) ); |
  |  | 6005 | return; |
  |  | 6006 | } |
  |  | 6007 |  |
  |  | 6008 | // Do the album |
  |  | 6009 | if ( $what == 'album' ) { |
  |  | 6010 |  |
  |  | 6011 | // Get the album info |
  |  | 6012 | $parent = wppa\_get\_album\_item( $last, 'a\_parent' ); |
  |  | 6013 | if ( $parent > 0 ) { |
  |  | 6014 | $album = wppa\_cache\_album( $parent ); |
  |  | 6015 | } |
  |  | 6016 | else { |
  |  | 6017 | $album = ''; |
  |  | 6018 | } |
  |  | 6019 |  |
  |  | 6020 | // Find the sequence method |
  |  | 6021 | $method = ''; |
  |  | 6022 |  |
  |  | 6023 | // Parent is album |
  |  | 6024 | if ( $album ) { |
  |  | 6025 | if ( $album['suba\_order\_by'] == '1' ) $method = 'order'; |
  |  | 6026 | elseif ( $album['suba\_order\_by'] == '-1' ) $method = 'orderdesc'; |
  |  | 6027 | elseif ( $album['suba\_order\_by'] != '0' ) return; // Default no set to seqno(desc) |
  |  | 6028 | } |
  |  | 6029 |  |
  |  | 6030 | // Parent is none or separate, or parent sequence is default: use system default |
  |  | 6031 | if ( ! $method ) { |
  |  | 6032 | if ( wppa\_opt( 'list\_albums\_by' ) == '1' ) $method = 'order'; |
  |  | 6033 | if ( wppa\_opt( 'list\_albums\_by' ) == '-1' ) $method = 'orderdesc'; |
  |  | 6034 | } |
  |  | 6035 |  |
  |  | 6036 | // Method not following sequence numbering? |
  |  | 6037 | if ( ! $method ) return; |
  |  | 6038 |  |
  |  | 6039 | // Find the subalbum count |
  |  | 6040 | $query      = $wpdb->prepare( "SELECT COUNT(\*) FROM $wpdb->wppa\_albums WHERE a\_parent = %d", $parent ); |
  |  | 6041 | $subcount   = wppa\_get\_var( $query ); |
  |  | 6042 |  |
  |  | 6043 | if ( $subcount < 2 ) return; // Only max one subalbum; nothing to Fix |
  |  | 6044 |  |
  |  | 6045 | // Ascending order nos |
  |  | 6046 | if ( $method == 'order' ) { |
  |  | 6047 |  |
  |  | 6048 | // Get the subalbs, except the last one |
  |  | 6049 | $query  = $wpdb->prepare( "SELECT id FROM $wpdb->wppa\_albums WHERE a\_parent = %d AND id <> %d ORDER BY a\_order, id", $parent, $last ); |
  |  | 6050 | $subs   = wppa\_get\_col( $query ); |
  |  | 6051 |  |
  |  | 6052 | // Now fix sequence |
  |  | 6053 | $seqno = 1; |
  |  | 6054 | foreach( $subs as $aid ) { |
  |  | 6055 | wppa\_update\_album( $aid, ['a\_order' => $seqno] ); |
  |  | 6056 | $seqno++; |
  |  | 6057 | } |
  |  | 6058 | wppa\_update\_album( $last, ['a\_order' => $seqno] ); |
  |  | 6059 |  |
  |  | 6060 | } |
  |  | 6061 |  |
  |  | 6062 | // Descenting order nos |
  |  | 6063 | else { |
  |  | 6064 | } |
  |  | 6065 |  |
  |  | 6066 | } |
  |  | 6067 |  |
  |  | 6068 | // Do the media item |
  |  | 6069 | elseif ( $what == 'media' ) { |
  |  | 6070 | } |
  |  | 6071 |  |
  |  | 6072 | return; |
  |  | 6073 | } |
* ## [wp-photo-album-plus/trunk/wppa-wpdb-insert.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa-wpdb-insert.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa-wpdb-insert.php")

  | [r3146070](/browser/wp-photo-album-plus/trunk/wppa-wpdb-insert.php?rev=3146070#L4 "Show revision 3146070 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa-wpdb-insert.php?rev=3170202#L4 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 4 | 4 | \* |
  | 5 | 5 | \* Contains low-level wpdb routines that add new records |
  | 6 |  | \* Version 8.8.0~~5.003~~ |
  |  | 6 | \* Version 8.8.07.004 |
  | 7 | 7 | \* |
  | 8 | 8 | \*/ |
  | […](/browser/wp-photo-album-plus/trunk/wppa-wpdb-insert.php?rev=3146070#L370) | […](/browser/wp-photo-album-plus/trunk/wppa-wpdb-insert.php?rev=3170202#L370) |  |
  | 370 | 370 | wppa\_invalidate\_treecounts( $data['a\_parent'] ); |
  | 371 | 371 | } |
  |  | 372 | wppa\_fix\_seq\_nums( 'album', $data['id'] ); |
  | 372 | 373 |  |
  | 373 | 374 | return $data['id']; |
* ## [wp-photo-album-plus/trunk/wppa.php](/changeset/3170202/wp-photo-album-plus/trunk/wppa.php "Show the changeset 3170202 restricted to wp-photo-album-plus/trunk/wppa.php")

  | [r3167611](/browser/wp-photo-album-plus/trunk/wppa.php?rev=3167611#L3 "Show revision 3167611 of this file in browser") | [r3170202](/browser/wp-photo-album-plus/trunk/wppa.php?rev=3170202#L3 "Show revision 3170202 of this file in browser") |  |
  | --- | --- | --- |
  | 3 | 3 | \* Plugin Name: WP Photo Album Plus |
  | 4 | 4 | \* Description: Easily manage and display your photo albums and slideshows within your WordPress site. |
  | 5 |  | \* Version: 8.8.07.00~~3~~ |
  |  | 5 | \* Version: 8.8.07.004 |
  | 6 | 6 | \* Author: J.N. Breetvelt a.k.a. OpaJaap |
  | 7 | 7 | \* Author URI: http://wppa.opajaap.nl/ |
  | […](/browser/wp-photo-album-plus/trunk/wppa.php?rev=3167611#L25) | […](/browser/wp-photo-album-plus/trunk/wppa.php?rev=3170202#L25) |  |
  | 25 | 25 |  |
  | 26 | 26 | /\* WPPA Version \*/ |
  | 27 |  | global $wppa\_version;       $wppa\_version = '8.8.07.00~~3~~';                           // WPPA software version |
  |  | 27 | global $wppa\_version;       $wppa\_version = '8.8.07.004';                           // WPPA software version |
  | 28 | 28 | global $wppa\_revno;         $wppa\_revno = str\_replace( '.', '', $wppa\_version );    // WPPA db version |
  | 29 | 29 |  |

**Note:** See [TracChangeset](/wiki/TracChangeset)
for help on using the changeset viewer.

[Trac UI Preferences](/prefs)
### Download in other formats:

* [Unified Diff](?format=diff&new=3170202)
* [Zip Archive](?format=zip&new=3170202)

* [About](https://wordpress.org/about/)
* [News](https://wordpress.org/news/)
* [Hosting](https://wordpress.org/hosting/)
* [Donate](https://wordpressfoundation.org/donate/)
* [Swag](https://mercantile.wordpress.org/)

* [Documentation](https://wordpress.org/documentation/)
* [Developers](https://developer.wordpress.org/)
* [Get Involved](https://make.wordpress.org/)
* [Learn](https://learn.wordpress.org/)

* [Showcase](https://wordpress.org/showcase/)
* [Plugins](https://wordpress.org/plugins/)
* [Themes](https://wordpress.org/themes/)
* [Patterns](https://wordpress.org/patterns/)

* [WordCamp](https://central.wordcamp.org/)
* [WordPress.TV](https://wordpress.tv/)
* [BuddyPress](https://buddypress.org/)
* [bbPress](https://bbpress.org/)

* [WordPress.com](https://wordpress.com/?ref=wporg-footer)
* [Matt](https://ma.tt/)
* [Privacy](https://wordpress.org/about/privacy/)
* [Public Code](https://publiccode.eu/)

[WordPress.org](https://wordpress.org/)

[WordPress.org](https://wordpress.org/)

* [Visit our Facebook page](https://www.facebook.com/WordPress/)
* [Visit our Twitter account](https://twitter.com/WordPress)
* [Visit our Instagram account](https://www.instagram.com/wordpress/)
* [Visit our LinkedIn account](https://www.linkedin.com/company/wordpress)

![Code is Poetry](https://s.w.org/style/images/code-is-poetry-for-dark-bg.svg)

