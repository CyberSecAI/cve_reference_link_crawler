
# [Database Security Ninja](https://databasesecurityninja.wordpress.com/)

##

Menu
[Skip to content](#content)

* [Home](https://databasesecurityninja.wordpress.com)
* [About ME](https://databasesecurityninja.wordpress.com/about/)

Search

Search for:

# CVE-2020-2978 – RMAN Audit table point in time Recovery Not Logged

[December 1, 2020](https://databasesecurityninja.wordpress.com/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/) / [arcsdegeo](https://databasesecurityninja.wordpress.com/author/arcsdegeo/)

The scope of this security research is to detect if a database administrator tried to restore a “sensitive table” (already in-place auditing is configured against SELECT statements against this sensitive table). The following research illustrates that despite RMAN operations are audited by “default” in pure “Unified Auditing” mode, the table point of time recovery activity/action was ****not logged**** in the audit logs. As a result, any trails for future forensic investigation or real time security operations monitoring for activities against highly confidential sensitive table will be very challenging.

SQL> select value from v$option where parameter =’Unified Auditing’;

VALUE

—————————————————————-

TRUE

SQL> select \* from DBA\_AUDIT\_MGMT\_CONFIG\_PARAMS where PARAMETER\_NAME = ‘AUDIT WRITE MODE’;

PARAMETER\_NAME

————————————————————————————————————————————————————————————————————————————————————————————————————

PARAMETER\_VALUE

————————————————————————————————————————————————————————————————————————————————————————————————————

AUDIT\_TRAIL

—————————-

AUDIT WRITE MODE

IMMEDIATE WRITE MODE

UNIFIED AUDIT TRAIL

The following shell script is used to restore the table with different name

/export/oraxxx/resotre.sh

#!/bin/sh

export ORACLE\_SID=oraxxx

export ORACLE\_HOME=/orcl/oraxxx/product/18.3

export RMAN\_LOG\_FILE=/export/oraxxx/aux\_db/emad\_restore.log

RMAN=$ORACLE\_HOME/bin/rman

CMD\_STR=”

ORACLE\_HOME=$ORACLE\_HOME

export ORACLE\_HOME

ORACLE\_SID=$ORACLE\_SID

export ORACLE\_SID

$RMAN target \/ msglog $RMAN\_LOG\_FILE append << EOF

connect CATALOG $RCVCAT\_CONNECT\_STR

run {

recover table dba.dummy

#until scn 56330407409

until time \”to\_date(’23-JAN-2020 08:00:00′,’DD-MON-YYYY HH24:MI:SS’)\”

auxiliary destination ‘/export/oraxxx/aux\_db’

remap table dba.dummy:dummy\_55;

}

EOF

“

/usr/bin/sh -c “$CMD\_STR” >> $RMAN\_LOG\_FILE

Log File shows the restore is successful:

auxiliary instance file /export/oraxxx/aux\_db/JTVB\_PITR\_oraxxx/onlinelog/o1\_mf\_1\_h2lopldq\_.log deleted

auxiliary instance file /export/oraxxx/aux\_db/JTVB\_PITR\_oraxxx/datafile/o1\_mf\_ts\_user\_\_h2locvjr\_.dbf deleted

auxiliary instance file /export/oraxxx/aux\_db/oraxxx/datafile/o1\_mf\_sysaux\_h2lncb1c\_.dbf deleted

auxiliary instance file /export/oraxxx/aux\_db/oraxxx/datafile/o1\_mf\_ts\_undo\_\_h2lnlrw7\_.dbf deleted

auxiliary instance file /export/oraxxx/aux\_db/oraxxx/datafile/o1\_mf\_system\_h2lncb14\_.dbf deleted

auxiliary instance file /export/oraxxx/aux\_db/oraxxx/datafile/o1\_mf\_system\_h2lncbvp\_.dbf deleted

auxiliary instance file /export/oraxxx/aux\_db/oraxxx/controlfile/o1\_mf\_h2ln7ftc\_.ctl deleted

auxiliary instance file tspitr\_jtvb\_19868.dmp deleted

Finished recover at 01/23/2020-11:19:30

RMAN> RMAN>

Recovery Manager complete.

![](https://databasesecurityninja.wordpress.com/wp-content/uploads/2020/12/image.png?w=1024)

Checking the unified audit trail:

SQL> select EVENT\_TIMESTAMP, ACTION\_NAME, RMAN\_SESSION\_STAMP, RMAN\_OPERATION,RMAN\_OPERATION,RMAN\_OBJECT\_TYPE

from unified\_audit\_trail where ACTION\_NAME like ‘%RMAN%’ order by 1;

The RMAN session is logged as shown below but there is NO details what kind of RMAN operation took place ?!

![](https://databasesecurityninja.wordpress.com/wp-content/uploads/2020/12/image-2.png?w=1024)

Now after applying July 2020 Oracle CPU patch, let us see if the issue is fixed:

I will recover the table with **remap\_table** option using RMAN again and checking audit logs:

select EVENT\_TIMESTAMP,authentication\_type,DBUSERNAME,CLIENT\_PROGRAM\_NAME,ACTION\_NAME,SQL\_TEXT,RMAN\_OPERATION,RMAN\_OBJECT\_TYPE,RMAN\_DEVICE\_TYPE from unified\_audit\_trail where ACTION\_NAME like ‘%RMAN%’ order by EVENT\_TIMESTAMP desc;

![](https://databasesecurityninja.wordpress.com/wp-content/uploads/2020/12/image-3.png?w=1024)

The RMAN operation is now “logged” successfully, its important to mention that you can recover the table as “**dump**” file and externally move it outside your database.

So this vulnerability is related to “integrity” issue, and assigned CVE-2020-2978 which exists in the following database versions : 19c, 18c, 12cR2, 12cR1

<https://www.oracle.com/security-alerts/cpujul2020.html>

### Share this:

* [Twitter](https://databasesecurityninja.wordpress.com/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/?share=twitter "Click to share on Twitter")
* [Facebook](https://databasesecurityninja.wordpress.com/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/?share=facebook "Click to share on Facebook")
Like Loading...
### *Related*

[Uncategorized](https://databasesecurityninja.wordpress.com/category/uncategorized/)
[CVE-2020-2978](https://databasesecurityninja.wordpress.com/tag/cve-2020-2978/), [CVE-2020-2978 exploit](https://databasesecurityninja.wordpress.com/tag/cve-2020-2978-exploit/), [CVE-2020-2978 Oracle](https://databasesecurityninja.wordpress.com/tag/cve-2020-2978-oracle/), [CVE-2020-2978 vulnerability](https://databasesecurityninja.wordpress.com/tag/cve-2020-2978-vulnerability/), [database security](https://databasesecurityninja.wordpress.com/tag/database-security/), [database security exploit](https://databasesecurityninja.wordpress.com/tag/database-security-exploit/), [Oracle CVE](https://databasesecurityninja.wordpress.com/tag/oracle-cve/), [oracle CVE exploit](https://databasesecurityninja.wordpress.com/tag/oracle-cve-exploit/), [Oracle Database Security](https://databasesecurityninja.wordpress.com/tag/oracle-database-security/), [oracle database security vulnerability](https://databasesecurityninja.wordpress.com/tag/oracle-database-security-vulnerability/), [oracle database security vulnerability exploit](https://databasesecurityninja.wordpress.com/tag/oracle-database-security-vulnerability-exploit/), [oracle database vulnerability](https://databasesecurityninja.wordpress.com/tag/oracle-database-vulnerability/), [oracle exploit](https://databasesecurityninja.wordpress.com/tag/oracle-exploit/), [oracle security vulnerability exploit](https://databasesecurityninja.wordpress.com/tag/oracle-security-vulnerability-exploit/)

# Post navigation

[← bypassing Data Classification and Auditing feature in SQL Server 2019](https://databasesecurityninja.wordpress.com/2020/10/22/bypassing-data-classification-and-auditing-feature-in-sql-server-2019/)[Memory Dump Against Oracle database system For Data Ex-filtration & ALLOW\_GROUP\_ACCESS\_TO\_SGA parameter →](https://databasesecurityninja.wordpress.com/2021/01/03/memory-dump-against-oracle-database-system-for-data-ex-filtration-allow_group_access_to_sga-parameter/)

### Leave a comment [Cancel reply](/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/#respond)

Δ

# Blog Stats

* 160,794 hits
Search for:

# Top Posts & Pages

* [Changing SYS password in Oracle 12cR2 and 18c](https://databasesecurityninja.wordpress.com/2019/04/01/changing-sys-password-in-oracle-12cr2-and-18c/)
* [SQLNET.ALLOW\_WEAK\_CRYPTO\_CLIENTS new parameter introduced in Oracle CPU July 2021](https://databasesecurityninja.wordpress.com/2021/07/21/sqlnet-allow_weak_crypto_clients-new-parameter-introduced-in-oracle-cpu-july-2021/)
* [Purging Unified Audit Logs](https://databasesecurityninja.wordpress.com/2019/01/02/purging-unified-audit-logs/)
* [Monitoring Oracle SYS Account Password Changes](https://databasesecurityninja.wordpress.com/2023/02/13/monitoring-oracle-sys-account-password-changes/)
* [ByPassing DBMS\_REDACT Dynamic Data Masking security feature in Oracle database system](https://databasesecurityninja.wordpress.com/2023/01/03/bypassing-dbms_redact-dynamic-data-masking-security-feature-in-oracle-database-system/)
* [Extract SQL Server Database Password Hashes Without A Trace](https://databasesecurityninja.wordpress.com/2020/06/02/extract-sql-server-database-password-hashes-without-a-trace/)

[Create a free website or blog at WordPress.com.](https://wordpress.com/?ref=footer_website)

* [Comment](https://databasesecurityninja.wordpress.com/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/#respond)
* Reblog
* Subscribe
  Subscribed

  + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Database Security Ninja](https://databasesecurityninja.wordpress.com)

  Sign me up

  + Already have a WordPress.com account? [Log in now.](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fdatabasesecurityninja.wordpress.com%2F2020%2F12%2F01%2Fcve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged%2F&signup_flow=account)
* Privacy
* + [![](https://s2.wp.com/i/logo/wpcom-gray-white.png) Database Security Ninja](https://databasesecurityninja.wordpress.com)
  + [Customize](https://databasesecurityninja.wordpress.com/wp-admin/customize.php?url=https%3A%2F%2Fdatabasesecurityninja.wordpress.com%2F2020%2F12%2F01%2Fcve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged%2F)
  + Subscribe
    Subscribed
  + [Sign up](https://wordpress.com/start/)
  + [Log in](https://wordpress.com/log-in?redirect_to=https%3A%2F%2Fdatabasesecurityninja.wordpress.com%2F2020%2F12%2F01%2Fcve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged%2F&signup_flow=account)
  + [Copy shortlink](https://wp.me/p8Poke-ce)
  + [Report this content](https://wordpress.com/abuse/?report_url=https://databasesecurityninja.wordpress.com/2020/12/01/cve-2020-2978-rman-audit-table-point-in-time-recovery-not-logged/)
  + [View post in Reader](https://wordpress.com/read/blogs/130458926/posts/758)
  + [Manage subscriptions](https://subscribe.wordpress.com/)
  + Collapse this bar

##

##

Loading Comments...

Write a Comment...

Email (Required)

Name (Required)

Website

###

%d

![](https://pixel.wp.com/b.gif?v=noscript)
Design a site like this with WordPress.com[Get started](https://wordpress.com/start/?ref=marketing_bar)

