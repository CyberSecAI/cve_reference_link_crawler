
[CodeQL documentation](https://codeql.github.com/docs)

CodeQL resources

* [CodeQL overview](https://codeql.github.com/docs/codeql-overview)
CodeQL guides
* [Writing CodeQL queries](https://codeql.github.com/docs/writing-codeql-queries)
* [CodeQL language guides](https://codeql.github.com/docs/codeql-language-guides)
  Reference docs
  * [QL language
    reference](https://codeql.github.com/docs/ql-language-reference/)* [CodeQL
      standard-libraries](https://codeql.github.com/codeql-standard-libraries)* [CodeQL
        query help](https://codeql.github.com/codeql-query-help)
        Source files
        * [CodeQL repository](https://github.com/github/codeql)
          Academic
          * [QL publications](https://codeql.github.com/publications)

* [CodeQL query help for C and C++](../../cpp/)
* [CodeQL query help for C#](../../csharp/)
* [CodeQL query help for Go](../../go/)
* [CodeQL query help for Java and Kotlin](../)
  + [Access Java object methods through JavaScript exposure](../java-android-webview-addjavascriptinterface/)
  + [Access to unsupported JDK-internal API](../java-jdk-internal-api-access/)
  + [Android APK installation](../java-android-arbitrary-apk-installation/)
  + [Android Intent redirection](../java-android-intent-redirection/)
  + [Android WebSettings file access](../java-android-websettings-file-access/)
  + [Android WebView JavaScript settings](../java-android-websettings-javascript-enabled/)
  + [Android WebView settings allows access to content links](../java-android-websettings-allow-content-access/)
  + [Android Webview debugging enabled](../java-android-webview-debugging-enabled/)
  + [Android `WebView` that accepts all certificates](../java-improper-webview-certificate-validation/)
  + [Android debuggable attribute enabled](../java-android-debuggable-attribute-enabled/)
  + [Android fragment injection](../java-android-fragment-injection/)
  + [Android fragment injection in PreferenceActivity](../java-android-fragment-injection-preference-activity/)
  + [Android missing certificate pinning](../java-android-missing-certificate-pinning/)
  + [Android sensitive keyboard cache](../java-android-sensitive-keyboard-cache/)
  + [AnnotationPresent check](../java-ineffective-annotation-present-check/)
  + [Application backup allowed](../java-android-backup-enabled/)
  + [Arbitrary file access during archive extraction (”Zip Slip”)](../java-zipslip/)
  + [Array index out of bounds](../java-index-out-of-bounds/)
  + [Bad implementation of an event Adapter](../java-wrong-swing-event-adapter-signature/)
  + [Bad suite method](../java-wrong-junit-suite-signature/)
  + [Boxed variable is never null](../java-non-null-boxed-variable/)
  + [Building a command line with string concatenation](../java-concatenated-command-line/)
  + [Building a command with an injected environment variable](../java-exec-tainted-environment/)
  + [Call to Iterator.remove may fail](../java-iterator-remove-failure/)
  + [Cast from abstract to concrete collection](../java-abstract-to-concrete-cast/)
  + [Chain of ‘instanceof’ tests](../java-chained-type-tests/)
  + [Character passed to StringBuffer or StringBuilder constructor](../java-string-buffer-char-init/)
  + [Class has same name as super class](../java-class-name-matches-super-class/)
  + [Cleartext storage of sensitive information in cookie](../java-cleartext-storage-in-cookie/)
  + [Cleartext storage of sensitive information in the Android filesystem](../java-android-cleartext-storage-filesystem/)
  + [Cleartext storage of sensitive information using ‘Properties’ class](../java-cleartext-storage-in-properties/)
  + [Cleartext storage of sensitive information using `SharedPreferences` on Android](../java-android-cleartext-storage-shared-prefs/)
  + [Cleartext storage of sensitive information using a local database on Android](../java-android-cleartext-storage-database/)
  + [Comparison of identical values](../java-comparison-of-identical-expressions/)
  + [Comparison of narrow type with wide type in loop condition](../java-comparison-with-wider-type/)
  + [Confusing method names because of capitalization](../java-confusing-method-name/)
  + [Confusing non-overriding of package-private method](../java-non-overriding-package-private/)
  + [Confusing overloading of methods](../java-confusing-method-signature/)
  + [Constant interface anti-pattern](../java-constants-only-interface/)
  + [Constant loop condition](../java-constant-loop-condition/)
  + [Container contents are never accessed](../java-unused-container/)
  + [Container contents are never initialized](../java-empty-container/)
  + [Container size compared to zero](../java-test-for-negative-container-size/)
  + [Continue statement that does not continue](../java-continue-in-false-loop/)
  + [Contradictory type checks](../java-contradictory-type-checks/)
  + [Creates empty ZIP file entry](../java-empty-zip-file-entry/)
  + [Cross-site scripting](../java-xss/)
  + [Dangerous non-short-circuit logic](../java-non-short-circuit-evaluation/)
  + [Dangerous runFinalizersOnExit](../java-run-finalizers-on-exit/)
  + [Depending upon JCenter/Bintray as an artifact repository](../java-maven-dependency-upon-bintray/)
  + [Deprecated method or constructor invocation](../java-deprecated-call/)
  + [Dereferenced expression may be null](../java-dereferenced-expr-may-be-null/)
  + [Dereferenced variable is always null](../java-dereferenced-value-is-always-null/)
  + [Dereferenced variable may be null](../java-dereferenced-value-may-be-null/)
  + [Deserialization of user-controlled data](../java-unsafe-deserialization/)
  + [Detect JHipster Generator Vulnerability CVE-2019-16303](../java-jhipster-prng/)
  + [Direct call to a run() method](../java-call-to-thread-run/)
  + [Disabled Netty HTTP header validation](../java-netty-http-request-or-response-splitting/)
  + [Disabled Spring CSRF protection](../java-spring-disabled-csrf-protection/)
  + [Double-checked locking is not thread-safe](../java-unsafe-double-checked-locking/)
  + [Equals method does not inspect argument type](../java-unchecked-cast-in-equals/)
  + [Equals on incomparable types](../java-equals-on-unrelated-types/)
  + [Equals or hashCode on arrays](../java-equals-on-arrays/)
  + [Executing a command with a relative path](../java-relative-path-command/)
  + [Exposing internal representation](../java-internal-representation-exposure/)
  + [Exposure of sensitive information to UI text views](../java-android-sensitive-text/)
  + [Exposure of sensitive information to notifications](../java-android-sensitive-notification/)
  + [Expression always evaluates to the same value](../java-evaluation-to-constant/)
  + [Expression language injection (JEXL)](../java-jexl-expression-injection/)
  + [Expression language injection (MVEL)](../java-mvel-expression-injection/)
  + Expression language injection (Spring)
  + [Externalizable but no public no-argument constructor](../java-missing-no-arg-constructor-on-externalizable/)
  + [Failure to use HTTPS or SFTP URL in Maven artifact upload/download](../java-maven-non-https-url/)
  + [Failure to use secure cookies](../java-insecure-cookie/)
  + [Field masks field in super class](../java-field-masks-super-field/)
  + [Finalizer inconsistency](../java-missing-super-finalize/)
  + [Futile synchronization on field](../java-unsafe-sync-on-field/)
  + [Groovy Language injection](../java-groovy-injection/)
  + [HTTP response splitting](../java-http-response-splitting/)
  + [Hard-coded credential in API call](../java-hardcoded-credential-api-call/)
  + [Hashed value without hashCode definition](../java-hashing-without-hashcode/)
  + [Ignored error status of call](../java-ignored-error-status-of-call/)
  + [Implicit conversion from array to string](../java-print-array/)
  + [Implicit narrowing conversion in compound assignment](../java-implicit-cast-in-compound-assignment/)
  + [Implicitly exported Android component](../java-android-implicitly-exported-component/)
  + [Improper validation of user-provided array index](../java-improper-validation-of-array-index/)
  + [Improper validation of user-provided size used for array construction](../java-improper-validation-of-array-construction/)
  + [Improper verification of intent by broadcast receiver](../java-improper-intent-verification/)
  + [Inconsistent compareTo](../java-inconsistent-compareto-and-equals/)
  + [Inconsistent equals and hashCode](../java-inconsistent-equals-and-hashcode/)
  + [Inconsistent synchronization for writeObject()](../java-inconsistent-sync-writeobject/)
  + [Inconsistent synchronization of getter and setter](../java-unsynchronized-getter/)
  + [Incorrect absolute value of random number](../java-abs-of-random/)
  + [Incorrect serialVersionUID field](../java-incorrect-serial-version-uid/)
  + [Inefficient String constructor](../java-inefficient-string-constructor/)
  + [Inefficient empty string test](../java-inefficient-empty-string-test/)
  + [Inefficient output stream](../java-inefficient-output-stream/)
  + [Inefficient primitive constructor](../java-inefficient-boxed-constructor/)
  + [Inefficient regular expression](../java-redos/)
  + [Inefficient use of key set iterator](../java-inefficient-key-set-iterator/)
  + [Information exposure through a stack trace](../java-stack-trace-exposure/)
  + [Information exposure through an error message](../java-error-message-exposure/)
  + [Inner class could be static](../java-non-static-nested-class/)
  + [Insecure Bean Validation](../java-insecure-bean-validation/)
  + [Insecure JavaMail SSL Configuration](../java-insecure-smtp-ssl/)
  + [Insecure LDAP authentication](../java-insecure-ldap-auth/)
  + [Insecure basic authentication](../java-insecure-basic-auth/)
  + [Insecure local authentication](../java-android-insecure-local-authentication/)
  + [Insecure randomness](../java-insecure-randomness/)
  + [Insecurely generated keys for local authentication](../java-android-insecure-local-key-gen/)
  + [Insertion of sensitive information into log files](../java-sensitive-log/)
  + [Intent URI permission manipulation](../java-android-intent-uri-permission-manipulation/)
  + [Interface cannot be implemented](../java-unimplementable-interface/)
  + [Iterable wrapping an iterator](../java-iterable-wraps-iterator/)
  + [Iterator implementing Iterable](../java-iterator-implements-iterable/)
  + [JNDI lookup with user-controlled name](../java-jndi-injection/)
  + [Javadoc has impossible ‘throws’ tag](../java-inconsistent-javadoc-throws/)
  + [LDAP query built from user-controlled sources](../java-ldap-injection/)
  + [Leaking sensitive information through a ResultReceiver](../java-android-sensitive-result-receiver/)
  + [Leaking sensitive information through an implicit Intent](../java-android-sensitive-communication/)
  + [Left shift by more than the type width](../java-lshift-larger-than-type-width/)
  + [Local information disclosure in a temporary directory](../java-local-temp-file-or-directory-information-disclosure/)
  + [Log Injection](../java-log-injection/)
  + [Loop with unreachable exit condition](../java-unreachable-exit-in-loop/)
  + [Misleading indentation](../java-misleading-indentation/)
  + [Missing JWT signature check](../java-missing-jwt-signature-check/)
  + [Missing Override annotation](../java-missing-override-annotation/)
  + [Missing catch of NumberFormatException](../java-uncaught-number-format-exception/)
  + [Missing enum case in switch](../java-missing-case-in-switch/)
  + [Missing format argument](../java-missing-format-argument/)
  + [Missing read or write permission in a content provider](../java-android-incomplete-provider-permissions/)
  + [Missing space in string literal](../java-missing-space-in-concatenation/)
  + [Missing super clone](../java-missing-call-to-super-clone/)
  + [Multiplication of remainder](../java-multiplication-of-remainder/)
  + [Next in hasNext implementation](../java-iterator-hasnext-calls-next/)
  + [No clone method](../java-missing-clone-method/)
  + [Non-final method invocation in constructor](../java-non-final-call-in-constructor/)
  + [Non-synchronized override of synchronized method](../java-non-sync-override/)
  + [OGNL Expression Language statement with user-controlled input](../java-ognl-injection/)
  + [Overloaded compareTo](../java-wrong-compareto-signature/)
  + [Overloaded equals](../java-wrong-equals-signature/)
  + [Overly permissive regular expression range](../java-overly-large-range/)
  + [Partial path traversal vulnerability](../java-partial-path-traversal/)
  + [Partial path traversal vulnerability from remote](../java-partial-path-traversal-from-remote/)
  + [Polynomial regular expression used on uncontrolled data](../java-polynomial-redos/)
  + [Possible confusion of local and field](../java-local-shadows-field/)
  + [Potential database resource leak](../java-database-resource-leak/)
  + [Potential input resource leak](../java-input-resource-leak/)
  + [Potential output resource leak](../java-output-resource-leak/)
  + [Query built by concatenation with a possibly-untrusted string](../java-concatenated-sql-query/)
  + [Query built from user-controlled sources](../java-sql-injection/)
  + [Race condition in double-checked locking object initialization](../java-unsafe-double-checked-locking-init-order/)
  + [Race condition in socket authentication](../java-socket-auth-race-condition/)
  + [Random used only once](../java-random-used-once/)
  + [ReadResolve must have Object return type, not void](../java-wrong-readresolve-signature/)
  + [Reading from a world writable file](../java-world-writable-file-read/)
  + [Reference equality test of boxed types](../java-reference-equality-of-boxed-types/)
  + [Reference equality test on strings](../java-reference-equality-on-strings/)
  + [Regular expression injection](../java-regex-injection/)
  + [Resolving XML external entity in user-controlled data](../java-xxe/)
  + [Result of multiplication cast to wider type](../java-integer-multiplication-cast-to-long/)
  + [Self assignment](../java-redundant-assignment/)
  + [Serializable but no void constructor](../java-missing-no-arg-constructor-on-serializable/)
  + [Serializable inner class of non-serializable class](../java-non-serializable-inner-class/)
  + [Serialization methods do not match required signature](../java-wrong-object-serialization-signature/)
  + [Server-side request forgery](../java-ssrf/)
  + [Server-side template injection](../java-server-side-template-injection/)
  + [Sleep with lock held](../java-sleep-with-lock-held/)
  + [Spin on field](../java-spin-on-field/)
  + [Spurious Javadoc @param tags](../java-unknown-javadoc-parameter/)
  + [Start of thread in constructor](../java-thread-start-in-constructor/)
  + [Subtle call to inherited method](../java-subtle-inherited-call/)
  + [Suspicious date format](../java-suspicious-date-format/)
  + [Synchronization on boxed types or strings](../java-sync-on-boxed-types/)
  + [Thread-unsafe use of DateFormat](../java-thread-unsafe-dateformat/)
  + [Time-of-check time-of-use race condition](../java-toctou-race-condition/)
  + [Trust boundary violation](../java-trust-boundary-violation/)
  + [Type bound extends a final class](../java-type-bound-extends-final/)
  + [Type mismatch on container access](../java-type-mismatch-access/)
  + [Type mismatch on container modification](../java-type-mismatch-modification/)
  + [Type variable hides another type](../java-type-variable-hides-type/)
  + [Typo in equals](../java-equals-typo/)
  + [Typo in hashCode](../java-hashcode-typo/)
  + [Typo in toString](../java-tostring-typo/)
  + [URL forward from a remote source](../java-unvalidated-url-forward/)
  + [URL redirection from remote source](../java-unvalidated-url-redirection/)
  + [Uncontrolled command line](../java-command-line-injection/)
  + [Uncontrolled data in arithmetic expression](../java-uncontrolled-arithmetic/)
  + [Uncontrolled data used in content resolution](../java-android-unsafe-content-uri-resolution/)
  + [Uncontrolled data used in path expression](../java-path-injection/)
  + [Underscore used as identifier](../java-underscore-identifier/)
  + [Unreachable catch clause](../java-unreachable-catch-clause/)
  + [Unread local variable](../java-local-variable-is-never-read/)
  + [Unreleased lock](../java-unreleased-lock/)
  + [Unsafe certificate trust](../java-unsafe-cert-trust/)
  + [Unsafe hostname verification](../java-unsafe-hostname-verification/)
  + [Unsafe resource fetching in Android WebView](../java-android-unsafe-android-webview-fetch/)
  + [Unsafe use of getResource](../java-unsafe-get-resource/)
  + [Unused classes and interfaces](../java-unused-reference-type/)
  + [Unused format argument](../java-unused-format-argument/)
  + [Unused label](../java-unused-label/)
  + [Use of RSA algorithm without OAEP](../java-rsa-without-oaep/)
  + [Use of a broken or risky cryptographic algorithm](../java-weak-cryptographic-algorithm/)
  + [Use of a cryptographic algorithm with insufficient key size](../java-insufficient-key-size/)
  + [Use of a potentially broken or risky cryptographic algorithm](../java-potentially-weak-cryptographic-algorithm/)
  + [Use of a potentially dangerous function](../java-potentially-dangerous-function/)
  + [Use of a predictable seed in a secure random number generator](../java-predictable-seed/)
  + [Use of default toString()](../java-call-to-object-tostring/)
  + [Use of externally-controlled format string](../java-tainted-format-string/)
  + [Use of implicit PendingIntents](../java-android-implicit-pendingintents/)
  + [Useless comparison test](../java-constant-comparison/)
  + [Useless null check](../java-useless-null-check/)
  + [Useless parameter](../java-unused-parameter/)
  + [Useless toString on String](../java-useless-tostring-call/)
  + [Useless type test](../java-useless-type-test/)
  + [User-controlled bypass of sensitive method](../java-user-controlled-bypass/)
  + [User-controlled data in arithmetic expression](../java-tainted-arithmetic/)
  + [User-controlled data in numeric cast](../java-tainted-numeric-cast/)
  + [User-controlled data used in permissions check](../java-tainted-permissions-check/)
  + [Using a static initialization vector for encryption](../java-static-initialization-vector/)
  + [Wait on condition](../java-wait-on-condition-interface/)
  + [Whitespace contradicts operator precedence](../java-whitespace-contradicts-precedence/)
  + [Wrong NaN comparison](../java-comparison-with-nan/)
  + [XPath injection](../java-xml-xpath-injection/)
  + [XSLT transformation with user-controlled stylesheet](../java-xslt-injection/)
  + [`TrustManager` that accepts all certificates](../java-insecure-trustmanager/)
  + [notify instead of notifyAll](../java-notify-instead-of-notify-all/)
* [CodeQL query help for JavaScript and TypeScript](../../javascript/)
* [CodeQL query help for Python](../../python/)
* [CodeQL query help for Ruby](../../ruby/)
* [CodeQL query help for Swift](../../swift/)
* [CodeQL CWE coverage](../../codeql-cwe-coverage/)

* [CodeQL query help documentation](../../) »
* [CodeQL query help for Java and Kotlin](../) »

# Expression language injection (Spring)[¶](#expression-language-injection-spring "Link to this heading")

```
ID: java/spel-expression-injection
Kind: path-problem
Security severity: 9.3
Severity: error
Precision: high
Tags:
   - security
   - external/cwe/cwe-094
Query suites:
   - java-code-scanning.qls
   - java-security-extended.qls
   - java-security-and-quality.qls

```

[Click to see the query in the CodeQL repository](https://github.com/github/codeql/blob/main/java/ql/src/Security/CWE/CWE-094/SpelInjection.ql)

The Spring Expression Language (SpEL) is a powerful expression language provided by the Spring Framework. The language offers many features including invocation of methods available in the JVM. If a SpEL expression is built using attacker-controlled data, and then evaluated in a powerful context, then it may allow the attacker to run arbitrary code.

The `SpelExpressionParser` class parses a SpEL expression string and returns an `Expression` instance that can be then evaluated by calling one of its methods. By default, an expression is evaluated in a powerful `StandardEvaluationContext` that allows the expression to access other methods available in the JVM.

## Recommendation[¶](#recommendation "Link to this heading")

In general, including user input in a SpEL expression should be avoided. If user input must be included in the expression, it should be then evaluated in a limited context that doesn’t allow arbitrary method invocation.

## Example[¶](#example "Link to this heading")

The following example uses untrusted data to build a SpEL expression and then runs it in the default powerful context.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    return expression.getValue();
  }
}

```

The next example shows how an untrusted SpEL expression can be run in `SimpleEvaluationContext` that doesn’t allow accessing arbitrary methods. However, it’s recommended to avoid using untrusted input in SpEL expressions.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    SimpleEvaluationContext context
        = SimpleEvaluationContext.forReadWriteDataBinding().build();
    return expression.getValue(context);
  }
}

```

## References[¶](#references "Link to this heading")

* Spring Framework Reference Documentation: [Spring Expression Language (SpEL)](https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/expressions.html).
* OWASP: [Expression Language Injection](https://owasp.org/www-community/vulnerabilities/Expression_Language_Injection).
* Common Weakness Enumeration: [CWE-94](https://cwe.mitre.org/data/definitions/94.html).

* ©
   GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)

