=== Content from github.com_b6cdca17_20250110_122035.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fsecurity%2Fadvisories%2FGHSA-wgrm-67xf-hhpq)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fsecurity%2Fadvisories%2FGHSA-wgrm-67xf-hhpq)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=mozilla%2Fpdf.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mozilla](/mozilla)
/
**[pdf.js](/mozilla/pdf.js)**
Public

* [Notifications](/login?return_to=%2Fmozilla%2Fpdf.js) You must be signed in to change notification settings
* [Fork
  10.1k](/login?return_to=%2Fmozilla%2Fpdf.js)
* [Star
   49.3k](/login?return_to=%2Fmozilla%2Fpdf.js)

* [Code](/mozilla/pdf.js)
* [Issues
  376](/mozilla/pdf.js/issues)
* [Pull requests
  32](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects
  1](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

Additional navigation options

* [Code](/mozilla/pdf.js)
* [Issues](/mozilla/pdf.js/issues)
* [Pull requests](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

# Arbitrary JavaScript execution upon opening a malicious PDF

High

[calixteman](/calixteman)
published
GHSA-wgrm-67xf-hhpq
May 6, 2024

## Package

npm

pdfjs-dist
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 4.1.392

## Patched versions

4.2.67

## Description

### Impact

If pdf.js is used to load a malicious PDF, and PDF.js is configured with `isEvalSupported` set to `true` (which is the default value), unrestricted attacker-controlled JavaScript will be executed in the context of the hosting domain.

### Patches

The patch removes the use of `eval`:

[#18015](https://github.com/mozilla/pdf.js/pull/18015)

### Workarounds

Set the option `isEvalSupported` to `false`.

### References

<https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>

### Severity

High

### CVE ID

CVE-2024-4367

### Weaknesses

No CWEs

### Credits

* [![@ThomasRinsma](https://avatars.githubusercontent.com/u/3109710?s=40&v=4)](/ThomasRinsma)
  [ThomasRinsma](/ThomasRinsma)
  Finder

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_99a939e0_20250110_122036.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F208f28dd47fe38c33ce4bac4205b2b0a0bb207fe)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F208f28dd47fe38c33ce4bac4205b2b0a0bb207fe)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=wojtekmaj%2Freact-pdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wojtekmaj](/wojtekmaj)
/
**[react-pdf](/wojtekmaj/react-pdf)**
Public

* [Notifications](/login?return_to=%2Fwojtekmaj%2Freact-pdf) You must be signed in to change notification settings
* [Fork
  905](/login?return_to=%2Fwojtekmaj%2Freact-pdf)
* [Star
   9.7k](/login?return_to=%2Fwojtekmaj%2Freact-pdf)

* [Code](/wojtekmaj/react-pdf)
* [Issues
  34](/wojtekmaj/react-pdf/issues)
* [Pull requests
  9](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

Additional navigation options

* [Code](/wojtekmaj/react-pdf)
* [Issues](/wojtekmaj/react-pdf/issues)
* [Pull requests](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

## Commit

[Permalink](/wojtekmaj/react-pdf/commit/208f28dd47fe38c33ce4bac4205b2b0a0bb207fe)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Force isEvalSupported to false

[Browse files](/wojtekmaj/react-pdf/tree/208f28dd47fe38c33ce4bac4205b2b0a0bb207fe)
Browse the repository at this point in the history

```
Fixes [[GHSA-wgrm-67xf-hhpq](https://github.com/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq")]([GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq"))
```

* Loading branch information

[![@wojtekmaj](https://avatars.githubusercontent.com/u/5426427?s=40&v=4)](/wojtekmaj)

[wojtekmaj](/wojtekmaj/react-pdf/commits?author=wojtekmaj "View all commits by wojtekmaj")
committed
May 7, 2024

1 parent
[8ca4d07](/wojtekmaj/react-pdf/commit/8ca4d07092e54cb4dc97f949c462ff149056d0d9)

commit 208f28d

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[packages/react-pdf/src/Document.tsx](#diff-a4b68625101a85ef8b90f4337e2d83fc52e0cb3bc54d3f366e5a6faaa1f412c1 "packages/react-pdf/src/Document.tsx")

Show comments

[View file](/wojtekmaj/react-pdf/blob/208f28dd47fe38c33ce4bac4205b2b0a0bb207fe/packages/react-pdf/src/Document.tsx)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -518,7 +518,7 @@ const Document = forwardRef(function Document( |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | const optionsWithModifiedIsEvalSupported: Options = { ...options, isEvalSupported: true }; |
|  |  | const optionsWithModifiedIsEvalSupported: Options = { ...options, isEvalSupported: false }; |
|  |  |  |
|  |  | const documentInitParams: Source = { |
|  |  | ...source, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `208f28d`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F208f28dd47fe38c33ce4bac4205b2b0a0bb207fe) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_ebbfd476_20250110_122037.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fsecurity%2Fadvisories%2FGHSA-87hq-q4gp-9wr4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fsecurity%2Fadvisories%2FGHSA-87hq-q4gp-9wr4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=wojtekmaj%2Freact-pdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wojtekmaj](/wojtekmaj)
/
**[react-pdf](/wojtekmaj/react-pdf)**
Public

* [Notifications](/login?return_to=%2Fwojtekmaj%2Freact-pdf) You must be signed in to change notification settings
* [Fork
  905](/login?return_to=%2Fwojtekmaj%2Freact-pdf)
* [Star
   9.7k](/login?return_to=%2Fwojtekmaj%2Freact-pdf)

* [Code](/wojtekmaj/react-pdf)
* [Issues
  34](/wojtekmaj/react-pdf/issues)
* [Pull requests
  9](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

Additional navigation options

* [Code](/wojtekmaj/react-pdf)
* [Issues](/wojtekmaj/react-pdf/issues)
* [Pull requests](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

# PDF.js vulnerable to arbitrary JavaScript execution upon opening a malicious PDF

High

[wojtekmaj](/wojtekmaj)
published
GHSA-87hq-q4gp-9wr4
May 7, 2024

## Package

npm

react-pdf
([npm](/advisories?query=ecosystem%3Anpm))

## Affected versions

<= 7.7.2
^8.0.0 <= 8.0.1

## Patched versions

7.7.3
8.0.2

## Description

### Summary

If PDF.js is used to load a malicious PDF, and PDF.js is configured with `isEvalSupported` set to `true` (which is the default value), unrestricted attacker-controlled JavaScript will be executed in the context of the hosting domain.

### Patches

[This patch](https://github.com/wojtekmaj/react-pdf/commit/671e6eaa2e373e404040c13cc6b668fe39839cad) forces `isEvalSupported` to `false`, removing the attack vector.

### Workarounds

Set `options.isEvalSupported` to `false`, where `options` is `Document` component prop.

### References

* [GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq)
* [mozilla/pdf.js#18015](https://github.com/mozilla/pdf.js/pull/18015)
* [mozilla/pdf.js@85e64b5](https://github.com/mozilla/pdf.js/commit/85e64b5c16c9aaef738f421733c12911a441cec6)
* <https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>

### Severity

High

7.1

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
Low

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:H/I:H/A:L

### CVE ID

CVE-2024-34342

### Weaknesses

No CWEs

### Credits

* [![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)
  [calixteman](/calixteman)
  Reporter
* [![@ThomasRinsma](https://avatars.githubusercontent.com/u/3109710?s=40&v=4)](/ThomasRinsma)
  [ThomasRinsma](/ThomasRinsma)
  Finder
* [![@wojtekmaj](https://avatars.githubusercontent.com/u/5426427?s=40&v=4)](/wojtekmaj)
  [wojtekmaj](/wojtekmaj)
  Remediation developer

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3b4a3b8b_20250110_122037.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F671e6eaa2e373e404040c13cc6b668fe39839cad)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F671e6eaa2e373e404040c13cc6b668fe39839cad)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=wojtekmaj%2Freact-pdf)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[wojtekmaj](/wojtekmaj)
/
**[react-pdf](/wojtekmaj/react-pdf)**
Public

* [Notifications](/login?return_to=%2Fwojtekmaj%2Freact-pdf) You must be signed in to change notification settings
* [Fork
  905](/login?return_to=%2Fwojtekmaj%2Freact-pdf)
* [Star
   9.7k](/login?return_to=%2Fwojtekmaj%2Freact-pdf)

* [Code](/wojtekmaj/react-pdf)
* [Issues
  34](/wojtekmaj/react-pdf/issues)
* [Pull requests
  9](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

Additional navigation options

* [Code](/wojtekmaj/react-pdf)
* [Issues](/wojtekmaj/react-pdf/issues)
* [Pull requests](/wojtekmaj/react-pdf/pulls)
* [Discussions](/wojtekmaj/react-pdf/discussions)
* [Actions](/wojtekmaj/react-pdf/actions)
* [Wiki](/wojtekmaj/react-pdf/wiki)
* [Security](/wojtekmaj/react-pdf/security)
* [Insights](/wojtekmaj/react-pdf/pulse)

## Commit

[Permalink](/wojtekmaj/react-pdf/commit/671e6eaa2e373e404040c13cc6b668fe39839cad)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Force isEvalSupported to false

[Browse files](/wojtekmaj/react-pdf/tree/671e6eaa2e373e404040c13cc6b668fe39839cad)
Browse the repository at this point in the history

```
Fixes [[GHSA-wgrm-67xf-hhpq](https://github.com/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq")]([GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq"))
```

* Loading branch information

[![@wojtekmaj](https://avatars.githubusercontent.com/u/5426427?s=40&v=4)](/wojtekmaj)

[wojtekmaj](/wojtekmaj/react-pdf/commits?author=wojtekmaj "View all commits by wojtekmaj")
committed
May 7, 2024

1 parent
[a662cfc](/wojtekmaj/react-pdf/commit/a662cfcc1a0fcd5d6f13afa8135d32f4a73a9a17)

commit 671e6ea

Showing
**1 changed file**
with
**1 addition**
and
**1 deletion**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[packages/react-pdf/src/Document.tsx](#diff-a4b68625101a85ef8b90f4337e2d83fc52e0cb3bc54d3f366e5a6faaa1f412c1 "packages/react-pdf/src/Document.tsx")

Show comments

[View file](/wojtekmaj/react-pdf/blob/671e6eaa2e373e404040c13cc6b668fe39839cad/packages/react-pdf/src/Document.tsx)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -505,7 +505,7 @@ const Document = forwardRef(function Document( |
|  |  | return; |
|  |  | } |
|  |  |  |
|  |  | const optionsWithModifiedIsEvalSupported: Options = { ...options, isEvalSupported: true }; |
|  |  | const optionsWithModifiedIsEvalSupported: Options = { ...options, isEvalSupported: false }; |
|  |  |  |
|  |  | const documentInitParams: Source = { |
|  |  | ...source, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 2 comments on commit `671e6ea`

[![@vinodkumarsharma276](https://avatars.githubusercontent.com/u/27913047?s=80&v=4)](/vinodkumarsharma276)

Copy link

### @vinodkumarsharma276 **[vinodkumarsharma276](/vinodkumarsharma276)** commented on `[671e6ea](/wojtekmaj/react-pdf/commit/671e6eaa2e373e404040c13cc6b668fe39839cad)` [May 15, 2024](#commitcomment-142036456)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Hi [@wojtekmaj](https://github.com/wojtekmaj) ,

We are using v4.2.0 and recently got a security issue mentioning isEvalSupported: true can cause issues.

I bumped react-pdf to v7.\* which should fix the security thread with isEvalSupported: false but I'm getting typing issues.

One of the issue:

We are using component and passing customTextRenderer as:

customTextRederer = (textInfo: { str: string; itemIndex: number }) => {

return (

<span

<..Some span attributes>

);

};

while building the project getting error:

\_```

Type '(textInfo: { str: string; itemIndex: number;}) => React.JSX.Element' is not assignable to type 'CustomTextRenderer'.

ERR! Type 'Element' is not assignable to type 'string'.

ERR!

ERR! 117 customTextRenderer={this.customTextRenderer}

ERR! ~~~~~~~~~~~~~~~~~~

```

I saw the the type of the customTextRenderer is changed to:

```

export type CustomTextRenderer = (props: {

pageIndex: number;

pageNumber: number;

itemIndex: number;

} & TextItem) => string;

```

Can we patch this commit with isEvalSupported =  false to v4.2.* ?

```

Sorry, something went wrong.

All reactions

[![@wojtekmaj](https://avatars.githubusercontent.com/u/5426427?s=80&v=4)](/wojtekmaj)

Copy link

Owner

Author

### @wojtekmaj **[wojtekmaj](/wojtekmaj)** commented on `[671e6ea](/wojtekmaj/react-pdf/commit/671e6eaa2e373e404040c13cc6b668fe39839cad)` [May 15, 2024](#commitcomment-142042924)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Path for upgrade is clearly outlined both in Wiki and release notes for every major version.

Only v7 and v8 have received a patch and I'm not planning to support older versions.

Read more: [#1786](https://github.com/wojtekmaj/react-pdf/discussions/1786)

Sorry, something went wrong.

All reactions

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fwojtekmaj%2Freact-pdf%2Fcommit%2F671e6eaa2e373e404040c13cc6b668fe39839cad) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_b885ee51_20250110_122035.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fpull%2F18015)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fpull%2F18015)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=mozilla%2Fpdf.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mozilla](/mozilla)
/
**[pdf.js](/mozilla/pdf.js)**
Public

* [Notifications](/login?return_to=%2Fmozilla%2Fpdf.js) You must be signed in to change notification settings
* [Fork
  10.1k](/login?return_to=%2Fmozilla%2Fpdf.js)
* [Star
   49.3k](/login?return_to=%2Fmozilla%2Fpdf.js)

* [Code](/mozilla/pdf.js)
* [Issues
  376](/mozilla/pdf.js/issues)
* [Pull requests
  32](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects
  1](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

Additional navigation options

* [Code](/mozilla/pdf.js)
* [Issues](/mozilla/pdf.js/issues)
* [Pull requests](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fmozilla%2Fpdf.js%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fmozilla%2Fpdf.js%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Simplify the way to pass the glyph drawing instructions from the worker to the main thread #18015

 Merged

[calixteman](/calixteman)
merged 1 commit into
[mozilla:master](/mozilla/pdf.js/tree/master "mozilla/pdf.js:master")
from
[calixteman:rm\_eval\_font\_loader](/calixteman/pdf.js/tree/rm_eval_font_loader "calixteman/pdf.js:rm_eval_font_loader")

Apr 28, 2024

 Merged

# [Simplify the way to pass the glyph drawing instructions from the worker to the main thread](#top) #18015

[calixteman](/calixteman)
merged 1 commit into
[mozilla:master](/mozilla/pdf.js/tree/master "mozilla/pdf.js:master")
from
[calixteman:rm\_eval\_font\_loader](/calixteman/pdf.js/tree/rm_eval_font_loader "calixteman/pdf.js:rm_eval_font_loader")

Apr 28, 2024

+150

−61

[Conversation
10](/mozilla/pdf.js/pull/18015)
[Commits
1](/mozilla/pdf.js/pull/18015/commits)
[Checks
9](/mozilla/pdf.js/pull/18015/checks)
[Files changed
5](/mozilla/pdf.js/pull/18015/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![calixteman](https://avatars.githubusercontent.com/u/5641725?s=60&v=4)](/calixteman)

Copy link

Contributor

### @calixteman **[calixteman](/calixteman)** commented [Apr 28, 2024](#issue-2267714829)

and remove the use of eval in the font loader.

Sorry, something went wrong.

 👍
3
 zzr-wzj, sha2084, and T0NG-J reacted with thumbs up emoji

All reactions

* 👍
  3 reactions

[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)

`[Simplify the way to pass the glyph drawing instructions from the work…](/mozilla/pdf.js/pull/18015/commits/551e63901c4e19450673c4832ef2235cf8f2fffa "Simplify the way to pass the glyph drawing instructions from the worker to the main thread

and remove the use of eval in the font loader.")`
 …

`[551e639](/mozilla/pdf.js/pull/18015/commits/551e63901c4e19450673c4832ef2235cf8f2fffa)`

```
…er to the main thread

and remove the use of eval in the font loader.
```

[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=80&v=4)](/calixteman)

Copy link

Contributor

Author

### **[calixteman](/calixteman)** commented [Apr 28, 2024](#issuecomment-2081579400)

| /botio test |
| --- |

All reactions

Sorry, something went wrong.

[![@moz-tools-bot](https://avatars.githubusercontent.com/u/59021053?s=80&u=16301cae53f5a0b7920befe91b48f4b0db8f1059&v=4)](/moz-tools-bot)

Copy link

Collaborator

### **[moz-tools-bot](/moz-tools-bot)** commented [Apr 28, 2024](#issuecomment-2081579407)

| From: Bot.io (Linux m4)  ---  Received Command **cmd\_test** from [@calixteman](https://github.com/calixteman) received. Current queue size: 0  Live output at: <http://54.241.84.105:8877/c1ca9a99111a8e2/output.txt> |
| --- |

All reactions

Sorry, something went wrong.

[![@moz-tools-bot](https://avatars.githubusercontent.com/u/59021053?s=80&u=16301cae53f5a0b7920befe91b48f4b0db8f1059&v=4)](/moz-tools-bot)

Copy link

Collaborator

### **[moz-tools-bot](/moz-tools-bot)** commented [Apr 28, 2024](#issuecomment-2081579408)

| From: Bot.io (Windows)  ---  Received Command **cmd\_test** from [@calixteman](https://github.com/calixteman) received. Current queue size: 0  Live output at: <http://54.193.163.58:8877/a833d31f5fba71b/output.txt> |
| --- |

All reactions

Sorry, something went wrong.

[![@moz-tools-bot](https://avatars.githubusercontent.com/u/59021053?s=80&u=16301cae53f5a0b7920befe91b48f4b0db8f1059&v=4)](/moz-tools-bot)

Copy link

Collaborator

### **[moz-tools-bot](/moz-tools-bot)** commented [Apr 28, 2024](#issuecomment-2081589657)

| From: Bot.io (Linux m4)  ---  Failed Full output at <http://54.241.84.105:8877/c1ca9a99111a8e2/output.txt>  Total script time: 27.17 mins   * **Unit tests:** Passed * **Integration Tests:** Passed * **Regression tests:** FAILED  ```   different ref/snapshot: 18   different first/second rendering: 3  ```  Image differences available at: <http://54.241.84.105:8877/c1ca9a99111a8e2/reftest-analyzer.html#web=eq.log> |
| --- |

All reactions

Sorry, something went wrong.

[![@moz-tools-bot](https://avatars.githubusercontent.com/u/59021053?s=80&u=16301cae53f5a0b7920befe91b48f4b0db8f1059&v=4)](/moz-tools-bot)

Copy link

Collaborator

### **[moz-tools-bot](/moz-tools-bot)** commented [Apr 28, 2024](#issuecomment-2081596794)

| From: Bot.io (Windows)  ---  Failed Full output at <http://54.193.163.58:8877/a833d31f5fba71b/output.txt>  Total script time: 42.14 mins   * **Unit tests:** Passed * **Integration Tests:** Passed * **Regression tests:** FAILED  ```   different ref/snapshot: 2  ```  Image differences available at: <http://54.193.163.58:8877/a833d31f5fba71b/reftest-analyzer.html#web=eq.log> |
| --- |

All reactions

Sorry, something went wrong.

 [![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)
[calixteman](/calixteman)
requested a review
from [Snuffleupagus](/Snuffleupagus)
[April 28, 2024 19:37](#event-12635678947)

[![Snuffleupagus](https://avatars.githubusercontent.com/u/2692120?s=60&v=4)](/Snuffleupagus)

**[Snuffleupagus](/Snuffleupagus)**
approved these changes
[Apr 28, 2024](#pullrequestreview-2027355227)

 [View reviewed changes](/mozilla/pdf.js/pull/18015/files/551e63901c4e19450673c4832ef2235cf8f2fffa)

[![@Snuffleupagus](https://avatars.githubusercontent.com/u/2692120?s=40&v=4)](/Snuffleupagus)
[Snuffleupagus](/Snuffleupagus)
added
the
[font-conversion](/mozilla/pdf.js/labels/font-conversion)
label
[Apr 28, 2024](#event-12635856582)

 Hide details
View details

[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)
[calixteman](/calixteman)
merged commit [`85e64b5`](/mozilla/pdf.js/commit/85e64b5c16c9aaef738f421733c12911a441cec6)
into
mozilla:master

[Apr 28, 2024](https://github.com/mozilla/pdf.js/pull/18015#event-12635941293)
8 of 9 checks passed

 [![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)
[calixteman](/calixteman)
deleted the
rm\_eval\_font\_loader

branch
[April 28, 2024 21:27](#event-12635941825)

[make-github-pseudonymous-again](/make-github-pseudonymous-again)
added a commit
to infoderm/patients
that referenced
this pull request
[May 11, 2024](#ref-commit-2ad2525)
[![@make-github-pseudonymous-again](https://avatars.githubusercontent.com/u/5165674?s=40&u=d68f1a55b14dbb4ecd0269bfc6fa4e1306c688b1&v=4)](/make-github-pseudonymous-again)

`[🔐 security: Disable user-input eval in pdfjs-dist usage.](/infoderm/patients/commit/2ad2525042b735226926d73b8e2ef76a802047dc ":closed_lock_with_key: security: Disable user-input eval in pdfjs-dist usage.

By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

See:
  - https://bugzilla.mozilla.org/show_bug.cgi?id=1893645
  - https://www.cve.org/CVERecord?id=CVE-2024-4367
  - https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403
  - https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq.
  - https://github.com/mozilla/pdf.js/pull/18015
  - https://github.com/wojtekmaj/react-pdf/discussions/1786
  - https://security.stackexchange.com/questions/248462/is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/248985#248985
  - https://stackoverflow.com/questions/49299000/what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - https://github.com/mozilla/pdf.js/issues/10818")`
…

`[2ad2525](/infoderm/patients/commit/2ad2525042b735226926d73b8e2ef76a802047dc)`

```
By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

See:
  - <https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>
  - <https://www.cve.org/CVERecord?id=CVE-2024-4367>
  - <https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403>
  - [GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq").
  - [mozilla/pdf.js#18015](https://github.com/mozilla/pdf.js/pull/18015)
  - [wojtekmaj/react-pdf#1786](https://github.com/wojtekmaj/react-pdf/discussions/1786)
  - <https://security.stackexchange.com/questions/248462/is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/248985#248985>
  - <https://stackoverflow.com/questions/49299000/what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js>
  - [mozilla/pdf.js#10818](https://github.com/mozilla/pdf.js/issues/10818)
```

[![@make-github-pseudonymous-again](https://avatars.githubusercontent.com/u/5165674?s=40&u=d68f1a55b14dbb4ecd0269bfc6fa4e1306c688b1&v=4)](/make-github-pseudonymous-again)
[make-github-pseudonymous-again](/make-github-pseudonymous-again)
mentioned this pull request
[May 11, 2024](#ref-pullrequest-2291051051)

[Fix CVE-2024-4367
infoderm/patients#935](/infoderm/patients/pull/935)
 Merged

[make-github-pseudonymous-again](/make-github-pseudonymous-again)
added a commit
to infoderm/patients
that referenced
this pull request
[May 11, 2024](#ref-commit-dd6ca32)
[![@make-github-pseudonymous-again](https://avatars.githubusercontent.com/u/5165674?s=40&u=d68f1a55b14dbb4ecd0269bfc6fa4e1306c688b1&v=4)](/make-github-pseudonymous-again)

`[🔐 security: Disable user-input eval in pdfjs-dist usage.](/infoderm/patients/commit/dd6ca327f92f10e1f3f2cff8aad983e8649a2566 ":closed_lock_with_key: security: Disable user-input eval in pdfjs-dist usage.

By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

For reference, see:
  - https://bugzilla.mozilla.org/show_bug.cgi?id=1893645
  - https://www.cve.org/CVERecord?id=CVE-2024-4367
  - https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403
  - https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq
  - https://github.com/mozilla/pdf.js/pull/18015
  - https://github.com/wojtekmaj/react-pdf/discussions/1786
  - https://security.stackexchange.com/questions/248462/\
    is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/\
    248985
  - https://stackoverflow.com/questions/49299000/\
    what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - https://github.com/mozilla/pdf.js/issues/10818

Not sure if this will break anything and/or will make certain things
slower.")`
…

`[dd6ca32](/infoderm/patients/commit/dd6ca327f92f10e1f3f2cff8aad983e8649a2566)`

```
By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

For reference, see:
  - <https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>
  - <https://www.cve.org/CVERecord?id=CVE-2024-4367>
  - <https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403>
  - [GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq")
  - [mozilla/pdf.js#18015](https://github.com/mozilla/pdf.js/pull/18015)
  - [wojtekmaj/react-pdf#1786](https://github.com/wojtekmaj/react-pdf/discussions/1786)
  - [https://security.stackexchange.com/questions/248462/\](https://security.stackexchange.com/questions/248462/%5C)
    is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/\
    248985
  - [https://stackoverflow.com/questions/49299000/\](https://stackoverflow.com/questions/49299000/%5C)
    what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - [mozilla/pdf.js#10818](https://github.com/mozilla/pdf.js/issues/10818)

Not sure if this will break anything and/or will make certain things
slower.
```

[make-github-pseudonymous-again](/make-github-pseudonymous-again)
added a commit
to infoderm/patients
that referenced
this pull request
[May 11, 2024](#ref-commit-9489f5a)
[![@make-github-pseudonymous-again](https://avatars.githubusercontent.com/u/5165674?s=40&u=d68f1a55b14dbb4ecd0269bfc6fa4e1306c688b1&v=4)](/make-github-pseudonymous-again)

`[🔐 security: Disable user-input eval in pdfjs-dist usage.](/infoderm/patients/commit/9489f5af54d995e573bbd37820641d5bcfd56fe4 ":closed_lock_with_key: security: Disable user-input eval in pdfjs-dist usage.

By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

See:
  - https://bugzilla.mozilla.org/show_bug.cgi?id=1893645
  - https://www.cve.org/CVERecord?id=CVE-2024-4367
  - https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403
  - https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq.
  - https://github.com/mozilla/pdf.js/pull/18015
  - https://github.com/wojtekmaj/react-pdf/discussions/1786
  - https://security.stackexchange.com/questions/248462/is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/248985#248985
  - https://stackoverflow.com/questions/49299000/what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - https://github.com/mozilla/pdf.js/issues/10818")`
…

`[9489f5a](/infoderm/patients/commit/9489f5af54d995e573bbd37820641d5bcfd56fe4)`

```
By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

See:
  - <https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>
  - <https://www.cve.org/CVERecord?id=CVE-2024-4367>
  - <https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403>
  - [GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq").
  - [mozilla/pdf.js#18015](https://github.com/mozilla/pdf.js/pull/18015)
  - [wojtekmaj/react-pdf#1786](https://github.com/wojtekmaj/react-pdf/discussions/1786)
  - <https://security.stackexchange.com/questions/248462/is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/248985#248985>
  - <https://stackoverflow.com/questions/49299000/what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js>
  - [mozilla/pdf.js#10818](https://github.com/mozilla/pdf.js/issues/10818)
```

[github-merge-queue](/apps/github-merge-queue) bot
pushed a commit
to infoderm/patients
that referenced
this pull request
[May 11, 2024](#ref-commit-a1ecaef)
[![@make-github-pseudonymous-again](https://avatars.githubusercontent.com/u/5165674?s=40&u=d68f1a55b14dbb4ecd0269bfc6fa4e1306c688b1&v=4)](/make-github-pseudonymous-again)

`[🔐 security: Disable user-input eval in pdfjs-dist usage.](/infoderm/patients/commit/a1ecaefdfaf3f613b5afb0ffc280dd0259899c58 ":closed_lock_with_key: security: Disable user-input eval in pdfjs-dist usage.

By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

For reference, see:
  - https://bugzilla.mozilla.org/show_bug.cgi?id=1893645
  - https://www.cve.org/CVERecord?id=CVE-2024-4367
  - https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403
  - https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq
  - https://github.com/mozilla/pdf.js/pull/18015
  - https://github.com/wojtekmaj/react-pdf/discussions/1786
  - https://security.stackexchange.com/questions/248462/\
    is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/\
    248985
  - https://stackoverflow.com/questions/49299000/\
    what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - https://github.com/mozilla/pdf.js/issues/10818

Not sure if this will break anything and/or will make certain things
slower.")`
…

`[a1ecaef](/infoderm/patients/commit/a1ecaefdfaf3f613b5afb0ffc280dd0259899c58)`

```
By default, pdfjs-dist optimizes some path resolution logic by compiling
a JavaScript function on the fly. The function is built using string
concatenation and no effort is made at sanitizing the parts it is
built from. These parts could contain user-input which leads to a code
injection vulnerability. This commit disables this default behavior.
An alternative is to upgrade pdfjs-dist to v4.2.67 or later.

For reference, see:
  - <https://bugzilla.mozilla.org/show_bug.cgi?id=1893645>
  - <https://www.cve.org/CVERecord?id=CVE-2024-4367>
  - <https://security.snyk.io/vuln/SNYK-JS-PDFJSDIST-6810403>
  - [GHSA-wgrm-67xf-hhpq](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq "GHSA-wgrm-67xf-hhpq")
  - [mozilla/pdf.js#18015](https://github.com/mozilla/pdf.js/pull/18015)
  - [wojtekmaj/react-pdf#1786](https://github.com/wojtekmaj/react-pdf/discussions/1786)
  - [https://security.stackexchange.com/questions/248462/\](https://security.stackexchange.com/questions/248462/%5C)
    is-firefoxs-new-javascript-support-within-pdf-files-a-security-concern/\
    248985
  - [https://stackoverflow.com/questions/49299000/\](https://stackoverflow.com/questions/49299000/%5C)
    what-are-the-security-implications-of-the-isevalsupported-option-in-pdf-js
  - [mozilla/pdf.js#10818](https://github.com/mozilla/pdf.js/issues/10818)

Not sure if this will break anything and/or will make certain things
slower.
```

This was referenced May 15, 2024

[chore(deps): update dependency n8n to v1.41.0
uniget-org/tools#4760](/uniget-org/tools/pull/4760)
 Merged

[chore(deps): update dependency n8n to v1.41.1
uniget-org/tools#4783](/uniget-org/tools/pull/4783)
 Merged

[stephanrauh](/stephanrauh)
pushed a commit
to stephanrauh/pdf.js
that referenced
this pull request
[May 16, 2024](#ref-commit-867382d)
[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman) [![@stephanrauh](https://avatars.githubusercontent.com/u/3045767?s=40&v=4)](/stephanrauh)

`[Merge pull request](/stephanrauh/pdf.js/commit/867382d125a18aae86b3f39ca13e6ab33748df1b "Merge pull request #18015 from calixteman/rm_eval_font_loader

Simplify the way to pass the glyph drawing instructions from the worker to the main thread") [mozilla#18015](https://github.com/mozilla/pdf.js/pull/18015) [from calixteman/rm_eval_font_loader](/stephanrauh/pdf.js/commit/867382d125a18aae86b3f39ca13e6ab33748df1b "Merge pull request #18015 from calixteman/rm_eval_font_loader

Simplify the way to pass the glyph drawing instructions from the worker to the main thread")`
…

`[867382d](/stephanrauh/pdf.js/commit/867382d125a18aae86b3f39ca13e6ab33748df1b)`

```
Simplify the way to pass the glyph drawing instructions from the worker to the main thread
```

[![@sebastiangarcia-elucid](https://avatars.githubusercontent.com/u/169367084?s=40&v=4)](/sebastiangarcia-elucid)
[sebastiangarcia-elucid](/sebastiangarcia-elucid)
mentioned this pull request
[May 17, 2024](#ref-issue-2302886988)

[[BUG]
compodoc/compodoc#1482](/compodoc/compodoc/issues/1482)

Closed

[![@foyaga](https://avatars.githubusercontent.com/u/62537001?s=40&v=4)](/foyaga)
[foyaga](/foyaga)
mentioned this pull request
[May 21, 2024](#ref-issue-2309253637)

[Mozilla pdfjs-dist安全漏洞(CVE-2024-4367)
foyaga/blog-timeline#239](/foyaga/blog-timeline/issues/239)

Open

[![@Rob--W](https://avatars.githubusercontent.com/u/1365071?s=80&u=a28e0813dc14227725639ff1d19a94f36319e285&v=4)](/Rob--W)

Copy link

Member

### **[Rob--W](/Rob--W)** commented [May 22, 2024](#issuecomment-2124596367)

| This PR is associated with the fix for [CVE-2024-4367](https://github.com/mozilla/pdf.js/security/advisories/GHSA-wgrm-67xf-hhpq) .  The advisory currently mentions `<= 4.1.392`, but in practice the version ranges are different, the precise details are below. Despite the presence of a version range that is unaffected by this specific bug, I still recommend using the latest versions only (v4.2.67+) because these older versions are also affected by another vulnerability ([CVE-2018-5158](https://github.com/advisories/GHSA-7jg2-jgv3-fmr4 "CVE-2018-5158"); I've filed a PR to update the right metadata in Github's advisory database at [github/advisory-database#4456](https://github.com/github/advisory-database/pull/4456)).  PDF.js versions and statuses:   * [v4.2.67](https://github.com/mozilla/pdf.js/releases/tag/v4.2.67) (released April 29, 2024) **unaffected** (fixed)   + Commit: [85e64b5](https://github.com/mozilla/pdf.js/commit/85e64b5c16c9aaef738f421733c12911a441cec6)   + Pull request: [Simplify the way to pass the glyph drawing instructions from the worker to the main thread #18015](https://github.com/mozilla/pdf.js/pull/18015) * [v4.1.392](https://github.com/mozilla/pdf.js/releases/tag/v4.1.392) (released April 11, 2024) affected (release before this bug was fixed) * [v1.10.88](https://github.com/mozilla/pdf.js/releases/tag/v1.10.88) (released Oct 27, 2017) affected (re-introduces the security vulnerability due to a typo fix)   + Commit: [ab4d5be](https://github.com/mozilla/pdf.js/commit/ab4d5be19294e3dc2972efd07d1c1373cc8e7e85)   + Pull request: [Mispelled isEvalSupported property at FontFaceObject() creation. #9008](https://github.com/mozilla/pdf.js/pull/9008) * [v1.9.426](https://github.com/mozilla/pdf.js/releases/tag/v1.9.426) (released Aug 15, 2017) **unaffected** (release before the next affected version) * [v1.5.188](https://github.com/mozilla/pdf.js/releases/tag/v1.5.188) (released Apr 21, 2016) **unaffected** (mitigated the security vulnerability by an accidental typo)   + commit: [1d12aed](https://github.com/mozilla/pdf.js/commit/1d12aed5cac6a0caccb0550e0aad4ef9f6bb263d)   + Pull request: [Move all PDFJS display/ usages into global.js file. #7126](https://github.com/mozilla/pdf.js/pull/7126) - the typo is later fixed by PR 9008. * [v1.4.20](https://github.com/mozilla/pdf.js/releases/tag/v1.4.20) (released Jan 27, 2016) affected (release before the next release that accidentally fixed the vulnerable code) * [v0.8.1181](https://github.com/mozilla/pdf.js/releases/tag/v0.8.1181) (released Apr 10, 2014) affected (first public release of PDF.js)   + Commit: [0e133f0](https://github.com/mozilla/pdf.js/commit/0e133f00902b9fef8422a932385a61a38ca85545)   + Pull request: [Drawing without fillText; refactoring ADD\_TO\_PATH #3195](https://github.com/mozilla/pdf.js/pull/3195) |
| --- |

 👍
1
 imgss reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Sorry, something went wrong.

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[May 23, 2024](#ref-pullrequest-2313379430)

[chore(deps): update dependency n8n to v1.42.1
uniget-org/tools#4905](/uniget-org/tools/pull/4905)
 Merged

1 task

[![@mzedeler](https://avatars.githubusercontent.com/u/214645?s=40&v=4)](/mzedeler)
[mzedeler](/mzedeler)
mentioned this pull request
[Jun 4, 2024](#ref-pullrequest-2215065590)

[[api-minor] Replace the `PromiseCapability` with `Promise.withResolvers()`
#17854](/mozilla/pdf.js/pull/17854)
 Merged

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Jun 6, 2024](#ref-pullrequest-2338691092)

[chore(deps): update dependency n8n to v1.44.1
uniget-org/tools#5192](/uniget-org/tools/pull/5192)
 Merged

1 task

[![@zlm15122306538](https://avatars.githubusercontent.com/u/56725916?s=80&v=4)](/zlm15122306538)

Copy link

### **[zlm15122306538](/zlm15122306538)** commented [Jun 12, 2024](#issuecomment-2162249439) • edited Loading

| and remove the use of eval in the font loader.  If the version is not upgraded, set isEvalSupported: false in which file？ |
| --- |

All reactions

Sorry, something went wrong.

[![isaacl](https://avatars.githubusercontent.com/u/1027886?s=60&v=4)](/isaacl)

**[isaacl](/isaacl)**
reviewed
[Jun 12, 2024](#pullrequestreview-2113017898)

 [View reviewed changes](/mozilla/pdf.js/pull/18015/files/551e63901c4e19450673c4832ef2235cf8f2fffa)

[src/display/font\_loader.js](/mozilla/pdf.js/pull/18015/files/551e63901c4e19450673c4832ef2235cf8f2fffa#diff-90a759422e3850ff1c8e4f1fc23b0a83aa06e995b69adfe3739afc877b3aec45)

|  |  | jsBuf.push("c.", current.cmd, "(", args, ");\n"); |
| --- | --- | --- |
|  |  | const commands = []; |
|  |  | for (let i = 0, ii = cmds.length; i < ii; ) { |
|  |  | switch (cmds[i++]) { |

Copy link

### @isaacl **[isaacl](/isaacl)** [Jun 12, 2024](#discussion_r1636461167)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

This is an odd way to increment a for loop.

Sorry, something went wrong.

All reactions

Copy link

Contributor

Author

### @calixteman **[calixteman](/calixteman)** [Jun 12, 2024](#discussion_r1636468821)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

If you think we can do better, please file an issue and write a PR, thank you.

Just for your information, each command is followed by its arguments where their length depends on the command.

So here, after `i++`, `i` is the position for the first argument, and then each `case` will increment it depending on the number of arguments.

Sorry, something went wrong.

 👍
1
 isaacl reacted with thumbs up emoji

All reactions

* 👍
  1 reaction

Copy link

### @isaacl **[isaacl](/isaacl)** [Jun 12, 2024](#discussion_r1636612228)

There was a problem hiding this comment.

### Choose a reason for hiding this comment

The reason will be displayed to describe this comment to others. [Learn more](https://docs.github.com/articles/managing-disruptive-comments/#hiding-a-comment).

Choose a reason

Spam
Abuse
Off Topic
Outdated
Duplicate
Resolved

Hide comment

Apologies -- I didn't realize `i` was also being incremented in the switch block. I withdraw my comment.

Sorry, something went wrong.

All reactions

This was referenced Jun 12, 2024

[chore(deps): update dependency n8n to v1.44.2
uniget-org/tools#5295](/uniget-org/tools/pull/5295)
 Merged

[chore(deps): update dependency n8n to v1.45.1
uniget-org/tools#5334](/uniget-org/tools/pull/5334)
 Merged

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Jun 27, 2024](#ref-pullrequest-2378611904)

[chore(deps): update dependency n8n to v1.47.1
uniget-org/tools#5588](/uniget-org/tools/pull/5588)
 Merged

1 task

12 hidden items

Load more…

This was referenced Aug 22, 2024

[chore(deps): update dependency n8n to v1.55.3
uniget-org/tools#6698](/uniget-org/tools/pull/6698)
 Merged

[chore(deps): update dependency n8n to v1.56.2
uniget-org/tools#6816](/uniget-org/tools/pull/6816)
 Merged

This was referenced Sep 5, 2024

[chore(deps): update dependency n8n to v1.57.0
uniget-org/tools#6978](/uniget-org/tools/pull/6978)
 Merged

[chore(deps): update dependency n8n to v1.58.1
uniget-org/tools#7094](/uniget-org/tools/pull/7094)
 Merged

[chore(deps): update dependency n8n to v1.58.2
uniget-org/tools#7116](/uniget-org/tools/pull/7116)
 Merged

This was referenced Sep 18, 2024

[chore(deps): update dependency n8n to v1.59.3
uniget-org/tools#7222](/uniget-org/tools/pull/7222)
 Merged

[chore(deps): update dependency n8n to v1.59.4
uniget-org/tools#7270](/uniget-org/tools/pull/7270)
 Merged

This was referenced Sep 25, 2024

[chore(deps): update dependency n8n to v1.60.1
uniget-org/tools#7355](/uniget-org/tools/pull/7355)
 Merged

[chore(deps): update dependency n8n to v1.61.0
uniget-org/tools#7476](/uniget-org/tools/pull/7476)
 Merged

This was referenced Oct 10, 2024

[chore(deps): update dependency n8n to v1.62.3
uniget-org/tools#7631](/uniget-org/tools/pull/7631)
 Merged

[chore(deps): update dependency n8n to v1.62.4
uniget-org/tools#7645](/uniget-org/tools/pull/7645)
 Merged

[chore(deps): update dependency n8n to v1.62.5
uniget-org/tools#7663](/uniget-org/tools/pull/7663)
 Merged

[Check dependencies
uniget-org/tools#7651](/uniget-org/tools/pull/7651)
 Merged

[chore(deps): update dependency n8n to v1.62.6
uniget-org/tools#7703](/uniget-org/tools/pull/7703)
 Merged

[chore(deps): update dependency n8n to v1.63.4
uniget-org/tools#7736](/uniget-org/tools/pull/7736)
 Merged

This was referenced Oct 24, 2024

[chore(deps): update dependency n8n to v1.64.2
uniget-org/tools#7915](/uniget-org/tools/pull/7915)
 Merged

[chore(deps): update dependency n8n to v1.64.3
uniget-org/tools#7942](/uniget-org/tools/pull/7942)
 Merged

This was referenced Nov 1, 2024

[chore(deps): update dependency n8n to v1.65.2
uniget-org/tools#8110](/uniget-org/tools/pull/8110)
 Merged

[chore(deps): update dependency n8n to v1.66.0
uniget-org/tools#8217](/uniget-org/tools/pull/8217)
 Merged

This was referenced Nov 14, 2024

[chore(deps): update dependency n8n to v1.67.1
uniget-org/tools#8413](/uniget-org/tools/pull/8413)
 Merged

[chore(deps): update dependency n8n to v1.68.0
uniget-org/tools#8558](/uniget-org/tools/pull/8558)
 Merged

This was referenced Nov 26, 2024

[chore(deps): update dependency n8n to v1.68.1
uniget-org/tools#8661](/uniget-org/tools/pull/8661)
 Merged

[chore(deps): update dependency n8n to v1.69.2
uniget-org/tools#8694](/uniget-org/tools/pull/8694)
 Merged

This was referenced Dec 4, 2024

[chore(deps): update dependency n8n to v1.70.2
uniget-org/tools#8830](/uniget-org/tools/pull/8830)
 Merged

[chore(deps): update dependency n8n to v1.70.3
uniget-org/tools#8870](/uniget-org/tools/pull/8870)
 Merged

[chore(deps): update dependency n8n to v1.70.4
uniget-org/tools#8955](/uniget-org/tools/pull/8955)
 Merged

This was referenced Dec 11, 2024

[chore(deps): update dependency n8n to v1.71.2
uniget-org/tools#8997](/uniget-org/tools/pull/8997)
 Merged

[chore(deps): update dependency n8n to v1.71.3
uniget-org/tools#9022](/uniget-org/tools/pull/9022)
 Merged

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Dec 19, 2024](#ref-pullrequest-2750885203)

[chore(deps): update dependency n8n to v1.72.1
uniget-org/tools#9197](/uniget-org/tools/pull/9197)
 Merged

1 task

[![@github-actions](https://avatars.githubusercontent.com/in/15368?s=40&v=4)](/apps/github-actions)
[github-actions](/apps/github-actions)
bot
mentioned this pull request
[Jan 10, 2025](#ref-pullrequest-2779100411)

[chore(deps): update dependency n8n to v1.73.1
uniget-org/tools#9501](/uniget-org/tools/pull/9501)
 Merged

1 task

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fpull%2F18015)

Reviewers

[![@isaacl](https://avatars.githubusercontent.com/u/1027886?s=40&v=4)](/isaacl) [isaacl](/isaacl)

isaacl left review comments

[![@Snuffleupagus](https://avatars.githubusercontent.com/u/2692120?s=40&v=4)](/Snuffleupagus) [Snuffleupagus](/Snuffleupagus)

Snuffleupagus approved these changes

Assignees

No one assigned

Labels

[font-conversion](/mozilla/pdf.js/labels/font-conversion)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

7 participants

[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=52&v=4)](/calixteman) [![@moz-tools-bot](https://avatars.githubusercontent.com/u/59021053?s=52&v=4)](/moz-tools-bot) [![@Rob--W](https://avatars.githubusercontent.com/u/1365071?s=52&v=4)](/Rob--W) [![@zlm15122306538](https://avatars.githubusercontent.com/u/56725916?s=52&v=4)](/zlm15122306538) [![@isaacl](https://avatars.githubusercontent.com/u/1027886?s=52&v=4)](/isaacl) [![@mildsunrise](https://avatars.githubusercontent.com/u/1177304?s=52&v=4)](/mildsunrise) [![@Snuffleupagus](https://avatars.githubusercontent.com/u/2692120?s=52&v=4)](/Snuffleupagus)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_e2e7da40_20250110_122033.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fcommit%2F85e64b5c16c9aaef738f421733c12911a441cec6)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fcommit%2F85e64b5c16c9aaef738f421733c12911a441cec6)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=mozilla%2Fpdf.js)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[mozilla](/mozilla)
/
**[pdf.js](/mozilla/pdf.js)**
Public

* [Notifications](/login?return_to=%2Fmozilla%2Fpdf.js) You must be signed in to change notification settings
* [Fork
  10.1k](/login?return_to=%2Fmozilla%2Fpdf.js)
* [Star
   49.3k](/login?return_to=%2Fmozilla%2Fpdf.js)

* [Code](/mozilla/pdf.js)
* [Issues
  376](/mozilla/pdf.js/issues)
* [Pull requests
  32](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects
  1](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

Additional navigation options

* [Code](/mozilla/pdf.js)
* [Issues](/mozilla/pdf.js/issues)
* [Pull requests](/mozilla/pdf.js/pulls)
* [Discussions](/mozilla/pdf.js/discussions)
* [Actions](/mozilla/pdf.js/actions)
* [Projects](/mozilla/pdf.js/projects)
* [Wiki](/mozilla/pdf.js/wiki)
* [Security](/mozilla/pdf.js/security)
* [Insights](/mozilla/pdf.js/pulse)

## Commit

[Permalink](/mozilla/pdf.js/commit/85e64b5c16c9aaef738f421733c12911a441cec6)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Merge pull request [#18015](https://github.com/mozilla/pdf.js/pull/18015) from calixteman/rm\_eval\_font\_loader

[Browse files](/mozilla/pdf.js/tree/85e64b5c16c9aaef738f421733c12911a441cec6)
Browse the repository at this point in the history

```
Simplify the way to pass the glyph drawing instructions from the worker to the main thread
```

* Loading branch information

[![@calixteman](https://avatars.githubusercontent.com/u/5641725?s=40&v=4)](/calixteman)

[calixteman](/mozilla/pdf.js/commits?author=calixteman "View all commits by calixteman")
authored
Apr 28, 2024

2 parents
[90d4b9c](/mozilla/pdf.js/commit/90d4b9c2c0df7cadbd5c2388431b208f08da1ed6)
+
[551e639](/mozilla/pdf.js/commit/551e63901c4e19450673c4832ef2235cf8f2fffa)

commit 85e64b5

 Show file tree

 Hide file tree

Showing
**5 changed files**
with
**150 additions**
and
**61 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + core

    - src/core/evaluator.js
      [evaluator.js](#diff-cf40014d9c7d352f3ae212e7fffe5386decf96a10e53066a4d900c3eb8fc559e)
    - src/core/font\_renderer.js
      [font\_renderer.js](#diff-1f75686043cdf0355087dde615c1eb96de4d726de04bca061d46e1f0c1a72a8b)
  + display

    - src/display/api.js
      [api.js](#diff-082d6b37ad01db7ac97cc07c6ddb0dc52040484c5ef91b110b072f50144d9f39)
    - src/display/font\_loader.js
      [font\_loader.js](#diff-90a759422e3850ff1c8e4f1fc23b0a83aa06e995b69adfe3739afc877b3aec45)
  + shared

    - src/shared/util.js
      [util.js](#diff-820af4a764722bb36f3daf6f9cb815fedfece273073b21d858bb8aa5210e411c)

## There are no files selected for viewing

11 changes: 10 additions & 1 deletion

11
[src/core/evaluator.js](#diff-cf40014d9c7d352f3ae212e7fffe5386decf96a10e53066a4d900c3eb8fc559e "src/core/evaluator.js")

Show comments

[View file](/mozilla/pdf.js/blob/85e64b5c16c9aaef738f421733c12911a441cec6/src/core/evaluator.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -4391,6 +4391,15 @@ class PartialEvaluator { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | let fontMatrix = dict.getArray("FontMatrix"); |
|  |  | if ( |
|  |  | !Array.isArray(fontMatrix) || |
|  |  | fontMatrix.length !== 6 || |
|  |  | fontMatrix.some(x => typeof x !== "number") |
|  |  | ) { |
|  |  | fontMatrix = FONT\_IDENTITY\_MATRIX; |
|  |  | } |
|  |  |  |
|  |  | const properties = { |
|  |  | type, |
|  |  | name: fontName.name, |
| Expand All | | @@ -4403,7 +4412,7 @@ class PartialEvaluator { |
|  |  | loadedName: baseDict.loadedName, |
|  |  | composite, |
|  |  | fixedPitch: false, |
|  |  | fontMatrix: dict.getArray("FontMatrix") || FONT\_IDENTITY\_MATRIX, |
|  |  | fontMatrix, |
|  |  | firstChar, |
|  |  | lastChar, |
|  |  | toUnicode, |
| Expand Down | |  |

77 changes: 51 additions & 26 deletions

77
[src/core/font\_renderer.js](#diff-1f75686043cdf0355087dde615c1eb96de4d726de04bca061d46e1f0c1a72a8b "src/core/font_renderer.js")

Show comments

[View file](/mozilla/pdf.js/blob/85e64b5c16c9aaef738f421733c12911a441cec6/src/core/font_renderer.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,6 +16,7 @@ |
|  |  | import { |
|  |  | bytesToString, |
|  |  | FONT\_IDENTITY\_MATRIX, |
|  |  | FontRenderOps, |
|  |  | FormatError, |
|  |  | unreachable, |
|  |  | warn, |
| Expand Down  Expand Up | | @@ -180,13 +181,13 @@ function lookupCmap(ranges, unicode) { |
|  |  |  |
|  |  | function compileGlyf(code, cmds, font) { |
|  |  | function moveTo(x, y) { |
|  |  | cmds.push({ cmd: "moveTo", args: [x, y] }); |
|  |  | cmds.add(FontRenderOps.MOVE\_TO, [x, y]); |
|  |  | } |
|  |  | function lineTo(x, y) { |
|  |  | cmds.push({ cmd: "lineTo", args: [x, y] }); |
|  |  | cmds.add(FontRenderOps.LINE\_TO, [x, y]); |
|  |  | } |
|  |  | function quadraticCurveTo(xa, ya, x, y) { |
|  |  | cmds.push({ cmd: "quadraticCurveTo", args: [xa, ya, x, y] }); |
|  |  | cmds.add(FontRenderOps.QUADRATIC\_CURVE\_TO, [xa, ya, x, y]); |
|  |  | } |
|  |  |  |
|  |  | let i = 0; |
| Expand Down  Expand Up | | @@ -247,20 +248,22 @@ function compileGlyf(code, cmds, font) { |
|  |  | if (subglyph) { |
|  |  | // TODO: the transform should be applied only if there is a scale: |
|  |  | // https://github.com/freetype/freetype/blob/edd4fedc5427cf1cf1f4b045e53ff91eb282e9d4/src/truetype/ttgload.c#L1205 |
|  |  | cmds.push( |
|  |  | { cmd: "save" }, |
|  |  | { |
|  |  | cmd: "transform", |
|  |  | args: [scaleX, scale01, scale10, scaleY, x, y], |
|  |  | } |
|  |  | ); |
|  |  | cmds.add(FontRenderOps.SAVE); |
|  |  | cmds.add(FontRenderOps.TRANSFORM, [ |
|  |  | scaleX, |
|  |  | scale01, |
|  |  | scale10, |
|  |  | scaleY, |
|  |  | x, |
|  |  | y, |
|  |  | ]); |
|  |  |  |
|  |  | if (!(flags & 0x02)) { |
|  |  | // TODO: we must use arg1 and arg2 to make something similar to: |
|  |  | // https://github.com/freetype/freetype/blob/edd4fedc5427cf1cf1f4b045e53ff91eb282e9d4/src/truetype/ttgload.c#L1209 |
|  |  | } |
|  |  | compileGlyf(subglyph, cmds, font); |
|  |  | cmds.push({ cmd: "restore" }); |
|  |  | cmds.add(FontRenderOps.RESTORE); |
|  |  | } |
|  |  | } while (flags & 0x20); |
|  |  | } else { |
| Expand Down  Expand Up | | @@ -365,13 +368,13 @@ function compileGlyf(code, cmds, font) { |
|  |  |  |
|  |  | function compileCharString(charStringCode, cmds, font, glyphId) { |
|  |  | function moveTo(x, y) { |
|  |  | cmds.push({ cmd: "moveTo", args: [x, y] }); |
|  |  | cmds.add(FontRenderOps.MOVE\_TO, [x, y]); |
|  |  | } |
|  |  | function lineTo(x, y) { |
|  |  | cmds.push({ cmd: "lineTo", args: [x, y] }); |
|  |  | cmds.add(FontRenderOps.LINE\_TO, [x, y]); |
|  |  | } |
|  |  | function bezierCurveTo(x1, y1, x2, y2, x, y) { |
|  |  | cmds.push({ cmd: "bezierCurveTo", args: [x1, y1, x2, y2, x, y] }); |
|  |  | cmds.add(FontRenderOps.BEZIER\_CURVE\_TO, [x1, y1, x2, y2, x, y]); |
|  |  | } |
|  |  |  |
|  |  | const stack = []; |
| Expand Down  Expand Up | | @@ -544,7 +547,8 @@ function compileCharString(charStringCode, cmds, font, glyphId) { |
|  |  | const bchar = stack.pop(); |
|  |  | y = stack.pop(); |
|  |  | x = stack.pop(); |
|  |  | cmds.push({ cmd: "save" }, { cmd: "translate", args: [x, y] }); |
|  |  | cmds.add(FontRenderOps.SAVE); |
|  |  | cmds.add(FontRenderOps.TRANSLATE, [x, y]); |
|  |  | let cmap = lookupCmap( |
|  |  | font.cmap, |
|  |  | String.fromCharCode(font.glyphNameMap[StandardEncoding[achar]]) |
| Expand All | | @@ -555,7 +559,7 @@ function compileCharString(charStringCode, cmds, font, glyphId) { |
|  |  | font, |
|  |  | cmap.glyphId |
|  |  | ); |
|  |  | cmds.push({ cmd: "restore" }); |
|  |  | cmds.add(FontRenderOps.RESTORE); |
|  |  |  |
|  |  | cmap = lookupCmap( |
|  |  | font.cmap, |
| Expand Down  Expand Up | | @@ -741,6 +745,27 @@ function compileCharString(charStringCode, cmds, font, glyphId) { |
|  |  |  |
|  |  | const NOOP = []; |
|  |  |  |
|  |  | class Commands { |
|  |  | cmds = []; |
|  |  |  |
|  |  | add(cmd, args) { |
|  |  | if (args) { |
|  |  | if (args.some(arg => typeof arg !== "number")) { |
|  |  | warn( |
|  |  | `Commands.add - "${cmd}" has at least one non-number arg: "${args}".` |
|  |  | ); |
|  |  | // "Fix" the wrong args by replacing them with 0. |
|  |  | const newArgs = args.map(arg => (typeof arg === "number" ? arg : 0)); |
|  |  | this.cmds.push(cmd, ...newArgs); |
|  |  | } else { |
|  |  | this.cmds.push(cmd, ...args); |
|  |  | } |
|  |  | } else { |
|  |  | this.cmds.push(cmd); |
|  |  | } |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | class CompiledFont { |
|  |  | constructor(fontMatrix) { |
|  |  | if (this.constructor === CompiledFont) { |
| Expand All | | @@ -757,8 +782,10 @@ class CompiledFont { |
|  |  | let fn = this.compiledGlyphs[glyphId]; |
|  |  | if (!fn) { |
|  |  | try { |
|  |  | fn = this.compileGlyph(this.glyphs[glyphId], glyphId); |
|  |  | this.compiledGlyphs[glyphId] = fn; |
|  |  | fn = this.compiledGlyphs[glyphId] = this.compileGlyph( |
|  |  | this.glyphs[glyphId], |
|  |  | glyphId |
|  |  | ); |
|  |  | } catch (ex) { |
|  |  | // Avoid attempting to re-compile a corrupt glyph. |
|  |  | this.compiledGlyphs[glyphId] = NOOP; |
| Expand Down  Expand Up | | @@ -793,16 +820,14 @@ class CompiledFont { |
|  |  | } |
|  |  | } |
|  |  |  |
|  |  | const cmds = [ |
|  |  | { cmd: "save" }, |
|  |  | { cmd: "transform", args: fontMatrix.slice() }, |
|  |  | { cmd: "scale", args: ["size", "-size"] }, |
|  |  | ]; |
|  |  | const cmds = new Commands(); |
|  |  | cmds.add(FontRenderOps.SAVE); |
|  |  | cmds.add(FontRenderOps.TRANSFORM, fontMatrix.slice()); |
|  |  | cmds.add(FontRenderOps.SCALE); |
|  |  | this.compileGlyphImpl(code, cmds, glyphId); |
|  |  | cmds.add(FontRenderOps.RESTORE); |
|  |  |  |
|  |  | cmds.push({ cmd: "restore" }); |
|  |  |  |
|  |  | return cmds; |
|  |  | return cmds.cmds; |
|  |  | } |
|  |  |  |
|  |  | compileGlyphImpl() { |
| Expand Down | |  |

6 changes: 2 additions & 4 deletions

6
[src/display/api.js](#diff-082d6b37ad01db7ac97cc07c6ddb0dc52040484c5ef91b110b072f50144d9f39 "src/display/api.js")

Show comments

[View file](/mozilla/pdf.js/blob/85e64b5c16c9aaef738f421733c12911a441cec6/src/display/api.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -169,8 +169,8 @@ const DefaultStandardFontDataFactory = |
|  |  | \* pixels, i.e. width \* height. Images above this value will not be rendered. |
|  |  | \* Use -1 for no limit, which is also the default value. |
|  |  | \* @property {boolean} [isEvalSupported] - Determines if we can evaluate strings |
|  |  | \* as JavaScript. Primarily used to improve performance of font rendering, and |
|  |  | \* when parsing PDF functions. The default value is `true`. |
|  |  | \* as JavaScript. Primarily used to improve performance of PDF functions. |
|  |  | \* The default value is `true`. |
|  |  | \* @property {boolean} [isOffscreenCanvasSupported] - Determines if we can use |
|  |  | \* `OffscreenCanvas` in the worker. Primarily used to improve performance of |
|  |  | \* image conversion/rendering. |
| Expand Down  Expand Up | | @@ -384,7 +384,6 @@ function getDocument(src) { |
|  |  | }; |
|  |  | const transportParams = { |
|  |  | ignoreErrors, |
|  |  | isEvalSupported, |
|  |  | disableFontFace, |
|  |  | fontExtraProperties, |
|  |  | enableXfa, |
| Expand Down  Expand Up | | @@ -2744,7 +2743,6 @@ class WorkerTransport { |
|  |  | ? (font, url) => globalThis.FontInspector.fontAdded(font, url) |
|  |  | : null; |
|  |  | const font = new FontFaceObject(exportedData, { |
|  |  | isEvalSupported: params.isEvalSupported, |
|  |  | disableFontFace: params.disableFontFace, |
|  |  | ignoreErrors: params.ignoreErrors, |
|  |  | inspectFont, |
| Expand Down | |  |

104 changes: 74 additions & 30 deletions

104
[src/display/font\_loader.js](#diff-90a759422e3850ff1c8e4f1fc23b0a83aa06e995b69adfe3739afc877b3aec45 "src/display/font_loader.js")

Show comments

[View file](/mozilla/pdf.js/blob/85e64b5c16c9aaef738f421733c12911a441cec6/src/display/font_loader.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -16,7 +16,7 @@ |
|  |  | import { |
|  |  | assert, |
|  |  | bytesToString, |
|  |  | FeatureTest, |
|  |  | FontRenderOps, |
|  |  | isNodeJS, |
|  |  | shadow, |
|  |  | string32, |
| Expand Down  Expand Up | | @@ -362,19 +362,13 @@ class FontLoader { |
|  |  | class FontFaceObject { |
|  |  | constructor( |
|  |  | translatedData, |
|  |  | { |
|  |  | isEvalSupported = true, |
|  |  | disableFontFace = false, |
|  |  | ignoreErrors = false, |
|  |  | inspectFont = null, |
|  |  | } |
|  |  | { disableFontFace = false, ignoreErrors = false, inspectFont = null } |
|  |  | ) { |
|  |  | this.compiledGlyphs = Object.create(null); |
|  |  | // importing translated data |
|  |  | for (const i in translatedData) { |
|  |  | this[i] = translatedData[i]; |
|  |  | } |
|  |  | this.isEvalSupported = isEvalSupported !== false; |
|  |  | this.disableFontFace = disableFontFace === true; |
|  |  | this.ignoreErrors = ignoreErrors === true; |
|  |  | this.\_inspectFont = inspectFont; |
| Expand Down  Expand Up | | @@ -440,35 +434,85 @@ class FontFaceObject { |
|  |  | throw ex; |
|  |  | } |
|  |  | warn(`getPathGenerator - ignoring character: "${ex}".`); |
|  |  | } |
|  |  |  |
|  |  | if (!Array.isArray(cmds) || cmds.length === 0) { |
|  |  | return (this.compiledGlyphs[character] = function (c, size) { |
|  |  | // No-op function, to allow rendering to continue. |
|  |  | }); |
|  |  | } |
|  |  |  |
|  |  | // If we can, compile cmds into JS for MAXIMUM SPEED... |
|  |  | if (this.isEvalSupported && FeatureTest.isEvalSupported) { |
|  |  | const jsBuf = []; |
|  |  | for (const current of cmds) { |
|  |  | const args = current.args !== undefined ? current.args.join(",") : ""; |
|  |  | jsBuf.push("c.", current.cmd, "(", args, ");\n"); |
|  |  | const commands = []; |
|  |  | for (let i = 0, ii = cmds.length; i < ii; ) { |
|  |  | switch (cmds[i++]) { |
|  |  | case FontRenderOps.BEZIER\_CURVE\_TO: |
|  |  | { |
|  |  | const [a, b, c, d, e, f] = cmds.slice(i, i + 6); |
|  |  | commands.push(ctx => ctx.bezierCurveTo(a, b, c, d, e, f)); |
|  |  | i += 6; |
|  |  | } |
|  |  | break; |
|  |  | case FontRenderOps.MOVE\_TO: |
|  |  | { |
|  |  | const [a, b] = cmds.slice(i, i + 2); |
|  |  | commands.push(ctx => ctx.moveTo(a, b)); |
|  |  | i += 2; |
|  |  | } |
|  |  | break; |
|  |  | case FontRenderOps.LINE\_TO: |
|  |  | { |
|  |  | const [a, b] = cmds.slice(i, i + 2); |
|  |  | commands.push(ctx => ctx.lineTo(a, b)); |
|  |  | i += 2; |
|  |  | } |
|  |  | break; |
|  |  | case FontRenderOps.QUADRATIC\_CURVE\_TO: |
|  |  | { |
|  |  | const [a, b, c, d] = cmds.slice(i, i + 4); |
|  |  | commands.push(ctx => ctx.quadraticCurveTo(a, b, c, d)); |
|  |  | i += 4; |
|  |  | } |
|  |  | break; |
|  |  | case FontRenderOps.RESTORE: |
|  |  | commands.push(ctx => ctx.restore()); |
|  |  | break; |
|  |  | case FontRenderOps.SAVE: |
|  |  | commands.push(ctx => ctx.save()); |
|  |  | break; |
|  |  | case FontRenderOps.SCALE: |
|  |  | // The scale command must be at the third position, after save and |
|  |  | // transform (for the font matrix) commands (see also |
|  |  | // font\_renderer.js). |
|  |  | // The goal is to just scale the canvas and then run the commands loop |
|  |  | // without the need to pass the size parameter to each command. |
|  |  | assert( |
|  |  | commands.length === 2, |
|  |  | "Scale command is only valid at the third position." |
|  |  | ); |
|  |  | break; |
|  |  | case FontRenderOps.TRANSFORM: |
|  |  | { |
|  |  | const [a, b, c, d, e, f] = cmds.slice(i, i + 6); |
|  |  | commands.push(ctx => ctx.transform(a, b, c, d, e, f)); |
|  |  | i += 6; |
|  |  | } |
|  |  | break; |
|  |  | case FontRenderOps.TRANSLATE: |
|  |  | { |
|  |  | const [a, b] = cmds.slice(i, i + 2); |
|  |  | commands.push(ctx => ctx.translate(a, b)); |
|  |  | i += 2; |
|  |  | } |
|  |  | break; |
|  |  | } |
|  |  | // eslint-disable-next-line no-new-func |
|  |  | return (this.compiledGlyphs[character] = new Function( |
|  |  | "c", |
|  |  | "size", |
|  |  | jsBuf.join("") |
|  |  | )); |
|  |  | } |
|  |  | // ... but fall back on using Function.prototype.apply() if we're |
|  |  | // blocked from using eval() for whatever reason (like CSP policies). |
|  |  | return (this.compiledGlyphs[character] = function (c, size) { |
|  |  | for (const current of cmds) { |
|  |  | if (current.cmd === "scale") { |
|  |  | current.args = [size, -size]; |
|  |  | } |
|  |  | // eslint-disable-next-line prefer-spread |
|  |  | c[current.cmd].apply(c, current.args); |
|  |  | } |
|  |  |  |
|  |  | return (this.compiledGlyphs[character] = function glyphDrawer(ctx, size) { |
|  |  | commands[0](ctx); |
|  |  | commands[1](ctx); |
|  |  | ctx.scale(size, -size); |
|  |  | for (let i = 2, ii = commands.length; i < ii; i++) { |
|  |  | commands[i](ctx); |
|  |  | } |
|  |  | }); |
|  |  | } |
| Expand Down | |  |

13 changes: 13 additions & 0 deletions

13
[src/shared/util.js](#diff-820af4a764722bb36f3daf6f9cb815fedfece273073b21d858bb8aa5210e411c "src/shared/util.js")

Show comments

[View file](/mozilla/pdf.js/blob/85e64b5c16c9aaef738f421733c12911a441cec6/src/shared/util.js)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -1073,6 +1073,18 @@ function getUuid() { |
|  |  |  |
|  |  | const AnnotationPrefix = "pdfjs\_internal\_id\_"; |
|  |  |  |
|  |  | const FontRenderOps = { |
|  |  | BEZIER\_CURVE\_TO: 0, |
|  |  | MOVE\_TO: 1, |
|  |  | LINE\_TO: 2, |
|  |  | QUADRATIC\_CURVE\_TO: 3, |
|  |  | RESTORE: 4, |
|  |  | SAVE: 5, |
|  |  | SCALE: 6, |
|  |  | TRANSFORM: 7, |
|  |  | TRANSLATE: 8, |
|  |  | }; |
|  |  |  |
|  |  | export { |
|  |  | AbortException, |
|  |  | AnnotationActionEventType, |
| Expand All | | @@ -1095,6 +1107,7 @@ export { |
|  |  | DocumentActionEventType, |
|  |  | FeatureTest, |
|  |  | FONT\_IDENTITY\_MATRIX, |
|  |  | FontRenderOps, |
|  |  | FormatError, |
|  |  | getModificationDate, |
|  |  | getUuid, |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `85e64b5`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmozilla%2Fpdf.js%2Fcommit%2F85e64b5c16c9aaef738f421733c12911a441cec6) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


