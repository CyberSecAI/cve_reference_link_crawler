Based on the provided information, this content is related to CVE-2024-40955.

**Root cause of vulnerability:**
The vulnerability is caused by an out-of-bounds read in the `ext4_mb_find_good_group_avg_frag_lists` function within the ext4 filesystem. This occurs when an oversized value is set for `s_mb_group_prealloc` via the sysfs interface, leading to an attempt to access an invalid index in the `s_mb_avg_fragment_size` list.

**Weaknesses/vulnerabilities present:**
- Slab-out-of-bounds read: Specifically, the code attempts to read beyond the bounds of the `s_mb_avg_fragment_size` array.
- Integer overflow/incorrect bounds check: The `s_mb_group_prealloc` value is not properly validated against the size of the `s_mb_avg_fragment_size` array.

**Impact of exploitation:**
- Kernel crash: The out-of-bounds read triggers a kernel panic due to KASAN (Kernel Address Sanitizer) detecting the memory access violation.
- Potential data corruption: Although not explicitly stated, out-of-bounds reads can sometimes lead to unexpected behavior or corruption of kernel memory.

**Attack vectors:**
- Sysfs interface: An attacker can write an oversized integer value to the `/sys/fs/ext4/$disk/mb_group_prealloc` file, thereby controlling the `s_mb_group_prealloc` value.
- File creation: After modifying the `mb_group_prealloc` value, writing data to a file on the mounted ext4 filesystem triggers the vulnerable code.

**Required attacker capabilities/position:**
- Mount an ext4 filesystem: The attacker needs to mount an ext4 filesystem.
- Write access via sysfs: The attacker needs write access to the specific sysfs entry.
- File write access: The attacker needs to be able to create or write to files on the mounted ext4 filesystem.
- Root privileges: The attacker needs root privileges to perform the described operations, especially writing to the sysfs interface and triggering the vulnerable code path.

**Additional details:**
- The fix involves adding a new `attr_id` called `attr_clusters_in_group` which is used for the `mb_group_prealloc` value. This enforces validation of the value to ensure it falls within the bounds of [0, `sbi->s_clusters_per_group`].
- Additionally, the code was changed to avoid returning an `order` from `mb_avg_fragment_size_order()` that is greater than `MB_NUM_ORDERS(sb)`.
- The vulnerability can be triggered using the provided commands `mkfs.ext4 -F /dev/$disk 10G`, `mount /dev/$disk /tmp/test`, `echo 2147483647 > /sys/fs/ext4/$disk/mb_group_prealloc` and `echo test > /tmp/test/file && sync`