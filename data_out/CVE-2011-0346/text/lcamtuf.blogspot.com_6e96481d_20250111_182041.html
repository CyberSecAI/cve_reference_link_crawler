

[skip to main](#main)  |
[skip to sidebar](#sidebar)

This is a personal blog. My other stuff:
[book](http://lcamtuf.coredump.cx/prep/) |
[home page](http://lcamtuf.coredump.cx/) |
[Substack](http://lcamtuf.substack.com)

# [lcamtuf's old blog](https://lcamtuf.blogspot.com/)

I retired this site back in 2022 for a couple of reasons. If you like the content, please subscribe to the new blog at *[lcamtuf.substack.com](https://lcamtuf.substack.com)*.

## January 01, 2011

### [Announcing cross\_fuzz, a potential 0-day in circulation, and more](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html)

I am happy to announce the availability of `cross_fuzz` - a surprisingly
effective but notoriously annoying cross-document DOM binding fuzzer that
helped identify about one hundred bugs in all browsers on the market - many of said bugs exploitable - and is still finding more.

The fuzzer owes much of its efficiency to dynamically generating extremely long-winding sequences of DOM operations across multiple documents, inspecting returned objects, recursing into them, and creating circular node references that stress-test garbage collection mechanisms.
Detailed `cross_fuzz` fuzzing algorithm:

1. Open two windows with documents of any (DOM-enabled) type. Simple HTML, XHTML, and SVG documents are randomly selected as targets by default - although any other, possibly plugin-supported formats could be targeted instead.

   - Crawl DOM hierarchy of the first document, collecting encountered object references for later reuse. Visited objects and collected references are tagged using an injected property to avoid infinite recursion; a secondary blacklist is used to prevent navigating away or descending into the master window. Critically, random shuffling and recursion fanout control are used to ensure good coverage.

     - Repeat DOM crawl, randomly tweaking encountered object properties by setting them to a one of the previously recorded references (or, with some probability, to one of a handful of hardcoded "interesting" values).

       - Repeat DOM crawl, randomly calling encountered object methods. Call parameters are synthesized using collected references and "interesting" values, as noted above. If a method returns an object, its output is subsequently crawled and tweaked in a similar manner.

         - Randomly destroy first document using one of the several possible methods, toggle garbage collection.

           - Perform the same set of crawl & tweak operations for the second document, but use references collected from the first document for overwriting properties and calling methods in the second one.

             - Randomly destroy document windows, carry over a percentage of collected references to the next fuzzing cycle.

This design can make it unexpectedly difficult to get clean, deterministic repros; to that effect, in the current versions of all the affected browsers, we are still seeing a collection of elusive problems when running the tool - and some not-so-elusive ones. I believe that at this point, a broader [community](http://www.chromium.org/Home/chromium-security/vulnerability-rewards-program) [involvement](http://www.mozilla.org/security/bug-bounty.html) may be instrumental to tracking down and resolving these bugs.

I also believe that at least one of the vulnerabilities discovered by `cross_fuzz` may be known to third parties - which makes getting this tool out a priority.

The following summarizes notification and patch status for all the affected vendors:

* **Internet Explorer:** MSRC notified in July 2010. Fuzzer known to trigger several clearly exploitable crashes ([example stack trace](http://lcamtuf.coredump.cx/cross_fuzz/msie_crash.txt) for `CVE-2011-0346`) and security-relevant GUI corruption issues (XP-only, [example](http://lcamtuf.coredump.cx/cross_fuzz/msie_display.jpg), `CVE-2011-0347`). >Reproducible, exploitable faults still present in current versions of the browser. I have reasons to believe that one of these vulnerabilities is [known to third parties](http://lcamtuf.coredump.cx/cross_fuzz/known_vuln.txt).

  *Comment: Vendor has acknowledged receiving the report in July (case `10205jr`), but has not contacted me again until my final ping in December. Following that contact attempt, they were able to quickly reproduce multiple exploitable crashes, and asked for the release of this tool to be postponed indefinitely. Since they have not provided a compelling explanation as to why these issues could not have been investigated earlier, I refused; see [this timeline](http://lcamtuf.coredump.cx/cross_fuzz/fuzzer_timeline.txt) for more.*

  * **All WebKit browsers:** WebKit project notified in July 2010. About two dozen crashes identified and addressed in [bug 42959](https://bugs.webkit.org/show_bug.cgi?id=42959) and related efforts by several volunteers. Relevant patches generally released with attribution in security bulletins. Some extremely hard-to-debug memory corruption problems still occurring on trunk.

    * **Firefox:** Mozilla notified in July 2010. Around 10 crashes addressed in [bug 581539](https://bugzilla.mozilla.org/show_bug.cgi?id=581539), with attribution in security bulletins where appropriate. Fuzzing approach subsequently rolled into [Jesse Ruderman's](http://www.squarefree.com/) fuzzing infrastructure under [bug 594645](https://bugzilla.mozilla.org/show_bug.cgi?id=594645) in September; from that point on, 50 additional bugs identified (generally with no specific attribution at patch time). Several elusive crashes still occurring on trunk. Bad read / write offset crashes in `npswf32.dll` can also be observed if the plugin is installed.

      * **Opera:** vendor notified in July 2010. Update provided in December states that Opera 11 fixed all the frequent crashes, and that a proper security advisory will be released at a later date ([release notes](http://www.opera.com/docs/changelogs/windows/1100/) list a placeholder statement: *"fixed a high severity issue"*). Several tricky crashes reportedly still waiting to be resolved.

        Note that with Opera, the fuzzer needs to be restarted frequently.

Well, that's it. To download the tool or see it in action, you can [follow this link](http://lcamtuf.coredump.cx/cross_fuzz). The fuzzer may be trivially extended to work with any other DOM-compliant documents, plugin bindings, and so forth.

#### 20 comments:

1. ![]()Anonymous[January 01, 2011 6:36 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1293892613611#c698618377192225812)

   Thanks Michal. How hard would it be, and would there be any value in working this fuzzer into existing applications that may already be stressing the DOM?

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=698618377192225812)Replies
   Reply
2. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 01, 2011 10:13 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1293905582921#c9083094674897490997)

   Larry: yes, it would be prudent to incorporate this with browser release QA test suites. My assumption is that at least some browser vendors will do so.

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=9083094674897490997)Replies
   Reply
3. ![]()[Yuhong Bao](https://www.blogger.com/profile/14519473280837410246)[January 01, 2011 5:30 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1293931826772#c8171044645901628175)

   When you release mangleme, you provided a mangle.cgi that logged, and a remangle.cgi that used the info in the log to reproduce the same page. You could do the same thing with this fuzzer, but the problem is where would you log? Filesystem access is restricted for obvious reasons. How about using document.cookie?

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=8171044645901628175)Replies
   Reply
4. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 01, 2011 6:25 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1293935102108#c7206965541252837180)

   Logging is a significant problem, yeah; but it's even mroe complicated: even if every eval() call is logged, this will not necessarily result in a case that can be minimized or even reproduces reliably. Note, for example, that the same initial random seed does not ilead to the same crash location.

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=7206965541252837180)Replies
   Reply
5. ![]()[Unknown](https://www.blogger.com/profile/10847129572108231033)[January 03, 2011 7:15 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294067750041#c1274042627394522050)

   ""When you release mangleme, you provided a mangle.cgi that logged, and a remangle.cgi that used the info in the log to reproduce the same page. You could do the same thing with this fuzzer, but the problem is where would you log? Filesystem access is restricted for obvious reasons. How about using document.cookie?""

   What do you think about HTML5 localstorage (and WebSQL for IE)?

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=1274042627394522050)Replies
   Reply
6. ![]()[Martijn](https://www.blogger.com/profile/15244217828993647136)[January 03, 2011 8:46 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294073192084#c4297089267473227299)

   What will happen on mobile browsers?

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=4297089267473227299)Replies
   Reply
7. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 03, 2011 9:01 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294074069662#c4141984213942494212)

   Thany: Android and iPhone browsers are based on WebKit, and should share the same issues; similarly for Windows Mobile (a fork of IE).

   I haven't tested the fuzzer there, and there might be some hiccups (e.g., related to popup management), but in principle, it should be roughly the same thing.

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=4141984213942494212)Replies
   Reply
8. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 03, 2011 9:02 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294074139117#c6975857485116558250)

   Johan: you can use these, although I don't think they offer strong guarantees of data integrity / completeness following a crash.

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=6975857485116558250)Replies
   Reply
9. ![]()[Donny Viszneki](https://www.blogger.com/profile/07019873471160940965)[January 03, 2011 10:28 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294079332120#c6883483519814475929)

   Brilliant fuzzing approach :D Our brave new garbage-collected world needs to be stress tested this way more often! I'm betting Flash will be a source of problems for some time... How many systems have you tested on?

   Also

   I really like your idea of incorporating your fuzzer's techniques into projects' QA testing! To this end, do you have any advice for developers who are not working with web browsers, but who are employing their Javascript engines? (Spidermonkey, V8)

   Thanks for your hard work! I can imagine it's frustrating to chase such elusive crashes!

   Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=6883483519814475929)Replies
   Reply
10. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 03, 2011 10:36 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294079770255#c3219969853639925208)

    Donny: the fuzzer can be probably easily adopted for non-browser uses (it has some dependence on window / document DOM, but not for the essential parts). In general, good test coverage + continuous fuzzing is a good idea.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=3219969853639925208)Replies
    Reply
11. ![]()[Pete](https://www.blogger.com/profile/16425298556760151548)[January 03, 2011 6:26 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294108009105#c7049605444592358175)

    "I also believe that at least one of the vulnerabilities discovered by cross\_fuzz may be known to third parties - which makes getting this tool out a priority."

    Hi, Michal - I am not sure I understand why a fuzzing tool is needed after a vuln is found. Am I missing something about a feature of the tool or a property of the vulns being found?

    Thanks.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=7049605444592358175)Replies
    Reply
12. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 03, 2011 6:38 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294108711441#c8162416154133844795)

    Pete: the tool is needed to reproduce, investigate, and address vulnerabilities; beyond that, it serves no immediate purpose :-)

    In general, vendors had several months to investigate, and past a certain point, the benefits of keeping the broader community in the loop seem to outweigh the risks; doubly so if the tool happens to reproduce a vulnerability privately known to third parties with an uncertain agenda. I had several posts dissecting this topic in the past, e.g.:

    http://lcamtuf.blogspot.com/2010/04/responsibilities-of-disclosure.html

    http://lcamtuf.blogspot.com/2010/06/not-disclosure-debate-again.html

    It's easy to frame the publication of this tool as controversial or damaging, but I do not think it is; because of the design of this tool, the expertise needed to actually go from it to a usable attack vector, to an exploit, is far higher than that needed to create a similar tool.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=8162416154133844795)Replies
    Reply
13. ![]()[Henk Poley](https://www.blogger.com/profile/07907677259674276676)[January 06, 2011 1:18 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294305507910#c7626201299165551451)

    I find it rather disconcerting that after a Firefox/Mac 4.0b7 crash by your tool, it now seems to operate hidden when I restart Firefox, without Firefox showing any window. Only some Find and Save dialogs popup every so often. Nothing in Exposé either.

    Not that this is a problem with your tool, just that a browser really shouldn't open after a fresh start to something hidden doing its nefarious things.

    I'll probably just purge my Firefox profile after I had enough of cross\_fuzz, but case anyone likes to trace how this is happening just shoot me a message.

    - Henk Poley

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=7626201299165551451)Replies
    Reply
14. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 06, 2011 1:27 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294306052194#c5944636236366976346)

    You probably have session restore configured, causing the browser to restart with the fuzzer whenever launched again. A very simple way to break this cycle would be to simply launch it while you are offline, and then close the offending tabs.

    The window being off-screen is a more serious problem (and a bug). I am not familiar with MacOS WM, but if there is a way to request the window to be maximized or otherwise moved to a more reasonable location, that may be useful. If not, I am not sure where the setting may be kept by Firefox or the WM. You can also try hitting the keyboard shortcut to open a new window (Ctrl-N?) and see if that helps.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=5944636236366976346)Replies
    Reply
15. ![]()[Unknown](https://www.blogger.com/profile/07970411820034804811)[January 06, 2011 4:33 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294317195559#c2147510592061099288)

    Cross fuzz? You mean an angry policeman? ;P

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=2147510592061099288)Replies
    Reply
16. ![]()[lamapper](https://www.blogger.com/profile/01549351295469241223)[January 07, 2011 11:22 AM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294428142528#c9151421779356166868)

    Thanks for creating the tool and your patience with the M$ beast in releasing it. I doubt I would have waited for six months to release and M$ asking you to not release after ignoring your notification for over 5 months is reprehensible, but hardly surprising. For M$ this is business as usual. Funny to watch their PR machine go into overdrive, AGAIN, rather than just fixing the problem.

    Perhaps they really are as incompetent as many of us believe that they are as a company. For my part I stopped using their products over 4 years ago, except on select business contracts where we are given no choice but M$...ugh.

    Keep up the great work!

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=9151421779356166868)Replies
    Reply
17. ![]()[Alex Garfield](https://www.blogger.com/profile/11399707471814092605)[January 07, 2011 11:16 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294471004164#c7051190661507872058)

    I was wondering if Google Chrome was also affected by this vulnerability.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=7051190661507872058)Replies
    Reply
18. ![]()[Michal Zalewski](https://www.blogger.com/profile/07964553034419471588)[January 07, 2011 11:20 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294471229040#c3029283380971715914)

    Dan: Which vulnerability?

    The fuzzer triggered security-relevant problems in all browsers on the market, including all WebKit ones; WebKit is at the core of Chrome, Safari, Palm / iPhone / Android browsers, and more.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=3029283380971715914)Replies
    Reply
19. ![]()[Alex Garfield](https://www.blogger.com/profile/11399707471814092605)[January 08, 2011 11:21 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1294557711268#c4027975531082470237)

    Thank you. I learned about this from the us-cert.gov website but I am surprised that cert has not mentioned in their vulnerability blog that the fuzzer triggered security-relevant problems affect numerous browsers and not just Internet Explorer.

    http://www.kb.cert.org/vuls/id/427980

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=4027975531082470237)Replies
    Reply
20. ![]()[Yuhong Bao](https://www.blogger.com/profile/14519473280837410246)[May 04, 2013 7:19 PM](https://lcamtuf.blogspot.com/2011/01/announcing-crossfuzz-potential-0-day-in.html?showComment=1367720364165#c6576164194182448489)

    Tip for fuzzing IE: you can use Scripting.FileSystemObject in the local computer zone to write to text files.

    Reply[Delete](https://www.blogger.com/delete-comment.g?blogID=383549007228220941&postID=6576164194182448489)Replies
    Reply

Add commentLoad more...

Note: Only a member of this blog may post a comment.

[Newer Post](https://lcamtuf.blogspot.com/2011/03/warning-object-and-embed-are-inherently.html "Newer Post")

[Older Post](https://lcamtuf.blogspot.com/2010/12/firefox-3613-damn-you-corner-cases.html "Older Post")

[Home](https://lcamtuf.blogspot.com/)

Subscribe to:
[Post Comments (Atom)](https://lcamtuf.blogspot.com/feeds/9019710460557288887/comments/default)

