

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Chao Yu <chao@kernel.org> | 2023-12-10 19:35:42 +0800 |
| --- | --- | --- |
| committer | Jaegeuk Kim <jaegeuk@kernel.org> | 2023-12-11 13:38:40 -0800 |
| commit | [4961acdd65c956e97c1a000c82d91a8c1cdbe44b](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)) | |
| tree | [fcfe8835d60c1d2330164a5b2cb81eeb75bda9e7](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b) | |
| parent | [87f3afd366f7c668be0269efda8a89741a3ea6b3](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=87f3afd366f7c668be0269efda8a89741a3ea6b3) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b&id2=87f3afd366f7c668be0269efda8a89741a3ea6b3)) | |
| download | [linux-4961acdd65c956e97c1a000c82d91a8c1cdbe44b.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-4961acdd65c956e97c1a000c82d91a8c1cdbe44b.tar.gz) | |

f2fs: fix to tag gcing flag on page during block migrationIt needs to add missing gcing flag on page during block migration,
in order to garantee migrated data be persisted during checkpoint,
otherwise out-of-order persistency between data and node may cause
data corruption after SPOR.
Similar issue was fixed by commit 2d1fe8a86bf5 ("f2fs: fix to tag
gcing flag on page during file defragment").
Signed-off-by: Chao Yu <chao@kernel.org>
Signed-off-by: Jaegeuk Kim <jaegeuk@kernel.org>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)

| -rw-r--r-- | [fs/f2fs/compress.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/compress.c?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b) | 4 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |
| -rw-r--r-- | [fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/fs/f2fs/file.c?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b) | 2 | |  |  |  | | --- | --- | --- | |

2 files changed, 5 insertions, 1 deletions

| diff --git a/fs/f2fs/compress.c b/fs/f2fs/compress.cindex b35be579972646..c5a4364c448271 100644--- a/[fs/f2fs/compress.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/compress.c?id=87f3afd366f7c668be0269efda8a89741a3ea6b3)+++ b/[fs/f2fs/compress.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/compress.c?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)@@ -1036,8 +1036,10 @@ static void set\_cluster\_dirty(struct compress\_ctx \*cc) int i;  for (i = 0; i < cc->cluster\_size; i++)- if (cc->rpages[i])+ if (cc->rpages[i]) { set\_page\_dirty(cc->rpages[i]);+ set\_page\_private\_gcing(cc->rpages[i]);+ } }  static int prepare\_compress\_overwrite(struct compress\_ctx \*cc,diff --git a/fs/f2fs/file.c b/fs/f2fs/file.cindex 60290940018d4e..156b0ff05a3b81 100644--- a/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=87f3afd366f7c668be0269efda8a89741a3ea6b3)+++ b/[fs/f2fs/file.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/fs/f2fs/file.c?id=4961acdd65c956e97c1a000c82d91a8c1cdbe44b)@@ -1312,6 +1312,7 @@ static int \_\_clone\_blkaddrs(struct inode \*src\_inode, struct inode \*dst\_inode, } memcpy\_page(pdst, 0, psrc, 0, PAGE\_SIZE); set\_page\_dirty(pdst);+ set\_page\_private\_gcing(pdst); f2fs\_put\_page(pdst, 1); f2fs\_put\_page(psrc, 1); @@ -4046,6 +4047,7 @@ static int redirty\_blocks(struct inode \*inode, pgoff\_t page\_idx, int len) f2fs\_bug\_on(F2FS\_I\_SB(inode), !page);  set\_page\_dirty(page);+ set\_page\_private\_gcing(page); f2fs\_put\_page(page, 1); f2fs\_put\_page(page, 0); } |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-11 01:39:33 +0000

