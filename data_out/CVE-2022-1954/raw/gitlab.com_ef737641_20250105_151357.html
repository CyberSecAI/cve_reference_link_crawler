





<!DOCTYPE html>
<html class="gl-light ui-neutral with-top-bar with-header " lang="en">
<head prefix="og: http://ogp.me/ns#">
<meta charset="utf-8">
<meta content="IE=edge" http-equiv="X-UA-Compatible">
<meta content="width=device-width, initial-scale=1" name="viewport">
<title>ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year (#358160) · Issues · GitLab.org / GitLab · GitLab</title>
<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
window.gon={};gon.math_rendering_limits_enabled=true;gon.features={"preserveMarkdown":true,"issuesGridView":false,"serviceDeskTicket":false,"issuesListDrawer":false,"notificationsTodosButtons":false,"glqlIntegration":true,"workItemsBeta":true,"workItemsAlpha":false,"workItems":true,"epicWidgetEditConfirmation":false,"namespaceLevelWorkItems":false,"workItemsViewPreference":false,"okrsMvc":false,"workItemEpics":true};gon.licensed_features={"escalationPolicies":true,"okrs":true};gon.abilities={"summarizeComments":false,"measureCommentTemperature":false};
//]]>
</script>


<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
var gl = window.gl || {};
gl.startup_calls = {"/gitlab-org/gitlab/-/issues/358160/related_branches":{},"/gitlab-org/gitlab/-/issues/358160/discussions.json?per_page=20":{},"/gitlab-org/gitlab/-/issues/358160.json?serializer=sidebar_extras":{}};
gl.startup_graphql_calls = [{"query":"query getDesignList($fullPath: ID!, $iid: String!, $atVersion: DesignManagementVersionID) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      designCollection {\n        __typename\n        copyState\n        designs(atVersion: $atVersion) {\n          __typename\n          nodes {\n            __typename\n            id\n            event\n            filename\n            notesCount\n            image\n            imageV432x230\n            currentUserTodos(state: pending) {\n              __typename\n              nodes {\n                __typename\n                id\n              }\n            }\n          }\n        }\n        versions {\n          __typename\n          nodes {\n            __typename\n            id\n            sha\n            createdAt\n            author {\n              __typename\n              id\n              name\n              avatarUrl\n            }\n          }\n        }\n      }\n    }\n  }\n}\n","variables":{"fullPath":"gitlab-org/gitlab","iid":"358160","atVersion":null}},{"query":"query permissions($fullPath: ID!, $iid: String!) {\n  project(fullPath: $fullPath) {\n    __typename\n    id\n    issue(iid: $iid) {\n      __typename\n      id\n      userPermissions {\n        __typename\n        createDesign\n      }\n    }\n  }\n}\n","variables":{"fullPath":"gitlab-org/gitlab","iid":"358160"}}];

if (gl.startup_calls && window.fetch) {
  Object.keys(gl.startup_calls).forEach(apiCall => {
   gl.startup_calls[apiCall] = {
      fetchCall: fetch(apiCall, {
        // Emulate XHR for Rails AJAX request checks
        headers: {
          'X-Requested-With': 'XMLHttpRequest'
        },
        // fetch won’t send cookies in older browsers, unless you set the credentials init option.
        // We set to `same-origin` which is default value in modern browsers.
        // See https://github.com/whatwg/fetch/pull/585 for more information.
        credentials: 'same-origin'
      })
    };
  });
}
if (gl.startup_graphql_calls && window.fetch) {
  const headers = {"X-CSRF-Token":"NJNReERRFFaeltkz6EIv9t1sFLo_2Tpg7WXrZdaAYRLg1x52ft4dnTW4UHVTrCNTq4IxpntFDZTtfzDNVLAYNw","x-gitlab-feature-category":"team_planning"};
  const url = `https://gitlab.com/api/graphql`

  const opts = {
    method: "POST",
    headers: {
      "Content-Type": "application/json",
      ...headers,
    }
  };

  gl.startup_graphql_calls = gl.startup_graphql_calls.map(call => ({
    ...call,
    fetchCall: fetch(url, {
      ...opts,
      credentials: 'same-origin',
      body: JSON.stringify(call)
    })
  }))
}


//]]>
</script>



<link rel="stylesheet" href="/assets/application-9de688b302d723d15d70ba51a5410625092e3bc978dbb160cc523f86c4807968.css" />
<link rel="stylesheet" href="/assets/page_bundles/design_management-f20ae9b5b8c9a0f793e3ffa2ddc13953bfd683e1d351c8e6cc75e0fcd4ddde90.css" /><link rel="stylesheet" href="/assets/page_bundles/incidents-b9f383aefa56f0a72990496e4a4b3aaf2c525843283a1c0c3d85876537187397.css" /><link rel="stylesheet" href="/assets/page_bundles/issuable-e25480d2326300d5c49ad31dbd847a53e39fc33a5fd595a961dd7238e411b558.css" /><link rel="stylesheet" href="/assets/page_bundles/notes_shared-7e727ab1e91b421915feadeb04a1b9d57213cb1b2f8f56f4d894b34d6b42e9b3.css" /><link rel="stylesheet" href="/assets/page_bundles/issues_show-785541c300108b8ecf7c08fd02bd67f4d6b9d59c86918ecfbf91bae5e1c8ffa8.css" /><link rel="stylesheet" href="/assets/page_bundles/work_items-22a76cdd1fe2ae5431b7ff603f86212acaf81b49c4a932f19e3b3222dc1881ee.css" /><link rel="stylesheet" href="/assets/page_bundles/labels-3508460b8d6f839e9d60de1f2065fdaf7f057efab04cf71966acef6a86fe9b41.css" /><link rel="stylesheet" href="/assets/page_bundles/commit_description-1e2cba4dda3c7b30dd84924809020c569f1308dea51520fe1dd5d4ce31403195.css" />
<link rel="stylesheet" href="/assets/application_utilities-73b9a1c83703ccfccd0e1e418c7d8dc606fcac533fa38b9fa86792f098db0f9a.css" />
<link rel="stylesheet" href="/assets/tailwind-284f33824923c600abd24d7884ff853fd38734b17a1441a1b7e31d4aa365acc2.css" />


<link rel="stylesheet" href="/assets/fonts-fae5d3f79948bd85f18b6513a025f863b19636e85b09a1492907eb4b1bb0557b.css" />
<link rel="stylesheet" href="/assets/highlight/themes/white-e31d355458ead69f8798dbb62f54c60c4ccc7db35289cbbd2353ddfdf5109aac.css" />

<script src="/assets/webpack/runtime.f0860ff2.bundle.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/main.78bd52ff.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/tracker.868aa839.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/analytics.cb60a77a.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
window.snowplowOptions = {"namespace":"gl","hostname":"snowplowprd.trx.gitlab.net","cookieDomain":".gitlab.com","appId":"gitlab","formTracking":true,"linkClickTracking":true}

gl = window.gl || {};
gl.snowplowStandardContext = {"schema":"iglu:com.gitlab/gitlab_standard/jsonschema/1-1-1","data":{"environment":"production","source":"gitlab-rails","correlation_id":"01JGVGFAVE7BPDNGABRTM7G587","plan":"gold","extra":{},"user_id":null,"global_user_id":null,"is_gitlab_team_member":null,"namespace_id":9970,"project_id":278964,"feature_enabled_by_namespace_ids":null,"realm":"saas","instance_id":"ea8bf810-1d6f-4a6a-b4fd-93e8cbd8b57f","host_name":"gitlab-cny-webservice-web-7b99886bd6-8ww8g","instance_version":"17.8.0","context_generated_at":"2025-01-05T15:13:57.353Z"}}
gl.snowplowPseudonymizedPageUrl = "https://gitlab.com/namespace9970/project278964/-/issues/358160";
gl.maskedDefaultReferrerUrl = null;
gl.ga4MeasurementId = 'G-ENFH3X7M5Y';


//]]>
</script>
<link rel="preload" href="/assets/application_utilities-73b9a1c83703ccfccd0e1e418c7d8dc606fcac533fa38b9fa86792f098db0f9a.css" as="style" type="text/css" nonce="E1/mbuN4GNO+NiYL8Zs8Gg==">
<link rel="preload" href="/assets/application-9de688b302d723d15d70ba51a5410625092e3bc978dbb160cc523f86c4807968.css" as="style" type="text/css" nonce="E1/mbuN4GNO+NiYL8Zs8Gg==">
<link rel="preload" href="/assets/highlight/themes/white-e31d355458ead69f8798dbb62f54c60c4ccc7db35289cbbd2353ddfdf5109aac.css" as="style" type="text/css" nonce="E1/mbuN4GNO+NiYL8Zs8Gg==">
<link crossorigin="" href="https://snowplowprd.trx.gitlab.net" rel="preconnect">
<link as="font" crossorigin="" href="/assets/gitlab-sans/GitLabSans-1e0a5107ea3bbd4be93e8ad2c503467e43166cd37e4293570b490e0812ede98b.woff2" rel="preload">
<link as="font" crossorigin="" href="/assets/gitlab-sans/GitLabSans-Italic-38eaf1a569a54ab28c58b92a4a8de3afb96b6ebc250cf372003a7b38151848cc.woff2" rel="preload">
<link as="font" crossorigin="" href="/assets/gitlab-mono/GitLabMono-08d2c5e8ff8fd3d2d6ec55bc7713380f8981c35f9d2df14e12b835464d6e8f23.woff2" rel="preload">
<link as="font" crossorigin="" href="/assets/gitlab-mono/GitLabMono-Italic-38e58d8df29485a20c550da1d0111e2c2169f6dcbcf894f2cd3afbdd97bcc588.woff2" rel="preload">
<link rel="preload" href="/assets/fonts-fae5d3f79948bd85f18b6513a025f863b19636e85b09a1492907eb4b1bb0557b.css" as="style" type="text/css" nonce="E1/mbuN4GNO+NiYL8Zs8Gg==">



<script src="/assets/webpack/sentry.907cf3e4.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>

<script src="/assets/webpack/9.49e5c3e3.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/11.e2e145a2.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/13.3d62f21f.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/commons-pages.groups.analytics.dashboards-pages.groups.harbor.repositories-pages.groups.iteration_ca-b07ae190.ba6536d6.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/commons-pages.groups.new-pages.import.gitlab_projects.new-pages.import.manifest.new-pages.projects.n-44c6c18e.3be560a5.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/commons-pages.search.show-super_sidebar.ca4ee38a.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/super_sidebar.14e23139.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/commons-pages.projects-pages.projects.activity-pages.projects.alert_management.details-pages.project-bce54798.cf2cb6b5.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>
<script src="/assets/webpack/pages.projects.issues.show.779fd13b.chunk.js" defer="defer" nonce="xwzcWaQUcTr8nsGERh75fg=="></script>

<meta content="object" property="og:type">
<meta content="GitLab" property="og:site_name">
<meta content="ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year (#358160) · Issues · GitLab.org / GitLab · GitLab" property="og:title">
<meta content="HackerOne report #1531958 by afewgoats on 2022-04-06, assigned to GitLab Team: Report | " property="og:description">
<meta content="https://gitlab.com/uploads/-/system/project/avatar/278964/project_avatar.png" property="og:image">
<meta content="64" property="og:image:width">
<meta content="64" property="og:image:height">
<meta content="https://gitlab.com/gitlab-org/gitlab/-/issues/358160" property="og:url">
<meta content="summary" property="twitter:card">
<meta content="ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year (#358160) · Issues · GitLab.org / GitLab · GitLab" property="twitter:title">
<meta content="HackerOne report #1531958 by afewgoats on 2022-04-06, assigned to GitLab Team: Report | " property="twitter:description">
<meta content="https://gitlab.com/uploads/-/system/project/avatar/278964/project_avatar.png" property="twitter:image">
<meta property="twitter:label1" content="Author"><meta property="twitter:data1" content="GitLab SecurityBot"><meta property="twitter:label2" content="Assignee"><meta property="twitter:data2" content="Luke Duncalfe">
<meta name="csrf-param" content="authenticity_token" />
<meta name="csrf-token" content="DbbcJNvTqRXrjHA5VgxuFxac9dtsJuRoBOog5TzcobvZ8pMq4Vyg3kCi-X_t4mKyYHLQxyi605wE8PtNvuzYng" />
<meta name="csp-nonce" content="xwzcWaQUcTr8nsGERh75fg==" />
<meta name="action-cable-url" content="/-/cable" />
<link href="/-/manifest.json" rel="manifest">
<link rel="icon" type="image/png" href="/assets/favicon-yellow-018213ceb87b472388095d0264be5b4319ef47471dacea03c83ecc233ced2fd5.png" id="favicon" data-original-href="/assets/favicon-yellow-018213ceb87b472388095d0264be5b4319ef47471dacea03c83ecc233ced2fd5.png" />
<link rel="apple-touch-icon" type="image/x-icon" href="/assets/apple-touch-icon-b049d4bc0dd9626f31db825d61880737befc7835982586d015bded10b4435460.png" />
<link href="/search/opensearch.xml" rel="search" title="Search GitLab" type="application/opensearchdescription+xml">




<meta content="HackerOne report #1531958 by afewgoats on 2022-04-06, assigned to GitLab Team: Report | " name="description">
<meta content="#ececef" name="theme-color">
</head>

<body class="tab-width-8 gl-browser-chrome gl-platform-windows" data-group="gitlab-org" data-group-full-path="gitlab-org" data-namespace-id="9970" data-page="projects:issues:show" data-page-type-id="358160" data-project="gitlab" data-project-full-path="gitlab-org/gitlab" data-project-id="278964">
<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
gl = window.gl || {};
gl.GfmAutoComplete = gl.GfmAutoComplete || {};
gl.GfmAutoComplete.dataSources = {"epics":"/gitlab-org/gitlab/-/autocomplete_sources/epics","iterations":"/gitlab-org/gitlab/-/autocomplete_sources/iterations","vulnerabilities":"/gitlab-org/gitlab/-/autocomplete_sources/vulnerabilities","members":"/gitlab-org/gitlab/-/autocomplete_sources/members?type=Issue\u0026type_id=358160","issues":"/gitlab-org/gitlab/-/autocomplete_sources/issues","mergeRequests":"/gitlab-org/gitlab/-/autocomplete_sources/merge_requests","labels":"/gitlab-org/gitlab/-/autocomplete_sources/labels?type=Issue\u0026type_id=358160","milestones":"/gitlab-org/gitlab/-/autocomplete_sources/milestones","commands":"/gitlab-org/gitlab/-/autocomplete_sources/commands?type=Issue\u0026type_id=358160","snippets":"/gitlab-org/gitlab/-/autocomplete_sources/snippets","contacts":"/gitlab-org/gitlab/-/autocomplete_sources/contacts?type=Issue\u0026type_id=358160","wikis":null};


//]]>
</script>
<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
gl = window.gl || {};
gl.client = {"isChrome":true,"isWindows":true};


//]]>
</script>


<header class="header-logged-out" data-testid="navbar">
<a class="gl-sr-only gl-accessibility" href="#content-body">Skip to content</a>
<div class="container-fluid">
<nav aria-label="Explore GitLab" class="header-logged-out-nav gl-flex gl-gap-3 gl-justify-between">
<div class="gl-flex gl-items-center gl-gap-1">
<span class="gl-sr-only">GitLab</span>
<a title="Homepage" id="logo" class="header-logged-out-logo has-tooltip" aria-label="Homepage" data-track-label="main_navigation" data-track-action="click_gitlab_logo_link" data-track-property="navigation_top" href="/"><svg aria-hidden="true" role="img" class="tanuki-logo" width="25" height="24" viewBox="0 0 25 24" fill="none" xmlns="http://www.w3.org/2000/svg">
  <path class="tanuki-shape tanuki" d="m24.507 9.5-.034-.09L21.082.562a.896.896 0 0 0-1.694.091l-2.29 7.01H7.825L5.535.653a.898.898 0 0 0-1.694-.09L.451 9.411.416 9.5a6.297 6.297 0 0 0 2.09 7.278l.012.01.03.022 5.16 3.867 2.56 1.935 1.554 1.176a1.051 1.051 0 0 0 1.268 0l1.555-1.176 2.56-1.935 5.197-3.89.014-.01A6.297 6.297 0 0 0 24.507 9.5Z"
        fill="#E24329"/>
  <path class="tanuki-shape right-cheek" d="m24.507 9.5-.034-.09a11.44 11.44 0 0 0-4.56 2.051l-7.447 5.632 4.742 3.584 5.197-3.89.014-.01A6.297 6.297 0 0 0 24.507 9.5Z"
        fill="#FC6D26"/>
  <path class="tanuki-shape chin" d="m7.707 20.677 2.56 1.935 1.555 1.176a1.051 1.051 0 0 0 1.268 0l1.555-1.176 2.56-1.935-4.743-3.584-4.755 3.584Z"
        fill="#FCA326"/>
  <path class="tanuki-shape left-cheek" d="M5.01 11.461a11.43 11.43 0 0 0-4.56-2.05L.416 9.5a6.297 6.297 0 0 0 2.09 7.278l.012.01.03.022 5.16 3.867 4.745-3.584-7.444-5.632Z"
        fill="#FC6D26"/>
</svg>

</a><a class="gl-badge badge badge-pill badge-success canary-badge" data-testid="canary_badge_link" href="https://next.gitlab.com" rel="noopener noreferrer" target="_blank"><span class="gl-badge-content">Next
</span></a></div>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-grow">
<li class="header-logged-out-nav-item header-logged-out-dropdown md:gl-hidden">
<button class="header-logged-out-toggle" data-toggle="dropdown" type="button">
<span class="gl-sr-only">
Menu
</span>
<svg class="s16" data-testid="hamburger-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#hamburger"></use></svg>
</button>
<div class="dropdown-menu">
<ul>
<li>
<a href="https://about.gitlab.com/why-gitlab">Why GitLab
</a></li>
<li>
<a href="https://about.gitlab.com/pricing">Pricing
</a></li>
<li>
<a href="https://about.gitlab.com/sales">Contact Sales
</a></li>
<li>
<a href="/explore">Explore</a>
</li>
</ul>
</div>
</li>
<li class="header-logged-out-nav-item gl-hidden md:gl-inline-block">
<a href="https://about.gitlab.com/why-gitlab">Why GitLab
</a></li>
<li class="header-logged-out-nav-item gl-hidden md:gl-inline-block">
<a href="https://about.gitlab.com/pricing">Pricing
</a></li>
<li class="header-logged-out-nav-item gl-hidden gl-inline-block">
<a href="https://about.gitlab.com/sales">Contact Sales
</a></li>
<li class="header-logged-out-nav-item gl-hidden md:gl-inline-block">
<a class="" href="/explore">Explore</a>
</li>
</ul>
<ul class="gl-list-none gl-p-0 gl-m-0 gl-flex gl-gap-3 gl-items-center gl-justify-end">
<li class="header-logged-out-nav-item">
<a href="/users/sign_in?redirect_to_referer=yes">Sign in</a>
</li>
<li class="header-logged-out-nav-item">
<a class="gl-button btn btn-md btn-confirm !gl-inline-flex" href="/users/sign_up"><span class="gl-button-text">
Get free trial

</span>

</a></li>
</ul>
</nav>
</div>
</header>

<div class="layout-page page-gutter right-sidebar-expanded page-with-super-sidebar">
<aside class="js-super-sidebar super-sidebar super-sidebar-loading" data-command-palette="{&quot;project_files_url&quot;:&quot;/gitlab-org/gitlab/-/files/master?format=json&quot;,&quot;project_blob_url&quot;:&quot;/gitlab-org/gitlab/-/blob/master&quot;}" data-force-desktop-expanded-sidebar="" data-is-saas="true" data-root-path="/" data-sidebar="{&quot;whats_new_most_recent_release_items_count&quot;:6,&quot;whats_new_version_digest&quot;:&quot;c955dbe1b30a1468b032fe6896086eda50f884ff9559d966e5ef75c34eee3ff0&quot;,&quot;is_logged_in&quot;:false,&quot;context_switcher_links&quot;:[{&quot;title&quot;:&quot;Explore&quot;,&quot;link&quot;:&quot;/explore&quot;,&quot;icon&quot;:&quot;compass&quot;}],&quot;current_menu_items&quot;:[{&quot;id&quot;:&quot;project_overview&quot;,&quot;title&quot;:&quot;GitLab&quot;,&quot;avatar&quot;:&quot;/uploads/-/system/project/avatar/278964/project_avatar.png&quot;,&quot;entity_id&quot;:278964,&quot;link&quot;:&quot;/gitlab-org/gitlab&quot;,&quot;link_classes&quot;:&quot;shortcuts-project&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;manage_menu&quot;,&quot;title&quot;:&quot;Manage&quot;,&quot;icon&quot;:&quot;users&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/activity&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;activity&quot;,&quot;title&quot;:&quot;Activity&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/activity&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-activity&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;members&quot;,&quot;title&quot;:&quot;Members&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/project_members&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;labels&quot;,&quot;title&quot;:&quot;Labels&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/labels&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;plan_menu&quot;,&quot;title&quot;:&quot;Plan&quot;,&quot;icon&quot;:&quot;planning&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/issues&quot;,&quot;is_active&quot;:true,&quot;items&quot;:[{&quot;id&quot;:&quot;project_issue_list&quot;,&quot;title&quot;:&quot;Issues&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/issues&quot;,&quot;pill_count_field&quot;:&quot;openIssuesCount&quot;,&quot;link_classes&quot;:&quot;shortcuts-issues has-sub-items&quot;,&quot;is_active&quot;:true},{&quot;id&quot;:&quot;boards&quot;,&quot;title&quot;:&quot;Issue boards&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/boards&quot;,&quot;link_classes&quot;:&quot;shortcuts-issue-boards&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;milestones&quot;,&quot;title&quot;:&quot;Milestones&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/milestones&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;iterations&quot;,&quot;title&quot;:&quot;Iterations&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/cadences&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;requirements&quot;,&quot;title&quot;:&quot;Requirements&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/requirements_management/requirements&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;code_menu&quot;,&quot;title&quot;:&quot;Code&quot;,&quot;icon&quot;:&quot;code&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/merge_requests&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;project_merge_request_list&quot;,&quot;title&quot;:&quot;Merge requests&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/merge_requests&quot;,&quot;pill_count_field&quot;:&quot;openMergeRequestsCount&quot;,&quot;link_classes&quot;:&quot;shortcuts-merge_requests&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;files&quot;,&quot;title&quot;:&quot;Repository&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/tree/master&quot;,&quot;link_classes&quot;:&quot;shortcuts-tree&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;branches&quot;,&quot;title&quot;:&quot;Branches&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/branches&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;commits&quot;,&quot;title&quot;:&quot;Commits&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/commits/master?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-commits&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;tags&quot;,&quot;title&quot;:&quot;Tags&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/tags&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;graphs&quot;,&quot;title&quot;:&quot;Repository graph&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/network/master?ref_type=heads&quot;,&quot;link_classes&quot;:&quot;shortcuts-network&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;compare&quot;,&quot;title&quot;:&quot;Compare revisions&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/compare?from=master\u0026to=master&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;project_snippets&quot;,&quot;title&quot;:&quot;Snippets&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/snippets&quot;,&quot;link_classes&quot;:&quot;shortcuts-snippets&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;file_locks&quot;,&quot;title&quot;:&quot;Locked files&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/path_locks&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;build_menu&quot;,&quot;title&quot;:&quot;Build&quot;,&quot;icon&quot;:&quot;rocket&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/pipelines&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;pipelines&quot;,&quot;title&quot;:&quot;Pipelines&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/pipelines&quot;,&quot;link_classes&quot;:&quot;shortcuts-pipelines&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;jobs&quot;,&quot;title&quot;:&quot;Jobs&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/jobs&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;pipeline_schedules&quot;,&quot;title&quot;:&quot;Pipeline schedules&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/pipeline_schedules&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;test_cases&quot;,&quot;title&quot;:&quot;Test cases&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/quality/test_cases&quot;,&quot;link_classes&quot;:&quot;shortcuts-test-cases&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;artifacts&quot;,&quot;title&quot;:&quot;Artifacts&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/artifacts&quot;,&quot;link_classes&quot;:&quot;shortcuts-builds&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;deploy_menu&quot;,&quot;title&quot;:&quot;Deploy&quot;,&quot;icon&quot;:&quot;deployments&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/releases&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;releases&quot;,&quot;title&quot;:&quot;Releases&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/releases&quot;,&quot;link_classes&quot;:&quot;shortcuts-deployments-releases&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;packages_registry&quot;,&quot;title&quot;:&quot;Package Registry&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/packages&quot;,&quot;link_classes&quot;:&quot;shortcuts-container-registry&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;container_registry&quot;,&quot;title&quot;:&quot;Container Registry&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/container_registry&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;model_registry&quot;,&quot;title&quot;:&quot;Model registry&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/ml/models&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;operations_menu&quot;,&quot;title&quot;:&quot;Operate&quot;,&quot;icon&quot;:&quot;cloud-pod&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/environments&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;environments&quot;,&quot;title&quot;:&quot;Environments&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/environments&quot;,&quot;link_classes&quot;:&quot;shortcuts-environments&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;infrastructure_registry&quot;,&quot;title&quot;:&quot;Terraform modules&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/terraform_module_registry&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;monitor_menu&quot;,&quot;title&quot;:&quot;Monitor&quot;,&quot;icon&quot;:&quot;monitor&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/incidents&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;incidents&quot;,&quot;title&quot;:&quot;Incidents&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/incidents&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;service_desk&quot;,&quot;title&quot;:&quot;Service Desk&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/issues/service_desk&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false},{&quot;id&quot;:&quot;analyze_menu&quot;,&quot;title&quot;:&quot;Analyze&quot;,&quot;icon&quot;:&quot;chart&quot;,&quot;avatar_shape&quot;:&quot;rect&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/value_stream_analytics&quot;,&quot;is_active&quot;:false,&quot;items&quot;:[{&quot;id&quot;:&quot;cycle_analytics&quot;,&quot;title&quot;:&quot;Value stream analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/value_stream_analytics&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-cycle-analytics&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;contributors&quot;,&quot;title&quot;:&quot;Contributor analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/graphs/master?ref_type=heads&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;ci_cd_analytics&quot;,&quot;title&quot;:&quot;CI/CD analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/pipelines/charts&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;repository_analytics&quot;,&quot;title&quot;:&quot;Repository analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/graphs/master/charts&quot;,&quot;link_classes&quot;:&quot;shortcuts-repository-charts&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;code_review&quot;,&quot;title&quot;:&quot;Code review analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/analytics/code_reviews&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;issues&quot;,&quot;title&quot;:&quot;Issue analytics&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/analytics/issues_analytics&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;insights&quot;,&quot;title&quot;:&quot;Insights&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/insights/&quot;,&quot;link_classes&quot;:&quot;shortcuts-project-insights&quot;,&quot;is_active&quot;:false},{&quot;id&quot;:&quot;model_experiments&quot;,&quot;title&quot;:&quot;Model experiments&quot;,&quot;link&quot;:&quot;/gitlab-org/gitlab/-/ml/experiments&quot;,&quot;is_active&quot;:false}],&quot;separated&quot;:false}],&quot;current_context_header&quot;:&quot;Project&quot;,&quot;support_path&quot;:&quot;https://about.gitlab.com/get-help/&quot;,&quot;docs_path&quot;:&quot;/help/docs&quot;,&quot;display_whats_new&quot;:true,&quot;show_version_check&quot;:null,&quot;search&quot;:{&quot;search_path&quot;:&quot;/search&quot;,&quot;issues_path&quot;:&quot;/dashboard/issues&quot;,&quot;mr_path&quot;:&quot;/dashboard/merge_requests&quot;,&quot;autocomplete_path&quot;:&quot;/search/autocomplete&quot;,&quot;settings_path&quot;:&quot;/search/settings&quot;,&quot;search_context&quot;:{&quot;group&quot;:{&quot;id&quot;:9970,&quot;name&quot;:&quot;GitLab.org&quot;,&quot;full_name&quot;:&quot;GitLab.org&quot;},&quot;group_metadata&quot;:{&quot;issues_path&quot;:&quot;/groups/gitlab-org/-/issues&quot;,&quot;mr_path&quot;:&quot;/groups/gitlab-org/-/merge_requests&quot;},&quot;project&quot;:{&quot;id&quot;:278964,&quot;name&quot;:&quot;GitLab&quot;},&quot;project_metadata&quot;:{&quot;mr_path&quot;:&quot;/gitlab-org/gitlab/-/merge_requests&quot;,&quot;issues_path&quot;:&quot;/gitlab-org/gitlab/-/issues&quot;},&quot;code_search&quot;:false,&quot;scope&quot;:&quot;issues&quot;,&quot;for_snippets&quot;:null}},&quot;panel_type&quot;:&quot;project&quot;,&quot;shortcut_links&quot;:[{&quot;title&quot;:&quot;Snippets&quot;,&quot;href&quot;:&quot;/explore/snippets&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-snippets&quot;},{&quot;title&quot;:&quot;Groups&quot;,&quot;href&quot;:&quot;/explore/groups&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-groups&quot;},{&quot;title&quot;:&quot;Projects&quot;,&quot;href&quot;:&quot;/explore/projects/starred&quot;,&quot;css_class&quot;:&quot;dashboard-shortcuts-projects&quot;}],&quot;terms&quot;:&quot;/-/users/terms&quot;}"></aside>

<div class="content-wrapper">
<div class="broadcast-wrapper">




</div>
<div class="alert-wrapper alert-wrapper-top-space gl-flex gl-flex-col gl-gap-3 container-fluid container-limited">






























</div>
<div class="top-bar-fixed container-fluid" data-testid="top-bar">
<div class="top-bar-container gl-flex gl-items-center gl-gap-2">
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-start">
<button class="gl-button btn btn-icon btn-md btn-default btn-default-tertiary js-super-sidebar-toggle-expand super-sidebar-toggle -gl-ml-3" aria-controls="super-sidebar" aria-expanded="false" aria-label="Primary navigation sidebar" type="button"><svg class="s16 gl-icon gl-button-icon " data-testid="sidebar-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#sidebar"></use></svg>

</button>
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"GitLab.org","item":"https://gitlab.com/gitlab-org"},{"@type":"ListItem","position":2,"name":"GitLab","item":"https://gitlab.com/gitlab-org/gitlab"},{"@type":"ListItem","position":3,"name":"Issues","item":"https://gitlab.com/gitlab-org/gitlab/-/issues"},{"@type":"ListItem","position":4,"name":"#358160","item":"https://gitlab.com/gitlab-org/gitlab/-/issues/358160"}]}


</script>
<div data-testid="breadcrumb-links" id="js-vue-page-breadcrumbs-wrapper">
<div data-breadcrumbs-json="[{&quot;text&quot;:&quot;GitLab.org&quot;,&quot;href&quot;:&quot;/gitlab-org&quot;,&quot;avatarPath&quot;:&quot;/uploads/-/system/group/avatar/9970/project_avatar.png&quot;},{&quot;text&quot;:&quot;GitLab&quot;,&quot;href&quot;:&quot;/gitlab-org/gitlab&quot;,&quot;avatarPath&quot;:&quot;/uploads/-/system/project/avatar/278964/project_avatar.png&quot;},{&quot;text&quot;:&quot;Issues&quot;,&quot;href&quot;:&quot;/gitlab-org/gitlab/-/issues&quot;,&quot;avatarPath&quot;:null},{&quot;text&quot;:&quot;#358160&quot;,&quot;href&quot;:&quot;/gitlab-org/gitlab/-/issues/358160&quot;,&quot;avatarPath&quot;:null}]" id="js-vue-page-breadcrumbs"></div>
<div id="js-injected-page-breadcrumbs"></div>
</div>


</div>
<div class="gl-flex-none gl-flex gl-items-center gl-justify-center">
<div id="js-advanced-search-modal"></div>

</div>
<div class="gl-grow gl-basis-0 gl-flex gl-items-center gl-justify-end">
<div id="js-work-item-feedback"></div>


</div>
</div>
</div>

<div class="container-fluid container-limited limit-container-width project-highlight-puc">
<main class="content" id="content-body" itemscope itemtype="http://schema.org/SoftwareSourceCode">
<div class="flash-container flash-container-page sticky" data-testid="flash-container">
<div id="js-global-alerts"></div>
</div>







<div class="issue-details issuable-details js-issue-details">
<div class="detail-page-description content-block js-detail-page-description gl-pt-3 gl-pb-0 gl-border-none">
<div data-header-actions-data="{&quot;can_create_issue&quot;:&quot;true&quot;,&quot;can_create_incident&quot;:&quot;false&quot;,&quot;can_destroy_issue&quot;:&quot;false&quot;,&quot;can_reopen_issue&quot;:&quot;false&quot;,&quot;can_report_spam&quot;:&quot;&quot;,&quot;can_update_issue&quot;:&quot;false&quot;,&quot;is_issue_author&quot;:&quot;false&quot;,&quot;issue_path&quot;:&quot;/gitlab-org/gitlab/-/issues/358160&quot;,&quot;new_issue_path&quot;:&quot;/gitlab-org/gitlab/-/issues/new?add_related_issue=358160&quot;,&quot;project_path&quot;:&quot;gitlab-org/gitlab&quot;,&quot;report_abuse_path&quot;:&quot;/-/abuse_reports/add_category&quot;,&quot;reported_user_id&quot;:2741139,&quot;reported_from_url&quot;:&quot;https://gitlab.com/gitlab-org/gitlab/-/issues/358160&quot;,&quot;submit_as_spam_path&quot;:&quot;/gitlab-org/gitlab/-/issues/358160/mark_as_spam&quot;,&quot;issuable_email_address&quot;:null,&quot;can_promote_to_epic&quot;:&quot;false&quot;}" data-initial="{&quot;endpoint&quot;:&quot;/gitlab-org/gitlab/-/issues/358160&quot;,&quot;updateEndpoint&quot;:&quot;/gitlab-org/gitlab/-/issues/358160.json&quot;,&quot;canUpdate&quot;:false,&quot;canDestroy&quot;:false,&quot;issuableRef&quot;:&quot;#358160&quot;,&quot;imported&quot;:false,&quot;markdownPreviewPath&quot;:&quot;/gitlab-org/gitlab/-/preview_markdown?target_id=358160\u0026target_type=Issue&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;lockVersion&quot;:0,&quot;issuableTemplateNamesPath&quot;:&quot;/gitlab-org/gitlab/description_templates/names/issue&quot;,&quot;initialTitleHtml&quot;:&quot;ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year&quot;,&quot;initialTitleText&quot;:&quot;ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year&quot;,&quot;initialDescriptionHtml&quot;:&quot;\u003cp data-sourcepos=\&quot;1:1-1:127\&quot; dir=\&quot;auto\&quot;\u003e\u003cstrong data-sourcepos=\&quot;1:1-1:70\&quot;\u003e\u003ca data-sourcepos=\&quot;1:3-1:68\&quot; href=\&quot;https://hackerone.com/reports/1531958\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003eHackerOne report #1531958\u003c/a\u003e\u003c/strong\u003e by \u003ccode data-sourcepos=\&quot;1:76-1:84\&quot;\u003eafewgoats\u003c/code\u003e on 2022-04-06, assigned to \u003ccode data-sourcepos=\&quot;1:115-1:125\&quot;\u003eGitLab Team\u003c/code\u003e:\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;3:1-3:87\&quot; dir=\&quot;auto\&quot;\u003e\u003ca data-sourcepos=\&quot;3:1-3:17\&quot; href=\&quot;#report\&quot;\u003eReport\u003c/a\u003e | \u003ca data-sourcepos=\&quot;3:21-3:47\&quot; href=\&quot;#attachments\&quot;\u003eAttachments\u003c/a\u003e | \u003ca data-sourcepos=\&quot;3:51-3:87\&quot; href=\&quot;#how-to-reproduce\&quot;\u003eHow To Reproduce\u003c/a\u003e\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;5:1-5:9\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-report\&quot; class=\&quot;anchor\&quot; href=\&quot;#report\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eReport\u003c/h2\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;7:1-7:14\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-summary\&quot; class=\&quot;anchor\&quot; href=\&quot;#summary\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSummary\u003c/h5\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;9:1-13:77\&quot; dir=\&quot;auto\&quot;\u003eA Gitlab webhook may be pointed at a malicious webhook receiver.\u003cbr data-sourcepos=\&quot;9:67-9:67\&quot;\u003e\u0026#x000A;The webhook receiver can respond with a specially crafted long header.\u003cbr data-sourcepos=\&quot;10:73-10:73\&quot;\u003e\u0026#x000A;Gitlab processes the header with Ruby&#39;s net/http where there is a regular expression operation with quadratic complexity (ReDoS).\u003cbr data-sourcepos=\&quot;11:132-11:132\&quot;\u003e\u0026#x000A;This causes the \u003ccode data-sourcepos=\&quot;12:18-12:25\&quot;\u003eweb_hook\u003c/code\u003e Sidekiq job to get stuck at 100% CPU utilisation until the regular expression processing is complete (weeks later).\u003cbr data-sourcepos=\&quot;12:145-12:145\&quot;\u003e\u0026#x000A;The long headers are also kept in memory and the connection can be kept open.\u003c/p\u003e\u0026#x000A;\u003ch6 data-sourcepos=\&quot;15:1-15:29\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-comparison-to-1252116\&quot; class=\&quot;anchor\&quot; href=\&quot;#comparison-to-1252116\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eComparison to 1252116\u003c/h6\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;17:1-17:524\&quot; dir=\&quot;auto\&quot;\u003eIn report #1252116, the impact was that the network connection was kept open indefinitely, potentially causing connection pool and memory exhaustion. This new report is instead about CPU exhaustion for a more serious and more powerful DoS. It also bypasses the timeout added to fix #1252116 (\u003ca href=\&quot;https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6\&quot; data-reference-type=\&quot;commit\&quot; data-original=\&quot;https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6\&quot; data-link=\&quot;false\&quot; data-link-reference=\&quot;true\&quot; data-project=\&quot;278964\&quot; data-commit=\&quot;a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6\&quot; data-container=\&quot;body\&quot; data-placement=\&quot;top\&quot; title=\&quot;Add Gitlab::BufferedIo with header read timeout\&quot; class=\&quot;gfm gfm-commit has-tooltip\&quot;\u003ea8807ee5\u003c/a\u003e) (deployed in 14.9.2) as the timeout only gets hit once the regular expression has finished processing (timeout is checked between header lines).\u003c/p\u003e\u0026#x000A;\u003ch6 data-sourcepos=\&quot;19:1-19:22\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-the-root-cause\&quot; class=\&quot;anchor\&quot; href=\&quot;#the-root-cause\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eThe root cause\u003c/h6\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;21:1-21:104\&quot; dir=\&quot;auto\&quot;\u003eA Regular Expression Denial of Service (ReDoS) vulnerability in Ruby&#39;s net/http affects Gitlab webhooks.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;23:1-23:183\&quot; dir=\&quot;auto\&quot;\u003eThe bug is in \u003ca data-sourcepos=\&quot;23:15-23:148\&quot; href=\&quot;https://github.com/ruby/net-http/blob/7b852b1feb7c1c0bc3019687d6ee5c385ce26eb9/lib/net/http/response.rb#L57\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003enet/http/response.rb#57\u003c/a\u003e when reading headers line by line:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;25:1-27:3\&quot; data-canonical-lang=\&quot;rb\&quot; class=\&quot;code highlight js-syntax-highlight language-ruby\&quot; lang=\&quot;ruby\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;ruby\&quot;\u003e\u003cspan class=\&quot;n\&quot;\u003eline\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;n\&quot;\u003esock\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003ereaduntil\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s2\&quot;\u003e\&quot;\u003c/span\u003e\u003cspan class=\&quot;se\&quot;\u003e\\n\u003c/span\u003e\u003cspan class=\&quot;s2\&quot;\u003e\&quot;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;kp\&quot;\u003etrue\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e).\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003esub\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;sr\&quot;\u003e/\\s+\\z/\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;29:1-29:153\&quot; dir=\&quot;auto\&quot;\u003eThe \u003ccode data-sourcepos=\&quot;29:6-29:8\&quot;\u003esub\u003c/code\u003e regex is the issue. While it looks safe and linear, the \u003ccode data-sourcepos=\&quot;29:68-29:70\&quot;\u003esub\u003c/code\u003e operation will actually have quadratic complexity as there is no starting anchor.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;31:1-31:91\&quot; dir=\&quot;auto\&quot;\u003eA header line which contains many consecutive spaces but \u003cem data-sourcepos=\&quot;31:58-31:82\&quot;\u003edoes not end in a space\u003c/em\u003e, such as\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;33:1-35:3\&quot; data-canonical-lang=\&quot;rb\&quot; class=\&quot;code highlight js-syntax-highlight language-ruby\&quot; lang=\&quot;ruby\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;ruby\&quot;\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e \u003cspan class=\&quot;s2\&quot;\u003e\&quot;a\&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e \u003cspan class=\&quot;s2\&quot;\u003e\&quot; \&quot;\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e*\u003c/span\u003e \u003cspan class=\&quot;mi\&quot;\u003e950000\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e+\u003c/span\u003e \u003cspan class=\&quot;s2\&quot;\u003e\&quot;b\&quot;\u003c/span\u003e \u003cspan class=\&quot;p\&quot;\u003e).\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003esub\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;sr\&quot;\u003e/\\s+\\z/\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e,\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;37:1-37:34\&quot; dir=\&quot;auto\&quot;\u003ewill exhibit extreme backtracking.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;39:1-39:231\&quot; dir=\&quot;auto\&quot;\u003eThe time complexity is quadratic with respect to the number of spaces in the string (doubling the number of spaces quadruples the processing time). Approximate timings from my laptop (I measured until 10,000 and then extrapolated):\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;41:1-51:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|  Spaces  |  Seconds   |  Hours   |  Days  |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|----------|------------|----------|--------|  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC3\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|     2000 |        1.8 |          |        |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC4\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|     4000 |        7.2 |          |        |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC5\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|     8000 |       28.6 |          |        |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC6\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|    10000 |       44.7 |          |        |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC7\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|   100000 |     4473.0 |     1.24 |   0.05 |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC8\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e|  1000000 |   447300.0 |   124.25 |   5.18 |  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC9\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e| 10000000 | 44730000.0 | 12425.00 | 517.71 |  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;53:1-53:25\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-steps-to-reproduce\&quot; class=\&quot;anchor\&quot; href=\&quot;#steps-to-reproduce\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eSteps to reproduce\u003c/h5\u003e\u0026#x000A;\u003col data-sourcepos=\&quot;55:1-61:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;55:1-55:87\&quot;\u003eRun the attached malicious node server on port 3000: \u003ccode data-sourcepos=\&quot;55:58-55:84\&quot;\u003enode ./net-http-response.js\u003c/code\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;56:1-56:91\&quot;\u003eCreate a project and add webhooks for issue events to \u003ca href=\&quot;http://maliciousserver:3000/xyz\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003ehttp://maliciousserver:3000/xyz\u003c/a\u003e.\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;57:1-57:187\&quot;\u003e(If you hosted the malicious server on your local network, you will need to \&quot;Allow requests to the local network from web hooks and services\&quot; in /admin/application_settings/network.)\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;58:1-58:105\&quot;\u003eCreate an issue (or close or reopen one) to trigger the webhook. Gitlab will make a webhook request.\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;59:1-59:133\&quot;\u003eThe malicious server will respond with \u003ccode data-sourcepos=\&quot;59:44-59:58\&quot;\u003eHTTP/1.1 200 OK\u003c/code\u003e and then a header line with 9,500,000 consecutive spaces in the middle.\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;60:1-61:0\&quot;\u003eThe \u003ccode data-sourcepos=\&quot;60:9-60:16\&quot;\u003eweb_hook\u003c/code\u003e Sidekiq job will be stuck processing at 100% CPU and will not complete for \u003cstrong data-sourcepos=\&quot;60:94-60:108\&quot;\u003eover a year\u003c/strong\u003e. This can be seen in the Background Jobs panel (/admin/background_jobs) and \u003ccode data-sourcepos=\&quot;60:187-60:189\&quot;\u003etop\u003c/code\u003e:\u003c/li\u003e\u0026#x000A;\u003c/ol\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;62:1-62:142\&quot; dir=\&quot;auto\&quot;\u003e\u003ca class=\&quot;no-attachment-icon\&quot; href=\&quot;https://user-content.gitlab-static.net/d326e3dce254db7662dd95c598d2d3024a9ce7d0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61383033663064362d306462622d343435342d623762652d6162393031623436336663362f6769746c61622d686967682d6370752d6865616465722d72656765782d646f732e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; data-canonical-src=\&quot;https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png\&quot;\u003e\u003cimg data-sourcepos=\&quot;62:1-62:142\&quot; src=\&quot;data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\&quot; alt=\&quot;gitlab-high-cpu-header-regex-dos.png\&quot; data-canonical-src=\&quot;https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png\&quot; decoding=\&quot;async\&quot; class=\&quot;lazy\&quot; data-src=\&quot;https://user-content.gitlab-static.net/d326e3dce254db7662dd95c598d2d3024a9ce7d0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61383033663064362d306462622d343435342d623762652d6162393031623436336663362f6769746c61622d686967682d6370752d6865616465722d72656765782d646f732e706e67\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;64:1-64:172\&quot; dir=\&quot;auto\&quot;\u003e\u003ca class=\&quot;no-attachment-icon\&quot; href=\&quot;https://user-content.gitlab-static.net/11e83d4669b44de828e3658903940cf20fc4d913/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63356430356263392d663831332d346332372d623462352d3934303738323165663238312f6769746c61622d6865616465722d72656765782d646f732d736964656b69712d6261636b67726f756e645f6a6f62732e706e67\&quot; target=\&quot;_blank\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; data-canonical-src=\&quot;https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png\&quot;\u003e\u003cimg data-sourcepos=\&quot;64:1-64:172\&quot; src=\&quot;data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==\&quot; alt=\&quot;gitlab-header-regex-dos-sidekiq-background_jobs.png\&quot; data-canonical-src=\&quot;https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png\&quot; decoding=\&quot;async\&quot; class=\&quot;lazy\&quot; data-src=\&quot;https://user-content.gitlab-static.net/11e83d4669b44de828e3658903940cf20fc4d913/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63356430356263392d663831332d346332372d623462352d3934303738323165663238312f6769746c61622d6865616465722d72656765782d646f732d736964656b69712d6261636b67726f756e645f6a6f62732e706e67\&quot;\u003e\u003c/a\u003e\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;66:1-66:224\&quot; dir=\&quot;auto\&quot;\u003eThe ReDoS triggers on web requests made to Gitlab which trigger an external request e.g. validating the URL before repository import. However, in these cases a \u003ccode data-sourcepos=\&quot;66:162-66:184\&quot;\u003eRequestTimeoutException\u003c/code\u003e triggers after 60 seconds of 100% CPU.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;68:1-68:196\&quot; dir=\&quot;auto\&quot;\u003eThe regex runs without a timeout on project webhooks. It&#39;s not just project webhooks though. Any use of \u003ccode data-sourcepos=\&quot;68:106-68:122\&quot;\u003eGitlab::HTTP.post\u003c/code\u003e such as system webhooks and integrations (e.g. Mattermost) are affected.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;70:1-70:32\&quot; dir=\&quot;auto\&quot;\u003eTo demonstrate the net/http bug:\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;72:1-76:3\&quot; data-canonical-lang=\&quot;rb\&quot; class=\&quot;code highlight js-syntax-highlight language-ruby\&quot; lang=\&quot;ruby\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;ruby\&quot;\u003e\u003cspan class=\&quot;nb\&quot;\u003erequire\u003c/span\u003e \u003cspan class=\&quot;s1\&quot;\u003e&#39;net/http&#39;\u003c/span\u003e  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;ruby\&quot;\u003e\u003cspan class=\&quot;n\&quot;\u003euri\u003c/span\u003e \u003cspan class=\&quot;o\&quot;\u003e=\u003c/span\u003e \u003cspan class=\&quot;no\&quot;\u003eURI\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;s1\&quot;\u003e&#39;http://maliciousserver:3000/x&#39;\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC3\&quot; class=\&quot;line\&quot; lang=\&quot;ruby\&quot;\u003e\u003cspan class=\&quot;no\&quot;\u003eNet\u003c/span\u003e\u003cspan class=\&quot;o\&quot;\u003e::\u003c/span\u003e\u003cspan class=\&quot;no\&quot;\u003eHTTP\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e.\u003c/span\u003e\u003cspan class=\&quot;nf\&quot;\u003eget\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e(\u003c/span\u003e\u003cspan class=\&quot;n\&quot;\u003euri\u003c/span\u003e\u003cspan class=\&quot;p\&quot;\u003e)\u003c/span\u003e  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;78:1-78:42\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-what-is-the-current-bug-behavior\&quot; class=\&quot;anchor\&quot; href=\&quot;#what-is-the-current-bug-behavior\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eWhat is the current \u003cem data-sourcepos=\&quot;78:28-78:32\&quot;\u003ebug\u003c/em\u003e behavior?\u003c/h5\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;80:1-80:160\&quot; dir=\&quot;auto\&quot;\u003eGitlab webhooks and system hooks get stuck for years in a CPU intensive regular expression operation when receiving a malicious header from an external service.\u003c/p\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;82:1-82:47\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-what-is-the-expected-correct-behavior\&quot; class=\&quot;anchor\&quot; href=\&quot;#what-is-the-expected-correct-behavior\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eWhat is the expected \u003cem data-sourcepos=\&quot;82:29-82:37\&quot;\u003ecorrect\u003c/em\u003e behavior?\u003c/h5\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;84:1-84:152\&quot; dir=\&quot;auto\&quot;\u003eProcessing a webhook response should never take longer than a year. More strictly, it should obey the webhook read timeout and also not run at 100% CPU.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;86:1-86:230\&quot; dir=\&quot;auto\&quot;\u003eRuby should simply use \u003ccode data-sourcepos=\&quot;86:25-86:57\&quot;\u003esock.readuntil(\&quot;\\n\&quot;, true).rstrip\u003c/code\u003e instead of a regex as I think it does the same thing. I can make a PR / issue for ruby unless you want to do it yourselves - let me know if and how you want me to proceed.\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;88:1-88:55\&quot; dir=\&quot;auto\&quot;\u003ePotentially drop responses with very long header lines.\u003c/p\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;90:1-90:39\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-relevant-logs-andor-screenshots\&quot; class=\&quot;anchor\&quot; href=\&quot;#relevant-logs-andor-screenshots\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eRelevant logs and/or screenshots\u003c/h5\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;92:1-92:51\&quot; dir=\&quot;auto\&quot;\u003enet/http is called by httparty which is called by\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;93:1-95:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e\&quot;lib/gitlab/http.rb:57:in `perform_request&#39;\&quot;,\&quot;app/services/web_hook_service.rb:125:in `make_request&#39;\&quot;  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch5 data-sourcepos=\&quot;97:1-97:23\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-output-of-checks\&quot; class=\&quot;anchor\&quot; href=\&quot;#output-of-checks\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eOutput of checks\u003c/h5\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;99:1-99:94\&quot; dir=\&quot;auto\&quot;\u003eThe bug happens locally. I did not test this on Gitlab.com because I&#39;m sure it will affect it.\u003c/p\u003e\u0026#x000A;\u003ch6 data-sourcepos=\&quot;101:1-101:42\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-results-of-gitlab-environment-info\&quot; class=\&quot;anchor\&quot; href=\&quot;#results-of-gitlab-environment-info\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eResults of GitLab environment info\u003c/h6\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;103:1-104:35\&quot; dir=\&quot;auto\&quot;\u003e(For installations with omnibus-gitlab package run and paste the output of:\u003cbr data-sourcepos=\&quot;103:78-103:78\&quot;\u003e\u0026#x000A;\u003ccode data-sourcepos=\&quot;104:2-104:33\&quot;\u003esudo gitlab-rake gitlab:env:info\u003c/code\u003e)\u003c/p\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;106:1-106:17\&quot; dir=\&quot;auto\&quot;\u003eRunning in docker\u003c/p\u003e\u0026#x000A;\u003cdiv class=\&quot;gl-relative markdown-code-block js-markdown-code\&quot;\u003e\u0026#x000A;\u003cpre data-sourcepos=\&quot;108:1-142:3\&quot; class=\&quot;code highlight js-syntax-highlight language-plaintext\&quot; lang=\&quot;plaintext\&quot; v-pre=\&quot;true\&quot;\u003e\u003ccode\u003e\u003cspan id=\&quot;LC1\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eSystem information  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC2\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eSystem:  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC3\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eProxy:          no  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC4\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eCurrent User:   git  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC5\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eUsing RVM:      no  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC6\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eRuby Version:   2.7.5p203  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC7\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGem Version:    3.1.4  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC8\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eBundler Version:2.2.33  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC9\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eRake Version:   13.0.6  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC10\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eRedis Version:  6.2.6  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC11\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eSidekiq Version:6.4.0  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC12\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGo Version:     unknown\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC13\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC14\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGitLab information  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC15\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eVersion:        14.9.2-ee  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC16\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eRevision:       3034418fb31  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC17\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eDirectory:      /opt/gitlab/embedded/service/gitlab-rails  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC18\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eDB Adapter:     PostgreSQL  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC19\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eDB Version:     12.7  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC20\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eURL:            https://gitlab.example.com  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC21\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eHTTP Clone URL: https://gitlab.example.com/some-group/some-project.git  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC22\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eSSH Clone URL:  git@gitlab.example.com:some-group/some-project.git  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC23\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eElasticsearch:  no  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC24\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGeo:            no  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC25\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eUsing LDAP:     no  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC26\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eUsing Omniauth: yes  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC27\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eOmniauth Providers: \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC28\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e\u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC29\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGitLab Shell  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC30\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eVersion:        13.24.0  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC31\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eRepository storage paths:  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC32\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003e- default:      /var/opt/gitlab/git-data/repositories  \u003c/span\u003e\u0026#x000A;\u003cspan id=\&quot;LC33\&quot; class=\&quot;line\&quot; lang=\&quot;plaintext\&quot;\u003eGitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell  \u003c/span\u003e\u003c/code\u003e\u003c/pre\u003e\u0026#x000A;\u003ccopy-code\u003e\u003c/copy-code\u003e\u0026#x000A;\u003c/div\u003e\u0026#x000A;\u003ch4 data-sourcepos=\&quot;144:1-144:12\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-impact\&quot; class=\&quot;anchor\&quot; href=\&quot;#impact\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eImpact\u003c/h4\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;146:1-149:187\&quot; dir=\&quot;auto\&quot;\u003eCPU exhaustion DoS.\u003cbr data-sourcepos=\&quot;146:22-146:22\&quot;\u003e\u0026#x000A;Memory exhaustion DoS.\u003cbr data-sourcepos=\&quot;147:25-147:25\&quot;\u003e\u0026#x000A;CPU intensive Sidekiq job runs forever (ok, not forever, but over a year) wasting energy and slowing down the system.\u003cbr data-sourcepos=\&quot;148:120-148:120\&quot;\u003e\u0026#x000A;Also possible to get connection pool exhaustion by sending data slowly and keeping the socket open until the regex completes (bypassing fix for #1252116) for multiple webhook connections.\u003c/p\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;151:1-151:14\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-attachments\&quot; class=\&quot;anchor\&quot; href=\&quot;#attachments\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eAttachments\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;153:1-153:77\&quot; dir=\&quot;auto\&quot;\u003e\u003cstrong data-sourcepos=\&quot;153:1-153:12\&quot;\u003eWarning:\u003c/strong\u003e Attachments received through HackerOne, please exercise caution!\u003c/p\u003e\u0026#x000A;\u003cul data-sourcepos=\&quot;155:1-158:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;155:1-155:143\&quot;\u003e\u003ca data-sourcepos=\&quot;155:3-155:143\&quot; href=\&quot;https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003egitlab-high-cpu-header-regex-dos.png\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;156:1-156:173\&quot;\u003e\u003ca data-sourcepos=\&quot;156:3-156:173\&quot; href=\&quot;https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003egitlab-header-regex-dos-sidekiq-background_jobs.png\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;157:1-158:0\&quot;\u003e\u003ca data-sourcepos=\&quot;157:3-157:111\&quot; href=\&quot;https://h1.sec.gitlab.net/a/f0253922-20e1-4080-91f9-2ba71f81ae68/net-http-response.js\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003enet-http-response.js\u003c/a\u003e\u003c/li\u003e\u0026#x000A;\u003c/ul\u003e\u0026#x000A;\u003ch2 data-sourcepos=\&quot;159:1-159:19\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003ca id=\&quot;user-content-how-to-reproduce\&quot; class=\&quot;anchor\&quot; href=\&quot;#how-to-reproduce\&quot; aria-hidden=\&quot;true\&quot;\u003e\u003c/a\u003eHow To Reproduce\u003c/h2\u003e\u0026#x000A;\u003cp data-sourcepos=\&quot;161:1-161:57\&quot; dir=\&quot;auto\&quot;\u003ePlease add \u003ca data-sourcepos=\&quot;161:12-161:40\&quot; href=\&quot;https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues\&quot; rel=\&quot;nofollow noreferrer noopener\&quot; target=\&quot;_blank\&quot;\u003ereproducibility information\u003c/a\u003e to this section:\u003c/p\u003e\u0026#x000A;\u003col data-sourcepos=\&quot;163:1-166:0\&quot; dir=\&quot;auto\&quot;\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;163:1-163:2\&quot;\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;164:1-164:2\&quot;\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003cli data-sourcepos=\&quot;165:1-165:2\&quot;\u003e\u0026#x000A;\u003c/li\u003e\u0026#x000A;\u003c/ol\u003e&quot;,&quot;initialDescriptionText&quot;:&quot;**[HackerOne report #1531958](https://hackerone.com/reports/1531958)** by `afewgoats` on 2022-04-06, assigned to `GitLab Team`:\n\n[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)\n\n## Report\n\n#####  Summary\n\nA Gitlab webhook may be pointed at a malicious webhook receiver.  \nThe webhook receiver can respond with a specially crafted long header.  \nGitlab processes the header with Ruby&#39;s net/http where there is a regular expression operation with quadratic complexity (ReDoS).  \nThis causes the `web_hook` Sidekiq job to get stuck at 100% CPU utilisation until the regular expression processing is complete (weeks later).  \nThe long headers are also kept in memory and the connection can be kept open.\n\n######  Comparison to 1252116\n\nIn report #1252116, the impact was that the network connection was kept open indefinitely, potentially causing connection pool and memory exhaustion. This new report is instead about CPU exhaustion for a more serious and more powerful DoS. It also bypasses the timeout added to fix #1252116 (https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6) (deployed in 14.9.2) as the timeout only gets hit once the regular expression has finished processing (timeout is checked between header lines).\n\n######  The root cause\n\nA Regular Expression Denial of Service (ReDoS) vulnerability in Ruby&#39;s net/http affects Gitlab webhooks.\n\nThe bug is in [net/http/response.rb#57](https://github.com/ruby/net-http/blob/7b852b1feb7c1c0bc3019687d6ee5c385ce26eb9/lib/net/http/response.rb#L57) when reading headers line by line:\n\n```rb  \nline = sock.readuntil(\&quot;\\n\&quot;, true).sub(/\\s+\\z/, &#39;&#39;)  \n```\n\nThe `sub` regex is the issue. While it looks safe and linear, the `sub` operation will actually have quadratic complexity as there is no starting anchor.\n\nA header line which contains many consecutive spaces but *does not end in a space*, such as\n\n```rb  \n( \&quot;a\&quot; + \&quot; \&quot; * 950000 + \&quot;b\&quot; ).sub(/\\s+\\z/, &#39;&#39;)  \n```\n\nwill exhibit extreme backtracking.\n\nThe time complexity is quadratic with respect to the number of spaces in the string (doubling the number of spaces quadruples the processing time). Approximate timings from my laptop (I measured until 10,000 and then extrapolated):\n\n```  \n|  Spaces  |  Seconds   |  Hours   |  Days  |  \n|----------|------------|----------|--------|  \n|     2000 |        1.8 |          |        |  \n|     4000 |        7.2 |          |        |  \n|     8000 |       28.6 |          |        |  \n|    10000 |       44.7 |          |        |  \n|   100000 |     4473.0 |     1.24 |   0.05 |  \n|  1000000 |   447300.0 |   124.25 |   5.18 |  \n| 10000000 | 44730000.0 | 12425.00 | 517.71 |  \n```\n\n#####  Steps to reproduce\n\n1. Run the attached malicious node server on port 3000: `node ./net-http-response.js`  \n2. Create a project and add webhooks for issue events to http://maliciousserver:3000/xyz.  \n3. (If you hosted the malicious server on your local network, you will need to \&quot;Allow requests to the local network from web hooks and services\&quot; in /admin/application_settings/network.)  \n4. Create an issue (or close or reopen one) to trigger the webhook. Gitlab will make a webhook request.  \n5. The malicious server will respond with `HTTP/1.1 200 OK` and then a header line with 9,500,000 consecutive spaces in the middle.  \n6. The `web_hook` Sidekiq job will be stuck processing at 100% CPU and will not complete for **over a year**. This can be seen in the Background Jobs panel (/admin/background_jobs) and `top`:\n\n![gitlab-high-cpu-header-regex-dos.png](https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png)\n\n![gitlab-header-regex-dos-sidekiq-background_jobs.png](https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png)\n\nThe ReDoS triggers on web requests made to Gitlab which trigger an external request e.g. validating the URL before repository import. However, in these cases a `RequestTimeoutException` triggers after 60 seconds of 100% CPU.\n\nThe regex runs without a timeout on project webhooks. It&#39;s not just project webhooks though. Any use of `Gitlab::HTTP.post` such as system webhooks and integrations (e.g. Mattermost) are affected.\n\nTo demonstrate the net/http bug:\n\n```rb  \nrequire &#39;net/http&#39;  \nuri = URI(&#39;http://maliciousserver:3000/x&#39;)  \nNet::HTTP.get(uri)  \n```\n\n#####  What is the current *bug* behavior?\n\nGitlab webhooks and system hooks get stuck for years in a CPU intensive regular expression operation when receiving a malicious header from an external service.\n\n#####  What is the expected *correct* behavior?\n\nProcessing a webhook response should never take longer than a year. More strictly, it should obey the webhook read timeout and also not run at 100% CPU.\n\nRuby should simply use `sock.readuntil(\&quot;\\n\&quot;, true).rstrip` instead of a regex as I think it does the same thing. I can make a PR / issue for ruby unless you want to do it yourselves - let me know if and how you want me to proceed.\n\nPotentially drop responses with very long header lines.\n\n#####  Relevant logs and/or screenshots\n\nnet/http is called by httparty which is called by  \n```  \n\&quot;lib/gitlab/http.rb:57:in `perform_request&#39;\&quot;,\&quot;app/services/web_hook_service.rb:125:in `make_request&#39;\&quot;  \n```\n\n#####  Output of checks\n\nThe bug happens locally. I did not test this on Gitlab.com because I&#39;m sure it will affect it.\n\n######  Results of GitLab environment info\n\n(For installations with omnibus-gitlab package run and paste the output of:  \n`sudo gitlab-rake gitlab:env:info`)\n\nRunning in docker\n\n```  \nSystem information  \nSystem:  \nProxy:          no  \nCurrent User:   git  \nUsing RVM:      no  \nRuby Version:   2.7.5p203  \nGem Version:    3.1.4  \nBundler Version:2.2.33  \nRake Version:   13.0.6  \nRedis Version:  6.2.6  \nSidekiq Version:6.4.0  \nGo Version:     unknown\n\nGitLab information  \nVersion:        14.9.2-ee  \nRevision:       3034418fb31  \nDirectory:      /opt/gitlab/embedded/service/gitlab-rails  \nDB Adapter:     PostgreSQL  \nDB Version:     12.7  \nURL:            https://gitlab.example.com  \nHTTP Clone URL: https://gitlab.example.com/some-group/some-project.git  \nSSH Clone URL:  git@gitlab.example.com:some-group/some-project.git  \nElasticsearch:  no  \nGeo:            no  \nUsing LDAP:     no  \nUsing Omniauth: yes  \nOmniauth Providers: \n\nGitLab Shell  \nVersion:        13.24.0  \nRepository storage paths:  \n- default:      /var/opt/gitlab/git-data/repositories  \nGitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell  \n```\n\n####  Impact\n\nCPU exhaustion DoS.  \nMemory exhaustion DoS.  \nCPU intensive Sidekiq job runs forever (ok, not forever, but over a year) wasting energy and slowing down the system.  \nAlso possible to get connection pool exhaustion by sending data slowly and keeping the socket open until the regex completes (bypassing fix for #1252116) for multiple webhook connections.\n\n## Attachments\n\n**Warning:** Attachments received through HackerOne, please exercise caution!\n\n* [gitlab-high-cpu-header-regex-dos.png](https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png)\n* [gitlab-header-regex-dos-sidekiq-background_jobs.png](https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png)\n* [net-http-response.js](https://h1.sec.gitlab.net/a/f0253922-20e1-4080-91f9-2ba71f81ae68/net-http-response.js)\n\n## How To Reproduce\n\nPlease add [reproducibility information] to this section:\n\n1.\n1.\n1.\n\n[reproducibility information]: https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues&quot;,&quot;initialTaskCompletionStatus&quot;:{&quot;count&quot;:0,&quot;completed_count&quot;:0},&quot;canCreateIncident&quot;:false,&quot;fullPath&quot;:&quot;gitlab-org/gitlab&quot;,&quot;iid&quot;:358160,&quot;issuableId&quot;:106261016,&quot;issueType&quot;:&quot;issue&quot;,&quot;isHidden&quot;:false,&quot;zoomMeetingUrl&quot;:null,&quot;authorId&quot;:2741139,&quot;authorName&quot;:&quot;GitLab SecurityBot&quot;,&quot;authorUsername&quot;:&quot;gitlab-securitybot&quot;,&quot;authorWebUrl&quot;:&quot;/gitlab-securitybot&quot;,&quot;createdAt&quot;:&quot;2022-04-07T14:42:58+00:00&quot;,&quot;isFirstContribution&quot;:false,&quot;serviceDeskReplyTo&quot;:null,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;signInPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;publishedIncidentUrl&quot;:null,&quot;slaFeatureAvailable&quot;:&quot;false&quot;,&quot;uploadMetricsFeatureAvailable&quot;:&quot;false&quot;,&quot;projectId&quot;:278964,&quot;projectPath&quot;:&quot;gitlab&quot;,&quot;projectNamespace&quot;:&quot;gitlab-org&quot;,&quot;canAdmin&quot;:false,&quot;hasIssueWeightsFeature&quot;:true,&quot;hasIterationsFeature&quot;:true,&quot;canAdminRelation&quot;:false}" id="js-issuable-app">
<div class="title-container">
<h1 class="gl-heading-1 !gl-m-0">ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year</h1>
</div>
<div class="description">
<div class="md"><p data-sourcepos="1:1-1:127" dir="auto"><strong data-sourcepos="1:1-1:70"><a data-sourcepos="1:3-1:68" href="https://hackerone.com/reports/1531958" rel="nofollow noreferrer noopener" target="_blank">HackerOne report #1531958</a></strong> by <code data-sourcepos="1:76-1:84">afewgoats</code> on 2022-04-06, assigned to <code data-sourcepos="1:115-1:125">GitLab Team</code>:</p>&#x000A;<p data-sourcepos="3:1-3:87" dir="auto"><a data-sourcepos="3:1-3:17" href="#report">Report</a> | <a data-sourcepos="3:21-3:47" href="#attachments">Attachments</a> | <a data-sourcepos="3:51-3:87" href="#how-to-reproduce">How To Reproduce</a></p>&#x000A;<h2 data-sourcepos="5:1-5:9" dir="auto">&#x000A;<a id="user-content-report" class="anchor" href="#report" aria-hidden="true"></a>Report</h2>&#x000A;<h5 data-sourcepos="7:1-7:14" dir="auto">&#x000A;<a id="user-content-summary" class="anchor" href="#summary" aria-hidden="true"></a>Summary</h5>&#x000A;<p data-sourcepos="9:1-13:77" dir="auto">A Gitlab webhook may be pointed at a malicious webhook receiver.<br data-sourcepos="9:67-9:67">&#x000A;The webhook receiver can respond with a specially crafted long header.<br data-sourcepos="10:73-10:73">&#x000A;Gitlab processes the header with Ruby's net/http where there is a regular expression operation with quadratic complexity (ReDoS).<br data-sourcepos="11:132-11:132">&#x000A;This causes the <code data-sourcepos="12:18-12:25">web_hook</code> Sidekiq job to get stuck at 100% CPU utilisation until the regular expression processing is complete (weeks later).<br data-sourcepos="12:145-12:145">&#x000A;The long headers are also kept in memory and the connection can be kept open.</p>&#x000A;<h6 data-sourcepos="15:1-15:29" dir="auto">&#x000A;<a id="user-content-comparison-to-1252116" class="anchor" href="#comparison-to-1252116" aria-hidden="true"></a>Comparison to 1252116</h6>&#x000A;<p data-sourcepos="17:1-17:524" dir="auto">In report #1252116, the impact was that the network connection was kept open indefinitely, potentially causing connection pool and memory exhaustion. This new report is instead about CPU exhaustion for a more serious and more powerful DoS. It also bypasses the timeout added to fix #1252116 (<a href="https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6" data-reference-type="commit" data-original="https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6" data-link="false" data-link-reference="true" data-project="278964" data-commit="a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6" data-container="body" data-placement="top" title="Add Gitlab::BufferedIo with header read timeout" class="gfm gfm-commit has-tooltip">a8807ee5</a>) (deployed in 14.9.2) as the timeout only gets hit once the regular expression has finished processing (timeout is checked between header lines).</p>&#x000A;<h6 data-sourcepos="19:1-19:22" dir="auto">&#x000A;<a id="user-content-the-root-cause" class="anchor" href="#the-root-cause" aria-hidden="true"></a>The root cause</h6>&#x000A;<p data-sourcepos="21:1-21:104" dir="auto">A Regular Expression Denial of Service (ReDoS) vulnerability in Ruby's net/http affects Gitlab webhooks.</p>&#x000A;<p data-sourcepos="23:1-23:183" dir="auto">The bug is in <a data-sourcepos="23:15-23:148" href="https://github.com/ruby/net-http/blob/7b852b1feb7c1c0bc3019687d6ee5c385ce26eb9/lib/net/http/response.rb#L57" rel="nofollow noreferrer noopener" target="_blank">net/http/response.rb#57</a> when reading headers line by line:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="25:1-27:3" data-canonical-lang="rb" class="code highlight js-syntax-highlight language-ruby" lang="ruby" v-pre="true"><code><span id="LC1" class="line" lang="ruby"><span class="n">line</span> <span class="o">=</span> <span class="n">sock</span><span class="p">.</span><span class="nf">readuntil</span><span class="p">(</span><span class="s2">"</span><span class="se">\n</span><span class="s2">"</span><span class="p">,</span> <span class="kp">true</span><span class="p">).</span><span class="nf">sub</span><span class="p">(</span><span class="sr">/\s+\z/</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="29:1-29:153" dir="auto">The <code data-sourcepos="29:6-29:8">sub</code> regex is the issue. While it looks safe and linear, the <code data-sourcepos="29:68-29:70">sub</code> operation will actually have quadratic complexity as there is no starting anchor.</p>&#x000A;<p data-sourcepos="31:1-31:91" dir="auto">A header line which contains many consecutive spaces but <em data-sourcepos="31:58-31:82">does not end in a space</em>, such as</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="33:1-35:3" data-canonical-lang="rb" class="code highlight js-syntax-highlight language-ruby" lang="ruby" v-pre="true"><code><span id="LC1" class="line" lang="ruby"><span class="p">(</span> <span class="s2">"a"</span> <span class="o">+</span> <span class="s2">" "</span> <span class="o">*</span> <span class="mi">950000</span> <span class="o">+</span> <span class="s2">"b"</span> <span class="p">).</span><span class="nf">sub</span><span class="p">(</span><span class="sr">/\s+\z/</span><span class="p">,</span> <span class="s1">''</span><span class="p">)</span>  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<p data-sourcepos="37:1-37:34" dir="auto">will exhibit extreme backtracking.</p>&#x000A;<p data-sourcepos="39:1-39:231" dir="auto">The time complexity is quadratic with respect to the number of spaces in the string (doubling the number of spaces quadruples the processing time). Approximate timings from my laptop (I measured until 10,000 and then extrapolated):</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="41:1-51:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">|  Spaces  |  Seconds   |  Hours   |  Days  |  </span>&#x000A;<span id="LC2" class="line" lang="plaintext">|----------|------------|----------|--------|  </span>&#x000A;<span id="LC3" class="line" lang="plaintext">|     2000 |        1.8 |          |        |  </span>&#x000A;<span id="LC4" class="line" lang="plaintext">|     4000 |        7.2 |          |        |  </span>&#x000A;<span id="LC5" class="line" lang="plaintext">|     8000 |       28.6 |          |        |  </span>&#x000A;<span id="LC6" class="line" lang="plaintext">|    10000 |       44.7 |          |        |  </span>&#x000A;<span id="LC7" class="line" lang="plaintext">|   100000 |     4473.0 |     1.24 |   0.05 |  </span>&#x000A;<span id="LC8" class="line" lang="plaintext">|  1000000 |   447300.0 |   124.25 |   5.18 |  </span>&#x000A;<span id="LC9" class="line" lang="plaintext">| 10000000 | 44730000.0 | 12425.00 | 517.71 |  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h5 data-sourcepos="53:1-53:25" dir="auto">&#x000A;<a id="user-content-steps-to-reproduce" class="anchor" href="#steps-to-reproduce" aria-hidden="true"></a>Steps to reproduce</h5>&#x000A;<ol data-sourcepos="55:1-61:0" dir="auto">&#x000A;<li data-sourcepos="55:1-55:87">Run the attached malicious node server on port 3000: <code data-sourcepos="55:58-55:84">node ./net-http-response.js</code>&#x000A;</li>&#x000A;<li data-sourcepos="56:1-56:91">Create a project and add webhooks for issue events to <a href="http://maliciousserver:3000/xyz" rel="nofollow noreferrer noopener" target="_blank">http://maliciousserver:3000/xyz</a>.</li>&#x000A;<li data-sourcepos="57:1-57:187">(If you hosted the malicious server on your local network, you will need to "Allow requests to the local network from web hooks and services" in /admin/application_settings/network.)</li>&#x000A;<li data-sourcepos="58:1-58:105">Create an issue (or close or reopen one) to trigger the webhook. Gitlab will make a webhook request.</li>&#x000A;<li data-sourcepos="59:1-59:133">The malicious server will respond with <code data-sourcepos="59:44-59:58">HTTP/1.1 200 OK</code> and then a header line with 9,500,000 consecutive spaces in the middle.</li>&#x000A;<li data-sourcepos="60:1-61:0">The <code data-sourcepos="60:9-60:16">web_hook</code> Sidekiq job will be stuck processing at 100% CPU and will not complete for <strong data-sourcepos="60:94-60:108">over a year</strong>. This can be seen in the Background Jobs panel (/admin/background_jobs) and <code data-sourcepos="60:187-60:189">top</code>:</li>&#x000A;</ol>&#x000A;<p data-sourcepos="62:1-62:142" dir="auto"><a class="no-attachment-icon" href="https://user-content.gitlab-static.net/d326e3dce254db7662dd95c598d2d3024a9ce7d0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61383033663064362d306462622d343435342d623762652d6162393031623436336663362f6769746c61622d686967682d6370752d6865616465722d72656765782d646f732e706e67" target="_blank" rel="nofollow noreferrer noopener" data-canonical-src="https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png"><img data-sourcepos="62:1-62:142" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitlab-high-cpu-header-regex-dos.png" data-canonical-src="https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png" decoding="async" class="lazy" data-src="https://user-content.gitlab-static.net/d326e3dce254db7662dd95c598d2d3024a9ce7d0/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f61383033663064362d306462622d343435342d623762652d6162393031623436336663362f6769746c61622d686967682d6370752d6865616465722d72656765782d646f732e706e67"></a></p>&#x000A;<p data-sourcepos="64:1-64:172" dir="auto"><a class="no-attachment-icon" href="https://user-content.gitlab-static.net/11e83d4669b44de828e3658903940cf20fc4d913/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63356430356263392d663831332d346332372d623462352d3934303738323165663238312f6769746c61622d6865616465722d72656765782d646f732d736964656b69712d6261636b67726f756e645f6a6f62732e706e67" target="_blank" rel="nofollow noreferrer noopener" data-canonical-src="https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png"><img data-sourcepos="64:1-64:172" src="data:image/gif;base64,R0lGODlhAQABAAAAACH5BAEKAAEALAAAAAABAAEAAAICTAEAOw==" alt="gitlab-header-regex-dos-sidekiq-background_jobs.png" data-canonical-src="https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png" decoding="async" class="lazy" data-src="https://user-content.gitlab-static.net/11e83d4669b44de828e3658903940cf20fc4d913/68747470733a2f2f68312e7365632e6769746c61622e6e65742f612f63356430356263392d663831332d346332372d623462352d3934303738323165663238312f6769746c61622d6865616465722d72656765782d646f732d736964656b69712d6261636b67726f756e645f6a6f62732e706e67"></a></p>&#x000A;<p data-sourcepos="66:1-66:224" dir="auto">The ReDoS triggers on web requests made to Gitlab which trigger an external request e.g. validating the URL before repository import. However, in these cases a <code data-sourcepos="66:162-66:184">RequestTimeoutException</code> triggers after 60 seconds of 100% CPU.</p>&#x000A;<p data-sourcepos="68:1-68:196" dir="auto">The regex runs without a timeout on project webhooks. It's not just project webhooks though. Any use of <code data-sourcepos="68:106-68:122">Gitlab::HTTP.post</code> such as system webhooks and integrations (e.g. Mattermost) are affected.</p>&#x000A;<p data-sourcepos="70:1-70:32" dir="auto">To demonstrate the net/http bug:</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="72:1-76:3" data-canonical-lang="rb" class="code highlight js-syntax-highlight language-ruby" lang="ruby" v-pre="true"><code><span id="LC1" class="line" lang="ruby"><span class="nb">require</span> <span class="s1">'net/http'</span>  </span>&#x000A;<span id="LC2" class="line" lang="ruby"><span class="n">uri</span> <span class="o">=</span> <span class="no">URI</span><span class="p">(</span><span class="s1">'http://maliciousserver:3000/x'</span><span class="p">)</span>  </span>&#x000A;<span id="LC3" class="line" lang="ruby"><span class="no">Net</span><span class="o">::</span><span class="no">HTTP</span><span class="p">.</span><span class="nf">get</span><span class="p">(</span><span class="n">uri</span><span class="p">)</span>  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h5 data-sourcepos="78:1-78:42" dir="auto">&#x000A;<a id="user-content-what-is-the-current-bug-behavior" class="anchor" href="#what-is-the-current-bug-behavior" aria-hidden="true"></a>What is the current <em data-sourcepos="78:28-78:32">bug</em> behavior?</h5>&#x000A;<p data-sourcepos="80:1-80:160" dir="auto">Gitlab webhooks and system hooks get stuck for years in a CPU intensive regular expression operation when receiving a malicious header from an external service.</p>&#x000A;<h5 data-sourcepos="82:1-82:47" dir="auto">&#x000A;<a id="user-content-what-is-the-expected-correct-behavior" class="anchor" href="#what-is-the-expected-correct-behavior" aria-hidden="true"></a>What is the expected <em data-sourcepos="82:29-82:37">correct</em> behavior?</h5>&#x000A;<p data-sourcepos="84:1-84:152" dir="auto">Processing a webhook response should never take longer than a year. More strictly, it should obey the webhook read timeout and also not run at 100% CPU.</p>&#x000A;<p data-sourcepos="86:1-86:230" dir="auto">Ruby should simply use <code data-sourcepos="86:25-86:57">sock.readuntil("\n", true).rstrip</code> instead of a regex as I think it does the same thing. I can make a PR / issue for ruby unless you want to do it yourselves - let me know if and how you want me to proceed.</p>&#x000A;<p data-sourcepos="88:1-88:55" dir="auto">Potentially drop responses with very long header lines.</p>&#x000A;<h5 data-sourcepos="90:1-90:39" dir="auto">&#x000A;<a id="user-content-relevant-logs-andor-screenshots" class="anchor" href="#relevant-logs-andor-screenshots" aria-hidden="true"></a>Relevant logs and/or screenshots</h5>&#x000A;<p data-sourcepos="92:1-92:51" dir="auto">net/http is called by httparty which is called by</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="93:1-95:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">"lib/gitlab/http.rb:57:in `perform_request'","app/services/web_hook_service.rb:125:in `make_request'"  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h5 data-sourcepos="97:1-97:23" dir="auto">&#x000A;<a id="user-content-output-of-checks" class="anchor" href="#output-of-checks" aria-hidden="true"></a>Output of checks</h5>&#x000A;<p data-sourcepos="99:1-99:94" dir="auto">The bug happens locally. I did not test this on Gitlab.com because I'm sure it will affect it.</p>&#x000A;<h6 data-sourcepos="101:1-101:42" dir="auto">&#x000A;<a id="user-content-results-of-gitlab-environment-info" class="anchor" href="#results-of-gitlab-environment-info" aria-hidden="true"></a>Results of GitLab environment info</h6>&#x000A;<p data-sourcepos="103:1-104:35" dir="auto">(For installations with omnibus-gitlab package run and paste the output of:<br data-sourcepos="103:78-103:78">&#x000A;<code data-sourcepos="104:2-104:33">sudo gitlab-rake gitlab:env:info</code>)</p>&#x000A;<p data-sourcepos="106:1-106:17" dir="auto">Running in docker</p>&#x000A;<div class="gl-relative markdown-code-block js-markdown-code">&#x000A;<pre data-sourcepos="108:1-142:3" class="code highlight js-syntax-highlight language-plaintext" lang="plaintext" v-pre="true"><code><span id="LC1" class="line" lang="plaintext">System information  </span>&#x000A;<span id="LC2" class="line" lang="plaintext">System:  </span>&#x000A;<span id="LC3" class="line" lang="plaintext">Proxy:          no  </span>&#x000A;<span id="LC4" class="line" lang="plaintext">Current User:   git  </span>&#x000A;<span id="LC5" class="line" lang="plaintext">Using RVM:      no  </span>&#x000A;<span id="LC6" class="line" lang="plaintext">Ruby Version:   2.7.5p203  </span>&#x000A;<span id="LC7" class="line" lang="plaintext">Gem Version:    3.1.4  </span>&#x000A;<span id="LC8" class="line" lang="plaintext">Bundler Version:2.2.33  </span>&#x000A;<span id="LC9" class="line" lang="plaintext">Rake Version:   13.0.6  </span>&#x000A;<span id="LC10" class="line" lang="plaintext">Redis Version:  6.2.6  </span>&#x000A;<span id="LC11" class="line" lang="plaintext">Sidekiq Version:6.4.0  </span>&#x000A;<span id="LC12" class="line" lang="plaintext">Go Version:     unknown</span>&#x000A;<span id="LC13" class="line" lang="plaintext"></span>&#x000A;<span id="LC14" class="line" lang="plaintext">GitLab information  </span>&#x000A;<span id="LC15" class="line" lang="plaintext">Version:        14.9.2-ee  </span>&#x000A;<span id="LC16" class="line" lang="plaintext">Revision:       3034418fb31  </span>&#x000A;<span id="LC17" class="line" lang="plaintext">Directory:      /opt/gitlab/embedded/service/gitlab-rails  </span>&#x000A;<span id="LC18" class="line" lang="plaintext">DB Adapter:     PostgreSQL  </span>&#x000A;<span id="LC19" class="line" lang="plaintext">DB Version:     12.7  </span>&#x000A;<span id="LC20" class="line" lang="plaintext">URL:            https://gitlab.example.com  </span>&#x000A;<span id="LC21" class="line" lang="plaintext">HTTP Clone URL: https://gitlab.example.com/some-group/some-project.git  </span>&#x000A;<span id="LC22" class="line" lang="plaintext">SSH Clone URL:  git@gitlab.example.com:some-group/some-project.git  </span>&#x000A;<span id="LC23" class="line" lang="plaintext">Elasticsearch:  no  </span>&#x000A;<span id="LC24" class="line" lang="plaintext">Geo:            no  </span>&#x000A;<span id="LC25" class="line" lang="plaintext">Using LDAP:     no  </span>&#x000A;<span id="LC26" class="line" lang="plaintext">Using Omniauth: yes  </span>&#x000A;<span id="LC27" class="line" lang="plaintext">Omniauth Providers: </span>&#x000A;<span id="LC28" class="line" lang="plaintext"></span>&#x000A;<span id="LC29" class="line" lang="plaintext">GitLab Shell  </span>&#x000A;<span id="LC30" class="line" lang="plaintext">Version:        13.24.0  </span>&#x000A;<span id="LC31" class="line" lang="plaintext">Repository storage paths:  </span>&#x000A;<span id="LC32" class="line" lang="plaintext">- default:      /var/opt/gitlab/git-data/repositories  </span>&#x000A;<span id="LC33" class="line" lang="plaintext">GitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell  </span></code></pre>&#x000A;<copy-code></copy-code>&#x000A;</div>&#x000A;<h4 data-sourcepos="144:1-144:12" dir="auto">&#x000A;<a id="user-content-impact" class="anchor" href="#impact" aria-hidden="true"></a>Impact</h4>&#x000A;<p data-sourcepos="146:1-149:187" dir="auto">CPU exhaustion DoS.<br data-sourcepos="146:22-146:22">&#x000A;Memory exhaustion DoS.<br data-sourcepos="147:25-147:25">&#x000A;CPU intensive Sidekiq job runs forever (ok, not forever, but over a year) wasting energy and slowing down the system.<br data-sourcepos="148:120-148:120">&#x000A;Also possible to get connection pool exhaustion by sending data slowly and keeping the socket open until the regex completes (bypassing fix for #1252116) for multiple webhook connections.</p>&#x000A;<h2 data-sourcepos="151:1-151:14" dir="auto">&#x000A;<a id="user-content-attachments" class="anchor" href="#attachments" aria-hidden="true"></a>Attachments</h2>&#x000A;<p data-sourcepos="153:1-153:77" dir="auto"><strong data-sourcepos="153:1-153:12">Warning:</strong> Attachments received through HackerOne, please exercise caution!</p>&#x000A;<ul data-sourcepos="155:1-158:0" dir="auto">&#x000A;<li data-sourcepos="155:1-155:143"><a data-sourcepos="155:3-155:143" href="https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png" rel="nofollow noreferrer noopener" target="_blank">gitlab-high-cpu-header-regex-dos.png</a></li>&#x000A;<li data-sourcepos="156:1-156:173"><a data-sourcepos="156:3-156:173" href="https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png" rel="nofollow noreferrer noopener" target="_blank">gitlab-header-regex-dos-sidekiq-background_jobs.png</a></li>&#x000A;<li data-sourcepos="157:1-158:0"><a data-sourcepos="157:3-157:111" href="https://h1.sec.gitlab.net/a/f0253922-20e1-4080-91f9-2ba71f81ae68/net-http-response.js" rel="nofollow noreferrer noopener" target="_blank">net-http-response.js</a></li>&#x000A;</ul>&#x000A;<h2 data-sourcepos="159:1-159:19" dir="auto">&#x000A;<a id="user-content-how-to-reproduce" class="anchor" href="#how-to-reproduce" aria-hidden="true"></a>How To Reproduce</h2>&#x000A;<p data-sourcepos="161:1-161:57" dir="auto">Please add <a data-sourcepos="161:12-161:40" href="https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues" rel="nofollow noreferrer noopener" target="_blank">reproducibility information</a> to this section:</p>&#x000A;<ol data-sourcepos="163:1-166:0" dir="auto">&#x000A;<li data-sourcepos="163:1-163:2">&#x000A;</li>&#x000A;<li data-sourcepos="164:1-164:2">&#x000A;</li>&#x000A;<li data-sourcepos="165:1-165:2">&#x000A;</li>&#x000A;</ol></div>
</div>

</div>
<div class="js-issue-widgets">
<div class="emoji-block emoji-block-sticky">
<div class="row gl-m-0 gl-justify-between">
<div class="js-noteable-awards">
<div class="gl-flex gl-flex-wrap gl-justify-between gl-pt-3">
<div data-can-award-emoji="false" data-path="/api/v4/projects/278964/issues/358160/award_emoji" data-show-default-award-emojis="true" id="js-vue-awards-block"></div>

</div>

</div>
<div class="new-branch-col gl-font-size-0 gl-my-2">

</div>
</div>
</div>

</div>
</div>
<div class="js-issue-widgets">

<div class="js-design-management" data-issue-iid="358160" data-issue-path="/gitlab-org/gitlab/-/issues/358160" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-project-path="gitlab-org/gitlab" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div class="js-work-item-links-root" data-full-path="gitlab-org/gitlab" data-issuable-id="106261016" data-issuable-iid="358160" data-register-path="/users/sign_up?redirect_to_referer=yes" data-sign-in-path="/users/sign_in?redirect_to_referer=yes" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-can-bulk-edit-epics="false" data-wi-can-create-projects="false" data-wi-default-branch="master" data-wi-epics-list-path="/groups/gitlab/-/epics" data-wi-full-path="gitlab-org/gitlab" data-wi-group-id="9970" data-wi-group-issues-path="/groups/gitlab/-/issues" data-wi-group-path="gitlab-org" data-wi-has-epics-feature="true" data-wi-has-issuable-health-status-feature="true" data-wi-has-issue-weights-feature="true" data-wi-has-iterations-feature="true" data-wi-has-linked-items-epics-feature="true" data-wi-has-okrs-feature="true" data-wi-has-quality-management-feature="true" data-wi-has-scoped-labels-feature="true" data-wi-has-subepics-feature="true" data-wi-is-signed-in="false" data-wi-issues-list-path="/gitlab-org/gitlab/-/issues" data-wi-labels-fetch-path="/groups/gitlab/-/labels.json?include_ancestor_groups=true&amp;only_group_labels=true" data-wi-labels-manage-path="/gitlab-org/gitlab/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-new-project-path="/projects/new?namespace_id=9970" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>


<div class="js-related-issues-root" data-can-add-related-issues="false" data-endpoint="/gitlab-org/gitlab/-/issues/358160/links" data-full-path="gitlab-org/gitlab" data-has-issue-weights-feature="true" data-has-iterations-feature="true" data-help-path="/help/user/project/issues/related_issues.md" data-is-group="false" data-issuable-type="issue" data-show-categorized-issues="true" data-wi-autocomplete-award-emojis-path="/-/autocomplete/award_emojis" data-wi-can-admin-label="false" data-wi-can-bulk-edit-epics="false" data-wi-can-create-projects="false" data-wi-default-branch="master" data-wi-epics-list-path="/groups/gitlab/-/epics" data-wi-full-path="gitlab-org/gitlab" data-wi-group-id="9970" data-wi-group-issues-path="/groups/gitlab/-/issues" data-wi-group-path="gitlab-org" data-wi-has-epics-feature="true" data-wi-has-issuable-health-status-feature="true" data-wi-has-issue-weights-feature="true" data-wi-has-iterations-feature="true" data-wi-has-linked-items-epics-feature="true" data-wi-has-okrs-feature="true" data-wi-has-quality-management-feature="true" data-wi-has-scoped-labels-feature="true" data-wi-has-subepics-feature="true" data-wi-is-signed-in="false" data-wi-issues-list-path="/gitlab-org/gitlab/-/issues" data-wi-labels-fetch-path="/groups/gitlab/-/labels.json?include_ancestor_groups=true&amp;only_group_labels=true" data-wi-labels-manage-path="/gitlab-org/gitlab/-/labels" data-wi-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-wi-new-project-path="/projects/new?namespace_id=9970" data-wi-register-path="/users/sign_up?redirect_to_referer=yes" data-wi-report-abuse-path="/-/abuse_reports/add_category" data-wi-show-new-issue-link="false" data-wi-sign-in-path="/users/sign_in?redirect_to_referer=yes"></div>

<div data-has-closing-merge-request="false" data-iid="358160" data-project-path="gitlab-org/gitlab" id="js-related-merge-requests"></div>
<div data-url="/gitlab-org/gitlab/-/issues/358160/related_branches" id="related-branches">
</div>
</div>
<div class="js-issue-widgets">
<section class="issuable-discussion js-vue-notes-event">
<div data-can-add-timeline-events="false" data-current-user-data="null" data-new-comment-template-paths="[{&quot;text&quot;:&quot;Your comment templates&quot;,&quot;href&quot;:&quot;/-/profile/comment_templates&quot;}]" data-noteable-data="{&quot;id&quot;:106261016,&quot;iid&quot;:358160,&quot;description&quot;:&quot;**[HackerOne report #1531958](https://hackerone.com/reports/1531958)** by `afewgoats` on 2022-04-06, assigned to `GitLab Team`:\n\n[Report](#report) | [Attachments](#attachments) | [How To Reproduce](#how-to-reproduce)\n\n## Report\n\n#####  Summary\n\nA Gitlab webhook may be pointed at a malicious webhook receiver.  \nThe webhook receiver can respond with a specially crafted long header.  \nGitlab processes the header with Ruby&#39;s net/http where there is a regular expression operation with quadratic complexity (ReDoS).  \nThis causes the `web_hook` Sidekiq job to get stuck at 100% CPU utilisation until the regular expression processing is complete (weeks later).  \nThe long headers are also kept in memory and the connection can be kept open.\n\n######  Comparison to 1252116\n\nIn report #1252116, the impact was that the network connection was kept open indefinitely, potentially causing connection pool and memory exhaustion. This new report is instead about CPU exhaustion for a more serious and more powerful DoS. It also bypasses the timeout added to fix #1252116 (https://gitlab.com/gitlab-org/gitlab/-/commit/a8807ee52d0b22b68beb31f0cad6ad5b77b4caf6) (deployed in 14.9.2) as the timeout only gets hit once the regular expression has finished processing (timeout is checked between header lines).\n\n######  The root cause\n\nA Regular Expression Denial of Service (ReDoS) vulnerability in Ruby&#39;s net/http affects Gitlab webhooks.\n\nThe bug is in [net/http/response.rb#57](https://github.com/ruby/net-http/blob/7b852b1feb7c1c0bc3019687d6ee5c385ce26eb9/lib/net/http/response.rb#L57) when reading headers line by line:\n\n```rb  \nline = sock.readuntil(\&quot;\\n\&quot;, true).sub(/\\s+\\z/, &#39;&#39;)  \n```\n\nThe `sub` regex is the issue. While it looks safe and linear, the `sub` operation will actually have quadratic complexity as there is no starting anchor.\n\nA header line which contains many consecutive spaces but *does not end in a space*, such as\n\n```rb  \n( \&quot;a\&quot; + \&quot; \&quot; * 950000 + \&quot;b\&quot; ).sub(/\\s+\\z/, &#39;&#39;)  \n```\n\nwill exhibit extreme backtracking.\n\nThe time complexity is quadratic with respect to the number of spaces in the string (doubling the number of spaces quadruples the processing time). Approximate timings from my laptop (I measured until 10,000 and then extrapolated):\n\n```  \n|  Spaces  |  Seconds   |  Hours   |  Days  |  \n|----------|------------|----------|--------|  \n|     2000 |        1.8 |          |        |  \n|     4000 |        7.2 |          |        |  \n|     8000 |       28.6 |          |        |  \n|    10000 |       44.7 |          |        |  \n|   100000 |     4473.0 |     1.24 |   0.05 |  \n|  1000000 |   447300.0 |   124.25 |   5.18 |  \n| 10000000 | 44730000.0 | 12425.00 | 517.71 |  \n```\n\n#####  Steps to reproduce\n\n1. Run the attached malicious node server on port 3000: `node ./net-http-response.js`  \n2. Create a project and add webhooks for issue events to http://maliciousserver:3000/xyz.  \n3. (If you hosted the malicious server on your local network, you will need to \&quot;Allow requests to the local network from web hooks and services\&quot; in /admin/application_settings/network.)  \n4. Create an issue (or close or reopen one) to trigger the webhook. Gitlab will make a webhook request.  \n5. The malicious server will respond with `HTTP/1.1 200 OK` and then a header line with 9,500,000 consecutive spaces in the middle.  \n6. The `web_hook` Sidekiq job will be stuck processing at 100% CPU and will not complete for **over a year**. This can be seen in the Background Jobs panel (/admin/background_jobs) and `top`:\n\n![gitlab-high-cpu-header-regex-dos.png](https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png)\n\n![gitlab-header-regex-dos-sidekiq-background_jobs.png](https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png)\n\nThe ReDoS triggers on web requests made to Gitlab which trigger an external request e.g. validating the URL before repository import. However, in these cases a `RequestTimeoutException` triggers after 60 seconds of 100% CPU.\n\nThe regex runs without a timeout on project webhooks. It&#39;s not just project webhooks though. Any use of `Gitlab::HTTP.post` such as system webhooks and integrations (e.g. Mattermost) are affected.\n\nTo demonstrate the net/http bug:\n\n```rb  \nrequire &#39;net/http&#39;  \nuri = URI(&#39;http://maliciousserver:3000/x&#39;)  \nNet::HTTP.get(uri)  \n```\n\n#####  What is the current *bug* behavior?\n\nGitlab webhooks and system hooks get stuck for years in a CPU intensive regular expression operation when receiving a malicious header from an external service.\n\n#####  What is the expected *correct* behavior?\n\nProcessing a webhook response should never take longer than a year. More strictly, it should obey the webhook read timeout and also not run at 100% CPU.\n\nRuby should simply use `sock.readuntil(\&quot;\\n\&quot;, true).rstrip` instead of a regex as I think it does the same thing. I can make a PR / issue for ruby unless you want to do it yourselves - let me know if and how you want me to proceed.\n\nPotentially drop responses with very long header lines.\n\n#####  Relevant logs and/or screenshots\n\nnet/http is called by httparty which is called by  \n```  \n\&quot;lib/gitlab/http.rb:57:in `perform_request&#39;\&quot;,\&quot;app/services/web_hook_service.rb:125:in `make_request&#39;\&quot;  \n```\n\n#####  Output of checks\n\nThe bug happens locally. I did not test this on Gitlab.com because I&#39;m sure it will affect it.\n\n######  Results of GitLab environment info\n\n(For installations with omnibus-gitlab package run and paste the output of:  \n`sudo gitlab-rake gitlab:env:info`)\n\nRunning in docker\n\n```  \nSystem information  \nSystem:  \nProxy:          no  \nCurrent User:   git  \nUsing RVM:      no  \nRuby Version:   2.7.5p203  \nGem Version:    3.1.4  \nBundler Version:2.2.33  \nRake Version:   13.0.6  \nRedis Version:  6.2.6  \nSidekiq Version:6.4.0  \nGo Version:     unknown\n\nGitLab information  \nVersion:        14.9.2-ee  \nRevision:       3034418fb31  \nDirectory:      /opt/gitlab/embedded/service/gitlab-rails  \nDB Adapter:     PostgreSQL  \nDB Version:     12.7  \nURL:            https://gitlab.example.com  \nHTTP Clone URL: https://gitlab.example.com/some-group/some-project.git  \nSSH Clone URL:  git@gitlab.example.com:some-group/some-project.git  \nElasticsearch:  no  \nGeo:            no  \nUsing LDAP:     no  \nUsing Omniauth: yes  \nOmniauth Providers: \n\nGitLab Shell  \nVersion:        13.24.0  \nRepository storage paths:  \n- default:      /var/opt/gitlab/git-data/repositories  \nGitLab Shell path:              /opt/gitlab/embedded/service/gitlab-shell  \n```\n\n####  Impact\n\nCPU exhaustion DoS.  \nMemory exhaustion DoS.  \nCPU intensive Sidekiq job runs forever (ok, not forever, but over a year) wasting energy and slowing down the system.  \nAlso possible to get connection pool exhaustion by sending data slowly and keeping the socket open until the regex completes (bypassing fix for #1252116) for multiple webhook connections.\n\n## Attachments\n\n**Warning:** Attachments received through HackerOne, please exercise caution!\n\n* [gitlab-high-cpu-header-regex-dos.png](https://h1.sec.gitlab.net/a/a803f0d6-0dbb-4454-b7be-ab901b463fc6/gitlab-high-cpu-header-regex-dos.png)\n* [gitlab-header-regex-dos-sidekiq-background_jobs.png](https://h1.sec.gitlab.net/a/c5d05bc9-f813-4c27-b4b5-9407821ef281/gitlab-header-regex-dos-sidekiq-background_jobs.png)\n* [net-http-response.js](https://h1.sec.gitlab.net/a/f0253922-20e1-4080-91f9-2ba71f81ae68/net-http-response.js)\n\n## How To Reproduce\n\nPlease add [reproducibility information] to this section:\n\n1.\n1.\n1.\n\n[reproducibility information]: https://about.gitlab.com/handbook/engineering/security/#reproducibility-on-security-issues&quot;,&quot;title&quot;:&quot;ReDoS in net/http affects webhooks: Sidekiq job stuck at 100% CPU for a year&quot;,&quot;time_estimate&quot;:0,&quot;total_time_spent&quot;:0,&quot;human_time_estimate&quot;:null,&quot;human_total_time_spent&quot;:null,&quot;state&quot;:&quot;closed&quot;,&quot;milestone_id&quot;:2453024,&quot;updated_by_id&quot;:1786152,&quot;created_at&quot;:&quot;2022-04-07T14:42:58Z&quot;,&quot;updated_at&quot;:&quot;2023-04-26T00:39:19Z&quot;,&quot;milestone&quot;:{&quot;id&quot;:2453024,&quot;iid&quot;:74,&quot;group_id&quot;:9970,&quot;title&quot;:&quot;15.2&quot;,&quot;description&quot;:&quot;&quot;,&quot;state&quot;:&quot;closed&quot;,&quot;created_at&quot;:&quot;2022-02-03T22:24:46.818Z&quot;,&quot;updated_at&quot;:&quot;2024-01-11T08:43:44.361Z&quot;,&quot;due_date&quot;:&quot;2022-07-17&quot;,&quot;start_date&quot;:&quot;2022-06-18&quot;,&quot;expired&quot;:true,&quot;web_url&quot;:&quot;https://gitlab.com/groups/gitlab-org/-/milestones/74&quot;},&quot;labels&quot;:[{&quot;id&quot;:992791,&quot;title&quot;:&quot;Deliverable&quot;,&quot;color&quot;:&quot;#428BCA&quot;,&quot;description&quot;:&quot;Issues scheduled for the current milestone.&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2016-11-18T17:02:50.145Z&quot;,&quot;updated_at&quot;:&quot;2019-04-17T18:49:16.998Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3417347,&quot;title&quot;:&quot;HackerOne&quot;,&quot;color&quot;:&quot;#0033CC&quot;,&quot;description&quot;:&quot;&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-01-31T13:53:42.609Z&quot;,&quot;updated_at&quot;:&quot;2019-01-09T12:13:21.325Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:10413872,&quot;title&quot;:&quot;SLO::Missed&quot;,&quot;color&quot;:&quot;#CC0000&quot;,&quot;description&quot;:&quot;Label to signify that a bug issue has missed its targeted SLO (Service Level Objective). See https://docs.gitlab.com/ee/development/contributing/issue_workflow.html#priority-labels. Previously titled as missed-SLO&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2019-04-28T18:18:21.631Z&quot;,&quot;updated_at&quot;:&quot;2023-02-16T18:38:39.684Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:17006635,&quot;title&quot;:&quot;Weakness::CWE-400&quot;,&quot;color&quot;:&quot;#7F8C8D&quot;,&quot;description&quot;:&quot;Denial of Service&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2020-11-09T22:14:41.441Z&quot;,&quot;updated_at&quot;:&quot;2020-11-09T22:14:41.441Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:1890178,&quot;title&quot;:&quot;[deprecated] Accepting merge requests&quot;,&quot;color&quot;:&quot;#69d100&quot;,&quot;description&quot;:&quot;[deprecated] Please use \&quot;Seeking community contributions\&quot; instead. https://gitlab.com/gitlab-org/developer-relations/contributor-success/team-task/-/issues/77&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2017-04-21T11:34:01.286Z&quot;,&quot;updated_at&quot;:&quot;2023-06-28T08:14:53.591Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2492649,&quot;title&quot;:&quot;backend&quot;,&quot;color&quot;:&quot;#D10069&quot;,&quot;description&quot;:&quot;Issues that require backend work&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-08-15T14:49:42.004Z&quot;,&quot;updated_at&quot;:&quot;2018-06-11T10:34:33.030Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:4107753,&quot;title&quot;:&quot;bug::vulnerability&quot;,&quot;color&quot;:&quot;#CC0000&quot;,&quot;description&quot;:&quot;A security vulnerability&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-22T15:15:09.960Z&quot;,&quot;updated_at&quot;:&quot;2022-03-16T11:32:16.336Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:4116705,&quot;title&quot;:&quot;devops::foundations&quot;,&quot;color&quot;:&quot;#e44d2a&quot;,&quot;description&quot;:&quot;Issues for the Foundations stage of the DevOps lifecycle (e.g. Import \u0026 Integrate, Personal Productivity, etc)&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-23T15:35:30.635Z&quot;,&quot;updated_at&quot;:&quot;2024-08-13T17:20:38.144Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:30057931,&quot;title&quot;:&quot;group::import and integrate&quot;,&quot;color&quot;:&quot;#a8d695&quot;,&quot;description&quot;:&quot;Issues, MRs and Epics belong to group::import and integrate https://handbook.gitlab.com/handbook/engineering/development/dev/manage/import-and-integrate/\nresulted from merging group::integrations and group::import | PM: @m_frankiewicz&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2023-04-25T21:26:50.744Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T07:52:00.403Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3857523,&quot;title&quot;:&quot;priority::2&quot;,&quot;color&quot;:&quot;#ff8800&quot;,&quot;description&quot;:&quot;We will address this soon and will provide capacity from our team for it in the next few releases. See https://handbook.gitlab.com/handbook/engineering/infrastructure/engineering-productivity/issue-triage/#priority&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2018-04-13T08:01:55.497Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T13:23:35.254Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:14918378,&quot;title&quot;:&quot;section::dev&quot;,&quot;color&quot;:&quot;#F0AD4E&quot;,&quot;description&quot;:&quot;Issues related to the Dev section&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2020-05-11T22:11:57.167Z&quot;,&quot;updated_at&quot;:&quot;2020-05-11T22:11:57.167Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2779335,&quot;title&quot;:&quot;security&quot;,&quot;color&quot;:&quot;#d9534f&quot;,&quot;description&quot;:&quot;Issues related to the security of GitLab or its dependencies. Please report vulnerabilities responsibly per https://about.gitlab.com/security/disclosure/&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-10-05T14:36:39.341Z&quot;,&quot;updated_at&quot;:&quot;2023-05-24T20:20:05.269Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3713902,&quot;title&quot;:&quot;severity::2&quot;,&quot;color&quot;:&quot;#ff8800&quot;,&quot;description&quot;:&quot;Critical - applies to bugs and bug categories of availability, performance, security and ux. See https://handbook.gitlab.com/handbook/engineering/infrastructure/engineering-productivity/issue-triage/#severity&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2018-03-23T14:46:34.880Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T13:12:15.351Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2278648,&quot;title&quot;:&quot;type::bug&quot;,&quot;color&quot;:&quot;#cc0000&quot;,&quot;description&quot;:&quot;Issues that report undesirable or incorrect behavior. See https://handbook.gitlab.com/handbook/product/groups/product-analysis/engineering/metrics/#work-type-classification&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-07-07T20:20:34.868Z&quot;,&quot;updated_at&quot;:&quot;2024-11-08T09:52:16.699Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:22408318,&quot;title&quot;:&quot;workflow::awaiting security release&quot;,&quot;color&quot;:&quot;#6699cc&quot;,&quot;description&quot;:&quot;This is a security issue that is ready to be deployed but awaiting a security release&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2021-11-02T16:15:28.794Z&quot;,&quot;updated_at&quot;:&quot;2021-11-02T16:15:28.794Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false}],&quot;lock_version&quot;:0,&quot;author_id&quot;:2741139,&quot;confidential&quot;:false,&quot;discussion_locked&quot;:null,&quot;assignees&quot;:[{&quot;id&quot;:2702368,&quot;username&quot;:&quot;.luke&quot;,&quot;name&quot;:&quot;Luke Duncalfe&quot;,&quot;state&quot;:&quot;active&quot;,&quot;locked&quot;:false,&quot;avatar_url&quot;:&quot;https://gitlab.com/uploads/-/system/user/avatar/2702368/avatar.png&quot;,&quot;web_url&quot;:&quot;https://gitlab.com/.luke&quot;}],&quot;due_date&quot;:&quot;2022-05-26&quot;,&quot;project_id&quot;:278964,&quot;moved_to_id&quot;:null,&quot;duplicated_to_id&quot;:null,&quot;web_url&quot;:&quot;/gitlab-org/gitlab/-/issues/358160&quot;,&quot;current_user&quot;:{&quot;can_create_note&quot;:false,&quot;can_create_confidential_note&quot;:false,&quot;can_update&quot;:false,&quot;can_set_issue_metadata&quot;:false,&quot;can_award_emoji&quot;:false},&quot;create_note_path&quot;:&quot;/gitlab-org/gitlab/notes?target_id=106261016\u0026target_type=issue&quot;,&quot;preview_note_path&quot;:&quot;/gitlab-org/gitlab/-/preview_markdown?target_id=358160\u0026target_type=Issue&quot;,&quot;is_project_archived&quot;:false,&quot;issue_email_participants&quot;:[],&quot;type&quot;:&quot;ISSUE&quot;,&quot;weight&quot;:0,&quot;blocked&quot;:false,&quot;blocked_by_issues&quot;:[]}" data-noteable-type="Issue" data-notes-data="{&quot;noteableType&quot;:&quot;issue&quot;,&quot;noteableId&quot;:106261016,&quot;projectId&quot;:278964,&quot;groupId&quot;:null,&quot;discussionsPath&quot;:&quot;/gitlab-org/gitlab/-/issues/358160/discussions.json&quot;,&quot;registerPath&quot;:&quot;/users/sign_up?redirect_to_referer=yes&quot;,&quot;newSessionPath&quot;:&quot;/users/sign_in?redirect_to_referer=yes&quot;,&quot;markdownDocsPath&quot;:&quot;/help/user/markdown.md&quot;,&quot;quickActionsDocsPath&quot;:&quot;/help/user/project/quick_actions.md&quot;,&quot;closePath&quot;:&quot;/gitlab-org/gitlab/-/issues/358160.json?issue%5Bstate_event%5D=close&quot;,&quot;reopenPath&quot;:&quot;/gitlab-org/gitlab/-/issues/358160.json?issue%5Bstate_event%5D=reopen&quot;,&quot;notesPath&quot;:&quot;/gitlab-org/gitlab/noteable/issue/106261016/notes&quot;,&quot;prerenderedNotesCount&quot;:10,&quot;lastFetchedAt&quot;:1736090037000000,&quot;notesFilter&quot;:null}" data-notes-filters="{&quot;Show all activity&quot;:0,&quot;Show comments only&quot;:1,&quot;Show history only&quot;:2}" data-report-abuse-path="/-/abuse_reports/add_category" data-show-timeline-view-toggle="false" data-target-type="issue" id="js-vue-notes"></div>
</section>

</div>
</div>
<aside aria-label="issue" aria-live="polite" class="right-sidebar js-right-sidebar js-issuable-sidebar right-sidebar-expanded" data-always-show-toggle data-auto-collapse data-issuable-type="issue">
<div class="issuable-sidebar">
<div class="issuable-sidebar-header">
<button class="gl-button btn btn-md btn-default gutter-toggle gl-float-right js-sidebar-toggle has-tooltip !gl-border-0" type="button" aria-label="Toggle sidebar" title="Collapse sidebar" data-container="body" data-placement="left" data-boundary="viewport" type="button"><span class="gl-button-text">
<span class="js-sidebar-toggle-container gl-button-text" data-is-expanded="true"><svg class="s16 js-sidebar-expand hidden" data-testid="chevron-double-lg-left-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-left"></use></svg><svg class="s16 js-sidebar-collapse " data-testid="chevron-double-lg-right-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#chevron-double-lg-right"></use></svg></span>

</span>

</button></div>
<form class="issuable-context-form inline-update js-issuable-update " action="/gitlab-org/gitlab/-/issues/358160.json" accept-charset="UTF-8" data-remote="true" method="post"><div class="block assignee gl-mt-3" data-testid="assignee-block-container">
<div class="js-sidebar-assignees-root" data-field="issue" data-max-assignees="200">
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Assignee</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>

</div>
<div class="block epic" data-testid="sidebar-epic">
<div class="js-sidebar-epic-widget-root" data-can-edit="false" data-group-path="gitlab-org" data-issue-id="106261016" data-issue-iid="358160" data-project-path="gitlab-org/gitlab"></div>
</div>

<div class="js-sidebar-labels-widget-root" data-allow-label-create="" data-allow-scoped-labels="true" data-can-edit="" data-iid="358160" data-issuable-type="issue" data-labels-fetch-path="/gitlab-org/gitlab/-/labels.json?include_ancestor_groups=true" data-labels-manage-path="/gitlab-org/gitlab/-/labels" data-project-issues-path="/gitlab-org/gitlab/-/issues" data-project-path="gitlab-org/gitlab" data-selected-labels="[{&quot;id&quot;:992791,&quot;title&quot;:&quot;Deliverable&quot;,&quot;color&quot;:&quot;#428BCA&quot;,&quot;description&quot;:&quot;Issues scheduled for the current milestone.&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2016-11-18T17:02:50.145Z&quot;,&quot;updated_at&quot;:&quot;2019-04-17T18:49:16.998Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3417347,&quot;title&quot;:&quot;HackerOne&quot;,&quot;color&quot;:&quot;#0033CC&quot;,&quot;description&quot;:&quot;&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-01-31T13:53:42.609Z&quot;,&quot;updated_at&quot;:&quot;2019-01-09T12:13:21.325Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:10413872,&quot;title&quot;:&quot;SLO::Missed&quot;,&quot;color&quot;:&quot;#CC0000&quot;,&quot;description&quot;:&quot;Label to signify that a bug issue has missed its targeted SLO (Service Level Objective). See https://docs.gitlab.com/ee/development/contributing/issue_workflow.html#priority-labels. Previously titled as missed-SLO&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2019-04-28T18:18:21.631Z&quot;,&quot;updated_at&quot;:&quot;2023-02-16T18:38:39.684Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:17006635,&quot;title&quot;:&quot;Weakness::CWE-400&quot;,&quot;color&quot;:&quot;#7F8C8D&quot;,&quot;description&quot;:&quot;Denial of Service&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2020-11-09T22:14:41.441Z&quot;,&quot;updated_at&quot;:&quot;2020-11-09T22:14:41.441Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:1890178,&quot;title&quot;:&quot;[deprecated] Accepting merge requests&quot;,&quot;color&quot;:&quot;#69d100&quot;,&quot;description&quot;:&quot;[deprecated] Please use \&quot;Seeking community contributions\&quot; instead. https://gitlab.com/gitlab-org/developer-relations/contributor-success/team-task/-/issues/77&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2017-04-21T11:34:01.286Z&quot;,&quot;updated_at&quot;:&quot;2023-06-28T08:14:53.591Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2492649,&quot;title&quot;:&quot;backend&quot;,&quot;color&quot;:&quot;#D10069&quot;,&quot;description&quot;:&quot;Issues that require backend work&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-08-15T14:49:42.004Z&quot;,&quot;updated_at&quot;:&quot;2018-06-11T10:34:33.030Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:4107753,&quot;title&quot;:&quot;bug::vulnerability&quot;,&quot;color&quot;:&quot;#CC0000&quot;,&quot;description&quot;:&quot;A security vulnerability&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-22T15:15:09.960Z&quot;,&quot;updated_at&quot;:&quot;2022-03-16T11:32:16.336Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:4116705,&quot;title&quot;:&quot;devops::foundations&quot;,&quot;color&quot;:&quot;#e44d2a&quot;,&quot;description&quot;:&quot;Issues for the Foundations stage of the DevOps lifecycle (e.g. Import \u0026 Integrate, Personal Productivity, etc)&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2018-05-23T15:35:30.635Z&quot;,&quot;updated_at&quot;:&quot;2024-08-13T17:20:38.144Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:30057931,&quot;title&quot;:&quot;group::import and integrate&quot;,&quot;color&quot;:&quot;#a8d695&quot;,&quot;description&quot;:&quot;Issues, MRs and Epics belong to group::import and integrate https://handbook.gitlab.com/handbook/engineering/development/dev/manage/import-and-integrate/\nresulted from merging group::integrations and group::import | PM: @m_frankiewicz&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2023-04-25T21:26:50.744Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T07:52:00.403Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3857523,&quot;title&quot;:&quot;priority::2&quot;,&quot;color&quot;:&quot;#ff8800&quot;,&quot;description&quot;:&quot;We will address this soon and will provide capacity from our team for it in the next few releases. See https://handbook.gitlab.com/handbook/engineering/infrastructure/engineering-productivity/issue-triage/#priority&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2018-04-13T08:01:55.497Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T13:23:35.254Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:14918378,&quot;title&quot;:&quot;section::dev&quot;,&quot;color&quot;:&quot;#F0AD4E&quot;,&quot;description&quot;:&quot;Issues related to the Dev section&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2020-05-11T22:11:57.167Z&quot;,&quot;updated_at&quot;:&quot;2020-05-11T22:11:57.167Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2779335,&quot;title&quot;:&quot;security&quot;,&quot;color&quot;:&quot;#d9534f&quot;,&quot;description&quot;:&quot;Issues related to the security of GitLab or its dependencies. Please report vulnerabilities responsibly per https://about.gitlab.com/security/disclosure/&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-10-05T14:36:39.341Z&quot;,&quot;updated_at&quot;:&quot;2023-05-24T20:20:05.269Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:3713902,&quot;title&quot;:&quot;severity::2&quot;,&quot;color&quot;:&quot;#ff8800&quot;,&quot;description&quot;:&quot;Critical - applies to bugs and bug categories of availability, performance, security and ux. See https://handbook.gitlab.com/handbook/engineering/infrastructure/engineering-productivity/issue-triage/#severity&quot;,&quot;text_color&quot;:&quot;#1F1E24&quot;,&quot;created_at&quot;:&quot;2018-03-23T14:46:34.880Z&quot;,&quot;updated_at&quot;:&quot;2024-04-01T13:12:15.351Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:2278648,&quot;title&quot;:&quot;type::bug&quot;,&quot;color&quot;:&quot;#cc0000&quot;,&quot;description&quot;:&quot;Issues that report undesirable or incorrect behavior. See https://handbook.gitlab.com/handbook/product/groups/product-analysis/engineering/metrics/#work-type-classification&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2017-07-07T20:20:34.868Z&quot;,&quot;updated_at&quot;:&quot;2024-11-08T09:52:16.699Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false},{&quot;id&quot;:22408318,&quot;title&quot;:&quot;workflow::awaiting security release&quot;,&quot;color&quot;:&quot;#6699cc&quot;,&quot;description&quot;:&quot;This is a security issue that is ready to be deployed but awaiting a security release&quot;,&quot;text_color&quot;:&quot;#FFFFFF&quot;,&quot;created_at&quot;:&quot;2021-11-02T16:15:28.794Z&quot;,&quot;updated_at&quot;:&quot;2021-11-02T16:15:28.794Z&quot;,&quot;group_id&quot;:9970,&quot;project_id&quot;:null,&quot;template&quot;:false}]"></div>
<div class="block milestone" data-testid="sidebar-milestones">
<div class="js-sidebar-milestone-widget-root" data-can-edit="" data-issue-iid="358160" data-project-path="gitlab-org/gitlab"></div>
</div>
<div class="block" data-testid="iteration-container"><div class="js-sidebar-iteration-widget-root" data-can-edit="" data-group-path="gitlab-org" data-issue-id="106261016" data-issue-iid="358160" data-project-path="gitlab-org/gitlab"></div>
</div>
<div class="js-sidebar-weight-widget-root" data-can-edit="" data-issue-iid="358160" data-project-path="gitlab-org/gitlab"></div>

<div class="js-sidebar-due-date-widget-root"></div>
<div class="js-sidebar-time-tracking-root block">
<!-- / Fallback while content is loading -->
<div class="title hide-collapsed gl-flex gl-justify-between gl-items-center !gl-mb-0">
<span class="gl-font-bold">Time tracking</span>
<span class="gl-spinner-container" role="status"><span aria-hidden class="gl-spinner gl-spinner-sm gl-spinner-dark !gl-align-text-bottom"></span><span class="gl-sr-only !gl-absolute">Loading</span>
</span>
</div>
</div>
<div class="js-sidebar-health-status-widget-root" data-can-edit="" data-full-path="gitlab-org/gitlab" data-iid="358160" data-issuable-type="issue"></div>
<script id="js-confidential-issue-data" type="application/json">{"is_confidential":false,"is_editable":null}</script>
<div class="block">
<div class="hide-collapsed gl-flex gl-items-center gl-font-bold gl-leading-20 gl-text-default">
Confidentiality
</div>
<div class="hide-collapsed gl-text-subtle">
Confidentiality controls have moved to the issue actions menu (<svg class="s12 gl-align-middle" data-testid="ellipsis_v-icon"><use href="/assets/icons-8791a66659d025e0a4c801978c79a1fbd82db1d27d85f044a35728ea7cf0ae80.svg#ellipsis_v"></use></svg>) at the top of the page.
</div>
</div>

<div class="js-sidebar-participants-widget-root"></div>
</form><script class="js-sidebar-options" type="application/json">{"endpoint":"/gitlab-org/gitlab/-/issues/358160.json?serializer=sidebar_extras","toggleSubscriptionEndpoint":"/gitlab-org/gitlab/-/issues/358160/toggle_subscription","moveIssueEndpoint":"/gitlab-org/gitlab/-/issues/358160/move","projectsAutocompleteEndpoint":"/-/autocomplete/projects?project_id=278964","editable":"","currentUser":{},"rootPath":"/","fullPath":"gitlab-org/gitlab","iid":358160,"id":106261016,"severity":"unknown","timeTrackingLimitToHours":true,"canCreateTimelogs":null,"createNoteEmail":null,"issuableType":"issue","directlyInviteMembers":"false","weightOptions":["None","Any",0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,16,17,18,19,20],"weightNoneValue":"None","multipleApprovalRulesAvailable":null}</script>
</div>
</aside>



</main>
</div>


</div>
</div>


<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
if ('loading' in HTMLImageElement.prototype) {
  document.querySelectorAll('img.lazy').forEach(img => {
    img.loading = 'lazy';
    let imgUrl = img.dataset.src;
    // Only adding width + height for avatars for now
    if (imgUrl.indexOf('/avatar/') > -1 && imgUrl.indexOf('?') === -1) {
      const targetWidth = img.getAttribute('width') || img.width;
      imgUrl += `?width=${targetWidth}`;
    }
    img.src = imgUrl;
    img.removeAttribute('data-src');
    img.classList.remove('lazy');
    img.classList.add('js-lazy-loaded');
    img.dataset.testid = 'js-lazy-loaded-content';
  });
}

//]]>
</script>
<script nonce="xwzcWaQUcTr8nsGERh75fg==">
//<![CDATA[
gl = window.gl || {};
gl.experiments = {};


//]]>
</script>

</body>
</html>

