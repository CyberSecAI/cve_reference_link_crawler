<!-- MHonArc v2.6.19+ -->
<!--X-Subject: [PATCH] pvrdma: Ensure correct input on ring init (CVE&#45;2021&#45;3607) -->
<!--X-From-R13: [nepry Ocsryonhz &#60;znepry.ncsryonhzNtznvy.pbz> -->
<!--X-Date: Wed, 30 Jun 2021 07:46:46 &#45;0400 -->
<!--X-Message-Id: 20210630114634.2168872&#45;1&#45;marcel@redhat.com -->
<!--X-Content-Type: text/plain -->
<!--X-Head-End-->
<!doctype html public "-//W3C//DTD HTML//EN">
<html>
<head>
<title>[PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</title>
<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
</head>
<body>
<center>
<table border=0 cellspacing=2 cellpadding=0 bgcolor="#000000">
<tr><td><table border=0 bgcolor="#FFFFCC">
<tr><td><big><b>qemu-devel</b></big></td></tr></table></tr></table>
<div class="nowrap">
<small>[<a href="../"
>Top</a>][<a href="/archive/html">All Lists</a>]</small>
</div>
<form method="get" action="/archive/cgi-bin/namazu.cgi">
<input type="text" name="query" size="30">
<input type="submit" name="submit" value="Search">
<input type="hidden" name="idxname" value="qemu-devel">
<a href="/archive/cgi-bin/namazu.cgi?idxname=qemu-devel">Advanced</a>
</form>

</center>
<!--X-Body-Begin-->
<!--X-User-Header-->
<!--X-User-Header-End-->
<!--X-TopPNI-->
<hr>
[<a href="msg07924.html">Date Prev</a>][<a href="msg07926.html">Date Next</a>][<a href="msg07921.html">Thread Prev</a>][<a href="msg07942.html">Thread Next</a>][<a
href="index.html#07925">Date Index</a>][<a
href="threads.html#07925">Thread Index</a>]

<!--X-TopPNI-End-->
<!--X-MsgBody-->
<!--X-Subject-Header-Begin-->
<h2>[PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</h2>
<hr>
<table border=0>
<tbody>
<tr>
<td align="right" valign="top">
<b>From</b>: </td>
<td align="left">
Marcel Apfelbaum</td>
</tr>
<!--X-Subject-Header-End-->
<!--X-Head-of-Message-->

<tr>
<td align="right" valign="top">
<b>Subject</b>: </td>
<td align="left">
[PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</td>
</tr>

<tr>
<td align="right" valign="top">
<b>Date</b>: </td>
<td align="left">
Wed, 30 Jun 2021 14:46:34 +0300</td>
</tr>

</tbody>
</table>
<!--X-Head-of-Message-End-->
<!--X-Head-Body-Sep-Begin-->
<hr>
<!--X-Head-Body-Sep-End-->
<!--X-Body-of-Message-->
<pre>Check the guest passed a non zero page count
for pvrdma device ring buffers.

Fixes: CVE-2021-3607
Reported-by: VictorV (Kunlun Lab) &lt;vv474172261@gmail.com&gt;
Reviewed-by: VictorV (Kunlun Lab) &lt;vv474172261@gmail.com&gt;
Signed-off-by: Marcel Apfelbaum &lt;marcel@redhat.com&gt;
---
 hw/rdma/vmw/pvrdma_main.c | 5 +++++
 1 file changed, 5 insertions(+)

diff --git a/hw/rdma/vmw/pvrdma_main.c b/hw/rdma/vmw/pvrdma_main.c
index 84ae8024fc..7c0c3551a8 100644
--- a/hw/rdma/vmw/pvrdma_main.c
+++ b/hw/rdma/vmw/pvrdma_main.c
@@ -92,6 +92,11 @@ static int init_dev_ring(PvrdmaRing *ring, PvrdmaRingState 
**ring_state,
     uint64_t *dir, *tbl;
     int rc = 0;
 
+    if (!num_pages) {
+        rdma_error_report(&quot;Ring pages count must be strictly positive&quot;);
+        return -EINVAL;
+    }
+
     dir = rdma_pci_dma_map(pci_dev, dir_addr, TARGET_PAGE_SIZE);
     if (!dir) {
         rdma_error_report(&quot;Failed to map to page directory (ring %s)&quot;, name);
-- 
2.31.1



</pre>
<!--X-Body-of-Message-End-->
<!--X-MsgBody-End-->
<!--X-Follow-Ups-->
<hr>
<form method="post" action="/mp/yyz.py" enctype="multipart/form-data">
<input type="hidden" name="a" value="marcel.apfelbaum">
<input type="hidden" name="b" value="[PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)">
<input type="hidden" name="d" value="20210630114634.2168872-1-marcel@redhat.com">
<input type="hidden" name="c" value="gmail.com">
<center>reply via email to<br><input type="submit" value=" Marcel Apfelbaum "></center>
</form>
<hr>
<table width="100%">
<tr><td align="left">[Prev in Thread]</td>
<td align="center"><b>Current Thread</b></td>
<td align="right">[<a href="msg07942.html">Next in Thread</a>]</td></tr></table>
<ul>
<li><font color="#666666"><strong>[PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</strong>,
<em>Marcel Apfelbaum</em></font>&nbsp;<b>&lt;=</b>
<ul>
<li><b><a name="07942" href="msg07942.html">Re: [PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</a></b>, <i>Yuval Shaia</i>, <tt>2021/06/30</tt>
</li>
</ul>
</li>
</ul>

<hr>
<!--X-Follow-Ups-End-->
<!--X-References-->
<!--X-References-End-->
<!--X-BotPNI-->
<ul>
<li>Prev by Date:
<strong><a href="msg07924.html">Re: [PATCH v7 2/4] Jobs based on custom runners: build environment docs and playbook</a></strong>
</li>
<li>Next by Date:
<strong><a href="msg07926.html">[PATCH] pvrdma: Fix the ring init error flow (CVE-2021-3608)</a></strong>
</li>
<li>Previous by thread:
<strong><a href="msg07921.html">[PATCH v3] target/s390x: Fix CC set by CONVERT TO FIXED/LOGICAL</a></strong>
</li>
<li>Next by thread:
<strong><a href="msg07942.html">Re: [PATCH] pvrdma: Ensure correct input on ring init (CVE-2021-3607)</a></strong>
</li>
<li>Index(es):
<ul>
<li><a href="index.html#07925"><strong>Date</strong></a></li>
<li><a href="threads.html#07925"><strong>Thread</strong></a></li>
</ul>
</li>
</ul>

<!--X-BotPNI-End-->
<!--X-User-Footer-->
<!--X-User-Footer-End-->
</body>
</html>
