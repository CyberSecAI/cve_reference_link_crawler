```
{
  "guidelines": "1. First verify if the content relates to the CVE specified based on the official description\n2. If the content does not relate to this CVE, respond with \"UNRELATED\"\n3. If no useful vulnerability information is found, respond with \"NOINFO\" \n4. For relevant content, extract:\n   - Root cause of vulnerability\n   - Weaknesses/vulnerabilities present\n   - Impact of exploitation\n   - Attack vectors\n   - Required attacker capabilities/position\n\nAdditional instructions:\n- Preserve original technical details and descriptions\n- Remove unrelated content\n- Translate non-English content to English\n- Note if the content provides more detail than the official CVE description",
  "response": {
    "CVE-2024-0874": {
      "matches": [
        {
          "type": "pull_request",
          "content": "This update keys the cache on CD bit, which effectively separates the entries for queries with CD disabled or enabled.\n\n### 1. Why is this pull request needed and what does it do?\n\nThe cache plugin currently does not have separate entries for CD disabled/enabled. When a user initially queries WITH the CD bit set, the cache stores the a potentially invalid cache entry. Then if a user queries without CD bit set, CoreDNS will return the invalid cache entry (as if the CD bit was set) which violates [rfc4035#section-4.7](https://datatracker.ietf.org/doc/html/rfc4035#section-4.7):\n\n> Resolvers MUST NOT return RRsets from the BAD cache unless the resolver is not required to validate the signatures of the RRsets in question under the rules given in [Section 4.2](https://datatracker.ietf.org/doc/html/rfc4035#section-4.2) of this document.\n\nAnd [rfc4035.html#section-3.2.2](https://www.rfc-editor.org/rfc/rfc4035.html#section-3.2.2) specifically says our cache should depend on the CD Bit of the original query:\n\n> If the resolver side implements a BAD cache (see [Section 4.7](https://www.rfc-editor.org/rfc/rfc4035.html#section-4.7)) and the name server side receives a query that matches an entry in the resolver side's BAD cache, the name server side's response depends on the state of the CD bit in the original query.",
          "root_cause": "The cache plugin does not differentiate between queries with the CD (Checking Disabled) bit set and those without. This results in a single cache entry being used for both types of queries.",
          "weaknesses": [
            "Incorrect caching mechanism that does not respect the CD bit in DNS queries.",
            "Violation of RFC4035 regarding caching of DNSSEC validation results."
          ],
          "impact": "A resolver might return an invalid cached entry to a client that sent a query without the CD bit set, even if a prior query with the CD bit set resulted in a validation failure. This can lead to a client accepting potentially invalid DNS records.",
           "attack_vectors": "A malicious actor could send a query to CoreDNS with the CD bit set, receive a bad cache entry, and then later trick another user querying the same domain without the CD bit to accept the invalid cache entry.",
            "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        },
        {
          "type": "issue",
          "content": "  * If CD bit is set in query, it disables validation at remote server   **What you expected to happen**:   * CD queries may pass, but the same answer must not be served to queries without CD bit set   **How to reproduce it (as minimally and precisely as possible)**:   * (re)start coredns * `dig @localhost -p 3053 +cd dnssec-failed.org` * sleep 3 * `dig @localhost -p 3053 +nocd dnssec-failed.org`  ``` ; <<>> DiG 9.18.16 <<>> @localhost -p 3053 +nocd dnssec-failed.org ; (2 servers found) ;; global options: +cmd ;; Got answer: ;; ->>HEADER<<- opcode: QUERY, status: NOERROR, id: 38206 ;; flags: qr aa rd ra; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 1  ;; OPT PSEUDOSECTION: ; EDNS: version: 0, flags:; udp: 1232 ; COOKIE: 7d7b4ddf7c182cc7 (echoed) ;; QUESTION SECTION: ;dnssec-failed.org.		IN	A  ;; ANSWER SECTION: dnssec-failed.org.	295	IN	A	96.99.227.255  ;; Query time: 0 msec ;; SERVER: ::1#3053(localhost) (UDP) ;; WHEN: Sat Jul 01 12:01:39 CEST 2023 ;; MSG SIZE  rcvd: 91  ```  * TTL shows it were cached, but CD bit is not included this time * It allowed reaching bogus DNSSEC record without CD bit, which should not have let us. forwarder is doing DNSSEC validation.",
           "root_cause": "CoreDNS's cache plugin does not have separate cache entries for DNS queries with and without the CD bit set. This causes the plugin to return possibly invalid cached results.",
            "weaknesses": [
              "Improper caching of DNS responses based on the CD bit."
            ],
            "impact": "CoreDNS can serve invalid DNSSEC records from cache, violating RFC4035",
            "attack_vectors": "An attacker could poison the cache by sending a DNS query with the CD bit set, potentially leading subsequent queries without the CD bit to receive invalid DNSSEC responses.",
            "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        },
        {
          "type": "security_advisory",
          "content": "* coredns: CD bit response is cached and served later (CVE-2024-0874)",
          "root_cause": "The vulnerability is caused by the CoreDNS cache plugin not differentiating queries with the CD bit set.",
          "weaknesses": [
            "The cache plugin does not properly distinguish between DNS queries based on the CD flag."
          ],
          "impact": "When a user queries WITH the CD bit set, the cache stores the a potentially invalid cache entry. Then if a user queries without CD bit set, CoreDNS will return the invalid cache entry (as if the CD bit was set) violating RFC4035.",
            "attack_vectors": "An attacker can poison the cache with queries with the CD bit, affecting subsequent queries without the bit set",
            "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        },
        {
          "type": "security_advisory",
           "content": "* coredns: CD bit response is cached and served later (CVE-2024-0874)",
            "root_cause": "The vulnerability is that CoreDNS does not properly isolate cache entries based on the presence of the CD bit.",
            "weaknesses": [
              "Incorrect cache implementation that does not properly handle the CD bit."
            ],
           "impact": "This could allow a resolver to return incorrect DNSSEC validation results from the cache.",
           "attack_vectors": "An attacker can poison the cache using queries with the CD bit set, leading to invalid responses for later queries without the CD bit.",
            "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        },
       {
          "type": "security_advisory",
           "content": "* coredns: CD bit response is cached and served later (CVE-2024-0874)",
            "root_cause": "CoreDNS's cache plugin does not create separate entries for queries with the CD bit enabled or disabled",
            "weaknesses": [
              "CoreDNS caching implementation does not respect the CD bit in DNS queries"
            ],
           "impact": "A resolver may serve invalid cached responses.",
          "attack_vectors": "An attacker can poison the cache with queries with the CD bit set, leading to invalid responses for later queries without the CD bit.",
            "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        },
        {
          "type": "bugzilla",
          "content": "CVE-2024-0874 coredns: CD bit response is cached and served later",
          "root_cause": "CoreDNS mishandling of CD bit",
          "weaknesses": [
           "CoreDNS's caching mechanism does not distinguish between CD bit set and unset queries"
          ],
          "impact": "A resolver might return a cached, potentially invalid, response to a client which did not specify a CD bit. Violating RFC4035 section 4.7",
          "attack_vectors": "An attacker can craft queries with a CD bit set that cause an invalid DNSSEC record to be cached. The next query from a user that does not set the CD bit may then get the invalid cached record.",
          "required_capabilities": "The attacker needs to be able to send DNS queries to the vulnerable CoreDNS server."
        }
      ]
    }
  }
}
```