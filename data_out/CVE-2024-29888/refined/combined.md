=== Content from github.com_cc3c75e9_20250110_155600.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fdccc2c842b4e2e09470929c80f07dc137e439182)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fdccc2c842b4e2e09470929c80f07dc137e439182)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/dccc2c842b4e2e09470929c80f07dc137e439182)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15490](https://github.com/saleor/saleor/pull/15490))

[Browse files](/saleor/saleor/tree/dccc2c842b4e2e09470929c80f07dc137e439182)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 29, 2024

1 parent
[eb4561b](/saleor/saleor/commit/eb4561b72488431047c8a794a0466b8179c1938f)

commit dccc2c8

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**310 additions**
and
**42 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/dccc2c842b4e2e09470929c80f07dc137e439182/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ class CheckoutErrorCode(Enum): |
|  |  | EMAIL\_NOT\_SET = "email\_not\_set" |
|  |  | NO\_LINES = "no\_lines" |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/dccc2c842b4e2e09470929c80f07dc137e439182/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.const import APP\_ID\_PREFIX |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
| Expand Down  Expand Up | | @@ -59,7 +60,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -238,6 +241,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -247,15 +251,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout\_prices( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -324,7 +332,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/dccc2c842b4e2e09470929c80f07dc137e439182/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -153,6 +154,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/dccc2c842b4e2e09470929c80f07dc137e439182/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -41,6 +41,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `dccc2c8`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fdccc2c842b4e2e09470929c80f07dc137e439182) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c26bcf20_20250110_155559.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fd8ba545c16ad3153febc5b5be8fd2ef75da9fc95)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fd8ba545c16ad3153febc5b5be8fd2ef75da9fc95)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15491](https://github.com/saleor/saleor/pull/15491))

[Browse files](/saleor/saleor/tree/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 29, 2024

1 parent
[6df4f0e](/saleor/saleor/commit/6df4f0ecfb10d8643a1bcd0db390a0c62b528937)

commit d8ba545

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**310 additions**
and
**42 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ class CheckoutErrorCode(Enum): |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | NON\_EDITABLE\_GIFT\_LINE = "non\_editable\_gift\_line" |
|  |  | NON\_REMOVABLE\_GIFT\_LINE = "non\_removable\_gift\_line" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.const import APP\_ID\_PREFIX |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
| Expand Down  Expand Up | | @@ -59,7 +60,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -238,6 +241,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -247,15 +251,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -324,7 +332,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -153,6 +154,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,6 +46,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `d8ba545`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fd8ba545c16ad3153febc5b5be8fd2ef75da9fc95) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_33fadb27_20250110_155558.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F997f7ea4f576543ec88679a86bfe1b14f7f2ff26)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F997f7ea4f576543ec88679a86bfe1b14f7f2ff26)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/997f7ea4f576543ec88679a86bfe1b14f7f2ff26)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix `FLAT_RATE` tax calculation for Click and Collect option. ([#15426](https://github.com/saleor/saleor/pull/15426))

[Browse files](/saleor/saleor/tree/997f7ea4f576543ec88679a86bfe1b14f7f2ff26)
Browse the repository at this point in the history

```
* fix checkout shipping address for tax calculations for click and collect option.
```

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 26, 2024

1 parent
[a4b1f7a](/saleor/saleor/commit/a4b1f7a5e4648411035db3100ffdd70577c0aa65)

commit 997f7ea

 Show file tree

 Hide file tree

Showing
**8 changed files**
with
**308 additions**
and
**37 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)
  + tax

    - saleor/tax/utils.py
      [utils.py](#diff-6a4a7eab95a8b54684716cf6a3f5c0588839fc2a8e2528394a31962b4bab347a)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/997f7ea4f576543ec88679a86bfe1b14f7f2ff26/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ class CheckoutErrorCode(Enum): |
|  |  | EMAIL\_NOT\_SET = "email\_not\_set" |
|  |  | NO\_LINES = "no\_lines" |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

15 changes: 13 additions & 2 deletions

15
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/997f7ea4f576543ec88679a86bfe1b14f7f2ff26/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ...core import ResolveInfo |
|  |  | from ...core.descriptions import ADDED\_IN\_31, ADDED\_IN\_34, DEPRECATED\_IN\_3X\_INPUT |
| Expand Down  Expand Up | | @@ -57,7 +58,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -223,6 +226,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -232,6 +236,14 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout\_prices( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
| Expand Down  Expand Up | | @@ -305,7 +317,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/997f7ea4f576543ec88679a86bfe1b14f7f2ff26/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -29,6 +29,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -137,6 +138,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/997f7ea4f576543ec88679a86bfe1b14f7f2ff26/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,6 +45,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `997f7ea`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F997f7ea4f576543ec88679a86bfe1b14f7f2ff26) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_4d8d8152_20250110_155557.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F47cedfd7d6524d79bdb04708edcdbb235874de6b)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F47cedfd7d6524d79bdb04708edcdbb235874de6b)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/47cedfd7d6524d79bdb04708edcdbb235874de6b)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix relation between order and click and collect address ([#15697](https://github.com/saleor/saleor/pull/15697))

[Browse files](/saleor/saleor/tree/47cedfd7d6524d79bdb04708edcdbb235874de6b)
Browse the repository at this point in the history

```
* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses
```

* Loading branch information

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&v=4)](/IKarbowiak)

[IKarbowiak](/saleor/saleor/commits?author=IKarbowiak "View all commits by IKarbowiak")
authored
Mar 27, 2024

1 parent
[ce4b317](/saleor/saleor/commit/ce4b31717ca2be3cc6c6f66dd5b876e9dd023253)

commit 47cedfd

 Show file tree

 Hide file tree

Showing
**10 changed files**
with
**140 additions**
and
**5 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/complete\_checkout.py
      [complete\_checkout.py](#diff-27b3f5d7b64efa6b9211eb632292fa7d6f6e031c8a5a38581da6391a901b5d0e)
  + graphql/checkout/tests/mutations

    - saleor/graphql/checkout/tests/mutations/test\_checkout\_complete\_with\_payment.py
      [test\_checkout\_complete\_with\_payment.py](#diff-886d043d7955cf5d35cc3e6f8eadcf69b126ff8e729ff7beb806f49473c360f0)
    - saleor/graphql/checkout/tests/mutations/test\_checkout\_complete\_with\_transactions.py
      [test\_checkout\_complete\_with\_transactions.py](#diff-d35172f296c1881cab11eb9302de9e85f1f45058b394636ac61caddb54a6c28b)
  + order/migrations

    - saleor/order/migrations/0172\_update\_order\_cc\_addresses.py
      [0172\_update\_order\_cc\_addresses.py](#diff-4b9bcafbd75acd0ba484ca0206a1aac2e4e2eb6c683e40c9efaea2bd1e6b9731)
    - saleor/order/migrations/0176\_merge\_20240325\_1315.py
      [0176\_merge\_20240325\_1315.py](#diff-791c8c9cfb750629f9e8cf41b0c9dd10fe6b5b9b2524f33c04b9525a7e172edf)
    - saleor/order/migrations/0177\_merge\_20240325\_1329.py
      [0177\_merge\_20240325\_1329.py](#diff-d799bc6f27172bc8c0f990ee0bc72636f2386643635cfee8128afb58545b8a4d)
    - saleor/order/migrations/0180\_merge\_20240325\_1333.py
      [0180\_merge\_20240325\_1333.py](#diff-1e6d6f148ed147c25406d58e4f6790f7ab8de535745e02ca55ea805f5eec3512)
    - saleor/order/migrations/0182\_merge\_20240325\_1338.py
      [0182\_merge\_20240325\_1338.py](#diff-9373871c2ab6f6dd91feb87d74c0bf29f1f266ff930ec2a9895967fedcdbbe5e)
    - saleor/order/migrations/0184\_merge\_0182\_merge\_20240325\_1338\_0183\_order\_tax\_error.py
      [0184\_merge\_0182\_merge\_20240325\_1338\_0183\_order\_tax\_error.py](#diff-52471f78aad29cea5613e138c0622fd2097de21ee0d92a3e15743bcced0e041b)
    - tasks

      * saleor/order/migrations/tasks/saleor3\_19.py
        [saleor3\_19.py](#diff-0d50d7faa674fe31c3ab5c3812310ee5b7c93cdb2d0d117dba05dbec8e4a3ca7)

## There are no files selected for viewing

3 changes: 3 additions & 0 deletions

3
[saleor/checkout/complete\_checkout.py](#diff-27b3f5d7b64efa6b9211eb632292fa7d6f6e031c8a5a38581da6391a901b5d0e "saleor/checkout/complete_checkout.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/checkout/complete_checkout.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -145,6 +145,9 @@ def \_process\_shipping\_data\_for\_order( |
|  |  | if checkout\_info.user.addresses.filter(pk=shipping\_address.pk).exists(): |
|  |  | shipping\_address = shipping\_address.get\_copy() |
|  |  |  |
|  |  | if shipping\_address and delivery\_method\_info.warehouse\_pk: |
|  |  | shipping\_address = shipping\_address.get\_copy() |
|  |  |  |
|  |  | shipping\_method = delivery\_method\_info.delivery\_method |
|  |  | tax\_class = getattr(shipping\_method, "tax\_class", None) |
|  |  |  |
| Expand Down | |  |

8 changes: 5 additions & 3 deletions

8
[saleor/graphql/checkout/tests/mutations/test\_checkout\_complete\_with\_payment.py](#diff-886d043d7955cf5d35cc3e6f8eadcf69b126ff8e729ff7beb806f49473c360f0 "saleor/graphql/checkout/tests/mutations/test_checkout_complete_with_payment.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/graphql/checkout/tests/mutations/test_checkout_complete_with_payment.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -3105,7 +3105,7 @@ def test\_complete\_checkout\_for\_local\_click\_and\_collect( |
|  |  | order\_count = Order.objects.count() |
|  |  | checkout = checkout\_with\_item\_for\_cc |
|  |  | checkout.collection\_point = warehouse\_for\_cc |
|  |  | checkout.shipping\_address = None |
|  |  | checkout.shipping\_address = warehouse\_for\_cc.address |
|  |  | checkout.save(update\_fields=["collection\_point", "shipping\_address"]) |
|  |  |  |
|  |  | variables = { |
| Expand Down  Expand Up | | @@ -3147,7 +3147,8 @@ def test\_complete\_checkout\_for\_local\_click\_and\_collect( |
|  |  |  |
|  |  | assert order.collection\_point == warehouse\_for\_cc |
|  |  | assert order.shipping\_method is None |
|  |  | assert order.shipping\_address == warehouse\_for\_cc.address |
|  |  | assert order.shipping\_address |
|  |  | assert order.shipping\_address.id != warehouse\_for\_cc.address.id |
|  |  | assert order.shipping\_price == zero\_taxed\_money(payment.currency) |
|  |  | assert order.lines.count() == 1 |
|  |  |  |
| Expand Down  Expand Up | | @@ -3215,7 +3216,8 @@ def test\_complete\_checkout\_for\_global\_click\_and\_collect( |
|  |  |  |
|  |  | assert order.collection\_point == warehouse\_for\_cc |
|  |  | assert order.shipping\_method is None |
|  |  | assert order.shipping\_address == warehouse\_for\_cc.address |
|  |  | assert order.shipping\_address |
|  |  | assert order.shipping\_address.id != warehouse\_for\_cc.address.id |
|  |  | assert order.shipping\_price == zero\_taxed\_money(payment.currency) |
|  |  | assert order.lines.count() == 1 |
|  |  |  |
| Expand Down | |  |

6 changes: 4 additions & 2 deletions

6
[saleor/graphql/checkout/tests/mutations/test\_checkout\_complete\_with\_transactions.py](#diff-d35172f296c1881cab11eb9302de9e85f1f45058b394636ac61caddb54a6c28b "saleor/graphql/checkout/tests/mutations/test_checkout_complete_with_transactions.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/graphql/checkout/tests/mutations/test_checkout_complete_with_transactions.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -2773,7 +2773,8 @@ def test\_complete\_checkout\_for\_local\_click\_and\_collect( |
|  |  |  |
|  |  | assert order.collection\_point == warehouse\_for\_cc |
|  |  | assert order.shipping\_method is None |
|  |  | assert order.shipping\_address == warehouse\_for\_cc.address |
|  |  | assert order.shipping\_address |
|  |  | assert order.shipping\_address.id != warehouse\_for\_cc.address.id |
|  |  | assert order.shipping\_price == zero\_taxed\_money(order.channel.currency\_code) |
|  |  | assert order.lines.count() == 1 |
|  |  |  |
| Expand Down  Expand Up | | @@ -2833,7 +2834,8 @@ def test\_complete\_checkout\_for\_global\_click\_and\_collect( |
|  |  |  |
|  |  | assert order.collection\_point == warehouse\_for\_cc |
|  |  | assert order.shipping\_method is None |
|  |  | assert order.shipping\_address == warehouse\_for\_cc.address |
|  |  | assert order.shipping\_address |
|  |  | assert order.shipping\_address.id != warehouse\_for\_cc.address.id |
|  |  | assert order.shipping\_price == zero\_taxed\_money(order.channel.currency\_code) |
|  |  | assert order.lines.count() == 1 |
|  |  |  |
| Expand Down | |  |

39 changes: 39 additions & 0 deletions

39
[saleor/order/migrations/0172\_update\_order\_cc\_addresses.py](#diff-4b9bcafbd75acd0ba484ca0206a1aac2e4e2eb6c683e40c9efaea2bd1e6b9731 "saleor/order/migrations/0172_update_order_cc_addresses.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0172_update_order_cc_addresses.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,39 @@ |
|  |  | from django.db import migrations |
|  |  | from django.db.models import Exists, OuterRef |
|  |  | from django.forms.models import model\_to\_dict |
|  |  |  |
|  |  | from .tasks.saleor3\_19 import update\_order\_addresses\_task |
|  |  |  |
|  |  | # The batch of size 250 takes ~0.5 second and consumes ~20MB memory at peak |
|  |  | ADDRESS\_UPDATE\_BATCH\_SIZE = 250 |
|  |  |  |
|  |  |  |
|  |  | def update\_order\_addresses(apps, schema\_editor): |
|  |  | Order = apps.get\_model("order", "Order") |
|  |  | Warehouse = apps.get\_model("warehouse", "Warehouse") |
|  |  | Address = apps.get\_model("account", "Address") |
|  |  | qs = Order.objects.filter( |
|  |  | Exists(Warehouse.objects.filter(address\_id=OuterRef("shipping\_address\_id"))), |
|  |  | ) |
|  |  | order\_ids = qs.values\_list("pk", flat=True)[:ADDRESS\_UPDATE\_BATCH\_SIZE] |
|  |  | addresses = [] |
|  |  | if order\_ids: |
|  |  | orders = Order.objects.filter(id\_\_in=order\_ids) |
|  |  | for order in orders: |
|  |  | if cc\_address := order.shipping\_address: |
|  |  | order\_address = Address(\*\*model\_to\_dict(cc\_address, exclude=["id"])) |
|  |  | order.shipping\_address = order\_address |
|  |  | addresses.append(order\_address) |
|  |  | Address.objects.bulk\_create(addresses, ignore\_conflicts=True) |
|  |  | Order.objects.bulk\_update(orders, ["shipping\_address"]) |
|  |  | update\_order\_addresses\_task.delay() |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0171\_order\_order\_user\_email\_user\_id\_idx"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [ |
|  |  | migrations.RunPython(update\_order\_addresses, migrations.RunPython.noop), |
|  |  | ] |

12 changes: 12 additions & 0 deletions

12
[saleor/order/migrations/0176\_merge\_20240325\_1315.py](#diff-791c8c9cfb750629f9e8cf41b0c9dd10fe6b5b9b2524f33c04b9525a7e172edf "saleor/order/migrations/0176_merge_20240325_1315.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0176_merge_20240325_1315.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | # Generated by Django 3.2.22 on 2024-03-25 13:15 |
|  |  |  |
|  |  | from django.db import migrations |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0172\_update\_order\_cc\_addresses"), |
|  |  | ("order", "0175\_merge\_20231122\_1040"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [] |

12 changes: 12 additions & 0 deletions

12
[saleor/order/migrations/0177\_merge\_20240325\_1329.py](#diff-d799bc6f27172bc8c0f990ee0bc72636f2386643635cfee8128afb58545b8a4d "saleor/order/migrations/0177_merge_20240325_1329.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0177_merge_20240325_1329.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | # Generated by Django 3.2.22 on 2024-03-25 13:29 |
|  |  |  |
|  |  | from django.db import migrations |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0176\_merge\_20231122\_1346"), |
|  |  | ("order", "0176\_merge\_20240325\_1315"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [] |

12 changes: 12 additions & 0 deletions

12
[saleor/order/migrations/0180\_merge\_20240325\_1333.py](#diff-1e6d6f148ed147c25406d58e4f6790f7ab8de535745e02ca55ea805f5eec3512 "saleor/order/migrations/0180_merge_20240325_1333.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0180_merge_20240325_1333.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | # Generated by Django 3.2.22 on 2024-03-25 13:33 |
|  |  |  |
|  |  | from django.db import migrations |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0177\_merge\_20240325\_1329"), |
|  |  | ("order", "0179\_merge\_20231122\_1348"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [] |

12 changes: 12 additions & 0 deletions

12
[saleor/order/migrations/0182\_merge\_20240325\_1338.py](#diff-9373871c2ab6f6dd91feb87d74c0bf29f1f266ff930ec2a9895967fedcdbbe5e "saleor/order/migrations/0182_merge_20240325_1338.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0182_merge_20240325_1338.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | # Generated by Django 3.2.22 on 2024-03-25 13:38 |
|  |  |  |
|  |  | from django.db import migrations |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0180\_merge\_20240325\_1333"), |
|  |  | ("order", "0181\_order\_subtotal\_as\_a\_field"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [] |

12 changes: 12 additions & 0 deletions

12
[saleor/order/migrations/0184\_merge\_0182\_merge\_20240325\_1338\_0183\_order\_tax\_error.py](#diff-52471f78aad29cea5613e138c0622fd2097de21ee0d92a3e15743bcced0e041b "saleor/order/migrations/0184_merge_0182_merge_20240325_1338_0183_order_tax_error.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/0184_merge_0182_merge_20240325_1338_0183_order_tax_error.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,12 @@ |
|  |  | # Generated by Django 3.2.22 on 2024-03-25 13:42 |
|  |  |  |
|  |  | from django.db import migrations |
|  |  |  |
|  |  |  |
|  |  | class Migration(migrations.Migration): |
|  |  | dependencies = [ |
|  |  | ("order", "0182\_merge\_20240325\_1338"), |
|  |  | ("order", "0183\_order\_tax\_error"), |
|  |  | ] |
|  |  |  |
|  |  | operations = [] |

29 changes: 29 additions & 0 deletions

29
[saleor/order/migrations/tasks/saleor3\_19.py](#diff-0d50d7faa674fe31c3ab5c3812310ee5b7c93cdb2d0d117dba05dbec8e4a3ca7 "saleor/order/migrations/tasks/saleor3_19.py")

Show comments

[View file](/saleor/saleor/blob/47cedfd7d6524d79bdb04708edcdbb235874de6b/saleor/order/migrations/tasks/saleor3_19.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
|  |  | @@ -0,0 +1,29 @@ |
|  |  | from django.db.models import Exists, OuterRef |
|  |  | from django.forms.models import model\_to\_dict |
|  |  |  |
|  |  | from ....account.models import Address |
|  |  | from ....celeryconf import app |
|  |  | from ....warehouse.models import Warehouse |
|  |  | from ...models import Order |
|  |  |  |
|  |  | # The batch of size 250 takes ~0.5 second and consumes ~20MB memory at peak |
|  |  | ADDRESS\_UPDATE\_BATCH\_SIZE = 250 |
|  |  |  |
|  |  |  |
|  |  | @app.task |
|  |  | def update\_order\_addresses\_task(): |
|  |  | qs = Order.objects.filter( |
|  |  | Exists(Warehouse.objects.filter(address\_id=OuterRef("shipping\_address\_id"))), |
|  |  | ) |
|  |  | order\_ids = qs.values\_list("pk", flat=True)[:ADDRESS\_UPDATE\_BATCH\_SIZE] |
|  |  | addresses = [] |
|  |  | if order\_ids: |
|  |  | orders = Order.objects.filter(id\_\_in=order\_ids) |
|  |  | for order in orders: |
|  |  | if cc\_address := order.shipping\_address: |
|  |  | order\_address = Address(\*\*model\_to\_dict(cc\_address, exclude=["id"])) |
|  |  | order.shipping\_address = order\_address |
|  |  | addresses.append(order\_address) |
|  |  | Address.objects.bulk\_create(addresses, ignore\_conflicts=True) |
|  |  | Order.objects.bulk\_update(orders, ["shipping\_address"]) |
|  |  | update\_order\_addresses\_task.delay() |

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `47cedfd`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F47cedfd7d6524d79bdb04708edcdbb235874de6b) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2dab0469_20250110_155604.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15697)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15697)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsaleor%2Fsaleor%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsaleor%2Fsaleor%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix relation between order and click and collect address #15697

 Merged

[korycins](/korycins)
merged 1 commit into
[main](/saleor/saleor/tree/main "saleor/saleor:main")
from
[merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main](/saleor/saleor/tree/merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main "saleor/saleor:merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main")

Mar 27, 2024

 Merged

# [Fix relation between order and click and collect address](#top) #15697

[korycins](/korycins)
merged 1 commit into
[main](/saleor/saleor/tree/main "saleor/saleor:main")
from
[merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main](/saleor/saleor/tree/merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main "saleor/saleor:merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main")

Mar 27, 2024

[Conversation
4](/saleor/saleor/pull/15697)
[Commits
1](/saleor/saleor/pull/15697/commits)
[Checks
45](/saleor/saleor/pull/15697/checks)
[Files changed](/saleor/saleor/pull/15697/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=60&v=4)](/IKarbowiak)

Copy link

Member

### @IKarbowiak **[IKarbowiak](/IKarbowiak)** commented [Mar 25, 2024](#issue-2205848387)

Port of [#15682](https://github.com/saleor/saleor/pull/15682)

# Impact

* New migrations
* New/Updated API fields or mutations
* Deprecated API fields or mutations
* Removed API types, fields, or mutations

# Docs

* Link to documentation:

# Pull Request Checklist

* Privileged queries and mutations are either absent or guarded by proper permission checks
* Database queries are optimized and the number of queries is constant
* Database migrations are either absent or optimized for zero downtime
* The changes are covered by test cases
* All new fields/inputs/mutations have proper labels added (`ADDED_IN_X`, `PREVIEW_FEATURE`, etc.)
* All migrations have proper dependencies
* All indexes are added concurrently in migrations
* All RunSql and RunPython migrations have revert option defined

Sorry, something went wrong.

All reactions

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&v=4)](/IKarbowiak)

`[Fix relation between order and click and collect address](/saleor/saleor/pull/15697/commits/814fdd24746eae204bae77b2843ec6df9df7dc0e "Fix relation between order and click and collect address

* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses")`
 …

`[814fdd2](/saleor/saleor/pull/15697/commits/814fdd24746eae204bae77b2843ec6df9df7dc0e)`

```
* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses
```

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&u=559d22666859f8022c4b78a9eec037353c0dbe95&v=4)](/IKarbowiak)
[IKarbowiak](/IKarbowiak)
self-assigned this
[Mar 25, 2024](#event-12235272720)

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&u=559d22666859f8022c4b78a9eec037353c0dbe95&v=4)](/IKarbowiak)
[IKarbowiak](/IKarbowiak)
added
the
[skip changelog](/saleor/saleor/labels/skip%20changelog)
label
[Mar 25, 2024](#event-12235280066)

[![@db-queries](https://avatars.githubusercontent.com/in/59286?s=80&v=4)](/apps/db-queries)

Copy link

### **[db-queries](/apps/db-queries) bot** commented [Mar 25, 2024](#issuecomment-2018137963)

| Here is the report for [814fdd2](https://github.com/saleor/saleor/commit/814fdd24746eae204bae77b2843ec6df9df7dc0e) (saleor:merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main) Base comparison is [a6693fd](https://github.com/saleor/saleor/commit/a6693fdc3b1773dc09ddc4dbaf96eed3eb3200e3).  **Found 1 differences!** (click me)   ``` # saleor.graphql.accountbenchmark account   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   addresses for federation query count                                    	          9	          9	              2   customers query                                                         	         51	         51	              0   delete staff members                                                    	         41	         41	              0   query staff user                                                        	         22	         22	              3   staff create                                                            	         23	         23	              3   staff update groups and permissions                                     	         36	         36	              5   users for federation query count                                        	          8	          8	              3  # saleor.graphql.accountbenchmark permission group   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   groups for federation query count                                       	          5	          5	              0   permission group create                                                 	         25	         25	              0   permission group delete                                                 	         30	         30	              3   permission group query                                                  	         14	         14	              0   permission group update                                                 	         44	         44	              2   permission group update remove users with manage staff                  	         36	         36	              3  # saleor.graphql.appbenchmarks app extensions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   app extensions                                                          	         25	         25	             10   app extensions with filter[filter0]                                     	         24	         24	             10   app extensions with filter[filter1]                                     	         12	         12	              2   app extensions with filter[filter2]                                     	         24	         24	             10   app extensions with filter[filter3]                                     	         12	         12	              2  # saleor.graphql.appbenchmarks apps   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   apps for federation query count                                         	          9	          9	              3   apps with tokens and webhooks                                           	          9	          9	              0  # saleor.graphql.attributebenchmark attribute   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   attribute translation                                                   	          6	          6	              0   attribute value translation                                             	         20	         20	              0   query attribute                                                         	          6	          6	              0   query attributes                                                        	          8	          8	              0  # saleor.graphql.channelbenchmark channel   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   channels query                                                          	          5	          5	              0  # saleor.graphql.channelmutations channel update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   channel update mutation remove warehouse                                	         38	         38	              6  # saleor.graphql.checkoutbenchmark checkout mutations   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   add billing address to checkout                                         	         75	         75	             10   add checkout lines                                                      	         80	         80	             12   add checkout lines gift discount applies                                	        142	        142	             21   add checkout lines order discount applies                               	        156	        156	             16   add checkout lines with external shipping                               	        183	        183	             74   add checkout lines with reservations                                    	        169	        169	             60   add delivery to checkout                                                	         77	         77	             13   add shipping to checkout                                                	         88	         88	             15   checkout email update                                                   	         40	         40	              2   checkout payment charge                                                 	         56	         56	             16   checkout shipping address update                                        	         81	         81	              9   checkout voucher code                                                   	        100	        100	             16   complete checkout                                                       	        239	        239	             81   complete checkout preorder                                              	        237	        237	             82   complete checkout with digital line                                     	        280	        280	             95   complete checkout with out of stock webhook                             	        241	        241	             81   complete checkout with single line                                      	        241	        241	             81   create checkout                                                         	         81	         81	              8   create checkout with gift promotion                                     	        120	        120	             18   create checkout with order promotion                                    	        103	        103	              8   create checkout with reservations                                       	        147	        147	             26   customer complete checkout                                              	        252	        252	             87 - customer complete checkout for cc                                       	        227	        229	             76   update checkout lines                                                   	         73	         73	             12   update checkout lines with reservations                                 	        175	        175	             71  # saleor.graphql.checkoutbenchmark checkouts   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   staff multiple checkouts                                                	          6	          6	              0  # saleor.graphql.checkoutbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   user checkout details                                                   	         59	         59	              5   user checkout details with tax app                                      	         81	         81	             27  # saleor.graphql.discountbenchmark promotion create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion create                                                        	         24	         24	              1   promotion create order promotion                                        	         38	         38	              7  # saleor.graphql.discountbenchmark promotion delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   gift promotion delete                                                   	         26	         26	              1   promotion delete                                                        	         28	         28	              1  # saleor.graphql.discountbenchmark promotion rule create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule create                                                   	         21	         21	              1   promotion rule create gift                                              	        135	        135	              7  # saleor.graphql.discountbenchmark promotion rule delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule delete                                                   	         24	         24	              0  # saleor.graphql.discountbenchmark promotion rule update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule update                                                   	         36	         36	              0  # saleor.graphql.discountbenchmark promotion update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion update                                                        	         14	         14	              0  # saleor.graphql.discountbenchmark promotions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotions querytest promotions query                                   	          9	          9	              0  # saleor.graphql.discountbenchmark sales   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   sales query with channel slug                                           	          9	          9	              0   sales query without channel slug                                        	          7	          7	              0  # saleor.graphql.discountbenchmark voucher code bulk delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   voucher code bulk delete queries                                        	         22	         22	              2  # saleor.graphql.discountbenchmark vouchers   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   vouchers query with channel slug                                        	         20	         20	              0   vouchers query withot channel slug                                      	         19	         19	              0  # saleor.graphql.giftcardbenchmark gift card mutations   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   create never expiry gift card                                           	         26	         26	              4   gift card bulk activate by staff                                        	         16	         16	              3   update gift card                                                        	         36	         36	              4  # saleor.graphql.giftcardbenchmark gift card queries   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   filter gift cards by products                                           	         14	         14	              3   filter gift cards by tags                                               	         12	         12	              3   filter gift cards by used by user                                       	         13	         13	              3   query gift card details                                                 	         14	         14	              3   query gift cards                                                        	         12	         12	              3  # saleor.graphql.orderbenchmark fulfillment   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   fulfillment query                                                       	          6	          6	              0  # saleor.graphql.orderbenchmark fulfillment refund and return products   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   fulfillment refund products order lines                                 	         60	         60	              0   fulfillment return products order lines                                 	        102	        102	              7  # saleor.graphql.orderbenchmark order   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   staff multiple draft orders                                             	          7	          7	              0   staff multiple orders                                                   	          7	          7	              0   staff order details                                                     	         56	         56	              7   user order details                                                      	         54	         54	              8  # saleor.graphql.orderbenchmark order bulk create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order bulk create                                                       	         21	         21	              2  # saleor.graphql.orderbenchmark order fulfill   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order fulfill                                                           	         19	         19	              0   order fulfill with gift cards                                           	         19	         19	              0  # saleor.graphql.orderbenchmark order lines create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order lines create                                                      	         94	         94	             17   order lines create variants on promotion                                	        153	        153	             22  # saleor.graphql.pagebenchmark page type   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   page types for federation query count                                   	          3	          3	              0   query page type                                                         	         18	         18	              6   query page types                                                        	         25	         25	             12  # saleor.graphql.paymentbenchmark payment transactions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   payment transactions                                                    	         54	         54	             20  # saleor.graphql.productbenchmark category   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   categories children                                                     	          3	          3	              0   categories for federation query count                                   	          3	          3	              0   category delete                                                         	         49	         49	              4   category view                                                           	         33	         33	              4  # saleor.graphql.productbenchmark collection   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   collection add products                                                 	         21	         21	              5   collection bulk delete                                                  	         28	         28	              3   collection view                                                         	         11	         11	              3   collections for federation query count                                  	          6	          6	              0   create collection                                                       	         37	         37	              5   delete collection                                                       	         40	         40	              5   remove products from collection                                         	         18	         18	              5   retrieve collection channel listings                                    	          5	          5	              0  # saleor.graphql.productbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   report product sales                                                    	         10	         10	              3   retrieve product list                                                   	          4	          4	              0  # saleor.graphql.productbenchmark product   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   filter products by attributes                                           	         10	         10	              1   filter products by boolean attributes                                   	         17	         17	              1   filter products by gift card                                            	         14	         14	              2   filter products by numeric attributes                                   	         16	         16	              1   product create                                                          	         53	         53	              3   product details                                                         	         46	         46	              4   product translations                                                    	          8	          8	              1   products for federation query count                                     	         12	         12	              4   products media for federation query count                               	          5	          5	              0   products types for federation query count                               	          2	          2	              0   retrieve channel listings                                               	         20	         20	              0   retrieve product attributes                                             	         11	         11	              1   retrieve product images                                                 	          7	          7	              1   retrieve product media                                                  	          7	          7	              1   retrive products with product types and attributes                      	         10	         10	              1   update product                                                          	         74	         74	              5  # saleor.graphql.productbenchmark product variant channel listing update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   variant channel listing update                                          	         33	         33	              3  # saleor.graphql.productbenchmark variant   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   product variant bulk create                                             	         46	         46	              1   product variant create                                                  	         60	         60	              3   products variants for federation query count                            	         10	         10	              3   retrieve variant list                                                   	         37	         37	              2   update product variant                                                  	         61	         61	              7  # saleor.graphql.productbenchmark variant stocks   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   product variants stocks create                                          	         29	         29	              4   product variants stocks create with single webhook called               	         28	         28	              4   product variants stocks delete by id                                    	         30	         30	              4   product variants stocks delete by sku                                   	         30	         30	              4   product variants stocks delete with out of stock webhook many calls     	         26	         26	              3   product variants stocks update by sku                                   	         28	         28	              4   product variants stocks update byid                                     	         28	         28	              4   query product variants stocks                                           	         10	         10	              0  # saleor.graphql.producttest product sorting attributes   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   sort product not having attribute data                                  	         20	         20	              0  # saleor.graphql.shippingbenchmark shipping methods   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   vouchers query with channel slug                                        	          7	          7	              0   vouchers query without channel slug                                     	          7	          7	              0  # saleor.graphql.shippingbenchmark shipping zones   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   shipping zones query                                                    	          6	          6	              0  # saleor.graphql.shopbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   retrieve shop                                                           	          2	          2	              0  # saleor.graphql.warehousebenchmark stock bulk update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   stocks bulk update queries count                                        	         33	         33	              5  # saleor.graphql.warehousebenchmark stocks   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   stocks query                                                            	          5	          5	              0  # saleor.graphql.webhookbenchmark webhook events   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   webhooks                                                                	          6	          6	              0  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)
[![Codecov](https://avatars.githubusercontent.com/in/254?s=40&u=c392dd7c2afc51fe2347d4296afa8494ac05772e&v=4)](https://github.com/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Mar 25, 2024](#issuecomment-2018140855) • edited Loading

| [Codecov](https://app.codecov.io/gh/saleor/saleor/pull/15697?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor) Report All modified and coverable lines are covered by tests ✅  Project coverage is 93.93%. Comparing base [(`a6693fd`)](https://app.codecov.io/gh/saleor/saleor/commit/a6693fdc3b1773dc09ddc4dbaf96eed3eb3200e3?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor) to head [(`814fdd2`)](https://app.codecov.io/gh/saleor/saleor/pull/15697?dropdown=coverage&src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). Report is 3 commits behind head on main. Additional details and impacted files ``` @@           Coverage Diff           @@ ##             main   #15697   +/-   ## =======================================   Coverage   93.93%   93.93%            =======================================   Files         932      932              Lines       71629    71631    +2        Branches     8404     8405    +1      ======================================= + Hits        67288    67290    +2        Misses       2785     2785              Partials     1556     1556            ```   [☔ View full report in Codecov by Sentry](https://app.codecov.io/gh/saleor/saleor/pull/15697?dropdown=coverage&src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). 📢 Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). |
| --- |

All reactions

Sorry, something went wrong.

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
added
the
[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
label
[Mar 25, 2024](#event-12235795521)

[![korycins](https://avatars.githubusercontent.com/u/23282005?s=60&v=4)](/korycins)

**[korycins](/korycins)**
approved these changes
[Mar 25, 2024](#pullrequestreview-1957945446)

 [View reviewed changes](/saleor/saleor/pull/15697/files/814fdd24746eae204bae77b2843ec6df9df7dc0e)

[![zedzior](https://avatars.githubusercontent.com/u/55899043?s=60&v=4)](/zedzior)

**[zedzior](/zedzior)**
approved these changes
[Mar 25, 2024](#pullrequestreview-1957985340)

 [View reviewed changes](/saleor/saleor/pull/15697/files/814fdd24746eae204bae77b2843ec6df9df7dc0e)

[![@saleor-deployments](https://avatars.githubusercontent.com/u/13796165?s=80&v=4)](/apps/saleor-deployments)

Copy link

### **[saleor-deployments](/apps/saleor-deployments) bot** commented [Mar 26, 2024](#issuecomment-2020051582)

| No migrations were executed during test, commit `074d2d4` |
| --- |

All reactions

Sorry, something went wrong.

[![@saleor-deployments](https://avatars.githubusercontent.com/u/13796165?s=40&v=4)](/apps/saleor-deployments)
[saleor-deployments](/apps/saleor-deployments)
bot
removed
the
[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
label
[Mar 26, 2024](#event-12247657904)

[![@magul](https://avatars.githubusercontent.com/u/1165138?s=40&u=65b01a45f484cefb5c68bba4e0f84a1d6199143b&v=4)](/magul)
[magul](/magul)
added
the
[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
label
[Mar 26, 2024](#event-12247774460)

[![@saleor-deployments](https://avatars.githubusercontent.com/u/13796165?s=80&v=4)](/apps/saleor-deployments)

Copy link

### **[saleor-deployments](/apps/saleor-deployments) bot** commented [Mar 26, 2024](#issuecomment-2020087869)

| No migrations were executed during test, commit `5e244dc` |
| --- |

All reactions

Sorry, something went wrong.

[![@saleor-deployments](https://avatars.githubusercontent.com/u/13796165?s=40&v=4)](/apps/saleor-deployments)
[saleor-deployments](/apps/saleor-deployments)
bot
removed
the
[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
label
[Mar 26, 2024](#event-12247884239)

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
added
the
[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
label
[Mar 26, 2024](#event-12249442836)

 Hide details
View details

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
merged commit [`47cedfd`](/saleor/saleor/commit/47cedfd7d6524d79bdb04708edcdbb235874de6b)
into
main

[Mar 27, 2024](https://github.com/saleor/saleor/pull/15697#event-12265272168)
36 of 42 checks passed

 [![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
deleted the
merx-213-staff-can-override-warehouse-address-when-editing-address-on-order-with-cc-main

branch
[March 27, 2024 12:56](#event-12265272340)

[korycins](/korycins)
pushed a commit
that referenced
this pull request
[Apr 15, 2024](#ref-commit-1501fc0)
[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&u=559d22666859f8022c4b78a9eec037353c0dbe95&v=4)](/IKarbowiak) [![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&v=4)](/korycins)

`[Fix relation between order and click and collect address (](/saleor/saleor/commit/1501fc0f762c4cda7569542a1f203f2046279f65 "Fix relation between order and click and collect address (#15697)

* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses")[#15697](https://github.com/saleor/saleor/pull/15697)[)](/saleor/saleor/commit/1501fc0f762c4cda7569542a1f203f2046279f65 "Fix relation between order and click and collect address (#15697)

* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses")`
…

`[1501fc0](/saleor/saleor/commit/1501fc0f762c4cda7569542a1f203f2046279f65)`

```
* Create a copy of collection point address during checkout completion

* Add migration for creating order shipping addresses
```

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15697)

Reviewers

[![@zedzior](https://avatars.githubusercontent.com/u/55899043?s=40&v=4)](/zedzior) [zedzior](/zedzior)

zedzior approved these changes

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&v=4)](/korycins) [korycins](/korycins)

korycins approved these changes

Assignees

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=40&v=4)](/IKarbowiak) [IKarbowiak](/IKarbowiak)

Labels

[migrations perf test](/saleor/saleor/labels/migrations%20perf%20test)
Runs performance tests on modified migrations
[skip changelog](/saleor/saleor/labels/skip%20changelog)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

4 participants

[![@IKarbowiak](https://avatars.githubusercontent.com/u/40886528?s=52&v=4)](/IKarbowiak) [![@korycins](https://avatars.githubusercontent.com/u/23282005?s=52&v=4)](/korycins) [![@zedzior](https://avatars.githubusercontent.com/u/55899043?s=52&v=4)](/zedzior) [![@magul](https://avatars.githubusercontent.com/u/1165138?s=52&v=4)](/magul)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_c5cdc668_20250110_155559.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fb7cecda8b603f7472790150bb4508c7b655946d4)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fb7cecda8b603f7472790150bb4508c7b655946d4)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/b7cecda8b603f7472790150bb4508c7b655946d4)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15489](https://github.com/saleor/saleor/pull/15489))

[Browse files](/saleor/saleor/tree/b7cecda8b603f7472790150bb4508c7b655946d4)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 29, 2024

1 parent
[3634257](/saleor/saleor/commit/363425761a514f86f5186e18f26cf8ecd2790500)

commit b7cecda

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**309 additions**
and
**41 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/b7cecda8b603f7472790150bb4508c7b655946d4/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ class CheckoutErrorCode(Enum): |
|  |  | EMAIL\_NOT\_SET = "email\_not\_set" |
|  |  | NO\_LINES = "no\_lines" |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/b7cecda8b603f7472790150bb4508c7b655946d4/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -20,6 +20,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.const import APP\_ID\_PREFIX |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
| Expand Down  Expand Up | | @@ -58,7 +59,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -237,6 +240,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -246,15 +250,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout\_prices( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -323,7 +331,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/b7cecda8b603f7472790150bb4508c7b655946d4/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -152,6 +153,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/b7cecda8b603f7472790150bb4508c7b655946d4/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,6 +45,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `b7cecda`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fb7cecda8b603f7472790150bb4508c7b655946d4) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_dea360d4_20250110_155556.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15488](https://github.com/saleor/saleor/pull/15488))

[Browse files](/saleor/saleor/tree/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 29, 2024

1 parent
[c09cb4a](/saleor/saleor/commit/c09cb4abb3d71dfee532097133106fcbfdf95376)

commit 39abb0f

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**309 additions**
and
**41 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ class CheckoutErrorCode(Enum): |
|  |  | EMAIL\_NOT\_SET = "email\_not\_set" |
|  |  | NO\_LINES = "no\_lines" |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
|  |  | from ...core import ResolveInfo |
| Expand Down  Expand Up | | @@ -58,7 +59,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -237,6 +240,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -246,15 +250,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout\_prices( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -323,7 +331,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -152,6 +153,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,6 +45,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `39abb0f`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_3de1d883_20250110_155601.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15487](https://github.com/saleor/saleor/pull/15487))

[Browse files](/saleor/saleor/tree/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Feb 29, 2024

1 parent
[352835c](/saleor/saleor/commit/352835ccf9614c238f643701c4bb5224920270fa)

commit ef003c7

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**309 additions**
and
**41 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -30,6 +30,7 @@ class CheckoutErrorCode(Enum): |
|  |  | EMAIL\_NOT\_SET = "email\_not\_set" |
|  |  | NO\_LINES = "no\_lines" |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
|  |  | from ...core import ResolveInfo |
| Expand Down  Expand Up | | @@ -58,7 +59,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -237,6 +240,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -246,15 +250,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout\_prices( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -323,7 +331,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -152,6 +153,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -45,6 +45,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `ef003c7`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2Fef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_16c75532_20250110_155604.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fsecurity%2Fadvisories%2FGHSA-mrj3-f2h4-7w45)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fsecurity%2Fadvisories%2FGHSA-mrj3-f2h4-7w45)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Frepos%2Fadvisories%2Fshow&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

# Customers addresses leak when using Warehouse as a `Pickup: Local stock only` delivery method

Moderate

[NyanKiyoshi](/NyanKiyoshi)
published
GHSA-mrj3-f2h4-7w45
Mar 27, 2024

## Package

saleor
(GHCR)

## Affected versions

>= 3.14.56, < 3.14.61
>= 3.15.31, < 3.15.37
>= 3.16.27, < 3.16.34
>= 3.17.25, < 3.17.32
>= 3.18.19, < 3.18.28
>= 3.19.5, < 3.19.15

## Patched versions

3.14.61
3.15.37
3.16.34
3.17.32
3.18.28
3.19.15

## Description

### Summary

Using `Pickup: Local stock only` as a click-and-collect points could cause a leak of customer addresses

### Details

When using `Pickup: Local stock only` click-and-collect as a delivery method in specific conditions the customer could overwrite the warehouse address with its own, which exposes its address as click-and-collect address.

### Impact

The vulnerability can cause the leak of customer's address when using click-and-collect delivery option marked as `Local stock only`. It has impact on all orders with click-and-collect delivery method marked as `Pickup:Local stock only`

The affected versions: `>=3.14.56 <3.14.61`, `>=3.15.31 <3.15.37`, `>=3.16.27 <3.16.34`, `>=3.17.25 <3.17.32`, `>=3.18.19 <3.18.28`, `>=3.19.5 <3.19.15`

This issue has been patched in versions: `3.14.61`, `3.15.37`, `3.16.34`, `3.17.32`, `3.18.28`, `3.19.15`

### Workaround

We strongly recommend upgrading to the latest versions, in case of inability to upgrade straight away, possible workarounds are:

* turn off click-and-collect delivery method on warehouse view when `Pickup` option is set to `Local stock only`.
* cherry-pick the changes from PRs: [#15694](https://github.com/saleor/saleor/pull/15694) & [#15697](https://github.com/saleor/saleor/pull/15697)

### References

* Commits introducing the issue ([22a1aa3](https://github.com/saleor/saleor/commit/22a1aa3ef0bc54156405f69146788016a7f3f761) main, [997f7ea](https://github.com/saleor/saleor/commit/997f7ea4f576543ec88679a86bfe1b14f7f2ff26) 3.14, [ef003c7](https://github.com/saleor/saleor/commit/ef003c76a304c89ddb2dc65b7f1d5b3b2ba1c640) 3.15, [39abb0f](https://github.com/saleor/saleor/commit/39abb0f4e4fe6503f81bfbb871227e4f70bcdd5c) 3.16, [b7cecda](https://github.com/saleor/saleor/commit/b7cecda8b603f7472790150bb4508c7b655946d4) 3.17, [dccc2c8](https://github.com/saleor/saleor/commit/dccc2c842b4e2e09470929c80f07dc137e439182) 3.18, [d8ba545](https://github.com/saleor/saleor/commit/d8ba545c16ad3153febc5b5be8fd2ef75da9fc95) 3.19)
* [47cedfd](https://github.com/saleor/saleor/commit/47cedfd7d6524d79bdb04708edcdbb235874de6b) (main branch)

  <https://github.com/saleor/saleor/releases/tag/3.14.60>

  <https://github.com/saleor/saleor/releases/tag/3.14.61>

  <https://github.com/saleor/saleor/releases/tag/3.15.36>

  <https://github.com/saleor/saleor/releases/tag/3.15.37>

  <https://github.com/saleor/saleor/releases/tag/3.16.33>

  <https://github.com/saleor/saleor/releases/tag/3.16.34>

  <https://github.com/saleor/saleor/releases/tag/3.17.31>

  <https://github.com/saleor/saleor/releases/tag/3.17.32>

  <https://github.com/saleor/saleor/releases/tag/3.18.27>

  <https://github.com/saleor/saleor/releases/tag/3.18.28>

  <https://github.com/saleor/saleor/releases/tag/3.19.14>

  <https://github.com/saleor/saleor/releases/tag/3.19.15>

### Severity

Moderate

4.2

# CVSS overall score

 This score calculates overall vulnerability severity from 0 to 10 and is based on the Common Vulnerability Scoring System (CVSS).

 / 10

#### CVSS v3 base metrics

Attack vector
Network

Attack complexity
High

Privileges required
None

User interaction
Required

Scope
Unchanged

Confidentiality
Low

Integrity
Low

Availability
None

Learn more about base metrics

# CVSS v3 base metrics

Attack vector:
More severe the more the remote (logically and physically) an attacker can be in order to exploit the vulnerability.

Attack complexity:
More severe for the least complex attacks.

Privileges required:
More severe if no privileges are required.

User interaction:
More severe when no user interaction is required.

Scope:
More severe when a scope change occurs, e.g. one vulnerable component impacts resources in components beyond its security scope.

Confidentiality:
More severe when loss of data confidentiality is highest, measuring the level of data access available to an unauthorized user.

Integrity:
More severe when loss of data integrity is the highest, measuring the consequence of data modification possible by an unauthorized user.

Availability:
More severe when the loss of impacted component availability is highest.

CVSS:3.1/AV:N/AC:H/PR:N/UI:R/S:U/C:L/I:L/A:N

### CVE ID

CVE-2024-29888

### Weaknesses

[CWE-359](/advisories?query=cwe%3A359)

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_2c992c91_20250110_155602.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15694)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15694)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fpull_requests_fragments%2Fpull_request_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

New issue

**Have a question about this project?** Sign up for a free GitHub account to open an issue and contact its maintainers and the community.

 [Sign up for GitHub](/signup?return_to=%2Fsaleor%2Fsaleor%2Fissues%2Fnew%2Fchoose)

By clicking “Sign up for GitHub”, you agree to our [terms of service](https://docs.github.com/terms) and
[privacy statement](https://docs.github.com/privacy). We’ll occasionally send you account related emails.

Already on GitHub?
[Sign in](/login?return_to=%2Fsaleor%2Fsaleor%2Fissues%2Fnew%2Fchoose)
to your account

[Jump to bottom](#issue-comment-box)

# Fix incorrect assigment of the shipping address #15694

 Merged

[zedzior](/zedzior)
merged 1 commit into
[main](/saleor/saleor/tree/main "saleor/saleor:main")
from
[fix-assgiment-of-shipping-address-for-c-and-c](/saleor/saleor/tree/fix-assgiment-of-shipping-address-for-c-and-c "saleor/saleor:fix-assgiment-of-shipping-address-for-c-and-c")

Mar 25, 2024

 Merged

# [Fix incorrect assigment of the shipping address](#top) #15694

[zedzior](/zedzior)
merged 1 commit into
[main](/saleor/saleor/tree/main "saleor/saleor:main")
from
[fix-assgiment-of-shipping-address-for-c-and-c](/saleor/saleor/tree/fix-assgiment-of-shipping-address-for-c-and-c "saleor/saleor:fix-assgiment-of-shipping-address-for-c-and-c")

Mar 25, 2024

[Conversation
2](/saleor/saleor/pull/15694)
[Commits
1](/saleor/saleor/pull/15694/commits)
[Checks
21](/saleor/saleor/pull/15694/checks)
[Files changed](/saleor/saleor/pull/15694/files)

## Conversation

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

[![korycins](https://avatars.githubusercontent.com/u/23282005?s=60&v=4)](/korycins)

Copy link

Member

### @korycins **[korycins](/korycins)** commented [Mar 25, 2024](#issue-2205783254) • edited Loading

I want to merge this change because it creates a copy of the address assigned to checkout.

Port of changes:[#15688](https://github.com/saleor/saleor/pull/15688)

# Impact

* New migrations
* New/Updated API fields or mutations
* Deprecated API fields or mutations
* Removed API types, fields, or mutations

# Docs

* Link to documentation:

# Pull Request Checklist

* Privileged queries and mutations are either absent or guarded by proper permission checks
* Database queries are optimized and the number of queries is constant
* Database migrations are either absent or optimized for zero downtime
* The changes are covered by test cases
* All new fields/inputs/mutations have proper labels added (`ADDED_IN_X`, `PREVIEW_FEATURE`, etc.)
* All migrations have proper dependencies
* All indexes are added concurrently in migrations
* All RunSql and RunPython migrations have revert option defined

Sorry, something went wrong.

All reactions

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&v=4)](/korycins)

`[Fix incorrect assigment of the shipping address](/saleor/saleor/pull/15694/commits/444cf47ce5cc9b683e8c20a0a85f620235749a6b "Fix incorrect assigment of the shipping address")`

`[444cf47](/saleor/saleor/pull/15694/commits/444cf47ce5cc9b683e8c20a0a85f620235749a6b)`

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
self-assigned this
[Mar 25, 2024](#event-12234783449)

[![@db-queries](https://avatars.githubusercontent.com/in/59286?s=80&v=4)](/apps/db-queries)

Copy link

### **[db-queries](/apps/db-queries) bot** commented [Mar 25, 2024](#issuecomment-2018072310)

| Here is the report for [444cf47](https://github.com/saleor/saleor/commit/444cf47ce5cc9b683e8c20a0a85f620235749a6b) (saleor:fix-assgiment-of-shipping-address-for-c-and-c) Base comparison is [a6693fd](https://github.com/saleor/saleor/commit/a6693fdc3b1773dc09ddc4dbaf96eed3eb3200e3).  **Found 1 differences!** (click me)   ``` # saleor.graphql.accountbenchmark account   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   addresses for federation query count                                    	          9	          9	              2   customers query                                                         	         51	         51	              0   delete staff members                                                    	         41	         41	              0   query staff user                                                        	         22	         22	              3   staff create                                                            	         23	         23	              3   staff update groups and permissions                                     	         36	         36	              5   users for federation query count                                        	          8	          8	              3  # saleor.graphql.accountbenchmark permission group   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   groups for federation query count                                       	          5	          5	              0   permission group create                                                 	         25	         25	              0   permission group delete                                                 	         30	         30	              3   permission group query                                                  	         14	         14	              0   permission group update                                                 	         44	         44	              2   permission group update remove users with manage staff                  	         36	         36	              3  # saleor.graphql.appbenchmarks app extensions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   app extensions                                                          	         25	         25	             10   app extensions with filter[filter0]                                     	         24	         24	             10   app extensions with filter[filter1]                                     	         12	         12	              2   app extensions with filter[filter2]                                     	         24	         24	             10   app extensions with filter[filter3]                                     	         12	         12	              2  # saleor.graphql.appbenchmarks apps   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   apps for federation query count                                         	          9	          9	              3   apps with tokens and webhooks                                           	          9	          9	              0  # saleor.graphql.attributebenchmark attribute   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   attribute translation                                                   	          6	          6	              0   attribute value translation                                             	         20	         20	              0   query attribute                                                         	          6	          6	              0   query attributes                                                        	          8	          8	              0  # saleor.graphql.channelbenchmark channel   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   channels query                                                          	          5	          5	              0  # saleor.graphql.channelmutations channel update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   channel update mutation remove warehouse                                	         38	         38	              6  # saleor.graphql.checkoutbenchmark checkout mutations   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   add billing address to checkout                                         	         75	         75	             10   add checkout lines                                                      	         80	         80	             12   add checkout lines gift discount applies                                	        142	        142	             21   add checkout lines order discount applies                               	        156	        156	             16   add checkout lines with external shipping                               	        183	        183	             74   add checkout lines with reservations                                    	        169	        169	             60 - add delivery to checkout                                                	         77	         78	             12   add shipping to checkout                                                	         88	         88	             15   checkout email update                                                   	         40	         40	              2   checkout payment charge                                                 	         56	         56	             16   checkout shipping address update                                        	         81	         81	              9   checkout voucher code                                                   	        100	        100	             16   complete checkout                                                       	        239	        239	             81   complete checkout preorder                                              	        237	        237	             82   complete checkout with digital line                                     	        280	        280	             95   complete checkout with out of stock webhook                             	        241	        241	             81   complete checkout with single line                                      	        241	        241	             81   create checkout                                                         	         81	         81	              8   create checkout with gift promotion                                     	        120	        120	             18   create checkout with order promotion                                    	        103	        103	              8   create checkout with reservations                                       	        147	        147	             26   customer complete checkout                                              	        252	        252	             87   customer complete checkout for cc                                       	        227	        227	             76   update checkout lines                                                   	         73	         73	             12   update checkout lines with reservations                                 	        175	        175	             71  # saleor.graphql.checkoutbenchmark checkouts   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   staff multiple checkouts                                                	          6	          6	              0  # saleor.graphql.checkoutbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   user checkout details                                                   	         59	         59	              5   user checkout details with tax app                                      	         81	         81	             27  # saleor.graphql.discountbenchmark promotion create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion create                                                        	         24	         24	              1   promotion create order promotion                                        	         38	         38	              7  # saleor.graphql.discountbenchmark promotion delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   gift promotion delete                                                   	         26	         26	              1   promotion delete                                                        	         28	         28	              1  # saleor.graphql.discountbenchmark promotion rule create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule create                                                   	         21	         21	              1   promotion rule create gift                                              	        135	        135	              7  # saleor.graphql.discountbenchmark promotion rule delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule delete                                                   	         24	         24	              0  # saleor.graphql.discountbenchmark promotion rule update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion rule update                                                   	         36	         36	              0  # saleor.graphql.discountbenchmark promotion update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotion update                                                        	         14	         14	              0  # saleor.graphql.discountbenchmark promotions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   promotions querytest promotions query                                   	          9	          9	              0  # saleor.graphql.discountbenchmark sales   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   sales query with channel slug                                           	          9	          9	              0   sales query without channel slug                                        	          7	          7	              0  # saleor.graphql.discountbenchmark voucher code bulk delete   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   voucher code bulk delete queries                                        	         22	         22	              2  # saleor.graphql.discountbenchmark vouchers   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   vouchers query with channel slug                                        	         20	         20	              0   vouchers query withot channel slug                                      	         19	         19	              0  # saleor.graphql.giftcardbenchmark gift card mutations   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   create never expiry gift card                                           	         26	         26	              4   gift card bulk activate by staff                                        	         16	         16	              3   update gift card                                                        	         36	         36	              4  # saleor.graphql.giftcardbenchmark gift card queries   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   filter gift cards by products                                           	         14	         14	              3   filter gift cards by tags                                               	         12	         12	              3   filter gift cards by used by user                                       	         13	         13	              3   query gift card details                                                 	         14	         14	              3   query gift cards                                                        	         12	         12	              3  # saleor.graphql.orderbenchmark fulfillment   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   fulfillment query                                                       	          6	          6	              0  # saleor.graphql.orderbenchmark fulfillment refund and return products   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   fulfillment refund products order lines                                 	         60	         60	              0   fulfillment return products order lines                                 	        102	        102	              7  # saleor.graphql.orderbenchmark order   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   staff multiple draft orders                                             	          7	          7	              0   staff multiple orders                                                   	          7	          7	              0   staff order details                                                     	         56	         56	              7   user order details                                                      	         54	         54	              8  # saleor.graphql.orderbenchmark order bulk create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order bulk create                                                       	         21	         21	              2  # saleor.graphql.orderbenchmark order fulfill   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order fulfill                                                           	         19	         19	              0   order fulfill with gift cards                                           	         19	         19	              0  # saleor.graphql.orderbenchmark order lines create   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   order lines create                                                      	         94	         94	             17   order lines create variants on promotion                                	        153	        153	             22  # saleor.graphql.pagebenchmark page type   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   page types for federation query count                                   	          3	          3	              0   query page type                                                         	         18	         18	              6   query page types                                                        	         25	         25	             12  # saleor.graphql.paymentbenchmark payment transactions   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   payment transactions                                                    	         54	         54	             20  # saleor.graphql.productbenchmark category   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   categories children                                                     	          3	          3	              0   categories for federation query count                                   	          3	          3	              0   category delete                                                         	         49	         49	              4   category view                                                           	         33	         33	              4  # saleor.graphql.productbenchmark collection   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   collection add products                                                 	         21	         21	              5   collection bulk delete                                                  	         28	         28	              3   collection view                                                         	         11	         11	              3   collections for federation query count                                  	          6	          6	              0   create collection                                                       	         37	         37	              5   delete collection                                                       	         40	         40	              5   remove products from collection                                         	         18	         18	              5   retrieve collection channel listings                                    	          5	          5	              0  # saleor.graphql.productbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   report product sales                                                    	         10	         10	              3   retrieve product list                                                   	          4	          4	              0  # saleor.graphql.productbenchmark product   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   filter products by attributes                                           	         10	         10	              1   filter products by boolean attributes                                   	         17	         17	              1   filter products by gift card                                            	         14	         14	              2   filter products by numeric attributes                                   	         16	         16	              1   product create                                                          	         53	         53	              3   product details                                                         	         46	         46	              4   product translations                                                    	          8	          8	              1   products for federation query count                                     	         12	         12	              4   products media for federation query count                               	          5	          5	              0   products types for federation query count                               	          2	          2	              0   retrieve channel listings                                               	         20	         20	              0   retrieve product attributes                                             	         11	         11	              1   retrieve product images                                                 	          7	          7	              1   retrieve product media                                                  	          7	          7	              1   retrive products with product types and attributes                      	         10	         10	              1   update product                                                          	         74	         74	              5  # saleor.graphql.productbenchmark product variant channel listing update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   variant channel listing update                                          	         33	         33	              3  # saleor.graphql.productbenchmark variant   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   product variant bulk create                                             	         46	         46	              1   product variant create                                                  	         60	         60	              3   products variants for federation query count                            	         10	         10	              3   retrieve variant list                                                   	         37	         37	              2   update product variant                                                  	         61	         61	              7  # saleor.graphql.productbenchmark variant stocks   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   product variants stocks create                                          	         29	         29	              4   product variants stocks create with single webhook called               	         28	         28	              4   product variants stocks delete by id                                    	         30	         30	              4   product variants stocks delete by sku                                   	         30	         30	              4   product variants stocks delete with out of stock webhook many calls     	         26	         26	              3   product variants stocks update by sku                                   	         28	         28	              4   product variants stocks update byid                                     	         28	         28	              4   query product variants stocks                                           	         10	         10	              0  # saleor.graphql.producttest product sorting attributes   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   sort product not having attribute data                                  	         20	         20	              0  # saleor.graphql.shippingbenchmark shipping methods   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   vouchers query with channel slug                                        	          7	          7	              0   vouchers query without channel slug                                     	          7	          7	              0  # saleor.graphql.shippingbenchmark shipping zones   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   shipping zones query                                                    	          6	          6	              0  # saleor.graphql.shopbenchmark homepage   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   retrieve shop                                                           	          2	          2	              0  # saleor.graphql.warehousebenchmark stock bulk update   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   stocks bulk update queries count                                        	         33	         33	              5  # saleor.graphql.warehousebenchmark stocks   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   stocks query                                                            	          5	          5	              0  # saleor.graphql.webhookbenchmark webhook events   test name                                                               	left count 	right count	duplicate count   ------------------------------------------------------------------------	-----------	-----------	---------------   webhooks                                                                	          6	          6	              0  ``` |
| --- |

All reactions

Sorry, something went wrong.

[![@codecov](https://avatars.githubusercontent.com/in/254?s=80&v=4)](/apps/codecov)
[![Codecov](https://avatars.githubusercontent.com/in/254?s=40&u=c392dd7c2afc51fe2347d4296afa8494ac05772e&v=4)](https://github.com/apps/codecov)

Copy link

### **[codecov](/apps/codecov) bot** commented [Mar 25, 2024](#issuecomment-2018074112)

| [Codecov](https://app.codecov.io/gh/saleor/saleor/pull/15694?dropdown=coverage&src=pr&el=h1&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor) Report All modified and coverable lines are covered by tests ✅  Project coverage is 93.93%. Comparing base [(`a6693fd`)](https://app.codecov.io/gh/saleor/saleor/commit/a6693fdc3b1773dc09ddc4dbaf96eed3eb3200e3?dropdown=coverage&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor) to head [(`444cf47`)](https://app.codecov.io/gh/saleor/saleor/pull/15694?dropdown=coverage&src=pr&el=desc&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). Additional details and impacted files ``` @@           Coverage Diff           @@ ##             main   #15694   +/-   ## =======================================   Coverage   93.93%   93.93%            =======================================   Files         932      932              Lines       71629    71629              Branches     8404     8404            =======================================   Hits        67288    67288              Misses       2785     2785              Partials     1556     1556            ```   [☔ View full report in Codecov by Sentry](https://app.codecov.io/gh/saleor/saleor/pull/15694?dropdown=coverage&src=pr&el=continue&utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). 📢 Have feedback on the report? [Share it here](https://about.codecov.io/codecov-pr-comment-feedback/?utm_medium=referral&utm_source=github&utm_content=comment&utm_campaign=pr+comments&utm_term=saleor). |
| --- |

All reactions

Sorry, something went wrong.

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
added
the
[skip changelog](/saleor/saleor/labels/skip%20changelog)
label
[Mar 25, 2024](#event-12235770358)

 [![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
marked this pull request as ready for review
[March 25, 2024 14:40](#event-12235771096)

 [![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)
[korycins](/korycins)
requested a review
from a team
[March 25, 2024 14:41](#event-12235773486)

[![Air-t](https://avatars.githubusercontent.com/u/31221055?s=60&v=4)](/Air-t)

**[Air-t](/Air-t)**
approved these changes
[Mar 25, 2024](#pullrequestreview-1957967177)

 [View reviewed changes](/saleor/saleor/pull/15694/files/444cf47ce5cc9b683e8c20a0a85f620235749a6b)

 [![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)
[Air-t](/Air-t)
requested a review
from a team
[March 25, 2024 14:53](#event-12235957180)

[![8r2y5](https://avatars.githubusercontent.com/u/5288384?s=60&v=4)](/8r2y5)

**[8r2y5](/8r2y5)**
approved these changes
[Mar 25, 2024](#pullrequestreview-1957971788)

 [View reviewed changes](/saleor/saleor/pull/15694/files/444cf47ce5cc9b683e8c20a0a85f620235749a6b)

 [![@8r2y5](https://avatars.githubusercontent.com/u/5288384?s=40&u=71d57c143fa85f690269c3aa44ff00ceb0326f06&v=4)](/8r2y5)
[8r2y5](/8r2y5)
requested a review
from a team
[March 25, 2024 14:54](#event-12235977432)

[![@8r2y5](https://avatars.githubusercontent.com/u/5288384?s=40&u=71d57c143fa85f690269c3aa44ff00ceb0326f06&v=4)](/8r2y5)
[8r2y5](/8r2y5)
added
the
[main](/saleor/saleor/labels/main)
label
[Mar 25, 2024](#event-12235978770)

[![fowczarek](https://avatars.githubusercontent.com/u/43955230?s=60&v=4)](/fowczarek)

**[fowczarek](/fowczarek)**
approved these changes
[Mar 25, 2024](#pullrequestreview-1957999061)

 [View reviewed changes](/saleor/saleor/pull/15694/files/444cf47ce5cc9b683e8c20a0a85f620235749a6b)

 Hide details
View details

[![@zedzior](https://avatars.githubusercontent.com/u/55899043?s=40&u=6254e62a19ab3985faaa9924ad0545c128d15661&v=4)](/zedzior)
[zedzior](/zedzior)
merged commit [`e0db9b3`](/saleor/saleor/commit/e0db9b3ddb9ae603252f76bda29d5a27f27043cb)
into
main

[Mar 25, 2024](https://github.com/saleor/saleor/pull/15694#event-12237280134)
18 of 19 checks passed

 [![@zedzior](https://avatars.githubusercontent.com/u/55899043?s=40&u=6254e62a19ab3985faaa9924ad0545c128d15661&v=4)](/zedzior)
[zedzior](/zedzior)
deleted the
fix-assgiment-of-shipping-address-for-c-and-c

branch
[March 25, 2024 16:23](#event-12237280270)

[korycins](/korycins)
added a commit
that referenced
this pull request
[Apr 15, 2024](#ref-commit-fb7a0e5)
[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&u=27daa171a0d24b7c3fdc79bf78bd1bf5e407f75a&v=4)](/korycins)

`[Fix incorrect assigment of the shipping address (](/saleor/saleor/commit/fb7a0e5e1991deb9ff815cd3883c04240a691a96 "Fix incorrect assigment of the shipping address (#15694)")[#15694](https://github.com/saleor/saleor/pull/15694)[)](/saleor/saleor/commit/fb7a0e5e1991deb9ff815cd3883c04240a691a96 "Fix incorrect assigment of the shipping address (#15694)")`

`[fb7a0e5](/saleor/saleor/commit/fb7a0e5e1991deb9ff815cd3883c04240a691a96)`

[Sign up for free](/join?source=comment-repo)
**to join this conversation on GitHub**.
Already have an account?
[Sign in to comment](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fpull%2F15694)

Reviewers

[![@fowczarek](https://avatars.githubusercontent.com/u/43955230?s=40&v=4)](/fowczarek) [fowczarek](/fowczarek)

fowczarek approved these changes

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t) [Air-t](/Air-t)

Air-t approved these changes

[![@8r2y5](https://avatars.githubusercontent.com/u/5288384?s=40&v=4)](/8r2y5) [8r2y5](/8r2y5)

8r2y5 approved these changes

Assignees

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=40&v=4)](/korycins) [korycins](/korycins)

Labels

[main](/saleor/saleor/labels/main)
[skip changelog](/saleor/saleor/labels/skip%20changelog)

Projects

None yet

Milestone

No milestone

Development

Successfully merging this pull request may close these issues.

5 participants

[![@korycins](https://avatars.githubusercontent.com/u/23282005?s=52&v=4)](/korycins) [![@8r2y5](https://avatars.githubusercontent.com/u/5288384?s=52&v=4)](/8r2y5) [![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=52&v=4)](/Air-t) [![@fowczarek](https://avatars.githubusercontent.com/u/43955230?s=52&v=4)](/fowczarek) [![@zedzior](https://avatars.githubusercontent.com/u/55899043?s=52&v=4)](/zedzior)

Add this suggestion to a batch that can be applied as a single commit.
This suggestion is invalid because no changes were made to the code.
Suggestions cannot be applied while the pull request is closed.
Suggestions cannot be applied while viewing a subset of changes.
Only one suggestion per line can be applied in a batch.
Add this suggestion to a batch that can be applied as a single commit.
Applying suggestions on deleted lines is not supported.
You must change the existing code in this line in order to create a valid suggestion.
Outdated suggestions cannot be applied.
This suggestion has been applied or marked resolved.
Suggestions cannot be applied from pending reviews.
Suggestions cannot be applied on multi-line comments.
Suggestions cannot be applied while the pull request is queued to merge.
Suggestion cannot be applied right now. Please check back later.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.



=== Content from github.com_1c623e17_20250110_155555.html ===

[Skip to content](#start-of-content)

## Navigation Menu

Toggle navigation

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F22a1aa3ef0bc54156405f69146788016a7f3f761)

* Product

  + [GitHub Copilot
    Write better code with AI](https://github.com/features/copilot)
  + [Security
    Find and fix vulnerabilities](https://github.com/features/security)
  + [Actions
    Automate any workflow](https://github.com/features/actions)
  + [Codespaces
    Instant dev environments](https://github.com/features/codespaces)
  + [Issues
    Plan and track work](https://github.com/features/issues)
  + [Code Review
    Manage code changes](https://github.com/features/code-review)
  + [Discussions
    Collaborate outside of code](https://github.com/features/discussions)
  + [Code Search
    Find more, search less](https://github.com/features/code-search)

  Explore
  + [All features](https://github.com/features)
  + [Documentation](https://docs.github.com)
  + [GitHub Skills](https://skills.github.com)
  + [Blog](https://github.blog)
* Solutions

  By company size
  + [Enterprises](https://github.com/enterprise)
  + [Small and medium teams](https://github.com/team)
  + [Startups](https://github.com/enterprise/startups)
  By use case
  + [DevSecOps](/solutions/use-case/devsecops)
  + [DevOps](/solutions/use-case/devops)
  + [CI/CD](/solutions/use-case/ci-cd)
  + [View all use cases](/solutions/use-case)

  By industry
  + [Healthcare](/solutions/industry/healthcare)
  + [Financial services](/solutions/industry/financial-services)
  + [Manufacturing](/solutions/industry/manufacturing)
  + [Government](/solutions/industry/government)
  + [View all industries](/solutions/industry)

  [View all solutions](/solutions)
* Resources

  Topics
  + [AI](/resources/articles/ai)
  + [DevOps](/resources/articles/devops)
  + [Security](/resources/articles/security)
  + [Software Development](/resources/articles/software-development)
  + [View all](/resources/articles)

  Explore
  + [Learning Pathways](https://resources.github.com/learn/pathways)
  + [White papers, Ebooks, Webinars](https://resources.github.com)
  + [Customer Stories](https://github.com/customer-stories)
  + [Partners](https://partner.github.com)
  + [Executive Insights](https://github.com/solutions/executive-insights)
* Open Source

  + [GitHub Sponsors
    Fund open source developers](/sponsors)
  + [The ReadME Project
    GitHub community articles](https://github.com/readme)
  Repositories
  + [Topics](https://github.com/topics)
  + [Trending](https://github.com/trending)
  + [Collections](https://github.com/collections)
* Enterprise

  + [Enterprise platform
    AI-powered developer platform](/enterprise)
  Available add-ons
  + [Advanced Security
    Enterprise-grade security features](https://github.com/enterprise/advanced-security)
  + [GitHub Copilot
    Enterprise-grade AI features](/features/copilot#enterprise)
  + [Premium Support
    Enterprise-grade 24/7 support](/premium-support)
* [Pricing](https://github.com/pricing)

Search or jump to...

# Search code, repositories, users, issues, pull requests...

Search

Clear

[Search syntax tips](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax)

# Provide feedback

We read every piece of feedback, and take your input very seriously.

Include my email address so I can be contacted

  Cancel

 Submit feedback

# Saved searches

## Use saved searches to filter your results more quickly

Name

Query

To see all available qualifiers, see our [documentation](https://docs.github.com/search-github/github-code-search/understanding-github-code-search-syntax).

  Cancel

 Create saved search

[Sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F22a1aa3ef0bc54156405f69146788016a7f3f761)

[Sign up](/signup?ref_cta=Sign+up&ref_loc=header+logged+out&ref_page=%2F%3Cuser-name%3E%2F%3Crepo-name%3E%2Fvoltron%2Fcommit_fragments%2Frepo_layout&source=header-repo&source_repo=saleor%2Fsaleor)
Reseting focus

You signed in with another tab or window. Reload to refresh your session.
You signed out in another tab or window. Reload to refresh your session.
You switched accounts on another tab or window. Reload to refresh your session.

Dismiss alert

{{ message }}

[saleor](/saleor)
/
**[saleor](/saleor/saleor)**
Public

* [Notifications](/login?return_to=%2Fsaleor%2Fsaleor) You must be signed in to change notification settings
* [Fork
  5.5k](/login?return_to=%2Fsaleor%2Fsaleor)
* [Star
   21k](/login?return_to=%2Fsaleor%2Fsaleor)

* [Code](/saleor/saleor)
* [Issues
  295](/saleor/saleor/issues)
* [Pull requests
  35](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects
  1](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

Additional navigation options

* [Code](/saleor/saleor)
* [Issues](/saleor/saleor/issues)
* [Pull requests](/saleor/saleor/pulls)
* [Discussions](/saleor/saleor/discussions)
* [Actions](/saleor/saleor/actions)
* [Projects](/saleor/saleor/projects)
* [Security](/saleor/saleor/security)
* [Insights](/saleor/saleor/pulse)

## Commit

[Permalink](/saleor/saleor/commit/22a1aa3ef0bc54156405f69146788016a7f3f761)

This commit does not belong to any branch on this repository, and may belong to a fork outside of the repository.

Fix tax calculation for Click and Collect option. ([#15505](https://github.com/saleor/saleor/pull/15505))

[Browse files](/saleor/saleor/tree/22a1aa3ef0bc54156405f69146788016a7f3f761)
Browse the repository at this point in the history

* Loading branch information

[![@Air-t](https://avatars.githubusercontent.com/u/31221055?s=40&v=4)](/Air-t)

[Air-t](/saleor/saleor/commits?author=Air-t "View all commits by Air-t")
authored
Mar 1, 2024

1 parent
[1373efe](/saleor/saleor/commit/1373efea8f0469937ad30fe53a7046fe86b2a67c)

commit 22a1aa3

 Show file tree

 Hide file tree

Showing
**7 changed files**
with
**310 additions**
and
**42 deletions**.

* Whitespace
* Ignore whitespace

* Split
* Unified

* saleor

  + checkout

    - saleor/checkout/error\_codes.py
      [error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8)
  + graphql

    - checkout

      * mutations

        + saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py
          [checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062)
        + saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py
          [checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78)
        + saleor/graphql/checkout/mutations/utils.py
          [utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb)
      * tests/mutations

        + saleor/graphql/checkout/tests/mutations/test\_checkout\_delivery\_method\_update.py
          [test\_checkout\_delivery\_method\_update.py](#diff-1d23854831880d0349798f732d537bec61ed664a998dffc6573d73cb21efad5b)
        + saleor/graphql/checkout/tests/mutations/test\_checkout\_shipping\_address\_update.py
          [test\_checkout\_shipping\_address\_update.py](#diff-96b9581180434104e887687e0541d935c8c35e16478beca7355a8a1eafc36c5d)
    - saleor/graphql/schema.graphql
      [schema.graphql](#diff-0de7d822ed8c0bc0dc7b823b647b689cad8ce15c8e9b5784b6c89a5b9fc16236)

## There are no files selected for viewing

1 change: 1 addition & 0 deletions

1
[saleor/checkout/error\_codes.py](#diff-b6b05dbcad146b4d415e8d9ea6fb6676388d591ea6c9556e4c47d3adb14ee6a8 "saleor/checkout/error_codes.py")

Show comments

[View file](/saleor/saleor/blob/22a1aa3ef0bc54156405f69146788016a7f3f761/saleor/checkout/error_codes.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -32,6 +32,7 @@ class CheckoutErrorCode(Enum): |
|  |  | INACTIVE\_PAYMENT = "inactive\_payment" |
|  |  | NON\_EDITABLE\_GIFT\_LINE = "non\_editable\_gift\_line" |
|  |  | NON\_REMOVABLE\_GIFT\_LINE = "non\_removable\_gift\_line" |
|  |  | SHIPPING\_CHANGE\_FORBIDDEN = "shipping\_change\_forbidden" |
|  |  |  |
|  |  |  |
|  |  | class OrderCreateFromCheckoutErrorCode(Enum): |
| Expand Down | |  |

21 changes: 14 additions & 7 deletions

21
[saleor/graphql/checkout/mutations/checkout\_delivery\_method\_update.py](#diff-fc1ca0557e98b2fab028e76bf8027e3205b4715265f8b78a5f9437f8ebaca062 "saleor/graphql/checkout/mutations/checkout_delivery_method_update.py")

Show comments

[View file](/saleor/saleor/blob/22a1aa3ef0bc54156405f69146788016a7f3f761/saleor/graphql/checkout/mutations/checkout_delivery_method_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -21,6 +21,7 @@ |
|  |  | from ....shipping import interface as shipping\_interface |
|  |  | from ....shipping import models as shipping\_models |
|  |  | from ....shipping.utils import convert\_to\_shipping\_method\_data |
|  |  | from ....warehouse import WarehouseClickAndCollectOption |
|  |  | from ....warehouse import models as warehouse\_models |
|  |  | from ....webhook.const import APP\_ID\_PREFIX |
|  |  | from ....webhook.event\_types import WebhookEventAsyncType, WebhookEventSyncType |
| Expand Down  Expand Up | | @@ -59,7 +60,9 @@ class Arguments: |
|  |  | class Meta: |
|  |  | description = ( |
|  |  | "Updates the delivery method (shipping method or pick up point) " |
|  |  | "of the checkout." + ADDED\_IN\_31 |
|  |  | "of the checkout. " |
|  |  | "Updates the checkout shipping\_address for click and collect delivery " |
|  |  | "for a warehouse address. " + ADDED\_IN\_31 |
|  |  | ) |
|  |  | doc\_category = DOC\_CATEGORY\_CHECKOUT |
|  |  | error\_type\_class = CheckoutError |
| Expand Down  Expand Up | | @@ -238,6 +241,7 @@ def \_update\_delivery\_method( |
|  |  | external\_shipping\_method: Optional[shipping\_interface.ShippingMethodData], |
|  |  | collection\_point: Optional[Warehouse], |
|  |  | ) -> None: |
|  |  | checkout\_fields\_to\_update = ["shipping\_method", "collection\_point"] |
|  |  | checkout = checkout\_info.checkout |
|  |  | if external\_shipping\_method: |
|  |  | set\_external\_shipping\_id( |
| Expand All | | @@ -247,15 +251,19 @@ def \_update\_delivery\_method( |
|  |  | delete\_external\_shipping\_id(checkout=checkout) |
|  |  | checkout.shipping\_method = shipping\_method |
|  |  | checkout.collection\_point = collection\_point |
|  |  | if ( |
|  |  | collection\_point is not None |
|  |  | and collection\_point.click\_and\_collect\_option |
|  |  | == WarehouseClickAndCollectOption.LOCAL\_STOCK |
|  |  | ): |
|  |  | checkout.shipping\_address = collection\_point.address |
|  |  | checkout\_info.shipping\_address = collection\_point.address |
|  |  | checkout\_fields\_to\_update += ["shipping\_address"] |
|  |  | invalidate\_prices\_updated\_fields = invalidate\_checkout( |
|  |  | checkout\_info, lines, manager, save=False |
|  |  | ) |
|  |  | checkout.save( |
|  |  | update\_fields=[ |
|  |  | "shipping\_method", |
|  |  | "collection\_point", |
|  |  | ] |
|  |  | + invalidate\_prices\_updated\_fields |
|  |  | update\_fields=checkout\_fields\_to\_update + invalidate\_prices\_updated\_fields |
|  |  | ) |
|  |  | get\_or\_create\_checkout\_metadata(checkout).save() |
|  |  | cls.call\_event(manager.checkout\_updated, checkout) |
| Expand Down  Expand Up | | @@ -324,7 +332,6 @@ def perform\_mutation( |
|  |  | } |
|  |  | ) |
|  |  | type\_name = cls.\_resolve\_delivery\_method\_type(delivery\_method\_id) |
|  |  |  |
|  |  | checkout\_info = fetch\_checkout\_info(checkout, lines, manager) |
|  |  | if type\_name == "Warehouse": |
|  |  | return cls.perform\_on\_collection\_point( |
| Expand Down | |  |

11 changes: 11 additions & 0 deletions

11
[saleor/graphql/checkout/mutations/checkout\_shipping\_address\_update.py](#diff-d566232a3ecdaa68e36f0d88dcb99468a3b48ba64a5ea7cf9b3228a99335cd78 "saleor/graphql/checkout/mutations/checkout_shipping_address_update.py")

Show comments

[View file](/saleor/saleor/blob/22a1aa3ef0bc54156405f69146788016a7f3f761/saleor/graphql/checkout/mutations/checkout_shipping_address_update.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -33,6 +33,7 @@ |
|  |  | from ..types import Checkout |
|  |  | from .checkout\_create import CheckoutAddressValidationRules |
|  |  | from .utils import ( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | ERROR\_DOES\_NOT\_SHIP, |
|  |  | check\_lines\_quantity, |
|  |  | get\_checkout, |
| Expand Down  Expand Up | | @@ -153,6 +154,16 @@ def perform\_mutation( |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | # prevent from changing the shipping address when click and collect is used. |
|  |  | if checkout.collection\_point\_id: |
|  |  | raise ValidationError( |
|  |  | { |
|  |  | "shipping\_address": ValidationError( |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN, |
|  |  | code=CheckoutErrorCode.SHIPPING\_CHANGE\_FORBIDDEN.value, |
|  |  | ) |
|  |  | } |
|  |  | ) |
|  |  | address\_validation\_rules = validation\_rules or {} |
|  |  | shipping\_address\_instance = cls.validate\_address( |
|  |  | shipping\_address, |
| Expand Down | |  |

4 changes: 4 additions & 0 deletions

4
[saleor/graphql/checkout/mutations/utils.py](#diff-df51b1fe10bd3e3ceb77b16b763c9da977a1e92555d28868c1ca98d03578c7fb "saleor/graphql/checkout/mutations/utils.py")

Show comments

[View file](/saleor/saleor/blob/22a1aa3ef0bc54156405f69146788016a7f3f761/saleor/graphql/checkout/mutations/utils.py)
Edit file

Delete file

This file contains bidirectional Unicode text that may be interpreted or compiled differently than what appears below. To review, open the file in an editor that reveals hidden Unicode characters.
[Learn more about bidirectional Unicode characters](https://github.co/hiddenchars)

  [Show hidden characters](%7B%7B%20revealButtonHref%20%7D%7D)

| Original file line number | Diff line number | Diff line change |
| --- | --- | --- |
| Expand Up | | @@ -46,6 +46,10 @@ |
|  |  |  |
|  |  |  |
|  |  | ERROR\_DOES\_NOT\_SHIP = "This checkout doesn't need shipping" |
|  |  | ERROR\_CC\_ADDRESS\_CHANGE\_FORBIDDEN = ( |
|  |  | "Can't change shipping address manually. " |
|  |  | "For click and collect delivery, address is set to a warehouse address." |
|  |  | ) |
|  |  |  |
|  |  |  |
|  |  | @dataclass |
| Expand Down | |  |

 Loading

Oops, something went wrong.
 Retry

Toggle all file notes
Toggle all file annotations

### 0 comments on commit `22a1aa3`

Please
[sign in](/login?return_to=https%3A%2F%2Fgithub.com%2Fsaleor%2Fsaleor%2Fcommit%2F22a1aa3ef0bc54156405f69146788016a7f3f761) to comment.

## Footer

© 2025 GitHub, Inc.

### Footer navigation

* [Terms](https://docs.github.com/site-policy/github-terms/github-terms-of-service)
* [Privacy](https://docs.github.com/site-policy/privacy-policies/github-privacy-statement)
* [Security](https://github.com/security)
* [Status](https://www.githubstatus.com/)
* [Docs](https://docs.github.com/)
* [Contact](https://support.github.com?tags=dotcom-footer)
* Manage cookies
* Do not share my personal information

You can’t perform that action at this time.


