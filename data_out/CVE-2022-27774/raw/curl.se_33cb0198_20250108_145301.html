<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN" "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head> <title>curl - Credential leak on redirect - CVE-2022-27774</title>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta content="text/html; charset=UTF-8" http-equiv="Content-Type">
<link rel="stylesheet" type="text/css" href="/curl.css">
<link rel="shortcut icon" href="/favicon.ico">
<link rel="icon" href="/logo/curl-symbol.svg" type="image/svg+xml">
<link rel="alternate" type="application/rss+xml" title="cURL Releases" href="https://github.com/curl/curl/releases.atom">
<link rel="stylesheet" type="text/css" href="/manpage.css">
<style>
code {
    padding: 0px 4px 0px 4px;
    background-color: #f0f0f0;
}
 (prefers-color-scheme: dark) {
    code {
        padding: 0px 4px 0px 4px;
        background-color: #101010;
    }
}
</style>
</head>
<body>
<div class="main">
<div class="menu">
<a href="/docs/" class="menuitem" title="Documentation Overview">Docs Overview</a>
<div class="dropdown">
  <a class="dropbtn" href="/docs/projdocs.html">Project</a>
  <div class="dropdown-content">
    <a href="/docs/bugbounty.html">Bug Bounty</a>
    <a href="/docs/bugs.html">Bug Report</a>
    <a href="/docs/code-of-conduct.html">Code of conduct</a>
    <a href="/docs/libs.html">Dependencies</a>
    <a href="/donation.html">Donate</a>
    <a href="/docs/faq.html">FAQ</a>
    <a href="/docs/features.html">Features</a>
    <a href="/docs/governance.html">Governance</a>
    <a href="/docs/history.html">History</a>
    <a href="/docs/install.html">Install</a>
    <a href="/docs/knownbugs.html">Known Bugs</a>
    <a href="/logo/">Logo</a>
    <a href="/docs/todo.html">TODO</a>
    <a href="/about.html">website Info</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/protdocs.html">Protocols</a>
  <div class="dropdown-content">
    <a href="/docs/caextract.html">CA Extract</a>
    <a href="/docs/http-cookies.html">HTTP cookies</a>
    <a href="/docs/http3.html">HTTP/3</a>
    <a href="/docs/mqtt.html">MQTT</a>
    <a href="/docs/sslcerts.html">SSL certs</a>
    <a href="/docs/ssl-compared.html">SSL libs compared</a>
    <a href="/docs/url-syntax.html">URL syntax</a>
    <a href="/docs/websocket.html">WebSocket</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/reldocs.html">Releases</a>
  <div class="dropdown-content">
    <a href="/ch/">Changelog</a>
    <a href="/docs/security.html">curl CVEs</a>
    <a href="/docs/releases.html">Release Table</a>
    <a href="/docs/versions.html">Version Numbering</a>
    <a href="/docs/vulnerabilities.html">Vulnerabilities</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/tooldocs.html">Tool</a>
  <div class="dropdown-content">
    <a href="/docs/comparison-table.html">Comparison Table</a>
    <a href="/docs/manpage.html">curl man page</a>
    <a href="/docs/httpscripting.html">HTTP Scripting</a>
    <a href="/docs/mk-ca-bundle.html">mk-ca-bundle</a>
    <a href="/docs/tutorial.html">Tutorial</a>
    <a href="optionswhen.html">When options were added</a>
  </div>
</div>
<div class="dropdown">
  <a class="dropbtn" href="/docs/whodocs.html">Who and Why</a>
  <div class="dropdown-content">
    <a href="/docs/companies.html">Companies</a>
    <a href="/docs/copyright.html">Copyright</a>
    <a href="/sponsors.html">Sponsors</a>
    <a href="/docs/thanks.html">Thanks</a>
    <a href="/docs/thename.html">The name</a>
  </div>
</div>
</div>
<div class="contents">
<div class="where"><a href="/">curl</a> / <a href="/docs/">Docs</a> / <a href="/docs/security.html">curl CVEs</a> / <b>Credential leak on redirect</b></div>
<div class="relatedbox">
<b>Related:</b>
<br><a href="audits.html">Audits</a>
<br><a href="/docs/bugbounty.html">Bug Bounty</a>
<br><a href="/ch/">Changelog</a>
<br><a href="security.html">curl CVEs</a>
<br><a href="CVE-2022-27774.json">JSON metadata</a>
<br><a href="https://hackerone.com/reports/1543773">Original report</a>
<br><a href="/dev/vuln-disclosure.html">Vulnerability Disclosure</a>
<br><a href="vulnerabilities.html">Vulnerabilities Table</a>
</div>
<div class="relatedbox">
Awarded 2400 USD<br>
</div>
<h2>CVE-2022-27774</h2>
<h1 id="credential-leak-on-redirect">Credential leak on redirect</h1>
<p>Project curl Security Advisory, April 27th 2022 - <a
href="/docs/CVE-2022-27774.html">Permalink</a></p>
<h2 id="vulnerability">VULNERABILITY</h2>
<p>curl follows HTTP(S) redirects when asked to. curl also supports
authentication. When a user and password are provided for a URL with a
given hostname, curl makes an effort to not pass on those credentials to
other hosts in redirects unless given permission with a special
option.</p>
<p>This "same host check" has been flawed all since it was introduced.
It does not work on cross protocol redirects and it does not consider
different port numbers to be separate hosts. This leads to curl leaking
credentials to other servers when it follows redirects from auth
protected HTTP(S) URLs to other protocols and port numbers. It could
also leak the TLS SRP credentials this way.</p>
<p>By default, curl only allows redirects to HTTP(S) and FTP(S), but can
be asked to allow redirects to all protocols curl supports.</p>
<h2 id="info">INFO</h2>
<p>This flaw was added in curl 4.9 with the introduction of
<code>--location</code> and has been present in all libcurl versions
ever released. In July 2000 in the curl <a href="vuln-7.1.1.html">7.1.1</a> release, <a
href="https://github.com/curl/curl/commit/29eda80f9669f">this commit</a>
was the first version that attempted to avoid this, but the check has
been bad since then.</p>
<p>The Common Vulnerabilities and Exposures (CVE) project has assigned
the name CVE-2022-27774 to this issue.</p>
<p>CWE-522: Insufficiently Protected Credentials</p>
<p>Severity: Medium</p>
<h2 id="affected-versions">AFFECTED VERSIONS</h2>
<ul>
<li>Affected versions: curl 4.9 to and including <a href="vuln-7.82.0.html">7.82.0</a></li>
<li>Not affected versions: curl &lt; 4.9 and curl &gt;= <a href="vuln-7.83.0.html">7.83.0</a></li>
<li>Introduced-in: <a
href="https://github.com/curl/curl/commit/ae1912cb0d494b4">https://github.com/curl/curl/commit/ae1912cb0d494b4</a></li>
</ul>
<p>Note that libcurl is used by many applications, but not always
advertised as such.</p>
<h2 id="solution">SOLUTION</h2>
<p>There are two separate patches to apply for CVE-2022-27774: <a
href="https://github.com/curl/curl/commit/620ea21410030a997">the main
one</a> and <a
href="https://github.com/curl/curl/commit/139a54ed0a172ada">the SRP
follow-up</a>.</p>
<ul>
<li>Fixed-in: <a
href="https://github.com/curl/curl/commit/139a54ed0a172ada">https://github.com/curl/curl/commit/139a54ed0a172ada</a></li>
</ul>
<h2 id="recommendations">RECOMMENDATIONS</h2>
<p>We suggest you take one of the following actions immediately, in
order of preference:</p>
<p>A - Upgrade curl and libcurl to version <a href="vuln-7.83.0.html">7.83.0</a></p>
<p>B - Apply the patches to your version and rebuild</p>
<p>C - Switch off curl's automatic redirect following</p>
<h2 id="timeline">TIMELINE</h2>
<p>It was first reported to the curl project on April 18 2022. We
contacted distros@openwall on April 19.</p>
<p>libcurl <a href="vuln-7.83.0.html">7.83.0</a> was released on April 27 2022, coordinated with the
publication of this advisory.</p>
<h2 id="credits">CREDITS</h2>
<ul>
<li>Reported-by: Harry Sintonen</li>
<li>Patched-by: Daniel Stenberg</li>
</ul>
<p>Thanks a lot!</p>
</div>
</div>
</body> </html>
