

| [cgit logo](/) | [index](/) : [kernel/git/stable/linux.git](/pub/scm/linux/kernel/git/stable/linux.git/) | linux-2.6.11.y linux-2.6.12.y linux-2.6.13.y linux-2.6.14.y linux-2.6.15.y linux-2.6.16.y linux-2.6.17.y linux-2.6.18.y linux-2.6.19.y linux-2.6.20.y linux-2.6.21.y linux-2.6.22.y linux-2.6.23.y linux-2.6.24.y linux-2.6.25.y linux-2.6.26.y linux-2.6.27.y linux-2.6.28.y linux-2.6.29.y linux-2.6.30.y linux-2.6.31.y linux-2.6.32.y linux-2.6.33.y linux-2.6.34.y linux-2.6.35.y linux-2.6.36.y linux-2.6.37.y linux-2.6.38.y linux-2.6.39.y linux-3.0.y linux-3.1.y linux-3.10.y linux-3.11.y linux-3.12.y linux-3.13.y linux-3.14.y linux-3.15.y linux-3.16.y linux-3.17.y linux-3.18.y linux-3.19.y linux-3.2.y linux-3.3.y linux-3.4.y linux-3.5.y linux-3.6.y linux-3.7.y linux-3.8.y linux-3.9.y linux-4.0.y linux-4.1.y linux-4.10.y linux-4.11.y linux-4.12.y linux-4.13.y linux-4.14.y linux-4.15.y linux-4.16.y linux-4.17.y linux-4.18.y linux-4.19.y linux-4.2.y linux-4.20.y linux-4.3.y linux-4.4.y linux-4.5.y linux-4.6.y linux-4.7.y linux-4.8.y linux-4.9.y linux-5.0.y linux-5.1.y linux-5.10.y linux-5.11.y linux-5.12.y linux-5.13.y linux-5.14.y linux-5.15.y linux-5.16.y linux-5.17.y linux-5.18.y linux-5.19.y linux-5.2.y linux-5.3.y linux-5.4.y linux-5.5.y linux-5.6.y linux-5.7.y linux-5.8.y linux-5.9.y linux-6.0.y linux-6.1.y linux-6.10.y linux-6.11.y linux-6.12.y linux-6.2.y linux-6.3.y linux-6.4.y linux-6.5.y linux-6.6.y linux-6.7.y linux-6.8.y linux-6.9.y linux-rolling-lts linux-rolling-stable master |
| --- | --- | --- |
| Linux kernel stable tree | Stable Group |

| [about](/pub/scm/linux/kernel/git/stable/linux.git/about/)[summary](/pub/scm/linux/kernel/git/stable/linux.git/)[refs](/pub/scm/linux/kernel/git/stable/linux.git/refs/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)[log](/pub/scm/linux/kernel/git/stable/linux.git/log/)[tree](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)[commit](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)[diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)[stats](/pub/scm/linux/kernel/git/stable/linux.git/stats/) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Shradha Todi <shradha.t@samsung.com> | 2021-03-24 15:46:09 +0530 |
| --- | --- | --- |
| committer | Lorenzo Pieralisi <lorenzo.pieralisi@arm.com> | 2021-03-26 15:21:53 +0000 |
| commit | [6613bc2301ba291a1c5a90e1dc24cf3edf223c03](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03) ([patch](/pub/scm/linux/kernel/git/stable/linux.git/patch/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)) | |
| tree | [b6d1daf72679f0e044430e7a8a17d794a83960fe](/pub/scm/linux/kernel/git/stable/linux.git/tree/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03) | |
| parent | [a38fd8748464831584a19438cbb3082b5a2dab15](/pub/scm/linux/kernel/git/stable/linux.git/commit/?id=a38fd8748464831584a19438cbb3082b5a2dab15) ([diff](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03&id2=a38fd8748464831584a19438cbb3082b5a2dab15)) | |
| download | [linux-6613bc2301ba291a1c5a90e1dc24cf3edf223c03.tar.gz](/pub/scm/linux/kernel/git/stable/linux.git/snapshot/linux-6613bc2301ba291a1c5a90e1dc24cf3edf223c03.tar.gz) | |

PCI: endpoint: Fix NULL pointer dereference for ->get\_features()get\_features ops of pci\_epc\_ops may return NULL, causing NULL pointer
dereference in pci\_epf\_test\_alloc\_space function. Let us add a check for
pci\_epc\_feature pointer in pci\_epf\_test\_bind before we access it to avoid
any such NULL pointer dereference and return -ENOTSUPP in case
pci\_epc\_feature is not found.
When the patch is not applied and EPC features is not implemented in the
platform driver, we see the following dump due to kernel NULL pointer
dereference.
Call trace:
pci\_epf\_test\_bind+0xf4/0x388
pci\_epf\_bind+0x3c/0x80
pci\_epc\_epf\_link+0xa8/0xcc
configfs\_symlink+0x1a4/0x48c
vfs\_symlink+0x104/0x184
do\_symlinkat+0x80/0xd4
\_\_arm64\_sys\_symlinkat+0x1c/0x24
el0\_svc\_common.constprop.3+0xb8/0x170
el0\_svc\_handler+0x70/0x88
el0\_svc+0x8/0x640
Code: d2800581 b9403ab9 f9404ebb 8b394f60 (f9400400)
---[ end trace a438e3c5a24f9df0 ]---
Link: [https://lore.kernel.org/r/20210324101609.79278-1-shradha.t@samsung.com](https://lore.kernel.org/r/20210324101609.79278-1-shradha.t%40samsung.com)
Fixes: 2c04c5b8eef79 ("PCI: pci-epf-test: Use pci\_epc\_get\_features() to get EPC features")
Signed-off-by: Sriram Dash <dash.sriram@gmail.com>
Signed-off-by: Shradha Todi <shradha.t@samsung.com>
Signed-off-by: Lorenzo Pieralisi <lorenzo.pieralisi@arm.com>
Reviewed-by: Pankaj Dubey <pankaj.dubey@samsung.com>
Reviewed-by: Kishon Vijay Abraham I <kishon@ti.com>
[Diffstat](/pub/scm/linux/kernel/git/stable/linux.git/diff/?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)

| -rw-r--r-- | [drivers/pci/endpoint/functions/pci-epf-test.c](/pub/scm/linux/kernel/git/stable/linux.git/diff/drivers/pci/endpoint/functions/pci-epf-test.c?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03) | 17 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 10 insertions, 7 deletions

| diff --git a/drivers/pci/endpoint/functions/pci-epf-test.c b/drivers/pci/endpoint/functions/pci-epf-test.cindex c0ac4e9cbe72fe..bc35b3566be61b 100644--- a/[drivers/pci/endpoint/functions/pci-epf-test.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-test.c?id=a38fd8748464831584a19438cbb3082b5a2dab15)+++ b/[drivers/pci/endpoint/functions/pci-epf-test.c](/pub/scm/linux/kernel/git/stable/linux.git/tree/drivers/pci/endpoint/functions/pci-epf-test.c?id=6613bc2301ba291a1c5a90e1dc24cf3edf223c03)@@ -833,15 +833,18 @@ static int pci\_epf\_test\_bind(struct pci\_epf \*epf) return -EINVAL;  epc\_features = pci\_epc\_get\_features(epc, epf->func\_no);- if (epc\_features) {- linkup\_notifier = epc\_features->linkup\_notifier;- core\_init\_notifier = epc\_features->core\_init\_notifier;- test\_reg\_bar = pci\_epc\_get\_first\_free\_bar(epc\_features);- if (test\_reg\_bar < 0)- return -EINVAL;- pci\_epf\_configure\_bar(epf, epc\_features);+ if (!epc\_features) {+ dev\_err(&epf->dev, "epc\_features not implemented\n");+ return -EOPNOTSUPP; } + linkup\_notifier = epc\_features->linkup\_notifier;+ core\_init\_notifier = epc\_features->core\_init\_notifier;+ test\_reg\_bar = pci\_epc\_get\_first\_free\_bar(epc\_features);+ if (test\_reg\_bar < 0)+ return -EINVAL;+ pci\_epf\_configure\_bar(epf, epc\_features);+ epf\_test->test\_reg\_bar = test\_reg\_bar; epf\_test->epc\_features = epc\_features; |
| --- |

generated by [cgit 1.2.3-korg](https://git.zx2c4.com/cgit/about/) ([git 2.43.0](https://git-scm.com/)) at 2025-01-10 13:06:51 +0000

