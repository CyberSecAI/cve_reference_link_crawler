

| [cgit logo](/cgi-bin/cgit.cgi/) | [index](/cgi-bin/cgit.cgi/) : [mupdf.git](/cgi-bin/cgit.cgi/mupdf.git/ "mupdf.git") | 1.18.x 1.19.x 1.20.x 1.21.x 1.22.x 1.23.x 1.24.x 1.25.x android-muso android-muso-signing android-openjpeg-2.3.1 css fontconfig java-empty-store lcms lcms2 line\_art\_filter master muso muso-3.9-release muso-temporary-hack objc-openjpeg-2.3.1 release-1.10a release\_1.8 so so-tess2 stext-flags win-openjpeg-2.3.1 winRT winphone |
| --- | --- | --- |
| MuPDF library | Chris Liddell |

| [summary](/cgi-bin/cgit.cgi/mupdf.git/)[refs](/cgi-bin/cgit.cgi/mupdf.git/refs/?id=2590fed7a355a421f062ebd4293df892800fa7ac)[log](/cgi-bin/cgit.cgi/mupdf.git/log/)[tree](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=2590fed7a355a421f062ebd4293df892800fa7ac)[commit](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=2590fed7a355a421f062ebd4293df892800fa7ac)[diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=2590fed7a355a421f062ebd4293df892800fa7ac) | log msg author committer range |
| --- | --- |

**diff options**

|  | |
| --- | --- |
| context: | 12345678910152025303540 |
| space: | includeignore |
| mode: | unifiedssdiffstat only |
|  |  |

| author | Sebastian Rasmussen <sebras@gmail.com> | 2016-12-01 17:15:27 -0500 |
| --- | --- | --- |
| committer | Sebastian Rasmussen <sebras@gmail.com> | 2016-12-14 16:31:13 +0100 |
| commit | [2590fed7a355a421f062ebd4293df892800fa7ac](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=2590fed7a355a421f062ebd4293df892800fa7ac) ([patch](/cgi-bin/cgit.cgi/mupdf.git/patch/?id=2590fed7a355a421f062ebd4293df892800fa7ac)) | |
| tree | [7a07c95024c28a7e1ac0506e6ffbf06c9f259e37](/cgi-bin/cgit.cgi/mupdf.git/tree/?id=2590fed7a355a421f062ebd4293df892800fa7ac) | |
| parent | [ffc4b61e6baf7a4d4e34c8901ae78ffd57da2530](/cgi-bin/cgit.cgi/mupdf.git/commit/?id=ffc4b61e6baf7a4d4e34c8901ae78ffd57da2530) ([diff](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=2590fed7a355a421f062ebd4293df892800fa7ac&id2=ffc4b61e6baf7a4d4e34c8901ae78ffd57da2530)) | |

Bug 697400: Mark visited objects when counting OCG layer entries.[Diffstat](/cgi-bin/cgit.cgi/mupdf.git/diff/?id=2590fed7a355a421f062ebd4293df892800fa7ac)

| -rw-r--r-- | [source/pdf/pdf-layer.c](/cgi-bin/cgit.cgi/mupdf.git/diff/source/pdf/pdf-layer.c?id=2590fed7a355a421f062ebd4293df892800fa7ac) | 20 | |  |  |  | | --- | --- | --- | |
| --- | --- | --- | --- | --- | --- | --- |

1 files changed, 18 insertions, 2 deletions

| diff --git a/source/pdf/pdf-layer.c b/source/pdf/pdf-layer.cindex 3296b6c5a..fc29c9d3e 100644--- a/[source/pdf/pdf-layer.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/pdf/pdf-layer.c?id=ffc4b61e6baf7a4d4e34c8901ae78ffd57da2530)+++ b/[source/pdf/pdf-layer.c](/cgi-bin/cgit.cgi/mupdf.git/tree/source/pdf/pdf-layer.c?id=2590fed7a355a421f062ebd4293df892800fa7ac)@@ -90,7 +90,14 @@ count\_entries(fz\_context \*ctx, pdf\_obj \*obj) for (i = 0; i < len; i++) { pdf\_obj \*o = pdf\_array\_get(ctx, obj, i);- count += (pdf\_is\_array(ctx, o) ? count\_entries(ctx, o) : 1);+ if (pdf\_mark\_obj(ctx, o))+ continue;+ fz\_try(ctx)+ count += (pdf\_is\_array(ctx, o) ? count\_entries(ctx, o) : 1);+ fz\_always(ctx)+ pdf\_unmark\_obj(ctx, o);+ fz\_catch(ctx)+ fz\_rethrow(ctx); } return count; }@@ -106,7 +113,16 @@ populate\_ui(fz\_context \*ctx, pdf\_ocg\_descriptor \*desc, pdf\_ocg\_ui \*ui, pdf\_obj \* pdf\_obj \*o = pdf\_array\_get(ctx, order, i); if (pdf\_is\_array(ctx, o)) {- ui = populate\_ui(ctx, desc, ui, o, depth+1, rbgroups, locked);+ if (pdf\_mark\_obj(ctx, o))+ continue;++ fz\_try(ctx)+ ui = populate\_ui(ctx, desc, ui, o, depth+1, rbgroups, locked);+ fz\_always(ctx)+ pdf\_unmark\_obj(ctx, o);+ fz\_catch(ctx)+ fz\_rethrow(ctx);+ continue; } ui->depth = depth; |
| --- |

generated by [cgit v1.2.3](https://git.zx2c4.com/cgit/about/) ([git 2.25.1](https://git-scm.com/)) at 2025-01-11 16:27:44 +0000

