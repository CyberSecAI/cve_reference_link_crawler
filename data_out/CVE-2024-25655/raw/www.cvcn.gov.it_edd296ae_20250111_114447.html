



<!DOCTYPE html>
<html lang="it">
    <head>
        <!-- Required meta tags -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
        <!-- Page details -->
        <title>
            
CVCN

        </title>
        <meta name="description" content="Bootstrap Italia">
        <meta name="keywords" content="Bootstrap Italia">
        <meta name="robots" content="all" />
        <!-- CSS -->
        <link rel="stylesheet" href="/static/css/bootstrap-italia.min.css">
        <!-- Fonts -->
        <script src="/cvcn/interazione/js/bootstrap-static-base.js"></script>
        <!-- Javascript -->
        <script src="/static/js/bootstrap-italia.bundle.min.js"></script>
        <!-- Extra CSS/Javascript -->
        

<link rel="stylesheet" type="text/css" href="/static/chosen/chosen.css">
<link rel="stylesheet" type="text/css" href="/static/chosen/bootstrap-chosen.css">
<link rel="stylesheet" href="/static/interazione_app/css/style.css">


    </head>
    <body>
        
        <div class="it-header-wrapper">

            <!-- Top row in header -->
            
<header id="main-header" class="header it-header-slim-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-12">
                <div class="it-header-slim-wrapper-content">
                    <a class="d-none d-md-block navbar-brand"></a>
                    <a id="mise-logo" data-img="/static/images/logo_ACN.png" class="d-none d-md-block navbar-brand text-right"></a>
                    <a class="d-md-none d-sm-block navbar-brand"></a>
                    <a id="mise-logo-sm" data-img="/static/images/logo_ACN.png"
                        class="d-md-none d-sm-block navbar-brand"></a>

                    <div class="header-slim-right-zone">
                        <div class="it-access-top-wrapper">
                            
                            
                                
                            
                        </div> <!-- it-access-top-wrapper -->
                    </div> <!-- header-slim-right-zone -->
                </div> <!-- it-header-slim-wrapper-content -->
            </div> <!-- col-12 -->
        </div> <!-- row -->
    </div> <!-- container -->
</header>


            <div class="it-nav-wrapper">
                <div class="it-header-center-wrapper">
                    <div class="container">
                        <div class="row">
                            <div class="col-12">
                                <div class="it-header-center-content-wrapper">
                                    <!-- Logo -->
                                    
<div class="it-brand-wrapper d-flex mx-auto mx-md-0 mb-md-5">
    <a href="https://www.acn.gov.it">
        
        <img style="margin-right: 15px; max-width: 11rem;" class="header_LOGO img-fluid" alt="logo ACN"
            src="/static/interazione_app/img/logo_ACN.png">
        
    </a>
    <a href="/cvcn/interazione/">
        
        <div class="it-brand-text">
            <h2 class="no_toc">
                
                CVCN
                
            </h2>
            <h3 class="no_toc d-none d-md-block">                
                
                CENTRO DI VALUTAZIONE E CERTIFICAZIONE NAZIONALE
                
            </h3>
        </div>
        
    </a>
</div>


                                    <!-- Social and Search -->
                                    
                                    <div class="it-right-zone">
                                        


                                        
                                    </div>
                                    
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Main menu -->
                
<div class="it-header-navbar-wrapper">
    <div class="container">
        <div class="row">
            <div class="col-12">
                
            </div>
        </div>
    </div>
</div>
</div>

            </div>
        </div>
        

        

        <!-- Container - Body of page-->
        <div class="main-body">
            



<div class="offset-lg-2 offset-md-1 col-lg-8 col-md-10 col-sm-12">
    <div class="ml-4 mr-4">
        <nav class="breadcrumb-container" aria-label="Percorso di navigazione">
            <ol class="breadcrumb">
                <li class="breadcrumb-item"><a href="/cvcn/interazione/">Home</a>
                    <span class="separator" aria-hidden="true">&gt;</span>
                </li>
                <li class="breadcrumb-item active" aria-current="page">Dettaglio CVE-2024-25655</li>
            </ol>
        </nav>

        <h1>CVE-2024-25655</h1>

        <div class="card card-bg p-3 mt-3 mb-3">
            
            <h5>Description</h5>
            <div>Insecure storage of LDAP passwords in the authentication functionality of AVSystem Unified Management Platform (UMP) 23.07.0.16567~LTS allows members (with read access to the application database) to decrypt the LDAP passwords of users who successfully authenticate to web management via LDAP.</div>
            

            

            

            

            
            <h5>CVE Link</h5>
            <div><a href="https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25655" target="_blank">https://cve.mitre.org/cgi-bin/cvename.cgi?name=CVE-2024-25655</a><br>&nbsp;</div>
            

            
            <h5>CVSS v3.1</h5>
            <div><b>Base Score:</b> <a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:H/PR:H/UI:N/S:C/C:H/I:H/A:H&version=3.1" target="_blank">7.6 HIGH</a>&nbsp;&nbsp; <b>Vector:</b> CVSS:3.1/<a href="https://nvd.nist.gov/vuln-metrics/cvss/v3-calculator?vector=AV:A/AC:H/PR:H/UI:N/S:C/C:H/I:H/A:H&version=3.1" target="_blank">AV:A/AC:H/PR:H/UI:N/S:C/C:H/I:H/A:H</a><br>&nbsp;</div>
            

            

            

            
            <h5>Details</h5>
            <div><h3>Introduction</h3>

<p>
AVSystem UMP allows users in a domain directory service to authenticate to the web management through LDAP integration. When a domain user successfully authenticates, its LDAP password is encrypted and stored in the <code>encryptedpwd</code> field of the <code>User</code> collection in the <code>smg</code> application database (<i>MongoDB</i>). This is necessary because the product connects to the LDAP directory service to fetch the latest permissions whenever the domain user takes any action.
</p>

<pre>
{ 
    [...]
    "properties":
    { 
        "ldapUser" : "true", 
        "encryptedpwd" : "[REDACTED_ENCRYPTED_PASSWORD]"
    }, 
    "login" : "ldapuser", 
    "password" : null
}
</pre>

<p>
However, the LDAP password can be decrypted by any member with read access to the database. In fact, the encryption relies on a symmetric key derived from the username and a constant string stored in the application codebase. No other secret key is needed to perform the operation.
</p>

<p>
Specifically, the encryption algorithm is <i>AES</i> with key length of 128 bit, <i>ECB</i> mode and <i>PKCS5Padding</i>. The key is computed taking the first 16 bytes of the <i>SHA-256</i> hash of the constant string concatenated to the username: <code>key=SUBARRAY(SHA-256(CONCAT(constant_string, username)),0,16)</code>.
</p>

<pre>
public final class PasswordSymmetricEncryptor$
{ 
    [...] 
    private static final String algorithm = "AES"; 
    
    [...] 
    public String decrypt(final String userid, final String encryptedPassword) 
    { 
        Key key = generateKeyFor(userid);
        Cipher cipher = Cipher.getInstance(algorithm()); 
        cipher.init(2, key); 
        return new String(cipher.doFinal(Base64.decodeBase64(encryptedPassword)), StandardCharsets.UTF_8); 
    } 
    
    private Key generateKeyFor(final String login) 
    { 
        return new SecretKeySpec((byte[]) ArrayOps$.MODULE$.take$extension(Predef$.MODULE$.byteArrayOps(MessageDigest.getInstance(CryptoUtil.ALG_SHA256).
            digest(new StringBuilder(11).
            append([REDACTED_CONSTANT_STRING]).
            append(User.loginToId(login)).
            toString().
            getBytes(StandardCharsets.UTF_8))), 16), algorithm()); 
    }
}
</pre>

<p>
The LDAP user record in the database is created as soon as the user successfully performs authentication on the UMP web management portal, also if that user is not authorized on the portal because it lacks permissions.
</p>

<p>
To sum up, any member who has read access to the database, such as the <i>Database Administrator (DBA)</i>, can decrypt the LDAP password of every user. This will grant them access not only to the web management of this product but also to the user's directory service and all the external services that are connected to it. In the scenario of the product integrated with a corporate Active Directory, the attacker could potentially impersonate a user account and login on domain machines.
</p>


<h3>Steps to reproduce</h3>

<p>
The following Java code implements the Java class to decrypt the LDAP password for a given user.
</p>

<pre>
class LdapPasswordDecryptor 
{ 
    public String decrypt(String username, String encryptedPassword) throws Exception 
    { 
        String sanitisedUsername = username.strip().toLowerCase(); 
        byte[] aes256Key = MessageDigest.getInstance("SHA-256").
                digest(new StringBuilder(11).
                append([REDACTED_CONSTANT_STRING]).
                append(sanitisedUsername).toString().
                getBytes(StandardCharsets.UTF_8)); 
        byte[] aes128Key = Arrays.copyOfRange(aes256Key, 0, 16); 

        Cipher cipher = Cipher.getInstance("AES/ECB/PKCS5Padding"); 
        SecretKeySpec key = new SecretKeySpec(aes128Key,"AES"); 
        cipher.init(2, key); 

        byte[] decodedEncryptedPassword = Base64.getUrlDecoder().decode(encryptedPassword); 
        return new String(cipher.doFinal(decodedEncryptedPassword), StandardCharsets.UTF_8); 
    } 
}
</pre>

The <code>decrypt</code> method takes in input the <code>login</code> and <code>encryptedpwd</code> fields from database and returns the cleartext LDAP password.</div>
            
        </div>
    </div>
</div>


        </div>

        <!-- Footer -->
        
        <footer class="it-footer">
            <div class="it-footer-main">
                <div class="container">
                    
<section>
    <div class="row clearfix">
        <div class="col-sm-11">
            <div class="it-brand-wrapper">
                <a href="https://www.acn.gov.it">
                    <img style="margin-right: 15px" class="header_LOGO img-fluid" alt="logo ACN"
                        src="/static/interazione_app/img/logo_ACN.png" width="100">
                    <div class="it-brand-text">
                        <h2 class="no_toc">
                            CVCN
                        </h2>
                        <h3 class="no_toc d-none d-md-block">
                            CENTRO DI VALUTAZIONE E CERTIFICAZIONE NAZIONALE
                        </h3>
                        
                    </div>
                </a>
            </div>
        </div>
    </div>
</section>


                    <!-- Footer middle section with menu blocks -->
                    


                    <!-- Footer bottom section with contacts -->
                    

                </div>
            </div>

            
            <div class="it-footer-small-prints clearfix">
                <div class="container">
                    
    <h6 style="color: white">LINK UTILI</h6>
    <ul class="it-footer-small-prints-list list-inline mb-0 d-flex flex-column flex-md-row" style="padding-top: 0px; padding-left: 0px;">
        <li class="list-inline-item"><a href="/cvcn/interazione/faq" title="FAQ">FAQ</a></li>
        <li class="list-inline-item"><a href="https://www.acn.gov.it/informative/cvcn" title="FAQ">Privacy Policy</a></li>
        <li class="list-inline-item"><a href="mailto:info@acn.gov.it" title="Help Desk">Help Desk</a></li>
        <li class="list-inline-item"><a href="https://www.acn.gov.it" title="Agenzia per la cybersicurezza nazionale">Agenzia per la cybersicurezza nazionale</a></li>
        <li class="list-inline-item"><a href="https://www.csirt.gov.it/" title="CSIRT Italia">CSIRT Italia</a></li>
    </ul>
</div>

                </div>
            </div>
            
        </footer>
        

        

<script type="text/javascript" src="/static/arrive/arrive.js"></script>
<script src="/static/chosen/chosen.jquery.js" type="text/javascript"></script>
<script src="/static/chosen/chosen.jquery-ui.js" type="text/javascript"></script>
<script type="text/javascript" src="/static/interazione_app/js/init_chosen.js"></script>

<script src="/static/jquery-validate/jquery.validate.min.js"></script>

<script type="text/javascript" src="/static/interazione_app/js/popper.min.js"></script>
<script src="/cvcn/interazione/js/bootstrap-static-base.js"></script>
<script type="text/javascript" src="/static/interazione_app/js/popover_init.js"></script>



        
    </body>
</html>
